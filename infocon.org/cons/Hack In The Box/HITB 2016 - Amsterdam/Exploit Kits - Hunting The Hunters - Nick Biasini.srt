1
00:00:14,560 --> 00:00:17,730
thanks everybody for coming out and
seeing me talk about it

2
00:00:17,730 --> 00:00:20,939
like it's a little bit about me

3
00:00:20,939 --> 00:00:27,000
I am a amateur coffee roaster a beer
snob and an occasional gamer as far as

4
00:00:27,000 --> 00:00:28,619
my career goes

5
00:00:28,619 --> 00:00:31,680
I've spent basically the entire time and
security

6
00:00:31,680 --> 00:00:36,900
the majority of that in sox started out
as an analyst working a 24 x seven shift

7
00:00:37,500 --> 00:00:42,600
I've been an analyst lead analyst
engineer policy certification

8
00:00:42,600 --> 00:00:43,710
accreditation

9
00:00:43,710 --> 00:00:47,070
I like to say I've done everything but
development because that's just not me

10
00:00:47,070 --> 00:00:51,480
as far as my research is concerned most
of it has been focused lately around

11
00:00:51,480 --> 00:00:56,069
exploit kits and I've done some stuff
about now are being delivered via email

12
00:00:56,070 --> 00:00:56,850
as well

13
00:00:56,850 --> 00:01:03,539
okay so I like to kind of start with a
baseline of what exploit kits are how

14
00:01:03,539 --> 00:01:04,410
they operate

15
00:01:04,410 --> 00:01:07,979
just to make sure everybody has a
general idea so an exploit it is

16
00:01:07,979 --> 00:01:12,509
basically a web-based platform for
compromise as far as the components are

17
00:01:12,509 --> 00:01:17,310
concerned there's some initial read
erection that comes from stuff that I'll

18
00:01:17,310 --> 00:01:21,570
talk about that eventually leads to a
gate the gate is just a series of

19
00:01:21,570 --> 00:01:25,410
redirections with occasional probing of
system before

20
00:01:26,160 --> 00:01:31,020
if they find a vulnerability deliver a
landing page that's doing even further

21
00:01:31,020 --> 00:01:35,819
probing of the browser doing things like
finding out your OS your browser version

22
00:01:35,819 --> 00:01:39,660
the plugins you have installed the
versions of those plugins and if they

23
00:01:39,660 --> 00:01:40,770
find a match

24
00:01:40,770 --> 00:01:46,080
they're delivering an exploit page with
some sort of payload as far as the

25
00:01:46,080 --> 00:01:47,399
payloads are concerned

26
00:01:47,399 --> 00:01:50,880
so now we're downloaders are they're
pretty common

27
00:01:50,880 --> 00:01:54,660
we see them a good portion of the time
obviously that's a first stage

28
00:01:55,349 --> 00:01:58,800
download you know you you get a malware
downloader there's a secondary payload

29
00:01:58,800 --> 00:02:00,720
associated with it

30
00:02:00,720 --> 00:02:06,239
historically like with angler we see the
depth used to drop click fraud software

31
00:02:06,239 --> 00:02:10,229
quite a bit now they've kind of pivoted
and are now delivering ransomware as a

32
00:02:10,229 --> 00:02:15,270
secondary payload we do see stuff that i
like to call the one offs

33
00:02:15,270 --> 00:02:18,520
every once in a while you'll see things
like trojans pop up

34
00:02:18,520 --> 00:02:23,500
uh a year and a half ago we saw some
weird malware that was associated with

35
00:02:23,500 --> 00:02:24,190
it

36
00:02:24,190 --> 00:02:29,050
it's not that prevalent but what is
prevalent is ransomware ransom or ransom

37
00:02:29,050 --> 00:02:33,820
or ransomware ransomware I can't
emphasize enough like two-thirds to

38
00:02:33,820 --> 00:02:37,810
three-quarters of the payloads now I
ransomware and it makes sense you know

39
00:02:37,810 --> 00:02:41,320
bad guys are out there and make money
right now how do you make money

40
00:02:41,320 --> 00:02:44,470
ransomware so that's why they deliver it
all the time

41
00:02:44,470 --> 00:02:49,240
let me take a step back and talk a
little bit about the history of exploit

42
00:02:49,240 --> 00:02:53,470
kits so I look at exploit kits largely
is like an assembly line approach

43
00:02:53,470 --> 00:02:58,270
so you have the domains you're going to
use the IP is associated with it

44
00:02:58,270 --> 00:03:01,600
you kind of move down the line and pick
out what exploits you want to use like I

45
00:03:01,600 --> 00:03:05,290
want to use these flash exploits the
silverlight exploit you keep moving down

46
00:03:05,290 --> 00:03:08,859
the line and then eventually selected
payload it go and you're off and running

47
00:03:09,430 --> 00:03:15,910
so if you go back this is from like Ford
in 1915 this is my analogy for where we

48
00:03:15,910 --> 00:03:18,280
were probably 10 years ago

49
00:03:18,280 --> 00:03:22,360
blackhole exploit kit was one of the
first big large successful exploit kits

50
00:03:22,360 --> 00:03:27,610
anybody that worked in operations five
or ten years ago probably has many many

51
00:03:27,610 --> 00:03:31,690
many stories about mitigating a box that
got popped by black hole and had zero

52
00:03:31,690 --> 00:03:33,160
access dropped on it

53
00:03:33,160 --> 00:03:36,490
I can't tell you there's probably a
period of six months where I was

54
00:03:36,490 --> 00:03:39,459
mitigating at least one every single day

55
00:03:39,459 --> 00:03:43,420
look the these devices were really good
at what they did they compromised

56
00:03:43,420 --> 00:03:45,220
systems very effectively

57
00:03:45,220 --> 00:03:50,620
but this is where we sit today this is
an assembly line for mercedes-benz from

58
00:03:50,620 --> 00:03:51,880
like a year or two ago

59
00:03:51,880 --> 00:03:55,870
this is how i look at exploit kits now
they're doing far more sophisticated

60
00:03:55,870 --> 00:04:00,160
things and you went from an industry
that was making money but doing things

61
00:04:00,160 --> 00:04:05,020
like dropping botnet clients now you're
talking about fifty a hundred million

62
00:04:05,020 --> 00:04:06,310
dollars at stake

63
00:04:06,310 --> 00:04:10,150
there's huge money behind these
organizations and it is really started

64
00:04:10,150 --> 00:04:14,500
to show seeing techniques and things
like domain shadowing which is

65
00:04:14,500 --> 00:04:19,269
compromising registered accounts hosting
the malicious activity under sub domains

66
00:04:19,269 --> 00:04:24,789
for those legitimate domains 302
cushioning which is the use of HTTP 302

67
00:04:24,790 --> 00:04:28,570
to use is another tier of redirection
another way for them to hide in the

68
00:04:28,570 --> 00:04:34,480
noise and then even more so seeing
things like custom encrypted payloads

69
00:04:34,480 --> 00:04:39,430
where the victim system is posting out
data that data is being used in a diff

70
00:04:39,430 --> 00:04:42,550
helmet encryption and the payload is
being custom encrypted to every single

71
00:04:42,550 --> 00:04:43,420
victim

72
00:04:43,420 --> 00:04:46,990
this is not stuff that five or ten years
ago you ever would have thought would be

73
00:04:46,990 --> 00:04:49,270
associated with a threat like exploit
kits

74
00:04:49,270 --> 00:04:56,620
ok so this is kind of a high-level
overview of how you get compromised user

75
00:04:56,620 --> 00:04:58,810
browses to some website

76
00:04:58,810 --> 00:05:05,830
historically it's very heavily either a
compromise website militia sad they go

77
00:05:05,830 --> 00:05:10,990
through a gate they get served a landing
page browser gets probed find

78
00:05:10,990 --> 00:05:16,420
vulnerability exploits delivered in a
payload but instead of just showing you

79
00:05:16,420 --> 00:05:17,230
a diagram

80
00:05:17,230 --> 00:05:21,160
I'm going to run through a quick video
because I find the most people have

81
00:05:21,160 --> 00:05:25,360
never actually seen what it looks like
for a user to get compromised on this is

82
00:05:25,360 --> 00:05:30,880
a newspaper from the United States and
when i was doing my research into angler

83
00:05:30,880 --> 00:05:34,030
i noticed that they were targeting
obituaries

84
00:05:34,030 --> 00:05:38,710
specifically which kind of makes sense
in an evil genius kind of way

85
00:05:38,710 --> 00:05:43,359
if you want to compromise people running
a default web browser with all versions

86
00:05:43,360 --> 00:05:48,040
of flash by targeting the elderly you're
going to increase your chances

87
00:05:48,040 --> 00:05:52,810
statistically significantly but as you
can see some user goes maybe they knew

88
00:05:52,810 --> 00:05:57,640
what are low brow here was looking up
their obituary in the back end they are

89
00:05:57,640 --> 00:06:01,750
actually being fully compromised and
ransom was dropped on their system as

90
00:06:01,750 --> 00:06:04,840
you can see there is absolutely no
indicator to the user

91
00:06:04,840 --> 00:06:08,560
there's no windows that pop up there's
no things you have to click through all

92
00:06:08,560 --> 00:06:12,850
it takes is literally just browsing to a
web page to get compromised

93
00:06:12,850 --> 00:06:21,760
all right that's my quick and dirty this
is what exploit kits are now the main

94
00:06:21,760 --> 00:06:23,729
topic hunting

95
00:06:23,729 --> 00:06:27,568
so the first thing I'll say about
hunting exploit kits is this is a

96
00:06:27,569 --> 00:06:31,110
constant effort you know these kits are
constantly evolving and changing

97
00:06:31,889 --> 00:06:35,550
they are very very good it at making
sure that they evade detection

98
00:06:36,330 --> 00:06:40,020
you know get delivered to as many users
as possible compromise as many systems

99
00:06:40,020 --> 00:06:41,128
as possible

100
00:06:41,129 --> 00:06:46,050
you can get up to speed on kits if you
know what you're doing not not too

101
00:06:46,050 --> 00:06:49,830
difficult but staying up with how they
change and evolve is the really really

102
00:06:49,830 --> 00:06:51,180
challenging part

103
00:06:51,180 --> 00:06:57,360
ok so one of the things that I like to
focus on is not just the kids themselves

104
00:06:57,360 --> 00:07:00,360
but how users are actually getting there

105
00:07:01,080 --> 00:07:06,149
and this is a couple examples of some of
the initial redirections and gates and

106
00:07:06,149 --> 00:07:08,969
stuff that I've seen start with this
over here

107
00:07:08,969 --> 00:07:14,339
that's a porn add that was targeted
specifically at spanish-speaking users

108
00:07:14,339 --> 00:07:16,860
as you can see by the spanish word there

109
00:07:16,860 --> 00:07:22,680
it's not uncommon for adult websites to
be targeted by malicious ads and

110
00:07:22,680 --> 00:07:25,409
adversaries trying to compromise users

111
00:07:25,409 --> 00:07:30,899
this is super effective I've seen kind
of a re-emergence of this in the last

112
00:07:30,899 --> 00:07:33,749
couple of months in a lot of ways that
makes sense

113
00:07:33,749 --> 00:07:38,009
you know you don't really want to hit
enterprise users if you're an exploit

114
00:07:38,009 --> 00:07:39,360
kit user

115
00:07:39,360 --> 00:07:42,870
the reason being you know that an
enterprise you're likely to be dealing

116
00:07:42,870 --> 00:07:45,180
with a whole bunch of different layers
of security

117
00:07:45,180 --> 00:07:49,529
I mean you're not just going to have the
Navy on the system but you're going to

118
00:07:49,529 --> 00:07:53,520
have AV you're going to have IDs IPS you
can have web security a whole bunch of

119
00:07:53,520 --> 00:07:54,628
different layers there

120
00:07:54,629 --> 00:07:58,589
so by targeting adult sites you're
probably not going to hit very many

121
00:07:58,589 --> 00:08:01,589
enterprise users at least you would hope
not

122
00:08:02,279 --> 00:08:06,870
and then here on the right is another
example of the militias and I saw this

123
00:08:06,870 --> 00:08:08,879
one spoofing a gambling site

124
00:08:08,879 --> 00:08:12,270
the ad itself was in German which you
cannot see it all

125
00:08:12,270 --> 00:08:18,330
the one thing in particular that was
interesting about this was the fact that

126
00:08:18,330 --> 00:08:21,120
it was redirecting to multiple different
exploit kits

127
00:08:21,120 --> 00:08:26,399
so one time motor act the ad i would get
angler and then interact with the same

128
00:08:26,399 --> 00:08:29,069
at again same site same domains

129
00:08:29,069 --> 00:08:35,339
this time i would get break um this is a
good example of either advertising as a

130
00:08:35,339 --> 00:08:36,270
service

131
00:08:36,270 --> 00:08:40,710
where you have an adversary or group of
adversaries that instead of focusing on

132
00:08:40,710 --> 00:08:45,480
delivering actual malicious content is
more focused on just delivering traffic

133
00:08:45,480 --> 00:08:48,510
so they could . wherever they see fit

134
00:08:48,510 --> 00:08:54,030
or you have an adversary that is using
both rig and angler without any

135
00:08:54,030 --> 00:08:55,680
visibility it's kinda hard to say

136
00:08:55,680 --> 00:09:00,750
then the bottom here this is what you
see very very commonly in websites that

137
00:09:00,750 --> 00:09:02,370
are compromised you'll see

138
00:09:02,370 --> 00:09:07,800
I don't know one or 50 of these I frames
that are dropped throughout one page or

139
00:09:07,800 --> 00:09:12,569
many pages in this particular case it's
pointing to a gate that again will point

140
00:09:12,570 --> 00:09:13,860
to an exploit kit

141
00:09:13,860 --> 00:09:19,680
now recently this kind of took a pivot
to change that I hadn't seen in awhile

142
00:09:19,680 --> 00:09:25,469
or really ever a couple of weeks ago we
started seeing this

143
00:09:26,190 --> 00:09:29,460
this is an obviously a spam message

144
00:09:29,460 --> 00:09:32,880
the subject lines are all consistent
your online order was successfully

145
00:09:32,880 --> 00:09:34,230
submitted thank you

146
00:09:34,230 --> 00:09:38,700
other things that they buried were the
companies involved so they used by

147
00:09:38,700 --> 00:09:41,400
member cokie about nine hundred
different companies

148
00:09:41,400 --> 00:09:46,199
some of them really large like AT&T is a
telecommunications provider in the US

149
00:09:47,040 --> 00:09:50,339
there was also amazon on there and then
I saw a whole bunch of companies like

150
00:09:50,340 --> 00:09:54,210
this which I don't know if the real
companies are not but the points the

151
00:09:54,210 --> 00:09:59,370
same the text of the ad or the email was
basically the same and there was a

152
00:09:59,370 --> 00:10:03,720
single link to go to their site now what
was actually happening on the back end

153
00:10:03,720 --> 00:10:09,180
was I found this and this is actually
how i found this spam campaign

154
00:10:09,180 --> 00:10:13,260
so i mentioned before i spend time
looking not just at the exploit kits but

155
00:10:13,260 --> 00:10:18,000
how users are getting infected and I
started to see a couple of different web

156
00:10:18,000 --> 00:10:20,340
pages that were ending in order

157
00:10:20,340 --> 00:10:24,420
underscore order / order underscore
details . HTML

158
00:10:24,930 --> 00:10:28,829
one of the things i'll do is i'll try
and figure out well how did the user get

159
00:10:28,830 --> 00:10:29,580
here

160
00:10:29,580 --> 00:10:34,320
you know it's not uncommon to see a
compromise wordpress site delivering an

161
00:10:34,320 --> 00:10:35,310
exploit kit

162
00:10:35,310 --> 00:10:40,829
what is unique though is having it in
this big giant weird path

163
00:10:40,830 --> 00:10:44,190
so what ended up finding is only links
to this

164
00:10:44,880 --> 00:10:49,010
it's like the user just magically went
to this one particular page

165
00:10:49,010 --> 00:10:53,990
so I went ahead and looked in email to
see if i could find the links and sure

166
00:10:53,990 --> 00:10:58,610
enough I found like 25 different sites
that were involved in a couple of

167
00:10:58,610 --> 00:11:00,500
thousand email messages

168
00:11:00,500 --> 00:11:04,160
so what happened to the user when they
click the link this is what is sitting

169
00:11:04,160 --> 00:11:06,560
on the page

170
00:11:06,560 --> 00:11:12,530
it's just a title saying gathering order
details on image and then an iframe the

171
00:11:12,530 --> 00:11:17,449
image is this which is kind of funny to
me

172
00:11:17,450 --> 00:11:21,440
I remember working with web-based
vulnerabilities long ago and when you're

173
00:11:21,440 --> 00:11:26,240
dealing with user side stuff you display
a gift like that to the user while in

174
00:11:26,240 --> 00:11:28,580
the background you're compromising the
box

175
00:11:28,580 --> 00:11:32,000
a while that's running on the screen
this is what was happening in the

176
00:11:32,000 --> 00:11:32,870
background

177
00:11:32,870 --> 00:11:38,780
I get request to a hard coded IP the it
was like a bunch of different sub

178
00:11:38,780 --> 00:11:44,689
folders this one was Facebook API which
was pointing to angler instance the

179
00:11:44,690 --> 00:11:49,460
interesting stuff with this is the fact
that was running on port 8080 we do see

180
00:11:49,460 --> 00:11:53,330
exploit kits use non-standard ports
occasionally but it's not all that

181
00:11:53,330 --> 00:11:54,680
common

182
00:11:54,680 --> 00:12:00,079
the other thing was this was but i guess
so much volume that periodically the

183
00:12:00,080 --> 00:12:02,540
adversary return the gate down

184
00:12:02,540 --> 00:12:06,650
the interesting thing is how they did it
a lot of times we just get 40 force they

185
00:12:06,650 --> 00:12:08,180
just take the page offline

186
00:12:08,180 --> 00:12:12,079
they actually change the link to point
to like AT&T com

187
00:12:12,080 --> 00:12:17,090
so when a user would go to the page they
would be rendering 80.com like three

188
00:12:17,090 --> 00:12:18,890
feet to the left of the screen

189
00:12:18,890 --> 00:12:28,370
ok so the stuff that i found i mentioned
domain shadowing before as well as 302

190
00:12:28,370 --> 00:12:29,150
cushioning

191
00:12:29,150 --> 00:12:33,829
this is kind of interesting so this is
the landing page for anglers

192
00:12:33,830 --> 00:12:39,740
specifically what's interesting about
this is the quotes that they embedded in

193
00:12:39,740 --> 00:12:40,490
the page

194
00:12:40,490 --> 00:12:43,880
so this is all quotes from Sense and
Sensibility

195
00:12:43,880 --> 00:12:48,920
no one seems to know why Sense and
Sensibility but the use of text in a

196
00:12:48,920 --> 00:12:55,310
landing page is actually quite smart for
a couple of reasons the first is if for

197
00:12:55,310 --> 00:12:59,510
some reason something goes wrong and the
user actually sees this page which i

198
00:12:59,510 --> 00:13:00,170
have seen

199
00:13:00,170 --> 00:13:05,300
before in the past we'll see some text
which I mean it looks a little weird but

200
00:13:05,300 --> 00:13:09,889
it does not look anything like a garbage
script page that you would get with most

201
00:13:09,889 --> 00:13:10,970
exploit kits

202
00:13:10,970 --> 00:13:14,630
additionally if you're looking at
something that's looking at heuristics

203
00:13:14,630 --> 00:13:19,220
are trying to do any type of machine
learning by inserting big blocks of text

204
00:13:19,790 --> 00:13:23,779
it makes it look more like a normal web
page than what you would get in normal

205
00:13:23,779 --> 00:13:26,089
malicious behavior

206
00:13:26,089 --> 00:13:30,649
alright so now on to the exploit kits
themselves

207
00:13:30,649 --> 00:13:36,380
i'll be talking about three today so we
have angler rig a nuclear and i'll be

208
00:13:36,380 --> 00:13:39,709
going into much more detail on a gate
that I haven't talked about before as

209
00:13:39,709 --> 00:13:41,660
well

210
00:13:41,660 --> 00:13:45,110
all right let's start with the big boy

211
00:13:45,110 --> 00:13:51,500
so angler is the most sophisticated most
prevalent exploit kit i see out there by

212
00:13:51,500 --> 00:13:53,149
a very wide margin

213
00:13:53,149 --> 00:13:58,250
the other kits are operating effectively
they're compromising users they have

214
00:13:58,250 --> 00:14:03,260
nowhere near the scope and the
prevalence that anger does this kit is

215
00:14:03,260 --> 00:14:04,790
everywhere

216
00:14:04,790 --> 00:14:09,529
if you're browsing the Internet in
general with the real explosion in

217
00:14:09,529 --> 00:14:13,189
malvert izing in the amount of websites
that i see compromised

218
00:14:13,190 --> 00:14:18,260
you could literally be browsing a major
pop culture site or looking at the web

219
00:14:18,260 --> 00:14:20,089
page of a shop down the street

220
00:14:20,089 --> 00:14:23,269
you're highly like you to come in
contact with this exploit kit

221
00:14:23,269 --> 00:14:27,740
one way or another you're running a
patched OS and you you don't take

222
00:14:27,740 --> 00:14:31,130
unnecessary risks you're probably not
going to ever know that it's there

223
00:14:31,130 --> 00:14:34,459
so why is it so effective

224
00:14:34,459 --> 00:14:37,939
this is my favorite graphic for this

225
00:14:37,940 --> 00:14:43,069
so there's a couple of things the busy
graph but the gray lines are when the

226
00:14:43,069 --> 00:14:49,219
good people at adobe released a patch
for flash the red lines are when angler

227
00:14:49,220 --> 00:14:51,500
was seen actively exploiting it

228
00:14:51,500 --> 00:14:57,350
in this case this is from the zero day
from last January that was before patch

229
00:14:57,350 --> 00:15:01,519
obviously but in general this trend has
continued to today

230
00:15:01,519 --> 00:15:04,819
it's usually 2-3 days before

231
00:15:04,819 --> 00:15:08,660
anglers actively exploiting a new
vulnerability that that's a pretty short

232
00:15:08,660 --> 00:15:09,500
time window

233
00:15:09,500 --> 00:15:14,000
the other thing that's important to call
out is the blue dots that is the

234
00:15:14,000 --> 00:15:18,800
instances that we saw particular
versions of flash being used and the

235
00:15:18,800 --> 00:15:24,260
most concerning thing here is way over
here on the right you have june first

236
00:15:24,260 --> 00:15:28,670
there were still a significant amount of
people using a version of flash

237
00:15:28,670 --> 00:15:32,180
that's vulnerable to four out of five of
these vulnerabilities this is exactly

238
00:15:32,180 --> 00:15:38,209
what exploit kit users prey upon people
still do not match their OS

239
00:15:38,210 --> 00:15:41,270
now as for the data itself

240
00:15:41,990 --> 00:15:48,350
this whole project started for me at
blackhat last year I was kind of sitting

241
00:15:48,350 --> 00:15:53,510
around talking with my colleagues and I
was thinking about kind of like a big

242
00:15:53,510 --> 00:15:55,040
data look at threats

243
00:15:55,040 --> 00:16:00,050
I've never really seen anyone do an
attempt at a big data look at an exploit

244
00:16:00,050 --> 00:16:04,819
kit and specifically angler some lucky I
work in an organization with a lot of

245
00:16:04,820 --> 00:16:09,260
data so i sat down I was like okay let
me let me think about this when do I

246
00:16:09,260 --> 00:16:14,689
want to look for this activity and I
chose this month of july 2015 for a

247
00:16:14,690 --> 00:16:19,610
couple of reasons the first being angler
you know it periodically goes through

248
00:16:19,610 --> 00:16:21,980
changes in July it went through

249
00:16:21,980 --> 00:16:27,560
- I believe then settled upon a final
kind of version for their landing page

250
00:16:27,560 --> 00:16:33,109
for that particular iteration and we did
also have a couple of the hacking team 0

251
00:16:33,110 --> 00:16:34,370
days get dropped

252
00:16:34,370 --> 00:16:38,510
so if you're a user of angler and you
know you have unpatched vulnerabilities

253
00:16:38,510 --> 00:16:42,350
you are going to be active and that's
exactly what I was hoping for

254
00:16:43,580 --> 00:16:47,540
before I get into that though let me
talk about what I was hunting

255
00:16:47,540 --> 00:16:53,209
so what you see here is a list of angler
landing pages from during that period

256
00:16:53,210 --> 00:17:00,020
and I started to notice patterns you can
see here it's like a english word folder

257
00:17:00,020 --> 00:17:04,550
/ and then there's a couple of different
iterations there's view forum dot PHP

258
00:17:04,550 --> 00:17:12,470
viewtopic PHP and search . PHP with a
combination of keyword or keywords as

259
00:17:12,470 --> 00:17:14,420
the parameter attached to it

260
00:17:14,420 --> 00:17:19,699
that's where I started real basic that's
cut off here but the URLs that end with

261
00:17:19,699 --> 00:17:21,240
one of those three things

262
00:17:21,240 --> 00:17:25,620
I want that it you know I kind of took a
shot and said hey let me see what I get

263
00:17:26,160 --> 00:17:31,800
did not turn out too well for me in
general with exploit kits there's kind

264
00:17:31,800 --> 00:17:33,389
of two major approaches

265
00:17:33,390 --> 00:17:38,760
there's those that work really hard to
kind of hide in the noise and make their

266
00:17:38,760 --> 00:17:43,440
landing pages and exploit pages look a
lot like normal web pages and there's

267
00:17:43,440 --> 00:17:49,230
those that make their landing pages and
exploit pages look really really weird

268
00:17:49,230 --> 00:17:53,190
so that they stand out a lot and they
kind of switch back and forth in this

269
00:17:53,190 --> 00:17:57,000
particular instance anger was trying to
hide in the noise they were doing a

270
00:17:57,000 --> 00:18:00,420
really good job so i had to go back to
the drawing board

271
00:18:00,420 --> 00:18:03,929
these are the things that I started to
realize that i could easily filter out

272
00:18:03,929 --> 00:18:09,960
things like sites with no or bad web
reputation that was the only ones i was

273
00:18:09,960 --> 00:18:11,309
looking at now

274
00:18:11,309 --> 00:18:15,389
i mentioned before angler uses domain
shadowing and all of them use domain

275
00:18:15,390 --> 00:18:17,550
shadowing now pretty extensively

276
00:18:17,550 --> 00:18:21,000
now there are going to be instances
where you're dealing with an angler

277
00:18:21,000 --> 00:18:25,260
instance that has a positive web
reputation but I wasn't trying to get a

278
00:18:25,260 --> 00:18:28,050
one-shot get everything all at once

279
00:18:28,050 --> 00:18:31,950
I was just trying to get on the right
path and by excluding all the stuff with

280
00:18:31,950 --> 00:18:34,650
positive web rep I could eliminate a lot
of noise

281
00:18:34,650 --> 00:18:40,740
i also noticed that they don't use host
that begin with www perform they do

282
00:18:40,740 --> 00:18:45,300
occasionally use form in the path but
again same thing

283
00:18:45,300 --> 00:18:49,980
I'm trying to eliminate noise not make
sure I have everything in one shot and

284
00:18:49,980 --> 00:18:54,600
then a couple other things like for a
landing page your host that your URL is

285
00:18:54,600 --> 00:18:58,740
not going to be the same the host that
you refer is and then add to exclude a

286
00:18:58,740 --> 00:19:04,050
bunch of prefers that are super noisy
getting rid of google being facebook and

287
00:19:04,050 --> 00:19:09,840
again some angler actors are really good
at breaking the referrer chain but it's

288
00:19:09,840 --> 00:19:12,540
not a hundred percent and that's the
whole point

289
00:19:12,540 --> 00:19:17,760
I don't want to get rid of noise not
still have results with a bunch of noise

290
00:19:17,760 --> 00:19:22,920
added on top so i tried all this and did
it again this time I was much much much

291
00:19:22,920 --> 00:19:24,030
more successful

292
00:19:24,030 --> 00:19:27,149
I ended up with a lot just a huge amount
of data

293
00:19:30,110 --> 00:19:34,250
so I started looking through this data
and there's so much stuff i don't really

294
00:19:34,250 --> 00:19:38,210
have time to talk about a lot of it but
one of the most interesting things was

295
00:19:38,210 --> 00:19:39,770
the IP space

296
00:19:39,770 --> 00:19:43,070
so what I would see is things like this
on july six

297
00:19:43,070 --> 00:19:47,840
they would be using 7463 - 17 - 17

298
00:19:47,840 --> 00:19:53,540
and on this on the 7th they would be
using that to 18 and then the eighth .

299
00:19:53,540 --> 00:19:58,879
to 19 . - 20 would be active and then on
the ninth . - 21 would be used and I

300
00:19:58,880 --> 00:20:01,100
kept seeing this over and over again

301
00:20:01,100 --> 00:20:04,668
where they're almost like walking
through the address space so i figured

302
00:20:04,669 --> 00:20:06,140
hey let me you know

303
00:20:06,140 --> 00:20:10,940
let's go see where these providers are
on this is a rudimentary graph of the

304
00:20:10,940 --> 00:20:16,040
providers that I saw the two key ones
here are limestone networks and hetzner

305
00:20:16,040 --> 00:20:21,918
that's largely they were responsible for
I think three quarters two-thirds of the

306
00:20:21,919 --> 00:20:26,270
overall activity so i went to them and
said look I found all this bad stuff

307
00:20:27,080 --> 00:20:30,740
it's bad here is all the evidence why
it's bad

308
00:20:31,429 --> 00:20:34,429
are you willing to work with me

309
00:20:35,179 --> 00:20:40,370
luckily limestone networks was really
eager to actually work with us and

310
00:20:40,370 --> 00:20:42,620
there's a couple of reasons for that

311
00:20:42,620 --> 00:20:46,040
so i mentioned before they were kind of
walking the address space

312
00:20:46,040 --> 00:20:50,600
it turns out what they were doing was
buying a block of servers using

313
00:20:50,600 --> 00:20:56,090
fraudulent names stolen credit cards and
then the company was losing thousands of

314
00:20:56,090 --> 00:21:00,559
dollars on credit card chargebacks so
because of that and as well as the fact

315
00:21:00,559 --> 00:21:04,220
that it's a bunch of really really bad
activity they were able to work with us

316
00:21:04,220 --> 00:21:08,540
and really provided us with a huge
amount of very valuable information

317
00:21:09,350 --> 00:21:14,570
this is a one slide overview of what we
saw and basically what they did is they

318
00:21:14,570 --> 00:21:17,840
set up an enterprise service for
compromise

319
00:21:17,840 --> 00:21:21,830
I come from an Operations background
I've if you're going to tell me I need

320
00:21:21,830 --> 00:21:24,889
to stand up a web server on the internet
there are a couple of things i'm going

321
00:21:24,890 --> 00:21:25,520
to say

322
00:21:25,520 --> 00:21:29,660
the first is the server that's hosting
the stuff that you are going to be

323
00:21:29,660 --> 00:21:33,350
posting does not need to be on the
internet directly use some sort of

324
00:21:33,350 --> 00:21:37,428
proxying infrastructure which is exactly
what they did they were proxying

325
00:21:37,429 --> 00:21:42,000
everything to a server in a completely
different provider different country

326
00:21:42,000 --> 00:21:45,510
the next thing I'm going to say is I
need health monitoring and i'm not

327
00:21:45,510 --> 00:21:46,770
talking about ping checks

328
00:21:46,770 --> 00:21:52,379
I need to know the website is up and
active in operating as expected that

329
00:21:52,380 --> 00:21:56,760
again is exactly what they did they set
up a status server and would do repeated

330
00:21:56,760 --> 00:22:01,920
get requests for unique strings for each
server knowing that every single time

331
00:22:01,920 --> 00:22:02,940
it's going to return it

332
00:22:02,940 --> 00:22:06,450
a tool for the last thing I'm going to
want is remote logging

333
00:22:06,450 --> 00:22:11,100
you know I want to know what's going on
they also did that they set up an alias

334
00:22:11,100 --> 00:22:15,659
on the proxy server that allows the
status server to basically go pull logs

335
00:22:15,660 --> 00:22:21,450
remotely as far as the configuration
this is one of the sample engine X

336
00:22:21,450 --> 00:22:26,970
configs up all the servers for linux
boxes running engine X that's true of

337
00:22:26,970 --> 00:22:32,760
all of the exploit kits I've looked at
so far that on the over here you see the

338
00:22:32,760 --> 00:22:34,290
proxy configuration

339
00:22:34,290 --> 00:22:40,080
they were running on port 80 one for the
proxy side and then on the over here you

340
00:22:40,080 --> 00:22:45,330
have the the unique string for the
health monitoring for the 204 as well as

341
00:22:45,330 --> 00:22:48,780
the unique string for the alias for the
logging itself

342
00:22:48,780 --> 00:22:54,450
that's a pretty sophisticated really
well-designed enterprise platform for

343
00:22:54,450 --> 00:22:55,320
compromise

344
00:22:55,320 --> 00:23:02,610
now why would they go through all this
money that is as simple as it gets

345
00:23:03,240 --> 00:23:08,820
I over the course of a month we saw
about a hundred and fifty proxy servers

346
00:23:08,820 --> 00:23:15,330
we figured out that about two-thirds of
the payloads were ransomware for that .

347
00:23:15,330 --> 00:23:20,250
and from previous research we see that
like ten percent of users are

348
00:23:20,250 --> 00:23:21,690
compromised by angler

349
00:23:21,690 --> 00:23:26,760
so we're seeing 90,000 ip's a day be
served exploits started doing some math

350
00:23:26,760 --> 00:23:32,700
and then we looked at the percentages of
users that would typically pay ransom

351
00:23:32,700 --> 00:23:36,660
we used a number here from us sir which
was two-point-nine percent and then if

352
00:23:36,660 --> 00:23:39,510
you start doing some math you realize
that these guys are making an

353
00:23:39,510 --> 00:23:41,190
astronomical amount of money

354
00:23:41,190 --> 00:23:47,040
about 3 million dollars a month or 30
million dollars a year even it three

355
00:23:47,040 --> 00:23:51,420
percent of the users paying the ransom
even if you have that and say one and a

356
00:23:51,420 --> 00:23:53,420
half percent which means only that

357
00:23:53,420 --> 00:23:56,840
three out of every two hundred victims
actually pay

358
00:23:56,840 --> 00:23:59,840
you're still making 15 million dollars a
year

359
00:24:00,590 --> 00:24:05,149
it's really easy to understand why this
is so prolific and so prevalent

360
00:24:05,150 --> 00:24:08,150
there's just millions and millions of
dollars at stake

361
00:24:09,350 --> 00:24:15,590
so where are we today the landing page
URLs they've kind of pivoted back the

362
00:24:15,590 --> 00:24:20,090
other way so they went from hiding in
the noise - really being unique

363
00:24:20,090 --> 00:24:23,389
now there's many many many different
patterns out there

364
00:24:23,390 --> 00:24:28,910
some of them end in dot HTML that PNG
other ones are just folders

365
00:24:28,910 --> 00:24:32,870
some of them just end with a hyphen in
the middle somewhere only are using

366
00:24:32,870 --> 00:24:35,750
English words some are using random
strings

367
00:24:35,750 --> 00:24:42,020
it's it's a lot more focused on the make
the page as weird as possible as unique

368
00:24:42,020 --> 00:24:47,150
as possible as opposed to trying to make
it look like something more common in

369
00:24:47,150 --> 00:24:47,900
the noise

370
00:24:47,900 --> 00:24:52,580
what's funny is they actually went
through a stage of going with another

371
00:24:52,580 --> 00:24:54,800
one of the looking like

372
00:24:54,800 --> 00:24:59,810
normal traffic stages where they were
spoofing IP form if i remember correctly

373
00:24:59,810 --> 00:25:04,310
is the software and that lasted for
maybe two weeks and then they pivoted to

374
00:25:04,310 --> 00:25:07,520
this so it's kind of that constant
evolution again

375
00:25:09,200 --> 00:25:15,860
all right that was angler let me talk a
little bit about rig same type of

376
00:25:15,860 --> 00:25:17,030
process with rig

377
00:25:17,030 --> 00:25:22,490
so real quick on rig rig is nowhere near
the scale of something like angler

378
00:25:22,490 --> 00:25:27,380
but what it does do is it's still very
successful at compromising users

379
00:25:27,380 --> 00:25:31,010
you know for the same reasons that
anglers successful rig is successful as

380
00:25:31,010 --> 00:25:31,580
well

381
00:25:31,580 --> 00:25:37,879
it's just not nearly as widespread so i
started with in rigs case i started with

382
00:25:37,880 --> 00:25:40,520
the exploit page and start as far

383
00:25:40,520 --> 00:25:45,230
instead of the landing page here you can
see what i was looking at

384
00:25:45,230 --> 00:25:49,130
so what I found is a whole bunch of
index dot PHP files that were things

385
00:25:49,130 --> 00:25:55,160
like flash or Silverlight so i started
hunting through the data again and i

386
00:25:55,160 --> 00:25:59,570
ended up with something like this so
this is the IP addresses that i saw

387
00:25:59,570 --> 00:26:00,590
active

388
00:26:00,590 --> 00:26:03,889
you can tell there's a stark difference
i mean a hundred and forty-seven servers

389
00:26:03,890 --> 00:26:04,790
in a month

390
00:26:04,790 --> 00:26:09,110
this is two months of data here the most
servers i ever saw active in a day was

391
00:26:09,110 --> 00:26:09,800
three

392
00:26:09,800 --> 00:26:14,570
this is not nearly the scale of
something like angler but it is still

393
00:26:14,570 --> 00:26:19,970
really really good at compromising users
so I started looking at the provider and

394
00:26:19,970 --> 00:26:24,110
come to find out everything was hosted
under a single provider for that entire

395
00:26:24,110 --> 00:26:29,000
two months of the provider was your bite
from Russia

396
00:26:30,170 --> 00:26:34,250
what we did is at that point as I
approach them much like i did with

397
00:26:34,250 --> 00:26:36,440
limestone and head sir

398
00:26:36,440 --> 00:26:40,340
and again look I'm not expecting all
providers to work with me

399
00:26:40,340 --> 00:26:43,490
I would love it if they did but that's
just not going to happen what I do

400
00:26:43,490 --> 00:26:48,140
expect you to do is say yes we
understand that there's bad activity we

401
00:26:48,140 --> 00:26:51,410
agree that you provided as logs that
show that bad activity

402
00:26:51,410 --> 00:26:54,890
we're going to remove the server or at
least acknowledge the fact that i sent

403
00:26:54,890 --> 00:27:00,290
you an abuse request i sent them email
after email after email even reverting

404
00:27:00,290 --> 00:27:03,560
at one point to putting a couple
sentences at the top saying look below

405
00:27:03,560 --> 00:27:09,379
you will find a translation attempt at
this into Russian i'm sure it's horrible

406
00:27:09,380 --> 00:27:14,030
but at least it's something please
contact me if you have any questions

407
00:27:14,030 --> 00:27:19,129
I did that and just heard absolutely
nothing just deafening silence

408
00:27:19,850 --> 00:27:23,540
so I started looking into the provider
they're not very big

409
00:27:24,050 --> 00:27:27,290
they only had maybe a handful of classy
networks

410
00:27:27,290 --> 00:27:35,090
what I did find is that there was really
not very much good activity on their

411
00:27:35,090 --> 00:27:40,459
overwhelmingly it's just it was just bad
stuff and there's tons of exploit kit

412
00:27:40,460 --> 00:27:41,240
stuff

413
00:27:41,240 --> 00:27:45,080
tons of various fishing and spam and
everything else

414
00:27:45,080 --> 00:27:49,730
with the exception of one there was one
provider that for one subnet that was

415
00:27:49,730 --> 00:27:54,200
hosting some sort of Russian payment
system that had a positive web the rest

416
00:27:54,200 --> 00:27:59,330
of the subnets were were really really
bad from a web reputation perspective

417
00:27:59,330 --> 00:28:03,980
so we took a different approach you know
you won't acknowledge anything then were

418
00:28:03,980 --> 00:28:05,480
not going to acknowledge you

419
00:28:05,480 --> 00:28:10,610
so we blocked the entire address space
with the exception of the good subnet

420
00:28:10,610 --> 00:28:11,570
that was in there

421
00:28:11,570 --> 00:28:14,659
what happened next was pretty
interesting

422
00:28:15,250 --> 00:28:18,310
within 72 hours they were completely
gone

423
00:28:18,310 --> 00:28:22,000
rig completely left the address space
left the provider as a whole and move to

424
00:28:22,000 --> 00:28:24,520
someplace new

425
00:28:24,520 --> 00:28:30,310
i will talk about the new provider in a
couple of minutes now let's let's change

426
00:28:30,310 --> 00:28:36,610
gears and switch over to nuclear so
nuclear is another really really well

427
00:28:36,610 --> 00:28:40,810
known pretty popular pretty large scale
exploit kit

428
00:28:41,320 --> 00:28:44,470
not not quite the same level of what you
would see with angler

429
00:28:46,090 --> 00:28:49,510
but the starting point with them was
actually a little bit more difficult

430
00:28:50,230 --> 00:28:55,750
what I ended up with was a bunch of dot
ASP flash files again

431
00:28:55,750 --> 00:29:00,970
tons and tons of noise just so much
noise so i had to do just absurd amounts

432
00:29:00,970 --> 00:29:06,100
of filtering and i ended up with a just
a a search pattern that could just best

433
00:29:06,100 --> 00:29:08,139
be described as just nasty

434
00:29:08,140 --> 00:29:11,530
it was ugly it was horrible but it
worked

435
00:29:11,530 --> 00:29:16,389
and that's exactly what I wanted so what
I ended up with was a list of ips and i

436
00:29:16,390 --> 00:29:21,760
did the same type of thing i have this
list of ips oh it's not quite as nice as

437
00:29:21,760 --> 00:29:25,000
angler you know I don't have that
walking of the address space that kind

438
00:29:25,000 --> 00:29:29,380
of led me in a solid direction but there
is some kind of subnet grouping there

439
00:29:29,380 --> 00:29:34,270
maybe I'll get lucky with the provider
again turns out these exploit kit

440
00:29:34,270 --> 00:29:39,250
authors were users really like to stick
it a provider and just stay there

441
00:29:39,250 --> 00:29:43,450
so again two months of activity all
hosted out of a single provider

442
00:29:44,170 --> 00:29:50,020
this time it was digitalocean digital
ocean again provided them the

443
00:29:50,020 --> 00:29:54,460
information they were super helpful very
responsive worked with me a lot

444
00:29:54,460 --> 00:29:58,990
one of the interesting things is the
differences

445
00:29:58,990 --> 00:30:03,970
so i mentioned before angler users would
register like a big block of address

446
00:30:03,970 --> 00:30:08,140
space with stolen credit cards and kind
of walk through the spaces they went

447
00:30:08,650 --> 00:30:13,510
what you saw with nuclear is that they
would actually do a single user account

448
00:30:13,510 --> 00:30:18,310
for each individual server and they
would use a coupon code to buy that

449
00:30:18,310 --> 00:30:22,600
server they would buy a block of servers
but since they're using different

450
00:30:22,600 --> 00:30:26,139
addresses different accounts every
single time the address space is just

451
00:30:26,140 --> 00:30:27,160
this is all over

452
00:30:27,160 --> 00:30:32,590
place one of the most interesting things
that I found with nuclear was the fact

453
00:30:32,590 --> 00:30:36,070
that it was just absolutely a global
threat

454
00:30:36,670 --> 00:30:40,930
so you can see here this is a map of all
the cities that were involved ended up

455
00:30:40,930 --> 00:30:45,640
being like something like 10,000 cities
are now I'll kind of walk through some

456
00:30:45,640 --> 00:30:49,720
of the comparisons to what I found with
the anglers well to draw those

457
00:30:49,720 --> 00:30:53,680
comparisons but I mentioned in the
beginning that add that was targeting

458
00:30:53,680 --> 00:31:00,310
spanish-speaking individuals i found
that particular ad generating 25,000

459
00:31:00,310 --> 00:31:04,540
ip's of traffic from that add to nuclear
in a single day

460
00:31:04,540 --> 00:31:08,139
uh and you can see the results I mean
you have a lot of spanish-speaking

461
00:31:08,140 --> 00:31:12,670
countries dominating this landscape and
we start looking at it from a country

462
00:31:12,670 --> 00:31:13,750
perspective

463
00:31:13,750 --> 00:31:17,860
it gets even more interesting again
spaying is one of the big countries not

464
00:31:17,860 --> 00:31:18,790
surprising

465
00:31:18,790 --> 00:31:24,970
i did also see a lot of German users as
well but what's interesting is you have

466
00:31:24,970 --> 00:31:30,910
mexico and argentina having largely the
same amount of victims as the United

467
00:31:30,910 --> 00:31:36,010
States did and the United States user
set is far bigger than what you have out

468
00:31:36,010 --> 00:31:37,300
of these other countries

469
00:31:37,300 --> 00:31:42,040
the other thing is just the huge variety
of countries i had a hundred and

470
00:31:42,040 --> 00:31:45,310
twenty-five countries and I saw
countries that I never thought I would

471
00:31:45,310 --> 00:31:51,159
see things like I see the united arab
emirates here I saw Syria and Iran and

472
00:31:51,160 --> 00:31:55,660
Venezuela and this this threat was
literally all over the world to give you

473
00:31:55,660 --> 00:32:01,630
a comparison of how different that is
this was angler activity from when we

474
00:32:01,630 --> 00:32:02,620
did our research

475
00:32:02,620 --> 00:32:05,919
almost three-quarters of the victims
came from the united states in the UK

476
00:32:05,920 --> 00:32:06,940
alone

477
00:32:06,940 --> 00:32:13,360
additionally there is only 12 countries
total that were impacted but you really

478
00:32:13,360 --> 00:32:16,360
can't tell a stark difference in the two
countries that are different

479
00:32:16,870 --> 00:32:23,139
united states in the UK now why would an
adversary want to avoid those countries

480
00:32:23,140 --> 00:32:29,050
the kind of the easy reason is just the
amount of eyes that are on that traffic

481
00:32:29,050 --> 00:32:33,220
know where researchers are all over the
world but there are a whole lot of them

482
00:32:33,220 --> 00:32:37,360
looking at a lot of data that's focused
heavily in the united states in the UK

483
00:32:37,360 --> 00:32:40,178
by avoiding that address space large

484
00:32:40,179 --> 00:32:44,740
three you're going to avoid maybe as
much as much attention as you think you

485
00:32:44,740 --> 00:32:46,509
would get by attacking them

486
00:32:46,509 --> 00:32:50,379
the other thing is that they could be
looking at targeting countries that may

487
00:32:50,379 --> 00:32:55,449
not have the same level of of software
that's installed

488
00:32:55,450 --> 00:32:59,169
you know and may not be as common to
have you know two or three different AV

489
00:32:59,169 --> 00:33:04,029
systems running on your your home
desktop outside of the US and the UK and

490
00:33:04,029 --> 00:33:07,179
obviously in the rest of Europe that's
pretty common but you can see here

491
00:33:07,179 --> 00:33:11,409
there's a huge chunk of countries that
are not necessarily in that place

492
00:33:11,409 --> 00:33:17,139
ok so this is an engine X config from
one of the nuclear servers

493
00:33:18,100 --> 00:33:23,740
one of the interesting things about this
is the basic user agent blocking they

494
00:33:23,740 --> 00:33:24,460
were doing

495
00:33:24,460 --> 00:33:28,929
there's a bunch of stuff up here but you
see some security software companies

496
00:33:28,929 --> 00:33:33,789
some stuff that's crawling the internet
which you actually can't see here is

497
00:33:33,789 --> 00:33:38,289
they also blocked game console
specifically so i saw things like

498
00:33:38,289 --> 00:33:42,879
Nintendo xbox and playstation
specifically excluded from the infection

499
00:33:42,879 --> 00:33:47,559
vector which makes sense but you don't
see this commonly and the other thing is

500
00:33:47,559 --> 00:33:51,039
they were using proxy configuration much
the same

501
00:33:51,039 --> 00:33:55,240
however they had far better OPSEC on the
server's themselves

502
00:33:55,840 --> 00:34:00,369
there was no logging like they went out
of their way to make sure that nothing

503
00:34:00,369 --> 00:34:01,418
was locked

504
00:34:01,419 --> 00:34:05,470
there was no remote logging being done
they were passing the IP in the header

505
00:34:05,470 --> 00:34:11,500
of the true victim but nothing was being
logged off the system directly they were

506
00:34:11,500 --> 00:34:16,719
however still doing health monitoring
every five minutes like clockwork would

507
00:34:16,719 --> 00:34:20,138
see it get requests for tests . X . test

508
00:34:20,139 --> 00:34:25,869
now what was particularly interesting
about this is kind of a circular logic

509
00:34:25,869 --> 00:34:29,589
that they're using so you can see here
that's the actual proxy server

510
00:34:29,589 --> 00:34:33,879
I'm sorry exploit server so they were
sending a request from the exploit

511
00:34:33,879 --> 00:34:37,449
server to the proxy server that would
proxy it back to the exploit server

512
00:34:37,449 --> 00:34:41,020
which would then respond with a response
to the proxy server that would go back

513
00:34:41,020 --> 00:34:44,319
to the exploit server kind of an
interesting way to do it

514
00:34:44,980 --> 00:34:49,149
you know largely just making sure that
everything is living on one system as

515
00:34:49,149 --> 00:34:50,960
far as the get itself

516
00:34:50,960 --> 00:34:55,280
every single time it was an octet stream
with a whole bunch of texts in it

517
00:34:55,280 --> 00:34:58,280
that's what was returned every single
time

518
00:34:58,970 --> 00:35:02,180
so they're still doing health monitoring
they're still doing that type of stuff

519
00:35:02,180 --> 00:35:08,390
but it's a little less sophisticated and
in enterprise like from what we saw from

520
00:35:08,390 --> 00:35:10,580
angler

521
00:35:10,580 --> 00:35:14,869
ok now on to the gate that I haven't
talked about before

522
00:35:15,500 --> 00:35:22,250
this is something that I called
Shadowgate and again a lot of this

523
00:35:22,250 --> 00:35:28,280
started from me looking at refers this
wasn't all that when I wasn't that much

524
00:35:28,280 --> 00:35:33,470
volume but every once in a while I would
see this pop-up and refer chain where I

525
00:35:33,470 --> 00:35:38,598
would see a shadow domain with a couple
of sub folders or one sub folder and

526
00:35:38,599 --> 00:35:42,440
then a JavaScript file being hosted that
was redirecting to angler

527
00:35:42,440 --> 00:35:45,980
it wasn't a huge volume but it was
something that i found interesting

528
00:35:45,980 --> 00:35:50,510
enough that i started was like well let
me start digging into it so i did the

529
00:35:50,510 --> 00:35:55,790
same type of thing I started hunting it
to see what i could find this is my

530
00:35:55,790 --> 00:36:00,290
chart of the data the amount of data
that i found was absolutely staggering

531
00:36:00,290 --> 00:36:03,890
everything was focused in a couple of
days here like between the 10th in the

532
00:36:03,890 --> 00:36:08,420
20th but i ended up with nine hundred
thousand rows of data

533
00:36:09,020 --> 00:36:12,619
this was a really really large scale
campaign

534
00:36:12,619 --> 00:36:17,839
what was so interesting about it was it
was only active for very very small

535
00:36:17,839 --> 00:36:22,369
amounts of time so i had nine hundred
thousand rows of data here

536
00:36:22,880 --> 00:36:27,080
I found . one percent actually
delivering an exploit kit the rest of it

537
00:36:27,080 --> 00:36:33,440
would just return nothing for for a
blank page just nothing there that was

538
00:36:33,440 --> 00:36:38,510
actually quite interesting and
unexpected i mentioned before the shadow

539
00:36:38,510 --> 00:36:44,599
domains on there were not a 50 that were
that I found in the in the month or two

540
00:36:44,599 --> 00:36:48,770
I was looking at this and they keep
adding and removing as time goes on but

541
00:36:48,770 --> 00:36:50,990
it's pretty well spread out there

542
00:36:50,990 --> 00:36:53,990
none of them really take that much
percentage

543
00:36:53,990 --> 00:36:56,390
what was interesting though was

544
00:36:56,390 --> 00:37:01,220
the MO is very similar to what I've seen
from domain shadowing that is that all

545
00:37:01,220 --> 00:37:06,348
of these registered accounts were
registered by godaddy has nothing to do

546
00:37:06,349 --> 00:37:08,059
with godaddy at all really

547
00:37:08,059 --> 00:37:11,690
other than the fact that they're really
good at what they do so go daddy is the

548
00:37:11,690 --> 00:37:15,950
largest registrant by orders of
magnitude over everyone else

549
00:37:16,609 --> 00:37:20,450
so if I'm a bad guy and i'm going to set
up a fishing campaign to gather

550
00:37:20,450 --> 00:37:23,899
potentials and I want to put all this
infrastructure and effort into it

551
00:37:23,900 --> 00:37:27,230
I'm going to hit a surface where i can
get the most users that's exactly why

552
00:37:27,230 --> 00:37:32,569
you go to go daddy what I found also was
the same as before you have a register

553
00:37:32,569 --> 00:37:36,829
an account with on a four or five
domains you would always find more than

554
00:37:36,829 --> 00:37:41,420
one of those domains being used not
always a hundred percent of them but you

555
00:37:41,420 --> 00:37:44,510
know sometimes between twenty and fifty
percent

556
00:37:44,510 --> 00:37:48,799
one other thing that i found
particularly interesting was despite

557
00:37:48,799 --> 00:37:51,019
having nine hundred thousand rows of
data

558
00:37:51,019 --> 00:37:55,399
I only ended up with 12 different file
names of all of that data there was only

559
00:37:55,400 --> 00:37:59,150
twelve unique file names being served in
total

560
00:37:59,150 --> 00:38:03,650
the other thing that was interesting was
the infrequency with the actual landing

561
00:38:03,650 --> 00:38:09,740
page itself so i mentioned before that
only . one percent of victims were

562
00:38:09,740 --> 00:38:12,319
actually delivered to a landing page

563
00:38:12,319 --> 00:38:16,279
what was interesting was the landing
page itself would pivot all the time so

564
00:38:16,279 --> 00:38:22,579
I rarely saw one particular infection
chain lead to the same server the same

565
00:38:22,579 --> 00:38:25,670
landing page it was like they were
pivoting and changing all the time

566
00:38:25,670 --> 00:38:32,509
this is my summary slide yet twenty
registered accounts multiple domains /

567
00:38:32,509 --> 00:38:37,579
account the volume was just astronomical
this is the largest advertising campaign

568
00:38:37,579 --> 00:38:38,630
I've ever seen

569
00:38:38,630 --> 00:38:45,259
to give you an example I went to one
single URL and was served 16 different

570
00:38:45,259 --> 00:38:50,480
malicious iframes through ads trying to
get me into this infrastructure not a

571
00:38:50,480 --> 00:38:55,339
single one serv data but that's 16 times
and going to one single web page that

572
00:38:55,339 --> 00:38:58,700
you're interacting with these systems
that's just a really high volume of data

573
00:38:58,700 --> 00:39:02,089
as for the the gate itself

574
00:39:02,720 --> 00:39:05,640
it's not really anything new same thing
as always

575
00:39:05,640 --> 00:39:09,000
just served way off screen

576
00:39:09,510 --> 00:39:13,319
what was interesting to was where this
is being served we saw a lot of car

577
00:39:13,319 --> 00:39:17,788
forms there was a bunch of HR websites
some popular culture stuff

578
00:39:18,450 --> 00:39:23,700
I didn't really find anything in like
the alexa top 500 but i found plenty of

579
00:39:23,700 --> 00:39:30,450
examples in the alexa top two thousand
that were redirecting threads but this

580
00:39:30,450 --> 00:39:34,470
was the most interesting thing that I
found while I was piling through these

581
00:39:34,470 --> 00:39:38,788
hundreds of thousands of rows of data
all the sudden I started to notice that

582
00:39:38,789 --> 00:39:44,099
occasionally I would stumble across a
flash file or Silverlight file which was

583
00:39:44,099 --> 00:39:44,700
odd

584
00:39:44,700 --> 00:39:48,390
I was like this is this is a little bit
peculiar let me dig into it a little bit

585
00:39:48,390 --> 00:39:49,259
further

586
00:39:49,260 --> 00:39:54,809
what I actually found was systems that
we're pivoting from being a gate to

587
00:39:54,809 --> 00:39:56,880
hosting rig exploit kit

588
00:39:56,880 --> 00:40:01,200
so this is one example here on the
twenty-fifth of march we saw them

589
00:40:01,200 --> 00:40:06,960
serving the gate on April second they
have now switched to being a rig exploit

590
00:40:06,960 --> 00:40:12,029
kit server on another example this one
is even shorter window on the 20 the

591
00:40:12,029 --> 00:40:15,809
19th we saw at delivering a gate and on
the 21st

592
00:40:15,809 --> 00:40:18,809
it was then hosting rig exploit kit

593
00:40:18,809 --> 00:40:23,880
it's it's a pretty quick turnaround in
an odd coincidence to say the least but

594
00:40:23,880 --> 00:40:29,220
back to the IP so these are the list of
ip's that I ended up with associated

595
00:40:29,220 --> 00:40:31,049
with the gate itself

596
00:40:31,049 --> 00:40:36,869
did the same type of thing looking up
and luckily enough

597
00:40:36,869 --> 00:40:40,740
they're all being hosted out of a single
provider in Russia again

598
00:40:40,740 --> 00:40:45,058
now it's like a provider looks really
really familiar

599
00:40:47,400 --> 00:40:52,500
turns out that's the provider that was
pivoted to when Rick moved away from the

600
00:40:52,500 --> 00:40:55,500
the other euro by provider that we saw
before

601
00:40:56,279 --> 00:41:01,259
I'm still trying to work with that
provider to to gather some information

602
00:41:01,259 --> 00:41:03,059
and let them know what's going on

603
00:41:03,059 --> 00:41:09,450
there's more research on that to come
again this was far and away the largest

604
00:41:09,450 --> 00:41:10,680
exploit kit

605
00:41:10,680 --> 00:41:15,779
I'm sorry advertising campaign I've ever
seen on and i found yet another link

606
00:41:15,779 --> 00:41:16,660
between

607
00:41:16,660 --> 00:41:20,558
angler and rig I talked about at the
very very beginning that i saw an ad

608
00:41:20,559 --> 00:41:25,930
that was redirecting to both angler and
rake instances again points to either

609
00:41:25,930 --> 00:41:30,308
you have adversaries out there that are
running both Reagan angler or there's

610
00:41:30,309 --> 00:41:33,369
some other type of link going on that we
have been able to find yet

611
00:41:34,569 --> 00:41:42,460
ok so in summary exploit kits literally
compromised anyone that is one of the

612
00:41:42,460 --> 00:41:46,270
things that really got me into looking
at exploit kits at I'm always interested

613
00:41:46,270 --> 00:41:51,309
by adversaries that do not care about
their target and will literally hit

614
00:41:51,309 --> 00:41:57,609
anyone on the internet the mal vertising
and compromised websites are just very

615
00:41:57,609 --> 00:42:02,710
very large scale happening constantly
driving traffic but even that is

616
00:42:02,710 --> 00:42:07,119
continuing to evolve as I walk through
the spam example before I expect to see

617
00:42:07,119 --> 00:42:09,220
more and more of that as time goes on

618
00:42:09,220 --> 00:42:13,180
because it's just another way like we
see with ransomware where you're getting

619
00:42:13,180 --> 00:42:16,419
users in his many different ways as you
can

620
00:42:16,420 --> 00:42:20,140
the parallels between them are obvious
because when you take a threat like

621
00:42:20,140 --> 00:42:24,759
exploit kits you had a payload like
ransomware you make it so you can pay

622
00:42:24,760 --> 00:42:29,799
basically invisibly through Bitcoin and
you're maintaining your anonymity while

623
00:42:29,799 --> 00:42:30,700
you go

624
00:42:30,700 --> 00:42:34,899
it's going to be a major challenge and
it's it's just going to get worse before

625
00:42:34,900 --> 00:42:35,950
it gets better

626
00:42:35,950 --> 00:42:42,399
all right i want to take a second to
thank the providers that worked with me

627
00:42:42,400 --> 00:42:46,119
honestly you know I I do a lot of
research a lot of hunting find a lot of

628
00:42:46,119 --> 00:42:48,460
really cool stuff without their help

629
00:42:48,460 --> 00:42:52,630
I don't get that visibility into the
back end that really helps expose not

630
00:42:52,630 --> 00:42:57,160
only what the bad guys are doing but
allows me to share that information with

631
00:42:57,160 --> 00:42:58,480
a wider audience

632
00:42:58,480 --> 00:43:01,660
you know I want to force them to spend
money to evolve and develop

633
00:43:02,410 --> 00:43:07,480
I don't want them to just keep operating
the way that they are speaking of which

634
00:43:07,480 --> 00:43:12,670
if you are a provider or work for
provider really want to work with you

635
00:43:12,670 --> 00:43:16,359
I am very happy to work with you
publicly or privately it does not matter

636
00:43:16,359 --> 00:43:17,170
to me

637
00:43:17,170 --> 00:43:22,660
we actually launched a project
associated with our angler research to

638
00:43:22,660 --> 00:43:27,009
specifically allow us to work directly
with providers reach out to us

639
00:43:27,010 --> 00:43:29,970
that's my Twitter handle feel free to
reach out to me tweet at me

640
00:43:29,970 --> 00:43:34,859
Edme whatever there's a web page there's
our external email

641
00:43:34,859 --> 00:43:38,430
we really want to work with providers
you know providers are in a unique

642
00:43:38,430 --> 00:43:44,879
circumstance to be able to say you know
we see bad activity on our network or we

643
00:43:44,880 --> 00:43:46,650
see bad activity on your network

644
00:43:46,650 --> 00:43:50,700
we want to come work with you and help
you get rid of the threat and hopefully

645
00:43:50,700 --> 00:43:54,270
help expose what the bad guys are doing
help us stop the threat altogether

646
00:43:54,900 --> 00:43:59,220
not just shut down the server to one
more thing

647
00:43:59,220 --> 00:44:02,939
for those of you that are interested in
hunting things like angler i'm going to

648
00:44:02,940 --> 00:44:06,599
throw out a couple of email addresses
here for you to look at if you like

649
00:44:06,599 --> 00:44:11,849
hunting domains and stuff like that so
one of the interesting ones here is

650
00:44:11,849 --> 00:44:19,710
being w 90 @ yahoo.com this particular
host was a angler of posting angler

651
00:44:19,710 --> 00:44:25,080
under their domains they were hosting
the majority and still are hosting them

652
00:44:25,080 --> 00:44:29,640
are owning the domains associated with
the majority of the dep see - I was able

653
00:44:29,640 --> 00:44:32,339
to pivot on the first name associated
with it

654
00:44:32,340 --> 00:44:37,349
find another host that's registering
account spot for famine 44a s @

655
00:44:37,349 --> 00:44:43,740
gmail.com that particular one was not
hosting angler directly but was hosting

656
00:44:43,740 --> 00:44:49,140
the dep c2 and was also tied into a
bunch of other stuff so i ended up

657
00:44:49,140 --> 00:44:53,759
stumbling upon the email address in some
angle every direction then I was looking

658
00:44:53,760 --> 00:44:54,390
at

659
00:44:54,390 --> 00:44:59,549
i also found some domains associated
with Kaz and semi trojans and then

660
00:44:59,550 --> 00:45:06,180
finally we have here John . broguing @
yahoo.com . UK this particular host also

661
00:45:06,180 --> 00:45:10,950
very heavily rope involved with angular
direction and a couple of other threats

662
00:45:10,950 --> 00:45:17,098
that we've seen one final one on this is
actually pretty recent so this

663
00:45:17,099 --> 00:45:23,760
particular name and email address Mako
at lists that are you and Mako if jenny

664
00:45:23,760 --> 00:45:28,770
has been absolutely prolific in
registering and hosting angler activity

665
00:45:28,770 --> 00:45:31,470
talked about this

666
00:45:31,470 --> 00:45:35,069
so angler disappeared for a couple of
weeks the beginning of the year when

667
00:45:35,070 --> 00:45:39,720
they pop back up this guy started
registering like 30 or 40 domains a day

668
00:45:39,720 --> 00:45:44,819
the majority of these 3000 domains have
been registered since the first of the

669
00:45:44,820 --> 00:45:45,330
year

670
00:45:45,330 --> 00:45:49,290
ok so I have some time for questions

671
00:45:57,490 --> 00:46:02,740
all right we have several questions I'll
start right here

672
00:46:04,150 --> 00:46:07,150
hi look what it's about

673
00:46:07,660 --> 00:46:11,589
I was I've noticed I've got that you've
mentioned in genetics and I know it's

674
00:46:11,590 --> 00:46:15,490
faster than then approached it would be
but how come that nobody is hosting from

675
00:46:15,490 --> 00:46:18,250
a party or is even or anything like that

676
00:46:18,250 --> 00:46:22,450
how come always in genetics you have any
anything on the had no idea is just what

677
00:46:22,450 --> 00:46:26,740
we found on when we looked and I've had
to know this one up have you ever

678
00:46:26,740 --> 00:46:30,160
correlated renting in the office
location matters that they've used was

679
00:46:30,160 --> 00:46:34,779
there any roving in there have you have
you looked at the deification of the

680
00:46:34,780 --> 00:46:40,000
confiscation actually of the of the
Justice downloaders mhm we've done some

681
00:46:40,000 --> 00:46:42,940
research into that but I don't really
have anything offhand that I can talk

682
00:46:42,940 --> 00:46:43,660
about

683
00:46:43,660 --> 00:46:54,040
ok thank you notice that they seem to
prefer providers in the Netherlands and

684
00:46:54,040 --> 00:46:56,110
Russia thoughts on why

685
00:46:56,110 --> 00:47:02,200
so one of the things that you could look
at these things like privacy they they

686
00:47:02,200 --> 00:47:07,270
tend to pick countries that have very
strong privacy laws and you know nothing

687
00:47:07,270 --> 00:47:07,660
wrong

688
00:47:07,660 --> 00:47:11,770
privacy laws but there are implications
from their perspective that makes that

689
00:47:11,770 --> 00:47:17,980
type of activity very attractive for
them question back here

690
00:47:22,370 --> 00:47:28,730
you mentioned there the operators upset
care when you're walking up to wonder if

691
00:47:28,730 --> 00:47:32,450
you could just talk about the upset that
you saw in the other kids as well and

692
00:47:32,450 --> 00:47:34,310
peacefully if there's anything of nope

693
00:47:34,310 --> 00:47:38,779
so the biggest thing with anger was
since they were doing remote logging

694
00:47:38,780 --> 00:47:42,020
they were maintaining a lot of logs on
the system's themselves

695
00:47:42,020 --> 00:47:45,110
so we're able to get a little more
visibility into the activity that was

696
00:47:45,110 --> 00:47:50,600
going on they did have some other things
that were logging like in the nuclear

697
00:47:50,600 --> 00:47:54,620
instance they basically shut down every
bit of logging on the system before they

698
00:47:54,620 --> 00:47:58,850
ever logged in like they didn't do
anything bad until everything had

699
00:47:58,850 --> 00:48:02,839
stopped angler not necessarily the same
type of detail

700
00:48:02,840 --> 00:48:05,870
they left a lot of logging on they just
may not have cared

701
00:48:05,870 --> 00:48:10,339
the nuclear actor was definitely very
concerned about what particularly will

702
00:48:10,340 --> 00:48:17,210
be logged on the system more questions
back there

703
00:48:23,880 --> 00:48:28,079
you mentioned how indiscriminate the
campaign was did you see any attempt

704
00:48:28,079 --> 00:48:33,210
when fingerprinting of trying to avoid
said keyboard layouts like this really

705
00:48:33,210 --> 00:48:38,519
cool mandarin anything like that that I
don't recall seeing any of that a it's

706
00:48:38,519 --> 00:48:42,118
possible that they're doing that stuff
actually at a higher level so I'm seeing

707
00:48:42,119 --> 00:48:46,980
more and more types of fingerprinting
being pushed out to the gates to kind of

708
00:48:46,980 --> 00:48:49,980
drive down the amount of traffic that
actually makes it through to the end

709
00:48:49,980 --> 00:48:52,980
system to the actual landing page itself

710
00:48:57,000 --> 00:49:06,329
yeah i'm curious what does it's getting
exploited the except flesh like flesh

711
00:49:06,329 --> 00:49:11,069
it's kind of going away known something
gets getting exploited by them

712
00:49:11,069 --> 00:49:15,960
so I've seen them actively using
silverlight they've been doing that rig

713
00:49:15,960 --> 00:49:18,059
is actually add it's over light as well

714
00:49:18,059 --> 00:49:22,950
in the past I've seen them exploit um
internet explorer vulnerabilities that

715
00:49:22,950 --> 00:49:26,730
was actually one of the first places
where the the custom encryption with the

716
00:49:26,730 --> 00:49:32,430
diffie-hellman was seen was associated
with my camera is from 2015 and ieave

717
00:49:32,430 --> 00:49:35,009
owner ability in 2015

718
00:49:35,009 --> 00:49:38,099
those are the big ones that we see every
once in a great while we might see some

719
00:49:38,099 --> 00:49:40,769
java pop up but it's really not that
common anymore

720
00:49:40,769 --> 00:49:45,930
I saw some your notes at the end there
where you are connecting different

721
00:49:45,930 --> 00:49:50,368
exploit kids based on you know certain
things like email addresses you have any

722
00:49:50,369 --> 00:49:53,130
thoughts around how accurate that is or
if they could be working together to

723
00:49:53,130 --> 00:49:55,650
mislead investigators it

724
00:49:55,650 --> 00:50:00,329
it could be it's hard to say all that I
can say for sure is that you have a

725
00:50:00,329 --> 00:50:03,660
bunch of registered accounts that are
creating domains for a whole bunch of

726
00:50:03,660 --> 00:50:08,069
different threats that seems like a
coincidence little bit weird but you

727
00:50:08,069 --> 00:50:11,069
know that's that's all I can really say
from that perspective

728
00:50:11,880 --> 00:50:17,789
yes any more questions so i have won the

729
00:50:18,309 --> 00:50:23,049
bitcoins of the name that they are very
anonymous but they can very easily be

730
00:50:23,049 --> 00:50:24,099
tracked

731
00:50:24,099 --> 00:50:28,809
if you looked into it with tracking
Bitcoin payments so you can track it to

732
00:50:28,809 --> 00:50:31,839
a certain extent what becomes difficult
is when they start using things like

733
00:50:31,839 --> 00:50:35,439
mixers and hitting multiple different
tiers of mixers then it becomes very

734
00:50:35,439 --> 00:50:39,788
very difficult to see where it comes in
and then where it actually comes out you

735
00:50:39,789 --> 00:50:44,709
can see the initial initial money coming
in but they're usually very very smart

736
00:50:44,709 --> 00:50:48,640
they're hitting I don't know 12 or 13
different wallets and then hitting a

737
00:50:48,640 --> 00:50:52,779
couple of mixtures along the way it's
really really hard to say with certainty

738
00:50:52,779 --> 00:50:59,949
where you go from A to Z through with
you can you can make more realistic

739
00:51:00,969 --> 00:51:06,069
you can judge more realistically what
they're what they're making

740
00:51:06,579 --> 00:51:10,359
what kind of money there me yes very
true

741
00:51:10,989 --> 00:51:13,989
thank you very much for this excellent
talk

742
00:51:14,499 --> 00:51:15,098
thanks

