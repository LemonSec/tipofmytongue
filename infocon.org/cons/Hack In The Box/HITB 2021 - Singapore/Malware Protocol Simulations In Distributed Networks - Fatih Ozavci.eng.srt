1
00:00:09,200 --> 00:00:10,719
hi

2
00:00:10,719 --> 00:00:13,200
thank you for joining me uh today and

3
00:00:13,200 --> 00:00:14,719
thank you for hacking the box singapore

4
00:00:14,719 --> 00:00:16,239
to invite me to talk about malware

5
00:00:16,239 --> 00:00:18,320
protocol simulations in distributed

6
00:00:18,320 --> 00:00:20,320
networks today

7
00:00:20,320 --> 00:00:22,560
so i will talk about malware simulations

8
00:00:22,560 --> 00:00:25,039
today but the point here is actually how

9
00:00:25,039 --> 00:00:27,039
we can simulate this in blue teamers

10
00:00:27,039 --> 00:00:29,679
perspective so the question here is how

11
00:00:29,679 --> 00:00:31,920
can we safely simulate the malware and

12
00:00:31,920 --> 00:00:34,640
investory network traffic to assess our

13
00:00:34,640 --> 00:00:36,480
data analytics telemetry and defense

14
00:00:36,480 --> 00:00:38,559
solutions this type of question is

15
00:00:38,559 --> 00:00:40,960
always there and i have actually heard

16
00:00:40,960 --> 00:00:41,760
about

17
00:00:41,760 --> 00:00:44,000
similar things from different parties

18
00:00:44,000 --> 00:00:45,760
that includes blue teamers data

19
00:00:45,760 --> 00:00:47,440
analytics different security engineers

20
00:00:47,440 --> 00:00:49,520
and defense people so i will try to

21
00:00:49,520 --> 00:00:52,160
explain today how we can simulate all

22
00:00:52,160 --> 00:00:54,480
these activities uh in defensive point

23
00:00:54,480 --> 00:00:56,800
of view using the tools that can be

24
00:00:56,800 --> 00:00:59,280
utilized by the defense people

25
00:00:59,280 --> 00:01:01,359
so today we will talk about malware

26
00:01:01,359 --> 00:01:03,840
communications and how they work after

27
00:01:03,840 --> 00:01:05,600
that we will talk about cyber analytics

28
00:01:05,600 --> 00:01:07,200
for detecting this type of malware

29
00:01:07,200 --> 00:01:09,040
communications ways to generate the

30
00:01:09,040 --> 00:01:10,720
malware communications and of course i

31
00:01:10,720 --> 00:01:14,000
will talk about tessa today as well

32
00:01:14,000 --> 00:01:16,960
my name is fatih zavja i'm an advisory

33
00:01:16,960 --> 00:01:20,240
simulation specialist so i work for

34
00:01:20,240 --> 00:01:21,840
the missing link as a security

35
00:01:21,840 --> 00:01:24,479
consultant so i have provided similar

36
00:01:24,479 --> 00:01:27,200
research in my uh specialty this

37
00:01:27,200 --> 00:01:29,680
advisory simulations area so i have

38
00:01:29,680 --> 00:01:31,840
different tools such as tessa malware

39
00:01:31,840 --> 00:01:35,840
generator patax c2 i also prepare ta 505

40
00:01:35,840 --> 00:01:37,920
plus advisory simulation pack and we

41
00:01:37,920 --> 00:01:40,240
will talk about all of those during this

42
00:01:40,240 --> 00:01:42,240
talk i have previously reported some

43
00:01:42,240 --> 00:01:44,799
vulnerabilities to major vendors as well

44
00:01:44,799 --> 00:01:46,640
and i have presented in various secret

45
00:01:46,640 --> 00:01:48,560
conferences including hacking the box

46
00:01:48,560 --> 00:01:50,960
but also black hat defcon and some other

47
00:01:50,960 --> 00:01:54,159
compressors in the same area as well

48
00:01:54,159 --> 00:01:54,960
so

49
00:01:54,960 --> 00:01:57,439
we always see some sort of trade actor

50
00:01:57,439 --> 00:02:00,799
campaigns and we see that xyz is bridged

51
00:02:00,799 --> 00:02:03,920
and that network has been compromised or

52
00:02:03,920 --> 00:02:06,240
this data has been stolen but this

53
00:02:06,240 --> 00:02:08,560
always happens everywhere the point here

54
00:02:08,560 --> 00:02:11,038
is how we can identify them during our

55
00:02:11,038 --> 00:02:13,040
networks right but the problem there is

56
00:02:13,040 --> 00:02:16,560
also how they say that long in our

57
00:02:16,560 --> 00:02:19,520
networks so we will try to find how they

58
00:02:19,520 --> 00:02:21,920
move inside and how we can generate our

59
00:02:21,920 --> 00:02:24,800
iocs based on this type of stuff

60
00:02:24,800 --> 00:02:27,520
so this is an example of solarigate so

61
00:02:27,520 --> 00:02:29,680
during the solarwinds compromise

62
00:02:29,680 --> 00:02:33,360
nobelium trajector as named by microsoft

63
00:02:33,360 --> 00:02:35,680
has provided a different approach and

64
00:02:35,680 --> 00:02:38,000
they stayed inside for a long time they

65
00:02:38,000 --> 00:02:40,319
planned the exercise in advance and this

66
00:02:40,319 --> 00:02:42,640
is a more like a year of run

67
00:02:42,640 --> 00:02:45,200
so simply they started around september

68
00:02:45,200 --> 00:02:47,440
and they ended this in the end of the

69
00:02:47,440 --> 00:02:49,920
year and they commenced it so simply

70
00:02:49,920 --> 00:02:52,000
they developed tools they compromised

71
00:02:52,000 --> 00:02:54,560
the supply chain and then they allowed

72
00:02:54,560 --> 00:02:56,879
the supply chain uh compromised patches

73
00:02:56,879 --> 00:02:59,440
to distribute to the victims and then

74
00:02:59,440 --> 00:03:01,519
they decided to wait for the right

75
00:03:01,519 --> 00:03:03,040
victim to

76
00:03:03,040 --> 00:03:05,680
see the right environment as well so

77
00:03:05,680 --> 00:03:07,680
this is how it works for the uh trade

78
00:03:07,680 --> 00:03:09,920
actors perspective but eight months nine

79
00:03:09,920 --> 00:03:12,640
months or a year waiting period is too

80
00:03:12,640 --> 00:03:15,440
long they do that because they they're

81
00:03:15,440 --> 00:03:18,080
actually intense or slightly sensitive

82
00:03:18,080 --> 00:03:20,480
they try to compromise the government

83
00:03:20,480 --> 00:03:23,120
or some sensitive organizations so

84
00:03:23,120 --> 00:03:25,840
simply they are trying to go subtle as

85
00:03:25,840 --> 00:03:27,599
much as possible

86
00:03:27,599 --> 00:03:30,080
in this exercise they try to identify

87
00:03:30,080 --> 00:03:31,200
the victim

88
00:03:31,200 --> 00:03:33,840
and they do nothing before they identify

89
00:03:33,840 --> 00:03:34,959
the victim

90
00:03:34,959 --> 00:03:37,840
and that avoids actually all directions

91
00:03:37,840 --> 00:03:40,640
because we can't easily see how they

92
00:03:40,640 --> 00:03:41,680
behave

93
00:03:41,680 --> 00:03:43,280
and we don't see any malicious

94
00:03:43,280 --> 00:03:45,040
activities before the victim is

95
00:03:45,040 --> 00:03:48,080
identified so we need to see some sort

96
00:03:48,080 --> 00:03:50,159
of communication in our network that

97
00:03:50,159 --> 00:03:52,799
should not be attached to a reactor but

98
00:03:52,799 --> 00:03:55,439
also uh checking a kind of

99
00:03:55,439 --> 00:03:57,599
co2 instruction it's more like a slipper

100
00:03:57,599 --> 00:04:00,239
cell they utilize this using the dns

101
00:04:00,239 --> 00:04:02,959
services uh then after that they they

102
00:04:02,959 --> 00:04:05,680
used a stage deployment and they didn't

103
00:04:05,680 --> 00:04:07,680
use directly cobalt track for it they

104
00:04:07,680 --> 00:04:10,480
used their own c2 to deploy this

105
00:04:10,480 --> 00:04:13,439
second stage and then they invoked the

106
00:04:13,439 --> 00:04:15,760
cabal strike to make this interactive as

107
00:04:15,760 --> 00:04:17,918
well so before cobalt track you have

108
00:04:17,918 --> 00:04:20,160
other problems as well so simply you

109
00:04:20,160 --> 00:04:22,800
need to understand how they compromised

110
00:04:22,800 --> 00:04:25,199
you how they stayed in this network as a

111
00:04:25,199 --> 00:04:28,240
sleeping cell what where what the actual

112
00:04:28,240 --> 00:04:30,000
beakering ratio will be sufficient for

113
00:04:30,000 --> 00:04:32,720
you to identify this also how this stage

114
00:04:32,720 --> 00:04:35,600
deployment works can you identify this

115
00:04:35,600 --> 00:04:38,639
if so uh can you repeat this as well

116
00:04:38,639 --> 00:04:40,400
because most of the blue teamers use

117
00:04:40,400 --> 00:04:42,560
different tools uh some use security

118
00:04:42,560 --> 00:04:44,639
online some use splunk some news hadoop

119
00:04:44,639 --> 00:04:46,639
say some user exam so they have

120
00:04:46,639 --> 00:04:48,800
different telemetry they have different

121
00:04:48,800 --> 00:04:50,639
network requirements that's why

122
00:04:50,639 --> 00:04:53,040
simulations are important to give them

123
00:04:53,040 --> 00:04:54,639
almost all these opportunities to

124
00:04:54,639 --> 00:04:56,960
simulate the activities

125
00:04:56,960 --> 00:04:59,199
in this case we need to understand a

126
00:04:59,199 --> 00:05:01,039
trade actor perspective they identify

127
00:05:01,039 --> 00:05:03,280
the organization they identify people

128
00:05:03,280 --> 00:05:05,440
they after that find the most valuable

129
00:05:05,440 --> 00:05:07,440
things and they try to steal this all

130
00:05:07,440 --> 00:05:10,479
this process takes that long so we can

131
00:05:10,479 --> 00:05:12,479
identify some of those activities or we

132
00:05:12,479 --> 00:05:14,639
can simulate them better to see our

133
00:05:14,639 --> 00:05:16,479
telemetry works or not

134
00:05:16,479 --> 00:05:18,000
there are different types of advisory

135
00:05:18,000 --> 00:05:20,320
simulations of course there is red team

136
00:05:20,320 --> 00:05:22,400
and it is a covert operation of the

137
00:05:22,400 --> 00:05:24,880
adversary simulations they don't tell

138
00:05:24,880 --> 00:05:27,039
anything to the blue teamers other than

139
00:05:27,039 --> 00:05:28,400
some white team members such as

140
00:05:28,400 --> 00:05:31,039
executive committee and they perform an

141
00:05:31,039 --> 00:05:33,759
advisory simulation in that context so

142
00:05:33,759 --> 00:05:36,479
simply we see this and it works for some

143
00:05:36,479 --> 00:05:38,960
of the exercises but blue tumors that

144
00:05:38,960 --> 00:05:41,199
they do not get improved there very fast

145
00:05:41,199 --> 00:05:43,600
during the exercises on the other hand

146
00:05:43,600 --> 00:05:46,639
purple team-like exercises they actually

147
00:05:46,639 --> 00:05:49,199
invite blue teamers to the exercise it's

148
00:05:49,199 --> 00:05:52,000
a collaborative exercise simply they run

149
00:05:52,000 --> 00:05:55,120
the exercise in both parties step by

150
00:05:55,120 --> 00:05:57,840
step for example we executed the initial

151
00:05:57,840 --> 00:05:59,759
compromise would you please confirm you

152
00:05:59,759 --> 00:06:02,400
have telemetry on it okay we executed

153
00:06:02,400 --> 00:06:04,639
the situational awareness or privilege

154
00:06:04,639 --> 00:06:06,080
escalation or lateral movement

155
00:06:06,080 --> 00:06:07,680
activities would you please confirm that

156
00:06:07,680 --> 00:06:10,880
as well so it is more like a a kind of

157
00:06:10,880 --> 00:06:12,240
uh

158
00:06:12,240 --> 00:06:14,240
interactive activity for everyone and

159
00:06:14,240 --> 00:06:16,720
they try to keep all the logs all the

160
00:06:16,720 --> 00:06:18,560
activities and telemetry and they need

161
00:06:18,560 --> 00:06:20,240
to share it and they need to train

162
00:06:20,240 --> 00:06:22,639
themselves one other type is also

163
00:06:22,639 --> 00:06:24,720
important it is called generally uh

164
00:06:24,720 --> 00:06:27,280
breach or threat simulations and they

165
00:06:27,280 --> 00:06:29,600
are automated simulations generally and

166
00:06:29,600 --> 00:06:32,160
they actually utilize some of the iocs

167
00:06:32,160 --> 00:06:34,560
to actually ring the bells for telemetry

168
00:06:34,560 --> 00:06:36,880
they are not that realistic and they

169
00:06:36,880 --> 00:06:39,039
will try to give you some indicators of

170
00:06:39,039 --> 00:06:40,479
compromise to make sure that your

171
00:06:40,479 --> 00:06:42,800
telemetry is there but you don't know

172
00:06:42,800 --> 00:06:45,120
whether or not that telemetry is based

173
00:06:45,120 --> 00:06:48,000
on an ioc available in real life so

174
00:06:48,000 --> 00:06:50,160
simply the trade actor will change their

175
00:06:50,160 --> 00:06:52,160
implementation and in this case you need

176
00:06:52,160 --> 00:06:55,120
to check your telemetry back again

177
00:06:55,120 --> 00:06:58,000
so when we run a red team exercise it

178
00:06:58,000 --> 00:07:01,520
takes time sometimes ages it starts with

179
00:07:01,520 --> 00:07:04,080
uh maybe one or two months it may go to

180
00:07:04,080 --> 00:07:06,319
six months activity as well it's pretty

181
00:07:06,319 --> 00:07:08,639
much like the adversary simulations and

182
00:07:08,639 --> 00:07:11,599
advanced reactor activities as well so

183
00:07:11,599 --> 00:07:13,680
just like no volume it may take a year

184
00:07:13,680 --> 00:07:15,360
so it depends on the objectives or to

185
00:07:15,360 --> 00:07:17,919
exercise however it is not easy to rerun

186
00:07:17,919 --> 00:07:19,919
for blue tumors and we can't easily

187
00:07:19,919 --> 00:07:21,840
learn almost all of those so we need to

188
00:07:21,840 --> 00:07:24,479
break this down and make it actually

189
00:07:24,479 --> 00:07:26,800
eatable chewable for us

190
00:07:26,800 --> 00:07:29,360
cyber analytics in this case

191
00:07:29,360 --> 00:07:31,840
most uh friendly approach and i advanced

192
00:07:31,840 --> 00:07:33,759
cyber analytics help defenders to

193
00:07:33,759 --> 00:07:35,919
identify various indicators of

194
00:07:35,919 --> 00:07:38,160
compromise uh in the organizations

195
00:07:38,160 --> 00:07:40,319
including their telemetry including

196
00:07:40,319 --> 00:07:42,800
their uh maybe endpoint activities some

197
00:07:42,800 --> 00:07:44,720
managed services and that there are

198
00:07:44,720 --> 00:07:46,400
several different tools that can be

199
00:07:46,400 --> 00:07:49,199
utilizing this advanced cyber analytics

200
00:07:49,199 --> 00:07:51,360
sometimes you use data sources coming

201
00:07:51,360 --> 00:07:53,759
from endpoint server or network

202
00:07:53,759 --> 00:07:55,919
monitoring sometimes you use a managed

203
00:07:55,919 --> 00:07:57,840
actually service provider that can

204
00:07:57,840 --> 00:08:00,000
deploy this data to you or you can use

205
00:08:00,000 --> 00:08:01,919
commercial services that can record and

206
00:08:01,919 --> 00:08:04,319
generate this data ingest to your data

207
00:08:04,319 --> 00:08:06,479
analytics platform so different types of

208
00:08:06,479 --> 00:08:09,039
activities will happen but the thing is

209
00:08:09,039 --> 00:08:11,680
we have a process here we need to

210
00:08:11,680 --> 00:08:13,759
set a good telemetry we need to ingest

211
00:08:13,759 --> 00:08:17,039
this in a real time as possible as much

212
00:08:17,039 --> 00:08:19,440
as possible and after that we need to

213
00:08:19,440 --> 00:08:21,759
build our own directions based on the

214
00:08:21,759 --> 00:08:24,319
pool available in this data analytics

215
00:08:24,319 --> 00:08:26,080
environment so simply we need to

216
00:08:26,080 --> 00:08:28,000
understand how it works

217
00:08:28,000 --> 00:08:30,080
in this case we need to test ingestion

218
00:08:30,080 --> 00:08:32,399
we need to test telemetry whether or not

219
00:08:32,399 --> 00:08:34,799
it works the data sources available or

220
00:08:34,799 --> 00:08:38,799
not or they see those activities uh also

221
00:08:38,799 --> 00:08:40,719
for deduction-wise we may use

222
00:08:40,719 --> 00:08:42,880
signature-based detection we may need to

223
00:08:42,880 --> 00:08:45,360
train machine learning or ai so we have

224
00:08:45,360 --> 00:08:46,800
a lot of different things to test in

225
00:08:46,800 --> 00:08:49,040
this picture so cyber analytics is a

226
00:08:49,040 --> 00:08:51,440
part of our fiber defense world and we

227
00:08:51,440 --> 00:08:53,440
need to test almost all of those in that

228
00:08:53,440 --> 00:08:55,760
manner so training exercises or testing

229
00:08:55,760 --> 00:08:58,720
them is quite important

230
00:08:58,720 --> 00:08:59,600
so

231
00:08:59,600 --> 00:09:00,880
mantra

232
00:09:00,880 --> 00:09:03,279
actually provides a good map and i cut

233
00:09:03,279 --> 00:09:05,279
up actually some portions of this map

234
00:09:05,279 --> 00:09:08,320
which could be relevant to our talk and

235
00:09:08,320 --> 00:09:10,720
we see some of the c2 activities and

236
00:09:10,720 --> 00:09:13,040
exfiltration activities here they are

237
00:09:13,040 --> 00:09:15,279
related activities for this talk because

238
00:09:15,279 --> 00:09:16,640
we will talk about malware

239
00:09:16,640 --> 00:09:18,240
communications and how we can simulate

240
00:09:18,240 --> 00:09:19,920
them for the data analytics and

241
00:09:19,920 --> 00:09:22,800
defensive perspective so we need to

242
00:09:22,800 --> 00:09:25,360
focus on these type of co2 activities

243
00:09:25,360 --> 00:09:27,360
that includes actually

244
00:09:27,360 --> 00:09:29,519
some sort of beaconing also a real-time

245
00:09:29,519 --> 00:09:31,600
communication tunneling

246
00:09:31,600 --> 00:09:33,600
data acceleration so we have different

247
00:09:33,600 --> 00:09:36,080
options for the c2s sometimes it is

248
00:09:36,080 --> 00:09:38,240
interactive sometimes it is go subtle

249
00:09:38,240 --> 00:09:41,440
such as dns or uh maybe to raise social

250
00:09:41,440 --> 00:09:43,519
media as well this has been used by

251
00:09:43,519 --> 00:09:45,200
different trade actors for example true

252
00:09:45,200 --> 00:09:47,760
love was using social media to identify

253
00:09:47,760 --> 00:09:50,560
things also the volume was using cobalt

254
00:09:50,560 --> 00:09:52,640
track for the interactive activities so

255
00:09:52,640 --> 00:09:54,560
everybody was using different types of

256
00:09:54,560 --> 00:09:56,399
uh tools but there are some common

257
00:09:56,399 --> 00:09:58,480
things so we will discuss about how we

258
00:09:58,480 --> 00:10:02,240
can simulate these common things today

259
00:10:02,240 --> 00:10:03,279
so

260
00:10:03,279 --> 00:10:05,440
advisory simulation activities can be

261
00:10:05,440 --> 00:10:07,200
actually handled in two different

262
00:10:07,200 --> 00:10:08,959
categories one is collaborative the

263
00:10:08,959 --> 00:10:11,120
other one is automated one i will not

264
00:10:11,120 --> 00:10:13,040
talk about rate team activities today

265
00:10:13,040 --> 00:10:15,200
because it is not easy to run a red team

266
00:10:15,200 --> 00:10:18,079
activity only for uh seeing telemetry or

267
00:10:18,079 --> 00:10:20,000
cyber analytics work because it takes

268
00:10:20,000 --> 00:10:22,000
time time consuming but also resources

269
00:10:22,000 --> 00:10:24,959
are expensive and it will be also not

270
00:10:24,959 --> 00:10:27,200
efficient to fix the errors on the way

271
00:10:27,200 --> 00:10:29,680
because you won't see any activities

272
00:10:29,680 --> 00:10:31,839
before the exercise completes you will

273
00:10:31,839 --> 00:10:34,160
see some activities that could be

274
00:10:34,160 --> 00:10:36,560
actually a real trade actor or the

275
00:10:36,560 --> 00:10:38,399
consultants performing the advisory

276
00:10:38,399 --> 00:10:40,000
simulation so you can't differentiate

277
00:10:40,000 --> 00:10:42,560
them unless you have attribution

278
00:10:42,560 --> 00:10:44,640
that's why the red team is out of scope

279
00:10:44,640 --> 00:10:46,560
for this talk we will focus on two types

280
00:10:46,560 --> 00:10:48,079
of the activities one is the

281
00:10:48,079 --> 00:10:50,079
collaborative exercise that could be

282
00:10:50,079 --> 00:10:52,560
actually quite useful for you and they

283
00:10:52,560 --> 00:10:54,399
are called genolipid colors such as

284
00:10:54,399 --> 00:10:56,800
purple team exercises but we can easily

285
00:10:56,800 --> 00:10:58,320
call this collaborative advices

286
00:10:58,320 --> 00:10:59,920
simulation exercises or advisory

287
00:10:59,920 --> 00:11:02,959
emulation exercises simply red team and

288
00:11:02,959 --> 00:11:05,279
blue team they work together which is

289
00:11:05,279 --> 00:11:07,279
great to develop actually more

290
00:11:07,279 --> 00:11:08,959
capabilities there

291
00:11:08,959 --> 00:11:11,440
and there are really good upsides there

292
00:11:11,440 --> 00:11:13,040
first you need to work on the trade

293
00:11:13,040 --> 00:11:15,200
intelligence data together you need to

294
00:11:15,200 --> 00:11:17,360
actually find the data analytics cases

295
00:11:17,360 --> 00:11:19,120
and you can deploy this for the defense

296
00:11:19,120 --> 00:11:22,000
perspective you can actually

297
00:11:22,000 --> 00:11:24,079
assist to the red tumors to commence the

298
00:11:24,079 --> 00:11:26,000
exercise instead of waiting for a

299
00:11:26,000 --> 00:11:28,480
phishing email for two weeks or maybe a

300
00:11:28,480 --> 00:11:30,800
couple of months to run you can just

301
00:11:30,800 --> 00:11:32,800
assist them to give a consent to run a

302
00:11:32,800 --> 00:11:33,839
laptop

303
00:11:33,839 --> 00:11:35,760
and run the execution phase or open the

304
00:11:35,760 --> 00:11:38,640
document so it can start with an assumed

305
00:11:38,640 --> 00:11:41,279
breach principle so it will be quite

306
00:11:41,279 --> 00:11:43,360
useful for this case and you can

307
00:11:43,360 --> 00:11:45,519
actually manage the hostile activities

308
00:11:45,519 --> 00:11:47,200
as well because you can contain the

309
00:11:47,200 --> 00:11:49,760
issues you can say that this server must

310
00:11:49,760 --> 00:11:52,079
be tested this end point must be tested

311
00:11:52,079 --> 00:11:55,120
these activities must be replicated this

312
00:11:55,120 --> 00:11:56,639
is quite important

313
00:11:56,639 --> 00:11:58,959
there are downsides of course because

314
00:11:58,959 --> 00:12:00,720
whenever you go to this type of

315
00:12:00,720 --> 00:12:02,800
communications you won't see the cyborg

316
00:12:02,800 --> 00:12:06,240
defense actually uh behaviors instincts

317
00:12:06,240 --> 00:12:08,480
because the thing is they will know the

318
00:12:08,480 --> 00:12:10,720
exercise that's the kind of downside

319
00:12:10,720 --> 00:12:12,959
second downside here is actually

320
00:12:12,959 --> 00:12:15,120
regarding the red team because red team

321
00:12:15,120 --> 00:12:16,800
won't use exactly

322
00:12:16,800 --> 00:12:19,519
all the realistic tools to avoid you for

323
00:12:19,519 --> 00:12:21,680
example domain fronting or hiding the

324
00:12:21,680 --> 00:12:23,440
activities performing a supply chain

325
00:12:23,440 --> 00:12:25,920
attack distributed to months so you will

326
00:12:25,920 --> 00:12:28,560
need to make this a realistic but

327
00:12:28,560 --> 00:12:30,639
eventually this will be slightly

328
00:12:30,639 --> 00:12:33,600
different from the real life actors

329
00:12:33,600 --> 00:12:36,480
the other thing is you can't easily give

330
00:12:36,480 --> 00:12:38,560
a full opportunity to the red team to

331
00:12:38,560 --> 00:12:40,480
compromise your entire network that is

332
00:12:40,480 --> 00:12:43,120
not possible also that is not exactly

333
00:12:43,120 --> 00:12:45,760
logical either because we know that you

334
00:12:45,760 --> 00:12:48,000
don't have telemetry everywhere the

335
00:12:48,000 --> 00:12:50,160
second thing is you can't easily allow

336
00:12:50,160 --> 00:12:52,000
to compromise the entire organization

337
00:12:52,000 --> 00:12:54,160
because you are just a cyber defense

338
00:12:54,160 --> 00:12:57,279
team so sometimes you try to define

339
00:12:57,279 --> 00:12:59,760
some servers or resources that you have

340
00:12:59,760 --> 00:13:01,279
no access to

341
00:13:01,279 --> 00:13:03,360
so you have only the ad point tools

342
00:13:03,360 --> 00:13:05,279
installed on it or server tools

343
00:13:05,279 --> 00:13:07,440
installed on it to remotely get

344
00:13:07,440 --> 00:13:09,839
telemetry that's it you can't give any

345
00:13:09,839 --> 00:13:12,240
content to test them if that is the case

346
00:13:12,240 --> 00:13:14,160
you need to supply some nominated

347
00:13:14,160 --> 00:13:16,720
systems designated systems to run this

348
00:13:16,720 --> 00:13:18,959
exercise this actually limits the

349
00:13:18,959 --> 00:13:21,040
capabilities of the red team so you need

350
00:13:21,040 --> 00:13:24,000
to see that red team will uh simulate

351
00:13:24,000 --> 00:13:27,440
the activities slightly realistic but to

352
00:13:27,440 --> 00:13:29,440
well-known targets and they will also

353
00:13:29,440 --> 00:13:31,600
know that where to go which is also

354
00:13:31,600 --> 00:13:33,279
another limitation

355
00:13:33,279 --> 00:13:36,959
so offensive mind is there but partially

356
00:13:36,959 --> 00:13:38,880
because for the adversaries they will

357
00:13:38,880 --> 00:13:41,600
try to chase the target if they are

358
00:13:41,600 --> 00:13:43,440
let's say short of time behind of

359
00:13:43,440 --> 00:13:45,920
schedule they will use highly noisy

360
00:13:45,920 --> 00:13:47,519
activities that could be even remote

361
00:13:47,519 --> 00:13:48,880
exploitation

362
00:13:48,880 --> 00:13:50,560
or maybe denial of service attacks

363
00:13:50,560 --> 00:13:53,920
because they need that objective to run

364
00:13:53,920 --> 00:13:56,160
however in your collaborative exercise

365
00:13:56,160 --> 00:13:58,240
you can't be hostile like that you need

366
00:13:58,240 --> 00:14:00,639
to think about how we can utilize this

367
00:14:00,639 --> 00:14:03,120
activities and offensive mind is a kind

368
00:14:03,120 --> 00:14:05,760
of problem because you can't always find

369
00:14:05,760 --> 00:14:06,959
the red team

370
00:14:06,959 --> 00:14:09,199
so this is time consuming and resources

371
00:14:09,199 --> 00:14:11,760
are expensive again those are downsides

372
00:14:11,760 --> 00:14:13,120
on the other hand for the automated

373
00:14:13,120 --> 00:14:15,279
traffic generation you don't have some

374
00:14:15,279 --> 00:14:17,920
of those limitations so you can use

375
00:14:17,920 --> 00:14:20,000
realistic tools you can use direct

376
00:14:20,000 --> 00:14:21,920
indicators of compromise you can

377
00:14:21,920 --> 00:14:23,839
actually extract from the thread

378
00:14:23,839 --> 00:14:25,680
intelligence and you can actually

379
00:14:25,680 --> 00:14:27,360
provide realistic lateral movement

380
00:14:27,360 --> 00:14:29,600
because you can actually replicate the

381
00:14:29,600 --> 00:14:31,360
exploitation accounts with their

382
00:14:31,360 --> 00:14:32,959
signatures and other stuff as well and

383
00:14:32,959 --> 00:14:35,279
you can repeat this and you can also use

384
00:14:35,279 --> 00:14:37,360
a kind of c2 and you can actually mask

385
00:14:37,360 --> 00:14:39,760
this as well just like the other ones so

386
00:14:39,760 --> 00:14:41,440
they are actually

387
00:14:41,440 --> 00:14:43,279
almost same for the up size actually

388
00:14:43,279 --> 00:14:45,760
automated traffic generation will give

389
00:14:45,760 --> 00:14:48,079
you more opportunities in some cases but

390
00:14:48,079 --> 00:14:50,240
of course there must be a driver

391
00:14:50,240 --> 00:14:53,040
downsize are just again this is an

392
00:14:53,040 --> 00:14:55,279
automated environment so you may have

393
00:14:55,279 --> 00:14:57,360
limitations of software you may have

394
00:14:57,360 --> 00:14:59,920
compliance violations uh so you need to

395
00:14:59,920 --> 00:15:01,760
pay attention to those complies uh

396
00:15:01,760 --> 00:15:04,000
compliance violations uh that's why you

397
00:15:04,000 --> 00:15:06,000
need to follow some certain execution

398
00:15:06,000 --> 00:15:07,680
schemes you need to also actually

399
00:15:07,680 --> 00:15:09,920
nominate some software to uh perform

400
00:15:09,920 --> 00:15:12,320
this you need a software suite to run

401
00:15:12,320 --> 00:15:14,240
this accurately as well for example

402
00:15:14,240 --> 00:15:16,160
interactive communications stage

403
00:15:16,160 --> 00:15:18,639
deployments co2 communications and

404
00:15:18,639 --> 00:15:20,560
sometimes even you have no access to

405
00:15:20,560 --> 00:15:22,160
those offensive tools right because you

406
00:15:22,160 --> 00:15:23,360
are defense

407
00:15:23,360 --> 00:15:26,000
and cyber analytics people do not run

408
00:15:26,000 --> 00:15:29,120
kabul track daily so that is not logical

409
00:15:29,120 --> 00:15:31,519
either so someone needs to give you

410
00:15:31,519 --> 00:15:33,040
those tools and that is not always

411
00:15:33,040 --> 00:15:34,399
possible because of the license

412
00:15:34,399 --> 00:15:36,800
restrictions so you need some toolsets

413
00:15:36,800 --> 00:15:38,959
and you need to be armed to do that that

414
00:15:38,959 --> 00:15:41,120
is the downside of it there are some

415
00:15:41,120 --> 00:15:42,880
solutions open source and commercial

416
00:15:42,880 --> 00:15:44,880
today i will talk about my solutions

417
00:15:44,880 --> 00:15:47,040
only but there are of course lots of

418
00:15:47,040 --> 00:15:49,199
different commercial solutions here

419
00:15:49,199 --> 00:15:51,680
and uh sky attack iq or open source

420
00:15:51,680 --> 00:15:54,079
caldera for example they are the tools

421
00:15:54,079 --> 00:15:55,920
that can help you to simulate some of

422
00:15:55,920 --> 00:15:57,759
those activities as well so pay

423
00:15:57,759 --> 00:15:59,360
attention to those tools if you are

424
00:15:59,360 --> 00:16:01,279
looking for some commercials or

425
00:16:01,279 --> 00:16:02,720
commercial solutions and vendor

426
00:16:02,720 --> 00:16:04,639
activities

427
00:16:04,639 --> 00:16:06,639
but today i will talk about my open

428
00:16:06,639 --> 00:16:09,279
source solutions and try to arm you

429
00:16:09,279 --> 00:16:11,680
actually to test your initial

430
00:16:11,680 --> 00:16:13,759
environments draft environments maybe

431
00:16:13,759 --> 00:16:16,000
data collection environments but that's

432
00:16:16,000 --> 00:16:16,880
it

433
00:16:16,880 --> 00:16:19,680
in production use my tools will be not

434
00:16:19,680 --> 00:16:23,120
sufficient for you so how we will

435
00:16:23,120 --> 00:16:25,680
operate this so for the collaborative

436
00:16:25,680 --> 00:16:27,440
exercise we can actually follow a

437
00:16:27,440 --> 00:16:30,639
certain uh scheme and certain steps for

438
00:16:30,639 --> 00:16:32,959
example finding the ti report

439
00:16:32,959 --> 00:16:34,959
intelligence report preparing this

440
00:16:34,959 --> 00:16:37,440
simulation task automating the tasks and

441
00:16:37,440 --> 00:16:39,440
observing the defense activities so it

442
00:16:39,440 --> 00:16:42,560
is slightly easy for everyone and uh the

443
00:16:42,560 --> 00:16:44,959
tools are shared that's why we can see

444
00:16:44,959 --> 00:16:46,480
actually some of those tools to be

445
00:16:46,480 --> 00:16:48,560
delivered to the defense people which is

446
00:16:48,560 --> 00:16:50,560
great in this case

447
00:16:50,560 --> 00:16:53,519
so i prepared it's a certain exercise

448
00:16:53,519 --> 00:16:56,639
for it ta 505 plus advisory simulation

449
00:16:56,639 --> 00:16:58,959
pack this pack has been designed for

450
00:16:58,959 --> 00:17:00,480
ta505

451
00:17:00,480 --> 00:17:03,040
which is a trade actor

452
00:17:03,040 --> 00:17:05,359
actively targeting australia or apec

453
00:17:05,359 --> 00:17:08,480
area or usa so simply they are quite

454
00:17:08,480 --> 00:17:10,480
active they perform some uh cyber

455
00:17:10,480 --> 00:17:13,119
espionage operations they provide some

456
00:17:13,119 --> 00:17:14,720
ransomware operations they try to

457
00:17:14,720 --> 00:17:16,640
collect some money they try to actually

458
00:17:16,640 --> 00:17:18,400
resell this information to different

459
00:17:18,400 --> 00:17:19,919
parties as well

460
00:17:19,919 --> 00:17:22,400
i was interested in this trade actor

461
00:17:22,400 --> 00:17:23,599
because they were targeting the

462
00:17:23,599 --> 00:17:25,599
financial institutions

463
00:17:25,599 --> 00:17:27,679
and i was in the financial industry for

464
00:17:27,679 --> 00:17:30,480
three and a half years to identify some

465
00:17:30,480 --> 00:17:32,480
of the issues stimulate activities so it

466
00:17:32,480 --> 00:17:34,799
was a kind of certain interest for me

467
00:17:34,799 --> 00:17:37,360
and that's why i prepared a simulation

468
00:17:37,360 --> 00:17:39,200
for it however the simulation is not

469
00:17:39,200 --> 00:17:41,280
based on the trade intelligence reports

470
00:17:41,280 --> 00:17:44,160
because we know that they evolve they

471
00:17:44,160 --> 00:17:45,679
provide different tools different

472
00:17:45,679 --> 00:17:48,080
techniques after each campaign so they

473
00:17:48,080 --> 00:17:49,039
learn

474
00:17:49,039 --> 00:17:51,440
so we need to learn as well so i try to

475
00:17:51,440 --> 00:17:53,200
say that okay

476
00:17:53,200 --> 00:17:54,240
what if

477
00:17:54,240 --> 00:17:57,919
38a 505 plus targets a cutting-edge

478
00:17:57,919 --> 00:18:00,160
environment that you can utilize for

479
00:18:00,160 --> 00:18:03,600
example windows 10 office 2019 all the

480
00:18:03,600 --> 00:18:05,760
defense tools activated windows

481
00:18:05,760 --> 00:18:08,000
defenders enabled activated cloud

482
00:18:08,000 --> 00:18:10,320
activated everything is activated and up

483
00:18:10,320 --> 00:18:11,360
to date

484
00:18:11,360 --> 00:18:14,799
so simply you have nowhere to hide

485
00:18:14,799 --> 00:18:17,440
but again you need to use open source

486
00:18:17,440 --> 00:18:19,760
tools and existing vulnerabilities you

487
00:18:19,760 --> 00:18:22,640
can't utilize a zero day you can't use a

488
00:18:22,640 --> 00:18:24,960
new technique that is in your pocket and

489
00:18:24,960 --> 00:18:27,679
you're waiting for it right so i try to

490
00:18:27,679 --> 00:18:29,919
prepare this exercise in that manner and

491
00:18:29,919 --> 00:18:32,160
i use this exercise to bypass all these

492
00:18:32,160 --> 00:18:34,640
security controls try to generate this

493
00:18:34,640 --> 00:18:37,440
traffic for you and prepare this

494
00:18:37,440 --> 00:18:39,679
good part is this exercise is ready to

495
00:18:39,679 --> 00:18:42,080
go pack so you can use this as a red

496
00:18:42,080 --> 00:18:44,000
teamer you can use this as a blue teamer

497
00:18:44,000 --> 00:18:46,640
or a purple teamer and you can use this

498
00:18:46,640 --> 00:18:48,720
as a kind of advanced analytics uh

499
00:18:48,720 --> 00:18:51,200
person or specialist as well so simply

500
00:18:51,200 --> 00:18:52,799
you can take the different portions or

501
00:18:52,799 --> 00:18:54,559
you can make it a collaborative exercise

502
00:18:54,559 --> 00:18:58,240
for all parties so it is free to go

503
00:18:58,240 --> 00:19:01,039
it is actually based on a certain c2

504
00:19:01,039 --> 00:19:04,320
which is pataxi ii and also malware

505
00:19:04,320 --> 00:19:07,039
patek is another tool i developed last

506
00:19:07,039 --> 00:19:09,840
year and actually the year before but

507
00:19:09,840 --> 00:19:12,080
last year i published this tool it is a

508
00:19:12,080 --> 00:19:14,880
commander control server with a malware

509
00:19:14,880 --> 00:19:17,039
which is an implant we will call it

510
00:19:17,039 --> 00:19:19,120
implant from this point because we will

511
00:19:19,120 --> 00:19:22,320
drive it so whenever i use malware i

512
00:19:22,320 --> 00:19:24,880
will refer to malware activities of it

513
00:19:24,880 --> 00:19:27,280
but again it is an implant so we can

514
00:19:27,280 --> 00:19:29,840
simply drive it we can remove features

515
00:19:29,840 --> 00:19:31,760
if we don't need to and we can actually

516
00:19:31,760 --> 00:19:34,799
customize this but means weirdo in

517
00:19:34,799 --> 00:19:37,919
klingon it is there because it was like

518
00:19:37,919 --> 00:19:40,480
uh first ct and implant generation in c

519
00:19:40,480 --> 00:19:42,559
sharp before that i have developed say

520
00:19:42,559 --> 00:19:45,120
different c2s using python lambda

521
00:19:45,120 --> 00:19:47,840
dynamodb on aws tools and distributed

522
00:19:47,840 --> 00:19:50,080
networks but this one is special for the

523
00:19:50,080 --> 00:19:52,240
defense teams because i was planning to

524
00:19:52,240 --> 00:19:53,840
automate some activities so it has

525
00:19:53,840 --> 00:19:55,919
automation capabilities which is great

526
00:19:55,919 --> 00:19:58,480
other than this for the execution part

527
00:19:58,480 --> 00:20:00,880
it supports.netassemblies.net

528
00:20:00,880 --> 00:20:03,440
source code and it can utilize some of

529
00:20:03,440 --> 00:20:05,520
the other tools third-party tools for

530
00:20:05,520 --> 00:20:07,039
example if you like

531
00:20:07,039 --> 00:20:09,679
for example spectrops close pack you can

532
00:20:09,679 --> 00:20:11,600
just load those tools and run in memory

533
00:20:11,600 --> 00:20:13,919
and generate all of the output in an

534
00:20:13,919 --> 00:20:15,679
automated way as well

535
00:20:15,679 --> 00:20:17,679
moreover it supports normal commands

536
00:20:17,679 --> 00:20:19,520
powershell in system automation

537
00:20:19,520 --> 00:20:20,400
perspective

538
00:20:20,400 --> 00:20:21,520
and it can

539
00:20:21,520 --> 00:20:23,679
support process injection in different

540
00:20:23,679 --> 00:20:26,000
types so it is good for

541
00:20:26,000 --> 00:20:28,159
this type of activities to run so it

542
00:20:28,159 --> 00:20:30,960
generates a lot of ttps on the end point

543
00:20:30,960 --> 00:20:33,120
but also it has additional features for

544
00:20:33,120 --> 00:20:36,240
the lateral movement for example wmi uh

545
00:20:36,240 --> 00:20:38,159
can be used to compromise the remote

546
00:20:38,159 --> 00:20:40,880
hose right you can use wmi to do that

547
00:20:40,880 --> 00:20:43,600
and it supports native wmi connections

548
00:20:43,600 --> 00:20:46,559
to get code execution with credentials

549
00:20:46,559 --> 00:20:49,200
but also it supports a nested implant

550
00:20:49,200 --> 00:20:51,679
perspective so simply whenever you have

551
00:20:51,679 --> 00:20:54,000
weakness with one certain implant you

552
00:20:54,000 --> 00:20:56,320
can use other implants as well through

553
00:20:56,320 --> 00:20:57,760
the same implant just like the cobalt

554
00:20:57,760 --> 00:20:59,679
strike or other activities you can just

555
00:20:59,679 --> 00:21:00,880
deploy

556
00:21:00,880 --> 00:21:03,600
and then link it to the original implant

557
00:21:03,600 --> 00:21:05,840
and you can actually deploy another

558
00:21:05,840 --> 00:21:08,320
implant and you can link it to different

559
00:21:08,320 --> 00:21:11,039
implants so simply you may have access

560
00:21:11,039 --> 00:21:13,919
to the implants in your console but you

561
00:21:13,919 --> 00:21:17,039
don't need to know how they're connected

562
00:21:17,039 --> 00:21:19,840
you already designed this and you run it

563
00:21:19,840 --> 00:21:23,200
so simply you know that

564
00:21:23,200 --> 00:21:24,799
implants will

565
00:21:24,799 --> 00:21:27,039
drive this through the way for example

566
00:21:27,039 --> 00:21:28,799
if you have any instruction to the

567
00:21:28,799 --> 00:21:31,440
implant let's say d in the back

568
00:21:31,440 --> 00:21:33,280
through the websocket connection with

569
00:21:33,280 --> 00:21:36,000
the original implant and then

570
00:21:36,000 --> 00:21:38,159
the second connection smb named pipe to

571
00:21:38,159 --> 00:21:41,200
the implant a after that tcp connection

572
00:21:41,200 --> 00:21:43,280
to b and another one to see udp

573
00:21:43,280 --> 00:21:45,039
connection to d so instruction will

574
00:21:45,039 --> 00:21:47,840
arrive to d directly because there's a

575
00:21:47,840 --> 00:21:49,760
there is a kind of pass through here

576
00:21:49,760 --> 00:21:50,880
because

577
00:21:50,880 --> 00:21:53,120
because of this nested implant feature

578
00:21:53,120 --> 00:21:55,280
which helped me a lot especially for the

579
00:21:55,280 --> 00:21:57,919
air gap networks or similar isolated

580
00:21:57,919 --> 00:21:59,760
networks it helped me to deploy the

581
00:21:59,760 --> 00:22:02,240
tools and tactics and etcetera so take a

582
00:22:02,240 --> 00:22:04,400
look at that one other thing is quite

583
00:22:04,400 --> 00:22:06,080
important scenario based approach

584
00:22:06,080 --> 00:22:08,480
whenever i run a red team exercise

585
00:22:08,480 --> 00:22:11,280
defense people generally ask me to

586
00:22:11,280 --> 00:22:13,679
ask me to replicate this again and again

587
00:22:13,679 --> 00:22:15,200
for different reasons

588
00:22:15,200 --> 00:22:17,120
to check to check the telemetry to

589
00:22:17,120 --> 00:22:18,880
understand the activity

590
00:22:18,880 --> 00:22:20,240
lots of reasons

591
00:22:20,240 --> 00:22:22,720
so i added a feature here which is

592
00:22:22,720 --> 00:22:25,039
scenario automation so simply you can

593
00:22:25,039 --> 00:22:29,120
make all these instructions https

594
00:22:30,320 --> 00:22:33,600
sorry uh you can make all of these ttps

595
00:22:33,600 --> 00:22:35,360
then you can actually make it this

596
00:22:35,360 --> 00:22:37,760
scenario as well so it's up to you then

597
00:22:37,760 --> 00:22:39,679
you can just run the scenario and you

598
00:22:39,679 --> 00:22:41,520
can see all the activities again and you

599
00:22:41,520 --> 00:22:43,840
can check your telemetry you improve it

600
00:22:43,840 --> 00:22:45,760
you tighten this up run the scenario

601
00:22:45,760 --> 00:22:46,960
back again

602
00:22:46,960 --> 00:22:49,919
less effort using the realistic c2 and

603
00:22:49,919 --> 00:22:52,080
it is not so different than for example

604
00:22:52,080 --> 00:22:54,400
covenant or mythic or kabul strike

605
00:22:54,400 --> 00:22:56,159
it is of course immature because

606
00:22:56,159 --> 00:22:58,159
developed by one single person in free

607
00:22:58,159 --> 00:22:59,120
time

608
00:22:59,120 --> 00:23:01,360
so that is the downside of it

609
00:23:01,360 --> 00:23:04,159
so i use this in the uh actually ta 505

610
00:23:04,159 --> 00:23:06,880
exercise and ta505 exercise is quite

611
00:23:06,880 --> 00:23:08,799
realistic especially

612
00:23:08,799 --> 00:23:10,640
if we compare with the latest campaigns

613
00:23:10,640 --> 00:23:12,159
for example solargate and other

614
00:23:12,159 --> 00:23:14,080
campaigns of new value

615
00:23:14,080 --> 00:23:16,559
we simply prepared an excel file excel

616
00:23:16,559 --> 00:23:19,120
file is using excel for macro and that

617
00:23:19,120 --> 00:23:22,080
is running on excel 2019

618
00:23:22,080 --> 00:23:24,640
and it simply uses a process injection

619
00:23:24,640 --> 00:23:27,679
for to run our patek dropper it uses a

620
00:23:27,679 --> 00:23:30,240
excellent donut to generate this type of

621
00:23:30,240 --> 00:23:32,320
activities

622
00:23:32,320 --> 00:23:35,280
so excellent donut helps us to generate

623
00:23:35,280 --> 00:23:37,039
a certain excel form macro that we

624
00:23:37,039 --> 00:23:39,440
integrate to an excel template we found

625
00:23:39,440 --> 00:23:41,240
on internet and

626
00:23:41,240 --> 00:23:44,799
excellente.net is utilizing donut for us

627
00:23:44,799 --> 00:23:47,039
and it is compiling a csharp file we

628
00:23:47,039 --> 00:23:49,200
developed so existing tools i'm not

629
00:23:49,200 --> 00:23:51,200
generating any of the data here i'm not

630
00:23:51,200 --> 00:23:52,960
saying that i use the magical technique

631
00:23:52,960 --> 00:23:56,640
that can utilize uh this excel file in a

632
00:23:56,640 --> 00:23:58,799
certain way to run my code no i use

633
00:23:58,799 --> 00:24:00,799
donut i use excellent internet i use

634
00:24:00,799 --> 00:24:03,200
excel so that is the good part the

635
00:24:03,200 --> 00:24:05,520
custom part is patek dropper patek

636
00:24:05,520 --> 00:24:07,360
dropper is also simple though it

637
00:24:07,360 --> 00:24:09,440
actually gets the environment and it

638
00:24:09,440 --> 00:24:11,279
says that okay if it is my environment

639
00:24:11,279 --> 00:24:14,159
let's download the mc bypass from the

640
00:24:14,159 --> 00:24:15,360
remote

641
00:24:15,360 --> 00:24:17,200
so you have this type of deployment

642
00:24:17,200 --> 00:24:19,600
traffic so that is the actually uh

643
00:24:19,600 --> 00:24:21,440
second stage because stage zero is the

644
00:24:21,440 --> 00:24:23,279
excel file stage one is the dropper

645
00:24:23,279 --> 00:24:25,440
itself and it gets the stage two it

646
00:24:25,440 --> 00:24:27,760
disables mc using empty scan buffer

647
00:24:27,760 --> 00:24:28,799
patch

648
00:24:28,799 --> 00:24:30,559
it is coming from also daniel dagon

649
00:24:30,559 --> 00:24:33,679
rasta mouse so it is a well-known patch

650
00:24:33,679 --> 00:24:36,240
i only tuned this up to still make it

651
00:24:36,240 --> 00:24:38,080
valid for the current windows defender

652
00:24:38,080 --> 00:24:40,159
you can see that minor adjustment in the

653
00:24:40,159 --> 00:24:42,880
document as well after that http

654
00:24:42,880 --> 00:24:44,640
download and other http download for the

655
00:24:44,640 --> 00:24:46,720
patek itself which is implant which is

656
00:24:46,720 --> 00:24:48,799
the actual model where we will run all

657
00:24:48,799 --> 00:24:51,440
this exercise and then this malware

658
00:24:51,440 --> 00:24:53,760
connects back to rc2 using a web circuit

659
00:24:53,760 --> 00:24:56,720
so it generates different layers for you

660
00:24:56,720 --> 00:24:58,320
if you are a purple teamer and if you

661
00:24:58,320 --> 00:25:00,400
are looking for indicators you can plant

662
00:25:00,400 --> 00:25:02,159
flags to different stages and you can

663
00:25:02,159 --> 00:25:04,320
say that dear defense people did you see

664
00:25:04,320 --> 00:25:07,760
this how it works and etc so it helps to

665
00:25:07,760 --> 00:25:09,760
everyone

666
00:25:09,760 --> 00:25:11,840
so you have multiple options here for

667
00:25:11,840 --> 00:25:15,440
the http download malware retrieval or

668
00:25:15,440 --> 00:25:17,679
you can use web circuit as interactive

669
00:25:17,679 --> 00:25:20,080
activities however when we deploy this

670
00:25:20,080 --> 00:25:21,840
the things change because when we deploy

671
00:25:21,840 --> 00:25:24,960
this we use actual activities on this

672
00:25:24,960 --> 00:25:28,720
implant so this implant actually forks

673
00:25:28,720 --> 00:25:31,120
itself on the same host

674
00:25:31,120 --> 00:25:33,039
and it actually listens to this and we

675
00:25:33,039 --> 00:25:35,200
name piles and tcp connections i

676
00:25:35,200 --> 00:25:36,880
understand that that is the same

677
00:25:36,880 --> 00:25:38,640
endpoint still but there are network

678
00:25:38,640 --> 00:25:40,880
activities for you if you don't actually

679
00:25:40,880 --> 00:25:43,039
monitor this that is the kind of

680
00:25:43,039 --> 00:25:44,799
challenge

681
00:25:44,799 --> 00:25:47,679
when with employee implant we will have

682
00:25:47,679 --> 00:25:49,679
a different types of a different type of

683
00:25:49,679 --> 00:25:51,039
connection because we will have web

684
00:25:51,039 --> 00:25:53,200
circuit but this time the implant will

685
00:25:53,200 --> 00:25:55,520
be connecting to the internals so simply

686
00:25:55,520 --> 00:25:58,159
we will actually fork the implant

687
00:25:58,159 --> 00:26:00,080
to generate different implants on the

688
00:26:00,080 --> 00:26:01,200
same host

689
00:26:01,200 --> 00:26:04,720
generating smb name pumps or tcp or udp

690
00:26:04,720 --> 00:26:06,799
connections inside the same host they

691
00:26:06,799 --> 00:26:08,240
are called network activities and

692
00:26:08,240 --> 00:26:10,480
malware communications again

693
00:26:10,480 --> 00:26:12,240
on the same endpoint

694
00:26:12,240 --> 00:26:14,320
and you may have a different visibility

695
00:26:14,320 --> 00:26:16,720
there so that is your way to understand

696
00:26:16,720 --> 00:26:17,919
how it works

697
00:26:17,919 --> 00:26:19,840
another one is we will compromise the

698
00:26:19,840 --> 00:26:22,559
servers so in this case it generates you

699
00:26:22,559 --> 00:26:24,559
different types of activities you can

700
00:26:24,559 --> 00:26:26,559
use actually scheduled tasks using the

701
00:26:26,559 --> 00:26:28,320
command console you can use any other

702
00:26:28,320 --> 00:26:30,000
command tools such as powershell inbox

703
00:26:30,000 --> 00:26:33,120
and etc i use wmi in this case because

704
00:26:33,120 --> 00:26:35,919
wmi is slightly subtle actually it was

705
00:26:35,919 --> 00:26:38,480
slightly subtle last year these years

706
00:26:38,480 --> 00:26:40,720
actually this year everybody is using

707
00:26:40,720 --> 00:26:43,520
wmi for everything so simply

708
00:26:43,520 --> 00:26:45,840
you have some remote compromise options

709
00:26:45,840 --> 00:26:47,440
for the lateral moment when you

710
00:26:47,440 --> 00:26:49,520
compromise using the known credentials

711
00:26:49,520 --> 00:26:52,400
you may have an option to actually

712
00:26:52,400 --> 00:26:55,440
deploy your implant there using similar

713
00:26:55,440 --> 00:26:58,080
similar protocols such as smb name pipe

714
00:26:58,080 --> 00:27:02,080
through the smbdc dcr pc also you can

715
00:27:02,080 --> 00:27:04,080
deploy your tcp and you can deploy your

716
00:27:04,080 --> 00:27:08,000
udp moreover i actually forked this

717
00:27:08,000 --> 00:27:10,960
and i deployed another type of implant

718
00:27:10,960 --> 00:27:13,279
which is called metal pattern

719
00:27:13,279 --> 00:27:15,360
methyl battery part of metasploit

720
00:27:15,360 --> 00:27:18,399
framework and methylperitone is useful

721
00:27:18,399 --> 00:27:21,360
uh in this case because ta-505 was using

722
00:27:21,360 --> 00:27:22,559
tiny mat

723
00:27:22,559 --> 00:27:24,320
to actually deploy metal pattern and

724
00:27:24,320 --> 00:27:26,480
sometimes utilizing metasploit through

725
00:27:26,480 --> 00:27:30,000
the socks proxy it is so noisy

726
00:27:30,000 --> 00:27:32,399
it is generating a lot of activities for

727
00:27:32,399 --> 00:27:34,720
you such as discovery activities

728
00:27:34,720 --> 00:27:36,320
scanning activities and the other

729
00:27:36,320 --> 00:27:38,399
content there so that's the kind of

730
00:27:38,399 --> 00:27:40,159
challenge for everyone

731
00:27:40,159 --> 00:27:43,120
but the thing is i have actually uh

732
00:27:43,120 --> 00:27:45,279
supplied some comments for you and i

733
00:27:45,279 --> 00:27:47,600
have also some certain systems behind of

734
00:27:47,600 --> 00:27:50,080
it because they are supplied as also a

735
00:27:50,080 --> 00:27:52,000
vulnerable windows server or a

736
00:27:52,000 --> 00:27:54,880
vulnerable linux server so you have some

737
00:27:54,880 --> 00:27:56,320
options

738
00:27:56,320 --> 00:27:58,880
so you see the communications here and

739
00:27:58,880 --> 00:28:00,240
different types of communications

740
00:28:00,240 --> 00:28:02,399
because my therapeutic is even using a

741
00:28:02,399 --> 00:28:05,120
different types of http https connection

742
00:28:05,120 --> 00:28:06,880
you see the socks proxy and you have

743
00:28:06,880 --> 00:28:09,679
remote deployment here

744
00:28:09,679 --> 00:28:10,880
so

745
00:28:10,880 --> 00:28:12,799
in this case

746
00:28:12,799 --> 00:28:14,960
we see different types of connections

747
00:28:14,960 --> 00:28:16,559
with different types of telemetry and

748
00:28:16,559 --> 00:28:18,720
indicators of compromise we can deploy

749
00:28:18,720 --> 00:28:21,039
our tools everywhere

750
00:28:21,039 --> 00:28:22,159
however

751
00:28:22,159 --> 00:28:24,399
this is not always easy so for the

752
00:28:24,399 --> 00:28:26,159
defense perspective we need to make it a

753
00:28:26,159 --> 00:28:28,559
scenario i also prepared another

754
00:28:28,559 --> 00:28:30,799
scenario video you can find it on my

755
00:28:30,799 --> 00:28:32,320
youtube channel as well through this

756
00:28:32,320 --> 00:28:36,240
link so simply we work on a a user which

757
00:28:36,240 --> 00:28:39,039
is padme on mandalore which is a an add

758
00:28:39,039 --> 00:28:42,000
point and we actually allow a padme to

759
00:28:42,000 --> 00:28:43,919
run the malware the implant which is

760
00:28:43,919 --> 00:28:46,720
pataxiatin a patek malware in this case

761
00:28:46,720 --> 00:28:49,520
it connects back to the pataxia2 service

762
00:28:49,520 --> 00:28:52,159
and then we try to actually compromise

763
00:28:52,159 --> 00:28:53,919
this

764
00:28:53,919 --> 00:28:55,679
actually compromise the other servers

765
00:28:55,679 --> 00:28:57,039
this network

766
00:28:57,039 --> 00:28:58,960
in this case we don't know how it works

767
00:28:58,960 --> 00:29:01,520
so we try to compromise them there one

768
00:29:01,520 --> 00:29:04,559
by one such as coruscant or we try to

769
00:29:04,559 --> 00:29:07,120
compromise geonosis and after that maybe

770
00:29:07,120 --> 00:29:09,840
we can compromise also another genesis

771
00:29:09,840 --> 00:29:12,720
implant inside as well and of course

772
00:29:12,720 --> 00:29:14,640
this network can be compromised in

773
00:29:14,640 --> 00:29:16,559
another way and for example never can be

774
00:29:16,559 --> 00:29:19,600
compromised so this type of scenario is

775
00:29:19,600 --> 00:29:21,760
already demonstrated it takes more than

776
00:29:21,760 --> 00:29:23,520
an hour unfortunately

777
00:29:23,520 --> 00:29:26,080
i can't fit in exactly in this talk

778
00:29:26,080 --> 00:29:28,159
please watch this video and try to

779
00:29:28,159 --> 00:29:29,919
understand how it works

780
00:29:29,919 --> 00:29:32,480
my simple summary here is as you see in

781
00:29:32,480 --> 00:29:36,000
the map we simply use padme as an

782
00:29:36,000 --> 00:29:38,240
initial compromise connect back then

783
00:29:38,240 --> 00:29:40,799
padma connects to the correspond using

784
00:29:40,799 --> 00:29:44,240
the assembly name pipe and a wmi code

785
00:29:44,240 --> 00:29:45,440
deployment

786
00:29:45,440 --> 00:29:46,799
using the well-known credentials

787
00:29:46,799 --> 00:29:48,480
extracted from padme

788
00:29:48,480 --> 00:29:50,799
also quick actually connects back to the

789
00:29:50,799 --> 00:29:53,760
generosity using another tcp connection

790
00:29:53,760 --> 00:29:56,559
so another implant impact link is there

791
00:29:56,559 --> 00:29:57,440
and

792
00:29:57,440 --> 00:29:59,600
in genesis we fork another implant there

793
00:29:59,600 --> 00:30:01,840
as well because we may perform some

794
00:30:01,840 --> 00:30:04,799
advanced activities

795
00:30:04,799 --> 00:30:05,840
sorry

796
00:30:05,840 --> 00:30:07,840
advanced activities and those activities

797
00:30:07,840 --> 00:30:10,240
need some implant connections

798
00:30:10,240 --> 00:30:12,080
so that is highly important for us we

799
00:30:12,080 --> 00:30:13,840
need to understand that part

800
00:30:13,840 --> 00:30:15,120
that's why we

801
00:30:15,120 --> 00:30:16,880
actually sacrifice that implant whenever

802
00:30:16,880 --> 00:30:19,279
that implant goes we are away

803
00:30:19,279 --> 00:30:21,919
and we are fine because we have another

804
00:30:21,919 --> 00:30:23,679
implant running on the same system we

805
00:30:23,679 --> 00:30:25,520
don't want to link them to our original

806
00:30:25,520 --> 00:30:28,159
implant because we don't want to lose uh

807
00:30:28,159 --> 00:30:30,000
things and connections we don't want to

808
00:30:30,000 --> 00:30:33,279
use additional traffic here so we use a

809
00:30:33,279 --> 00:30:36,080
sambi name pipe in the same network and

810
00:30:36,080 --> 00:30:40,080
same host loopback interface

811
00:30:41,200 --> 00:30:43,520
i apologize for that

812
00:30:43,520 --> 00:30:44,960
and naboo

813
00:30:44,960 --> 00:30:47,520
naboo is also another system and this

814
00:30:47,520 --> 00:30:49,520
time we use udp there

815
00:30:49,520 --> 00:30:50,880
i demonstrate the different types of

816
00:30:50,880 --> 00:30:53,039
connections here somebody named pipe tcp

817
00:30:53,039 --> 00:30:54,399
and udp

818
00:30:54,399 --> 00:30:56,480
the reason is actually

819
00:30:56,480 --> 00:30:59,440
you know that the networks can actually

820
00:30:59,440 --> 00:31:01,919
there's be separated yeah some certain

821
00:31:01,919 --> 00:31:04,080
protocols will be allowed sometimes only

822
00:31:04,080 --> 00:31:05,919
windows protocols sometimes udp

823
00:31:05,919 --> 00:31:08,399
sometimes dns so we can use different

824
00:31:08,399 --> 00:31:10,480
types of protocols to generate these

825
00:31:10,480 --> 00:31:12,399
iocs

826
00:31:12,399 --> 00:31:13,919
another type of

827
00:31:13,919 --> 00:31:16,720
challenge here is actually

828
00:31:16,720 --> 00:31:19,279
the network isolations but we need to

829
00:31:19,279 --> 00:31:21,679
have scenario right

830
00:31:21,679 --> 00:31:23,760
but it doesn't work exactly like that

831
00:31:23,760 --> 00:31:25,039
all the time

832
00:31:25,039 --> 00:31:26,720
as you see in the demo

833
00:31:26,720 --> 00:31:28,960
it takes more than an hour one hour

834
00:31:28,960 --> 00:31:31,279
fifteen minutes or so even for a quick

835
00:31:31,279 --> 00:31:33,760
demo of multiple compromise

836
00:31:33,760 --> 00:31:35,120
planning this

837
00:31:35,120 --> 00:31:37,039
automating that

838
00:31:37,039 --> 00:31:39,120
asking consent or

839
00:31:39,120 --> 00:31:41,279
maybe permissions to compromise those

840
00:31:41,279 --> 00:31:42,480
servers

841
00:31:42,480 --> 00:31:44,320
organizing the software

842
00:31:44,320 --> 00:31:46,159
making sure that it runs under these

843
00:31:46,159 --> 00:31:48,240
conditions organizing the red team or

844
00:31:48,240 --> 00:31:51,200
blue team it is so time consuming

845
00:31:51,200 --> 00:31:53,600
that is one of the challenges the second

846
00:31:53,600 --> 00:31:56,240
thing is we don't exactly know how it

847
00:31:56,240 --> 00:31:57,519
works

848
00:31:57,519 --> 00:31:59,679
because we are purple team all right we

849
00:31:59,679 --> 00:32:02,799
try to simulate a certain trade actor

850
00:32:02,799 --> 00:32:04,799
but the challenge here is we don't know

851
00:32:04,799 --> 00:32:06,399
exactly what is the motivation of the

852
00:32:06,399 --> 00:32:08,480
trade actor in that targeted environment

853
00:32:08,480 --> 00:32:09,200
so

854
00:32:09,200 --> 00:32:11,360
we will be tr we will be trade actors

855
00:32:11,360 --> 00:32:13,679
specific as much as possible but we

856
00:32:13,679 --> 00:32:15,840
don't have their actually intents and

857
00:32:15,840 --> 00:32:18,559
objectives in our mind

858
00:32:18,559 --> 00:32:20,960
evasion is a priority for the real life

859
00:32:20,960 --> 00:32:23,519
exercises in this exercise yes it is as

860
00:32:23,519 --> 00:32:24,399
well

861
00:32:24,399 --> 00:32:26,799
also lack of communications

862
00:32:26,799 --> 00:32:28,799
that always happens even though we are

863
00:32:28,799 --> 00:32:30,640
in the same room even we discuss

864
00:32:30,640 --> 00:32:33,360
everything even we give the samples

865
00:32:33,360 --> 00:32:35,200
we shouldn't expect the blue teamers to

866
00:32:35,200 --> 00:32:37,200
understand everything happening in that

867
00:32:37,200 --> 00:32:38,640
exercise

868
00:32:38,640 --> 00:32:40,640
because their mindset is different they

869
00:32:40,640 --> 00:32:42,960
try to understand the attack vector and

870
00:32:42,960 --> 00:32:45,440
how to detect them on the other hand for

871
00:32:45,440 --> 00:32:48,000
the red tumor perspective we will try to

872
00:32:48,000 --> 00:32:49,440
understand how we can go to the

873
00:32:49,440 --> 00:32:51,200
objectives directly so these type of

874
00:32:51,200 --> 00:32:54,080
things are slightly challenged in this

875
00:32:54,080 --> 00:32:56,480
exercise and it is time consuming

876
00:32:56,480 --> 00:32:58,159
also it is harder to run because

877
00:32:58,159 --> 00:32:59,919
whenever you need to repeat this

878
00:32:59,919 --> 00:33:02,799
exercise you will be in trouble

879
00:33:02,799 --> 00:33:05,600
because the deployment will change and

880
00:33:05,600 --> 00:33:07,039
the environment will change and you need

881
00:33:07,039 --> 00:33:08,880
to repeat this exercise

882
00:33:08,880 --> 00:33:11,039
but exercise takes time

883
00:33:11,039 --> 00:33:13,600
even even though you automate this you

884
00:33:13,600 --> 00:33:15,200
need to organize maybe five different

885
00:33:15,200 --> 00:33:16,640
systems for it

886
00:33:16,640 --> 00:33:19,120
so it is not always easy

887
00:33:19,120 --> 00:33:22,240
moreover it is not always easy to uh

888
00:33:22,240 --> 00:33:24,399
take let's say five or six systems from

889
00:33:24,399 --> 00:33:26,880
the production especially

890
00:33:26,880 --> 00:33:30,000
certain locations you always see or you

891
00:33:30,000 --> 00:33:31,919
always uh no

892
00:33:31,919 --> 00:33:33,919
that's not possible

893
00:33:33,919 --> 00:33:36,080
and what we see here is generally the

894
00:33:36,080 --> 00:33:38,480
organizations give you those systems on

895
00:33:38,480 --> 00:33:40,000
test networks

896
00:33:40,000 --> 00:33:43,200
or they designate one or two servers so

897
00:33:43,200 --> 00:33:44,880
as a blue tumor

898
00:33:44,880 --> 00:33:46,399
you know that you monitor those

899
00:33:46,399 --> 00:33:48,320
endpoints and servers what if this

900
00:33:48,320 --> 00:33:50,320
happens in your production deployment in

901
00:33:50,320 --> 00:33:51,360
cloud

902
00:33:51,360 --> 00:33:52,720
that's a question

903
00:33:52,720 --> 00:33:55,200
but there's no certain answer here

904
00:33:55,200 --> 00:33:57,600
because you may not be able to deploy a

905
00:33:57,600 --> 00:34:00,480
tool there you may not be able to deploy

906
00:34:00,480 --> 00:34:02,880
a certain monitor software there you

907
00:34:02,880 --> 00:34:05,840
need to send something harmless and it

908
00:34:05,840 --> 00:34:07,840
will be easier to get the consent and

909
00:34:07,840 --> 00:34:10,320
permissions or uh actually service

910
00:34:10,320 --> 00:34:11,280
changes

911
00:34:11,280 --> 00:34:14,000
there so these type of things are uh

912
00:34:14,000 --> 00:34:16,960
challenges of the purple team exercises

913
00:34:16,960 --> 00:34:18,879
one other thing is we always assume that

914
00:34:18,879 --> 00:34:21,440
purple team exercise tools are available

915
00:34:21,440 --> 00:34:24,239
to blue team that's not true even though

916
00:34:24,239 --> 00:34:26,800
most of the tools are open source

917
00:34:26,800 --> 00:34:29,040
we shouldn't assume that the blue team

918
00:34:29,040 --> 00:34:32,159
is always aware of those tools and run

919
00:34:32,159 --> 00:34:32,839
them

920
00:34:32,839 --> 00:34:34,879
accordingly because some of the tools

921
00:34:34,879 --> 00:34:36,399
are not available such as some

922
00:34:36,399 --> 00:34:38,399
commercial cities including cobalt track

923
00:34:38,399 --> 00:34:40,320
but there are also some other

924
00:34:40,320 --> 00:34:42,960
subtle c2s in commercial and closed

925
00:34:42,960 --> 00:34:45,280
source as well and we don't have access

926
00:34:45,280 --> 00:34:47,599
to and bluetumors won't have access to

927
00:34:47,599 --> 00:34:49,440
either so we need to replicate them

928
00:34:49,440 --> 00:34:51,760
using open source tools we shouldn't

929
00:34:51,760 --> 00:34:53,918
expect the blue teamers to know all the

930
00:34:53,918 --> 00:34:57,520
c2 types covenant mythic or patak

931
00:34:57,520 --> 00:35:00,880
whatever weird city appears in the wild

932
00:35:00,880 --> 00:35:03,040
because they are used

933
00:35:03,040 --> 00:35:05,359
by trade actors but this doesn't mean

934
00:35:05,359 --> 00:35:07,520
that blue teamers should know everything

935
00:35:07,520 --> 00:35:09,440
happening in those cities

936
00:35:09,440 --> 00:35:10,720
because they have different concerns

937
00:35:10,720 --> 00:35:12,400
such as data analytics and directions

938
00:35:12,400 --> 00:35:13,760
right

939
00:35:13,760 --> 00:35:14,560
so

940
00:35:14,560 --> 00:35:16,720
we have another approach for this

941
00:35:16,720 --> 00:35:19,280
automated traffic generation

942
00:35:19,280 --> 00:35:21,119
automated traffic generation will help

943
00:35:21,119 --> 00:35:21,920
you

944
00:35:21,920 --> 00:35:24,560
to simulate the same traffic or similar

945
00:35:24,560 --> 00:35:25,760
traffic

946
00:35:25,760 --> 00:35:27,680
using different protocols

947
00:35:27,680 --> 00:35:29,839
in distributed networks without the

948
00:35:29,839 --> 00:35:32,079
hostile intention

949
00:35:32,079 --> 00:35:33,040
none

950
00:35:33,040 --> 00:35:35,440
so simply you can just say deploy an

951
00:35:35,440 --> 00:35:37,359
implant but implant will be an open

952
00:35:37,359 --> 00:35:40,320
source maybe hundreds of lines only

953
00:35:40,320 --> 00:35:43,200
and that's it it will connect back to is

954
00:35:43,200 --> 00:35:46,000
a certain c2 or it will just download a

955
00:35:46,000 --> 00:35:48,560
file as a config and it will run

956
00:35:48,560 --> 00:35:50,720
those communications it will be a

957
00:35:50,720 --> 00:35:53,280
beginning ratio for example every five

958
00:35:53,280 --> 00:35:55,520
seconds or five minutes it's up to you

959
00:35:55,520 --> 00:35:57,280
there will be some intervals and

960
00:35:57,280 --> 00:35:59,839
randomization there to provide you a

961
00:35:59,839 --> 00:36:00,640
good

962
00:36:00,640 --> 00:36:03,599
median or a good coverage for the

963
00:36:03,599 --> 00:36:06,240
beaconing ratios so you need to perform

964
00:36:06,240 --> 00:36:09,599
this on tcp web circuit udp

965
00:36:09,599 --> 00:36:12,000
normal http https connections as well

966
00:36:12,000 --> 00:36:14,720
you need to support c2 profiles so all

967
00:36:14,720 --> 00:36:17,359
these answers actually are provided by

968
00:36:17,359 --> 00:36:19,440
one single tool that i will refer to you

969
00:36:19,440 --> 00:36:22,400
shortly um so what we do here is

970
00:36:22,400 --> 00:36:24,000
actually finding a tradactor

971
00:36:24,000 --> 00:36:25,599
intelligence report again just like the

972
00:36:25,599 --> 00:36:27,680
purple team exercises we prepare a

973
00:36:27,680 --> 00:36:29,920
scenario this time and scenario is based

974
00:36:29,920 --> 00:36:32,240
on only communications not indicators of

975
00:36:32,240 --> 00:36:34,640
compromise on the end point and we will

976
00:36:34,640 --> 00:36:36,880
build some c2 profiles for it and

977
00:36:36,880 --> 00:36:38,800
observe the defense

978
00:36:38,800 --> 00:36:41,680
behaviors and telemetry and data sources

979
00:36:41,680 --> 00:36:43,760
then we will go to the first step again

980
00:36:43,760 --> 00:36:45,760
and we will use another one it is so

981
00:36:45,760 --> 00:36:49,119
easy easy to deploy and uh easy to get

982
00:36:49,119 --> 00:36:51,599
approvals and the generation

983
00:36:51,599 --> 00:36:55,440
would be so so so easy

984
00:36:55,440 --> 00:36:58,000
however the networks are not always easy

985
00:36:58,000 --> 00:37:00,560
as you see in this diagram we may have

986
00:37:00,560 --> 00:37:02,240
working from home environment we may

987
00:37:02,240 --> 00:37:04,000
have cloud environment we may have

988
00:37:04,000 --> 00:37:05,760
remote deployments we may have internal

989
00:37:05,760 --> 00:37:07,920
network moreover virtualizations and

990
00:37:07,920 --> 00:37:10,240
different types of hypervisors will be

991
00:37:10,240 --> 00:37:12,400
deployed remote or local

992
00:37:12,400 --> 00:37:14,240
so there are different types of networks

993
00:37:14,240 --> 00:37:16,079
here you can't compromise or you can't

994
00:37:16,079 --> 00:37:18,000
allow a third party to compromise all

995
00:37:18,000 --> 00:37:18,880
right

996
00:37:18,880 --> 00:37:20,960
but you need to defend them

997
00:37:20,960 --> 00:37:23,119
you need to provide a sort of telemetry

998
00:37:23,119 --> 00:37:25,359
there so the solution here is actually

999
00:37:25,359 --> 00:37:28,320
using something less hostile to run this

1000
00:37:28,320 --> 00:37:30,880
type of activities that is my intention

1001
00:37:30,880 --> 00:37:34,240
and how i design so through this tool we

1002
00:37:34,240 --> 00:37:36,480
may be able to cover some of those

1003
00:37:36,480 --> 00:37:39,359
traffic maybe uh all of those uh where

1004
00:37:39,359 --> 00:37:41,119
it is not sufficient you can always use

1005
00:37:41,119 --> 00:37:43,520
patak for example somebody named pipe or

1006
00:37:43,520 --> 00:37:46,800
tcp and other udp activities or internal

1007
00:37:46,800 --> 00:37:50,000
activities but tessa is slightly easier

1008
00:37:50,000 --> 00:37:52,000
to deploy and it will give you more

1009
00:37:52,000 --> 00:37:55,040
options in that case

1010
00:37:55,040 --> 00:37:56,079
so

1011
00:37:56,079 --> 00:37:58,480
i see also another thing here i have

1012
00:37:58,480 --> 00:38:00,720
provided two different research well one

1013
00:38:00,720 --> 00:38:03,200
is for ct communications in the wild and

1014
00:38:03,200 --> 00:38:04,720
their future predictions and the other

1015
00:38:04,720 --> 00:38:06,560
one is malware

1016
00:38:06,560 --> 00:38:08,800
simulations in the distributed network

1017
00:38:08,800 --> 00:38:09,599
so

1018
00:38:09,599 --> 00:38:11,599
in this case i actually worked on the

1019
00:38:11,599 --> 00:38:13,760
first paper and i try to understand how

1020
00:38:13,760 --> 00:38:16,000
this type of deployments work what i

1021
00:38:16,000 --> 00:38:18,160
observed is some of the trade actors are

1022
00:38:18,160 --> 00:38:20,480
actively actually using

1023
00:38:20,480 --> 00:38:23,040
distributed networks they don't need to

1024
00:38:23,040 --> 00:38:24,400
actually

1025
00:38:24,400 --> 00:38:26,160
reveal their hand

1026
00:38:26,160 --> 00:38:27,760
otherwise they can't

1027
00:38:27,760 --> 00:38:29,280
they can't actually run the operation

1028
00:38:29,280 --> 00:38:31,359
for a year that's not possible

1029
00:38:31,359 --> 00:38:34,000
that is how nobelium works as well

1030
00:38:34,000 --> 00:38:36,800
using a certain c2 for only

1031
00:38:36,800 --> 00:38:38,240
registration

1032
00:38:38,240 --> 00:38:41,040
and then working on a certain c2 that

1033
00:38:41,040 --> 00:38:44,079
can only deploy the second stage

1034
00:38:44,079 --> 00:38:46,240
and another type of c2 that gives you

1035
00:38:46,240 --> 00:38:48,800
interactive communications

1036
00:38:48,800 --> 00:38:50,480
so different types of protocols around

1037
00:38:50,480 --> 00:38:52,079
here dns

1038
00:38:52,079 --> 00:38:54,960
normal http and maybe http web circuit

1039
00:38:54,960 --> 00:38:57,200
or similar tools

1040
00:38:57,200 --> 00:38:59,440
we have options here but of course trade

1041
00:38:59,440 --> 00:39:01,280
actors have options as well

1042
00:39:01,280 --> 00:39:03,920
what i observe to the trade actors is

1043
00:39:03,920 --> 00:39:07,119
they try to identify the target first

1044
00:39:07,119 --> 00:39:09,760
that is most subtle communication

1045
00:39:09,760 --> 00:39:11,680
they they may use different types of

1046
00:39:11,680 --> 00:39:15,040
things but first one is uh c2 second one

1047
00:39:15,040 --> 00:39:16,800
is social media

1048
00:39:16,800 --> 00:39:19,040
and third one is some communication

1049
00:39:19,040 --> 00:39:21,119
channels such as slack or

1050
00:39:21,119 --> 00:39:23,119
youtube or maybe office 365

1051
00:39:23,119 --> 00:39:25,680
communication channels they try to get

1052
00:39:25,680 --> 00:39:28,160
an indication of the target is our

1053
00:39:28,160 --> 00:39:29,440
victim

1054
00:39:29,440 --> 00:39:31,520
because we have the code execution but

1055
00:39:31,520 --> 00:39:33,200
we need to understand that that is our

1056
00:39:33,200 --> 00:39:35,680
target if not we can resell it

1057
00:39:35,680 --> 00:39:38,079
or if we are a resetter we can identify

1058
00:39:38,079 --> 00:39:39,839
the target and we can put a value around

1059
00:39:39,839 --> 00:39:41,760
it and then we sell this to different

1060
00:39:41,760 --> 00:39:42,800
parties

1061
00:39:42,800 --> 00:39:44,880
so this is how it works this is real

1062
00:39:44,880 --> 00:39:47,119
life so simply

1063
00:39:47,119 --> 00:39:48,720
we need to understand this initial

1064
00:39:48,720 --> 00:39:51,119
discovery part for example trula was

1065
00:39:51,119 --> 00:39:54,400
using actually britney spears instagram

1066
00:39:54,400 --> 00:39:57,760
posts to discover the c2 itself

1067
00:39:57,760 --> 00:39:59,920
so it was slightly subtle and you will

1068
00:39:59,920 --> 00:40:01,520
see only a malware going to the

1069
00:40:01,520 --> 00:40:03,200
instagram

1070
00:40:03,200 --> 00:40:06,319
then c2 appears elsewhere in this case

1071
00:40:06,319 --> 00:40:09,920
the malware will need deployments stages

1072
00:40:09,920 --> 00:40:12,560
do you remember ta505 had the stage

1073
00:40:12,560 --> 00:40:14,400
deployment do you remember the real life

1074
00:40:14,400 --> 00:40:17,200
no valuem deployments such as iso file

1075
00:40:17,200 --> 00:40:19,040
or other files

1076
00:40:19,040 --> 00:40:21,680
exactly that's what i meant so they have

1077
00:40:21,680 --> 00:40:23,760
different servers different servers will

1078
00:40:23,760 --> 00:40:24,400
be

1079
00:40:24,400 --> 00:40:26,160
located in different positions as well

1080
00:40:26,160 --> 00:40:28,400
the implant registers itself if target

1081
00:40:28,400 --> 00:40:29,520
is correct

1082
00:40:29,520 --> 00:40:31,520
and then actually it asks that do i need

1083
00:40:31,520 --> 00:40:33,440
to load a feature

1084
00:40:33,440 --> 00:40:34,960
for example do you need process

1085
00:40:34,960 --> 00:40:36,560
injection do you need situational

1086
00:40:36,560 --> 00:40:37,760
awareness

1087
00:40:37,760 --> 00:40:39,920
do you need for example a remote

1088
00:40:39,920 --> 00:40:41,440
communications or lateral movement

1089
00:40:41,440 --> 00:40:42,880
features

1090
00:40:42,880 --> 00:40:46,240
if so i will go another website

1091
00:40:46,240 --> 00:40:48,560
so we are not again placing everything

1092
00:40:48,560 --> 00:40:50,079
in the same bucket

1093
00:40:50,079 --> 00:40:51,760
we go to another deployment for example

1094
00:40:51,760 --> 00:40:54,319
a kind of image website all of those are

1095
00:40:54,319 --> 00:40:58,400
jpeg or png images or job posting okay

1096
00:40:58,400 --> 00:41:01,040
they are there as implant features so

1097
00:41:01,040 --> 00:41:04,240
your implant downloads this

1098
00:41:04,240 --> 00:41:07,599
and loads in memory and extend it

1099
00:41:07,599 --> 00:41:11,680
this part will be actually uh

1100
00:41:11,680 --> 00:41:13,680
actually this part will be an exercise

1101
00:41:13,680 --> 00:41:17,200
topic for me and during my um tracecraft

1102
00:41:17,200 --> 00:41:19,359
development workshop in this hack in the

1103
00:41:19,359 --> 00:41:22,160
box singapore i will demonstrate this

1104
00:41:22,160 --> 00:41:22,960
part

1105
00:41:22,960 --> 00:41:25,280
with you develop a malware that can

1106
00:41:25,280 --> 00:41:27,680
extend and grow in memory

1107
00:41:27,680 --> 00:41:30,079
using c sharp features so simply we

1108
00:41:30,079 --> 00:41:31,440
don't need to deploy everything in the

1109
00:41:31,440 --> 00:41:33,119
first place

1110
00:41:33,119 --> 00:41:35,440
we don't need to push everything again

1111
00:41:35,440 --> 00:41:37,920
and again for http or each command

1112
00:41:37,920 --> 00:41:40,160
instead we grow in memory

1113
00:41:40,160 --> 00:41:41,839
new features for example process

1114
00:41:41,839 --> 00:41:43,520
injection capabilities evasion

1115
00:41:43,520 --> 00:41:45,760
capabilities or some other capabilities

1116
00:41:45,760 --> 00:41:48,720
so i will develop this live as well

1117
00:41:48,720 --> 00:41:51,359
let's go back to deployments so we

1118
00:41:51,359 --> 00:41:53,599
actually deployed different stages to

1119
00:41:53,599 --> 00:41:56,560
this malware so we grow in memory and

1120
00:41:56,560 --> 00:41:58,640
malware is aware of that different

1121
00:41:58,640 --> 00:42:01,520
types of connections are there

1122
00:42:01,520 --> 00:42:02,960
but we always need

1123
00:42:02,960 --> 00:42:04,319
interaction

1124
00:42:04,319 --> 00:42:07,040
interaction must be in real time as well

1125
00:42:07,040 --> 00:42:08,880
but it is always directed

1126
00:42:08,880 --> 00:42:11,359
because the interaction means we have

1127
00:42:11,359 --> 00:42:14,720
a beacon going on a certain ratio

1128
00:42:14,720 --> 00:42:17,599
certain beaconing ratio certain interval

1129
00:42:17,599 --> 00:42:19,599
so we need to understand

1130
00:42:19,599 --> 00:42:22,400
how we can make this realistic and

1131
00:42:22,400 --> 00:42:25,200
blend into the network communications

1132
00:42:25,200 --> 00:42:29,119
the answer is webrtc or web circuit or

1133
00:42:29,119 --> 00:42:32,240
similar rate real-time activities http 2

1134
00:42:32,240 --> 00:42:34,720
or http 3 or quick protocols

1135
00:42:34,720 --> 00:42:37,680
so those protocols are real time already

1136
00:42:37,680 --> 00:42:38,560
so

1137
00:42:38,560 --> 00:42:40,079
it is normal

1138
00:42:40,079 --> 00:42:42,480
we don't need to see a kind of http web

1139
00:42:42,480 --> 00:42:43,440
page

1140
00:42:43,440 --> 00:42:46,240
recursively getting the content or

1141
00:42:46,240 --> 00:42:48,160
we don't need a kind of certain website

1142
00:42:48,160 --> 00:42:50,160
always uh checking for every five

1143
00:42:50,160 --> 00:42:51,680
minutes

1144
00:42:51,680 --> 00:42:53,440
we can't do that always

1145
00:42:53,440 --> 00:42:54,960
that's why three actors don't do that

1146
00:42:54,960 --> 00:42:57,760
either but we need also real life uh

1147
00:42:57,760 --> 00:43:00,319
speed real life traffic there as well

1148
00:43:00,319 --> 00:43:03,040
and those protocols quick

1149
00:43:03,040 --> 00:43:06,079
website webrtc that gives it to you

1150
00:43:06,079 --> 00:43:08,160
you can just tunnel it

1151
00:43:08,160 --> 00:43:10,480
and then you are good to go

1152
00:43:10,480 --> 00:43:12,720
however you can't use any of those

1153
00:43:12,720 --> 00:43:14,480
channels for data exfiltration the

1154
00:43:14,480 --> 00:43:16,720
problem there is we don't know how big

1155
00:43:16,720 --> 00:43:18,240
your data

1156
00:43:18,240 --> 00:43:20,800
you may leverage the organization's

1157
00:43:20,800 --> 00:43:22,800
capabilities already because your target

1158
00:43:22,800 --> 00:43:24,720
already has these capabilities such as

1159
00:43:24,720 --> 00:43:27,599
aws such as google such as gmail

1160
00:43:27,599 --> 00:43:30,160
so you need to develop different modules

1161
00:43:30,160 --> 00:43:32,319
that can utilize

1162
00:43:32,319 --> 00:43:35,200
data exfiltration slowly to the class

1163
00:43:35,200 --> 00:43:37,839
services already deployed in a client so

1164
00:43:37,839 --> 00:43:40,240
the client won't notice that there is

1165
00:43:40,240 --> 00:43:42,480
also an additional data going to the

1166
00:43:42,480 --> 00:43:44,319
same cloud service for a different

1167
00:43:44,319 --> 00:43:46,319
tenancy or different container which is

1168
00:43:46,319 --> 00:43:48,079
the attacker in this case

1169
00:43:48,079 --> 00:43:48,960
so

1170
00:43:48,960 --> 00:43:51,119
that is how real life works

1171
00:43:51,119 --> 00:43:52,800
different types of communications

1172
00:43:52,800 --> 00:43:55,119
different reasons and distributed co2 is

1173
00:43:55,119 --> 00:43:58,079
always it's a sort of reality

1174
00:43:58,079 --> 00:43:59,839
you can deploy similar tools like that

1175
00:43:59,839 --> 00:44:02,480
for example mythic c2 is a distributed

1176
00:44:02,480 --> 00:44:04,400
environment it can help you to do that

1177
00:44:04,400 --> 00:44:06,560
or you can develop your own implant that

1178
00:44:06,560 --> 00:44:08,640
can support this type of approach that i

1179
00:44:08,640 --> 00:44:11,119
will develop using a c-sharp in our

1180
00:44:11,119 --> 00:44:12,240
workshop

1181
00:44:12,240 --> 00:44:13,920
in real time

1182
00:44:13,920 --> 00:44:16,880
so we can see how it works for the ct

1183
00:44:16,880 --> 00:44:18,319
perspective

1184
00:44:18,319 --> 00:44:20,560
tessa malware generator

1185
00:44:20,560 --> 00:44:22,560
is actually for defense people as a

1186
00:44:22,560 --> 00:44:24,800
cyber data analytics people

1187
00:44:24,800 --> 00:44:25,520
so

1188
00:44:25,520 --> 00:44:27,119
you don't need to code anything you

1189
00:44:27,119 --> 00:44:29,520
don't need to work on uh tools you don't

1190
00:44:29,520 --> 00:44:32,319
need to actually work on all of those

1191
00:44:32,319 --> 00:44:34,319
offensive capabilities you need to focus

1192
00:44:34,319 --> 00:44:36,880
on what you want to do

1193
00:44:36,880 --> 00:44:39,280
simulating a network traffic

1194
00:44:39,280 --> 00:44:41,280
that's it

1195
00:44:41,280 --> 00:44:43,359
and you have just one single portion of

1196
00:44:43,359 --> 00:44:44,640
it

1197
00:44:44,640 --> 00:44:47,359
i know it looks like it's oversimplified

1198
00:44:47,359 --> 00:44:49,200
but it helps you a lot

1199
00:44:49,200 --> 00:44:52,000
you can create multiple services on this

1200
00:44:52,000 --> 00:44:54,000
tessat interface and you can use

1201
00:44:54,000 --> 00:44:56,000
multiple implants coming from different

1202
00:44:56,000 --> 00:44:58,400
places or the same host and that will be

1203
00:44:58,400 --> 00:45:00,880
realistic as well

1204
00:45:00,880 --> 00:45:04,400
tassat is also another language uh

1205
00:45:04,400 --> 00:45:08,079
vulcan and it means deception so

1206
00:45:08,079 --> 00:45:11,200
i try to actually provide you slightly

1207
00:45:11,200 --> 00:45:12,160
similar

1208
00:45:12,160 --> 00:45:14,400
uh data generation environment

1209
00:45:14,400 --> 00:45:16,400
but again you need to read the thread

1210
00:45:16,400 --> 00:45:18,880
intelligence reports and you need to

1211
00:45:18,880 --> 00:45:20,800
extract this data

1212
00:45:20,800 --> 00:45:23,280
so it gives you a graphical user

1213
00:45:23,280 --> 00:45:25,359
interface this time not the console

1214
00:45:25,359 --> 00:45:28,319
interface not a hacky interface it

1215
00:45:28,319 --> 00:45:31,359
supports currently http websocket with

1216
00:45:31,359 --> 00:45:36,319
https support as well and tcp udp

1217
00:45:36,319 --> 00:45:37,359
easy

1218
00:45:37,359 --> 00:45:40,160
customization is available because you

1219
00:45:40,160 --> 00:45:42,400
can easily see the menu and the menu

1220
00:45:42,400 --> 00:45:44,560
allows you to change the get post

1221
00:45:44,560 --> 00:45:48,079
request get post type or http headers or

1222
00:45:48,079 --> 00:45:50,480
user agents so you can make it realistic

1223
00:45:50,480 --> 00:45:52,560
as much as possible you can use the same

1224
00:45:52,560 --> 00:45:54,319
request you can use

1225
00:45:54,319 --> 00:45:56,240
a get request post request you can use

1226
00:45:56,240 --> 00:45:59,440
stages so it's up to you

1227
00:45:59,440 --> 00:46:01,599
service creation is based on use a

1228
00:46:01,599 --> 00:46:04,160
profile c2 profiles so you create a

1229
00:46:04,160 --> 00:46:06,079
profile and then you create a service

1230
00:46:06,079 --> 00:46:07,599
based on the profile so you don't need

1231
00:46:07,599 --> 00:46:09,680
to repeat yourself for each service you

1232
00:46:09,680 --> 00:46:11,280
can use a profile that can fork to

1233
00:46:11,280 --> 00:46:13,040
multiple services running on different

1234
00:46:13,040 --> 00:46:15,599
ports for different reasons as well so

1235
00:46:15,599 --> 00:46:17,839
that is slightly useful and implant

1236
00:46:17,839 --> 00:46:19,440
generation is so easy because it

1237
00:46:19,440 --> 00:46:21,359
generates the implant for you it gives

1238
00:46:21,359 --> 00:46:24,000
you the source so you can just use a.net

1239
00:46:24,000 --> 00:46:25,760
application to run this

1240
00:46:25,760 --> 00:46:28,720
it is that net five by the way so you

1241
00:46:28,720 --> 00:46:31,599
can use this tool anywhere that net 5

1242
00:46:31,599 --> 00:46:33,839
available the server component as well

1243
00:46:33,839 --> 00:46:35,599
as the implant component

1244
00:46:35,599 --> 00:46:38,880
scenario design steps are so simple find

1245
00:46:38,880 --> 00:46:41,200
the thread intelligence report read it

1246
00:46:41,200 --> 00:46:43,680
understand the content and then

1247
00:46:43,680 --> 00:46:46,319
replicate the kill chain phases of it

1248
00:46:46,319 --> 00:46:48,480
and then actually generate this traffic

1249
00:46:48,480 --> 00:46:51,680
using the profiles okay that is so easy

1250
00:46:51,680 --> 00:46:54,000
the interface is also easy to understand

1251
00:46:54,000 --> 00:46:55,920
because the interface is giving you

1252
00:46:55,920 --> 00:46:58,079
multiple options generating profiles

1253
00:46:58,079 --> 00:47:00,240
generating service and then during the

1254
00:47:00,240 --> 00:47:02,880
profiles you have options so not only

1255
00:47:02,880 --> 00:47:06,480
names the ports the url types uris the

1256
00:47:06,480 --> 00:47:09,280
data content or http headers or user

1257
00:47:09,280 --> 00:47:12,720
agents so you can use every portion of

1258
00:47:12,720 --> 00:47:15,520
this http request as an indicator of

1259
00:47:15,520 --> 00:47:18,319
compromise so you can use data transfer

1260
00:47:18,319 --> 00:47:20,480
in user agents or you can use data

1261
00:47:20,480 --> 00:47:23,599
transfer in the content itself so

1262
00:47:23,599 --> 00:47:26,319
it's up to you

1263
00:47:27,280 --> 00:47:30,480
that the set simulations are slightly uh

1264
00:47:30,480 --> 00:47:33,119
easy to understand but it is also so

1265
00:47:33,119 --> 00:47:35,280
customer customized so it's up to you

1266
00:47:35,280 --> 00:47:37,440
again facade can actually simulate

1267
00:47:37,440 --> 00:47:39,520
multiple traffic in this

1268
00:47:39,520 --> 00:47:41,599
sample scenario it can actually provide

1269
00:47:41,599 --> 00:47:44,079
the http serverless communications uh

1270
00:47:44,079 --> 00:47:46,240
maybe icmp it is under development by

1271
00:47:46,240 --> 00:47:49,839
the way dns as well uh https and http so

1272
00:47:49,839 --> 00:47:52,640
simply a reseller would compromise this

1273
00:47:52,640 --> 00:47:54,400
network

1274
00:47:54,400 --> 00:47:57,200
and use http a big link for it and

1275
00:47:57,200 --> 00:47:59,119
whenever uh

1276
00:47:59,119 --> 00:48:02,160
it finds another trade actor who can buy

1277
00:48:02,160 --> 00:48:04,480
it it sells this network communication

1278
00:48:04,480 --> 00:48:06,800
so you have another type of weakening to

1279
00:48:06,800 --> 00:48:09,119
another thread actor and then it changes

1280
00:48:09,119 --> 00:48:11,440
the c2 type for example web circuit and

1281
00:48:11,440 --> 00:48:13,680
it connects to your network and uses tcp

1282
00:48:13,680 --> 00:48:16,480
and udp this type of scenario could work

1283
00:48:16,480 --> 00:48:19,200
with tessat one single implant type

1284
00:48:19,200 --> 00:48:20,720
deployed one where

1285
00:48:20,720 --> 00:48:21,520
and

1286
00:48:21,520 --> 00:48:23,280
test out could be on maybe a class

1287
00:48:23,280 --> 00:48:25,760
service and it will generate this iocs

1288
00:48:25,760 --> 00:48:28,400
for you it is not hostile that means you

1289
00:48:28,400 --> 00:48:31,040
can't you can't deploy this to anywhere

1290
00:48:31,040 --> 00:48:32,960
even cloud services you don't violate

1291
00:48:32,960 --> 00:48:35,200
any ndas or something like that you have

1292
00:48:35,200 --> 00:48:37,440
no concerns because it is not a no-style

1293
00:48:37,440 --> 00:48:39,760
tool it doesn't actually drive a

1294
00:48:39,760 --> 00:48:42,000
malicious implant it simply generates

1295
00:48:42,000 --> 00:48:44,000
traffic it sees that okay i received

1296
00:48:44,000 --> 00:48:46,800
this traffic traffic is this that's it

1297
00:48:46,800 --> 00:48:49,520
so it is easy to get this type of

1298
00:48:49,520 --> 00:48:50,880
approvals

1299
00:48:50,880 --> 00:48:53,119
you can plant the flags inside the

1300
00:48:53,119 --> 00:48:55,599
communications as well you can put some

1301
00:48:55,599 --> 00:48:57,280
certain strings and you can say that

1302
00:48:57,280 --> 00:48:59,119
okay blue teamwork you identified this

1303
00:48:59,119 --> 00:49:01,839
c2 because domain is so obvious can you

1304
00:49:01,839 --> 00:49:05,119
actually see the content and the flag

1305
00:49:05,119 --> 00:49:07,520
can you give me the flag itself

1306
00:49:07,520 --> 00:49:10,160
that would actually enforce them to find

1307
00:49:10,160 --> 00:49:11,920
the actual flag and actual problems

1308
00:49:11,920 --> 00:49:14,480
there okay so ct communications lateral

1309
00:49:14,480 --> 00:49:16,559
movement data exfiltration they all may

1310
00:49:16,559 --> 00:49:17,920
have flags

1311
00:49:17,920 --> 00:49:20,960
uh i actually like tool vector here

1312
00:49:20,960 --> 00:49:22,800
because vector gives you interactive

1313
00:49:22,800 --> 00:49:24,319
communications and management

1314
00:49:24,319 --> 00:49:26,720
capabilities for this as well so

1315
00:49:26,720 --> 00:49:30,319
again it's up to you

1316
00:49:30,319 --> 00:49:33,040
every run has some consequences so

1317
00:49:33,040 --> 00:49:34,720
uplift your game

1318
00:49:34,720 --> 00:49:37,440
and try to add more layers for example

1319
00:49:37,440 --> 00:49:39,200
implement domain fronting implement

1320
00:49:39,200 --> 00:49:41,680
never protocols and i will try to do

1321
00:49:41,680 --> 00:49:44,319
that for you as well but again tessat is

1322
00:49:44,319 --> 00:49:47,119
my open source play tool i try to do

1323
00:49:47,119 --> 00:49:49,680
that in my free time whenever i find

1324
00:49:49,680 --> 00:49:51,520
some free time i add new protocols and

1325
00:49:51,520 --> 00:49:53,920
new features currently it comes with two

1326
00:49:53,920 --> 00:49:55,839
different white papers for you and this

1327
00:49:55,839 --> 00:49:57,920
tool is a proof of concept but you can

1328
00:49:57,920 --> 00:50:01,280
easily deploy your own protocols there

1329
00:50:01,280 --> 00:50:04,480
so this is a sample demo for tessa and

1330
00:50:04,480 --> 00:50:08,240
how it works so simply tasat is there as

1331
00:50:08,240 --> 00:50:09,839
an offensive tool but we need trade

1332
00:50:09,839 --> 00:50:11,920
intelligence data in this case we use

1333
00:50:11,920 --> 00:50:14,400
security bull word block by eric

1334
00:50:14,400 --> 00:50:15,520
heinrich

1335
00:50:15,520 --> 00:50:18,800
so simply in this tool we see how it

1336
00:50:18,800 --> 00:50:20,720
works

1337
00:50:20,720 --> 00:50:23,040
during this tool and during this

1338
00:50:23,040 --> 00:50:25,839
environment we understand that ice id

1339
00:50:25,839 --> 00:50:28,559
was a ransomware and this ransomware

1340
00:50:28,559 --> 00:50:31,280
generates some certain iocs

1341
00:50:31,280 --> 00:50:33,040
and this ransomware is actually

1342
00:50:33,040 --> 00:50:35,599
generating some http traffic https

1343
00:50:35,599 --> 00:50:38,319
traffic for certain reasons get a post

1344
00:50:38,319 --> 00:50:40,720
type of it

1345
00:50:40,720 --> 00:50:43,680
so simply we see this and

1346
00:50:43,680 --> 00:50:45,839
this is how it works in this demo i will

1347
00:50:45,839 --> 00:50:48,160
try to show you how a tested malware

1348
00:50:48,160 --> 00:50:50,079
generation works

1349
00:50:50,079 --> 00:50:52,079
so tessat is the tool that was the

1350
00:50:52,079 --> 00:50:54,240
interface and now we are looking for a

1351
00:50:54,240 --> 00:50:56,480
security uh thread intelligence block in

1352
00:50:56,480 --> 00:50:59,839
security bulwark and eric hambig has

1353
00:50:59,839 --> 00:51:02,559
provided some data about ice id which is

1354
00:51:02,559 --> 00:51:05,040
a malicious software ransomware actually

1355
00:51:05,040 --> 00:51:06,800
generates some different types of

1356
00:51:06,800 --> 00:51:08,640
traffic for different reasons for

1357
00:51:08,640 --> 00:51:11,359
example c2 deployment ct communications

1358
00:51:11,359 --> 00:51:13,680
so we need to understand how it works

1359
00:51:13,680 --> 00:51:16,720
right as a data analytics or blue tumor

1360
00:51:16,720 --> 00:51:18,319
we can always access your trade

1361
00:51:18,319 --> 00:51:20,559
intelligence data this is an example so

1362
00:51:20,559 --> 00:51:22,480
we see that that

1363
00:51:22,480 --> 00:51:26,079
text or that get request or post request

1364
00:51:26,079 --> 00:51:27,839
will give us some indicators of

1365
00:51:27,839 --> 00:51:30,240
compromise so we will try to generate

1366
00:51:30,240 --> 00:51:33,359
the same thing in our environment

1367
00:51:33,359 --> 00:51:35,760
that's why we used iced id and cobalt

1368
00:51:35,760 --> 00:51:37,920
strike example because aist id was using

1369
00:51:37,920 --> 00:51:39,920
cobastrac to deploy and we don't have

1370
00:51:39,920 --> 00:51:41,520
access to the cobalt track because it is

1371
00:51:41,520 --> 00:51:43,200
not always available because it's a

1372
00:51:43,200 --> 00:51:45,200
commercial application sold under

1373
00:51:45,200 --> 00:51:46,880
certain conditions

1374
00:51:46,880 --> 00:51:49,119
and in this profile we can choose our

1375
00:51:49,119 --> 00:51:50,800
profile

1376
00:51:50,800 --> 00:51:53,520
options such as ports such as http uri

1377
00:51:53,520 --> 00:51:57,119
such as the get or post request type we

1378
00:51:57,119 --> 00:51:59,359
can add headers we can remove headers

1379
00:51:59,359 --> 00:52:01,760
and we can do more and more so it's up

1380
00:52:01,760 --> 00:52:03,119
to us

1381
00:52:03,119 --> 00:52:05,680
so simply we can actually use

1382
00:52:05,680 --> 00:52:07,119
all this content

1383
00:52:07,119 --> 00:52:08,480
with some certain generation

1384
00:52:08,480 --> 00:52:11,520
capabilities so it's up to us

1385
00:52:11,520 --> 00:52:13,520
another thing is we can actually make it

1386
00:52:13,520 --> 00:52:16,160
realistic here and we can copy and past

1387
00:52:16,160 --> 00:52:17,040
or

1388
00:52:17,040 --> 00:52:18,800
we can just generate the content

1389
00:52:18,800 --> 00:52:21,280
whatever it is in this case i'm actually

1390
00:52:21,280 --> 00:52:24,079
mocking up i'm providing a content that

1391
00:52:24,079 --> 00:52:26,240
will be not the exact response because

1392
00:52:26,240 --> 00:52:28,079
we need to trade intelligence data to

1393
00:52:28,079 --> 00:52:29,119
see that

1394
00:52:29,119 --> 00:52:30,880
and the current block doesn't have

1395
00:52:30,880 --> 00:52:33,520
exactly how it works so i say that okay

1396
00:52:33,520 --> 00:52:35,440
if that uri is used i can give some

1397
00:52:35,440 --> 00:52:37,280
instructions so

1398
00:52:37,280 --> 00:52:38,640
it's done

1399
00:52:38,640 --> 00:52:41,359
another one is also uh the pulse request

1400
00:52:41,359 --> 00:52:43,200
so combo straight can use multiple

1401
00:52:43,200 --> 00:52:45,200
request types for different reasons such

1402
00:52:45,200 --> 00:52:47,839
as cobalt strike deployment the beacon

1403
00:52:47,839 --> 00:52:49,280
deployment or

1404
00:52:49,280 --> 00:52:50,240
normal

1405
00:52:50,240 --> 00:52:52,400
get request for the tasks or data

1406
00:52:52,400 --> 00:52:54,640
transfer for post or that can be also

1407
00:52:54,640 --> 00:52:57,280
get as well so it is a really important

1408
00:52:57,280 --> 00:53:00,960
for the malleable co2 profiles

1409
00:53:00,960 --> 00:53:03,520
in this environment we have all options

1410
00:53:03,520 --> 00:53:05,760
we can actually provide different get

1411
00:53:05,760 --> 00:53:08,240
requests or we can use actually

1412
00:53:08,240 --> 00:53:10,640
different types of response data so this

1413
00:53:10,640 --> 00:53:13,440
is task data processed and we are

1414
00:53:13,440 --> 00:53:14,880
actually

1415
00:53:14,880 --> 00:53:16,960
receiving an input from the implant

1416
00:53:16,960 --> 00:53:19,119
saying that yes i executed these tasks

1417
00:53:19,119 --> 00:53:21,200
this is my output and the server says

1418
00:53:21,200 --> 00:53:23,520
that success i got it

1419
00:53:23,520 --> 00:53:25,920
these are the profiles let's generate

1420
00:53:25,920 --> 00:53:28,400
some services for it the service name is

1421
00:53:28,400 --> 00:53:31,760
same again honest id and cobalt strike

1422
00:53:31,760 --> 00:53:34,480
and this time it is

1423
00:53:34,480 --> 00:53:36,480
the ports are important because that was

1424
00:53:36,480 --> 00:53:37,920
the template the initial one the

1425
00:53:37,920 --> 00:53:40,160
profiles this time we can change things

1426
00:53:40,160 --> 00:53:42,880
here and this will be the service itself

1427
00:53:42,880 --> 00:53:45,359
because you would generate the implant

1428
00:53:45,359 --> 00:53:47,760
based on service not on the profile

1429
00:53:47,760 --> 00:53:49,760
so you the profile is your template to

1430
00:53:49,760 --> 00:53:51,920
generate multiple services easily

1431
00:53:51,920 --> 00:53:54,079
without any change or with just minor

1432
00:53:54,079 --> 00:53:55,359
changes

1433
00:53:55,359 --> 00:53:57,680
but the services whatever put on the

1434
00:53:57,680 --> 00:53:58,880
services

1435
00:53:58,880 --> 00:54:01,119
will be reflected in the implant

1436
00:54:01,119 --> 00:54:04,319
so our implant will have all these there

1437
00:54:04,319 --> 00:54:06,480
are two services running here when we

1438
00:54:06,480 --> 00:54:09,440
actually click play it will start

1439
00:54:09,440 --> 00:54:10,960
running so we have two different

1440
00:54:10,960 --> 00:54:13,760
services for 8001 and 8002

1441
00:54:13,760 --> 00:54:16,160
now we need an implant for it right so

1442
00:54:16,160 --> 00:54:19,280
the implant needs to be generated

1443
00:54:19,280 --> 00:54:21,599
so implant generation is under implants

1444
00:54:21,599 --> 00:54:24,240
so i'm generating an iced id russian

1445
00:54:24,240 --> 00:54:26,160
very platformed

1446
00:54:26,160 --> 00:54:28,880
the domain tessa may not know the domain

1447
00:54:28,880 --> 00:54:30,640
so you need to give it because it may be

1448
00:54:30,640 --> 00:54:33,599
running on a cloud on an ip address or a

1449
00:54:33,599 --> 00:54:37,040
domain i use the localhost for it so it

1450
00:54:37,040 --> 00:54:39,359
will be easier for me to

1451
00:54:39,359 --> 00:54:41,839
show you and replicate but again in your

1452
00:54:41,839 --> 00:54:44,240
environment you may need to tell the

1453
00:54:44,240 --> 00:54:46,559
implant that is the domain that's that

1454
00:54:46,559 --> 00:54:48,960
running so go there and that is the port

1455
00:54:48,960 --> 00:54:52,079
as well also you can decide uh what type

1456
00:54:52,079 --> 00:54:54,240
of update interval or jitter should be

1457
00:54:54,240 --> 00:54:56,480
used by that implant

1458
00:54:56,480 --> 00:54:58,720
because it is custom because that is the

1459
00:54:58,720 --> 00:55:01,520
implant specific thing not driven by the

1460
00:55:01,520 --> 00:55:03,920
test malware generator

1461
00:55:03,920 --> 00:55:05,839
as you see this is the source code of it

1462
00:55:05,839 --> 00:55:09,119
you can download this as an implant

1463
00:55:09,119 --> 00:55:11,359
source code it's a net project what you

1464
00:55:11,359 --> 00:55:14,559
need to do is only using that net run

1465
00:55:14,559 --> 00:55:17,520
that means it will run the implant

1466
00:55:17,520 --> 00:55:20,400
that's it because it has only uh one

1467
00:55:20,400 --> 00:55:23,280
single uh program cs with some limited

1468
00:55:23,280 --> 00:55:26,000
tool unlimited capabilities i'm opening

1469
00:55:26,000 --> 00:55:28,640
the wireshark to understand that how our

1470
00:55:28,640 --> 00:55:31,599
loopback interface observes this traffic

1471
00:55:31,599 --> 00:55:33,920
i will also limit this traffic to the

1472
00:55:33,920 --> 00:55:36,480
traffic we actually try to monitor and

1473
00:55:36,480 --> 00:55:40,000
understand which was port 8001 and port

1474
00:55:40,000 --> 00:55:42,720
8002 so we will see that how this

1475
00:55:42,720 --> 00:55:45,280
traffic has been generated on this

1476
00:55:45,280 --> 00:55:47,280
network which is loopback interface for

1477
00:55:47,280 --> 00:55:49,280
now but of course you can use remote

1478
00:55:49,280 --> 00:55:50,400
deployment

1479
00:55:50,400 --> 00:55:51,119
so

1480
00:55:51,119 --> 00:55:53,200
our implant is

1481
00:55:53,200 --> 00:55:55,839
actually simply connecting now

1482
00:55:55,839 --> 00:55:58,160
and we have services already running so

1483
00:55:58,160 --> 00:55:59,920
we can use the status screen to

1484
00:55:59,920 --> 00:56:02,160
understand how it works and what's

1485
00:56:02,160 --> 00:56:04,319
happening as you see implants simply

1486
00:56:04,319 --> 00:56:06,799
shows you that this is the server's

1487
00:56:06,799 --> 00:56:09,119
server's response these are the other

1488
00:56:09,119 --> 00:56:12,880
server responses and etc but simply you

1489
00:56:12,880 --> 00:56:14,720
see the content on the implant side you

1490
00:56:14,720 --> 00:56:16,559
need to see this on the network using

1491
00:56:16,559 --> 00:56:18,640
your telemetry and data sources right

1492
00:56:18,640 --> 00:56:20,720
that's why you need to go back to the

1493
00:56:20,720 --> 00:56:22,559
wireshark to understand how it is

1494
00:56:22,559 --> 00:56:24,000
reflected

1495
00:56:24,000 --> 00:56:27,280
as you see it is here and it is used as

1496
00:56:27,280 --> 00:56:29,200
a normal traffic

1497
00:56:29,200 --> 00:56:31,440
whenever you actually follow the tcp

1498
00:56:31,440 --> 00:56:33,520
stream you will see the raw request and

1499
00:56:33,520 --> 00:56:36,160
it is easy to understand because that is

1500
00:56:36,160 --> 00:56:38,319
simply the data generated than to be

1501
00:56:38,319 --> 00:56:40,240
observed

1502
00:56:40,240 --> 00:56:42,720
so this is how it works for the set

1503
00:56:42,720 --> 00:56:45,359
malware generation the implant

1504
00:56:45,359 --> 00:56:47,760
and the server and they generate output

1505
00:56:47,760 --> 00:56:50,640
for you there is nothing malicious here

1506
00:56:50,640 --> 00:56:52,240
no code injections

1507
00:56:52,240 --> 00:56:55,040
no code execution on the remote side

1508
00:56:55,040 --> 00:56:57,760
but that netron would make you confusing

1509
00:56:57,760 --> 00:56:59,440
for example you can actually compile

1510
00:56:59,440 --> 00:57:01,680
this as an executable or you can deploy

1511
00:57:01,680 --> 00:57:04,079
this using powershell it's up to you but

1512
00:57:04,079 --> 00:57:06,559
deployment strategies must be discussed

1513
00:57:06,559 --> 00:57:08,720
because that is specific to you

1514
00:57:08,720 --> 00:57:10,480
i'm just giving the tool not the

1515
00:57:10,480 --> 00:57:12,880
deployment strategies for you but my

1516
00:57:12,880 --> 00:57:14,480
suggestion is

1517
00:57:14,480 --> 00:57:17,280
use cloud deployments use the left

1518
00:57:17,280 --> 00:57:18,880
running in front of tess at malware

1519
00:57:18,880 --> 00:57:20,880
generation because you may have

1520
00:57:20,880 --> 00:57:22,640
different options here

1521
00:57:22,640 --> 00:57:25,359
so it supports you to drive some certain

1522
00:57:25,359 --> 00:57:28,000
headers or some certain content and you

1523
00:57:28,000 --> 00:57:29,839
can always monitor the implants and

1524
00:57:29,839 --> 00:57:32,160
their connection types

1525
00:57:32,160 --> 00:57:34,079
this is how it works for the

1526
00:57:34,079 --> 00:57:36,640
test set actually so i hope

1527
00:57:36,640 --> 00:57:38,640
you like the set

1528
00:57:38,640 --> 00:57:40,720
the conclusion here is malware traffic

1529
00:57:40,720 --> 00:57:42,880
simulations are actually prepared using

1530
00:57:42,880 --> 00:57:44,720
thread intelligence data you need to

1531
00:57:44,720 --> 00:57:47,760
understand that part and that is certain

1532
00:57:47,760 --> 00:57:50,319
second thing is you actually

1533
00:57:50,319 --> 00:57:52,880
need to utilize some advanced simulation

1534
00:57:52,880 --> 00:57:55,839
packs for the collaborative exercises if

1535
00:57:55,839 --> 00:57:58,319
there is no game plan if game is not

1536
00:57:58,319 --> 00:58:00,400
ready tools are not ready

1537
00:58:00,400 --> 00:58:02,000
it is not efficient

1538
00:58:02,000 --> 00:58:04,480
another one is distributed c2 approach

1539
00:58:04,480 --> 00:58:06,559
is quite common these days

1540
00:58:06,559 --> 00:58:08,799
so pay attention to different types of

1541
00:58:08,799 --> 00:58:11,359
protocols how you can monitor them not

1542
00:58:11,359 --> 00:58:13,680
only http not only traditional domain

1543
00:58:13,680 --> 00:58:14,720
mapping

1544
00:58:14,720 --> 00:58:17,839
social media cloud services http https

1545
00:58:17,839 --> 00:58:20,480
interception try different options using

1546
00:58:20,480 --> 00:58:23,599
patak and kassad malware generation

1547
00:58:23,599 --> 00:58:25,040
actually a traffic generation can be

1548
00:58:25,040 --> 00:58:26,880
also automatically automated so it's

1549
00:58:26,880 --> 00:58:29,520
also up to you

1550
00:58:29,520 --> 00:58:32,000
these are my tools and references and i

1551
00:58:32,000 --> 00:58:34,319
will be more than happy to

1552
00:58:34,319 --> 00:58:36,640
support you in this case uh feel free to

1553
00:58:36,640 --> 00:58:39,200
reach me out but also thank you for

1554
00:58:39,200 --> 00:58:41,119
joining me today thank you hack in the

1555
00:58:41,119 --> 00:58:44,240
box singapore to actually invite me to

1556
00:58:44,240 --> 00:58:47,359
speak here again this is our discord uh

1557
00:58:47,359 --> 00:58:49,119
settings so simply you can use this

1558
00:58:49,119 --> 00:58:51,839
discord invite to actually join this

1559
00:58:51,839 --> 00:58:54,640
code and work with me on your questions

1560
00:58:54,640 --> 00:58:56,079
and your options

1561
00:58:56,079 --> 00:58:57,520
thank you for your time thank you

1562
00:58:57,520 --> 00:58:59,359
hacking the box and thank you audience

1563
00:58:59,359 --> 00:59:04,279
have a great one and see you in discord

1564
00:59:05,359 --> 00:59:07,440
you

