1
00:00:07,630 --> 00:00:12,770
good morning everyone<font color="#E5E5E5"> thank</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> for</font>

2
00:00:10,030 --> 00:00:16,460
<font color="#CCCCCC">joining that</font><font color="#E5E5E5"> talk so just now we</font>

3
00:00:12,770 --> 00:00:19,580
<font color="#E5E5E5">when and vitaliy</font><font color="#CCCCCC"> a great tool that</font><font color="#E5E5E5"> I</font>

4
00:00:16,460 --> 00:00:22,420
decided to<font color="#CCCCCC"> use I will show you some some</font>

5
00:00:19,580 --> 00:00:25,459
use cases<font color="#E5E5E5"> and hopefully</font><font color="#CCCCCC"> is going to work</font>

6
00:00:22,420 --> 00:00:28,540
<font color="#E5E5E5">so a little bit of background about</font><font color="#CCCCCC"> me</font>

7
00:00:25,460 --> 00:00:31,130
um<font color="#CCCCCC"> IT</font><font color="#E5E5E5"> security</font><font color="#CCCCCC"> specialist</font>

8
00:00:28,540 --> 00:00:34,399
InfoSec specialist before cyber became

9
00:00:31,130 --> 00:00:37,250
famous<font color="#E5E5E5"> I'm hitting the offensive team at</font>

10
00:00:34,399 --> 00:00:39,950
DBS<font color="#CCCCCC"> bank and I'm part of unparticle</font>

11
00:00:37,250 --> 00:00:43,030
equally of the computer emergency

12
00:00:39,950 --> 00:00:45,050
response team I'm passionate about

13
00:00:43,030 --> 00:00:46,840
infrastructure<font color="#E5E5E5"> in general but</font>

14
00:00:45,050 --> 00:00:49,250
particularly<font color="#E5E5E5"> about fighting cybercrime</font>

15
00:00:46,840 --> 00:00:50,989
<font color="#E5E5E5">preventing and also responding to</font>

16
00:00:49,250 --> 00:00:56,179
incident when it happens unfortunately

17
00:00:50,989 --> 00:00:58,788
<font color="#CCCCCC">and I like to analyze malwan so</font>

18
00:00:56,179 --> 00:01:01,789
<font color="#E5E5E5">cybercrime is suggest matter but</font>

19
00:00:58,789 --> 00:01:04,699
hopefully today we are going<font color="#E5E5E5"> to analyze</font>

20
00:01:01,789 --> 00:01:06,800
some in a safe manner<font color="#E5E5E5"> and nobody was</font>

21
00:01:04,699 --> 00:01:08,300
<font color="#E5E5E5">hurt in this presentation there</font><font color="#CCCCCC"> was no</font>

22
00:01:06,800 --> 00:01:15,259
real incident<font color="#CCCCCC"> for those that were</font>

23
00:01:08,300 --> 00:01:17,840
wondering so about the plot far away on

24
00:01:15,260 --> 00:01:22,070
the<font color="#CCCCCC"> internet is not</font><font color="#E5E5E5"> very far but on the</font>

25
00:01:17,840 --> 00:01:23,990
planet<font color="#E5E5E5"> it's in the middle of nowhere my</font>

26
00:01:22,070 --> 00:01:27,408
friend called me and<font color="#CCCCCC"> it's of course on a</font>

27
00:01:23,990 --> 00:01:30,140
Friday at<font color="#E5E5E5"> 5 or</font><font color="#CCCCCC"> 6</font><font color="#E5E5E5"> p.m. just before I was</font>

28
00:01:27,409 --> 00:01:34,070
closing<font color="#E5E5E5"> my laptop I</font><font color="#CCCCCC"> suddenly</font><font color="#E5E5E5"> receive a</font>

29
00:01:30,140 --> 00:01:35,899
call and my friend Patrick noticed that

30
00:01:34,070 --> 00:01:40,240
there was something a bit special about

31
00:01:35,899 --> 00:01:40,240
<font color="#E5E5E5">his computer and was asking for</font><font color="#CCCCCC"> l.e</font>

32
00:01:40,520 --> 00:01:44,509
because<font color="#E5E5E5"> it's very far away</font><font color="#CCCCCC"> it was asking</font>

33
00:01:42,890 --> 00:01:46,640
<font color="#CCCCCC">if I could travel</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> of course it was</font>

34
00:01:44,509 --> 00:01:50,329
<font color="#E5E5E5">not an option or at least not</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> a</font>

35
00:01:46,640 --> 00:01:54,439
reasonable time<font color="#CCCCCC"> oh</font><font color="#E5E5E5"> yes me if I could</font>

36
00:01:50,329 --> 00:01:57,380
troubleshoot everything by phone it's

37
00:01:54,439 --> 00:01:59,148
not not not easy trick is not not so

38
00:01:57,380 --> 00:02:02,570
simple<font color="#CCCCCC"> all you wanted</font><font color="#E5E5E5"> to call shallow</font>

39
00:01:59,149 --> 00:02:05,890
<font color="#E5E5E5">codes so I told him don't worry I'm</font>

40
00:02:02,570 --> 00:02:11,530
going<font color="#E5E5E5"> to help you let's do it together</font>

41
00:02:05,890 --> 00:02:13,940
so Vitaly just presented<font color="#E5E5E5"> that in July 19</font>

42
00:02:11,530 --> 00:02:17,750
<font color="#CCCCCC">in all security meetup group in</font>

43
00:02:13,940 --> 00:02:21,829
Singapore<font color="#CCCCCC"> special interest group it</font>

44
00:02:17,750 --> 00:02:25,520
released<font color="#E5E5E5"> the tool called</font><font color="#CCCCCC"> bit Scout he</font>

45
00:02:21,830 --> 00:02:26,420
was searching for<font color="#E5E5E5"> a poisonous needle so</font>

46
00:02:25,520 --> 00:02:28,310
it picked up my

47
00:02:26,420 --> 00:02:31,760
<font color="#CCCCCC">first I say it</font><font color="#E5E5E5"> looks like a very</font>

48
00:02:28,310 --> 00:02:34,700
interesting<font color="#E5E5E5"> tool why don't I try it so</font>

49
00:02:31,760 --> 00:02:39,140
as<font color="#E5E5E5"> you can see</font><font color="#CCCCCC"> July 19 G</font><font color="#E5E5E5"> today is not</font>

50
00:02:34,700 --> 00:02:41,540
long ago<font color="#CCCCCC"> so I've</font><font color="#E5E5E5"> worked many hours with</font>

51
00:02:39,140 --> 00:02:43,970
the help of<font color="#CCCCCC"> France and Italy</font><font color="#E5E5E5"> in</font>

52
00:02:41,540 --> 00:02:47,870
particular<font color="#E5E5E5"> and hopefully the demo is</font>

53
00:02:43,970 --> 00:02:49,880
<font color="#CCCCCC">going to work so as we have as</font>

54
00:02:47,870 --> 00:02:54,440
Battaglia's briefly<font color="#E5E5E5"> explained basically</font>

55
00:02:49,880 --> 00:02:56,780
<font color="#E5E5E5">Patrick is located far away is booting</font>

56
00:02:54,440 --> 00:03:01,340
up an ISO file that I've provided to him

57
00:02:56,780 --> 00:03:03,110
<font color="#E5E5E5">so I send it flying pigeon because</font><font color="#CCCCCC"> it</font>

58
00:03:01,340 --> 00:03:05,840
can carry USB Drive and<font color="#E5E5E5"> it was able to</font>

59
00:03:03,110 --> 00:03:07,299
<font color="#E5E5E5">put the USB Drive on the computer and</font>

60
00:03:05,840 --> 00:03:10,850
<font color="#E5E5E5">boot it up</font>

61
00:03:07,299 --> 00:03:13,370
he<font color="#CCCCCC"> also authorized</font><font color="#E5E5E5"> the mounting of</font><font color="#CCCCCC"> the</font>

62
00:03:10,850 --> 00:03:15,650
<font color="#CCCCCC">disc in read-only</font><font color="#E5E5E5"> so that I cannot</font>

63
00:03:13,370 --> 00:03:18,290
tamper with the evidence in case<font color="#E5E5E5"> a law</font>

64
00:03:15,650 --> 00:03:23,690
enforcement<font color="#E5E5E5"> agency wants to take</font><font color="#CCCCCC"> over</font>

65
00:03:18,290 --> 00:03:26,030
from here so I'm going<font color="#CCCCCC"> to go to the demo</font>

66
00:03:23,690 --> 00:03:29,090
<font color="#E5E5E5">one now and is</font><font color="#CCCCCC"> going to be completely</font>

67
00:03:26,030 --> 00:03:31,100
<font color="#E5E5E5">live it was not working until minutes</font>

68
00:03:29,090 --> 00:03:36,620
ago so<font color="#CCCCCC"> fully together</font><font color="#E5E5E5"> we</font><font color="#CCCCCC"> are going to</font>

69
00:03:31,100 --> 00:03:42,470
make it work<font color="#CCCCCC"> all</font><font color="#E5E5E5"> right</font><font color="#CCCCCC"> so I'm doing</font>

70
00:03:36,620 --> 00:03:44,480
<font color="#E5E5E5">everything of a virtual machines because</font>

71
00:03:42,470 --> 00:03:48,049
I was not confident doing<font color="#E5E5E5"> it</font><font color="#CCCCCC"> over the</font>

72
00:03:44,480 --> 00:03:50,510
the<font color="#E5E5E5"> network for today we have this</font>

73
00:03:48,049 --> 00:03:53,660
tested several time and it works well in

74
00:03:50,510 --> 00:03:56,929
the<font color="#E5E5E5"> network the setup was my machine</font>

75
00:03:53,660 --> 00:03:58,280
connecting to the VPN<font color="#CCCCCC"> and the the</font>

76
00:03:56,930 --> 00:04:00,829
infected machine was connected to<font color="#CCCCCC"> the</font>

77
00:03:58,280 --> 00:04:03,859
planning as<font color="#E5E5E5"> well and even over 4G</font>

78
00:04:00,829 --> 00:04:07,280
connection it was pretty small<font color="#E5E5E5"> in other</font>

79
00:04:03,859 --> 00:04:09,590
words I didn't acquire the the<font color="#E5E5E5"> disk</font><font color="#CCCCCC"> I</font>

80
00:04:07,280 --> 00:04:12,850
didn't acquire the memory everything<font color="#E5E5E5"> was</font>

81
00:04:09,590 --> 00:04:16,548
done remotely<font color="#CCCCCC"> and that's why it was fast</font>

82
00:04:12,850 --> 00:04:18,589
<font color="#E5E5E5">so I've mounted the</font><font color="#CCCCCC"> disk</font><font color="#E5E5E5"> actually</font>

83
00:04:16,548 --> 00:04:21,529
there's one mounted<font color="#E5E5E5"> too much but doesn't</font>

84
00:04:18,589 --> 00:04:25,700
matter<font color="#E5E5E5"> so we can see evidence zero is</font>

85
00:04:21,529 --> 00:04:28,760
the<font color="#CCCCCC"> four full disk and evidence one is</font>

86
00:04:25,700 --> 00:04:33,620
the<font color="#E5E5E5"> the partition the main NTFS</font>

87
00:04:28,760 --> 00:04:36,909
partition of<font color="#CCCCCC"> the disk so what I'm going</font>

88
00:04:33,620 --> 00:04:36,909
to do is

89
00:04:39,010 --> 00:04:42,610
<font color="#CCCCCC">as</font><font color="#E5E5E5"> my pleasure</font>

90
00:04:47,680 --> 00:04:52,930
so I'm going to<font color="#E5E5E5"> connect connect to the</font>

91
00:04:49,810 --> 00:04:54,699
to the machine<font color="#E5E5E5"> so</font><font color="#CCCCCC"> let self FTP</font><font color="#E5E5E5"> n but</font>

92
00:04:52,930 --> 00:04:59,110
from the<font color="#E5E5E5"> like</font><font color="#CCCCCC"> like I explained is local</font>

93
00:04:54,699 --> 00:05:00,820
local for now<font color="#E5E5E5"> I'm going to create a</font>

94
00:04:59,110 --> 00:05:12,039
<font color="#E5E5E5">folder that's going to be useful for</font>

95
00:05:00,820 --> 00:05:15,969
<font color="#CCCCCC">later</font><font color="#E5E5E5"> all right</font>

96
00:05:12,039 --> 00:05:24,190
<font color="#CCCCCC">I have access to the disk so I could I</font>

97
00:05:15,970 --> 00:05:27,220
could mount<font color="#CCCCCC"> on the disk so I'm going</font>

98
00:05:24,190 --> 00:05:29,860
into to<font color="#CCCCCC"> boot mode</font><font color="#E5E5E5"> but as vitaly</font>

99
00:05:27,220 --> 00:05:31,000
explained it is a virtual<font color="#E5E5E5"> route so even</font>

100
00:05:29,860 --> 00:05:33,039
though<font color="#CCCCCC"> i have full access on my</font>

101
00:05:31,000 --> 00:05:35,169
container<font color="#CCCCCC"> i cannot do anything on the</font>

102
00:05:33,039 --> 00:05:40,620
evidence at least<font color="#E5E5E5"> so i'm going to mount</font>

103
00:05:35,169 --> 00:05:45,400
the<font color="#E5E5E5"> disk that the disk is located in dev</font>

104
00:05:40,620 --> 00:05:48,759
host evidence<font color="#E5E5E5"> one so this one</font><font color="#CCCCCC"> is the</font>

105
00:05:45,400 --> 00:05:53,380
<font color="#CCCCCC">partition the main NTFS partition of the</font>

106
00:05:48,759 --> 00:05:55,570
<font color="#CCCCCC">infected machine and i'm</font><font color="#E5E5E5"> going to put it</font>

107
00:05:53,380 --> 00:06:03,250
as mom<font color="#E5E5E5"> but because it's read-only</font><font color="#CCCCCC"> i have</font>

108
00:05:55,570 --> 00:06:14,409
to specify<font color="#E5E5E5"> all right so if i if i</font><font color="#CCCCCC"> ended</font>

109
00:06:03,250 --> 00:06:16,780
<font color="#E5E5E5">go to that that folder now I can see</font>

110
00:06:14,409 --> 00:06:18,729
documents and settings I can<font color="#CCCCCC"> see Program</font>

111
00:06:16,780 --> 00:06:22,059
<font color="#CCCCCC">Files so basically this is this is my</font>

112
00:06:18,729 --> 00:06:23,800
partition<font color="#CCCCCC"> alright but it would be it</font>

113
00:06:22,060 --> 00:06:27,580
<font color="#E5E5E5">would be good if</font><font color="#CCCCCC"> we could boot up that</font>

114
00:06:23,800 --> 00:06:31,650
<font color="#E5E5E5">system because many of my</font><font color="#CCCCCC"> farm six tools</font>

115
00:06:27,580 --> 00:06:31,650
are actually running on it

116
00:06:38,980 --> 00:06:41,790
sorry

117
00:06:51,599 --> 00:07:03,270
<font color="#E5E5E5">all right so I'm going</font><font color="#CCCCCC"> to create a</font>

118
00:06:56,819 --> 00:07:06,629
backing file for the for the image<font color="#E5E5E5"> okay</font>

119
00:07:03,270 --> 00:07:08,779
so I created a<font color="#CCCCCC"> cuoco file that the</font>

120
00:07:06,629 --> 00:07:13,979
virtual<font color="#E5E5E5"> machine is going</font><font color="#CCCCCC"> to do to use</font>

121
00:07:08,779 --> 00:07:20,039
I'm<font color="#E5E5E5"> going to copy a very long</font><font color="#CCCCCC"> command</font><font color="#E5E5E5"> to</font>

122
00:07:13,979 --> 00:07:22,378
basically create my virtual<font color="#CCCCCC"> machine so</font>

123
00:07:20,039 --> 00:07:23,759
this creates a virtual machine<font color="#E5E5E5"> and in</font>

124
00:07:22,379 --> 00:07:26,669
fact the virtual machine should probably

125
00:07:23,759 --> 00:07:31,159
be booting up by now<font color="#E5E5E5"> and I realized that</font>

126
00:07:26,669 --> 00:07:31,159
<font color="#E5E5E5">I forgot</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> set a password</font><font color="#CCCCCC"> for the</font><font color="#E5E5E5"> VNC</font>

127
00:07:51,430 --> 00:07:55,259
yes and<font color="#E5E5E5"> also forgot to</font>

128
00:08:25,250 --> 00:08:34,070
<font color="#E5E5E5">all right so my</font><font color="#CCCCCC"> veteran machine by right</font>

129
00:08:30,110 --> 00:08:36,669
<font color="#E5E5E5">is what is starting now</font><font color="#CCCCCC"> so I'm going to</font>

130
00:08:34,070 --> 00:08:36,669
connect<font color="#CCCCCC"> to it</font>

131
00:08:43,669 --> 00:08:47,260
<font color="#E5E5E5">all these</font><font color="#CCCCCC"> talking</font>

132
00:09:01,420 --> 00:09:05,290
<font color="#E5E5E5">okay I'm facing some difficulties I</font>

133
00:09:04,060 --> 00:09:09,750
think I'm going<font color="#E5E5E5"> to jump</font><font color="#CCCCCC"> straight to the</font>

134
00:09:05,290 --> 00:09:09,750
demo<font color="#E5E5E5"> - sorry sorry about</font><font color="#CCCCCC"> that</font>

135
00:09:31,770 --> 00:09:35,600
<font color="#E5E5E5">okay so</font><font color="#CCCCCC"> hopefully this one will</font><font color="#E5E5E5"> work</font>

136
00:09:33,210 --> 00:09:35,600
<font color="#E5E5E5">better</font>

137
00:10:02,710 --> 00:10:11,450
<font color="#CCCCCC">alright so my virtual machine is created</font>

138
00:10:07,240 --> 00:10:14,630
I've basically<font color="#E5E5E5"> it's a</font><font color="#CCCCCC"> it's a machine</font>

139
00:10:11,450 --> 00:10:16,340
where we<font color="#E5E5E5"> we discover</font><font color="#CCCCCC"> there's something</font>

140
00:10:14,630 --> 00:10:19,550
wrong but<font color="#E5E5E5"> we couldn't find any evidence</font>

141
00:10:16,340 --> 00:10:21,770
<font color="#E5E5E5">on the machine so</font><font color="#CCCCCC"> we suspect that</font>

142
00:10:19,550 --> 00:10:23,660
<font color="#CCCCCC">there's a rootkit and when we started</font>

143
00:10:21,770 --> 00:10:26,270
<font color="#E5E5E5">Gmail which is a tool to detect rootkit</font>

144
00:10:23,660 --> 00:10:28,130
<font color="#E5E5E5">we detected</font><font color="#CCCCCC"> that the MBR the Master Boot</font>

145
00:10:26,270 --> 00:10:32,300
Record<font color="#E5E5E5"> of the machine had been tampered</font>

146
00:10:28,130 --> 00:10:35,240
<font color="#E5E5E5">with</font><font color="#CCCCCC"> so let's try to analyze the the d</font>

147
00:10:32,300 --> 00:10:36,170
<font color="#CCCCCC">mb</font><font color="#E5E5E5"> mb a-- as it is booting and hopefully</font>

148
00:10:35,240 --> 00:10:52,180
we are<font color="#E5E5E5"> going to find something</font>

149
00:10:36,170 --> 00:10:58,099
<font color="#CCCCCC">interesting so</font><font color="#E5E5E5"> all</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> so I'm going</font>

150
00:10:52,180 --> 00:11:00,680
I'm going<font color="#CCCCCC"> this is going</font><font color="#E5E5E5"> to be I'm</font>

151
00:10:58,100 --> 00:11:05,800
setting up some breakpoints on my my

152
00:11:00,680 --> 00:11:05,800
virtual machine<font color="#E5E5E5"> and as I'm debugging it</font>

153
00:11:06,790 --> 00:11:16,030
and<font color="#E5E5E5"> basically yes</font>

154
00:11:28,639 --> 00:11:33,740
all right if I'm not looking<font color="#CCCCCC"> at</font><font color="#E5E5E5"> the</font>

155
00:11:30,750 --> 00:11:33,740
<font color="#E5E5E5">right one doesn't help</font>

156
00:12:07,839 --> 00:12:15,170
<font color="#E5E5E5">all right so we can see that the</font><font color="#CCCCCC"> MP</font>

157
00:12:11,600 --> 00:12:17,870
actually is loaded at 7000<font color="#CCCCCC"> it is the</font>

158
00:12:15,170 --> 00:12:21,260
<font color="#E5E5E5">bootloader of of the BIOS that is</font>

159
00:12:17,870 --> 00:12:24,470
starting<font color="#E5E5E5"> this then we can see at the</font>

160
00:12:21,260 --> 00:12:26,510
<font color="#CCCCCC">bottom of the screen in 7c 3f that there</font>

161
00:12:24,470 --> 00:12:30,589
is a function where the<font color="#E5E5E5"> code</font><font color="#CCCCCC"> is going to</font>

162
00:12:26,510 --> 00:12:36,860
<font color="#E5E5E5">be</font><font color="#CCCCCC"> will</font><font color="#E5E5E5"> be located so I'm going to put a</font>

163
00:12:30,589 --> 00:12:37,820
<font color="#E5E5E5">breakpoint</font><font color="#CCCCCC"> on that location</font><font color="#E5E5E5"> all right so</font>

164
00:12:36,860 --> 00:12:45,910
we<font color="#CCCCCC"> can</font><font color="#E5E5E5"> see that the code</font><font color="#CCCCCC"> has been</font>

165
00:12:37,820 --> 00:12:50,300
<font color="#CCCCCC">relocated in a</font><font color="#E5E5E5"> 974</font><font color="#CCCCCC"> 0 then I'm going to</font>

166
00:12:45,910 --> 00:12:54,170
<font color="#E5E5E5">continue looking at the code</font><font color="#CCCCCC"> we can</font><font color="#E5E5E5"> see</font>

167
00:12:50,300 --> 00:12:57,410
in the code just<font color="#E5E5E5"> listed above in in the</font>

168
00:12:54,170 --> 00:13:03,459
middle<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the screen there is an int 13</font>

169
00:12:57,410 --> 00:13:03,459
so int 13 is actually an instruction

170
00:13:11,079 --> 00:13:15,609
<font color="#E5E5E5">okay sure yeah</font>

171
00:13:16,990 --> 00:13:23,810
check check<font color="#CCCCCC"> so sorry for interrupting</font>

172
00:13:20,209 --> 00:13:25,880
this but I'm<font color="#E5E5E5"> just feeling bad for my</font>

173
00:13:23,810 --> 00:13:28,489
friend who<font color="#E5E5E5"> spend a lot of time making</font>

174
00:13:25,880 --> 00:13:31,490
the demo and I know it's super<font color="#E5E5E5"> hard</font><font color="#CCCCCC"> to</font>

175
00:13:28,490 --> 00:13:34,430
use gdb<font color="#E5E5E5"> and show live demand command</font>

176
00:13:31,490 --> 00:13:35,959
what's going on at the same<font color="#CCCCCC"> time so when</font>

177
00:13:34,430 --> 00:13:38,000
<font color="#E5E5E5">his permission I'll just help him to</font>

178
00:13:35,959 --> 00:13:40,279
comment<font color="#E5E5E5"> what's going on with while he</font>

179
00:13:38,000 --> 00:13:41,079
<font color="#CCCCCC">was</font><font color="#E5E5E5"> doing here between all the all the</font>

180
00:13:40,279 --> 00:13:45,620
work<font color="#CCCCCC"> all</font><font color="#E5E5E5"> right</font>

181
00:13:41,079 --> 00:13:48,079
you don't mind please thank<font color="#E5E5E5"> you</font><font color="#CCCCCC"> so</font>

182
00:13:45,620 --> 00:13:52,399
basically<font color="#E5E5E5"> what you</font><font color="#CCCCCC"> see the idea</font><font color="#E5E5E5"> is that</font>

183
00:13:48,079 --> 00:13:53,540
<font color="#E5E5E5">we're going to debug the the NPR because</font>

184
00:13:52,399 --> 00:13:55,430
we know that<font color="#CCCCCC"> this is a boot kit</font>

185
00:13:53,540 --> 00:13:57,469
installed this was<font color="#E5E5E5"> detected by some</font>

186
00:13:55,430 --> 00:14:01,130
<font color="#E5E5E5">tools and what</font><font color="#CCCCCC"> ninka was</font><font color="#E5E5E5"> just showed</font>

187
00:13:57,470 --> 00:14:02,540
this gdb session was attaching<font color="#E5E5E5"> to the</font>

188
00:14:01,130 --> 00:14:04,610
virtual<font color="#E5E5E5"> machine</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> starts from</font><font color="#CCCCCC"> bits</font>

189
00:14:02,540 --> 00:14:07,790
card from the live CD<font color="#CCCCCC"> okay so actually</font>

190
00:14:04,610 --> 00:14:09,769
qmo comes<font color="#E5E5E5"> with the gdb server which you</font>

191
00:14:07,790 --> 00:14:11,269
<font color="#E5E5E5">can attach</font><font color="#CCCCCC"> to and you can</font><font color="#E5E5E5"> debug start</font>

192
00:14:09,769 --> 00:14:14,420
starting from the<font color="#E5E5E5"> first instruction of</font>

193
00:14:11,269 --> 00:14:16,820
<font color="#E5E5E5">the virtual machine code at</font><font color="#CCCCCC"> 7 C 0 0 this</font>

194
00:14:14,420 --> 00:14:19,399
is the magic address<font color="#E5E5E5"> where bias of the</font>

195
00:14:16,820 --> 00:14:20,510
virtual machine puts the MBR code that's

196
00:14:19,399 --> 00:14:23,750
why this

197
00:14:20,510 --> 00:14:25,760
magic<font color="#CCCCCC"> value okay so at summon c00 you</font>

198
00:14:23,750 --> 00:14:27,500
will see the<font color="#E5E5E5"> first instruction that is</font>

199
00:14:25,760 --> 00:14:28,370
exactly the same on the hard drive and

200
00:14:27,500 --> 00:14:31,910
the first<font color="#CCCCCC"> byte</font>

201
00:14:28,370 --> 00:14:34,699
so what<font color="#CCCCCC"> Nicolas said</font><font color="#E5E5E5"> about the</font>

202
00:14:31,910 --> 00:14:37,219
relocation<font color="#CCCCCC"> is that of course as</font><font color="#E5E5E5"> far as</font>

203
00:14:34,699 --> 00:14:39,019
<font color="#E5E5E5">the MBR inspected it has to execute the</font>

204
00:14:37,220 --> 00:14:41,750
original code at some point and<font color="#E5E5E5"> that's</font>

205
00:14:39,019 --> 00:14:44,690
<font color="#E5E5E5">why they a migrating code to a different</font>

206
00:14:41,750 --> 00:14:47,209
place<font color="#E5E5E5"> to this</font><font color="#CCCCCC"> 9700</font><font color="#E5E5E5"> where they continue</font>

207
00:14:44,690 --> 00:14:49,639
execution<font color="#E5E5E5"> while restoring the MBR the</font>

208
00:14:47,209 --> 00:14:54,369
original one<font color="#E5E5E5"> to let the Windows</font><font color="#CCCCCC"> boot as</font>

209
00:14:49,639 --> 00:14:54,370
nothing has happened<font color="#CCCCCC"> sir please go ahead</font>

210
00:14:59,620 --> 00:15:05,720
<font color="#CCCCCC">do you recommend or</font><font color="#E5E5E5"> well so like I</font>

211
00:15:03,290 --> 00:15:08,990
mentioned<font color="#CCCCCC"> earlier the ENT</font><font color="#E5E5E5"> Titan is the</font>

212
00:15:05,720 --> 00:15:12,800
interrupt<font color="#E5E5E5"> to read the</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> file on disk</font>

213
00:15:08,990 --> 00:15:16,130
<font color="#E5E5E5">and it's going to read 3d sectors so my</font>

214
00:15:12,800 --> 00:15:19,099
<font color="#E5E5E5">to be multiplied by</font><font color="#CCCCCC"> five one two and</font>

215
00:15:16,130 --> 00:15:21,709
it's going to to to to to<font color="#E5E5E5"> load the</font>

216
00:15:19,100 --> 00:15:24,110
additional<font color="#CCCCCC"> but keep the data</font><font color="#E5E5E5"> in the</font>

217
00:15:21,709 --> 00:15:25,550
memory<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> right so just like Nikolas</font>

218
00:15:24,110 --> 00:15:26,810
said the additional date is<font color="#E5E5E5"> going to be</font>

219
00:15:25,550 --> 00:15:29,120
<font color="#E5E5E5">lower because it's not going to fit into</font>

220
00:15:26,810 --> 00:15:31,130
<font color="#E5E5E5">small one or two sectors from disk so</font>

221
00:15:29,120 --> 00:15:35,029
<font color="#E5E5E5">there is extra package bailout which is</font>

222
00:15:31,130 --> 00:15:38,000
encrypted<font color="#CCCCCC"> so that's 3d hacks sectors</font>

223
00:15:35,029 --> 00:15:41,420
that are<font color="#E5E5E5"> read is in interrupts 13 so</font>

224
00:15:38,000 --> 00:15:43,910
what is this is<font color="#E5E5E5"> the exact encryption so</font>

225
00:15:41,420 --> 00:15:48,439
this is encrypted<font color="#CCCCCC"> it's already decrypted</font>

226
00:15:43,910 --> 00:15:52,269
right<font color="#CCCCCC"> no observe decrypted</font><font color="#E5E5E5"> yes</font><font color="#CCCCCC"> ok</font><font color="#E5E5E5"> can</font>

227
00:15:48,440 --> 00:15:57,560
you<font color="#E5E5E5"> scroll up the</font><font color="#CCCCCC"> CD</font>

228
00:15:52,269 --> 00:16:01,069
<font color="#CCCCCC">No</font><font color="#E5E5E5"> so we see we see we see the</font><font color="#CCCCCC"> the same</font>

229
00:15:57,560 --> 00:16:04,910
location beef before<font color="#E5E5E5"> encryption and then</font>

230
00:16:01,069 --> 00:16:07,279
it was decrypted so because it's a it's

231
00:16:04,910 --> 00:16:09,829
a complex complex good kid that<font color="#CCCCCC"> was at</font>

232
00:16:07,279 --> 00:16:14,899
least<font color="#CCCCCC"> the first level of encryption</font><font color="#E5E5E5"> and</font>

233
00:16:09,829 --> 00:16:18,380
it was over of<font color="#CCCCCC"> XOR with a key that was</font>

234
00:16:14,899 --> 00:16:19,760
moving<font color="#E5E5E5"> according to the</font><font color="#CCCCCC"> sector's</font><font color="#E5E5E5"> so the</font>

235
00:16:18,380 --> 00:16:23,180
basically the payload on<font color="#E5E5E5"> disk is</font>

236
00:16:19,760 --> 00:16:26,120
encrypted with<font color="#CCCCCC"> a simple XOR algorithm</font><font color="#E5E5E5"> so</font>

237
00:16:23,180 --> 00:16:28,910
<font color="#E5E5E5">the first stage is</font><font color="#CCCCCC"> you have to to run it</font>

238
00:16:26,120 --> 00:16:30,019
to let<font color="#E5E5E5"> it decrypt using the own XOR and</font>

239
00:16:28,910 --> 00:16:32,240
decryption

240
00:16:30,019 --> 00:16:34,010
<font color="#CCCCCC">and this is where you can dump the next</font>

241
00:16:32,240 --> 00:16:35,180
stage<font color="#E5E5E5"> but it's not</font>

242
00:16:34,010 --> 00:16:38,210
yet over<font color="#E5E5E5"> because there will be other</font>

243
00:16:35,180 --> 00:16:40,849
layers inside so in fact we discovered

244
00:16:38,210 --> 00:16:42,410
that there was a layer of a c4 or

245
00:16:40,850 --> 00:16:45,050
<font color="#CCCCCC">something that looked like a c4</font>

246
00:16:42,410 --> 00:16:46,520
encryption it was not<font color="#E5E5E5"> exactly the same</font>

247
00:16:45,050 --> 00:16:48,920
when we<font color="#E5E5E5"> looked for the code I'm not</font>

248
00:16:46,520 --> 00:16:52,699
going<font color="#E5E5E5"> through the code but it was nearly</font>

249
00:16:48,920 --> 00:16:57,319
identical<font color="#E5E5E5"> so the modified</font><font color="#CCCCCC"> are support</font>

250
00:16:52,700 --> 00:16:59,600
the key scheduling was different and so

251
00:16:57,320 --> 00:17:01,610
in<font color="#CCCCCC"> fact on</font><font color="#E5E5E5"> the screen now</font><font color="#CCCCCC"> you can see we</font>

252
00:16:59,600 --> 00:17:05,329
recover the key<font color="#E5E5E5"> and it was part of the</font>

253
00:17:01,610 --> 00:17:11,300
after the<font color="#CCCCCC"> war sequence</font><font color="#E5E5E5"> and we can see on</font>

254
00:17:05,329 --> 00:17:14,359
<font color="#E5E5E5">that line here as Y as te M then null</font>

255
00:17:11,300 --> 00:17:14,690
character<font color="#E5E5E5"> and then M so system m capital</font>

256
00:17:14,359 --> 00:17:22,490
M

257
00:17:14,690 --> 00:17:25,220
<font color="#CCCCCC">I think it's system on</font><font color="#E5E5E5"> here so now we</font>

258
00:17:22,490 --> 00:17:34,190
managed to<font color="#E5E5E5"> get the DRC</font><font color="#CCCCCC"> 4 so</font><font color="#E5E5E5"> let's</font>

259
00:17:25,220 --> 00:17:36,890
decrypt the data so<font color="#E5E5E5"> this was the the the</font>

260
00:17:34,190 --> 00:17:39,200
<font color="#CCCCCC">the data that we decrypted</font><font color="#E5E5E5"> although it</font>

261
00:17:36,890 --> 00:17:47,330
shouldn't be bytes<font color="#E5E5E5"> but</font><font color="#CCCCCC"> it should</font><font color="#E5E5E5"> be</font>

262
00:17:39,200 --> 00:17:49,250
<font color="#CCCCCC">instruction</font><font color="#E5E5E5"> so let's</font><font color="#CCCCCC"> click that so after</font>

263
00:17:47,330 --> 00:17:51,530
<font color="#CCCCCC">our C for decryption that has to be</font>

264
00:17:49,250 --> 00:17:56,120
<font color="#E5E5E5">allegedly executable code if everything</font>

265
00:17:51,530 --> 00:17:58,160
worked the demo gods<font color="#E5E5E5"> are with us you</font>

266
00:17:56,120 --> 00:18:04,459
need<font color="#E5E5E5"> to put</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> location so we will now</font>

267
00:17:58,160 --> 00:18:10,250
<font color="#CCCCCC">try to exploit these in instructions</font><font color="#E5E5E5"> no</font>

268
00:18:04,460 --> 00:18:14,090
sorry<font color="#CCCCCC"> therefore actually</font><font color="#E5E5E5"> that wasn't it</font>

269
00:18:10,250 --> 00:18:15,860
was a encrypted<font color="#E5E5E5"> this is the encrypted</font>

270
00:18:14,090 --> 00:18:22,699
data<font color="#CCCCCC"> okay this</font><font color="#E5E5E5"> doesn't</font><font color="#CCCCCC"> make sense</font>

271
00:18:15,860 --> 00:18:24,649
yes<font color="#CCCCCC"> okay</font><font color="#E5E5E5"> so now it's decrypted and we</font>

272
00:18:22,700 --> 00:18:27,800
can<font color="#E5E5E5"> see some some code</font><font color="#CCCCCC"> that kind of make</font>

273
00:18:24,650 --> 00:18:31,340
sense<font color="#E5E5E5"> with jump and calls to further</font>

274
00:18:27,800 --> 00:18:37,450
functions so we we<font color="#E5E5E5"> are facing one</font>

275
00:18:31,340 --> 00:18:41,230
problem<font color="#E5E5E5"> basically</font><font color="#CCCCCC"> what happens is the</font>

276
00:18:37,450 --> 00:18:45,020
the malicious MBR is going to<font color="#E5E5E5"> identify</font>

277
00:18:41,230 --> 00:18:47,780
some some drivers started by<font color="#E5E5E5"> windows and</font>

278
00:18:45,020 --> 00:18:50,629
in that case<font color="#E5E5E5"> it was a CPI disease</font>

279
00:18:47,780 --> 00:18:55,760
it's going to patch this driver<font color="#E5E5E5"> to load</font>

280
00:18:50,630 --> 00:18:57,880
<font color="#CCCCCC">its</font><font color="#E5E5E5"> own malicious instruction because</font>

281
00:18:55,760 --> 00:19:00,679
the the windows is<font color="#E5E5E5"> already started</font>

282
00:18:57,880 --> 00:19:02,030
hanging all free<font color="#E5E5E5"> and there's we don't</font>

283
00:19:00,679 --> 00:19:05,360
have knowledge<font color="#E5E5E5"> of the structure of</font>

284
00:19:02,030 --> 00:19:08,928
<font color="#CCCCCC">Windows then we were</font><font color="#E5E5E5"> not able</font><font color="#CCCCCC"> to put</font><font color="#E5E5E5"> to</font>

285
00:19:05,360 --> 00:19:11,658
set<font color="#E5E5E5"> break point with the traditional</font>

286
00:19:08,929 --> 00:19:16,850
<font color="#E5E5E5">method so we step to record and we</font>

287
00:19:11,659 --> 00:19:18,650
identify<font color="#CCCCCC"> that</font><font color="#E5E5E5"> at some some function even</font>

288
00:19:16,850 --> 00:19:20,389
<font color="#CCCCCC">though we</font><font color="#E5E5E5"> couldn't put breakpoints we</font>

289
00:19:18,650 --> 00:19:21,919
were able<font color="#CCCCCC"> to put like a cyclic jump so</font>

290
00:19:20,390 --> 00:19:24,260
basically we<font color="#E5E5E5"> put an instruction</font><font color="#CCCCCC"> that</font>

291
00:19:21,919 --> 00:19:26,600
once executed is going to jump<font color="#CCCCCC"> over</font>

292
00:19:24,260 --> 00:19:28,400
itself again and<font color="#E5E5E5"> again so it is not</font>

293
00:19:26,600 --> 00:19:32,120
breaking the code but the<font color="#CCCCCC"> cony</font><font color="#E5E5E5"> the code</font>

294
00:19:28,400 --> 00:19:34,429
is<font color="#CCCCCC"> not doing anything for forward it's</font>

295
00:19:32,120 --> 00:19:36,260
actually<font color="#E5E5E5"> infinite loop on itself</font><font color="#CCCCCC"> so the</font>

296
00:19:34,429 --> 00:19:39,799
loop instruction and we do that<font color="#E5E5E5"> it so</font>

297
00:19:36,260 --> 00:19:41,480
<font color="#E5E5E5">called</font><font color="#CCCCCC"> Poorman</font><font color="#E5E5E5"> break point because and</font>

298
00:19:39,799 --> 00:19:43,610
it's super useful here because<font color="#CCCCCC"> if</font><font color="#E5E5E5"> you</font>

299
00:19:41,480 --> 00:19:44,870
don't<font color="#E5E5E5"> use</font><font color="#CCCCCC"> it if you</font><font color="#E5E5E5"> put the normal</font>

300
00:19:43,610 --> 00:19:47,928
<font color="#CCCCCC">breakpoint</font><font color="#E5E5E5"> software</font><font color="#CCCCCC"> interrupt for</font>

301
00:19:44,870 --> 00:19:50,330
instance<font color="#E5E5E5"> then the code will be placed to</font>

302
00:19:47,929 --> 00:19:51,860
a different memory location because you

303
00:19:50,330 --> 00:19:54,649
are<font color="#CCCCCC"> switching from real</font><font color="#E5E5E5"> mode to the</font>

304
00:19:51,860 --> 00:19:56,870
protected mode<font color="#CCCCCC"> and you have to survive</font>

305
00:19:54,650 --> 00:19:58,789
<font color="#E5E5E5">right</font><font color="#CCCCCC"> if the call has relocated that</font>

306
00:19:56,870 --> 00:20:00,649
interrupts<font color="#CCCCCC"> 3 for the debugger we</font>

307
00:19:58,789 --> 00:20:04,490
actually crash<font color="#CCCCCC"> Windows that's why we</font>

308
00:20:00,650 --> 00:20:06,799
need<font color="#CCCCCC"> to use</font><font color="#E5E5E5"> this funny infinite loop to</font>

309
00:20:04,490 --> 00:20:08,929
catch that<font color="#CCCCCC"> moment when we are already in</font>

310
00:20:06,799 --> 00:20:10,700
protected mode to keep on debugging<font color="#CCCCCC"> the</font>

311
00:20:08,929 --> 00:20:17,450
protected<font color="#CCCCCC"> mode from this attached</font>

312
00:20:10,700 --> 00:20:22,880
debugger<font color="#CCCCCC"> alright so we are</font><font color="#E5E5E5"> putting that</font>

313
00:20:17,450 --> 00:20:24,260
<font color="#CCCCCC">breakpoint and running so Windows is</font>

314
00:20:22,880 --> 00:20:27,080
already starting because<font color="#CCCCCC"> I interrupted</font>

315
00:20:24,260 --> 00:20:30,260
<font color="#CCCCCC">the across the</font><font color="#E5E5E5"> machine earlier then I</font>

316
00:20:27,080 --> 00:20:34,158
need to<font color="#CCCCCC"> start normally and I know fully</font>

317
00:20:30,260 --> 00:20:39,740
soon after<font color="#CCCCCC"> our break point is set is a</font>

318
00:20:34,159 --> 00:20:42,710
hit sorry so I'm going to<font color="#CCCCCC"> continue after</font>

319
00:20:39,740 --> 00:20:45,230
after we<font color="#E5E5E5"> patch so the cyclic cyclic jump</font>

320
00:20:42,710 --> 00:20:47,179
is EB Fe<font color="#E5E5E5"> so this is actually patching</font>

321
00:20:45,230 --> 00:20:49,370
you can see EB Fe the Oscar<font color="#CCCCCC"> Radian</font>

322
00:20:47,179 --> 00:20:52,280
machine<font color="#CCCCCC"> code I'm sure everyone this is</font>

323
00:20:49,370 --> 00:20:58,270
<font color="#E5E5E5">the infinite</font><font color="#CCCCCC"> loop</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> on itself</font><font color="#E5E5E5"> we jump</font>

324
00:20:52,280 --> 00:21:01,520
to self so when windows starts starting

325
00:20:58,270 --> 00:21:06,110
at<font color="#E5E5E5"> some point is just not going to</font><font color="#CCCCCC"> do</font>

326
00:21:01,520 --> 00:21:07,520
<font color="#E5E5E5">anything at all because it's a it's a</font>

327
00:21:06,110 --> 00:21:10,790
<font color="#E5E5E5">now</font><font color="#CCCCCC"> I would switch to</font><font color="#E5E5E5"> protected</font><font color="#CCCCCC"> model</font>

328
00:21:07,520 --> 00:21:12,920
<font color="#CCCCCC">ready</font><font color="#E5E5E5"> this animation allegedly I think</font>

329
00:21:10,790 --> 00:21:14,930
it's a separate thread that is rendering

330
00:21:12,920 --> 00:21:21,080
<font color="#E5E5E5">this while we are running in an</font>

331
00:21:14,930 --> 00:21:22,730
<font color="#E5E5E5">efficient loop in another place so since</font>

332
00:21:21,080 --> 00:21:26,030
we managed to<font color="#E5E5E5"> hit the breakpoint close</font>

333
00:21:22,730 --> 00:21:30,460
to the<font color="#E5E5E5"> 2d drivers we were able</font><font color="#CCCCCC"> to locate</font>

334
00:21:26,030 --> 00:21:43,700
it and eventually dump this this driver

335
00:21:30,460 --> 00:21:47,620
<font color="#E5E5E5">so now what I can do is okay</font><font color="#CCCCCC"> we can see</font>

336
00:21:43,700 --> 00:21:50,210
there's<font color="#CCCCCC"> an 11 K</font><font color="#E5E5E5"> drivers so we</font><font color="#CCCCCC"> can see</font>

337
00:21:47,620 --> 00:21:52,850
what<font color="#E5E5E5"> kind of drivers is it</font>

338
00:21:50,210 --> 00:21:56,560
what<font color="#E5E5E5"> kind of fire it is it is</font><font color="#CCCCCC"> AP</font>

339
00:21:52,850 --> 00:22:01,909
executive<font color="#E5E5E5"> L file so it is indeed</font>

340
00:21:56,560 --> 00:22:08,570
something<font color="#E5E5E5"> that looks like</font><font color="#CCCCCC"> working what I</font>

341
00:22:01,910 --> 00:22:11,840
could do<font color="#CCCCCC"> also</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> md5 this driver and</font>

342
00:22:08,570 --> 00:22:17,419
for<font color="#E5E5E5"> example I can see on virustotal if</font>

343
00:22:11,840 --> 00:22:18,889
there is a hit well<font color="#CCCCCC"> Nicholas is looking</font>

344
00:22:17,420 --> 00:22:21,170
at<font color="#CCCCCC"> my risotto</font><font color="#E5E5E5"> I just wanted to come in</font>

345
00:22:18,890 --> 00:22:23,120
<font color="#E5E5E5">here</font><font color="#CCCCCC"> like why do</font><font color="#E5E5E5"> we need to follow this</font>

346
00:22:21,170 --> 00:22:24,950
procedure to<font color="#E5E5E5"> get to the driver is we</font>

347
00:22:23,120 --> 00:22:26,899
start from the MBR this is a reliable

348
00:22:24,950 --> 00:22:28,730
point where we start<font color="#E5E5E5"> execution of the</font>

349
00:22:26,900 --> 00:22:30,800
malicious code<font color="#E5E5E5"> right and we want to pull</font>

350
00:22:28,730 --> 00:22:33,260
and see how it unrolls<font color="#E5E5E5"> however it has</font>

351
00:22:30,800 --> 00:22:35,510
<font color="#E5E5E5">multiple layers</font><font color="#CCCCCC"> of encryption this one</font>

352
00:22:33,260 --> 00:22:37,490
has<font color="#E5E5E5"> three so it's X or encryption or C</font>

353
00:22:35,510 --> 00:22:39,080
for<font color="#CCCCCC"> customized one inside and</font><font color="#E5E5E5"> inside</font>

354
00:22:37,490 --> 00:22:40,640
<font color="#CCCCCC">there</font><font color="#E5E5E5"> is a container with a driver which</font>

355
00:22:39,080 --> 00:22:42,889
is decrypt it only<font color="#E5E5E5"> in protected mode</font>

356
00:22:40,640 --> 00:22:45,110
<font color="#CCCCCC">only after it switch to the protected</font>

357
00:22:42,890 --> 00:22:48,050
mode<font color="#E5E5E5"> and inject it into one of the</font>

358
00:22:45,110 --> 00:22:49,850
drivers<font color="#CCCCCC"> you see pilot</font><font color="#E5E5E5"> sees only then if</font>

359
00:22:48,050 --> 00:22:51,500
you run that code<font color="#CCCCCC"> that will save the</font>

360
00:22:49,850 --> 00:22:52,790
<font color="#CCCCCC">creep and</font><font color="#E5E5E5"> we want to catch this moment</font>

361
00:22:51,500 --> 00:22:55,610
to dump it on<font color="#E5E5E5"> disk and that's what we</font>

362
00:22:52,790 --> 00:23:00,370
did so as we can see<font color="#E5E5E5"> virustotal</font>

363
00:22:55,610 --> 00:23:04,090
already knows about<font color="#E5E5E5"> this violin</font><font color="#CCCCCC"> several</font>

364
00:23:00,370 --> 00:23:08,320
antiviruses identified as you can see

365
00:23:04,090 --> 00:23:11,240
<font color="#E5E5E5">but if</font><font color="#CCCCCC"> you see is</font><font color="#E5E5E5"> called</font><font color="#CCCCCC"> set need for</font>

366
00:23:08,320 --> 00:23:15,500
<font color="#CCCCCC">Yandex I</font><font color="#E5E5E5"> said</font><font color="#CCCCCC"> net or</font><font color="#E5E5E5"> sofa</font><font color="#CCCCCC"> C of</font><font color="#E5E5E5"> fancy</font>

367
00:23:11,240 --> 00:23:18,770
bear<font color="#E5E5E5"> if you have it in your machine this</font>

368
00:23:15,500 --> 00:23:22,460
it's<font color="#E5E5E5"> really bad</font><font color="#CCCCCC"> it's a it's a it's so</font>

369
00:23:18,770 --> 00:23:24,650
it's it's a boot<font color="#CCCCCC"> kid with candle man</font>

370
00:23:22,460 --> 00:23:32,780
<font color="#E5E5E5">rootkit and</font><font color="#CCCCCC"> use Allenwood</font><font color="#E5E5E5"> kid that is</font>

371
00:23:24,650 --> 00:23:35,030
typically<font color="#CCCCCC"> used by</font><font color="#E5E5E5"> the apt 28 actors</font><font color="#CCCCCC"> all</font>

372
00:23:32,780 --> 00:23:37,460
<font color="#E5E5E5">right so it is it is the end of my</font>

373
00:23:35,030 --> 00:23:39,590
second demo<font color="#E5E5E5"> that worked much better</font><font color="#CCCCCC"> than</font>

374
00:23:37,460 --> 00:23:41,360
<font color="#E5E5E5">the first</font><font color="#CCCCCC"> one the first</font><font color="#E5E5E5"> one basically</font><font color="#CCCCCC"> I</font>

375
00:23:39,590 --> 00:23:43,129
wanted<font color="#E5E5E5"> to demonstrate that but you have</font>

376
00:23:41,360 --> 00:23:44,719
still six minutes<font color="#CCCCCC"> I still have six</font>

377
00:23:43,130 --> 00:23:49,549
minutes<font color="#E5E5E5"> let's do</font><font color="#CCCCCC"> it let's do it</font><font color="#E5E5E5"> let's</font>

378
00:23:44,720 --> 00:24:06,880
fight with the<font color="#E5E5E5"> Democrats on stage all</font>

379
00:23:49,549 --> 00:24:09,350
<font color="#CCCCCC">right so</font><font color="#E5E5E5"> let's let's support Nicolas so</font>

380
00:24:06,880 --> 00:24:10,580
why only<font color="#CCCCCC"> cos is recovering just wanted</font>

381
00:24:09,350 --> 00:24:13,370
to add a<font color="#E5E5E5"> few comments like what's the</font>

382
00:24:10,580 --> 00:24:15,590
<font color="#E5E5E5">difference between the</font><font color="#CCCCCC"> booting of vm</font>

383
00:24:13,370 --> 00:24:17,870
<font color="#E5E5E5">that I showed the previous presentation</font>

384
00:24:15,590 --> 00:24:20,209
and this is that he boots it right<font color="#E5E5E5"> from</font>

385
00:24:17,870 --> 00:24:22,100
the live CD on the<font color="#E5E5E5"> remote location</font><font color="#CCCCCC"> given</font>

386
00:24:20,210 --> 00:24:24,080
<font color="#CCCCCC">that you have enough of</font><font color="#E5E5E5"> RAM that</font><font color="#CCCCCC"> you can</font>

387
00:24:22,100 --> 00:24:26,870
use to boot like this<font color="#CCCCCC"> I know already</font>

388
00:24:24,080 --> 00:24:28,970
this<font color="#E5E5E5"> sword operating system on</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> same</font>

389
00:24:26,870 --> 00:24:31,959
hardware then you can do<font color="#E5E5E5"> it you can</font><font color="#CCCCCC"> play</font>

390
00:24:28,970 --> 00:24:35,390
with it remotely<font color="#CCCCCC"> where it</font><font color="#E5E5E5"> is helpful is</font>

391
00:24:31,960 --> 00:24:38,330
for<font color="#E5E5E5"> instance</font><font color="#CCCCCC"> the network bandwidth sucks</font>

392
00:24:35,390 --> 00:24:40,610
and you cannot<font color="#CCCCCC"> actually redirect</font><font color="#E5E5E5"> you</font>

393
00:24:38,330 --> 00:24:42,559
know reading<font color="#E5E5E5"> these</font><font color="#CCCCCC"> Cruden</font><font color="#E5E5E5"> operations all</font>

394
00:24:40,610 --> 00:24:45,049
the network because<font color="#E5E5E5"> boot in Windows</font>

395
00:24:42,559 --> 00:24:47,960
actually takes<font color="#CCCCCC"> about from 500</font><font color="#E5E5E5"> to 600</font>

396
00:24:45,049 --> 00:24:50,330
megabytes of data<font color="#CCCCCC"> transfer if</font><font color="#E5E5E5"> you have a</font>

397
00:24:47,960 --> 00:24:52,100
slow link<font color="#E5E5E5"> it's not an option it's much</font>

398
00:24:50,330 --> 00:24:55,908
better to connect over<font color="#CCCCCC"> BNC to the remote</font>

399
00:24:52,100 --> 00:24:58,549
<font color="#CCCCCC">VM so this is where it helps the case</font>

400
00:24:55,909 --> 00:25:01,400
where<font color="#CCCCCC"> I can use the</font><font color="#E5E5E5"> setup that I showed</font>

401
00:24:58,549 --> 00:25:05,270
is useful where you have a very small

402
00:25:01,400 --> 00:25:07,100
<font color="#CCCCCC">RAM and you cannot actually start the</font>

403
00:25:05,270 --> 00:25:10,158
virtual machine<font color="#CCCCCC"> remotely</font><font color="#E5E5E5"> because of the</font>

404
00:25:07,100 --> 00:25:11,719
constraints of<font color="#E5E5E5"> RAM size then you can do</font>

405
00:25:10,159 --> 00:25:17,059
<font color="#E5E5E5">over the network given that you have</font>

406
00:25:11,720 --> 00:25:19,100
fast connection so at<font color="#CCCCCC"> his demos he is</font>

407
00:25:17,059 --> 00:25:22,309
starting all these<font color="#E5E5E5"> machines right on the</font>

408
00:25:19,100 --> 00:25:25,580
on the bit Scout instance running<font color="#E5E5E5"> so</font>

409
00:25:22,309 --> 00:25:28,450
<font color="#E5E5E5">I've created already my microphone my</font>

410
00:25:25,580 --> 00:25:31,070
backing file<font color="#E5E5E5"> from</font><font color="#CCCCCC"> my virtual machines</font>

411
00:25:28,450 --> 00:25:33,350
and again the changes are<font color="#E5E5E5"> not written</font><font color="#CCCCCC"> to</font>

412
00:25:31,070 --> 00:25:34,580
the hard<font color="#CCCCCC"> drive of the older</font><font color="#E5E5E5"> right it's</font>

413
00:25:33,350 --> 00:25:36,770
written in<font color="#E5E5E5"> this temporary file which</font>

414
00:25:34,580 --> 00:26:00,139
exists only in RAM you powered off like

415
00:25:36,770 --> 00:26:02,029
no changes are<font color="#E5E5E5"> done to this</font><font color="#CCCCCC"> machine so</font>

416
00:26:00,140 --> 00:26:04,640
<font color="#CCCCCC">chiamo when it starts with me</font><font color="#E5E5E5"> and see</font>

417
00:26:02,029 --> 00:26:08,029
<font color="#CCCCCC">you have to set password manually like</font>

418
00:26:04,640 --> 00:26:09,169
through the<font color="#E5E5E5"> monitor command</font><font color="#CCCCCC"> way default</font>

419
00:26:08,029 --> 00:26:12,980
it<font color="#E5E5E5"> doesn't allow you to connect the</font>

420
00:26:09,169 --> 00:26:15,220
<font color="#E5E5E5">doubt password so now we can see that</font>

421
00:26:12,980 --> 00:26:15,220
when

422
00:26:28,870 --> 00:26:36,739
<font color="#E5E5E5">okay now's a good</font><font color="#CCCCCC"> time</font><font color="#E5E5E5"> in this booting</font>

423
00:26:31,670 --> 00:26:43,780
<font color="#E5E5E5">yes so</font><font color="#CCCCCC"> you know past the stage where</font>

424
00:26:36,740 --> 00:26:49,780
where<font color="#E5E5E5"> we failed so I'm going to create</font>

425
00:26:43,780 --> 00:26:49,780
<font color="#CCCCCC">knit to you thank you</font>

426
00:27:13,500 --> 00:27:18,470
so<font color="#CCCCCC"> windows is</font><font color="#E5E5E5"> still good thing which is</font>

427
00:27:16,200 --> 00:27:18,470
good

428
00:27:36,710 --> 00:27:49,970
<font color="#CCCCCC">a bit slow I don't know why but let's</font>

429
00:27:41,899 --> 00:27:52,939
<font color="#E5E5E5">see so</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> machine the machine is</font>

430
00:27:49,970 --> 00:28:03,830
infected<font color="#E5E5E5"> that's why I put a red red</font>

431
00:27:52,940 --> 00:28:05,480
background over<font color="#CCCCCC"> Samba</font><font color="#E5E5E5"> since we have full</font>

432
00:28:03,830 --> 00:28:08,090
control<font color="#CCCCCC"> over</font><font color="#E5E5E5"> the virtual machine then I</font>

433
00:28:05,480 --> 00:28:09,590
was able to<font color="#E5E5E5"> install it using apt apt</font>

434
00:28:08,090 --> 00:28:13,750
<font color="#E5E5E5">common because it's a Ubuntu based</font>

435
00:28:09,590 --> 00:28:19,399
virtual<font color="#E5E5E5"> machine so I pity install Samba</font>

436
00:28:13,750 --> 00:28:20,990
amounted remote<font color="#E5E5E5"> drive that allow me for</font>

437
00:28:19,399 --> 00:28:30,770
example<font color="#E5E5E5"> to upload all</font><font color="#CCCCCC"> my tools and</font>

438
00:28:20,990 --> 00:28:33,730
<font color="#CCCCCC">Phyllida inside okay the inside so I'm</font>

439
00:28:30,770 --> 00:28:33,730
going to<font color="#E5E5E5"> look at</font>

440
00:28:47,110 --> 00:28:52,449
it's<font color="#E5E5E5"> over VNC that's</font><font color="#CCCCCC"> why</font><font color="#E5E5E5"> the screen is</font>

441
00:28:49,210 --> 00:28:54,489
<font color="#E5E5E5">not very</font><font color="#CCCCCC"> beautiful but at least it is it</font>

442
00:28:52,450 --> 00:28:57,249
is executing at the the real time<font color="#E5E5E5"> of the</font>

443
00:28:54,489 --> 00:29:00,539
<font color="#E5E5E5">of the server so if the server</font><font color="#CCCCCC"> is fast</font>

444
00:28:57,249 --> 00:29:00,539
and it should be quite fast as well

445
00:29:05,909 --> 00:29:13,029
<font color="#CCCCCC">alright so the the</font><font color="#E5E5E5"> the entry point was</font>

446
00:29:10,899 --> 00:29:16,149
<font color="#CCCCCC">that there was some connection coming</font><font color="#E5E5E5"> to</font>

447
00:29:13,029 --> 00:29:19,179
that<font color="#CCCCCC"> machine and we couldn't</font><font color="#E5E5E5"> explain</font><font color="#CCCCCC"> it</font>

448
00:29:16,149 --> 00:29:21,369
<font color="#E5E5E5">so by using TCP view we</font><font color="#CCCCCC"> are going to see</font>

449
00:29:19,179 --> 00:29:25,690
all<font color="#CCCCCC"> the network traffic</font><font color="#E5E5E5"> passing through</font>

450
00:29:21,369 --> 00:29:27,549
it<font color="#E5E5E5"> and particularly we</font><font color="#CCCCCC"> will see here</font>

451
00:29:25,690 --> 00:29:29,590
that<font color="#CCCCCC"> there is</font><font color="#E5E5E5"> on court</font><font color="#CCCCCC"> one two three</font>

452
00:29:27,549 --> 00:29:34,029
<font color="#CCCCCC">seven there is a process called CTF</font><font color="#E5E5E5"> Mon</font>

453
00:29:29,590 --> 00:29:41,639
<font color="#E5E5E5">that is listening</font><font color="#CCCCCC"> alright so let's try</font>

454
00:29:34,029 --> 00:29:45,690
<font color="#E5E5E5">to find this the city of Mon process so</font>

455
00:29:41,639 --> 00:29:45,689
if<font color="#E5E5E5"> I use process Explorer</font>

456
00:29:52,650 --> 00:30:01,020
and the demo gods<font color="#E5E5E5"> are really not kind</font>

457
00:29:54,720 --> 00:30:10,410
today<font color="#E5E5E5"> let me</font><font color="#CCCCCC"> just stand</font><font color="#E5E5E5"> on stage thank</font>

458
00:30:01,020 --> 00:30:14,300
<font color="#CCCCCC">you see</font><font color="#E5E5E5"> so we can</font><font color="#CCCCCC"> see a city everyone</font><font color="#E5E5E5"> is</font>

459
00:30:10,410 --> 00:30:15,720
indeed started<font color="#CCCCCC"> but if we try to see</font>

460
00:30:14,300 --> 00:30:18,270
where is it

461
00:30:15,720 --> 00:30:21,120
what it is doing<font color="#E5E5E5"> we can see that it was</font>

462
00:30:18,270 --> 00:30:23,490
started from<font color="#E5E5E5"> a non-existent process so</font>

463
00:30:21,120 --> 00:30:25,199
in other<font color="#E5E5E5"> words it exists but we don't</font>

464
00:30:23,490 --> 00:30:26,760
know who<font color="#E5E5E5"> started it</font><font color="#CCCCCC"> can you</font><font color="#E5E5E5"> run it as</font>

465
00:30:25,200 --> 00:30:28,160
administrator so that you see all

466
00:30:26,760 --> 00:30:30,929
options

467
00:30:28,160 --> 00:30:32,370
absolutely so the thing is<font color="#E5E5E5"> that we</font>

468
00:30:30,929 --> 00:30:34,170
wanted to<font color="#CCCCCC"> know how it started who</font>

469
00:30:32,370 --> 00:30:39,239
started the process right like<font color="#E5E5E5"> where the</font>

470
00:30:34,170 --> 00:30:42,120
the infection comes from that's why this

471
00:30:39,240 --> 00:30:52,559
chain<font color="#CCCCCC"> of like which process started what</font>

472
00:30:42,120 --> 00:30:54,959
<font color="#CCCCCC">is important we</font><font color="#E5E5E5"> have to restore it okay</font>

473
00:30:52,559 --> 00:30:57,090
at<font color="#CCCCCC"> least you have the common line</font><font color="#E5E5E5"> yes we</font>

474
00:30:54,960 --> 00:30:59,580
have the the command line<font color="#E5E5E5"> and so we can</font>

475
00:30:57,090 --> 00:31:04,260
see indeed CTF<font color="#CCCCCC"> one started something and</font>

476
00:30:59,580 --> 00:31:06,149
start another line on<font color="#E5E5E5"> the process there</font>

477
00:31:04,260 --> 00:31:08,460
<font color="#CCCCCC">is a port number that</font><font color="#E5E5E5"> we recognize</font><font color="#CCCCCC"> right</font>

478
00:31:06,150 --> 00:31:19,050
and reference to<font color="#CCCCCC"> another file yes</font>

479
00:31:08,460 --> 00:31:22,920
so I<font color="#E5E5E5"> don't</font><font color="#CCCCCC"> think I've</font><font color="#E5E5E5"> a friend okay so I</font>

480
00:31:19,050 --> 00:31:25,889
would<font color="#E5E5E5"> have started a system on and with</font>

481
00:31:22,920 --> 00:31:29,910
this<font color="#E5E5E5"> man upon reboot this man will have</font>

482
00:31:25,890 --> 00:31:32,880
shown all<font color="#CCCCCC"> the all the process starting</font>

483
00:31:29,910 --> 00:31:35,640
all the creation and<font color="#E5E5E5"> and everything and</font>

484
00:31:32,880 --> 00:31:39,770
<font color="#E5E5E5">I would</font><font color="#CCCCCC"> have</font><font color="#E5E5E5"> seen</font><font color="#CCCCCC"> particularly that it</font>

485
00:31:35,640 --> 00:31:43,290
<font color="#CCCCCC">was started from a legitimate windows</font>

486
00:31:39,770 --> 00:31:47,340
<font color="#CCCCCC">can you show the</font><font color="#E5E5E5"> wtr file that you as</font>

487
00:31:43,290 --> 00:31:51,570
we've seen this just to<font color="#E5E5E5"> jump ahead the</font>

488
00:31:47,340 --> 00:31:54,300
<font color="#CCCCCC">WT or file is actually the file the DLL</font>

489
00:31:51,570 --> 00:31:56,189
that this is a loader that loads the DLL

490
00:31:54,300 --> 00:31:58,500
<font color="#E5E5E5">passes the parameter the same day well</font>

491
00:31:56,190 --> 00:32:00,540
<font color="#E5E5E5">the same water that I showed you during</font>

492
00:31:58,500 --> 00:32:02,730
<font color="#CCCCCC">my demo but if you go to the Windows</font>

493
00:32:00,540 --> 00:32:07,280
folder where it<font color="#E5E5E5"> was it was called</font><font color="#CCCCCC"> sealed</font>

494
00:32:02,730 --> 00:32:07,280
<font color="#E5E5E5">wtr 9001 right</font>

495
00:32:09,170 --> 00:32:17,150
search for<font color="#E5E5E5"> wtr files it's not there so</font>

496
00:32:14,280 --> 00:32:19,290
<font color="#E5E5E5">it means the file was deleted it's gone</font>

497
00:32:17,150 --> 00:32:22,170
possibility or we are<font color="#E5E5E5"> doing with the</font>

498
00:32:19,290 --> 00:32:22,889
rootkit right now so how can we check if

499
00:32:22,170 --> 00:32:25,140
this<font color="#E5E5E5"> is a rootkit</font>

500
00:32:22,890 --> 00:32:26,940
we have to look<font color="#E5E5E5"> at the same system from</font>

501
00:32:25,140 --> 00:32:28,620
a different angle<font color="#E5E5E5"> independent of the</font>

502
00:32:26,940 --> 00:32:29,940
<font color="#E5E5E5">infected system right so</font><font color="#CCCCCC"> we have to</font>

503
00:32:28,620 --> 00:32:35,000
access<font color="#E5E5E5"> the file system and</font><font color="#CCCCCC"> see if the</font>

504
00:32:29,940 --> 00:32:45,870
file is really<font color="#E5E5E5"> there we are wrapping up</font>

505
00:32:35,000 --> 00:32:48,080
don't worry<font color="#CCCCCC"> just</font><font color="#E5E5E5"> last thing to show so</font>

506
00:32:45,870 --> 00:32:49,949
we can now mount<font color="#E5E5E5"> the device</font>

507
00:32:48,080 --> 00:32:52,889
<font color="#CCCCCC">independently from the bit Scout because</font>

508
00:32:49,950 --> 00:32:56,070
<font color="#E5E5E5">this</font><font color="#CCCCCC"> aparte is not infected right it's</font>

509
00:32:52,890 --> 00:32:59,730
<font color="#E5E5E5">safe</font><font color="#CCCCCC"> and then</font><font color="#E5E5E5"> we can look at the file</font>

510
00:32:56,070 --> 00:33:03,179
system from the angle<font color="#E5E5E5"> of</font><font color="#CCCCCC"> the bit Scout</font>

511
00:32:59,730 --> 00:33:05,450
<font color="#E5E5E5">to see if there's any files that as this</font>

512
00:33:03,180 --> 00:33:05,450
name

513
00:33:18,090 --> 00:33:25,570
<font color="#E5E5E5">all right and so finally we can</font><font color="#CCCCCC"> identify</font>

514
00:33:21,940 --> 00:33:27,600
the file that<font color="#E5E5E5"> was just hidden so yet</font>

515
00:33:25,570 --> 00:33:32,649
another rootkit on the Windows machine

516
00:33:27,600 --> 00:33:34,659
<font color="#CCCCCC">and it was this is another reason why</font>

517
00:33:32,650 --> 00:33:36,460
you should<font color="#E5E5E5"> do actually offline forensics</font>

518
00:33:34,660 --> 00:33:38,740
on<font color="#CCCCCC"> the machines you should not rely</font><font color="#E5E5E5"> on</font>

519
00:33:36,460 --> 00:33:40,630
remote forensics that runs imagined<font color="#E5E5E5"> on</font>

520
00:33:38,740 --> 00:33:42,160
the infected<font color="#E5E5E5"> system because you do not</font>

521
00:33:40,630 --> 00:33:44,500
<font color="#E5E5E5">see</font><font color="#CCCCCC"> things like this you'll never</font>

522
00:33:42,160 --> 00:33:47,230
discover<font color="#CCCCCC"> these files</font><font color="#E5E5E5"> otherwise so just</font>

523
00:33:44,500 --> 00:33:51,010
just as a<font color="#E5E5E5"> conclusion</font><font color="#CCCCCC"> I didn't know</font>

524
00:33:47,230 --> 00:33:53,710
anything about remote<font color="#E5E5E5"> 4</font><font color="#CCCCCC"> &</font><font color="#E5E5E5"> 6</font><font color="#CCCCCC"> I didn't</font>

525
00:33:51,010 --> 00:33:58,140
know anything about<font color="#E5E5E5"> debugging</font><font color="#CCCCCC"> um</font><font color="#E5E5E5"> you to</font>

526
00:33:53,710 --> 00:34:02,700
find a boot kit let's say two weeks<font color="#E5E5E5"> ago</font>

527
00:33:58,140 --> 00:34:07,030
with a lot<font color="#CCCCCC"> of work a lot of a lot of</font>

528
00:34:02,700 --> 00:34:08,260
<font color="#E5E5E5">perseverance</font><font color="#CCCCCC"> I was able</font><font color="#E5E5E5"> to do that</font><font color="#CCCCCC"> so in</font>

529
00:34:07,030 --> 00:34:11,469
other<font color="#E5E5E5"> words the message that I want to</font>

530
00:34:08,260 --> 00:34:12,840
<font color="#E5E5E5">pass today is that work hard and</font>

531
00:34:11,469 --> 00:34:16,500
eventually<font color="#E5E5E5"> you will you will succeed</font>

532
00:34:12,840 --> 00:34:19,300
maybe not on stage and under pressure

533
00:34:16,500 --> 00:34:19,510
<font color="#E5E5E5">but other than</font><font color="#CCCCCC"> that yes thank you very</font>

534
00:34:19,300 --> 00:34:25,949
much

535
00:34:19,510 --> 00:34:25,949
[Applause]

