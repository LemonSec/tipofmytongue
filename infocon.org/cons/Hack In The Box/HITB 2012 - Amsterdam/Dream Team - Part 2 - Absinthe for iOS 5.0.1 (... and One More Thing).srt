1
00:00:01,040 --> 00:00:08,040
the yo

2
00:00:15,080 --> 00:00:17,240
well welcome back up

3
00:00:17,240 --> 00:00:20,110
we look to you with third the job rating
and a tie mister

4
00:00:20,110 --> 00:00:24,170
absent ok these welcome %ah

5
00:00:24,170 --> 00:00:31,170
thank you everyone for coming to this
second parts of

6
00:00:31,790 --> 00:00:33,910
our talk

7
00:00:33,910 --> 00:00:36,789
soul I'll we're gonna just a

8
00:00:36,789 --> 00:00:39,859
here a okay

9
00:00:39,859 --> 00:00:43,449
by tonight just can't register the
second thoughts a

10
00:00:43,449 --> 00:00:47,370
we have issue we had issues with the

11
00:00:47,370 --> 00:00:50,670
a fire 5 because its kind of difference

12
00:00:50,670 --> 00:00:55,159
the think the first thoughts ends will
try to explaining why

13
00:00:55,159 --> 00:01:02,159
a st. Francis and only manage change and
break it so

14
00:01:02,809 --> 00:01:06,850
in a summary of pot one oh we've seen
that's

15
00:01:06,850 --> 00:01:11,050
Coco Rocha a for relies on the tethered
jailbreak

16
00:01:11,050 --> 00:01:14,950
to inject me endeavoring payments to
defy system

17
00:01:14,950 --> 00:01:18,450
that's use an interrupt code is started
a

18
00:01:18,450 --> 00:01:22,880
time with the format string back in the
IP sec recommend service

19
00:01:22,880 --> 00:01:26,119
and a and disses

20
00:01:26,119 --> 00:01:30,780
nice because we at this to feature from
managed to disable

21
00:01:30,780 --> 00:01:34,560
et cetera at that time which is right
now

22
00:01:34,560 --> 00:01:38,200
misstates session of eyeless not
possible anymore

23
00:01:38,200 --> 00:01:43,289
also

24
00:01:43,289 --> 00:01:46,719
01 import Singh about the HFS

25
00:01:46,719 --> 00:01:50,840
channel exploits we talked are you is
that it has to be done

26
00:01:50,840 --> 00:01:54,179
as the root user and it has to be done
or so

27
00:01:54,179 --> 00:01:57,609
out to the Recon sandbox attended

28
00:01:57,609 --> 00:02:01,340
explain this after afterwards ans

29
00:02:01,340 --> 00:02:07,229
there this is very quiet and one little
tree Creuset

30
00:02:07,229 --> 00:02:11,290
to just keep ascend books time it's just

31
00:02:11,290 --> 00:02:14,450
batch the record binary and just

32
00:02:14,450 --> 00:02:17,760
change one bites modify the

33
00:02:17,760 --> 00:02:23,540
raccoon profile to just another to
nothing yet effective nursing

34
00:02:23,540 --> 00:02:27,010
just skeet me

35
00:02:27,010 --> 00:02:30,450
the prof i buy just modifying the
entitlements

36
00:02:30,450 --> 00:02:33,700
love them back home sets we have me

37
00:02:33,700 --> 00:02:37,769
a where where thats checked by the camel

38
00:02:37,769 --> 00:02:41,400
at that time so

39
00:02:41,400 --> 00:02:44,970
now a five as

40
00:02:44,970 --> 00:02:49,159
you know success setting a few min

41
00:02:49,159 --> 00:02:52,370
there's no teeth that ship breaking up
the 85

42
00:02:52,370 --> 00:02:55,870
we don't have about level exploit for it

43
00:02:55,870 --> 00:02:59,299
no line rain the so a

44
00:02:59,299 --> 00:03:03,170
we don't at this a backdoor to injects

45
00:03:03,170 --> 00:03:06,670
I was tough to face them so as a
resurgence

46
00:03:06,670 --> 00:03:10,349
up this also weaken decrease the camel

47
00:03:10,349 --> 00:03:15,709
because PDAs I a historic he's asked
statements

48
00:03:15,709 --> 00:03:20,040
when I US sexiness

49
00:03:20,040 --> 00:03:23,489
a me other for us to exploit the camel

50
00:03:23,489 --> 00:03:28,560
and to the actual jailbreak course
hopefully

51
00:03:28,560 --> 00:03:32,319
a miss sounds this summer a

52
00:03:32,319 --> 00:03:35,989
a way to use rock became as in Texas
Tech Talk

53
00:03:35,989 --> 00:03:40,989
for the a-side butts that implies that
we need to get out of the Recon said

54
00:03:40,989 --> 00:03:41,489
books

55
00:03:41,489 --> 00:03:45,769
because this time this the origin record
for trying to exploit nutty

56
00:03:45,769 --> 00:03:49,470
best one agreement the root filesystem

57
00:03:49,470 --> 00:03:53,909
the read/write because by default of
course it is just

58
00:03:53,909 --> 00:03:57,090
read-only so

59
00:03:57,090 --> 00:04:00,519
a which sets

60
00:04:00,519 --> 00:04:03,640
okay as one slight missing

61
00:04:03,640 --> 00:04:06,659
whatever a.m. to adjusting Joshua Hill

62
00:04:06,659 --> 00:04:10,079
which will talk of how we managed to
inject the bailout

63
00:04:10,079 --> 00:04:17,079
%uh

64
00:04:19,140 --> 00:04:22,450
0 a yep

65
00:04:22,450 --> 00:04:26,050
how we manage to actually get the
exploits

66
00:04:26,050 --> 00:04:29,349
inside up filesystem

67
00:04:29,349 --> 00:04:34,530
so Chronicle on probables

68
00:04:34,530 --> 00:04:37,800
we need a new injection vector silly
game

69
00:04:37,800 --> 00:04:42,719
initial code execution files had happy

70
00:04:42,719 --> 00:04:45,950
onto the root filesystem so they can
launch

71
00:04:45,950 --> 00:04:50,640
every time on bill to launch then at

72
00:04:50,640 --> 00:04:55,610
drew file system is read-only so yep
have some kind code running

73
00:04:55,610 --> 00:05:00,529
in order to pointing out that hearst
more problems

74
00:05:00,529 --> 00:05:03,779
a ASLR course

75
00:05:03,779 --> 00:05:07,909
big problem yep the dialing code running
on the device

76
00:05:07,909 --> 00:05:12,839
we have find some kinda information Lee
at

77
00:05:12,839 --> 00:05:19,839
and of course the sandbox profile well

78
00:05:21,300 --> 00:05:24,349
when you need it away to inject commands

79
00:05:24,349 --> 00:05:28,740
in till the track record configuration
so we can

80
00:05:28,740 --> 00:05:32,110
include our payload or are

81
00:05:32,110 --> 00:05:35,789
at and away to bypass ASLR

82
00:05:35,789 --> 00:05:39,070
to generator wrap Taylor through

83
00:05:39,070 --> 00:05:42,800
some kinda information leak or some
other

84
00:05:42,800 --> 00:05:45,979
at

85
00:05:45,979 --> 00:05:48,990
the actual explain here is

86
00:05:48,990 --> 00:05:53,000
in at BP in settings it doesn't

87
00:05:53,000 --> 00:05:56,440
properly validate the input Center

88
00:05:56,440 --> 00:06:01,680
and never checks if you just take that
quotation mark

89
00:06:01,680 --> 00:06:05,209
so much on their yes

90
00:06:05,209 --> 00:06:10,180
at on anyone's cell pp in settings

91
00:06:10,180 --> 00:06:13,240
are injected through a big deal which
are

92
00:06:13,240 --> 00:06:16,450
past director a good thing about this

93
00:06:16,450 --> 00:06:19,779
is that the VPN settings can actually

94
00:06:19,779 --> 00:06:25,020
be that Britain to the device using
mobile back to

95
00:06:25,020 --> 00:06:29,469
their stored in that preferences to me

96
00:06:29,469 --> 00:06:34,270
I example the profile after its

97
00:06:34,270 --> 00:06:37,430
been injected sages

98
00:06:37,430 --> 00:06:40,520
SANDICOR print season akong

99
00:06:40,520 --> 00:06:47,520
XSI XS sign in using crack

100
00:06:48,370 --> 00:06:52,570
unfortunately that

101
00:06:52,570 --> 00:06:57,330
user over the years is limited 255
characters

102
00:06:57,330 --> 00:07:00,560
so star trillion up to sticker

103
00:07:00,560 --> 00:07:03,860
he wrap Taylor

104
00:07:03,860 --> 00:07:07,709
at ok to use the include command
actually

105
00:07:07,709 --> 00:07:12,020
get it till lotta population from
another

106
00:07:12,020 --> 00:07:16,209
a I promised that is

107
00:07:16,209 --> 00:07:19,810
say last profile extremely strict so

108
00:07:19,810 --> 00:07:22,959
there's very few places you can read or
write to

109
00:07:22,959 --> 00:07:27,050
from director so in a defiant

110
00:07:27,050 --> 00:07:32,500
basically someplace allows us to chill

111
00:07:32,500 --> 00:07:36,669
a upload from of the device

112
00:07:36,669 --> 00:07:40,570
but still I reckon to read it

113
00:07:40,570 --> 00:07:44,390
basis sandbox

114
00:07:44,390 --> 00:07:47,800
I at

115
00:07:47,800 --> 00:07:52,479
payload actually found one directory

116
00:07:52,479 --> 00:07:56,519
autos & in half also in the Preferences

117
00:07:56,519 --> 00:08:00,089
directory at comment that Apple

118
00:08:00,089 --> 00:08:03,700
that i ke sec actually

119
00:08:03,700 --> 00:08:07,349
record jury trial and we try to hold
back

120
00:08:07,349 --> 00:08:10,620
cell they're actually able to chill

121
00:08:10,620 --> 00:08:13,740
check demands or check taylor's

122
00:08:13,740 --> 00:08:18,680
that way and hingis

123
00:08:18,680 --> 00:08:25,680
inject commands to load the file from

124
00:08:26,240 --> 00:08:29,510
text

125
00:08:29,510 --> 00:08:34,539
yeah a comeback so now

126
00:08:34,539 --> 00:08:37,700
so now that we're able to set

127
00:08:37,700 --> 00:08:42,190
configuration profile for it year
raccoon demon

128
00:08:42,190 --> 00:08:46,580
which were would trigger exploit we
still have to execute it somehow

129
00:08:46,580 --> 00:08:51,230
so this is for me needed to find a way

130
00:08:51,230 --> 00:08:54,470
that is actually quite often
user-friendly

131
00:08:54,470 --> 00:08:57,560
I'm and the man of jailbreak tool

132
00:08:57,560 --> 00:09:01,850
to me a trigger so I'll what we did

133
00:09:01,850 --> 00:09:05,430
s did some research and I'll found out
that this

134
00:09:05,430 --> 00:09:08,529
up on an on-demand future forty

135
00:09:08,529 --> 00:09:12,079
bpm connection binding annis actually

136
00:09:12,079 --> 00:09:16,600
recorder designed only for certificate
based authentication

137
00:09:16,600 --> 00:09:19,850
so shown what acculturation

138
00:09:19,850 --> 00:09:23,339
profile up and a

139
00:09:23,339 --> 00:09:26,529
provisions that to your defies I'll

140
00:09:26,529 --> 00:09:29,889
with the ship sea for authentication at
would

141
00:09:29,889 --> 00:09:33,420
actually not accept the on demand
feature mud since we

142
00:09:33,420 --> 00:09:37,620
just upright the configuration using the
MoMA back up to

143
00:09:37,620 --> 00:09:41,759
protocol %uh we can just

144
00:09:41,759 --> 00:09:45,269
said these parts of the country
duration: to

145
00:09:45,269 --> 00:09:48,800
I'll shit secret authentication

146
00:09:48,800 --> 00:09:52,540
I'll and at the same time used the
on-demand future

147
00:09:52,540 --> 00:09:55,750
so missus record because

148
00:09:55,750 --> 00:09:59,100
week now actually await your that

149
00:09:59,100 --> 00:10:02,389
the magic happen automatic um but

150
00:10:02,389 --> 00:10:06,180
since this automatically with me we have
to

151
00:10:06,180 --> 00:10:09,439
know and accept time when

152
00:10:09,439 --> 00:10:12,910
I'll a specific URL

153
00:10:12,910 --> 00:10:15,970
or I'll IP address

154
00:10:15,970 --> 00:10:19,730
s I'll yeah

155
00:10:19,730 --> 00:10:24,170
your requested this is a

156
00:10:24,170 --> 00:10:27,529
and in the Gulf unpredictable so its

157
00:10:27,529 --> 00:10:30,670
also a the problem is that not every

158
00:10:30,670 --> 00:10:34,259
like maybe system demand as a

159
00:10:34,259 --> 00:10:38,120
triggering a connection so it's designed
for the user

160
00:10:38,120 --> 00:10:41,639
few this and enterprise network and
opens

161
00:10:41,639 --> 00:10:45,399
email client that with Texas me
enterprise

162
00:10:45,399 --> 00:10:49,209
you mister this word usually trigger bpm
Commission

163
00:10:49,209 --> 00:10:52,209
same with before Safari just typing

164
00:10:52,209 --> 00:10:55,279
you well this defined as: the trigger

165
00:10:55,279 --> 00:10:59,600
URL I'll this would also die connection

166
00:10:59,600 --> 00:11:02,749
um much since we're try to make it

167
00:11:02,749 --> 00:11:06,009
a really easy for the user um

168
00:11:06,009 --> 00:11:09,310
yeah actually I thought type in an
address

169
00:11:09,310 --> 00:11:12,980
in Safari just just not epic because

170
00:11:12,980 --> 00:11:17,730
yeah takes too long to rule type the
address and if it's misspelled

171
00:11:17,730 --> 00:11:20,860
its review not say so me

172
00:11:20,860 --> 00:11:23,870
a thought of another nice feature with

173
00:11:23,870 --> 00:11:27,720
which is called webclip it's basically a
bookmark but for sites on the

174
00:11:27,720 --> 00:11:28,850
springboard

175
00:11:28,850 --> 00:11:31,939
and so just typist

176
00:11:31,939 --> 00:11:35,519
webclip which we provision

177
00:11:35,519 --> 00:11:40,180
together with the VPN connection using
them over to pick up to a protocol

178
00:11:40,180 --> 00:11:45,709
onto the nice and this website with open
to prepare web page

179
00:11:45,709 --> 00:11:50,319
that contains reference team

180
00:11:50,319 --> 00:11:54,060
yup use an image a image attack that

181
00:11:54,060 --> 00:11:57,999
referenced our treating you well so it
wasn't actually noting any

182
00:11:57,999 --> 00:12:01,709
image but it this is the Defiant return
URL

183
00:12:01,709 --> 00:12:05,259
so if you opened this webpage a.m.

184
00:12:05,259 --> 00:12:08,980
this but just trigger a cone to upstart

185
00:12:08,980 --> 00:12:13,249
connection and since we prepare the
country aggression of recurrent

186
00:12:13,249 --> 00:12:17,509
with a yeah the exploits the

187
00:12:17,509 --> 00:12:20,839
a pain old this would just executed

188
00:12:20,839 --> 00:12:23,949
explosion s

189
00:12:23,949 --> 00:12:27,470
Josh already mentioned we still have to

190
00:12:27,470 --> 00:12:30,649
my past is our for the

191
00:12:30,649 --> 00:12:33,970
security feature of I S own

192
00:12:33,970 --> 00:12:37,300
the problem is here that on every board

193
00:12:37,300 --> 00:12:40,720
your on doin me shared cache

194
00:12:40,720 --> 00:12:44,809
is I'll yeah slighted

195
00:12:44,809 --> 00:12:47,990
own every boots so

196
00:12:47,990 --> 00:12:53,059
this means ever space all the libraries
that scientists que Estes

197
00:12:53,059 --> 00:12:57,639
physically shifted and the random way so

198
00:12:57,639 --> 00:13:00,779
yeah it's not really predictable I'll

199
00:13:00,779 --> 00:13:03,930
a sec the binary itself

200
00:13:03,930 --> 00:13:07,029
also haz I am the same

201
00:13:07,029 --> 00:13:10,529
thing about this happens every launch of
the programme

202
00:13:10,529 --> 00:13:13,990
which also makes a not really
predictable

203
00:13:13,990 --> 00:13:17,550
own yeah bath since we are on

204
00:13:17,550 --> 00:13:21,569
and a fire defiance a which does not
have

205
00:13:21,569 --> 00:13:24,779
the long run export cannot aseptic

206
00:13:24,779 --> 00:13:29,209
a disabled are launched a key because at
this stage

207
00:13:29,209 --> 00:13:33,829
we did not remarkable try system
rideable so we have no access to change

208
00:13:33,829 --> 00:13:37,430
this specific entry for the launch team

209
00:13:37,430 --> 00:13:40,730
a demon own yeah at

210
00:13:40,730 --> 00:13:43,829
no to bypassed is in our

211
00:13:43,829 --> 00:13:47,370
we just make use of a nice feature
included

212
00:13:47,370 --> 00:13:51,410
every IRS which has caused the crash
reporting service

213
00:13:51,410 --> 00:13:55,029
justice up if the program

214
00:13:55,029 --> 00:13:58,839
pressures producing really detailed
pressure thought

215
00:13:58,839 --> 00:14:03,879
but some aren't useful information like
affect race where the crash happened

216
00:14:03,879 --> 00:14:07,540
see if you register us base address is
often I was used

217
00:14:07,540 --> 00:14:11,420
and a yep

218
00:14:11,420 --> 00:14:14,800
so this the extra gift

219
00:14:14,800 --> 00:14:18,319
cost me can now the that get some

220
00:14:18,319 --> 00:14:21,709
vital information for our exploit

221
00:14:21,709 --> 00:14:25,189
what we do now s we need to somehow
crash

222
00:14:25,189 --> 00:14:28,529
something and thus crush must happen

223
00:14:28,529 --> 00:14:32,009
and this a specific a yup

224
00:14:32,009 --> 00:14:35,079
to specific place and jailbreak

225
00:14:35,079 --> 00:14:38,809
process own since you cannot rely

226
00:14:38,809 --> 00:14:42,249
on me yeah like waiting for a

227
00:14:42,249 --> 00:14:45,259
program to crash

228
00:14:45,259 --> 00:14:48,509
we actually have to a trust such crash

229
00:14:48,509 --> 00:14:51,829
and yeah the easiest way

230
00:14:51,829 --> 00:14:55,509
to do this in this actually to crash

231
00:14:55,509 --> 00:14:59,449
one of the services that this running on
the device

232
00:14:59,449 --> 00:15:02,540
that can be started on the device um

233
00:15:02,540 --> 00:15:05,749
which are used up by iTunes

234
00:15:05,749 --> 00:15:09,100
as well like the AFC protocol

235
00:15:09,100 --> 00:15:12,259
whatever service pack up certain their

236
00:15:12,259 --> 00:15:15,839
really a lot of service now I'll during
the act

237
00:15:15,839 --> 00:15:18,980
the the year confrontation fourth annual

238
00:15:18,980 --> 00:15:22,180
more way back up to a protocol which was
her

239
00:15:22,180 --> 00:15:25,220
initially shipped with I worst 4.0

240
00:15:25,220 --> 00:15:28,619
um yup I actually

241
00:15:28,619 --> 00:15:32,050
count all a crash that just

242
00:15:32,050 --> 00:15:35,069
you're not really exploitable but status

243
00:15:35,069 --> 00:15:38,499
always happening because it's just
another pointer exception

244
00:15:38,499 --> 00:15:43,040
there's the move my pick up line or just
for my backup service

245
00:15:43,040 --> 00:15:47,360
which this still present on the mission
devices

246
00:15:47,360 --> 00:15:50,550
and actually the the problem was

247
00:15:50,550 --> 00:15:53,920
hi mistype the service name

248
00:15:53,920 --> 00:15:58,309
when trying to implement a move it up to
a protocol discretion the Trinity

249
00:15:58,309 --> 00:15:58,930
ordered

250
00:15:58,930 --> 00:16:02,990
pick up ancient and this is holding a
half pound a crash

251
00:16:02,990 --> 00:16:07,290
the trust for any suitable for our
purpose

252
00:16:07,290 --> 00:16:10,600
okay now that we are a bit too crossed a
crash

253
00:16:10,600 --> 00:16:14,389
the at yeah apps command

254
00:16:14,389 --> 00:16:19,279
basically we can the with mister need to
get this pressure or somehow

255
00:16:19,279 --> 00:16:23,309
and what we do is actually nothing else
what iTunes also to us

256
00:16:23,309 --> 00:16:27,160
if the crash happens defies store such
pressure for

257
00:16:27,160 --> 00:16:30,459
if you attach a device to your computer
by chance

258
00:16:30,459 --> 00:16:33,980
with a copy over at the crash reports

259
00:16:33,980 --> 00:16:37,410
I want for this purpose we have to

260
00:16:37,410 --> 00:16:43,309
services one has a crush important for
her which were just more

261
00:16:43,309 --> 00:16:47,449
the store fresh reports from here
original location to

262
00:16:47,449 --> 00:16:53,480
another location which is van available
as a CH 105 min for the pressure will

263
00:16:53,480 --> 00:16:56,509
report Copy Service which is nothing
more

264
00:16:56,509 --> 00:17:00,230
than just a plaintiff see service but
though still

265
00:17:00,230 --> 00:17:03,740
excess fights again copy them you can
deter

266
00:17:03,740 --> 00:17:07,900
you can you come fright your fights and
to this location

267
00:17:07,900 --> 00:17:11,709
yep that's basically it so

268
00:17:11,709 --> 00:17:14,829
know I can just copy all of you
discretion parts

269
00:17:14,829 --> 00:17:18,740
aren't just parse them and

270
00:17:18,740 --> 00:17:22,079
yeltsin's the special part contains at
recess

271
00:17:22,079 --> 00:17:26,170
40 libraries we can take one of the
library stand

272
00:17:26,170 --> 00:17:30,230
US unknown address of function Chu

273
00:17:30,230 --> 00:17:33,830
get the slight offset of CSR

274
00:17:33,830 --> 00:17:36,840
from video you okay chef cash

275
00:17:36,840 --> 00:17:43,780
20 p being ever to generate a pet goat
feed for Oracle

276
00:17:43,780 --> 00:17:46,880
yep this

277
00:17:46,880 --> 00:17:52,820
artists for David

278
00:17:52,820 --> 00:17:56,510
hey thanks I'll so my part presentation
is a

279
00:17:56,510 --> 00:17:59,870
breaking out attacks in the sandbox as

280
00:17:59,870 --> 00:18:03,740
Joshin yes I showed you that we now have
the ability to

281
00:18:03,740 --> 00:18:07,120
honestok 85 device to execute

282
00:18:07,120 --> 00:18:10,530
rack should with a configuration file
are choosing

283
00:18:10,530 --> 00:18:13,540
unfortunately the stock copyright unit
still stand box

284
00:18:13,540 --> 00:18:17,120
and in order to launch the kernel
exploit will need to

285
00:18:17,120 --> 00:18:21,470
of breakouts box so the show's

286
00:18:21,470 --> 00:18:24,700
so what is the sandbox well so sandbox

287
00:18:24,700 --> 00:18:28,270
of itself its codename seatbelt it's
based off the

288
00:18:28,270 --> 00:18:33,780
trust trusted yes a mandatory access
from work early as part of its actually

289
00:18:33,780 --> 00:18:35,890
split into two different parts

290
00:18:35,890 --> 00:18:40,180
one is a car lights that kernel
extension called sandbox stock axed and

291
00:18:40,180 --> 00:18:41,480
the other is these

292
00:18:41,480 --> 00:18:46,780
mandatory access control and sandbox
like axe is actually the grains of sand

293
00:18:46,780 --> 00:18:47,650
box

294
00:18:47,650 --> 00:18:50,690
whereas Optimax free markets house

295
00:18:50,690 --> 00:18:55,930
how the sandbox exchange forces the
sandbox policies

296
00:18:55,930 --> 00:19:00,170
so how does than actually working for
sandbox us

297
00:19:00,170 --> 00:19:04,050
well and a lot of days doctor no
interfaces

298
00:19:04,050 --> 00:19:07,380
that a Caesar lawn of these calls arm

299
00:19:07,380 --> 00:19:11,540
one compile trust in politics come pick
Mac ask flag

300
00:19:11,540 --> 00:19:14,760
%uh day all holidays various

301
00:19:14,760 --> 00:19:19,090
different functions that check if that
particular process

302
00:19:19,090 --> 00:19:23,470
is allowed to do is perform a search in
action so these Mac

303
00:19:23,470 --> 00:19:27,710
I Mac checks are enforcing are processed
by process basis

304
00:19:27,710 --> 00:19:30,710
as you can see there's a lot of
different granny

305
00:19:30,710 --> 00:19:34,250
at different checks and a lot of
granularity stay how

306
00:19:34,250 --> 00:19:38,330
how much they can be how access control

307
00:19:38,330 --> 00:19:41,570
so as a side FINA slide up

308
00:19:41,570 --> 00:19:44,720
one make any relevant Carl interface
called check

309
00:19:44,720 --> 00:19:48,480
hola those checks before performing
action and

310
00:19:48,480 --> 00:19:51,930
you can see her previous life that are
there a lot different category so

311
00:19:51,930 --> 00:19:53,100
basically hooks into

312
00:19:53,100 --> 00:19:56,370
every conceivable part the system you
know if

313
00:19:56,370 --> 00:20:01,250
the file interaction file POSIX some of
our system 5 message choose

314
00:20:01,250 --> 00:20:04,690
sockets like all States I okay

315
00:20:04,690 --> 00:20:09,690
I'll but the maximum doesn't really do
anything by itself

316
00:20:09,690 --> 00:20:13,530
I'll happens is that relies on other
parts of the trial to register

317
00:20:13,530 --> 00:20:17,380
what are called max Hall's and a time
any of them act

318
00:20:17,380 --> 00:20:21,610
framework call backs are call it just
call

319
00:20:21,610 --> 00:20:26,200
call backs in the policies the policies
are basically a giant this to function

320
00:20:26,200 --> 00:20:29,860
call function players that the max a
mark is supposed to call into to

321
00:20:29,860 --> 00:20:32,640
determine if an action is allowed

322
00:20:32,640 --> 00:20:35,790
cell then we get to the sandbox

323
00:20:35,790 --> 00:20:39,460
our extension and and it is a registered
back all seen

324
00:20:39,460 --> 00:20:43,150
and wants initializing register itself
as a nap all CNS

325
00:20:43,150 --> 00:20:47,130
a giant mister functions that up that
are called into

326
00:20:47,130 --> 00:20:52,200
at to determine whether I'll whether a
particular process allowed to do any

327
00:20:52,200 --> 00:20:55,760
of the Wayne that the sandbox

328
00:20:55,760 --> 00:20:58,850
HOA Sandbach trial extension determines
whether Paul

329
00:20:58,850 --> 00:21:02,310
whether a program is allowed to do
something is in

330
00:21:02,310 --> 00:21:06,490
a few ways first processes can often to
the sandbox ATI

331
00:21:06,490 --> 00:21:10,000
there's a there's a function call arts
and boxing net

332
00:21:10,000 --> 00:21:13,170
dad that's part of the West Ham library

333
00:21:13,170 --> 00:21:17,630
that Chen have a process of into
particular sandbox profile which

334
00:21:17,630 --> 00:21:18,390
determines

335
00:21:18,390 --> 00:21:21,530
what things it's allowed to your not of

336
00:21:21,530 --> 00:21:24,640
entitlements as sorry earlier there's a

337
00:21:24,640 --> 00:21:28,450
there's a part there said a bit above
it's a proper

338
00:21:28,450 --> 00:21:31,550
property this attached to every single
all

339
00:21:31,550 --> 00:21:35,130
Marco Beyer a on a left-hand and

340
00:21:35,130 --> 00:21:38,590
and I last that determines that has a

341
00:21:38,590 --> 00:21:42,140
list a property entitlements that the
process is a lot to do and

342
00:21:42,140 --> 00:21:45,920
one day entitlements is what Sam Bass
Pro fault

343
00:21:45,920 --> 00:21:48,920
or yes an application is launched from

344
00:21:48,920 --> 00:21:52,010
Marmol applications which is where all
the %ah

345
00:21:52,010 --> 00:21:57,180
abstracts reinstall then container
sandbox the containers and boxes the

346
00:21:57,180 --> 00:21:59,350
default sandbox for abstracts

347
00:21:59,350 --> 00:22:03,860
thats force so I'll profiles are matched
by sandbox the

348
00:22:03,860 --> 00:22:07,160
still in profiles their match buyouts at
this

349
00:22:07,160 --> 00:22:11,110
additional 30 min costs and mocks the
wish to trial communicates with

350
00:22:11,110 --> 00:22:14,350
whatsoever process request to use a
certain profile

351
00:22:14,350 --> 00:22:18,740
the car last Sandboxie to you tell like
Zac profile

352
00:22:18,740 --> 00:22:22,760
what exact settings to apply whats app
profile this

353
00:22:22,760 --> 00:22:26,520
and profiles are like Compal tiny steam
programs are

354
00:22:26,520 --> 00:22:29,740
extremely complex and AR you can

355
00:22:29,740 --> 00:22:34,210
they can had very fine granular control
over everything

356
00:22:34,210 --> 00:22:37,230
and here's an example %uh a the source
code

357
00:22:37,230 --> 00:22:40,820
for a profile and it happens to be the
sandbox profile

358
00:22:40,820 --> 00:22:44,130
they are process that we're concerned
with which the structure

359
00:22:44,130 --> 00:22:48,120
and you can see that by the fall Italian
out to do anything

360
00:22:48,120 --> 00:22:53,030
but it's a lot to do is allowed to
access certain locations such as a

361
00:22:53,030 --> 00:22:56,790
up library preferences as %ah

362
00:22:56,790 --> 00:23:01,810
yet joshing yes a preference it's lots
rights to its own mark Wiles

363
00:23:01,810 --> 00:23:04,930
as a lot it s another things likes
access earned

364
00:23:04,930 --> 00:23:08,250
mock services using my PC an accessor

365
00:23:08,250 --> 00:23:12,700
shared memory areas here

366
00:23:12,700 --> 00:23:16,570
so up so server

367
00:23:16,570 --> 00:23:20,250
Kappa but state earlier why do we care
as faction

368
00:23:20,250 --> 00:23:23,370
as the IPSec team and we actually
running as root

369
00:23:23,370 --> 00:23:26,830
but because sandbox profile you can up

370
00:23:26,830 --> 00:23:31,090
even processes running as root are
restricted in what they can do

371
00:23:31,090 --> 00:23:35,070
as a security precaution against ice you
know people like us to do stuff like

372
00:23:35,070 --> 00:23:36,040
this

373
00:23:36,040 --> 00:23:39,580
so I'll but you know forty

374
00:23:39,580 --> 00:23:44,300
a foreign tether meeting actually need
to we can actually need to do anything

375
00:23:44,300 --> 00:23:47,820
got difficult to get past sandbox and
the reason is because

376
00:23:47,820 --> 00:23:51,040
Apple me they're pretty silly mistake
I'll

377
00:23:51,040 --> 00:23:54,450
this is the entitlements for their
actions process

378
00:23:54,450 --> 00:23:59,130
as cassini over here says see Felpro
faucet does a code name for a sandbox SS

379
00:23:59,130 --> 00:24:00,130
fraction

380
00:24:00,130 --> 00:24:04,630
so it tells a colonel when you execute
distraction by reapplying

381
00:24:04,630 --> 00:24:07,980
their action profile so that's great

382
00:24:07,980 --> 00:24:12,590
arm but what we did was it just passed
this one by

383
00:24:12,590 --> 00:24:15,850
from profiles across three s

384
00:24:15,850 --> 00:24:20,780
and this causes this profile this he not
to be recognized

385
00:24:20,780 --> 00:24:23,870
and Sam Bass Pro five star for

386
00:24:23,870 --> 00:24:27,560
not applied how can we do this how this
is

387
00:24:27,560 --> 00:24:32,080
break code signing it does not if you
just have fiery passion the

388
00:24:32,080 --> 00:24:35,420
entitlements for a process it doesn't
actually break code signing

389
00:24:35,420 --> 00:24:39,600
Apple still recognize back showing as a
sign application by Apple

390
00:24:39,600 --> 00:24:42,930
villages xx here without the sandbox
profile which is

391
00:24:42,930 --> 00:24:46,380
here on but

392
00:24:46,380 --> 00:24:51,500
shell are we done 3 just all we need to
do is pass out one by an hour outside

393
00:24:51,500 --> 00:24:52,700
the box right

394
00:24:52,700 --> 00:24:56,980
well not quite that thing is that we
actually need a way to get

395
00:24:56,980 --> 00:25:01,580
first pass coffee a fraction onto I ally
spa system

396
00:25:01,580 --> 00:25:05,000
and we also need to convince I last saw
you execute

397
00:25:05,000 --> 00:25:09,350
action West a copy of our our past
configuration file

398
00:25:09,350 --> 00:25:13,720
asked in order to do anything and just
so that this is the way we did any on

399
00:25:13,720 --> 00:25:14,530
tether

400
00:25:14,530 --> 00:25:18,080
is I'll is such a launch takeoff which
is a which

401
00:25:18,080 --> 00:25:22,420
tells launch day which is like process
wine and ISL s world like

402
00:25:22,420 --> 00:25:26,350
it in the next world and tells it too
launched at two

403
00:25:26,350 --> 00:25:30,560
those después which tells it too right

404
00:25:30,560 --> 00:25:34,790
action at find the stash first pop your
back shooting

405
00:25:34,790 --> 00:25:38,810
with rx like configuration file and
disable a Sr

406
00:25:38,810 --> 00:25:42,600
so that's great and we can put that
those two files

407
00:25:42,600 --> 00:25:47,810
on the file system with lime rain but
for a5 us as they fix the poor on

408
00:25:47,810 --> 00:25:51,560
exploit that live relies upon we can't
do that

409
00:25:51,560 --> 00:25:55,070
but what we can do as I think yes
explain

410
00:25:55,070 --> 00:25:59,600
all we can do is we can check this that
default version iraq shooting

411
00:25:59,600 --> 00:26:02,910
using those deep and settings that he
talked about to rally the next like

412
00:26:02,910 --> 00:26:04,020
configuration file

413
00:26:04,020 --> 00:26:07,360
that we can use mobile mobile backup and
other stuff too

414
00:26:07,360 --> 00:26:10,810
restore onto so I'll soul

415
00:26:10,810 --> 00:26:15,170
the only thing we need to do that is to
get out a sandbox are running as faction

416
00:26:15,170 --> 00:26:18,790
so he can remain out there route as
read/write

417
00:26:18,790 --> 00:26:21,830
and to you get the patch version I'm
back soon to follow

418
00:26:21,830 --> 00:26:25,860
onto the filesystem and then launched at
Patch per share action: that doesn't

419
00:26:25,860 --> 00:26:27,270
have a sandbox

420
00:26:27,270 --> 00:26:31,600
but you know you're in Archer run the
patch version direction that doesn't

421
00:26:31,600 --> 00:26:34,650
that's nine a sandbox me the first state
to sandbox

422
00:26:34,650 --> 00:26:37,910
there's like a chicken and fish sewing
to find another way to escape the

423
00:26:37,910 --> 00:26:39,680
sandbox

424
00:26:39,680 --> 00:26:43,610
fortunately in the sandbox is not
entirely without flaws

425
00:26:43,610 --> 00:26:48,060
I'll what we found is that this is
called heat race

426
00:26:48,060 --> 00:26:51,200
which you know might be familiar to you
next it offers s

427
00:26:51,200 --> 00:26:56,110
as a debugging call the GDP uses for
example to debug other processes

428
00:26:56,110 --> 00:26:59,810
I teach race is not use that much

429
00:26:59,810 --> 00:27:04,490
on a westech because there are more
powerful interface is on a list and

430
00:27:04,490 --> 00:27:07,880
because par the last 10 tried all is
mock

431
00:27:07,880 --> 00:27:12,190
and locking do is actually have thought
that processes talk to each other

432
00:27:12,190 --> 00:27:16,470
using are were yet underscore calls that
let you

433
00:27:16,470 --> 00:27:20,340
basically you can the map another
processes memory

434
00:27:20,340 --> 00:27:23,750
into your own memory space you can
examines threads region

435
00:27:23,750 --> 00:27:26,830
you can control the other processes
threats and

436
00:27:26,830 --> 00:27:30,870
also is a powerful stuff that you can't
really do with Pete race

437
00:27:30,870 --> 00:27:34,670
and that GB on last 10 years soapy trace

438
00:27:34,670 --> 00:27:39,760
on the list 10 is not very powerful and
actually on I lasts nights kinda bugging

439
00:27:39,760 --> 00:27:42,220
me it doesn't really work properly

440
00:27:42,220 --> 00:27:46,580
but States adults and paid much
attention to it since not

441
00:27:46,580 --> 00:27:51,180
that not very necessary it's also quite
unrestricted

442
00:27:51,180 --> 00:27:55,360
soul be happy trace what can we do it P
chase

443
00:27:55,360 --> 00:27:58,740
well we can do it P traces possibly use
it to control

444
00:27:58,740 --> 00:28:02,020
on sandbox process where ru so

445
00:28:02,020 --> 00:28:05,370
we could possibly P chase to attach you
another

446
00:28:05,370 --> 00:28:08,740
process that's not restricted by sandbox
and yet it

447
00:28:08,740 --> 00:28:12,000
to do something for us %uh

448
00:28:12,000 --> 00:28:16,150
sup this is showing you that Pinterest
doesn't really have an answer

449
00:28:16,150 --> 00:28:19,360
sandbox checks I'll the only

450
00:28:19,360 --> 00:28:22,790
to-ing check that is %ah that

451
00:28:22,790 --> 00:28:26,470
it does for authorization is a

452
00:28:26,470 --> 00:28:30,400
k of authorize process this call right
here

453
00:28:30,400 --> 00:28:33,800
and

454
00:28:33,800 --> 00:28:39,140
so this goes that the source of this
function is right here

455
00:28:39,140 --> 00:28:42,530
and 4k of process can trace

456
00:28:42,530 --> 00:28:45,580
which is what the previous function call
it is 'cause

457
00:28:45,580 --> 00:28:48,700
this function can trace

458
00:28:48,700 --> 00:28:52,030
can trace checks for commissions much
like I'll

459
00:28:52,030 --> 00:28:55,130
how UNIX traditionally expressions UK

460
00:28:55,130 --> 00:28:58,700
you can transfer process yes it's a
process that's doing that racing

461
00:28:58,700 --> 00:29:03,100
it's already been traced it or it's now
owned by you or say

462
00:29:03,100 --> 00:29:08,100
said I D on exact foster so those are
very traditional UNIX restrictions

463
00:29:08,100 --> 00:29:12,250
there's no layered sandbox issues here s
inspection is running as root

464
00:29:12,250 --> 00:29:15,360
we basically have carte blanche to I to

465
00:29:15,360 --> 00:29:18,900
pit race any process on this on the OS

466
00:29:18,900 --> 00:29:21,960
walk on

467
00:29:21,960 --> 00:29:25,640
so bad fortune ahtext discuss P chase

468
00:29:25,640 --> 00:29:28,660
on OS 10 is not

469
00:29:28,660 --> 00:29:32,280
harmful at all it's not it's not
something that you would usually use for

470
00:29:32,280 --> 00:29:33,390
debugging

471
00:29:33,390 --> 00:29:37,330
it doesn't it doesn't it can do a lot
things up sentry some

472
00:29:37,330 --> 00:29:41,510
for example the next and the next
handset break points in P Tracy can

473
00:29:41,510 --> 00:29:44,920
HN uptick in Polk memory it cannot

474
00:29:44,920 --> 00:29:48,300
it can't softer stop the process on says
calls

475
00:29:48,300 --> 00:29:51,560
but the OS embers and teachers getting
on these things

476
00:29:51,560 --> 00:29:55,280
lot of functionality broken but what
does it work

477
00:29:55,280 --> 00:29:59,500
is PT continue I'll

478
00:29:59,500 --> 00:30:02,770
a cat single step through a process
because on

479
00:30:02,770 --> 00:30:05,770
I less threat set single step

480
00:30:05,770 --> 00:30:09,620
always returns failure actually does
nothing but returned dire

481
00:30:09,620 --> 00:30:12,710
so when it gets here when a function
gets here

482
00:30:12,710 --> 00:30:15,900
ill always try air not not supported

483
00:30:15,900 --> 00:30:19,940
and then could you know leave the if the
the execution

484
00:30:19,940 --> 00:30:23,960
but before you do that before it does
that actually successfully cause threat

485
00:30:23,960 --> 00:30:25,560
said entry point

486
00:30:25,560 --> 00:30:28,910
and all this function does is in the ER
in

487
00:30:28,910 --> 00:30:32,290
in the structure from threatening to
turn all in the

488
00:30:32,290 --> 00:30:36,250
structured s that saves a register state
up the thread

489
00:30:36,250 --> 00:30:39,990
are it just sets the PC to whatever he
walked

490
00:30:39,990 --> 00:30:42,990
so basically what we can do it this

491
00:30:42,990 --> 00:30:46,730
is control the PC control the

492
00:30:46,730 --> 00:30:50,490
program counter %uh any other process

493
00:30:50,490 --> 00:30:54,200
all so even it successfully says a PC

494
00:30:54,200 --> 00:30:57,270
and then airs out but it it

495
00:30:57,270 --> 00:31:02,230
the PC setting day it does set means me
act

496
00:31:02,230 --> 00:31:06,730
seller to limitations up what we can do
with this method

497
00:31:06,730 --> 00:31:10,430
well control PC but only on the first
read

498
00:31:10,430 --> 00:31:14,970
because she traces have the facilities
for selecting what threat a process

499
00:31:14,970 --> 00:31:19,780
we control and the only register we can
control his PC because none of the other

500
00:31:19,780 --> 00:31:21,900
stuff P chase works we can't set

501
00:31:21,900 --> 00:31:25,020
the the registers on any of the other
registers

502
00:31:25,020 --> 00:31:28,910
on that threat that we control and also
another thing that

503
00:31:28,910 --> 00:31:33,260
really really like a bothered us and
took us a long time to figure out

504
00:31:33,260 --> 00:31:36,710
is we can switch between armand dunno
and this is a

505
00:31:36,710 --> 00:31:39,950
I D A down a threat accept returns

506
00:31:39,950 --> 00:31:43,320
which is how law just how all

507
00:31:43,320 --> 00:31:47,080
functions on our on I last HR

508
00:31:47,080 --> 00:31:50,210
from says calls and saw up

509
00:31:50,210 --> 00:31:53,290
as demonstrates why you can't switch for
Harmattan

510
00:31:53,290 --> 00:31:56,320
Acme people don't know about the %ah

511
00:31:56,320 --> 00:31:59,990
are ARM architecture but is actually to
instruction sets

512
00:31:59,990 --> 00:32:04,680
arm and Dom on is a 32-bit instructions
sent on Sat 16

513
00:32:04,680 --> 00:32:09,400
instruction set so if you try to if
you're in arm mode it's a jump into the

514
00:32:09,400 --> 00:32:10,630
middle timecode

515
00:32:10,630 --> 00:32:13,830
than you know it's I don't work and shop
dumped

516
00:32:13,830 --> 00:32:17,850
heir-apparent online China jump into
middle arm kurtz I don't work either

517
00:32:17,850 --> 00:32:21,120
you actually have to set a at it inside
the

518
00:32:21,120 --> 00:32:24,340
etc a.m. special register call CPS

519
00:32:24,340 --> 00:32:27,940
are the done that which set which sets
the processor noting

520
00:32:27,940 --> 00:32:31,290
instruction the instruction set that you
uses

521
00:32:31,290 --> 00:32:34,760
and this function is how all how all of
the

522
00:32:34,760 --> 00:32:38,190
processes return from syscall soul

523
00:32:38,190 --> 00:32:42,990
this part is our load sieck sporty into
our foreign jokes forty is where the

524
00:32:42,990 --> 00:32:44,700
previous EPS are less

525
00:32:44,700 --> 00:32:48,040
was stored and desist order into

526
00:32:48,040 --> 00:32:51,710
s SDSR which is the same CTS or register

527
00:32:51,710 --> 00:32:54,750
and when you reach our from the
instruction

528
00:32:54,750 --> 00:32:59,540
I'll lr2 PC this STS are setting is
restore trust

529
00:32:59,540 --> 00:33:02,930
PSR so in that way out whatever

530
00:33:02,930 --> 00:33:07,630
whatever download that was stored n0
exporting is going to be active after

531
00:33:07,630 --> 00:33:09,350
this function returns

532
00:33:09,350 --> 00:33:12,390
so even when even if you can set PC like

533
00:33:12,390 --> 00:33:16,030
attracts a entry point set this value
right here

534
00:33:16,030 --> 00:33:20,370
and this gets I gets written to PC even
if he said PC

535
00:33:20,370 --> 00:33:23,410
that done bit is still whatever it was

536
00:33:23,410 --> 00:33:27,310
when you I'll when you entered well when
the process was break

537
00:33:27,310 --> 00:33:31,420
was it was I'll was interrupted own when
there was a context which

538
00:33:31,420 --> 00:33:36,280
so this light can switch between aren't
download using that method

539
00:33:36,280 --> 00:33:40,770
om cell

540
00:33:40,770 --> 00:33:44,180
so how how can we use this

541
00:33:44,180 --> 00:33:47,290
this control over PC for evil

542
00:33:47,290 --> 00:33:50,650
to la how can we do it we walked with it

543
00:33:50,650 --> 00:33:53,800
so record through we can manipulate any
other process

544
00:33:53,800 --> 00:33:56,800
including not sandbox once and we can
control

545
00:33:56,800 --> 00:33:59,940
PC so maybe we can use rock

546
00:33:59,940 --> 00:34:03,870
but so are up to work in a two
ingredients warning to control

547
00:34:03,870 --> 00:34:09,159
stack and then one in each at the other
is you need to control program PC

548
00:34:09,159 --> 00:34:12,429
are yeah cell

549
00:34:12,429 --> 00:34:15,470
it's actually pretty interesting me I
use dropped to

550
00:34:15,470 --> 00:34:19,310
set up a situation where we use Robin
another process

551
00:34:19,310 --> 00:34:22,950
so is right to launch rock are

552
00:34:22,950 --> 00:34:27,230
so here so we selected object Mr victim
process for action yes

553
00:34:27,230 --> 00:34:30,470
is notify Team and ID is a core
component

554
00:34:30,470 --> 00:34:33,639
Apple's a notification system

555
00:34:33,639 --> 00:34:37,550
all what it does its allows kinda but

556
00:34:37,550 --> 00:34:40,659
there a generic form of IPCC that

557
00:34:40,659 --> 00:34:44,869
has a very easy to use interface you can
use it to notify all processes in a

558
00:34:44,869 --> 00:34:45,519
system

559
00:34:45,519 --> 00:34:49,210
I'll its some sources state that like
the wifi settings changed or something

560
00:34:49,210 --> 00:34:50,309
like that

561
00:34:50,309 --> 00:34:53,759
an almost all processes can talk to me
fighting

562
00:34:53,759 --> 00:34:57,359
and I'll and also they have access to
notify

563
00:34:57,359 --> 00:35:00,390
these shared memory area so we can so

564
00:35:00,390 --> 00:35:04,099
if they can use a shame area should have
action right

565
00:35:04,099 --> 00:35:07,789
right to Ann Arbor trail are stacked for
notified eavesdrop

566
00:35:07,789 --> 00:35:11,200
into it and then we can tell your ID to
tippit to thats

567
00:35:11,200 --> 00:35:15,079
add to that shared memory area and rough
in there so we don't have any space

568
00:35:15,079 --> 00:35:16,529
limitations

569
00:35:16,529 --> 00:35:21,859
I'll we can also get stuff on to notify
the staff at Makai PC

570
00:35:21,859 --> 00:35:25,819
which is how to unlock my PC is how r
how

571
00:35:25,819 --> 00:35:29,749
every process normally tossing out of
it. and also

572
00:35:29,749 --> 00:35:33,119
another useful thing that we can do it
ideas that we can make it blocked

573
00:35:33,119 --> 00:35:34,339
deterministically

574
00:35:34,339 --> 00:35:38,730
and also how arse have whatever you want
to deterministically

575
00:35:38,730 --> 00:35:42,339
on the stack at the same time so I'm
gonna show you

576
00:35:42,339 --> 00:35:46,849
I'm gonna prove these four points annex
lines

577
00:35:46,849 --> 00:35:50,119
so this is the profile for action again

578
00:35:50,119 --> 00:35:53,359
as he gets a over here Mia

579
00:35:53,359 --> 00:35:56,690
only allowed to look up the Notification
Center are

580
00:35:56,690 --> 00:36:02,430
box service and were allowed to access
the Notification Center shared memory

581
00:36:02,430 --> 00:36:03,099
area

582
00:36:03,099 --> 00:36:07,230
so know if I can slot tax to interact
with at

583
00:36:07,230 --> 00:36:10,589
at back as allowed to interact with
their fighting

584
00:36:10,589 --> 00:36:13,700
of here is the source code for all

585
00:36:13,700 --> 00:36:18,019
for apart notified he's called service
mock message is the main

586
00:36:18,019 --> 00:36:21,069
server though that that listens to all
the

587
00:36:21,069 --> 00:36:25,319
every class all the mock but requests
coming in

588
00:36:25,319 --> 00:36:28,680
and our response and ask Jesse

589
00:36:28,680 --> 00:36:31,910
up every season message over here and
yes these

590
00:36:31,910 --> 00:36:35,519
stack but first to receive the message
our bus where

591
00:36:35,519 --> 00:36:38,920
the BC best sets an ass but his word

592
00:36:38,920 --> 00:36:42,950
the wear on their fight his reply it's
going to be

593
00:36:42,950 --> 00:36:49,170
so our message comes over here and that
it tries to send a reply over here

594
00:36:49,170 --> 00:36:53,329
and an interesting part the mock
messaging system

595
00:36:53,329 --> 00:36:56,970
is that the Q for the messaging system
by the whole is only

596
00:36:56,970 --> 00:37:00,339
five messages deep so basically

597
00:37:00,339 --> 00:37:03,490
if there's already five messages in a in
a dress

598
00:37:03,490 --> 00:37:07,440
priests into processes are a receives
you

599
00:37:07,440 --> 00:37:11,499
H SMS text message that the kernel is
going to make you block

600
00:37:11,499 --> 00:37:16,539
until other processed decides to receive
one or more other messages

601
00:37:16,539 --> 00:37:19,660
so all we have to do is send out a
five-game

602
00:37:19,660 --> 00:37:22,990
six messages over here and refuse to
actually

603
00:37:22,990 --> 00:37:28,269
actually receive an answer replies and
I'll just get stuck here forever

604
00:37:28,269 --> 00:37:32,859
and after stuck here forever we will
know that whatever he said

605
00:37:32,859 --> 00:37:37,529
it will be an ARB up on the stack and
the reply which will be based on

606
00:37:37,529 --> 00:37:39,529
whatever we set will be on tests of

607
00:37:39,529 --> 00:37:43,339
in this stop so

608
00:37:43,339 --> 00:37:47,809
nah case we have hot all the ingredients
for rock we can control PC and we can

609
00:37:47,809 --> 00:37:49,210
control it on a stack

610
00:37:49,210 --> 00:37:52,890
very deterministically so all

611
00:37:52,890 --> 00:37:56,359
this is going to be an overview a are
exploit

612
00:37:56,359 --> 00:38:00,839
I'll the way we wrote our explains
actually with a very clever our prop

613
00:38:00,839 --> 00:38:02,999
generation program that cereal

614
00:38:02,999 --> 00:38:08,579
well I it actually consists of several
different macros that that sa

615
00:38:08,579 --> 00:38:12,259
that lousy to do common drop expressions
like a

616
00:38:12,259 --> 00:38:16,339
call functions and %ah load register
from memory actually

617
00:38:16,339 --> 00:38:19,730
it's almost like a rock compiler
targeted towards back

618
00:38:19,730 --> 00:38:23,940
format strings in particular so is it
was very easy to prepare

619
00:38:23,940 --> 00:38:27,390
to generate all sorts of complex %ah
I'll

620
00:38:27,390 --> 00:38:31,349
rock programs and are

621
00:38:31,349 --> 00:38:35,339
I'd don't have time to take it through
that full source

622
00:38:35,339 --> 00:38:38,650
a the Explorer the explain generation

623
00:38:38,650 --> 00:38:42,730
a the rock generation but basically the
idea of the ROP

624
00:38:42,730 --> 00:38:47,249
inside direction is that first week
trading on sandbox version

625
00:38:47,249 --> 00:38:51,220
a fraction and put in place where we can
try and change mode

626
00:38:51,220 --> 00:38:54,519
%uh so that's execute a ball all

627
00:38:54,519 --> 00:38:59,069
we down we have to find notified EPID

628
00:38:59,069 --> 00:39:03,319
that put notified his main thread on the
IPCC threat

629
00:39:03,319 --> 00:39:07,220
because remember we are I made remember
we can only control

630
00:39:07,220 --> 00:39:10,579
main thread other victim process and

631
00:39:10,579 --> 00:39:15,319
as it happens service mock message is
actually not the main threats the second

632
00:39:15,319 --> 00:39:16,029
thread

633
00:39:16,029 --> 00:39:19,049
the first rate is actually at threat
that just does nothing

634
00:39:19,049 --> 00:39:23,299
the licence to Pasig signals like said
user one sec user to in

635
00:39:23,299 --> 00:39:28,369
and does some you know dump some data on
their whenever he sees a signals

636
00:39:28,369 --> 00:39:32,089
so we don't we don't want to control
that train lost control second thread

637
00:39:32,089 --> 00:39:36,210
so we can do is we can make that threat
that thread

638
00:39:36,210 --> 00:39:39,450
by changing its pc2 law

639
00:39:39,450 --> 00:39:43,279
to underscore underscore PST threat
terminating

640
00:39:43,279 --> 00:39:46,970
prey on the slide that this this cost
the first right to terminate

641
00:39:46,970 --> 00:39:50,220
leaving the second threat as the main
threat and then we can

642
00:39:50,220 --> 00:39:53,259
directly control their control that
right

643
00:39:53,259 --> 00:39:57,440
so then we block notified the what are
exploited PC message which has

644
00:39:57,440 --> 00:39:58,900
beginnings a stack

645
00:39:58,900 --> 00:40:03,190
and then after the afternoon if I D is
blocked we can write the rest of the

646
00:40:03,190 --> 00:40:05,589
rocks back to the shared memory area

647
00:40:05,589 --> 00:40:09,170
and then we can set PC to somewhere

648
00:40:09,170 --> 00:40:12,460
that me that does a proper thing to the
stock topping writ

649
00:40:12,460 --> 00:40:16,249
that we setup using the ex-player PC
message and

650
00:40:16,249 --> 00:40:20,359
check memory area and launch the exploit
that way

651
00:40:20,359 --> 00:40:23,410
are Asha missing a

652
00:40:23,410 --> 00:40:26,730
yeah action a arts top ballet

653
00:40:26,730 --> 00:40:30,619
are so this this part is where I

654
00:40:30,619 --> 00:40:35,190
basically walking through the rock
happens inside notified eat that we set

655
00:40:35,190 --> 00:40:36,029
up

656
00:40:36,029 --> 00:40:41,099
all up too painful search for our
gadgets

657
00:40:41,099 --> 00:40:45,640
the called the hardest part about this
exploit after figuring out now

658
00:40:45,640 --> 00:40:48,710
how exactly were going to do it how
we're going to use P trace to control

659
00:40:48,710 --> 00:40:49,809
their process

660
00:40:49,809 --> 00:40:54,269
is a searching for the catches
gotshall's because they all had to be

661
00:40:54,269 --> 00:40:57,549
are all they could be in Tom and also

662
00:40:57,549 --> 00:41:00,569
but most the vial es written and

663
00:41:00,569 --> 00:41:03,650
some because it takes l'espace

664
00:41:03,650 --> 00:41:07,660
but wait a minute isn't notified he also
written dunno

665
00:41:07,660 --> 00:41:13,380
well it is but the problem where the
problem is that whenever you are

666
00:41:13,380 --> 00:41:16,559
whenever you there's a context switch a
process

667
00:41:16,559 --> 00:41:19,619
usually it's in the middle appliances
call

668
00:41:19,619 --> 00:41:23,180
are at all says call like it's doing

669
00:41:23,180 --> 00:41:26,329
of messages waiting for a mock message
or something like that so it's an email

670
00:41:26,329 --> 00:41:27,839
inboxes calls

671
00:41:27,839 --> 00:41:30,900
and all says calls on i OS are actually

672
00:41:30,900 --> 00:41:35,440
you know executed in our mail so
basically whenever you interrupted

673
00:41:35,440 --> 00:41:39,460
interrupt the process it's definitely
going to be an armload

674
00:41:39,460 --> 00:41:43,079
so you know I'm gadget that up

675
00:41:43,079 --> 00:41:46,309
that can jump to a ton location we check
so we can start using

676
00:41:46,309 --> 00:41:50,509
some gadgets for the rest for the rest
iraq or else now or else we have very

677
00:41:50,509 --> 00:41:54,069
very limited selection gadgets that
weakens

678
00:41:54,069 --> 00:41:57,589
I'll so this is the first one

679
00:41:57,589 --> 00:42:00,829
data holy because it took for our fine
hectic days

680
00:42:00,829 --> 00:42:04,809
fine I'll what's so special about this
one is that

681
00:42:04,809 --> 00:42:08,200
actually pasta stack to know exactly

682
00:42:08,200 --> 00:42:11,499
where the reply for the replies

683
00:42:11,499 --> 00:42:15,249
message ideas and it's it's quite a long
while

684
00:42:15,249 --> 00:42:20,049
llame pop and we can't control the
replies message id:

685
00:42:20,049 --> 00:42:24,700
because in are in me mocking her face
generator which is a standard way

686
00:42:24,700 --> 00:42:28,619
I'll up generating are los servicios

687
00:42:28,619 --> 00:42:32,210
using MOX mock I TC the

688
00:42:32,210 --> 00:42:37,119
message id: other reply is always to is
always the message id: other class

689
00:42:37,119 --> 00:42:41,960
plus 100 so if we send a request to
notify teeny

690
00:42:41,960 --> 00:42:45,849
with whatever you want minus a hundred
then

691
00:42:45,849 --> 00:42:50,049
when notified formulates his reply and
its message id: will be

692
00:42:50,049 --> 00:42:54,529
what every walk so we have to find a
gadget that says she did precisely where

693
00:42:54,529 --> 00:42:57,759
5 message ideas thanks to Jay Freeman
mine on this

694
00:42:57,759 --> 00:43:01,859
stark are yeah she didn't realize that
he found the gadget

695
00:43:01,859 --> 00:43:04,989
double-checked wide looking for forever
and

696
00:43:04,989 --> 00:43:08,589
US like we had no sleep but we finally
found it

697
00:43:08,589 --> 00:43:11,739
at up this is the I'm not sure if you
can see this

698
00:43:11,739 --> 00:43:14,880
actually I'm pretty sure you can see
this at all blue

699
00:43:14,880 --> 00:43:18,960
well what other it's %uh

700
00:43:18,960 --> 00:43:22,619
basically it does add

701
00:43:22,619 --> 00:43:27,660
HST their lows a buncha a buncha stuff
into floating point registers

702
00:43:27,660 --> 00:43:31,980
and double-precision floating-point
registers which take up a lot of space

703
00:43:31,980 --> 00:43:35,289
and it haha registers and possible
registers and PC

704
00:43:35,289 --> 00:43:39,509
at the at and up popkin doing on time
switch so what every

705
00:43:39,509 --> 00:43:42,710
we put where we pop PC which is
sufficient

706
00:43:42,710 --> 00:43:45,769
done from our or whatever law

707
00:43:45,769 --> 00:43:49,700
so I'll this is actually the staff

708
00:43:49,700 --> 00:43:53,519
up there if I D right well we
interrupted

709
00:43:53,519 --> 00:43:57,079
at the top is mock message trap which is
this

710
00:43:57,079 --> 00:44:00,349
the syscall it's a wrap around the
syscall

711
00:44:00,349 --> 00:44:03,589
inside the the library's the system
libraries

712
00:44:03,589 --> 00:44:07,700
and this is Mak message which is which
causing of it's a trap

713
00:44:07,700 --> 00:44:10,960
and saw that earlier in the earlier sly
or service mark message call mock

714
00:44:10,960 --> 00:44:11,789
message

715
00:44:11,789 --> 00:44:17,220
a service mark messages that racked as I
function notified e-on sure they're

716
00:44:17,220 --> 00:44:20,989
and I'll this is what's on stack

717
00:44:20,989 --> 00:44:26,720
all the reason this is the address that
the next ratchet we're going to use

718
00:44:26,720 --> 00:44:30,950
s positioned perfectly and a reply but
first message id:

719
00:44:30,950 --> 00:44:33,989
and the reason we did eyes is that mines
100 tricked at

720
00:44:33,989 --> 00:44:37,710
at that I center there and dated 0s

721
00:44:37,710 --> 00:44:40,819
make bad idea because this actually
about

722
00:44:40,819 --> 00:44:44,200
mock message and notified Jenny
recognizes

723
00:44:44,200 --> 00:44:47,489
so this is the state of the stock right
40

724
00:44:47,489 --> 00:44:51,039
5240 me set she traces

725
00:44:51,039 --> 00:44:54,739
a Sat TCF RFID using heat race

726
00:44:54,739 --> 00:44:59,329
to gadget holy and this is but after
data holy so it

727
00:44:59,329 --> 00:45:03,380
it puts a bunch of stuff into these
double precision are

728
00:45:03,380 --> 00:45:07,650
a floating-point registers and apostasy
into this next catcher

729
00:45:07,650 --> 00:45:11,960
and is next Sat at arm the purpose in
the next gadget

730
00:45:11,960 --> 00:45:16,210
is to jump across the city significant
portion this tactic Jeff under

731
00:45:16,210 --> 00:45:19,279
reply but to get from the reply

732
00:45:19,279 --> 00:45:24,119
offer to that request offer which we
directly controlled five of her is

733
00:45:24,119 --> 00:45:25,180
mostly thought

734
00:45:25,180 --> 00:45:29,640
jump because %uh notified each and
recognize a message that we sat

735
00:45:29,640 --> 00:45:33,269
but there but their request after we can
actually thought it was mostly whatever

736
00:45:33,269 --> 00:45:33,910
we walk

737
00:45:33,910 --> 00:45:39,180
and sell this is the gadget that were
used arm

738
00:45:39,180 --> 00:45:43,369
so this is the state the stock right
before that gadgets extruded

739
00:45:43,369 --> 00:45:46,930
selling pop all the other stuff of stock
earlier

740
00:45:46,930 --> 00:45:50,739
now right here and now

741
00:45:50,739 --> 00:45:54,160
we r now that back gadgets extruded

742
00:45:54,160 --> 00:45:58,069
and this at desk to set up the next
gadget wish

743
00:45:58,069 --> 00:46:01,160
as you probably guessed from move SPR

744
00:46:01,160 --> 00:46:04,519
or is est activity gadget we put

745
00:46:04,519 --> 00:46:08,309
are we put but shared to access and
share memory

746
00:46:08,309 --> 00:46:11,829
nr4 and then this fall commit to it

747
00:46:11,829 --> 00:46:15,680
and I described as a right here next
additive it's a stack to Notification

748
00:46:15,680 --> 00:46:16,809
Center share memory

749
00:46:16,809 --> 00:46:20,589
and continues execution from there

750
00:46:20,589 --> 00:46:25,099
so now or actually pretty much free to
do whatever you want we have

751
00:46:25,099 --> 00:46:29,989
a we we have a prop stock that pretty
much limited in size

752
00:46:29,989 --> 00:46:33,180
all aluminium before chill bites of

753
00:46:33,180 --> 00:46:36,829
are and we can we can set up

754
00:46:36,829 --> 00:46:40,599
we can set up their of ID to do whatever
why in this case

755
00:46:40,599 --> 00:46:43,660
s2 do to syscall really

756
00:46:43,660 --> 00:46:47,210
the first change ownership to for

757
00:46:47,210 --> 00:46:53,279
to change in ownership this file Jamie
option this 200 at tonight in route

758
00:46:53,279 --> 00:46:57,029
because lost control or if you still owe
that he lists lessons

759
00:46:57,029 --> 00:47:00,400
and afterwards what we do is s exact al

760
00:47:00,400 --> 00:47:04,789
that he lists lol this is pretty up

761
00:47:04,789 --> 00:47:07,839
tree you know standard I'll

762
00:47:07,839 --> 00:47:13,249
we set up the LR for that change
ownership call

763
00:47:13,249 --> 00:47:18,549
over here and

764
00:47:18,549 --> 00:47:21,920
this sets up the the set up another hour

765
00:47:21,920 --> 00:47:27,519
is actually calls that change ownership

766
00:47:27,519 --> 00:47:34,519
and this returns to every chance that
previous up our

767
00:47:34,739 --> 00:47:39,079
and this actually calls the exec al so
basically we force lost control which

768
00:47:39,079 --> 00:47:39,769
controls

769
00:47:39,769 --> 00:47:42,940
launch team in to low Jamie top US

770
00:47:42,940 --> 00:47:46,989
consulate a beat-up ulysses very similar
to what I showed you a few slight a

771
00:47:46,989 --> 00:47:50,289
many slides ago or I'll where that

772
00:47:50,289 --> 00:47:53,809
Paschke of erection which saw sandbox
loaded and also

773
00:47:53,809 --> 00:47:57,720
SLRs disabled so now we're running a cop
iraq showing

774
00:47:57,720 --> 00:48:01,619
that has an assault ass are disabled
that's awesome box

775
00:48:01,619 --> 00:48:04,749
and we're free to use rock to Ste

776
00:48:04,749 --> 00:48:08,739
to youth forced to copy a fraction
choose do whatever wat wish

777
00:48:08,739 --> 00:48:13,339
in this case is to do the starter sheep
harsh way

778
00:48:13,339 --> 00:48:16,380
amount announced that is required to
exploit the kernel

779
00:48:16,380 --> 00:48:20,079
and then loss rest jailbreak

780
00:48:20,079 --> 00:48:27,079
at set

781
00:48:31,260 --> 00:48:32,069
questions

782
00:48:32,069 --> 00:48:39,069
how'd you get the shared memory address

783
00:48:40,960 --> 00:48:44,510
for here how to get the shared memory
address

784
00:48:44,510 --> 00:48:47,900
I'll yet at that part is up

785
00:48:47,900 --> 00:48:51,950
we since his calls to get a to get the

786
00:48:51,950 --> 00:48:55,859
to get the first forty fort

787
00:48:55,859 --> 00:49:00,349
memory regions up notify DD which we can
do because it where rude and that's to

788
00:49:00,349 --> 00:49:02,050
Sam box so you're right

789
00:49:02,050 --> 00:49:05,660
right this trucks right a right
forty-four

790
00:49:05,660 --> 00:49:10,800
others up that descriptors for those
forty-four first memory

791
00:49:10,800 --> 00:49:16,470
regions into into memory in action and
then we spend them to search for AI

792
00:49:16,470 --> 00:49:19,579
area memory doubtless de lys read and
write

793
00:49:19,579 --> 00:49:23,490
me to write three right share and the
first one is being right share

794
00:49:23,490 --> 00:49:26,569
is going to be a shared memory area far
a

795
00:49:26,569 --> 00:49:33,569
notified more questions

796
00:49:43,990 --> 00:49:46,630
can this be used for a and tighter a

797
00:49:46,630 --> 00:49:50,080
jailbreaks for forensics

798
00:49:50,080 --> 00:49:55,020
yeah this is actually is what we did for
the untethered jailbreak

799
00:49:55,020 --> 00:49:59,480
yes showed you how featured a Lowther

800
00:49:59,480 --> 00:50:02,490
the exploit configuration file onto
completely

801
00:50:02,490 --> 00:50:06,830
on jailbroken phone and actually talking
on to jailbreak yeah

802
00:50:06,830 --> 00:50:10,140
so all we do is after after this is done
we just

803
00:50:10,140 --> 00:50:13,350
lowered the et cetera launched the doc
on file

804
00:50:13,350 --> 00:50:16,630
and also the los penes Tana lawn cheap
US

805
00:50:16,630 --> 00:50:20,460
in this way every tiny boats it and in
runs and

806
00:50:20,460 --> 00:50:23,610
everyone's that pass for some traction

807
00:50:23,610 --> 00:50:27,740
with asp.net configuration that that
passed the kernel

808
00:50:27,740 --> 00:50:31,420
so every move their losses faction which
and touch the trial

809
00:50:31,420 --> 00:50:37,010
so that's untethered jailbreak right
there questions questions

810
00:50:37,010 --> 00:50:40,060
its renny

811
00:50:40,060 --> 00:50:43,810
them all hopes to the post

812
00:50:43,810 --> 00:50:50,810
of ok I hi

813
00:50:52,140 --> 00:50:56,210
I don't have to I I don't want to ask in
his personal question

814
00:50:56,210 --> 00:51:00,610
I just wanted to say good for s

815
00:51:00,610 --> 00:51:07,610
I got

816
00:51:16,120 --> 00:51:16,510
and

817
00:51:16,510 --> 00:51:23,510
pay

818
00:51:29,480 --> 00:51:33,069
but just well

819
00:51:33,069 --> 00:51:36,839
we have one more thing to announce we a

820
00:51:36,839 --> 00:51:41,619
actually manage to finish this up the
untethered jailbreak for the 511

821
00:51:41,619 --> 00:51:44,859
I US-russian and would like to

822
00:51:44,859 --> 00:51:48,359
pro now

823
00:51:48,359 --> 00:51:55,359
um

824
00:51:56,099 --> 00:52:00,849
yeah a second we'd like to nazi hunters
745 11

825
00:52:00,849 --> 00:52:05,309
a the promise right now it's a green
card inside a star for some reason

826
00:52:05,309 --> 00:52:08,450
but we actually a finished

827
00:52:08,450 --> 00:52:12,540
serve the work done to it lead over for
Donald as soon as me

828
00:52:12,540 --> 00:52:19,540
managed to get the server back online I
think someone hacked us

829
00:52:34,070 --> 00:52:36,619
that position he will be your neck as
requiring about

830
00:52:36,619 --> 00:52:37,390
five minutes

