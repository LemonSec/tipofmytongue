1
00:00:10,130 --> 00:00:14,190
all right everyone could have your

2
00:00:12,330 --> 00:00:15,750
attention my name is Eric Conrad and

3
00:00:14,190 --> 00:00:18,180
thanks for coming to my talk

4
00:00:15,750 --> 00:00:20,240
I just wanted to while cliff Stoll is

5
00:00:18,180 --> 00:00:23,730
still here

6
00:00:20,240 --> 00:00:25,349
you know I was a UNIX system in 1991 and

7
00:00:23,730 --> 00:00:27,960
a great beer had said you have to buy

8
00:00:25,350 --> 00:00:29,880
this book and I did so I went to quantum

9
00:00:27,960 --> 00:00:33,000
books in Cambridge Kendall Square and

10
00:00:29,880 --> 00:00:34,649
bought the book and in 1993 we got

11
00:00:33,000 --> 00:00:37,530
hacked I was working in Kendall Square

12
00:00:34,649 --> 00:00:39,809
and I knew what to do because I read

13
00:00:37,530 --> 00:00:41,160
this and in addition all the amazing

14
00:00:39,809 --> 00:00:43,320
clips done he inspired an entire

15
00:00:41,160 --> 00:00:46,050
generation of people like me to do

16
00:00:43,320 --> 00:00:47,850
incident handling to pursue InfoSec back

17
00:00:46,050 --> 00:00:49,739
in 93 information security was it a

18
00:00:47,850 --> 00:00:52,350
career there are no titles but I pursued

19
00:00:49,739 --> 00:00:54,449
it based on that incident and it was a

20
00:00:52,350 --> 00:00:57,000
pretty good decision 26 years later so

21
00:00:54,449 --> 00:00:58,800
thank you clear it's talking to cliff

22
00:00:57,000 --> 00:01:01,440
before the talk he was kind enough to

23
00:00:58,800 --> 00:01:03,718
give some of us speaking advice and he

24
00:01:01,440 --> 00:01:06,479
said make it personal so I did actually

25
00:01:03,719 --> 00:01:08,790
before I talk to him one of the reasons

26
00:01:06,479 --> 00:01:11,490
I'm here is because while they existed

27
00:01:08,790 --> 00:01:13,740
so my great grandfather Highland Connor

28
00:01:11,490 --> 00:01:16,860
I was born in lüneburg and emigrated to

29
00:01:13,740 --> 00:01:19,339
Boston in 1897 I don't have a picture

30
00:01:16,860 --> 00:01:23,159
Highland that's his my great-grandmother

31
00:01:19,340 --> 00:01:24,900
Delia and I discovered my Atlantic

32
00:01:23,159 --> 00:01:26,970
Canadian roots a few years ago the story

33
00:01:24,900 --> 00:01:29,100
was always German Catholic German Irish

34
00:01:26,970 --> 00:01:30,780
rather and I was the weird kid in South

35
00:01:29,100 --> 00:01:32,640
Boston with a German name but I

36
00:01:30,780 --> 00:01:36,900
researched it and I traced it back it

37
00:01:32,640 --> 00:01:40,049
was Germany 1700s Luneberg 1896 Boston

38
00:01:36,900 --> 00:01:41,640
and so we began visiting Atlantic Canada

39
00:01:40,049 --> 00:01:44,220
discovering our Atlantic Canadian roots

40
00:01:41,640 --> 00:01:46,259
and now my son Eric is attending

41
00:01:44,220 --> 00:01:48,298
Dalhousie University he's the first

42
00:01:46,259 --> 00:01:50,340
Conrad from my branch to actually return

43
00:01:48,299 --> 00:01:52,710
to live in Canada so it's awesome to be

44
00:01:50,340 --> 00:01:54,360
here and thanks to having me here oh and

45
00:01:52,710 --> 00:01:56,429
after cliff gave me that advice he stole

46
00:01:54,360 --> 00:01:59,990
my coffee he drank it then they

47
00:01:56,430 --> 00:01:59,990
complained I didn't put sugar in it okay

48
00:02:01,010 --> 00:02:07,280
oh he also said PowerPoint is poison so

49
00:02:05,390 --> 00:02:09,350
get ready for some poison alright so

50
00:02:07,280 --> 00:02:11,990
it's a fast-paced talk my website Sarah

51
00:02:09,350 --> 00:02:13,340
Conrad comm I once said someone say Eric

52
00:02:11,990 --> 00:02:14,420
I couldn't write down all the things you

53
00:02:13,340 --> 00:02:17,420
were saying you were talking too fast

54
00:02:14,420 --> 00:02:19,429
and my answer is yeah that's right so go

55
00:02:17,420 --> 00:02:23,000
to Eric Conrad comm I just uploaded it

56
00:02:19,430 --> 00:02:24,740
last night and just like cliff did back

57
00:02:23,000 --> 00:02:26,870
in the day you want to detect the wily

58
00:02:24,740 --> 00:02:28,430
hacker right how do you detect the wily

59
00:02:26,870 --> 00:02:31,730
hacker most networks have built for

60
00:02:28,430 --> 00:02:33,170
operations not a security I also like

61
00:02:31,730 --> 00:02:35,299
what cliff said it's like security goes

62
00:02:33,170 --> 00:02:37,309
hand-in-hand with proper operations

63
00:02:35,300 --> 00:02:38,960
well-run networks are secure networks

64
00:02:37,310 --> 00:02:40,850
right so I'm gonna cover a number of

65
00:02:38,960 --> 00:02:42,920
things now on how to better configure

66
00:02:40,850 --> 00:02:45,440
your network to detect that wily hacker

67
00:02:42,920 --> 00:02:46,549
starting with command line auditing so

68
00:02:45,440 --> 00:02:50,780
well the best thing you can do is turn

69
00:02:46,550 --> 00:02:53,060
on this this events 46 88 the Windows

70
00:02:50,780 --> 00:02:54,560
security event log you already have 46

71
00:02:53,060 --> 00:02:56,210
88 right now but you don't have the

72
00:02:54,560 --> 00:02:57,620
command line auditing command line

73
00:02:56,210 --> 00:02:59,570
auditing shows you every single command

74
00:02:57,620 --> 00:03:03,490
the hacker type much like cliff saw in

75
00:02:59,570 --> 00:03:03,489
his teletypes back in the day right and

76
00:03:04,690 --> 00:03:11,660
that's not okay yeah okay and thank you

77
00:03:09,470 --> 00:03:13,730
so if you want every command the

78
00:03:11,660 --> 00:03:16,640
attacker types you turn this thing on

79
00:03:13,730 --> 00:03:19,070
and it's to GPO settings you see every

80
00:03:16,640 --> 00:03:21,200
single command that the the hacker types

81
00:03:19,070 --> 00:03:22,850
now and then if I had one event to put

82
00:03:21,200 --> 00:03:25,369
in my sim in my sock it's this event

83
00:03:22,850 --> 00:03:27,380
4680 a command line auditing I want more

84
00:03:25,370 --> 00:03:28,250
than one event but I only get one I want

85
00:03:27,380 --> 00:03:30,350
this one right

86
00:03:28,250 --> 00:03:32,959
a lot of Sox aren't looking this event I

87
00:03:30,350 --> 00:03:33,440
want for log sources I want in a Windows

88
00:03:32,959 --> 00:03:36,650
environment

89
00:03:33,440 --> 00:03:39,079
I want to log sources I want 46 88 well

90
00:03:36,650 --> 00:03:40,580
windows event logs and I want DNS as

91
00:03:39,080 --> 00:03:43,220
well well talking about DNS logging in a

92
00:03:40,580 --> 00:03:44,900
bit so once you turned on command line

93
00:03:43,220 --> 00:03:47,260
auditing what do you look for really

94
00:03:44,900 --> 00:03:49,970
long commands over thousand bytes right

95
00:03:47,260 --> 00:03:52,700
run DLL 32 which is a way to inject

96
00:03:49,970 --> 00:03:54,590
dll's into RAM VBS scripts now of course

97
00:03:52,700 --> 00:03:56,510
not all VBS scripts are malicious but

98
00:03:54,590 --> 00:03:59,060
some are anything running out of a temp

99
00:03:56,510 --> 00:04:01,310
folder PowerShell launched by CMD is a

100
00:03:59,060 --> 00:04:03,380
common for a hacker to type or for what

101
00:04:01,310 --> 00:04:05,959
are your admins to type open a terminal

102
00:04:03,380 --> 00:04:07,850
and type powershell exe inside that

103
00:04:05,959 --> 00:04:10,579
terminal that's not normal at all very

104
00:04:07,850 --> 00:04:14,269
common malware approach also base64

105
00:04:10,579 --> 00:04:14,930
encoding commands powershell powershell

106
00:04:14,269 --> 00:04:17,120
is

107
00:04:14,930 --> 00:04:18,858
amazing most of the post exploitation

108
00:04:17,120 --> 00:04:20,810
frameworks have now moved on to

109
00:04:18,858 --> 00:04:23,299
PowerShell most of the intelligent

110
00:04:20,810 --> 00:04:24,500
malware's using PowerShell to move what

111
00:04:23,300 --> 00:04:26,960
it's stilling is just living off the

112
00:04:24,500 --> 00:04:29,419
land we call those Lal bins by the way

113
00:04:26,960 --> 00:04:31,580
living on tool and binaries if I'm a

114
00:04:29,419 --> 00:04:33,859
hacker and I install malicious software

115
00:04:31,580 --> 00:04:35,240
on your system your antivirus this

116
00:04:33,860 --> 00:04:36,259
Center is designed to stop that but if

117
00:04:35,240 --> 00:04:38,120
instead of installing a malicious

118
00:04:36,259 --> 00:04:40,280
software I simply use commands that are

119
00:04:38,120 --> 00:04:41,660
already there I live off the land I'm

120
00:04:40,280 --> 00:04:44,210
much more likely to be successful and

121
00:04:41,660 --> 00:04:47,900
not be detected right so PowerShell is

122
00:04:44,210 --> 00:04:50,690
amazing and PowerShell natively with

123
00:04:47,900 --> 00:04:52,520
PowerShell - which is Windows 7 has no

124
00:04:50,690 --> 00:04:55,039
login for our purpose there's no useful

125
00:04:52,520 --> 00:04:57,198
logging power show 4 & 5 had a lot more

126
00:04:55,039 --> 00:04:58,969
logging well by the way Windows 7 is end

127
00:04:57,199 --> 00:05:00,860
of life in January so tik-tok you be

128
00:04:58,970 --> 00:05:03,530
still of a Windows 7 no more patches as

129
00:05:00,860 --> 00:05:06,050
of January so I recommend you upgrade

130
00:05:03,530 --> 00:05:08,210
any Windows 7 systems to PowerShell 5 or

131
00:05:06,050 --> 00:05:10,460
higher and turn on PowerShell auditing

132
00:05:08,210 --> 00:05:12,229
cuz most Maur is now using PowerShell

133
00:05:10,460 --> 00:05:15,109
well most the advanced malware I should

134
00:05:12,229 --> 00:05:17,060
say and natively even on PowerShell 5

135
00:05:15,110 --> 00:05:20,990
plus is no logging turned on by default

136
00:05:17,060 --> 00:05:22,280
you can turn that on now sis Mon is

137
00:05:20,990 --> 00:05:25,070
amazing system honest from system

138
00:05:22,280 --> 00:05:26,570
Eternals by mark russinovich that's a

139
00:05:25,070 --> 00:05:28,610
company that was acquired by Microsoft a

140
00:05:26,570 --> 00:05:31,340
number of years ago it's this money

141
00:05:28,610 --> 00:05:33,800
there's a saying I like by Brandeis a

142
00:05:31,340 --> 00:05:36,049
Brandeis University Fame sunlight is the

143
00:05:33,800 --> 00:05:37,789
best disinfectant right sunlight is the

144
00:05:36,050 --> 00:05:39,289
best disinfectant you have to know what

145
00:05:37,789 --> 00:05:41,510
you don't know you have to avoid the

146
00:05:39,289 --> 00:05:42,320
blind spots and system on gives you some

147
00:05:41,510 --> 00:05:44,000
of that visibility

148
00:05:42,320 --> 00:05:45,830
it's from Microsoft you download from

149
00:05:44,000 --> 00:05:48,199
Microsoft com of course it's just not

150
00:05:45,830 --> 00:05:49,880
installed natively and it gives you it

151
00:05:48,199 --> 00:05:51,470
logs on Windows Event log format which

152
00:05:49,880 --> 00:05:53,210
your sim can now in - yes very nicely

153
00:05:51,470 --> 00:05:55,130
and it gives you some critical

154
00:05:53,210 --> 00:05:57,500
visibility of malware that you normally

155
00:05:55,130 --> 00:05:59,750
lack if at the kind of visibility you

156
00:05:57,500 --> 00:06:01,729
normally need like Atheneum or carbon

157
00:05:59,750 --> 00:06:03,110
black or sentinel one one of these

158
00:06:01,729 --> 00:06:05,630
advanced you know endpoint protection

159
00:06:03,110 --> 00:06:06,680
suites heuristic things right but it

160
00:06:05,630 --> 00:06:09,740
gives you that kind of intense

161
00:06:06,680 --> 00:06:11,960
visibility like for instance WMI so not

162
00:06:09,740 --> 00:06:14,300
petia was a piece of malware that's

163
00:06:11,960 --> 00:06:16,609
caused over ten billion dollars us and

164
00:06:14,300 --> 00:06:18,680
damaged 10 billion with the be you know

165
00:06:16,610 --> 00:06:20,360
there's a great wired a magazine article

166
00:06:18,680 --> 00:06:21,919
on murska the shipping company mercer

167
00:06:20,360 --> 00:06:24,639
you've probably seen their containers on

168
00:06:21,919 --> 00:06:27,169
ships in halifax harbour here right and

169
00:06:24,639 --> 00:06:29,300
it blew up the entire Active Directory

170
00:06:27,169 --> 00:06:31,068
infrastructure it knew every

171
00:06:29,300 --> 00:06:32,990
eighty controller on the planet except

172
00:06:31,069 --> 00:06:34,849
for one it turns out there's a power

173
00:06:32,990 --> 00:06:36,440
outage in Ghana and Ghana there's a

174
00:06:34,849 --> 00:06:38,719
power outage and they had one

175
00:06:36,440 --> 00:06:40,520
actor/director controller offline out of

176
00:06:38,720 --> 00:06:43,159
all their global network everyone else

177
00:06:40,520 --> 00:06:44,419
got nuked and I'm not petty up some

178
00:06:43,159 --> 00:06:46,310
people call it ransomware it's not

179
00:06:44,419 --> 00:06:48,318
actually ransomware its destructive

180
00:06:46,310 --> 00:06:50,300
malware simply destroys your data you

181
00:06:48,319 --> 00:06:52,280
don't have backups it's gone right and

182
00:06:50,300 --> 00:06:53,960
so by an act of God there's a power

183
00:06:52,280 --> 00:06:56,690
outage in Ghana and it was one ad

184
00:06:53,960 --> 00:06:58,159
controller offline for an act of God so

185
00:06:56,690 --> 00:06:59,719
they called down to Ghana and they said

186
00:06:58,159 --> 00:07:00,740
unplug it now before the power comes

187
00:06:59,720 --> 00:07:02,240
back because when the power comes back

188
00:07:00,740 --> 00:07:05,780
if it's plugged in it's over

189
00:07:02,240 --> 00:07:07,009
pulled at this fly to London dude a visa

190
00:07:05,780 --> 00:07:08,690
issue they couldn't fly to London they

191
00:07:07,009 --> 00:07:10,340
had to fly to Nigeria so formal um had a

192
00:07:08,690 --> 00:07:11,930
meeting i giri they met in the middle

193
00:07:10,340 --> 00:07:13,758
grab the disk flew back and they

194
00:07:11,930 --> 00:07:16,310
recovered their global ad infrastructure

195
00:07:13,759 --> 00:07:18,349
from that set of disks they had 18

196
00:07:16,310 --> 00:07:20,180
wheels backed up miles at crippled a

197
00:07:18,349 --> 00:07:21,800
company they fell back the paper pencil

198
00:07:20,180 --> 00:07:24,440
to track all of those containers right

199
00:07:21,800 --> 00:07:25,879
and one of the things your Google a

200
00:07:24,440 --> 00:07:30,590
Wired magazine merci

201
00:07:25,879 --> 00:07:32,319
ma e ER SK you'll see that story and one

202
00:07:30,590 --> 00:07:34,940
of the things that did it move to W am i

203
00:07:32,319 --> 00:07:36,199
w MEK one of the things not petty did

204
00:07:34,940 --> 00:07:38,419
it's interesting we talk about malware

205
00:07:36,199 --> 00:07:40,909
for years we talked about how dumb most

206
00:07:38,419 --> 00:07:43,219
malware was like year the Conficker worm

207
00:07:40,909 --> 00:07:44,870
10 years ago and the Conficker worm

208
00:07:43,219 --> 00:07:46,909
would infect the Box scan for more

209
00:07:44,870 --> 00:07:49,099
infect them scan for more in fact those

210
00:07:46,909 --> 00:07:52,699
if you're missing a patch MSO eight oh

211
00:07:49,099 --> 00:07:54,770
six seven bang you're it and I were back

212
00:07:52,699 --> 00:07:57,319
then saying wow that's dumb that's not

213
00:07:54,770 --> 00:07:59,299
all pen tester works right a pen tester

214
00:07:57,319 --> 00:08:01,490
doesn't simply exploit an exploit

215
00:07:59,300 --> 00:08:04,099
exploit a pen test will break into one

216
00:08:01,490 --> 00:08:06,409
box steal credentials use the tool call

217
00:08:04,099 --> 00:08:08,120
me me cats to dump plaintext passwords

218
00:08:06,409 --> 00:08:10,129
windows 8 in previous as plaintext

219
00:08:08,120 --> 00:08:12,740
passwords in ram they're encoded but

220
00:08:10,129 --> 00:08:14,840
they're not encrypted and steal those

221
00:08:12,740 --> 00:08:16,520
and move laterally so there's an old

222
00:08:14,840 --> 00:08:18,739
saying what you call hacking I call

223
00:08:16,520 --> 00:08:21,650
logging in right I'll just log in I'll

224
00:08:18,740 --> 00:08:24,529
steal credentials and log in so ten

225
00:08:21,650 --> 00:08:27,888
years ago conficker a thousand boxes to

226
00:08:24,529 --> 00:08:30,289
unpack to went down not petia a thousand

227
00:08:27,889 --> 00:08:31,819
boxes to unpack all thousand go down if

228
00:08:30,289 --> 00:08:33,468
you made a series of mistakes with

229
00:08:31,819 --> 00:08:36,740
credentials and things like that if you

230
00:08:33,469 --> 00:08:38,209
manually synchronized your local admin

231
00:08:36,740 --> 00:08:42,570
passwords for example made of the

232
00:08:38,208 --> 00:08:46,829
mistakes so WM I had moved to WMI

233
00:08:42,570 --> 00:08:49,380
systems to WMI a PS exact and W mine has

234
00:08:46,830 --> 00:08:52,050
had no login whatsoever I've any use to

235
00:08:49,380 --> 00:08:54,150
us and a sock right you install system

236
00:08:52,050 --> 00:08:55,680
on weeks after that they had a WMI

237
00:08:54,150 --> 00:08:56,250
logging specifically because of not

238
00:08:55,680 --> 00:08:58,050
petia

239
00:08:56,250 --> 00:08:59,250
so if added that in that visibility

240
00:08:58,050 --> 00:09:01,109
that's some like you need in your

241
00:08:59,250 --> 00:09:04,530
network system on is a wonderful tool

242
00:09:01,110 --> 00:09:07,110
and built on top of system on I wrote a

243
00:09:04,530 --> 00:09:09,319
tool called deep light so one of the

244
00:09:07,110 --> 00:09:12,150
things sis mom can give you is the

245
00:09:09,320 --> 00:09:14,100
sha-256 hash is one example of every

246
00:09:12,150 --> 00:09:15,090
process running on every windows system

247
00:09:14,100 --> 00:09:17,760
your entire network

248
00:09:15,090 --> 00:09:19,800
this is powerful so it turns your your

249
00:09:17,760 --> 00:09:21,990
Windows Network into a massively

250
00:09:19,800 --> 00:09:24,030
distributed application of where IDs you

251
00:09:21,990 --> 00:09:26,340
can see every single hash of every

252
00:09:24,030 --> 00:09:28,170
single process for free right this

253
00:09:26,340 --> 00:09:30,540
scales well globally Microsoft runs to

254
00:09:28,170 --> 00:09:33,510
this tool globally and I thought why

255
00:09:30,540 --> 00:09:35,699
don't I grab that hash and upload a

256
00:09:33,510 --> 00:09:38,580
virus total virus total runs like 65 odd

257
00:09:35,700 --> 00:09:41,040
antivirus checks right and for free they

258
00:09:38,580 --> 00:09:43,920
have a free API key and you can send one

259
00:09:41,040 --> 00:09:45,750
hash every 15 seconds for free freeze

260
00:09:43,920 --> 00:09:48,709
and beer free as we say UNIX nerds like

261
00:09:45,750 --> 00:09:51,360
this day right and if you have more than

262
00:09:48,710 --> 00:09:53,220
one hashes submitted just accuse them 15

263
00:09:51,360 --> 00:09:54,570
seconds you got to buy more access from

264
00:09:53,220 --> 00:09:56,670
virustotal but the free version works

265
00:09:54,570 --> 00:09:59,580
pretty well start with that tool and

266
00:09:56,670 --> 00:10:01,229
there's an old UNIX thing as well if you

267
00:09:59,580 --> 00:10:03,330
typed it twice you should have script it

268
00:10:01,230 --> 00:10:05,040
at once and having done this manually

269
00:10:03,330 --> 00:10:07,740
more than twice I can tell you that I

270
00:10:05,040 --> 00:10:09,900
script it at once and so it takes the

271
00:10:07,740 --> 00:10:12,720
process of copy-paste in that shot two

272
00:10:09,900 --> 00:10:15,329
fives hat - five six hash excuse me from

273
00:10:12,720 --> 00:10:17,130
sis mom pasted a virus total hit enter

274
00:10:15,330 --> 00:10:19,260
right I've done that dozens of times

275
00:10:17,130 --> 00:10:21,840
manually so I took my own advice and I

276
00:10:19,260 --> 00:10:23,610
wrote a tool called deep white and it's

277
00:10:21,840 --> 00:10:25,680
been very very effective and way deep

278
00:10:23,610 --> 00:10:27,810
white works is you take like your

279
00:10:25,680 --> 00:10:29,699
Windows 10 install image you grab a

280
00:10:27,810 --> 00:10:31,589
sha-256 hash of all that it's one

281
00:10:29,700 --> 00:10:35,220
powershell command that's your whitelist

282
00:10:31,590 --> 00:10:37,080
if deep white sees a hash that wasn't on

283
00:10:35,220 --> 00:10:39,000
that list it looks it up tells you

284
00:10:37,080 --> 00:10:41,010
whether it's malicious or not and once

285
00:10:39,000 --> 00:10:43,500
it's looked it up once it won't look it

286
00:10:41,010 --> 00:10:45,689
up again unless you tell us to write so

287
00:10:43,500 --> 00:10:48,750
I wrote that tool for derbycon but a

288
00:10:45,690 --> 00:10:50,910
year and a half ago and whole piece of

289
00:10:48,750 --> 00:10:53,220
advice if you get one hit don't freak

290
00:10:50,910 --> 00:10:55,530
out if you get a lot of hits the top one

291
00:10:53,220 --> 00:10:57,029
yeah freak up you get one hit don't

292
00:10:55,530 --> 00:11:00,089
freak out too much

293
00:10:57,029 --> 00:11:02,730
I ran this on I I teach for Sansa by

294
00:11:00,089 --> 00:11:05,579
stands fellow and I've written a number

295
00:11:02,730 --> 00:11:08,249
of classes for sins and I ran this tool

296
00:11:05,579 --> 00:11:10,109
on the Windows 10 VM we've handed out to

297
00:11:08,249 --> 00:11:12,449
thousands of students thousands of

298
00:11:10,110 --> 00:11:13,679
students in security 511 what I saw that

299
00:11:12,449 --> 00:11:14,609
hit I started hyperventilating and

300
00:11:13,679 --> 00:11:16,410
panicking because I thought I just

301
00:11:14,610 --> 00:11:18,329
infected thousands of students because

302
00:11:16,410 --> 00:11:19,290
they handed them an effective BM and I

303
00:11:18,329 --> 00:11:22,529
thought I have to change my name and

304
00:11:19,290 --> 00:11:24,809
leave the country and fail and I calmed

305
00:11:22,529 --> 00:11:26,399
down like well one hit sometimes

306
00:11:24,809 --> 00:11:27,959
especially if it's not signed the

307
00:11:26,399 --> 00:11:30,059
vendors will crank the heuristics up all

308
00:11:27,959 --> 00:11:32,160
the way and get false positives so one

309
00:11:30,059 --> 00:11:33,899
hit investigate don't freak out a lot of

310
00:11:32,160 --> 00:11:39,569
hits maybe you want to freak out don't

311
00:11:33,899 --> 00:11:41,189
forget all right DNS so DNS again if in

312
00:11:39,569 --> 00:11:43,410
a Windows environment the first log

313
00:11:41,189 --> 00:11:46,079
source I want is Windows event logs the

314
00:11:43,410 --> 00:11:48,238
second log source I want is DNS most

315
00:11:46,079 --> 00:11:50,399
people use DNS for correlation purposes

316
00:11:48,239 --> 00:11:52,470
which is fine I want DNS for thread

317
00:11:50,399 --> 00:11:54,989
hunting you know putty down that wily

318
00:11:52,470 --> 00:11:57,509
hacker thread hunting is the presumption

319
00:11:54,989 --> 00:11:58,889
of compromised action eyes right the

320
00:11:57,509 --> 00:12:00,959
presumption of compromised as all

321
00:11:58,889 --> 00:12:02,759
networks come pre owned every networks

322
00:12:00,959 --> 00:12:04,799
own right now all defenders should

323
00:12:02,759 --> 00:12:06,449
defend that way right all networks come

324
00:12:04,799 --> 00:12:09,899
pre owned and then you hunt to prove

325
00:12:06,449 --> 00:12:12,029
find them hunt them down right so DNS

326
00:12:09,899 --> 00:12:14,730
face a great threat hunting source right

327
00:12:12,029 --> 00:12:17,689
and some of the things you want to look

328
00:12:14,730 --> 00:12:19,949
for the easiest telltale sign is

329
00:12:17,689 --> 00:12:21,480
hundreds of thousands of lookups dot

330
00:12:19,949 --> 00:12:25,790
something dot something on the internet

331
00:12:21,480 --> 00:12:28,799
like you look up WWE google.com/chrome

332
00:12:25,790 --> 00:12:31,379
you look up Maps Google com you don't

333
00:12:28,799 --> 00:12:32,939
look up a thousand things google.com a

334
00:12:31,379 --> 00:12:35,459
thousand things dot something dot

335
00:12:32,939 --> 00:12:38,129
something is a telltale sign of malware

336
00:12:35,459 --> 00:12:38,628
using DNS tunneling right here Zeus

337
00:12:38,129 --> 00:12:41,850
botnet

338
00:12:38,629 --> 00:12:43,949
and so I was on a threat hunt and a

339
00:12:41,850 --> 00:12:47,220
third-party threat hunt and I asked them

340
00:12:43,949 --> 00:12:48,479
for data logs you know I need logs it

341
00:12:47,220 --> 00:12:50,610
was well these places with lots of red

342
00:12:48,480 --> 00:12:52,350
tape and like well you know fill out an

343
00:12:50,610 --> 00:12:53,699
account requisition form we'll talk

344
00:12:52,350 --> 00:12:55,230
about that on Thursday and it's like

345
00:12:53,699 --> 00:12:58,258
Monday and I'm leaving Friday morning

346
00:12:55,230 --> 00:13:00,480
and I'm I'm you know stuck in a queue

347
00:12:58,259 --> 00:13:02,369
but no data if they put me to queue but

348
00:13:00,480 --> 00:13:03,660
nothing to do I'll lose my mind I go

349
00:13:02,369 --> 00:13:04,049
hunting around for anyone will give me

350
00:13:03,660 --> 00:13:06,480
data

351
00:13:04,049 --> 00:13:08,819
I find that old UNIX graybeard oh yeah

352
00:13:06,480 --> 00:13:09,660
so if he has any data any logs say while

353
00:13:08,819 --> 00:13:12,150
I run DNS

354
00:13:09,660 --> 00:13:15,089
great DNS I want those logs you turn on

355
00:13:12,150 --> 00:13:19,199
logging he did and I saw this this is

356
00:13:15,090 --> 00:13:21,390
the 1290 third thing this thing looked

357
00:13:19,200 --> 00:13:22,980
up it looked up zero dot P up as owns

358
00:13:21,390 --> 00:13:24,569
Cobb looked up meaning it's

359
00:13:22,980 --> 00:13:27,030
communicating back and forth wound up

360
00:13:24,570 --> 00:13:28,800
here at the zones noise com2 dot PF dot

361
00:13:27,030 --> 00:13:30,329
dot dot twelve thousand one hundred

362
00:13:28,800 --> 00:13:32,069
ninety two top here that's known stars

363
00:13:30,330 --> 00:13:35,010
calm now what most vendors do and say o

364
00:13:32,070 --> 00:13:36,870
zones noise calm your evil with a black

365
00:13:35,010 --> 00:13:39,270
list you right let's call whack Amole

366
00:13:36,870 --> 00:13:41,190
because today at zones noise calm and

367
00:13:39,270 --> 00:13:42,840
eight hours later with zones not calm

368
00:13:41,190 --> 00:13:44,700
and eight hours later at zones nod with

369
00:13:42,840 --> 00:13:46,590
addy calm and we can put this game all

370
00:13:44,700 --> 00:13:48,540
day long and you're gonna fail right so

371
00:13:46,590 --> 00:13:50,550
instead of black listing things look for

372
00:13:48,540 --> 00:13:52,740
you know behavioral things like

373
00:13:50,550 --> 00:13:55,760
thousands of lookups and that by the way

374
00:13:52,740 --> 00:13:59,940
is x or encoded than base64-encoded

375
00:13:55,760 --> 00:14:02,250
traffic right so for me it's the ideal

376
00:13:59,940 --> 00:14:04,290
c2 channel now c2 stands for command and

377
00:14:02,250 --> 00:14:05,970
control way to maintain communication

378
00:14:04,290 --> 00:14:08,280
channel the way the bot herder controls

379
00:14:05,970 --> 00:14:10,980
the botnet right that's called c2 it's a

380
00:14:08,280 --> 00:14:12,569
military term DNS is the ideal c2

381
00:14:10,980 --> 00:14:14,070
channel because it's it's allowed and

382
00:14:12,570 --> 00:14:15,870
it's ignored it's like a utility people

383
00:14:14,070 --> 00:14:19,140
treat DNS like electricity it's working

384
00:14:15,870 --> 00:14:20,580
or it's not as resolving or not and it's

385
00:14:19,140 --> 00:14:23,819
allowed outbound even on lockdown

386
00:14:20,580 --> 00:14:25,380
networks i had a company tell me Eric we

387
00:14:23,820 --> 00:14:27,810
have no internet connectivity from this

388
00:14:25,380 --> 00:14:29,790
host and I sit down I typed nslookup

389
00:14:27,810 --> 00:14:31,349
Google comm I get an answer

390
00:14:29,790 --> 00:14:33,449
that's bi-directional Internet

391
00:14:31,350 --> 00:14:35,100
connectivity right like yeah Eric but

392
00:14:33,450 --> 00:14:36,780
that's the afford well at the u.s.

393
00:14:35,100 --> 00:14:37,800
quarter is the Dinah's proxy we don't

394
00:14:36,780 --> 00:14:40,380
think of them that way but they are

395
00:14:37,800 --> 00:14:43,589
right and so if I can send something

396
00:14:40,380 --> 00:14:45,240
Google calm and Google's primary name

397
00:14:43,590 --> 00:14:47,430
server gets that and sends a response

398
00:14:45,240 --> 00:14:49,110
that's bi-directional communication

399
00:14:47,430 --> 00:14:52,199
regardless of how many folders that goes

400
00:14:49,110 --> 00:14:54,150
to it right so would give an example of

401
00:14:52,200 --> 00:14:56,460
something advanced tunneling that both

402
00:14:54,150 --> 00:14:59,160
penetration testers and now or use tool

403
00:14:56,460 --> 00:15:01,580
called iodine you could tunnel any ipv4

404
00:14:59,160 --> 00:15:04,170
protocol via DNS you could tunnel

405
00:15:01,580 --> 00:15:06,060
SSH you could tunnel IPSec you could

406
00:15:04,170 --> 00:15:06,420
tunnel RDP you could tunnel whatever you

407
00:15:06,060 --> 00:15:08,790
want

408
00:15:06,420 --> 00:15:11,910
right here's what it looks like it looks

409
00:15:08,790 --> 00:15:14,370
very very odd right very very odd oh by

410
00:15:11,910 --> 00:15:16,890
the way pro tip no records I've

411
00:15:14,370 --> 00:15:19,800
configured DNS my first domain I

412
00:15:16,890 --> 00:15:20,970
configured zone was 1991 says old man

413
00:15:19,800 --> 00:15:23,399
Conrad

414
00:15:20,970 --> 00:15:24,990
and I never heard of no records right I

415
00:15:23,399 --> 00:15:26,579
don't know what a no record was it's

416
00:15:24,990 --> 00:15:28,410
experimental format that's been this

417
00:15:26,579 --> 00:15:30,420
it's beginning any binary data

418
00:15:28,410 --> 00:15:32,219
transferred via DNS I had no idea you

419
00:15:30,420 --> 00:15:34,378
could transfer binary data DNA you'd be

420
00:15:32,220 --> 00:15:36,930
a DNS place saw that so if you want to

421
00:15:34,379 --> 00:15:38,759
set up DNS tunneling by a domain which

422
00:15:36,930 --> 00:15:41,370
is my son's domain I stole

423
00:15:38,759 --> 00:15:43,740
eega taught me that's a Montenegro had a

424
00:15:41,370 --> 00:15:44,970
one dollar sale one day so I decided to

425
00:15:43,740 --> 00:15:47,009
channel my inner bought her tour and get

426
00:15:44,970 --> 00:15:48,480
some really short domains and you see

427
00:15:47,009 --> 00:15:50,339
I'm looking up hundreds of thousands of

428
00:15:48,480 --> 00:15:53,160
things hundreds of thousands of things

429
00:15:50,339 --> 00:15:56,129
gej taught me using these big binary

430
00:15:53,160 --> 00:16:00,029
records so protip block detect null

431
00:15:56,129 --> 00:16:01,829
records on Windows DNS as a button you

432
00:16:00,029 --> 00:16:03,990
can click on bind yet this up what's

433
00:16:01,829 --> 00:16:08,599
called an RPC a response policy zone

434
00:16:03,990 --> 00:16:12,269
okay and this is a long way of saying

435
00:16:08,600 --> 00:16:14,339
somebody looked at 138 things 3d Jade on

436
00:16:12,269 --> 00:16:15,870
me that's very strange so I'm simply

437
00:16:14,339 --> 00:16:17,399
with what this command is doing is

438
00:16:15,870 --> 00:16:20,550
trimming off the thing before the first

439
00:16:17,399 --> 00:16:26,100
dot many things are left that are unique

440
00:16:20,550 --> 00:16:27,719
and 3d EJ taught me falls right 138

441
00:16:26,100 --> 00:16:30,920
lookups that's not communication that's

442
00:16:27,720 --> 00:16:33,629
not resolution that's communication

443
00:16:30,920 --> 00:16:35,040
one thing we looked at and security 511

444
00:16:33,629 --> 00:16:38,129
was how do I know when a string was

445
00:16:35,040 --> 00:16:39,839
randomly generated like entropy and

446
00:16:38,129 --> 00:16:43,019
cryptographic term it means disorder

447
00:16:39,839 --> 00:16:44,339
right and if I want to know what string

448
00:16:43,019 --> 00:16:45,750
cuz it's thing called domain generation

449
00:16:44,339 --> 00:16:47,879
algorithms are gonna show you shortly

450
00:16:45,750 --> 00:16:49,500
where it's random name dot something dot

451
00:16:47,879 --> 00:16:51,689
something random name dot something dot

452
00:16:49,500 --> 00:16:53,040
something how do I detect random name

453
00:16:51,689 --> 00:16:55,500
dot something dot something I thought

454
00:16:53,040 --> 00:16:58,290
hey this is easy it's the good old ant

455
00:16:55,500 --> 00:17:00,300
command right UNIX has N and Linux says

456
00:16:58,290 --> 00:17:02,519
and built-in it calculates the Shannon

457
00:17:00,300 --> 00:17:05,639
entropy right the disorder I thought

458
00:17:02,519 --> 00:17:07,559
this is easy but if I do 26 letters in

459
00:17:05,640 --> 00:17:09,990
ten numbers which is how a lot of

460
00:17:07,559 --> 00:17:12,899
malware communicates that's 36 out of

461
00:17:09,990 --> 00:17:14,730
two five six that ASCII ASCII values 36

462
00:17:12,900 --> 00:17:17,939
out of two five six is not high entropy

463
00:17:14,730 --> 00:17:19,679
I'm not using most of ASCII if most of

464
00:17:17,939 --> 00:17:21,360
ass keys being unused the entropy is

465
00:17:19,679 --> 00:17:23,400
actually low its orderly per

466
00:17:21,359 --> 00:17:24,750
cryptographer so we looked at it I

467
00:17:23,400 --> 00:17:26,370
thought it was easy and we totally

468
00:17:24,750 --> 00:17:27,959
totally failed because I would have

469
00:17:26,369 --> 00:17:30,299
scripted take that randomly generated

470
00:17:27,959 --> 00:17:32,850
thing and we simply failed luckily I

471
00:17:30,299 --> 00:17:33,570
know a lot of smart people right so we

472
00:17:32,850 --> 00:17:34,709
asked mark

473
00:17:33,570 --> 00:17:36,870
marks the next expert pie

474
00:17:34,710 --> 00:17:37,860
encoder mark humor like a script to

475
00:17:36,870 --> 00:17:39,330
figure out this thing's randomly

476
00:17:37,860 --> 00:17:40,590
generated and don't use then that's a

477
00:17:39,330 --> 00:17:41,939
waste of time ago so yeah and would be a

478
00:17:40,590 --> 00:17:44,029
total waste of time he knew that up to

479
00:17:41,940 --> 00:17:46,380
top his head of course I didn't and

480
00:17:44,029 --> 00:17:48,990
clickety clickety clickety click 15

481
00:17:46,380 --> 00:17:51,299
minutes later freak top py really smart

482
00:17:48,990 --> 00:17:53,760
so you feed it the used to be the Alexa

483
00:17:51,299 --> 00:17:56,760
top million as a corpus you find a

484
00:17:53,760 --> 00:17:58,049
corpus of data that's normal right so

485
00:17:56,760 --> 00:17:59,490
your feet are corporates of normal data

486
00:17:58,049 --> 00:18:01,049
if you look at a DNS you feed it the

487
00:17:59,490 --> 00:18:03,659
Alexa top million I used to be for free

488
00:18:01,049 --> 00:18:05,370
that was a top million websites now they

489
00:18:03,659 --> 00:18:07,799
took a commercial but Cisco umbrella

490
00:18:05,370 --> 00:18:09,689
which does Open DNS they made their top

491
00:18:07,799 --> 00:18:11,668
million available for free so top

492
00:18:09,690 --> 00:18:14,700
million DNS names resolved right

493
00:18:11,669 --> 00:18:17,039
dr. corpus feet at that and in it says

494
00:18:14,700 --> 00:18:18,870
okay how what are the odds that one

495
00:18:17,039 --> 00:18:20,960
character will follow another in a DNS

496
00:18:18,870 --> 00:18:24,870
name does not reduce the NS it could be

497
00:18:20,960 --> 00:18:28,470
exe names function names DLL names

498
00:18:24,870 --> 00:18:31,408
whatever and what are the odds that cue

499
00:18:28,470 --> 00:18:33,179
is followed by W in English or Q is

500
00:18:31,409 --> 00:18:35,039
followed by you know huge lonely flop

501
00:18:33,179 --> 00:18:36,899
followed by you so give it a corpus

502
00:18:35,039 --> 00:18:38,850
it'll calculate the odds of one

503
00:18:36,899 --> 00:18:40,168
character following another and if

504
00:18:38,850 --> 00:18:41,820
that's low enough it'll say hey this is

505
00:18:40,169 --> 00:18:43,409
odd this is unusual per the corporate

506
00:18:41,820 --> 00:18:45,299
you gave me you told me these are the

507
00:18:43,409 --> 00:18:48,360
top million DNS names this is weird

508
00:18:45,299 --> 00:18:50,580
right trying to catch this that's the

509
00:18:48,360 --> 00:18:52,110
domain generation algorithm at work so

510
00:18:50,580 --> 00:18:55,439
it looks up something dot PL randomly

511
00:18:52,110 --> 00:18:57,629
generated PL randomly generated su we

512
00:18:55,440 --> 00:18:59,669
only did it generated dot are you Russia

513
00:18:57,630 --> 00:19:01,799
of course right cuz the vendors are

514
00:18:59,669 --> 00:19:03,870
saying oh zones noise comm is evil well

515
00:19:01,799 --> 00:19:06,120
what if I generate 50 names every eight

516
00:19:03,870 --> 00:19:07,889
hours I'll generate 50 names every eight

517
00:19:06,120 --> 00:19:10,229
hours I'll pick one of them

518
00:19:07,890 --> 00:19:12,539
I already said just that one then eight

519
00:19:10,230 --> 00:19:14,760
hours later a new 50 list eight hours

520
00:19:12,539 --> 00:19:16,830
later a new list of 50 the bots and the

521
00:19:14,760 --> 00:19:18,899
botnet both know the next set of names

522
00:19:16,830 --> 00:19:20,879
coming up right stir constantly churning

523
00:19:18,899 --> 00:19:23,059
through names in order to make

524
00:19:20,880 --> 00:19:25,080
whack-a-mole pointless right so

525
00:19:23,059 --> 00:19:27,120
generating lists of things like this

526
00:19:25,080 --> 00:19:29,158
that change every out every it always

527
00:19:27,120 --> 00:19:31,408
excuse me it's pointless but we just say

528
00:19:29,159 --> 00:19:34,580
hey per the corpus of data you gave me

529
00:19:31,409 --> 00:19:37,980
these names look weird I mean you know

530
00:19:34,580 --> 00:19:40,710
unlikely per normal DNS that's very

531
00:19:37,980 --> 00:19:42,000
effective that's not just DNS it could

532
00:19:40,710 --> 00:19:42,990
be threaten names could be file names

533
00:19:42,000 --> 00:19:47,850
workstation names

534
00:19:42,990 --> 00:19:48,450
service names or not right so does it

535
00:19:47,850 --> 00:19:52,050
scale

536
00:19:48,450 --> 00:19:53,910
everyone wants to know yeah so python

537
00:19:52,050 --> 00:19:58,280
script justin Henderson try to throw

538
00:19:53,910 --> 00:20:01,260
500,000 lookups per second at it

539
00:19:58,280 --> 00:20:03,000
500,000 lookups per second Andy let's

540
00:20:01,260 --> 00:20:04,770
just say the little Python script

541
00:20:03,000 --> 00:20:09,630
exploded you know into a billion pieces

542
00:20:04,770 --> 00:20:11,010
and so we reached out to Demark said we

543
00:20:09,630 --> 00:20:13,470
do this a scale can you make it like a

544
00:20:11,010 --> 00:20:15,660
service like I send it a string and it

545
00:20:13,470 --> 00:20:18,090
gives me a number like a listen on TCP

546
00:20:15,660 --> 00:20:20,550
for 10000 or something I send a string

547
00:20:18,090 --> 00:20:22,649
it sends me a number very quickly sure

548
00:20:20,550 --> 00:20:25,379
two scales to half a million per second

549
00:20:22,650 --> 00:20:28,230
it's running at a nearly 1,000 node wind

550
00:20:25,380 --> 00:20:30,240
side it's scales and when Justin turned

551
00:20:28,230 --> 00:20:31,740
this on I miss nearly 1000 old win site

552
00:20:30,240 --> 00:20:34,590
he found three pieces of malware

553
00:20:31,740 --> 00:20:37,230
instantly instantly by just those names

554
00:20:34,590 --> 00:20:38,970
look weirdest all that was mania mating

555
00:20:37,230 --> 00:20:39,600
incidents have been launched by hey

556
00:20:38,970 --> 00:20:41,370
that's weird

557
00:20:39,600 --> 00:20:43,080
hey there's a 75 cent accounting error

558
00:20:41,370 --> 00:20:44,370
that's on cliff go look at how many

559
00:20:43,080 --> 00:20:45,090
incidents have been launched by hey

560
00:20:44,370 --> 00:20:48,959
that's weird

561
00:20:45,090 --> 00:20:50,429
lots of them right so I stumbled into

562
00:20:48,960 --> 00:20:52,500
this that's not YouTube by the way

563
00:20:50,430 --> 00:20:54,960
that's not the YouTube you know right

564
00:20:52,500 --> 00:20:56,460
and what I like about this career it's

565
00:20:54,960 --> 00:20:58,410
never boring not for long there's always

566
00:20:56,460 --> 00:21:00,060
something new to get owned by or a new

567
00:20:58,410 --> 00:21:02,370
tech need to get hit with new technique

568
00:21:00,060 --> 00:21:04,050
to learn commit yourself to a life of a

569
00:21:02,370 --> 00:21:07,649
career of constant learning as I have

570
00:21:04,050 --> 00:21:10,500
right that's not YouTube that's not the

571
00:21:07,650 --> 00:21:12,890
YouTube you know right why the oh is not

572
00:21:10,500 --> 00:21:15,330
an an ASCII oh it's like a Cyrillic Oh

573
00:21:12,890 --> 00:21:16,500
DNS now supports internationalized

574
00:21:15,330 --> 00:21:19,710
domain names right

575
00:21:16,500 --> 00:21:22,590
meaning Unicode Unicode in DNS so

576
00:21:19,710 --> 00:21:24,690
Unicode you know English fits neatly and

577
00:21:22,590 --> 00:21:27,330
ASCII ASCII as I mentioned this two five

578
00:21:24,690 --> 00:21:29,670
six values but what if I want Cyrillic

579
00:21:27,330 --> 00:21:31,139
and kanji and emojis and everything else

580
00:21:29,670 --> 00:21:32,760
that's not all gonna fit in ASCII

581
00:21:31,140 --> 00:21:34,680
there's too many human languages and

582
00:21:32,760 --> 00:21:37,110
character sets to do that so they have

583
00:21:34,680 --> 00:21:39,720
to but Unicode which is two characters

584
00:21:37,110 --> 00:21:42,209
to display one four byte Unicode floor

585
00:21:39,720 --> 00:21:43,380
characters to display one and joins our

586
00:21:42,210 --> 00:21:44,430
Cyrillic has some letters that are

587
00:21:43,380 --> 00:21:45,900
different but some letters that are

588
00:21:44,430 --> 00:21:48,630
exactly the same as us

589
00:21:45,900 --> 00:21:52,050
English pixel by pixel you can also buy

590
00:21:48,630 --> 00:21:53,490
the the x.509 surfer this you get an SSL

591
00:21:52,050 --> 00:21:55,110
cert for because you own that domain

592
00:21:53,490 --> 00:21:56,970
because that oh it's not an ASCII oh

593
00:21:55,110 --> 00:21:59,729
it's a different oh now if you saw this

594
00:21:56,970 --> 00:22:01,720
email come across your email would you

595
00:21:59,730 --> 00:22:03,430
click on it I probably would I

596
00:22:01,720 --> 00:22:05,860
fall for that trick that's nasty that is

597
00:22:03,430 --> 00:22:07,540
just nasty she's not fair right so the

598
00:22:05,860 --> 00:22:09,550
attackers are now weaponizing this stuff

599
00:22:07,540 --> 00:22:12,190
and it's any the telling you is from

600
00:22:09,550 --> 00:22:14,889
Bank of America calm and it's Bank of

601
00:22:12,190 --> 00:22:16,900
America calm but do is a Cyrillic go and

602
00:22:14,890 --> 00:22:19,840
they buy a surf for that thing as well

603
00:22:16,900 --> 00:22:21,670
and you're you get an email or your boss

604
00:22:19,840 --> 00:22:23,320
gets an email or your your CFO ggest an

605
00:22:21,670 --> 00:22:25,510
email from Bank of America with a

606
00:22:23,320 --> 00:22:27,490
Cyrillic oh they go to the website

607
00:22:25,510 --> 00:22:29,410
they've cloned the website there's a

608
00:22:27,490 --> 00:22:31,540
fraud alert in your accounts please log

609
00:22:29,410 --> 00:22:33,010
in you can see how this goes right you

610
00:22:31,540 --> 00:22:34,870
have to protect your users against this

611
00:22:33,010 --> 00:22:37,750
because most users will fall prey to

612
00:22:34,870 --> 00:22:39,070
this so that's what it looks like it's

613
00:22:37,750 --> 00:22:41,260
interesting how browsers treat that

614
00:22:39,070 --> 00:22:42,790
that's Apple calm but it's not Apple

615
00:22:41,260 --> 00:22:44,620
calm because there's a different L it's

616
00:22:42,790 --> 00:22:47,290
not an English L it's not an ASCII L

617
00:22:44,620 --> 00:22:49,590
it's a different L by default Chrome

618
00:22:47,290 --> 00:22:52,870
says shows you the it's called puny code

619
00:22:49,590 --> 00:22:55,270
chrome shows you the puny code Firefox

620
00:22:52,870 --> 00:22:57,790
today about a fault shows you the Oh it

621
00:22:55,270 --> 00:22:59,170
looks totally totally normal so if I

622
00:22:57,790 --> 00:23:01,120
said hey there's a fraud alert on your

623
00:22:59,170 --> 00:23:03,550
Apple account your iTunes account please

624
00:23:01,120 --> 00:23:05,469
log in and you're using Firefox but a

625
00:23:03,550 --> 00:23:07,720
fault you're in big trouble right you're

626
00:23:05,470 --> 00:23:10,570
in big big trouble you can change all

627
00:23:07,720 --> 00:23:13,000
this stuff right so I recommended your

628
00:23:10,570 --> 00:23:14,530
company even in your house you check out

629
00:23:13,000 --> 00:23:15,820
these settings again this talks online I

630
00:23:14,530 --> 00:23:17,920
know I'm hitting you with a lot of data

631
00:23:15,820 --> 00:23:20,080
believe me I know I like even talks fast

632
00:23:17,920 --> 00:23:21,850
and furious that's my style I realized a

633
00:23:20,080 --> 00:23:24,010
more than less that's how I roll right

634
00:23:21,850 --> 00:23:27,129
but Eric Conrad calm first you can

635
00:23:24,010 --> 00:23:28,780
download it right now okay and these the

636
00:23:27,130 --> 00:23:30,820
settings here for changing the behavior

637
00:23:28,780 --> 00:23:32,680
especially if firefox chrome does a good

638
00:23:30,820 --> 00:23:37,840
job with this Firefox

639
00:23:32,680 --> 00:23:40,390
not so much so how do I detect that

640
00:23:37,840 --> 00:23:42,820
someone's cloned my domain we call these

641
00:23:40,390 --> 00:23:45,730
cousin domains right I remember I had a

642
00:23:42,820 --> 00:23:48,250
client it was Johnson Johnson accounting

643
00:23:45,730 --> 00:23:51,040
com right what was the actual CP firm

644
00:23:48,250 --> 00:23:52,390
they used Johnson accounting calm they

645
00:23:51,040 --> 00:23:55,870
start getting emails from Johnson

646
00:23:52,390 --> 00:23:58,540
accountants calm right and so your CPA

647
00:23:55,870 --> 00:24:00,040
is Freddy Johnson accounting calm now

648
00:23:58,540 --> 00:24:01,840
get an email from Freddy Johnson

649
00:24:00,040 --> 00:24:03,580
accountants calm right

650
00:24:01,840 --> 00:24:06,010
they've also cloned to the Johnson

651
00:24:03,580 --> 00:24:08,590
accounting website the email footer is

652
00:24:06,010 --> 00:24:10,180
Fred's actual email footer copied but

653
00:24:08,590 --> 00:24:12,520
it's not for the Johnson accounting calm

654
00:24:10,180 --> 00:24:14,419
it spread its Johnson accountants calm

655
00:24:12,520 --> 00:24:16,399
these are much more targeted attack

656
00:24:14,419 --> 00:24:18,259
this is called spearfishing a whale

657
00:24:16,399 --> 00:24:20,840
hunting you know how do you

658
00:24:18,259 --> 00:24:22,669
programmatically detect that because one

659
00:24:20,840 --> 00:24:24,080
thing I've learned layer aid is always

660
00:24:22,669 --> 00:24:26,389
going to fail layer eight is the

661
00:24:24,080 --> 00:24:28,789
unofficial OSI model layer above seven

662
00:24:26,389 --> 00:24:30,590
the person right that's layer eight and

663
00:24:28,789 --> 00:24:32,509
you can give us a hard time about making

664
00:24:30,590 --> 00:24:33,799
mistakes you can do all the security

665
00:24:32,509 --> 00:24:35,690
awareness you want to do but end of the

666
00:24:33,799 --> 00:24:37,730
day people will make mistakes that's our

667
00:24:35,690 --> 00:24:38,929
nature and instead of saying okay we'll

668
00:24:37,730 --> 00:24:40,730
just try harder we'll have more

669
00:24:38,929 --> 00:24:42,619
awareness how do we build better

670
00:24:40,730 --> 00:24:46,460
defenses right how do we build better

671
00:24:42,619 --> 00:24:49,279
defenses how about we program for that

672
00:24:46,460 --> 00:24:51,759
failure like there was a famous plane

673
00:24:49,279 --> 00:24:56,230
crash last year so a plane accident

674
00:24:51,759 --> 00:24:58,970
Southwest Airlines right engine explodes

675
00:24:56,230 --> 00:25:01,460
shrapnel shoots through the window of

676
00:24:58,970 --> 00:25:02,720
the engine blows the window open and a

677
00:25:01,460 --> 00:25:05,929
woman's pulled halfway out the plan

678
00:25:02,720 --> 00:25:08,389
right and the plane begins emergency

679
00:25:05,929 --> 00:25:12,590
descent and all the oxygen masks drop

680
00:25:08,389 --> 00:25:14,418
right and someone took a picture of the

681
00:25:12,590 --> 00:25:16,119
oxygen mask and everyone has it on wrong

682
00:25:14,419 --> 00:25:17,600
and what has done below their nose right

683
00:25:16,119 --> 00:25:20,059
everyone you can see in that picture

684
00:25:17,600 --> 00:25:21,049
it's below their nose people started

685
00:25:20,059 --> 00:25:22,970
saying hey you should listen to

686
00:25:21,049 --> 00:25:24,289
pre-flight video the safety video come

687
00:25:22,970 --> 00:25:25,309
on and we're blaming the users I'm like

688
00:25:24,289 --> 00:25:27,590
I'm blaming the engineer who designed

689
00:25:25,309 --> 00:25:29,119
that Cup because if it's a perfectly

690
00:25:27,590 --> 00:25:30,889
round Cup you'll put it over your mouth

691
00:25:29,119 --> 00:25:32,539
you've made a little notch where the

692
00:25:30,889 --> 00:25:34,908
nose goes you'll put that notch over

693
00:25:32,539 --> 00:25:36,230
your nose so yes we have responsibility

694
00:25:34,909 --> 00:25:38,539
to be more careful and listen to the

695
00:25:36,230 --> 00:25:40,340
preflight safety video but how about we

696
00:25:38,539 --> 00:25:42,289
engineer better systems that are more

697
00:25:40,340 --> 00:25:43,789
resilient that are lowering the chances

698
00:25:42,289 --> 00:25:46,158
of a mistake they'll make a mistake well

699
00:25:43,789 --> 00:25:47,960
how costly that mistake will be so

700
00:25:46,159 --> 00:25:50,149
Dinah's twist what you do Adina's twist

701
00:25:47,960 --> 00:25:52,999
is as you use as a surfing the web

702
00:25:50,149 --> 00:25:54,859
you're calculating how likely the names

703
00:25:52,999 --> 00:25:57,139
they're going to are like names you care

704
00:25:54,859 --> 00:25:58,399
about like Eric Conrad calm not that

705
00:25:57,139 --> 00:26:00,168
that's a high-value target you could

706
00:25:58,399 --> 00:26:02,449
steal on my talks they're free anyways

707
00:26:00,169 --> 00:26:05,840
right but if someone wanted to clone

708
00:26:02,450 --> 00:26:08,090
Eric conrad calm right and like take out

709
00:26:05,840 --> 00:26:11,178
one of the seas instead of Eric Conrad

710
00:26:08,090 --> 00:26:13,428
CC Eric on rad right and use that as a

711
00:26:11,179 --> 00:26:15,019
cousin domain we call that right could

712
00:26:13,429 --> 00:26:16,609
it tell be using to be more careful yes

713
00:26:15,019 --> 00:26:18,649
well they still make mistakes enough

714
00:26:16,609 --> 00:26:20,629
will let's be honest right so how about

715
00:26:18,649 --> 00:26:22,459
we programmatically detect that two DNS

716
00:26:20,629 --> 00:26:23,689
twists and you see names that are very

717
00:26:22,460 --> 00:26:24,889
less than the names you care about now

718
00:26:23,690 --> 00:26:26,090
you the names you care about will be

719
00:26:24,889 --> 00:26:26,570
different than the names I care about

720
00:26:26,090 --> 00:26:29,310
perhaps

721
00:26:26,570 --> 00:26:32,790
either block it or alerts warn the user

722
00:26:29,310 --> 00:26:36,360
tell the sock etc he is the eternal

723
00:26:32,790 --> 00:26:40,800
Deanna scurry logging on Windows 20 2008

724
00:26:36,360 --> 00:26:42,719
2012 and DNS analytical logging on

725
00:26:40,800 --> 00:26:44,550
Windows 2012 r2 plus now they've

726
00:26:42,720 --> 00:26:47,580
actually vastly improved it the old

727
00:26:44,550 --> 00:26:50,790
method was plain text local file plain

728
00:26:47,580 --> 00:26:53,460
text not ideal the new method is

729
00:26:50,790 --> 00:26:55,379
actually honest-to-goodness Windows

730
00:26:53,460 --> 00:26:58,830
Event log forwarding plays nicely with

731
00:26:55,380 --> 00:27:02,120
your sim etc etc here's how you do it on

732
00:26:58,830 --> 00:27:05,699
by 9 as well alright

733
00:27:02,120 --> 00:27:08,280
client to client traffic is it normal

734
00:27:05,700 --> 00:27:11,310
for a client to send unicast traffic

735
00:27:08,280 --> 00:27:13,770
meaning one to one to another client not

736
00:27:11,310 --> 00:27:15,960
really like there are exceptions we'll

737
00:27:13,770 --> 00:27:17,460
talk about that but on a Windows network

738
00:27:15,960 --> 00:27:18,660
if you turn a bunch of Windows PCs on

739
00:27:17,460 --> 00:27:20,190
they'll start chatting with each other

740
00:27:18,660 --> 00:27:21,690
over like net bias broadcast they'll

741
00:27:20,190 --> 00:27:23,040
stop saying broadcast traffic to each

742
00:27:21,690 --> 00:27:24,900
other but they will want to actually

743
00:27:23,040 --> 00:27:26,220
talk unicast to each other and let's

744
00:27:24,900 --> 00:27:28,320
chip a couple of use cases which we'll

745
00:27:26,220 --> 00:27:32,010
talk about what you want to do now is

746
00:27:28,320 --> 00:27:34,770
kill the pivot the pivot is when one

747
00:27:32,010 --> 00:27:37,110
system is affected right one user clicks

748
00:27:34,770 --> 00:27:39,900
on an email Johnson account tun

749
00:27:37,110 --> 00:27:42,030
stock.com comes in they click on it it's

750
00:27:39,900 --> 00:27:45,180
a cousin domain and now those Malheur on

751
00:27:42,030 --> 00:27:47,190
that box but often the first box a pen

752
00:27:45,180 --> 00:27:48,750
tester or malware hits it's not the box

753
00:27:47,190 --> 00:27:50,430
of interest it's just the foothold

754
00:27:48,750 --> 00:27:52,380
it's the beachhead you're behind that

755
00:27:50,430 --> 00:27:54,390
first firewall you behind enemy lines

756
00:27:52,380 --> 00:27:56,100
right and you want to move further

757
00:27:54,390 --> 00:27:58,080
so you've achieved the first goal which

758
00:27:56,100 --> 00:27:59,730
is to get behind that first firewall but

759
00:27:58,080 --> 00:28:01,919
the real goal is say steal the crown

760
00:27:59,730 --> 00:28:03,540
jewels the crown jewels probably aren't

761
00:28:01,920 --> 00:28:04,170
on the system you hit write it someplace

762
00:28:03,540 --> 00:28:06,090
else

763
00:28:04,170 --> 00:28:07,710
so you start pivoting you start moving

764
00:28:06,090 --> 00:28:12,300
laterally from one system to another

765
00:28:07,710 --> 00:28:14,280
right and you know also with with

766
00:28:12,300 --> 00:28:15,870
malware not petia if you've manually

767
00:28:14,280 --> 00:28:18,060
synchronized you to your local admin

768
00:28:15,870 --> 00:28:20,159
password 10,000 clients kiss them all

769
00:28:18,060 --> 00:28:22,379
goodbye they're all going away right so

770
00:28:20,160 --> 00:28:24,000
is it normal for clients to talk to

771
00:28:22,380 --> 00:28:25,400
clients there are some you say it's

772
00:28:24,000 --> 00:28:27,750
cases I'll cover but it's not normal

773
00:28:25,400 --> 00:28:30,320
good hotels have what's called station

774
00:28:27,750 --> 00:28:34,380
isolation station isolation says room

775
00:28:30,320 --> 00:28:36,000
1342 can't talk to him for 1343 now want

776
00:28:34,380 --> 00:28:37,920
the person next door scanning me or

777
00:28:36,000 --> 00:28:39,820
infecting me of course not I don't want

778
00:28:37,920 --> 00:28:42,100
to talk to any other room in that hotel

779
00:28:39,820 --> 00:28:44,019
I want to reach the Internet so a good

780
00:28:42,100 --> 00:28:45,428
wireless network has station isolation

781
00:28:44,019 --> 00:28:47,679
don't let clients talk to clients

782
00:28:45,429 --> 00:28:50,259
clients only talk to this switch your

783
00:28:47,679 --> 00:28:52,330
default gateway etc so that's a good

784
00:28:50,259 --> 00:28:57,309
idea on a wireless network why not do a

785
00:28:52,330 --> 00:28:59,499
wire now what cases do we have when

786
00:28:57,309 --> 00:29:01,570
clients talk to clients you know how

787
00:28:59,499 --> 00:29:02,649
might this be difficult to pull off well

788
00:29:01,570 --> 00:29:04,059
if you have a pulley design network

789
00:29:02,649 --> 00:29:06,309
you're mixing clients and servers in the

790
00:29:04,059 --> 00:29:07,178
same VLAN virtual LAN that's gonna break

791
00:29:06,309 --> 00:29:09,249
you because you want to have a private

792
00:29:07,179 --> 00:29:11,409
VLAN the private view that says clients

793
00:29:09,249 --> 00:29:13,720
don't talk to clients clients only talk

794
00:29:11,409 --> 00:29:15,639
to a promiscuous port which is the

795
00:29:13,720 --> 00:29:16,809
default gateway you turn that on and you

796
00:29:15,639 --> 00:29:17,949
in turn make them clients and servers

797
00:29:16,809 --> 00:29:19,479
you're obviously gonna break the

798
00:29:17,950 --> 00:29:21,519
server's but don't intermingle clients

799
00:29:19,479 --> 00:29:23,080
or servers have server networks and

800
00:29:21,519 --> 00:29:27,609
client networks you want at least three

801
00:29:23,080 --> 00:29:30,580
types of networks IT clients non IT

802
00:29:27,609 --> 00:29:32,470
clients and servers and then the non IT

803
00:29:30,580 --> 00:29:33,939
clients they can't talk to each other I

804
00:29:32,470 --> 00:29:36,580
tease except that obviously because they

805
00:29:33,940 --> 00:29:38,169
have to administer boxes right and does

806
00:29:36,580 --> 00:29:39,789
anything violate that rule is anything

807
00:29:38,169 --> 00:29:41,830
applying to clients sure some

808
00:29:39,789 --> 00:29:42,879
audio/video stuff some commercial

809
00:29:41,830 --> 00:29:45,039
products like Taney I'm sending

810
00:29:42,879 --> 00:29:47,580
peer-to-peer updates Windows has this

811
00:29:45,039 --> 00:29:49,929
crazy delivery optimization mode where

812
00:29:47,580 --> 00:29:51,489
clients and patches to other clients

813
00:29:49,929 --> 00:29:52,869
that's not designed for the enterprise

814
00:29:51,489 --> 00:29:56,049
network that's designed for ad-hoc

815
00:29:52,869 --> 00:29:57,549
workgroups we call them you know at the

816
00:29:56,049 --> 00:29:59,200
end of the day I don't care if you block

817
00:29:57,549 --> 00:30:00,970
it layer two which is a private of Eliam

818
00:29:59,200 --> 00:30:02,979
or layer three four which is a

819
00:30:00,970 --> 00:30:05,109
host-based firewall I want to stop

820
00:30:02,979 --> 00:30:06,429
clients from talking to clients one of

821
00:30:05,109 --> 00:30:08,918
the things your company may want to

822
00:30:06,429 --> 00:30:11,259
pursue is zero trust networking zero

823
00:30:08,919 --> 00:30:13,690
trust networking is it used to be the

824
00:30:11,259 --> 00:30:14,710
old days out sides evil insides trusted

825
00:30:13,690 --> 00:30:16,330
right the perimeter

826
00:30:14,710 --> 00:30:17,919
well the perimeters dead now all right

827
00:30:16,330 --> 00:30:19,840
the perimeter is quite dead so it's

828
00:30:17,919 --> 00:30:22,029
testing outside evil insides good

829
00:30:19,840 --> 00:30:22,779
everything's potentially evil excuse me

830
00:30:22,029 --> 00:30:25,720
until proven otherwise

831
00:30:22,779 --> 00:30:28,659
right and zero trust Google has now

832
00:30:25,720 --> 00:30:31,119
pursued zero trust globally Google is

833
00:30:28,659 --> 00:30:34,840
subject to intense nation Street state

834
00:30:31,119 --> 00:30:37,449
scrutiny excuse me they're subject to

835
00:30:34,840 --> 00:30:38,889
intense nation-states scrutiny world

836
00:30:37,450 --> 00:30:41,259
governments want a hack Google who'd

837
00:30:38,889 --> 00:30:43,178
want all your Gmail and all your Google

838
00:30:41,259 --> 00:30:45,039
Maps history that your phone tracks in a

839
00:30:43,179 --> 00:30:46,419
very stalkerish way right what a

840
00:30:45,039 --> 00:30:48,220
nation-state wouldn't want that

841
00:30:46,419 --> 00:30:49,720
so nation-states are constantly trying

842
00:30:48,220 --> 00:30:52,899
to hack into Google because there's all

843
00:30:49,720 --> 00:30:53,560
kinds of data in Google right so if

844
00:30:52,899 --> 00:30:55,179
they're pursuing its

845
00:30:53,560 --> 00:30:56,110
technology globally that's expensive and

846
00:30:55,180 --> 00:30:57,430
hard to pull off you should pay

847
00:30:56,110 --> 00:30:58,750
attention because they know what it's

848
00:30:57,430 --> 00:31:01,360
like to be in the receiving end right

849
00:30:58,750 --> 00:31:03,790
and zero trust is nothing's trusted til

850
00:31:01,360 --> 00:31:06,040
proven inside outside doesn't matter and

851
00:31:03,790 --> 00:31:08,230
that's tough to pull off that may seem

852
00:31:06,040 --> 00:31:10,300
very intimidating however if you stop

853
00:31:08,230 --> 00:31:13,090
clients from talking to clients you made

854
00:31:10,300 --> 00:31:14,590
a huge leap forward for a fairly simple

855
00:31:13,090 --> 00:31:16,590
change that your users probably won't

856
00:31:14,590 --> 00:31:20,649
even notice right

857
00:31:16,590 --> 00:31:22,810
also one killer killer feature of your

858
00:31:20,650 --> 00:31:25,840
host-based firewall is blocking by

859
00:31:22,810 --> 00:31:27,970
application man turn this on most

860
00:31:25,840 --> 00:31:29,770
firewalls block at layer 3 and layer 4

861
00:31:27,970 --> 00:31:31,390
which is IP addresses imports right

862
00:31:29,770 --> 00:31:33,550
we've done that for literally decades

863
00:31:31,390 --> 00:31:35,880
since there are 1989 we've had firewalls

864
00:31:33,550 --> 00:31:38,800
like that right IP addresses and ports

865
00:31:35,880 --> 00:31:41,500
the windows firewall built in free and

866
00:31:38,800 --> 00:31:44,290
most commercial host-based firewalls can

867
00:31:41,500 --> 00:31:46,480
also block by application right so

868
00:31:44,290 --> 00:31:48,879
instead of blocking port protocol keep

869
00:31:46,480 --> 00:31:50,890
doing that block by app how often is the

870
00:31:48,880 --> 00:31:52,960
secretary PowerShell remote out of his

871
00:31:50,890 --> 00:31:55,660
or her own PC how often does the

872
00:31:52,960 --> 00:31:57,160
secretary use piece exec or W milk I

873
00:31:55,660 --> 00:31:59,230
mentioned W make when I talked about not

874
00:31:57,160 --> 00:32:00,790
petia that the 10 to 10 billion dollar

875
00:31:59,230 --> 00:32:03,190
strain of ransomware right our sorry

876
00:32:00,790 --> 00:32:05,139
destructive malware so you should on

877
00:32:03,190 --> 00:32:08,650
again you have three types of networks

878
00:32:05,140 --> 00:32:11,260
at least maybe more servers IT clients

879
00:32:08,650 --> 00:32:13,090
non IT clients and the rule for non 80

880
00:32:11,260 --> 00:32:15,879
clients is block alert on all of these

881
00:32:13,090 --> 00:32:18,490
because if you do that I'm a pen tester

882
00:32:15,880 --> 00:32:20,710
and I pull up the Johnson account INSCOM

883
00:32:18,490 --> 00:32:22,060
trick I do a cousin domain the first

884
00:32:20,710 --> 00:32:24,460
thing I try to do is move laterally

885
00:32:22,060 --> 00:32:26,440
using one of these tools so if you have

886
00:32:24,460 --> 00:32:28,390
the windows firewall block and alert on

887
00:32:26,440 --> 00:32:30,970
any attempt from non IT clients to use

888
00:32:28,390 --> 00:32:32,770
this you catch me in seconds my pen test

889
00:32:30,970 --> 00:32:34,510
will be over literally in seconds cuz

890
00:32:32,770 --> 00:32:34,990
your sock will know you'll be hunting me

891
00:32:34,510 --> 00:32:36,760
down

892
00:32:34,990 --> 00:32:38,200
Microsoft talks about this a lot I've

893
00:32:36,760 --> 00:32:39,400
got to know some folks at Microsoft I

894
00:32:38,200 --> 00:32:42,550
just spent some time at the Blue Team

895
00:32:39,400 --> 00:32:44,410
summit last week and I love the new look

896
00:32:42,550 --> 00:32:46,210
Microsoft they are drinking the kool-aid

897
00:32:44,410 --> 00:32:48,040
man they've turned that company around

898
00:32:46,210 --> 00:32:50,470
for a security standpoint and what a

899
00:32:48,040 --> 00:32:52,659
large customer there is is infected has

900
00:32:50,470 --> 00:32:55,150
an incident don't hop in a plane to fly

901
00:32:52,660 --> 00:32:56,770
out there your fortune 500 you spend a

902
00:32:55,150 --> 00:32:57,850
lot of money with Microsoft when you

903
00:32:56,770 --> 00:32:59,740
have a massive incident they'll fly

904
00:32:57,850 --> 00:33:01,240
someone out an expert on whatever just

905
00:32:59,740 --> 00:33:02,620
happened to you you know the

906
00:33:01,240 --> 00:33:04,600
technologies that was used to make that

907
00:33:02,620 --> 00:33:06,850
happen and I talked to some folks at

908
00:33:04,600 --> 00:33:09,969
Microsoft like Eric everything

909
00:33:06,850 --> 00:33:11,469
time every single incident the built-in

910
00:33:09,970 --> 00:33:13,630
functionality they already paid for

911
00:33:11,470 --> 00:33:16,270
would have both prevented and detected

912
00:33:13,630 --> 00:33:17,830
it had they simply turned it on simply

913
00:33:16,270 --> 00:33:22,990
turn it on oh by the way they looked at

914
00:33:17,830 --> 00:33:26,800
um Asher Microsoft cloud stuff two years

915
00:33:22,990 --> 00:33:29,350
ago only 0.7% of administrators had

916
00:33:26,800 --> 00:33:32,530
multi-factor authentication point seven

917
00:33:29,350 --> 00:33:34,240
percent of admins use multi-factor

918
00:33:32,530 --> 00:33:36,070
authentication in Azure right

919
00:33:34,240 --> 00:33:39,010
a year later it was one point seven

920
00:33:36,070 --> 00:33:40,780
percent so the needles moving but not

921
00:33:39,010 --> 00:33:42,190
fast enough right multi-factor

922
00:33:40,780 --> 00:33:44,379
authentication is built-in it takes

923
00:33:42,190 --> 00:33:46,180
whole swathes of attacks off the table

924
00:33:44,380 --> 00:33:48,340
you know what you call hacking I call

925
00:33:46,180 --> 00:33:50,140
logging in I mean that most hacks are

926
00:33:48,340 --> 00:33:52,480
just logging in that's all it really is

927
00:33:50,140 --> 00:33:54,190
it says pen testing is easy the dirty

928
00:33:52,480 --> 00:33:56,380
secret penetration testing it's easy

929
00:33:54,190 --> 00:33:58,360
blue team the defense that's the hard

930
00:33:56,380 --> 00:34:00,070
stuff pen testing is easy I can make a

931
00:33:58,360 --> 00:34:02,649
harder mistakes and still beat you as a

932
00:34:00,070 --> 00:34:05,230
pen tester that's a defender one mistake

933
00:34:02,650 --> 00:34:06,700
might do me in it might right so I've

934
00:34:05,230 --> 00:34:08,110
talked to people Microsoft like Eric

935
00:34:06,700 --> 00:34:10,210
every major hack you've read about in

936
00:34:08,110 --> 00:34:13,030
the paper they're a big Microsoft shop

937
00:34:10,210 --> 00:34:14,770
we flew in every single time that could

938
00:34:13,030 --> 00:34:17,170
have prevented and detected have they

939
00:34:14,770 --> 00:34:20,800
simply used built-in functionality like

940
00:34:17,170 --> 00:34:24,480
this alright my last section is going to

941
00:34:20,800 --> 00:34:26,860
be on something I love to do a little

942
00:34:24,480 --> 00:34:28,929
wizardry from the past they picked up

943
00:34:26,860 --> 00:34:30,820
there's the kind of thing like UNIX

944
00:34:28,929 --> 00:34:33,669
people from the nineties learn to do

945
00:34:30,820 --> 00:34:36,550
it's kind of this bit of lost art right

946
00:34:33,670 --> 00:34:38,650
a darknet so the term dark that's been

947
00:34:36,550 --> 00:34:40,840
co-opted by tor hidden nodes in the dark

948
00:34:38,650 --> 00:34:43,240
web and Silk Road that's not what I mean

949
00:34:40,840 --> 00:34:46,450
by dark net dark net is unrouted IP

950
00:34:43,239 --> 00:34:48,639
space IPS IP space you either own or is

951
00:34:46,449 --> 00:34:51,399
contiguous or near you the space you're

952
00:34:48,639 --> 00:34:55,719
using that you're not using right so I'm

953
00:34:51,400 --> 00:34:57,040
using 192.168.1 got something dot

954
00:34:55,719 --> 00:34:58,569
something and dots read out something

955
00:34:57,040 --> 00:35:00,850
and that's it right and that's that's

956
00:34:58,570 --> 00:35:03,070
private space that's called RFC 1918

957
00:35:00,850 --> 00:35:04,660
space request for comets the private

958
00:35:03,070 --> 00:35:06,130
addresses you didn't map to the Internet

959
00:35:04,660 --> 00:35:08,890
they're not routed on the Internet

960
00:35:06,130 --> 00:35:14,230
you're using internally now 192.168.1.0

961
00:35:08,890 --> 00:35:16,629
through two five five 2.0 to 255 3.0

962
00:35:14,230 --> 00:35:18,160
through 255 right and you're ignoring

963
00:35:16,630 --> 00:35:18,970
the rest you're not routing it I'm

964
00:35:18,160 --> 00:35:20,379
saying

965
00:35:18,970 --> 00:35:23,259
route

966
00:35:20,380 --> 00:35:24,520
everything else near that - a dark dark

967
00:35:23,260 --> 00:35:28,840
net router and then just count it

968
00:35:24,520 --> 00:35:31,509
discount it right and why now we're

969
00:35:28,840 --> 00:35:33,460
likes to scan pen test is like the scan

970
00:35:31,510 --> 00:35:35,620
we love scanning right you break and you

971
00:35:33,460 --> 00:35:39,400
start scanning right and if you're using

972
00:35:35,620 --> 00:35:45,240
1.0 2.0 3.0 and 4.0 I'm probably gonna

973
00:35:39,400 --> 00:35:45,240
scan 192.168.0.0 to 192 168

974
00:35:48,180 --> 00:35:55,210
255.255.255.0 notice an IDs intrusion

975
00:35:53,230 --> 00:35:56,650
detection system the first rules that

976
00:35:55,210 --> 00:35:57,820
are disabled out of scanning rules the

977
00:35:56,650 --> 00:36:00,070
port scanning rules because they're so

978
00:35:57,820 --> 00:36:01,780
noisy so many false positives right so

979
00:36:00,070 --> 00:36:04,480
much that's just noise so we turn her

980
00:36:01,780 --> 00:36:06,640
off instead of turning that off route

981
00:36:04,480 --> 00:36:09,130
that space to a darknet router right and

982
00:36:06,640 --> 00:36:11,859
then simply count what goes there right

983
00:36:09,130 --> 00:36:14,830
so the count what goes there this is the

984
00:36:11,860 --> 00:36:17,140
witty worm the witty worm discovered by

985
00:36:14,830 --> 00:36:18,220
a darknet router the witty worm is one

986
00:36:17,140 --> 00:36:18,850
of the most destructive worms in

987
00:36:18,220 --> 00:36:20,649
internet history

988
00:36:18,850 --> 00:36:22,750
it was nasty it was a nasty piece of

989
00:36:20,650 --> 00:36:25,150
work most worms well petty had changed

990
00:36:22,750 --> 00:36:26,980
this not pity to change this till not

991
00:36:25,150 --> 00:36:28,810
petty and most worms were breeders not

992
00:36:26,980 --> 00:36:30,430
warriors they spread they didn't fight

993
00:36:28,810 --> 00:36:31,930
when they took down networks it wasn't

994
00:36:30,430 --> 00:36:33,580
intentional just bad design that a

995
00:36:31,930 --> 00:36:35,589
sprayer or good design I guess they

996
00:36:33,580 --> 00:36:38,440
spread so quickly these overwhelm stuff

997
00:36:35,590 --> 00:36:40,270
right and so but they didn't normally

998
00:36:38,440 --> 00:36:41,830
destroy that's changed more recently but

999
00:36:40,270 --> 00:36:44,200
witty was a while back it attacked

1000
00:36:41,830 --> 00:36:47,440
firewalls black guys firewalls which by

1001
00:36:44,200 --> 00:36:49,899
their nature are internet facing and you

1002
00:36:47,440 --> 00:36:52,750
can see the explosion traffic there it

1003
00:36:49,900 --> 00:36:55,270
was a one packet UDP attack UDP which is

1004
00:36:52,750 --> 00:36:57,430
nasty and most worms follow what's

1005
00:36:55,270 --> 00:36:59,680
called the inverted hockey stick growth

1006
00:36:57,430 --> 00:37:01,690
pattern one worm segment that's the

1007
00:36:59,680 --> 00:37:04,060
formal name becomes two to become four

1008
00:37:01,690 --> 00:37:06,100
four become eight eight becomes 16 and

1009
00:37:04,060 --> 00:37:08,200
eventually the math explodes but it

1010
00:37:06,100 --> 00:37:10,750
starts relatively slowly than geomatica

1011
00:37:08,200 --> 00:37:13,419
geometrically flies up whoever created

1012
00:37:10,750 --> 00:37:17,170
this worm scan the internet for black

1013
00:37:13,420 --> 00:37:19,930
eyes firewalls found 10,000 and preceded

1014
00:37:17,170 --> 00:37:21,520
10,000 at once this is nasty so instead

1015
00:37:19,930 --> 00:37:25,330
of one becoming to becoming for becoming

1016
00:37:21,520 --> 00:37:28,120
eight 10,000 became 20,000 became 40,000

1017
00:37:25,330 --> 00:37:29,950
within hours every black eyes firewall

1018
00:37:28,120 --> 00:37:30,430
was infected and here's how it actually

1019
00:37:29,950 --> 00:37:33,490
worked

1020
00:37:30,430 --> 00:37:34,210
it would had two cycles one cycle would

1021
00:37:33,490 --> 00:37:37,450
be spread

1022
00:37:34,210 --> 00:37:39,970
the second cycle would be chew up blocks

1023
00:37:37,450 --> 00:37:42,580
in a disc spread destroy data spread the

1024
00:37:39,970 --> 00:37:44,350
story data spread destroy data because

1025
00:37:42,580 --> 00:37:46,240
if a simply blew a firewall up right

1026
00:37:44,350 --> 00:37:48,130
away it wouldn't spread it's kind of

1027
00:37:46,240 --> 00:37:49,629
like a human pathogen if a human

1028
00:37:48,130 --> 00:37:51,220
pathogen killed everyone instantly it

1029
00:37:49,630 --> 00:37:52,960
wouldn't spread because people wouldn't

1030
00:37:51,220 --> 00:37:54,310
be around to spread it though so it has

1031
00:37:52,960 --> 00:37:56,440
to kind of Angel you believe you stumble

1032
00:37:54,310 --> 00:37:58,690
around a bit you know if what both good

1033
00:37:56,440 --> 00:38:01,390
pathogens do right it's spread it

1034
00:37:58,690 --> 00:38:02,920
typhoid mary right Black Plague so they

1035
00:38:01,390 --> 00:38:04,900
they too did well they wanted to blow up

1036
00:38:02,920 --> 00:38:07,330
those firewalls but not too quickly not

1037
00:38:04,900 --> 00:38:11,230
too slowly just right and it was first

1038
00:38:07,330 --> 00:38:13,210
detected by a darknet router so I had we

1039
00:38:11,230 --> 00:38:14,860
had our internal audit team was fond of

1040
00:38:13,210 --> 00:38:16,810
dropping unannounced penetration tests

1041
00:38:14,860 --> 00:38:19,240
on us they stored for Hospital chain of

1042
00:38:16,810 --> 00:38:20,650
Boston I was the HIPAA Security Officer

1043
00:38:19,240 --> 00:38:22,830
that's Health Insurance Portability and

1044
00:38:20,650 --> 00:38:25,180
Accountability Act in Boston right and

1045
00:38:22,830 --> 00:38:28,000
the internal audit team love to hire

1046
00:38:25,180 --> 00:38:29,500
unannounced pentest and so my team of

1047
00:38:28,000 --> 00:38:31,240
innocent handlers we'd handle these

1048
00:38:29,500 --> 00:38:32,620
incidents not knowing was that she'd

1049
00:38:31,240 --> 00:38:35,770
good guys firing at us we thought was

1050
00:38:32,620 --> 00:38:39,670
bad guys and so our darknet router the

1051
00:38:35,770 --> 00:38:41,320
rule was if dark net traffic doubles you

1052
00:38:39,670 --> 00:38:42,940
let us know because you might be

1053
00:38:41,320 --> 00:38:44,800
thinking there's no dark net traffic on

1054
00:38:42,940 --> 00:38:46,270
the internet there's plenty worms are

1055
00:38:44,800 --> 00:38:48,280
skinny but I'm talking internally now

1056
00:38:46,270 --> 00:38:50,410
internally internally you might have

1057
00:38:48,280 --> 00:38:51,970
dark nitaac why layer 8 I mentioned that

1058
00:38:50,410 --> 00:38:52,390
term people make mistakes wrong that

1059
00:38:51,970 --> 00:38:54,790
mask

1060
00:38:52,390 --> 00:38:57,129
wrong gateway I fat-fingered IP wrong

1061
00:38:54,790 --> 00:38:58,509
domain name whatever right so you see

1062
00:38:57,130 --> 00:39:00,010
some of that stuff and we were trying to

1063
00:38:58,510 --> 00:39:01,780
fix that stuff but it was a little study

1064
00:39:00,010 --> 00:39:04,690
steady hum of that kind of stuff right

1065
00:39:01,780 --> 00:39:05,920
but the rule was if darkness wake

1066
00:39:04,690 --> 00:39:07,420
someone up right

1067
00:39:05,920 --> 00:39:10,390
so if dark net traffic doubles wake

1068
00:39:07,420 --> 00:39:12,850
someone up 3a mas and Hanna got woken up

1069
00:39:10,390 --> 00:39:14,440
there was a 10,000 percent increase in

1070
00:39:12,850 --> 00:39:17,890
dark net traffic on our network right

1071
00:39:14,440 --> 00:39:18,840
rolls out of bed he finds a PC and a

1072
00:39:17,890 --> 00:39:22,359
guard shack

1073
00:39:18,840 --> 00:39:23,670
scanning our entire the what's called a

1074
00:39:22,360 --> 00:39:26,470
Class B

1075
00:39:23,670 --> 00:39:27,880
65536 addresses that's a Class B we were

1076
00:39:26,470 --> 00:39:29,379
using a few hundred of them actually or

1077
00:39:27,880 --> 00:39:31,570
a few thousand but they were trying to

1078
00:39:29,380 --> 00:39:33,550
scan 65,000 536 addresses all the

1079
00:39:31,570 --> 00:39:35,770
addresses nearby the ones we were using

1080
00:39:33,550 --> 00:39:39,910
from a guard shack guard clicked on the

1081
00:39:35,770 --> 00:39:41,440
phishing email right and within 60

1082
00:39:39,910 --> 00:39:45,129
seconds that the incident here and them

1083
00:39:41,440 --> 00:39:46,840
was awake within 10 minutes the incident

1084
00:39:45,130 --> 00:39:47,500
was contained so within 10 minutes the

1085
00:39:46,840 --> 00:39:50,980
incident

1086
00:39:47,500 --> 00:39:53,470
right and I get the work next morning

1087
00:39:50,980 --> 00:39:55,300
and the internal audit team calls me and

1088
00:39:53,470 --> 00:39:56,890
they said okay Conrad who told you about

1089
00:39:55,300 --> 00:39:58,240
the pen test who warned you who gave you

1090
00:39:56,890 --> 00:40:00,279
the heads-up because someone clearly

1091
00:39:58,240 --> 00:40:03,370
told you I'm like no one told us well

1092
00:40:00,280 --> 00:40:04,210
the darknet router told us and they

1093
00:40:03,370 --> 00:40:05,560
thought it was lying because they

1094
00:40:04,210 --> 00:40:07,420
couldn't see how it was humanly possible

1095
00:40:05,560 --> 00:40:08,620
to catch malware that quickly the big

1096
00:40:07,420 --> 00:40:11,350
floor accounting firm comes in to do

1097
00:40:08,620 --> 00:40:12,880
their reveal as a pen tester I had shell

1098
00:40:11,350 --> 00:40:14,500
for 10 minutes that I lost it forever

1099
00:40:12,880 --> 00:40:15,730
you're a sad pen tester let me tell you

1100
00:40:14,500 --> 00:40:17,500
that that's the worst feeling in the

1101
00:40:15,730 --> 00:40:19,090
world that happened to me 10 years later

1102
00:40:17,500 --> 00:40:20,770
I'd still be wincing over it to have

1103
00:40:19,090 --> 00:40:22,330
shell for 10 minutes and lose it forever

1104
00:40:20,770 --> 00:40:24,130
that's an awful feeling meaning we're

1105
00:40:22,330 --> 00:40:25,360
winning they're losing so big for

1106
00:40:24,130 --> 00:40:27,760
accounting firm comes in they're all

1107
00:40:25,360 --> 00:40:30,940
wearing nice suits three pen testers

1108
00:40:27,760 --> 00:40:32,410
each building $250 us an hour so 750

1109
00:40:30,940 --> 00:40:33,760
dollars collectively to hear me talk

1110
00:40:32,410 --> 00:40:35,560
right we're still paying them as I'm

1111
00:40:33,760 --> 00:40:37,210
telling them how they failed and they

1112
00:40:35,560 --> 00:40:40,270
said we don't understand what happened I

1113
00:40:37,210 --> 00:40:42,220
said well my darknet rudder car I caught

1114
00:40:40,270 --> 00:40:45,160
you right they see your dark net what

1115
00:40:42,220 --> 00:40:46,480
you want but never heard of it didn't

1116
00:40:45,160 --> 00:40:49,240
know it and I described what we're doing

1117
00:40:46,480 --> 00:40:51,220
to them and they were like that is magic

1118
00:40:49,240 --> 00:40:53,620
it's magic that's very inexpensive

1119
00:40:51,220 --> 00:40:54,819
actually it's cheap magic all you need

1120
00:40:53,620 --> 00:40:57,420
is a router you already have a router

1121
00:40:54,820 --> 00:41:00,370
right you already have a router for the

1122
00:40:57,420 --> 00:41:02,080
packets to that router and you can

1123
00:41:00,370 --> 00:41:03,490
simply count them there through SNMP and

1124
00:41:02,080 --> 00:41:05,799
drop or if you wanna be a little more

1125
00:41:03,490 --> 00:41:07,750
advanced send to a packet vacuum so send

1126
00:41:05,800 --> 00:41:10,900
that to a packet vacuum something like

1127
00:41:07,750 --> 00:41:13,090
security onion and IDs what will you see

1128
00:41:10,900 --> 00:41:14,980
you'll see a whole bunch of TCP sins and

1129
00:41:13,090 --> 00:41:17,620
no acts the handshakes begun but not

1130
00:41:14,980 --> 00:41:20,620
finished so TCP data's there's no data

1131
00:41:17,620 --> 00:41:22,839
just syn synchronize UDP you see the

1132
00:41:20,620 --> 00:41:25,060
full packet i simpiy see the full packet

1133
00:41:22,840 --> 00:41:27,790
right super use useful bit of old

1134
00:41:25,060 --> 00:41:29,910
network wizardry that I rarely see in

1135
00:41:27,790 --> 00:41:32,740
the wild I want to share with you all

1136
00:41:29,910 --> 00:41:34,750
right let's say you hit the mark that's

1137
00:41:32,740 --> 00:41:36,459
my talk folks you went to download this

1138
00:41:34,750 --> 00:41:37,750
talk that's Eric Conrad com

1139
00:41:36,460 --> 00:41:38,920
you're gonna come see me at sans

1140
00:41:37,750 --> 00:41:40,660
obviously it's sans or anywhere else

1141
00:41:38,920 --> 00:41:42,370
I'll hang around for questions and

1142
00:41:40,660 --> 00:41:45,450
thanks for having me folks it's good to

1143
00:41:42,370 --> 00:41:45,450
be home thank you thank you

