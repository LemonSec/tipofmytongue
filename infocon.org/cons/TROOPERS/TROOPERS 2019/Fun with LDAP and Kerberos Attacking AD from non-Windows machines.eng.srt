1
00:00:01,109 --> 00:00:06,990
for the next talk please welcome<font color="#CCCCCC"> Ronnie</font>

2
00:00:03,959 --> 00:00:08,760
<font color="#E5E5E5">who will talk about how you can attack</font>

3
00:00:06,990 --> 00:00:11,400
Active Directory from<font color="#E5E5E5"> non Windows</font>

4
00:00:08,760 --> 00:00:13,610
machines cool thank you

5
00:00:11,400 --> 00:00:15,720
can<font color="#E5E5E5"> you all hear me okay</font><font color="#CCCCCC"> all right</font>

6
00:00:13,610 --> 00:00:17,609
<font color="#CCCCCC">thanks for</font><font color="#E5E5E5"> coming I'm super</font><font color="#CCCCCC"> excited</font><font color="#E5E5E5"> to</font>

7
00:00:15,720 --> 00:00:19,409
be<font color="#E5E5E5"> here</font><font color="#CCCCCC"> and give this talk</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> is fun</font>

8
00:00:17,609 --> 00:00:20,849
with LDAP and Kerberos or attacking

9
00:00:19,409 --> 00:00:23,189
Active Directory from<font color="#E5E5E5"> non Windows</font>

10
00:00:20,849 --> 00:00:24,839
machines real quick

11
00:00:23,189 --> 00:00:27,839
Who am I my name is Ronnie<font color="#E5E5E5"> I'm from</font>

12
00:00:24,839 --> 00:00:29,519
<font color="#CCCCCC">Chicago I have a DD when it comes to</font>

13
00:00:27,839 --> 00:00:31,470
security I seem to<font color="#E5E5E5"> just jump around I</font>

14
00:00:29,519 --> 00:00:34,199
started a net<font color="#CCCCCC"> second did AB</font><font color="#E5E5E5"> SEC I'm in</font>

15
00:00:31,470 --> 00:00:35,910
prod<font color="#E5E5E5"> second dev</font><font color="#CCCCCC"> set cops but a D</font>

16
00:00:34,199 --> 00:00:37,289
<font color="#E5E5E5">security was sort of my first passion</font>

17
00:00:35,910 --> 00:00:39,148
and it's still what I really<font color="#CCCCCC"> really love</font>

18
00:00:37,289 --> 00:00:41,760
researching and<font color="#CCCCCC"> working and doing some</font>

19
00:00:39,149 --> 00:00:43,590
tool development<font color="#E5E5E5"> in work the various</font>

20
00:00:41,760 --> 00:00:45,210
companies<font color="#E5E5E5"> I just started at Motorola</font>

21
00:00:43,590 --> 00:00:48,300
<font color="#E5E5E5">Solutions I'm doing</font><font color="#CCCCCC"> app SEC over there</font>

22
00:00:45,210 --> 00:00:50,670
<font color="#E5E5E5">I'm wrapping up on Twitter</font><font color="#CCCCCC"> and I have a</font>

23
00:00:48,300 --> 00:00:51,928
<font color="#CCCCCC">github and I blog occasionally</font><font color="#E5E5E5"> I'm gonna</font>

24
00:00:50,670 --> 00:00:53,219
be referencing several tools<font color="#E5E5E5"> and</font>

25
00:00:51,929 --> 00:00:54,719
repositories you can find them on my

26
00:00:53,219 --> 00:00:57,629
<font color="#E5E5E5">github and I'll tweet out</font><font color="#CCCCCC"> the slides</font>

27
00:00:54,719 --> 00:00:59,550
after this so<font color="#E5E5E5"> first a little bit of</font>

28
00:00:57,629 --> 00:01:00,899
background about why this talk<font color="#CCCCCC"> this was</font>

29
00:00:59,550 --> 00:01:02,399
actually<font color="#E5E5E5"> a lot of this material</font><font color="#CCCCCC"> was born</font>

30
00:01:00,899 --> 00:01:04,800
as a workshop<font color="#E5E5E5"> I gave at a Chicago</font>

31
00:01:02,399 --> 00:01:06,240
conference last year<font color="#E5E5E5"> called</font><font color="#CCCCCC"> con</font><font color="#E5E5E5"> and the</font>

32
00:01:04,800 --> 00:01:07,980
workshop<font color="#E5E5E5"> was targeted towards like</font>

33
00:01:06,240 --> 00:01:10,289
people who wanted to<font color="#E5E5E5"> get into a deep end</font>

34
00:01:07,980 --> 00:01:12,090
testing<font color="#E5E5E5"> so I covered a lot</font><font color="#CCCCCC"> of the basics</font>

35
00:01:10,290 --> 00:01:14,760
<font color="#E5E5E5">and</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> and kind of the foundational</font>

36
00:01:12,090 --> 00:01:16,260
knowledge for<font color="#CCCCCC"> AD security so I'm going</font>

37
00:01:14,760 --> 00:01:17,880
into this talk and<font color="#E5E5E5"> I'm assuming no pre</font>

38
00:01:16,260 --> 00:01:19,290
<font color="#CCCCCC">knowledge so if</font><font color="#E5E5E5"> you just getting started</font>

39
00:01:17,880 --> 00:01:22,170
<font color="#CCCCCC">in AD Security or you're just interested</font>

40
00:01:19,290 --> 00:01:24,120
<font color="#E5E5E5">in pen testing this is a great talk for</font>

41
00:01:22,170 --> 00:01:26,160
those of you that are pen testers or

42
00:01:24,120 --> 00:01:28,320
have a solid knowledge<font color="#E5E5E5"> of</font><font color="#CCCCCC"> a T security</font>

43
00:01:26,160 --> 00:01:29,880
<font color="#CCCCCC">then my hope is that you might be able</font>

44
00:01:28,320 --> 00:01:33,149
<font color="#CCCCCC">to</font><font color="#E5E5E5"> take a few things away from</font><font color="#CCCCCC"> this and</font>

45
00:01:29,880 --> 00:01:34,589
learn a few<font color="#CCCCCC"> new tips or techniques</font><font color="#E5E5E5"> but</font>

46
00:01:33,150 --> 00:01:35,820
really it comes<font color="#CCCCCC"> down</font><font color="#E5E5E5"> to automated tools</font>

47
00:01:34,590 --> 00:01:37,950
are awesome and<font color="#E5E5E5"> when I started pen</font>

48
00:01:35,820 --> 00:01:39,660
testing I was using<font color="#E5E5E5"> a lot of them</font><font color="#CCCCCC"> but I</font>

49
00:01:37,950 --> 00:01:41,280
find<font color="#E5E5E5"> that doing things manually or</font>

50
00:01:39,660 --> 00:01:42,780
looking under the hood<font color="#CCCCCC"> makes</font><font color="#E5E5E5"> it a lot</font>

51
00:01:41,280 --> 00:01:46,170
<font color="#E5E5E5">more interesting and really lets me</font>

52
00:01:42,780 --> 00:01:47,670
absorb<font color="#E5E5E5"> that knowledge and to be an</font>

53
00:01:46,170 --> 00:01:49,290
effective Windows pen tester or

54
00:01:47,670 --> 00:01:50,420
researcher I really strongly believe you

55
00:01:49,290 --> 00:01:52,500
have to understand the underlying

56
00:01:50,420 --> 00:01:53,820
<font color="#E5E5E5">technologies that are in play and don't</font>

57
00:01:52,500 --> 00:01:56,460
just rely on the<font color="#E5E5E5"> tools that kind of</font>

58
00:01:53,820 --> 00:01:57,779
abstract that away<font color="#E5E5E5"> and I think that</font>

59
00:01:56,460 --> 00:01:59,729
manually doing<font color="#E5E5E5"> things really lets you</font>

60
00:01:57,780 --> 00:02:03,180
<font color="#CCCCCC">become more creative as a pen tester or</font>

61
00:01:59,730 --> 00:02:05,130
researcher so like I said<font color="#E5E5E5"> key takeaways</font>

62
00:02:03,180 --> 00:02:06,030
for you guys from<font color="#E5E5E5"> this talk is if you're</font>

63
00:02:05,130 --> 00:02:07,170
new I want you to have a better

64
00:02:06,030 --> 00:02:09,570
<font color="#CCCCCC">understanding of</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> underlying</font>

65
00:02:07,170 --> 00:02:11,460
technologies and protocols<font color="#CCCCCC"> if you are a</font>

66
00:02:09,570 --> 00:02:13,680
pen tester or<font color="#E5E5E5"> experienced</font><font color="#CCCCCC"> maybe some</font>

67
00:02:11,460 --> 00:02:14,760
<font color="#E5E5E5">more tricks for your pen tester bag the</font>

68
00:02:13,680 --> 00:02:16,799
slides are dense<font color="#E5E5E5"> I'm going</font>

69
00:02:14,760 --> 00:02:18,420
have a lot of screenshots<font color="#E5E5E5"> and commands</font>

70
00:02:16,799 --> 00:02:20,010
in there and I'm gonna sorry but kind of

71
00:02:18,420 --> 00:02:21,328
<font color="#E5E5E5">be clicking through them quickly but I</font>

72
00:02:20,010 --> 00:02:23,189
did that deliberately because<font color="#E5E5E5"> I like</font>

73
00:02:21,329 --> 00:02:24,930
slides that<font color="#E5E5E5"> can</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> taken as kind of a</font>

74
00:02:23,189 --> 00:02:26,310
standalone cheat sheet<font color="#E5E5E5"> so</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> can always</font>

75
00:02:24,930 --> 00:02:27,689
reference these<font color="#E5E5E5"> slides if you're on an</font>

76
00:02:26,310 --> 00:02:30,599
assessment<font color="#CCCCCC"> or</font><font color="#E5E5E5"> you just</font><font color="#CCCCCC"> playing around</font><font color="#E5E5E5"> in</font>

77
00:02:27,689 --> 00:02:32,909
your<font color="#E5E5E5"> lab and really what it comes</font><font color="#CCCCCC"> down</font>

78
00:02:30,599 --> 00:02:34,440
to is I put this talk together as the

79
00:02:32,909 --> 00:02:36,209
talk that<font color="#E5E5E5"> I would have loved to have</font>

80
00:02:34,440 --> 00:02:37,859
seen<font color="#CCCCCC"> a couple</font><font color="#E5E5E5"> years ago when I was</font>

81
00:02:36,209 --> 00:02:39,390
<font color="#E5E5E5">getting started in</font><font color="#CCCCCC"> ad</font><font color="#E5E5E5"> security there was</font>

82
00:02:37,860 --> 00:02:41,730
concepts that weren't quite<font color="#CCCCCC"> clear to</font><font color="#E5E5E5"> me</font>

83
00:02:39,390 --> 00:02:43,440
<font color="#E5E5E5">I wanted to see things in action</font><font color="#CCCCCC"> so this</font>

84
00:02:41,730 --> 00:02:45,209
<font color="#E5E5E5">talk was the is the talk that I would</font>

85
00:02:43,440 --> 00:02:48,900
like to<font color="#CCCCCC"> see and hopefully</font><font color="#E5E5E5"> some of you</font>

86
00:02:45,209 --> 00:02:50,489
<font color="#E5E5E5">guys enjoy it too quick</font><font color="#CCCCCC"> agenda</font><font color="#E5E5E5"> I'm going</font>

87
00:02:48,900 --> 00:02:53,220
to do some level<font color="#E5E5E5"> studying and an intro</font>

88
00:02:50,489 --> 00:02:54,359
and background<font color="#E5E5E5"> to Active Directory then</font>

89
00:02:53,220 --> 00:02:56,700
we're gonna<font color="#E5E5E5"> jump right</font><font color="#CCCCCC"> into just</font><font color="#E5E5E5"> fun</font>

90
00:02:54,359 --> 00:02:59,069
with LDAP<font color="#CCCCCC"> an overview of LDAP and some</font>

91
00:02:56,700 --> 00:03:01,230
demos for doing LDAP queries and then

92
00:02:59,069 --> 00:03:03,510
<font color="#CCCCCC">fun with Kerberos and some demos of</font>

93
00:03:01,230 --> 00:03:05,790
different Kerberos tools and techniques

94
00:03:03,510 --> 00:03:06,959
<font color="#E5E5E5">and then hopefully time permitting I've</font>

95
00:03:05,790 --> 00:03:10,769
kind of been buttoned up right against

96
00:03:06,959 --> 00:03:15,690
an hour<font color="#CCCCCC"> but we have Q&A or</font><font color="#E5E5E5"> if not coffee</font>

97
00:03:10,769 --> 00:03:17,430
break after this I'll<font color="#CCCCCC"> be around so you</font>

98
00:03:15,690 --> 00:03:19,290
guys<font color="#E5E5E5"> are in the ad</font><font color="#CCCCCC"> Security</font><font color="#E5E5E5"> track so I</font>

99
00:03:17,430 --> 00:03:21,150
kind of I'm assuming you have some<font color="#CCCCCC"> idea</font>

100
00:03:19,290 --> 00:03:22,349
of what Active Directory is but I<font color="#E5E5E5"> don't</font>

101
00:03:21,150 --> 00:03:23,879
want<font color="#E5E5E5"> to assume anything so I just kind</font>

102
00:03:22,349 --> 00:03:27,690
of want a level<font color="#E5E5E5"> set because Active</font>

103
00:03:23,879 --> 00:03:29,190
Directory gets thrown around a<font color="#CCCCCC"> lot</font><font color="#E5E5E5"> and I</font>

104
00:03:27,690 --> 00:03:30,690
just<font color="#E5E5E5"> want to have a quick</font><font color="#CCCCCC"> overview</font><font color="#E5E5E5"> of</font>

105
00:03:29,190 --> 00:03:33,120
like what is Active Directory when I'm

106
00:03:30,690 --> 00:03:35,310
referring<font color="#CCCCCC"> to it so ad is Microsoft's</font>

107
00:03:33,120 --> 00:03:37,919
proprietary directory service for use in

108
00:03:35,310 --> 00:03:39,449
Windows<font color="#E5E5E5"> domain networks and when I am</font>

109
00:03:37,919 --> 00:03:41,459
referring<font color="#E5E5E5"> to ad I'm actually referring</font>

110
00:03:39,449 --> 00:03:44,970
to<font color="#E5E5E5"> a DDS or Active Directory domain</font>

111
00:03:41,459 --> 00:03:47,040
services<font color="#CCCCCC"> and AD</font><font color="#E5E5E5"> is kind of a suite of</font>

112
00:03:44,970 --> 00:03:50,280
tools and<font color="#CCCCCC"> protocols</font><font color="#E5E5E5"> and technologies</font><font color="#CCCCCC"> to</font>

113
00:03:47,040 --> 00:03:52,470
<font color="#CCCCCC">allow an administrator to manage objects</font>

114
00:03:50,280 --> 00:03:54,090
on their network<font color="#E5E5E5"> and an ad everything is</font>

115
00:03:52,470 --> 00:03:57,299
an object you've got<font color="#CCCCCC"> users groups</font>

116
00:03:54,090 --> 00:03:59,280
computers policies<font color="#E5E5E5"> printers subnets DHCP</font>

117
00:03:57,299 --> 00:04:00,690
leases everything is an<font color="#CCCCCC"> object and ad</font>

118
00:03:59,280 --> 00:04:03,000
gives you the tools<font color="#E5E5E5"> you</font><font color="#CCCCCC"> need to</font><font color="#E5E5E5"> kind</font><font color="#CCCCCC"> of</font>

119
00:04:00,690 --> 00:04:04,500
<font color="#E5E5E5">remotely manage them and it relies on</font>

120
00:04:03,000 --> 00:04:07,049
various<font color="#E5E5E5"> different protocols and</font>

121
00:04:04,500 --> 00:04:09,629
<font color="#CCCCCC">technologies to provide location lookup</font>

122
00:04:07,049 --> 00:04:14,940
authentication authorization<font color="#E5E5E5"> and remote</font>

123
00:04:09,629 --> 00:04:16,228
management in any single Active

124
00:04:14,940 --> 00:04:17,579
Directory deployment though it really

125
00:04:16,228 --> 00:04:19,649
<font color="#E5E5E5">comes down to what I consider like the</font>

126
00:04:17,579 --> 00:04:21,570
<font color="#E5E5E5">three big protocols you're always gonna</font>

127
00:04:19,649 --> 00:04:23,280
<font color="#E5E5E5">find these in play on any sort of Active</font>

128
00:04:21,570 --> 00:04:24,690
Directory domain and I think it's kind

129
00:04:23,280 --> 00:04:27,479
of what Microsoft built a lot<font color="#E5E5E5"> of Active</font>

130
00:04:24,690 --> 00:04:28,120
Directory up on and those three are<font color="#CCCCCC"> DNS</font>

131
00:04:27,479 --> 00:04:31,539
<font color="#CCCCCC">L</font>

132
00:04:28,120 --> 00:04:33,580
and<font color="#E5E5E5"> Kerberos so DNS is required in</font>

133
00:04:31,540 --> 00:04:36,400
Active Directory for resource lookups

134
00:04:33,580 --> 00:04:38,109
<font color="#E5E5E5">it's how resources find each other</font><font color="#CCCCCC"> and a</font>

135
00:04:36,400 --> 00:04:39,789
quick<font color="#E5E5E5"> example is like DNS is so</font>

136
00:04:38,110 --> 00:04:41,410
important<font color="#E5E5E5"> because if you want to join a</font>

137
00:04:39,790 --> 00:04:43,720
computer or you want to log<font color="#CCCCCC"> in to a</font>

138
00:04:41,410 --> 00:04:46,530
domain<font color="#CCCCCC"> it uses DNS to identify where the</font>

139
00:04:43,720 --> 00:04:49,270
domain controller is to begin<font color="#CCCCCC"> with</font>

140
00:04:46,530 --> 00:04:50,799
LDAP is the directory access protocol

141
00:04:49,270 --> 00:04:52,780
and<font color="#E5E5E5"> you kind</font><font color="#CCCCCC"> of think of it</font><font color="#E5E5E5"> as like how</font>

142
00:04:50,800 --> 00:04:54,460
to store and access<font color="#E5E5E5"> all those objects</font>

143
00:04:52,780 --> 00:04:56,979
that<font color="#E5E5E5"> make up an Active Directory domain</font>

144
00:04:54,460 --> 00:05:00,010
and LDAP is a standard that predates

145
00:04:56,979 --> 00:05:02,260
Active Directory<font color="#CCCCCC"> it's an open RFC</font><font color="#E5E5E5"> and so</font>

146
00:05:00,010 --> 00:05:04,030
Microsoft adapted LDAP and built a lot

147
00:05:02,260 --> 00:05:05,950
on top of it and<font color="#E5E5E5"> added some extensions</font>

148
00:05:04,030 --> 00:05:07,239
and new attributes but LDAP is really

149
00:05:05,950 --> 00:05:09,840
really<font color="#E5E5E5"> still</font><font color="#CCCCCC"> the core underlying</font>

150
00:05:07,240 --> 00:05:12,070
<font color="#E5E5E5">directory access protocol and AD and</font>

151
00:05:09,840 --> 00:05:14,260
then lastly Kerberos the big one

152
00:05:12,070 --> 00:05:16,180
Kerberos and<font color="#E5E5E5"> Active Directory provides</font>

153
00:05:14,260 --> 00:05:19,360
authentication and<font color="#E5E5E5"> a single sign-on</font>

154
00:05:16,180 --> 00:05:20,770
experience<font color="#CCCCCC"> and similar to LDAP act or</font>

155
00:05:19,360 --> 00:05:23,560
Kerberos waiver dates Active Directory

156
00:05:20,770 --> 00:05:27,340
as well it's an open RFC<font color="#E5E5E5"> but Microsoft</font>

157
00:05:23,560 --> 00:05:29,350
<font color="#E5E5E5">took that Kerberos protocol or kerberos</font>

158
00:05:27,340 --> 00:05:30,638
RFC and<font color="#E5E5E5"> kind of bastardized it and added</font>

159
00:05:29,350 --> 00:05:32,979
a bunch of<font color="#E5E5E5"> things on top</font><font color="#CCCCCC"> of it to make</font>

160
00:05:30,639 --> 00:05:35,830
<font color="#CCCCCC">it work</font><font color="#E5E5E5"> but it's still Kerberos at its</font>

161
00:05:32,979 --> 00:05:37,150
core<font color="#E5E5E5"> and there's lots of other protocols</font>

162
00:05:35,830 --> 00:05:38,740
and technology<font color="#E5E5E5"> that</font><font color="#CCCCCC"> I'm not really going</font>

163
00:05:37,150 --> 00:05:42,000
<font color="#E5E5E5">to touch on</font><font color="#CCCCCC"> here</font><font color="#E5E5E5"> but you've probably</font>

164
00:05:38,740 --> 00:05:44,470
seen<font color="#CCCCCC"> NetBIOS</font><font color="#E5E5E5"> MS RPC ntlm authentication</font>

165
00:05:42,000 --> 00:05:45,849
<font color="#E5E5E5">really all of this stuff is just it's a</font>

166
00:05:44,470 --> 00:05:47,530
hodgepodge that makes up Active

167
00:05:45,849 --> 00:05:50,130
Directory<font color="#E5E5E5"> but these are the three big</font>

168
00:05:47,530 --> 00:05:54,059
ones I'll be focusing on because<font color="#E5E5E5"> they're</font>

169
00:05:50,130 --> 00:05:56,950
backwards compatible and open protocols

170
00:05:54,060 --> 00:05:58,990
so<font color="#E5E5E5"> DNS LDAP Kerberos</font><font color="#CCCCCC"> they're open</font>

171
00:05:56,950 --> 00:06:00,639
protocols like<font color="#E5E5E5"> I said and there's other</font>

172
00:05:58,990 --> 00:06:03,039
clients<font color="#E5E5E5"> you can use to</font><font color="#CCCCCC"> communicate with</font>

173
00:06:00,639 --> 00:06:04,960
them so when it comes<font color="#E5E5E5"> down to is really</font>

174
00:06:03,039 --> 00:06:06,729
in the crux of this talk<font color="#E5E5E5"> is you don't</font>

175
00:06:04,960 --> 00:06:08,500
have<font color="#E5E5E5"> to rely on Windows to talk to</font>

176
00:06:06,729 --> 00:06:10,150
Active Directory over the network<font color="#E5E5E5"> these</font>

177
00:06:08,500 --> 00:06:11,620
protocols<font color="#E5E5E5"> are open and as long as you</font>

178
00:06:10,150 --> 00:06:14,440
have network access<font color="#E5E5E5"> you can use any</font>

179
00:06:11,620 --> 00:06:15,820
clients<font color="#E5E5E5"> that you want to talk to them so</font>

180
00:06:14,440 --> 00:06:16,599
from<font color="#CCCCCC"> here</font><font color="#E5E5E5"> on out I'm not gonna use</font>

181
00:06:15,820 --> 00:06:18,190
Windows at all

182
00:06:16,599 --> 00:06:20,200
there's no PowerShell in this talk I'm

183
00:06:18,190 --> 00:06:22,500
sorry if you were<font color="#E5E5E5"> expecting that but I'm</font>

184
00:06:20,200 --> 00:06:25,180
only using<font color="#E5E5E5"> pretty much Python</font><font color="#CCCCCC"> and Linux</font>

185
00:06:22,500 --> 00:06:26,590
<font color="#CCCCCC">and</font><font color="#E5E5E5"> the idea is as a pen tester you</font>

186
00:06:25,180 --> 00:06:29,110
should be able to<font color="#E5E5E5"> pen test from wherever</font>

187
00:06:26,590 --> 00:06:30,520
you land<font color="#CCCCCC"> if you don't have</font><font color="#E5E5E5"> access or a</font>

188
00:06:29,110 --> 00:06:32,860
<font color="#E5E5E5">foothold to a Windows machine if you get</font>

189
00:06:30,520 --> 00:06:35,080
a web server or a container<font color="#E5E5E5"> or a smart</font>

190
00:06:32,860 --> 00:06:36,700
fish tank<font color="#E5E5E5"> you should be able to still do</font>

191
00:06:35,080 --> 00:06:38,859
some Windows pen testing if you're in an

192
00:06:36,700 --> 00:06:40,090
Active Directory domain so<font color="#E5E5E5"> these are</font>

193
00:06:38,860 --> 00:06:43,110
some of<font color="#E5E5E5"> the tools you can use the talk</font>

194
00:06:40,090 --> 00:06:45,460
to these<font color="#E5E5E5"> protocols here</font>

195
00:06:43,110 --> 00:06:49,330
<font color="#E5E5E5">I'm going to kind of jump into some</font>

196
00:06:45,460 --> 00:06:51,878
examples<font color="#CCCCCC"> here DNS for DNS is in</font><font color="#E5E5E5"> play and</font>

197
00:06:49,330 --> 00:06:53,830
<font color="#CCCCCC">a TDS heavily relies on it and you if</font>

198
00:06:51,879 --> 00:06:55,150
you have<font color="#CCCCCC"> Digg or any just standard DNS</font>

199
00:06:53,830 --> 00:06:56,830
tool you can<font color="#E5E5E5"> actually perform some</font>

200
00:06:55,150 --> 00:06:59,739
domain reconnaissance if you land on a

201
00:06:56,830 --> 00:07:01,568
network<font color="#E5E5E5"> DNS especially relies on serve</font>

202
00:06:59,740 --> 00:07:04,389
records to<font color="#CCCCCC"> identify where the important</font>

203
00:07:01,569 --> 00:07:06,819
<font color="#E5E5E5">services are such as LDAP Kerberos and</font>

204
00:07:04,389 --> 00:07:09,550
<font color="#E5E5E5">global catalog which</font><font color="#CCCCCC"> is kind</font><font color="#E5E5E5"> of LDAP for</font>

205
00:07:06,819 --> 00:07:11,499
the forest<font color="#E5E5E5"> and you</font><font color="#CCCCCC"> can just use dig for</font>

206
00:07:09,550 --> 00:07:13,779
example to do serve record enumeration

207
00:07:11,499 --> 00:07:15,430
and find out where the global<font color="#E5E5E5"> catalog or</font>

208
00:07:13,779 --> 00:07:16,840
LDAP servers are where the Kerberos

209
00:07:15,430 --> 00:07:20,289
servers are and start mapping out your

210
00:07:16,840 --> 00:07:22,628
domain you<font color="#CCCCCC"> can also use an nmap script</font>

211
00:07:20,289 --> 00:07:24,550
<font color="#CCCCCC">but this is</font><font color="#E5E5E5"> just showing and my my test</font>

212
00:07:22,629 --> 00:07:26,289
domain here through DNS server

213
00:07:24,550 --> 00:07:28,240
enumeration<font color="#E5E5E5"> I can identify</font><font color="#CCCCCC"> right away</font>

214
00:07:26,289 --> 00:07:31,090
that I have one domain<font color="#E5E5E5"> controller</font><font color="#CCCCCC"> and</font>

215
00:07:28,240 --> 00:07:33,219
it's called<font color="#E5E5E5"> PDC</font><font color="#CCCCCC"> oh one lab drop nap com</font>

216
00:07:31,090 --> 00:07:37,960
because that's running LDAP Kerberos GC

217
00:07:33,219 --> 00:07:39,849
all of that good<font color="#CCCCCC"> stuff that when you</font>

218
00:07:37,960 --> 00:07:41,318
identify<font color="#CCCCCC"> an LDAP server and I'm gonna</font><font color="#E5E5E5"> be</font>

219
00:07:39,849 --> 00:07:43,810
talking<font color="#CCCCCC"> a</font><font color="#E5E5E5"> lot about LDAP and a couple</font>

220
00:07:41,319 --> 00:07:46,270
slides but most LDAP reconnaissance

221
00:07:43,810 --> 00:07:48,520
requires an<font color="#E5E5E5"> authenticated bind however</font>

222
00:07:46,270 --> 00:07:50,529
if you do an unauthenticated bind to an

223
00:07:48,520 --> 00:07:52,210
Active Directory LDAP server<font color="#E5E5E5"> you can</font>

224
00:07:50,529 --> 00:07:53,560
still pull some valuable metadata sorry

225
00:07:52,210 --> 00:07:55,388
I'm blocking<font color="#CCCCCC"> it</font><font color="#E5E5E5"> you can still pull some</font>

226
00:07:53,560 --> 00:07:58,000
valuable metadata from<font color="#E5E5E5"> the LDAP server</font>

227
00:07:55,389 --> 00:07:59,860
<font color="#E5E5E5">itself and you can use any LDAP client</font>

228
00:07:58,000 --> 00:08:01,659
like LDAP search for<font color="#E5E5E5"> example to pull</font>

229
00:07:59,860 --> 00:08:03,939
that<font color="#E5E5E5"> data out so this is just an</font>

230
00:08:01,659 --> 00:08:05,589
unauthenticated<font color="#CCCCCC"> LDAP bind and over here</font>

231
00:08:03,939 --> 00:08:07,060
on the left is sort<font color="#E5E5E5"> of a snipped output</font>

232
00:08:05,589 --> 00:08:10,029
of all the attributes<font color="#E5E5E5"> that come back</font>

233
00:08:07,060 --> 00:08:11,560
<font color="#E5E5E5">about that LDAP server</font><font color="#CCCCCC"> I've bolded</font><font color="#E5E5E5"> some</font>

234
00:08:10,029 --> 00:08:12,879
of the more useful<font color="#E5E5E5"> ones but I think the</font>

235
00:08:11,560 --> 00:08:13,270
<font color="#E5E5E5">most useful ones are these three down</font>

236
00:08:12,879 --> 00:08:15,460
here

237
00:08:13,270 --> 00:08:17,080
they're numeric values that correspond

238
00:08:15,460 --> 00:08:18,520
to what the functionality level is of

239
00:08:17,080 --> 00:08:20,438
the domain the forest or<font color="#CCCCCC"> the</font><font color="#E5E5E5"> domain</font>

240
00:08:18,520 --> 00:08:22,599
controller<font color="#E5E5E5"> and if you just look up those</font>

241
00:08:20,439 --> 00:08:24,430
those values in<font color="#E5E5E5"> the table</font><font color="#CCCCCC"> over here we</font>

242
00:08:22,599 --> 00:08:26,319
can<font color="#E5E5E5"> see just through an authenticated</font>

243
00:08:24,430 --> 00:08:33,250
<font color="#E5E5E5">LDAP lookup that we're dealing</font><font color="#CCCCCC"> with</font><font color="#E5E5E5"> a</font>

244
00:08:26,319 --> 00:08:36,039
Windows<font color="#E5E5E5"> 2012 r2 functionality level MSRP</font>

245
00:08:33,250 --> 00:08:37,299
<font color="#CCCCCC">C is definitely big and play in Active</font>

246
00:08:36,039 --> 00:08:40,948
Directory and I'm gonna just gloss over

247
00:08:37,299 --> 00:08:45,579
it real quickly here but MSRP<font color="#CCCCCC"> C is</font>

248
00:08:40,948 --> 00:08:46,689
<font color="#E5E5E5">Microsoft's twist on dce/rpc it's</font>

249
00:08:45,579 --> 00:08:48,609
actually made up of several different

250
00:08:46,690 --> 00:08:50,380
protocols but the idea is<font color="#CCCCCC"> that every</font>

251
00:08:48,610 --> 00:08:52,449
computer<font color="#E5E5E5"> within an Active Directory</font>

252
00:08:50,380 --> 00:08:55,300
domain can communicate to<font color="#CCCCCC"> each</font><font color="#E5E5E5"> other and</font>

253
00:08:52,449 --> 00:08:57,880
do remote procedure calls and

254
00:08:55,300 --> 00:09:01,270
the most common way that<font color="#E5E5E5"> our</font><font color="#CCCCCC"> ms RPC</font>

255
00:08:57,880 --> 00:09:03,520
occurs is RPC over SMB<font color="#CCCCCC"> so it's using</font>

256
00:09:01,270 --> 00:09:05,529
named pipes over SMB so if you've<font color="#E5E5E5"> ever</font>

257
00:09:03,520 --> 00:09:07,089
had any confusion<font color="#CCCCCC"> about like why SMB</font>

258
00:09:05,529 --> 00:09:08,860
which is for<font color="#CCCCCC"> file-sharing you can get</font>

259
00:09:07,089 --> 00:09:10,209
code execution through<font color="#E5E5E5"> it's because</font>

260
00:09:08,860 --> 00:09:12,010
you're<font color="#CCCCCC"> actually mounting a named pipe</font>

261
00:09:10,209 --> 00:09:15,819
and doing an RPC call through the<font color="#E5E5E5"> file</font>

262
00:09:12,010 --> 00:09:17,950
share functionality<font color="#E5E5E5"> of SMB so all net</font>

263
00:09:15,820 --> 00:09:19,300
commands are doing MSRP see under the

264
00:09:17,950 --> 00:09:22,360
<font color="#CCCCCC">hood so</font><font color="#E5E5E5"> if you've ever run like a net</font>

265
00:09:19,300 --> 00:09:24,399
user command slash domain will actually

266
00:09:22,360 --> 00:09:27,130
communicate to the domain controller<font color="#E5E5E5"> and</font>

267
00:09:24,399 --> 00:09:29,230
do a bunch<font color="#E5E5E5"> of MS RPC calls and it</font>

268
00:09:27,130 --> 00:09:31,450
establishes an SMB connection it drops

269
00:09:29,230 --> 00:09:32,830
into<font color="#CCCCCC"> Samer it does a ton of lookups at</font>

270
00:09:31,450 --> 00:09:35,050
the domain and then it<font color="#E5E5E5"> displays that</font>

271
00:09:32,830 --> 00:09:36,130
information back<font color="#CCCCCC"> to us but</font><font color="#E5E5E5"> under the</font>

272
00:09:35,050 --> 00:09:38,380
hood<font color="#E5E5E5"> Microsoft does all this</font>

273
00:09:36,130 --> 00:09:41,260
automatically<font color="#CCCCCC"> and these are the types of</font>

274
00:09:38,380 --> 00:09:42,880
protocols<font color="#CCCCCC"> that are</font><font color="#E5E5E5"> in play for RPC now</font>

275
00:09:41,260 --> 00:09:45,399
though its proprietary there are other

276
00:09:42,880 --> 00:09:47,560
implementations of<font color="#CCCCCC"> MS RPC and you don't</font>

277
00:09:45,399 --> 00:09:50,050
actually need Windows to talk MSRP<font color="#E5E5E5"> C and</font>

278
00:09:47,560 --> 00:09:52,930
the two big ones are the<font color="#CCCCCC"> samba project</font>

279
00:09:50,050 --> 00:09:55,630
which has SMB client an RPC client as

280
00:09:52,930 --> 00:09:58,060
<font color="#CCCCCC">well as a port of the net</font><font color="#E5E5E5"> command or my</font>

281
00:09:55,630 --> 00:09:59,740
<font color="#E5E5E5">favorite which is</font><font color="#CCCCCC"> impac it quick show of</font>

282
00:09:58,060 --> 00:10:03,130
hands who's used<font color="#E5E5E5"> and familiar with</font>

283
00:09:59,740 --> 00:10:04,390
<font color="#E5E5E5">impact it before cool so about</font><font color="#CCCCCC"> now maybe</font>

284
00:10:03,130 --> 00:10:06,910
<font color="#CCCCCC">three-quarters of the room impact it's</font>

285
00:10:04,390 --> 00:10:09,100
awesome<font color="#E5E5E5"> I can't say enough of it</font><font color="#CCCCCC"> it is a</font>

286
00:10:06,910 --> 00:10:13,329
full<font color="#E5E5E5"> Python implementation of the MSRP</font><font color="#CCCCCC"> C</font>

287
00:10:09,100 --> 00:10:14,920
stack or<font color="#E5E5E5"> almost full so in packet is</font>

288
00:10:13,329 --> 00:10:16,449
like the Swiss<font color="#CCCCCC"> Army knife for</font><font color="#E5E5E5"> Windows</font>

289
00:10:14,920 --> 00:10:18,339
<font color="#CCCCCC">Network pentesting it is my</font><font color="#E5E5E5"> go-to</font>

290
00:10:16,450 --> 00:10:20,410
toolkit if I'm<font color="#E5E5E5"> ever doing a Windows pen</font>

291
00:10:18,339 --> 00:10:22,510
test I<font color="#E5E5E5"> absolutely has</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> have I have to</font>

292
00:10:20,410 --> 00:10:23,920
have it<font color="#E5E5E5"> but</font><font color="#CCCCCC"> I will</font><font color="#E5E5E5"> admit that</font>

293
00:10:22,510 --> 00:10:26,380
dependencies<font color="#CCCCCC"> can be a little</font><font color="#E5E5E5"> difficult</font>

294
00:10:23,920 --> 00:10:27,760
<font color="#E5E5E5">impact it requires Python</font><font color="#CCCCCC"> to there's</font>

295
00:10:26,380 --> 00:10:30,339
some crypto modules that<font color="#CCCCCC"> have to</font><font color="#E5E5E5"> be</font>

296
00:10:27,760 --> 00:10:32,230
installed<font color="#E5E5E5"> so I really wanted impact it</font>

297
00:10:30,339 --> 00:10:33,880
to be able<font color="#E5E5E5"> to work wherever</font><font color="#CCCCCC"> I land</font>

298
00:10:32,230 --> 00:10:36,880
anywhere<font color="#CCCCCC"> I can</font><font color="#E5E5E5"> get a foothold I want to</font>

299
00:10:33,880 --> 00:10:39,670
run an impact script so I released a

300
00:10:36,880 --> 00:10:41,829
project it's on github<font color="#CCCCCC"> I set up a CI CD</font>

301
00:10:39,670 --> 00:10:43,959
pipeline to continually build static

302
00:10:41,829 --> 00:10:46,329
binaries from all the impacted example

303
00:10:43,959 --> 00:10:48,130
scripts so these are standalone binaries

304
00:10:46,329 --> 00:10:50,050
<font color="#CCCCCC">that don't have any other dependencies</font>

305
00:10:48,130 --> 00:10:53,290
<font color="#E5E5E5">and you can download them and run them</font>

306
00:10:50,050 --> 00:10:55,000
wherever<font color="#E5E5E5"> you might land so under the</font>

307
00:10:53,290 --> 00:10:57,010
hood I'm doing PI installer<font color="#CCCCCC"> and</font><font color="#E5E5E5"> I'm</font>

308
00:10:55,000 --> 00:10:58,720
<font color="#E5E5E5">compiling them for Linux against the</font>

309
00:10:57,010 --> 00:11:01,300
oldest version<font color="#CCCCCC"> of gee Lib C I could find</font>

310
00:10:58,720 --> 00:11:03,190
<font color="#E5E5E5">I'm doing wine to compile Windows</font><font color="#CCCCCC"> Exe</font><font color="#E5E5E5"> s</font>

311
00:11:01,300 --> 00:11:05,349
<font color="#E5E5E5">and then I'm also compiling them against</font>

312
00:11:03,190 --> 00:11:07,510
a<font color="#E5E5E5"> different Lib C implementation</font><font color="#CCCCCC"> that's</font>

313
00:11:05,350 --> 00:11:08,649
really popular<font color="#CCCCCC"> in containers</font><font color="#E5E5E5"> so if you</font>

314
00:11:07,510 --> 00:11:10,899
ever land in a container

315
00:11:08,649 --> 00:11:13,269
like<font color="#E5E5E5"> alpine linux you can still run</font>

316
00:11:10,899 --> 00:11:14,410
these<font color="#E5E5E5"> impacted binaries and here's a</font>

317
00:11:13,269 --> 00:11:18,220
quick<font color="#CCCCCC"> example of what that looks like</font>

318
00:11:14,410 --> 00:11:20,110
here<font color="#CCCCCC"> I'm on a container pythons not</font>

319
00:11:18,220 --> 00:11:21,459
installed<font color="#CCCCCC"> I want to run an</font><font color="#E5E5E5"> impacted</font>

320
00:11:20,110 --> 00:11:23,199
script though so I just downloaded

321
00:11:21,459 --> 00:11:25,839
<font color="#E5E5E5">directly from my github releases page</font>

322
00:11:23,199 --> 00:11:27,279
<font color="#CCCCCC">Acho mod + exit and then I have a</font>

323
00:11:25,839 --> 00:11:29,170
standalone binary with no other

324
00:11:27,279 --> 00:11:31,360
dependencies and I can<font color="#E5E5E5"> just run with me</font>

325
00:11:29,170 --> 00:11:33,069
exec against a Windows machine<font color="#E5E5E5"> that this</font>

326
00:11:31,360 --> 00:11:36,730
container has<font color="#E5E5E5"> network</font><font color="#CCCCCC"> access to and</font>

327
00:11:33,069 --> 00:11:41,378
execute some commands that way so<font color="#E5E5E5"> that</font>

328
00:11:36,730 --> 00:11:43,089
works<font color="#E5E5E5"> alright enough about MSRP see it</font>

329
00:11:41,379 --> 00:11:47,470
it's hard<font color="#E5E5E5"> it's gross</font>

330
00:11:43,089 --> 00:11:49,869
I like LDAP more so I guess that<font color="#CCCCCC"> Active</font>

331
00:11:47,470 --> 00:11:52,529
<font color="#CCCCCC">Directory</font><font color="#E5E5E5"> uses LDAP it's the underlying</font>

332
00:11:49,869 --> 00:11:55,179
<font color="#CCCCCC">access directory access protocol and</font>

333
00:11:52,529 --> 00:11:57,490
really every<font color="#CCCCCC"> single object and remember</font>

334
00:11:55,179 --> 00:11:59,800
everything is an object<font color="#CCCCCC"> they all exist</font>

335
00:11:57,490 --> 00:12:01,329
in the LDAP<font color="#CCCCCC"> quote unquote</font><font color="#E5E5E5"> database so</font>

336
00:11:59,800 --> 00:12:02,949
LDAP is kind of like your source of

337
00:12:01,329 --> 00:12:05,769
truth<font color="#CCCCCC"> for all</font><font color="#E5E5E5"> this information in an</font>

338
00:12:02,949 --> 00:12:07,809
Active Directory domain and every<font color="#CCCCCC"> domain</font>

339
00:12:05,769 --> 00:12:09,730
controller is also<font color="#CCCCCC"> an LDAP server</font>

340
00:12:07,809 --> 00:12:12,730
listening on three different<font color="#CCCCCC"> ports</font><font color="#E5E5E5"> you</font>

341
00:12:09,730 --> 00:12:15,279
get traditional LDAP LDAP<font color="#E5E5E5"> s for secure</font>

342
00:12:12,730 --> 00:12:16,660
and<font color="#E5E5E5"> then the LDAP global catalog and the</font>

343
00:12:15,279 --> 00:12:18,610
nice<font color="#E5E5E5"> thing with LDAP is there's really</font>

344
00:12:16,660 --> 00:12:20,709
<font color="#E5E5E5">no special privileges</font><font color="#CCCCCC"> needed to bind to</font>

345
00:12:18,610 --> 00:12:21,939
the LDAP server and perform some queries

346
00:12:20,709 --> 00:12:23,739
so if you just have<font color="#E5E5E5"> the most</font>

347
00:12:21,939 --> 00:12:25,449
<font color="#E5E5E5">unprivileged user but as long as it's a</font>

348
00:12:23,740 --> 00:12:27,100
valid user account<font color="#E5E5E5"> you</font><font color="#CCCCCC"> can perform</font>

349
00:12:25,449 --> 00:12:32,109
<font color="#E5E5E5">almost all the LDAP queries you'll want</font>

350
00:12:27,100 --> 00:12:34,569
<font color="#E5E5E5">to map out</font><font color="#CCCCCC"> the domain if you're not</font>

351
00:12:32,110 --> 00:12:36,309
familiar with<font color="#E5E5E5"> LDAP I've never really</font>

352
00:12:34,569 --> 00:12:39,339
<font color="#CCCCCC">used it before the syntax can be a</font>

353
00:12:36,309 --> 00:12:41,110
little alarming<font color="#E5E5E5"> it's based on X dot 500</font>

354
00:12:39,339 --> 00:12:44,350
<font color="#E5E5E5">I'm gonna give a quick overview</font><font color="#CCCCCC"> here</font>

355
00:12:41,110 --> 00:12:46,149
essentially<font color="#E5E5E5"> every single object</font><font color="#CCCCCC"> in LDAP</font>

356
00:12:44,350 --> 00:12:47,559
has a distinguished<font color="#CCCCCC"> name which is a</font>

357
00:12:46,149 --> 00:12:50,110
hierarchical path of<font color="#E5E5E5"> where it's located</font>

358
00:12:47,559 --> 00:12:53,379
<font color="#E5E5E5">inside the directory</font><font color="#CCCCCC"> but it's also</font><font color="#E5E5E5"> its</font>

359
00:12:50,110 --> 00:12:54,759
unique identifier so in an<font color="#CCCCCC"> active</font>

360
00:12:53,379 --> 00:12:57,399
<font color="#CCCCCC">directory a user</font><font color="#E5E5E5"> object for example</font>

361
00:12:54,759 --> 00:12:58,899
Trevor Hoffman here that's his complete

362
00:12:57,399 --> 00:13:00,819
DN and you can read it from

363
00:12:58,899 --> 00:13:03,249
<font color="#CCCCCC">right-to-left hierarchically the DC is</font>

364
00:13:00,819 --> 00:13:04,540
the<font color="#E5E5E5"> domain component</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> Active</font>

365
00:13:03,249 --> 00:13:05,589
<font color="#CCCCCC">Directory you can take the domain and</font>

366
00:13:04,540 --> 00:13:08,349
you<font color="#CCCCCC"> just split</font><font color="#E5E5E5"> it up into the domain</font>

367
00:13:05,589 --> 00:13:09,910
components then<font color="#E5E5E5"> you have oh use which</font>

368
00:13:08,350 --> 00:13:11,470
you<font color="#E5E5E5"> can think of as folders they're</font>

369
00:13:09,910 --> 00:13:12,999
organizational units there's no rhyme or

370
00:13:11,470 --> 00:13:14,860
reason it's however<font color="#E5E5E5"> the administrator</font>

371
00:13:12,999 --> 00:13:17,230
kind of wants to<font color="#CCCCCC"> organize his domain he</font>

372
00:13:14,860 --> 00:13:18,639
creates these folders called<font color="#E5E5E5"> oh you and</font>

373
00:13:17,230 --> 00:13:19,899
then a common name which is<font color="#E5E5E5"> the friendly</font>

374
00:13:18,639 --> 00:13:22,180
name you'll often<font color="#CCCCCC"> just see it referred</font>

375
00:13:19,899 --> 00:13:25,600
<font color="#CCCCCC">to as</font><font color="#E5E5E5"> and</font>

376
00:13:22,180 --> 00:13:26,819
<font color="#E5E5E5">single DN has lots of attributes here's</font>

377
00:13:25,600 --> 00:13:29,680
what that<font color="#CCCCCC"> looks like in Active Directory</font>

378
00:13:26,820 --> 00:13:31,149
<font color="#CCCCCC">this is the LDAP entry for that</font><font color="#E5E5E5"> Trevor</font>

379
00:13:29,680 --> 00:13:32,739
Hoffman user and these are all<font color="#E5E5E5"> the</font>

380
00:13:31,149 --> 00:13:34,660
attributes<font color="#E5E5E5"> that are stored for that user</font>

381
00:13:32,740 --> 00:13:36,610
<font color="#E5E5E5">that were able</font><font color="#CCCCCC"> to query for with with</font>

382
00:13:34,660 --> 00:13:38,279
<font color="#E5E5E5">just a standard domain user and it</font>

383
00:13:36,610 --> 00:13:41,320
contains all his<font color="#CCCCCC"> personal information</font>

384
00:13:38,279 --> 00:13:43,270
<font color="#CCCCCC">his first name last name address or</font>

385
00:13:41,320 --> 00:13:45,130
phone number email address<font color="#E5E5E5"> but it also</font>

386
00:13:43,270 --> 00:13:48,010
includes<font color="#E5E5E5"> things like all the</font><font color="#CCCCCC"> groups he's</font>

387
00:13:45,130 --> 00:13:49,149
a part of some time stamps<font color="#E5E5E5"> when the last</font>

388
00:13:48,010 --> 00:13:51,730
time he<font color="#E5E5E5"> logged in or changed his</font>

389
00:13:49,149 --> 00:13:54,550
<font color="#CCCCCC">password is his gooood and his sid</font><font color="#E5E5E5"> are</font>

390
00:13:51,730 --> 00:13:56,080
<font color="#E5E5E5">also stored as LDAP attributes</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> then</font>

391
00:13:54,550 --> 00:13:57,609
down here<font color="#CCCCCC"> on the bottom his Sam account</font>

392
00:13:56,080 --> 00:13:59,890
<font color="#E5E5E5">name and</font><font color="#CCCCCC"> his user principal name which</font>

393
00:13:57,610 --> 00:14:05,470
is what<font color="#CCCCCC"> he'll</font><font color="#E5E5E5"> use to</font><font color="#CCCCCC"> log</font><font color="#E5E5E5"> in to</font><font color="#CCCCCC"> the</font>

394
00:13:59,890 --> 00:14:08,199
domain is<font color="#E5E5E5"> also always stored in LDAP so</font>

395
00:14:05,470 --> 00:14:09,610
you can use any LDAP client but the

396
00:14:08,200 --> 00:14:10,990
client I find myself going back<font color="#E5E5E5"> to</font>

397
00:14:09,610 --> 00:14:14,140
because<font color="#E5E5E5"> it's installed by default on a</font>

398
00:14:10,990 --> 00:14:15,580
lot of<font color="#CCCCCC"> Linux distros</font><font color="#E5E5E5"> as LDAP search and</font>

399
00:14:14,140 --> 00:14:18,189
LDAP search kind of has a<font color="#E5E5E5"> weird syntax</font>

400
00:14:15,580 --> 00:14:19,690
also<font color="#E5E5E5"> so I just put an example slide up</font>

401
00:14:18,190 --> 00:14:22,060
<font color="#CCCCCC">here if</font><font color="#E5E5E5"> you have LDAP search and want to</font>

402
00:14:19,690 --> 00:14:23,350
run an LDAP query<font color="#E5E5E5"> you basically just</font>

403
00:14:22,060 --> 00:14:25,000
pointed<font color="#CCCCCC"> to</font><font color="#E5E5E5"> the domain controller you</font>

404
00:14:23,350 --> 00:14:26,890
give it the<font color="#E5E5E5"> authentication material like</font>

405
00:14:25,000 --> 00:14:29,080
a username<font color="#E5E5E5"> and a password and it's nice</font>

406
00:14:26,890 --> 00:14:31,089
an<font color="#CCCCCC"> Active Directory you</font><font color="#E5E5E5"> can use a UPN or</font>

407
00:14:29,080 --> 00:14:32,500
use a<font color="#CCCCCC"> principle name as the bind account</font>

408
00:14:31,089 --> 00:14:34,750
instead<font color="#E5E5E5"> of doing having to type out the</font>

409
00:14:32,500 --> 00:14:38,220
full<font color="#E5E5E5"> DN and then you give</font><font color="#CCCCCC"> it the</font><font color="#E5E5E5"> search</font>

410
00:14:34,750 --> 00:14:38,220
filter and the attributes that<font color="#E5E5E5"> you want</font>

411
00:14:38,459 --> 00:14:43,329
so a couple if you<font color="#E5E5E5"> want to just start</font>

412
00:14:41,230 --> 00:14:44,770
<font color="#CCCCCC">doing some initial mapping really broad</font>

413
00:14:43,330 --> 00:14:46,480
filters to see the<font color="#CCCCCC"> information that</font>

414
00:14:44,770 --> 00:14:48,790
comes<font color="#E5E5E5"> back and you one filter I like to</font>

415
00:14:46,480 --> 00:14:50,770
use<font color="#CCCCCC"> a</font><font color="#E5E5E5"> just object class so object class</font>

416
00:14:48,790 --> 00:14:53,290
equals<font color="#E5E5E5"> user is gonna dump every single</font>

417
00:14:50,770 --> 00:14:54,779
LDAP object that's<font color="#E5E5E5"> a user object and</font>

418
00:14:53,290 --> 00:14:57,790
some of the<font color="#E5E5E5"> more interesting attributes</font>

419
00:14:54,779 --> 00:14:59,800
<font color="#CCCCCC">that</font><font color="#E5E5E5"> are stored in LDAP for user objects</font>

420
00:14:57,790 --> 00:15:01,779
like<font color="#E5E5E5"> we've talked</font><font color="#CCCCCC"> about already are</font><font color="#E5E5E5"> the</font>

421
00:14:59,800 --> 00:15:03,069
<font color="#E5E5E5">groups</font><font color="#CCCCCC"> they're</font><font color="#E5E5E5"> members</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the last time</font>

422
00:15:01,779 --> 00:15:04,900
they've logged in or the last time

423
00:15:03,070 --> 00:15:06,970
they've failed an account the number<font color="#CCCCCC"> of</font>

424
00:15:04,900 --> 00:15:08,470
times they failed to<font color="#CCCCCC"> log in</font><font color="#E5E5E5"> the last</font>

425
00:15:06,970 --> 00:15:10,450
time they set their password<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is ID</font>

426
00:15:08,470 --> 00:15:12,760
<font color="#CCCCCC">true information</font><font color="#E5E5E5"> you can just</font><font color="#CCCCCC"> pull from</font>

427
00:15:10,450 --> 00:15:14,170
LDAP attributes and<font color="#E5E5E5"> this little</font>

428
00:15:12,760 --> 00:15:16,390
one-liner here will actually<font color="#E5E5E5"> convert</font>

429
00:15:14,170 --> 00:15:21,939
those ugly decimal timestamps to a human

430
00:15:16,390 --> 00:15:23,589
<font color="#E5E5E5">readable date object class equals group</font>

431
00:15:21,940 --> 00:15:26,050
<font color="#E5E5E5">will show every</font><font color="#CCCCCC"> single group with an</font>

432
00:15:23,589 --> 00:15:28,270
LDAP<font color="#CCCCCC"> and some of the more interesting</font>

433
00:15:26,050 --> 00:15:29,740
attributes<font color="#CCCCCC"> there's</font><font color="#E5E5E5"> common name which is</font>

434
00:15:28,270 --> 00:15:32,560
what you'll see<font color="#CCCCCC"> the group referred to as</font>

435
00:15:29,740 --> 00:15:34,209
the members so the the objects that<font color="#E5E5E5"> make</font>

436
00:15:32,560 --> 00:15:35,510
<font color="#CCCCCC">up that group are a part of</font><font color="#E5E5E5"> that group</font>

437
00:15:34,209 --> 00:15:36,920
and then remember

438
00:15:35,510 --> 00:15:38,689
because you have to remember groups can

439
00:15:36,920 --> 00:15:40,130
also<font color="#E5E5E5"> be members</font><font color="#CCCCCC"> of other</font><font color="#E5E5E5"> groups so</font><font color="#CCCCCC"> you</font>

440
00:15:38,690 --> 00:15:41,840
have nested groups and if a group<font color="#E5E5E5"> is a</font>

441
00:15:40,130 --> 00:15:43,970
member<font color="#CCCCCC"> of another</font><font color="#E5E5E5"> group</font><font color="#CCCCCC"> there'll be a</font>

442
00:15:41,840 --> 00:15:45,680
member<font color="#E5E5E5"> of attribute as well</font><font color="#CCCCCC"> and you</font><font color="#E5E5E5"> can</font>

443
00:15:43,970 --> 00:15:50,930
see<font color="#E5E5E5"> if</font><font color="#CCCCCC"> that groups part</font><font color="#E5E5E5"> of a different</font>

444
00:15:45,680 --> 00:15:53,510
group computers are great<font color="#E5E5E5"> object</font><font color="#CCCCCC"> class</font>

445
00:15:50,930 --> 00:15:54,439
equals computer every single<font color="#CCCCCC"> computer</font>

446
00:15:53,510 --> 00:15:57,620
that's joined to the<font color="#E5E5E5"> Active Directory</font>

447
00:15:54,440 --> 00:15:59,510
<font color="#E5E5E5">domain gets an LDAP entry and</font><font color="#CCCCCC"> Aldo's</font>

448
00:15:57,620 --> 00:16:01,190
LDAP attributes store metadata

449
00:15:59,510 --> 00:16:02,600
information<font color="#E5E5E5"> about the computer that's</font>

450
00:16:01,190 --> 00:16:04,970
<font color="#CCCCCC">useful for us if we're just performing</font>

451
00:16:02,600 --> 00:16:06,560
reconnaissance so some of the more

452
00:16:04,970 --> 00:16:08,630
<font color="#E5E5E5">interesting</font><font color="#CCCCCC"> information just</font><font color="#E5E5E5"> for every</font>

453
00:16:06,560 --> 00:16:10,339
<font color="#CCCCCC">single computer object</font><font color="#E5E5E5"> is we have its</font>

454
00:16:08,630 --> 00:16:12,860
NetBIOS name and<font color="#E5E5E5"> it's fully qualified</font>

455
00:16:10,340 --> 00:16:14,390
domain<font color="#E5E5E5"> name but we also have the exact</font>

456
00:16:12,860 --> 00:16:16,400
operating system version that's<font color="#E5E5E5"> running</font>

457
00:16:14,390 --> 00:16:19,189
<font color="#E5E5E5">on that machine the last time someone</font>

458
00:16:16,400 --> 00:16:21,560
logged on to it<font color="#CCCCCC"> and</font><font color="#E5E5E5"> through</font><font color="#CCCCCC"> sources and</font>

459
00:16:19,190 --> 00:16:24,020
what function might that that<font color="#E5E5E5"> machines</font>

460
00:16:21,560 --> 00:16:26,630
serve and what's<font color="#E5E5E5"> nice is</font><font color="#CCCCCC"> you could</font>

461
00:16:24,020 --> 00:16:28,970
combine<font color="#E5E5E5"> the DNS</font><font color="#CCCCCC"> hostname that you get</font>

462
00:16:26,630 --> 00:16:31,160
from LDAP<font color="#E5E5E5"> with forward</font><font color="#CCCCCC"> DNS lookups</font><font color="#E5E5E5"> and</font>

463
00:16:28,970 --> 00:16:33,650
get IP addresses<font color="#E5E5E5"> a que like a target</font>

464
00:16:31,160 --> 00:16:35,150
list<font color="#E5E5E5"> for your</font><font color="#CCCCCC"> pentest</font><font color="#E5E5E5"> without actually</font>

465
00:16:33,650 --> 00:16:36,319
having to<font color="#E5E5E5"> scan the</font><font color="#CCCCCC"> network because the</font>

466
00:16:35,150 --> 00:16:43,370
domain<font color="#CCCCCC"> control will just give that all</font>

467
00:16:36,320 --> 00:16:45,110
to you now like I said Microsoft<font color="#CCCCCC"> took</font>

468
00:16:43,370 --> 00:16:47,750
LDAP and added a bunch<font color="#E5E5E5"> of cool</font><font color="#CCCCCC"> things to</font>

469
00:16:45,110 --> 00:16:49,940
<font color="#E5E5E5">it and one of</font><font color="#CCCCCC"> the coolest things that I</font>

470
00:16:47,750 --> 00:16:53,600
mean they added were these extensions

471
00:16:49,940 --> 00:16:55,370
through<font color="#E5E5E5"> object identifier</font><font color="#CCCCCC"> Zoro IDs and</font>

472
00:16:53,600 --> 00:16:57,860
these let you craft really really

473
00:16:55,370 --> 00:16:59,150
powerful<font color="#CCCCCC"> LDAP searches</font><font color="#E5E5E5"> and you can do</font>

474
00:16:57,860 --> 00:17:01,940
sort<font color="#E5E5E5"> of advanced searching and filtering</font>

475
00:16:59,150 --> 00:17:03,410
as you're<font color="#E5E5E5"> doing LDAP lookups</font><font color="#CCCCCC"> and one of</font>

476
00:17:01,940 --> 00:17:05,480
them called LDAP matching rule and chain

477
00:17:03,410 --> 00:17:08,180
<font color="#CCCCCC">is super useful because it allows you</font><font color="#E5E5E5"> to</font>

478
00:17:05,480 --> 00:17:10,430
do recursive lookups<font color="#E5E5E5"> and so if you chain</font>

479
00:17:08,180 --> 00:17:13,370
that with the member of property it will

480
00:17:10,430 --> 00:17:15,020
recursively<font color="#CCCCCC"> go into every group and find</font>

481
00:17:13,369 --> 00:17:17,448
transitive members of that<font color="#E5E5E5"> group as well</font>

482
00:17:15,020 --> 00:17:19,670
<font color="#E5E5E5">so if you just drop that ugly kind of</font>

483
00:17:17,449 --> 00:17:22,100
decimal oh<font color="#E5E5E5"> i</font><font color="#CCCCCC"> d--</font><font color="#E5E5E5"> into your LDAP filter</font>

484
00:17:19,670 --> 00:17:23,690
<font color="#E5E5E5">the server will</font><font color="#CCCCCC"> recurse into all the</font>

485
00:17:22,099 --> 00:17:25,698
members of a group<font color="#E5E5E5"> and if that's a group</font>

486
00:17:23,690 --> 00:17:29,030
<font color="#E5E5E5">itself all the members</font><font color="#CCCCCC"> of that group etc</font>

487
00:17:25,699 --> 00:17:32,210
etc all<font color="#E5E5E5"> the</font><font color="#CCCCCC"> way down the chain so why is</font>

488
00:17:29,030 --> 00:17:33,920
that important<font color="#E5E5E5"> well net group domain</font>

489
00:17:32,210 --> 00:17:35,660
admins slash domain is probably the

490
00:17:33,920 --> 00:17:37,010
first<font color="#E5E5E5"> Windows command I memorized when I</font>

491
00:17:35,660 --> 00:17:38,360
started<font color="#E5E5E5"> out pen testing I thought that</font>

492
00:17:37,010 --> 00:17:41,270
was<font color="#E5E5E5"> the most important thing</font><font color="#CCCCCC"> if I ever</font>

493
00:17:38,360 --> 00:17:43,429
got<font color="#E5E5E5"> in a Windows machine</font><font color="#CCCCCC"> but if you run</font>

494
00:17:41,270 --> 00:17:45,440
<font color="#E5E5E5">that on a Windows machine in this domain</font>

495
00:17:43,430 --> 00:17:47,780
<font color="#CCCCCC">you might think there's only two domain</font>

496
00:17:45,440 --> 00:17:49,310
admins administrator and a green and

497
00:17:47,780 --> 00:17:52,100
that's looking<font color="#CCCCCC"> it</font><font color="#E5E5E5"> up over our</font><font color="#CCCCCC"> piece</font>

498
00:17:49,310 --> 00:17:53,870
<font color="#CCCCCC">and Samer</font><font color="#E5E5E5"> but if we run</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> nested</font>

499
00:17:52,100 --> 00:17:55,909
group query and LDAP for the domain

500
00:17:53,870 --> 00:17:57,889
admins<font color="#CCCCCC"> group</font><font color="#E5E5E5"> will actually get a more</font>

501
00:17:55,910 --> 00:17:59,750
authoritative answer<font color="#CCCCCC"> and it shows</font><font color="#E5E5E5"> that</font>

502
00:17:57,890 --> 00:18:02,270
there's<font color="#E5E5E5"> 13 user objects that have</font>

503
00:17:59,750 --> 00:18:03,680
transitive domain admin properties so

504
00:18:02,270 --> 00:18:05,300
you should always trust<font color="#E5E5E5"> LDAP and not</font>

505
00:18:03,680 --> 00:18:09,520
necessarily the net commands<font color="#E5E5E5"> if you're</font>

506
00:18:05,300 --> 00:18:13,970
performing<font color="#E5E5E5"> reconnaissance another useful</font>

507
00:18:09,520 --> 00:18:15,650
<font color="#E5E5E5">LDAP filter is admin count and this is</font>

508
00:18:13,970 --> 00:18:18,380
just<font color="#CCCCCC"> a basically</font><font color="#E5E5E5"> a boolean it's either</font>

509
00:18:15,650 --> 00:18:21,530
<font color="#E5E5E5">one</font><font color="#CCCCCC"> or it doesn't</font><font color="#E5E5E5"> exist and according to</font>

510
00:18:18,380 --> 00:18:23,360
Microsoft documentation<font color="#E5E5E5"> admin count</font>

511
00:18:21,530 --> 00:18:25,250
attribute indicates<font color="#CCCCCC"> that</font><font color="#E5E5E5"> this object has</font>

512
00:18:23,360 --> 00:18:27,320
<font color="#CCCCCC">had its Ackles changed</font><font color="#E5E5E5"> because</font><font color="#CCCCCC"> it's</font>

513
00:18:25,250 --> 00:18:31,040
either directly or transitively part of

514
00:18:27,320 --> 00:18:32,389
an administrative group so as<font color="#CCCCCC"> a pen</font>

515
00:18:31,040 --> 00:18:33,800
tester or someone who<font color="#E5E5E5"> wants to just</font>

516
00:18:32,390 --> 00:18:35,720
perform<font color="#CCCCCC"> reconnaissance like this is</font>

517
00:18:33,800 --> 00:18:37,490
extremely<font color="#E5E5E5"> useful</font><font color="#CCCCCC"> to me</font><font color="#E5E5E5"> because this</font>

518
00:18:35,720 --> 00:18:39,350
<font color="#E5E5E5">makes my LDAP search like the easiest</font>

519
00:18:37,490 --> 00:18:41,300
thing<font color="#CCCCCC"> in the world you can filter on</font>

520
00:18:39,350 --> 00:18:43,399
<font color="#E5E5E5">this attribute so if you only</font><font color="#CCCCCC"> remember</font>

521
00:18:41,300 --> 00:18:45,080
one<font color="#E5E5E5"> LDAP search filter like leaving this</font>

522
00:18:43,400 --> 00:18:47,720
talk<font color="#E5E5E5"> just land somewhere</font><font color="#CCCCCC"> and just</font>

523
00:18:45,080 --> 00:18:49,639
<font color="#E5E5E5">remember admin count equals one and if</font>

524
00:18:47,720 --> 00:18:51,590
you search<font color="#CCCCCC"> for any object that has admin</font>

525
00:18:49,640 --> 00:18:52,850
<font color="#E5E5E5">count equals one you will find every</font>

526
00:18:51,590 --> 00:18:54,169
<font color="#E5E5E5">single object that's considered</font>

527
00:18:52,850 --> 00:18:55,730
important enough<font color="#CCCCCC"> to</font><font color="#E5E5E5"> have</font><font color="#CCCCCC"> its Ackles</font>

528
00:18:54,170 --> 00:18:56,960
protected and those<font color="#CCCCCC"> would</font><font color="#E5E5E5"> be like your</font>

529
00:18:55,730 --> 00:18:58,940
<font color="#CCCCCC">high-value targets to go after</font>

530
00:18:56,960 --> 00:19:00,710
<font color="#E5E5E5">essentially all the domain admins or</font><font color="#CCCCCC"> the</font>

531
00:18:58,940 --> 00:19:04,850
objects that<font color="#E5E5E5"> have essentially transitive</font>

532
00:19:00,710 --> 00:19:06,950
domain admin rights<font color="#E5E5E5"> couple other</font>

533
00:19:04,850 --> 00:19:09,429
examples<font color="#CCCCCC"> of some other</font><font color="#E5E5E5"> oh I DS that can</font>

534
00:19:06,950 --> 00:19:11,840
be useful<font color="#CCCCCC"> when you're doing LDAP lookups</font>

535
00:19:09,430 --> 00:19:13,700
<font color="#CCCCCC">there's</font><font color="#E5E5E5"> oh I DS for user account control</font>

536
00:19:11,840 --> 00:19:16,399
which can find user objects that have

537
00:19:13,700 --> 00:19:17,960
service<font color="#E5E5E5"> principle names there's oh I DS</font>

538
00:19:16,400 --> 00:19:19,700
that can help<font color="#E5E5E5"> you find users and</font>

539
00:19:17,960 --> 00:19:21,860
computers unconstrained delegation

540
00:19:19,700 --> 00:19:23,000
so these LDAP queries you<font color="#E5E5E5"> can use to</font>

541
00:19:21,860 --> 00:19:25,760
find<font color="#E5E5E5"> all the servers that allow</font>

542
00:19:23,000 --> 00:19:29,200
unconstrained delegation<font color="#E5E5E5"> computers with</font>

543
00:19:25,760 --> 00:19:32,360
protocol transition so Kerberos<font color="#E5E5E5"> to ntlm</font>

544
00:19:29,200 --> 00:19:34,640
and then<font color="#CCCCCC"> everything's</font><font color="#E5E5E5"> an object like I</font>

545
00:19:32,360 --> 00:19:36,439
said so even<font color="#CCCCCC"> Group Policy you can</font><font color="#E5E5E5"> query</font>

546
00:19:34,640 --> 00:19:38,390
through LDAP<font color="#E5E5E5"> if you</font><font color="#CCCCCC"> just want to look</font>

547
00:19:36,440 --> 00:19:39,860
for object classical's<font color="#E5E5E5"> group policy you</font>

548
00:19:38,390 --> 00:19:41,540
can find all the<font color="#CCCCCC"> information for every</font>

549
00:19:39,860 --> 00:19:42,919
policy<font color="#E5E5E5"> that's in that domain not</font>

550
00:19:41,540 --> 00:19:46,940
necessarily that it's linked or enforced

551
00:19:42,920 --> 00:19:50,240
<font color="#E5E5E5">but you can just enumerate that but why</font>

552
00:19:46,940 --> 00:19:52,400
do<font color="#E5E5E5"> that manually</font><font color="#CCCCCC"> it's a pain to</font><font color="#E5E5E5"> remember</font>

553
00:19:50,240 --> 00:19:53,720
all<font color="#E5E5E5"> that LDAP search syntax and my cheat</font>

554
00:19:52,400 --> 00:19:55,160
sheet<font color="#E5E5E5"> kind of kept growing and growing</font>

555
00:19:53,720 --> 00:19:57,860
and<font color="#CCCCCC"> growing</font><font color="#E5E5E5"> and I finally said screw</font><font color="#CCCCCC"> it</font>

556
00:19:55,160 --> 00:19:59,720
so I wrote a Python script<font color="#CCCCCC"> to automate a</font>

557
00:19:57,860 --> 00:20:02,540
<font color="#CCCCCC">lot of those common active directory and</font>

558
00:19:59,720 --> 00:20:04,250
numeration<font color="#E5E5E5"> lookups</font>

559
00:20:02,540 --> 00:20:06,050
wind app search you can<font color="#E5E5E5"> find</font><font color="#CCCCCC"> it on like</font>

560
00:20:04,250 --> 00:20:07,790
github<font color="#E5E5E5"> over here is kind</font><font color="#CCCCCC"> of a quick</font>

561
00:20:06,050 --> 00:20:09,649
rundown of all<font color="#E5E5E5"> the options</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> can just</font>

562
00:20:07,790 --> 00:20:13,580
pass<font color="#E5E5E5"> it command line flags and enumerate</font>

563
00:20:09,650 --> 00:20:15,650
some<font color="#CCCCCC"> of that information so just a quick</font>

564
00:20:13,580 --> 00:20:17,000
demo video showing wind app search in

565
00:20:15,650 --> 00:20:18,860
action<font color="#E5E5E5"> I hope you guys can read that I</font>

566
00:20:17,000 --> 00:20:23,870
<font color="#CCCCCC">apologize it's a video I can't make</font><font color="#E5E5E5"> it</font>

567
00:20:18,860 --> 00:20:25,580
bigger<font color="#CCCCCC"> it all it needs is</font><font color="#E5E5E5"> a valid domain</font>

568
00:20:23,870 --> 00:20:27,889
name it'll find the LDAP servers<font color="#E5E5E5"> over</font>

569
00:20:25,580 --> 00:20:29,629
DNS like I talked about and from an

570
00:20:27,890 --> 00:20:31,640
unauthenticated perspective<font color="#E5E5E5"> the -</font>

571
00:20:29,630 --> 00:20:33,290
functionality<font color="#E5E5E5"> will just go ahead and</font>

572
00:20:31,640 --> 00:20:35,030
<font color="#CCCCCC">find the LDAP server and tell us exactly</font>

573
00:20:33,290 --> 00:20:37,879
what functionality level we're dealing

574
00:20:35,030 --> 00:20:38,540
with but if we give it a<font color="#CCCCCC"> username and a</font>

575
00:20:37,880 --> 00:20:40,250
password

576
00:20:38,540 --> 00:20:42,139
then we can actually<font color="#CCCCCC"> perform more</font>

577
00:20:40,250 --> 00:20:45,020
valuable information<font color="#CCCCCC"> or more valuable</font>

578
00:20:42,140 --> 00:20:46,550
queries<font color="#E5E5E5"> so - capital C this is</font>

579
00:20:45,020 --> 00:20:49,190
enumerated<font color="#CCCCCC"> in all the computers in the</font>

580
00:20:46,550 --> 00:20:50,570
<font color="#E5E5E5">domain</font><font color="#CCCCCC"> and explaining</font><font color="#E5E5E5"> you know what</font>

581
00:20:49,190 --> 00:20:53,720
operating system they're running and

582
00:20:50,570 --> 00:20:54,830
what patch level<font color="#E5E5E5"> they're at as an</font>

583
00:20:53,720 --> 00:20:56,990
<font color="#CCCCCC">example</font><font color="#E5E5E5"> because this has been</font><font color="#CCCCCC"> a hot</font>

584
00:20:54,830 --> 00:20:58,189
<font color="#CCCCCC">topic this week</font><font color="#E5E5E5"> unconstrained computers</font>

585
00:20:56,990 --> 00:21:00,140
will show me<font color="#CCCCCC"> all the computers that</font>

586
00:20:58,190 --> 00:21:01,790
<font color="#E5E5E5">allow unconstrained delegation domain</font>

587
00:21:00,140 --> 00:21:03,530
control is expected<font color="#E5E5E5"> but definitely not</font><font color="#CCCCCC"> a</font>

588
00:21:01,790 --> 00:21:06,590
Windows 10<font color="#CCCCCC"> workstations so that's that's</font>

589
00:21:03,530 --> 00:21:09,500
<font color="#CCCCCC">something to target user spins will of</font>

590
00:21:06,590 --> 00:21:12,490
course<font color="#E5E5E5"> show Kerberos table user objects</font>

591
00:21:09,500 --> 00:21:12,490
and I'll talk about<font color="#E5E5E5"> that at the end</font>

592
00:21:14,320 --> 00:21:19,129
admin objects does that admin count

593
00:21:17,300 --> 00:21:21,230
equals<font color="#E5E5E5"> one so this is every object that</font>

594
00:21:19,130 --> 00:21:22,880
has its<font color="#CCCCCC"> ackles protected so it includes</font>

595
00:21:21,230 --> 00:21:25,390
<font color="#E5E5E5">basically all the domain admins plus</font>

596
00:21:22,880 --> 00:21:27,680
groups plus service accounts or<font color="#CCCCCC"> anything</font>

597
00:21:25,390 --> 00:21:28,880
<font color="#CCCCCC">and just to</font><font color="#E5E5E5"> show if we come across a</font>

598
00:21:27,680 --> 00:21:31,160
group and we<font color="#E5E5E5"> just want to see who's a</font>

599
00:21:28,880 --> 00:21:32,750
part of<font color="#E5E5E5"> like IT admins that's really</font>

600
00:21:31,160 --> 00:21:34,400
easy<font color="#E5E5E5"> to search</font><font color="#CCCCCC"> an</font><font color="#E5E5E5"> LDAP and we can just</font>

601
00:21:32,750 --> 00:21:37,160
<font color="#E5E5E5">quickly pull out all the group</font><font color="#CCCCCC"> members</font>

602
00:21:34,400 --> 00:21:42,320
of that of<font color="#E5E5E5"> that account</font><font color="#CCCCCC"> or sorry all the</font>

603
00:21:37,160 --> 00:21:44,180
group members<font color="#CCCCCC"> of that group</font><font color="#E5E5E5"> and then the</font>

604
00:21:42,320 --> 00:21:46,070
last thing LDAP supports fuzzy searching

605
00:21:44,180 --> 00:21:47,750
so if I<font color="#E5E5E5"> wanted</font><font color="#CCCCCC"> to just find</font><font color="#E5E5E5"> someone</font>

606
00:21:46,070 --> 00:21:49,850
named John in the domain I<font color="#CCCCCC"> can just look</font>

607
00:21:47,750 --> 00:21:51,890
up John<font color="#E5E5E5"> it'll show me all the possible</font>

608
00:21:49,850 --> 00:21:53,240
<font color="#CCCCCC">matches</font><font color="#E5E5E5"> I choose the one that</font><font color="#CCCCCC"> I want</font><font color="#E5E5E5"> and</font>

609
00:21:51,890 --> 00:21:56,590
then<font color="#E5E5E5"> it goes and it pulls out</font><font color="#CCCCCC"> all</font><font color="#E5E5E5"> the</font>

610
00:21:53,240 --> 00:21:56,590
<font color="#E5E5E5">actual information for</font><font color="#CCCCCC"> that user</font>

611
00:22:00,930 --> 00:22:05,790
so just a useful<font color="#E5E5E5"> wrapper if you're ready</font>

612
00:22:03,840 --> 00:22:07,139
<font color="#CCCCCC">to run LDAP queries or you</font><font color="#E5E5E5"> find yourself</font>

613
00:22:05,790 --> 00:22:09,270
kind<font color="#CCCCCC"> of wanting to</font><font color="#E5E5E5"> find</font><font color="#CCCCCC"> that information</font>

614
00:22:07,140 --> 00:22:11,130
quickly<font color="#E5E5E5"> and don't like I said have</font>

615
00:22:09,270 --> 00:22:14,150
access to<font color="#CCCCCC"> PowerShell or just prefer</font>

616
00:22:11,130 --> 00:22:17,850
Python<font color="#CCCCCC"> wind DAB search is a</font><font color="#E5E5E5"> great tool</font>

617
00:22:14,150 --> 00:22:20,100
I've kind of in<font color="#E5E5E5"> summary for LDAP LDAP</font>

618
00:22:17,850 --> 00:22:21,300
<font color="#E5E5E5">like I said consider it the source of</font>

619
00:22:20,100 --> 00:22:23,370
truth<font color="#E5E5E5"> for all objects in Active</font>

620
00:22:21,300 --> 00:22:24,899
Directory domain<font color="#E5E5E5"> it's really the first</font>

621
00:22:23,370 --> 00:22:27,209
stop that<font color="#CCCCCC"> I would go to to try</font><font color="#E5E5E5"> to map</font>

622
00:22:24,900 --> 00:22:28,500
out a domain<font color="#E5E5E5"> and the protocol is like</font>

623
00:22:27,210 --> 00:22:31,200
fairly easy to<font color="#E5E5E5"> work with</font><font color="#CCCCCC"> when you</font><font color="#E5E5E5"> get</font>

624
00:22:28,500 --> 00:22:33,330
the hang of it<font color="#E5E5E5"> and there's lots of ways</font>

625
00:22:31,200 --> 00:22:35,220
<font color="#E5E5E5">to query it it is an open protocol so</font>

626
00:22:33,330 --> 00:22:36,750
find whatever client you want<font color="#E5E5E5"> in any</font>

627
00:22:35,220 --> 00:22:38,610
<font color="#CCCCCC">language you want</font><font color="#E5E5E5"> to write a script in</font>

628
00:22:36,750 --> 00:22:40,200
like there's gonna<font color="#E5E5E5"> be an LDAP compliant</font>

629
00:22:38,610 --> 00:22:41,969
library for it and then<font color="#E5E5E5"> you</font><font color="#CCCCCC"> just start</font>

630
00:22:40,200 --> 00:22:44,430
<font color="#CCCCCC">putting those same LDAP filters in</font><font color="#E5E5E5"> and</font>

631
00:22:41,970 --> 00:22:45,870
you can pull<font color="#CCCCCC"> that information</font><font color="#E5E5E5"> out as</font>

632
00:22:44,430 --> 00:22:47,970
long as<font color="#CCCCCC"> you have any</font><font color="#E5E5E5"> valid domain</font>

633
00:22:45,870 --> 00:22:50,159
account you can run those LDAP queries

634
00:22:47,970 --> 00:22:51,630
from anywhere you have network<font color="#E5E5E5"> access</font><font color="#CCCCCC"> so</font>

635
00:22:50,160 --> 00:22:53,340
it's a great way<font color="#CCCCCC"> if you</font><font color="#E5E5E5"> just have like</font><font color="#CCCCCC"> a</font>

636
00:22:51,630 --> 00:22:55,830
username and<font color="#E5E5E5"> a password that's super own</font>

637
00:22:53,340 --> 00:22:57,240
<font color="#E5E5E5">privilege but can't log in anywhere</font><font color="#CCCCCC"> you</font>

638
00:22:55,830 --> 00:22:58,530
can just run LDAP queries against the

639
00:22:57,240 --> 00:23:01,290
domain controller and<font color="#CCCCCC"> find some</font><font color="#E5E5E5"> more</font>

640
00:22:58,530 --> 00:23:03,000
valuable information<font color="#E5E5E5"> and I said</font>

641
00:23:01,290 --> 00:23:06,270
potentially stealthier in<font color="#E5E5E5"> question marks</font>

642
00:23:03,000 --> 00:23:07,770
<font color="#CCCCCC">I</font><font color="#E5E5E5"> I think a lot</font><font color="#CCCCCC"> of security tools or</font><font color="#E5E5E5"> the</font>

643
00:23:06,270 --> 00:23:09,300
last time<font color="#CCCCCC"> I looked</font>

644
00:23:07,770 --> 00:23:11,610
we're listening<font color="#CCCCCC"> on the</font><font color="#E5E5E5"> domain</font><font color="#CCCCCC"> controller</font>

645
00:23:09,300 --> 00:23:13,680
and<font color="#E5E5E5"> flagging potentially sensitive</font><font color="#CCCCCC"> MS</font>

646
00:23:11,610 --> 00:23:15,570
RPC calls like looking up domain admins

647
00:23:13,680 --> 00:23:17,610
or protected objects<font color="#E5E5E5"> but they had a gap</font>

648
00:23:15,570 --> 00:23:19,020
when it<font color="#E5E5E5"> came to LDAP</font><font color="#CCCCCC"> I don't know if</font>

649
00:23:17,610 --> 00:23:21,320
that's the<font color="#E5E5E5"> case anymore but I think that</font>

650
00:23:19,020 --> 00:23:21,320
more

651
00:23:24,190 --> 00:23:28,029
looking at<font color="#CCCCCC"> net</font><font color="#E5E5E5"> flow and RPC traffic</font><font color="#CCCCCC"> than</font>

652
00:23:26,110 --> 00:23:29,110
LDAP<font color="#E5E5E5"> so this might fly under the radar a</font>

653
00:23:28,029 --> 00:23:32,169
<font color="#CCCCCC">little bit more if you're concerned</font>

654
00:23:29,110 --> 00:23:33,729
about<font color="#E5E5E5"> that</font><font color="#CCCCCC"> and I'm always adding to</font><font color="#E5E5E5"> wind</font>

655
00:23:32,169 --> 00:23:35,259
<font color="#CCCCCC">app search so if there's more useful</font>

656
00:23:33,730 --> 00:23:37,720
LDAP queries and there's so many<font color="#E5E5E5"> that</font>

657
00:23:35,259 --> 00:23:39,100
<font color="#E5E5E5">are out</font><font color="#CCCCCC"> there</font><font color="#E5E5E5"> including</font><font color="#CCCCCC"> Mauro</font><font color="#E5E5E5"> IDs PRS</font>

658
00:23:37,720 --> 00:23:47,159
are welcome to shoot in my way and we

659
00:23:39,100 --> 00:23:47,158
can just<font color="#E5E5E5"> keep the script alive all right</font>

660
00:23:48,570 --> 00:23:55,269
let's talk<font color="#CCCCCC"> about the three-headed</font><font color="#E5E5E5"> dog in</font>

661
00:23:50,799 --> 00:23:57,340
the room so who here feels like<font color="#E5E5E5"> they</font><font color="#CCCCCC"> are</font>

662
00:23:55,269 --> 00:24:01,529
comfortable<font color="#E5E5E5"> with Kerberos show of hands</font>

663
00:23:57,340 --> 00:24:01,529
<font color="#CCCCCC">okay and how many of you are</font><font color="#E5E5E5"> not liars</font>

664
00:24:02,519 --> 00:24:06,940
are displayed<font color="#E5E5E5"> every time I think I think</font>

665
00:24:05,529 --> 00:24:08,889
I'm<font color="#E5E5E5"> comfortable</font><font color="#CCCCCC"> with Kerberos and</font><font color="#E5E5E5"> every</font>

666
00:24:06,940 --> 00:24:11,019
time I see a talk or<font color="#CCCCCC"> look</font><font color="#E5E5E5"> back into it I</font>

667
00:24:08,889 --> 00:24:14,049
realize I'm a noob again Kerberos can

668
00:24:11,019 --> 00:24:15,639
seem crazy crazy<font color="#CCCCCC"> complicated and so I'm</font>

669
00:24:14,049 --> 00:24:17,259
<font color="#E5E5E5">going</font><font color="#CCCCCC"> to try to level</font><font color="#E5E5E5"> set and just</font>

670
00:24:15,639 --> 00:24:18,758
<font color="#CCCCCC">explain enough of the high level</font>

671
00:24:17,259 --> 00:24:20,200
concepts so that<font color="#CCCCCC"> we can get into some of</font>

672
00:24:18,759 --> 00:24:21,940
the fun stuff

673
00:24:20,200 --> 00:24:23,409
without<font color="#E5E5E5"> going into</font><font color="#CCCCCC"> too many</font><font color="#E5E5E5"> of the</font>

674
00:24:21,940 --> 00:24:28,450
<font color="#E5E5E5">technical details</font><font color="#CCCCCC"> that really hurt my</font>

675
00:24:23,409 --> 00:24:30,519
brain so it<font color="#E5E5E5"> took</font><font color="#CCCCCC"> me a long time to grok</font>

676
00:24:28,450 --> 00:24:32,529
<font color="#E5E5E5">Kerberos I didn't quite understand it</font>

677
00:24:30,519 --> 00:24:33,850
<font color="#E5E5E5">and it can seem</font><font color="#CCCCCC"> really complicated and</font>

678
00:24:32,529 --> 00:24:36,879
like I said<font color="#CCCCCC"> easy to get</font><font color="#E5E5E5"> lost in the</font>

679
00:24:33,850 --> 00:24:38,889
technical<font color="#E5E5E5"> details but what helped me to</font>

680
00:24:36,879 --> 00:24:41,620
kind of<font color="#E5E5E5"> put it into perspective is it's</font>

681
00:24:38,889 --> 00:24:44,289
just<font color="#CCCCCC"> single sign-on and</font><font color="#E5E5E5"> it's essentially</font>

682
00:24:41,620 --> 00:24:46,149
the<font color="#CCCCCC"> og single sign-on</font><font color="#E5E5E5"> so if any of you</font>

683
00:24:44,289 --> 00:24:49,870
<font color="#E5E5E5">and your work</font><font color="#CCCCCC"> use like single sign-on</font>

684
00:24:46,149 --> 00:24:51,879
providers like<font color="#CCCCCC"> octa or one</font><font color="#E5E5E5"> login or</font>

685
00:24:49,870 --> 00:24:53,439
<font color="#E5E5E5">summer sale point or something</font><font color="#CCCCCC"> like</font><font color="#E5E5E5"> that</font>

686
00:24:51,879 --> 00:24:55,809
Kerberos<font color="#CCCCCC"> is kind of like the precursor</font>

687
00:24:53,440 --> 00:24:58,450
<font color="#CCCCCC">to that</font><font color="#E5E5E5"> and I and it's an analogous to a</font>

688
00:24:55,809 --> 00:24:59,799
single sign-on provider and if anyone

689
00:24:58,450 --> 00:25:01,659
here<font color="#CCCCCC"> is</font><font color="#E5E5E5"> in web apps like I came from</font>

690
00:24:59,799 --> 00:25:03,370
<font color="#CCCCCC">that background when I started</font><font color="#E5E5E5"> thinking</font>

691
00:25:01,659 --> 00:25:04,200
<font color="#E5E5E5">about it like sam'l or</font><font color="#CCCCCC"> open ID it made</font>

692
00:25:03,370 --> 00:25:07,330
more<font color="#E5E5E5"> sense</font>

693
00:25:04,200 --> 00:25:09,039
the idea is you authenticate once<font color="#E5E5E5"> to a</font>

694
00:25:07,330 --> 00:25:10,689
trusted<font color="#E5E5E5"> source</font><font color="#CCCCCC"> it's the single</font><font color="#E5E5E5"> sign-on</font>

695
00:25:09,039 --> 00:25:11,980
portal and then<font color="#E5E5E5"> you don't have to</font>

696
00:25:10,690 --> 00:25:14,350
<font color="#CCCCCC">provide your password</font><font color="#E5E5E5"> to any other</font>

697
00:25:11,980 --> 00:25:16,269
services in the domain<font color="#E5E5E5"> the single source</font>

698
00:25:14,350 --> 00:25:17,980
delegates all your authentication<font color="#CCCCCC"> and</font>

699
00:25:16,269 --> 00:25:21,600
the single source<font color="#E5E5E5"> there is the key</font>

700
00:25:17,980 --> 00:25:21,600
<font color="#E5E5E5">distribution center or the KDC</font>

701
00:25:23,830 --> 00:25:29,529
so in<font color="#E5E5E5"> Windows</font><font color="#CCCCCC"> the domain controller is</font>

702
00:25:26,679 --> 00:25:32,320
<font color="#E5E5E5">the KDC</font><font color="#CCCCCC"> and the KDC is made up of two</font>

703
00:25:29,529 --> 00:25:35,019
<font color="#E5E5E5">parts</font><font color="#CCCCCC"> authentication</font><font color="#E5E5E5"> service and the</font>

704
00:25:32,320 --> 00:25:36,820
ticket granting service<font color="#CCCCCC"> they're not</font>

705
00:25:35,019 --> 00:25:38,230
super important to like keep<font color="#CCCCCC"> in mind</font>

706
00:25:36,820 --> 00:25:41,799
right<font color="#CCCCCC"> now but they just exist</font><font color="#E5E5E5"> on the</font>

707
00:25:38,230 --> 00:25:43,419
same domain controller now I'm<font color="#E5E5E5"> gonna try</font>

708
00:25:41,799 --> 00:25:44,590
to<font color="#E5E5E5"> walk</font><font color="#CCCCCC"> through kind</font><font color="#E5E5E5"> of a flow that made</font>

709
00:25:43,419 --> 00:25:48,100
<font color="#E5E5E5">sense for me if we're thing if we're</font>

710
00:25:44,590 --> 00:25:50,860
talking<font color="#E5E5E5"> about Kerberos here</font><font color="#CCCCCC"> the first</font>

711
00:25:48,100 --> 00:25:53,168
step as a user I start my day<font color="#E5E5E5"> I log into</font>

712
00:25:50,860 --> 00:25:54,729
<font color="#E5E5E5">my machine</font><font color="#CCCCCC"> I'm gonna go to my SSO portal</font>

713
00:25:53,169 --> 00:25:57,190
and sign in<font color="#CCCCCC"> with my</font><font color="#E5E5E5"> password</font><font color="#CCCCCC"> for the one</font>

714
00:25:54,730 --> 00:25:59,019
time that<font color="#E5E5E5"> day and SSO portal in this</font>

715
00:25:57,190 --> 00:26:02,289
case is the domain<font color="#E5E5E5"> controller and</font><font color="#CCCCCC"> it's</font>

716
00:25:59,019 --> 00:26:04,539
Kerberos so I send my password to<font color="#CCCCCC"> the</font>

717
00:26:02,289 --> 00:26:06,639
domain controller the domain controller

718
00:26:04,539 --> 00:26:09,129
validates my password and<font color="#E5E5E5"> it gives me a</font>

719
00:26:06,639 --> 00:26:10,779
session<font color="#E5E5E5"> cookie</font><font color="#CCCCCC"> I mean a ticket</font><font color="#E5E5E5"> but it's</font>

720
00:26:09,130 --> 00:26:13,029
<font color="#E5E5E5">really in my mind</font><font color="#CCCCCC"> like a</font><font color="#E5E5E5"> long live</font>

721
00:26:10,779 --> 00:26:15,519
session cookie and it's called a TGT or

722
00:26:13,029 --> 00:26:16,600
a ticket<font color="#CCCCCC"> granting ticket</font><font color="#E5E5E5"> as long as I'm</font>

723
00:26:15,519 --> 00:26:18,940
in possession<font color="#CCCCCC"> of</font><font color="#E5E5E5"> that ticket granting</font>

724
00:26:16,600 --> 00:26:20,469
ticket<font color="#E5E5E5"> and it hasn't expired</font><font color="#CCCCCC"> I never</font>

725
00:26:18,940 --> 00:26:23,590
need<font color="#CCCCCC"> to show my password again</font><font color="#E5E5E5"> that</font>

726
00:26:20,470 --> 00:26:25,269
ticket granting ticket<font color="#E5E5E5"> is all I need now</font>

727
00:26:23,590 --> 00:26:27,250
a little<font color="#E5E5E5"> bit later in the day</font>

728
00:26:25,269 --> 00:26:29,169
<font color="#CCCCCC">I want to log in to a server</font><font color="#E5E5E5"> called</font>

729
00:26:27,250 --> 00:26:31,289
servo<font color="#CCCCCC"> 1 and I</font><font color="#E5E5E5"> want to just mount like an</font>

730
00:26:29,169 --> 00:26:33,940
SMB share<font color="#CCCCCC"> over servo</font><font color="#E5E5E5"> 1</font>

731
00:26:31,289 --> 00:26:36,340
so I go to<font color="#E5E5E5"> servo 1 and I say hey I want</font>

732
00:26:33,940 --> 00:26:38,019
to mount your<font color="#E5E5E5"> SMB share and I need to</font>

733
00:26:36,340 --> 00:26:39,879
authenticate<font color="#CCCCCC"> myself so servo 1</font>

734
00:26:38,019 --> 00:26:41,169
<font color="#CCCCCC">quote-unquote redirects</font><font color="#E5E5E5"> me</font><font color="#CCCCCC"> back to the</font>

735
00:26:39,880 --> 00:26:42,460
domain controller if you're<font color="#E5E5E5"> kind of</font>

736
00:26:41,169 --> 00:26:44,260
<font color="#E5E5E5">thinking about this in like</font><font color="#CCCCCC"> a web app</font>

737
00:26:42,460 --> 00:26:46,720
flow I get redirected<font color="#E5E5E5"> back to the domain</font>

738
00:26:44,260 --> 00:26:48,129
controller now I show my TGT to the

739
00:26:46,720 --> 00:26:49,720
domain controller which proves I've

740
00:26:48,130 --> 00:26:51,519
already logged in I've authenticated

741
00:26:49,720 --> 00:26:54,700
myself and I say the<font color="#CCCCCC"> domain controller I</font>

742
00:26:51,519 --> 00:26:56,470
need to access SMB on servo 1 and the

743
00:26:54,700 --> 00:26:58,210
domain controller goes okay here's

744
00:26:56,470 --> 00:26:59,799
another cookie another<font color="#CCCCCC"> sessions are</font>

745
00:26:58,210 --> 00:27:01,809
another ticket called a service<font color="#CCCCCC"> ticket</font>

746
00:26:59,799 --> 00:27:04,090
<font color="#E5E5E5">that you can</font><font color="#CCCCCC"> present a</font><font color="#E5E5E5"> servo one that</font>

747
00:27:01,809 --> 00:27:06,129
will let you in<font color="#E5E5E5"> and it's only for SMB on</font>

748
00:27:04,090 --> 00:27:10,120
<font color="#CCCCCC">servo 1</font><font color="#E5E5E5"> and that's called a TGS or a</font>

749
00:27:06,130 --> 00:27:12,789
service ticket<font color="#E5E5E5"> now I forget redirected</font>

750
00:27:10,120 --> 00:27:15,639
<font color="#CCCCCC">quote unquote</font><font color="#E5E5E5"> back to servo 1 and this</font>

751
00:27:12,789 --> 00:27:17,590
time I present my service ticket<font color="#E5E5E5"> servo</font><font color="#CCCCCC"> 1</font>

752
00:27:15,639 --> 00:27:19,418
trusts and can verify that that service

753
00:27:17,590 --> 00:27:21,340
<font color="#E5E5E5">ticket is legitimate and</font><font color="#CCCCCC"> that service</font>

754
00:27:19,419 --> 00:27:23,440
ticket has all the<font color="#CCCCCC"> information</font><font color="#E5E5E5"> about me</font>

755
00:27:21,340 --> 00:27:25,990
<font color="#E5E5E5">and my user</font><font color="#CCCCCC"> and my group memberships</font><font color="#E5E5E5"> and</font>

756
00:27:23,440 --> 00:27:29,220
servo<font color="#CCCCCC"> 1 goes</font><font color="#E5E5E5"> ok this is legitimate go</font>

757
00:27:25,990 --> 00:27:32,049
ahead we'll<font color="#CCCCCC"> set up</font><font color="#E5E5E5"> the SMB connection</font>

758
00:27:29,220 --> 00:27:33,669
did<font color="#E5E5E5"> that kind</font><font color="#CCCCCC"> of make</font><font color="#E5E5E5"> sense at a super</font>

759
00:27:32,049 --> 00:27:36,158
<font color="#CCCCCC">high level</font><font color="#E5E5E5"> that's kind</font><font color="#CCCCCC"> of the Kerberos</font>

760
00:27:33,669 --> 00:27:37,760
flow right there and<font color="#CCCCCC"> it's Kerberos and</font>

761
00:27:36,159 --> 00:27:40,670
<font color="#E5E5E5">for bullet points which might be a new</font>

762
00:27:37,760 --> 00:27:42,440
I don't know<font color="#CCCCCC"> but I could talk about</font><font color="#E5E5E5"> this</font>

763
00:27:40,670 --> 00:27:43,370
<font color="#E5E5E5">and go into a lot more detail but</font><font color="#CCCCCC"> this</font>

764
00:27:42,440 --> 00:27:46,720
is all<font color="#E5E5E5"> we really need to</font><font color="#CCCCCC"> know to</font>

765
00:27:43,370 --> 00:27:49,580
understand some of the<font color="#CCCCCC"> kerberos attacks</font>

766
00:27:46,720 --> 00:27:51,260
now under the hood<font color="#E5E5E5"> windows does so much</font>

767
00:27:49,580 --> 00:27:52,669
<font color="#CCCCCC">to</font><font color="#E5E5E5"> make this seem really seamless like</font>

768
00:27:51,260 --> 00:27:55,310
it should when it works it<font color="#CCCCCC"> really is</font>

769
00:27:52,670 --> 00:27:57,200
like seamless single sign-on<font color="#E5E5E5"> so as a</font>

770
00:27:55,310 --> 00:28:00,230
quick example<font color="#E5E5E5"> if we're on a Windows</font>

771
00:27:57,200 --> 00:28:03,260
machine<font color="#CCCCCC"> wso one in this</font><font color="#E5E5E5"> case and we're</font>

772
00:28:00,230 --> 00:28:05,930
gonna try to<font color="#E5E5E5"> mount the SMB share for</font><font color="#CCCCCC"> wso</font>

773
00:28:03,260 --> 00:28:07,490
<font color="#CCCCCC">to I can</font><font color="#E5E5E5"> just do</font><font color="#CCCCCC"> adder command</font><font color="#E5E5E5"> and all</font>

774
00:28:05,930 --> 00:28:10,430
of a sudden<font color="#CCCCCC"> I'm browsing the SMB share</font>

775
00:28:07,490 --> 00:28:12,380
it seems like<font color="#CCCCCC"> magic but under the hood</font>

776
00:28:10,430 --> 00:28:13,610
<font color="#E5E5E5">all those steps and those four bullet</font>

777
00:28:12,380 --> 00:28:15,380
points I just<font color="#E5E5E5"> mentioned</font><font color="#CCCCCC"> actually</font>

778
00:28:13,610 --> 00:28:17,600
happened and<font color="#E5E5E5"> they're</font><font color="#CCCCCC"> actually nicely</font>

779
00:28:15,380 --> 00:28:18,800
color-coded here in Wireshark so I'll

780
00:28:17,600 --> 00:28:21,379
<font color="#E5E5E5">walk through them real quick check on</font>

781
00:28:18,800 --> 00:28:24,050
<font color="#CCCCCC">hopefully let it sink in the first step</font>

782
00:28:21,380 --> 00:28:27,440
is I did a DNS lookup<font color="#CCCCCC"> I need to find out</font>

783
00:28:24,050 --> 00:28:29,810
where<font color="#CCCCCC"> wso 2 is so I do</font><font color="#E5E5E5"> a broad or a DNS</font>

784
00:28:27,440 --> 00:28:32,690
lookup<font color="#CCCCCC"> and</font><font color="#E5E5E5"> I identify where</font><font color="#CCCCCC"> wso 2 is and</font>

785
00:28:29,810 --> 00:28:34,370
<font color="#E5E5E5">that's the blue then I go to</font><font color="#CCCCCC"> wso 2 in</font>

786
00:28:32,690 --> 00:28:37,880
yellow and<font color="#CCCCCC"> I try</font><font color="#E5E5E5"> to set up an SMB</font>

787
00:28:34,370 --> 00:28:39,560
connection and<font color="#CCCCCC"> wso 2 responds to me and</font>

788
00:28:37,880 --> 00:28:41,510
says let's you need to<font color="#CCCCCC"> authenticate</font>

789
00:28:39,560 --> 00:28:44,629
yourself<font color="#CCCCCC"> let's do the Kerberos dance</font>

790
00:28:41,510 --> 00:28:46,760
we'll use Kerberos for that so then I

791
00:28:44,630 --> 00:28:48,830
get redirected to<font color="#CCCCCC"> the domain controller</font>

792
00:28:46,760 --> 00:28:50,540
and that's purple<font color="#E5E5E5"> and now I'm talking to</font>

793
00:28:48,830 --> 00:28:52,699
<font color="#E5E5E5">the domain controller over Kerberos and</font>

794
00:28:50,540 --> 00:28:54,860
<font color="#E5E5E5">I'll go to the first the authentication</font>

795
00:28:52,700 --> 00:28:56,990
<font color="#E5E5E5">service and that's the first four</font>

796
00:28:54,860 --> 00:28:58,459
packets here<font color="#E5E5E5"> I'm talking</font><font color="#CCCCCC"> to the</font>

797
00:28:56,990 --> 00:29:00,350
<font color="#E5E5E5">authentication service and I'm sending</font>

798
00:28:58,460 --> 00:29:02,240
them<font color="#E5E5E5"> my password and in return I'm</font>

799
00:29:00,350 --> 00:29:05,330
getting the ticket granting ticket<font color="#CCCCCC"> Allah</font>

800
00:29:02,240 --> 00:29:06,950
my single sign-on session cookie then

801
00:29:05,330 --> 00:29:08,570
the<font color="#E5E5E5"> last two here I go back to the</font>

802
00:29:06,950 --> 00:29:11,210
domain controller<font color="#E5E5E5"> and I say ok I've got</font>

803
00:29:08,570 --> 00:29:14,450
my single sign-on like TGT here I<font color="#E5E5E5"> need</font>

804
00:29:11,210 --> 00:29:16,970
<font color="#E5E5E5">to access SMB on</font><font color="#CCCCCC"> wso 2 and the domain</font>

805
00:29:14,450 --> 00:29:18,320
controller goes okay here's the TGS that

806
00:29:16,970 --> 00:29:20,780
has all the<font color="#CCCCCC"> information you need to</font><font color="#E5E5E5"> do</font>

807
00:29:18,320 --> 00:29:24,740
that<font color="#E5E5E5"> and then finally I get redirected</font>

808
00:29:20,780 --> 00:29:27,080
back to<font color="#CCCCCC"> wso 2 I present my</font><font color="#E5E5E5"> TGS and this</font>

809
00:29:24,740 --> 00:29:28,790
time the SMB session is successful and

810
00:29:27,080 --> 00:29:30,260
we<font color="#E5E5E5"> proceed to set up that entire session</font>

811
00:29:28,790 --> 00:29:31,430
and I start mounting<font color="#E5E5E5"> it so all those</font>

812
00:29:30,260 --> 00:29:32,690
steps happen<font color="#E5E5E5"> really quickly in</font>

813
00:29:31,430 --> 00:29:37,010
succession underneath the hood but they

814
00:29:32,690 --> 00:29:38,870
are happening every time and if we do a

815
00:29:37,010 --> 00:29:40,490
<font color="#E5E5E5">que list on Windows you can see the</font>

816
00:29:38,870 --> 00:29:42,439
tickets<font color="#E5E5E5"> that</font><font color="#CCCCCC"> are in</font><font color="#E5E5E5"> your ticket cache</font><font color="#CCCCCC"> I</font>

817
00:29:40,490 --> 00:29:44,200
suppose you<font color="#E5E5E5"> could use</font><font color="#CCCCCC"> movie cats too but</font>

818
00:29:42,440 --> 00:29:48,920
this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> the preferred</font><font color="#E5E5E5"> approach I suppose</font>

819
00:29:44,200 --> 00:29:50,330
<font color="#CCCCCC">and we can see exactly</font><font color="#E5E5E5"> the tickets that</font>

820
00:29:48,920 --> 00:29:51,890
<font color="#CCCCCC">we would</font><font color="#E5E5E5"> expect to see in that and</font><font color="#CCCCCC"> that</font>

821
00:29:50,330 --> 00:29:54,260
dance that<font color="#CCCCCC"> walkthrough</font>

822
00:29:51,890 --> 00:29:55,430
<font color="#E5E5E5">ticket number zero is the TGT</font><font color="#CCCCCC"> so we got</font>

823
00:29:54,260 --> 00:29:56,360
that<font color="#E5E5E5"> from the domain controller by</font>

824
00:29:55,430 --> 00:29:58,880
giving the domain controller our

825
00:29:56,360 --> 00:30:01,250
password<font color="#E5E5E5"> ticket number one is the</font>

826
00:29:58,880 --> 00:30:04,190
<font color="#CCCCCC">specific service ticket to access SMB on</font>

827
00:30:01,250 --> 00:30:07,100
<font color="#CCCCCC">wso - and that says it</font><font color="#E5E5E5"> right</font><font color="#CCCCCC"> here sips</font>

828
00:30:04,190 --> 00:30:09,020
which is the SMB service on<font color="#CCCCCC"> wso to win</font>

829
00:30:07,100 --> 00:30:11,750
seven and that's what we use<font color="#E5E5E5"> to</font><font color="#CCCCCC"> actually</font>

830
00:30:09,020 --> 00:30:12,770
set up<font color="#E5E5E5"> the SMB session now two things in</font>

831
00:30:11,750 --> 00:30:15,050
brutally important to<font color="#CCCCCC"> remember when it</font>

832
00:30:12,770 --> 00:30:17,540
<font color="#E5E5E5">comes to Kerberos one service</font><font color="#CCCCCC"> ticket</font>

833
00:30:15,050 --> 00:30:19,190
<font color="#CCCCCC">server</font><font color="#E5E5E5"> specific services not hosts so</font>

834
00:30:17,540 --> 00:30:21,139
they're only good for<font color="#CCCCCC"> a specific service</font>

835
00:30:19,190 --> 00:30:23,720
host combination<font color="#CCCCCC"> I can't use that to</font>

836
00:30:21,140 --> 00:30:27,350
<font color="#CCCCCC">access RDP</font><font color="#E5E5E5"> on</font><font color="#CCCCCC"> WS o</font><font color="#E5E5E5"> - and have to go</font>

837
00:30:23,720 --> 00:30:29,570
<font color="#E5E5E5">through the whole process</font><font color="#CCCCCC"> again</font><font color="#E5E5E5"> and this</font>

838
00:30:27,350 --> 00:30:31,669
<font color="#E5E5E5">is the big one Kerberos is an</font>

839
00:30:29,570 --> 00:30:33,200
authentication protocol it's not an

840
00:30:31,670 --> 00:30:36,260
authorization protocol it was not

841
00:30:33,200 --> 00:30:39,050
designed to<font color="#E5E5E5"> be that</font><font color="#CCCCCC"> way it only</font>

842
00:30:36,260 --> 00:30:40,610
<font color="#E5E5E5">validates who you are not whether</font><font color="#CCCCCC"> or</font><font color="#E5E5E5"> not</font>

843
00:30:39,050 --> 00:30:43,040
<font color="#E5E5E5">you should</font><font color="#CCCCCC"> have access</font><font color="#E5E5E5"> to what you're</font>

844
00:30:40,610 --> 00:30:44,600
<font color="#E5E5E5">requesting so you will actually</font><font color="#CCCCCC"> always</font>

845
00:30:43,040 --> 00:30:46,550
get a service<font color="#CCCCCC"> ticket from</font><font color="#E5E5E5"> the domain</font>

846
00:30:44,600 --> 00:30:48,320
controller if you want it<font color="#E5E5E5"> even</font><font color="#CCCCCC"> if you</font>

847
00:30:46,550 --> 00:30:49,580
shouldn't be able<font color="#E5E5E5"> to access that</font><font color="#CCCCCC"> service</font>

848
00:30:48,320 --> 00:30:52,460
like you can usually<font color="#CCCCCC"> just check it out</font>

849
00:30:49,580 --> 00:30:55,070
<font color="#CCCCCC">and it's up to the consumer</font><font color="#E5E5E5"> in this case</font>

850
00:30:52,460 --> 00:30:56,600
servo<font color="#CCCCCC"> 1 to make</font><font color="#E5E5E5"> the decision to whether</font>

851
00:30:55,070 --> 00:31:02,149
or not<font color="#E5E5E5"> to</font><font color="#CCCCCC"> let you in with that service</font>

852
00:30:56,600 --> 00:31:04,070
ticket how does<font color="#E5E5E5"> it do that well</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> was</font>

853
00:31:02,150 --> 00:31:07,460
a Microsoft<font color="#CCCCCC"> addition to Kerberos to kind</font>

854
00:31:04,070 --> 00:31:09,470
of<font color="#CCCCCC"> Bolton authorization and they did it</font>

855
00:31:07,460 --> 00:31:11,210
by attaching a privileged<font color="#CCCCCC"> attribute</font>

856
00:31:09,470 --> 00:31:13,490
certificate to every single ticket<font color="#E5E5E5"> in</font>

857
00:31:11,210 --> 00:31:15,980
Kerberos and<font color="#CCCCCC"> this is</font><font color="#E5E5E5"> basically like an</font>

858
00:31:13,490 --> 00:31:18,410
encrypted blob<font color="#E5E5E5"> that contains among other</font>

859
00:31:15,980 --> 00:31:20,990
<font color="#CCCCCC">things who you are and all</font><font color="#E5E5E5"> the groups</font>

860
00:31:18,410 --> 00:31:22,580
you belong to so<font color="#CCCCCC"> anytime you</font><font color="#E5E5E5"> actually</font>

861
00:31:20,990 --> 00:31:24,710
present your<font color="#E5E5E5"> ticket someone can decrypt</font>

862
00:31:22,580 --> 00:31:26,210
the ticket and look up who you are and

863
00:31:24,710 --> 00:31:28,760
<font color="#E5E5E5">then make</font><font color="#CCCCCC"> the decision - and</font><font color="#E5E5E5"> whether or</font>

864
00:31:26,210 --> 00:31:30,650
<font color="#E5E5E5">not to let you in and I think this is</font>

865
00:31:28,760 --> 00:31:32,810
sort<font color="#E5E5E5"> of the source of a lot</font><font color="#CCCCCC"> of abuse</font>

866
00:31:30,650 --> 00:31:34,310
<font color="#E5E5E5">when it comes to Kerberos is that this</font>

867
00:31:32,810 --> 00:31:36,050
pack was added to the tickets and

868
00:31:34,310 --> 00:31:37,940
authorization and authentication kind of

869
00:31:36,050 --> 00:31:44,830
got mixed<font color="#E5E5E5"> up and we'll talk a little bit</font>

870
00:31:37,940 --> 00:31:47,120
<font color="#CCCCCC">about forging</font><font color="#E5E5E5"> these by the end cool so</font>

871
00:31:44,830 --> 00:31:49,310
everything that<font color="#E5E5E5"> I've</font><font color="#CCCCCC"> done previously</font><font color="#E5E5E5"> the</font>

872
00:31:47,120 --> 00:31:50,959
LDAP search commands<font color="#E5E5E5"> the</font><font color="#CCCCCC"> women exec</font><font color="#E5E5E5"> win</font>

873
00:31:49,310 --> 00:31:53,570
the<font color="#E5E5E5"> exec example I haven't actually</font><font color="#CCCCCC"> used</font>

874
00:31:50,960 --> 00:31:55,160
Kerberos yet<font color="#CCCCCC"> all of that's been</font><font color="#E5E5E5"> doing a</font>

875
00:31:53,570 --> 00:31:57,139
different type<font color="#CCCCCC"> of authentication called</font>

876
00:31:55,160 --> 00:32:00,020
ntlm authentication which is a challenge

877
00:31:57,140 --> 00:32:02,630
<font color="#E5E5E5">response using an NT hash of the users</font>

878
00:32:00,020 --> 00:32:04,850
password<font color="#E5E5E5"> but that doesn't mean I can't</font>

879
00:32:02,630 --> 00:32:06,529
<font color="#CCCCCC">and this is where the fun stuff comes in</font>

880
00:32:04,850 --> 00:32:08,240
because<font color="#E5E5E5"> Linux can totally speak Kerberos</font>

881
00:32:06,529 --> 00:32:10,130
there's plenty of Kerberos clients and

882
00:32:08,240 --> 00:32:12,950
the<font color="#CCCCCC"> Windows implementation of Kerberos</font>

883
00:32:10,130 --> 00:32:14,960
is compliant<font color="#CCCCCC"> so I can use any Kerberos</font>

884
00:32:12,950 --> 00:32:16,190
client on<font color="#E5E5E5"> Linux to talk with the domain</font>

885
00:32:14,960 --> 00:32:19,039
controller<font color="#CCCCCC"> and do the Kerberos</font>

886
00:32:16,190 --> 00:32:20,809
authentication dance so to set<font color="#E5E5E5"> that up</font>

887
00:32:19,039 --> 00:32:22,220
<font color="#CCCCCC">and</font><font color="#E5E5E5"> this is something I love doing when</font>

888
00:32:20,809 --> 00:32:23,809
I'm on a pen test or just<font color="#CCCCCC"> have a Linux</font>

889
00:32:22,220 --> 00:32:25,279
<font color="#E5E5E5">machine</font><font color="#CCCCCC"> is I would just</font><font color="#E5E5E5"> install a</font>

890
00:32:23,809 --> 00:32:28,639
Kerberos client and set up the<font color="#E5E5E5"> the</font>

891
00:32:25,279 --> 00:32:30,980
<font color="#E5E5E5">configuration as follows so a popular</font>

892
00:32:28,639 --> 00:32:32,658
one<font color="#E5E5E5"> is Heimdall so on Linux if debian</font>

893
00:32:30,980 --> 00:32:34,880
for example app get install<font color="#E5E5E5"> Heimdall</font>

894
00:32:32,659 --> 00:32:37,340
clients the other information<font color="#CCCCCC"> we need is</font>

895
00:32:34,880 --> 00:32:41,210
the<font color="#CCCCCC"> configuration information</font><font color="#E5E5E5"> and then</font>

896
00:32:37,340 --> 00:32:44,449
we need<font color="#CCCCCC"> DNS</font><font color="#E5E5E5"> and we need time this is</font>

897
00:32:41,210 --> 00:32:46,220
what it looks like<font color="#CCCCCC"> on Linux</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> setup</font>

898
00:32:44,450 --> 00:32:48,080
<font color="#CCCCCC">like a really</font><font color="#E5E5E5"> simple Active Directory</font>

899
00:32:46,220 --> 00:32:50,990
domain as a Kerberos realm we have to

900
00:32:48,080 --> 00:32:53,149
modify<font color="#CCCCCC"> @ck rb5 conf</font><font color="#E5E5E5"> and we have to</font>

901
00:32:50,990 --> 00:32:55,100
define<font color="#E5E5E5"> the Kerberos realm</font><font color="#CCCCCC"> in Windows</font>

902
00:32:53,149 --> 00:32:58,070
<font color="#E5E5E5">world is pretty much always the fully</font>

903
00:32:55,100 --> 00:32:59,360
qualified<font color="#CCCCCC"> domain name</font><font color="#E5E5E5"> just</font><font color="#CCCCCC"> uppercase and</font>

904
00:32:58,070 --> 00:33:03,320
then we have to point<font color="#E5E5E5"> it</font><font color="#CCCCCC"> to where the</font>

905
00:32:59,360 --> 00:33:04,639
KDC the admin server and that's it and

906
00:33:03,320 --> 00:33:06,799
<font color="#E5E5E5">then where the default domain is this is</font>

907
00:33:04,639 --> 00:33:09,229
the minimum you<font color="#E5E5E5"> need and remember that</font>

908
00:33:06,799 --> 00:33:10,970
none of<font color="#CCCCCC"> this information</font><font color="#E5E5E5"> is secret like</font>

909
00:33:09,230 --> 00:33:12,529
it has<font color="#E5E5E5"> to be broadcast it has to be</font>

910
00:33:10,970 --> 00:33:14,480
advertised and<font color="#E5E5E5"> we can always look that</font>

911
00:33:12,529 --> 00:33:19,460
<font color="#E5E5E5">up via DNS server records to set up our</font>

912
00:33:14,480 --> 00:33:21,759
client Kerberos also so tightly<font color="#CCCCCC"> is</font>

913
00:33:19,460 --> 00:33:24,679
coupled with DNS that<font color="#E5E5E5"> DNS has to work</font>

914
00:33:21,759 --> 00:33:27,289
<font color="#E5E5E5">the easiest way if you're doing</font><font color="#CCCCCC"> this is</font>

915
00:33:24,679 --> 00:33:28,850
to just<font color="#E5E5E5"> point your local name server to</font>

916
00:33:27,289 --> 00:33:31,309
the<font color="#E5E5E5"> domain controller and let</font><font color="#CCCCCC"> the domain</font>

917
00:33:28,850 --> 00:33:33,740
controller handle all<font color="#CCCCCC"> of all of DNS</font>

918
00:33:31,309 --> 00:33:35,299
resolution<font color="#CCCCCC"> if it's unable to do that or</font>

919
00:33:33,740 --> 00:33:37,850
<font color="#CCCCCC">just point</font><font color="#E5E5E5"> it to whatever name server is</font>

920
00:33:35,299 --> 00:33:40,549
<font color="#CCCCCC">being in use in that</font><font color="#E5E5E5"> domain and then</font>

921
00:33:37,850 --> 00:33:42,289
time also<font color="#E5E5E5"> has to be</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> sync</font><font color="#CCCCCC"> and so the</font>

922
00:33:40,549 --> 00:33:43,908
easiest way from<font color="#E5E5E5"> Linux is to actually</font>

923
00:33:42,289 --> 00:33:45,408
sync your local time with the domain

924
00:33:43,909 --> 00:33:51,080
controllers time you can do<font color="#E5E5E5"> that with</font>

925
00:33:45,409 --> 00:33:52,279
<font color="#CCCCCC">the</font><font color="#E5E5E5"> our date utility so if you have all</font>

926
00:33:51,080 --> 00:33:54,080
that information<font color="#E5E5E5"> and you have</font><font color="#CCCCCC"> it</font>

927
00:33:52,279 --> 00:33:55,789
configure and you have it set<font color="#CCCCCC"> up</font><font color="#E5E5E5"> you</font>

928
00:33:54,080 --> 00:33:58,189
should be<font color="#CCCCCC"> able to</font><font color="#E5E5E5"> go ahead and run</font><font color="#CCCCCC"> kay</font>

929
00:33:55,789 --> 00:34:00,379
in it<font color="#E5E5E5"> which is the</font><font color="#CCCCCC"> utility to kick off</font>

930
00:33:58,190 --> 00:34:02,659
and<font color="#E5E5E5"> get</font><font color="#CCCCCC"> checkout a TGT from the</font>

931
00:34:00,379 --> 00:34:04,850
authentication<font color="#E5E5E5"> service it'll prompt you</font>

932
00:34:02,659 --> 00:34:05,960
for a password<font color="#E5E5E5"> and if you Duke a list on</font>

933
00:34:04,850 --> 00:34:07,908
Linux<font color="#E5E5E5"> it'll show you your</font><font color="#CCCCCC"> current</font>

934
00:34:05,960 --> 00:34:09,168
tickets and so if it's all configured

935
00:34:07,909 --> 00:34:11,839
well it should work<font color="#E5E5E5"> and it looks like</font>

936
00:34:09,168 --> 00:34:14,418
<font color="#E5E5E5">this we can enter</font><font color="#CCCCCC"> T hoffman's password</font>

937
00:34:11,839 --> 00:34:16,699
and<font color="#CCCCCC"> Kay</font><font color="#E5E5E5"> list will</font><font color="#CCCCCC"> show that we actually</font>

938
00:34:14,418 --> 00:34:18,529
<font color="#CCCCCC">have created a ticket cache file</font><font color="#E5E5E5"> it's in</font>

939
00:34:16,699 --> 00:34:20,928
the temp directory<font color="#E5E5E5"> our principle</font>

940
00:34:18,530 --> 00:34:24,200
<font color="#E5E5E5">as who we</font><font color="#CCCCCC"> expect it to be</font><font color="#E5E5E5"> and we have a</font>

941
00:34:20,929 --> 00:34:27,460
<font color="#E5E5E5">curb TGT that expires in shoot I forget</font>

942
00:34:24,199 --> 00:34:27,460
what the default<font color="#E5E5E5"> is it's less than a day</font>

943
00:34:28,540 --> 00:34:33,380
when we have that we're off to the<font color="#E5E5E5"> races</font>

944
00:34:30,800 --> 00:34:34,909
<font color="#CCCCCC">so now</font><font color="#E5E5E5"> any tool</font><font color="#CCCCCC"> that supports</font><font color="#E5E5E5"> Kerberos</font>

945
00:34:33,380 --> 00:34:36,650
authentication can<font color="#E5E5E5"> be used with</font><font color="#CCCCCC"> that</font>

946
00:34:34,909 --> 00:34:38,780
ticket cache file or that<font color="#E5E5E5"> C cache file</font>

947
00:34:36,650 --> 00:34:40,100
<font color="#E5E5E5">and there's actually a lot that have it</font>

948
00:34:38,780 --> 00:34:42,919
baked in if you<font color="#E5E5E5"> just look in the man</font>

949
00:34:40,100 --> 00:34:45,199
<font color="#CCCCCC">pages or the</font><font color="#E5E5E5"> command line flags</font><font color="#CCCCCC"> if you</font>

950
00:34:42,918 --> 00:34:47,900
see a<font color="#E5E5E5"> reference on a particular tool to</font>

951
00:34:45,199 --> 00:34:50,210
gssapi<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> pretty much Kerberos</font>

952
00:34:47,900 --> 00:34:52,730
authentication gssapi<font color="#CCCCCC"> is the auth</font>

953
00:34:50,210 --> 00:34:54,440
mechanism that Kerberos<font color="#CCCCCC"> five</font><font color="#E5E5E5"> uses and so</font>

954
00:34:52,730 --> 00:34:56,300
you can use gssapi or if you see a

955
00:34:54,440 --> 00:34:59,150
<font color="#E5E5E5">reference to it in a man page try using</font>

956
00:34:56,300 --> 00:35:00,530
<font color="#CCCCCC">it</font><font color="#E5E5E5"> with Kerberos and most tools will</font>

957
00:34:59,150 --> 00:35:03,620
require the well-known environment

958
00:35:00,530 --> 00:35:05,420
variable here<font color="#CCCCCC"> krb v CC name</font><font color="#E5E5E5"> so if that's</font>

959
00:35:03,620 --> 00:35:10,700
<font color="#E5E5E5">not set you have to export that to</font><font color="#CCCCCC"> your</font>

960
00:35:05,420 --> 00:35:12,980
<font color="#E5E5E5">actual C cache file so here's some quick</font>

961
00:35:10,700 --> 00:35:14,600
<font color="#E5E5E5">examples</font><font color="#CCCCCC"> like the Samba utilities</font><font color="#E5E5E5"> work</font>

962
00:35:12,980 --> 00:35:16,070
great with Kerberos if I have it

963
00:35:14,600 --> 00:35:18,049
<font color="#CCCCCC">configured and I've already</font><font color="#E5E5E5"> gone and</font>

964
00:35:16,070 --> 00:35:21,020
done<font color="#E5E5E5"> a</font><font color="#CCCCCC"> K in it and checked out a TGT</font><font color="#E5E5E5"> I</font>

965
00:35:18,050 --> 00:35:24,740
can use SMB client with - -<font color="#E5E5E5"> Kerberos and</font>

966
00:35:21,020 --> 00:35:28,520
browse<font color="#CCCCCC"> windows shares using Kerberos</font>

967
00:35:24,740 --> 00:35:30,979
authentication<font color="#E5E5E5"> our PC client</font><font color="#CCCCCC"> as well</font>

968
00:35:28,520 --> 00:35:33,830
<font color="#E5E5E5">totally easily supports Kerberos with -</font>

969
00:35:30,980 --> 00:35:35,300
<font color="#CCCCCC">K and notice in</font><font color="#E5E5E5"> both these cases I don't</font>

970
00:35:33,830 --> 00:35:36,680
need to provide even<font color="#E5E5E5"> a username because</font>

971
00:35:35,300 --> 00:35:41,030
it's reading all<font color="#CCCCCC"> that information</font><font color="#E5E5E5"> from</font>

972
00:35:36,680 --> 00:35:42,890
the<font color="#E5E5E5"> C cache file and LDAP</font><font color="#CCCCCC"> search</font><font color="#E5E5E5"> all</font>

973
00:35:41,030 --> 00:35:45,140
those LDAP search fun queries we were

974
00:35:42,890 --> 00:35:47,180
doing I was using ntlm off<font color="#E5E5E5"> I can do it</font>

975
00:35:45,140 --> 00:35:50,299
in Kerberos - as long as Kerberos<font color="#CCCCCC"> is</font>

976
00:35:47,180 --> 00:35:52,370
configured<font color="#E5E5E5"> -</font><font color="#CCCCCC"> capital</font><font color="#E5E5E5"> wide gssapi will</font>

977
00:35:50,300 --> 00:35:55,580
tell LDAP search to do authentication

978
00:35:52,370 --> 00:35:56,779
<font color="#E5E5E5">over Kerberos instead of ntlm and then I</font>

979
00:35:55,580 --> 00:36:02,690
don't<font color="#E5E5E5"> need to provide a</font><font color="#CCCCCC"> username or</font><font color="#E5E5E5"> a</font>

980
00:35:56,780 --> 00:36:03,950
<font color="#E5E5E5">password I can use tickets and just a</font>

981
00:36:02,690 --> 00:36:05,810
sanity check to make sure it's all

982
00:36:03,950 --> 00:36:07,250
<font color="#CCCCCC">working like we</font><font color="#E5E5E5"> would</font><font color="#CCCCCC"> expect it to</font><font color="#E5E5E5"> you</font>

983
00:36:05,810 --> 00:36:08,660
can<font color="#CCCCCC"> always go back</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> look at</font><font color="#E5E5E5"> K list</font>

984
00:36:07,250 --> 00:36:10,790
and see the service tickets that you've

985
00:36:08,660 --> 00:36:13,040
been checking<font color="#E5E5E5"> out so we can see in this</font>

986
00:36:10,790 --> 00:36:14,990
case we<font color="#E5E5E5"> started with the TGT</font><font color="#CCCCCC"> and then I</font>

987
00:36:13,040 --> 00:36:17,540
ran in LDAP search query so as expected

988
00:36:14,990 --> 00:36:20,029
<font color="#CCCCCC">I checked out a service ticket for LDAP</font>

989
00:36:17,540 --> 00:36:22,070
on the domain<font color="#E5E5E5"> controller</font><font color="#CCCCCC"> and then I did</font>

990
00:36:20,030 --> 00:36:23,660
an SMB mount<font color="#E5E5E5"> and so as expected I</font>

991
00:36:22,070 --> 00:36:26,120
checked out a service<font color="#CCCCCC"> ticket for sifts</font>

992
00:36:23,660 --> 00:36:29,920
on<font color="#CCCCCC"> wso 1 1 7</font><font color="#E5E5E5"> so it</font><font color="#CCCCCC"> keeps track of</font><font color="#E5E5E5"> your</font>

993
00:36:26,120 --> 00:36:29,920
service tickets in the same<font color="#CCCCCC"> C cache file</font>

994
00:36:31,070 --> 00:36:34,760
and all the Kerberos<font color="#E5E5E5"> scripts are sorry</font>

995
00:36:32,990 --> 00:36:36,890
<font color="#CCCCCC">all the impacted scripts</font><font color="#E5E5E5"> also fully</font>

996
00:36:34,760 --> 00:36:39,260
support Kerberos so if you have a<font color="#E5E5E5"> C</font>

997
00:36:36,890 --> 00:36:43,250
cache file already you can give a -<font color="#CCCCCC"> k -</font>

998
00:36:39,260 --> 00:36:44,900
no pass<font color="#CCCCCC"> or</font><font color="#E5E5E5"> you can just do -</font><font color="#CCCCCC"> k and give</font>

999
00:36:43,250 --> 00:36:49,160
it a<font color="#CCCCCC"> password and</font><font color="#E5E5E5"> the impacted script</font>

1000
00:36:44,900 --> 00:36:52,010
will actually get a<font color="#E5E5E5"> TGT for you so these</font>

1001
00:36:49,160 --> 00:36:54,740
are<font color="#E5E5E5"> just two quick examples PS exec or</font>

1002
00:36:52,010 --> 00:36:57,350
<font color="#E5E5E5">doe</font><font color="#CCCCCC"> or women exec just using it with</font><font color="#E5E5E5"> my</font>

1003
00:36:54,740 --> 00:36:59,000
<font color="#CCCCCC">existing C cache file</font><font color="#E5E5E5"> I can execute code</font>

1004
00:36:57,350 --> 00:37:03,560
and do our<font color="#E5E5E5"> PC calls and all that fun</font>

1005
00:36:59,000 --> 00:37:06,650
<font color="#CCCCCC">stuff</font><font color="#E5E5E5"> over Kerberos from Linux and</font>

1006
00:37:03,560 --> 00:37:10,570
that's<font color="#CCCCCC"> useful because</font><font color="#E5E5E5"> occasionally you</font>

1007
00:37:06,650 --> 00:37:10,570
might<font color="#E5E5E5"> run</font><font color="#CCCCCC"> into a situation</font><font color="#E5E5E5"> where ntlm</font>

1008
00:37:10,990 --> 00:37:15,560
authen is a<font color="#CCCCCC"> ssin that's fully been able</font>

1009
00:37:13,490 --> 00:37:17,899
to<font color="#E5E5E5"> get rid of ntlm but if there's a</font>

1010
00:37:15,560 --> 00:37:20,420
servers or like an<font color="#CCCCCC"> O you that has ntlm</font>

1011
00:37:17,900 --> 00:37:22,780
off disabled<font color="#CCCCCC"> a lot of your traditional</font>

1012
00:37:20,420 --> 00:37:24,980
pen testing<font color="#E5E5E5"> tools just fail</font><font color="#CCCCCC"> to work</font>

1013
00:37:22,780 --> 00:37:26,090
<font color="#CCCCCC">Metasploit crack map exact a lot of</font>

1014
00:37:24,980 --> 00:37:27,560
these<font color="#E5E5E5"> tools are based on ntlm</font>

1015
00:37:26,090 --> 00:37:30,170
authentication<font color="#E5E5E5"> and you can't</font><font color="#CCCCCC"> really do</font>

1016
00:37:27,560 --> 00:37:32,480
anything<font color="#CCCCCC"> with them but remember if you</font>

1017
00:37:30,170 --> 00:37:34,130
have a<font color="#CCCCCC"> password you can always do</font>

1018
00:37:32,480 --> 00:37:35,420
Kerberos authentication<font color="#E5E5E5"> so as long as</font>

1019
00:37:34,130 --> 00:37:36,770
<font color="#CCCCCC">you have a password</font><font color="#E5E5E5"> you can just drop</font>

1020
00:37:35,420 --> 00:37:38,750
<font color="#E5E5E5">the Kerberos authentication and get</font>

1021
00:37:36,770 --> 00:37:41,180
around<font color="#CCCCCC"> this and that's what</font><font color="#E5E5E5"> this looks</font>

1022
00:37:38,750 --> 00:37:42,890
<font color="#E5E5E5">like here if you try this is me trying</font>

1023
00:37:41,180 --> 00:37:45,560
<font color="#E5E5E5">to</font><font color="#CCCCCC"> run with me exec against a machine</font>

1024
00:37:42,890 --> 00:37:56,480
<font color="#CCCCCC">and I get a SMB session error status</font><font color="#E5E5E5"> not</font>

1025
00:37:45,560 --> 00:38:03,080
supported that means ntlm authentication

1026
00:37:56,480 --> 00:38:05,330
<font color="#E5E5E5">no problems there</font><font color="#CCCCCC"> I land my</font><font color="#E5E5E5"> shell</font><font color="#CCCCCC"> all</font>

1027
00:38:03,080 --> 00:38:11,180
<font color="#CCCCCC">right kind</font><font color="#E5E5E5"> of brief detour now to</font>

1028
00:38:05,330 --> 00:38:12,680
another<font color="#E5E5E5"> pen test technique sometimes</font><font color="#CCCCCC"> if</font>

1029
00:38:11,180 --> 00:38:14,569
I'm on an<font color="#E5E5E5"> internal network and I can't</font>

1030
00:38:12,680 --> 00:38:16,060
get a foothold nothing's working<font color="#CCCCCC"> I have</font>

1031
00:38:14,570 --> 00:38:18,470
to resort<font color="#CCCCCC"> to some password guessing</font>

1032
00:38:16,060 --> 00:38:20,360
<font color="#E5E5E5">because someone</font><font color="#CCCCCC"> somewhere is always</font>

1033
00:38:18,470 --> 00:38:23,810
using<font color="#E5E5E5"> password</font><font color="#CCCCCC"> one two three</font><font color="#E5E5E5"> or company</font>

1034
00:38:20,360 --> 00:38:25,100
one two three so<font color="#E5E5E5"> brute forcing passwords</font>

1035
00:38:23,810 --> 00:38:28,009
<font color="#E5E5E5">in Active Directory is generally pretty</font>

1036
00:38:25,100 --> 00:38:30,230
tough it's most domains on a<font color="#CCCCCC"> lock out</font>

1037
00:38:28,010 --> 00:38:32,240
policy it's pretty noisy there's lots of

1038
00:38:30,230 --> 00:38:36,230
security events and in my<font color="#CCCCCC"> opinion it's</font>

1039
00:38:32,240 --> 00:38:38,000
also pretty slow<font color="#CCCCCC"> for example like SMB</font>

1040
00:38:36,230 --> 00:38:39,290
sets up an entire connection<font color="#E5E5E5"> and tears</font>

1041
00:38:38,000 --> 00:38:42,710
it<font color="#CCCCCC"> down every time</font><font color="#E5E5E5"> you try</font><font color="#CCCCCC"> to test</font><font color="#E5E5E5"> a</font>

1042
00:38:39,290 --> 00:38:44,240
password and as attackers one technique

1043
00:38:42,710 --> 00:38:44,839
we like to use a lot<font color="#CCCCCC"> more than password</font>

1044
00:38:44,240 --> 00:38:46,459
<font color="#E5E5E5">brute force</font>

1045
00:38:44,839 --> 00:38:47,989
his password<font color="#E5E5E5"> sprained right which is</font>

1046
00:38:46,460 --> 00:38:49,940
<font color="#E5E5E5">where you just do a horizontal spray of</font>

1047
00:38:47,989 --> 00:38:54,289
a single or one or two<font color="#E5E5E5"> common passwords</font>

1048
00:38:49,940 --> 00:38:56,749
against a big list<font color="#E5E5E5"> of users</font><font color="#CCCCCC"> like I</font><font color="#E5E5E5"> said</font>

1049
00:38:54,289 --> 00:38:58,640
it's noisy<font color="#CCCCCC"> all of</font><font color="#E5E5E5"> this traffic here in</font>

1050
00:38:56,749 --> 00:39:00,769
Wireshark is<font color="#E5E5E5"> the test one password if I</font>

1051
00:38:58,640 --> 00:39:02,538
tried to<font color="#E5E5E5"> do it over SMB so there's lots</font>

1052
00:39:00,769 --> 00:39:08,149
of TCP traffic that's generated and

1053
00:39:02,539 --> 00:39:09,589
there's<font color="#E5E5E5"> tons of logs and anyone should</font>

1054
00:39:08,150 --> 00:39:12,259
probably<font color="#CCCCCC"> be familiar</font><font color="#E5E5E5"> right with the big</font>

1055
00:39:09,589 --> 00:39:14,359
event<font color="#CCCCCC"> ID for</font><font color="#E5E5E5"> six to five which</font><font color="#CCCCCC"> is an</font>

1056
00:39:12,259 --> 00:39:16,130
account<font color="#E5E5E5"> failed to log on so if you start</font>

1057
00:39:14,359 --> 00:39:17,900
seeing<font color="#CCCCCC"> your sim blow up with tons</font><font color="#E5E5E5"> of</font>

1058
00:39:16,130 --> 00:39:21,349
<font color="#E5E5E5">these event IDs someone's doing</font>

1059
00:39:17,900 --> 00:39:22,849
<font color="#CCCCCC">something pretty bad so I started</font>

1060
00:39:21,349 --> 00:39:24,859
<font color="#CCCCCC">thinking about like what other ways can</font>

1061
00:39:22,849 --> 00:39:29,569
I do password guessing<font color="#E5E5E5"> on an internal</font>

1062
00:39:24,859 --> 00:39:30,950
Windows domain<font color="#CCCCCC"> Network LDAP binds was</font>

1063
00:39:29,569 --> 00:39:33,200
interesting it<font color="#E5E5E5"> was actually quite a bit</font>

1064
00:39:30,950 --> 00:39:36,259
faster<font color="#CCCCCC"> but</font><font color="#E5E5E5"> it still generated a bunch of</font>

1065
00:39:33,200 --> 00:39:38,989
<font color="#CCCCCC">four six to five events but I had the</font>

1066
00:39:36,259 --> 00:39:40,609
<font color="#E5E5E5">question well what</font><font color="#CCCCCC"> happens when I do</font>

1067
00:39:38,989 --> 00:39:42,469
<font color="#E5E5E5">this when</font><font color="#CCCCCC"> I do a</font><font color="#E5E5E5"> que in it with a</font>

1068
00:39:40,609 --> 00:39:44,839
Kerberos client and I type in<font color="#E5E5E5"> a bad</font>

1069
00:39:42,469 --> 00:39:49,400
password and it fails<font color="#E5E5E5"> and says password</font>

1070
00:39:44,839 --> 00:39:52,460
incorrect this<font color="#E5E5E5"> is what happens to UDP</font>

1071
00:39:49,400 --> 00:39:54,529
frames<font color="#E5E5E5"> I literally send one UDP frame to</font>

1072
00:39:52,460 --> 00:39:55,969
the domain controller with my<font color="#E5E5E5"> password</font>

1073
00:39:54,529 --> 00:39:57,799
essentially it's an encrypted nonce<font color="#E5E5E5"> and</font>

1074
00:39:55,969 --> 00:40:00,319
the domain controller responds with like

1075
00:39:57,799 --> 00:40:01,849
a success or a failure<font color="#CCCCCC"> so only</font><font color="#E5E5E5"> two UDP</font>

1076
00:40:00,319 --> 00:40:03,979
frames<font color="#CCCCCC"> to check a password is pretty</font>

1077
00:40:01,849 --> 00:40:07,190
efficient<font color="#E5E5E5"> and pretty quick</font><font color="#CCCCCC"> so I started</font>

1078
00:40:03,979 --> 00:40:08,569
<font color="#CCCCCC">thinking</font><font color="#E5E5E5"> about this and</font><font color="#CCCCCC"> decided I wanted</font>

1079
00:40:07,190 --> 00:40:12,019
<font color="#E5E5E5">to try to write the fastest</font><font color="#CCCCCC"> brute-force</font>

1080
00:40:08,569 --> 00:40:14,420
or I could so I'm happy to announce and

1081
00:40:12,019 --> 00:40:17,919
release<font color="#E5E5E5"> I just made the github public a</font>

1082
00:40:14,420 --> 00:40:21,739
new tool that<font color="#E5E5E5"> I wrote</font><font color="#CCCCCC"> called curb root</font>

1083
00:40:17,920 --> 00:40:23,660
and curb<font color="#E5E5E5"> root is my first go project</font>

1084
00:40:21,739 --> 00:40:25,309
<font color="#CCCCCC">it's written entirely in golang which</font>

1085
00:40:23,660 --> 00:40:27,859
has the<font color="#CCCCCC"> advantage of being</font><font color="#E5E5E5"> completely</font>

1086
00:40:25,309 --> 00:40:29,539
cross-platform across architecture so

1087
00:40:27,859 --> 00:40:31,279
anywhere you<font color="#E5E5E5"> land you can compile this</font>

1088
00:40:29,539 --> 00:40:33,859
binary<font color="#E5E5E5"> and run it even if we</font><font color="#CCCCCC"> round like</font>

1089
00:40:31,279 --> 00:40:35,539
a PowerPC or something like<font color="#E5E5E5"> that</font>

1090
00:40:33,859 --> 00:40:38,029
<font color="#E5E5E5">it's multi-threaded and takes takes</font>

1091
00:40:35,539 --> 00:40:39,739
advantage of gos concurrency<font color="#E5E5E5"> so combined</font>

1092
00:40:38,029 --> 00:40:42,440
with small UDP frames this thing is

1093
00:40:39,739 --> 00:40:44,869
<font color="#E5E5E5">insanely fast it can auto look up all</font>

1094
00:40:42,440 --> 00:40:46,190
the KDC information via<font color="#CCCCCC"> DNS and it has</font>

1095
00:40:44,869 --> 00:40:48,109
three<font color="#CCCCCC"> main functionalities for now we</font>

1096
00:40:46,190 --> 00:40:50,420
can enumerate<font color="#E5E5E5"> valid accounts just by</font>

1097
00:40:48,109 --> 00:40:52,640
guessing<font color="#E5E5E5"> user names we can do a password</font>

1098
00:40:50,420 --> 00:40:54,349
<font color="#E5E5E5">spray against a list of user names or we</font>

1099
00:40:52,640 --> 00:40:56,989
can brute force a single<font color="#CCCCCC"> user with a</font>

1100
00:40:54,349 --> 00:40:58,220
huge<font color="#E5E5E5"> list of passwords and my binaries</font>

1101
00:40:56,989 --> 00:40:59,900
I'm a

1102
00:40:58,220 --> 00:41:01,879
piling binaries for<font color="#E5E5E5"> common platform and</font>

1103
00:40:59,900 --> 00:41:03,020
architecture<font color="#CCCCCC"> windows linux and mac</font><font color="#E5E5E5"> and</font>

1104
00:41:01,880 --> 00:41:05,290
you can always<font color="#E5E5E5"> download the latest</font>

1105
00:41:03,020 --> 00:41:09,230
binaries directly<font color="#E5E5E5"> from github releases</font>

1106
00:41:05,290 --> 00:41:10,849
so demo gods hopefully are working and

1107
00:41:09,230 --> 00:41:19,700
<font color="#CCCCCC">i'm gonna try</font><font color="#E5E5E5"> to demo</font><font color="#CCCCCC"> curb root real</font>

1108
00:41:10,849 --> 00:41:22,700
quick can<font color="#CCCCCC"> you guys read</font><font color="#E5E5E5"> this okay so I'm</font>

1109
00:41:19,700 --> 00:41:26,598
on a<font color="#E5E5E5"> Linux machine here and I have the</font>

1110
00:41:22,700 --> 00:41:28,509
curb<font color="#CCCCCC"> root binary it's curb root</font><font color="#E5E5E5"> Linux</font>

1111
00:41:26,599 --> 00:41:30,440
<font color="#CCCCCC">amd64</font>

1112
00:41:28,510 --> 00:41:32,420
<font color="#CCCCCC">there's a couple</font><font color="#E5E5E5"> things I want to try</font>

1113
00:41:30,440 --> 00:41:35,390
first let's say I have a list of

1114
00:41:32,420 --> 00:41:37,490
<font color="#E5E5E5">possible</font><font color="#CCCCCC"> usernames that I've</font>

1115
00:41:35,390 --> 00:41:39,049
<font color="#E5E5E5">consolidated from LinkedIn or dumps or</font>

1116
00:41:37,490 --> 00:41:39,439
something like that<font color="#E5E5E5"> I've got</font><font color="#CCCCCC"> like 10,000</font>

1117
00:41:39,050 --> 00:41:43,270
of them

1118
00:41:39,440 --> 00:41:47,300
if I run<font color="#E5E5E5"> curb</font><font color="#CCCCCC"> root and do</font><font color="#E5E5E5"> user enum</font><font color="#CCCCCC"> I</font>

1119
00:41:43,270 --> 00:41:49,820
just give it<font color="#CCCCCC"> the domain</font><font color="#E5E5E5"> and then I give</font>

1120
00:41:47,300 --> 00:41:51,109
<font color="#E5E5E5">it this big list of possible names and</font>

1121
00:41:49,820 --> 00:41:52,609
this<font color="#CCCCCC"> is gonna</font><font color="#E5E5E5"> do some Kerberos pre</font>

1122
00:41:51,109 --> 00:41:53,960
authentication<font color="#CCCCCC"> and see if</font><font color="#E5E5E5"> these user</font>

1123
00:41:52,609 --> 00:41:56,869
names exist judging by the error

1124
00:41:53,960 --> 00:41:57,890
messages that<font color="#E5E5E5"> come back from the KDC so</font>

1125
00:41:56,869 --> 00:42:00,320
it found<font color="#E5E5E5"> the KDC</font>

1126
00:41:57,890 --> 00:42:02,660
<font color="#E5E5E5">and it starts enumerated some valid user</font>

1127
00:42:00,320 --> 00:42:04,790
names for me and it's done

1128
00:42:02,660 --> 00:42:08,779
and<font color="#CCCCCC"> i got 40 valid user names and i</font>

1129
00:42:04,790 --> 00:42:12,290
<font color="#CCCCCC">tested 10197 user names and i got cut</font>

1130
00:42:08,780 --> 00:42:16,640
off there but 5.4 seconds so pretty

1131
00:42:12,290 --> 00:42:18,710
quick<font color="#E5E5E5"> next let's say</font><font color="#CCCCCC"> i have a list of</font>

1132
00:42:16,640 --> 00:42:20,509
valid domain users and I've dumped<font color="#E5E5E5"> this</font>

1133
00:42:18,710 --> 00:42:21,740
may be from LDAP and I have twenty seven

1134
00:42:20,510 --> 00:42:23,240
<font color="#CCCCCC">hundred or two thousand seven hundred</font>

1135
00:42:21,740 --> 00:42:26,060
two thousand seven hundred<font color="#CCCCCC"> fifty-five</font>

1136
00:42:23,240 --> 00:42:28,279
domain users and I want to see are any

1137
00:42:26,060 --> 00:42:30,529
of them using password one two three so

1138
00:42:28,280 --> 00:42:34,339
I<font color="#E5E5E5"> can use curb root and I will do a</font>

1139
00:42:30,530 --> 00:42:40,460
password spray I have to give it the

1140
00:42:34,339 --> 00:42:42,830
<font color="#E5E5E5">domain again and then I give</font><font color="#CCCCCC"> it the list</font>

1141
00:42:40,460 --> 00:42:45,890
<font color="#E5E5E5">of domain users I want and the password</font>

1142
00:42:42,830 --> 00:42:47,900
<font color="#E5E5E5">I'd like to try so we'll try password</font>

1143
00:42:45,890 --> 00:42:52,839
one two three<font color="#E5E5E5"> do is clean sweep against</font>

1144
00:42:47,900 --> 00:42:52,839
every single domain user found<font color="#E5E5E5"> the KDC</font>

1145
00:42:54,940 --> 00:43:03,170
there's one there's two<font color="#E5E5E5"> and I tested all</font>

1146
00:43:00,109 --> 00:43:05,779
<font color="#CCCCCC">2700 domain users in eight point two</font>

1147
00:43:03,170 --> 00:43:07,160
seconds so really quickly enumerated

1148
00:43:05,780 --> 00:43:09,130
right there<font color="#E5E5E5"> to ballot accounts that I</font>

1149
00:43:07,160 --> 00:43:11,210
have just<font color="#E5E5E5"> through some passwords brain</font>

1150
00:43:09,130 --> 00:43:12,020
and then<font color="#E5E5E5"> the last</font><font color="#CCCCCC"> function that I'll</font>

1151
00:43:11,210 --> 00:43:13,730
demo is

1152
00:43:12,020 --> 00:43:15,800
<font color="#CCCCCC">is</font><font color="#E5E5E5"> if you're sure that</font><font color="#CCCCCC"> there's no</font>

1153
00:43:13,730 --> 00:43:17,750
lockout policy in place<font color="#E5E5E5"> and you want to</font>

1154
00:43:15,800 --> 00:43:20,600
just take one user and just<font color="#CCCCCC"> blast a</font>

1155
00:43:17,750 --> 00:43:22,730
bunch of<font color="#CCCCCC"> passwords against them we'll</font>

1156
00:43:20,600 --> 00:43:27,470
<font color="#CCCCCC">we'll take a the top</font><font color="#E5E5E5"> 1000 most common</font>

1157
00:43:22,730 --> 00:43:33,650
<font color="#CCCCCC">passwords</font><font color="#E5E5E5"> and we'll do a brute user</font>

1158
00:43:27,470 --> 00:43:35,810
attack<font color="#E5E5E5"> in lab drop</font><font color="#CCCCCC"> knob comm will give</font>

1159
00:43:33,650 --> 00:43:38,720
<font color="#E5E5E5">it passwords dot list and then the user</font>

1160
00:43:35,810 --> 00:43:42,620
that we want<font color="#E5E5E5"> to brute force against in</font>

1161
00:43:38,720 --> 00:43:44,149
this case it'll be Trevor Hoffman so

1162
00:43:42,620 --> 00:43:46,160
this time it's just<font color="#E5E5E5"> targeting one user</font>

1163
00:43:44,150 --> 00:43:48,170
and blasting it<font color="#E5E5E5"> and I got the valid</font>

1164
00:43:46,160 --> 00:43:52,970
<font color="#CCCCCC">login and I tested 1000</font><font color="#E5E5E5"> possible</font>

1165
00:43:48,170 --> 00:43:54,770
passwords in 2.9 seconds<font color="#E5E5E5"> so it's pretty</font>

1166
00:43:52,970 --> 00:43:56,629
cool<font color="#E5E5E5"> it's really</font><font color="#CCCCCC"> quick it was sort of a</font>

1167
00:43:54,770 --> 00:43:59,690
<font color="#CCCCCC">challenge to myself to learn go</font><font color="#E5E5E5"> multi</font>

1168
00:43:56,630 --> 00:44:04,790
concurrency is awesome<font color="#CCCCCC"> UDP</font><font color="#E5E5E5"> is fast and</font>

1169
00:43:59,690 --> 00:44:08,590
Kerberos is pretty fun<font color="#CCCCCC"> oh that was my</font>

1170
00:44:04,790 --> 00:44:10,910
backup<font color="#E5E5E5"> video but thankfully it worked</font><font color="#CCCCCC"> oh</font>

1171
00:44:08,590 --> 00:44:12,620
and for<font color="#E5E5E5"> anyone who might want to give me</font>

1172
00:44:10,910 --> 00:44:14,480
crap<font color="#E5E5E5"> for not writing PowerShell tools I</font>

1173
00:44:12,620 --> 00:44:16,870
just<font color="#E5E5E5"> wanted to show the exe works fine</font>

1174
00:44:14,480 --> 00:44:16,870
in PowerShell

1175
00:44:18,010 --> 00:44:23,180
so what about logs<font color="#E5E5E5"> I actually had a</font>

1176
00:44:20,990 --> 00:44:24,770
major WTF moment like a year or two ago

1177
00:44:23,180 --> 00:44:26,509
when I was playing around with this

1178
00:44:24,770 --> 00:44:28,009
because<font color="#E5E5E5"> I was blasting like so much</font>

1179
00:44:26,510 --> 00:44:29,440
Kerberos failed traffic all over the

1180
00:44:28,010 --> 00:44:31,820
place I<font color="#E5E5E5"> went to my domain</font><font color="#CCCCCC"> controller</font>

1181
00:44:29,440 --> 00:44:34,280
<font color="#E5E5E5">queried</font><font color="#CCCCCC"> the security log</font><font color="#E5E5E5"> I didn't see a</font>

1182
00:44:31,820 --> 00:44:35,780
<font color="#E5E5E5">single failure</font><font color="#CCCCCC"> and I thought</font><font color="#E5E5E5"> that was a</font>

1183
00:44:34,280 --> 00:44:38,000
<font color="#E5E5E5">little bit odd granted I'm</font><font color="#CCCCCC"> not like a</font>

1184
00:44:35,780 --> 00:44:41,060
blue team or Active Directory<font color="#E5E5E5"> security</font>

1185
00:44:38,000 --> 00:44:42,830
like<font color="#E5E5E5"> guru</font><font color="#CCCCCC"> but I</font><font color="#E5E5E5"> investigated a little</font>

1186
00:44:41,060 --> 00:44:45,049
<font color="#CCCCCC">bit I think this is</font><font color="#E5E5E5"> really important</font>

1187
00:44:42,830 --> 00:44:47,090
turns out<font color="#E5E5E5"> that everything I'm doing is</font>

1188
00:44:45,050 --> 00:44:49,640
doing Kerberos pre authentication<font color="#E5E5E5"> and</font>

1189
00:44:47,090 --> 00:44:51,920
failing Kerberos pre<font color="#CCCCCC"> authentication</font><font color="#E5E5E5"> does</font>

1190
00:44:49,640 --> 00:44:54,920
not trigger the traditional<font color="#CCCCCC"> 4 625</font>

1191
00:44:51,920 --> 00:44:56,840
<font color="#E5E5E5">account failed to log on because we</font>

1192
00:44:54,920 --> 00:44:58,640
never actually logged on to<font color="#CCCCCC"> anything we</font>

1193
00:44:56,840 --> 00:45:01,400
<font color="#CCCCCC">just did a little pre on and ants and</font>

1194
00:44:58,640 --> 00:45:04,220
<font color="#CCCCCC">got a ticket so you actually have to</font>

1195
00:45:01,400 --> 00:45:05,990
enable Kerberos<font color="#E5E5E5"> auditing which is in a</font>

1196
00:45:04,220 --> 00:45:08,450
different<font color="#CCCCCC"> area than your normal like log</font>

1197
00:45:05,990 --> 00:45:10,009
on or<font color="#E5E5E5"> log off events so you have to make</font>

1198
00:45:08,450 --> 00:45:11,870
<font color="#E5E5E5">sure if you are running a domain that</font>

1199
00:45:10,010 --> 00:45:13,220
<font color="#CCCCCC">you have that</font><font color="#E5E5E5"> enabled it's considered</font>

1200
00:45:11,870 --> 00:45:15,109
best<font color="#CCCCCC"> practice but</font><font color="#E5E5E5"> this is really</font>

1201
00:45:13,220 --> 00:45:17,419
stressing<font color="#E5E5E5"> the point that like you should</font>

1202
00:45:15,110 --> 00:45:20,140
be enabling Kerberos auditing and not

1203
00:45:17,420 --> 00:45:22,190
just enabling it but alerting on it

1204
00:45:20,140 --> 00:45:24,109
because then we<font color="#CCCCCC"> start seeing</font><font color="#E5E5E5"> all this</font>

1205
00:45:22,190 --> 00:45:25,400
<font color="#E5E5E5">stuff and the two main events that are</font>

1206
00:45:24,110 --> 00:45:28,700
generated through that type of

1207
00:45:25,400 --> 00:45:31,310
<font color="#CCCCCC">Niq is event for 771 which is a</font><font color="#E5E5E5"> Kerberos</font>

1208
00:45:28,700 --> 00:45:34,580
pre authentication failure<font color="#CCCCCC"> an event for</font>

1209
00:45:31,310 --> 00:45:36,560
768<font color="#E5E5E5"> which</font><font color="#CCCCCC"> is a TGT was requested</font><font color="#E5E5E5"> and</font>

1210
00:45:34,580 --> 00:45:38,420
when we do the user enum that's the only

1211
00:45:36,560 --> 00:45:39,470
<font color="#E5E5E5">one we're doing so user enum doesn't</font>

1212
00:45:38,420 --> 00:45:40,790
actually count towards<font color="#CCCCCC"> the</font><font color="#E5E5E5"> failed</font>

1213
00:45:39,470 --> 00:45:42,560
<font color="#CCCCCC">lockout at all because</font><font color="#E5E5E5"> we never even</font>

1214
00:45:40,790 --> 00:45:45,710
tried a password we were just gauging

1215
00:45:42,560 --> 00:45:47,150
<font color="#E5E5E5">whether or not the</font><font color="#CCCCCC"> username existed so</font>

1216
00:45:45,710 --> 00:45:48,680
kind<font color="#E5E5E5"> of in summary there</font>

1217
00:45:47,150 --> 00:45:51,740
I believe that Kerberos pre

1218
00:45:48,680 --> 00:45:53,330
authentication is much faster<font color="#E5E5E5"> than any</font>

1219
00:45:51,740 --> 00:45:55,189
other like<font color="#CCCCCC"> password sprain or brute</font>

1220
00:45:53,330 --> 00:45:58,850
forcing attempt<font color="#E5E5E5"> live brute forcing</font>

1221
00:45:55,190 --> 00:46:01,490
attempt that's<font color="#E5E5E5"> out there and I</font><font color="#CCCCCC"> think</font>

1222
00:45:58,850 --> 00:46:03,230
<font color="#E5E5E5">it's potentially stealthier anecdotally</font>

1223
00:46:01,490 --> 00:46:04,970
<font color="#E5E5E5">I</font><font color="#CCCCCC"> don't have enough like evidence to go</font>

1224
00:46:03,230 --> 00:46:06,680
<font color="#CCCCCC">on here but just giving this talk</font>

1225
00:46:04,970 --> 00:46:08,000
internally and talking to a few<font color="#E5E5E5"> people</font><font color="#CCCCCC"> I</font>

1226
00:46:06,680 --> 00:46:09,529
know that there's<font color="#CCCCCC"> organizations out</font>

1227
00:46:08,000 --> 00:46:11,240
there that<font color="#E5E5E5"> like this is a visibility gap</font>

1228
00:46:09,530 --> 00:46:12,800
for them they're not<font color="#E5E5E5"> necessarily</font><font color="#CCCCCC"> looking</font>

1229
00:46:11,240 --> 00:46:14,750
at or alerting on Kerberos pre

1230
00:46:12,800 --> 00:46:20,990
authentication<font color="#CCCCCC"> failures</font><font color="#E5E5E5"> and they really</font>

1231
00:46:14,750 --> 00:46:22,490
<font color="#E5E5E5">really need</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> be</font><font color="#CCCCCC"> alright ok I'm doing</font>

1232
00:46:20,990 --> 00:46:26,209
<font color="#CCCCCC">ok on</font><font color="#E5E5E5"> time so we'll go into some</font><font color="#CCCCCC"> more</font>

1233
00:46:22,490 --> 00:46:27,950
Kerberos fun here specifically how to<font color="#E5E5E5"> do</font>

1234
00:46:26,210 --> 00:46:35,690
some privilege escalation and working

1235
00:46:27,950 --> 00:46:38,210
with hashes<font color="#CCCCCC"> alright so let's talk about</font>

1236
00:46:35,690 --> 00:46:41,960
spins spins or service<font color="#CCCCCC"> principle names</font>

1237
00:46:38,210 --> 00:46:44,000
<font color="#E5E5E5">and in Kerberos you can always request a</font>

1238
00:46:41,960 --> 00:46:45,560
service<font color="#CCCCCC"> ticket for</font><font color="#E5E5E5"> a spin I mean that's</font>

1239
00:46:44,000 --> 00:46:46,880
<font color="#CCCCCC">exactly what they're designed for if you</font>

1240
00:46:45,560 --> 00:46:48,860
have a spin it means that you want<font color="#E5E5E5"> to</font>

1241
00:46:46,880 --> 00:46:50,480
accept Kerberos authentication<font color="#E5E5E5"> and I can</font>

1242
00:46:48,860 --> 00:46:53,300
therefore check out a service<font color="#E5E5E5"> ticket for</font>

1243
00:46:50,480 --> 00:46:56,240
<font color="#CCCCCC">that spin for example if I want</font><font color="#E5E5E5"> to</font>

1244
00:46:53,300 --> 00:46:58,190
access RDP<font color="#CCCCCC"> I will go to the KDC and</font><font color="#E5E5E5"> I</font>

1245
00:46:56,240 --> 00:47:00,350
will<font color="#E5E5E5"> request just a service ticket for</font>

1246
00:46:58,190 --> 00:47:02,810
the spin associated with RDP<font color="#E5E5E5"> on the</font>

1247
00:47:00,350 --> 00:47:04,759
server that I want to access<font color="#E5E5E5"> now that</font>

1248
00:47:02,810 --> 00:47:08,000
service ticket is encrypted<font color="#E5E5E5"> with</font><font color="#CCCCCC"> the</font>

1249
00:47:04,760 --> 00:47:09,800
spin<font color="#E5E5E5"> owners excuse me and tail and</font>

1250
00:47:08,000 --> 00:47:11,300
password hash which means that it's

1251
00:47:09,800 --> 00:47:13,220
actually<font color="#CCCCCC"> possible</font><font color="#E5E5E5"> to crack service</font>

1252
00:47:11,300 --> 00:47:15,160
tickets<font color="#E5E5E5"> offline</font><font color="#CCCCCC"> you can just brute-force</font>

1253
00:47:13,220 --> 00:47:17,240
them until you<font color="#E5E5E5"> find the decryption key</font>

1254
00:47:15,160 --> 00:47:20,330
<font color="#E5E5E5">generally</font><font color="#CCCCCC"> speaking though that's useless</font>

1255
00:47:17,240 --> 00:47:22,160
<font color="#E5E5E5">because for most machines who are the</font>

1256
00:47:20,330 --> 00:47:23,840
spin owners<font color="#E5E5E5"> it's encrypted with</font><font color="#CCCCCC"> their</font>

1257
00:47:22,160 --> 00:47:26,509
machine<font color="#E5E5E5"> service account which is a super</font>

1258
00:47:23,840 --> 00:47:28,490
<font color="#E5E5E5">long randomly generated password but</font>

1259
00:47:26,510 --> 00:47:30,170
sometimes spins can<font color="#E5E5E5"> be tied to user</font>

1260
00:47:28,490 --> 00:47:31,790
accounts<font color="#CCCCCC"> and when</font><font color="#E5E5E5"> that's the case it's</font>

1261
00:47:30,170 --> 00:47:33,530
encrypted<font color="#E5E5E5"> with</font><font color="#CCCCCC"> the users password</font><font color="#E5E5E5"> and as</font>

1262
00:47:31,790 --> 00:47:36,910
we know users are terrible at picking

1263
00:47:33,530 --> 00:47:39,190
passwords so this tech

1264
00:47:36,910 --> 00:47:40,779
<font color="#E5E5E5">is called</font><font color="#CCCCCC"> Kerberos team and it was</font>

1265
00:47:39,190 --> 00:47:42,010
initially<font color="#E5E5E5"> presented at Derby con I was</font>

1266
00:47:40,780 --> 00:47:43,510
in the audience<font color="#E5E5E5"> there and I had no idea</font>

1267
00:47:42,010 --> 00:47:44,980
<font color="#CCCCCC">what</font><font color="#E5E5E5"> was</font><font color="#CCCCCC"> going on but I</font><font color="#E5E5E5"> think I finally</font>

1268
00:47:43,510 --> 00:47:49,360
get it<font color="#E5E5E5"> five years later or four years</font>

1269
00:47:44,980 --> 00:47:50,950
later so Kerberos<font color="#E5E5E5"> team three-step</font>

1270
00:47:49,360 --> 00:47:52,420
<font color="#E5E5E5">process it requires a valid domain</font>

1271
00:47:50,950 --> 00:47:54,759
account so you<font color="#E5E5E5"> need to have at</font><font color="#CCCCCC"> least one</font>

1272
00:47:52,420 --> 00:47:56,650
<font color="#CCCCCC">valid domain account</font><font color="#E5E5E5"> and then you find</font>

1273
00:47:54,760 --> 00:47:58,390
spins that<font color="#E5E5E5"> are tied to user accounts</font>

1274
00:47:56,650 --> 00:48:00,430
which is an LDAP filter<font color="#E5E5E5"> that I shared</font>

1275
00:47:58,390 --> 00:48:02,350
already<font color="#E5E5E5"> you request the service</font><font color="#CCCCCC"> ticket</font>

1276
00:48:00,430 --> 00:48:03,669
for the spin and then you brute force it

1277
00:48:02,350 --> 00:48:05,380
offline<font color="#CCCCCC"> and if you can successfully</font>

1278
00:48:03,670 --> 00:48:08,640
decrypt it you have<font color="#E5E5E5"> found that</font><font color="#CCCCCC"> users</font>

1279
00:48:05,380 --> 00:48:11,730
password and<font color="#CCCCCC"> impac it makes it so easy</font>

1280
00:48:08,640 --> 00:48:14,410
<font color="#E5E5E5">with their Python script get user spins</font>

1281
00:48:11,730 --> 00:48:16,300
which is one<font color="#E5E5E5"> of the ones that I compile</font>

1282
00:48:14,410 --> 00:48:18,370
do a<font color="#E5E5E5"> static binaries so this works fine</font>

1283
00:48:16,300 --> 00:48:22,510
if you download it<font color="#CCCCCC"> you can</font><font color="#E5E5E5"> run get user</font>

1284
00:48:18,370 --> 00:48:24,609
spins -<font color="#E5E5E5"> request the domain and the one</font>

1285
00:48:22,510 --> 00:48:26,680
valid user that we have<font color="#E5E5E5"> and it will do</font>

1286
00:48:24,610 --> 00:48:28,240
an LDAP look up it will request a

1287
00:48:26,680 --> 00:48:30,220
service<font color="#E5E5E5"> ticket it will spit out the hash</font>

1288
00:48:28,240 --> 00:48:32,649
and that hash is like in a crack ready

1289
00:48:30,220 --> 00:48:36,520
format so you<font color="#CCCCCC"> can feed that</font><font color="#E5E5E5"> hash right</font>

1290
00:48:32,650 --> 00:48:38,770
into hash<font color="#E5E5E5"> cat mode</font><font color="#CCCCCC"> 13100 and just start</font>

1291
00:48:36,520 --> 00:48:41,620
an<font color="#E5E5E5"> offline</font><font color="#CCCCCC"> brute-force attack and if we</font>

1292
00:48:38,770 --> 00:48:43,930
crack it<font color="#E5E5E5"> like we can we did here</font><font color="#CCCCCC"> that</font>

1293
00:48:41,620 --> 00:48:46,120
what we've cracked is the password

1294
00:48:43,930 --> 00:48:48,640
<font color="#CCCCCC">associated with the user account who had</font>

1295
00:48:46,120 --> 00:48:51,759
the spin and<font color="#E5E5E5"> the user account we</font><font color="#CCCCCC"> can see</font>

1296
00:48:48,640 --> 00:48:53,680
here is vulner<font color="#E5E5E5"> and he's a member of IT</font>

1297
00:48:51,760 --> 00:48:55,720
admins which means transitively he has

1298
00:48:53,680 --> 00:48:57,100
domain admin so it's a way you can get

1299
00:48:55,720 --> 00:49:02,140
domain admin it's a way I've<font color="#E5E5E5"> gotten</font>

1300
00:48:57,100 --> 00:49:04,690
domain<font color="#E5E5E5"> admin several times so passwords</font>

1301
00:49:02,140 --> 00:49:06,490
are great<font color="#E5E5E5"> but and you're usually pretty</font>

1302
00:49:04,690 --> 00:49:08,020
easy<font color="#E5E5E5"> to find in</font><font color="#CCCCCC"> clear-text</font><font color="#E5E5E5"> but sometimes</font>

1303
00:49:06,490 --> 00:49:11,169
you can't<font color="#E5E5E5"> get a clear text password and</font>

1304
00:49:08,020 --> 00:49:12,910
all you have is<font color="#CCCCCC"> a hash for ntlm off</font><font color="#E5E5E5"> past</font>

1305
00:49:11,170 --> 00:49:15,100
the hash is still around past the hash

1306
00:49:12,910 --> 00:49:16,690
still works great<font color="#E5E5E5"> but how</font><font color="#CCCCCC"> can</font><font color="#E5E5E5"> you do</font>

1307
00:49:15,100 --> 00:49:18,610
Kerberos authentication without<font color="#CCCCCC"> a</font>

1308
00:49:16,690 --> 00:49:20,920
password<font color="#E5E5E5"> since I thought Kerberos was</font>

1309
00:49:18,610 --> 00:49:24,970
based on passwords<font color="#CCCCCC"> well it turns out</font><font color="#E5E5E5"> you</font>

1310
00:49:20,920 --> 00:49:26,410
<font color="#CCCCCC">can because the</font><font color="#E5E5E5"> a s request to get a TGT</font>

1311
00:49:24,970 --> 00:49:28,660
doesn't actually<font color="#E5E5E5"> use the</font><font color="#CCCCCC"> password</font>

1312
00:49:26,410 --> 00:49:30,310
directly<font color="#CCCCCC"> it derives an encryption key</font>

1313
00:49:28,660 --> 00:49:33,310
from the password and uses that

1314
00:49:30,310 --> 00:49:35,590
<font color="#E5E5E5">encryption key and the NT hash is an</font>

1315
00:49:33,310 --> 00:49:37,150
encryption key<font color="#E5E5E5"> so if you have the empty</font>

1316
00:49:35,590 --> 00:49:39,940
<font color="#E5E5E5">hash of the password you have everything</font>

1317
00:49:37,150 --> 00:49:41,590
<font color="#E5E5E5">you need to</font><font color="#CCCCCC"> actually check out</font><font color="#E5E5E5"> a TGT and</font>

1318
00:49:39,940 --> 00:49:43,570
this this technique is called<font color="#CCCCCC"> over</font>

1319
00:49:41,590 --> 00:49:45,400
passing the hash or<font color="#CCCCCC"> pass the ticket I've</font>

1320
00:49:43,570 --> 00:49:47,110
also heard it referred to and I'll show

1321
00:49:45,400 --> 00:49:48,910
two ways you can<font color="#E5E5E5"> do this one is with</font>

1322
00:49:47,110 --> 00:49:50,650
native Kerberos clients like<font color="#CCCCCC"> Heimdall</font>

1323
00:49:48,910 --> 00:49:51,910
<font color="#E5E5E5">and then of</font><font color="#CCCCCC"> course one is</font><font color="#E5E5E5"> with</font>

1324
00:49:50,650 --> 00:49:54,579
because you can do<font color="#E5E5E5"> everything within</font>

1325
00:49:51,910 --> 00:49:56,259
packet so our scenario here is<font color="#E5E5E5"> let's say</font>

1326
00:49:54,579 --> 00:50:00,009
<font color="#E5E5E5">we have the empty hash for a user named</font>

1327
00:49:56,259 --> 00:50:03,160
tony gwynn<font color="#E5E5E5"> if we want to do it natively</font>

1328
00:50:00,009 --> 00:50:05,349
with<font color="#CCCCCC"> heimdal Kerberos</font><font color="#E5E5E5"> passing the hash</font>

1329
00:50:03,160 --> 00:50:07,538
actually documented this<font color="#CCCCCC"> several years</font>

1330
00:50:05,349 --> 00:50:10,240
<font color="#E5E5E5">ago and it's been in my bookmarks since</font>

1331
00:50:07,539 --> 00:50:13,569
then but<font color="#E5E5E5"> you can use the key tab utility</font>

1332
00:50:10,240 --> 00:50:15,459
<font color="#E5E5E5">and create a key tab file which is a</font>

1333
00:50:13,569 --> 00:50:17,558
Kerberos construct<font color="#E5E5E5"> that just stores</font>

1334
00:50:15,460 --> 00:50:19,509
encryption keys and you specify<font color="#CCCCCC"> that the</font>

1335
00:50:17,559 --> 00:50:21,460
NT hash is the encryption<font color="#CCCCCC"> key you'd</font><font color="#E5E5E5"> like</font>

1336
00:50:19,509 --> 00:50:23,230
to use and you<font color="#E5E5E5"> have to specify</font><font color="#CCCCCC"> that the</font>

1337
00:50:21,460 --> 00:50:27,009
NT hash is<font color="#CCCCCC"> arced</font><font color="#E5E5E5"> for encryption</font>

1338
00:50:23,230 --> 00:50:28,720
<font color="#CCCCCC">HMH</font><font color="#E5E5E5"> with md5 so when you do that you can</font>

1339
00:50:27,009 --> 00:50:30,519
<font color="#E5E5E5">then</font><font color="#CCCCCC"> use K in it and provide it the</font>

1340
00:50:28,720 --> 00:50:32,558
encryption key<font color="#E5E5E5"> directly from the key tab</font>

1341
00:50:30,519 --> 00:50:34,660
file instead<font color="#CCCCCC"> of a password and you will</font>

1342
00:50:32,559 --> 00:50:35,710
check out<font color="#E5E5E5"> a TGT for tony gwynn even</font>

1343
00:50:34,660 --> 00:50:37,440
though we don't<font color="#CCCCCC"> know tony Gwynn's</font>

1344
00:50:35,710 --> 00:50:40,900
password and just<font color="#CCCCCC"> have the hash</font><font color="#E5E5E5"> of</font>

1345
00:50:37,440 --> 00:50:44,529
<font color="#CCCCCC">course get TGT also does this for you we</font>

1346
00:50:40,900 --> 00:50:47,380
can just request<font color="#CCCCCC"> the NT hashes and get</font>

1347
00:50:44,529 --> 00:50:49,539
TGT will create a<font color="#CCCCCC"> c cache file</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> c</font>

1348
00:50:47,380 --> 00:50:53,069
cache file can<font color="#CCCCCC"> be</font><font color="#E5E5E5"> used with heimdall</font>

1349
00:50:49,539 --> 00:50:53,069
Kerberos<font color="#CCCCCC"> and we can see the same result</font>

1350
00:50:53,190 --> 00:50:57,849
now empty hashes with<font color="#CCCCCC"> ARC for encryption</font>

1351
00:50:55,779 --> 00:51:00,309
<font color="#CCCCCC">could actually flag some windows alerts</font>

1352
00:50:57,849 --> 00:51:02,410
so I caution you<font color="#E5E5E5"> because it's not the</font>

1353
00:51:00,309 --> 00:51:04,450
<font color="#E5E5E5">best or default encryption anymore in</font>

1354
00:51:02,410 --> 00:51:06,999
Active Directory modern<font color="#CCCCCC"> AD is using AES</font>

1355
00:51:04,450 --> 00:51:11,319
256 encryption for Kerberos

1356
00:51:06,999 --> 00:51:13,359
authentication or<font color="#E5E5E5"> a s requests so every</font>

1357
00:51:11,319 --> 00:51:15,130
user also<font color="#E5E5E5"> has</font><font color="#CCCCCC"> AE s keys that</font><font color="#E5E5E5"> are</font><font color="#CCCCCC"> derived</font>

1358
00:51:13,359 --> 00:51:16,960
<font color="#E5E5E5">from their password and those AES keys</font>

1359
00:51:15,130 --> 00:51:18,279
can be somewhat harder to come<font color="#CCCCCC"> by</font><font color="#E5E5E5"> but</font>

1360
00:51:16,960 --> 00:51:20,589
<font color="#CCCCCC">they're still there if you look in mini</font>

1361
00:51:18,279 --> 00:51:24,900
cats or secrets dump<font color="#E5E5E5"> and here's a</font><font color="#CCCCCC"> e s</font>

1362
00:51:20,589 --> 00:51:27,910
keys for a user and<font color="#CCCCCC"> for name will Myers</font>

1363
00:51:24,900 --> 00:51:29,640
<font color="#E5E5E5">the exact same techniques work use</font><font color="#CCCCCC"> KT</font>

1364
00:51:27,910 --> 00:51:32,799
util just change the encryption

1365
00:51:29,640 --> 00:51:34,660
<font color="#E5E5E5">mechanism to AES 256 and paste in</font><font color="#CCCCCC"> the</font>

1366
00:51:32,799 --> 00:51:37,569
<font color="#E5E5E5">encryption key you got and you</font><font color="#CCCCCC"> can get a</font>

1367
00:51:34,660 --> 00:51:39,759
TGT same would get<font color="#E5E5E5"> TGT within packet you</font>

1368
00:51:37,569 --> 00:51:43,470
just specify AES key and you get<font color="#CCCCCC"> a</font><font color="#E5E5E5"> C</font>

1369
00:51:39,759 --> 00:51:46,660
<font color="#E5E5E5">cache file which contains</font><font color="#CCCCCC"> your chi GT</font>

1370
00:51:43,470 --> 00:51:48,069
<font color="#CCCCCC">okay</font><font color="#E5E5E5"> cool I've got a couple more minutes</font>

1371
00:51:46,660 --> 00:51:50,319
so the last thing<font color="#E5E5E5"> I wanted to touch on</font>

1372
00:51:48,069 --> 00:51:52,269
<font color="#E5E5E5">and I could really go on on this kind of</font>

1373
00:51:50,319 --> 00:51:54,730
fun<font color="#E5E5E5"> stuff forever</font><font color="#CCCCCC"> but I</font><font color="#E5E5E5"> think these kind</font>

1374
00:51:52,269 --> 00:51:57,189
of<font color="#CCCCCC"> built-in</font><font color="#E5E5E5"> nicely is abusing Kerberos</font>

1375
00:51:54,730 --> 00:52:00,880
for persistence<font color="#E5E5E5"> specifically golden and</font>

1376
00:51:57,190 --> 00:52:02,559
silver tickets so<font color="#E5E5E5"> I think we're all</font>

1377
00:52:00,880 --> 00:52:04,330
<font color="#E5E5E5">you've probably heard of golden ticket</font>

1378
00:52:02,559 --> 00:52:06,160
silver tickets<font color="#CCCCCC"> I</font>

1379
00:52:04,330 --> 00:52:08,230
they're very<font color="#CCCCCC"> well</font><font color="#E5E5E5"> documented</font><font color="#CCCCCC"> I don't</font>

1380
00:52:06,160 --> 00:52:09,850
want to spend too much time on<font color="#E5E5E5"> them</font><font color="#CCCCCC"> but</font>

1381
00:52:08,230 --> 00:52:11,680
I<font color="#E5E5E5"> feel like they fit in nicely here</font>

1382
00:52:09,850 --> 00:52:15,160
<font color="#E5E5E5">because I want to focus a little bit</font>

1383
00:52:11,680 --> 00:52:16,870
<font color="#CCCCCC">more on their practical usage and</font><font color="#E5E5E5"> a lot</font>

1384
00:52:15,160 --> 00:52:18,790
<font color="#CCCCCC">of the documentation</font><font color="#E5E5E5"> and like</font><font color="#CCCCCC"> tutorials</font>

1385
00:52:16,870 --> 00:52:20,740
that were out there<font color="#CCCCCC"> that I found</font><font color="#E5E5E5"> were</font>

1386
00:52:18,790 --> 00:52:22,900
using golden and silver tickets like

1387
00:52:20,740 --> 00:52:24,250
with mini cats or kikyo<font color="#CCCCCC"> inside</font><font color="#E5E5E5"> windows</font>

1388
00:52:22,900 --> 00:52:26,670
and<font color="#E5E5E5"> I wasn't quite sure what</font><font color="#CCCCCC"> to do with</font>

1389
00:52:24,250 --> 00:52:30,040
<font color="#CCCCCC">them</font><font color="#E5E5E5"> if I was on</font><font color="#CCCCCC"> Linux</font>

1390
00:52:26,670 --> 00:52:32,950
so with mini cats or in packet you can

1391
00:52:30,040 --> 00:52:34,750
forge your own<font color="#E5E5E5"> TGT</font><font color="#CCCCCC"> Zoar</font><font color="#E5E5E5"> forge your</font><font color="#CCCCCC"> own</font>

1392
00:52:32,950 --> 00:52:37,240
service tickets<font color="#E5E5E5"> and if you are forging</font>

1393
00:52:34,750 --> 00:52:39,280
<font color="#CCCCCC">your own TGT that's a golden</font><font color="#E5E5E5"> ticket</font><font color="#CCCCCC"> if</font>

1394
00:52:37,240 --> 00:52:43,479
you are forging<font color="#E5E5E5"> your own service ticket</font>

1395
00:52:39,280 --> 00:52:45,310
<font color="#E5E5E5">that's a silver ticket</font><font color="#CCCCCC"> to forge a golden</font>

1396
00:52:43,480 --> 00:52:46,990
ticket we need the master encryption key

1397
00:52:45,310 --> 00:52:48,850
that's used by<font color="#E5E5E5"> the domain controller</font><font color="#CCCCCC"> to</font>

1398
00:52:46,990 --> 00:52:53,259
encrypt all the Kerberos responses and

1399
00:52:48,850 --> 00:52:55,180
that's the account called krbtgt<font color="#E5E5E5"> for the</font>

1400
00:52:53,260 --> 00:52:56,950
silver ticket we don't need that but we

1401
00:52:55,180 --> 00:52:58,600
do need<font color="#E5E5E5"> the encryption key for the</font>

1402
00:52:56,950 --> 00:53:00,160
machine that<font color="#E5E5E5"> we're trying to</font><font color="#CCCCCC"> access so</font>

1403
00:52:58,600 --> 00:53:02,860
the spin owner<font color="#CCCCCC"> they have their own</font>

1404
00:53:00,160 --> 00:53:06,509
password a password hash or encryption

1405
00:53:02,860 --> 00:53:09,070
key<font color="#CCCCCC"> so practically it looks like this</font>

1406
00:53:06,510 --> 00:53:11,440
<font color="#E5E5E5">ticket or</font><font color="#CCCCCC"> PI is</font><font color="#E5E5E5"> the impacted script that</font>

1407
00:53:09,070 --> 00:53:13,960
you<font color="#E5E5E5"> can run anywhere as it as the binary</font>

1408
00:53:11,440 --> 00:53:16,510
<font color="#E5E5E5">or is the Python script</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> provided the</font>

1409
00:53:13,960 --> 00:53:19,000
key you give it the<font color="#E5E5E5"> domain Sid you give</font>

1410
00:53:16,510 --> 00:53:20,860
it the<font color="#E5E5E5"> domain the default duration any</font>

1411
00:53:19,000 --> 00:53:22,630
additional groups that you<font color="#CCCCCC"> want it to be</font>

1412
00:53:20,860 --> 00:53:24,490
a part of and a<font color="#E5E5E5"> user name because this</font>

1413
00:53:22,630 --> 00:53:26,380
<font color="#E5E5E5">isn't just forging the TGT it's also</font>

1414
00:53:24,490 --> 00:53:27,939
forging the<font color="#E5E5E5"> pack and I talked about how</font>

1415
00:53:26,380 --> 00:53:29,680
<font color="#E5E5E5">the pack is embedded inside the ticket</font>

1416
00:53:27,940 --> 00:53:31,450
<font color="#E5E5E5">this is actually going to create the</font>

1417
00:53:29,680 --> 00:53:33,430
<font color="#E5E5E5">fort entirely forged</font><font color="#CCCCCC"> packed</font><font color="#E5E5E5"> so we can</font>

1418
00:53:31,450 --> 00:53:37,330
put in any user or group<font color="#E5E5E5"> information we</font>

1419
00:53:33,430 --> 00:53:39,879
want as well so I hope<font color="#E5E5E5"> you can read this</font>

1420
00:53:37,330 --> 00:53:43,299
but this is using<font color="#E5E5E5"> the ticket or binary</font>

1421
00:53:39,880 --> 00:53:45,430
<font color="#E5E5E5">and I've put in the AES key of the</font><font color="#CCCCCC"> kerb</font>

1422
00:53:43,300 --> 00:53:48,880
TGT account that I got from<font color="#E5E5E5"> the domain</font>

1423
00:53:45,430 --> 00:53:51,759
controller<font color="#E5E5E5"> the domain</font><font color="#CCCCCC"> Sid</font><font color="#E5E5E5"> the domain I'm</font>

1424
00:53:48,880 --> 00:53:53,740
just<font color="#E5E5E5"> making it good for one day</font><font color="#CCCCCC"> and the</font>

1425
00:53:51,760 --> 00:53:55,480
<font color="#CCCCCC">username</font><font color="#E5E5E5"> I completely made up and I just</font>

1426
00:53:53,740 --> 00:53:58,419
made up a user called hello troopers<font color="#E5E5E5"> and</font>

1427
00:53:55,480 --> 00:54:00,610
ticket er creates<font color="#CCCCCC"> AC</font><font color="#E5E5E5"> cache file from</font>

1428
00:53:58,420 --> 00:54:01,900
scratch<font color="#CCCCCC"> and it's a valid</font><font color="#E5E5E5"> C cache file</font>

1429
00:54:00,610 --> 00:54:04,540
that can<font color="#E5E5E5"> be used with any Kerberos</font>

1430
00:54:01,900 --> 00:54:06,460
client so by exporting it and using<font color="#E5E5E5"> it</font>

1431
00:54:04,540 --> 00:54:08,770
with<font color="#CCCCCC"> K</font><font color="#E5E5E5"> list we can see the information</font>

1432
00:54:06,460 --> 00:54:10,540
<font color="#CCCCCC">in here</font><font color="#E5E5E5"> and we actually have a principle</font>

1433
00:54:08,770 --> 00:54:13,120
called<font color="#E5E5E5"> hello troopers which is a made-up</font>

1434
00:54:10,540 --> 00:54:15,160
user but we have a valid TGT that that

1435
00:54:13,120 --> 00:54:17,020
hasn't<font color="#E5E5E5"> expired yet for the domain and</font>

1436
00:54:15,160 --> 00:54:17,920
then we're off to<font color="#CCCCCC"> the</font><font color="#E5E5E5"> races and can use</font>

1437
00:54:17,020 --> 00:54:20,230
<font color="#E5E5E5">that with any</font>

1438
00:54:17,920 --> 00:54:21,490
<font color="#E5E5E5">kerberos tool so I just wanted to show</font>

1439
00:54:20,230 --> 00:54:24,520
you can use it like<font color="#E5E5E5"> with Samba for</font>

1440
00:54:21,490 --> 00:54:26,500
<font color="#E5E5E5">example SMB client -</font><font color="#CCCCCC"> k with hello</font>

1441
00:54:24,520 --> 00:54:28,359
<font color="#E5E5E5">troopers I've mounted the</font><font color="#CCCCCC"> C shared</font>

1442
00:54:26,500 --> 00:54:31,000
directory on the<font color="#E5E5E5"> domain controller</font><font color="#CCCCCC"> and</font>

1443
00:54:28,359 --> 00:54:32,680
I'm<font color="#CCCCCC"> a user called hello troopers I don't</font>

1444
00:54:31,000 --> 00:54:34,150
even<font color="#E5E5E5"> exist</font><font color="#CCCCCC"> that's the power of golden</font>

1445
00:54:32,680 --> 00:54:35,710
<font color="#CCCCCC">tickets it's really been demoed before</font>

1446
00:54:34,150 --> 00:54:40,089
but<font color="#E5E5E5"> that's how you</font><font color="#CCCCCC"> would</font><font color="#E5E5E5"> do it from</font>

1447
00:54:35,710 --> 00:54:41,920
Linux and silver tickets are slightly

1448
00:54:40,089 --> 00:54:44,078
<font color="#CCCCCC">different they are useful</font><font color="#E5E5E5"> for</font>

1449
00:54:41,920 --> 00:54:45,250
persistence to a single host service

1450
00:54:44,079 --> 00:54:46,480
combination so you<font color="#E5E5E5"> have to recall</font>

1451
00:54:45,250 --> 00:54:49,750
service tickets are only<font color="#E5E5E5"> good for</font>

1452
00:54:46,480 --> 00:54:51,339
service host combos<font color="#CCCCCC"> and I think there's</font>

1453
00:54:49,750 --> 00:54:52,960
stealthier than golden tickets<font color="#E5E5E5"> the</font>

1454
00:54:51,339 --> 00:54:55,058
reason being you'd never actually<font color="#E5E5E5"> talk</font>

1455
00:54:52,960 --> 00:54:56,799
to the domain controller<font color="#CCCCCC"> with a</font><font color="#E5E5E5"> forged</font>

1456
00:54:55,059 --> 00:54:58,240
silver ticket you can<font color="#E5E5E5"> go directly to the</font>

1457
00:54:56,799 --> 00:54:59,740
service you want<font color="#E5E5E5"> to access and they will</font>

1458
00:54:58,240 --> 00:55:01,058
let you in so<font color="#CCCCCC"> you don't have</font><font color="#E5E5E5"> to go back</font>

1459
00:54:59,740 --> 00:55:04,058
to the domain controller and<font color="#CCCCCC"> check out a</font>

1460
00:55:01,059 --> 00:55:06,549
ticket<font color="#CCCCCC"> you</font><font color="#E5E5E5"> have to specify the service</font>

1461
00:55:04,059 --> 00:55:07,930
you need and if you're trying to<font color="#E5E5E5"> get</font>

1462
00:55:06,549 --> 00:55:11,140
code execution in a later date you're

1463
00:55:07,930 --> 00:55:13,328
probably gonna want<font color="#CCCCCC"> sifts and or host</font><font color="#E5E5E5"> so</font>

1464
00:55:11,140 --> 00:55:15,730
very<font color="#E5E5E5"> very similar</font><font color="#CCCCCC"> looking command would</font>

1465
00:55:13,329 --> 00:55:18,490
<font color="#CCCCCC">ticket er but in</font><font color="#E5E5E5"> this case our AES</font><font color="#CCCCCC"> key</font>

1466
00:55:15,730 --> 00:55:20,500
is not<font color="#CCCCCC"> curb TGT the AES key is the</font>

1467
00:55:18,490 --> 00:55:24,308
<font color="#CCCCCC">machine account password or the machine</font>

1468
00:55:20,500 --> 00:55:27,069
account<font color="#E5E5E5"> encryption key</font><font color="#CCCCCC"> and we also give</font>

1469
00:55:24,309 --> 00:55:29,380
it<font color="#E5E5E5"> - spin for the spins we want to embed</font>

1470
00:55:27,069 --> 00:55:31,480
or the spins<font color="#E5E5E5"> that we want to forge the</font>

1471
00:55:29,380 --> 00:55:33,760
the ticket<font color="#E5E5E5"> for and so in this case I'm</font>

1472
00:55:31,480 --> 00:55:36,730
<font color="#CCCCCC">requesting it for stiffs which is SMB on</font>

1473
00:55:33,760 --> 00:55:38,410
<font color="#CCCCCC">wso 3 win</font><font color="#E5E5E5"> 10 and again a made-up</font><font color="#CCCCCC"> user</font>

1474
00:55:36,730 --> 00:55:42,190
<font color="#E5E5E5">name called silver troopers to show that</font>

1475
00:55:38,410 --> 00:55:44,589
it<font color="#CCCCCC"> doesn't</font><font color="#E5E5E5"> matter</font><font color="#CCCCCC"> the C cash file is</font>

1476
00:55:42,190 --> 00:55:45,910
<font color="#CCCCCC">valid if we feed it to Heindel we'll see</font>

1477
00:55:44,589 --> 00:55:47,890
something<font color="#E5E5E5"> kind of unusual</font><font color="#CCCCCC"> that you</font>

1478
00:55:45,910 --> 00:55:50,618
normally<font color="#CCCCCC"> probably wouldn't see</font><font color="#E5E5E5"> is your</font><font color="#CCCCCC"> C</font>

1479
00:55:47,890 --> 00:55:52,930
<font color="#CCCCCC">cash file contains a TGS but not a TGT</font>

1480
00:55:50,619 --> 00:55:55,299
so we have the<font color="#E5E5E5"> principle here we have a</font>

1481
00:55:52,930 --> 00:55:57,040
<font color="#E5E5E5">ticket for</font><font color="#CCCCCC"> Sif's</font><font color="#E5E5E5"> we don't have a TGT we</font>

1482
00:55:55,299 --> 00:55:57,670
never needed<font color="#CCCCCC"> it we didn't we didn't</font>

1483
00:55:57,040 --> 00:56:01,390
<font color="#E5E5E5">request one</font>

1484
00:55:57,670 --> 00:56:04,000
and with SMB client<font color="#E5E5E5"> it works fine with -</font>

1485
00:56:01,390 --> 00:56:06,460
<font color="#CCCCCC">Kay as long</font><font color="#E5E5E5"> as we're accessing</font><font color="#CCCCCC"> wso 3 win</font>

1486
00:56:04,000 --> 00:56:08,020
10<font color="#E5E5E5"> and we're using it with Kerberos</font>

1487
00:56:06,460 --> 00:56:09,520
authentication<font color="#E5E5E5"> it doesn't matter that</font>

1488
00:56:08,020 --> 00:56:11,589
<font color="#E5E5E5">our</font><font color="#CCCCCC"> username is</font><font color="#E5E5E5"> made up it will let us</font>

1489
00:56:09,520 --> 00:56:16,450
in and<font color="#E5E5E5"> we can mount it and use that</font><font color="#CCCCCC"> C</font>

1490
00:56:11,589 --> 00:56:18,308
<font color="#E5E5E5">cache file with any Kerberos client so I</font>

1491
00:56:16,450 --> 00:56:19,540
think that's<font color="#CCCCCC"> my stopping</font><font color="#E5E5E5"> point</font><font color="#CCCCCC"> like I</font>

1492
00:56:18,309 --> 00:56:21,130
<font color="#CCCCCC">said there's a lot more fun things that</font>

1493
00:56:19,540 --> 00:56:22,240
<font color="#E5E5E5">could be that</font><font color="#CCCCCC"> could be done but</font><font color="#E5E5E5"> this was</font>

1494
00:56:21,130 --> 00:56:23,980
kind<font color="#CCCCCC"> of intended to</font><font color="#E5E5E5"> just be the</font>

1495
00:56:22,240 --> 00:56:25,270
foundational knowledge and I encourage

1496
00:56:23,980 --> 00:56:27,760
<font color="#E5E5E5">you to go</font><font color="#CCCCCC"> out there and just experiment</font>

1497
00:56:25,270 --> 00:56:28,990
<font color="#E5E5E5">and</font><font color="#CCCCCC"> play more with this type of cool</font>

1498
00:56:27,760 --> 00:56:31,880
things<font color="#E5E5E5"> you</font><font color="#CCCCCC"> can do with these</font><font color="#E5E5E5"> open</font>

1499
00:56:28,990 --> 00:56:33,769
protocols<font color="#CCCCCC"> kind</font><font color="#E5E5E5"> of in summary</font>

1500
00:56:31,880 --> 00:56:35,779
there's so much attack service<font color="#E5E5E5"> in Active</font>

1501
00:56:33,769 --> 00:56:37,488
Directory environments<font color="#CCCCCC"> I think</font><font color="#E5E5E5"> I saw in</font>

1502
00:56:35,779 --> 00:56:40,400
the<font color="#E5E5E5"> last presentation Biggie Smalls once</font>

1503
00:56:37,489 --> 00:56:43,339
said that<font color="#E5E5E5"> the more complex the system is</font>

1504
00:56:40,400 --> 00:56:45,140
the more attack surface it has<font color="#E5E5E5"> so</font><font color="#CCCCCC"> yeah</font>

1505
00:56:43,339 --> 00:56:46,999
there's always things that<font color="#CCCCCC"> you could</font><font color="#E5E5E5"> be</font>

1506
00:56:45,140 --> 00:56:48,618
<font color="#CCCCCC">looking</font><font color="#E5E5E5"> at even if you were just</font><font color="#CCCCCC"> getting</font>

1507
00:56:46,999 --> 00:56:50,569
started<font color="#CCCCCC"> in Active Directory security go</font>

1508
00:56:48,619 --> 00:56:51,739
poking<font color="#E5E5E5"> around reading</font><font color="#CCCCCC"> MSDN Docs</font><font color="#E5E5E5"> to</font>

1509
00:56:50,569 --> 00:56:53,288
probably find<font color="#E5E5E5"> something that no one's</font>

1510
00:56:51,739 --> 00:56:55,729
<font color="#CCCCCC">really looked at before</font>

1511
00:56:53,289 --> 00:56:58,039
you don't need<font color="#CCCCCC"> Windows to talk Windows</font>

1512
00:56:55,729 --> 00:56:59,598
if you do not like PowerShell don't

1513
00:56:58,039 --> 00:57:01,369
worry<font color="#E5E5E5"> you can</font><font color="#CCCCCC"> still be a Windows pen</font>

1514
00:56:59,599 --> 00:57:02,749
tester<font color="#E5E5E5"> that was the conflict I had a</font>

1515
00:57:01,369 --> 00:57:04,759
couple<font color="#E5E5E5"> years ago and then I found in</font>

1516
00:57:02,749 --> 00:57:08,660
packet it's just been<font color="#E5E5E5"> great</font>

1517
00:57:04,759 --> 00:57:09,979
so DNS LDAP Kerberos MSR PC you can just

1518
00:57:08,660 --> 00:57:11,299
use other tools<font color="#CCCCCC"> to talk to</font><font color="#E5E5E5"> those</font>

1519
00:57:09,979 --> 00:57:12,890
protocols<font color="#CCCCCC"> and you can still be an</font>

1520
00:57:11,299 --> 00:57:15,410
effective Windows<font color="#E5E5E5"> pentester security</font>

1521
00:57:12,890 --> 00:57:18,019
researcher with no net or C sharp<font color="#CCCCCC"> or</font>

1522
00:57:15,410 --> 00:57:19,279
PowerShell if you'd<font color="#CCCCCC"> like and then more</font>

1523
00:57:18,019 --> 00:57:22,368
tools and<font color="#E5E5E5"> techniques will make you a</font>

1524
00:57:19,279 --> 00:57:24,200
better<font color="#E5E5E5"> pen tester so go exploring some</font>

1525
00:57:22,369 --> 00:57:26,089
amazing<font color="#E5E5E5"> research is being done like even</font>

1526
00:57:24,200 --> 00:57:27,200
<font color="#CCCCCC">just this week at this</font><font color="#E5E5E5"> track there's</font>

1527
00:57:26,089 --> 00:57:28,970
such cool stuff<font color="#CCCCCC"> coming</font><font color="#E5E5E5"> out about</font>

1528
00:57:27,200 --> 00:57:31,700
Kerberos<font color="#CCCCCC"> I really think there's like</font>

1529
00:57:28,970 --> 00:57:34,339
more<font color="#E5E5E5"> to be found there and Kerberos is</font>

1530
00:57:31,700 --> 00:57:35,930
not as scary or as intimidating as<font color="#CCCCCC"> it</font>

1531
00:57:34,339 --> 00:57:37,640
might seem<font color="#E5E5E5"> because I was there once and</font>

1532
00:57:35,930 --> 00:57:39,469
I really<font color="#E5E5E5"> really enjoy</font><font color="#CCCCCC"> it now and there's</font>

1533
00:57:37,640 --> 00:57:42,019
still<font color="#E5E5E5"> things</font><font color="#CCCCCC"> that I love</font><font color="#E5E5E5"> learning</font><font color="#CCCCCC"> and</font>

1534
00:57:39,469 --> 00:57:44,180
impact it<font color="#E5E5E5"> is awesome and then a quick</font>

1535
00:57:42,019 --> 00:57:46,189
<font color="#CCCCCC">shout out no this is not the 80s</font>

1536
00:57:44,180 --> 00:57:48,379
<font color="#E5E5E5">security track speakers this was a slide</font>

1537
00:57:46,190 --> 00:57:49,849
<font color="#CCCCCC">that I created</font><font color="#E5E5E5"> beforehand</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> these just</font>

1538
00:57:48,380 --> 00:57:52,549
big shoutouts to guys that<font color="#CCCCCC"> I've learned</font>

1539
00:57:49,849 --> 00:57:55,789
a ton from<font color="#E5E5E5"> and countless more except</font>

1540
00:57:52,549 --> 00:57:57,259
sure I'm forgetting<font color="#E5E5E5"> people and these are</font>

1541
00:57:55,789 --> 00:57:59,119
<font color="#CCCCCC">the</font><font color="#E5E5E5"> slides are the three tools that</font><font color="#CCCCCC"> I</font>

1542
00:57:57,259 --> 00:58:01,190
<font color="#CCCCCC">mentioned her on github</font><font color="#E5E5E5"> like I</font><font color="#CCCCCC"> said I</font>

1543
00:57:59,119 --> 00:58:03,229
<font color="#E5E5E5">gave this as a workshop it was</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> almost</font>

1544
00:58:01,190 --> 00:58:05,779
three hour long workshop at<font color="#CCCCCC"> Khan last</font>

1545
00:58:03,229 --> 00:58:07,819
year my slides are posted<font color="#E5E5E5"> for that so if</font>

1546
00:58:05,779 --> 00:58:08,809
you enjoyed this<font color="#E5E5E5"> I would encourage you</font>

1547
00:58:07,819 --> 00:58:10,549
to<font color="#CCCCCC"> check that out there's more</font>

1548
00:58:08,809 --> 00:58:13,249
information deep diving<font color="#E5E5E5"> into like MSRP</font>

1549
00:58:10,549 --> 00:58:15,859
<font color="#E5E5E5">see for</font><font color="#CCCCCC"> example</font><font color="#E5E5E5"> but cool I think I've</font>

1550
00:58:13,249 --> 00:58:18,339
got time for a couple questions<font color="#E5E5E5"> thank</font>

1551
00:58:15,859 --> 00:58:18,339
you<font color="#CCCCCC"> very</font><font color="#E5E5E5"> much</font>

1552
00:58:23,160 --> 00:58:36,460
any questions<font color="#E5E5E5"> thank you for to talk</font><font color="#CCCCCC"> um</font>

1553
00:58:34,600 --> 00:58:37,839
you mentioned<font color="#E5E5E5"> the</font><font color="#CCCCCC"> a lab search for the</font>

1554
00:58:36,460 --> 00:58:40,330
enumeration process

1555
00:58:37,840 --> 00:58:42,790
did you ever discover a client that uses

1556
00:58:40,330 --> 00:58:45,520
<font color="#E5E5E5">search flags</font><font color="#CCCCCC"> to as a part of a</font>

1557
00:58:42,790 --> 00:58:50,980
mitigation<font color="#E5E5E5"> so that you cannot query that</font>

1558
00:58:45,520 --> 00:58:52,840
much from the<font color="#CCCCCC"> ad</font><font color="#E5E5E5"> a great question no but</font>

1559
00:58:50,980 --> 00:58:54,520
my sample size is<font color="#CCCCCC"> small so I've</font><font color="#E5E5E5"> actually</font>

1560
00:58:52,840 --> 00:58:56,410
been deferring<font color="#CCCCCC"> a lot to</font><font color="#E5E5E5"> someone like the</font>

1561
00:58:54,520 --> 00:58:58,000
more prolific<font color="#E5E5E5"> red teamers that are here</font>

1562
00:58:56,410 --> 00:58:59,799
who work with larger<font color="#CCCCCC"> organizations to</font>

1563
00:58:58,000 --> 00:59:01,360
see if those mitigations are<font color="#E5E5E5"> in place I</font>

1564
00:58:59,800 --> 00:59:02,680
haven't<font color="#E5E5E5"> personally encountered</font><font color="#CCCCCC"> it but</font>

1565
00:59:01,360 --> 00:59:03,700
that<font color="#E5E5E5"> doesn't mean that that</font><font color="#CCCCCC"> no one is</font>

1566
00:59:02,680 --> 00:59:07,500
out there<font color="#CCCCCC"> using it</font><font color="#E5E5E5"> but it's a great</font>

1567
00:59:03,700 --> 00:59:07,500
great mitigation for sure thanks again

