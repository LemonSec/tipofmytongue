1
00:00:04,410 --> 00:00:13,059
it is 10:30 welcome to the<font color="#CCCCCC"> Active</font>

2
00:00:08,680 --> 00:00:15,489
<font color="#CCCCCC">Directory Trek</font><font color="#E5E5E5"> and I would like</font><font color="#CCCCCC"> to</font>

3
00:00:13,059 --> 00:00:18,850
warmly<font color="#E5E5E5"> welcome Sean</font><font color="#CCCCCC"> Metcalfe it's</font><font color="#E5E5E5"> really</font>

4
00:00:15,490 --> 00:00:20,500
a great<font color="#E5E5E5"> pleasure and honor to have to</font>

5
00:00:18,850 --> 00:00:24,160
have you here in our Active Directory

6
00:00:20,500 --> 00:00:26,770
<font color="#CCCCCC">tech and</font><font color="#E5E5E5"> we are excited we will be</font>

7
00:00:24,160 --> 00:00:29,950
excited about<font color="#E5E5E5"> the journey and we would</font>

8
00:00:26,770 --> 00:00:32,019
like to<font color="#CCCCCC"> go</font><font color="#E5E5E5"> with you and your knowledge</font>

9
00:00:29,950 --> 00:00:42,940
<font color="#E5E5E5">so thank you very much</font>

10
00:00:32,020 --> 00:00:44,019
and the stage is yours thank you good

11
00:00:42,940 --> 00:00:46,089
morning

12
00:00:44,019 --> 00:00:47,980
this is<font color="#E5E5E5"> Active Directory security the</font>

13
00:00:46,089 --> 00:00:51,729
journey and I'm Sean Metcalfe this kind

14
00:00:47,980 --> 00:00:53,379
<font color="#E5E5E5">of a fun title is well it's fun for</font><font color="#CCCCCC"> me</font>

15
00:00:51,729 --> 00:00:55,748
because<font color="#E5E5E5"> it means I can talk about pretty</font>

16
00:00:53,379 --> 00:00:56,888
<font color="#E5E5E5">much whatever I want to but we're gonna</font>

17
00:00:55,749 --> 00:00:58,479
we're gonna go through the<font color="#E5E5E5"> journey of</font>

18
00:00:56,889 --> 00:01:00,219
Active Directory where we've been and

19
00:00:58,479 --> 00:01:03,219
where<font color="#E5E5E5"> we're headed</font>

20
00:01:00,219 --> 00:01:05,790
potentially so I'm Sean<font color="#CCCCCC"> Metcalf the fine</font>

21
00:01:03,219 --> 00:01:07,600
dirt founder<font color="#E5E5E5"> Trimark we help</font>

22
00:01:05,790 --> 00:01:09,190
<font color="#E5E5E5">organizations and companies better</font>

23
00:01:07,600 --> 00:01:12,070
secure their Microsoft platform<font color="#E5E5E5"> on</font>

24
00:01:09,190 --> 00:01:13,300
<font color="#E5E5E5">premise and in the cloud Microsoft</font>

25
00:01:12,070 --> 00:01:14,580
Certified Master<font color="#CCCCCC"> an Active Directory</font>

26
00:01:13,300 --> 00:01:16,660
<font color="#CCCCCC">there's about a hundred</font><font color="#E5E5E5"> in the world</font>

27
00:01:14,580 --> 00:01:19,810
<font color="#E5E5E5">most of whom actually</font><font color="#CCCCCC"> work for Microsoft</font>

28
00:01:16,660 --> 00:01:21,520
<font color="#CCCCCC">I don't I spoken at a number of</font>

29
00:01:19,810 --> 00:01:23,710
conferences very happy to be<font color="#E5E5E5"> here at</font>

30
00:01:21,520 --> 00:01:25,750
troopers in beautiful Heidelberg<font color="#E5E5E5"> the</font>

31
00:01:23,710 --> 00:01:26,470
weather is very<font color="#E5E5E5"> nice here so I'm</font>

32
00:01:25,750 --> 00:01:28,240
enjoying<font color="#E5E5E5"> this</font>

33
00:01:26,470 --> 00:01:29,920
<font color="#CCCCCC">I have security consultant and a</font>

34
00:01:28,240 --> 00:01:31,720
researcher and I own and operate<font color="#E5E5E5"> 80</font>

35
00:01:29,920 --> 00:01:33,640
<font color="#CCCCCC">security org which hopefully many of you</font>

36
00:01:31,720 --> 00:01:35,320
have been to before<font color="#E5E5E5"> where I post</font>

37
00:01:33,640 --> 00:01:38,020
interesting<font color="#CCCCCC"> information about Microsoft</font>

38
00:01:35,320 --> 00:01:39,490
platform<font color="#CCCCCC"> security so the agenda</font><font color="#E5E5E5"> like I</font>

39
00:01:38,020 --> 00:01:41,289
said is this a journey of Active

40
00:01:39,490 --> 00:01:43,360
Directory security what is<font color="#CCCCCC"> it where have</font>

41
00:01:41,290 --> 00:01:46,390
we been<font color="#CCCCCC"> where</font><font color="#E5E5E5"> we had it what is the</font>

42
00:01:43,360 --> 00:01:49,570
current state and how can<font color="#E5E5E5"> we make things</font>

43
00:01:46,390 --> 00:01:51,670
better for<font color="#CCCCCC"> our company or organization</font>

44
00:01:49,570 --> 00:01:54,490
and our customers if we're if we have

45
00:01:51,670 --> 00:01:55,840
consultants here so we're gonna start

46
00:01:54,490 --> 00:01:58,720
<font color="#CCCCCC">with the current</font><font color="#E5E5E5"> state of Active</font>

47
00:01:55,840 --> 00:01:59,080
Directory<font color="#E5E5E5"> so the good the bad and the</font>

48
00:01:58,720 --> 00:02:02,039
ugly

49
00:01:59,080 --> 00:02:05,530
and quite<font color="#E5E5E5"> honestly it's it's fairly ugly</font>

50
00:02:02,040 --> 00:02:07,900
in a lot<font color="#CCCCCC"> of cases</font><font color="#E5E5E5"> we start with the good</font>

51
00:02:05,530 --> 00:02:09,720
so there are some good<font color="#E5E5E5"> things there's a</font>

52
00:02:07,900 --> 00:02:11,409
better<font color="#E5E5E5"> awareness of the importance of</font><font color="#CCCCCC"> AD</font>

53
00:02:09,720 --> 00:02:14,140
obviously there's an Active Directory

54
00:02:11,409 --> 00:02:16,340
security track here at troopers so that

55
00:02:14,140 --> 00:02:17,869
there's awareness

56
00:02:16,340 --> 00:02:20,930
<font color="#CCCCCC">our thorough testing of Active Directory</font>

57
00:02:17,870 --> 00:02:22,879
security so tools like<font color="#E5E5E5"> bloodhound</font><font color="#CCCCCC"> and</font>

58
00:02:20,930 --> 00:02:26,360
the focus on Active Directory at large

59
00:02:22,879 --> 00:02:29,329
means that the things that<font color="#CCCCCC"> have</font><font color="#E5E5E5"> gone and</font>

60
00:02:26,360 --> 00:02:31,519
have been ignored<font color="#CCCCCC"> over time are starting</font>

61
00:02:29,330 --> 00:02:34,280
to be looked at and started to<font color="#E5E5E5"> people</font>

62
00:02:31,519 --> 00:02:36,260
are starting<font color="#CCCCCC"> to dig</font><font color="#E5E5E5"> into that there's</font>

63
00:02:34,280 --> 00:02:39,019
less domain admins<font color="#E5E5E5"> well overall there</font>

64
00:02:36,260 --> 00:02:40,970
<font color="#CCCCCC">are</font><font color="#E5E5E5"> maybe there used to be</font><font color="#CCCCCC"> 200 now</font>

65
00:02:39,019 --> 00:02:44,599
there's 70 that's<font color="#E5E5E5"> better</font>

66
00:02:40,970 --> 00:02:47,269
<font color="#CCCCCC">ish right well has credentials</font><font color="#E5E5E5"> and group</font>

67
00:02:44,599 --> 00:02:48,590
<font color="#E5E5E5">policy</font><font color="#CCCCCC"> preferences</font><font color="#E5E5E5"> we do security</font>

68
00:02:47,269 --> 00:02:50,180
assessments for Active Directory and<font color="#E5E5E5"> we</font>

69
00:02:48,590 --> 00:02:52,790
see less<font color="#E5E5E5"> and less of these there aren't</font>

70
00:02:50,180 --> 00:02:55,099
none<font color="#E5E5E5"> which would be ideal but it's much</font>

71
00:02:52,790 --> 00:02:56,720
better than it<font color="#CCCCCC"> has</font><font color="#E5E5E5"> been and ultimately</font>

72
00:02:55,099 --> 00:02:59,119
more of the<font color="#E5E5E5"> local admin passwords are</font>

73
00:02:56,720 --> 00:03:00,920
getting automatically changed<font color="#E5E5E5"> via</font>

74
00:02:59,120 --> 00:03:03,280
something<font color="#E5E5E5"> like Microsoft local</font><font color="#CCCCCC"> add and</font>

75
00:03:00,920 --> 00:03:05,119
password solution or something else<font color="#CCCCCC"> our</font>

76
00:03:03,280 --> 00:03:06,590
organizations are<font color="#E5E5E5"> starting to deploy</font>

77
00:03:05,120 --> 00:03:08,720
this so<font color="#E5E5E5"> that's much better because</font>

78
00:03:06,590 --> 00:03:10,790
otherwise and an attacker can get on one

79
00:03:08,720 --> 00:03:12,049
<font color="#E5E5E5">system dump the local Sam and get those</font>

80
00:03:10,790 --> 00:03:15,078
credentials<font color="#E5E5E5"> and then jump</font><font color="#CCCCCC"> to another</font>

81
00:03:12,049 --> 00:03:17,870
<font color="#E5E5E5">system</font><font color="#CCCCCC"> and in</font><font color="#E5E5E5"> often</font><font color="#CCCCCC"> cases</font><font color="#E5E5E5"> this can</font><font color="#CCCCCC"> even</font>

82
00:03:15,079 --> 00:03:19,400
occur if you<font color="#CCCCCC"> have a build process that</font>

83
00:03:17,870 --> 00:03:22,670
sets that same password for<font color="#E5E5E5"> everything</font>

84
00:03:19,400 --> 00:03:25,040
<font color="#CCCCCC">and</font><font color="#E5E5E5"> so even your non domain join systems</font>

85
00:03:22,670 --> 00:03:28,089
may have<font color="#CCCCCC"> the same</font><font color="#E5E5E5"> local admin passwords</font>

86
00:03:25,040 --> 00:03:30,019
<font color="#E5E5E5">as your domain join systems and</font>

87
00:03:28,090 --> 00:03:33,709
PowerShell security has gotten much

88
00:03:30,019 --> 00:03:35,569
better<font color="#E5E5E5"> in version 5 from tube 3 4 all</font>

89
00:03:33,709 --> 00:03:38,590
<font color="#CCCCCC">the way up</font><font color="#E5E5E5"> not everyone is deployed</font>

90
00:03:35,569 --> 00:03:41,540
version<font color="#E5E5E5"> 5 yet</font><font color="#CCCCCC"> but it's</font><font color="#E5E5E5"> getting there</font><font color="#CCCCCC"> now</font>

91
00:03:38,590 --> 00:03:41,959
<font color="#CCCCCC">let's kind of</font><font color="#E5E5E5"> look at the bad and the</font>

92
00:03:41,540 --> 00:03:44,209
<font color="#CCCCCC">ugly</font>

93
00:03:41,959 --> 00:03:45,380
so obviously too many domain admins or

94
00:03:44,209 --> 00:03:47,329
<font color="#E5E5E5">Active Directory admins are still</font>

95
00:03:45,380 --> 00:03:49,668
administering Active Directory<font color="#E5E5E5"> from</font>

96
00:03:47,329 --> 00:03:51,739
their standard<font color="#E5E5E5"> workstation lies is bad</font>

97
00:03:49,669 --> 00:03:54,709
<font color="#CCCCCC">well think</font><font color="#E5E5E5"> about how</font><font color="#CCCCCC"> many</font><font color="#E5E5E5"> people have</font>

98
00:03:51,739 --> 00:03:57,380
admin<font color="#CCCCCC"> rights</font><font color="#E5E5E5"> or access</font><font color="#CCCCCC"> to install or run</font>

99
00:03:54,709 --> 00:04:00,530
code<font color="#CCCCCC"> on that</font><font color="#E5E5E5"> workstation there's</font>

100
00:03:57,380 --> 00:04:03,019
<font color="#E5E5E5">probably one to 20 agents on that</font>

101
00:04:00,530 --> 00:04:05,359
<font color="#E5E5E5">workstation from antivirus to patching</font>

102
00:04:03,019 --> 00:04:07,280
to management<font color="#CCCCCC"> including a</font><font color="#E5E5E5"> number of</font>

103
00:04:05,359 --> 00:04:10,940
people<font color="#CCCCCC"> that are typically in a helpdesk</font>

104
00:04:07,280 --> 00:04:12,380
<font color="#E5E5E5">group or a local workstation admin group</font>

105
00:04:10,940 --> 00:04:14,599
they<font color="#CCCCCC"> all have rights of</font><font color="#E5E5E5"> these</font>

106
00:04:12,380 --> 00:04:17,870
workstations<font color="#CCCCCC"> compromised of that could</font>

107
00:04:14,599 --> 00:04:20,120
then jump and pivot to the<font color="#E5E5E5"> domain admin</font>

108
00:04:17,870 --> 00:04:21,769
or Active Directory admin and so

109
00:04:20,120 --> 00:04:23,960
privilege escalation from<font color="#E5E5E5"> this regular</font>

110
00:04:21,769 --> 00:04:27,020
user<font color="#E5E5E5"> all the way up is is still too easy</font>

111
00:04:23,960 --> 00:04:29,570
<font color="#CCCCCC">that's part of the reason why</font>

112
00:04:27,020 --> 00:04:32,419
there's a lot of<font color="#CCCCCC"> legacy stuff that</font>

113
00:04:29,570 --> 00:04:34,730
reduces the security mainframes<font color="#E5E5E5"> still</font>

114
00:04:32,420 --> 00:04:36,620
have a<font color="#E5E5E5"> requirement of a certain password</font>

115
00:04:34,730 --> 00:04:38,330
length<font color="#E5E5E5"> in environments that have to</font>

116
00:04:36,620 --> 00:04:41,210
interoperate<font color="#E5E5E5"> with mainframes this means</font>

117
00:04:38,330 --> 00:04:42,530
that the<font color="#E5E5E5"> Active</font><font color="#CCCCCC"> Directory user password</font>

118
00:04:41,210 --> 00:04:45,109
<font color="#E5E5E5">length is probably going</font><font color="#CCCCCC"> to be about</font>

119
00:04:42,530 --> 00:04:47,869
<font color="#CCCCCC">seven</font><font color="#E5E5E5"> or</font><font color="#CCCCCC"> eight characters</font><font color="#E5E5E5"> it's not</font><font color="#CCCCCC"> great</font>

120
00:04:45,110 --> 00:04:50,240
<font color="#CCCCCC">and still not enough</font><font color="#E5E5E5"> PowerShell logging</font>

121
00:04:47,870 --> 00:04:52,130
deployed<font color="#E5E5E5"> even</font><font color="#CCCCCC"> organizations have that of</font>

122
00:04:50,240 --> 00:04:53,870
deployed version<font color="#CCCCCC"> 4 a version 5 still</font>

123
00:04:52,130 --> 00:04:55,250
<font color="#E5E5E5">aren't necessarily configuring the</font>

124
00:04:53,870 --> 00:04:56,900
logging on it so they're<font color="#CCCCCC"> not</font><font color="#E5E5E5"> getting</font>

125
00:04:55,250 --> 00:04:59,210
that<font color="#E5E5E5"> additional detail of what's going</font>

126
00:04:56,900 --> 00:05:01,609
on<font color="#E5E5E5"> in PowerShell and there's still too</font>

127
00:04:59,210 --> 00:05:03,320
<font color="#E5E5E5">many blind spots why is this not enough</font>

128
00:05:01,610 --> 00:05:04,880
visibility<font color="#CCCCCC"> of what's going</font><font color="#E5E5E5"> on in Active</font>

129
00:05:03,320 --> 00:05:06,800
Directory<font color="#CCCCCC"> while logging</font><font color="#E5E5E5"> is not</font>

130
00:05:04,880 --> 00:05:09,590
configured<font color="#CCCCCC"> the way that it should</font><font color="#E5E5E5"> be on</font>

131
00:05:06,800 --> 00:05:10,880
domain controllers<font color="#E5E5E5"> on in the environment</font>

132
00:05:09,590 --> 00:05:13,940
to<font color="#E5E5E5"> better understand and see what's</font>

133
00:05:10,880 --> 00:05:16,400
going on<font color="#E5E5E5"> and in there and the ugly</font>

134
00:05:13,940 --> 00:05:19,310
so in 2018 cyber security spending hit

135
00:05:16,400 --> 00:05:20,840
<font color="#CCCCCC">around 90 billion dollars</font><font color="#E5E5E5"> u.s. there's a</font>

136
00:05:19,310 --> 00:05:22,490
lot of money does anyone feel it's

137
00:05:20,840 --> 00:05:24,950
gotten<font color="#CCCCCC"> that much better ninety billion</font>

138
00:05:22,490 --> 00:05:27,320
<font color="#CCCCCC">dollars worth no I don't think so</font>

139
00:05:24,950 --> 00:05:28,729
we still have attacks<font color="#E5E5E5"> today</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> don't</font>

140
00:05:27,320 --> 00:05:30,380
<font color="#E5E5E5">think the attack detection has gotten</font>

141
00:05:28,730 --> 00:05:34,520
<font color="#E5E5E5">that much better not certainly not</font>

142
00:05:30,380 --> 00:05:37,000
<font color="#CCCCCC">ninety billion dollars worth and</font><font color="#E5E5E5"> now we</font>

143
00:05:34,520 --> 00:05:40,760
have<font color="#E5E5E5"> more ransom in crypto</font><font color="#CCCCCC"> where right</font>

144
00:05:37,000 --> 00:05:42,650
<font color="#E5E5E5">crypto miners in organizations a lot</font><font color="#CCCCCC"> of</font>

145
00:05:40,760 --> 00:05:45,289
attackers<font color="#E5E5E5"> that have gone from I've gone</font>

146
00:05:42,650 --> 00:05:48,109
from encrypting things and<font color="#E5E5E5"> saying we</font>

147
00:05:45,290 --> 00:05:51,560
need<font color="#E5E5E5"> a ransom to release this to let's</font>

148
00:05:48,110 --> 00:05:53,270
<font color="#E5E5E5">just go ahead and mine Bitcoin or</font>

149
00:05:51,560 --> 00:05:54,740
<font color="#E5E5E5">something else on there and make some</font>

150
00:05:53,270 --> 00:05:56,870
<font color="#CCCCCC">money that</font><font color="#E5E5E5"> way</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> just use those</font>

151
00:05:54,740 --> 00:05:58,550
<font color="#CCCCCC">resources and some organizations are</font>

152
00:05:56,870 --> 00:06:00,680
<font color="#CCCCCC">realizing that</font><font color="#E5E5E5"> their cloud resources</font><font color="#CCCCCC"> are</font>

153
00:05:58,550 --> 00:06:02,419
being<font color="#E5E5E5"> used</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> this which can</font><font color="#CCCCCC"> result in</font>

154
00:06:00,680 --> 00:06:07,010
a huge AWS bill that they weren't

155
00:06:02,419 --> 00:06:08,960
expecting<font color="#E5E5E5"> so where where were we how did</font>

156
00:06:07,010 --> 00:06:12,080
we get<font color="#E5E5E5"> to this point well</font><font color="#CCCCCC"> we were an</font>

157
00:06:08,960 --> 00:06:14,330
environment where Active Directory<font color="#CCCCCC"> was</font>

158
00:06:12,080 --> 00:06:16,010
being released in the<font color="#E5E5E5"> year 2000 and</font><font color="#CCCCCC"> the</font>

159
00:06:14,330 --> 00:06:18,979
operating system is Windows Server

160
00:06:16,010 --> 00:06:21,530
<font color="#E5E5E5">Windows 2000 server there were some key</font>

161
00:06:18,979 --> 00:06:24,050
design decisions<font color="#CCCCCC"> that were made</font><font color="#E5E5E5"> in the</font>

162
00:06:21,530 --> 00:06:26,750
<font color="#E5E5E5">late 90s for Active Directory which</font>

163
00:06:24,050 --> 00:06:28,450
persists to this day<font color="#E5E5E5"> and really impact</font>

164
00:06:26,750 --> 00:06:31,100
<font color="#E5E5E5">the security</font><font color="#CCCCCC"> of the environment</font>

165
00:06:28,450 --> 00:06:33,110
<font color="#CCCCCC">Microsoft</font><font color="#E5E5E5"> was extremely scared about</font>

166
00:06:31,100 --> 00:06:35,419
replication<font color="#E5E5E5"> because</font><font color="#CCCCCC"> they weren't</font><font color="#E5E5E5"> sure</font>

167
00:06:33,110 --> 00:06:38,570
<font color="#E5E5E5">how that would</font><font color="#CCCCCC"> actually work on a</font><font color="#E5E5E5"> very</font>

168
00:06:35,419 --> 00:06:40,260
big scale<font color="#E5E5E5"> so wherever possible they</font>

169
00:06:38,570 --> 00:06:41,820
minimized replication they

170
00:06:40,260 --> 00:06:43,349
<font color="#E5E5E5">said this Kerberos thing looks</font><font color="#CCCCCC"> pretty</font>

171
00:06:41,820 --> 00:06:46,620
good<font color="#E5E5E5"> let's take that and add some stuff</font>

172
00:06:43,350 --> 00:06:48,180
<font color="#CCCCCC">to it and make it</font><font color="#E5E5E5"> better</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> and so we</font>

173
00:06:46,620 --> 00:06:50,490
have Kerberos in Active Directory as one

174
00:06:48,180 --> 00:06:52,770
of<font color="#E5E5E5"> the key</font><font color="#CCCCCC"> components or authentication</font>

175
00:06:50,490 --> 00:06:55,110
methods in Active Directory<font color="#CCCCCC"> but we still</font>

176
00:06:52,770 --> 00:06:58,109
have ntlm why because Microsoft wanted

177
00:06:55,110 --> 00:06:59,700
<font color="#E5E5E5">to ease this path from</font><font color="#CCCCCC"> NT over to Active</font>

178
00:06:58,110 --> 00:07:01,020
Directory<font color="#CCCCCC"> which meant there were a lot</font>

179
00:06:59,700 --> 00:07:03,240
<font color="#CCCCCC">of these design decisions</font><font color="#E5E5E5"> and</font>

180
00:07:01,020 --> 00:07:05,789
configurations with compatibility<font color="#CCCCCC"> as one</font>

181
00:07:03,240 --> 00:07:07,920
of<font color="#CCCCCC"> their overriding factors and we still</font>

182
00:07:05,790 --> 00:07:09,870
have<font color="#E5E5E5"> that issue today Microsoft's</font>

183
00:07:07,920 --> 00:07:11,430
commitment compatibility is one of the

184
00:07:09,870 --> 00:07:13,490
reasons why we have so<font color="#E5E5E5"> many security</font>

185
00:07:11,430 --> 00:07:15,570
issues in a Microsoft environment<font color="#E5E5E5"> today</font>

186
00:07:13,490 --> 00:07:17,040
<font color="#E5E5E5">unlike</font><font color="#CCCCCC"> Apple</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> it will kill</font><font color="#E5E5E5"> off a</font>

187
00:07:15,570 --> 00:07:19,680
feature in two months<font color="#CCCCCC"> without much</font>

188
00:07:17,040 --> 00:07:22,560
warning<font color="#E5E5E5"> but you know that's it's the</font>

189
00:07:19,680 --> 00:07:24,870
<font color="#E5E5E5">given that take so what I call Active</font>

190
00:07:22,560 --> 00:07:27,300
Directory version 2 version 3<font color="#E5E5E5"> was really</font>

191
00:07:24,870 --> 00:07:31,440
the 2003<font color="#E5E5E5"> timeframe</font><font color="#CCCCCC"> so Windows Server</font>

192
00:07:27,300 --> 00:07:33,660
Windows 2003 server was deployed got

193
00:07:31,440 --> 00:07:34,880
rolled out all the way up and<font color="#E5E5E5"> each of</font>

194
00:07:33,660 --> 00:07:37,400
<font color="#E5E5E5">these service packs</font><font color="#CCCCCC"> got</font><font color="#E5E5E5"> released</font>

195
00:07:34,880 --> 00:07:40,080
<font color="#E5E5E5">dramatically improved Active Directory</font>

196
00:07:37,400 --> 00:07:42,750
<font color="#E5E5E5">reliability replication capability and</font>

197
00:07:40,080 --> 00:07:44,789
the security components<font color="#E5E5E5"> and so we had a</font>

198
00:07:42,750 --> 00:07:46,440
new<font color="#E5E5E5"> attribute at it called the last</font>

199
00:07:44,790 --> 00:07:48,060
<font color="#E5E5E5">logon timestamp a lot of you probably</font>

200
00:07:46,440 --> 00:07:50,280
<font color="#E5E5E5">have used this to track when people have</font>

201
00:07:48,060 --> 00:07:53,820
logged in to<font color="#CCCCCC"> identify</font><font color="#E5E5E5"> what users and</font>

202
00:07:50,280 --> 00:07:56,429
computers are<font color="#CCCCCC"> inactive or stale and then</font>

203
00:07:53,820 --> 00:07:58,500
Microsoft<font color="#E5E5E5"> said well the way that we did</font>

204
00:07:56,430 --> 00:08:00,750
<font color="#E5E5E5">Kerberos delegation when we released</font>

205
00:07:58,500 --> 00:08:04,190
Active Directory was not ideal<font color="#E5E5E5"> because</font>

206
00:08:00,750 --> 00:08:07,530
it<font color="#CCCCCC"> basically said if you can delegate to</font>

207
00:08:04,190 --> 00:08:08,790
<font color="#CCCCCC">this</font><font color="#E5E5E5"> then</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> can basically impersonate</font>

208
00:08:07,530 --> 00:08:10,799
<font color="#E5E5E5">them to anything</font>

209
00:08:08,790 --> 00:08:12,270
so with<font color="#E5E5E5"> constrain delegation we're going</font>

210
00:08:10,800 --> 00:08:14,520
to lock<font color="#CCCCCC"> that down to</font><font color="#E5E5E5"> just these Kerberos</font>

211
00:08:12,270 --> 00:08:16,650
services here which is much better<font color="#E5E5E5"> than</font>

212
00:08:14,520 --> 00:08:18,719
what<font color="#CCCCCC"> it was and I'll show</font><font color="#E5E5E5"> you why in a</font>

213
00:08:16,650 --> 00:08:20,310
<font color="#CCCCCC">little while and then selective</font>

214
00:08:18,720 --> 00:08:24,510
authentication for<font color="#CCCCCC"> trusts as a way to</font>

215
00:08:20,310 --> 00:08:26,220
say trust<font color="#E5E5E5"> you but only this much and so</font>

216
00:08:24,510 --> 00:08:29,400
with the<font color="#CCCCCC"> Selective authentication</font><font color="#E5E5E5"> we can</font>

217
00:08:26,220 --> 00:08:31,200
have a trust between<font color="#E5E5E5"> two forests and the</font>

218
00:08:29,400 --> 00:08:33,240
users that<font color="#CCCCCC"> are in</font><font color="#E5E5E5"> this other force that</font>

219
00:08:31,200 --> 00:08:35,880
are connecting in our forest<font color="#E5E5E5"> can only</font>

220
00:08:33,240 --> 00:08:37,440
see and<font color="#CCCCCC"> access what we want them to now</font>

221
00:08:35,880 --> 00:08:38,909
there is some overhead<font color="#E5E5E5"> to that there's</font>

222
00:08:37,440 --> 00:08:41,280
actually quite a<font color="#E5E5E5"> bit of overhead because</font>

223
00:08:38,909 --> 00:08:43,020
that means<font color="#E5E5E5"> I need to track what all</font><font color="#CCCCCC"> of</font>

224
00:08:41,280 --> 00:08:45,000
those users<font color="#E5E5E5"> or all</font><font color="#CCCCCC"> of those groups and</font>

225
00:08:43,020 --> 00:08:46,860
<font color="#E5E5E5">now the other forest actually</font><font color="#CCCCCC"> need to</font>

226
00:08:45,000 --> 00:08:50,010
access<font color="#CCCCCC"> and</font>

227
00:08:46,860 --> 00:08:54,029
then explicitly allow them to access<font color="#E5E5E5"> it</font>

228
00:08:50,010 --> 00:08:56,279
<font color="#E5E5E5">so</font><font color="#CCCCCC"> a lot of</font><font color="#E5E5E5"> organizations deploy Active</font>

229
00:08:54,029 --> 00:08:57,720
<font color="#E5E5E5">Directory</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> then we go into this world</font>

230
00:08:56,279 --> 00:08:59,310
where<font color="#E5E5E5"> Microsoft says oh right let's</font>

231
00:08:57,720 --> 00:09:02,160
let's add some additional<font color="#E5E5E5"> security let's</font>

232
00:08:59,310 --> 00:09:04,199
add some better performance<font color="#E5E5E5"> 2008 2008 r2</font>

233
00:09:02,160 --> 00:09:06,329
is really where Microsoft hit their

234
00:09:04,200 --> 00:09:08,700
stride with a lot<font color="#E5E5E5"> of these features</font><font color="#CCCCCC"> we</font>

235
00:09:06,329 --> 00:09:10,260
get the<font color="#E5E5E5"> 80 recycle bin last interactive</font>

236
00:09:08,700 --> 00:09:11,899
logon information<font color="#CCCCCC"> so the user can</font>

237
00:09:10,260 --> 00:09:14,040
<font color="#CCCCCC">actually see when they last logged on</font>

238
00:09:11,899 --> 00:09:16,290
fine-grained password policies<font color="#CCCCCC"> this is</font>

239
00:09:14,040 --> 00:09:17,849
<font color="#E5E5E5">great</font><font color="#CCCCCC"> ok so we recognize that we have</font>

240
00:09:16,290 --> 00:09:19,290
mainframes<font color="#E5E5E5"> in our environment and we're</font>

241
00:09:17,850 --> 00:09:22,100
<font color="#CCCCCC">gonna</font><font color="#E5E5E5"> keep them active directory</font>

242
00:09:19,290 --> 00:09:25,290
password policy default of<font color="#CCCCCC"> 7 characters</font>

243
00:09:22,100 --> 00:09:27,000
<font color="#E5E5E5">sure why not but now what we're gonna do</font>

244
00:09:25,290 --> 00:09:29,459
is<font color="#E5E5E5"> create a fine-grained password policy</font>

245
00:09:27,000 --> 00:09:31,800
and apply it to all admins<font color="#E5E5E5"> and say your</font>

246
00:09:29,459 --> 00:09:33,359
password<font color="#CCCCCC"> has to be 16 characters and</font>

247
00:09:31,800 --> 00:09:35,490
we're gonna say all the service accounts

248
00:09:33,360 --> 00:09:38,310
your passwords<font color="#E5E5E5"> have to be 25 characters</font>

249
00:09:35,490 --> 00:09:40,050
and they're gonna<font color="#E5E5E5"> change once a year or</font>

250
00:09:38,310 --> 00:09:40,579
twice<font color="#E5E5E5"> every</font><font color="#CCCCCC"> two years</font><font color="#E5E5E5"> or</font><font color="#CCCCCC"> something like</font>

251
00:09:40,050 --> 00:09:43,290
that

252
00:09:40,579 --> 00:09:46,019
authentication mechanism insurance is

253
00:09:43,290 --> 00:09:48,420
this<font color="#E5E5E5"> feature where</font><font color="#CCCCCC"> we can say this</font><font color="#E5E5E5"> is</font>

254
00:09:46,019 --> 00:09:50,850
how<font color="#CCCCCC"> a person logged on they use the</font>

255
00:09:48,420 --> 00:09:52,979
smart card<font color="#E5E5E5"> or they use a username and a</font>

256
00:09:50,850 --> 00:09:54,390
password<font color="#E5E5E5"> and then we can define</font><font color="#CCCCCC"> what</font>

257
00:09:52,980 --> 00:09:57,720
they can<font color="#CCCCCC"> access based on</font><font color="#E5E5E5"> that</font>

258
00:09:54,390 --> 00:09:59,490
information<font color="#E5E5E5"> managed service counts where</font>

259
00:09:57,720 --> 00:10:01,589
Active Directory itself manages that

260
00:09:59,490 --> 00:10:03,510
<font color="#CCCCCC">password and then evolved into group</font>

261
00:10:01,589 --> 00:10:04,680
managed service accounts and Microsoft

262
00:10:03,510 --> 00:10:06,540
gave it the capability where it can

263
00:10:04,680 --> 00:10:10,319
manage that<font color="#CCCCCC"> curb</font><font color="#E5E5E5"> reserves principle name</font>

264
00:10:06,540 --> 00:10:13,230
or<font color="#E5E5E5"> spend and Microsoft said goodbye to</font>

265
00:10:10,320 --> 00:10:16,890
<font color="#E5E5E5">des finally and introduced AES as a</font>

266
00:10:13,230 --> 00:10:19,050
Kerberos option great<font color="#E5E5E5"> so then we go</font>

267
00:10:16,890 --> 00:10:21,060
forward into<font color="#E5E5E5"> 2012 and 2012 r2 and</font>

268
00:10:19,050 --> 00:10:22,769
Microsoft really focuses on<font color="#CCCCCC"> how to</font>

269
00:10:21,060 --> 00:10:24,119
<font color="#E5E5E5">protect these credentials they recognize</font>

270
00:10:22,769 --> 00:10:26,730
some mistakes in<font color="#E5E5E5"> the</font><font color="#CCCCCC"> way that they</font>

271
00:10:24,120 --> 00:10:29,370
manage credentials such as for example

272
00:10:26,730 --> 00:10:31,170
<font color="#CCCCCC">if you already</font><font color="#E5E5E5"> peed</font><font color="#CCCCCC"> into a server</font><font color="#E5E5E5"> and</font>

273
00:10:29,370 --> 00:10:32,940
<font color="#E5E5E5">you</font><font color="#CCCCCC"> did what you need to and then you</font>

274
00:10:31,170 --> 00:10:34,380
logged off that server<font color="#E5E5E5"> would actually</font>

275
00:10:32,940 --> 00:10:37,500
keep your credentials in memory and

276
00:10:34,380 --> 00:10:40,110
<font color="#CCCCCC">alsace for ever pretty much until it</font>

277
00:10:37,500 --> 00:10:43,500
reboots<font color="#CCCCCC"> Microsoft fix a lot</font><font color="#E5E5E5"> of that and</font>

278
00:10:40,110 --> 00:10:45,570
the shift in security<font color="#CCCCCC"> focused to what is</font>

279
00:10:43,500 --> 00:10:48,720
<font color="#E5E5E5">actually the</font><font color="#CCCCCC"> problem how do we fix this</font>

280
00:10:45,570 --> 00:10:51,480
how do<font color="#E5E5E5"> we really lock down windows to a</font>

281
00:10:48,720 --> 00:10:53,550
better<font color="#CCCCCC"> state as shown in</font><font color="#E5E5E5"> this protected</font>

282
00:10:51,480 --> 00:10:56,010
<font color="#E5E5E5">users group which is highly recommend</font>

283
00:10:53,550 --> 00:10:57,420
that<font color="#CCCCCC"> if you have this group available to</font>

284
00:10:56,010 --> 00:10:59,300
you in<font color="#CCCCCC"> your environment which is when</font>

285
00:10:57,420 --> 00:11:02,599
you<font color="#E5E5E5"> have 2012 r2</font>

286
00:10:59,300 --> 00:11:05,209
that you add<font color="#E5E5E5"> your admins to this because</font>

287
00:11:02,600 --> 00:11:07,790
<font color="#E5E5E5">this means that they have to</font>

288
00:11:05,209 --> 00:11:10,579
<font color="#CCCCCC">authenticate via via Kerberos AES no</font>

289
00:11:07,790 --> 00:11:12,050
ntlm and there's no delegation allowed

290
00:11:10,580 --> 00:11:13,970
for those<font color="#E5E5E5"> accounts so they're well</font>

291
00:11:12,050 --> 00:11:16,339
<font color="#E5E5E5">protected against Kerberos delegation</font>

292
00:11:13,970 --> 00:11:17,779
attacks<font color="#CCCCCC"> and their Kerberos</font>

293
00:11:16,339 --> 00:11:19,910
authentication is<font color="#E5E5E5"> gonna be limited</font><font color="#CCCCCC"> to</font>

294
00:11:17,779 --> 00:11:21,380
<font color="#E5E5E5">four hours so they have to re off on a</font>

295
00:11:19,910 --> 00:11:22,430
<font color="#E5E5E5">regular basis which</font><font color="#CCCCCC"> means that if</font>

296
00:11:21,380 --> 00:11:25,370
there's any<font color="#E5E5E5"> group membership changes</font>

297
00:11:22,430 --> 00:11:26,989
<font color="#E5E5E5">they should be captured by that and then</font>

298
00:11:25,370 --> 00:11:28,700
<font color="#E5E5E5">finally there's authentication policies</font>

299
00:11:26,990 --> 00:11:30,769
and policy silos which I don't recommend

300
00:11:28,700 --> 00:11:33,800
unless<font color="#E5E5E5"> you plan on spending about a</font>

301
00:11:30,769 --> 00:11:35,660
month<font color="#E5E5E5"> trying to figure it out then in</font>

302
00:11:33,800 --> 00:11:37,699
the<font color="#CCCCCC"> twenty sixteen twenty</font><font color="#E5E5E5"> Windows 10</font>

303
00:11:35,660 --> 00:11:39,649
<font color="#E5E5E5">time frame</font><font color="#CCCCCC"> Microsoft said you know what</font>

304
00:11:37,700 --> 00:11:41,990
this guy Benjamin Delpy might have a

305
00:11:39,649 --> 00:11:43,730
<font color="#E5E5E5">point but with as many cats thing and</font>

306
00:11:41,990 --> 00:11:46,459
maybe we need<font color="#CCCCCC"> to change the way Windows</font>

307
00:11:43,730 --> 00:11:48,230
is actually managing credentials<font color="#E5E5E5"> so if</font>

308
00:11:46,459 --> 00:11:51,439
you've<font color="#E5E5E5"> ever wondered if one person can</font>

309
00:11:48,230 --> 00:11:53,660
really<font color="#E5E5E5"> have an impact in how a massive</font>

310
00:11:51,440 --> 00:11:57,800
software conglomerate<font color="#E5E5E5"> actually does</font>

311
00:11:53,660 --> 00:11:59,689
business<font color="#CCCCCC"> you can</font><font color="#E5E5E5"> benjamin</font><font color="#CCCCCC"> stuck-at</font><font color="#E5E5E5"> with</font>

312
00:11:57,800 --> 00:12:01,399
it and said<font color="#E5E5E5"> Microsoft</font><font color="#CCCCCC"> this doesn't make</font>

313
00:11:59,690 --> 00:12:04,310
<font color="#E5E5E5">sense</font><font color="#CCCCCC"> why are you doing this</font><font color="#E5E5E5"> this way</font>

314
00:12:01,399 --> 00:12:06,980
<font color="#CCCCCC">and after a number of</font><font color="#E5E5E5"> years</font><font color="#CCCCCC"> many cats is</font>

315
00:12:04,310 --> 00:12:08,869
about<font color="#E5E5E5"> ten years old</font><font color="#CCCCCC"> now Microsoft said</font>

316
00:12:06,980 --> 00:12:10,760
yes let's<font color="#E5E5E5"> reaaahhr</font><font color="#CCCCCC"> tech this and they</font>

317
00:12:08,870 --> 00:12:14,870
took what<font color="#E5E5E5"> was the traditional Windows OS</font>

318
00:12:10,760 --> 00:12:16,760
and put it into a VM and then created a

319
00:12:14,870 --> 00:12:18,890
thing that's effectively<font color="#E5E5E5"> a microkernel</font>

320
00:12:16,760 --> 00:12:22,250
that they call secure world<font color="#E5E5E5"> of VSM and</font>

321
00:12:18,890 --> 00:12:23,630
then made that a VM<font color="#CCCCCC"> - and so they are at</font>

322
00:12:22,250 --> 00:12:25,970
the same level they<font color="#CCCCCC"> are effectively</font>

323
00:12:23,630 --> 00:12:27,320
peers on the<font color="#E5E5E5"> system and communication</font>

324
00:12:25,970 --> 00:12:29,390
between the<font color="#CCCCCC"> two</font><font color="#E5E5E5"> is brokered through the</font>

325
00:12:27,320 --> 00:12:31,730
<font color="#E5E5E5">hypervisor via RPC through these things</font>

326
00:12:29,390 --> 00:12:34,149
<font color="#E5E5E5">called trust lights this whole concept</font>

327
00:12:31,730 --> 00:12:36,920
is completely<font color="#CCCCCC"> anti Microsoft</font><font color="#E5E5E5"> it is this</font>

328
00:12:34,149 --> 00:12:39,350
microkernel that no<font color="#CCCCCC"> third-party can</font>

329
00:12:36,920 --> 00:12:40,520
interact<font color="#E5E5E5"> with no real drivers no</font>

330
00:12:39,350 --> 00:12:42,260
<font color="#CCCCCC">software's installed</font>

331
00:12:40,520 --> 00:12:44,000
there's no GUI it's just this<font color="#E5E5E5"> thing</font>

332
00:12:42,260 --> 00:12:45,800
that's there and that's where the

333
00:12:44,000 --> 00:12:48,620
credential secrets are actually stored

334
00:12:45,800 --> 00:12:50,630
not in<font color="#CCCCCC"> this regular Windows OS</font><font color="#E5E5E5"> so you</font>

335
00:12:48,620 --> 00:12:52,490
can<font color="#E5E5E5"> compromise the Windows OS but you</font>

336
00:12:50,630 --> 00:12:55,820
can't get into<font color="#CCCCCC"> that microkernel because</font>

337
00:12:52,490 --> 00:12:59,120
it's it's separated<font color="#E5E5E5"> and into a into its</font>

338
00:12:55,820 --> 00:13:01,010
own environment<font color="#CCCCCC"> and so this is how</font>

339
00:12:59,120 --> 00:13:03,649
credential<font color="#CCCCCC"> guard and remote credential</font>

340
00:13:01,010 --> 00:13:04,790
guard and a device guard they leverage

341
00:13:03,649 --> 00:13:06,140
these features<font color="#E5E5E5"> and there's a lot of</font>

342
00:13:04,790 --> 00:13:09,319
other security<font color="#E5E5E5"> features at Windows 10</font>

343
00:13:06,140 --> 00:13:11,620
has now in 2016<font color="#CCCCCC"> that leverages this this</font>

344
00:13:09,320 --> 00:13:14,560
<font color="#CCCCCC">VSM the secure world environment</font>

345
00:13:11,620 --> 00:13:15,940
<font color="#CCCCCC">to protect</font><font color="#E5E5E5"> that information</font><font color="#CCCCCC"> but</font>

346
00:13:14,560 --> 00:13:18,550
<font color="#E5E5E5">ultimately comes down a lot of minor</font>

347
00:13:15,940 --> 00:13:20,070
changes<font color="#CCCCCC"> but some</font><font color="#E5E5E5"> big impact as far as</font>

348
00:13:18,550 --> 00:13:22,870
recon<font color="#E5E5E5"> and some of the others</font>

349
00:13:20,070 --> 00:13:24,490
<font color="#CCCCCC">Jared hate and I did a class</font><font color="#E5E5E5"> at</font><font color="#CCCCCC"> der beek</font>

350
00:13:22,870 --> 00:13:26,740
<font color="#CCCCCC">on training</font><font color="#E5E5E5"> last year</font><font color="#CCCCCC"> on Windows</font>

351
00:13:24,490 --> 00:13:29,110
security<font color="#E5E5E5"> and we wanted to do use Windows</font>

352
00:13:26,740 --> 00:13:31,320
Server 2016 it makes sense<font color="#E5E5E5"> right it's</font>

353
00:13:29,110 --> 00:13:33,220
the<font color="#E5E5E5"> latest</font><font color="#CCCCCC"> OS we</font><font color="#E5E5E5"> use Windows 10 and</font>

354
00:13:31,320 --> 00:13:34,839
while we're going<font color="#E5E5E5"> through and building</font>

355
00:13:33,220 --> 00:13:36,460
<font color="#E5E5E5">these labs we realize</font><font color="#CCCCCC"> that a number</font><font color="#E5E5E5"> of</font>

356
00:13:34,839 --> 00:13:38,529
<font color="#E5E5E5">the</font><font color="#CCCCCC"> Recon tools that we were</font><font color="#E5E5E5"> using just</font>

357
00:13:36,460 --> 00:13:40,480
<font color="#E5E5E5">weren't</font><font color="#CCCCCC"> working and we weren't getting</font>

358
00:13:38,529 --> 00:13:42,490
the information<font color="#CCCCCC"> that we wanted</font><font color="#E5E5E5"> to we</font>

359
00:13:40,480 --> 00:13:45,490
<font color="#CCCCCC">have to change</font><font color="#E5E5E5"> the labs about</font><font color="#CCCCCC"> half way</font>

360
00:13:42,490 --> 00:13:47,680
through back to<font color="#E5E5E5"> Windows 2012 r2 because</font>

361
00:13:45,490 --> 00:13:49,690
<font color="#E5E5E5">a number</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> things just weren't working</font>

362
00:13:47,680 --> 00:13:51,219
<font color="#CCCCCC">the way we would</font><font color="#E5E5E5"> expect</font><font color="#CCCCCC"> them to so</font>

363
00:13:49,690 --> 00:13:53,970
there's a number<font color="#E5E5E5"> of</font><font color="#CCCCCC"> changes under the</font>

364
00:13:51,220 --> 00:13:56,529
<font color="#E5E5E5">hood to lock down and protect these</font>

365
00:13:53,970 --> 00:14:00,160
ancient protocols that<font color="#E5E5E5"> go back to the NT</font>

366
00:13:56,529 --> 00:14:02,920
<font color="#CCCCCC">4 days which really helped</font><font color="#E5E5E5"> the security</font>

367
00:14:00,160 --> 00:14:04,810
<font color="#CCCCCC">of the platform and now we have features</font>

368
00:14:02,920 --> 00:14:06,849
such as shadow security principles which

369
00:14:04,810 --> 00:14:09,130
are very<font color="#CCCCCC"> interesting because it can</font>

370
00:14:06,850 --> 00:14:11,980
effectively impersonate a security<font color="#CCCCCC"> group</font>

371
00:14:09,130 --> 00:14:14,020
in another another forest expiring links

372
00:14:11,980 --> 00:14:17,050
<font color="#E5E5E5">this is really great where you have an</font>

373
00:14:14,020 --> 00:14:19,870
admin group<font color="#E5E5E5"> but the admin group has a</font>

374
00:14:17,050 --> 00:14:21,910
<font color="#E5E5E5">TTL a time to live and this means</font><font color="#CCCCCC"> that</font>

375
00:14:19,870 --> 00:14:25,779
any account that is placed in<font color="#E5E5E5"> that group</font>

376
00:14:21,910 --> 00:14:28,329
<font color="#E5E5E5">only lives there for a specific amount</font>

377
00:14:25,779 --> 00:14:30,430
<font color="#CCCCCC">of time a threshold so 4</font><font color="#E5E5E5"> hours</font><font color="#CCCCCC"> 6 hours</font>

378
00:14:28,330 --> 00:14:32,410
whatever you have set that<font color="#E5E5E5"> group TTL to</font>

379
00:14:30,430 --> 00:14:34,540
<font color="#E5E5E5">be after that time that group is</font>

380
00:14:32,410 --> 00:14:36,760
automatically removed<font color="#E5E5E5"> and what's great</font>

381
00:14:34,540 --> 00:14:38,079
about this<font color="#E5E5E5"> is Microsoft said</font><font color="#CCCCCC"> ok</font><font color="#E5E5E5"> that's</font>

382
00:14:36,760 --> 00:14:40,390
fine but they still have their Kerberos

383
00:14:38,080 --> 00:14:42,430
ticket how do we fix that<font color="#E5E5E5"> so what</font>

384
00:14:40,390 --> 00:14:44,439
happens is if I'm in<font color="#CCCCCC"> a group or if I'm</font>

385
00:14:42,430 --> 00:14:47,859
<font color="#CCCCCC">in</font><font color="#E5E5E5"> three groups that have TTL s1 six</font>

386
00:14:44,440 --> 00:14:49,360
hours<font color="#E5E5E5"> ones for hours ones two hours what</font>

387
00:14:47,860 --> 00:14:50,890
will happen is that<font color="#CCCCCC"> a main controller is</font>

388
00:14:49,360 --> 00:14:52,300
<font color="#E5E5E5">going to look at that and say okay your</font>

389
00:14:50,890 --> 00:14:55,140
Kerberos ticket is<font color="#E5E5E5"> only good for two</font>

390
00:14:52,300 --> 00:14:57,189
hours after<font color="#CCCCCC"> that you</font><font color="#E5E5E5"> have to</font><font color="#CCCCCC"> Rio that</font>

391
00:14:55,140 --> 00:15:00,069
<font color="#CCCCCC">point I'm going to</font><font color="#E5E5E5"> be removed from that</font>

392
00:14:57,190 --> 00:15:02,680
that group<font color="#E5E5E5"> that's at</font><font color="#CCCCCC"> two hours</font><font color="#E5E5E5"> so this</font>

393
00:15:00,070 --> 00:15:04,860
is in 2016 mode so as you see we're

394
00:15:02,680 --> 00:15:07,270
moving<font color="#E5E5E5"> through to a much better place</font>

395
00:15:04,860 --> 00:15:09,010
<font color="#CCCCCC">over time</font><font color="#E5E5E5"> this is one of the reasons why</font>

396
00:15:07,270 --> 00:15:10,839
you really<font color="#E5E5E5"> want</font><font color="#CCCCCC"> to get your your domain</font>

397
00:15:09,010 --> 00:15:14,470
controllers<font color="#CCCCCC"> up to a modern level of</font>

398
00:15:10,839 --> 00:15:17,540
Windows at least 2008 r2 preferably 2012

399
00:15:14,470 --> 00:15:19,250
r2 and certainly looking to 2016

400
00:15:17,540 --> 00:15:22,670
and it's also important to<font color="#E5E5E5"> know that</font>

401
00:15:19,250 --> 00:15:25,579
<font color="#E5E5E5">what you don't know can hurt</font><font color="#CCCCCC"> so like the</font>

402
00:15:22,670 --> 00:15:28,490
predator<font color="#E5E5E5"> hiding out in the jungle there</font>

403
00:15:25,579 --> 00:15:30,709
are permissions from from systems and

404
00:15:28,490 --> 00:15:33,680
applications<font color="#CCCCCC"> that have been deployed</font>

405
00:15:30,709 --> 00:15:36,619
over<font color="#E5E5E5"> years maybe before you have been</font><font color="#CCCCCC"> at</font>

406
00:15:33,680 --> 00:15:38,180
the organization well probably<font color="#E5E5E5"> and one</font>

407
00:15:36,620 --> 00:15:40,370
fun<font color="#CCCCCC"> thing about this</font><font color="#E5E5E5"> is with Microsoft</font>

408
00:15:38,180 --> 00:15:42,680
Exchange<font color="#CCCCCC"> it doesn't matter what Active</font>

409
00:15:40,370 --> 00:15:44,660
Directory permissions a user has when

410
00:15:42,680 --> 00:15:47,449
managing exchange if the user is

411
00:15:44,660 --> 00:15:49,069
authorized via exchange<font color="#CCCCCC"> are back the</font>

412
00:15:47,449 --> 00:15:50,300
user can perform the action<font color="#E5E5E5"> regardless</font>

413
00:15:49,070 --> 00:15:54,199
of his or<font color="#CCCCCC"> Horror Active Directory</font>

414
00:15:50,300 --> 00:15:54,620
permissions that's intriguing<font color="#CCCCCC"> tell me</font>

415
00:15:54,199 --> 00:15:57,469
<font color="#E5E5E5">more</font>

416
00:15:54,620 --> 00:16:00,860
<font color="#CCCCCC">all right so how does this exchange</font>

417
00:15:57,470 --> 00:16:02,089
thing actually<font color="#E5E5E5"> work well there's a few</font>

418
00:16:00,860 --> 00:16:03,920
new groups in exchange that have been

419
00:16:02,089 --> 00:16:05,750
around since around<font color="#E5E5E5"> the</font><font color="#CCCCCC"> twenty ten days</font>

420
00:16:03,920 --> 00:16:08,000
there's the exchange trusted<font color="#CCCCCC"> sub system</font>

421
00:16:05,750 --> 00:16:09,800
<font color="#E5E5E5">this is like system in</font><font color="#CCCCCC"> exchange has full</font>

422
00:16:08,000 --> 00:16:13,160
<font color="#E5E5E5">rights to all the exchange components</font>

423
00:16:09,800 --> 00:16:15,199
and configuration container information

424
00:16:13,160 --> 00:16:17,980
in Active Directory<font color="#CCCCCC"> and the members of</font>

425
00:16:15,199 --> 00:16:21,439
<font color="#E5E5E5">this group are the exchange servers and</font>

426
00:16:17,980 --> 00:16:23,120
one of the members this group here the

427
00:16:21,440 --> 00:16:24,709
exchange<font color="#E5E5E5"> trusted sub system is also</font><font color="#CCCCCC"> a</font>

428
00:16:23,120 --> 00:16:26,690
member<font color="#E5E5E5"> of the exchange</font><font color="#CCCCCC"> Windows</font>

429
00:16:24,709 --> 00:16:28,630
permissions<font color="#E5E5E5"> group the exchange windows</font>

430
00:16:26,690 --> 00:16:32,420
permission group<font color="#E5E5E5"> is this separate</font>

431
00:16:28,630 --> 00:16:35,630
<font color="#E5E5E5">completely isolated let's say for</font>

432
00:16:32,420 --> 00:16:38,479
exchange this parallel security

433
00:16:35,630 --> 00:16:40,399
configuration which is granted<font color="#E5E5E5"> rights on</font>

434
00:16:38,480 --> 00:16:43,190
users and<font color="#E5E5E5"> computers sorry users and</font>

435
00:16:40,399 --> 00:16:46,160
groups<font color="#CCCCCC"> and have modify rights to a</font>

436
00:16:43,190 --> 00:16:48,350
number of<font color="#CCCCCC"> attributes</font><font color="#E5E5E5"> on those objects so</font>

437
00:16:46,160 --> 00:16:50,120
that<font color="#E5E5E5"> way exchange goes you know what</font><font color="#CCCCCC"> 80</font>

438
00:16:48,350 --> 00:16:52,430
admin you don't have to do anything<font color="#CCCCCC"> I've</font>

439
00:16:50,120 --> 00:16:54,019
<font color="#E5E5E5">got this I'm going to make sure</font><font color="#CCCCCC"> that my</font>

440
00:16:52,430 --> 00:16:56,660
exchange admins have the rights they

441
00:16:54,019 --> 00:16:58,310
need to do their job<font color="#E5E5E5"> and then there's</font>

442
00:16:56,660 --> 00:16:59,959
the organization management<font color="#E5E5E5"> which is</font>

443
00:16:58,310 --> 00:17:01,939
<font color="#E5E5E5">kind of the domain admin of the exchange</font>

444
00:16:59,959 --> 00:17:04,520
world so organization<font color="#E5E5E5"> management has</font>

445
00:17:01,940 --> 00:17:05,569
full<font color="#CCCCCC"> rights in that exchange org</font><font color="#E5E5E5"> really</font>

446
00:17:04,520 --> 00:17:07,429
there shouldn't be<font color="#CCCCCC"> anyone</font><font color="#E5E5E5"> that's a</font>

447
00:17:05,569 --> 00:17:09,649
member of this but I<font color="#E5E5E5"> usually find that</font>

448
00:17:07,429 --> 00:17:12,380
there's<font color="#E5E5E5"> often many more that the need</font>

449
00:17:09,650 --> 00:17:15,980
<font color="#E5E5E5">than need to be there so what's</font>

450
00:17:12,380 --> 00:17:18,230
interesting about this is if I<font color="#E5E5E5"> have if</font>

451
00:17:15,980 --> 00:17:20,240
I'm an attacker<font color="#CCCCCC"> and I compromised an</font>

452
00:17:18,230 --> 00:17:22,760
exchange server<font color="#E5E5E5"> and I get system rights</font>

453
00:17:20,240 --> 00:17:24,500
on that<font color="#CCCCCC"> exchange server</font><font color="#E5E5E5"> that system</font>

454
00:17:22,760 --> 00:17:26,809
right<font color="#CCCCCC"> on that exchange server</font><font color="#E5E5E5"> is a</font>

455
00:17:24,500 --> 00:17:29,179
member of<font color="#E5E5E5"> exchange trusted sub system so</font>

456
00:17:26,809 --> 00:17:30,280
now I own the<font color="#E5E5E5"> exchange work from that</font>

457
00:17:29,179 --> 00:17:32,290
one server

458
00:17:30,280 --> 00:17:34,649
<font color="#E5E5E5">but it's also a member of that</font><font color="#CCCCCC"> windows</font>

459
00:17:32,290 --> 00:17:37,690
<font color="#E5E5E5">exchange windows permissions group</font>

460
00:17:34,650 --> 00:17:39,250
<font color="#E5E5E5">exchange windows permission group and so</font>

461
00:17:37,690 --> 00:17:41,830
what that<font color="#E5E5E5"> means is I have rights to a</font>

462
00:17:39,250 --> 00:17:44,200
lot<font color="#E5E5E5"> of other accounts and groups in that</font>

463
00:17:41,830 --> 00:17:46,000
<font color="#E5E5E5">organization maybe even admin groups</font>

464
00:17:44,200 --> 00:17:49,420
<font color="#E5E5E5">because one of the things that's able to</font>

465
00:17:46,000 --> 00:17:50,620
<font color="#E5E5E5">do is change group membership and so</font>

466
00:17:49,420 --> 00:17:52,270
what we have<font color="#CCCCCC"> here is</font><font color="#E5E5E5"> this exchange</font>

467
00:17:50,620 --> 00:17:54,250
rights and our back system<font color="#E5E5E5"> where</font>

468
00:17:52,270 --> 00:17:57,220
<font color="#E5E5E5">exchange has extensive rights throughout</font>

469
00:17:54,250 --> 00:17:58,870
Active Directory<font color="#E5E5E5"> modify rights on many</font>

470
00:17:57,220 --> 00:18:00,880
objects including users and groups

471
00:17:58,870 --> 00:18:03,040
<font color="#E5E5E5">except those protected by admin</font><font color="#CCCCCC"> st</font>

472
00:18:00,880 --> 00:18:05,050
holder and this access<font color="#E5E5E5"> is provided</font>

473
00:18:03,040 --> 00:18:07,540
<font color="#E5E5E5">through these exchange groups through</font>

474
00:18:05,050 --> 00:18:10,000
<font color="#E5E5E5">this separate system of permissions that</font>

475
00:18:07,540 --> 00:18:11,560
is not<font color="#E5E5E5"> obvious to Active Directory you</font>

476
00:18:10,000 --> 00:18:14,380
can scan Active Directory and look for

477
00:18:11,560 --> 00:18:16,659
any custom groups or users<font color="#E5E5E5"> or anything</font>

478
00:18:14,380 --> 00:18:18,160
else that<font color="#CCCCCC"> has rights there</font><font color="#E5E5E5"> but if you're</font>

479
00:18:16,660 --> 00:18:19,060
<font color="#E5E5E5">not also</font><font color="#CCCCCC"> looking at the exchange rights</font>

480
00:18:18,160 --> 00:18:21,250
you're missing a<font color="#E5E5E5"> lot</font>

481
00:18:19,060 --> 00:18:23,320
and if you've migrated<font color="#E5E5E5"> to office 365</font>

482
00:18:21,250 --> 00:18:25,420
guess what<font color="#E5E5E5"> these permissions are still</font>

483
00:18:23,320 --> 00:18:27,429
there if you've had exchange because

484
00:18:25,420 --> 00:18:32,670
these permissions exist<font color="#E5E5E5"> and persist from</font>

485
00:18:27,430 --> 00:18:35,800
2000 to 2003 to 2007<font color="#E5E5E5"> to 2010 to 2016</font><font color="#CCCCCC"> and</font>

486
00:18:32,670 --> 00:18:37,780
over time<font color="#E5E5E5"> in the beginning</font><font color="#CCCCCC"> microsoft</font>

487
00:18:35,800 --> 00:18:40,060
said let's just<font color="#E5E5E5"> give exchange</font><font color="#CCCCCC"> all of</font>

488
00:18:37,780 --> 00:18:42,370
these rights<font color="#E5E5E5"> and then over time they've</font>

489
00:18:40,060 --> 00:18:44,649
kind<font color="#E5E5E5"> of paired that down in the 2010</font><font color="#CCCCCC"> 10</font>

490
00:18:42,370 --> 00:18:47,469
<font color="#E5E5E5">timeframe but they're still there</font><font color="#CCCCCC"> and</font>

491
00:18:44,650 --> 00:18:50,680
<font color="#CCCCCC">it's not just exchange I mean Microsoft</font>

492
00:18:47,470 --> 00:18:54,520
<font color="#E5E5E5">SCCM is an interesting</font><font color="#CCCCCC"> beast originally</font>

493
00:18:50,680 --> 00:18:56,710
SMS not text messaging<font color="#E5E5E5"> but the granular</font>

494
00:18:54,520 --> 00:18:59,620
delegation within<font color="#CCCCCC"> SCCM</font><font color="#E5E5E5"> was difficult</font>

495
00:18:56,710 --> 00:19:01,810
<font color="#CCCCCC">until around 2012 and so it has this</font>

496
00:18:59,620 --> 00:19:04,270
role based access<font color="#E5E5E5"> breakout for desktops</font>

497
00:19:01,810 --> 00:19:06,220
and servers<font color="#E5E5E5"> right so we can manage our</font>

498
00:19:04,270 --> 00:19:08,830
workstations and our servers which makes

499
00:19:06,220 --> 00:19:10,960
sense because everyone<font color="#E5E5E5"> only has to type</font>

500
00:19:08,830 --> 00:19:12,939
oh wait no there's also domain

501
00:19:10,960 --> 00:19:15,220
controllers right<font color="#E5E5E5"> but there's no</font>

502
00:19:12,940 --> 00:19:17,620
delegation<font color="#E5E5E5"> or way to separate those out</font>

503
00:19:15,220 --> 00:19:19,720
<font color="#CCCCCC">so what does this mean this means pretty</font>

504
00:19:17,620 --> 00:19:22,959
much<font color="#E5E5E5"> any organization that's using</font><font color="#CCCCCC"> SCCM</font>

505
00:19:19,720 --> 00:19:24,880
<font color="#CCCCCC">is also patching and managing domain</font>

506
00:19:22,960 --> 00:19:27,850
controllers bundled in with servers or

507
00:19:24,880 --> 00:19:29,290
with workstations which is problematic

508
00:19:27,850 --> 00:19:32,199
<font color="#E5E5E5">because that means if an attacker</font>

509
00:19:29,290 --> 00:19:35,320
compromises an admin account for<font color="#CCCCCC"> SCCM or</font>

510
00:19:32,200 --> 00:19:37,360
<font color="#CCCCCC">SCCM</font><font color="#E5E5E5"> itself then they can compromise and</font>

511
00:19:35,320 --> 00:19:39,399
install or run code on a<font color="#CCCCCC"> domain</font>

512
00:19:37,360 --> 00:19:40,899
<font color="#E5E5E5">controller</font><font color="#CCCCCC"> and it's not just these</font>

513
00:19:39,400 --> 00:19:42,950
Microsoft tools I<font color="#E5E5E5"> mean there's plenty of</font>

514
00:19:40,900 --> 00:19:45,769
third-party<font color="#E5E5E5"> products that have</font>

515
00:19:42,950 --> 00:19:47,929
and require permissions<font color="#E5E5E5"> from the main</font>

516
00:19:45,769 --> 00:19:50,059
user rights to<font color="#CCCCCC"> ID object rights to</font>

517
00:19:47,929 --> 00:19:52,129
system rights to full<font color="#CCCCCC"> 80 rights so I</font>

518
00:19:50,059 --> 00:19:53,480
went through<font color="#CCCCCC"> and I looked at a bunch of</font>

519
00:19:52,129 --> 00:19:56,658
<font color="#E5E5E5">different products and I was like you</font>

520
00:19:53,480 --> 00:19:58,489
know what there's a pattern here<font color="#CCCCCC"> every</font>

521
00:19:56,659 --> 00:19:59,960
product<font color="#E5E5E5"> seems to require pretty much the</font>

522
00:19:58,489 --> 00:20:01,369
<font color="#E5E5E5">same rights and it comes down to this</font>

523
00:19:59,960 --> 00:20:02,720
pattern<font color="#CCCCCC"> I'm not sure if it's a if it</font>

524
00:20:01,369 --> 00:20:05,119
becomes<font color="#CCCCCC"> obvious to you but it became</font>

525
00:20:02,720 --> 00:20:07,669
<font color="#CCCCCC">obvious</font><font color="#E5E5E5"> to me</font><font color="#CCCCCC"> that pretty much off every</font>

526
00:20:05,119 --> 00:20:09,918
one of<font color="#E5E5E5"> them wants to main admin why</font>

527
00:20:07,669 --> 00:20:11,659
because it makes<font color="#E5E5E5"> it easy makes it easy</font>

528
00:20:09,919 --> 00:20:13,249
for<font color="#E5E5E5"> the vendor when they're</font><font color="#CCCCCC"> developing</font>

529
00:20:11,659 --> 00:20:15,169
<font color="#E5E5E5">the product when they're selling</font><font color="#CCCCCC"> the</font>

530
00:20:13,249 --> 00:20:16,549
product<font color="#E5E5E5"> post sales support of the</font>

531
00:20:15,169 --> 00:20:19,309
product<font color="#E5E5E5"> it's easier for the customer</font>

532
00:20:16,549 --> 00:20:22,100
<font color="#CCCCCC">just everything works</font><font color="#E5E5E5"> but everything</font>

533
00:20:19,309 --> 00:20:23,928
works for the attacker as well<font color="#E5E5E5"> and a lot</font>

534
00:20:22,100 --> 00:20:25,459
<font color="#CCCCCC">of environments they use the built-in</font>

535
00:20:23,929 --> 00:20:28,700
groups<font color="#E5E5E5"> for delegation like account</font>

536
00:20:25,460 --> 00:20:29,929
operator server operators etc etc they

537
00:20:28,700 --> 00:20:31,340
don't always mean what they think they

538
00:20:29,929 --> 00:20:34,580
mean<font color="#E5E5E5"> and they often provide more rights</font>

539
00:20:31,340 --> 00:20:36,439
<font color="#CCCCCC">than expect it and then they provide</font>

540
00:20:34,580 --> 00:20:37,820
full control at the domain<font color="#CCCCCC"> root so that</font>

541
00:20:36,440 --> 00:20:39,379
<font color="#CCCCCC">way it flows down everything</font><font color="#E5E5E5"> and</font>

542
00:20:37,820 --> 00:20:42,590
everything just works<font color="#E5E5E5"> because let's just</font>

543
00:20:39,379 --> 00:20:44,629
<font color="#CCCCCC">make it</font><font color="#E5E5E5"> work right and the delegation</font>

544
00:20:42,590 --> 00:20:46,609
tools<font color="#CCCCCC"> an ad</font><font color="#E5E5E5"> are very challenging</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> get</font>

545
00:20:44,629 --> 00:20:49,399
right because<font color="#E5E5E5"> nobody really wants to</font>

546
00:20:46,609 --> 00:20:51,320
<font color="#E5E5E5">have</font><font color="#CCCCCC"> to look</font><font color="#E5E5E5"> at this on every</font><font color="#CCCCCC"> o</font><font color="#E5E5E5"> you or</font>

547
00:20:49,399 --> 00:20:54,649
every object and<font color="#CCCCCC"> try</font><font color="#E5E5E5"> to figure out</font>

548
00:20:51,320 --> 00:20:57,980
what's going<font color="#CCCCCC"> on</font><font color="#E5E5E5"> that's not fun and</font><font color="#CCCCCC"> it'd</font>

549
00:20:54,649 --> 00:21:01,008
<font color="#E5E5E5">be very difficult to see</font><font color="#CCCCCC"> or identify a</font>

550
00:20:57,980 --> 00:21:03,019
mistake that<font color="#CCCCCC"> was made here</font><font color="#E5E5E5"> I mean like</font>

551
00:21:01,009 --> 00:21:04,850
perhaps<font color="#E5E5E5"> someone delegated domain</font>

552
00:21:03,019 --> 00:21:07,249
computers to have full control<font color="#CCCCCC"> on</font><font color="#E5E5E5"> the so</font>

553
00:21:04,850 --> 00:21:09,289
you which would be a<font color="#E5E5E5"> compromise if any</font>

554
00:21:07,249 --> 00:21:12,529
domain computer would<font color="#CCCCCC"> have full rights</font>

555
00:21:09,289 --> 00:21:14,869
on the so you and<font color="#CCCCCC"> anything in it that</font>

556
00:21:12,529 --> 00:21:16,190
never happens right but it's very

557
00:21:14,869 --> 00:21:18,980
<font color="#CCCCCC">difficult to see something</font><font color="#E5E5E5"> like that</font>

558
00:21:16,190 --> 00:21:20,509
<font color="#CCCCCC">unless you run a tool that is scanning</font>

559
00:21:18,980 --> 00:21:21,799
<font color="#E5E5E5">Active Directory for permissions or</font>

560
00:21:20,509 --> 00:21:23,929
using something like bloodhound which

561
00:21:21,799 --> 00:21:25,970
does something<font color="#E5E5E5"> similar and the cloud</font>

562
00:21:23,929 --> 00:21:27,710
<font color="#E5E5E5">isn't to be excluded</font><font color="#CCCCCC"> the cloud has some</font>

563
00:21:25,970 --> 00:21:29,720
issues<font color="#CCCCCC"> with this as well why because we</font>

564
00:21:27,710 --> 00:21:31,639
<font color="#E5E5E5">have to integrate or</font><font color="#CCCCCC"> on-prem environment</font>

565
00:21:29,720 --> 00:21:33,710
with the cloud so Active Directory

566
00:21:31,639 --> 00:21:35,809
provides our single<font color="#E5E5E5"> sign-on services to</font>

567
00:21:33,710 --> 00:21:37,519
these cloud services<font color="#CCCCCC"> and</font><font color="#E5E5E5"> there's</font>

568
00:21:35,809 --> 00:21:39,830
directory sync tools that sync

569
00:21:37,519 --> 00:21:42,409
information from our ad to cloud

570
00:21:39,830 --> 00:21:45,049
<font color="#E5E5E5">services and most of these sync engines</font>

571
00:21:42,409 --> 00:21:47,149
only require user rights but this means

572
00:21:45,049 --> 00:21:49,299
that<font color="#E5E5E5"> many organizations don't even know</font>

573
00:21:47,149 --> 00:21:52,149
what<font color="#E5E5E5"> kind of cloud sync is involved or</font>

574
00:21:49,299 --> 00:21:55,900
occurring do you

575
00:21:52,150 --> 00:21:57,730
<font color="#CCCCCC">I worked with</font><font color="#E5E5E5"> an</font><font color="#CCCCCC"> organization and they</font>

576
00:21:55,900 --> 00:21:59,230
went through<font color="#CCCCCC"> and forced everyone</font><font color="#E5E5E5"> to</font>

577
00:21:57,730 --> 00:22:00,340
change their password they're like we're

578
00:21:59,230 --> 00:22:01,360
tired of this people haven't changed

579
00:22:00,340 --> 00:22:03,639
your<font color="#CCCCCC"> password in years we're gonna</font>

580
00:22:01,360 --> 00:22:05,409
change all of<font color="#E5E5E5"> them and then someone</font>

581
00:22:03,640 --> 00:22:07,570
complained<font color="#CCCCCC"> oh well this account</font><font color="#E5E5E5"> that we</font>

582
00:22:05,410 --> 00:22:10,450
were using<font color="#E5E5E5"> we're actually doing some</font>

583
00:22:07,570 --> 00:22:12,490
sync to this cloud service<font color="#E5E5E5"> and IT said</font>

584
00:22:10,450 --> 00:22:14,560
what and security said what

585
00:22:12,490 --> 00:22:16,060
no no you're<font color="#CCCCCC"> not supposed to be</font><font color="#E5E5E5"> doing</font>

586
00:22:14,560 --> 00:22:19,750
<font color="#E5E5E5">that they're like well we we got a user</font>

587
00:22:16,060 --> 00:22:21,879
account<font color="#CCCCCC"> and we did it</font><font color="#E5E5E5"> no I mean</font><font color="#CCCCCC"> they're</font>

588
00:22:19,750 --> 00:22:23,410
<font color="#E5E5E5">the problem</font><font color="#CCCCCC"> is that people</font><font color="#E5E5E5"> don't really</font>

589
00:22:21,880 --> 00:22:24,790
understand where that<font color="#E5E5E5"> data is going and</font>

590
00:22:23,410 --> 00:22:28,930
if there's<font color="#E5E5E5"> certain regulations that</font>

591
00:22:24,790 --> 00:22:32,670
apply to your<font color="#E5E5E5"> industry your company your</font>

592
00:22:28,930 --> 00:22:34,600
country your geographic<font color="#CCCCCC"> location</font>

593
00:22:32,670 --> 00:22:37,930
synchronizing this data to a cloud

594
00:22:34,600 --> 00:22:40,300
<font color="#E5E5E5">service may put you at</font><font color="#CCCCCC"> risk</font><font color="#E5E5E5"> now there's</font>

595
00:22:37,930 --> 00:22:41,920
a 3d Kinect which is part<font color="#E5E5E5"> of what</font><font color="#CCCCCC"> you</font>

596
00:22:40,300 --> 00:22:44,320
have<font color="#CCCCCC"> to implement in order to go</font><font color="#E5E5E5"> to</font>

597
00:22:41,920 --> 00:22:46,390
office<font color="#CCCCCC"> 365 and leverage exchange and all</font>

598
00:22:44,320 --> 00:22:48,850
those cloud features and so these are

599
00:22:46,390 --> 00:22:49,990
<font color="#CCCCCC">the standard feature set of Badger</font><font color="#E5E5E5"> 80</font>

600
00:22:48,850 --> 00:22:51,550
Kinect which I'm not<font color="#E5E5E5"> going to go through</font>

601
00:22:49,990 --> 00:22:53,380
<font color="#CCCCCC">all of them but one of</font><font color="#E5E5E5"> them is password</font>

602
00:22:51,550 --> 00:22:56,230
synchronization which is not really well

603
00:22:53,380 --> 00:22:58,300
named Microsoft this<font color="#E5E5E5"> is actually taking</font>

604
00:22:56,230 --> 00:23:00,220
a hash of<font color="#E5E5E5"> the password hash for</font><font color="#CCCCCC"> a D</font><font color="#E5E5E5"> and</font>

605
00:22:58,300 --> 00:23:02,800
putting that hash of the hash up in

606
00:23:00,220 --> 00:23:04,660
Azure ad so that<font color="#E5E5E5"> way users can log in</font>

607
00:23:02,800 --> 00:23:06,940
directly<font color="#E5E5E5"> to Azure ad without having to</font>

608
00:23:04,660 --> 00:23:09,970
come<font color="#CCCCCC"> back</font><font color="#E5E5E5"> through your local ad and do</font>

609
00:23:06,940 --> 00:23:11,710
something like<font color="#E5E5E5"> Federation so what's</font>

610
00:23:09,970 --> 00:23:15,250
<font color="#E5E5E5">interesting about this is even if you're</font>

611
00:23:11,710 --> 00:23:16,870
not allowing or enabling this<font color="#CCCCCC"> password</font>

612
00:23:15,250 --> 00:23:18,880
synchronization and when you set up<font color="#E5E5E5"> a</font>

613
00:23:16,870 --> 00:23:20,620
<font color="#CCCCCC">jury to connect synchronization you just</font>

614
00:23:18,880 --> 00:23:24,010
said Express<font color="#CCCCCC"> settings you had the easy</font>

615
00:23:20,620 --> 00:23:25,419
button<font color="#E5E5E5"> so to speak</font><font color="#CCCCCC"> there's a</font><font color="#E5E5E5"> couple of</font>

616
00:23:24,010 --> 00:23:28,990
<font color="#E5E5E5">rights that are that</font><font color="#CCCCCC"> are interesting</font>

617
00:23:25,420 --> 00:23:32,410
here<font color="#CCCCCC"> that are</font><font color="#E5E5E5"> used for password sync and</font>

618
00:23:28,990 --> 00:23:34,630
so at Def Con<font color="#CCCCCC"> in July I called</font><font color="#E5E5E5"> us out</font>

619
00:23:32,410 --> 00:23:36,010
and<font color="#E5E5E5"> I said be aware</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> this account</font>

620
00:23:34,630 --> 00:23:39,100
may have more rights than you think<font color="#E5E5E5"> it</font>

621
00:23:36,010 --> 00:23:40,480
<font color="#E5E5E5">does it says for password sync well</font>

622
00:23:39,100 --> 00:23:42,550
there's an<font color="#CCCCCC"> interesting</font><font color="#E5E5E5"> tool that's a</font>

623
00:23:40,480 --> 00:23:44,440
component of<font color="#E5E5E5"> Mimi Katz called DC sync</font>

624
00:23:42,550 --> 00:23:46,659
where if you have the<font color="#E5E5E5"> appropriate rights</font>

625
00:23:44,440 --> 00:23:48,310
to sync a password<font color="#E5E5E5"> you basically tell</font>

626
00:23:46,660 --> 00:23:50,920
the domain controller<font color="#E5E5E5"> domain controller</font>

627
00:23:48,310 --> 00:23:53,560
please send me<font color="#E5E5E5"> the</font><font color="#CCCCCC"> password data for the</font>

628
00:23:50,920 --> 00:23:55,390
<font color="#E5E5E5">default admin password or the</font><font color="#CCCCCC"> kerb TGT</font>

629
00:23:53,560 --> 00:23:56,889
account or any computer account or

630
00:23:55,390 --> 00:23:59,020
pretty much<font color="#E5E5E5"> everybody because I like to</font>

631
00:23:56,890 --> 00:24:01,870
have<font color="#E5E5E5"> all the password hashes and it will</font>

632
00:23:59,020 --> 00:24:02,889
do that<font color="#CCCCCC"> because I have the rights so one</font>

633
00:24:01,870 --> 00:24:05,169
of the things that you'll<font color="#CCCCCC"> definitely</font>

634
00:24:02,890 --> 00:24:05,960
want to do if you're working<font color="#CCCCCC"> with a</font><font color="#E5E5E5"> her</font>

635
00:24:05,170 --> 00:24:08,270
<font color="#CCCCCC">ad Connect</font>

636
00:24:05,960 --> 00:24:10,220
and your company or<font color="#E5E5E5"> the company</font><font color="#CCCCCC"> you're</font>

637
00:24:08,270 --> 00:24:11,240
<font color="#CCCCCC">working with says well no password sink</font>

638
00:24:10,220 --> 00:24:13,549
you want to make sure<font color="#E5E5E5"> that you're using</font>

639
00:24:11,240 --> 00:24:16,580
custom permissions<font color="#CCCCCC"> and not setting that</font>

640
00:24:13,549 --> 00:24:17,658
at least not<font color="#CCCCCC"> initially because one of</font>

641
00:24:16,580 --> 00:24:19,279
the interesting things that came<font color="#E5E5E5"> out of</font>

642
00:24:17,659 --> 00:24:21,350
<font color="#E5E5E5">this a number</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> months after</font><font color="#CCCCCC"> DEFCON</font>

643
00:24:19,279 --> 00:24:23,950
<font color="#E5E5E5">towards the end of the year</font><font color="#CCCCCC"> security</font>

644
00:24:21,350 --> 00:24:27,830
advisory<font color="#CCCCCC"> 405 six three one eight</font>

645
00:24:23,950 --> 00:24:30,049
<font color="#E5E5E5">Microsoft said by the way if you have</font>

646
00:24:27,830 --> 00:24:31,939
this configured based on the standard

647
00:24:30,049 --> 00:24:34,429
<font color="#CCCCCC">configuration so that Express setting</font>

648
00:24:31,940 --> 00:24:37,250
this service count is created in the

649
00:24:34,429 --> 00:24:38,510
<font color="#E5E5E5">users oh you and it has the ability to</font>

650
00:24:37,250 --> 00:24:40,850
<font color="#E5E5E5">synchronize passwords</font>

651
00:24:38,510 --> 00:24:43,010
well account operators has default

652
00:24:40,850 --> 00:24:44,959
<font color="#E5E5E5">access to the users</font><font color="#CCCCCC"> oh you</font><font color="#E5E5E5"> and can</font>

653
00:24:43,010 --> 00:24:46,820
control this account change the password

654
00:24:44,960 --> 00:24:49,940
<font color="#E5E5E5">it's a great reason not to use account</font>

655
00:24:46,820 --> 00:24:52,129
operators by the way<font color="#CCCCCC"> but to be aware of</font>

656
00:24:49,940 --> 00:24:54,710
what kind<font color="#E5E5E5"> of exposure these things</font>

657
00:24:52,130 --> 00:24:56,179
<font color="#CCCCCC">potentially could give you</font><font color="#E5E5E5"> and so it's</font>

658
00:24:54,710 --> 00:24:59,390
important<font color="#CCCCCC"> to note how this</font><font color="#E5E5E5"> password</font><font color="#CCCCCC"> sync</font>

659
00:24:56,179 --> 00:25:00,020
actually works<font color="#CCCCCC"> so about every</font><font color="#E5E5E5"> two</font>

660
00:24:59,390 --> 00:25:02,120
minutes

661
00:25:00,020 --> 00:25:03,889
the synchronization agent on the azure

662
00:25:02,120 --> 00:25:05,870
ad<font color="#CCCCCC"> Connect server</font><font color="#E5E5E5"> will</font><font color="#CCCCCC"> request</font><font color="#E5E5E5"> those</font>

663
00:25:03,890 --> 00:25:07,460
store passwords<font color="#E5E5E5"> from the DC using the</font>

664
00:25:05,870 --> 00:25:09,168
standard method<font color="#E5E5E5"> now it looks</font><font color="#CCCCCC"> like this</font>

665
00:25:07,460 --> 00:25:10,940
<font color="#E5E5E5">so you have</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> domain controller</font>

666
00:25:09,169 --> 00:25:12,740
because the azure ad<font color="#E5E5E5"> Connect server</font>

667
00:25:10,940 --> 00:25:14,630
which does a lot<font color="#CCCCCC"> of crypto stuff</font><font color="#E5E5E5"> to it</font>

668
00:25:12,740 --> 00:25:19,220
all<font color="#E5E5E5"> of</font><font color="#CCCCCC"> this up here sends it</font><font color="#E5E5E5"> up to Azure</font>

669
00:25:14,630 --> 00:25:22,399
ad that's<font color="#E5E5E5"> pretty solid the thing that</font>

670
00:25:19,220 --> 00:25:25,520
we've<font color="#CCCCCC"> seen</font><font color="#E5E5E5"> is that organizations forget</font>

671
00:25:22,399 --> 00:25:27,620
that this actually at<font color="#E5E5E5"> some point has</font>

672
00:25:25,520 --> 00:25:31,520
every password<font color="#E5E5E5"> for every synchronized</font>

673
00:25:27,620 --> 00:25:34,908
user<font color="#E5E5E5"> in memory and is performing</font><font color="#CCCCCC"> actions</font>

674
00:25:31,520 --> 00:25:38,510
on those so in environments<font color="#E5E5E5"> where you</font>

675
00:25:34,909 --> 00:25:40,580
have multiple forests<font color="#E5E5E5"> all of that</font>

676
00:25:38,510 --> 00:25:43,309
<font color="#E5E5E5">password data is flowing through the</font>

677
00:25:40,580 --> 00:25:45,470
azure ad<font color="#E5E5E5"> Connect server</font><font color="#CCCCCC"> so this is kind</font>

678
00:25:43,309 --> 00:25:47,678
of like<font color="#CCCCCC"> a super DC because</font><font color="#E5E5E5"> if I'm an</font>

679
00:25:45,470 --> 00:25:50,179
<font color="#CCCCCC">attacker I'm just gonna go after this</font>

680
00:25:47,679 --> 00:25:52,190
<font color="#E5E5E5">because that's gonna have what I need</font><font color="#CCCCCC"> or</font>

681
00:25:50,179 --> 00:25:54,409
I'm gonna<font color="#E5E5E5"> go after that special account</font>

682
00:25:52,190 --> 00:25:56,870
that's used as a service account for

683
00:25:54,409 --> 00:25:58,190
that<font color="#E5E5E5"> so there's a few things</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> want to</font>

684
00:25:56,870 --> 00:25:59,000
do first<font color="#E5E5E5"> of all protect this like a</font>

685
00:25:58,190 --> 00:26:00,890
domain<font color="#E5E5E5"> controller</font>

686
00:25:59,000 --> 00:26:03,080
lock it down firewall it off from<font color="#CCCCCC"> the</font>

687
00:26:00,890 --> 00:26:04,159
network<font color="#E5E5E5"> since</font><font color="#CCCCCC"> it only needs</font><font color="#E5E5E5"> to connect</font>

688
00:26:03,080 --> 00:26:07,250
to Azure<font color="#CCCCCC"> ad and your domain controllers</font>

689
00:26:04,159 --> 00:26:09,799
<font color="#CCCCCC">and only 80 admin should ever really be</font>

690
00:26:07,250 --> 00:26:11,419
allowed<font color="#CCCCCC"> to log on or manage this you can</font>

691
00:26:09,799 --> 00:26:13,908
lock down<font color="#CCCCCC"> that service count it's logon</font>

692
00:26:11,419 --> 00:26:15,889
ability just<font color="#E5E5E5"> this server and monitor</font>

693
00:26:13,909 --> 00:26:17,270
that and<font color="#CCCCCC"> of course keep the account</font>

694
00:26:15,889 --> 00:26:18,939
operators group empty because there's

695
00:26:17,270 --> 00:26:22,389
really no reason<font color="#E5E5E5"> to</font>

696
00:26:18,940 --> 00:26:23,980
to have that open<font color="#E5E5E5"> and accessible but</font>

697
00:26:22,390 --> 00:26:25,930
ultimately in Active Directory common

698
00:26:23,980 --> 00:26:27,490
issues<font color="#E5E5E5"> persists today</font><font color="#CCCCCC"> we have this issue</font>

699
00:26:25,930 --> 00:26:29,110
of<font color="#E5E5E5"> groups being in groups being in</font>

700
00:26:27,490 --> 00:26:30,610
groups being in groups<font color="#E5E5E5"> and then trying</font>

701
00:26:29,110 --> 00:26:32,949
<font color="#E5E5E5">to follow that path makes it very</font>

702
00:26:30,610 --> 00:26:34,360
difficult<font color="#CCCCCC"> there's a group that's</font><font color="#E5E5E5"> in</font>

703
00:26:32,950 --> 00:26:36,850
domain admins and there's a group<font color="#E5E5E5"> that's</font>

704
00:26:34,360 --> 00:26:38,229
in that and person that is a member of

705
00:26:36,850 --> 00:26:39,639
<font color="#E5E5E5">that</font><font color="#CCCCCC"> group isn't</font><font color="#E5E5E5"> really sure</font><font color="#CCCCCC"> what that</font>

706
00:26:38,230 --> 00:26:42,670
<font color="#E5E5E5">group is for so they add another</font><font color="#CCCCCC"> group</font>

707
00:26:39,640 --> 00:26:43,270
<font color="#CCCCCC">to it</font><font color="#E5E5E5"> just to simplify stuff right makes</font>

708
00:26:42,670 --> 00:26:44,950
sense

709
00:26:43,270 --> 00:26:47,290
sure let's simplify by adding more stuff

710
00:26:44,950 --> 00:26:48,880
to<font color="#E5E5E5"> it and then before you know</font><font color="#CCCCCC"> it people</font>

711
00:26:47,290 --> 00:26:51,190
<font color="#E5E5E5">that aren't supposed</font><font color="#CCCCCC"> to be domain admins</font>

712
00:26:48,880 --> 00:26:52,750
<font color="#E5E5E5">are domain admins and then we see</font>

713
00:26:51,190 --> 00:26:54,340
<font color="#E5E5E5">organizations</font><font color="#CCCCCC"> that still have the</font>

714
00:26:52,750 --> 00:26:55,840
<font color="#E5E5E5">default domain controllers policy it</font>

715
00:26:54,340 --> 00:26:58,270
looks similar to this<font color="#E5E5E5"> pretty much</font>

716
00:26:55,840 --> 00:27:00,669
<font color="#E5E5E5">vanilla</font><font color="#CCCCCC"> same as it ever was</font>

717
00:26:58,270 --> 00:27:03,280
since the very beginning<font color="#E5E5E5"> Microsoft has</font>

718
00:27:00,670 --> 00:27:05,710
not changed this policy since the early

719
00:27:03,280 --> 00:27:08,320
days<font color="#CCCCCC"> of Active Directory</font><font color="#E5E5E5"> back when they</font>

720
00:27:05,710 --> 00:27:10,300
were concerned<font color="#E5E5E5"> about replication and so</font>

721
00:27:08,320 --> 00:27:13,240
in that default<font color="#E5E5E5"> domain controllers</font>

722
00:27:10,300 --> 00:27:15,040
policy<font color="#E5E5E5"> are these standard user rights</font>

723
00:27:13,240 --> 00:27:19,360
assignments<font color="#E5E5E5"> I'm not expecting anyone</font>

724
00:27:15,040 --> 00:27:20,740
actually<font color="#E5E5E5"> read this but I recommend that</font>

725
00:27:19,360 --> 00:27:23,020
you<font color="#E5E5E5"> do look at your default domain</font>

726
00:27:20,740 --> 00:27:24,340
<font color="#E5E5E5">controllers policy and that you look at</font>

727
00:27:23,020 --> 00:27:25,900
the policies that<font color="#CCCCCC"> apply to</font><font color="#E5E5E5"> in main</font>

728
00:27:24,340 --> 00:27:30,459
controllers because they can go from

729
00:27:25,900 --> 00:27:32,560
basic to bad<font color="#CCCCCC"> something like this which</font>

730
00:27:30,460 --> 00:27:33,790
<font color="#CCCCCC">looks pretty</font><font color="#E5E5E5"> much</font><font color="#CCCCCC"> exactly the</font><font color="#E5E5E5"> same</font><font color="#CCCCCC"> as</font>

731
00:27:32,560 --> 00:27:37,480
the screenshot I just showed you<font color="#CCCCCC"> right</font>

732
00:27:33,790 --> 00:27:37,930
<font color="#E5E5E5">especially those in the back so let me</font>

733
00:27:37,480 --> 00:27:40,540
help<font color="#E5E5E5"> you out</font>

734
00:27:37,930 --> 00:27:45,670
<font color="#E5E5E5">so someone for some reason has added</font>

735
00:27:40,540 --> 00:27:48,970
domain users to allow log on locally why

736
00:27:45,670 --> 00:27:52,020
I<font color="#E5E5E5"> don't know we've seen this a</font><font color="#CCCCCC"> few times</font>

737
00:27:48,970 --> 00:27:52,020
<font color="#E5E5E5">in the past</font><font color="#CCCCCC"> couple years</font>

738
00:27:52,750 --> 00:27:58,299
we've also seen where it's been

739
00:27:56,080 --> 00:27:59,949
configured<font color="#E5E5E5"> where someone can remotely</font>

740
00:27:58,299 --> 00:28:02,139
<font color="#CCCCCC">shutdown the</font><font color="#E5E5E5"> domain controller and</font>

741
00:27:59,950 --> 00:28:04,630
domain users are in that you know just

742
00:28:02,140 --> 00:28:08,650
in case<font color="#E5E5E5"> the admins are out of town and</font>

743
00:28:04,630 --> 00:28:10,990
we need to do maintenance on the<font color="#E5E5E5"> DC hey</font>

744
00:28:08,650 --> 00:28:12,789
can<font color="#E5E5E5"> anybody in the company shut</font><font color="#CCCCCC"> down</font><font color="#E5E5E5"> the</font>

745
00:28:10,990 --> 00:28:16,179
DC please because<font color="#CCCCCC"> we need to do that</font>

746
00:28:12,789 --> 00:28:18,429
<font color="#CCCCCC">right now I'm not really sure or this</font>

747
00:28:16,179 --> 00:28:19,929
situation<font color="#E5E5E5"> where you</font><font color="#CCCCCC"> have allow log on</font>

748
00:28:18,429 --> 00:28:22,090
through<font color="#E5E5E5"> Remote Desktop service has</font>

749
00:28:19,929 --> 00:28:24,789
server admins or some other<font color="#E5E5E5"> group</font><font color="#CCCCCC"> but</font>

750
00:28:22,090 --> 00:28:26,649
<font color="#E5E5E5">you know anyone</font><font color="#CCCCCC"> can log on locally this</font>

751
00:28:24,789 --> 00:28:30,100
means that server admins can actually

752
00:28:26,650 --> 00:28:35,080
RDP<font color="#CCCCCC"> into the DC's because</font><font color="#E5E5E5"> VM is the</font>

753
00:28:30,100 --> 00:28:36,850
server now<font color="#CCCCCC"> just the write shown here</font>

754
00:28:35,080 --> 00:28:39,309
<font color="#E5E5E5">allow log and locally does not allow</font>

755
00:28:36,850 --> 00:28:41,770
them<font color="#CCCCCC"> to</font><font color="#E5E5E5"> connect over the network to it</font>

756
00:28:39,309 --> 00:28:45,340
via RDP they need this other right<font color="#E5E5E5"> but</font>

757
00:28:41,770 --> 00:28:47,679
if they had access to<font color="#E5E5E5"> virtual client or</font>

758
00:28:45,340 --> 00:28:50,470
the server itself because it<font color="#E5E5E5"> was sitting</font>

759
00:28:47,679 --> 00:28:54,010
<font color="#E5E5E5">right over here then anyone could log on</font>

760
00:28:50,470 --> 00:28:55,630
to it and<font color="#E5E5E5"> then the other one that's</font>

761
00:28:54,010 --> 00:28:58,570
<font color="#CCCCCC">interesting is managing account by</font>

762
00:28:55,630 --> 00:29:00,520
auditing and security<font color="#E5E5E5"> lock</font><font color="#CCCCCC"> so exchange</font>

763
00:28:58,570 --> 00:29:02,950
typically requires this and<font color="#E5E5E5"> sometimes</font>

764
00:29:00,520 --> 00:29:05,289
there's<font color="#E5E5E5"> other service</font><font color="#CCCCCC"> accounts or groups</font>

765
00:29:02,950 --> 00:29:06,760
that<font color="#E5E5E5"> are added to this but the thing</font><font color="#CCCCCC"> to</font>

766
00:29:05,289 --> 00:29:08,500
<font color="#E5E5E5">understand about this and the one thing</font>

767
00:29:06,760 --> 00:29:11,799
<font color="#E5E5E5">I want to point out</font><font color="#CCCCCC"> as a</font><font color="#E5E5E5"> takeaway is</font>

768
00:29:08,500 --> 00:29:14,140
clear the security<font color="#CCCCCC"> lock</font><font color="#E5E5E5"> so any member</font>

769
00:29:11,799 --> 00:29:15,730
that<font color="#E5E5E5"> has this</font><font color="#CCCCCC"> right on</font><font color="#E5E5E5"> the domain</font>

770
00:29:14,140 --> 00:29:17,470
controller can clear the domain

771
00:29:15,730 --> 00:29:19,990
controller security log whenever they

772
00:29:17,470 --> 00:29:23,020
want<font color="#E5E5E5"> to so be very careful</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> what</font><font color="#CCCCCC"> how</font>

773
00:29:19,990 --> 00:29:24,970
that's configured and I mentioned

774
00:29:23,020 --> 00:29:26,500
delegation earlier there<font color="#CCCCCC"> is a user</font>

775
00:29:24,970 --> 00:29:28,150
rights assignment on domain controllers

776
00:29:26,500 --> 00:29:30,610
called<font color="#CCCCCC"> an</font><font color="#E5E5E5"> able computer and user</font>

777
00:29:28,150 --> 00:29:32,049
accounts<font color="#CCCCCC"> to be trusted for delegation so</font>

778
00:29:30,610 --> 00:29:34,510
this is very<font color="#E5E5E5"> much</font><font color="#CCCCCC"> that Kerberos</font>

779
00:29:32,049 --> 00:29:36,100
delegation configuration and Kerberos

780
00:29:34,510 --> 00:29:38,710
delegation that's a little confusing

781
00:29:36,100 --> 00:29:40,449
<font color="#CCCCCC">let's call it</font><font color="#E5E5E5"> Kerber impersonation so</font>

782
00:29:38,710 --> 00:29:42,580
basically if you're a goat<font color="#E5E5E5"> and</font><font color="#CCCCCC"> you want</font>

783
00:29:40,450 --> 00:29:43,590
to be a duck you could just impersonate

784
00:29:42,580 --> 00:29:46,510
the duck

785
00:29:43,590 --> 00:29:49,570
it's Thursday<font color="#CCCCCC"> what animal do you want to</font>

786
00:29:46,510 --> 00:29:51,789
be so the way that Kerberos<font color="#CCCCCC"> works with</font>

787
00:29:49,570 --> 00:29:54,010
this<font color="#E5E5E5"> double hop issue is you</font><font color="#CCCCCC"> have a user</font>

788
00:29:51,789 --> 00:29:55,720
<font color="#CCCCCC">that connects to this web server</font><font color="#E5E5E5"> you</font>

789
00:29:54,010 --> 00:29:58,480
<font color="#E5E5E5">have a database server behind this web</font>

790
00:29:55,720 --> 00:30:00,610
server<font color="#E5E5E5"> and using standard Kerberos the</font>

791
00:29:58,480 --> 00:30:02,320
user connects to<font color="#E5E5E5"> that web server and the</font>

792
00:30:00,610 --> 00:30:03,620
<font color="#CCCCCC">web server performs the update on the</font>

793
00:30:02,320 --> 00:30:06,080
database server

794
00:30:03,620 --> 00:30:07,250
as the<font color="#CCCCCC"> webserver well that's not great</font>

795
00:30:06,080 --> 00:30:09,110
<font color="#E5E5E5">because that</font><font color="#CCCCCC"> means every user</font>

796
00:30:07,250 --> 00:30:11,780
authenticates<font color="#CCCCCC"> so</font><font color="#E5E5E5"> the web server is</font><font color="#CCCCCC"> going</font>

797
00:30:09,110 --> 00:30:13,490
<font color="#CCCCCC">to</font><font color="#E5E5E5"> update that</font><font color="#CCCCCC"> data as the web server so</font>

798
00:30:11,780 --> 00:30:14,840
every single<font color="#CCCCCC"> update to that database</font>

799
00:30:13,490 --> 00:30:17,090
server is<font color="#CCCCCC"> the web server</font>

800
00:30:14,840 --> 00:30:19,970
so through Kerberos delegation we can

801
00:30:17,090 --> 00:30:23,540
say web server you can impersonate users

802
00:30:19,970 --> 00:30:26,840
and you can change<font color="#E5E5E5"> make those changes on</font>

803
00:30:23,540 --> 00:30:29,629
the database<font color="#E5E5E5"> as that user</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> sounds</font>

804
00:30:26,840 --> 00:30:30,949
<font color="#E5E5E5">very useful as I mentioned in the early</font>

805
00:30:29,630 --> 00:30:32,570
days of Active Directory there was this

806
00:30:30,950 --> 00:30:34,550
<font color="#E5E5E5">thing called unconstrained delegation</font>

807
00:30:32,570 --> 00:30:38,540
which we can find<font color="#E5E5E5"> using this lengthy</font>

808
00:30:34,550 --> 00:30:41,300
<font color="#CCCCCC">PowerShell command but unconstrained</font>

809
00:30:38,540 --> 00:30:44,300
delegation means that that when that web

810
00:30:41,300 --> 00:30:46,730
server receives<font color="#E5E5E5"> that user service ticket</font>

811
00:30:44,300 --> 00:30:49,159
<font color="#E5E5E5">that web server is basically allowed to</font>

812
00:30:46,730 --> 00:30:51,770
impersonate that user<font color="#E5E5E5"> to any Kerberos</font>

813
00:30:49,160 --> 00:30:54,290
service on the network<font color="#CCCCCC"> that seems less</font>

814
00:30:51,770 --> 00:30:55,730
than ideal<font color="#E5E5E5"> so this is what the</font>

815
00:30:54,290 --> 00:30:58,280
configuration<font color="#E5E5E5"> looks like on the computer</font>

816
00:30:55,730 --> 00:31:00,230
<font color="#E5E5E5">account</font><font color="#CCCCCC"> trusted the computer</font><font color="#E5E5E5"> for</font>

817
00:30:58,280 --> 00:31:02,750
delegation to any service Kerberos only

818
00:31:00,230 --> 00:31:05,360
so I dug into this and spoke about<font color="#E5E5E5"> it a</font>

819
00:31:02,750 --> 00:31:07,160
black had a<font color="#E5E5E5"> couple years ago and</font><font color="#CCCCCC"> pointed</font>

820
00:31:05,360 --> 00:31:10,040
<font color="#E5E5E5">out how the Kerberos flow works for this</font>

821
00:31:07,160 --> 00:31:11,540
because it seemed kind of vague and even

822
00:31:10,040 --> 00:31:13,280
the documentation didn't really dig<font color="#E5E5E5"> into</font>

823
00:31:11,540 --> 00:31:15,320
what it actually meant<font color="#CCCCCC"> so you have your</font>

824
00:31:13,280 --> 00:31:17,780
standard Kerberos off where you<font color="#E5E5E5"> go</font>

825
00:31:15,320 --> 00:31:19,879
<font color="#E5E5E5">I am Sean here you go domain controller</font>

826
00:31:17,780 --> 00:31:20,510
this<font color="#E5E5E5"> is my proof of identity this is</font><font color="#CCCCCC"> Who</font>

827
00:31:19,880 --> 00:31:22,309
I am

828
00:31:20,510 --> 00:31:24,320
<font color="#CCCCCC">okay domain controller says here's your</font>

829
00:31:22,309 --> 00:31:26,090
TGT or your authentication<font color="#CCCCCC"> ticket used</font>

830
00:31:24,320 --> 00:31:26,389
this for further<font color="#CCCCCC"> request</font><font color="#E5E5E5"> for a service</font>

831
00:31:26,090 --> 00:31:28,820
ticket

832
00:31:26,390 --> 00:31:30,320
<font color="#E5E5E5">sure so then I take that back</font><font color="#CCCCCC"> and say</font>

833
00:31:28,820 --> 00:31:32,720
domain controller I want to talk to this

834
00:31:30,320 --> 00:31:33,678
application<font color="#CCCCCC"> server over here the</font><font color="#E5E5E5"> domain</font>

835
00:31:32,720 --> 00:31:36,260
controller<font color="#E5E5E5"> looks up that application</font>

836
00:31:33,679 --> 00:31:38,900
<font color="#CCCCCC">server</font><font color="#E5E5E5"> and says ah unconstrained</font>

837
00:31:36,260 --> 00:31:41,210
delegation what I'm going to do is<font color="#E5E5E5"> take</font>

838
00:31:38,900 --> 00:31:43,100
that TGT your authentication ticket that

839
00:31:41,210 --> 00:31:44,900
proves who you are to any domain

840
00:31:43,100 --> 00:31:47,120
<font color="#E5E5E5">controller</font><font color="#CCCCCC"> in order</font><font color="#E5E5E5"> for you to</font><font color="#CCCCCC"> get</font><font color="#E5E5E5"> that</font>

841
00:31:44,900 --> 00:31:48,950
service ticket I'm gonna put that<font color="#CCCCCC"> in</font>

842
00:31:47,120 --> 00:31:50,360
<font color="#CCCCCC">that service</font><font color="#E5E5E5"> ticket that you are then</font>

843
00:31:48,950 --> 00:31:54,020
going<font color="#CCCCCC"> to provide</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> application</font>

844
00:31:50,360 --> 00:31:56,840
<font color="#E5E5E5">server that application server can now</font>

845
00:31:54,020 --> 00:31:59,480
impersonate me<font color="#E5E5E5"> whenever</font><font color="#CCCCCC"> it wants to</font>

846
00:31:56,840 --> 00:32:03,199
-<font color="#E5E5E5"> Annie Kerberos service on the entire</font>

847
00:31:59,480 --> 00:32:05,090
<font color="#E5E5E5">network so as an attacker if I</font>

848
00:32:03,200 --> 00:32:08,300
<font color="#E5E5E5">compromised the server all I need to do</font>

849
00:32:05,090 --> 00:32:09,830
is to get a<font color="#CCCCCC"> domain admin or someone with</font>

850
00:32:08,300 --> 00:32:13,409
rights<font color="#E5E5E5"> that I want to connect to this</font>

851
00:32:09,830 --> 00:32:16,470
server on any Kerberos service I don't

852
00:32:13,410 --> 00:32:17,910
a<font color="#E5E5E5"> file share would any domain admin be</font>

853
00:32:16,470 --> 00:32:19,950
concerned about connecting to<font color="#CCCCCC"> a file</font>

854
00:32:17,910 --> 00:32:22,680
share on a server<font color="#E5E5E5"> on the network</font>

855
00:32:19,950 --> 00:32:24,090
probably not<font color="#E5E5E5"> there's a number of</font><font color="#CCCCCC"> ways to</font>

856
00:32:22,680 --> 00:32:25,890
<font color="#E5E5E5">get them to do that which I won't get</font>

857
00:32:24,090 --> 00:32:28,439
<font color="#CCCCCC">into</font><font color="#E5E5E5"> here but once they connect to that</font>

858
00:32:25,890 --> 00:32:31,290
<font color="#CCCCCC">there TGT that authentication ticket is</font>

859
00:32:28,440 --> 00:32:34,230
now in<font color="#E5E5E5"> memory on that</font><font color="#CCCCCC"> server an attacker</font>

860
00:32:31,290 --> 00:32:36,720
can<font color="#E5E5E5"> extract that</font><font color="#CCCCCC"> reuse that</font><font color="#E5E5E5"> using many</font>

861
00:32:34,230 --> 00:32:38,490
cats or<font color="#E5E5E5"> something else and then connect</font>

862
00:32:36,720 --> 00:32:41,700
<font color="#E5E5E5">to a domain controller and dump the</font><font color="#CCCCCC"> kerb</font>

863
00:32:38,490 --> 00:32:43,680
TGT or whatever really they want to just

864
00:32:41,700 --> 00:32:45,600
<font color="#E5E5E5">because they compromised the server that</font>

865
00:32:43,680 --> 00:32:48,420
<font color="#E5E5E5">had unconstrained delegation configured</font>

866
00:32:45,600 --> 00:32:50,929
<font color="#E5E5E5">and they got someone</font><font color="#CCCCCC"> with rights to</font>

867
00:32:48,420 --> 00:32:53,250
connect to any Kerberos service on it

868
00:32:50,930 --> 00:32:55,140
so there's constrain delegation which is

869
00:32:53,250 --> 00:32:57,930
much better<font color="#E5E5E5"> right because what we'll do</font>

870
00:32:55,140 --> 00:33:00,300
here is we'll say<font color="#E5E5E5"> all right the</font>

871
00:32:57,930 --> 00:33:02,760
<font color="#E5E5E5">delegation is only going</font><font color="#CCCCCC"> to work on this</font>

872
00:33:00,300 --> 00:33:05,280
server<font color="#CCCCCC"> to these specific services</font><font color="#E5E5E5"> on</font>

873
00:33:02,760 --> 00:33:08,760
these<font color="#CCCCCC"> specific servers</font><font color="#E5E5E5"> much much better</font>

874
00:33:05,280 --> 00:33:10,170
<font color="#E5E5E5">right but of course if the attacker runs</font>

875
00:33:08,760 --> 00:33:12,600
a search count they can<font color="#CCCCCC"> impersonate the</font>

876
00:33:10,170 --> 00:33:14,400
user to specific service on a server<font color="#E5E5E5"> so</font>

877
00:33:12,600 --> 00:33:17,639
but it's better than unconstrained

878
00:33:14,400 --> 00:33:19,050
delegation<font color="#E5E5E5"> Microsoft also added</font>

879
00:33:17,640 --> 00:33:20,280
something<font color="#E5E5E5"> else in this time of</font>

880
00:33:19,050 --> 00:33:23,780
constrained<font color="#E5E5E5"> delegations that they call</font>

881
00:33:20,280 --> 00:33:26,190
protocol transition<font color="#CCCCCC"> I call this magic</font>

882
00:33:23,780 --> 00:33:29,460
<font color="#E5E5E5">let's see what happens with protocol</font>

883
00:33:26,190 --> 00:33:31,950
transition this enables this server or

884
00:33:29,460 --> 00:33:34,590
service account<font color="#E5E5E5"> to impersonate anybody</font>

885
00:33:31,950 --> 00:33:37,980
on the network to a Kerberos service

886
00:33:34,590 --> 00:33:39,449
that's defined here without any prior

887
00:33:37,980 --> 00:33:41,060
authentication or proof<font color="#CCCCCC"> of</font>

888
00:33:39,450 --> 00:33:43,020
authentication<font color="#E5E5E5"> to the domain controller</font>

889
00:33:41,060 --> 00:33:45,450
<font color="#E5E5E5">so here's how this works</font>

890
00:33:43,020 --> 00:33:48,150
<font color="#CCCCCC">I'm</font><font color="#E5E5E5"> the server that's configured with</font>

891
00:33:45,450 --> 00:33:48,750
protocol transition<font color="#CCCCCC"> I say domain</font>

892
00:33:48,150 --> 00:33:50,970
controller

893
00:33:48,750 --> 00:33:54,180
everybody in this room authenticated to

894
00:33:50,970 --> 00:33:56,490
<font color="#E5E5E5">me give me delegation tickets to these</font>

895
00:33:54,180 --> 00:33:58,470
services<font color="#E5E5E5"> and the domain controllers</font>

896
00:33:56,490 --> 00:34:01,260
checks sees<font color="#E5E5E5"> that I have those rights and</font>

897
00:33:58,470 --> 00:34:02,310
magically gives it to me<font color="#CCCCCC"> so you didn't</font>

898
00:34:01,260 --> 00:34:04,490
<font color="#E5E5E5">know you're gonna see a magic show today</font>

899
00:34:02,310 --> 00:34:07,260
but<font color="#E5E5E5"> that's how it works</font>

900
00:34:04,490 --> 00:34:09,090
it's just that<font color="#E5E5E5"> easy and</font><font color="#CCCCCC"> so anyone</font><font color="#E5E5E5"> that</font>

901
00:34:07,260 --> 00:34:11,219
<font color="#E5E5E5">has this right here on a domain</font>

902
00:34:09,090 --> 00:34:13,860
<font color="#CCCCCC">controller like trusty</font><font color="#E5E5E5"> mixer</font><font color="#CCCCCC"> vus account</font>

903
00:34:11,219 --> 00:34:17,009
has the ability to<font color="#E5E5E5"> configure delegation</font>

904
00:34:13,860 --> 00:34:19,590
<font color="#E5E5E5">and has control over</font><font color="#CCCCCC"> this can configure</font>

905
00:34:17,010 --> 00:34:23,429
protocol transition or Kerberos magic

906
00:34:19,590 --> 00:34:24,159
and then basically<font color="#CCCCCC"> just say that admins</font>

907
00:34:23,429 --> 00:34:27,879
have a

908
00:34:24,159 --> 00:34:30,369
<font color="#CCCCCC">kated so something that's pretty</font>

909
00:34:27,879 --> 00:34:32,020
interesting about this is at Derby con a

910
00:34:30,369 --> 00:34:33,879
<font color="#E5E5E5">couple years ago I talked about how you</font>

911
00:34:32,020 --> 00:34:36,009
<font color="#E5E5E5">could use a service to a silver ticket</font>

912
00:34:33,879 --> 00:34:39,159
for an<font color="#CCCCCC"> LDAP service on a domain</font>

913
00:34:36,010 --> 00:34:40,720
<font color="#E5E5E5">controller</font><font color="#CCCCCC"> to then do DC sync so what</font>

914
00:34:39,159 --> 00:34:43,119
does this mean this means<font color="#E5E5E5"> that if I have</font>

915
00:34:40,719 --> 00:34:45,638
a<font color="#E5E5E5"> ticket</font><font color="#CCCCCC"> that says I'm a domain admin or</font>

916
00:34:43,119 --> 00:34:47,079
someone with rights to do a DC sync -

917
00:34:45,639 --> 00:34:49,329
the LDAP service on a domain<font color="#E5E5E5"> controller</font>

918
00:34:47,079 --> 00:34:52,500
<font color="#CCCCCC">that means that I can DC sync and pull</font>

919
00:34:49,329 --> 00:34:56,500
those credentials<font color="#E5E5E5"> from Active Directory</font>

920
00:34:52,500 --> 00:35:00,880
so I wondered what if I could add some

921
00:34:56,500 --> 00:35:02,559
<font color="#CCCCCC">magic to this so I</font><font color="#E5E5E5"> did and so what ends</font>

922
00:35:00,880 --> 00:35:05,170
up<font color="#CCCCCC"> happening is we have a</font><font color="#E5E5E5"> service count</font>

923
00:35:02,559 --> 00:35:07,660
here which has<font color="#E5E5E5"> the</font><font color="#CCCCCC"> ability just</font><font color="#E5E5E5"> like</font>

924
00:35:05,170 --> 00:35:09,700
<font color="#E5E5E5">that</font><font color="#CCCCCC"> em</font><font color="#E5E5E5"> sol</font><font color="#CCCCCC"> adder 80</font><font color="#E5E5E5"> Connect service</font>

925
00:35:07,660 --> 00:35:12,670
<font color="#CCCCCC">that</font><font color="#E5E5E5"> I mentioned earlier to actually</font>

926
00:35:09,700 --> 00:35:15,009
pull those password hashes<font color="#CCCCCC"> and I</font>

927
00:35:12,670 --> 00:35:18,819
<font color="#CCCCCC">configure delegation for this server</font>

928
00:35:15,010 --> 00:35:22,390
<font color="#E5E5E5">which I compromised for LDAP on a domain</font>

929
00:35:18,819 --> 00:35:25,690
<font color="#E5E5E5">controller</font><font color="#CCCCCC"> ah so then what I</font><font color="#E5E5E5"> did using</font>

930
00:35:22,390 --> 00:35:27,910
magic<font color="#CCCCCC"> I said this service count is</font>

931
00:35:25,690 --> 00:35:31,150
authenticated<font color="#E5E5E5"> to me domain controller I</font>

932
00:35:27,910 --> 00:35:34,990
need a service ticket<font color="#E5E5E5"> for this service</font>

933
00:35:31,150 --> 00:35:36,430
<font color="#E5E5E5">account using delegation to this LDAP</font>

934
00:35:34,990 --> 00:35:37,839
service on this domain controller which

935
00:35:36,430 --> 00:35:41,558
<font color="#CCCCCC">is to make sure</font><font color="#E5E5E5"> we're</font><font color="#CCCCCC"> happily gave to me</font>

936
00:35:37,839 --> 00:35:46,089
because I have<font color="#E5E5E5"> the right</font><font color="#CCCCCC"> to have it so</font>

937
00:35:41,559 --> 00:35:50,950
now through<font color="#E5E5E5"> Kerberos magic</font><font color="#CCCCCC"> I own the</font>

938
00:35:46,089 --> 00:35:53,230
domain so you<font color="#CCCCCC"> can discover all Kerberos</font>

939
00:35:50,950 --> 00:35:54,549
delegation by the way all of these

940
00:35:53,230 --> 00:35:56,920
slides<font color="#E5E5E5"> will be available on</font><font color="#CCCCCC"> a tee</font>

941
00:35:54,549 --> 00:35:58,990
security org<font color="#E5E5E5"> including this one which</font>

942
00:35:56,920 --> 00:36:01,510
<font color="#E5E5E5">basically tells you how</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> find Kerberos</font>

943
00:35:58,990 --> 00:36:03,129
delegation you<font color="#CCCCCC"> can find unconstrained</font>

944
00:36:01,510 --> 00:36:05,250
constrained<font color="#E5E5E5"> and constrained protocol</font>

945
00:36:03,130 --> 00:36:07,869
transition<font color="#CCCCCC"> I highly recommend you do it</font>

946
00:36:05,250 --> 00:36:09,849
<font color="#E5E5E5">understand how Kerberos delegation is</font>

947
00:36:07,869 --> 00:36:13,750
configured and really ask the question

948
00:36:09,849 --> 00:36:15,849
<font color="#CCCCCC">why I found hundreds of systems</font><font color="#E5E5E5"> with</font>

949
00:36:13,750 --> 00:36:17,890
Kerberos delegation enabled<font color="#E5E5E5"> and no one</font>

950
00:36:15,849 --> 00:36:21,160
can<font color="#E5E5E5"> tell me why because at some point it</font>

951
00:36:17,890 --> 00:36:23,558
was<font color="#E5E5E5"> set up in the</font><font color="#CCCCCC"> past so how do we</font>

952
00:36:21,160 --> 00:36:24,220
<font color="#E5E5E5">mitigate this the mitigation is actually</font>

953
00:36:23,559 --> 00:36:27,220
pretty simple

954
00:36:24,220 --> 00:36:29,740
you set account<font color="#E5E5E5"> as sensitive and cannot</font>

955
00:36:27,220 --> 00:36:31,328
be<font color="#CCCCCC"> delegated on all admin accounts and</font>

956
00:36:29,740 --> 00:36:33,759
then the Kerberos delegation does not

957
00:36:31,329 --> 00:36:35,239
work for<font color="#E5E5E5"> those the</font><font color="#CCCCCC"> problem is that</font>

958
00:36:33,760 --> 00:36:37,859
service accounts

959
00:36:35,239 --> 00:36:39,720
typically<font color="#E5E5E5"> can I have this configured in</font>

960
00:36:37,859 --> 00:36:40,979
fact<font color="#CCCCCC"> Microsoft says do not configure</font>

961
00:36:39,720 --> 00:36:42,359
this on service accounts because

962
00:36:40,979 --> 00:36:44,759
<font color="#CCCCCC">oftentimes</font><font color="#E5E5E5"> they need to do some</font>

963
00:36:42,359 --> 00:36:46,470
delegation<font color="#CCCCCC"> even</font><font color="#E5E5E5"> better than that is</font>

964
00:36:44,759 --> 00:36:48,509
adding these admin accounts to protected

965
00:36:46,470 --> 00:36:51,538
users group<font color="#CCCCCC"> and that way delegation is</font>

966
00:36:48,509 --> 00:36:54,180
blocked<font color="#E5E5E5"> and a lot of insecure or</font>

967
00:36:51,539 --> 00:36:55,349
<font color="#CCCCCC">well-known attacks</font><font color="#E5E5E5"> and insecure methods</font>

968
00:36:54,180 --> 00:36:57,899
<font color="#CCCCCC">or well-known</font><font color="#E5E5E5"> attacks aren't going to</font>

969
00:36:55,349 --> 00:37:02,999
<font color="#E5E5E5">work the same</font><font color="#CCCCCC"> way they</font><font color="#E5E5E5"> did</font><font color="#CCCCCC"> and you can</font>

970
00:36:57,900 --> 00:37:04,739
also check this here there is MSDS

971
00:37:02,999 --> 00:37:06,779
allowed to delegate to<font color="#CCCCCC"> the</font><font color="#E5E5E5"> list of spins</font>

972
00:37:04,739 --> 00:37:09,119
for constrain delegation<font color="#CCCCCC"> you definitely</font>

973
00:37:06,779 --> 00:37:11,940
want to<font color="#E5E5E5"> check for domain controller</font>

974
00:37:09,119 --> 00:37:13,680
spins<font color="#E5E5E5"> in that setting</font><font color="#CCCCCC"> because</font><font color="#E5E5E5"> that will</font>

975
00:37:11,940 --> 00:37:15,269
highlight if<font color="#E5E5E5"> someone's using protocol</font>

976
00:37:13,680 --> 00:37:20,220
transition or something<font color="#E5E5E5"> like that to</font>

977
00:37:15,269 --> 00:37:21,629
LDAP on a domain<font color="#CCCCCC"> controller</font><font color="#E5E5E5"> so when we</font>

978
00:37:20,220 --> 00:37:23,249
look at attacker capability and

979
00:37:21,630 --> 00:37:25,079
mitigations with Active Directory what

980
00:37:23,249 --> 00:37:28,160
are we looking at<font color="#E5E5E5"> well ultimately what</font>

981
00:37:25,079 --> 00:37:31,289
two attackers require<font color="#E5E5E5"> they need account</font>

982
00:37:28,160 --> 00:37:33,538
credentials they need rights privileges

983
00:37:31,289 --> 00:37:35,519
and<font color="#CCCCCC"> they need some sort of</font><font color="#E5E5E5"> access the</font>

984
00:37:33,539 --> 00:37:38,609
ability<font color="#CCCCCC"> to</font><font color="#E5E5E5"> connect and and do what they</font>

985
00:37:35,519 --> 00:37:40,169
<font color="#E5E5E5">need to do so three things what do you</font>

986
00:37:38,609 --> 00:37:42,420
think happens if<font color="#CCCCCC"> we block one of</font><font color="#E5E5E5"> these</font>

987
00:37:40,170 --> 00:37:43,920
or mitigate one of these or prevent one

988
00:37:42,420 --> 00:37:45,299
of<font color="#E5E5E5"> these they can't do what they</font><font color="#CCCCCC"> need to</font>

989
00:37:43,920 --> 00:37:47,039
they can have the account and<font color="#E5E5E5"> rights but</font>

990
00:37:45,299 --> 00:37:49,170
if they can't connect to<font color="#E5E5E5"> the services or</font>

991
00:37:47,039 --> 00:37:51,239
servers<font color="#E5E5E5"> that enable them to</font><font color="#CCCCCC"> use those</font>

992
00:37:49,170 --> 00:37:52,680
rights they can't do anything or if they

993
00:37:51,239 --> 00:37:55,049
have the account credentials<font color="#CCCCCC"> and the</font>

994
00:37:52,680 --> 00:37:56,940
access but that account currently

995
00:37:55,049 --> 00:37:59,640
doesn't<font color="#CCCCCC"> have those rights</font><font color="#E5E5E5"> they can't do</font>

996
00:37:56,940 --> 00:38:01,650
<font color="#CCCCCC">anything because in a traditional</font><font color="#E5E5E5"> ad</font>

997
00:37:59,640 --> 00:38:03,930
<font color="#E5E5E5">administration environment all admins or</font>

998
00:38:01,650 --> 00:38:06,269
<font color="#E5E5E5">domain admins administration from</font>

999
00:38:03,930 --> 00:38:08,519
anywhere<font color="#CCCCCC"> need a</font><font color="#E5E5E5"> surge count with 88</font>

1000
00:38:06,269 --> 00:38:10,468
<font color="#CCCCCC">rights guess what you get domain admin I</font>

1001
00:38:08,519 --> 00:38:11,999
need to manage user accounts<font color="#CCCCCC"> we're going</font>

1002
00:38:10,469 --> 00:38:13,349
to go ahead and set up account operators

1003
00:38:11,999 --> 00:38:15,618
if you need to do any<font color="#E5E5E5"> kind of backup</font>

1004
00:38:13,349 --> 00:38:19,410
backup<font color="#E5E5E5"> operators even for workstations</font>

1005
00:38:15,619 --> 00:38:21,650
and management<font color="#E5E5E5"> just everywhere patching</font>

1006
00:38:19,410 --> 00:38:26,180
everywhere agents<font color="#E5E5E5"> all over</font><font color="#CCCCCC"> the place</font>

1007
00:38:21,650 --> 00:38:26,180
and compromise is<font color="#E5E5E5"> very likely</font>

1008
00:38:26,410 --> 00:38:32,399
so the question<font color="#E5E5E5"> a lot of the times is</font>

1009
00:38:28,750 --> 00:38:36,300
has an attacker do I need<font color="#E5E5E5"> to maenad</font>

1010
00:38:32,400 --> 00:38:38,800
anyone no no<font color="#CCCCCC"> absolutely</font><font color="#E5E5E5"> not</font>

1011
00:38:36,300 --> 00:38:40,600
tackers have lots of options<font color="#CCCCCC"> group</font>

1012
00:38:38,800 --> 00:38:43,180
<font color="#E5E5E5">policy delegated permissions</font><font color="#CCCCCC"> ad</font>

1013
00:38:40,600 --> 00:38:45,400
permissions<font color="#E5E5E5"> and proper group nesting</font><font color="#CCCCCC"> /</font>

1014
00:38:43,180 --> 00:38:47,740
permission accounts service<font color="#CCCCCC"> count access</font>

1015
00:38:45,400 --> 00:38:50,980
<font color="#CCCCCC">Kerberos delegation password vaults that</font>

1016
00:38:47,740 --> 00:38:53,020
are improperly managed and protected<font color="#CCCCCC"> the</font>

1017
00:38:50,980 --> 00:38:55,600
backup<font color="#CCCCCC"> process the backup service count</font>

1018
00:38:53,020 --> 00:38:58,120
<font color="#CCCCCC">etc but in the real</font><font color="#E5E5E5"> world</font><font color="#CCCCCC"> where these</font>

1019
00:38:55,600 --> 00:38:58,450
rights<font color="#E5E5E5"> are everywhere they're all over</font>

1020
00:38:58,120 --> 00:39:00,310
the place

1021
00:38:58,450 --> 00:39:01,930
why because workstation admins<font color="#E5E5E5"> have full</font>

1022
00:39:00,310 --> 00:39:04,270
rights the workstations server admins

1023
00:39:01,930 --> 00:39:05,620
have full right<font color="#E5E5E5"> to servers local admin</font>

1024
00:39:04,270 --> 00:39:08,830
accounts and passwords are often the

1025
00:39:05,620 --> 00:39:10,330
same temporary<font color="#E5E5E5"> admin groups I'm going to</font>

1026
00:39:08,830 --> 00:39:12,490
add to this group temporarily<font color="#E5E5E5"> just for</font>

1027
00:39:10,330 --> 00:39:14,230
today<font color="#E5E5E5"> fix what you need to I get busy I</font>

1028
00:39:12,490 --> 00:39:16,149
<font color="#CCCCCC">gotta</font><font color="#E5E5E5"> go do something over here and I</font>

1029
00:39:14,230 --> 00:39:18,460
forget<font color="#E5E5E5"> about it</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> it happens people</font>

1030
00:39:16,150 --> 00:39:23,320
<font color="#CCCCCC">are</font><font color="#E5E5E5"> busy</font><font color="#CCCCCC"> and then the one that we see a</font>

1031
00:39:18,460 --> 00:39:25,420
lot is this group policy<font color="#E5E5E5"> reuse so group</font>

1032
00:39:23,320 --> 00:39:27,400
policy is<font color="#E5E5E5"> configured with server policy</font>

1033
00:39:25,420 --> 00:39:29,020
on the<font color="#E5E5E5"> server so you and</font><font color="#CCCCCC"> someone goes</font>

1034
00:39:27,400 --> 00:39:30,670
<font color="#E5E5E5">you</font><font color="#CCCCCC"> know what</font><font color="#E5E5E5"> domain controllers are</font>

1035
00:39:29,020 --> 00:39:33,759
servers<font color="#CCCCCC"> - I'm gonna apply that to</font><font color="#E5E5E5"> the</font>

1036
00:39:30,670 --> 00:39:35,440
main controllers but this policy has a

1037
00:39:33,760 --> 00:39:37,960
restricted group which adds server

1038
00:39:35,440 --> 00:39:38,920
admins<font color="#E5E5E5"> to the local administrators</font><font color="#CCCCCC"> group</font>

1039
00:39:37,960 --> 00:39:40,690
<font color="#CCCCCC">ah</font>

1040
00:39:38,920 --> 00:39:43,510
but<font color="#CCCCCC"> Shawn to make controllers don't</font><font color="#E5E5E5"> have</font>

1041
00:39:40,690 --> 00:39:45,160
a local<font color="#E5E5E5"> administrators group you're</font>

1042
00:39:43,510 --> 00:39:47,680
right they don't<font color="#E5E5E5"> so it goes</font><font color="#CCCCCC"> to the</font>

1043
00:39:45,160 --> 00:39:49,149
domain administrators group about<font color="#E5E5E5"> five</font>

1044
00:39:47,680 --> 00:39:52,930
minutes<font color="#E5E5E5"> later when</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> domain controller</font>

1045
00:39:49,150 --> 00:39:54,100
applies group policy so we worked<font color="#CCCCCC"> with</font>

1046
00:39:52,930 --> 00:39:55,600
organizations<font color="#E5E5E5"> and they are quite</font>

1047
00:39:54,100 --> 00:39:59,319
confused when we point this<font color="#E5E5E5"> out and say</font>

1048
00:39:55,600 --> 00:40:01,480
hey why is server admins<font color="#CCCCCC"> in your domain</font>

1049
00:39:59,320 --> 00:40:04,450
administrators group<font color="#E5E5E5"> like I don't know</font>

1050
00:40:01,480 --> 00:40:06,250
and then we track it<font color="#E5E5E5"> back to this policy</font>

1051
00:40:04,450 --> 00:40:09,730
which shouldn't<font color="#E5E5E5"> been there in the first</font>

1052
00:40:06,250 --> 00:40:12,610
<font color="#CCCCCC">place or similarly</font><font color="#E5E5E5"> someone has done this</font>

1053
00:40:09,730 --> 00:40:15,460
and this server policy group policy here

1054
00:40:12,610 --> 00:40:18,130
has delegation to<font color="#E5E5E5"> a very broad group</font>

1055
00:40:15,460 --> 00:40:20,320
policy management group which has all

1056
00:40:18,130 --> 00:40:21,850
sorts of users in it and there have the

1057
00:40:20,320 --> 00:40:25,720
ability to<font color="#CCCCCC"> modify this</font><font color="#E5E5E5"> group</font><font color="#CCCCCC"> policy</font>

1058
00:40:21,850 --> 00:40:27,819
which applies<font color="#CCCCCC"> to Adam HR</font><font color="#E5E5E5"> so from the red</font>

1059
00:40:25,720 --> 00:40:31,049
team's perspective<font color="#CCCCCC"> they're pretty much</font>

1060
00:40:27,820 --> 00:40:33,730
riding a raptor<font color="#CCCCCC"> on a great white with a</font>

1061
00:40:31,050 --> 00:40:35,410
rocket-propelled grenade launcher right

1062
00:40:33,730 --> 00:40:37,220
<font color="#E5E5E5">it's basically they can do whatever they</font>

1063
00:40:35,410 --> 00:40:39,440
want<font color="#CCCCCC"> because it's too easy</font>

1064
00:40:37,220 --> 00:40:41,149
<font color="#CCCCCC">eighty is only secure</font><font color="#E5E5E5"> as the admin</font>

1065
00:40:39,440 --> 00:40:42,650
accounts the the<font color="#E5E5E5"> act directory admin</font>

1066
00:40:41,150 --> 00:40:44,270
accounts and since<font color="#E5E5E5"> these domain admin</font>

1067
00:40:42,650 --> 00:40:46,549
accounts are logged on to everywhere

1068
00:40:44,270 --> 00:40:48,349
they're very easy<font color="#E5E5E5"> to find because</font><font color="#CCCCCC"> they</font>

1069
00:40:46,549 --> 00:40:49,940
know the account<font color="#E5E5E5"> right is a combination</font>

1070
00:40:48,349 --> 00:40:52,339
of the group<font color="#E5E5E5"> membership which</font><font color="#CCCCCC"> is the</font>

1071
00:40:49,940 --> 00:40:55,490
<font color="#CCCCCC">eighty</font><font color="#E5E5E5"> group and the local computer</font>

1072
00:40:52,339 --> 00:40:57,440
groups<font color="#E5E5E5"> and then the delegated oh you and</font>

1073
00:40:55,490 --> 00:40:59,689
GPO permissions<font color="#CCCCCC"> so if you compromised</font>

1074
00:40:57,440 --> 00:41:02,480
<font color="#CCCCCC">the correct account you have everything</font>

1075
00:40:59,690 --> 00:41:05,720
<font color="#E5E5E5">and then there's the concept of admin</font>

1076
00:41:02,480 --> 00:41:08,329
servers<font color="#CCCCCC"> so many organizations there</font>

1077
00:41:05,720 --> 00:41:09,919
<font color="#CCCCCC">eighty admins</font><font color="#E5E5E5"> log on to the regular user</font>

1078
00:41:08,329 --> 00:41:13,190
workstation with their user account<font color="#E5E5E5"> and</font>

1079
00:41:09,920 --> 00:41:15,200
then they RDP to an admin server<font color="#E5E5E5"> and</font>

1080
00:41:13,190 --> 00:41:16,700
they do what they need to<font color="#E5E5E5"> do there but</font>

1081
00:41:15,200 --> 00:41:19,160
<font color="#E5E5E5">the thing</font><font color="#CCCCCC"> that's often</font><font color="#E5E5E5"> forgotten about</font>

1082
00:41:16,700 --> 00:41:21,348
is that when all these admins are

1083
00:41:19,160 --> 00:41:24,200
logging<font color="#E5E5E5"> on to this admin server often</font>

1084
00:41:21,349 --> 00:41:26,630
with admin<font color="#E5E5E5"> rights interesting things can</font>

1085
00:41:24,200 --> 00:41:31,490
happen even<font color="#E5E5E5"> if they use two-factor to</font>

1086
00:41:26,630 --> 00:41:33,680
the RDP service or access protocol<font color="#CCCCCC"> WM</font><font color="#E5E5E5"> is</font>

1087
00:41:31,490 --> 00:41:36,618
missed when<font color="#E5E5E5"> RM is missed</font><font color="#CCCCCC"> there's other</font>

1088
00:41:33,680 --> 00:41:38,270
ways to<font color="#CCCCCC"> access that server remotely</font><font color="#E5E5E5"> so</font>

1089
00:41:36,619 --> 00:41:39,920
if you can compromise<font color="#E5E5E5"> this admin server</font>

1090
00:41:38,270 --> 00:41:43,400
you can obviously own the<font color="#CCCCCC"> domain because</font>

1091
00:41:39,920 --> 00:41:44,599
<font color="#E5E5E5">all of these</font><font color="#CCCCCC"> accounts are on there so</font>

1092
00:41:43,400 --> 00:41:46,430
there's an<font color="#CCCCCC"> interesting</font><font color="#E5E5E5"> way to hijack</font>

1093
00:41:44,599 --> 00:41:49,160
this so if you<font color="#CCCCCC"> compromise</font><font color="#E5E5E5"> an admin</font>

1094
00:41:46,430 --> 00:41:53,589
account connect to that<font color="#CCCCCC"> server get</font>

1095
00:41:49,160 --> 00:41:56,020
system on it and run TSK XE as system

1096
00:41:53,589 --> 00:41:59,119
you can do something very<font color="#E5E5E5"> interesting</font>

1097
00:41:56,020 --> 00:42:00,890
<font color="#E5E5E5">because if you can run TS Condotti XE as</font>

1098
00:41:59,119 --> 00:42:03,049
<font color="#CCCCCC">a</font><font color="#E5E5E5"> system user you can connect to any of</font>

1099
00:42:00,890 --> 00:42:08,420
these RDP sessions without a password

1100
00:42:03,049 --> 00:42:10,069
<font color="#CCCCCC">and so</font><font color="#E5E5E5"> Alexander</font><font color="#CCCCCC"> cours knockoff did a</font>

1101
00:42:08,420 --> 00:42:11,000
blog<font color="#E5E5E5"> post</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> this over the summer and</font>

1102
00:42:10,069 --> 00:42:12,410
he said you know what's<font color="#E5E5E5"> interesting</font>

1103
00:42:11,000 --> 00:42:13,819
about this<font color="#E5E5E5"> you could actually create a</font>

1104
00:42:12,410 --> 00:42:17,990
service<font color="#CCCCCC"> that would</font><font color="#E5E5E5"> do this automatically</font>

1105
00:42:13,819 --> 00:42:20,690
<font color="#CCCCCC">for you because</font><font color="#E5E5E5"> RDP sessions to a server</font>

1106
00:42:17,990 --> 00:42:23,629
<font color="#E5E5E5">are shared that's a shared</font><font color="#CCCCCC"> environment</font>

1107
00:42:20,690 --> 00:42:25,160
<font color="#CCCCCC">and so what he figured</font><font color="#E5E5E5"> out is you could</font>

1108
00:42:23,630 --> 00:42:27,589
leverage the<font color="#CCCCCC"> stickykeys</font><font color="#E5E5E5"> persistence</font>

1109
00:42:25,160 --> 00:42:30,410
method connect to that RDP server hit

1110
00:42:27,589 --> 00:42:33,259
shift 5 times<font color="#E5E5E5"> get a command prompt</font><font color="#CCCCCC"> that</font>

1111
00:42:30,410 --> 00:42:34,730
pops up<font color="#E5E5E5"> as system and then run TS con</font>

1112
00:42:33,260 --> 00:42:36,890
there and then connect<font color="#E5E5E5"> to whatever sir</font>

1113
00:42:34,730 --> 00:42:38,900
whatever<font color="#E5E5E5"> session he wanted to without</font>

1114
00:42:36,890 --> 00:42:40,640
<font color="#CCCCCC">authenticating at all now of course he</font>

1115
00:42:38,900 --> 00:42:42,859
needs prior access to that server in

1116
00:42:40,640 --> 00:42:46,160
order<font color="#CCCCCC"> to replace</font><font color="#E5E5E5"> the the sticky keys</font>

1117
00:42:42,859 --> 00:42:48,890
executable with cmd.exe but and then

1118
00:42:46,160 --> 00:42:51,368
turn off<font color="#E5E5E5"> an</font><font color="#CCCCCC"> L a to that RDP server</font><font color="#E5E5E5"> but</font>

1119
00:42:48,890 --> 00:42:54,080
who's<font color="#E5E5E5"> monitoring for that</font>

1120
00:42:51,369 --> 00:42:56,060
so Microsoft<font color="#E5E5E5"> has provided a number</font><font color="#CCCCCC"> of</font>

1121
00:42:54,080 --> 00:43:00,109
<font color="#E5E5E5">Active Directory security guidance and</font>

1122
00:42:56,060 --> 00:43:03,440
so they<font color="#CCCCCC"> basically said hey we could help</font>

1123
00:43:00,109 --> 00:43:05,000
you<font color="#E5E5E5"> with this so let's</font><font color="#CCCCCC"> talk about this</font>

1124
00:43:03,440 --> 00:43:06,770
I'm<font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> go</font><font color="#CCCCCC"> over</font><font color="#E5E5E5"> this fairly quickly</font>

1125
00:43:05,000 --> 00:43:08,349
<font color="#CCCCCC">and just highlight some things</font><font color="#E5E5E5"> and</font>

1126
00:43:06,770 --> 00:43:11,180
provide<font color="#E5E5E5"> some additional recommendations</font>

1127
00:43:08,349 --> 00:43:13,550
<font color="#CCCCCC">so stage one they say make sure</font><font color="#E5E5E5"> you have</font>

1128
00:43:11,180 --> 00:43:15,649
a user<font color="#CCCCCC"> account and</font><font color="#E5E5E5"> an admin account and</font>

1129
00:43:13,550 --> 00:43:17,300
your user account<font color="#CCCCCC"> logs on to the</font><font color="#E5E5E5"> regular</font>

1130
00:43:15,650 --> 00:43:19,160
<font color="#E5E5E5">workstation user workstation and your</font>

1131
00:43:17,300 --> 00:43:22,400
admin account logs on<font color="#E5E5E5"> to a privileged</font>

1132
00:43:19,160 --> 00:43:23,960
access<font color="#E5E5E5"> workstation or a PHA then you</font>

1133
00:43:22,400 --> 00:43:26,660
want<font color="#E5E5E5"> to make sure you randomize and</font>

1134
00:43:23,960 --> 00:43:29,150
ensure that<font color="#CCCCCC"> the passwords are unique for</font>

1135
00:43:26,660 --> 00:43:30,399
<font color="#CCCCCC">all workstations and all servers</font><font color="#E5E5E5"> make</font>

1136
00:43:29,150 --> 00:43:34,210
sense

1137
00:43:30,400 --> 00:43:37,490
<font color="#CCCCCC">Stage two time bound privileges</font><font color="#E5E5E5"> so</font>

1138
00:43:34,210 --> 00:43:39,530
<font color="#E5E5E5">ideally your admins don't all we aren't</font>

1139
00:43:37,490 --> 00:43:40,939
always<font color="#E5E5E5"> at members of the admin group</font>

1140
00:43:39,530 --> 00:43:43,550
they give them those rights<font color="#CCCCCC"> you're here</font>

1141
00:43:40,940 --> 00:43:44,869
at the<font color="#E5E5E5"> conference if you're an admin you</font>

1142
00:43:43,550 --> 00:43:46,460
don't necessarily need those rights

1143
00:43:44,869 --> 00:43:49,910
right now<font color="#CCCCCC"> you might</font><font color="#E5E5E5"> need those rights</font>

1144
00:43:46,460 --> 00:43:54,560
later<font color="#CCCCCC"> so that's the way</font><font color="#E5E5E5"> that works using</font>

1145
00:43:49,910 --> 00:43:56,930
multi-factor authentication so I'm gonna

1146
00:43:54,560 --> 00:43:58,790
<font color="#E5E5E5">add an update to this if you have a</font>

1147
00:43:56,930 --> 00:44:00,470
cloud admin account<font color="#E5E5E5"> you want to make</font>

1148
00:43:58,790 --> 00:44:02,720
<font color="#CCCCCC">sure that they are</font><font color="#E5E5E5"> using an admin</font>

1149
00:44:00,470 --> 00:44:04,848
workstation or system<font color="#E5E5E5"> to protect that</font>

1150
00:44:02,720 --> 00:44:06,470
cloud admin account because access<font color="#E5E5E5"> to</font>

1151
00:44:04,849 --> 00:44:08,380
that cloud admin account gives<font color="#CCCCCC"> access to</font>

1152
00:44:06,470 --> 00:44:11,330
<font color="#CCCCCC">all of</font><font color="#E5E5E5"> the cloud services that</font><font color="#CCCCCC"> you have</font>

1153
00:44:08,380 --> 00:44:12,950
so Microsoft highlights lower tax

1154
00:44:11,330 --> 00:44:14,180
service of domains<font color="#E5E5E5"> and</font><font color="#CCCCCC"> DCs</font>

1155
00:44:12,950 --> 00:44:16,790
but there's a number<font color="#E5E5E5"> of things that I</font>

1156
00:44:14,180 --> 00:44:18,618
found<font color="#CCCCCC"> we're missing to this so clear</font>

1157
00:44:16,790 --> 00:44:20,330
<font color="#E5E5E5">guidance some recommended GPO security</font>

1158
00:44:18,619 --> 00:44:24,349
settings beyond the default<font color="#E5E5E5"> locking down</font>

1159
00:44:20,330 --> 00:44:26,630
protocols features etc<font color="#E5E5E5"> implementation</font>

1160
00:44:24,349 --> 00:44:28,130
guidance<font color="#E5E5E5"> for limiting this and then</font>

1161
00:44:26,630 --> 00:44:29,960
locking<font color="#E5E5E5"> down and controlling the</font>

1162
00:44:28,130 --> 00:44:31,700
management protocols<font color="#E5E5E5"> to the domain</font>

1163
00:44:29,960 --> 00:44:33,380
controllers not everyone in the

1164
00:44:31,700 --> 00:44:34,848
organization needs<font color="#E5E5E5"> to</font><font color="#CCCCCC"> WMI to the domain</font>

1165
00:44:33,380 --> 00:44:36,440
controller or RDP to the domain

1166
00:44:34,849 --> 00:44:38,150
controller so you can lock that<font color="#CCCCCC"> down</font>

1167
00:44:36,440 --> 00:44:40,130
with a host-based firewall or<font color="#E5E5E5"> some other</font>

1168
00:44:38,150 --> 00:44:42,200
<font color="#E5E5E5">rules</font><font color="#CCCCCC"> I have some</font><font color="#E5E5E5"> more</font><font color="#CCCCCC"> information</font><font color="#E5E5E5"> on</font>

1169
00:44:40,130 --> 00:44:43,550
<font color="#E5E5E5">this at the bottom under securing</font>

1170
00:44:42,200 --> 00:44:46,549
<font color="#CCCCCC">domaine controllers to improve Active</font>

1171
00:44:43,550 --> 00:44:48,740
Directory security on<font color="#E5E5E5"> 80 security then</font>

1172
00:44:46,550 --> 00:44:50,240
Microsoft<font color="#E5E5E5"> talks about how to use hyper-v</font>

1173
00:44:48,740 --> 00:44:53,359
to do all this<font color="#CCCCCC"> extra security stuff</font>

1174
00:44:50,240 --> 00:44:55,700
boils down to two<font color="#CCCCCC"> things</font><font color="#E5E5E5"> virtualization</font>

1175
00:44:53,359 --> 00:44:58,520
platform admins have full rights to<font color="#E5E5E5"> your</font>

1176
00:44:55,700 --> 00:45:01,930
virtual DC's we need to include<font color="#E5E5E5"> them as</font>

1177
00:44:58,520 --> 00:45:03,710
effective domain admins or leverage<font color="#E5E5E5"> a</font>

1178
00:45:01,930 --> 00:45:06,020
virtual<font color="#CCCCCC"> platform that</font><font color="#E5E5E5"> can</font>

1179
00:45:03,710 --> 00:45:08,780
enable you to protect<font color="#E5E5E5"> your virtual DC's</font>

1180
00:45:06,020 --> 00:45:11,480
from those virtual admins<font color="#E5E5E5"> VMware has a</font>

1181
00:45:08,780 --> 00:45:13,820
solution<font color="#E5E5E5"> hyper-v 2016 has a solution</font>

1182
00:45:11,480 --> 00:45:15,080
second part<font color="#E5E5E5"> that's important is ensuring</font>

1183
00:45:13,820 --> 00:45:16,369
that you<font color="#CCCCCC"> have some sort</font><font color="#E5E5E5"> of full volume</font>

1184
00:45:15,080 --> 00:45:18,290
encryption on your dcs

1185
00:45:16,369 --> 00:45:20,180
especially if<font color="#CCCCCC"> they're virtual so</font>

1186
00:45:18,290 --> 00:45:22,009
something like BitLocker<font color="#E5E5E5"> does require</font>

1187
00:45:20,180 --> 00:45:26,210
<font color="#CCCCCC">virtual TPM or something along that</font>

1188
00:45:22,010 --> 00:45:29,420
level so attack detection<font color="#CCCCCC"> microsoft says</font>

1189
00:45:26,210 --> 00:45:32,480
by<font color="#CCCCCC"> ata</font><font color="#E5E5E5"> advanced threat analytics</font><font color="#CCCCCC"> let's</font>

1190
00:45:29,420 --> 00:45:38,660
be a<font color="#CCCCCC"> little</font><font color="#E5E5E5"> more practical</font><font color="#CCCCCC"> logon types</font>

1191
00:45:32,480 --> 00:45:40,730
log<font color="#CCCCCC"> 46:24</font><font color="#E5E5E5"> zero four five nine and ten</font>

1192
00:45:38,660 --> 00:45:42,170
<font color="#E5E5E5">this will get you a lot of really good</font>

1193
00:45:40,730 --> 00:45:46,070
<font color="#CCCCCC">information about what attackers you're</font>

1194
00:45:42,170 --> 00:45:47,359
doing in<font color="#CCCCCC"> your environment the</font><font color="#E5E5E5"> other one</font>

1195
00:45:46,070 --> 00:45:48,830
<font color="#CCCCCC">and</font><font color="#E5E5E5"> again</font><font color="#CCCCCC"> I'm going</font><font color="#E5E5E5"> through so a little</font>

1196
00:45:47,359 --> 00:45:51,529
<font color="#E5E5E5">more quickly the slides are on</font><font color="#CCCCCC"> ad</font>

1197
00:45:48,830 --> 00:45:53,598
<font color="#CCCCCC">Security org there's a</font><font color="#E5E5E5"> number of event</font>

1198
00:45:51,530 --> 00:45:55,820
IDs that you can get off<font color="#CCCCCC"> of all Windows</font>

1199
00:45:53,599 --> 00:45:57,740
systems that give you insight<font color="#CCCCCC"> into what</font>

1200
00:45:55,820 --> 00:45:59,930
attackers are doing attackers love

1201
00:45:57,740 --> 00:46:03,140
installing new services<font color="#E5E5E5"> they love</font>

1202
00:45:59,930 --> 00:46:04,669
scheduling tasks these things<font color="#CCCCCC"> want</font>

1203
00:46:03,140 --> 00:46:05,930
monitoring for them pulling<font color="#E5E5E5"> this these</font>

1204
00:46:04,670 --> 00:46:09,440
events into your sim will give you a

1205
00:46:05,930 --> 00:46:11,210
great<font color="#CCCCCC"> insight domain controllers we want</font>

1206
00:46:09,440 --> 00:46:12,950
to make sure<font color="#CCCCCC"> that Active Directory</font>

1207
00:46:11,210 --> 00:46:16,160
events are logged on<font color="#E5E5E5"> domain controllers</font>

1208
00:46:12,950 --> 00:46:17,930
otherwise you're missing a lot<font color="#E5E5E5"> so</font>

1209
00:46:16,160 --> 00:46:19,368
there's a an attack method called

1210
00:46:17,930 --> 00:46:21,410
password<font color="#E5E5E5"> sprang where the attacker</font>

1211
00:46:19,369 --> 00:46:24,140
basically takes a list of<font color="#E5E5E5"> password</font>

1212
00:46:21,410 --> 00:46:26,118
starts with the top one like summer 2018

1213
00:46:24,140 --> 00:46:29,359
and the<font color="#E5E5E5"> u.s. is</font><font color="#CCCCCC"> very popular or winter</font>

1214
00:46:26,119 --> 00:46:31,130
2018 and takes that one<font color="#CCCCCC"> password in</font>

1215
00:46:29,359 --> 00:46:32,390
attempts to authenticate as every user

1216
00:46:31,130 --> 00:46:35,180
in Active Directory with that one

1217
00:46:32,390 --> 00:46:37,549
password<font color="#E5E5E5"> and they do this as many times</font>

1218
00:46:35,180 --> 00:46:39,770
they want<font color="#E5E5E5"> to up until the account</font>

1219
00:46:37,550 --> 00:46:42,440
lockout policy says that<font color="#E5E5E5"> all of those</font>

1220
00:46:39,770 --> 00:46:45,230
<font color="#E5E5E5">would get locked out</font><font color="#CCCCCC"> the thing is</font><font color="#E5E5E5"> that</font>

1221
00:46:42,440 --> 00:46:47,540
many<font color="#E5E5E5"> organizations have that password</font>

1222
00:46:45,230 --> 00:46:50,330
logging configured on their domain

1223
00:46:47,540 --> 00:46:54,050
<font color="#E5E5E5">controllers but if the attacker shifts</font>

1224
00:46:50,330 --> 00:46:55,970
<font color="#E5E5E5">to Kerberos for that authentication</font><font color="#CCCCCC"> most</font>

1225
00:46:54,050 --> 00:46:57,859
organizations do not<font color="#E5E5E5"> have the Kerberos</font>

1226
00:46:55,970 --> 00:47:01,520
authentication service<font color="#E5E5E5"> forty seven</font>

1227
00:46:57,859 --> 00:47:02,960
<font color="#E5E5E5">seventy one event ID logged and you have</font>

1228
00:47:01,520 --> 00:47:05,150
to<font color="#CCCCCC"> look for failure code zero by</font>

1229
00:47:02,960 --> 00:47:07,099
eighteen just to see that that<font color="#E5E5E5"> means bad</font>

1230
00:47:05,150 --> 00:47:08,750
password so you<font color="#E5E5E5"> can</font><font color="#CCCCCC"> detect password</font>

1231
00:47:07,099 --> 00:47:11,990
<font color="#CCCCCC">spraying but</font><font color="#E5E5E5"> you've got to do it on</font><font color="#CCCCCC"> both</font>

1232
00:47:08,750 --> 00:47:13,880
<font color="#CCCCCC">sides then there's an attack method</font>

1233
00:47:11,990 --> 00:47:16,549
called Kerberos sting which is basically

1234
00:47:13,880 --> 00:47:19,310
requesting a service<font color="#E5E5E5"> ticket</font>

1235
00:47:16,550 --> 00:47:21,200
for a service<font color="#CCCCCC"> principle name associated</font>

1236
00:47:19,310 --> 00:47:22,910
<font color="#E5E5E5">with</font><font color="#CCCCCC"> a user account in</font><font color="#E5E5E5"> AD so that's just</font>

1237
00:47:21,200 --> 00:47:25,129
<font color="#E5E5E5">basically a service account to support</font>

1238
00:47:22,910 --> 00:47:27,200
Kerberos off in the environment we can

1239
00:47:25,130 --> 00:47:29,150
request<font color="#E5E5E5"> that service ticket with rc4</font>

1240
00:47:27,200 --> 00:47:30,609
encryption<font color="#CCCCCC"> I remember before I said</font>

1241
00:47:29,150 --> 00:47:32,810
<font color="#CCCCCC">Microsoft has a lot of compatibility</font>

1242
00:47:30,610 --> 00:47:35,870
<font color="#CCCCCC">well they decided instead of coming up</font>

1243
00:47:32,810 --> 00:47:39,080
<font color="#CCCCCC">with a new key for Kerberos they would</font>

1244
00:47:35,870 --> 00:47:41,839
use the<font color="#E5E5E5"> ntlm password hash for it so</font>

1245
00:47:39,080 --> 00:47:43,700
this service ticket that we request with

1246
00:47:41,840 --> 00:47:46,520
<font color="#CCCCCC">rc4</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> encrypted by that service</font>

1247
00:47:43,700 --> 00:47:48,379
accounts ntlm password hash which means

1248
00:47:46,520 --> 00:47:50,390
we just<font color="#E5E5E5"> have</font><font color="#CCCCCC"> to request</font><font color="#E5E5E5"> it take it</font>

1249
00:47:48,380 --> 00:47:52,340
offline<font color="#CCCCCC"> put it on our</font><font color="#E5E5E5"> password cracking</font>

1250
00:47:50,390 --> 00:47:53,990
box and when we're able<font color="#CCCCCC"> to open</font><font color="#E5E5E5"> up that</font>

1251
00:47:52,340 --> 00:47:56,630
service ticket we<font color="#CCCCCC"> have cracked that</font>

1252
00:47:53,990 --> 00:47:57,890
<font color="#CCCCCC">password offline and we have</font><font color="#E5E5E5"> about as</font>

1253
00:47:56,630 --> 00:47:59,690
<font color="#E5E5E5">much time as</font><font color="#CCCCCC"> it takes for that</font>

1254
00:47:57,890 --> 00:48:01,089
<font color="#E5E5E5">organization</font><font color="#CCCCCC"> to actually</font><font color="#E5E5E5"> change their</font>

1255
00:47:59,690 --> 00:48:05,180
service account passwords which is

1256
00:48:01,090 --> 00:48:06,710
<font color="#CCCCCC">usually never we can monitor for</font><font color="#E5E5E5"> this we</font>

1257
00:48:05,180 --> 00:48:09,830
<font color="#E5E5E5">can detect this by setting and</font>

1258
00:48:06,710 --> 00:48:11,210
monitoring<font color="#E5E5E5"> 4769</font><font color="#CCCCCC"> s with</font><font color="#E5E5E5"> these ticket</font>

1259
00:48:09,830 --> 00:48:15,529
options<font color="#CCCCCC"> of this</font><font color="#E5E5E5"> ticket encryption which</font>

1260
00:48:11,210 --> 00:48:20,020
is<font color="#CCCCCC"> rc4 so</font><font color="#E5E5E5"> stage 3 is a little bit bigger</font>

1261
00:48:15,530 --> 00:48:22,850
or more<font color="#E5E5E5"> long-term</font><font color="#CCCCCC"> Microsoft has here so</font>

1262
00:48:20,020 --> 00:48:25,340
you want to look at the roles and<font color="#CCCCCC"> writes</font>

1263
00:48:22,850 --> 00:48:28,130
in<font color="#E5E5E5"> your environment</font><font color="#CCCCCC"> plain English or</font>

1264
00:48:25,340 --> 00:48:30,080
German<font color="#E5E5E5"> since the case may be what do you</font>

1265
00:48:28,130 --> 00:48:31,540
do what<font color="#CCCCCC"> are the rights that</font><font color="#E5E5E5"> you need</font><font color="#CCCCCC"> ok</font>

1266
00:48:30,080 --> 00:48:37,430
let me translate those to the system

1267
00:48:31,540 --> 00:48:40,040
<font color="#CCCCCC">reevaluate redefined and reestablish so</font>

1268
00:48:37,430 --> 00:48:41,720
Microsoft has this<font color="#E5E5E5"> tiered model which</font>

1269
00:48:40,040 --> 00:48:45,650
<font color="#E5E5E5">whenever I talk to</font><font color="#CCCCCC"> customers about</font><font color="#E5E5E5"> their</font>

1270
00:48:41,720 --> 00:48:47,839
eyes glaze over<font color="#E5E5E5"> why because in the admin</font>

1271
00:48:45,650 --> 00:48:50,270
tier<font color="#CCCCCC"> model all domain controllers and</font>

1272
00:48:47,840 --> 00:48:52,460
domain admins going tier<font color="#E5E5E5"> 0</font><font color="#CCCCCC"> all server</font>

1273
00:48:50,270 --> 00:48:54,980
admins and servers go into tier one and

1274
00:48:52,460 --> 00:48:56,660
all workstation workstation admins go to

1275
00:48:54,980 --> 00:48:59,030
tier<font color="#CCCCCC"> 2 Microsoft's been talking about</font>

1276
00:48:56,660 --> 00:49:00,529
<font color="#E5E5E5">this for a couple of</font><font color="#CCCCCC"> years</font><font color="#E5E5E5"> and then</font>

1277
00:48:59,030 --> 00:49:02,540
never the twain shall meet

1278
00:49:00,530 --> 00:49:04,340
tier<font color="#E5E5E5"> one</font><font color="#CCCCCC"> you can't go into tier</font><font color="#E5E5E5"> 0 to</font>

1279
00:49:02,540 --> 00:49:05,960
your to tier<font color="#CCCCCC"> 2 cannot</font><font color="#E5E5E5"> in the tier</font><font color="#CCCCCC"> 1 tier</font>

1280
00:49:04,340 --> 00:49:09,920
1<font color="#CCCCCC"> mountains</font><font color="#E5E5E5"> here</font><font color="#CCCCCC"> zero to zero nowhere</font>

1281
00:49:05,960 --> 00:49:12,740
else<font color="#E5E5E5"> right separate those tiers what</font>

1282
00:49:09,920 --> 00:49:14,450
does this mean this is where I lose

1283
00:49:12,740 --> 00:49:15,709
<font color="#E5E5E5">pretty much everyone at the customer</font>

1284
00:49:14,450 --> 00:49:17,480
site because<font color="#E5E5E5"> they're like there's no way</font>

1285
00:49:15,710 --> 00:49:19,460
we can do that<font color="#CCCCCC"> because you're</font><font color="#E5E5E5"> saying</font>

1286
00:49:17,480 --> 00:49:22,250
that we need<font color="#CCCCCC"> to duplicate what we have</font>

1287
00:49:19,460 --> 00:49:24,940
<font color="#E5E5E5">already for management patching for that</font>

1288
00:49:22,250 --> 00:49:27,339
tier 0<font color="#E5E5E5"> and admin</font>

1289
00:49:24,940 --> 00:49:28,960
and admin workstations<font color="#E5E5E5"> and then we need</font>

1290
00:49:27,339 --> 00:49:30,670
<font color="#E5E5E5">to make</font><font color="#CCCCCC"> sure domain controllers</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> ad</font>

1291
00:49:28,960 --> 00:49:32,619
<font color="#E5E5E5">FS and all this other stuff are in that</font>

1292
00:49:30,670 --> 00:49:34,329
tier and protected and we have to do the

1293
00:49:32,619 --> 00:49:36,069
exact<font color="#CCCCCC"> same</font><font color="#E5E5E5"> thing for tier</font><font color="#CCCCCC"> one</font><font color="#E5E5E5"> and</font>

1294
00:49:34,329 --> 00:49:38,020
separate management<font color="#E5E5E5"> and patching in</font>

1295
00:49:36,069 --> 00:49:39,940
there and separate admins and we can't

1296
00:49:38,020 --> 00:49:42,280
<font color="#E5E5E5">reuse those admin accounts we can't</font>

1297
00:49:39,940 --> 00:49:43,990
reuse<font color="#E5E5E5"> those abner workstations and then</font>

1298
00:49:42,280 --> 00:49:45,280
we do<font color="#CCCCCC"> it</font><font color="#E5E5E5"> again for tier two with all</font>

1299
00:49:43,990 --> 00:49:47,200
these<font color="#E5E5E5"> workstations</font><font color="#CCCCCC"> and workstation</font>

1300
00:49:45,280 --> 00:49:48,190
admins and everything<font color="#E5E5E5"> else and I can't</font>

1301
00:49:47,200 --> 00:49:51,939
do<font color="#E5E5E5"> that</font>

1302
00:49:48,190 --> 00:49:54,339
so<font color="#E5E5E5"> takeaway for today is if you're gonna</font>

1303
00:49:51,940 --> 00:49:57,490
focus<font color="#E5E5E5"> on anything just</font><font color="#CCCCCC"> focus on tier</font>

1304
00:49:54,339 --> 00:49:59,170
zero<font color="#E5E5E5"> protect your domain admins protect</font>

1305
00:49:57,490 --> 00:50:02,500
those systems that<font color="#CCCCCC"> are</font><font color="#E5E5E5"> the most critical</font>

1306
00:49:59,170 --> 00:50:04,780
that<font color="#E5E5E5"> have those most critical password</font>

1307
00:50:02,500 --> 00:50:06,220
and credential information<font color="#E5E5E5"> because once</font>

1308
00:50:04,780 --> 00:50:09,490
an attacker gets those it's game over

1309
00:50:06,220 --> 00:50:11,828
<font color="#CCCCCC">and at some point later on at</font><font color="#E5E5E5"> least look</font>

1310
00:50:09,490 --> 00:50:13,959
at and figure<font color="#CCCCCC"> out</font><font color="#E5E5E5"> a way</font><font color="#CCCCCC"> to limit</font><font color="#E5E5E5"> access</font>

1311
00:50:11,829 --> 00:50:15,190
at each of these<font color="#E5E5E5"> other tiers because</font>

1312
00:50:13,960 --> 00:50:17,230
ultimately there's things missing from

1313
00:50:15,190 --> 00:50:18,550
<font color="#CCCCCC">this whole tier model</font><font color="#E5E5E5"> removing local</font>

1314
00:50:17,230 --> 00:50:20,890
admin rights from users which<font color="#CCCCCC"> is</font>

1315
00:50:18,550 --> 00:50:23,380
important limiting broad system admin

1316
00:50:20,890 --> 00:50:25,480
like the system access like workstation

1317
00:50:23,380 --> 00:50:27,460
admin server admins<font color="#E5E5E5"> and then having</font>

1318
00:50:25,480 --> 00:50:29,230
host-based firewalls to prevent any

1319
00:50:27,460 --> 00:50:32,170
computer to connect<font color="#E5E5E5"> any other computer</font>

1320
00:50:29,230 --> 00:50:33,760
<font color="#CCCCCC">and then practical guidance</font><font color="#E5E5E5"> on achieving</font>

1321
00:50:32,170 --> 00:50:36,430
these tiers<font color="#E5E5E5"> I'm giving you that now</font>

1322
00:50:33,760 --> 00:50:37,780
focus on tier<font color="#CCCCCC"> 0 and of course there's</font>

1323
00:50:36,430 --> 00:50:39,910
<font color="#E5E5E5">service count risks that have access to</font>

1324
00:50:37,780 --> 00:50:41,230
<font color="#CCCCCC">everything</font><font color="#E5E5E5"> most organizations have</font><font color="#CCCCCC"> a</font>

1325
00:50:39,910 --> 00:50:43,089
service<font color="#E5E5E5"> count that does some sort</font><font color="#CCCCCC"> of</font>

1326
00:50:41,230 --> 00:50:45,310
vulnerability scanning<font color="#E5E5E5"> unfortunately</font>

1327
00:50:43,089 --> 00:50:49,089
it's usually<font color="#E5E5E5"> just one service count for</font>

1328
00:50:45,310 --> 00:50:51,119
everything<font color="#CCCCCC"> so at least say vulnerability</font>

1329
00:50:49,089 --> 00:50:53,650
scanning account for domain controllers

1330
00:50:51,119 --> 00:50:56,230
which is only active when<font color="#CCCCCC"> they need</font><font color="#E5E5E5"> to</font>

1331
00:50:53,650 --> 00:50:57,339
scan<font color="#E5E5E5"> another one for servers another one</font>

1332
00:50:56,230 --> 00:50:59,829
for workstations

1333
00:50:57,339 --> 00:51:02,109
take this tiered model to the level

1334
00:50:59,829 --> 00:51:04,180
where it's practical and possible<font color="#CCCCCC"> in</font>

1335
00:51:02,109 --> 00:51:06,940
your<font color="#E5E5E5"> organization make progress with</font><font color="#CCCCCC"> it</font>

1336
00:51:04,180 --> 00:51:10,690
<font color="#E5E5E5">and then finally Microsoft's red forest</font>

1337
00:51:06,940 --> 00:51:12,790
<font color="#E5E5E5">or enhance security administrative</font>

1338
00:51:10,690 --> 00:51:14,640
environment where we take all<font color="#CCCCCC"> of this</font>

1339
00:51:12,790 --> 00:51:16,720
tier<font color="#E5E5E5"> 0</font><font color="#CCCCCC"> and put it into a separate forest</font>

1340
00:51:14,640 --> 00:51:18,339
<font color="#E5E5E5">Microsoft outs this and highlights this</font>

1341
00:51:16,720 --> 00:51:20,980
<font color="#E5E5E5">is the most secure way to administer</font>

1342
00:51:18,339 --> 00:51:23,589
Active Directory<font color="#CCCCCC"> and it involves all</font>

1343
00:51:20,980 --> 00:51:25,660
this basically<font color="#CCCCCC"> we're going</font><font color="#E5E5E5"> to use</font>

1344
00:51:23,589 --> 00:51:27,640
<font color="#E5E5E5">Windows Server 2016 we're going to have</font>

1345
00:51:25,660 --> 00:51:31,180
the separate admin<font color="#CCCCCC"> forest with a special</font>

1346
00:51:27,640 --> 00:51:33,578
selective auth trust so that<font color="#E5E5E5"> way only</font>

1347
00:51:31,180 --> 00:51:35,470
the admin groups from the admin<font color="#CCCCCC"> Forest</font>

1348
00:51:33,579 --> 00:51:36,609
can connect into<font color="#CCCCCC"> our production ad and</font>

1349
00:51:35,470 --> 00:51:37,740
manage it<font color="#E5E5E5"> because we're going to empty</font>

1350
00:51:36,609 --> 00:51:40,230
all those admin groups in the

1351
00:51:37,740 --> 00:51:42,240
action<font color="#CCCCCC"> force</font><font color="#E5E5E5"> we're going to make sure</font>

1352
00:51:40,230 --> 00:51:45,030
that<font color="#CCCCCC"> they use admin workstations we're</font>

1353
00:51:42,240 --> 00:51:46,470
secure and lock off and and isolate<font color="#E5E5E5"> this</font>

1354
00:51:45,030 --> 00:51:47,880
environment<font color="#E5E5E5"> we're gonna do all this</font>

1355
00:51:46,470 --> 00:51:52,350
<font color="#E5E5E5">stuff we're</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> duplicate everything</font>

1356
00:51:47,880 --> 00:51:55,470
again into this<font color="#E5E5E5"> environment</font><font color="#CCCCCC"> so there's a</font>

1357
00:51:52,350 --> 00:51:57,839
few<font color="#E5E5E5"> problems with this but</font><font color="#CCCCCC"> ultimately as</font>

1358
00:51:55,470 --> 00:51:59,459
part<font color="#E5E5E5"> of the</font><font color="#CCCCCC"> implementation we</font><font color="#E5E5E5"> have to</font>

1359
00:51:57,840 --> 00:52:01,410
assume breach we have to check the

1360
00:51:59,460 --> 00:52:03,060
production<font color="#E5E5E5"> ad environment we've</font><font color="#CCCCCC"> got to</font>

1361
00:52:01,410 --> 00:52:05,339
start clean make<font color="#CCCCCC"> sure we're using clean</font>

1362
00:52:03,060 --> 00:52:06,840
media oftentimes that means physical

1363
00:52:05,340 --> 00:52:08,550
servers and<font color="#E5E5E5"> that had been forced and</font>

1364
00:52:06,840 --> 00:52:10,230
<font color="#E5E5E5">then there's a lot of questions about</font>

1365
00:52:08,550 --> 00:52:11,670
<font color="#E5E5E5">how this actually</font><font color="#CCCCCC"> works and is</font>

1366
00:52:10,230 --> 00:52:13,460
maintainable<font color="#E5E5E5"> and</font><font color="#CCCCCC"> managed some</font><font color="#E5E5E5"> of the</font>

1367
00:52:11,670 --> 00:52:16,170
biggest organizations are doing<font color="#CCCCCC"> this and</font>

1368
00:52:13,460 --> 00:52:17,640
it takes a long time<font color="#E5E5E5"> for them to</font>

1369
00:52:16,170 --> 00:52:18,900
<font color="#E5E5E5">actually</font><font color="#CCCCCC"> get it set up right</font><font color="#E5E5E5"> because</font>

1370
00:52:17,640 --> 00:52:20,580
there's<font color="#E5E5E5"> limitations to this approach</font>

1371
00:52:18,900 --> 00:52:22,740
it's<font color="#E5E5E5"> very expensive</font>

1372
00:52:20,580 --> 00:52:24,540
it increases management<font color="#E5E5E5"> overhead and</font>

1373
00:52:22,740 --> 00:52:26,069
<font color="#CCCCCC">costs</font><font color="#E5E5E5"> you're duplicating</font><font color="#CCCCCC"> PGI</font>

1374
00:52:24,540 --> 00:52:28,080
infrastructure if you<font color="#E5E5E5"> have it in the</font>

1375
00:52:26,070 --> 00:52:30,330
<font color="#E5E5E5">first place</font><font color="#CCCCCC"> you're doing pretty much</font><font color="#E5E5E5"> all</font>

1376
00:52:28,080 --> 00:52:31,680
physical you're forcing<font color="#E5E5E5"> the admins to go</font>

1377
00:52:30,330 --> 00:52:33,869
through the system<font color="#E5E5E5"> and yet having more</font>

1378
00:52:31,680 --> 00:52:36,649
<font color="#CCCCCC">add</font><font color="#E5E5E5"> nine more</font><font color="#CCCCCC"> ack accounts</font><font color="#E5E5E5"> you're</font>

1379
00:52:33,869 --> 00:52:39,210
<font color="#CCCCCC">duplicating this infrastructure and</font>

1380
00:52:36,650 --> 00:52:41,580
making sure that<font color="#E5E5E5"> all</font><font color="#CCCCCC"> of this stuff is</font>

1381
00:52:39,210 --> 00:52:43,710
done<font color="#CCCCCC"> but it doesn't fix</font><font color="#E5E5E5"> the production</font>

1382
00:52:41,580 --> 00:52:46,799
<font color="#E5E5E5">ad environment the issues</font><font color="#CCCCCC"> that you</font><font color="#E5E5E5"> have</font>

1383
00:52:43,710 --> 00:52:48,450
<font color="#E5E5E5">today you still have and doesn't resolve</font>

1384
00:52:46,800 --> 00:52:49,619
<font color="#E5E5E5">these expansive rights over workstations</font>

1385
00:52:48,450 --> 00:52:52,799
and servers<font color="#E5E5E5"> and as we've already</font>

1386
00:52:49,619 --> 00:52:55,740
<font color="#CCCCCC">established</font><font color="#E5E5E5"> attackers don't need domain</font>

1387
00:52:52,800 --> 00:52:57,180
admin so the best<font color="#CCCCCC"> cases it does isolate</font>

1388
00:52:55,740 --> 00:52:58,890
<font color="#E5E5E5">ad admin accounts which is useful</font>

1389
00:52:57,180 --> 00:53:00,540
<font color="#CCCCCC">especially when</font><font color="#E5E5E5"> you have a multi forest</font>

1390
00:52:58,890 --> 00:53:01,950
environment and you<font color="#E5E5E5"> have your admins in</font>

1391
00:53:00,540 --> 00:53:04,460
a single force that are well<font color="#CCCCCC"> protected</font>

1392
00:53:01,950 --> 00:53:07,140
and managed and isolated<font color="#E5E5E5"> and monitored</font>

1393
00:53:04,460 --> 00:53:08,790
but what<font color="#E5E5E5"> about domain privilege service</font>

1394
00:53:07,140 --> 00:53:10,740
accounts these are<font color="#E5E5E5"> often forgotten about</font>

1395
00:53:08,790 --> 00:53:12,900
<font color="#E5E5E5">and missed because you can't necessarily</font>

1396
00:53:10,740 --> 00:53:14,640
<font color="#E5E5E5">very easily go through and wipe all the</font>

1397
00:53:12,900 --> 00:53:18,300
permissions<font color="#E5E5E5"> off these without fully</font>

1398
00:53:14,640 --> 00:53:21,089
understanding<font color="#E5E5E5"> what the rights are so</font>

1399
00:53:18,300 --> 00:53:24,150
<font color="#E5E5E5">that's been a lot right</font><font color="#CCCCCC"> like I</font><font color="#E5E5E5"> said the</font>

1400
00:53:21,090 --> 00:53:25,820
slides are online<font color="#CCCCCC"> but</font><font color="#E5E5E5"> ultimately</font><font color="#CCCCCC"> comes</font>

1401
00:53:24,150 --> 00:53:28,140
down<font color="#E5E5E5"> to this the things that matter</font>

1402
00:53:25,820 --> 00:53:30,300
<font color="#CCCCCC">making sure this local admin password</font>

1403
00:53:28,140 --> 00:53:31,109
<font color="#CCCCCC">really unique and</font><font color="#E5E5E5"> they change leveraging</font>

1404
00:53:30,300 --> 00:53:32,820
<font color="#CCCCCC">hosts firewalls</font>

1405
00:53:31,109 --> 00:53:34,830
highly recommend<font color="#CCCCCC"> that</font><font color="#E5E5E5"> you enable</font>

1406
00:53:32,820 --> 00:53:37,109
host-based firewalls<font color="#E5E5E5"> on all your</font>

1407
00:53:34,830 --> 00:53:39,150
<font color="#E5E5E5">workstations that will stop lateral</font>

1408
00:53:37,109 --> 00:53:41,190
movement it will mitigate<font color="#E5E5E5"> most</font>

1409
00:53:39,150 --> 00:53:42,810
ransomware attacks that spread<font color="#CCCCCC"> out</font>

1410
00:53:41,190 --> 00:53:45,060
through the<font color="#E5E5E5"> environment</font><font color="#CCCCCC"> from system the</font>

1411
00:53:42,810 --> 00:53:46,590
<font color="#CCCCCC">system reducing the ad admin group</font>

1412
00:53:45,060 --> 00:53:49,710
membership limiting service count

1413
00:53:46,590 --> 00:53:51,089
privileges always good ideas and if you

1414
00:53:49,710 --> 00:53:52,859
take<font color="#CCCCCC"> away</font><font color="#E5E5E5"> one thing here</font>

1415
00:53:51,089 --> 00:53:55,890
you're out a way to<font color="#E5E5E5"> get your domain</font>

1416
00:53:52,859 --> 00:53:57,690
admins<font color="#E5E5E5"> your 80 admins</font><font color="#CCCCCC"> to log on to admin</font>

1417
00:53:55,890 --> 00:53:59,400
<font color="#CCCCCC">workstations that are</font><font color="#E5E5E5"> separate than the</font>

1418
00:53:57,690 --> 00:54:03,390
<font color="#E5E5E5">regular</font><font color="#CCCCCC"> workstations</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> are managed</font><font color="#E5E5E5"> by</font>

1419
00:53:59,400 --> 00:54:04,920
everything<font color="#E5E5E5"> and</font><font color="#CCCCCC"> then there's ways to</font><font color="#E5E5E5"> lock</font>

1420
00:54:03,390 --> 00:54:06,989
down and protect the<font color="#CCCCCC"> environment by</font>

1421
00:54:04,920 --> 00:54:09,029
limiting these<font color="#E5E5E5"> older protocols and</font>

1422
00:54:06,989 --> 00:54:11,130
features that still exist<font color="#E5E5E5"> in most</font>

1423
00:54:09,029 --> 00:54:12,930
environments<font color="#CCCCCC"> and then control office</font>

1424
00:54:11,130 --> 00:54:15,390
macros<font color="#E5E5E5"> and we have some information on</font>

1425
00:54:12,930 --> 00:54:18,149
<font color="#E5E5E5">that</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> 80 security as well</font><font color="#CCCCCC"> there's</font>

1426
00:54:15,390 --> 00:54:21,598
further key recommendations here<font color="#E5E5E5"> which I</font>

1427
00:54:18,150 --> 00:54:25,460
<font color="#E5E5E5">will leave up after I say that has been</font>

1428
00:54:21,599 --> 00:54:25,460
my time thank you<font color="#CCCCCC"> very much for yours</font>

1429
00:54:30,150 --> 00:54:36,600
[Applause]

1430
00:54:33,200 --> 00:54:46,080
thank you very<font color="#E5E5E5"> much for this broad</font>

1431
00:54:36,600 --> 00:54:47,339
overview and other<font color="#E5E5E5"> questions hi sir</font>

1432
00:54:46,080 --> 00:54:49,259
<font color="#E5E5E5">thank you for your talking your great</font>

1433
00:54:47,340 --> 00:54:50,940
contributions on ad security so<font color="#E5E5E5"> it's</font>

1434
00:54:49,260 --> 00:54:55,920
<font color="#E5E5E5">really great</font>

1435
00:54:50,940 --> 00:54:59,010
but do you personally see using<font color="#E5E5E5"> ad on</font>

1436
00:54:55,920 --> 00:55:01,620
something below 2016 as a lost cause

1437
00:54:59,010 --> 00:55:06,330
<font color="#CCCCCC">because we are like yeah we're deploying</font>

1438
00:55:01,620 --> 00:55:08,580
this one we use es<font color="#E5E5E5"> AE pause</font><font color="#CCCCCC"> RC for</font>

1439
00:55:06,330 --> 00:55:11,700
detection<font color="#CCCCCC"> of Kerberos thing we</font>

1440
00:55:08,580 --> 00:55:13,620
bloodhound our our complete<font color="#E5E5E5"> forests go</font>

1441
00:55:11,700 --> 00:55:16,169
like yeah why do you need<font color="#CCCCCC"> right the ACL</font>

1442
00:55:13,620 --> 00:55:19,890
on on your domain admins but you doing

1443
00:55:16,170 --> 00:55:25,560
it seems<font color="#E5E5E5"> like it's</font><font color="#CCCCCC"> just making</font><font color="#E5E5E5"> the ship</font>

1444
00:55:19,890 --> 00:55:27,240
sink<font color="#E5E5E5"> let's say a little later so I would</font>

1445
00:55:25,560 --> 00:55:29,790
say you don't have to<font color="#CCCCCC"> go to 2016</font><font color="#E5E5E5"> today</font>

1446
00:55:27,240 --> 00:55:31,500
or<font color="#E5E5E5"> tomorrow</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> think if you have 2012 r2</font>

1447
00:55:29,790 --> 00:55:32,940
on your<font color="#CCCCCC"> DCs you're doing</font><font color="#E5E5E5"> pretty good and</font>

1448
00:55:31,500 --> 00:55:36,330
all<font color="#E5E5E5"> the other things you're doing are</font>

1449
00:55:32,940 --> 00:55:37,500
great<font color="#CCCCCC"> so yeah I I would say that the</font>

1450
00:55:36,330 --> 00:55:39,150
things that<font color="#CCCCCC"> you're doing from</font><font color="#E5E5E5"> what it</font>

1451
00:55:37,500 --> 00:55:41,760
sounds<font color="#CCCCCC"> like</font><font color="#E5E5E5"> are the important</font><font color="#CCCCCC"> things</font>

1452
00:55:39,150 --> 00:55:44,160
continue<font color="#E5E5E5"> to focus on ad as the service</font>

1453
00:55:41,760 --> 00:55:45,990
and the infrastructure and protecting

1454
00:55:44,160 --> 00:55:48,420
<font color="#E5E5E5">that and minute kind of locking that</font>

1455
00:55:45,990 --> 00:55:50,700
down<font color="#E5E5E5"> we</font><font color="#CCCCCC"> work</font><font color="#E5E5E5"> with customers that have</font>

1456
00:55:48,420 --> 00:55:52,500
hundreds if<font color="#E5E5E5"> not a thousand domain</font>

1457
00:55:50,700 --> 00:55:55,410
controllers and<font color="#E5E5E5"> obviously getting up to</font>

1458
00:55:52,500 --> 00:55:57,450
<font color="#CCCCCC">2016 is a very long</font><font color="#E5E5E5"> process for them so</font>

1459
00:55:55,410 --> 00:55:58,920
absolutely there's other things<font color="#E5E5E5"> you</font><font color="#CCCCCC"> can</font>

1460
00:55:57,450 --> 00:56:00,930
focus on and<font color="#E5E5E5"> really work on before</font>

1461
00:55:58,920 --> 00:56:03,630
getting to<font color="#E5E5E5"> that depending on the size</font><font color="#CCCCCC"> of</font>

1462
00:56:00,930 --> 00:56:09,710
<font color="#CCCCCC">your</font><font color="#E5E5E5"> organization</font><font color="#CCCCCC"> I wouldn't necessarily</font>

1463
00:56:03,630 --> 00:56:09,710
<font color="#E5E5E5">say a lost cause more questions</font>

1464
00:56:10,940 --> 00:56:16,809
so<font color="#CCCCCC"> fun</font><font color="#E5E5E5"> thank you very</font><font color="#CCCCCC"> much</font><font color="#E5E5E5"> again</font><font color="#CCCCCC"> for</font>

1465
00:56:13,430 --> 00:56:16,808
<font color="#E5E5E5">your great talk thank you</font>

1466
00:56:19,330 --> 00:56:22,270
[Applause]

