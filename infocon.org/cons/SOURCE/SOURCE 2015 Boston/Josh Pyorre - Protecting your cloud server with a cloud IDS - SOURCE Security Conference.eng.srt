1
00:00:00,060 --> 00:00:05,399
security analyst with OpenDNS I

2
00:00:03,290 --> 00:00:08,580
previously worked as a threat analyst at

3
00:00:05,400 --> 00:00:11,010
NASA protecting the NASA against threats

4
00:00:08,580 --> 00:00:12,420
for about five years or so I took a

5
00:00:11,010 --> 00:00:14,099
little break and with the mandiant for

6
00:00:12,420 --> 00:00:17,730
about a year and then I went back to the

7
00:00:14,099 --> 00:00:20,670
NASA sock but I left for OpenDNS because

8
00:00:17,730 --> 00:00:22,320
I it's amazing the company so things I

9
00:00:20,670 --> 00:00:24,689
like to do just so you know I like to

10
00:00:22,320 --> 00:00:28,080
ride motorcycles I make music and I like

11
00:00:24,689 --> 00:00:29,810
cats I have two of them so this is about

12
00:00:28,080 --> 00:00:35,040
building an intrusion detection system

13
00:00:29,810 --> 00:00:36,899
in in a virtual server space to protect

14
00:00:35,040 --> 00:00:39,660
other systems that don't really have

15
00:00:36,899 --> 00:00:41,309
protection actually to offer monitoring

16
00:00:39,660 --> 00:00:47,839
and detection more than protection but

17
00:00:41,309 --> 00:00:51,480
I'll get into all of this all right so

18
00:00:47,840 --> 00:00:53,430
cloud hosting is really cheap and easy

19
00:00:51,480 --> 00:00:55,319
you can set up a server for about five

20
00:00:53,430 --> 00:00:59,370
to ten dollars a month or twenty if you

21
00:00:55,320 --> 00:01:00,960
want to spend it it's you can have a

22
00:00:59,370 --> 00:01:03,629
server set up within a couple minutes

23
00:01:00,960 --> 00:01:05,700
and have a website in the case of what

24
00:01:03,629 --> 00:01:07,220
I'm looking at set up quickly you can

25
00:01:05,700 --> 00:01:09,689
also set up other servers too

26
00:01:07,220 --> 00:01:12,390
the problem is that security options are

27
00:01:09,689 --> 00:01:13,979
limited just looking at the providers

28
00:01:12,390 --> 00:01:17,100
that I'm going to be working with today

29
00:01:13,979 --> 00:01:18,720
the options are limited to reporting of

30
00:01:17,100 --> 00:01:22,798
vulnerability reading about how to

31
00:01:18,720 --> 00:01:25,048
secure a server and just reading other

32
00:01:22,799 --> 00:01:26,580
documentation but they don't really

33
00:01:25,049 --> 00:01:29,100
provide anything in the way of

34
00:01:26,580 --> 00:01:30,479
monitoring order detection so what kind

35
00:01:29,100 --> 00:01:33,479
of people would do this sort of thing

36
00:01:30,479 --> 00:01:37,289
I'd do it you might do it if you have a

37
00:01:33,479 --> 00:01:39,360
good long week and nothing to do but

38
00:01:37,290 --> 00:01:40,680
probably your average website owner is

39
00:01:39,360 --> 00:01:42,479
not going to be interested in doing this

40
00:01:40,680 --> 00:01:43,590
they just want to set their side up and

41
00:01:42,479 --> 00:01:45,420
usually they're going to forget about it

42
00:01:43,590 --> 00:01:47,130
if they use content management systems

43
00:01:45,420 --> 00:01:49,079
they're gonna probably leave it and

44
00:01:47,130 --> 00:01:50,670
forget about updating or not even think

45
00:01:49,079 --> 00:01:52,470
about it

46
00:01:50,670 --> 00:01:56,299
why bother during this well obviously

47
00:01:52,470 --> 00:01:58,740
well it's kind of fun and security is

48
00:01:56,299 --> 00:02:02,360
really important

49
00:01:58,740 --> 00:02:06,149
using data from fish tank which is a

50
00:02:02,360 --> 00:02:09,560
website that is run at Open DNS people

51
00:02:06,149 --> 00:02:12,420
can submit fishes they believe that our

52
00:02:09,560 --> 00:02:13,709
fishes and people the community a fish

53
00:02:12,420 --> 00:02:15,510
tank can vote on them

54
00:02:13,709 --> 00:02:17,579
so over the life of fish tank or at

55
00:02:15,510 --> 00:02:18,899
least to the last database refresh I

56
00:02:17,579 --> 00:02:20,579
don't know what that has happened but

57
00:02:18,900 --> 00:02:23,790
there's been there have been over three

58
00:02:20,579 --> 00:02:28,799
million submissions to fish tank there

59
00:02:23,790 --> 00:02:32,489
were total of 1000 1 billion 1.7 million

60
00:02:28,799 --> 00:02:33,959
basically fishes verified as valid at

61
00:02:32,489 --> 00:02:37,049
the time of this snapshot which was last

62
00:02:33,959 --> 00:02:38,459
week about we can half ago there were

63
00:02:37,049 --> 00:02:40,769
thirty thousand seven hundred

64
00:02:38,459 --> 00:02:42,569
sixty-eight online valid fish that means

65
00:02:40,769 --> 00:02:45,209
that they were verified as valid and

66
00:02:42,569 --> 00:02:47,280
currently online at that time I took

67
00:02:45,209 --> 00:02:49,950
that data and I did some processing on

68
00:02:47,280 --> 00:02:53,310
it and look at the unique domains there

69
00:02:49,950 --> 00:02:56,099
were over 10,000 unique domains with

70
00:02:53,310 --> 00:02:58,799
these of these 30,000 and those were

71
00:02:56,099 --> 00:03:02,909
attributable to over two thousand unique

72
00:02:58,799 --> 00:03:04,799
asns so looking at those asns this is

73
00:03:02,909 --> 00:03:08,370
kind of a pain to look at but this is

74
00:03:04,799 --> 00:03:09,959
just a text file of the SNS so I want to

75
00:03:08,370 --> 00:03:12,000
look at a different way to put it into a

76
00:03:09,959 --> 00:03:15,540
graph so you can see there these are

77
00:03:12,000 --> 00:03:18,120
kind of the the worst providers that

78
00:03:15,540 --> 00:03:21,690
have phishing content whether it's free

79
00:03:18,120 --> 00:03:24,359
hosting or compromised hosts or actual

80
00:03:21,690 --> 00:03:27,150
registered domains we see a lot of stuff

81
00:03:24,359 --> 00:03:28,109
obviously it's Cyrus one PayPal fishing

82
00:03:27,150 --> 00:03:32,099
and things like that

83
00:03:28,109 --> 00:03:33,810
GoDaddy is a big big one they also put

84
00:03:32,099 --> 00:03:35,250
some as far as I've been able to tell

85
00:03:33,810 --> 00:03:38,659
they put so they have some servers

86
00:03:35,250 --> 00:03:41,760
through Cyrus ones so there may be some

87
00:03:38,659 --> 00:03:44,298
cross-contamination looking at the oh I

88
00:03:41,760 --> 00:03:47,310
forgot I did that looking at the

89
00:03:44,299 --> 00:03:50,099
registrar's just to see who the top

90
00:03:47,310 --> 00:03:51,689
registrar's for domains maybe this

91
00:03:50,099 --> 00:03:56,388
doesn't indicate which ones are

92
00:03:51,689 --> 00:03:58,888
compromised domains or which ones are

93
00:03:56,389 --> 00:04:01,949
registered for more targeted

94
00:03:58,889 --> 00:04:04,799
spearfishing type things but we have

95
00:04:01,949 --> 00:04:07,409
GoDaddy is most common of the fishtank

96
00:04:04,799 --> 00:04:08,790
data it's pretty cheap you can see the

97
00:04:07,409 --> 00:04:12,780
network solutions is in there that's

98
00:04:08,790 --> 00:04:14,280
more expensive but the I would imagine

99
00:04:12,780 --> 00:04:15,900
it may be some targeted stuff might use

100
00:04:14,280 --> 00:04:19,649
a more expensive option to look more

101
00:04:15,900 --> 00:04:22,789
legitimate but the idea is that domains

102
00:04:19,649 --> 00:04:27,210
are a constant are often compromised

103
00:04:22,789 --> 00:04:28,860
because for fishing usually

104
00:04:27,210 --> 00:04:32,758
fishing is very deep inside the site and

105
00:04:28,860 --> 00:04:33,990
the host owner doesn't know about it so

106
00:04:32,759 --> 00:04:34,889
that's one reason you want to might want

107
00:04:33,990 --> 00:04:36,569
to protect the server

108
00:04:34,889 --> 00:04:39,539
additionally sites are just hacked in

109
00:04:36,569 --> 00:04:43,530
this case you might know this the hack a

110
00:04:39,539 --> 00:04:45,509
lot sooner and fix the problem but the

111
00:04:43,530 --> 00:04:49,799
fishing situation you usually don't know

112
00:04:45,509 --> 00:04:52,349
about it for a while but looking closer

113
00:04:49,800 --> 00:04:54,509
at content management systems which are

114
00:04:52,349 --> 00:04:56,130
the most common ways of compromising the

115
00:04:54,509 --> 00:04:57,389
site and specifically looking at

116
00:04:56,130 --> 00:05:00,180
WordPress sources where I'm going to be

117
00:04:57,389 --> 00:05:01,979
using today in my demonstrations the

118
00:05:00,180 --> 00:05:06,210
WordPress has a lot it's up to version

119
00:05:01,979 --> 00:05:08,039
for something but it's got a there's a

120
00:05:06,210 --> 00:05:09,659
database you can look at all the

121
00:05:08,039 --> 00:05:12,120
vulnerabilities that have been reported

122
00:05:09,660 --> 00:05:16,050
so far and this doesn't even look into

123
00:05:12,120 --> 00:05:18,780
the plugins plugins are a great way for

124
00:05:16,050 --> 00:05:20,280
an attacker to get into a site and

125
00:05:18,780 --> 00:05:23,070
compromise it which I'll also be showing

126
00:05:20,280 --> 00:05:25,229
you in my demonstration you can use tool

127
00:05:23,070 --> 00:05:27,330
like WP scan this is specifically for

128
00:05:25,229 --> 00:05:29,580
WordPress it can enumerate you're a

129
00:05:27,330 --> 00:05:31,258
wordpress instance and tell you what

130
00:05:29,580 --> 00:05:33,449
version is running what plugins it's

131
00:05:31,259 --> 00:05:36,449
running and hopefully maybe some other

132
00:05:33,449 --> 00:05:37,680
stuff I'm going to show you a really you

133
00:05:36,449 --> 00:05:40,740
probably all know this a really

134
00:05:37,680 --> 00:05:43,050
high-level view of how it works when a

135
00:05:40,740 --> 00:05:44,969
visitor visits a website so you have

136
00:05:43,050 --> 00:05:46,380
your cloud which is just a network it's

137
00:05:44,969 --> 00:05:49,259
your hosting provider up in this case

138
00:05:46,380 --> 00:05:50,870
and you've got your ISP and you have the

139
00:05:49,259 --> 00:05:55,169
internet which we know is made of cats

140
00:05:50,870 --> 00:05:57,419
so the person the visitor of your

141
00:05:55,169 --> 00:05:59,549
website is just gonna they want to visit

142
00:05:57,419 --> 00:06:01,620
it and this super super simple view is

143
00:05:59,550 --> 00:06:03,150
that they go they go there and that's

144
00:06:01,620 --> 00:06:06,000
that's how it looks

145
00:06:03,150 --> 00:06:08,310
a hacker version very similar you have

146
00:06:06,000 --> 00:06:10,349
your attacker and ISPs maybe their proxy

147
00:06:08,310 --> 00:06:11,460
maybe they're going it doesn't matter

148
00:06:10,349 --> 00:06:14,070
how they get there they have an endpoint

149
00:06:11,460 --> 00:06:15,780
before they pass over to the website

150
00:06:14,070 --> 00:06:19,469
visitors go there and we don't have any

151
00:06:15,780 --> 00:06:21,599
clue that anything happens so I'm gonna

152
00:06:19,469 --> 00:06:23,729
be showing you a hack of the slider

153
00:06:21,599 --> 00:06:25,199
revolution WordPress plug-in about a

154
00:06:23,729 --> 00:06:29,340
year and a half ago I think there was a

155
00:06:25,199 --> 00:06:30,659
major vulnerability with it and it it's

156
00:06:29,340 --> 00:06:32,580
a little plugin that makes it so you it

157
00:06:30,659 --> 00:06:35,520
can present some pictures like a little

158
00:06:32,580 --> 00:06:38,909
slide on your WordPress page and a lot

159
00:06:35,520 --> 00:06:40,680
of people use it but what we're going to

160
00:06:38,909 --> 00:06:43,409
be doing is exploiting

161
00:06:40,680 --> 00:06:45,419
local file include where I'm gonna be I

162
00:06:43,410 --> 00:06:47,820
have this domain JP or calm which I

163
00:06:45,419 --> 00:06:50,310
registered for this demonstration I'm

164
00:06:47,820 --> 00:06:52,110
going to be trying to get the WP admin

165
00:06:50,310 --> 00:06:55,110
config file which contains my database

166
00:06:52,110 --> 00:06:56,639
username and password for WordPress you

167
00:06:55,110 --> 00:06:58,650
shouldn't be able to get this but the

168
00:06:56,639 --> 00:07:02,070
local file and could let you do this so

169
00:06:58,650 --> 00:07:04,349
this is the text I'll be pasting in and

170
00:07:02,070 --> 00:07:07,710
also I have a snort rule that I will be

171
00:07:04,350 --> 00:07:13,620
using to to catch this just to show you

172
00:07:07,710 --> 00:07:15,330
this is my my dashboard for my WordPress

173
00:07:13,620 --> 00:07:17,550
domain and I'm running running an older

174
00:07:15,330 --> 00:07:18,719
version of WordPress and it doesn't

175
00:07:17,550 --> 00:07:20,250
really matter I'm not working on

176
00:07:18,720 --> 00:07:22,229
exploiting WordPress itself I'm going to

177
00:07:20,250 --> 00:07:23,729
exploit revolution slider this is the

178
00:07:22,229 --> 00:07:27,539
vulnerable version here that I have

179
00:07:23,729 --> 00:07:29,340
installed and I did it WP scan of my

180
00:07:27,539 --> 00:07:31,550
system that's kind of hard to read them

181
00:07:29,340 --> 00:07:34,560
sorry but you can see down at the bottom

182
00:07:31,550 --> 00:07:36,240
got rep slider I think I actually yeah I

183
00:07:34,560 --> 00:07:37,710
got Rev slider it doesn't tell me what

184
00:07:36,240 --> 00:07:39,330
version but I can like well there's

185
00:07:37,710 --> 00:07:41,820
something from you look for as an

186
00:07:39,330 --> 00:07:43,289
attacker I have this one video here

187
00:07:41,820 --> 00:07:45,210
because it was this easier in this case

188
00:07:43,289 --> 00:07:47,789
to do a video but I'm opening a web

189
00:07:45,210 --> 00:07:50,250
browser I'm going to JP or comm and this

190
00:07:47,789 --> 00:07:53,370
is this is actually hosted at Hostgator

191
00:07:50,250 --> 00:07:55,500
right now I'm pasting in that field that

192
00:07:53,370 --> 00:07:58,050
you saw before and I'm gonna press enter

193
00:07:55,500 --> 00:08:00,120
and when I do what I would like to see

194
00:07:58,050 --> 00:08:02,909
is a download of a text file but I got a

195
00:08:00,120 --> 00:08:04,770
non acceptable message a message from

196
00:08:02,909 --> 00:08:08,880
mod security which is an Apache module

197
00:08:04,770 --> 00:08:11,340
to do some security features so mod

198
00:08:08,880 --> 00:08:12,840
security protected us that's great I

199
00:08:11,340 --> 00:08:14,159
didn't know that Hostgator had that they

200
00:08:12,840 --> 00:08:15,780
don't announce anything about any kind

201
00:08:14,159 --> 00:08:17,610
of security feature they have but we

202
00:08:15,780 --> 00:08:20,849
don't have the idea that it actually

203
00:08:17,610 --> 00:08:22,409
happens it wasn't successful that

204
00:08:20,849 --> 00:08:25,199
doesn't mean it's not nice to know it

205
00:08:22,409 --> 00:08:27,030
someone tried for a moment us take a

206
00:08:25,199 --> 00:08:29,729
sidestep and look at the neighborhood

207
00:08:27,030 --> 00:08:33,299
that I live in with this domain sitting

208
00:08:29,729 --> 00:08:36,899
on host Gators Network I've got this

209
00:08:33,299 --> 00:08:39,419
domain JP or calm and looking at it I've

210
00:08:36,899 --> 00:08:42,539
got an a record my IP address basically

211
00:08:39,419 --> 00:08:44,730
if where JP or com lives is this dot 97

212
00:08:42,539 --> 00:08:47,220
address which I'll refer to a few times

213
00:08:44,730 --> 00:08:49,200
as I demonstrate you can see some DNS

214
00:08:47,220 --> 00:08:49,779
requests this is a while ago this is

215
00:08:49,200 --> 00:08:51,810
needs

216
00:08:49,779 --> 00:08:57,639
and stuff and it's through the open DNS

217
00:08:51,810 --> 00:08:59,920
Network these spikes so looking at it

218
00:08:57,639 --> 00:09:01,899
another way here's here's my domain and

219
00:08:59,920 --> 00:09:03,819
here's the a record you can see there

220
00:09:01,899 --> 00:09:05,259
are some name servers or the top is at

221
00:09:03,819 --> 00:09:07,029
Hostgator name servers so whenever

222
00:09:05,259 --> 00:09:09,399
someone types in their browser

223
00:09:07,029 --> 00:09:11,319
J furie com it goes up the chain through

224
00:09:09,399 --> 00:09:15,339
DNS and eventually gets the hostgator

225
00:09:11,319 --> 00:09:19,120
and hostgator says it exists at 97 but

226
00:09:15,339 --> 00:09:21,249
who else is at this IP address well this

227
00:09:19,120 --> 00:09:22,660
is a list you don't have to read it you

228
00:09:21,249 --> 00:09:24,279
can't read it too small but this is a

229
00:09:22,660 --> 00:09:26,559
list of all the domains on my shared

230
00:09:24,279 --> 00:09:28,509
hosting that I pay I think 11 dollars a

231
00:09:26,559 --> 00:09:31,749
month for I don't know who any of these

232
00:09:28,509 --> 00:09:33,850
domains are maybe I do but I don't maybe

233
00:09:31,749 --> 00:09:35,290
someone else is interested in attacking

234
00:09:33,850 --> 00:09:36,579
them I haven't really heard much about

235
00:09:35,290 --> 00:09:39,160
people attacking shared hosting

236
00:09:36,579 --> 00:09:41,019
laterally moving once they did like from

237
00:09:39,160 --> 00:09:42,550
the one site to another getting to the

238
00:09:41,019 --> 00:09:44,499
base operating system but I don't know

239
00:09:42,550 --> 00:09:47,469
it's just that I'm just sitting there

240
00:09:44,499 --> 00:09:49,540
with all these people also what else is

241
00:09:47,470 --> 00:09:52,420
at this IP address doing the nmap scan

242
00:09:49,540 --> 00:09:53,889
of the IP I can see there's a lot of

243
00:09:52,420 --> 00:09:54,939
filtered ports there's some open ports

244
00:09:53,889 --> 00:09:59,290
there's at least something for

245
00:09:54,939 --> 00:10:00,910
exploration for a board attacker maybe a

246
00:09:59,290 --> 00:10:04,209
dedicated attacker but I think you could

247
00:10:00,910 --> 00:10:06,490
just explore this quite a bit so talking

248
00:10:04,209 --> 00:10:09,309
about the classic model of intrusion

249
00:10:06,490 --> 00:10:12,459
detection I have this boring corporate

250
00:10:09,309 --> 00:10:15,279
network diagram that I worked up maybe

251
00:10:12,459 --> 00:10:17,170
this is kind of theoretical but it's

252
00:10:15,279 --> 00:10:18,970
it's practical I've seen it before in

253
00:10:17,170 --> 00:10:21,219
environments you have your router you've

254
00:10:18,970 --> 00:10:23,139
got IDs systems in between different

255
00:10:21,220 --> 00:10:25,059
firewalls things to segment and you've

256
00:10:23,139 --> 00:10:26,879
got a mail server the web server

257
00:10:25,059 --> 00:10:29,110
everything is under your control you can

258
00:10:26,879 --> 00:10:31,410
see when an attack happens if you have

259
00:10:29,110 --> 00:10:34,540
the right signatures for it you can also

260
00:10:31,410 --> 00:10:37,360
get log files protecting your Active

261
00:10:34,540 --> 00:10:39,429
Directory all that stuff that's great

262
00:10:37,360 --> 00:10:41,860
you've got full control hopefully but

263
00:10:39,429 --> 00:10:43,779
the cloud model the security perimeter

264
00:10:41,860 --> 00:10:45,639
is averting a lot of people are putting

265
00:10:43,779 --> 00:10:47,290
their servers out there not just web

266
00:10:45,639 --> 00:10:49,120
servers like I'm showing in this example

267
00:10:47,290 --> 00:10:51,819
a lot of people are printing becoming

268
00:10:49,120 --> 00:10:53,920
anything out there and you may want to

269
00:10:51,819 --> 00:10:55,329
protect it in this case I'm just showing

270
00:10:53,920 --> 00:10:57,819
protecting web servers but you can

271
00:10:55,329 --> 00:11:00,459
protect a lot of other things but what

272
00:10:57,819 --> 00:11:01,790
I'm doing here I have an IDs @ly node

273
00:11:00,459 --> 00:11:04,250
it's a

274
00:11:01,790 --> 00:11:07,730
private server service it's a Linux

275
00:11:04,250 --> 00:11:08,870
system and I'm able to I have control on

276
00:11:07,730 --> 00:11:11,690
it so I was able to install whatever I

277
00:11:08,870 --> 00:11:14,180
want and I paid no $20 a month for that

278
00:11:11,690 --> 00:11:17,630
thing and the idea is up going to be

279
00:11:14,180 --> 00:11:20,630
sending traffic to JP or comm the

280
00:11:17,630 --> 00:11:23,600
Hostgator through the ids aligner using

281
00:11:20,630 --> 00:11:26,660
some proxying which is old news and i'll

282
00:11:23,600 --> 00:11:28,310
get into how the proxy works and how

283
00:11:26,660 --> 00:11:31,610
dangerous it kind of is

284
00:11:28,310 --> 00:11:35,050
so but this is the basic idea well I

285
00:11:31,610 --> 00:11:36,830
note is the dot one eight nine address

286
00:11:35,050 --> 00:11:38,890
so I'm gonna show you a little bit about

287
00:11:36,830 --> 00:11:41,270
the lye noticed it's running Apache

288
00:11:38,890 --> 00:11:43,010
proxy and I'm doing some mitigation on

289
00:11:41,270 --> 00:11:46,090
the proxy with the IP tables and fail to

290
00:11:43,010 --> 00:11:48,620
ban and I'm also running to snort for

291
00:11:46,090 --> 00:11:50,840
monitoring and detection I'm doing TCP

292
00:11:48,620 --> 00:11:53,050
dump for packet capture I'm running some

293
00:11:50,840 --> 00:11:56,240
other tools which I think I get into

294
00:11:53,050 --> 00:11:57,949
this is my control panel when I log into

295
00:11:56,240 --> 00:12:01,580
lino this you can see I'm running a

296
00:11:57,950 --> 00:12:02,840
Debian just kind of a low-end system it

297
00:12:01,580 --> 00:12:06,020
doesn't have much going on I've actually

298
00:12:02,840 --> 00:12:08,630
used what I'll be showing you to monitor

299
00:12:06,020 --> 00:12:10,220
multiple sites and services but I

300
00:12:08,630 --> 00:12:12,380
imagine if you wanted to do this as a

301
00:12:10,220 --> 00:12:14,360
service you would probably want

302
00:12:12,380 --> 00:12:16,340
something be here or you'd want an

303
00:12:14,360 --> 00:12:19,330
actual system somewhere which kind of

304
00:12:16,340 --> 00:12:23,870
takes it out of the cloud ID ID idea but

305
00:12:19,330 --> 00:12:26,990
this this works for me for the

306
00:12:23,870 --> 00:12:28,820
configuration talk about the DNS seems

307
00:12:26,990 --> 00:12:30,020
like I've been talking about DNS but a

308
00:12:28,820 --> 00:12:33,500
whole bunch but I have to keep going

309
00:12:30,020 --> 00:12:34,790
with this this is the another kind of

310
00:12:33,500 --> 00:12:37,940
high level or review but this is the

311
00:12:34,790 --> 00:12:40,339
basic routes a current route user says

312
00:12:37,940 --> 00:12:41,510
where's jpoa com we have Tron guy who

313
00:12:40,340 --> 00:12:43,730
represents the Internet

314
00:12:41,510 --> 00:12:45,950
he says it's over at dot 97 that's that

315
00:12:43,730 --> 00:12:49,520
Hostgator address and then they go to

316
00:12:45,950 --> 00:12:53,660
the website well in lion ode I could

317
00:12:49,520 --> 00:12:55,370
figure a DNS record so this this updates

318
00:12:53,660 --> 00:12:59,060
line owns name servers their public name

319
00:12:55,370 --> 00:13:02,360
servers and says JP or e.com can be

320
00:12:59,060 --> 00:13:06,439
found if I tell the registrar that can

321
00:13:02,360 --> 00:13:08,510
be found at this address 189 so that

322
00:13:06,440 --> 00:13:09,830
that sets that up and then going into my

323
00:13:08,510 --> 00:13:12,470
registrar this is where I actually

324
00:13:09,830 --> 00:13:13,940
purchased JP or calm down at the bottom

325
00:13:12,470 --> 00:13:14,840
you can see I've got Hostgator as my

326
00:13:13,940 --> 00:13:16,550
name servers right

327
00:13:14,840 --> 00:13:18,830
I should change this I mean anyone who's

328
00:13:16,550 --> 00:13:21,050
dealt with web servers knows how this

329
00:13:18,830 --> 00:13:25,010
works but change it to lino calm their

330
00:13:21,050 --> 00:13:27,229
name the servers and within almost

331
00:13:25,010 --> 00:13:29,000
instantaneous but usually they say 12 to

332
00:13:27,230 --> 00:13:31,160
24 hours it's updated and the whole

333
00:13:29,000 --> 00:13:33,860
internet knows that this is where JP or

334
00:13:31,160 --> 00:13:34,459
comm is so the modified route won't look

335
00:13:33,860 --> 00:13:37,070
like this

336
00:13:34,460 --> 00:13:40,790
they say where's this website Internet

337
00:13:37,070 --> 00:13:44,210
says it's over at 189 that's the line on

338
00:13:40,790 --> 00:13:46,819
hosts and they're gonna pass through but

339
00:13:44,210 --> 00:13:49,360
a little slow on the animation here

340
00:13:46,820 --> 00:13:53,420
sorry they're gonna pass through the VPS

341
00:13:49,360 --> 00:13:57,170
the IBS virtual private server and head

342
00:13:53,420 --> 00:13:58,729
over to the Hostgator address and in my

343
00:13:57,170 --> 00:14:00,800
example I'll show you I'm gonna switch

344
00:13:58,730 --> 00:14:03,470
from Hostgator to digitalocean on the

345
00:14:00,800 --> 00:14:05,209
fly but we'll get there the actual

346
00:14:03,470 --> 00:14:08,720
website location this is the Hostgator

347
00:14:05,210 --> 00:14:11,840
control panel and we zoom in we can see

348
00:14:08,720 --> 00:14:14,630
I've got some add-on domains option this

349
00:14:11,840 --> 00:14:17,270
Hostgator account I have a I have a

350
00:14:14,630 --> 00:14:19,400
domain there doesn't really matter what

351
00:14:17,270 --> 00:14:22,550
it is but you'll see it in a second and

352
00:14:19,400 --> 00:14:23,959
all out on domains become subdomains so

353
00:14:22,550 --> 00:14:26,810
you'll just you'll see that and when I

354
00:14:23,960 --> 00:14:29,380
show you that the configuration but the

355
00:14:26,810 --> 00:14:32,270
files live in that that domains JP ory

356
00:14:29,380 --> 00:14:34,160
location I won't talk about the open

357
00:14:32,270 --> 00:14:37,790
proxy that I'll be using open proxies

358
00:14:34,160 --> 00:14:40,880
are really bad for the Internet in a

359
00:14:37,790 --> 00:14:46,189
dedicated attacker or not dedicated

360
00:14:40,880 --> 00:14:47,689
attacker can connect in to the open

361
00:14:46,190 --> 00:14:51,020
proxy which are constantly being scanned

362
00:14:47,690 --> 00:14:53,840
for and found very frequently and use it

363
00:14:51,020 --> 00:14:55,250
to pivot off and then hack some site or

364
00:14:53,840 --> 00:14:57,290
do whatever kind of activity they want

365
00:14:55,250 --> 00:14:59,030
and it looks like it came from my system

366
00:14:57,290 --> 00:15:00,530
so that's a really bad thing you

367
00:14:59,030 --> 00:15:02,360
shouldn't run it open proxies this is

368
00:15:00,530 --> 00:15:04,220
just the initial proof of concept of

369
00:15:02,360 --> 00:15:05,800
this project and I've got some

370
00:15:04,220 --> 00:15:08,090
mitigations in place which you'll see

371
00:15:05,800 --> 00:15:09,439
let's put an intrusion detection system

372
00:15:08,090 --> 00:15:12,440
in there so I'm going to show you a demo

373
00:15:09,440 --> 00:15:14,480
of how its configured and I'm it's a

374
00:15:12,440 --> 00:15:17,090
little technical but hopefully you know

375
00:15:14,480 --> 00:15:19,760
can't you okay with that I have some

376
00:15:17,090 --> 00:15:21,620
cheat sheets or a cheat sheet over here

377
00:15:19,760 --> 00:15:26,480
for me to make a little quicker of it up

378
00:15:21,620 --> 00:15:27,950
so I have a some shell scripts that log

379
00:15:26,480 --> 00:15:29,810
me into my servers

380
00:15:27,950 --> 00:15:32,110
this is me logging into the IDS at the

381
00:15:29,810 --> 00:15:34,359
very top window you can all see that

382
00:15:32,110 --> 00:15:38,210
okay

383
00:15:34,360 --> 00:15:41,900
looking at the they attach the config

384
00:15:38,210 --> 00:15:44,780
file I have I'm listening on port 80 and

385
00:15:41,900 --> 00:15:46,790
443 80 is for now I'm just working with

386
00:15:44,780 --> 00:15:48,680
port 80 HTTP traffic because most the

387
00:15:46,790 --> 00:15:52,010
attacks gonna be over HTTP but I'll get

388
00:15:48,680 --> 00:15:54,439
in other protocols later any thing going

389
00:15:52,010 --> 00:15:55,730
to JPY comm port 80 will be sent to this

390
00:15:54,440 --> 00:15:58,280
sub domain this is what I mentioned

391
00:15:55,730 --> 00:16:03,590
before JP or e about absent fifth column

392
00:15:58,280 --> 00:16:05,870
I also have a 443 a SSL site or the I'm

393
00:16:03,590 --> 00:16:09,130
using snore be to look at alerts as they

394
00:16:05,870 --> 00:16:14,420
happen then you'll see that too and then

395
00:16:09,130 --> 00:16:16,970
looking at this is the proxy comm file

396
00:16:14,420 --> 00:16:19,459
this proxy requests on is what makes it

397
00:16:16,970 --> 00:16:22,220
so that it's an open proxy so that's

398
00:16:19,460 --> 00:16:26,960
that's bad but in the case of this it's

399
00:16:22,220 --> 00:16:28,940
good and I'll show you I pee tables what

400
00:16:26,960 --> 00:16:32,840
the rules I'm going to use I'm not gonna

401
00:16:28,940 --> 00:16:38,660
go too much into IP tables but let me go

402
00:16:32,840 --> 00:16:40,580
in is more privileged user right now I

403
00:16:38,660 --> 00:16:42,560
have no rules

404
00:16:40,580 --> 00:16:45,860
I have some rules from last night I was

405
00:16:42,560 --> 00:16:48,979
testing so

406
00:16:45,860 --> 00:16:50,329
I have no rules and my IP tables I'm

407
00:16:48,980 --> 00:16:53,170
gonna add some I'm going to add an

408
00:16:50,329 --> 00:16:55,550
output and input these will allow

409
00:16:53,170 --> 00:16:57,649
traffic to and from the Hostgator

410
00:16:55,550 --> 00:17:00,258
servers not the dot 97 I mentioned

411
00:16:57,649 --> 00:17:02,209
before and also a reject at the end that

412
00:17:00,259 --> 00:17:04,339
will reject all port 80 traffic to

413
00:17:02,209 --> 00:17:06,379
anywhere else making it so it's not

414
00:17:04,339 --> 00:17:09,589
usable open proxy it's still able to be

415
00:17:06,380 --> 00:17:13,069
checked as I will show so I'm adding the

416
00:17:09,589 --> 00:17:19,000
output chain and I'm adding the input

417
00:17:13,069 --> 00:17:22,760
chain and then they reject and then if I

418
00:17:19,000 --> 00:17:29,330
list it again you can see I've got I'm

419
00:17:22,760 --> 00:17:31,220
allowing HTTP traffic in and out and

420
00:17:29,330 --> 00:17:34,270
rejecting the rest of it so it's kind of

421
00:17:31,220 --> 00:17:41,440
difficult to follow the line breaks but

422
00:17:34,270 --> 00:17:43,580
and then I'm gonna start Apache and

423
00:17:41,440 --> 00:17:45,649
we're going to test the open proxy I'm

424
00:17:43,580 --> 00:17:48,080
gonna show you how it how it works first

425
00:17:45,649 --> 00:17:48,739
I'm gonna run a streaming TCP down

426
00:17:48,080 --> 00:17:50,539
possession

427
00:17:48,740 --> 00:17:52,309
well it'll be found or easy but you'll

428
00:17:50,539 --> 00:17:54,139
just see stuff happen and I'm gonna tell

429
00:17:52,309 --> 00:17:55,970
net on the bottom window is my local

430
00:17:54,139 --> 00:17:58,370
system right here I'm not connected to

431
00:17:55,970 --> 00:18:01,549
another server outside I'm gonna tell

432
00:17:58,370 --> 00:18:03,799
that to JP or column port 80 and I'm

433
00:18:01,549 --> 00:18:05,870
gonna actually try to get what I'm

434
00:18:03,799 --> 00:18:09,980
supposed to be able to get at this sub

435
00:18:05,870 --> 00:18:12,830
domain press ENTER a couple times in a

436
00:18:09,980 --> 00:18:14,149
second we'll see it passed through you

437
00:18:12,830 --> 00:18:15,710
can see down here at the bottom proudly

438
00:18:14,149 --> 00:18:19,250
powered by WordPress I got the index

439
00:18:15,710 --> 00:18:21,110
page and that's great that's how that's

440
00:18:19,250 --> 00:18:25,059
the way I want it to be but let's try

441
00:18:21,110 --> 00:18:28,870
again real quick we'll tell that again

442
00:18:25,059 --> 00:18:31,870
and we're gonna try to use my tapas

443
00:18:28,870 --> 00:18:31,870
sorry

444
00:18:32,799 --> 00:18:41,200
we're gonna use my telling that session

445
00:18:34,419 --> 00:18:43,630
to that's gonna cancel me out okay tell

446
00:18:41,200 --> 00:18:45,549
it again we're gonna try to use this

447
00:18:43,630 --> 00:18:56,399
Telenet so get the index from the otter

448
00:18:45,549 --> 00:18:56,399
calm maybe we wait and we got this error

449
00:18:56,610 --> 00:19:01,809
so actually we didn't get the error I

450
00:18:59,200 --> 00:19:10,630
didn't make my iptables is not in effect

451
00:19:01,809 --> 00:19:14,250
one second demo God strike like I my

452
00:19:10,630 --> 00:19:14,250
medium I reject again

453
00:19:31,779 --> 00:19:34,769
sorry about this

454
00:19:36,059 --> 00:19:39,739
let's try that

455
00:19:47,140 --> 00:19:50,920
she sleep it up on the top

456
00:19:57,620 --> 00:20:01,658
damnit well normally it blocks it I'm

457
00:20:00,590 --> 00:20:05,379
not gonna worry about that because

458
00:20:01,659 --> 00:20:07,640
that's not the point of this talk the

459
00:20:05,380 --> 00:20:09,260
demo gods is just not working with me

460
00:20:07,640 --> 00:20:12,169
today I've been having good luck lately

461
00:20:09,260 --> 00:20:15,169
but anyway I'm gonna go ahead and attack

462
00:20:12,169 --> 00:20:19,010
my site so we can actually see it in

463
00:20:15,169 --> 00:20:20,809
process first I'll show you the rule

464
00:20:19,010 --> 00:20:25,190
that I'm using I have one snort rule in

465
00:20:20,809 --> 00:20:29,629
place at the moment is a local rule I'm

466
00:20:25,190 --> 00:20:31,700
watching for any Content going to been

467
00:20:29,630 --> 00:20:33,260
looking for this kind of thing right

468
00:20:31,700 --> 00:20:44,000
here this is what I pasted in before the

469
00:20:33,260 --> 00:20:46,129
local file include and if I look in in

470
00:20:44,000 --> 00:20:48,710
this directory I've got just as barnyard

471
00:20:46,130 --> 00:20:51,980
to waldo file i'm gonna have unified

472
00:20:48,710 --> 00:20:54,140
files up here a snort is running it

473
00:20:51,980 --> 00:20:56,390
saves it to a binary file and then i'm

474
00:20:54,140 --> 00:21:00,500
use bar nard to barnyard to insert that

475
00:20:56,390 --> 00:21:02,299
into a database which will over you so

476
00:21:00,500 --> 00:21:03,679
I'm going to start snort I have a script

477
00:21:02,299 --> 00:21:06,399
that I wrote that does that for me

478
00:21:03,679 --> 00:21:06,399
and

479
00:21:12,390 --> 00:21:15,450
open proxy things bother bothers me

480
00:21:14,820 --> 00:21:17,939
sorry

481
00:21:15,450 --> 00:21:20,490
alright I'm going to connect in on the

482
00:21:17,940 --> 00:21:22,710
bottom window again to the IDS I need to

483
00:21:20,490 --> 00:21:30,870
start a TCP dump session that will save

484
00:21:22,710 --> 00:21:34,169
peek packet capture so I have a script

485
00:21:30,870 --> 00:21:36,719
it's go save to a file called Hostgator

486
00:21:34,169 --> 00:21:40,049
pcap in the temp directory that's

487
00:21:36,720 --> 00:21:45,690
running I'll show you the last alert

488
00:21:40,049 --> 00:21:47,250
that we had that's this is gonna be

489
00:21:45,690 --> 00:21:54,440
snore B which I'll be logging into in

490
00:21:47,250 --> 00:21:54,440
just a moment and while that's waiting

491
00:21:55,340 --> 00:22:01,830
so this is JP or e.com hosted on

492
00:21:58,980 --> 00:22:03,690
Hostgator here's the snore B dashboard

493
00:22:01,830 --> 00:22:05,399
over here you can see these are my

494
00:22:03,690 --> 00:22:07,500
alerts I've done a lot of testing on

495
00:22:05,399 --> 00:22:09,809
this I did this last night got something

496
00:22:07,500 --> 00:22:11,940
from yesterday so that's the last of our

497
00:22:09,809 --> 00:22:14,070
alert that we have though so over here

498
00:22:11,940 --> 00:22:16,590
on JP or EECOM I'm actually gonna paste

499
00:22:14,070 --> 00:22:21,899
in that same thing that showed you

500
00:22:16,590 --> 00:22:25,620
before and we get that modsecurity error

501
00:22:21,899 --> 00:22:28,199
that we showed before now going back

502
00:22:25,620 --> 00:22:31,320
over to here I'm gonna stop TCP dump I'm

503
00:22:28,200 --> 00:22:33,659
gonna stop snort and let's take a look

504
00:22:31,320 --> 00:22:36,120
you can see I've got a unified file

505
00:22:33,659 --> 00:22:39,450
right here it's 621 bytes so it's got

506
00:22:36,120 --> 00:22:42,120
some data in it I'm gonna run barnyard

507
00:22:39,450 --> 00:22:45,690
which is going to take that unified file

508
00:22:42,120 --> 00:22:47,039
and insert it into a sequel database it

509
00:22:45,690 --> 00:22:48,389
found something it shows me what it

510
00:22:47,039 --> 00:22:51,000
found right there I can go ahead and

511
00:22:48,389 --> 00:22:55,559
quit barnyard real quick I would go back

512
00:22:51,000 --> 00:22:57,360
over here and refresh snort II go back

513
00:22:55,559 --> 00:23:00,389
to the alerts seems to be the best way

514
00:22:57,360 --> 00:23:03,000
to do it and we've got a new one does

515
00:23:00,389 --> 00:23:05,428
not am because my clock this server

516
00:23:03,000 --> 00:23:07,380
whatever looking at the alert you can

517
00:23:05,429 --> 00:23:09,690
see this is B this is the alert that's

518
00:23:07,380 --> 00:23:12,779
fired and snort but we don't know if it

519
00:23:09,690 --> 00:23:14,850
was successful or not if we have our

520
00:23:12,779 --> 00:23:16,080
system set to email us or contact us we

521
00:23:14,850 --> 00:23:17,969
know that someone tried to do something

522
00:23:16,080 --> 00:23:19,740
but we don't know what happens so we

523
00:23:17,970 --> 00:23:22,399
need to look at actual actually look at

524
00:23:19,740 --> 00:23:24,559
the pcap file so i'm going to copy that

525
00:23:22,399 --> 00:23:26,178
pcap file to

526
00:23:24,559 --> 00:23:28,279
system I'm going to exit the server at

527
00:23:26,179 --> 00:23:30,649
the bottom now I'm back on my local

528
00:23:28,279 --> 00:23:32,769
system and I'm going to use SCP to get

529
00:23:30,649 --> 00:23:32,768
it

530
00:23:39,440 --> 00:23:51,560
thank you it's like there's no oh yeah

531
00:23:45,080 --> 00:23:55,970
thank you and looking at this hostgator

532
00:23:51,560 --> 00:23:58,330
pcap okay we can filter it on HTTP

533
00:23:55,970 --> 00:23:58,330
traffic

534
00:23:59,550 --> 00:24:02,690
[Music]

535
00:24:07,419 --> 00:24:13,809
that's actually the initial get of that

536
00:24:11,289 --> 00:24:15,989
I did before let's go down to the bottom

537
00:24:13,809 --> 00:24:15,989
here

538
00:24:18,300 --> 00:24:23,889
we get them not acceptable well this is

539
00:24:21,730 --> 00:24:25,780
part of it in in this traffic I can see

540
00:24:23,890 --> 00:24:27,370
that they aren't successful there's one

541
00:24:25,780 --> 00:24:32,139
of these lines is going to have the mod

542
00:24:27,370 --> 00:24:33,610
security error in it I will show you

543
00:24:32,140 --> 00:24:35,080
that because it's not as exciting as the

544
00:24:33,610 --> 00:24:38,679
next one where I'm actually successful

545
00:24:35,080 --> 00:24:42,639
attacking it so quit player shark

546
00:24:38,680 --> 00:24:46,860
and now we're going to go back to the

547
00:24:42,640 --> 00:24:48,460
demo go back to the slides

548
00:24:46,860 --> 00:24:50,530
alright so we're gonna try another

549
00:24:48,460 --> 00:24:52,030
hosting provider this is this time we're

550
00:24:50,530 --> 00:24:55,120
using digital ocean and we're gonna

551
00:24:52,030 --> 00:24:58,000
succeed in the attack in this case I am

552
00:24:55,120 --> 00:25:01,959
changing it to digital ocean the changes

553
00:24:58,000 --> 00:25:04,030
are going to be made on the IV s and the

554
00:25:01,960 --> 00:25:05,470
traffic will flow the same way I'm not

555
00:25:04,030 --> 00:25:08,139
gonna change the registrar that's going

556
00:25:05,470 --> 00:25:10,450
to stay the same and I have setup this

557
00:25:08,140 --> 00:25:13,930
is my digital ocean control panel I have

558
00:25:10,450 --> 00:25:16,450
set up a local DNS zone telling digital

559
00:25:13,930 --> 00:25:18,190
oceans name servers where I where my

560
00:25:16,450 --> 00:25:20,470
domain is it doesn't matter cuz I didn't

561
00:25:18,190 --> 00:25:23,800
actually change the registrar's DNS I

562
00:25:20,470 --> 00:25:25,570
just did it just because but this is the

563
00:25:23,800 --> 00:25:27,010
address we will be working with I'm

564
00:25:25,570 --> 00:25:28,990
actually gonna be pasting this directly

565
00:25:27,010 --> 00:25:32,050
into my Apache config file to proxy and

566
00:25:28,990 --> 00:25:34,120
over so the dots order to is the address

567
00:25:32,050 --> 00:25:35,770
so here's another demo this is a little

568
00:25:34,120 --> 00:25:42,340
bit shorter demo but we will actually

569
00:25:35,770 --> 00:25:45,370
see the attack I'm going to modify IP

570
00:25:42,340 --> 00:25:50,020
tables now I don't have to flush the

571
00:25:45,370 --> 00:25:52,389
akha tables but I'm going to and I'm

572
00:25:50,020 --> 00:25:54,700
gonna add the stuff for digital ocean

573
00:25:52,390 --> 00:26:00,370
the dot 32 and output input and then the

574
00:25:54,700 --> 00:26:01,900
reject for everything else I could just

575
00:26:00,370 --> 00:26:06,820
keep adding rules though as I have more

576
00:26:01,900 --> 00:26:12,150
sites to protect or monitor now looking

577
00:26:06,820 --> 00:26:12,149
at IP tables up I just left it

578
00:26:21,700 --> 00:26:24,630
sorry about this

579
00:26:33,380 --> 00:26:38,110
this time I'm gonna show you it not

580
00:26:35,720 --> 00:26:38,110
gonna flush it

581
00:26:39,140 --> 00:26:45,049
all right I have this input-output 4.32

582
00:26:42,440 --> 00:26:52,250
and the reject for everything else on

583
00:26:45,049 --> 00:26:59,540
port 80 and I will modify my Apache

584
00:26:52,250 --> 00:27:03,370
config file I'm gonna change this this

585
00:26:59,540 --> 00:27:06,879
mmm is going to go now to the IP address

586
00:27:03,370 --> 00:27:06,879
for digital ocean

587
00:27:14,130 --> 00:27:24,690
and then I need just restart Apache and

588
00:27:22,080 --> 00:27:26,909
then looking over kind of the bottom

589
00:27:24,690 --> 00:27:34,289
window I'm gonna log into my digital

590
00:27:26,910 --> 00:27:36,419
ocean sorry digital ocean server

591
00:27:34,289 --> 00:27:37,470
it's a Linux system hang ten no I'm

592
00:27:36,419 --> 00:27:39,000
paying five dollars a month for this

593
00:27:37,470 --> 00:27:41,700
thing but I have full root access to it

594
00:27:39,000 --> 00:27:45,090
I so I think I've secured it pretty well

595
00:27:41,700 --> 00:27:47,450
and I'm stoked but I'm running the same

596
00:27:45,090 --> 00:27:51,510
WordPress same revolution slider plugin

597
00:27:47,450 --> 00:27:53,100
I'll just show you real quick the patch

598
00:27:51,510 --> 00:28:02,190
a config file this is a more normal

599
00:27:53,100 --> 00:28:04,439
looking file no proxying going on so I

600
00:28:02,190 --> 00:28:05,669
have anything going into this IP address

601
00:28:04,440 --> 00:28:09,480
I could have also set this up as a

602
00:28:05,669 --> 00:28:12,450
domain name but the port 80 will go look

603
00:28:09,480 --> 00:28:18,000
for the files in there www JP or e and

604
00:28:12,450 --> 00:28:20,730
then I'll show you real quick the files

605
00:28:18,000 --> 00:28:22,710
in here if this is the WordPress stuff

606
00:28:20,730 --> 00:28:24,539
this is in my files that I'll be

607
00:28:22,710 --> 00:28:27,929
accessing so I'm going to exit the

608
00:28:24,539 --> 00:28:31,408
digitalocean tope actually mean to start

609
00:28:27,929 --> 00:28:32,850
apache before i need to exit let's

610
00:28:31,409 --> 00:28:37,289
starting apache on digital ocean so

611
00:28:32,850 --> 00:28:40,678
it'll serve up those files for me and i

612
00:28:37,289 --> 00:28:43,020
can go ahead and exit that now and now

613
00:28:40,679 --> 00:28:50,100
we're going to run

614
00:28:43,020 --> 00:28:51,780
we're gonna run snort again starting

615
00:28:50,100 --> 00:28:56,070
snort on the top on the bottom I'm going

616
00:28:51,780 --> 00:29:01,139
to connect into my IDs again and go in

617
00:28:56,070 --> 00:29:03,360
as root and I'm gonna start the pcap

618
00:29:01,140 --> 00:29:05,460
file for digitalocean it's been

619
00:29:03,360 --> 00:29:08,100
digitalocean dot pcap which we'll look

620
00:29:05,460 --> 00:29:13,470
at after I'm done so that's running and

621
00:29:08,100 --> 00:29:17,490
then we're going to visit Jai peur comm

622
00:29:13,470 --> 00:29:19,230
again you can see this one that was a

623
00:29:17,490 --> 00:29:21,299
digital ocean so we're passing through

624
00:29:19,230 --> 00:29:23,350
and going to a different server I'm

625
00:29:21,299 --> 00:29:33,010
going to paste in the exact same

626
00:29:23,350 --> 00:29:34,629
as before now this time when I press

627
00:29:33,010 --> 00:29:36,789
ENTER we will actually see it successful

628
00:29:34,630 --> 00:29:38,770
it's going to exploit reps letter and we

629
00:29:36,789 --> 00:29:41,140
get this pop-up asking us to download a

630
00:29:38,770 --> 00:29:43,918
file it's going to save that file and

631
00:29:41,140 --> 00:29:48,570
then we'll take a look at it

632
00:29:43,919 --> 00:29:50,740
this right here is sorry for the second

633
00:29:48,570 --> 00:29:53,799
though you can kind of read it you can

634
00:29:50,740 --> 00:29:55,539
read it okay okay you can see here's my

635
00:29:53,799 --> 00:29:58,120
database username right here WordPress

636
00:29:55,539 --> 00:30:00,220
my password is hello there so this is a

637
00:29:58,120 --> 00:30:01,870
great this is great for the attacker

638
00:30:00,220 --> 00:30:03,700
they've got my database information it's

639
00:30:01,870 --> 00:30:06,250
a good starting point to compromising my

640
00:30:03,700 --> 00:30:08,470
website now as a website owner we don't

641
00:30:06,250 --> 00:30:11,020
have any idea that it happened except in

642
00:30:08,470 --> 00:30:13,120
this case we do because we we are

643
00:30:11,020 --> 00:30:15,370
watching it with snort so let's go back

644
00:30:13,120 --> 00:30:20,620
to the server stop snort I'm gonna stop

645
00:30:15,370 --> 00:30:24,939
the TCP dump packet capture and I'm

646
00:30:20,620 --> 00:30:29,678
going to start barnyard and it will grab

647
00:30:24,940 --> 00:30:31,960
it windows it will grab that file again

648
00:30:29,679 --> 00:30:33,820
the newest one it actually it keeps a

649
00:30:31,960 --> 00:30:35,740
database of what it has seen and what it

650
00:30:33,820 --> 00:30:39,070
hasn't seen so it found them an alert

651
00:30:35,740 --> 00:30:44,770
I'll stop barnyard and I'm gonna grab

652
00:30:39,070 --> 00:30:49,120
that tactic capture file in a second

653
00:30:44,770 --> 00:30:51,129
I'll show you the alert I'm exiting on

654
00:30:49,120 --> 00:30:54,219
the bottom window is my local system

655
00:30:51,130 --> 00:30:55,929
again I'm gonna SCP that digital ocean

656
00:30:54,220 --> 00:30:58,480
key cap to the desktop

657
00:30:55,929 --> 00:31:05,039
and then I'm going to go back over here

658
00:30:58,480 --> 00:31:05,039
to the snore be refreshing

659
00:31:12,340 --> 00:31:19,909
okay and then going over to the alerts

660
00:31:16,990 --> 00:31:22,730
we have a new one 907 a and this just

661
00:31:19,910 --> 00:31:24,170
happened and it's the exact same that

662
00:31:22,730 --> 00:31:25,130
has the previous one we know something

663
00:31:24,170 --> 00:31:26,510
happened we don't know if we're

664
00:31:25,130 --> 00:31:30,410
successful so of course we have to have

665
00:31:26,510 --> 00:31:32,600
packet capture so let's go ahead and

666
00:31:30,410 --> 00:31:35,780
look at that pcap file that I just got

667
00:31:32,600 --> 00:31:41,629
and this should be a little bit cleaner

668
00:31:35,780 --> 00:31:44,480
to look at following this stream we can

669
00:31:41,630 --> 00:31:46,700
see this is the get request at the top

670
00:31:44,480 --> 00:31:48,470
up here and then down below we got 200

671
00:31:46,700 --> 00:31:49,520
okay message and then we got we can see

672
00:31:48,470 --> 00:31:50,870
that they got that WordPress

673
00:31:49,520 --> 00:31:53,060
configuration file

674
00:31:50,870 --> 00:31:56,209
there's the databases password know that

675
00:31:53,060 --> 00:31:59,240
we need to go in and change our

676
00:31:56,210 --> 00:32:00,890
WordPress information and update our

677
00:31:59,240 --> 00:32:03,160
server and maybe wipe the whole thing

678
00:32:00,890 --> 00:32:05,810
actually it's probably the best option

679
00:32:03,160 --> 00:32:08,680
so that's showing that and showing the

680
00:32:05,810 --> 00:32:08,679
visibility into it

681
00:32:10,680 --> 00:32:14,880
and so potential problems with this

682
00:32:12,420 --> 00:32:16,140
whole configuration it messes up visitor

683
00:32:14,880 --> 00:32:18,540
statistics quite a bit

684
00:32:16,140 --> 00:32:20,160
looking at the Hostgator control panel I

685
00:32:18,540 --> 00:32:22,320
got a double your stats or whatever this

686
00:32:20,160 --> 00:32:25,380
was I can't remember I've got these

687
00:32:22,320 --> 00:32:27,480
visitors at the top it's kind of small

688
00:32:25,380 --> 00:32:29,610
but it's the line owed host and the

689
00:32:27,480 --> 00:32:32,040
other two hosts are me doing some other

690
00:32:29,610 --> 00:32:34,199
stuff before I had it all configured as

691
00:32:32,040 --> 00:32:35,670
liner host as the primary visitors so a

692
00:32:34,200 --> 00:32:36,720
lot of people might be upset by that

693
00:32:35,670 --> 00:32:38,280
not knowing where their visitors

694
00:32:36,720 --> 00:32:39,780
visitors are coming from so if you're

695
00:32:38,280 --> 00:32:42,990
doing this as a service you might want

696
00:32:39,780 --> 00:32:47,850
to modify or whip something up on the

697
00:32:42,990 --> 00:32:52,650
IDs you to get the proxy logs or some

698
00:32:47,850 --> 00:32:54,570
kind of logs to show proper stats this

699
00:32:52,650 --> 00:32:57,930
video is a video here they will show

700
00:32:54,570 --> 00:33:00,300
kind of looking at those log files I'm

701
00:32:57,930 --> 00:33:04,710
just watching the log files and I'm

702
00:33:00,300 --> 00:33:06,330
gonna be visiting my domain it's kind of

703
00:33:04,710 --> 00:33:09,630
way because you can see it you can see

704
00:33:06,330 --> 00:33:11,550
that 67 the 204 address was me visiting

705
00:33:09,630 --> 00:33:13,050
that works but when I tried the same

706
00:33:11,550 --> 00:33:16,110
attack I'm doing that I'm gonna do the

707
00:33:13,050 --> 00:33:17,430
local file include it's actually it

708
00:33:16,110 --> 00:33:18,600
looks like I came from Lion owed so

709
00:33:17,430 --> 00:33:21,920
there's some work to be done on this

710
00:33:18,600 --> 00:33:24,689
part that's the download right there

711
00:33:21,920 --> 00:33:27,330
looking at it you can see this dot 189

712
00:33:24,690 --> 00:33:27,990
to the dot 132 I guess this is going to

713
00:33:27,330 --> 00:33:31,500
digitalocean

714
00:33:27,990 --> 00:33:34,530
but I so there's some problems with the

715
00:33:31,500 --> 00:33:38,220
stats and people logs you might have to

716
00:33:34,530 --> 00:33:41,010
program that other protocols I've played

717
00:33:38,220 --> 00:33:42,750
around with with HTTP most in most cases

718
00:33:41,010 --> 00:33:44,790
I mean pretty much all cases I've seen

719
00:33:42,750 --> 00:33:46,770
it with watching stuff on the intrusion

720
00:33:44,790 --> 00:33:50,250
detection systems at previous

721
00:33:46,770 --> 00:33:52,440
organizations it was all or it wasn't

722
00:33:50,250 --> 00:33:54,360
sequel data it was HTTP but to web

723
00:33:52,440 --> 00:33:58,890
servers HTTP but you could watch sequel

724
00:33:54,360 --> 00:34:00,959
data in a slider to talk about future

725
00:33:58,890 --> 00:34:02,550
research that would be able to capture

726
00:34:00,960 --> 00:34:06,990
more stuff like that but I've actually

727
00:34:02,550 --> 00:34:08,850
put a certificate on the IDs which sort

728
00:34:06,990 --> 00:34:11,399
of man-in-the-middle myself to watch the

729
00:34:08,850 --> 00:34:13,199
traffic but I think that'd be a bad idea

730
00:34:11,399 --> 00:34:14,788
you were offering this as a service you

731
00:34:13,199 --> 00:34:16,589
would just want the HTTPS to pass

732
00:34:14,789 --> 00:34:20,190
through and hope that someone isn't

733
00:34:16,589 --> 00:34:22,288
trying to do something through HTTP the

734
00:34:20,190 --> 00:34:27,119
open proxy I'm using IP tables as you

735
00:34:22,289 --> 00:34:28,470
saw to to do some mitigation on that I'm

736
00:34:27,119 --> 00:34:30,210
doing some other protection stuff like

737
00:34:28,469 --> 00:34:31,859
failed to ban here you can see I blocked

738
00:34:30,210 --> 00:34:34,109
myself from my server while doing some

739
00:34:31,859 --> 00:34:36,538
testing that's my that was my home

740
00:34:34,109 --> 00:34:39,078
address at the time and I was blocked

741
00:34:36,539 --> 00:34:43,349
for an hour 10 minutes kind of annoying

742
00:34:39,079 --> 00:34:45,779
future research what I'd like to do what

743
00:34:43,349 --> 00:34:47,309
would be more robust is to have some

744
00:34:45,779 --> 00:34:49,529
public name servers almost like your

745
00:34:47,309 --> 00:34:50,819
hosting provider hosting provider review

746
00:34:49,529 --> 00:34:52,440
we're all situated to actually build

747
00:34:50,819 --> 00:34:53,730
this system and they probably should do

748
00:34:52,440 --> 00:34:56,940
something like this to offer it as a

749
00:34:53,730 --> 00:34:59,130
service and he sent stuff through a

750
00:34:56,940 --> 00:35:01,920
router through the IDs and out to the

751
00:34:59,130 --> 00:35:04,260
website and no proxy needed proxies are

752
00:35:01,920 --> 00:35:07,260
good idea even more future research

753
00:35:04,260 --> 00:35:10,440
which I find much more exciting is to do

754
00:35:07,260 --> 00:35:12,329
this process in in addition to honey

755
00:35:10,440 --> 00:35:13,440
pots and distributed honey pots all over

756
00:35:12,329 --> 00:35:16,020
the place and you maybe have a server

757
00:35:13,440 --> 00:35:17,819
that is watching reporting on everything

758
00:35:16,020 --> 00:35:19,559
you can send the idea to look at the

759
00:35:17,819 --> 00:35:21,089
server too that way you get some more

760
00:35:19,559 --> 00:35:23,039
insight into what kind of traffic you're

761
00:35:21,089 --> 00:35:25,109
seeing on these honey pots I think also

762
00:35:23,039 --> 00:35:26,940
especially Khan pod which is like a I

763
00:35:25,109 --> 00:35:28,619
believe it Swiss takeda systems it would

764
00:35:26,940 --> 00:35:31,140
be really interesting to see the kind of

765
00:35:28,619 --> 00:35:33,690
network traffic so this would be fun I

766
00:35:31,140 --> 00:35:38,420
think that's that's the end of it I

767
00:35:33,690 --> 00:35:41,420
don't you don't have any questions yeah

768
00:35:38,420 --> 00:35:41,420
here

769
00:35:57,340 --> 00:36:03,250
well his CloudFlare they do that for DNS

770
00:35:59,800 --> 00:36:04,870
of I think they initially did this with

771
00:36:03,250 --> 00:36:07,960
the proxy I've heard I don't know that

772
00:36:04,870 --> 00:36:10,480
for sure but they they're just doing the

773
00:36:07,960 --> 00:36:13,330
DNS traffic and you know the block

774
00:36:10,480 --> 00:36:15,520
Dawson temps I don't know about about

775
00:36:13,330 --> 00:36:17,140
this specific thing I haven't I didn't

776
00:36:15,520 --> 00:36:19,950
see it so I thought well I'll try to do

777
00:36:17,140 --> 00:36:19,950
it see if it happens

778
00:36:38,940 --> 00:36:51,329
I can see that yeah they wouldn't they'd

779
00:36:49,650 --> 00:36:52,680
have they'd have no idea they would just

780
00:36:51,329 --> 00:37:00,839
see your traveler coming from one place

781
00:36:52,680 --> 00:37:03,899
so yeah yeah yeah it's me

782
00:37:00,839 --> 00:37:14,849
and you had a question yeah basically

783
00:37:03,900 --> 00:37:17,180
you had a question in the back I didn't

784
00:37:14,849 --> 00:37:21,030
know that was hostgator they did that

785
00:37:17,180 --> 00:37:23,359
that was hostgator the hostgator have

786
00:37:21,030 --> 00:37:26,700
modsecurity as part of their their

787
00:37:23,359 --> 00:37:28,140
security you know and i didn't configure

788
00:37:26,700 --> 00:37:30,149
it on the digitalocean host because i

789
00:37:28,140 --> 00:37:32,450
wanted to actually be successful in the

790
00:37:30,150 --> 00:37:32,450
attack

791
00:37:42,170 --> 00:38:08,220
yeah I know that would be amazing I

792
00:38:05,730 --> 00:38:11,339
don't know what there are and since I'm

793
00:38:08,220 --> 00:38:13,500
not developer of yet at least but I'm

794
00:38:11,339 --> 00:38:14,660
working on it but it's a that'd be an

795
00:38:13,500 --> 00:38:16,980
awesome project

796
00:38:14,660 --> 00:38:19,200
it'd be great great as he wouldn't have

797
00:38:16,980 --> 00:38:20,730
to have a separate server just install

798
00:38:19,200 --> 00:38:21,899
it right in your place but of course in

799
00:38:20,730 --> 00:38:23,519
the case of Hostgator you don't have

800
00:38:21,900 --> 00:38:25,140
access unless you pay a lot of money for

801
00:38:23,519 --> 00:38:27,779
your own servers you don't have access

802
00:38:25,140 --> 00:38:29,430
to that level I can't turn I could

803
00:38:27,779 --> 00:38:31,529
actually I I checked in so I could have

804
00:38:29,430 --> 00:38:39,890
them turn modsecurity off for me but I

805
00:38:31,529 --> 00:38:39,890
have to call support yeah oh go ahead

806
00:38:45,420 --> 00:38:54,059
I look at mr. previously at my work at

807
00:38:50,099 --> 00:38:55,380
NASA I would watch all the I would not

808
00:38:54,059 --> 00:38:57,420
one of my main jobs was looking at all

809
00:38:55,380 --> 00:39:00,690
the fishing females that were reported

810
00:38:57,420 --> 00:39:02,069
to the sock and and fighting to mange

811
00:39:00,690 --> 00:39:03,630
the block and things like that and I

812
00:39:02,069 --> 00:39:04,920
would see so many worth compromised

813
00:39:03,630 --> 00:39:07,079
domains of course there were free ones

814
00:39:04,920 --> 00:39:10,500
like Rick's and dine dienes subdomains

815
00:39:07,079 --> 00:39:12,390
and that stuff but then my current work

816
00:39:10,500 --> 00:39:14,069
at Open DNS I do the same kind of thing

817
00:39:12,390 --> 00:39:15,629
I look a lot of I don't look at the

818
00:39:14,069 --> 00:39:17,339
phishing emails because we don't get

819
00:39:15,630 --> 00:39:19,920
reports of that but I look at

820
00:39:17,339 --> 00:39:23,339
compromised domains constantly and it's

821
00:39:19,920 --> 00:39:25,530
almost always I don't know a percentage

822
00:39:23,339 --> 00:39:27,150
but not ninety something percent people

823
00:39:25,530 --> 00:39:28,770
people's sites they didn't know they

824
00:39:27,150 --> 00:39:31,650
were compromised are blocked by us

825
00:39:28,770 --> 00:39:34,980
automatically or by an analyst or a

826
00:39:31,650 --> 00:39:35,970
security researcher and they don't they

827
00:39:34,980 --> 00:39:38,970
just don't have no idea they were

828
00:39:35,970 --> 00:39:42,149
compromised so it I figured there's got

829
00:39:38,970 --> 00:39:43,799
to be some way that people could protect

830
00:39:42,150 --> 00:39:46,470
or at least see when they're compromised

831
00:39:43,799 --> 00:39:50,490
and have some proof and have some way to

832
00:39:46,470 --> 00:39:51,480
tell who did it I I imagine most hosting

833
00:39:50,490 --> 00:39:54,930
providers aren't going to do this this

834
00:39:51,480 --> 00:39:57,089
is more of a service kind of offering if

835
00:39:54,930 --> 00:39:59,149
if someone wanted to do this and charge

836
00:39:57,089 --> 00:40:03,328
customers an extra fee they could be bad

837
00:39:59,150 --> 00:40:05,130
but as I said before the average website

838
00:40:03,329 --> 00:40:09,359
owner of selling widgets is not going to

839
00:40:05,130 --> 00:40:10,890
be interested in knowing this yeah but I

840
00:40:09,359 --> 00:40:13,069
feel like it has a lot of room for

841
00:40:10,890 --> 00:40:13,069
exploration

842
00:40:14,970 --> 00:40:31,509
what's that I don't know I don't have an

843
00:40:23,109 --> 00:40:35,430
answer yeah any other questions all

844
00:40:31,509 --> 00:40:35,430
right well thank you very much for

845
00:40:36,600 --> 00:40:41,469
[Applause]

