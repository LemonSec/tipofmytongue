1
00:00:00,080 --> 00:00:03,040
we have randy parkman here to give us a

2
00:00:03,040 --> 00:00:04,400
demonstration

3
00:00:04,400 --> 00:00:06,720
on making pizza from scratch and give a

4
00:00:06,720 --> 00:00:08,880
talk on hunting malware beacons it

5
00:00:08,880 --> 00:00:10,240
appears that

6
00:00:10,240 --> 00:00:13,120
in defiance of all the demo gods he's

7
00:00:13,120 --> 00:00:15,839
going to do this live

8
00:00:15,839 --> 00:00:19,039
absolutely thank you moonan um and good

9
00:00:19,039 --> 00:00:20,320
evening to everybody

10
00:00:20,320 --> 00:00:23,519
i have enjoyed this pancakes con

11
00:00:23,519 --> 00:00:25,920
so much there have been so many great

12
00:00:25,920 --> 00:00:27,359
videos and um

13
00:00:27,359 --> 00:00:29,119
it's so hard that it's two tracks i'm

14
00:00:29,119 --> 00:00:30,720
gonna have to go back and watch

15
00:00:30,720 --> 00:00:32,800
a lot of these on the replay so i'm so

16
00:00:32,800 --> 00:00:34,640
glad that they're recorded

17
00:00:34,640 --> 00:00:37,040
my name is randy parkman i work at

18
00:00:37,040 --> 00:00:38,160
binary defense

19
00:00:38,160 --> 00:00:39,440
in threat hunting and

20
00:00:39,440 --> 00:00:41,120
counterintelligence i've done that for

21
00:00:41,120 --> 00:00:42,640
about a year and a half

22
00:00:42,640 --> 00:00:45,280
and before that i worked at the fbi for

23
00:00:45,280 --> 00:00:46,480
15 years

24
00:00:46,480 --> 00:00:49,280
doing cyber crime investigations with a

25
00:00:49,280 --> 00:00:50,800
great team of people

26
00:00:50,800 --> 00:00:53,199
so if you have any questions about

27
00:00:53,199 --> 00:00:54,559
threat hunting in general

28
00:00:54,559 --> 00:00:56,719
or digital forensics incident response

29
00:00:56,719 --> 00:00:58,640
or how to work with law enforcement

30
00:00:58,640 --> 00:01:00,000
i'd love to talk to you about that

31
00:01:00,000 --> 00:01:02,160
that's one of the passions that

32
00:01:02,160 --> 00:01:05,199
i hold very dear um but another passion

33
00:01:05,199 --> 00:01:06,640
is making pizza

34
00:01:06,640 --> 00:01:10,000
so i wanted to do something that would

35
00:01:10,000 --> 00:01:10,960
be kind of fun

36
00:01:10,960 --> 00:01:13,520
and also a little bit different and i

37
00:01:13,520 --> 00:01:15,680
put a poll out on twitter yesterday

38
00:01:15,680 --> 00:01:18,000
and asked if we should you know kind of

39
00:01:18,000 --> 00:01:19,920
play it safe and do some powerpoint

40
00:01:19,920 --> 00:01:20,880
slides or

41
00:01:20,880 --> 00:01:24,400
do everything live including

42
00:01:24,400 --> 00:01:27,040
doing live things on azure sentinel um

43
00:01:27,040 --> 00:01:28,720
while we're baking a pizza and

44
00:01:28,720 --> 00:01:31,600
you know the votes for live definitely

45
00:01:31,600 --> 00:01:32,720
were overwhelming

46
00:01:32,720 --> 00:01:34,320
so that's the way that we're going to do

47
00:01:34,320 --> 00:01:36,479
it um i want to give you a little bit of

48
00:01:36,479 --> 00:01:38,320
my background just so that you know

49
00:01:38,320 --> 00:01:40,320
um you know kind of where i've come from

50
00:01:40,320 --> 00:01:41,360
and hopefully

51
00:01:41,360 --> 00:01:43,759
this will be encouraging to people who

52
00:01:43,759 --> 00:01:45,680
are getting started out as well

53
00:01:45,680 --> 00:01:48,000
um when i was very young i got my start

54
00:01:48,000 --> 00:01:49,759
in programming with my grandmother i

55
00:01:49,759 --> 00:01:52,000
have a super cool grandma

56
00:01:52,000 --> 00:01:55,439
who taught me atari 2600 basic

57
00:01:55,439 --> 00:01:56,560
programming

58
00:01:56,560 --> 00:01:59,840
from magazines that came with the basic

59
00:01:59,840 --> 00:02:00,640
code and

60
00:02:00,640 --> 00:02:03,119
we typed them in one line at a time and

61
00:02:03,119 --> 00:02:04,640
see how it works

62
00:02:04,640 --> 00:02:06,719
i'm also very fortunate to have had a

63
00:02:06,719 --> 00:02:08,239
mom who homeschooled me

64
00:02:08,239 --> 00:02:11,200
and got to learn by doing and sometimes

65
00:02:11,200 --> 00:02:12,720
mess up our family computer

66
00:02:12,720 --> 00:02:16,879
but i think you learn so much more

67
00:02:16,879 --> 00:02:18,879
from making mistakes and then fixing

68
00:02:18,879 --> 00:02:20,239
them than anything else

69
00:02:20,239 --> 00:02:22,800
so that's how i want to approach this

70
00:02:22,800 --> 00:02:24,480
presentation as well i'm going to show

71
00:02:24,480 --> 00:02:25,120
you

72
00:02:25,120 --> 00:02:27,680
uh live as we're kind of figuring out um

73
00:02:27,680 --> 00:02:29,440
how to do these threat hunting queries

74
00:02:29,440 --> 00:02:30,959
i'm going to assume you know nothing

75
00:02:30,959 --> 00:02:33,040
about sysmon or sentinel and just sort

76
00:02:33,040 --> 00:02:34,560
of introduce those

77
00:02:34,560 --> 00:02:36,959
um and the other thing that we're going

78
00:02:36,959 --> 00:02:38,480
to do to just make it a little bit more

79
00:02:38,480 --> 00:02:39,599
interesting

80
00:02:39,599 --> 00:02:42,399
i have here

81
00:02:42,959 --> 00:02:46,000
a pizza that i've assembled and

82
00:02:46,000 --> 00:02:49,519
as i'm starting the threat hunting part

83
00:02:49,519 --> 00:02:51,680
i'm going to put this pizza into the

84
00:02:51,680 --> 00:02:52,800
oven behind me

85
00:02:52,800 --> 00:02:54,879
and then what i'd like you to do on the

86
00:02:54,879 --> 00:02:56,480
track to chat

87
00:02:56,480 --> 00:02:59,360
is let us know when you think the pizza

88
00:02:59,360 --> 00:03:00,400
is ready

89
00:03:00,400 --> 00:03:02,000
when we should check on the pizza i'm

90
00:03:02,000 --> 00:03:03,920
going to kind of be watching it here

91
00:03:03,920 --> 00:03:04,879
over my shoulder

92
00:03:04,879 --> 00:03:08,480
and hopefully not smell it burning and

93
00:03:08,480 --> 00:03:10,959
moon if you don't mind let me know if

94
00:03:10,959 --> 00:03:11,519
pizza

95
00:03:11,519 --> 00:03:13,840
people are saying it's pizza time when

96
00:03:13,840 --> 00:03:15,200
the pizza comes out

97
00:03:15,200 --> 00:03:16,800
that's my cue we're going to switch

98
00:03:16,800 --> 00:03:18,319
topics and go

99
00:03:18,319 --> 00:03:20,959
from threat hunting to how do you

100
00:03:20,959 --> 00:03:22,800
actually make pizza

101
00:03:22,800 --> 00:03:24,640
hopefully ending soon enough that we can

102
00:03:24,640 --> 00:03:26,400
take a lot of questions but if not i'll

103
00:03:26,400 --> 00:03:27,680
go back to threat hunting because

104
00:03:27,680 --> 00:03:28,560
there's a lot

105
00:03:28,560 --> 00:03:30,879
to talk about there so let's get this

106
00:03:30,879 --> 00:03:33,760
got it

107
00:03:33,760 --> 00:03:36,000
i i have to say this is the most guts

108
00:03:36,000 --> 00:03:38,080
i've seen from any presenter to not only

109
00:03:38,080 --> 00:03:40,080
have a a live pizza demo

110
00:03:40,080 --> 00:03:42,560
but uh to have the audience dictate its

111
00:03:42,560 --> 00:03:44,000
face

112
00:03:44,000 --> 00:03:48,000
this will be fantastic there we go and

113
00:03:48,000 --> 00:03:49,760
all right hopefully you can see that

114
00:03:49,760 --> 00:03:53,200
baking and now i'm gonna share my screen

115
00:03:53,200 --> 00:03:55,519
and uh you know because it's always fun

116
00:03:55,519 --> 00:03:57,280
to just share the whole desktop that's

117
00:03:57,280 --> 00:03:59,360
what we're gonna do too

118
00:03:59,360 --> 00:04:01,840
tempting all of the demo gods all right

119
00:04:01,840 --> 00:04:02,640
so there's the

120
00:04:02,640 --> 00:04:04,879
poll definitely almost 80 percent said

121
00:04:04,879 --> 00:04:07,280
live that's why we're doing it this way

122
00:04:07,280 --> 00:04:10,560
so let me introduce first um cismond

123
00:04:10,560 --> 00:04:12,560
and sentinel if you don't know anything

124
00:04:12,560 --> 00:04:14,640
about it sysmon

125
00:04:14,640 --> 00:04:17,199
records all of the things that are

126
00:04:17,199 --> 00:04:18,880
interesting happening on a windows

127
00:04:18,880 --> 00:04:19,440
machine

128
00:04:19,440 --> 00:04:21,120
and soon there will be a linux version

129
00:04:21,120 --> 00:04:23,919
as well sysmon is free software from

130
00:04:23,919 --> 00:04:24,880
microsoft

131
00:04:24,880 --> 00:04:27,280
it's not supported which means if it

132
00:04:27,280 --> 00:04:28,639
blue screens your computer

133
00:04:28,639 --> 00:04:31,520
don't play microsoft um it also takes a

134
00:04:31,520 --> 00:04:32,080
little bit

135
00:04:32,080 --> 00:04:35,280
of work to do some config but

136
00:04:35,280 --> 00:04:38,240
there are some really great websites

137
00:04:38,240 --> 00:04:38,800
like

138
00:04:38,800 --> 00:04:41,440
olaf hartong's modular sysmon config

139
00:04:41,440 --> 00:04:42,000
that will help

140
00:04:42,000 --> 00:04:44,320
you get started but suffice it to say

141
00:04:44,320 --> 00:04:45,759
that sisman is like

142
00:04:45,759 --> 00:04:48,000
the black box flight recorder on an

143
00:04:48,000 --> 00:04:49,680
airplane it records all the things that

144
00:04:49,680 --> 00:04:50,960
you might need to go back

145
00:04:50,960 --> 00:04:53,360
and investigate if something goes wrong

146
00:04:53,360 --> 00:04:55,600
so that's what we're going to use

147
00:04:55,600 --> 00:04:58,160
azure sentinel is not free it's also

148
00:04:58,160 --> 00:04:59,840
from microsoft

149
00:04:59,840 --> 00:05:02,240
but something that a lot of people don't

150
00:05:02,240 --> 00:05:02,880
know

151
00:05:02,880 --> 00:05:05,759
is that it's very inexpensive for a home

152
00:05:05,759 --> 00:05:06,560
lab so

153
00:05:06,560 --> 00:05:07,840
if you're watching the earlier talk

154
00:05:07,840 --> 00:05:09,520
about putting together your own your own

155
00:05:09,520 --> 00:05:11,600
home lab sentinel is a great affordable

156
00:05:11,600 --> 00:05:12,560
way to go

157
00:05:12,560 --> 00:05:15,600
you can put a lot of um

158
00:05:15,600 --> 00:05:18,400
logs in and like uh with a small home

159
00:05:18,400 --> 00:05:20,240
lab i'm paying less than five dollars a

160
00:05:20,240 --> 00:05:22,080
month for all the log processing

161
00:05:22,080 --> 00:05:23,440
and then if you're not sending logs to

162
00:05:23,440 --> 00:05:25,120
it you don't pay anything at all

163
00:05:25,120 --> 00:05:26,720
even though you can still query your

164
00:05:26,720 --> 00:05:29,120
logs so let's get started and just see

165
00:05:29,120 --> 00:05:30,560
kind of what we have so i'm just going

166
00:05:30,560 --> 00:05:31,280
to type in

167
00:05:31,280 --> 00:05:34,639
sysmon and i have a custom function here

168
00:05:34,639 --> 00:05:37,120
it'll prompt me for a where clause to

169
00:05:37,120 --> 00:05:38,880
filter this but let's just start with

170
00:05:38,880 --> 00:05:39,600
looking for

171
00:05:39,600 --> 00:05:42,560
all of the sysmon blogs in the last 24

172
00:05:42,560 --> 00:05:44,400
hours and see what comes up

173
00:05:44,400 --> 00:05:46,160
this is a great way to get started if

174
00:05:46,160 --> 00:05:47,680
you don't know

175
00:05:47,680 --> 00:05:49,600
what logs you have available you can

176
00:05:49,600 --> 00:05:50,960
also go over here

177
00:05:50,960 --> 00:05:53,759
and see there's a lot of custom logs

178
00:05:53,759 --> 00:05:54,479
that i've got

179
00:05:54,479 --> 00:05:56,800
put in here i'm going to collapse this

180
00:05:56,800 --> 00:05:58,240
just we've got some more screen real

181
00:05:58,240 --> 00:05:58,880
estate

182
00:05:58,880 --> 00:06:00,400
you can see there's a whole bunch of

183
00:06:00,400 --> 00:06:03,120
things like process create this is

184
00:06:03,120 --> 00:06:04,880
obviously something that is important

185
00:06:04,880 --> 00:06:06,000
that happens on a computer

186
00:06:06,000 --> 00:06:08,080
when a program starts up and then

187
00:06:08,080 --> 00:06:09,039
there's

188
00:06:09,039 --> 00:06:12,800
process terminated events event id2 is

189
00:06:12,800 --> 00:06:14,960
file time creation changed

190
00:06:14,960 --> 00:06:17,759
but let's summarize this really quickly

191
00:06:17,759 --> 00:06:18,880
just so that we can see

192
00:06:18,880 --> 00:06:20,479
what sort of data we've got the

193
00:06:20,479 --> 00:06:23,120
summarize operator is really important

194
00:06:23,120 --> 00:06:26,080
in kql because it goes from having you

195
00:06:26,080 --> 00:06:27,520
know we've got over 30

196
00:06:27,520 --> 00:06:30,319
000 results here it's capped our results

197
00:06:30,319 --> 00:06:32,000
to just looking at the things that we

198
00:06:32,000 --> 00:06:32,880
want to look at

199
00:06:32,880 --> 00:06:35,840
all summed up so let's do summarize

200
00:06:35,840 --> 00:06:36,639
count

201
00:06:36,639 --> 00:06:39,840
so we'll get the number of events by

202
00:06:39,840 --> 00:06:43,840
event id and also render description

203
00:06:43,840 --> 00:06:45,199
because if you don't know what all the

204
00:06:45,199 --> 00:06:48,639
event ids mean it's kind of nice to see

205
00:06:48,639 --> 00:06:51,120
what they're described as so then let's

206
00:06:51,120 --> 00:06:52,960
let's just click here to sort it by the

207
00:06:52,960 --> 00:06:53,280
count

208
00:06:53,280 --> 00:06:54,560
and see which things are the most

209
00:06:54,560 --> 00:06:56,960
popular and we can see that registry

210
00:06:56,960 --> 00:06:58,479
object added or deleted

211
00:06:58,479 --> 00:07:01,599
registry activity happens an awful lot

212
00:07:01,599 --> 00:07:04,000
image load is like a dll registry value

213
00:07:04,000 --> 00:07:06,240
set is also very popular

214
00:07:06,240 --> 00:07:08,160
and then network connection detected

215
00:07:08,160 --> 00:07:09,919
this is what we're going to focus on

216
00:07:09,919 --> 00:07:11,520
we want to look at every single time

217
00:07:11,520 --> 00:07:13,039
there's been a network connection

218
00:07:13,039 --> 00:07:14,720
now i told you this is a small lab

219
00:07:14,720 --> 00:07:16,319
there's just a handful of computers in

220
00:07:16,319 --> 00:07:18,080
it and it's the weekend so not much is

221
00:07:18,080 --> 00:07:18,800
happening

222
00:07:18,800 --> 00:07:21,759
and still we have over 9 000 events in

223
00:07:21,759 --> 00:07:23,280
the last 24 hours

224
00:07:23,280 --> 00:07:26,160
so obviously we're going to need to do

225
00:07:26,160 --> 00:07:28,000
something if we're going to find

226
00:07:28,000 --> 00:07:29,919
interesting network connections and in

227
00:07:29,919 --> 00:07:31,360
this case what we're going to be looking

228
00:07:31,360 --> 00:07:32,080
for

229
00:07:32,080 --> 00:07:33,759
are network connections that are

230
00:07:33,759 --> 00:07:35,759
regularly repeating like a malware

231
00:07:35,759 --> 00:07:38,080
beacon calling out back to its home

232
00:07:38,080 --> 00:07:40,639
so let's select just the network traffic

233
00:07:40,639 --> 00:07:41,199
now

234
00:07:41,199 --> 00:07:44,160
i'm going to do where event id is equal

235
00:07:44,160 --> 00:07:44,560
to

236
00:07:44,560 --> 00:07:49,280
3 34 3 there we go

237
00:07:49,280 --> 00:07:52,639
and then we should see just network

238
00:07:52,639 --> 00:07:54,800
connections all right now if i expand

239
00:07:54,800 --> 00:07:56,479
one of these things

240
00:07:56,479 --> 00:07:59,039
i will see some details here like i've

241
00:07:59,039 --> 00:08:00,319
got the process id

242
00:08:00,319 --> 00:08:02,800
i've got the process path that might be

243
00:08:02,800 --> 00:08:04,000
interesting

244
00:08:04,000 --> 00:08:06,160
the source ip address and the

245
00:08:06,160 --> 00:08:08,479
destination ip address and then this

246
00:08:08,479 --> 00:08:10,319
host name is a little bit misleading

247
00:08:10,319 --> 00:08:12,240
because it's not a dns host name

248
00:08:12,240 --> 00:08:14,319
it's actually a reverse dns lookup of

249
00:08:14,319 --> 00:08:15,759
that ip

250
00:08:15,759 --> 00:08:17,199
so the next thing that i want to do is i

251
00:08:17,199 --> 00:08:19,440
want to sort of summarize these

252
00:08:19,440 --> 00:08:22,720
somehow right um let's start out by just

253
00:08:22,720 --> 00:08:24,400
projecting the things

254
00:08:24,400 --> 00:08:27,440
that we want so project we'll just take

255
00:08:27,440 --> 00:08:28,879
some of these columns

256
00:08:28,879 --> 00:08:31,919
let's project the computer because that

257
00:08:31,919 --> 00:08:33,760
would be important

258
00:08:33,760 --> 00:08:38,159
the destination ip address

259
00:08:38,159 --> 00:08:41,120
that would be good oh and let's do the

260
00:08:41,120 --> 00:08:43,120
process path too because we want to see

261
00:08:43,120 --> 00:08:43,519
what

262
00:08:43,519 --> 00:08:46,720
process is uh responsible for each one

263
00:08:46,720 --> 00:08:49,040
of these connections right

264
00:08:49,040 --> 00:08:50,720
all right and then how about the

265
00:08:50,720 --> 00:08:54,160
destination port that makes sense too

266
00:08:54,160 --> 00:08:57,279
okay so if we do that um

267
00:08:57,279 --> 00:08:59,600
now we'll see a nice some uh

268
00:08:59,600 --> 00:09:02,160
summarization here where we can see

269
00:09:02,160 --> 00:09:04,640
um when oh you know what i didn't get

270
00:09:04,640 --> 00:09:05,440
the time

271
00:09:05,440 --> 00:09:07,440
created too that would be nice if we can

272
00:09:07,440 --> 00:09:08,800
see what time that was

273
00:09:08,800 --> 00:09:12,320
so let's do time generated

274
00:09:12,320 --> 00:09:15,519
time generated and now

275
00:09:15,519 --> 00:09:16,959
that will make a little bit more sense

276
00:09:16,959 --> 00:09:18,560
all right so already we're getting

277
00:09:18,560 --> 00:09:20,959
a feeling for something that we might

278
00:09:20,959 --> 00:09:22,320
want to investigate

279
00:09:22,320 --> 00:09:24,959
you can see that run dll is running very

280
00:09:24,959 --> 00:09:26,560
often so this was at

281
00:09:26,560 --> 00:09:30,480
1034 utc this is a 1035 1036

282
00:09:30,480 --> 00:09:32,080
these are very frequent connections

283
00:09:32,080 --> 00:09:34,080
right and they're all going out to the

284
00:09:34,080 --> 00:09:36,880
same ip address on port 80.

285
00:09:36,880 --> 00:09:38,640
so hopefully you're already seeing if

286
00:09:38,640 --> 00:09:40,240
you were doing a real threat hunt you

287
00:09:40,240 --> 00:09:41,120
would already

288
00:09:41,120 --> 00:09:44,000
want to start investigating these ip

289
00:09:44,000 --> 00:09:45,680
addresses and here's another one here's

290
00:09:45,680 --> 00:09:47,360
another run dll

291
00:09:47,360 --> 00:09:49,440
32 and it's reaching out to this other

292
00:09:49,440 --> 00:09:50,880
ip address

293
00:09:50,880 --> 00:09:53,360
um but let's say that what we really

294
00:09:53,360 --> 00:09:54,320
want to do

295
00:09:54,320 --> 00:09:56,800
is um if we're in a real live

296
00:09:56,800 --> 00:09:58,080
environment we're going to have a lot of

297
00:09:58,080 --> 00:09:59,440
these to go through we still want to

298
00:09:59,440 --> 00:10:00,800
summarize these

299
00:10:00,800 --> 00:10:04,240
a little bit right so um what i'd like

300
00:10:04,240 --> 00:10:05,680
to do now

301
00:10:05,680 --> 00:10:09,200
is i'm going to summarize

302
00:10:09,200 --> 00:10:12,399
and let's do um just

303
00:10:12,399 --> 00:10:16,079
the count first um

304
00:10:16,079 --> 00:10:20,480
by let's say the computer

305
00:10:20,480 --> 00:10:24,720
the process path the destination

306
00:10:24,720 --> 00:10:27,279
ip

307
00:10:28,240 --> 00:10:31,920
and destination port and you can see

308
00:10:31,920 --> 00:10:33,680
intellisense helps out a whole lot this

309
00:10:33,680 --> 00:10:34,880
is one of the things i like about

310
00:10:34,880 --> 00:10:36,320
sentinel you don't have to type

311
00:10:36,320 --> 00:10:37,600
everything

312
00:10:37,600 --> 00:10:39,680
okay so this is interesting now we went

313
00:10:39,680 --> 00:10:40,800
from 9000

314
00:10:40,800 --> 00:10:44,000
down to just 92 unique items and we can

315
00:10:44,000 --> 00:10:44,640
see

316
00:10:44,640 --> 00:10:47,120
that there's some of these that are

317
00:10:47,120 --> 00:10:47,839
recurring

318
00:10:47,839 --> 00:10:50,000
very frequently right so let's sort it

319
00:10:50,000 --> 00:10:51,040
by count it was

320
00:10:51,040 --> 00:10:52,399
i think it was already kind of sorted

321
00:10:52,399 --> 00:10:53,839
that way but we can see at the top of

322
00:10:53,839 --> 00:10:56,000
the list here in the last 24 hours

323
00:10:56,000 --> 00:11:00,160
or 8 457 um

324
00:11:00,160 --> 00:11:03,200
events network events going to this ip

325
00:11:03,200 --> 00:11:05,120
address from this run dll

326
00:11:05,120 --> 00:11:08,160
and then slightly less to this ip

327
00:11:08,160 --> 00:11:09,040
address

328
00:11:09,040 --> 00:11:11,760
and then of course we see teams pops up

329
00:11:11,760 --> 00:11:13,120
an awful lot

330
00:11:13,120 --> 00:11:15,519
right and then we've got another kind of

331
00:11:15,519 --> 00:11:16,880
suspicious

332
00:11:16,880 --> 00:11:19,920
looking thing here too but not

333
00:11:19,920 --> 00:11:23,440
nearly as many connections so what if we

334
00:11:23,440 --> 00:11:26,800
want to see the timing between

335
00:11:26,800 --> 00:11:29,200
those connections the first thing that

336
00:11:29,200 --> 00:11:30,800
we'll want to do

337
00:11:30,800 --> 00:11:34,079
is we want to sort by

338
00:11:34,079 --> 00:11:36,720
so that we get everything together that

339
00:11:36,720 --> 00:11:39,120
has to do with the same

340
00:11:39,120 --> 00:11:43,360
computer i process and destination ip

341
00:11:43,360 --> 00:11:46,000
so let's do sort by the first thing we

342
00:11:46,000 --> 00:11:47,600
want to do is computer

343
00:11:47,600 --> 00:11:50,720
the next thing is destination ip if

344
00:11:50,720 --> 00:11:52,639
you've ever done a multi-column sort in

345
00:11:52,639 --> 00:11:53,360
excel

346
00:11:53,360 --> 00:11:54,959
you kind of understand what i'm doing

347
00:11:54,959 --> 00:11:56,639
here so i'm putting together

348
00:11:56,639 --> 00:11:58,800
all of the connections that are from

349
00:11:58,800 --> 00:11:59,680
each computer

350
00:11:59,680 --> 00:12:02,880
to the same ip and then

351
00:12:02,880 --> 00:12:05,920
time generated

352
00:12:06,160 --> 00:12:10,079
let's see

353
00:12:10,079 --> 00:12:13,120
and we'll do it in ascending order oh i

354
00:12:13,120 --> 00:12:13,760
see

355
00:12:13,760 --> 00:12:18,320
um i need to

356
00:12:18,320 --> 00:12:21,440
get rid of this summarize now because i

357
00:12:21,440 --> 00:12:23,600
don't need that i'm going to

358
00:12:23,600 --> 00:12:26,959
order this way all right now i've got

359
00:12:26,959 --> 00:12:28,320
things ordered

360
00:12:28,320 --> 00:12:31,279
now i want to do a special kql function

361
00:12:31,279 --> 00:12:33,600
called serialize serialize tells it that

362
00:12:33,600 --> 00:12:35,360
i want to be able to do some

363
00:12:35,360 --> 00:12:38,639
computation between each field and the

364
00:12:38,639 --> 00:12:41,040
next one in serial order if that makes

365
00:12:41,040 --> 00:12:41,839
sense

366
00:12:41,839 --> 00:12:44,240
now um we've already found something

367
00:12:44,240 --> 00:12:45,920
really interesting just with that simple

368
00:12:45,920 --> 00:12:47,680
query so if the rest of this gets

369
00:12:47,680 --> 00:12:49,360
complex and you're like wow i don't even

370
00:12:49,360 --> 00:12:51,200
know what he's doing at this point

371
00:12:51,200 --> 00:12:54,079
you've already got some useful skills in

372
00:12:54,079 --> 00:12:55,279
kql right

373
00:12:55,279 --> 00:12:56,800
but let's take this a little bit further

374
00:12:56,800 --> 00:12:58,800
and let's do some statistical

375
00:12:58,800 --> 00:13:00,079
computations

376
00:13:00,079 --> 00:13:03,279
that sentinel lets us do so let's do

377
00:13:03,279 --> 00:13:05,440
the extend function this is going to

378
00:13:05,440 --> 00:13:06,959
create a new column

379
00:13:06,959 --> 00:13:10,800
so first let's extend the

380
00:13:10,800 --> 00:13:16,720
next time and that's going to be

381
00:13:16,720 --> 00:13:20,000
the time

382
00:13:20,000 --> 00:13:23,680
def let's see

383
00:13:23,680 --> 00:13:26,079
time

384
00:13:27,680 --> 00:13:31,040
or maybe it's diff time date time diff

385
00:13:31,040 --> 00:13:32,800
there we go i'm glad that intellisense

386
00:13:32,800 --> 00:13:33,760
helped me there

387
00:13:33,760 --> 00:13:38,160
we want to compute by seconds

388
00:13:38,160 --> 00:13:42,800
uh between the uh

389
00:13:42,800 --> 00:13:46,240
wait a minute here next time

390
00:13:46,240 --> 00:13:47,519
i was getting a little bit ahead of

391
00:13:47,519 --> 00:13:50,320
myself next time is just next

392
00:13:50,320 --> 00:13:53,199
time generated there we go and now we'll

393
00:13:53,199 --> 00:13:53,760
do

394
00:13:53,760 --> 00:13:57,040
extend um

395
00:13:57,120 --> 00:14:01,440
time diff extend i'm gonna call it delta

396
00:14:01,440 --> 00:14:02,399
time

397
00:14:02,399 --> 00:14:05,120
the change in time is equal to date time

398
00:14:05,120 --> 00:14:05,680
def

399
00:14:05,680 --> 00:14:08,720
seconds between the next

400
00:14:08,720 --> 00:14:12,240
time and the time generated okay so now

401
00:14:12,240 --> 00:14:14,000
we've computed

402
00:14:14,000 --> 00:14:17,279
um seconds or second there we go second

403
00:14:17,279 --> 00:14:20,000
is the right word uh we've computed the

404
00:14:20,000 --> 00:14:22,399
time

405
00:14:22,399 --> 00:14:25,600
um oh i forgot a closing paren

406
00:14:25,600 --> 00:14:27,440
there we go we're computing the

407
00:14:27,440 --> 00:14:29,279
difference in time

408
00:14:29,279 --> 00:14:31,600
between each one of these connections

409
00:14:31,600 --> 00:14:33,199
and the next one

410
00:14:33,199 --> 00:14:36,160
right okay that sort of makes sense some

411
00:14:36,160 --> 00:14:37,680
of these are really weird numbers

412
00:14:37,680 --> 00:14:39,040
they're negative numbers and that's

413
00:14:39,040 --> 00:14:39,760
because

414
00:14:39,760 --> 00:14:42,399
we've got a difference between one

415
00:14:42,399 --> 00:14:44,000
destination ip and the next

416
00:14:44,000 --> 00:14:47,519
one so we also want to extend

417
00:14:47,519 --> 00:14:53,199
the next computer is equal to

418
00:14:53,839 --> 00:14:58,959
next computer there we go

419
00:14:58,959 --> 00:15:02,560
and then let's do uh next

420
00:15:02,560 --> 00:15:05,680
destination ip is equal to

421
00:15:05,680 --> 00:15:08,880
next uh deskt ip

422
00:15:08,880 --> 00:15:12,480
whoops i p not work there we go okay

423
00:15:12,480 --> 00:15:16,959
so now we're going to have a record of

424
00:15:16,959 --> 00:15:18,959
uh what was the next computer and the

425
00:15:18,959 --> 00:15:21,040
next destination ip

426
00:15:21,040 --> 00:15:23,279
and we can filter that so that we don't

427
00:15:23,279 --> 00:15:25,440
get the really strange results we're

428
00:15:25,440 --> 00:15:26,399
computing

429
00:15:26,399 --> 00:15:28,399
a difference in time across things that

430
00:15:28,399 --> 00:15:30,240
don't make any sense right

431
00:15:30,240 --> 00:15:33,120
so i'm going to say another where clause

432
00:15:33,120 --> 00:15:34,320
where

433
00:15:34,320 --> 00:15:37,519
next computer is equal to

434
00:15:37,519 --> 00:15:40,800
this computer and

435
00:15:40,800 --> 00:15:44,079
um and next

436
00:15:44,079 --> 00:15:48,079
destination ip is equal to

437
00:15:48,079 --> 00:15:51,199
this destination ip

438
00:15:51,199 --> 00:15:54,560
okay so if this works then we should

439
00:15:54,560 --> 00:15:55,519
have the

440
00:15:55,519 --> 00:15:59,360
uh time delta there we go the delta time

441
00:15:59,360 --> 00:16:01,120
and they're always positive numbers

442
00:16:01,120 --> 00:16:02,880
these always make sense

443
00:16:02,880 --> 00:16:05,360
okay we're getting somewhere but still

444
00:16:05,360 --> 00:16:08,000
we've got these 9 000 records right

445
00:16:08,000 --> 00:16:11,759
so let's now do a summary

446
00:16:11,759 --> 00:16:15,279
so i'm going to summarize um first

447
00:16:15,279 --> 00:16:20,560
let's do make list

448
00:16:21,440 --> 00:16:24,720
uh the last of

449
00:16:24,720 --> 00:16:28,000
delta time and i want to

450
00:16:28,000 --> 00:16:31,040
call that um how about just the

451
00:16:31,040 --> 00:16:34,240
uh delta time list that makes sense to

452
00:16:34,240 --> 00:16:35,199
me let's call it

453
00:16:35,199 --> 00:16:38,880
delta time list

454
00:16:38,880 --> 00:16:42,800
whoops list is equal to make list

455
00:16:42,800 --> 00:16:46,240
s time and then

456
00:16:46,240 --> 00:16:49,440
buy and i need to tell it how i want to

457
00:16:49,440 --> 00:16:50,000
summarize

458
00:16:50,000 --> 00:16:52,320
this up so i want to do it by again

459
00:16:52,320 --> 00:16:53,759
computer

460
00:16:53,759 --> 00:16:57,040
process panel and destination ip

461
00:16:57,040 --> 00:16:58,880
all right so let's look at that and see

462
00:16:58,880 --> 00:17:00,560
what we've got

463
00:17:00,560 --> 00:17:04,240
now we've got for each one of these

464
00:17:04,240 --> 00:17:06,480
processes that is talking to a

465
00:17:06,480 --> 00:17:08,160
destination ip

466
00:17:08,160 --> 00:17:11,280
all of the the list of delta times

467
00:17:11,280 --> 00:17:12,480
between their connections

468
00:17:12,480 --> 00:17:14,559
hopefully this is starting to look

469
00:17:14,559 --> 00:17:15,679
useful to you

470
00:17:15,679 --> 00:17:18,559
so some of these all right yes the

471
00:17:18,559 --> 00:17:20,079
appearance that the chat is of the

472
00:17:20,079 --> 00:17:22,240
opinion the pizza may be done

473
00:17:22,240 --> 00:17:24,480
oh thank you i was hoping that you'd be

474
00:17:24,480 --> 00:17:25,760
watching that all right

475
00:17:25,760 --> 00:17:29,760
so let's take a look oh my goodness

476
00:17:29,760 --> 00:17:32,320
as pizza chefs are fired i'm sorry this

477
00:17:32,320 --> 00:17:32,799
is an

478
00:17:32,799 --> 00:17:35,679
overdone pizza look at this i am still

479
00:17:35,679 --> 00:17:37,120
going to eat this pizza

480
00:17:37,120 --> 00:17:40,559
for sure but

481
00:17:40,799 --> 00:17:43,919
this is uh this is very brown i think it

482
00:17:43,919 --> 00:17:44,720
will be

483
00:17:44,720 --> 00:17:46,960
okay and my wife is on the side laughing

484
00:17:46,960 --> 00:17:48,720
because this is pretty funny but

485
00:17:48,720 --> 00:17:50,559
that is exactly the kind of thing that

486
00:17:50,559 --> 00:17:51,840
you can expect

487
00:17:51,840 --> 00:17:55,520
when you do a live demo of baking pizza

488
00:17:55,520 --> 00:17:58,320
right so what we're going to do now as

489
00:17:58,320 --> 00:17:59,520
promised is switch

490
00:17:59,520 --> 00:18:02,480
to the topic of how to create the pizza

491
00:18:02,480 --> 00:18:03,200
and

492
00:18:03,200 --> 00:18:04,880
especially when you burn your pizza you

493
00:18:04,880 --> 00:18:06,320
might want another one

494
00:18:06,320 --> 00:18:09,520
so um we'll get right to that and then

495
00:18:09,520 --> 00:18:12,720
um as we take questions i'll see if

496
00:18:12,720 --> 00:18:14,480
there's more interest of a pizza topic

497
00:18:14,480 --> 00:18:16,160
or more interest in the threat hunting

498
00:18:16,160 --> 00:18:17,679
and we'll get to the one that

499
00:18:17,679 --> 00:18:20,559
makes the most sense okay can you see my

500
00:18:20,559 --> 00:18:21,200
screen

501
00:18:21,200 --> 00:18:24,720
uh my video here yeah it appears to be a

502
00:18:24,720 --> 00:18:25,840
measuring cup

503
00:18:25,840 --> 00:18:27,760
excellent all right so i'm going to play

504
00:18:27,760 --> 00:18:28,960
the video and

505
00:18:28,960 --> 00:18:30,880
talk through how to make the pizza but

506
00:18:30,880 --> 00:18:32,799
first i want to introduce this topic

507
00:18:32,799 --> 00:18:35,600
by saying i've seen many many pizza

508
00:18:35,600 --> 00:18:37,679
making videos that were about how to

509
00:18:37,679 --> 00:18:39,120
make the perfect pizza

510
00:18:39,120 --> 00:18:41,120
right and of course that makes sense you

511
00:18:41,120 --> 00:18:43,039
want to make the perfect pizza

512
00:18:43,039 --> 00:18:46,080
but what i prefer is rather than chasing

513
00:18:46,080 --> 00:18:47,919
after the perfect pizza that is too

514
00:18:47,919 --> 00:18:49,760
difficult and you don't attempt

515
00:18:49,760 --> 00:18:52,480
i'd much rather make the pizza that you

516
00:18:52,480 --> 00:18:54,320
have time for that's simple enough that

517
00:18:54,320 --> 00:18:56,480
you actually do um

518
00:18:56,480 --> 00:18:59,520
over the course of the last 20 years or

519
00:18:59,520 --> 00:19:00,080
so

520
00:19:00,080 --> 00:19:02,720
i've calculated rough order of magnitude

521
00:19:02,720 --> 00:19:04,640
my wife and i have probably made over 2

522
00:19:04,640 --> 00:19:06,320
000 pizzas

523
00:19:06,320 --> 00:19:09,039
and each time we do it we try to make it

524
00:19:09,039 --> 00:19:10,000
a little bit simpler

525
00:19:10,000 --> 00:19:12,960
and we've come to this um actually we

526
00:19:12,960 --> 00:19:14,640
both make it a little bit differently

527
00:19:14,640 --> 00:19:16,480
from each other but both are just fine

528
00:19:16,480 --> 00:19:18,480
and we've come to the realization

529
00:19:18,480 --> 00:19:21,520
that um pizza is very forgiving it's

530
00:19:21,520 --> 00:19:24,799
really easy to make and you can actually

531
00:19:24,799 --> 00:19:26,559
mess it up a lot and still get a very

532
00:19:26,559 --> 00:19:28,240
good result so that's what i would like

533
00:19:28,240 --> 00:19:29,919
to share with you the encouragement

534
00:19:29,919 --> 00:19:31,919
that you can do this you can you can try

535
00:19:31,919 --> 00:19:33,600
it yourself even if you've never baked

536
00:19:33,600 --> 00:19:35,120
any bread before

537
00:19:35,120 --> 00:19:38,240
so start with some water um the rule of

538
00:19:38,240 --> 00:19:38,799
thumb

539
00:19:38,799 --> 00:19:40,799
is that you use about three quarters of

540
00:19:40,799 --> 00:19:42,000
a cup of water

541
00:19:42,000 --> 00:19:44,960
per pizza so i'm normally making two

542
00:19:44,960 --> 00:19:47,039
pizzas at a time to feed my family of

543
00:19:47,039 --> 00:19:47,600
four

544
00:19:47,600 --> 00:19:49,919
because we eat a lot of pizza and so i

545
00:19:49,919 --> 00:19:52,000
use about a cup and a half

546
00:19:52,000 --> 00:19:53,919
that should be the hottest water that

547
00:19:53,919 --> 00:19:56,320
you can get out of the tap not scalding

548
00:19:56,320 --> 00:19:58,799
that you could still uh put your finger

549
00:19:58,799 --> 00:20:00,160
in and it's okay

550
00:20:00,160 --> 00:20:03,760
um you also use about one teaspoon

551
00:20:03,760 --> 00:20:07,840
of yeast per crust that you want to make

552
00:20:07,840 --> 00:20:11,360
now if you have just a package of yeast

553
00:20:11,360 --> 00:20:13,200
and you're making two pizzas just open

554
00:20:13,200 --> 00:20:14,559
the packet throw it all

555
00:20:14,559 --> 00:20:16,799
in it doesn't matter a whole lot and i

556
00:20:16,799 --> 00:20:19,440
know real bakers will probably hate that

557
00:20:19,440 --> 00:20:21,360
i'm saying something like that but

558
00:20:21,360 --> 00:20:23,440
you know as long as the yeast hasn't

559
00:20:23,440 --> 00:20:24,960
gone bad it's fine

560
00:20:24,960 --> 00:20:27,120
now i'll tell you one good pizza

561
00:20:27,120 --> 00:20:28,799
debugging tip

562
00:20:28,799 --> 00:20:30,960
or troubleshooting tip if you find that

563
00:20:30,960 --> 00:20:32,799
you your dough doesn't rise at all

564
00:20:32,799 --> 00:20:35,280
it may have been that you put the yeast

565
00:20:35,280 --> 00:20:36,400
in too hot of water

566
00:20:36,400 --> 00:20:38,880
the water is like boiling hot you'll

567
00:20:38,880 --> 00:20:40,159
kill the yeast

568
00:20:40,159 --> 00:20:42,720
now here is a pizza hat i am putting in

569
00:20:42,720 --> 00:20:44,559
a teaspoon of brown sugar

570
00:20:44,559 --> 00:20:47,120
my wife never puts in brown sugar you

571
00:20:47,120 --> 00:20:48,400
don't taste it

572
00:20:48,400 --> 00:20:50,559
but i found that it makes the crust

573
00:20:50,559 --> 00:20:52,720
brown up a little bit nicer

574
00:20:52,720 --> 00:20:54,240
even if you don't have the oven

575
00:20:54,240 --> 00:20:56,559
parameters quite right so i put in

576
00:20:56,559 --> 00:20:59,440
a teaspoon of brown sugar now the trick

577
00:20:59,440 --> 00:21:00,320
is

578
00:21:00,320 --> 00:21:02,000
you don't really need to measure the

579
00:21:02,000 --> 00:21:04,000
flour um and that's a good thing

580
00:21:04,000 --> 00:21:06,159
because if i'm trying to measure flour

581
00:21:06,159 --> 00:21:08,159
adding it slowly a bit at a time

582
00:21:08,159 --> 00:21:11,039
i always forget where i'm at i always

583
00:21:11,039 --> 00:21:12,240
forget how many

584
00:21:12,240 --> 00:21:15,280
cups i've put in already and the the

585
00:21:15,280 --> 00:21:16,480
pizza gets ruined

586
00:21:16,480 --> 00:21:19,679
so um what i do is just add the flour

587
00:21:19,679 --> 00:21:22,320
a little bit at a time and then once

588
00:21:22,320 --> 00:21:23,440
i've got enough

589
00:21:23,440 --> 00:21:25,039
flour in there that it's kind of looking

590
00:21:25,039 --> 00:21:26,720
like this it's getting a little bit

591
00:21:26,720 --> 00:21:27,520
thick

592
00:21:27,520 --> 00:21:30,000
then i add the salt one teaspoon salt

593
00:21:30,000 --> 00:21:31,360
again i try and keep things really

594
00:21:31,360 --> 00:21:33,840
simple just a teaspoon for everything

595
00:21:33,840 --> 00:21:35,840
the teaspoon of salt goes in at this

596
00:21:35,840 --> 00:21:37,360
time also

597
00:21:37,360 --> 00:21:40,480
to preserve the yeast so if you if you

598
00:21:40,480 --> 00:21:41,360
put the salt in

599
00:21:41,360 --> 00:21:43,039
too soon if you just mix the salt

600
00:21:43,039 --> 00:21:44,400
directly with the yeast

601
00:21:44,400 --> 00:21:46,400
that can cause the yeast to die and then

602
00:21:46,400 --> 00:21:47,919
you won't get a good rise

603
00:21:47,919 --> 00:21:49,679
but as long as you put in at least a

604
00:21:49,679 --> 00:21:52,400
little bit of flour you can mix the

605
00:21:52,400 --> 00:21:54,640
salt in at that point and you have no

606
00:21:54,640 --> 00:21:55,600
trouble

607
00:21:55,600 --> 00:21:58,000
now i just keep adding a little bit of

608
00:21:58,000 --> 00:21:58,799
flour

609
00:21:58,799 --> 00:22:01,679
um little bits at a time until the dough

610
00:22:01,679 --> 00:22:04,240
gets to the right consistency

611
00:22:04,240 --> 00:22:05,840
that's the trick rather than measuring

612
00:22:05,840 --> 00:22:07,280
the flour out

613
00:22:07,280 --> 00:22:09,679
you just add it a little bit at a time

614
00:22:09,679 --> 00:22:10,480
now believe me

615
00:22:10,480 --> 00:22:12,720
i have made mistakes with this many

616
00:22:12,720 --> 00:22:13,919
times and just

617
00:22:13,919 --> 00:22:16,080
i got lazy or i was in a hurry and i

618
00:22:16,080 --> 00:22:17,679
dumped in a whole bunch at once and it

619
00:22:17,679 --> 00:22:19,200
just made a mess

620
00:22:19,200 --> 00:22:20,640
i also want to say you don't need a

621
00:22:20,640 --> 00:22:22,559
mixer to do this but it makes it a whole

622
00:22:22,559 --> 00:22:24,000
lot easier

623
00:22:24,000 --> 00:22:27,120
um so once the dough is looking about

624
00:22:27,120 --> 00:22:28,559
like that i want to show you another

625
00:22:28,559 --> 00:22:30,559
pizza hat this is definitely a hack and

626
00:22:30,559 --> 00:22:32,640
not something a real baker would do

627
00:22:32,640 --> 00:22:34,640
and i also want to be clear i'm not

628
00:22:34,640 --> 00:22:36,720
going to microwave this dough so don't

629
00:22:36,720 --> 00:22:40,480
don't be too aghast what i'm doing here

630
00:22:40,480 --> 00:22:43,919
is microwaving some water to get it hot

631
00:22:43,919 --> 00:22:46,880
and then i'm using the microwave as kind

632
00:22:46,880 --> 00:22:47,520
of a

633
00:22:47,520 --> 00:22:50,240
proofing chamber or rising chamber that

634
00:22:50,240 --> 00:22:50,799
water

635
00:22:50,799 --> 00:22:54,240
will keep the inside of it humid and

636
00:22:54,240 --> 00:22:57,360
warm and then i just put the dough

637
00:22:57,360 --> 00:22:59,600
into the microwave but again don't turn

638
00:22:59,600 --> 00:23:00,799
the microwave on this would be

639
00:23:00,799 --> 00:23:02,559
disastrous especially with the metal

640
00:23:02,559 --> 00:23:03,919
bowl

641
00:23:03,919 --> 00:23:05,600
and just leave it in there for a while

642
00:23:05,600 --> 00:23:07,760
until it's risen and it looks like this

643
00:23:07,760 --> 00:23:11,200
now if you have plenty of time then

644
00:23:11,200 --> 00:23:12,960
you don't need to use the microwave at

645
00:23:12,960 --> 00:23:14,880
all if you've got

646
00:23:14,880 --> 00:23:17,360
you know i usually four hours or so it's

647
00:23:17,360 --> 00:23:19,120
about the time that i give for normal

648
00:23:19,120 --> 00:23:20,960
rising at just room temperature

649
00:23:20,960 --> 00:23:24,320
my house is warm enough i will usually

650
00:23:24,320 --> 00:23:26,720
come out from my home office at around

651
00:23:26,720 --> 00:23:27,440
lunchtime

652
00:23:27,440 --> 00:23:29,840
eat my lunch make some dough it really

653
00:23:29,840 --> 00:23:31,840
doesn't take that long

654
00:23:31,840 --> 00:23:33,280
and i'll just leave it out to rise and

655
00:23:33,280 --> 00:23:35,120
by the time it's dinner time the dough

656
00:23:35,120 --> 00:23:36,000
has risen on its

657
00:23:36,000 --> 00:23:39,360
own but i often forget and

658
00:23:39,360 --> 00:23:41,120
i don't make the dough in time and

659
00:23:41,120 --> 00:23:43,039
sometimes we've been at the point where

660
00:23:43,039 --> 00:23:43,840
it's like

661
00:23:43,840 --> 00:23:46,159
an hour and a half till dinner you all

662
00:23:46,159 --> 00:23:47,600
want to have pizza and there's not

663
00:23:47,600 --> 00:23:49,200
enough time to let it rise and that's

664
00:23:49,200 --> 00:23:51,200
when i use that microwave

665
00:23:51,200 --> 00:23:55,440
water and quick rising hat and it works

666
00:23:55,440 --> 00:23:58,000
so once the dough looks about like that

667
00:23:58,000 --> 00:24:00,000
um then you can take it out

668
00:24:00,000 --> 00:24:03,279
and if you can sort of try to preserve

669
00:24:03,279 --> 00:24:05,440
some of the bubbles in the dough that

670
00:24:05,440 --> 00:24:07,440
helps the dough

671
00:24:07,440 --> 00:24:09,760
to rise but really however you do it is

672
00:24:09,760 --> 00:24:10,640
fine

673
00:24:10,640 --> 00:24:12,240
this is my nine-year-old daughter

674
00:24:12,240 --> 00:24:14,000
helping me with the demo because

675
00:24:14,000 --> 00:24:16,320
at this point i couldn't both hold the

676
00:24:16,320 --> 00:24:17,039
camera

677
00:24:17,039 --> 00:24:19,919
and do the dough so um she's trying to

678
00:24:19,919 --> 00:24:21,600
get out about half of the dough and

679
00:24:21,600 --> 00:24:23,840
doing a marvelous job of it

680
00:24:23,840 --> 00:24:26,400
um i really enjoy baking with my family

681
00:24:26,400 --> 00:24:28,480
too it's an awful lot of fun

682
00:24:28,480 --> 00:24:30,720
and then this is the part where it

683
00:24:30,720 --> 00:24:32,559
starts getting kind of scary if you've

684
00:24:32,559 --> 00:24:34,159
never done this before and it seems like

685
00:24:34,159 --> 00:24:36,080
you're going to mess it up

686
00:24:36,080 --> 00:24:38,240
it's going to work out just take a deep

687
00:24:38,240 --> 00:24:40,000
breath it will be fine

688
00:24:40,000 --> 00:24:43,360
um making pizza is a lot of fun and

689
00:24:43,360 --> 00:24:45,520
the thing that can help you relax is to

690
00:24:45,520 --> 00:24:47,520
know that when you're making it at home

691
00:24:47,520 --> 00:24:49,840
it doesn't matter if it's perfectly

692
00:24:49,840 --> 00:24:52,320
round it doesn't matter if it's smooth

693
00:24:52,320 --> 00:24:54,640
it doesn't matter if it looks perfect

694
00:24:54,640 --> 00:24:56,240
it's going to taste just fine

695
00:24:56,240 --> 00:24:57,760
unless you leave it in the oven too long

696
00:24:57,760 --> 00:25:00,159
and you burn it like i just did but

697
00:25:00,159 --> 00:25:01,679
otherwise it's going to be fine

698
00:25:01,679 --> 00:25:04,080
so we have a clean counter that we've

699
00:25:04,080 --> 00:25:05,600
scrubbed down really well

700
00:25:05,600 --> 00:25:08,000
and then we just add enough flour to

701
00:25:08,000 --> 00:25:09,520
this so that it's not

702
00:25:09,520 --> 00:25:12,080
too sticky and you can actually work it

703
00:25:12,080 --> 00:25:14,480
with your hands um

704
00:25:14,480 --> 00:25:17,279
you you could use a rolling pin and roll

705
00:25:17,279 --> 00:25:19,600
it out and that's not disastrous but

706
00:25:19,600 --> 00:25:21,039
the only thing that will happen if you

707
00:25:21,039 --> 00:25:22,880
use the rolling pin is you'll kind of

708
00:25:22,880 --> 00:25:23,440
remove

709
00:25:23,440 --> 00:25:26,000
some of the air bubbles that have built

710
00:25:26,000 --> 00:25:27,840
up as that dough was rising really

711
00:25:27,840 --> 00:25:28,640
nicely

712
00:25:28,640 --> 00:25:30,799
and so i mean your pizza will still

713
00:25:30,799 --> 00:25:32,559
taste fine it'll just be a little bit

714
00:25:32,559 --> 00:25:34,960
flatter it won't have those nice sort of

715
00:25:34,960 --> 00:25:37,200
risen bubbles in it if you want to get

716
00:25:37,200 --> 00:25:38,159
the most

717
00:25:38,159 --> 00:25:41,440
bubbles try to stretch it rather than

718
00:25:41,440 --> 00:25:42,960
roll it if that makes sense

719
00:25:42,960 --> 00:25:45,360
and this is the part that can get really

720
00:25:45,360 --> 00:25:46,000
scary

721
00:25:46,000 --> 00:25:48,880
if you try to get fancy with it i have

722
00:25:48,880 --> 00:25:49,440
tried

723
00:25:49,440 --> 00:25:52,159
over and over and over again to throw

724
00:25:52,159 --> 00:25:54,320
the pizza dough into the air twirl it

725
00:25:54,320 --> 00:25:54,720
around

726
00:25:54,720 --> 00:25:56,960
like some kind of expert and you know

727
00:25:56,960 --> 00:25:58,960
what just about every time i've dropped

728
00:25:58,960 --> 00:26:00,720
the pizza dough and nothing good has

729
00:26:00,720 --> 00:26:02,720
ever come of it so i don't recommend it

730
00:26:02,720 --> 00:26:05,360
unless you're just very talented at that

731
00:26:05,360 --> 00:26:07,760
um just try to sort of stretch it out

732
00:26:07,760 --> 00:26:09,200
here's another pizza hat

733
00:26:09,200 --> 00:26:12,240
from all of the uh recipes that i've

734
00:26:12,240 --> 00:26:13,200
ever seen

735
00:26:13,200 --> 00:26:15,520
have said to put the pizza directly on a

736
00:26:15,520 --> 00:26:16,640
pizza stone

737
00:26:16,640 --> 00:26:18,400
but i have a really hard time with that

738
00:26:18,400 --> 00:26:20,240
like i'm always messing up the pizza

739
00:26:20,240 --> 00:26:21,039
when i do that

740
00:26:21,039 --> 00:26:22,960
so instead i'll put it on a piece of

741
00:26:22,960 --> 00:26:24,880
parchment paper which makes it a whole

742
00:26:24,880 --> 00:26:27,120
lot easier to get in and out of the oven

743
00:26:27,120 --> 00:26:28,559
now here's the thing that i was kind of

744
00:26:28,559 --> 00:26:30,720
hoping would happen as we did this demo

745
00:26:30,720 --> 00:26:33,919
the pizza dough tour that is because i

746
00:26:33,919 --> 00:26:34,480
didn't

747
00:26:34,480 --> 00:26:36,480
let it run in the mixer and knead it

748
00:26:36,480 --> 00:26:38,880
long enough um the longer you need it

749
00:26:38,880 --> 00:26:40,799
the more elastic it becomes and the less

750
00:26:40,799 --> 00:26:41,840
that it'll tear

751
00:26:41,840 --> 00:26:44,159
but what i wanted to show you is it's

752
00:26:44,159 --> 00:26:46,640
fine even if the pizza dough tears you

753
00:26:46,640 --> 00:26:48,240
can just fix it just sort of pinch it

754
00:26:48,240 --> 00:26:49,600
back together again

755
00:26:49,600 --> 00:26:52,000
and it'll be just fine now the most fun

756
00:26:52,000 --> 00:26:52,720
about making

757
00:26:52,720 --> 00:26:54,960
pizza at home is that everybody gets to

758
00:26:54,960 --> 00:26:57,360
put whatever toppings they want on it

759
00:26:57,360 --> 00:26:59,520
when you put it in the oven you want it

760
00:26:59,520 --> 00:27:01,600
to be the hottest oven that you can

761
00:27:01,600 --> 00:27:04,320
and a pizza stone works great heat up

762
00:27:04,320 --> 00:27:05,919
the pizza stone in the oven ahead of

763
00:27:05,919 --> 00:27:06,559
time

764
00:27:06,559 --> 00:27:09,279
but i have also made this on all kinds

765
00:27:09,279 --> 00:27:11,279
of metal pans and it's also worked out

766
00:27:11,279 --> 00:27:12,159
just fine

767
00:27:12,159 --> 00:27:15,039
this pizza or this oven i've heated up

768
00:27:15,039 --> 00:27:17,279
to 500 degrees fahrenheit which is

769
00:27:17,279 --> 00:27:20,720
260 celsius um and that's worked out

770
00:27:20,720 --> 00:27:21,440
really well

771
00:27:21,440 --> 00:27:23,919
real pizza ovens are like 900 degrees

772
00:27:23,919 --> 00:27:24,480
and

773
00:27:24,480 --> 00:27:27,679
um they're super hot so you really can't

774
00:27:27,679 --> 00:27:28,000
get

775
00:27:28,000 --> 00:27:30,960
the the oven too hot at home um this

776
00:27:30,960 --> 00:27:32,159
pizza

777
00:27:32,159 --> 00:27:34,880
is a special one it's half dairy free

778
00:27:34,880 --> 00:27:35,600
and

779
00:27:35,600 --> 00:27:38,960
half full dairy cheese so that everybody

780
00:27:38,960 --> 00:27:41,440
can enjoy it whether um they can eat

781
00:27:41,440 --> 00:27:43,039
dairy or not

782
00:27:43,039 --> 00:27:46,240
so um i'd like to stop now and take

783
00:27:46,240 --> 00:27:47,919
questions and see if there are any

784
00:27:47,919 --> 00:27:49,039
questions about

785
00:27:49,039 --> 00:27:51,919
pizza or about the threat hunting

786
00:27:51,919 --> 00:27:52,480
queries

787
00:27:52,480 --> 00:27:55,520
and then if we don't have any pizza

788
00:27:55,520 --> 00:27:57,039
questions i'll get back to threat

789
00:27:57,039 --> 00:28:00,000
hunting and round it out with that

790
00:28:00,000 --> 00:28:02,640
already yeah uh your oven was perhaps a

791
00:28:02,640 --> 00:28:03,679
little hotter than

792
00:28:03,679 --> 00:28:05,520
people were anticipating by the look of

793
00:28:05,520 --> 00:28:07,600
it

794
00:28:08,720 --> 00:28:12,559
alrighty uh so we have one person asking

795
00:28:12,559 --> 00:28:13,200
if you

796
00:28:13,200 --> 00:28:16,480
add a semolina i guess flour at the end

797
00:28:16,480 --> 00:28:17,840
to build the crust

798
00:28:17,840 --> 00:28:20,240
oh excellent yes i've heard that the

799
00:28:20,240 --> 00:28:21,440
semolina flour

800
00:28:21,440 --> 00:28:24,080
will do a really good job um but i don't

801
00:28:24,080 --> 00:28:25,919
i just keep it really simple

802
00:28:25,919 --> 00:28:28,960
um i've used all-purpose flour sometimes

803
00:28:28,960 --> 00:28:30,000
bread flour it comes

804
00:28:30,000 --> 00:28:31,360
out a little bit differently depending

805
00:28:31,360 --> 00:28:33,520
on what sort of flour you work you use

806
00:28:33,520 --> 00:28:35,760
but any of those types of flours will

807
00:28:35,760 --> 00:28:38,000
work just fine

808
00:28:38,000 --> 00:28:40,720
all right uh can the dough be over

809
00:28:40,720 --> 00:28:41,840
kneaded

810
00:28:41,840 --> 00:28:43,520
oh that's an another really good

811
00:28:43,520 --> 00:28:45,039
question so i actually

812
00:28:45,039 --> 00:28:46,880
have an excellent book called the bread

813
00:28:46,880 --> 00:28:48,320
baker's apprentice

814
00:28:48,320 --> 00:28:50,559
and the author deals with that very

815
00:28:50,559 --> 00:28:51,520
topic

816
00:28:51,520 --> 00:28:54,000
and uh the author's opinion which i

817
00:28:54,000 --> 00:28:55,200
trust quite a bit

818
00:28:55,200 --> 00:28:58,159
is that you just cannot need it too much

819
00:28:58,159 --> 00:29:00,320
um my own experience and

820
00:29:00,320 --> 00:29:02,720
you know as a person who just tries

821
00:29:02,720 --> 00:29:03,760
things out

822
00:29:03,760 --> 00:29:06,880
um i have also experimentally just

823
00:29:06,880 --> 00:29:09,279
tried to let the pizza knead for a

824
00:29:09,279 --> 00:29:11,360
really long time like 30 minutes

825
00:29:11,360 --> 00:29:15,120
in the mixer or when i've done it by

826
00:29:15,120 --> 00:29:15,840
hand just

827
00:29:15,840 --> 00:29:17,600
keep going until i can't knead it

828
00:29:17,600 --> 00:29:19,360
anymore it's never

829
00:29:19,360 --> 00:29:21,279
been messed up there's never been any

830
00:29:21,279 --> 00:29:23,279
problem with that the only problem that

831
00:29:23,279 --> 00:29:23,919
i've ever

832
00:29:23,919 --> 00:29:26,720
had with pizza and kneading was not

833
00:29:26,720 --> 00:29:27,520
needing it

834
00:29:27,520 --> 00:29:29,760
enough so i'd say if you're not sure if

835
00:29:29,760 --> 00:29:31,520
you've done it enough just keep going

836
00:29:31,520 --> 00:29:33,039
until you're tired of needing and then

837
00:29:33,039 --> 00:29:34,880
it'll be just fine

838
00:29:34,880 --> 00:29:37,600
all right switching uh switching back

839
00:29:37,600 --> 00:29:39,279
over to your other topic

840
00:29:39,279 --> 00:29:40,640
we have a question as to whether you can

841
00:29:40,640 --> 00:29:42,880
detect beacon with jitter

842
00:29:42,880 --> 00:29:45,039
using kql or is that something that's

843
00:29:45,039 --> 00:29:46,000
too difficult

844
00:29:46,000 --> 00:29:48,640
oh excellent um i'm glad that that

845
00:29:48,640 --> 00:29:50,480
question was raised because that's where

846
00:29:50,480 --> 00:29:51,279
we're going to go

847
00:29:51,279 --> 00:29:54,480
with building this kql query next

848
00:29:54,480 --> 00:29:56,240
so if that's all right it'll take a

849
00:29:56,240 --> 00:29:58,480
little while to answer that question

850
00:29:58,480 --> 00:30:01,039
but uh but the short answer is yes we're

851
00:30:01,039 --> 00:30:02,559
going to use statistics we're going to

852
00:30:02,559 --> 00:30:04,559
use a standard deviation

853
00:30:04,559 --> 00:30:06,960
and figure out even if there is some

854
00:30:06,960 --> 00:30:07,760
jitter

855
00:30:07,760 --> 00:30:11,360
in the beacon check-in we can find the

856
00:30:11,360 --> 00:30:12,799
ones that

857
00:30:12,799 --> 00:30:15,679
are most likely

858
00:30:15,919 --> 00:30:18,559
repeating now i also want to point out

859
00:30:18,559 --> 00:30:19,200
that

860
00:30:19,200 --> 00:30:21,440
with the beacons that we're going to

861
00:30:21,440 --> 00:30:23,440
find here we also just found them

862
00:30:23,440 --> 00:30:24,159
because they

863
00:30:24,159 --> 00:30:27,200
were the top of the list for computer

864
00:30:27,200 --> 00:30:29,919
process and destination ip just the the

865
00:30:29,919 --> 00:30:30,720
count

866
00:30:30,720 --> 00:30:34,159
of the number of connections so it stood

867
00:30:34,159 --> 00:30:35,760
out that way as well

868
00:30:35,760 --> 00:30:37,919
just because they're so frequent but i'd

869
00:30:37,919 --> 00:30:39,200
like to show you this

870
00:30:39,200 --> 00:30:42,480
way to summarize um and

871
00:30:42,480 --> 00:30:44,640
calculate the standard deviation because

872
00:30:44,640 --> 00:30:46,159
i think that's really interesting as

873
00:30:46,159 --> 00:30:47,440
well

874
00:30:47,440 --> 00:30:48,960
all right and i'm really glad my wife

875
00:30:48,960 --> 00:30:50,320
turned the oven off because i was

876
00:30:50,320 --> 00:30:51,840
getting very warm sitting

877
00:30:51,840 --> 00:30:54,880
with my back to a 500 degree oven

878
00:30:54,880 --> 00:30:57,919
all right so we've got the make list

879
00:30:57,919 --> 00:30:58,880
here

880
00:30:58,880 --> 00:31:02,159
um let's do some other uh

881
00:31:02,159 --> 00:31:05,679
summation summations too let's do uh

882
00:31:05,679 --> 00:31:08,159
connection count i'm just giving it a

883
00:31:08,159 --> 00:31:09,360
variable name here

884
00:31:09,360 --> 00:31:14,639
it's equal to count and we'll run that

885
00:31:14,880 --> 00:31:17,519
okay now we've got number of connections

886
00:31:17,519 --> 00:31:19,440
that's going to be useful

887
00:31:19,440 --> 00:31:22,799
and then let's also do the standard

888
00:31:22,799 --> 00:31:25,360
deviation so i'll just call this

889
00:31:25,360 --> 00:31:29,480
standard d is equal to

890
00:31:29,480 --> 00:31:33,200
stdev and give it the

891
00:31:33,200 --> 00:31:36,799
delta time right that's what i called it

892
00:31:36,799 --> 00:31:40,320
delta time there we go

893
00:31:42,320 --> 00:31:45,519
okay so now what we've computed

894
00:31:45,519 --> 00:31:49,519
is not only um the number of connections

895
00:31:49,519 --> 00:31:52,159
but the standard deviation between the

896
00:31:52,159 --> 00:31:54,000
timing of those connections

897
00:31:54,000 --> 00:31:56,399
and you can see that we're probably not

898
00:31:56,399 --> 00:31:57,679
going to find anything

899
00:31:57,679 --> 00:31:59,120
interesting any sort of malware

900
00:31:59,120 --> 00:32:01,600
beaconing for anything other than

901
00:32:01,600 --> 00:32:04,880
under uh 10 connections right so

902
00:32:04,880 --> 00:32:08,000
let me filter that now and say where the

903
00:32:08,000 --> 00:32:12,320
connection count is greater than

904
00:32:12,320 --> 00:32:14,000
well just for sake of argument let's

905
00:32:14,000 --> 00:32:15,919
just do five just so that we see a few

906
00:32:15,919 --> 00:32:16,880
more results

907
00:32:16,880 --> 00:32:20,000
right off the bat okay

908
00:32:20,000 --> 00:32:22,799
now we're seeing for a connection count

909
00:32:22,799 --> 00:32:23,600
with 10

910
00:32:23,600 --> 00:32:27,440
there's a standard deviation of 9166

911
00:32:27,440 --> 00:32:29,120
and you can see that's because these

912
00:32:29,120 --> 00:32:31,519
delta times are all over the board like

913
00:32:31,519 --> 00:32:33,120
there was a connection there's a pair of

914
00:32:33,120 --> 00:32:35,360
connections that the time between them

915
00:32:35,360 --> 00:32:36,679
was

916
00:32:36,679 --> 00:32:39,279
6241 seconds there was another one that

917
00:32:39,279 --> 00:32:41,519
it was just 481 seconds

918
00:32:41,519 --> 00:32:45,440
that doesn't seem very regular so let's

919
00:32:45,440 --> 00:32:48,399
sort that or

920
00:32:48,799 --> 00:32:52,640
let's sort by standard deviation

921
00:32:52,640 --> 00:32:56,159
and let's do it um

922
00:32:56,159 --> 00:32:58,240
ascending so that we have the lowest

923
00:32:58,240 --> 00:32:59,840
standard deviation

924
00:32:59,840 --> 00:33:01,760
at the top of the list and if you're not

925
00:33:01,760 --> 00:33:03,360
familiar with this this is just a

926
00:33:03,360 --> 00:33:04,159
measure

927
00:33:04,159 --> 00:33:08,080
of how regular the connections are so if

928
00:33:08,080 --> 00:33:10,720
the standard deviation is very low

929
00:33:10,720 --> 00:33:12,720
that means that there's not a whole lot

930
00:33:12,720 --> 00:33:14,240
of deviation

931
00:33:14,240 --> 00:33:16,559
between the values in the list if the

932
00:33:16,559 --> 00:33:18,480
standard deviation is very high there's

933
00:33:18,480 --> 00:33:20,720
a high degree of deviation between them

934
00:33:20,720 --> 00:33:22,320
or a lot of variance

935
00:33:22,320 --> 00:33:24,320
and you can see that just by sorting by

936
00:33:24,320 --> 00:33:26,240
standard deviation and putting the low

937
00:33:26,240 --> 00:33:27,760
numbers at the top

938
00:33:27,760 --> 00:33:30,559
now we've got the most beacon like

939
00:33:30,559 --> 00:33:32,960
connections the most regularly repeating

940
00:33:32,960 --> 00:33:33,760
ones

941
00:33:33,760 --> 00:33:36,559
right up at the top of the list so this

942
00:33:36,559 --> 00:33:38,559
gives us a way that if we didn't even

943
00:33:38,559 --> 00:33:40,159
want to look at the rest of these

944
00:33:40,159 --> 00:33:41,919
like let's say that we wanted to set

945
00:33:41,919 --> 00:33:43,840
this up as an alert

946
00:33:43,840 --> 00:33:46,960
that would run every so often and send

947
00:33:46,960 --> 00:33:47,440
us

948
00:33:47,440 --> 00:33:53,039
um uh maybe a message on teams or

949
00:33:53,039 --> 00:33:54,880
start a new ticket or something like

950
00:33:54,880 --> 00:33:56,559
that um

951
00:33:56,559 --> 00:33:59,519
let's just filter for the things that

952
00:33:59,519 --> 00:34:01,679
are

953
00:34:02,080 --> 00:34:04,960
very low on the standard deviation

954
00:34:04,960 --> 00:34:07,279
measurement so this is where jitter

955
00:34:07,279 --> 00:34:08,239
comes in

956
00:34:08,239 --> 00:34:10,159
now if you're not familiar with it when

957
00:34:10,159 --> 00:34:11,679
you create

958
00:34:11,679 --> 00:34:14,480
a remote access tool like cobalt strike

959
00:34:14,480 --> 00:34:15,280
beacon

960
00:34:15,280 --> 00:34:17,679
and you're giving it configuration

961
00:34:17,679 --> 00:34:19,839
you'll want to tell it how often to

962
00:34:19,839 --> 00:34:20,719
check in

963
00:34:20,719 --> 00:34:23,199
and you'll also want to tell it how how

964
00:34:23,199 --> 00:34:25,280
much jitter to put into the check-in

965
00:34:25,280 --> 00:34:26,960
times and that's the amount of

966
00:34:26,960 --> 00:34:30,239
random variation between

967
00:34:30,239 --> 00:34:32,800
check-in times and the reason for jitter

968
00:34:32,800 --> 00:34:34,560
if you're a red team operator

969
00:34:34,560 --> 00:34:37,520
is to avoid um a blue team doing

970
00:34:37,520 --> 00:34:39,440
analysis just like we're doing here you

971
00:34:39,440 --> 00:34:41,440
want to be able to fly under their radar

972
00:34:41,440 --> 00:34:42,239
so

973
00:34:42,239 --> 00:34:44,079
instead of having a check in like every

974
00:34:44,079 --> 00:34:45,679
10 seconds you know 10

975
00:34:45,679 --> 00:34:48,800
10 10 11 10 9

976
00:34:48,800 --> 00:34:51,760
11. that type of check-in which is so

977
00:34:51,760 --> 00:34:52,399
easy to

978
00:34:52,399 --> 00:34:55,199
spot you want to do something that is um

979
00:34:55,199 --> 00:34:57,040
you know maybe five seconds here and

980
00:34:57,040 --> 00:34:58,960
then 15 seconds later on

981
00:34:58,960 --> 00:35:01,280
i try to get the standard deviation up a

982
00:35:01,280 --> 00:35:02,079
little bit

983
00:35:02,079 --> 00:35:03,920
and maybe hide in the noise that's the

984
00:35:03,920 --> 00:35:05,280
point now

985
00:35:05,280 --> 00:35:08,320
the only way that you can really

986
00:35:08,320 --> 00:35:10,160
hide in the noise using this sort of

987
00:35:10,160 --> 00:35:11,920
regular repeating check-in

988
00:35:11,920 --> 00:35:14,560
is to have a very long polling interval

989
00:35:14,560 --> 00:35:15,359
you know like

990
00:35:15,359 --> 00:35:17,599
you know maybe 15 minutes between

991
00:35:17,599 --> 00:35:18,480
check-ins

992
00:35:18,480 --> 00:35:20,560
and then have a high degree of jitter so

993
00:35:20,560 --> 00:35:22,480
that one time you're checking in

994
00:35:22,480 --> 00:35:24,079
one minute later the next time it might

995
00:35:24,079 --> 00:35:25,760
be 15 minutes

996
00:35:25,760 --> 00:35:27,920
and create a lot of variants in there

997
00:35:27,920 --> 00:35:28,960
now the reason

998
00:35:28,960 --> 00:35:31,359
that i think a lot of red team operators

999
00:35:31,359 --> 00:35:32,480
and definitely

1000
00:35:32,480 --> 00:35:35,680
uh professional threat actors don't

1001
00:35:35,680 --> 00:35:37,920
do that um and let me just say i've

1002
00:35:37,920 --> 00:35:40,400
studied an awful lot of malware beacons

1003
00:35:40,400 --> 00:35:42,640
and i almost never see that kind of

1004
00:35:42,640 --> 00:35:43,520
jitter

1005
00:35:43,520 --> 00:35:45,440
the reason they don't want to do that in

1006
00:35:45,440 --> 00:35:47,520
my opinion is because it's really

1007
00:35:47,520 --> 00:35:48,240
annoying

1008
00:35:48,240 --> 00:35:50,720
as a red team operator to work with a

1009
00:35:50,720 --> 00:35:51,280
beacon

1010
00:35:51,280 --> 00:35:52,640
that you don't know when it's going to

1011
00:35:52,640 --> 00:35:54,240
check in again that means you're sitting

1012
00:35:54,240 --> 00:35:55,839
on the other end of the keyboard

1013
00:35:55,839 --> 00:35:58,240
typing some command and you don't know

1014
00:35:58,240 --> 00:35:59,839
if it's going to run in one minute

1015
00:35:59,839 --> 00:36:02,160
or 15 minutes or maybe an hour later

1016
00:36:02,160 --> 00:36:02,960
that makes your

1017
00:36:02,960 --> 00:36:05,280
work day go really really slowly and you

1018
00:36:05,280 --> 00:36:06,880
start to wonder if your beacon is

1019
00:36:06,880 --> 00:36:10,160
even working at all right so

1020
00:36:10,160 --> 00:36:13,839
let's first filter um let's do

1021
00:36:13,839 --> 00:36:17,040
where the standard deviation is

1022
00:36:17,040 --> 00:36:20,240
uh let's say less than and here's where

1023
00:36:20,240 --> 00:36:20,640
we

1024
00:36:20,640 --> 00:36:23,520
we as the threat hunter are going to

1025
00:36:23,520 --> 00:36:24,240
pick

1026
00:36:24,240 --> 00:36:26,160
a number that makes sense to us so just

1027
00:36:26,160 --> 00:36:27,599
looking at these numbers

1028
00:36:27,599 --> 00:36:29,280
i'm going to say how about standard

1029
00:36:29,280 --> 00:36:32,000
deviation is less than 200.

1030
00:36:32,000 --> 00:36:34,160
i think that's going to highlight just

1031
00:36:34,160 --> 00:36:36,400
the connections that we're interested in

1032
00:36:36,400 --> 00:36:38,640
that seems to be doing a pretty good job

1033
00:36:38,640 --> 00:36:39,680
now we can see these

1034
00:36:39,680 --> 00:36:41,599
standard deviations are really low but

1035
00:36:41,599 --> 00:36:43,680
i've seen an actual malware

1036
00:36:43,680 --> 00:36:46,960
beacon with i think it had 10 minute

1037
00:36:46,960 --> 00:36:49,680
pulling intervals and a really high

1038
00:36:49,680 --> 00:36:51,680
degree of jitter it ended up being about

1039
00:36:51,680 --> 00:36:54,800
an 87 on the standard deviation scale so

1040
00:36:54,800 --> 00:36:57,040
this should still

1041
00:36:57,040 --> 00:36:59,599
get us the values that we want now the

1042
00:36:59,599 --> 00:37:01,440
next thing that we want to do is maybe

1043
00:37:01,440 --> 00:37:02,160
expand

1044
00:37:02,160 --> 00:37:04,960
our time that we're searching and see if

1045
00:37:04,960 --> 00:37:05,760
we still get

1046
00:37:05,760 --> 00:37:07,839
reasonable results over a longer period

1047
00:37:07,839 --> 00:37:08,960
of time

1048
00:37:08,960 --> 00:37:13,359
now you can see we've got a few more

1049
00:37:13,520 --> 00:37:15,680
a few more things that are popping up on

1050
00:37:15,680 --> 00:37:17,920
our list this is over the last seven

1051
00:37:17,920 --> 00:37:20,160
days in this lab environment

1052
00:37:20,160 --> 00:37:23,040
and we can see okay run dll run dll this

1053
00:37:23,040 --> 00:37:25,280
be loader two that looks suspicious too

1054
00:37:25,280 --> 00:37:26,800
these other run dlls

1055
00:37:26,800 --> 00:37:29,359
these are all definitely suspicious um

1056
00:37:29,359 --> 00:37:31,040
not so sure about this one though

1057
00:37:31,040 --> 00:37:33,280
this is sort of weird the destination ip

1058
00:37:33,280 --> 00:37:35,680
is a ipv6 and it looks like there's a

1059
00:37:35,680 --> 00:37:36,000
whole

1060
00:37:36,000 --> 00:37:38,960
bunch of zero so these are a whole bunch

1061
00:37:38,960 --> 00:37:40,160
of connections that happen

1062
00:37:40,160 --> 00:37:43,040
at the same time now i don't really want

1063
00:37:43,040 --> 00:37:44,800
to see that result

1064
00:37:44,800 --> 00:37:47,040
so what i'm going to do is tune this

1065
00:37:47,040 --> 00:37:48,800
query a little bit more

1066
00:37:48,800 --> 00:37:52,320
and let's say for delta time

1067
00:37:52,320 --> 00:37:54,800
i don't really care about delta times

1068
00:37:54,800 --> 00:37:55,599
zero

1069
00:37:55,599 --> 00:37:58,400
so let's put another where clause here

1070
00:37:58,400 --> 00:37:59,040
and say

1071
00:37:59,040 --> 00:38:02,160
the delta time is greater than zero

1072
00:38:02,160 --> 00:38:03,920
or i could even expand it and say

1073
00:38:03,920 --> 00:38:06,079
greater than one i don't think i've ever

1074
00:38:06,079 --> 00:38:06,880
seen

1075
00:38:06,880 --> 00:38:09,920
a malware beacon that its check-in time

1076
00:38:09,920 --> 00:38:12,079
was one second that would be incredibly

1077
00:38:12,079 --> 00:38:13,359
noisy and we'll probably catch it

1078
00:38:13,359 --> 00:38:14,720
another way just by

1079
00:38:14,720 --> 00:38:17,520
most amount of traffic so i just did the

1080
00:38:17,520 --> 00:38:19,599
delta time is greater than one and now

1081
00:38:19,599 --> 00:38:21,280
you can see i filtered out some of those

1082
00:38:21,280 --> 00:38:22,880
things that i didn't care about

1083
00:38:22,880 --> 00:38:25,359
so much on the list i'm pretty happy

1084
00:38:25,359 --> 00:38:26,960
with this right now like

1085
00:38:26,960 --> 00:38:30,880
if i had over the last week uh my

1086
00:38:30,880 --> 00:38:32,880
sentinel sent me an automated alert to

1087
00:38:32,880 --> 00:38:34,320
say hey you might have a beacon you

1088
00:38:34,320 --> 00:38:35,359
should check out

1089
00:38:35,359 --> 00:38:38,480
for each one of these those would be

1090
00:38:38,480 --> 00:38:40,240
good results that i could actually do

1091
00:38:40,240 --> 00:38:41,760
something with

1092
00:38:41,760 --> 00:38:44,000
so let's see we've got a little bit of

1093
00:38:44,000 --> 00:38:45,760
time left i've got some more things that

1094
00:38:45,760 --> 00:38:46,320
i could do

1095
00:38:46,320 --> 00:38:49,839
adding in some dns data here or maybe

1096
00:38:49,839 --> 00:38:52,079
looking up some of these ip addresses in

1097
00:38:52,079 --> 00:38:52,960
threat feeds

1098
00:38:52,960 --> 00:38:54,480
but i'd like to go back and see if there

1099
00:38:54,480 --> 00:38:56,160
are any questions that i can take

1100
00:38:56,160 --> 00:38:59,359
before we run out of time the

1101
00:38:59,359 --> 00:39:02,320
one that showed up earlier is uh

1102
00:39:02,320 --> 00:39:04,320
admittedly somewhat controversial so

1103
00:39:04,320 --> 00:39:05,839
i'll go ahead and elide the

1104
00:39:05,839 --> 00:39:07,280
controversial part

1105
00:39:07,280 --> 00:39:10,160
but what are your favorite toppings uh

1106
00:39:10,160 --> 00:39:11,200
for pizza

1107
00:39:11,200 --> 00:39:14,160
oh my goodness so i am an adventurous

1108
00:39:14,160 --> 00:39:15,200
pizza hacker

1109
00:39:15,200 --> 00:39:18,160
and i like putting weird things on pizza

1110
00:39:18,160 --> 00:39:19,839
so my favorite thing to do is actually

1111
00:39:19,839 --> 00:39:21,040
ask other people

1112
00:39:21,040 --> 00:39:22,800
what they like on their pizza and then

1113
00:39:22,800 --> 00:39:24,560
try that um

1114
00:39:24,560 --> 00:39:26,800
somebody from germany told me a lot not

1115
00:39:26,800 --> 00:39:28,240
long ago that

1116
00:39:28,240 --> 00:39:30,240
tuna right out of a can was a good

1117
00:39:30,240 --> 00:39:32,000
topping and i have to admit

1118
00:39:32,000 --> 00:39:34,960
i was not so keen to try that because

1119
00:39:34,960 --> 00:39:37,280
tuna's okay on a sandwich but

1120
00:39:37,280 --> 00:39:39,119
i didn't think it was going to be good

1121
00:39:39,119 --> 00:39:41,280
on pizza i tried it

1122
00:39:41,280 --> 00:39:43,359
it was pretty good uh not one of my

1123
00:39:43,359 --> 00:39:45,359
favorites but it was definitely worth

1124
00:39:45,359 --> 00:39:46,000
trying i

1125
00:39:46,000 --> 00:39:48,240
enjoyed that um something else i've done

1126
00:39:48,240 --> 00:39:49,040
on pizza

1127
00:39:49,040 --> 00:39:51,440
that has come out really well i'm in the

1128
00:39:51,440 --> 00:39:53,520
pacific northwest and smoked salmon is

1129
00:39:53,520 --> 00:39:54,560
huge here

1130
00:39:54,560 --> 00:39:58,160
so i did some cream cheese and

1131
00:39:58,160 --> 00:40:01,040
and some fresh mozzarella and then put

1132
00:40:01,040 --> 00:40:01,359
the

1133
00:40:01,359 --> 00:40:03,520
smoked salmon on top and i actually put

1134
00:40:03,520 --> 00:40:04,640
the smoked salmon on

1135
00:40:04,640 --> 00:40:06,160
after it came out of the oven so that it

1136
00:40:06,160 --> 00:40:07,839
didn't dry it out too much and it was

1137
00:40:07,839 --> 00:40:08,960
still

1138
00:40:08,960 --> 00:40:12,079
just that perfect sort of moist

1139
00:40:12,079 --> 00:40:14,079
salmon with that good smoky flavor i

1140
00:40:14,079 --> 00:40:16,160
thought that was really good

1141
00:40:16,160 --> 00:40:18,560
i also like fresh toppings after the

1142
00:40:18,560 --> 00:40:20,160
pizza comes out of the oven i like to

1143
00:40:20,160 --> 00:40:20,880
put

1144
00:40:20,880 --> 00:40:24,400
fresh basil and some

1145
00:40:24,400 --> 00:40:26,160
uh oh what are some of the other fresh

1146
00:40:26,160 --> 00:40:28,319
things that we put on oh fresh tomatoes

1147
00:40:28,319 --> 00:40:30,319
that's really good um and i like them

1148
00:40:30,319 --> 00:40:32,160
when they're not all baked and dried

1149
00:40:32,160 --> 00:40:35,280
but really pizza toppings are personal

1150
00:40:35,280 --> 00:40:37,119
and i think whatever you like on your

1151
00:40:37,119 --> 00:40:37,680
pizza

1152
00:40:37,680 --> 00:40:40,480
is the right thing to put on your pizza

1153
00:40:40,480 --> 00:40:41,920
and unless you just like to be

1154
00:40:41,920 --> 00:40:43,280
adventurous like me you don't really

1155
00:40:43,280 --> 00:40:44,560
even need to worry about what other

1156
00:40:44,560 --> 00:40:47,520
people like on theirs

1157
00:40:47,920 --> 00:40:50,240
fantastic i i like the way that you

1158
00:40:50,240 --> 00:40:51,680
handled that particular

1159
00:40:51,680 --> 00:40:53,599
question there that's something that can

1160
00:40:53,599 --> 00:40:55,920
get a little fraught with some people

1161
00:40:55,920 --> 00:40:58,560
oh for sure

1162
00:40:59,280 --> 00:41:02,800
i don't see any everyone

1163
00:41:02,800 --> 00:41:05,440
is is now talking about how they really

1164
00:41:05,440 --> 00:41:07,200
want a pizza now

1165
00:41:07,200 --> 00:41:10,240
uh despite diets and other such

1166
00:41:10,240 --> 00:41:11,680
impediments

1167
00:41:11,680 --> 00:41:13,599
so i think that you've gone and nerd

1168
00:41:13,599 --> 00:41:16,079
sniped the entire channel at this point

1169
00:41:16,079 --> 00:41:17,920
excellent all right well i've got a

1170
00:41:17,920 --> 00:41:20,000
little bit more i wanted to

1171
00:41:20,000 --> 00:41:21,839
add on to this query and just because

1172
00:41:21,839 --> 00:41:23,760
we're running short on time

1173
00:41:23,760 --> 00:41:27,200
i want to sort of show you um what other

1174
00:41:27,200 --> 00:41:29,040
data i have added into this

1175
00:41:29,040 --> 00:41:31,200
so this is this is pretty much the same

1176
00:41:31,200 --> 00:41:34,000
query that we built before

1177
00:41:34,000 --> 00:41:37,119
but i've added on dns data because

1178
00:41:37,119 --> 00:41:40,400
i wanted to see has there been a dns

1179
00:41:40,400 --> 00:41:43,760
query that resulted in an answer of one

1180
00:41:43,760 --> 00:41:46,240
of these ip addresses before

1181
00:41:46,240 --> 00:41:49,520
so what i've done is a kql join

1182
00:41:49,520 --> 00:41:52,640
and if you've ever done sql database

1183
00:41:52,640 --> 00:41:53,280
queries

1184
00:41:53,280 --> 00:41:54,960
you should be familiar with joins

1185
00:41:54,960 --> 00:41:56,319
they're so valuable

1186
00:41:56,319 --> 00:41:59,520
and it works in kql as well so i've told

1187
00:41:59,520 --> 00:42:01,440
it that the kind of join i want is

1188
00:42:01,440 --> 00:42:04,560
left outer what that means is i want

1189
00:42:04,560 --> 00:42:07,520
all of the results from the left table

1190
00:42:07,520 --> 00:42:08,960
the left table is this

1191
00:42:08,960 --> 00:42:10,480
right it's this result that we're

1192
00:42:10,480 --> 00:42:13,359
looking at right now in other words

1193
00:42:13,359 --> 00:42:15,839
even if there is no dns query that

1194
00:42:15,839 --> 00:42:18,240
matches this ip address i still want to

1195
00:42:18,240 --> 00:42:19,920
see this result i just want to see that

1196
00:42:19,920 --> 00:42:21,680
there was no dns query

1197
00:42:21,680 --> 00:42:25,200
because i don't want pardon me adding in

1198
00:42:25,200 --> 00:42:29,040
extra data to cause me to miss some of

1199
00:42:29,040 --> 00:42:30,000
these really important

1200
00:42:30,000 --> 00:42:33,040
results so then i've joined it

1201
00:42:33,040 --> 00:42:35,359
to another custom data source that i've

1202
00:42:35,359 --> 00:42:36,160
got in this

1203
00:42:36,160 --> 00:42:38,319
environment i've got both ciracata and

1204
00:42:38,319 --> 00:42:39,359
zeek

1205
00:42:39,359 --> 00:42:42,480
both of those will read dns queries on

1206
00:42:42,480 --> 00:42:43,520
the wire

1207
00:42:43,520 --> 00:42:46,880
and then i've used another

1208
00:42:46,880 --> 00:42:49,920
really really handy kql function here

1209
00:42:49,920 --> 00:42:52,960
called parse json parse json

1210
00:42:52,960 --> 00:42:54,880
as one of the parsing functions along

1211
00:42:54,880 --> 00:42:56,000
with

1212
00:42:56,000 --> 00:42:59,119
parse csv or parse xml

1213
00:42:59,119 --> 00:43:00,960
that will take a field that's in your

1214
00:43:00,960 --> 00:43:03,200
results and make it so that you can

1215
00:43:03,200 --> 00:43:05,920
query inside of that so i'm going to

1216
00:43:05,920 --> 00:43:07,760
skip ahead where i figured out

1217
00:43:07,760 --> 00:43:10,880
that in ceracata the dns

1218
00:43:10,880 --> 00:43:15,040
is the question and or the answer is

1219
00:43:15,040 --> 00:43:17,920
put in a json format and i just care

1220
00:43:17,920 --> 00:43:19,440
about the first one

1221
00:43:19,440 --> 00:43:23,839
i want to extend the answer r data

1222
00:43:23,839 --> 00:43:26,960
which is the resource data coming back

1223
00:43:26,960 --> 00:43:29,520
into this new field called our data then

1224
00:43:29,520 --> 00:43:31,200
i want to summarize by

1225
00:43:31,200 --> 00:43:33,359
the resource record name that was the

1226
00:43:33,359 --> 00:43:34,319
query

1227
00:43:34,319 --> 00:43:37,359
and the r data so in in other words i'll

1228
00:43:37,359 --> 00:43:38,480
just take this query

1229
00:43:38,480 --> 00:43:41,119
out actually and you can see what this

1230
00:43:41,119 --> 00:43:43,040
results in all by itself i think that

1231
00:43:43,040 --> 00:43:43,920
will be really

1232
00:43:43,920 --> 00:43:45,920
instructive and helpful so you

1233
00:43:45,920 --> 00:43:47,200
understand where i'm going with this

1234
00:43:47,200 --> 00:43:49,040
query

1235
00:43:49,040 --> 00:43:51,599
here we go all right so let's just run

1236
00:43:51,599 --> 00:43:52,960
this for the last

1237
00:43:52,960 --> 00:43:55,680
um four hours so we don't get bombarded

1238
00:43:55,680 --> 00:43:56,640
with a lot of

1239
00:43:56,640 --> 00:44:00,640
results so what this is saying is that

1240
00:44:00,640 --> 00:44:03,920
these are the queries and

1241
00:44:03,920 --> 00:44:05,760
sorry these are the queries on the right

1242
00:44:05,760 --> 00:44:07,280
and on the left

1243
00:44:07,280 --> 00:44:10,560
these are the responses and so i can see

1244
00:44:10,560 --> 00:44:12,640
already there's one of my

1245
00:44:12,640 --> 00:44:15,200
ip addresses that the cobalt strike

1246
00:44:15,200 --> 00:44:16,960
beacon is calling out to

1247
00:44:16,960 --> 00:44:20,000
and the dns query that was made for that

1248
00:44:20,000 --> 00:44:22,880
is wellernaft.top

1249
00:44:22,880 --> 00:44:24,560
and i think we're just about done with

1250
00:44:24,560 --> 00:44:26,640
time so i will

1251
00:44:26,640 --> 00:44:29,280
close it there and thank you so much i'm

1252
00:44:29,280 --> 00:44:31,200
gonna be around in slack chat so i'd be

1253
00:44:31,200 --> 00:44:32,000
happy to

1254
00:44:32,000 --> 00:44:33,359
keep chatting with you and answering

1255
00:44:33,359 --> 00:44:36,160
questions fantastic thanks

1256
00:44:36,160 --> 00:44:39,359
for uh bringing your double live

1257
00:44:39,359 --> 00:44:41,440
demo to pancakes con randy we're very

1258
00:44:41,440 --> 00:44:44,960
glad to have had you here

