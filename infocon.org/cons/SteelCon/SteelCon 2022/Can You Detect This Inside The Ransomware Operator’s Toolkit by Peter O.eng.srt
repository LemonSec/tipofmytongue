1
00:00:02,879 --> 00:00:06,240
hey hello uh welcome to the can you

2
00:00:06,240 --> 00:00:08,000
detect this inside the ransomware

3
00:00:08,000 --> 00:00:09,599
operators toolkit

4
00:00:09,599 --> 00:00:12,799
so my name is pete i'm part of the dfir

5
00:00:12,799 --> 00:00:15,120
report team of analysts

6
00:00:15,120 --> 00:00:15,839
so

7
00:00:15,839 --> 00:00:18,720
we make up a team of about eight or nine

8
00:00:18,720 --> 00:00:23,279
um we're global based and

9
00:00:23,279 --> 00:00:25,199
we all do this in our own time so we're

10
00:00:25,199 --> 00:00:27,760
volunteer analysts and we've all got

11
00:00:27,760 --> 00:00:30,880
skills in doing intrusion analysis and

12
00:00:30,880 --> 00:00:32,800
some of us are

13
00:00:32,800 --> 00:00:34,719
specialist skills in

14
00:00:34,719 --> 00:00:37,120
malware reverse engineering

15
00:00:37,120 --> 00:00:39,520
memory forensic analysis and so on

16
00:00:39,520 --> 00:00:41,440
but foundation level

17
00:00:41,440 --> 00:00:43,440
we all have a core set of skills being

18
00:00:43,440 --> 00:00:44,719
able to

19
00:00:44,719 --> 00:00:47,280
work with intelligence do triage

20
00:00:47,280 --> 00:00:50,480
investigations um work with the data and

21
00:00:50,480 --> 00:00:51,840
exploit that

22
00:00:51,840 --> 00:00:54,160
so i've been contributing to the dfir

23
00:00:54,160 --> 00:00:56,320
report cases

24
00:00:56,320 --> 00:00:58,399
so providing the endless insight for

25
00:00:58,399 --> 00:01:01,760
quite a while now um most of our cases

26
00:01:01,760 --> 00:01:04,319
are ransomware intrusions

27
00:01:04,319 --> 00:01:05,519
and

28
00:01:05,519 --> 00:01:08,799
and we report on methods of detection um

29
00:01:08,799 --> 00:01:12,799
i specialize in brett hunting

30
00:01:12,799 --> 00:01:15,759
detection engineering

31
00:01:15,759 --> 00:01:16,880
so

32
00:01:16,880 --> 00:01:21,040
this presentation uh the focus is on the

33
00:01:21,040 --> 00:01:22,400
review of the common tools and

34
00:01:22,400 --> 00:01:26,560
techniques of 2021 so we published a

35
00:01:26,560 --> 00:01:29,439
report on our website earlier on this

36
00:01:29,439 --> 00:01:30,320
year

37
00:01:30,320 --> 00:01:31,200
where

38
00:01:31,200 --> 00:01:33,680
from the analysis of a lot of the

39
00:01:33,680 --> 00:01:35,119
cases

40
00:01:35,119 --> 00:01:37,680
we've reported the common techniques

41
00:01:37,680 --> 00:01:41,040
that the ransomware that groups use and

42
00:01:41,040 --> 00:01:45,200
the types of uh tools um um procedures

43
00:01:45,200 --> 00:01:46,640
that they follow

44
00:01:46,640 --> 00:01:49,280
um so we've collated that into like a

45
00:01:49,280 --> 00:01:52,560
trend analysis charts

46
00:01:52,840 --> 00:01:55,119
so in the presentation we'll also be

47
00:01:55,119 --> 00:01:58,240
covering the attack objectives and how

48
00:01:58,240 --> 00:02:01,280
this fits in with the attack life cycle

49
00:02:01,280 --> 00:02:04,000
and then we'll be mapping typical um

50
00:02:04,000 --> 00:02:05,840
attack on how to

51
00:02:05,840 --> 00:02:08,720
leverage the detection so where do we

52
00:02:08,720 --> 00:02:12,560
need to detect in order to

53
00:02:12,640 --> 00:02:14,000
prevent

54
00:02:14,000 --> 00:02:16,400
the ransomware threat operator from

55
00:02:16,400 --> 00:02:17,840
progression

56
00:02:17,840 --> 00:02:19,120
and then

57
00:02:19,120 --> 00:02:21,040
we're going to focus on more on the

58
00:02:21,040 --> 00:02:23,440
human side because ultimately

59
00:02:23,440 --> 00:02:24,879
they are

60
00:02:24,879 --> 00:02:27,360
uh human operative ransomware

61
00:02:27,360 --> 00:02:29,360
groups there is a human being behind

62
00:02:29,360 --> 00:02:32,160
this uh it's not automatic it's not just

63
00:02:32,160 --> 00:02:34,400
code that fires and then you just get

64
00:02:34,400 --> 00:02:38,000
run somewhere there is a human operator

65
00:02:38,000 --> 00:02:40,800
what is using tools uh deciding when not

66
00:02:40,800 --> 00:02:42,800
to use tools

67
00:02:42,800 --> 00:02:45,120
and then making decisions uh where they

68
00:02:45,120 --> 00:02:46,959
go through the intrusion

69
00:02:46,959 --> 00:02:48,959
and then finally

70
00:02:48,959 --> 00:02:50,879
some useful resources

71
00:02:50,879 --> 00:02:52,800
for defenders

72
00:02:52,800 --> 00:02:54,879
there's a lot of material out there

73
00:02:54,879 --> 00:02:56,879
so what can we do to prevent detect and

74
00:02:56,879 --> 00:03:00,560
respond to ransomware intrusion

75
00:03:00,560 --> 00:03:01,440
so

76
00:03:01,440 --> 00:03:03,920
just a bit of a background on the dfir

77
00:03:03,920 --> 00:03:07,680
report so our aim is to find cyber

78
00:03:07,680 --> 00:03:09,440
intelligence

79
00:03:09,440 --> 00:03:12,080
that is actionable and tells a story of

80
00:03:12,080 --> 00:03:13,519
an intrusion

81
00:03:13,519 --> 00:03:15,519
using mitre

82
00:03:15,519 --> 00:03:17,760
tactic techniques and procedures

83
00:03:17,760 --> 00:03:18,560
so

84
00:03:18,560 --> 00:03:20,879
like i said before we deal with a lot of

85
00:03:20,879 --> 00:03:23,680
different types of intrusion cases

86
00:03:23,680 --> 00:03:27,760
so from nation state sponsored apts um

87
00:03:27,760 --> 00:03:30,480
through to organize crime groups

88
00:03:30,480 --> 00:03:32,560
for a bulk of our cases is predominantly

89
00:03:32,560 --> 00:03:35,840
ransomware um for actors

90
00:03:35,840 --> 00:03:37,200
so

91
00:03:37,200 --> 00:03:39,440
as a reader uh looking at this

92
00:03:39,440 --> 00:03:42,000
information uh in the report you should

93
00:03:42,000 --> 00:03:43,599
be able to understand what the attacker

94
00:03:43,599 --> 00:03:44,400
did

95
00:03:44,400 --> 00:03:46,959
and how they accomplish their goals and

96
00:03:46,959 --> 00:03:50,080
importantly how to defend i.t systems

97
00:03:50,080 --> 00:03:52,239
so it's not all about just providing

98
00:03:52,239 --> 00:03:55,840
iocs as the malware hashes etip address

99
00:03:55,840 --> 00:03:59,040
that they use it's all about

100
00:03:59,040 --> 00:04:01,920
the techniques that they leverage so

101
00:04:01,920 --> 00:04:05,200
um forgetting the ips um the hashes

102
00:04:05,200 --> 00:04:07,120
um for those familiar with the pyramid

103
00:04:07,120 --> 00:04:08,000
of pain

104
00:04:08,000 --> 00:04:10,959
the the easy stuff to report and uh

105
00:04:10,959 --> 00:04:12,720
report on is

106
00:04:12,720 --> 00:04:15,360
the atomic indicators uh such as i'd be

107
00:04:15,360 --> 00:04:17,918
addressing what's really tough is the

108
00:04:17,918 --> 00:04:20,639
top level which is the tradecraft that

109
00:04:20,639 --> 00:04:21,358
the

110
00:04:21,358 --> 00:04:24,000
actually uses so that's what we're

111
00:04:24,000 --> 00:04:27,360
aiming for um so

112
00:04:27,360 --> 00:04:28,639
uh

113
00:04:28,639 --> 00:04:31,040
so all our reports are free they're

114
00:04:31,040 --> 00:04:33,280
available on the website uh we've been

115
00:04:33,280 --> 00:04:36,080
reckoned by the us cert um various other

116
00:04:36,080 --> 00:04:38,720
organizations as well so the aim is to

117
00:04:38,720 --> 00:04:44,560
provide concise uh detailed um

118
00:04:44,720 --> 00:04:46,720
indicators and

119
00:04:46,720 --> 00:04:47,840
uh

120
00:04:47,840 --> 00:04:49,120
indicator

121
00:04:49,120 --> 00:04:51,600
activities and so on that that's doing

122
00:04:51,600 --> 00:04:53,840
so

123
00:04:54,240 --> 00:04:56,720
before i do a deep dive into

124
00:04:56,720 --> 00:05:00,800
uh the content um just a recap on opsec

125
00:05:00,800 --> 00:05:02,720
so

126
00:05:02,720 --> 00:05:05,120
so we just have to be a bit careful um

127
00:05:05,120 --> 00:05:07,440
so we provide cyber intelligence so the

128
00:05:07,440 --> 00:05:10,320
moment is out in the community

129
00:05:10,320 --> 00:05:13,360
both good and bad guys can utilize that

130
00:05:13,360 --> 00:05:14,880
so

131
00:05:14,880 --> 00:05:18,479
so we we do know that our intelligence

132
00:05:18,479 --> 00:05:20,560
has been used by

133
00:05:20,560 --> 00:05:23,199
attackers um they have been used by

134
00:05:23,199 --> 00:05:26,240
ransomware groups um so for example in

135
00:05:26,240 --> 00:05:29,680
the conti leagues county is a ransomware

136
00:05:29,680 --> 00:05:30,560
group

137
00:05:30,560 --> 00:05:33,680
they were breached uh end of last year

138
00:05:33,680 --> 00:05:35,360
early this year

139
00:05:35,360 --> 00:05:38,720
where an insider effectively leaked all

140
00:05:38,720 --> 00:05:41,520
their tradecraft or their internal chat

141
00:05:41,520 --> 00:05:43,280
discussions and so on

142
00:05:43,280 --> 00:05:44,479
and there were

143
00:05:44,479 --> 00:05:47,680
references to our reports in there

144
00:05:47,680 --> 00:05:50,400
they were using our report to track

145
00:05:50,400 --> 00:05:51,440
rival

146
00:05:51,440 --> 00:05:53,199
ransomware groups

147
00:05:53,199 --> 00:05:54,320
and

148
00:05:54,320 --> 00:05:56,160
yeah so that's quite interesting but it

149
00:05:56,160 --> 00:05:57,520
just goes to show

150
00:05:57,520 --> 00:06:00,240
um we knew that would happen um so

151
00:06:00,240 --> 00:06:02,319
anything else pushed out of there

152
00:06:02,319 --> 00:06:04,319
so we have to strike a balance between

153
00:06:04,319 --> 00:06:06,560
providing natural intelligence to the

154
00:06:06,560 --> 00:06:08,000
community

155
00:06:08,000 --> 00:06:09,680
but at the same time

156
00:06:09,680 --> 00:06:12,000
not to disclose our source i.e where the

157
00:06:12,000 --> 00:06:14,639
intrusion happened and

158
00:06:14,639 --> 00:06:16,240
the methods

159
00:06:16,240 --> 00:06:17,440
and the

160
00:06:17,440 --> 00:06:20,000
which methods in terms of like detection

161
00:06:20,000 --> 00:06:22,080
instant response and so on

162
00:06:22,080 --> 00:06:24,160
because they could have made that

163
00:06:24,160 --> 00:06:26,639
and that could potentially jeopardize

164
00:06:26,639 --> 00:06:28,160
future cases

165
00:06:28,160 --> 00:06:30,639
so for all of this we follow the traffic

166
00:06:30,639 --> 00:06:34,400
light protocol um to protect our data so

167
00:06:34,400 --> 00:06:35,280
any

168
00:06:35,280 --> 00:06:38,319
um identifiable data relating to the

169
00:06:38,319 --> 00:06:40,080
case itself which is like the

170
00:06:40,080 --> 00:06:42,560
environment such as the uh the ip

171
00:06:42,560 --> 00:06:45,600
addresses host names

172
00:06:45,600 --> 00:06:47,759
specific user accounts that kind of

173
00:06:47,759 --> 00:06:50,560
detail we will secure that in the report

174
00:06:50,560 --> 00:06:52,800
so you'll see in screenshots

175
00:06:52,800 --> 00:06:55,280
where they are redacted blacked out

176
00:06:55,280 --> 00:06:56,800
effectively

177
00:06:56,800 --> 00:06:58,560
there is no impact in terms of the

178
00:06:58,560 --> 00:07:00,479
threat intelligence because like i said

179
00:07:00,479 --> 00:07:02,479
before it's all about the activities the

180
00:07:02,479 --> 00:07:04,479
tools that they use to move around the

181
00:07:04,479 --> 00:07:06,479
network to achieve their goals so

182
00:07:06,479 --> 00:07:09,120
knowing the um

183
00:07:09,120 --> 00:07:10,960
the compromise environment is irrelevant

184
00:07:10,960 --> 00:07:12,960
to the third intelligence

185
00:07:12,960 --> 00:07:16,000
so the the brief

186
00:07:16,000 --> 00:07:17,280
um

187
00:07:17,280 --> 00:07:21,039
this presentation brief is tlp white so

188
00:07:21,039 --> 00:07:23,120
it can be released uh there's nothing

189
00:07:23,120 --> 00:07:25,360
sensitive in there um

190
00:07:25,360 --> 00:07:28,160
so anything watch tlp red

191
00:07:28,160 --> 00:07:32,240
we treat internally within our team

192
00:07:33,039 --> 00:07:35,280
so

193
00:07:35,280 --> 00:07:37,039
in order to provide reports we have to

194
00:07:37,039 --> 00:07:40,319
work with data so these are the four

195
00:07:40,319 --> 00:07:41,919
principal types of data that we work

196
00:07:41,919 --> 00:07:42,800
with

197
00:07:42,800 --> 00:07:45,599
um so

198
00:07:45,599 --> 00:07:47,919
so that all these are artifacts that we

199
00:07:47,919 --> 00:07:49,360
collect from the endpoints on the

200
00:07:49,360 --> 00:07:50,319
network

201
00:07:50,319 --> 00:07:54,400
um we don't do any hackback or probe any

202
00:07:54,400 --> 00:07:55,919
attacker infrastructure anything like

203
00:07:55,919 --> 00:07:57,520
that

204
00:07:57,520 --> 00:07:58,560
so

205
00:07:58,560 --> 00:08:01,440
the four artifacts are memory files

206
00:08:01,440 --> 00:08:03,280
networking logs

207
00:08:03,280 --> 00:08:06,240
so these are the core ingredients so to

208
00:08:06,240 --> 00:08:07,199
speak

209
00:08:07,199 --> 00:08:10,879
our main source is blocks

210
00:08:10,879 --> 00:08:13,680
because they are smaller inside

211
00:08:13,680 --> 00:08:16,400
um they typically track uh the whole

212
00:08:16,400 --> 00:08:19,360
intrusion from beginning to end and the

213
00:08:19,360 --> 00:08:21,919
the log sources come vary from

214
00:08:21,919 --> 00:08:25,120
everything from av logs to actual host

215
00:08:25,120 --> 00:08:26,879
logs themselves such as like

216
00:08:26,879 --> 00:08:29,280
authentication logs and it could include

217
00:08:29,280 --> 00:08:32,799
a web blogs around even edr logs and so

218
00:08:32,799 --> 00:08:37,120
on so it's quite a wide range

219
00:08:37,360 --> 00:08:39,360
collecting processing and storing that

220
00:08:39,360 --> 00:08:40,958
is cheap

221
00:08:40,958 --> 00:08:41,839
so

222
00:08:41,839 --> 00:08:43,839
so that's our principal data source that

223
00:08:43,839 --> 00:08:45,200
we work with

224
00:08:45,200 --> 00:08:47,760
and the the other useful data source

225
00:08:47,760 --> 00:08:51,279
that we have is network base so

226
00:08:51,279 --> 00:08:53,120
so we're looking at

227
00:08:53,120 --> 00:08:55,839
data on the wire so packet capture

228
00:08:55,839 --> 00:08:58,959
is fundamentally the raw data type

229
00:08:58,959 --> 00:09:00,080
these are

230
00:09:00,080 --> 00:09:03,120
larger in file size

231
00:09:03,120 --> 00:09:05,760
but we can use this because this if you

232
00:09:05,760 --> 00:09:08,240
capture the packet capture you can pull

233
00:09:08,240 --> 00:09:10,240
out a lot of useful information such as

234
00:09:10,240 --> 00:09:11,440
um

235
00:09:11,440 --> 00:09:15,279
to see to activity uh user agent strings

236
00:09:15,279 --> 00:09:16,480
obviously a

237
00:09:16,480 --> 00:09:20,080
domain supports and even

238
00:09:20,080 --> 00:09:21,120
data

239
00:09:21,120 --> 00:09:23,360
uh binary data that has gone across the

240
00:09:23,360 --> 00:09:27,519
wire so like downloaded files and um

241
00:09:27,519 --> 00:09:29,680
even like certificates so there's quite

242
00:09:29,680 --> 00:09:31,519
a lot of data that

243
00:09:31,519 --> 00:09:34,399
we could never get in the logs um the

244
00:09:34,399 --> 00:09:36,800
challenge we have with the network is

245
00:09:36,800 --> 00:09:38,720
just making sure having the right

246
00:09:38,720 --> 00:09:40,480
collector deployed on the right part of

247
00:09:40,480 --> 00:09:41,920
the network

248
00:09:41,920 --> 00:09:47,519
um the the other one is uh files so

249
00:09:47,519 --> 00:09:48,240
we

250
00:09:48,240 --> 00:09:50,880
usually focus our file collection on

251
00:09:50,880 --> 00:09:52,880
drop files so we're not going to pull

252
00:09:52,880 --> 00:09:54,800
all the files relating to

253
00:09:54,800 --> 00:09:57,040
the windows directory uh so we're

254
00:09:57,040 --> 00:09:58,080
looking for anything that's being

255
00:09:58,080 --> 00:10:00,080
tampered anything else in the use of

256
00:10:00,080 --> 00:10:02,839
folders things like that

257
00:10:02,839 --> 00:10:04,640
and

258
00:10:04,640 --> 00:10:07,200
again that that can vary and depending

259
00:10:07,200 --> 00:10:09,040
on the hosts and so on so it's quite

260
00:10:09,040 --> 00:10:11,360
important to your collections for doing

261
00:10:11,360 --> 00:10:13,600
uh that collection

262
00:10:13,600 --> 00:10:17,200
the lastly is memory so this is the

263
00:10:17,200 --> 00:10:20,160
largest file size um so that is driven

264
00:10:20,160 --> 00:10:21,680
by a host

265
00:10:21,680 --> 00:10:26,240
um so if you've got a host eyes um that

266
00:10:26,240 --> 00:10:28,959
has a large rum um

267
00:10:28,959 --> 00:10:31,600
memory coupon um doing a minimum dump on

268
00:10:31,600 --> 00:10:34,480
that could be quite um expensive

269
00:10:34,480 --> 00:10:38,399
there are challenges around that um so

270
00:10:38,399 --> 00:10:40,560
the memory itself can be like a snapshot

271
00:10:40,560 --> 00:10:43,200
in time so you really do need to capture

272
00:10:43,200 --> 00:10:46,560
um when you know that there's malware on

273
00:10:46,560 --> 00:10:47,360
there

274
00:10:47,360 --> 00:10:49,040
um

275
00:10:49,040 --> 00:10:51,360
well if you get the right memory capture

276
00:10:51,360 --> 00:10:53,440
you can't really exclude it by pulling

277
00:10:53,440 --> 00:10:55,360
out the malware understanding or

278
00:10:55,360 --> 00:10:56,880
configuring their processes and

279
00:10:56,880 --> 00:10:58,240
correlating that back to the lock

280
00:10:58,240 --> 00:10:59,279
sources

281
00:10:59,279 --> 00:11:02,160
so it is quite rich well that is very

282
00:11:02,160 --> 00:11:04,640
detailed really adept it's only on one

283
00:11:04,640 --> 00:11:06,880
house so you don't forget you've got

284
00:11:06,880 --> 00:11:09,600
multiple hosts on the network so

285
00:11:09,600 --> 00:11:11,600
you need to really think about

286
00:11:11,600 --> 00:11:14,160
how do i do this at scale and do a do i

287
00:11:14,160 --> 00:11:15,519
really want to do and when we jump to

288
00:11:15,519 --> 00:11:17,120
every single house or just focus on

289
00:11:17,120 --> 00:11:19,839
particular ones of interest so they're

290
00:11:19,839 --> 00:11:22,800
the kind of data that we work with

291
00:11:22,800 --> 00:11:24,160
so

292
00:11:24,160 --> 00:11:26,240
we structure the report in a way that

293
00:11:26,240 --> 00:11:28,880
provides a timeline of the intrusion

294
00:11:28,880 --> 00:11:29,839
so

295
00:11:29,839 --> 00:11:32,000
that's the best way where it articulates

296
00:11:32,000 --> 00:11:34,079
uh the beginning to end what the

297
00:11:34,079 --> 00:11:36,560
attacker did on one day to the next day

298
00:11:36,560 --> 00:11:38,640
if there are any gaps

299
00:11:38,640 --> 00:11:40,959
then we document each stage of the

300
00:11:40,959 --> 00:11:43,200
intrusion bar the technique so we tried

301
00:11:43,200 --> 00:11:45,279
to use a mighty attack because it's a

302
00:11:45,279 --> 00:11:47,200
very good way of

303
00:11:47,200 --> 00:11:48,399
um

304
00:11:48,399 --> 00:11:50,240
it's a common language everyone

305
00:11:50,240 --> 00:11:52,560
is broadly familiar with might attack

306
00:11:52,560 --> 00:11:54,079
techniques

307
00:11:54,079 --> 00:11:54,959
so

308
00:11:54,959 --> 00:11:57,120
so we tried to call it against her

309
00:11:57,120 --> 00:11:59,200
and then we also provide screenshots as

310
00:11:59,200 --> 00:12:02,480
well um where we come in the reports

311
00:12:02,480 --> 00:12:06,000
and in the case of ransomware attacks

312
00:12:06,000 --> 00:12:07,760
uh there's a lot of emphasis in other

313
00:12:07,760 --> 00:12:11,040
cyberpunk intelligence providing ioc on

314
00:12:11,040 --> 00:12:13,040
the the encrypted bit which is right at

315
00:12:13,040 --> 00:12:14,079
the end

316
00:12:14,079 --> 00:12:16,240
so we don't just focus on that we focus

317
00:12:16,240 --> 00:12:18,639
on the whole chain so what tools do they

318
00:12:18,639 --> 00:12:21,760
use quiet uh deploying the encrypter

319
00:12:21,760 --> 00:12:24,480
and we also took cover about how they

320
00:12:24,480 --> 00:12:26,240
established the sport how did they get

321
00:12:26,240 --> 00:12:28,800
onto the network and so on

322
00:12:28,800 --> 00:12:30,399
and

323
00:12:30,399 --> 00:12:32,320
so we try to focus on indicator

324
00:12:32,320 --> 00:12:35,440
activities but we do provide the iocs um

325
00:12:35,440 --> 00:12:38,480
as well um but we do try and make a

326
00:12:38,480 --> 00:12:42,240
strong point on activities

327
00:12:42,240 --> 00:12:43,200
so

328
00:12:43,200 --> 00:12:46,480
in most of our cases uh the

329
00:12:46,480 --> 00:12:48,240
initial access

330
00:12:48,240 --> 00:12:50,800
starts with official email and most not

331
00:12:50,800 --> 00:12:52,399
all but in most

332
00:12:52,399 --> 00:12:54,880
so here's some example screenshots that

333
00:12:54,880 --> 00:12:56,079
we've got from

334
00:12:56,079 --> 00:12:57,760
some cases

335
00:12:57,760 --> 00:12:59,200
and

336
00:12:59,200 --> 00:13:01,680
yeah and then ultimately it ends in a

337
00:13:01,680 --> 00:13:03,920
ransomware notebook

338
00:13:03,920 --> 00:13:05,839
dropped on a desktop or presented on the

339
00:13:05,839 --> 00:13:07,440
screen

340
00:13:07,440 --> 00:13:09,680
but it doesn't happen by magic it's not

341
00:13:09,680 --> 00:13:11,680
like an email comes in an attachment

342
00:13:11,680 --> 00:13:13,360
someone clicks on it and boom the whole

343
00:13:13,360 --> 00:13:15,360
network's encrypted

344
00:13:15,360 --> 00:13:17,200
there is a

345
00:13:17,200 --> 00:13:20,000
chain of events um and there's it's

346
00:13:20,000 --> 00:13:21,760
quite it can get quite complicated on

347
00:13:21,760 --> 00:13:23,200
the depending on the scale of the

348
00:13:23,200 --> 00:13:24,320
network

349
00:13:24,320 --> 00:13:25,120
so

350
00:13:25,120 --> 00:13:27,040
there's activities about

351
00:13:27,040 --> 00:13:28,480
okay once the user's clicked on

352
00:13:28,480 --> 00:13:30,959
somewhere uh how do they maintain the

353
00:13:30,959 --> 00:13:33,600
footload and then from there how do they

354
00:13:33,600 --> 00:13:36,399
discover other assets of interest and

355
00:13:36,399 --> 00:13:38,800
then how do they move around the network

356
00:13:38,800 --> 00:13:40,959
where do they find those critical files

357
00:13:40,959 --> 00:13:43,440
and then at one point at what point did

358
00:13:43,440 --> 00:13:45,440
they exploit and then how do they

359
00:13:45,440 --> 00:13:48,880
encrypt it and so on so

360
00:13:48,880 --> 00:13:52,079
the initial access to ransom

361
00:13:52,079 --> 00:13:54,000
uh the shortage we've seen is about two

362
00:13:54,000 --> 00:13:57,360
hours um more complex cases it's been

363
00:13:57,360 --> 00:14:00,800
weeks so again it does vary um and i

364
00:14:00,800 --> 00:14:03,040
think part of it it does depend on the

365
00:14:03,040 --> 00:14:06,160
size of the network um and how easy it

366
00:14:06,160 --> 00:14:08,639
is to get to those critical files to

367
00:14:08,639 --> 00:14:11,920
encrypt them so

368
00:14:12,000 --> 00:14:13,680
so let's start off with the initial

369
00:14:13,680 --> 00:14:16,639
access so this is the um

370
00:14:16,639 --> 00:14:17,920
the email

371
00:14:17,920 --> 00:14:18,720
so

372
00:14:18,720 --> 00:14:20,639
a lot of the the malware variants that

373
00:14:20,639 --> 00:14:22,000
come through are

374
00:14:22,000 --> 00:14:24,639
uh tend to be like ice id reserved trick

375
00:14:24,639 --> 00:14:25,440
part

376
00:14:25,440 --> 00:14:27,680
so they come through uh mousepam

377
00:14:27,680 --> 00:14:28,880
campaigns

378
00:14:28,880 --> 00:14:30,480
um so

379
00:14:30,480 --> 00:14:32,639
that is fairly sophisticated malware

380
00:14:32,639 --> 00:14:34,399
they've been operating for a number of

381
00:14:34,399 --> 00:14:35,199
years

382
00:14:35,199 --> 00:14:36,160
um

383
00:14:36,160 --> 00:14:38,240
the the malware variants are actually

384
00:14:38,240 --> 00:14:39,920
developed

385
00:14:39,920 --> 00:14:43,040
it's designed to evade security tooling

386
00:14:43,040 --> 00:14:45,920
and they've been successful

387
00:14:45,920 --> 00:14:47,760
and they're continuing to do that they

388
00:14:47,760 --> 00:14:49,519
do go through phases

389
00:14:49,519 --> 00:14:51,680
where there'll be takedowns of networks

390
00:14:51,680 --> 00:14:53,839
and then they're rebuild and

391
00:14:53,839 --> 00:14:56,320
launch again

392
00:14:56,320 --> 00:14:58,720
so the malware variants typically tend

393
00:14:58,720 --> 00:15:00,560
to be um

394
00:15:00,560 --> 00:15:02,079
an email with

395
00:15:02,079 --> 00:15:05,040
embedded documents or macro based

396
00:15:05,040 --> 00:15:06,800
documents that kind of thing

397
00:15:06,800 --> 00:15:07,839
um

398
00:15:07,839 --> 00:15:09,680
in the last few months

399
00:15:09,680 --> 00:15:10,880
we've seen

400
00:15:10,880 --> 00:15:14,480
characters using iso images

401
00:15:14,480 --> 00:15:16,639
so effectively these are like containers

402
00:15:16,639 --> 00:15:18,399
and then there there are

403
00:15:18,399 --> 00:15:21,360
an initial payload embedded in there

404
00:15:21,360 --> 00:15:23,760
and that's designed to avoid the mark of

405
00:15:23,760 --> 00:15:24,880
the web

406
00:15:24,880 --> 00:15:28,160
so that is designed um to bypass content

407
00:15:28,160 --> 00:15:30,399
uh build to him and endpoint security to

408
00:15:30,399 --> 00:15:31,360
them

409
00:15:31,360 --> 00:15:32,160
so

410
00:15:32,160 --> 00:15:34,480
in one case the iso image contained a

411
00:15:34,480 --> 00:15:37,279
legitimate looking shortcut file link

412
00:15:37,279 --> 00:15:39,120
and in there there is a

413
00:15:39,120 --> 00:15:40,800
malicious dll

414
00:15:40,800 --> 00:15:41,839
so

415
00:15:41,839 --> 00:15:43,600
when the user clicks the uh the link

416
00:15:43,600 --> 00:15:47,040
file the dll gets executed

417
00:15:47,040 --> 00:15:50,079
for example by run dll32 and then the

418
00:15:50,079 --> 00:15:51,519
bizarre load of infection chain is

419
00:15:51,519 --> 00:15:52,839
initiated

420
00:15:52,839 --> 00:15:56,720
so quite simple uh it can be quite

421
00:15:56,720 --> 00:15:59,600
complex it just requires uh the user

422
00:15:59,600 --> 00:16:01,839
clicking um following instructions an

423
00:16:01,839 --> 00:16:04,560
email but a well-crafted email

424
00:16:04,560 --> 00:16:07,839
targeted an unsuspecting user who's

425
00:16:07,839 --> 00:16:10,240
either expecting a similar email or just

426
00:16:10,240 --> 00:16:11,839
not educated

427
00:16:11,839 --> 00:16:14,480
it does happen um and they've been very

428
00:16:14,480 --> 00:16:15,839
effective at that

429
00:16:15,839 --> 00:16:19,279
so after again in the initial put out um

430
00:16:19,279 --> 00:16:21,199
we've seen tripod

431
00:16:21,199 --> 00:16:23,519
serving as access brokers

432
00:16:23,519 --> 00:16:25,680
for various ransomware groups

433
00:16:25,680 --> 00:16:29,120
so the biggest one is county

434
00:16:29,120 --> 00:16:30,079
so

435
00:16:30,079 --> 00:16:32,800
last september um

436
00:16:32,800 --> 00:16:34,959
like i say it wasn't just emails we saw

437
00:16:34,959 --> 00:16:38,880
an intrusion what came via a proxy shell

438
00:16:38,880 --> 00:16:41,360
on microsoft exchange

439
00:16:41,360 --> 00:16:43,199
so this is the only case that we've

440
00:16:43,199 --> 00:16:45,120
really seen where vulnerability was

441
00:16:45,120 --> 00:16:46,240
exploited

442
00:16:46,240 --> 00:16:47,360
so

443
00:16:47,360 --> 00:16:49,040
at the time

444
00:16:49,040 --> 00:16:50,399
proxy shell

445
00:16:50,399 --> 00:16:52,880
um was quite easy to access quite high

446
00:16:52,880 --> 00:16:54,320
severity

447
00:16:54,320 --> 00:16:56,959
publication so it just had the right

448
00:16:56,959 --> 00:16:58,560
ingredients to

449
00:16:58,560 --> 00:17:01,360
uh exploit and there was proof of code

450
00:17:01,360 --> 00:17:03,120
concept code released

451
00:17:03,120 --> 00:17:04,880
so it's quite easy for the threat group

452
00:17:04,880 --> 00:17:07,599
to pick that up weaponize them and

453
00:17:07,599 --> 00:17:08,720
incorporate it as part of their

454
00:17:08,720 --> 00:17:10,720
techniques

455
00:17:10,720 --> 00:17:12,640
so

456
00:17:12,640 --> 00:17:15,199
accessing vulnerabilities um

457
00:17:15,199 --> 00:17:17,039
is quite hard

458
00:17:17,039 --> 00:17:18,959
so they tried to go for vulnerabilities

459
00:17:18,959 --> 00:17:21,359
that are quite um that could impact a

460
00:17:21,359 --> 00:17:22,400
number of different types of

461
00:17:22,400 --> 00:17:25,359
organizations so exchange is a popular

462
00:17:25,359 --> 00:17:26,240
vector

463
00:17:26,240 --> 00:17:27,919
so

464
00:17:27,919 --> 00:17:31,520
so from a detection point of view from

465
00:17:31,520 --> 00:17:32,799
documents

466
00:17:32,799 --> 00:17:35,039
we can look for office applications that

467
00:17:35,039 --> 00:17:38,080
are spawning unusual chair processes

468
00:17:38,080 --> 00:17:40,720
such as living upper land binaries

469
00:17:40,720 --> 00:17:44,080
such as red surface 32 run dll and even

470
00:17:44,080 --> 00:17:47,600
direct calls to command.exe

471
00:17:47,600 --> 00:17:48,880
so

472
00:17:48,880 --> 00:17:51,280
the business email compromise is still a

473
00:17:51,280 --> 00:17:53,520
call for the attacker it's still active

474
00:17:53,520 --> 00:17:55,039
it's still happening now

475
00:17:55,039 --> 00:17:55,840
so

476
00:17:55,840 --> 00:17:58,000
it's designed to bypass

477
00:17:58,000 --> 00:18:00,080
the endpoint security tool and it's a

478
00:18:00,080 --> 00:18:02,640
kind of mouse game though uh constantly

479
00:18:02,640 --> 00:18:04,160
evolve and you've seen recent

480
00:18:04,160 --> 00:18:06,320
vulnerabilities in the last month or so

481
00:18:06,320 --> 00:18:08,240
certainly new features being exploited

482
00:18:08,240 --> 00:18:11,760
in uh microsoft office um it's just

483
00:18:11,760 --> 00:18:15,120
never ending so in this example we can

484
00:18:15,120 --> 00:18:17,760
see quite a complex precious execution

485
00:18:17,760 --> 00:18:20,799
tree uh where document has multiple

486
00:18:20,799 --> 00:18:23,600
different payloads and ways of execution

487
00:18:23,600 --> 00:18:25,679
so it's multi-stage

488
00:18:25,679 --> 00:18:28,080
so it's it's been in the process and

489
00:18:28,080 --> 00:18:30,559
then reaching out uh downloading the

490
00:18:30,559 --> 00:18:32,320
files spinning up another process

491
00:18:32,320 --> 00:18:33,440
calling

492
00:18:33,440 --> 00:18:34,559
an

493
00:18:34,559 --> 00:18:36,720
html application and then i took it

494
00:18:36,720 --> 00:18:40,400
something out so very complex

495
00:18:40,400 --> 00:18:42,960
and then this one the dll is much graded

496
00:18:42,960 --> 00:18:44,320
as a jpeg

497
00:18:44,320 --> 00:18:45,679
so

498
00:18:45,679 --> 00:18:47,760
so despite attempts to evade a lot of

499
00:18:47,760 --> 00:18:50,400
the security tooling and so on

500
00:18:50,400 --> 00:18:52,160
looking at that you can say that's not

501
00:18:52,160 --> 00:18:54,720
normal um so if you've got that

502
00:18:54,720 --> 00:18:56,799
telemetry being collected you should be

503
00:18:56,799 --> 00:19:00,400
able to see that and it is unusual

504
00:19:00,400 --> 00:19:01,600
um

505
00:19:01,600 --> 00:19:02,640
so

506
00:19:02,640 --> 00:19:04,320
looking for unexpected process

507
00:19:04,320 --> 00:19:06,480
interactions files being dropped into

508
00:19:06,480 --> 00:19:08,320
non-standard locations such as temp

509
00:19:08,320 --> 00:19:11,200
coders especially dlls and so on they're

510
00:19:11,200 --> 00:19:14,799
really obvious kind of indicators

511
00:19:15,280 --> 00:19:18,240
so the next step is okay they've got

512
00:19:18,240 --> 00:19:19,280
access

513
00:19:19,280 --> 00:19:23,360
is maintaining a photo on that endpoint

514
00:19:23,360 --> 00:19:25,520
so it's still fairly fragile the process

515
00:19:25,520 --> 00:19:27,679
could crash terminate and they've lost

516
00:19:27,679 --> 00:19:29,840
access again it would require the user

517
00:19:29,840 --> 00:19:31,360
clicking on it again

518
00:19:31,360 --> 00:19:32,960
so

519
00:19:32,960 --> 00:19:35,200
so they the factors will employ several

520
00:19:35,200 --> 00:19:38,720
techniques to maintain that photo so

521
00:19:38,720 --> 00:19:41,600
common ones are what we saw in 50 of our

522
00:19:41,600 --> 00:19:42,559
cases

523
00:19:42,559 --> 00:19:45,360
is creation of scheduled tasks so this

524
00:19:45,360 --> 00:19:47,360
is effectively like a back door

525
00:19:47,360 --> 00:19:48,320
so

526
00:19:48,320 --> 00:19:50,160
another popular technique that attackers

527
00:19:50,160 --> 00:19:53,840
perform is the creation of new users on

528
00:19:53,840 --> 00:19:56,799
the the endpoint and then adding users

529
00:19:56,799 --> 00:20:00,400
to local admins or remote desktops users

530
00:20:00,400 --> 00:20:02,080
as well so

531
00:20:02,080 --> 00:20:04,159
it doesn't depend on that user account

532
00:20:04,159 --> 00:20:06,080
so if the user logs out they've got

533
00:20:06,080 --> 00:20:08,880
always a means of getting back into them

534
00:20:08,880 --> 00:20:12,640
uh in another case we saw a pitch job

535
00:20:12,640 --> 00:20:13,840
being created

536
00:20:13,840 --> 00:20:14,799
um

537
00:20:14,799 --> 00:20:17,919
and i was calling a malicious dll uh

538
00:20:17,919 --> 00:20:19,360
every three hours

539
00:20:19,360 --> 00:20:21,760
for the length of the intrusion so

540
00:20:21,760 --> 00:20:23,520
various different ways of maintaining uh

541
00:20:23,520 --> 00:20:25,280
persistence

542
00:20:25,280 --> 00:20:27,280
um they

543
00:20:27,280 --> 00:20:28,240
also

544
00:20:28,240 --> 00:20:31,440
um what we have seen there is deploy the

545
00:20:31,440 --> 00:20:34,240
likes of teamviewer any desk top

546
00:20:34,240 --> 00:20:36,880
artillery agent so these are legitimate

547
00:20:36,880 --> 00:20:38,720
remote access tools

548
00:20:38,720 --> 00:20:41,679
and so if an organization is using that

549
00:20:41,679 --> 00:20:43,760
that could appear legitimate

550
00:20:43,760 --> 00:20:46,559
and again there's always a risk that if

551
00:20:46,559 --> 00:20:48,159
they've used their initial access to

552
00:20:48,159 --> 00:20:51,120
game and it is malware it could get

553
00:20:51,120 --> 00:20:53,280
detected at some point by an av and

554
00:20:53,280 --> 00:20:55,760
they're just bearing access so having a

555
00:20:55,760 --> 00:20:57,760
legitimate meaning to stay on there

556
00:20:57,760 --> 00:20:59,919
again that's another technique

557
00:20:59,919 --> 00:21:01,039
so

558
00:21:01,039 --> 00:21:03,120
if you understand your baseline

559
00:21:03,120 --> 00:21:05,520
so if you know you don't use those tools

560
00:21:05,520 --> 00:21:07,760
um and then you start seeing the network

561
00:21:07,760 --> 00:21:10,159
traffic to splashtop servers again

562
00:21:10,159 --> 00:21:12,720
that's definitely worth investigating if

563
00:21:12,720 --> 00:21:14,720
it starts here and tools being dropped

564
00:21:14,720 --> 00:21:16,559
and installed on those endpoint with

565
00:21:16,559 --> 00:21:18,799
remote access capabilities that should

566
00:21:18,799 --> 00:21:20,480
be a red flag and certainly something

567
00:21:20,480 --> 00:21:22,640
where it should be locked down

568
00:21:22,640 --> 00:21:23,760
and

569
00:21:23,760 --> 00:21:24,640
the

570
00:21:24,640 --> 00:21:26,799
then the obvious ones are one key

571
00:21:26,799 --> 00:21:31,120
registry so very easy to do so if um add

572
00:21:31,120 --> 00:21:33,760
a new one key so if you use it just log

573
00:21:33,760 --> 00:21:36,480
out log back in there just stop again

574
00:21:36,480 --> 00:21:38,080
and

575
00:21:38,080 --> 00:21:40,799
in the likes of proxy show vulnerability

576
00:21:40,799 --> 00:21:42,400
um

577
00:21:42,400 --> 00:21:44,159
that was slightly different and they

578
00:21:44,159 --> 00:21:46,640
ended up dropping a lot of web shelves

579
00:21:46,640 --> 00:21:49,200
um to maintain access on there again

580
00:21:49,200 --> 00:21:50,960
they were very conscious that they were

581
00:21:50,960 --> 00:21:53,520
using a properly available

582
00:21:53,520 --> 00:21:55,440
exploit that could be detected and

583
00:21:55,440 --> 00:21:57,120
removed or if they change the

584
00:21:57,120 --> 00:21:59,360
configuration add in a backdoor web

585
00:21:59,360 --> 00:22:00,159
shell

586
00:22:00,159 --> 00:22:02,400
um that's a good way to hide their

587
00:22:02,400 --> 00:22:04,799
access

588
00:22:04,799 --> 00:22:06,559
um

589
00:22:06,559 --> 00:22:07,360
the

590
00:22:07,360 --> 00:22:09,840
the next stage okay they got initial

591
00:22:09,840 --> 00:22:12,880
access they've established photo so

592
00:22:12,880 --> 00:22:14,880
they're in a good position um they know

593
00:22:14,880 --> 00:22:16,320
they've got

594
00:22:16,320 --> 00:22:19,840
remote access to that machine though so

595
00:22:19,840 --> 00:22:21,600
but they're still uh

596
00:22:21,600 --> 00:22:23,039
nowhere near to

597
00:22:23,039 --> 00:22:27,200
uh run somewhere in the environment so

598
00:22:27,200 --> 00:22:28,559
in order to

599
00:22:28,559 --> 00:22:30,720
deliver their pets uh they need to

600
00:22:30,720 --> 00:22:33,120
understand that environment so

601
00:22:33,120 --> 00:22:35,520
they ideally what they're aiming for is

602
00:22:35,520 --> 00:22:37,440
to escalate their privileges because the

603
00:22:37,440 --> 00:22:39,280
chances are the user account they

604
00:22:39,280 --> 00:22:42,000
compromise is probably just a general

605
00:22:42,000 --> 00:22:44,159
enterprise user um probably didn't have

606
00:22:44,159 --> 00:22:46,799
much access um apart from accessing a

607
00:22:46,799 --> 00:22:48,559
few file shares

608
00:22:48,559 --> 00:22:50,960
and other resources so they really need

609
00:22:50,960 --> 00:22:54,799
to get higher level privileges so

610
00:22:54,799 --> 00:22:57,520
in virtual cases that we've come across

611
00:22:57,520 --> 00:22:59,120
they've always deployed a couple slide

612
00:22:59,120 --> 00:23:00,080
beacon

613
00:23:00,080 --> 00:23:00,960
um

614
00:23:00,960 --> 00:23:03,039
that is very common

615
00:23:03,039 --> 00:23:04,799
as part of their tradecraft

616
00:23:04,799 --> 00:23:08,320
and they use the built-in function

617
00:23:08,320 --> 00:23:09,840
the technical name namepipe

618
00:23:09,840 --> 00:23:12,799
impersonation also known as getsystem

619
00:23:12,799 --> 00:23:13,840
and

620
00:23:13,840 --> 00:23:17,120
so they use our as a service to

621
00:23:17,120 --> 00:23:19,919
effectively get system level privileges

622
00:23:19,919 --> 00:23:23,679
there's a great article on red canary

623
00:23:23,679 --> 00:23:26,159
titled hunting for get system in

624
00:23:26,159 --> 00:23:28,320
offensive security tools so they go

625
00:23:28,320 --> 00:23:30,640
through a lot of detail about how that

626
00:23:30,640 --> 00:23:32,640
punching works

627
00:23:32,640 --> 00:23:35,440
methods of detection

628
00:23:35,440 --> 00:23:37,280
one of our fellow analysts um he's

629
00:23:37,280 --> 00:23:40,880
created a series of uh blogs um

630
00:23:40,880 --> 00:23:43,200
called strike defenders guide and it's

631
00:23:43,200 --> 00:23:45,600
available on the website as well so

632
00:23:45,600 --> 00:23:47,440
there's a lot of detection indicators to

633
00:23:47,440 --> 00:23:49,120
work through from there

634
00:23:49,120 --> 00:23:52,320
and we've also seen um

635
00:23:52,320 --> 00:23:54,000
powershell

636
00:23:54,000 --> 00:23:57,360
which bypasses usc um so again i mean to

637
00:23:57,360 --> 00:23:59,760
getting into our integrity

638
00:23:59,760 --> 00:24:03,440
so once they got that system level

639
00:24:03,440 --> 00:24:04,960
they really want to be moving around the

640
00:24:04,960 --> 00:24:07,919
network and they can start targeting the

641
00:24:07,919 --> 00:24:10,320
lsas process so that is a privileged

642
00:24:10,320 --> 00:24:11,760
process

643
00:24:11,760 --> 00:24:13,679
that does a lot of the interactions and

644
00:24:13,679 --> 00:24:16,840
authentication to a lot of the host

645
00:24:16,840 --> 00:24:20,000
um resources and other resources on the

646
00:24:20,000 --> 00:24:21,120
network

647
00:24:21,120 --> 00:24:22,240
and

648
00:24:22,240 --> 00:24:25,600
in a mo in the majority of the cases um

649
00:24:25,600 --> 00:24:28,159
the primary mechanism for interacting

650
00:24:28,159 --> 00:24:29,360
with that

651
00:24:29,360 --> 00:24:31,760
is via cobblestrike beacons

652
00:24:31,760 --> 00:24:32,559
so

653
00:24:32,559 --> 00:24:35,120
other methods um quite simple but

654
00:24:35,120 --> 00:24:37,440
effective uh dumping of the outside

655
00:24:37,440 --> 00:24:40,000
process um so they're effectively take a

656
00:24:40,000 --> 00:24:41,279
memory dump

657
00:24:41,279 --> 00:24:42,320
and then

658
00:24:42,320 --> 00:24:44,559
they'll use things like system terminals

659
00:24:44,559 --> 00:24:46,880
produm again legitimate tool developed

660
00:24:46,880 --> 00:24:48,480
by microsoft

661
00:24:48,480 --> 00:24:51,200
um it's primarily used for debugging

662
00:24:51,200 --> 00:24:53,520
applications and so on there's dumping

663
00:24:53,520 --> 00:24:56,320
process memory

664
00:24:56,320 --> 00:24:58,159
even using task manager if you've got

665
00:24:58,159 --> 00:25:00,880
that level of privilege uh another

666
00:25:00,880 --> 00:25:04,400
fairly infamous one is mimikat so

667
00:25:04,400 --> 00:25:08,880
that should be fairly rare and it's

668
00:25:08,880 --> 00:25:10,799
that should trigger a lot of antivirus

669
00:25:10,799 --> 00:25:13,360
alerts so if you do see that morning on

670
00:25:13,360 --> 00:25:15,919
the endpoints and when we cut two

671
00:25:15,919 --> 00:25:18,559
yeah i always pay attention to that

672
00:25:18,559 --> 00:25:21,200
it's primarily used by pentesters red

673
00:25:21,200 --> 00:25:22,799
teamers

674
00:25:22,799 --> 00:25:25,120
it could be used internally for testing

675
00:25:25,120 --> 00:25:27,120
security tools

676
00:25:27,120 --> 00:25:29,279
and controls but if you do see um and if

677
00:25:29,279 --> 00:25:30,559
you're not seeing that then i'll be

678
00:25:30,559 --> 00:25:32,720
really concerned about the av

679
00:25:32,720 --> 00:25:33,679
so

680
00:25:33,679 --> 00:25:36,320
not so common is dumping the the

681
00:25:36,320 --> 00:25:37,760
registry hives

682
00:25:37,760 --> 00:25:40,159
especially the same security and system

683
00:25:40,159 --> 00:25:42,240
registry hives

684
00:25:42,240 --> 00:25:44,159
so

685
00:25:44,159 --> 00:25:46,559
so while performing all of these because

686
00:25:46,559 --> 00:25:47,679
they are

687
00:25:47,679 --> 00:25:50,159
doing fairly dangerous

688
00:25:50,159 --> 00:25:53,039
activities now

689
00:25:53,520 --> 00:25:57,120
accessing credential resources and a lot

690
00:25:57,120 --> 00:25:59,520
of the tool and should detect that

691
00:25:59,520 --> 00:26:01,520
um but they're what they would do prior

692
00:26:01,520 --> 00:26:04,240
to that so they will take certain

693
00:26:04,240 --> 00:26:06,880
measures to avoid getting caught

694
00:26:06,880 --> 00:26:09,520
and one of those is discovering the

695
00:26:09,520 --> 00:26:11,200
installed antivirus

696
00:26:11,200 --> 00:26:14,240
um disabling those so

697
00:26:14,240 --> 00:26:16,159
some of the common techniques are making

698
00:26:16,159 --> 00:26:18,720
registered keys and a gpo and disabling

699
00:26:18,720 --> 00:26:20,640
defender for example

700
00:26:20,640 --> 00:26:22,480
so we see that quite a lot

701
00:26:22,480 --> 00:26:24,720
and there are some other tools out there

702
00:26:24,720 --> 00:26:27,120
such as defender control which where you

703
00:26:27,120 --> 00:26:29,840
can disable like uh cloud submission and

704
00:26:29,840 --> 00:26:31,279
all that kind of thing

705
00:26:31,279 --> 00:26:33,919
so again look for that if you've got

706
00:26:33,919 --> 00:26:36,240
visibility the avs and all of a sudden

707
00:26:36,240 --> 00:26:37,520
you've got endpoints that aren't

708
00:26:37,520 --> 00:26:39,440
updating or communicating to you then

709
00:26:39,440 --> 00:26:41,760
it's definitely worth investigating

710
00:26:41,760 --> 00:26:45,200
um the the other technique is uh process

711
00:26:45,200 --> 00:26:47,760
injection so where

712
00:26:47,760 --> 00:26:49,600
they spawn the process but what they

713
00:26:49,600 --> 00:26:52,960
need to do really is hype up beacon and

714
00:26:52,960 --> 00:26:55,840
i'll migrate into another process

715
00:26:55,840 --> 00:26:57,520
which is legitimate

716
00:26:57,520 --> 00:27:01,440
so again it's all about evasion

717
00:27:01,440 --> 00:27:02,880
so

718
00:27:02,880 --> 00:27:04,840
just expanding a bit more on

719
00:27:04,840 --> 00:27:07,120
discovery they spend a lot of time doing

720
00:27:07,120 --> 00:27:10,480
discovery so they perform a number of

721
00:27:10,480 --> 00:27:12,159
discovery commands

722
00:27:12,159 --> 00:27:14,559
and they'll do that frequently so they

723
00:27:14,559 --> 00:27:16,480
won't just do it once on the endpoint

724
00:27:16,480 --> 00:27:18,000
they'll be doing it across multiple

725
00:27:18,000 --> 00:27:21,279
endpoints and the discoveries can vary

726
00:27:21,279 --> 00:27:22,960
from doing

727
00:27:22,960 --> 00:27:25,279
uh looking at security tools

728
00:27:25,279 --> 00:27:28,480
determining what users locked in

729
00:27:28,480 --> 00:27:30,799
what files are installed and trying to

730
00:27:30,799 --> 00:27:32,840
find credentials and so on so it's

731
00:27:32,840 --> 00:27:35,600
continuous um some of the common tools

732
00:27:35,600 --> 00:27:37,520
we see living off the land built in

733
00:27:37,520 --> 00:27:42,399
windows features is net.exe and lts for

734
00:27:42,399 --> 00:27:44,080
network discovery they want to see if

735
00:27:44,080 --> 00:27:45,919
that endpoint is connected to any other

736
00:27:45,919 --> 00:27:46,880
endpoints

737
00:27:46,880 --> 00:27:49,279
so you see them running really quick

738
00:27:49,279 --> 00:27:50,399
succession

739
00:27:50,399 --> 00:27:54,559
it's pretty unusual um you may see

740
00:27:54,559 --> 00:27:56,480
admin scripts doing that as part of a

741
00:27:56,480 --> 00:27:58,000
configuration

742
00:27:58,000 --> 00:28:01,039
testing but it's a normal environment

743
00:28:01,039 --> 00:28:02,799
should if you start seeing

744
00:28:02,799 --> 00:28:05,520
dozens and dozens of probing activity

745
00:28:05,520 --> 00:28:07,600
that should be a red flag

746
00:28:07,600 --> 00:28:08,559
and

747
00:28:08,559 --> 00:28:10,640
the other on the graph

748
00:28:10,640 --> 00:28:12,159
there's a lot of different windows

749
00:28:12,159 --> 00:28:13,919
commands that they use across all the

750
00:28:13,919 --> 00:28:15,440
intrusions

751
00:28:15,440 --> 00:28:16,559
but

752
00:28:16,559 --> 00:28:18,640
they also bring in a lot of other tools

753
00:28:18,640 --> 00:28:20,799
onto the environment as well

754
00:28:20,799 --> 00:28:22,640
and so

755
00:28:22,640 --> 00:28:25,039
two of the common tools that we see

756
00:28:25,039 --> 00:28:27,440
repeatedly across our cases

757
00:28:27,440 --> 00:28:29,840
one is advined and another one is

758
00:28:29,840 --> 00:28:32,080
bloodhound so both of those are used for

759
00:28:32,080 --> 00:28:34,159
active directory enumeration

760
00:28:34,159 --> 00:28:38,240
um again quite quite noisy um bloodhound

761
00:28:38,240 --> 00:28:41,039
as a bar as a binary the collectable it

762
00:28:41,039 --> 00:28:45,200
should get detected by avs and so on

763
00:28:45,200 --> 00:28:47,760
tools like adfine may not get detected

764
00:28:47,760 --> 00:28:51,440
by avs because it is a legitimate

765
00:28:51,440 --> 00:28:54,480
system admin tool

766
00:28:54,720 --> 00:28:56,240
other types of tools they use for

767
00:28:56,240 --> 00:28:59,120
program are post gunning tools um a

768
00:28:59,120 --> 00:29:01,840
common one is advanced ip scanner we see

769
00:29:01,840 --> 00:29:03,200
that quite a lot

770
00:29:03,200 --> 00:29:05,279
just being dropped and effectively

771
00:29:05,279 --> 00:29:07,440
almost like end mapped across the uh the

772
00:29:07,440 --> 00:29:10,240
network and other ones like kp uh port

773
00:29:10,240 --> 00:29:11,679
scan

774
00:29:11,679 --> 00:29:14,320
in the uh the proxy show and the the

775
00:29:14,320 --> 00:29:16,399
exchange um

776
00:29:16,399 --> 00:29:17,360
we saw

777
00:29:17,360 --> 00:29:20,080
command that's been exploited um such as

778
00:29:20,080 --> 00:29:22,799
get inbox rule get mailbox those kind of

779
00:29:22,799 --> 00:29:25,760
things again very unusual

780
00:29:25,760 --> 00:29:28,240
it's not someone you see all the time

781
00:29:28,240 --> 00:29:30,240
and

782
00:29:30,240 --> 00:29:31,919
so

783
00:29:31,919 --> 00:29:33,760
once they get into the end point they

784
00:29:33,760 --> 00:29:36,799
really need to stop pivoting to get to

785
00:29:36,799 --> 00:29:39,279
domain controllers file shares things

786
00:29:39,279 --> 00:29:42,799
like that so um backup service as well

787
00:29:42,799 --> 00:29:45,440
so for lateral movement uh they spend a

788
00:29:45,440 --> 00:29:47,600
lot of time deploying other beacons

789
00:29:47,600 --> 00:29:49,039
across the network

790
00:29:49,039 --> 00:29:52,320
um so and they will use that

791
00:29:52,320 --> 00:29:54,720
the primary commons is um smb

792
00:29:54,720 --> 00:29:56,960
so they spend a lot of time building

793
00:29:56,960 --> 00:30:00,159
their infrastructure internally um

794
00:30:00,159 --> 00:30:02,240
so and they're data tuning them all

795
00:30:02,240 --> 00:30:03,279
together

796
00:30:03,279 --> 00:30:06,159
and they're also deployed remote access

797
00:30:06,159 --> 00:30:08,880
on certain endpoints as well such as any

798
00:30:08,880 --> 00:30:12,240
desk and so on um so not everything is

799
00:30:12,240 --> 00:30:13,360
just going to be done through that

800
00:30:13,360 --> 00:30:16,000
initial access point they'll try to

801
00:30:16,000 --> 00:30:17,120
um

802
00:30:17,120 --> 00:30:19,440
like spread the load a little bit

803
00:30:19,440 --> 00:30:20,559
um

804
00:30:20,559 --> 00:30:23,440
other popular tool for lateral movement

805
00:30:23,440 --> 00:30:26,640
is resistant turn off ps exec again

806
00:30:26,640 --> 00:30:29,200
um system admin tool which is very

807
00:30:29,200 --> 00:30:31,360
commonly used in an environment

808
00:30:31,360 --> 00:30:32,960
system administrators use it for

809
00:30:32,960 --> 00:30:34,640
troubleshooting

810
00:30:34,640 --> 00:30:37,120
so just look for unusual use of that and

811
00:30:37,120 --> 00:30:38,559
if it's coming from end points that you

812
00:30:38,559 --> 00:30:40,240
don't normally see have been executed

813
00:30:40,240 --> 00:30:43,360
from that's worth having to look at

814
00:30:43,360 --> 00:30:44,240
uh

815
00:30:44,240 --> 00:30:47,200
other types of remote execution um is

816
00:30:47,200 --> 00:30:49,279
using wmi where they're interact

817
00:30:49,279 --> 00:30:50,799
directly with the host and execute

818
00:30:50,799 --> 00:30:53,360
commands

819
00:30:53,840 --> 00:30:55,600
so once they've

820
00:30:55,600 --> 00:30:57,600
done the initial access established

821
00:30:57,600 --> 00:31:00,080
photos

822
00:31:00,159 --> 00:31:01,760
done the lateral movement they've done

823
00:31:01,760 --> 00:31:03,200
the discovery

824
00:31:03,200 --> 00:31:05,919
um they'll start doing exfiltration and

825
00:31:05,919 --> 00:31:08,000
they may do some exfiltration throughout

826
00:31:08,000 --> 00:31:09,600
the intrusion

827
00:31:09,600 --> 00:31:13,199
so some of the things they do

828
00:31:14,080 --> 00:31:15,840
there's established station service

829
00:31:15,840 --> 00:31:17,760
where they've dumped our data and the

830
00:31:17,760 --> 00:31:18,880
data

831
00:31:18,880 --> 00:31:21,120
might be a user's folder which is quite

832
00:31:21,120 --> 00:31:23,600
hidden away and then

833
00:31:23,600 --> 00:31:25,360
just like what we do when we're sending

834
00:31:25,360 --> 00:31:27,279
emails they'll compress their data to

835
00:31:27,279 --> 00:31:29,120
make it smaller so there are multiple

836
00:31:29,120 --> 00:31:32,000
files and artifacts to work with um and

837
00:31:32,000 --> 00:31:34,080
then they will

838
00:31:34,080 --> 00:31:36,639
upload them

839
00:31:36,799 --> 00:31:39,519
in terms of data artifacts they've also

840
00:31:39,519 --> 00:31:42,880
tried to dump sql databases so it's not

841
00:31:42,880 --> 00:31:44,159
all about just

842
00:31:44,159 --> 00:31:46,559
files or process dumps and things like

843
00:31:46,559 --> 00:31:47,360
that

844
00:31:47,360 --> 00:31:49,760
um it can be any anything else on there

845
00:31:49,760 --> 00:31:53,200
such as configuration database servers

846
00:31:53,200 --> 00:31:54,720
um

847
00:31:54,720 --> 00:31:56,399
in terms of exfiltration there was a

848
00:31:56,399 --> 00:31:57,919
trend at one point

849
00:31:57,919 --> 00:32:01,519
or using the uh the mega storage service

850
00:32:01,519 --> 00:32:02,960
i know using

851
00:32:02,960 --> 00:32:05,840
um our clone quite a lot um it's

852
00:32:05,840 --> 00:32:08,000
effectively a file transfer utility and

853
00:32:08,000 --> 00:32:10,559
they would just upload all the data

854
00:32:10,559 --> 00:32:13,840
pretty easy spot in the um

855
00:32:13,840 --> 00:32:16,240
in network logs um

856
00:32:16,240 --> 00:32:19,200
the other types of utilities uh include

857
00:32:19,200 --> 00:32:20,559
one scp

858
00:32:20,559 --> 00:32:22,559
filezilla again

859
00:32:22,559 --> 00:32:24,720
common utilities that you'd like expect

860
00:32:24,720 --> 00:32:27,200
to see on the network

861
00:32:27,200 --> 00:32:28,880
uh

862
00:32:28,880 --> 00:32:31,679
in one of the intrusions um

863
00:32:31,679 --> 00:32:33,600
a really interesting one when they

864
00:32:33,600 --> 00:32:36,320
dumped the uh the osas process

865
00:32:36,320 --> 00:32:38,640
um they actually just opened the web

866
00:32:38,640 --> 00:32:40,399
browser and just uploaded it to u

867
00:32:40,399 --> 00:32:42,559
file.io so

868
00:32:42,559 --> 00:32:45,840
really simple um it worked

869
00:32:45,840 --> 00:32:48,880
um so we can monitor network connections

870
00:32:48,880 --> 00:32:50,880
um you can kind of see what they're

871
00:32:50,880 --> 00:32:52,880
doing where data is going and so on what

872
00:32:52,880 --> 00:32:55,600
processes are firing on

873
00:32:55,600 --> 00:32:59,039
ips and so on so um so yeah if you've

874
00:32:59,039 --> 00:33:01,279
got that capability look for those

875
00:33:01,279 --> 00:33:02,640
because you shouldn't be seeing that

876
00:33:02,640 --> 00:33:04,480
kind of exfiltration

877
00:33:04,480 --> 00:33:05,519
and

878
00:33:05,519 --> 00:33:07,440
lastly we've also seen coco strike being

879
00:33:07,440 --> 00:33:08,480
used

880
00:33:08,480 --> 00:33:11,440
so that's got an internal capability for

881
00:33:11,440 --> 00:33:13,519
uh doing downloads and uploads so they

882
00:33:13,519 --> 00:33:15,679
can just exfiltrate it out the way they

883
00:33:15,679 --> 00:33:17,360
came

884
00:33:17,360 --> 00:33:20,799
uh so the final objective for the tier

885
00:33:20,799 --> 00:33:23,360
uh factor is the actual ransomware

886
00:33:23,360 --> 00:33:24,559
deployment

887
00:33:24,559 --> 00:33:26,080
um so

888
00:33:26,080 --> 00:33:28,159
this involves several things

889
00:33:28,159 --> 00:33:29,760
encrypting the data

890
00:33:29,760 --> 00:33:31,360
uh wiping the file so that you can't

891
00:33:31,360 --> 00:33:34,080
recover it and then deploying a ransom

892
00:33:34,080 --> 00:33:36,159
note

893
00:33:36,159 --> 00:33:37,440
in

894
00:33:37,440 --> 00:33:39,200
one case that we saw

895
00:33:39,200 --> 00:33:40,559
so a lot of them tend to be custom

896
00:33:40,559 --> 00:33:42,720
malware and they would encrypt in one

897
00:33:42,720 --> 00:33:46,480
case we saw a bit locker being used

898
00:33:46,480 --> 00:33:48,880
so you can see it's a complex chain and

899
00:33:48,880 --> 00:33:50,799
there's a chart here

900
00:33:50,799 --> 00:33:52,960
and it's not just an email and once you

901
00:33:52,960 --> 00:33:54,000
know

902
00:33:54,000 --> 00:33:56,000
there are a lot of tools and techniques

903
00:33:56,000 --> 00:33:58,159
being leveraged

904
00:33:58,159 --> 00:34:00,320
um but one of the things it the big

905
00:34:00,320 --> 00:34:01,760
challenge is where do you invest your

906
00:34:01,760 --> 00:34:03,840
detections because ideally you want to

907
00:34:03,840 --> 00:34:07,279
detect it earlier or prevented

908
00:34:07,279 --> 00:34:10,480
but if you try to detect it at the end i

909
00:34:10,480 --> 00:34:12,639
ran some notes or the ransomware it's

910
00:34:12,639 --> 00:34:13,918
too late you're not gonna have a chance

911
00:34:13,918 --> 00:34:16,960
to respond from now

912
00:34:17,599 --> 00:34:18,639
so

913
00:34:18,639 --> 00:34:20,079
trying to understand where we need to

914
00:34:20,079 --> 00:34:23,040
invest what techniques do we see used

915
00:34:23,040 --> 00:34:26,000
quite a lot um and what are some of the

916
00:34:26,000 --> 00:34:28,320
quick wins so

917
00:34:28,320 --> 00:34:31,280
understanding at the procedure level uh

918
00:34:31,280 --> 00:34:32,879
we need to understand why the attacker

919
00:34:32,879 --> 00:34:34,639
is doing that why are they using that

920
00:34:34,639 --> 00:34:37,280
command why are they doing it that way

921
00:34:37,280 --> 00:34:39,280
and when are they doing that as part of

922
00:34:39,280 --> 00:34:41,280
the attack life cycle

923
00:34:41,280 --> 00:34:44,320
so using the mundian

924
00:34:44,320 --> 00:34:46,719
attack lifecycle we can start to map

925
00:34:46,719 --> 00:34:48,800
the observed procedures that we see in

926
00:34:48,800 --> 00:34:50,879
the intrusions and then start

927
00:34:50,879 --> 00:34:52,399
classifying them

928
00:34:52,399 --> 00:34:55,119
and then from this we can start to build

929
00:34:55,119 --> 00:34:56,879
an understanding of how frequent those

930
00:34:56,879 --> 00:34:58,320
procedures are

931
00:34:58,320 --> 00:35:00,240
where they've been leveraged what kind

932
00:35:00,240 --> 00:35:03,280
of telemetry data sources you can do and

933
00:35:03,280 --> 00:35:05,359
then start building up

934
00:35:05,359 --> 00:35:07,760
opportunities for detection

935
00:35:07,760 --> 00:35:09,839
so it's

936
00:35:09,839 --> 00:35:12,560
evident from doing that analysis that

937
00:35:12,560 --> 00:35:15,119
most of the procedures

938
00:35:15,119 --> 00:35:17,680
are associated with maintaining

939
00:35:17,680 --> 00:35:20,480
persistence and internal weak on stages

940
00:35:20,480 --> 00:35:24,079
so to maintain persistence are

941
00:35:24,720 --> 00:35:26,720
creating scheduled tasks

942
00:35:26,720 --> 00:35:28,640
establishing that photo to cross all the

943
00:35:28,640 --> 00:35:30,960
end points and they spend a lot of time

944
00:35:30,960 --> 00:35:33,119
building that infrastructure so and they

945
00:35:33,119 --> 00:35:34,960
want to maintain that because that's

946
00:35:34,960 --> 00:35:37,599
their means of delivering that effect

947
00:35:37,599 --> 00:35:39,920
the other one is internal recon when

948
00:35:39,920 --> 00:35:41,520
they're moving around discovering

949
00:35:41,520 --> 00:35:44,720
credentials powers of interest and so on

950
00:35:44,720 --> 00:35:47,359
they do a lot of discovery

951
00:35:47,359 --> 00:35:49,280
the the actual exploitation document

952
00:35:49,280 --> 00:35:50,800
coming in

953
00:35:50,800 --> 00:35:52,720
it could be quite difficult to detect if

954
00:35:52,720 --> 00:35:54,160
it's a vulnerability that they're

955
00:35:54,160 --> 00:35:56,000
exploiting you're not going you might

956
00:35:56,000 --> 00:35:57,839
not even know what you're looking for

957
00:35:57,839 --> 00:35:59,520
you may be able to

958
00:35:59,520 --> 00:36:01,920
identify unusual things like certain

959
00:36:01,920 --> 00:36:04,240
processes being called and so on

960
00:36:04,240 --> 00:36:05,440
um

961
00:36:05,440 --> 00:36:08,079
so but what we do know

962
00:36:08,079 --> 00:36:10,320
it's not linear it's not

963
00:36:10,320 --> 00:36:11,440
email

964
00:36:11,440 --> 00:36:13,920
do this do that read out and run some

965
00:36:13,920 --> 00:36:16,240
there is a big recursive loop in the

966
00:36:16,240 --> 00:36:17,359
middle

967
00:36:17,359 --> 00:36:18,480
and

968
00:36:18,480 --> 00:36:20,640
so

969
00:36:20,640 --> 00:36:22,480
still like the internal stuff like i

970
00:36:22,480 --> 00:36:23,520
said they're

971
00:36:23,520 --> 00:36:26,560
continually reviewed all the time and

972
00:36:26,560 --> 00:36:28,400
got the persistence as well so they need

973
00:36:28,400 --> 00:36:30,160
to make sure that the beacons are in

974
00:36:30,160 --> 00:36:31,599
place

975
00:36:31,599 --> 00:36:33,920
so the attack life cycle so this is

976
00:36:33,920 --> 00:36:36,880
based on a 19 day period so the biggest

977
00:36:36,880 --> 00:36:38,720
challenge is detecting a malicious

978
00:36:38,720 --> 00:36:42,079
activity early on and then

979
00:36:42,079 --> 00:36:43,599
before it's too late

980
00:36:43,599 --> 00:36:45,760
so you can see at the start of intrusion

981
00:36:45,760 --> 00:36:47,680
we can see a cluster of activity where

982
00:36:47,680 --> 00:36:49,839
they seem to do a lot of techniques so

983
00:36:49,839 --> 00:36:51,680
they're

984
00:36:51,680 --> 00:36:53,680
trying to maintain access doing a bit of

985
00:36:53,680 --> 00:36:55,280
internal week on on that endpoint

986
00:36:55,280 --> 00:36:58,079
finding out what it's connected to

987
00:36:58,079 --> 00:37:00,400
making some configuration changes um

988
00:37:00,400 --> 00:37:02,480
establishing the backdoors access and so

989
00:37:02,480 --> 00:37:04,400
on and then it appears that there's a

990
00:37:04,400 --> 00:37:07,200
quieter period um and then i do more

991
00:37:07,200 --> 00:37:08,960
internal recon discovering more

992
00:37:08,960 --> 00:37:12,160
endpoints um they'll move laterally and

993
00:37:12,160 --> 00:37:15,520
they'll keep repeating now um it's all

994
00:37:15,520 --> 00:37:17,599
building

995
00:37:17,599 --> 00:37:20,400
back doors again on other endpoints

996
00:37:20,400 --> 00:37:22,240
they will service more footballed

997
00:37:22,240 --> 00:37:23,760
elsewhere on the network

998
00:37:23,760 --> 00:37:26,560
um carry on with more internal recon so

999
00:37:26,560 --> 00:37:28,079
they're very deeper and deeper in the

1000
00:37:28,079 --> 00:37:30,640
network and then on the very last day

1001
00:37:30,640 --> 00:37:32,480
they would deliver that effect

1002
00:37:32,480 --> 00:37:33,200
so

1003
00:37:33,200 --> 00:37:34,880
the question is why do we see a lot of

1004
00:37:34,880 --> 00:37:36,720
the internal recon again

1005
00:37:36,720 --> 00:37:37,680
so

1006
00:37:37,680 --> 00:37:39,680
the main reason for that is when they

1007
00:37:39,680 --> 00:37:41,359
deliver effect they need to make sure

1008
00:37:41,359 --> 00:37:43,119
that i was being delivered i had to run

1009
00:37:43,119 --> 00:37:45,359
somewhere actually worked so i've seen

1010
00:37:45,359 --> 00:37:47,520
where they delivered the payload and

1011
00:37:47,520 --> 00:37:49,839
it's not worked they've made changes and

1012
00:37:49,839 --> 00:37:51,760
they've done checks check and see if the

1013
00:37:51,760 --> 00:37:53,599
files have actually encrypted so that's

1014
00:37:53,599 --> 00:37:55,680
a discovery technique

1015
00:37:55,680 --> 00:37:59,599
and and it's also worth noting that um

1016
00:37:59,599 --> 00:38:00,720
for

1017
00:38:00,720 --> 00:38:03,040
ransomware

1018
00:38:03,040 --> 00:38:05,599
um for actually maintaining

1019
00:38:05,599 --> 00:38:06,800
presence

1020
00:38:06,800 --> 00:38:08,880
so if i install like any desk or

1021
00:38:08,880 --> 00:38:10,480
splashtop

1022
00:38:10,480 --> 00:38:11,680
you don't just get an indicator when

1023
00:38:11,680 --> 00:38:13,680
it's been installed in process running

1024
00:38:13,680 --> 00:38:15,119
there will be a continuous network

1025
00:38:15,119 --> 00:38:17,359
connection to splashtop services to

1026
00:38:17,359 --> 00:38:18,560
allow me

1027
00:38:18,560 --> 00:38:21,359
an indicator that there's a strong c2

1028
00:38:21,359 --> 00:38:22,720
activity

1029
00:38:22,720 --> 00:38:24,880
um

1030
00:38:24,880 --> 00:38:26,800
yeah and then when we start to put all

1031
00:38:26,800 --> 00:38:28,800
these procedures in the context of an

1032
00:38:28,800 --> 00:38:30,640
intrusion because we see in multiple

1033
00:38:30,640 --> 00:38:34,880
cases of these we start to see a pattern

1034
00:38:34,880 --> 00:38:36,160
and it's quite clear they're following a

1035
00:38:36,160 --> 00:38:37,760
playbook

1036
00:38:37,760 --> 00:38:38,640
so

1037
00:38:38,640 --> 00:38:40,960
the country leak confirmed the existence

1038
00:38:40,960 --> 00:38:43,200
of very detailed playbooks and training

1039
00:38:43,200 --> 00:38:44,320
material

1040
00:38:44,320 --> 00:38:45,119
so

1041
00:38:45,119 --> 00:38:47,920
playbooks have several advantages so

1042
00:38:47,920 --> 00:38:49,920
they provide a baseline of common

1043
00:38:49,920 --> 00:38:52,000
scripts and tools

1044
00:38:52,000 --> 00:38:54,320
and ensures ensures consistent ways of

1045
00:38:54,320 --> 00:38:55,280
working

1046
00:38:55,280 --> 00:38:57,119
so when they've got a team of operators

1047
00:38:57,119 --> 00:38:59,040
within the group they're all following

1048
00:38:59,040 --> 00:39:01,520
the same uh ways of working when they do

1049
00:39:01,520 --> 00:39:03,599
their intrusions uh they've got their

1050
00:39:03,599 --> 00:39:05,200
same tool kits

1051
00:39:05,200 --> 00:39:06,560
um

1052
00:39:06,560 --> 00:39:08,160
and it helps because not all of the

1053
00:39:08,160 --> 00:39:10,240
operators are trained at the same level

1054
00:39:10,240 --> 00:39:11,680
so it helps

1055
00:39:11,680 --> 00:39:13,680
but they're all sharing that knowledge

1056
00:39:13,680 --> 00:39:14,880
um

1057
00:39:14,880 --> 00:39:16,400
and they've got the right tools and

1058
00:39:16,400 --> 00:39:18,720
configurations in place

1059
00:39:18,720 --> 00:39:20,320
so for example they have customized

1060
00:39:20,320 --> 00:39:22,880
scripts for like ad fines and so on

1061
00:39:22,880 --> 00:39:26,000
so the procedures are battle tested

1062
00:39:26,000 --> 00:39:27,200
they work

1063
00:39:27,200 --> 00:39:29,119
um it doesn't mean that they're

1064
00:39:29,119 --> 00:39:30,960
sophisticated it just means that the

1065
00:39:30,960 --> 00:39:34,400
operator know when and where to use them

1066
00:39:34,400 --> 00:39:35,200
and

1067
00:39:35,200 --> 00:39:38,320
they know what commands to enter um

1068
00:39:38,320 --> 00:39:40,400
and what to do

1069
00:39:40,400 --> 00:39:41,920
and what they objected on using that

1070
00:39:41,920 --> 00:39:42,880
command

1071
00:39:42,880 --> 00:39:45,440
some of the procedures are automated um

1072
00:39:45,440 --> 00:39:47,760
with custom scripts so

1073
00:39:47,760 --> 00:39:48,880
um

1074
00:39:48,880 --> 00:39:50,560
survival happened to type commands all

1075
00:39:50,560 --> 00:39:51,839
the time they will evolve their

1076
00:39:51,839 --> 00:39:54,079
playbooks put scripts in place to

1077
00:39:54,079 --> 00:39:56,640
automate that discovery the collection

1078
00:39:56,640 --> 00:39:58,800
and then the the analyst uh the operator

1079
00:39:58,800 --> 00:40:02,079
can dictate that and upload them

1080
00:40:02,079 --> 00:40:04,000
the the other bit

1081
00:40:04,000 --> 00:40:07,119
um so we talked about new vulnerability

1082
00:40:07,119 --> 00:40:08,560
so

1083
00:40:08,560 --> 00:40:10,079
it's a kind of mouse game for them as

1084
00:40:10,079 --> 00:40:12,720
well so as analysts if we detect how

1085
00:40:12,720 --> 00:40:14,560
they're doing them and a security tool

1086
00:40:14,560 --> 00:40:16,400
can detect what they're doing they would

1087
00:40:16,400 --> 00:40:18,079
have booked their game they'll have to

1088
00:40:18,079 --> 00:40:20,000
develop new procedures leveraging new

1089
00:40:20,000 --> 00:40:22,240
tools and if there's a new vulnerability

1090
00:40:22,240 --> 00:40:25,440
coming out or which has been released um

1091
00:40:25,440 --> 00:40:27,040
then they'll exploit that incorporate

1092
00:40:27,040 --> 00:40:28,560
into our procedures

1093
00:40:28,560 --> 00:40:29,839
so

1094
00:40:29,839 --> 00:40:32,160
so while the playbooks are great um and

1095
00:40:32,160 --> 00:40:34,160
they work it provides an easy to follow

1096
00:40:34,160 --> 00:40:35,440
procedure

1097
00:40:35,440 --> 00:40:36,839
operator can still make

1098
00:40:36,839 --> 00:40:39,920
mistakes so we've seen mistakes by

1099
00:40:39,920 --> 00:40:42,319
operators so

1100
00:40:42,319 --> 00:40:44,720
they either tend to fall into console

1101
00:40:44,720 --> 00:40:46,480
errors where they've entered the wrong

1102
00:40:46,480 --> 00:40:49,760
command or they tool in issues when

1103
00:40:49,760 --> 00:40:51,200
things break

1104
00:40:51,200 --> 00:40:55,040
so in one case as part of the discovery

1105
00:40:55,040 --> 00:40:57,200
they were trying to do enumeration of

1106
00:40:57,200 --> 00:40:59,359
installed antivirus products on the

1107
00:40:59,359 --> 00:41:00,640
endpoint

1108
00:41:00,640 --> 00:41:01,520
and

1109
00:41:01,520 --> 00:41:03,440
what the operator did and i was done by

1110
00:41:03,440 --> 00:41:05,359
a cobble strike

1111
00:41:05,359 --> 00:41:08,000
they entered the of a specific command

1112
00:41:08,000 --> 00:41:09,920
on the

1113
00:41:09,920 --> 00:41:12,319
host command shell

1114
00:41:12,319 --> 00:41:15,359
which was the av query command

1115
00:41:15,359 --> 00:41:17,839
which is very specific to kobo strike is

1116
00:41:17,839 --> 00:41:20,480
a add-on script called aggressor

1117
00:41:20,480 --> 00:41:22,960
and so they entered it effectively in

1118
00:41:22,960 --> 00:41:24,960
the wrong window so in their cable

1119
00:41:24,960 --> 00:41:27,839
stripe console they would allow like an

1120
00:41:27,839 --> 00:41:29,920
interact with the beacon and they would

1121
00:41:29,920 --> 00:41:32,079
have had another window for

1122
00:41:32,079 --> 00:41:34,880
non-interactive so

1123
00:41:34,880 --> 00:41:36,960
yeah so that was

1124
00:41:36,960 --> 00:41:39,359
at a bad day well that kind of telemetry

1125
00:41:39,359 --> 00:41:41,520
just get locked um see if you can

1126
00:41:41,520 --> 00:41:42,720
capture that

1127
00:41:42,720 --> 00:41:44,319
um that's pretty good

1128
00:41:44,319 --> 00:41:45,280
um

1129
00:41:45,280 --> 00:41:47,680
the the other controllers

1130
00:41:47,680 --> 00:41:49,599
is copy and paste so it looks like they

1131
00:41:49,599 --> 00:41:52,240
copied and pasted um a command straight

1132
00:41:52,240 --> 00:41:53,599
from the playbook

1133
00:41:53,599 --> 00:41:55,920
so where the ip

1134
00:41:55,920 --> 00:41:57,760
should have been past your taskless it

1135
00:41:57,760 --> 00:41:59,599
should have been the actual ip just over

1136
00:41:59,599 --> 00:42:00,800
the end point

1137
00:42:00,800 --> 00:42:03,599
so again that would have thrown an error

1138
00:42:03,599 --> 00:42:04,720
so

1139
00:42:04,720 --> 00:42:06,880
very useful detection opportunity it

1140
00:42:06,880 --> 00:42:08,400
doesn't happen all the time but it can

1141
00:42:08,400 --> 00:42:09,440
happen

1142
00:42:09,440 --> 00:42:12,640
and we have seen them several times

1143
00:42:12,640 --> 00:42:15,280
so the tools um

1144
00:42:15,280 --> 00:42:16,720
a defined

1145
00:42:16,720 --> 00:42:18,960
very popular tool of all the tools that

1146
00:42:18,960 --> 00:42:20,000
we've seen

1147
00:42:20,000 --> 00:42:22,240
and

1148
00:42:22,720 --> 00:42:24,800
the country group and they actually

1149
00:42:24,800 --> 00:42:28,160
automated that using adf.bat and we've

1150
00:42:28,160 --> 00:42:30,400
seen this being dropped on endpoints and

1151
00:42:30,400 --> 00:42:31,839
a number of cases over the last two

1152
00:42:31,839 --> 00:42:32,720
years

1153
00:42:32,720 --> 00:42:34,960
and they still use the same file name

1154
00:42:34,960 --> 00:42:37,040
adf.bat

1155
00:42:37,040 --> 00:42:38,480
and

1156
00:42:38,480 --> 00:42:40,400
the same script is also favored by other

1157
00:42:40,400 --> 00:42:43,599
groups so we can see from a country chat

1158
00:42:43,599 --> 00:42:45,920
they were saying that agf talked about

1159
00:42:45,920 --> 00:42:47,599
was used by like

1160
00:42:47,599 --> 00:42:48,880
and then someone remarked it was

1161
00:42:48,880 --> 00:42:51,680
actually created by them um so

1162
00:42:51,680 --> 00:42:53,839
there you go tools are being leaked or

1163
00:42:53,839 --> 00:42:56,000
shared amongst other groups

1164
00:42:56,000 --> 00:42:56,960
whether

1165
00:42:56,960 --> 00:42:59,839
uh intentionally or unintentionally

1166
00:42:59,839 --> 00:43:03,040
so we've seen other scripts such as one

1167
00:43:03,040 --> 00:43:05,119
side piece gunner and power view as well

1168
00:43:05,119 --> 00:43:07,839
so all of them are home to public domain

1169
00:43:07,839 --> 00:43:10,839
um

1170
00:43:11,119 --> 00:43:14,160
card so you'll tend to get dropped

1171
00:43:14,160 --> 00:43:14,880
so

1172
00:43:14,880 --> 00:43:16,800
look for files that are dropped in

1173
00:43:16,800 --> 00:43:19,359
unusual files like temp folder music

1174
00:43:19,359 --> 00:43:22,319
folder downloads folder they're

1175
00:43:22,319 --> 00:43:24,880
easy to

1176
00:43:25,760 --> 00:43:28,400
in spot of vulnerabilities um so we

1177
00:43:28,400 --> 00:43:30,640
talked about the the exchange one

1178
00:43:30,640 --> 00:43:33,440
um one i saw in the case

1179
00:43:33,440 --> 00:43:34,400
where

1180
00:43:34,400 --> 00:43:37,040
i was seeing sam the admin as part of

1181
00:43:37,040 --> 00:43:39,040
ldap request

1182
00:43:39,040 --> 00:43:41,599
um doing the analysis yeah it was linked

1183
00:43:41,599 --> 00:43:44,800
to a uh probably available script uh you

1184
00:43:44,800 --> 00:43:46,720
could get from github so they've

1185
00:43:46,720 --> 00:43:48,880
obviously taken that incorporated into

1186
00:43:48,880 --> 00:43:52,319
that procedure and um uh used it against

1187
00:43:52,319 --> 00:43:52,960
this

1188
00:43:52,960 --> 00:43:54,480
particular host

1189
00:43:54,480 --> 00:43:57,680
so it does demonstrate that groups

1190
00:43:57,680 --> 00:43:59,760
they are actually

1191
00:43:59,760 --> 00:44:01,680
reviewing the vulnerabilities out there

1192
00:44:01,680 --> 00:44:03,520
working out which ones are definitely

1193
00:44:03,520 --> 00:44:06,800
worth exposing and also looking for any

1194
00:44:06,800 --> 00:44:08,319
code that's been released to exploit

1195
00:44:08,319 --> 00:44:09,119
that

1196
00:44:09,119 --> 00:44:10,800
so they are relying on system

1197
00:44:10,800 --> 00:44:12,720
administrators not doing their patching

1198
00:44:12,720 --> 00:44:14,640
holding him and so on and exploiting

1199
00:44:14,640 --> 00:44:16,079
those weakness

1200
00:44:16,079 --> 00:44:18,560
and the us sir they produced their

1201
00:44:18,560 --> 00:44:20,560
report as well where they

1202
00:44:20,560 --> 00:44:23,280
even acknowledged that after two weeks

1203
00:44:23,280 --> 00:44:25,599
where vulnerability is disclosed

1204
00:44:25,599 --> 00:44:27,760
and and if there's a tool available such

1205
00:44:27,760 --> 00:44:30,480
as the people concept script

1206
00:44:30,480 --> 00:44:32,480
attackers will explain

1207
00:44:32,480 --> 00:44:34,160
so that's a trend that i have seen and

1208
00:44:34,160 --> 00:44:35,760
it pretty much

1209
00:44:35,760 --> 00:44:37,280
aligns to what we've seen as well in

1210
00:44:37,280 --> 00:44:38,480
cases

1211
00:44:38,480 --> 00:44:39,440
um

1212
00:44:39,440 --> 00:44:40,480
we don't

1213
00:44:40,480 --> 00:44:42,400
see huge amounts of customizations of

1214
00:44:42,400 --> 00:44:44,319
scripts so they tend to take what

1215
00:44:44,319 --> 00:44:45,280
they've got

1216
00:44:45,280 --> 00:44:46,800
and deploy it

1217
00:44:46,800 --> 00:44:49,040
it probably means that they're

1218
00:44:49,040 --> 00:44:50,160
probably got

1219
00:44:50,160 --> 00:44:51,839
operators but probably a lack of

1220
00:44:51,839 --> 00:44:54,000
developers in their teams so they can't

1221
00:44:54,000 --> 00:44:56,880
do a lot of tool development maybe um or

1222
00:44:56,880 --> 00:44:59,280
whether they just interested in using a

1223
00:44:59,280 --> 00:45:01,440
tool just for short amount of time

1224
00:45:01,440 --> 00:45:03,359
before everything is patched so they're

1225
00:45:03,359 --> 00:45:05,520
probably not worth investing in building

1226
00:45:05,520 --> 00:45:07,280
that vulnerability

1227
00:45:07,280 --> 00:45:08,400
um

1228
00:45:08,400 --> 00:45:09,760
so

1229
00:45:09,760 --> 00:45:11,359
yeah again

1230
00:45:11,359 --> 00:45:13,040
a lot of scripts tend to fall into

1231
00:45:13,040 --> 00:45:16,000
non-standard locations as well

1232
00:45:16,000 --> 00:45:16,880
so

1233
00:45:16,880 --> 00:45:19,200
intrusions never always go to plum so

1234
00:45:19,200 --> 00:45:22,400
some of the more unusual ones are

1235
00:45:22,400 --> 00:45:24,880
when things go wrong so we've seen

1236
00:45:24,880 --> 00:45:26,720
beacons be deployed

1237
00:45:26,720 --> 00:45:28,000
never

1238
00:45:28,000 --> 00:45:30,400
uh call home properly

1239
00:45:30,400 --> 00:45:33,280
and it's just continuous dns requests um

1240
00:45:33,280 --> 00:45:35,040
and then they'll deploy another beacon

1241
00:45:35,040 --> 00:45:36,480
on the same house so they end up with

1242
00:45:36,480 --> 00:45:38,560
multiple beacons on the same house uh

1243
00:45:38,560 --> 00:45:40,800
making continuous requests and then one

1244
00:45:40,800 --> 00:45:42,560
of them will connect

1245
00:45:42,560 --> 00:45:45,200
um so it could there's so they have

1246
00:45:45,200 --> 00:45:47,040
issues as well with their infrastructure

1247
00:45:47,040 --> 00:45:48,480
so they might have developed a payload

1248
00:45:48,480 --> 00:45:50,400
that might work fine the day before and

1249
00:45:50,400 --> 00:45:52,480
all of a sudden the c2 infrastructure

1250
00:45:52,480 --> 00:45:55,359
has been burned um so

1251
00:45:55,359 --> 00:45:57,040
sort of create another one so this is

1252
00:45:57,040 --> 00:45:59,119
the problem with iocs it's quite easy to

1253
00:45:59,119 --> 00:46:02,319
build a new domain new ip and so on

1254
00:46:02,319 --> 00:46:04,000
um

1255
00:46:04,000 --> 00:46:05,920
in another case

1256
00:46:05,920 --> 00:46:07,200
because there's a lot of ransomware

1257
00:46:07,200 --> 00:46:11,359
groups um i actually saw two

1258
00:46:11,359 --> 00:46:13,599
different operators on the same house at

1259
00:46:13,599 --> 00:46:15,359
the same time

1260
00:46:15,359 --> 00:46:17,520
which is another following almost

1261
00:46:17,520 --> 00:46:20,640
identical um playbooks uh how they were

1262
00:46:20,640 --> 00:46:22,319
doing their enumeration discovery and

1263
00:46:22,319 --> 00:46:23,359
moving

1264
00:46:23,359 --> 00:46:25,040
one took a different approach to doing

1265
00:46:25,040 --> 00:46:27,680
lateral movement whereas another one

1266
00:46:27,680 --> 00:46:29,520
was successful in their lateral movement

1267
00:46:29,520 --> 00:46:30,640
and did the

1268
00:46:30,640 --> 00:46:32,160
encryption

1269
00:46:32,160 --> 00:46:33,760
made it a bit more difficult for the

1270
00:46:33,760 --> 00:46:34,800
analysts

1271
00:46:34,800 --> 00:46:36,880
because they were very similar

1272
00:46:36,880 --> 00:46:39,040
techniques they were following um so it

1273
00:46:39,040 --> 00:46:41,119
just made it a bit harder to unpack but

1274
00:46:41,119 --> 00:46:42,480
it does happen

1275
00:46:42,480 --> 00:46:44,560
and

1276
00:46:44,560 --> 00:46:46,960
some of the operators they are really

1277
00:46:46,960 --> 00:46:48,880
good understanding of an environment

1278
00:46:48,880 --> 00:46:50,000
that they

1279
00:46:50,000 --> 00:46:52,400
compromise um they probably know it

1280
00:46:52,400 --> 00:46:53,839
better than the system administrators in

1281
00:46:53,839 --> 00:46:56,319
some cases so they'll know the security

1282
00:46:56,319 --> 00:46:58,480
of the configuration how things hang and

1283
00:46:58,480 --> 00:46:59,839
network together

1284
00:46:59,839 --> 00:47:01,440
um but they don't look out for the

1285
00:47:01,440 --> 00:47:04,640
factors so they may focus on

1286
00:47:04,640 --> 00:47:06,800
a defender or not necessary other threat

1287
00:47:06,800 --> 00:47:07,680
groups

1288
00:47:07,680 --> 00:47:09,119
so

1289
00:47:09,119 --> 00:47:11,359
so the operators were have been focused

1290
00:47:11,359 --> 00:47:13,440
on initial access all the way up to run

1291
00:47:13,440 --> 00:47:15,599
somewhere but i mentioned about tripol

1292
00:47:15,599 --> 00:47:17,359
so you mustn't forget about those so

1293
00:47:17,359 --> 00:47:18,880
don't just focus on ransomware

1294
00:47:18,880 --> 00:47:22,000
techniques try to detect tripod because

1295
00:47:22,000 --> 00:47:24,079
and other types of access books because

1296
00:47:24,079 --> 00:47:26,079
if you can detect those then it's

1297
00:47:26,079 --> 00:47:28,000
unlikely the one somewhere that you can

1298
00:47:28,000 --> 00:47:30,800
get into the network

1299
00:47:30,800 --> 00:47:32,880
some of these smart activities we see

1300
00:47:32,880 --> 00:47:33,920
are

1301
00:47:33,920 --> 00:47:36,480
related to checks and blending so we've

1302
00:47:36,480 --> 00:47:38,960
seen safety checks so this is fairly

1303
00:47:38,960 --> 00:47:42,160
recent so in one case i saw the use of a

1304
00:47:42,160 --> 00:47:44,000
change um

1305
00:47:44,000 --> 00:47:45,359
code page

1306
00:47:45,359 --> 00:47:47,440
which i thought was quite unusual then

1307
00:47:47,440 --> 00:47:49,280
look doing a look on that

1308
00:47:49,280 --> 00:47:50,559
um

1309
00:47:50,559 --> 00:47:51,760
they're effectively looking for a

1310
00:47:51,760 --> 00:47:53,680
language uh that is configured on the

1311
00:47:53,680 --> 00:47:56,319
endpoint so they're either trying to

1312
00:47:56,319 --> 00:47:58,319
acknowledge yes that is a target they

1313
00:47:58,319 --> 00:48:00,480
should be engaging or based on the

1314
00:48:00,480 --> 00:48:02,240
language or if they're using a

1315
00:48:02,240 --> 00:48:04,319
particular language they need to avoid

1316
00:48:04,319 --> 00:48:06,800
so that's my i posted this on that

1317
00:48:06,800 --> 00:48:08,240
so

1318
00:48:08,240 --> 00:48:10,240
so they they spend a lot of time doing

1319
00:48:10,240 --> 00:48:12,800
those safety checks as well and

1320
00:48:12,800 --> 00:48:16,000
they also did a

1321
00:48:16,000 --> 00:48:18,160
battle damage assessment as well so i

1322
00:48:18,160 --> 00:48:20,079
mentioned like it's not all about

1323
00:48:20,079 --> 00:48:21,920
discovering stuff but also confirming

1324
00:48:21,920 --> 00:48:23,839
his prevention where actually did work

1325
00:48:23,839 --> 00:48:26,160
so again pretty clever just confirming

1326
00:48:26,160 --> 00:48:27,520
what they've done

1327
00:48:27,520 --> 00:48:29,920
actually delivered the payload

1328
00:48:29,920 --> 00:48:31,119
pattern of life

1329
00:48:31,119 --> 00:48:32,839
exfiltration

1330
00:48:32,839 --> 00:48:36,160
um in some cases we've seen blending of

1331
00:48:36,160 --> 00:48:37,599
activities where they've tried to

1332
00:48:37,599 --> 00:48:39,119
exfiltrate data

1333
00:48:39,119 --> 00:48:41,359
over several days with gaps and over

1334
00:48:41,359 --> 00:48:44,160
hours so again fairly small so it's not

1335
00:48:44,160 --> 00:48:46,720
a data upload coming out which will be

1336
00:48:46,720 --> 00:48:49,760
very unusual

1337
00:48:49,760 --> 00:48:52,079
uh in terms of c2 i've mentioned that

1338
00:48:52,079 --> 00:48:54,079
this is very hard for

1339
00:48:54,079 --> 00:48:56,000
the operators to maintain post

1340
00:48:56,000 --> 00:48:58,000
compromise and there's a lot of things

1341
00:48:58,000 --> 00:48:59,599
that can go wrong

1342
00:48:59,599 --> 00:49:00,400
so

1343
00:49:00,400 --> 00:49:02,319
it's frequently served by cobra slide

1344
00:49:02,319 --> 00:49:05,839
beacons um but there's also any desks

1345
00:49:05,839 --> 00:49:07,920
and other legitimate tools for long-term

1346
00:49:07,920 --> 00:49:08,960
access

1347
00:49:08,960 --> 00:49:11,599
so typically you see a beacon

1348
00:49:11,599 --> 00:49:15,280
on the edge so in http then internally

1349
00:49:15,280 --> 00:49:17,920
uh they'll be smb and they're uh linked

1350
00:49:17,920 --> 00:49:18,960
together

1351
00:49:18,960 --> 00:49:21,359
and um when

1352
00:49:21,359 --> 00:49:24,319
things do go wrong i've seen in cases

1353
00:49:24,319 --> 00:49:26,400
where they've

1354
00:49:26,400 --> 00:49:29,680
pulled out a ban payload uh

1355
00:49:29,680 --> 00:49:31,839
revealing a

1356
00:49:31,839 --> 00:49:35,359
staging tooling server um where they

1357
00:49:35,359 --> 00:49:37,280
must store their tools and pull that

1358
00:49:37,280 --> 00:49:40,960
down uh again they use like curl um

1359
00:49:40,960 --> 00:49:42,880
quite unique user agent string you not

1360
00:49:42,880 --> 00:49:45,280
normally see

1361
00:49:45,280 --> 00:49:46,640
so ideally they should be going for

1362
00:49:46,640 --> 00:49:49,760
short and long term haul beacons um it

1363
00:49:49,760 --> 00:49:51,760
all depends how long their intrusion is

1364
00:49:51,760 --> 00:49:53,280
going to be

1365
00:49:53,280 --> 00:49:54,880
but the key is for them to maintain

1366
00:49:54,880 --> 00:49:56,880
access by any means possible

1367
00:49:56,880 --> 00:49:59,280
um it's worth noting that a lot of the

1368
00:49:59,280 --> 00:50:02,079
cobblestop beacons are out of the box so

1369
00:50:02,079 --> 00:50:03,839
quite easy to spot in terms of default

1370
00:50:03,839 --> 00:50:05,839
configurations

1371
00:50:05,839 --> 00:50:09,119
so going back to the data still there

1372
00:50:09,119 --> 00:50:11,200
before we work with we work with a lot

1373
00:50:11,200 --> 00:50:12,400
of different tools

1374
00:50:12,400 --> 00:50:14,400
a lot of them in the public domain so as

1375
00:50:14,400 --> 00:50:16,400
an analyst you should be familiar with

1376
00:50:16,400 --> 00:50:18,880
all these tools or have some awareness

1377
00:50:18,880 --> 00:50:20,160
of them

1378
00:50:20,160 --> 00:50:22,800
so that's what we're working with

1379
00:50:22,800 --> 00:50:26,640
so in terms of network analysis um

1380
00:50:26,640 --> 00:50:28,400
looking at peak up

1381
00:50:28,400 --> 00:50:30,000
it's not possible to just get a peak up

1382
00:50:30,000 --> 00:50:31,599
and then the story into wireshark and

1383
00:50:31,599 --> 00:50:32,960
just going through it individually

1384
00:50:32,960 --> 00:50:35,839
there's just um just too big data to

1385
00:50:35,839 --> 00:50:37,599
work with so

1386
00:50:37,599 --> 00:50:40,960
converting it into like zeke locks

1387
00:50:40,960 --> 00:50:43,119
will help focus the tree out a little

1388
00:50:43,119 --> 00:50:44,400
bit better

1389
00:50:44,400 --> 00:50:47,760
um and even running them against the um

1390
00:50:47,760 --> 00:50:50,160
emergence that's um

1391
00:50:50,160 --> 00:50:52,559
rules snort rules and that could detect

1392
00:50:52,559 --> 00:50:54,000
some of the low-hanging fruit as well

1393
00:50:54,000 --> 00:50:55,520
especially with default out-of-the-box

1394
00:50:55,520 --> 00:50:57,440
configuration for beacons

1395
00:50:57,440 --> 00:51:01,680
and even just doing uh some basic uh

1396
00:51:01,680 --> 00:51:03,599
analysis of the p-caps

1397
00:51:03,599 --> 00:51:05,200
you can probably start to see trends

1398
00:51:05,200 --> 00:51:06,960
where there's a lot of unusual post

1399
00:51:06,960 --> 00:51:09,280
requests a lot of traffic to particular

1400
00:51:09,280 --> 00:51:10,880
host domains

1401
00:51:10,880 --> 00:51:12,800
user agent strings which are really odd

1402
00:51:12,800 --> 00:51:14,800
they don't fit in and there's no other

1403
00:51:14,800 --> 00:51:17,280
network traffic um

1404
00:51:17,280 --> 00:51:19,200
so you can start looking for that

1405
00:51:19,200 --> 00:51:22,000
and the us

1406
00:51:22,000 --> 00:51:23,839
analysis reports

1407
00:51:23,839 --> 00:51:25,599
and they share a lot of the common

1408
00:51:25,599 --> 00:51:26,800
indicators as well especially with

1409
00:51:26,800 --> 00:51:29,520
cobalt stroke

1410
00:51:30,240 --> 00:51:32,960
so memory analysis this is quite a

1411
00:51:32,960 --> 00:51:34,839
complex area

1412
00:51:34,839 --> 00:51:37,520
so um if you get the right data and you

1413
00:51:37,520 --> 00:51:39,920
can you're confident whether you can use

1414
00:51:39,920 --> 00:51:42,240
that to correlate with your blog sources

1415
00:51:42,240 --> 00:51:43,359
especially if you've got telemetry

1416
00:51:43,359 --> 00:51:45,440
around processes and then you can start

1417
00:51:45,440 --> 00:51:48,079
running your scans against that as well

1418
00:51:48,079 --> 00:51:50,319
and you can start to understand more of

1419
00:51:50,319 --> 00:51:52,160
a deeper dive how that process is

1420
00:51:52,160 --> 00:51:54,240
injecting into other processes

1421
00:51:54,240 --> 00:51:56,640
um and if you've got the memory uh and

1422
00:51:56,640 --> 00:51:58,240
you've got a couple slight beacon you

1423
00:51:58,240 --> 00:52:01,280
can use some of the open um

1424
00:52:01,280 --> 00:52:03,440
and the public domain script such as one

1425
00:52:03,440 --> 00:52:06,319
one seven six eight dot python uh which

1426
00:52:06,319 --> 00:52:08,400
is created by digit stevens and you can

1427
00:52:08,400 --> 00:52:10,800
extract the cover stack configuration

1428
00:52:10,800 --> 00:52:12,800
again you can use that to verify your

1429
00:52:12,800 --> 00:52:15,599
indicators and the looks um

1430
00:52:15,599 --> 00:52:16,720
so

1431
00:52:16,720 --> 00:52:19,440
with all these data sources try not to

1432
00:52:19,440 --> 00:52:21,599
treat everything in isolation try to

1433
00:52:21,599 --> 00:52:23,680
understand what your analysis workflow

1434
00:52:23,680 --> 00:52:26,160
is and tie them all together

1435
00:52:26,160 --> 00:52:28,480
so if you've got gaps in one knowledge

1436
00:52:28,480 --> 00:52:31,359
um use another data artifact to

1437
00:52:31,359 --> 00:52:33,280
try to plug that gap

1438
00:52:33,280 --> 00:52:35,119
try not to solve everything just from

1439
00:52:35,119 --> 00:52:38,000
one data source

1440
00:52:38,319 --> 00:52:40,720
uh log analysis like i said that's our

1441
00:52:40,720 --> 00:52:42,480
main one you usually get lots of

1442
00:52:42,480 --> 00:52:44,839
different types of log sources

1443
00:52:44,839 --> 00:52:47,520
um we primarily work with microsoft

1444
00:52:47,520 --> 00:52:50,400
windows and we get a lot of we can work

1445
00:52:50,400 --> 00:52:52,559
with uh

1446
00:52:52,559 --> 00:52:55,119
powershell logs security logs system

1447
00:52:55,119 --> 00:52:57,599
unlocks and we can use things like

1448
00:52:57,599 --> 00:53:00,000
chainsaw uh where we can load them with

1449
00:53:00,000 --> 00:53:02,000
sigma rules again we can start to

1450
00:53:02,000 --> 00:53:04,319
understand classify the data

1451
00:53:04,319 --> 00:53:05,839
again with a lot of these tools you need

1452
00:53:05,839 --> 00:53:07,839
to understand the limitations and stuff

1453
00:53:07,839 --> 00:53:09,680
like you are for example

1454
00:53:09,680 --> 00:53:11,680
if you've got a rule just understand the

1455
00:53:11,680 --> 00:53:12,960
rule that you're trying to detect

1456
00:53:12,960 --> 00:53:15,119
because your can be used for detecting

1457
00:53:15,119 --> 00:53:17,599
files as well as memory resistant um

1458
00:53:17,599 --> 00:53:19,599
artifacts so if you try to run a file

1459
00:53:19,599 --> 00:53:22,079
based url in memory you might not get

1460
00:53:22,079 --> 00:53:23,760
that detection if it's looking for like

1461
00:53:23,760 --> 00:53:25,920
file size and

1462
00:53:25,920 --> 00:53:28,079
header bytes and so on which just didn't

1463
00:53:28,079 --> 00:53:29,839
exist in a memory properly

1464
00:53:29,839 --> 00:53:30,640
so

1465
00:53:30,640 --> 00:53:34,160
yeah so don't just drive to the tools uh

1466
00:53:34,160 --> 00:53:36,960
still think create hypotheses understand

1467
00:53:36,960 --> 00:53:39,200
what the attack is done and where

1468
00:53:39,200 --> 00:53:42,000
they think they are

1469
00:53:42,000 --> 00:53:43,440
documents

1470
00:53:43,440 --> 00:53:46,319
um again tools around that

1471
00:53:46,319 --> 00:53:48,559
related tools again you can quickly run

1472
00:53:48,559 --> 00:53:50,559
through those and they'll come up with

1473
00:53:50,559 --> 00:53:51,839
some

1474
00:53:51,839 --> 00:53:54,640
indicators so typical webplugs are

1475
00:53:54,640 --> 00:53:58,400
unusual api calls directly to win32

1476
00:53:58,400 --> 00:53:59,680
um

1477
00:53:59,680 --> 00:54:01,920
anti debug scripts where there's a lot

1478
00:54:01,920 --> 00:54:04,319
of macros where human

1479
00:54:04,319 --> 00:54:06,480
it's not human readable

1480
00:54:06,480 --> 00:54:08,000
where there's a lot of procedures

1481
00:54:08,000 --> 00:54:10,559
calling procedures and things like that

1482
00:54:10,559 --> 00:54:14,480
any unusual iocs call in um files that

1483
00:54:14,480 --> 00:54:16,480
are on the the endpoint

1484
00:54:16,480 --> 00:54:18,880
um so if you get enough of those flags

1485
00:54:18,880 --> 00:54:21,119
you can probably confirm hypothesis what

1486
00:54:21,119 --> 00:54:22,640
you're seeing in the logs and then what

1487
00:54:22,640 --> 00:54:24,880
you're seeing in the memory dump as well

1488
00:54:24,880 --> 00:54:26,559
and

1489
00:54:26,559 --> 00:54:29,200
so another tool we work with is cyber

1490
00:54:29,200 --> 00:54:32,079
chef by the ncsc that is a brilliant

1491
00:54:32,079 --> 00:54:34,559
tool it is like a swiss army knife we

1492
00:54:34,559 --> 00:54:36,720
can take

1493
00:54:36,720 --> 00:54:38,960
a number of functions in there for

1494
00:54:38,960 --> 00:54:42,319
decoding base64 and so on we can do

1495
00:54:42,319 --> 00:54:43,920
artifact analysis

1496
00:54:43,920 --> 00:54:45,040
um

1497
00:54:45,040 --> 00:54:47,119
in some cases they put square words in

1498
00:54:47,119 --> 00:54:48,559
there and

1499
00:54:48,559 --> 00:54:50,799
again that can be an indicator so

1500
00:54:50,799 --> 00:54:53,839
and we can start to

1501
00:54:53,839 --> 00:54:55,520
put everything together and even during

1502
00:54:55,520 --> 00:54:57,520
the binary you can see like county

1503
00:54:57,520 --> 00:54:59,839
reference in the binary files

1504
00:54:59,839 --> 00:55:00,880
um

1505
00:55:00,880 --> 00:55:02,799
yeah so there's a lot of data we can

1506
00:55:02,799 --> 00:55:05,359
work with testing

1507
00:55:05,359 --> 00:55:07,280
the key thing okay we understand how to

1508
00:55:07,280 --> 00:55:08,960
detect it we understand how the attacker

1509
00:55:08,960 --> 00:55:10,720
works the lock file the data that they

1510
00:55:10,720 --> 00:55:11,839
work with

1511
00:55:11,839 --> 00:55:14,079
the important thing is to understand uh

1512
00:55:14,079 --> 00:55:15,599
what actually works in your environment

1513
00:55:15,599 --> 00:55:17,680
in terms of preventing them detecting

1514
00:55:17,680 --> 00:55:19,200
and how to respond

1515
00:55:19,200 --> 00:55:22,880
so the likes of checking your avs using

1516
00:55:22,880 --> 00:55:24,559
um sigma

1517
00:55:24,559 --> 00:55:26,559
um there's a lot of

1518
00:55:26,559 --> 00:55:28,400
atomic tests out there that you can do

1519
00:55:28,400 --> 00:55:30,640
very simple test on the endpoint so

1520
00:55:30,640 --> 00:55:33,920
again a lot of resources so like georgie

1521
00:55:33,920 --> 00:55:36,640
generating an atomic case based on the

1522
00:55:36,640 --> 00:55:39,200
change control page and i wrote a sigma

1523
00:55:39,200 --> 00:55:41,599
rule for it so again that's the

1524
00:55:41,599 --> 00:55:43,680
community working in action really to

1525
00:55:43,680 --> 00:55:45,599
developing all these um

1526
00:55:45,599 --> 00:55:47,680
techniques and then being able to test

1527
00:55:47,680 --> 00:55:49,839
them

1528
00:55:49,920 --> 00:55:53,520
with a whole lot of resources um

1529
00:55:53,520 --> 00:55:56,319
far too many to list here um ncsc

1530
00:55:56,319 --> 00:55:58,319
provide the logging made easy solution

1531
00:55:58,319 --> 00:56:00,400
out of the box with a lot of default uh

1532
00:56:00,400 --> 00:56:03,119
windows log configuration which is great

1533
00:56:03,119 --> 00:56:06,400
uh mongen provides hardware

1534
00:56:06,400 --> 00:56:08,799
windows hardening guides

1535
00:56:08,799 --> 00:56:11,200
technique testing

1536
00:56:11,200 --> 00:56:12,880
and the us

1537
00:56:12,880 --> 00:56:15,200
provide bulletins as well

1538
00:56:15,200 --> 00:56:16,720
so

1539
00:56:16,720 --> 00:56:20,160
final advice so rob joyce uh woodwind

1540
00:56:20,160 --> 00:56:23,520
nsa he was head of a chief of data

1541
00:56:23,520 --> 00:56:25,920
access organizations he did a brief

1542
00:56:25,920 --> 00:56:27,440
several years ago

1543
00:56:27,440 --> 00:56:29,520
so one of the key takeaway comments from

1544
00:56:29,520 --> 00:56:32,880
that was and over those logs um look at

1545
00:56:32,880 --> 00:56:34,480
those locks no point just collecting

1546
00:56:34,480 --> 00:56:36,559
them and doing nothing with them

1547
00:56:36,559 --> 00:56:39,280
so is fear from

1548
00:56:39,280 --> 00:56:41,520
the nation state hacker point of view

1549
00:56:41,520 --> 00:56:44,640
was someone actually paying attention to

1550
00:56:44,640 --> 00:56:46,319
the logs and the data

1551
00:56:46,319 --> 00:56:48,559
and actually understanding what's

1552
00:56:48,559 --> 00:56:50,319
happening on the environment what usual

1553
00:56:50,319 --> 00:56:52,079
accounts are being used or

1554
00:56:52,079 --> 00:56:54,640
abused and so on so

1555
00:56:54,640 --> 00:56:56,240
yeah quite often we see a lot of

1556
00:56:56,240 --> 00:56:58,640
configuration where the logs are

1557
00:56:58,640 --> 00:56:59,920
misconfigured

1558
00:56:59,920 --> 00:57:00,960
they haven't got

1559
00:57:00,960 --> 00:57:03,440
the level of granularity not the right

1560
00:57:03,440 --> 00:57:05,599
time zone and it just makes it really

1561
00:57:05,599 --> 00:57:07,839
hard and then you end up with gaps and

1562
00:57:07,839 --> 00:57:09,200
you just don't understand what the truth

1563
00:57:09,200 --> 00:57:10,480
is um

1564
00:57:10,480 --> 00:57:13,280
so that's the key thing logs collecting

1565
00:57:13,280 --> 00:57:15,599
logs is really cheap so

1566
00:57:15,599 --> 00:57:18,079
yeah understand what you can collect

1567
00:57:18,079 --> 00:57:20,400
where you can store it and how to

1568
00:57:20,400 --> 00:57:22,799
exploit them

1569
00:57:22,799 --> 00:57:24,880
so

1570
00:57:24,880 --> 00:57:26,559
thank you um

1571
00:57:26,559 --> 00:57:28,480
i hope you've enjoyed the presentation

1572
00:57:28,480 --> 00:57:31,280
um so keep an eye out on

1573
00:57:31,280 --> 00:57:34,559
twitter feed on our website uh we

1574
00:57:34,559 --> 00:57:36,160
publish um

1575
00:57:36,160 --> 00:57:38,240
blogs um

1576
00:57:38,240 --> 00:57:39,200
talking

1577
00:57:39,200 --> 00:57:41,760
c2 servers uh quite frequently so we've

1578
00:57:41,760 --> 00:57:43,440
tried to produce uh one or two reports

1579
00:57:43,440 --> 00:57:46,640
every month um a big final thanks to the

1580
00:57:46,640 --> 00:57:48,880
dfir report team so

1581
00:57:48,880 --> 00:57:50,960
we spend a lot of time in our effort in

1582
00:57:50,960 --> 00:57:53,359
our own time uh analyzing and reporting

1583
00:57:53,359 --> 00:57:56,880
on techniques um yeah is

1584
00:57:56,880 --> 00:58:00,480
it's a great good team and and it yeah

1585
00:58:00,480 --> 00:58:02,960
everyone's making use of the intelligent

1586
00:58:02,960 --> 00:58:05,599
report out there and a lot of the other

1587
00:58:05,599 --> 00:58:07,599
intelligence reports have also matured

1588
00:58:07,599 --> 00:58:09,440
over the last couple years following

1589
00:58:09,440 --> 00:58:12,000
very similar approaches moving away just

1590
00:58:12,000 --> 00:58:16,880
from ioc or indicator activities as well

1591
00:58:16,880 --> 00:58:21,400
i'm nicer that's three o'clock

