1
00:00:05,040 --> 00:00:06,560
peter giorgio the federal account

2
00:00:06,560 --> 00:00:08,720
executive for security onion solutions a

3
00:00:08,720 --> 00:00:11,120
retired army cyber officer i guess what

4
00:00:11,120 --> 00:00:13,280
i forgot to say before is is yeah i was

5
00:00:13,280 --> 00:00:15,759
a helicopter pilot

6
00:00:15,759 --> 00:00:18,000
joined the army went to the united

7
00:00:18,000 --> 00:00:21,039
states military academy um got a degree

8
00:00:21,039 --> 00:00:22,400
in computer engineering and then

9
00:00:22,400 --> 00:00:25,359
instantly decided i wanted to be cool

10
00:00:25,359 --> 00:00:27,439
so i went and flew helicopters did that

11
00:00:27,439 --> 00:00:29,679
for 13 years

12
00:00:29,679 --> 00:00:31,359
and there was a point where my beloved

13
00:00:31,359 --> 00:00:32,719
looked at me and she said you need to

14
00:00:32,719 --> 00:00:35,040
grow up and get a real job

15
00:00:35,040 --> 00:00:36,719
so i transitioned into

16
00:00:36,719 --> 00:00:38,960
telecommunications engineering which

17
00:00:38,960 --> 00:00:41,200
somehow landed me in cyber and here i

18
00:00:41,200 --> 00:00:42,079
stand

19
00:00:42,079 --> 00:00:42,879
so

20
00:00:42,879 --> 00:00:44,480
let's get into this detection

21
00:00:44,480 --> 00:00:46,559
engineering

22
00:00:46,559 --> 00:00:48,320
all right so

23
00:00:48,320 --> 00:00:50,800
you know the idea here in engineering

24
00:00:50,800 --> 00:00:53,039
your detections is so you're getting

25
00:00:53,039 --> 00:00:56,320
ahead of the adversary and so i've got

26
00:00:56,320 --> 00:00:57,840
at least i think there are two

27
00:00:57,840 --> 00:00:59,920
obligatory dead guy quotes in here uh

28
00:00:59,920 --> 00:01:04,080
both sun tzu uh but the idea here is you

29
00:01:04,080 --> 00:01:06,560
know victorious warriors win then go to

30
00:01:06,560 --> 00:01:08,720
battle

31
00:01:08,720 --> 00:01:11,360
defeated warriors go to battle then seek

32
00:01:11,360 --> 00:01:12,560
to win

33
00:01:12,560 --> 00:01:14,080
so there's there's some thought there

34
00:01:14,080 --> 00:01:16,400
you you've got to be prepared if you

35
00:01:16,400 --> 00:01:18,240
want to have the advantage in your given

36
00:01:18,240 --> 00:01:20,880
environment and you know in security

37
00:01:20,880 --> 00:01:22,960
operations information security or cyber

38
00:01:22,960 --> 00:01:25,520
defense the advantage you have is that

39
00:01:25,520 --> 00:01:27,360
you're there first or at least you're

40
00:01:27,360 --> 00:01:29,119
supposed to be

41
00:01:29,119 --> 00:01:30,720
so how many of us have walked into a

42
00:01:30,720 --> 00:01:32,640
network that was built out of necessity

43
00:01:32,640 --> 00:01:34,159
and then some managers said hey go

44
00:01:34,159 --> 00:01:35,840
defend it

45
00:01:35,840 --> 00:01:36,720
yeah

46
00:01:36,720 --> 00:01:37,600
right

47
00:01:37,600 --> 00:01:39,280
um it's like

48
00:01:39,280 --> 00:01:42,079
the sad face of our lives but that's it

49
00:01:42,079 --> 00:01:43,840
so you've got to circle back on that and

50
00:01:43,840 --> 00:01:44,960
you've got to figure out what your

51
00:01:44,960 --> 00:01:47,520
environment is and and figure out how

52
00:01:47,520 --> 00:01:49,040
you're going to set yourself up for

53
00:01:49,040 --> 00:01:50,479
success

54
00:01:50,479 --> 00:01:52,960
and that's where these ideas of

55
00:01:52,960 --> 00:01:55,119
a detection engineering process i've got

56
00:01:55,119 --> 00:01:57,600
a process to actually build detections

57
00:01:57,600 --> 00:01:59,040
that are meaningful

58
00:01:59,040 --> 00:02:01,840
to the threats and to my environment and

59
00:02:01,840 --> 00:02:03,520
we're going to do that by taking the

60
00:02:03,520 --> 00:02:05,439
capabilities we have

61
00:02:05,439 --> 00:02:07,759
figure out where our gaps in detections

62
00:02:07,759 --> 00:02:10,639
are and then use some tooling

63
00:02:10,639 --> 00:02:13,440
um preferably one we're familiar and and

64
00:02:13,440 --> 00:02:15,120
have an affection for

65
00:02:15,120 --> 00:02:18,480
to close those gaps

66
00:02:19,040 --> 00:02:21,360
all right so knowing's half the battle

67
00:02:21,360 --> 00:02:23,440
because i grew up in the 80s and i love

68
00:02:23,440 --> 00:02:25,599
gi joe and that basically were the

69
00:02:25,599 --> 00:02:27,840
formative years of my life so here's

70
00:02:27,840 --> 00:02:30,400
this this quote from sun tzu and the

71
00:02:30,400 --> 00:02:32,400
reason why it's always resonated with me

72
00:02:32,400 --> 00:02:34,239
is it gets after how do we wrap our

73
00:02:34,239 --> 00:02:36,000
heads around the current situation we're

74
00:02:36,000 --> 00:02:36,959
in

75
00:02:36,959 --> 00:02:38,480
so if you know the enemy and know

76
00:02:38,480 --> 00:02:40,800
yourself your victory will not stand in

77
00:02:40,800 --> 00:02:41,840
doubt

78
00:02:41,840 --> 00:02:43,280
if you know the heaven and you know

79
00:02:43,280 --> 00:02:45,680
earth you may make your victory complete

80
00:02:45,680 --> 00:02:47,280
now we've got to translate that to

81
00:02:47,280 --> 00:02:49,280
modern times a little bit

82
00:02:49,280 --> 00:02:51,519
obviously when this was written sun tzu

83
00:02:51,519 --> 00:02:52,879
was looking at the world from a

84
00:02:52,879 --> 00:02:53,920
different

85
00:02:53,920 --> 00:02:55,920
time and different place

86
00:02:55,920 --> 00:02:58,480
the first sentence is pretty obvious

87
00:02:58,480 --> 00:03:00,319
if you know your strengths your

88
00:03:00,319 --> 00:03:01,840
weaknesses

89
00:03:01,840 --> 00:03:03,680
your capabilities

90
00:03:03,680 --> 00:03:05,680
your ability to maneuver

91
00:03:05,680 --> 00:03:07,599
that's a good place to be if you know

92
00:03:07,599 --> 00:03:10,480
that about your adversary that's also a

93
00:03:10,480 --> 00:03:12,080
great place to be

94
00:03:12,080 --> 00:03:13,760
now that second sentence is a little

95
00:03:13,760 --> 00:03:15,360
less clear what was he getting after

96
00:03:15,360 --> 00:03:16,879
that

97
00:03:16,879 --> 00:03:19,440
he's talking about the terrain and the

98
00:03:19,440 --> 00:03:21,840
conditions of the terrain so if you were

99
00:03:21,840 --> 00:03:23,040
in physical

100
00:03:23,040 --> 00:03:24,799
battle that would be you know i'm

101
00:03:24,799 --> 00:03:26,400
standing in a mountainous environment i

102
00:03:26,400 --> 00:03:28,319
got forests and there's a valley and

103
00:03:28,319 --> 00:03:31,120
it's raining and so that means something

104
00:03:31,120 --> 00:03:33,280
in this in the context of cyber that

105
00:03:33,280 --> 00:03:35,280
means something else

106
00:03:35,280 --> 00:03:37,519
not every network is the same not every

107
00:03:37,519 --> 00:03:39,200
network behaves the same not every

108
00:03:39,200 --> 00:03:42,159
network has the same purpose

109
00:03:42,159 --> 00:03:43,040
so

110
00:03:43,040 --> 00:03:47,280
if we were to consider that in any given

111
00:03:47,280 --> 00:03:49,360
network any given environment there is

112
00:03:49,360 --> 00:03:51,120
probably somebody out there looking to

113
00:03:51,120 --> 00:03:53,920
gain something information money or

114
00:03:53,920 --> 00:03:55,040
power

115
00:03:55,040 --> 00:03:57,760
and there is a victim or a target from

116
00:03:57,760 --> 00:04:00,640
which they can gain that from

117
00:04:00,640 --> 00:04:02,319
now that's pretty open

118
00:04:02,319 --> 00:04:05,280
and that probably means most of us all

119
00:04:05,280 --> 00:04:07,519
of us in this room most likely

120
00:04:07,519 --> 00:04:09,920
so the idea here is in order to gain

121
00:04:09,920 --> 00:04:12,400
situational understanding we must you

122
00:04:12,400 --> 00:04:14,640
must know yourself you must know your

123
00:04:14,640 --> 00:04:17,358
terrain and you must know your adversary

124
00:04:17,358 --> 00:04:19,519
and this allows us to make decisions

125
00:04:19,519 --> 00:04:20,880
faster because that's what we really

126
00:04:20,880 --> 00:04:23,199
need right so when bad stuff is

127
00:04:23,199 --> 00:04:24,800
happening you got management breathing

128
00:04:24,800 --> 00:04:27,280
down your throat what is going on and

129
00:04:27,280 --> 00:04:30,160
how do i make the bad things stop

130
00:04:30,160 --> 00:04:32,800
um some call that the ooda loop if

131
00:04:32,800 --> 00:04:34,639
you're familiar with an air force

132
00:04:34,639 --> 00:04:38,160
concept observe orient detect and decide

133
00:04:38,160 --> 00:04:39,280
and act

134
00:04:39,280 --> 00:04:41,360
um so that's that's what a lot of this

135
00:04:41,360 --> 00:04:43,520
is about and which is why

136
00:04:43,520 --> 00:04:44,960
in the

137
00:04:44,960 --> 00:04:46,720
information security industry we started

138
00:04:46,720 --> 00:04:48,960
having this conversation about detection

139
00:04:48,960 --> 00:04:50,479
engineering

140
00:04:50,479 --> 00:04:51,520
so

141
00:04:51,520 --> 00:04:53,600
uh i did a little bit of research kind

142
00:04:53,600 --> 00:04:55,199
of digging around trying to figure out

143
00:04:55,199 --> 00:04:57,120
what is detection engineering where did

144
00:04:57,120 --> 00:04:58,479
it come from

145
00:04:58,479 --> 00:05:02,479
um and my google foo led me to two

146
00:05:02,479 --> 00:05:04,880
places well lots of places as google

147
00:05:04,880 --> 00:05:06,400
does but there were two big ones that

148
00:05:06,400 --> 00:05:08,160
resonated with me

149
00:05:08,160 --> 00:05:09,520
and they're represented in the two

150
00:05:09,520 --> 00:05:11,520
graphics on this slide so the top one is

151
00:05:11,520 --> 00:05:14,160
from gigamon uh which is why the color

152
00:05:14,160 --> 00:05:16,479
scheme might look familiar and then the

153
00:05:16,479 --> 00:05:19,120
bottom one is from spectre ops and and

154
00:05:19,120 --> 00:05:20,400
what both

155
00:05:20,400 --> 00:05:23,360
uh authors were really getting at is you

156
00:05:23,360 --> 00:05:25,680
know first like everything else in cyber

157
00:05:25,680 --> 00:05:27,600
security it's a process

158
00:05:27,600 --> 00:05:30,160
it never ends it keeps going to all

159
00:05:30,160 --> 00:05:33,600
infinity until you move on or somebody

160
00:05:33,600 --> 00:05:36,560
somebody better comes to help you

161
00:05:36,560 --> 00:05:38,400
so we're going to start

162
00:05:38,400 --> 00:05:40,080
with you got to start the process

163
00:05:40,080 --> 00:05:41,680
somewhere you know

164
00:05:41,680 --> 00:05:43,120
everything's got to start somewhere so

165
00:05:43,120 --> 00:05:45,039
start with the threat template

166
00:05:45,039 --> 00:05:46,880
even if it's not the one you think

167
00:05:46,880 --> 00:05:48,880
you're currently being faced with and

168
00:05:48,880 --> 00:05:50,160
that's what we'll do here i'll walk

169
00:05:50,160 --> 00:05:52,240
through something where i've just picked

170
00:05:52,240 --> 00:05:53,199
something

171
00:05:53,199 --> 00:05:55,360
for the sake of picking something it

172
00:05:55,360 --> 00:05:57,520
gets you started in the process you can

173
00:05:57,520 --> 00:05:59,919
work through it and then as you learn

174
00:05:59,919 --> 00:06:02,479
you'll make new decisions and and tune

175
00:06:02,479 --> 00:06:04,160
that up

176
00:06:04,160 --> 00:06:05,520
now you also have to understand your

177
00:06:05,520 --> 00:06:07,360
capabilities what do you have and that's

178
00:06:07,360 --> 00:06:09,440
kind of where this lower diagram gets

179
00:06:09,440 --> 00:06:12,479
gets into the equation is

180
00:06:12,479 --> 00:06:15,840
if you're a shop of one

181
00:06:15,840 --> 00:06:18,880
how broad can your detections be do you

182
00:06:18,880 --> 00:06:21,919
have time to investigate all of that

183
00:06:21,919 --> 00:06:24,400
or is it worth it to engineer more

184
00:06:24,400 --> 00:06:27,199
precise detections that you can respond

185
00:06:27,199 --> 00:06:28,400
to quickly

186
00:06:28,400 --> 00:06:31,039
now there's risk and reward there

187
00:06:31,039 --> 00:06:35,759
now if you're a shop of 20 30 100

188
00:06:35,759 --> 00:06:38,960
can can that shop absorb less precise

189
00:06:38,960 --> 00:06:41,520
detections but with a higher degree of

190
00:06:41,520 --> 00:06:43,039
finding something

191
00:06:43,039 --> 00:06:45,360
shady going on

192
00:06:45,360 --> 00:06:46,960
and that's where knowing yourself is

193
00:06:46,960 --> 00:06:48,800
important and how you walk through this

194
00:06:48,800 --> 00:06:50,400
process

195
00:06:50,400 --> 00:06:52,080
and then finally

196
00:06:52,080 --> 00:06:54,319
you got to start working with your

197
00:06:54,319 --> 00:06:56,479
capabilities and find those gaps what am

198
00:06:56,479 --> 00:07:00,160
i not seeing what's not being alerted

199
00:07:00,160 --> 00:07:00,800
and

200
00:07:00,800 --> 00:07:02,319
for the purposes of this we're going to

201
00:07:02,319 --> 00:07:04,080
say alerts are

202
00:07:04,080 --> 00:07:06,400
the thing we're driving towards so

203
00:07:06,400 --> 00:07:08,560
something discreet that immediately

204
00:07:08,560 --> 00:07:10,720
gives you attention so that you can

205
00:07:10,720 --> 00:07:13,440
focus your investigative time into that

206
00:07:13,440 --> 00:07:14,400
thing

207
00:07:14,400 --> 00:07:16,720
um you know and i would argue that

208
00:07:16,720 --> 00:07:18,240
that's kind of the output of threat

209
00:07:18,240 --> 00:07:20,240
hunting threat hunting you're trolling

210
00:07:20,240 --> 00:07:21,680
around you're looking for evil and then

211
00:07:21,680 --> 00:07:23,360
you find it and you go

212
00:07:23,360 --> 00:07:24,800
hey guys

213
00:07:24,800 --> 00:07:25,759
alert

214
00:07:25,759 --> 00:07:27,440
something bad's going on well we're

215
00:07:27,440 --> 00:07:28,800
going to automate that

216
00:07:28,800 --> 00:07:30,880
or that's the goal because

217
00:07:30,880 --> 00:07:33,199
computers go really really fast and no

218
00:07:33,199 --> 00:07:34,800
matter how much coffee i drink i can't

219
00:07:34,800 --> 00:07:37,759
seem to keep up with them

220
00:07:38,160 --> 00:07:39,840
all right so we're going to do some more

221
00:07:39,840 --> 00:07:41,759
gaming and i love this picture because

222
00:07:41,759 --> 00:07:44,240
that's exactly what wargaming feels like

223
00:07:44,240 --> 00:07:46,400
it's depressing

224
00:07:46,400 --> 00:07:47,840
but somewhere what you don't see in the

225
00:07:47,840 --> 00:07:49,599
pictures there's some young person that

226
00:07:49,599 --> 00:07:51,120
had to build that train model and

227
00:07:51,120 --> 00:07:52,400
they're like giddy with themselves

228
00:07:52,400 --> 00:07:53,680
because they spent three days building

229
00:07:53,680 --> 00:07:55,520
it and it finally gets used and then it

230
00:07:55,520 --> 00:07:58,319
gets thrown out at the end

231
00:07:58,319 --> 00:07:59,280
so

232
00:07:59,280 --> 00:08:01,199
my recommendation

233
00:08:01,199 --> 00:08:03,840
don't do this live in production

234
00:08:03,840 --> 00:08:06,080
for the first time

235
00:08:06,080 --> 00:08:08,000
build a test environment that focuses on

236
00:08:08,000 --> 00:08:09,680
the capability you want to test it

237
00:08:09,680 --> 00:08:13,520
replicates your capability for detection

238
00:08:13,520 --> 00:08:14,479
um

239
00:08:14,479 --> 00:08:17,599
for this i'm i picked wazoo for windows

240
00:08:17,599 --> 00:08:20,479
endpoint detection with wazoo um

241
00:08:20,479 --> 00:08:22,160
that's

242
00:08:22,160 --> 00:08:23,840
that's what i use at home because i'm a

243
00:08:23,840 --> 00:08:25,520
total nerd and i censor all of my kids

244
00:08:25,520 --> 00:08:27,520
computers

245
00:08:27,520 --> 00:08:29,919
the threat template i chose so i used

246
00:08:29,919 --> 00:08:31,599
the mitre attack framework and then i

247
00:08:31,599 --> 00:08:33,279
went out to this thing called the atomic

248
00:08:33,279 --> 00:08:36,320
red team uh it's it's free and open by a

249
00:08:36,320 --> 00:08:39,360
company called red canary and it's got a

250
00:08:39,360 --> 00:08:42,159
fair number of discrete tests

251
00:08:42,159 --> 00:08:45,360
that look like

252
00:08:45,519 --> 00:08:48,000
tactics from the miter attack framework

253
00:08:48,000 --> 00:08:49,920
but don't actually

254
00:08:49,920 --> 00:08:51,440
you know cause damage to your

255
00:08:51,440 --> 00:08:52,480
environment

256
00:08:52,480 --> 00:08:54,560
and they also provide the steps to back

257
00:08:54,560 --> 00:08:56,720
that out if you need to

258
00:08:56,720 --> 00:08:59,360
uh and the other cool thing about it is

259
00:08:59,360 --> 00:09:01,360
it's got a powershell framework so you

260
00:09:01,360 --> 00:09:03,120
can just run powershell commands and

261
00:09:03,120 --> 00:09:04,880
i'll show i just scripted it

262
00:09:04,880 --> 00:09:06,080
um

263
00:09:06,080 --> 00:09:08,320
because i'm lazy and it was easier for

264
00:09:08,320 --> 00:09:10,560
me to do that

265
00:09:10,560 --> 00:09:13,120
you've got to see it

266
00:09:13,120 --> 00:09:15,279
and we're going to use a capability near

267
00:09:15,279 --> 00:09:18,080
and dear to us to observe this event

268
00:09:18,080 --> 00:09:20,399
document what's going on and then figure

269
00:09:20,399 --> 00:09:22,080
out how to close that gap and that's why

270
00:09:22,080 --> 00:09:24,000
i highlighted playbook and so we're

271
00:09:24,000 --> 00:09:25,600
going to use security onion to do this

272
00:09:25,600 --> 00:09:27,760
because uh you know funny thing it

273
00:09:27,760 --> 00:09:29,360
already leverages most of the things

274
00:09:29,360 --> 00:09:30,800
i've just talked about and i'm just

275
00:09:30,800 --> 00:09:32,560
bringing in the atomic red team to kind

276
00:09:32,560 --> 00:09:35,120
of drive

277
00:09:35,120 --> 00:09:38,399
this event um so cool little picture of

278
00:09:38,399 --> 00:09:41,279
what i set up um it can be pretty simple

279
00:09:41,279 --> 00:09:43,600
uh i'm running this one on my computer

280
00:09:43,600 --> 00:09:45,200
so if you're a small shop of one and

281
00:09:45,200 --> 00:09:46,880
this is what you've got

282
00:09:46,880 --> 00:09:48,560
you can set up something small work

283
00:09:48,560 --> 00:09:50,800
through your capability and then take

284
00:09:50,800 --> 00:09:52,959
those detections you've engineered and

285
00:09:52,959 --> 00:09:56,560
push that into production

286
00:09:57,760 --> 00:09:59,760
uh all right so windows endpoint

287
00:09:59,760 --> 00:10:02,320
observation uh i wish i could say i was

288
00:10:02,320 --> 00:10:04,320
smart and these were i came up with this

289
00:10:04,320 --> 00:10:06,000
list of logs on my own but that's not

290
00:10:06,000 --> 00:10:06,880
true

291
00:10:06,880 --> 00:10:10,079
i went out to sands i pulled up a poster

292
00:10:10,079 --> 00:10:12,240
i looked at the poster for about five

293
00:10:12,240 --> 00:10:14,160
minutes and everything that looked like

294
00:10:14,160 --> 00:10:16,480
a windows log i underlined it and then

295
00:10:16,480 --> 00:10:18,959
put it on the slide so that's how i came

296
00:10:18,959 --> 00:10:20,560
up with that list

297
00:10:20,560 --> 00:10:22,399
i've i found it to be really really

298
00:10:22,399 --> 00:10:24,320
useful in finding bad things that are

299
00:10:24,320 --> 00:10:26,720
going on so those are the windows events

300
00:10:26,720 --> 00:10:29,839
uh that i'm pulling in sysmon a very

301
00:10:29,839 --> 00:10:32,959
popular capability for for getting more

302
00:10:32,959 --> 00:10:34,880
information out of windows

303
00:10:34,880 --> 00:10:37,040
and i'm running the good old swift on

304
00:10:37,040 --> 00:10:38,880
security rule set

305
00:10:38,880 --> 00:10:41,360
very easy to get and implement and then

306
00:10:41,360 --> 00:10:44,320
finally using wazoo to ingest those logs

307
00:10:44,320 --> 00:10:46,160
and then leverage the other capabilities

308
00:10:46,160 --> 00:10:49,760
of that host intrusion detection system

309
00:10:49,760 --> 00:10:52,880
so there's a lot you can get out of that

310
00:10:52,880 --> 00:10:55,120
in this particular case i use the logs

311
00:10:55,120 --> 00:10:56,880
more for the detection there is so much

312
00:10:56,880 --> 00:10:58,399
more you can do with wazoo if you dig

313
00:10:58,399 --> 00:11:00,640
into that configuration file and figure

314
00:11:00,640 --> 00:11:04,880
out what else you can get out of it

315
00:11:05,040 --> 00:11:07,360
threat templating like i said i use the

316
00:11:07,360 --> 00:11:09,920
atomic red team there are a lot of

317
00:11:09,920 --> 00:11:12,800
tactics on this slide

318
00:11:12,800 --> 00:11:14,959
for today i'm going to focus on one

319
00:11:14,959 --> 00:11:16,880
windows command shell execution of a

320
00:11:16,880 --> 00:11:18,800
batch file and we'll walk through that

321
00:11:18,800 --> 00:11:20,880
and kind of what that looks like and

322
00:11:20,880 --> 00:11:22,800
then what the the detection looks like

323
00:11:22,800 --> 00:11:25,279
on the back end of it um

324
00:11:25,279 --> 00:11:27,360
but for small shops this is something

325
00:11:27,360 --> 00:11:29,760
you can do and it's already like i said

326
00:11:29,760 --> 00:11:31,680
there's a there's a powershell framework

327
00:11:31,680 --> 00:11:34,320
for this you can do this very quickly uh

328
00:11:34,320 --> 00:11:36,720
in a in a test environment and then take

329
00:11:36,720 --> 00:11:38,320
a look at your capabilities and figure

330
00:11:38,320 --> 00:11:40,480
out what you're seeing what you may not

331
00:11:40,480 --> 00:11:43,279
be seeing and how to close that

332
00:11:43,279 --> 00:11:44,959
i'm going to use security onion 2 to

333
00:11:44,959 --> 00:11:46,640
watch all of this

334
00:11:46,640 --> 00:11:49,680
a lot of data available if you're using

335
00:11:49,680 --> 00:11:52,560
security onion 2. so cerakada is giving

336
00:11:52,560 --> 00:11:55,360
me the nids alerts

337
00:11:55,360 --> 00:11:57,120
zeke is giving me

338
00:11:57,120 --> 00:11:59,920
packet metadata events

339
00:11:59,920 --> 00:12:02,079
strelka is in there so if you want exif

340
00:12:02,079 --> 00:12:04,639
analysis of extracted files or if you

341
00:12:04,639 --> 00:12:06,320
want yara

342
00:12:06,320 --> 00:12:08,560
rule matches to occur strelka can do

343
00:12:08,560 --> 00:12:10,320
that for you so that's another point

344
00:12:10,320 --> 00:12:12,959
where you can engineer detections based

345
00:12:12,959 --> 00:12:15,200
on a threat template you might have for

346
00:12:15,200 --> 00:12:17,120
your organization

347
00:12:17,120 --> 00:12:18,800
wazoo we've already talked about so

348
00:12:18,800 --> 00:12:20,240
that's the back end of it and then

349
00:12:20,240 --> 00:12:22,440
playbook which we're going to use sigma

350
00:12:22,440 --> 00:12:25,920
rules that will be driven by a last

351
00:12:25,920 --> 00:12:28,800
alert to give us that alert that focuses

352
00:12:28,800 --> 00:12:31,360
uh focuses us very quickly on something

353
00:12:31,360 --> 00:12:34,160
that's going on

354
00:12:35,760 --> 00:12:37,440
all right so this is how it's going to

355
00:12:37,440 --> 00:12:40,000
go and and i'm actually i was inspired

356
00:12:40,000 --> 00:12:43,120
by wes lambert's uh school for soar for

357
00:12:43,120 --> 00:12:45,040
people who don't know how to soar but

358
00:12:45,040 --> 00:12:47,360
want to soar good and do other stuff too

359
00:12:47,360 --> 00:12:49,040
um so we're gonna we're gonna go through

360
00:12:49,040 --> 00:12:50,000
a demo

361
00:12:50,000 --> 00:12:53,200
uh several of us have offered sacrifices

362
00:12:53,200 --> 00:12:55,680
um i've prayed to the demo gods and

363
00:12:55,680 --> 00:12:57,360
we'll see how this goes

364
00:12:57,360 --> 00:12:59,200
uh because sometimes they listen and

365
00:12:59,200 --> 00:13:01,519
sometimes they like to put adventure in

366
00:13:01,519 --> 00:13:02,639
your life

367
00:13:02,639 --> 00:13:05,360
uh so we're gonna use the the atomic red

368
00:13:05,360 --> 00:13:08,079
team to invoke this particular

369
00:13:08,079 --> 00:13:09,040
tactic

370
00:13:09,040 --> 00:13:11,120
uh i built a powershell script and we'll

371
00:13:11,120 --> 00:13:12,880
look at that real quick

372
00:13:12,880 --> 00:13:15,200
and then we'll measure what happens and

373
00:13:15,200 --> 00:13:17,600
so i i created a somewhat arbitrary

374
00:13:17,600 --> 00:13:20,639
metric for measurement

375
00:13:21,360 --> 00:13:23,760
i recommend this because

376
00:13:23,760 --> 00:13:25,600
arbitrary metrics for measurement

377
00:13:25,600 --> 00:13:28,320
sometimes resonate with management

378
00:13:28,320 --> 00:13:30,880
so if i can say to management

379
00:13:30,880 --> 00:13:32,639
having been management at one point in

380
00:13:32,639 --> 00:13:37,120
my life i started at 50

381
00:13:37,200 --> 00:13:41,440
and for very little money ended up at 75

382
00:13:41,440 --> 00:13:44,079
and if you give me more money i can get

383
00:13:44,079 --> 00:13:45,680
to a hundred

384
00:13:45,680 --> 00:13:47,440
that's valuable

385
00:13:47,440 --> 00:13:50,079
improves our lives it makes us happier

386
00:13:50,079 --> 00:13:51,680
we're better human beings more

387
00:13:51,680 --> 00:13:54,320
productive members of society so having

388
00:13:54,320 --> 00:13:56,160
a metric is useful because then it's not

389
00:13:56,160 --> 00:13:57,920
just my opinion

390
00:13:57,920 --> 00:13:59,519
my beard is longer than your beard

391
00:13:59,519 --> 00:14:01,600
therefore i'm right

392
00:14:01,600 --> 00:14:04,000
i've used actual hard numbers

393
00:14:04,000 --> 00:14:05,600
so

394
00:14:05,600 --> 00:14:08,399
let's see how this demo goes

395
00:14:08,399 --> 00:14:09,920
okay i've gotten through step one i can

396
00:14:09,920 --> 00:14:11,600
get to my screen

397
00:14:11,600 --> 00:14:14,000
so we're staring at security onion let

398
00:14:14,000 --> 00:14:15,920
me refresh this because i was i was just

399
00:14:15,920 --> 00:14:17,600
looking at five minutes back so this is

400
00:14:17,600 --> 00:14:19,600
this is where we're starting i've got no

401
00:14:19,600 --> 00:14:22,160
alerts nothing's going on uh

402
00:14:22,160 --> 00:14:24,240
not not a lot's happening in this

403
00:14:24,240 --> 00:14:25,920
environment

404
00:14:25,920 --> 00:14:28,000
and i'm going to pull up powershell

405
00:14:28,000 --> 00:14:30,800
i think it looks pretty good

406
00:14:30,800 --> 00:14:32,720
and we'll clear that

407
00:14:32,720 --> 00:14:34,800
so let's look at this uh

408
00:14:34,800 --> 00:14:37,120
script i wrote

409
00:14:37,120 --> 00:14:40,959
uh and and so it's a super simple script

410
00:14:40,959 --> 00:14:42,399
uh one thing i'm going to do is i'm

411
00:14:42,399 --> 00:14:44,480
going to use this start transcript thing

412
00:14:44,480 --> 00:14:46,240
so in powershell you can take

413
00:14:46,240 --> 00:14:47,680
transcripts of what's happening in

414
00:14:47,680 --> 00:14:49,920
command line push that off to a text

415
00:14:49,920 --> 00:14:52,240
file so if if you're running a lot of

416
00:14:52,240 --> 00:14:54,639
these like say i wanted to run 10

417
00:14:54,639 --> 00:14:57,440
tactics at once i can start stop 10

418
00:14:57,440 --> 00:14:59,680
different transcripts so that i have 10

419
00:14:59,680 --> 00:15:01,360
different discrete things and then go

420
00:15:01,360 --> 00:15:02,399
through them

421
00:15:02,399 --> 00:15:05,199
individually

422
00:15:05,199 --> 00:15:06,560
because we're also going to take time

423
00:15:06,560 --> 00:15:08,399
snapshots so you can go back into

424
00:15:08,399 --> 00:15:10,160
security on you and find that time

425
00:15:10,160 --> 00:15:13,040
window reference the attack that you ran

426
00:15:13,040 --> 00:15:14,560
and then make sure that you're seeing

427
00:15:14,560 --> 00:15:16,160
the alerts and the events that you

428
00:15:16,160 --> 00:15:17,600
wanted to see

429
00:15:17,600 --> 00:15:19,519
or that you should be seen because you

430
00:15:19,519 --> 00:15:20,720
might get in there and be like i see

431
00:15:20,720 --> 00:15:23,839
nothing oh that's bad okay so what data

432
00:15:23,839 --> 00:15:26,880
what data am i not collecting what what

433
00:15:26,880 --> 00:15:29,440
is missed am i not positioned right from

434
00:15:29,440 --> 00:15:31,759
a network perspective is my agent

435
00:15:31,759 --> 00:15:34,160
configured appropriately for that

436
00:15:34,160 --> 00:15:36,320
particular tactic

437
00:15:36,320 --> 00:15:37,120
um

438
00:15:37,120 --> 00:15:39,040
so below the transcript we get to the

439
00:15:39,040 --> 00:15:42,160
the time so time is always important so

440
00:15:42,160 --> 00:15:43,759
we're going to get the start

441
00:15:43,759 --> 00:15:45,759
i'm going to run the attack so that's

442
00:15:45,759 --> 00:15:47,920
the invoke atomic test

443
00:15:47,920 --> 00:15:50,079
uh the tactic number

444
00:15:50,079 --> 00:15:51,519
and then each one of these tactics

445
00:15:51,519 --> 00:15:53,920
actually have like multiple test numbers

446
00:15:53,920 --> 00:15:55,920
so this particular test

447
00:15:55,920 --> 00:15:58,880
uh executes a batch script that's in a

448
00:15:58,880 --> 00:16:00,639
temp folder

449
00:16:00,639 --> 00:16:02,480
and it's there it does it doesn't do it

450
00:16:02,480 --> 00:16:04,880
well it does do something it just uh

451
00:16:04,880 --> 00:16:08,160
runs a directory walk of the c drive

452
00:16:08,160 --> 00:16:10,160
and then we'll take the time stamp at

453
00:16:10,160 --> 00:16:11,920
the end of the test

454
00:16:11,920 --> 00:16:13,920
we'll stop the transcript and then we'll

455
00:16:13,920 --> 00:16:16,399
write to the command line the time

456
00:16:16,399 --> 00:16:19,120
window and i'm actually adding about two

457
00:16:19,120 --> 00:16:20,959
minutes onto it because

458
00:16:20,959 --> 00:16:22,720
if you're going to run this and then go

459
00:16:22,720 --> 00:16:25,279
right into security onion it takes a

460
00:16:25,279 --> 00:16:27,120
little time to parse it

461
00:16:27,120 --> 00:16:28,880
so you've got to be a little patient so

462
00:16:28,880 --> 00:16:30,560
i added about two minutes so that i

463
00:16:30,560 --> 00:16:32,399
don't have to mess with the time picker

464
00:16:32,399 --> 00:16:34,320
and and it's just there

465
00:16:34,320 --> 00:16:36,480
so simple script you can do this at

466
00:16:36,480 --> 00:16:38,959
scale so like i think uh my total

467
00:16:38,959 --> 00:16:41,519
template had 68 tests

468
00:16:41,519 --> 00:16:44,399
if i wanted to script out all 68 tests

469
00:16:44,399 --> 00:16:46,000
it's certainly possible

470
00:16:46,000 --> 00:16:48,880
um i considered it but it seemed like uh

471
00:16:48,880 --> 00:16:50,480
it would be fraught with peril an

472
00:16:50,480 --> 00:16:52,560
opportunity for destruction so i didn't

473
00:16:52,560 --> 00:16:54,560
i kept it small

474
00:16:54,560 --> 00:16:57,759
so at this point this is

475
00:16:57,759 --> 00:16:59,839
pretty simple

476
00:16:59,839 --> 00:17:01,920
so we'll see how well this goes i'm just

477
00:17:01,920 --> 00:17:04,400
going to run it it runs

478
00:17:04,400 --> 00:17:06,640
all went well i see no red in my

479
00:17:06,640 --> 00:17:08,400
terminal so it means i did something

480
00:17:08,400 --> 00:17:09,919
right

481
00:17:09,919 --> 00:17:14,079
and right here we have the time stamp

482
00:17:14,079 --> 00:17:15,839
and i did some formatting to make my

483
00:17:15,839 --> 00:17:19,839
life easy so i just copied that

484
00:17:19,839 --> 00:17:22,799
and i'm going to come over here to my my

485
00:17:22,799 --> 00:17:25,280
hunt interface

486
00:17:25,280 --> 00:17:27,280
i'm just going to copy that time in

487
00:17:27,280 --> 00:17:30,080
there i'm going to give it a second

488
00:17:30,080 --> 00:17:32,160
and it's going to mess with me and not

489
00:17:32,160 --> 00:17:33,919
there we go

490
00:17:33,919 --> 00:17:36,720
momentary sweating so we have data

491
00:17:36,720 --> 00:17:38,240
something happened something good

492
00:17:38,240 --> 00:17:39,280
happened

493
00:17:39,280 --> 00:17:41,919
uh and hopefully

494
00:17:41,919 --> 00:17:46,000
uh so i don't see any any alerts in this

495
00:17:46,000 --> 00:17:47,760
list of files

496
00:17:47,760 --> 00:17:50,160
but we definitely have events so i'm at

497
00:17:50,160 --> 00:17:51,679
that 50

498
00:17:51,679 --> 00:17:53,520
we saw events

499
00:17:53,520 --> 00:17:54,960
in this particular case i'm going to

500
00:17:54,960 --> 00:17:57,760
focus on one in particular

501
00:17:57,760 --> 00:17:58,559
it's

502
00:17:58,559 --> 00:18:00,640
see if i can zoom this in i can

503
00:18:00,640 --> 00:18:03,520
the sysmond process creation so let's

504
00:18:03,520 --> 00:18:05,120
let's take a look at that so i'm just

505
00:18:05,120 --> 00:18:07,120
going to include that in my filter

506
00:18:07,120 --> 00:18:09,600
we're going to take a look at it and so

507
00:18:09,600 --> 00:18:12,160
we see a couple of processed cubital

508
00:18:12,160 --> 00:18:15,120
executables powershell command line

509
00:18:15,120 --> 00:18:17,600
host name exe and who am i so i'm just

510
00:18:17,600 --> 00:18:20,240
going to expand this first one

511
00:18:20,240 --> 00:18:23,280
and what i'm really curious about so we

512
00:18:23,280 --> 00:18:26,799
i'm going to focus right in here

513
00:18:27,039 --> 00:18:28,960
parent command line

514
00:18:28,960 --> 00:18:31,840
here it is process command line

515
00:18:31,840 --> 00:18:33,919
right here at the end

516
00:18:33,919 --> 00:18:35,679
there's the the

517
00:18:35,679 --> 00:18:38,400
batch file that was run okay so we have

518
00:18:38,400 --> 00:18:39,600
an event

519
00:18:39,600 --> 00:18:42,000
we have discrete observables in that

520
00:18:42,000 --> 00:18:43,360
event

521
00:18:43,360 --> 00:18:46,240
that now i can close an alert gap on and

522
00:18:46,240 --> 00:18:49,280
actually create something to say hey

523
00:18:49,280 --> 00:18:51,600
a batch file was run

524
00:18:51,600 --> 00:18:53,840
now depending on your environment and

525
00:18:53,840 --> 00:18:56,400
the habits of your administrators and

526
00:18:56,400 --> 00:18:58,799
all of those other considerations either

527
00:18:58,799 --> 00:19:00,960
you get a lot of batch files in your

528
00:19:00,960 --> 00:19:04,400
environment or you get very few

529
00:19:04,400 --> 00:19:06,799
nowadays i would hope for few but you

530
00:19:06,799 --> 00:19:08,320
never know

531
00:19:08,320 --> 00:19:11,280
how far back somebody's google foo goes

532
00:19:11,280 --> 00:19:12,799
um so

533
00:19:12,799 --> 00:19:14,880
great we've got something to start with

534
00:19:14,880 --> 00:19:18,160
and and this is where playbook

535
00:19:18,160 --> 00:19:19,679
comes into

536
00:19:19,679 --> 00:19:21,919
our lives

537
00:19:21,919 --> 00:19:24,160
playbook is a capability that's in

538
00:19:24,160 --> 00:19:27,760
security onion it leverages sigma rules

539
00:19:27,760 --> 00:19:30,640
to create queries that a last alert will

540
00:19:30,640 --> 00:19:31,520
run

541
00:19:31,520 --> 00:19:33,840
against data inelastic search and then

542
00:19:33,840 --> 00:19:35,679
generate an alert for you on the alerts

543
00:19:35,679 --> 00:19:36,880
interface

544
00:19:36,880 --> 00:19:39,280
there are a ton of open

545
00:19:39,280 --> 00:19:41,840
free and open rules that come already

546
00:19:41,840 --> 00:19:44,559
integrated in security onion i wrote one

547
00:19:44,559 --> 00:19:46,400
specifically for this to kind of

548
00:19:46,400 --> 00:19:48,400
highlight how

549
00:19:48,400 --> 00:19:50,799
doable this really is so i've got this

550
00:19:50,799 --> 00:19:55,039
first one batch script execution

551
00:19:55,039 --> 00:19:57,120
i'm going to expand the actual sigma

552
00:19:57,120 --> 00:19:59,200
rule

553
00:19:59,200 --> 00:20:00,640
let's

554
00:20:00,640 --> 00:20:02,720
get a little closer

555
00:20:02,720 --> 00:20:03,679
all right

556
00:20:03,679 --> 00:20:07,039
pretty straightforward um you know it's

557
00:20:07,039 --> 00:20:09,200
it's written in simple

558
00:20:09,200 --> 00:20:10,559
simple language that's easy to

559
00:20:10,559 --> 00:20:11,840
understand

560
00:20:11,840 --> 00:20:14,000
um so what are we doing with this thing

561
00:20:14,000 --> 00:20:14,880
uh

562
00:20:14,880 --> 00:20:16,559
once we get through the titling and the

563
00:20:16,559 --> 00:20:18,880
dating we can tag it

564
00:20:18,880 --> 00:20:22,320
so i've tagged it with the mitre attack

565
00:20:22,320 --> 00:20:24,640
appropriate tactic number

566
00:20:24,640 --> 00:20:27,039
and technique type

567
00:20:27,039 --> 00:20:28,000
we've

568
00:20:28,000 --> 00:20:30,240
looking for a log source category so

569
00:20:30,240 --> 00:20:32,159
process creations

570
00:20:32,159 --> 00:20:34,320
out of the sigma rule set or the sigma

571
00:20:34,320 --> 00:20:35,440
log set

572
00:20:35,440 --> 00:20:36,640
and i'm going to make a couple of

573
00:20:36,640 --> 00:20:38,880
selections so in this particular case

574
00:20:38,880 --> 00:20:41,840
i'm looking for powershell exe

575
00:20:41,840 --> 00:20:43,440
in the image

576
00:20:43,440 --> 00:20:45,840
i'm looking for the original power the

577
00:20:45,840 --> 00:20:48,400
original file name to be powershell exe

578
00:20:48,400 --> 00:20:50,159
and i'm looking for a process command

579
00:20:50,159 --> 00:20:54,320
line that contains that dot bat

580
00:20:54,320 --> 00:20:56,080
then i'm going to select all those

581
00:20:56,080 --> 00:20:58,159
conditions i want to see all three of

582
00:20:58,159 --> 00:21:00,080
those so there's no or statements it's

583
00:21:00,080 --> 00:21:02,400
all and i've got a couple of notes for

584
00:21:02,400 --> 00:21:04,320
false positives so

585
00:21:04,320 --> 00:21:07,280
if we're looking at it

586
00:21:12,960 --> 00:21:14,720
okay it still works

587
00:21:14,720 --> 00:21:17,840
i'll show you

588
00:21:19,760 --> 00:21:22,080
i'll prove because he wants to to do

589
00:21:22,080 --> 00:21:24,080
that to me as it still works

590
00:21:24,080 --> 00:21:27,600
so there you go still works

591
00:21:28,240 --> 00:21:31,640
see instructors

592
00:21:31,919 --> 00:21:33,360
can't live with them can't get rid of

593
00:21:33,360 --> 00:21:35,520
them

594
00:21:35,760 --> 00:21:38,400
so there's your alert

595
00:21:38,400 --> 00:21:40,640
and it it shows you it's from playbook

596
00:21:40,640 --> 00:21:42,400
you know exactly where it's from and i

597
00:21:42,400 --> 00:21:43,679
can use the

598
00:21:43,679 --> 00:21:45,520
um actually

599
00:21:45,520 --> 00:21:47,600
mr doug berg should be proud of this

600
00:21:47,600 --> 00:21:51,280
development option the quick drill down

601
00:21:51,280 --> 00:21:53,120
i click on that number and i get a quick

602
00:21:53,120 --> 00:21:55,520
drill down and now i can look at

603
00:21:55,520 --> 00:21:56,320
yes

604
00:21:56,320 --> 00:21:59,600
mr doug did that and you get all of the

605
00:21:59,600 --> 00:22:01,919
information available uh for that

606
00:22:01,919 --> 00:22:04,080
particular alert so we've sped that up

607
00:22:04,080 --> 00:22:05,840
now i didn't have to go in and hunt

608
00:22:05,840 --> 00:22:08,000
around and look at process creations and

609
00:22:08,000 --> 00:22:10,400
try to back out where this came from

610
00:22:10,400 --> 00:22:11,840
even though i wrote my conditional

611
00:22:11,840 --> 00:22:13,600
statement with an error and someone had

612
00:22:13,600 --> 00:22:15,760
to point it out for me in public because

613
00:22:15,760 --> 00:22:17,760
he's a good dude and a friend

614
00:22:17,760 --> 00:22:18,880
um

615
00:22:18,880 --> 00:22:21,120
but

616
00:22:21,200 --> 00:22:23,280
it is an effective way to go through

617
00:22:23,280 --> 00:22:25,600
with a template and start closing those

618
00:22:25,600 --> 00:22:27,840
gaps

619
00:22:28,240 --> 00:22:30,640
all right

620
00:22:36,240 --> 00:22:37,280
no

621
00:22:37,280 --> 00:22:39,120
come on now

622
00:22:39,120 --> 00:22:40,640
that's what i get for powerpointing at

623
00:22:40,640 --> 00:22:43,200
the end of the day

624
00:22:43,200 --> 00:22:46,400
all right so uh

625
00:22:46,400 --> 00:22:48,240
actually i'm impressed that demo

626
00:22:48,240 --> 00:22:50,159
survived pretty well uh now that i'm

627
00:22:50,159 --> 00:22:51,200
through with it i'm not going to touch

628
00:22:51,200 --> 00:22:52,799
it anymore because it'll go it'll go

629
00:22:52,799 --> 00:22:54,960
south all right so

630
00:22:54,960 --> 00:22:57,679
so what have we achieved uh and it it

631
00:22:57,679 --> 00:23:01,280
may feel like a lot it may not but we've

632
00:23:01,280 --> 00:23:03,440
we've kind of wrapped our heads around

633
00:23:03,440 --> 00:23:04,400
um

634
00:23:04,400 --> 00:23:06,960
the philosophy behind why we would want

635
00:23:06,960 --> 00:23:09,280
to do detection engineering the the

636
00:23:09,280 --> 00:23:11,440
ideas behind why

637
00:23:11,440 --> 00:23:13,520
uh we need to understand the situation

638
00:23:13,520 --> 00:23:15,280
in our given network and the types of

639
00:23:15,280 --> 00:23:17,280
threats we might be facing because we're

640
00:23:17,280 --> 00:23:20,159
trying to drive decisions faster

641
00:23:20,159 --> 00:23:21,679
because if something bad is happening

642
00:23:21,679 --> 00:23:23,760
you need to make quick decisions so that

643
00:23:23,760 --> 00:23:26,480
you can regain that initiative in your

644
00:23:26,480 --> 00:23:27,360
own

645
00:23:27,360 --> 00:23:28,960
home territory

646
00:23:28,960 --> 00:23:33,039
uh we took some time to explore a way

647
00:23:33,039 --> 00:23:34,720
to generate

648
00:23:34,720 --> 00:23:36,799
attacks in an environment to see those

649
00:23:36,799 --> 00:23:39,919
gaps and then we use security onion to

650
00:23:39,919 --> 00:23:42,480
to see that and then close those gaps

651
00:23:42,480 --> 00:23:45,440
with sigma rules as an example there are

652
00:23:45,440 --> 00:23:47,200
certainly some other areas in there

653
00:23:47,200 --> 00:23:48,840
where you can

654
00:23:48,840 --> 00:23:52,320
um add detections to security onion to

655
00:23:52,320 --> 00:23:53,840
give you those alerts

656
00:23:53,840 --> 00:23:57,039
uh and then and so now finally uh we can

657
00:23:57,039 --> 00:23:58,640
start to

658
00:23:58,640 --> 00:24:00,720
defend our networks with with a little

659
00:24:00,720 --> 00:24:02,960
bit more purpose the idea is to get

660
00:24:02,960 --> 00:24:05,840
further away from a reactionary posture

661
00:24:05,840 --> 00:24:07,600
and closer to a pro

662
00:24:07,600 --> 00:24:10,799
proactive posture

663
00:24:11,919 --> 00:24:14,080
all right so as i mentioned uh there is

664
00:24:14,080 --> 00:24:15,120
a

665
00:24:15,120 --> 00:24:17,200
lengthy and riveting white paper about

666
00:24:17,200 --> 00:24:19,120
this that was published in the sands

667
00:24:19,120 --> 00:24:21,679
reading room i encourage you if you have

668
00:24:21,679 --> 00:24:24,320
15 to 20 quiet moments you can read

669
00:24:24,320 --> 00:24:26,720
through it

670
00:24:27,520 --> 00:24:30,080
it's not too bad i did put a lot of this

671
00:24:30,080 --> 00:24:32,400
on github so there's a link right there

672
00:24:32,400 --> 00:24:34,960
so all of those

673
00:24:34,960 --> 00:24:38,080
the the miter attack views with how

674
00:24:38,080 --> 00:24:41,200
everything got scored how i built that

675
00:24:41,200 --> 00:24:43,520
all of the invocation tests for atomic

676
00:24:43,520 --> 00:24:46,400
red team that were run i tried to leave

677
00:24:46,400 --> 00:24:47,919
it in a state where someone could

678
00:24:47,919 --> 00:24:49,679
probably scrape it pretty quickly and

679
00:24:49,679 --> 00:24:52,240
stand that up on their own

680
00:24:52,240 --> 00:24:54,559
and and run through this and get a feel

681
00:24:54,559 --> 00:24:57,600
for how it works and make a decision on

682
00:24:57,600 --> 00:24:59,279
how fruitful that would be in their own

683
00:24:59,279 --> 00:25:01,440
environment to start engineering some

684
00:25:01,440 --> 00:25:02,799
detections

685
00:25:02,799 --> 00:25:04,720
beyond what comes baked into the

686
00:25:04,720 --> 00:25:07,279
platform

687
00:25:07,279 --> 00:25:08,559
so

688
00:25:08,559 --> 00:25:11,520
i will stop there and see if there's any

689
00:25:11,520 --> 00:25:14,159
questions or constructive comments that

690
00:25:14,159 --> 00:25:16,720
aren't picking at me for making a small

691
00:25:16,720 --> 00:25:18,559
error in my typing

692
00:25:18,559 --> 00:25:20,240
because i was inspired by west this

693
00:25:20,240 --> 00:25:23,520
morning to make a live demo

694
00:25:27,360 --> 00:25:29,760
mister

695
00:25:40,840 --> 00:25:43,279
yeah this

696
00:25:43,279 --> 00:25:44,960
so and actually i'll i have the

697
00:25:44,960 --> 00:25:47,039
comparison let me go back

698
00:25:47,039 --> 00:25:49,440
here so when i ran the full test for

699
00:25:49,440 --> 00:25:51,880
everything i had about what is that

700
00:25:51,880 --> 00:25:55,360
61.36 percent of coverage so the the

701
00:25:55,360 --> 00:25:57,440
default circada alerts

702
00:25:57,440 --> 00:26:00,000
uh created those alerts and then i had

703
00:26:00,000 --> 00:26:02,159
event data for pretty much everything

704
00:26:02,159 --> 00:26:06,080
else there was some event data available

705
00:26:06,080 --> 00:26:08,960
now i went through after that and i just

706
00:26:08,960 --> 00:26:11,679
turned all of those default sigma rules

707
00:26:11,679 --> 00:26:14,000
on for windows environment

708
00:26:14,000 --> 00:26:15,679
uh because that's what comes loaded by

709
00:26:15,679 --> 00:26:17,279
default i just turned them all on oh

710
00:26:17,279 --> 00:26:19,760
except for one there is one that you

711
00:26:19,760 --> 00:26:21,919
need to be really really capable careful

712
00:26:21,919 --> 00:26:25,679
with it has a lot of regex in it so i

713
00:26:25,679 --> 00:26:28,000
think it's the nishang is that is the

714
00:26:28,000 --> 00:26:30,240
infamous play 166

715
00:26:30,240 --> 00:26:32,480
yeah so that will crush your box unless

716
00:26:32,480 --> 00:26:35,679
it's it's a well-resourced machine uh so

717
00:26:35,679 --> 00:26:39,840
don't turn that one on but when i did

718
00:26:40,159 --> 00:26:42,240
i actually got to the big 100

719
00:26:42,240 --> 00:26:44,240
i had an alert

720
00:26:44,240 --> 00:26:45,679
for everything

721
00:26:45,679 --> 00:26:49,039
now they're pretty wide open so i mean

722
00:26:49,039 --> 00:26:50,480
it's you're getting

723
00:26:50,480 --> 00:26:51,880
alerts for

724
00:26:51,880 --> 00:26:54,559
cmd.exe execution you're getting alerts

725
00:26:54,559 --> 00:26:57,440
for who am i and a lot of these atomic

726
00:26:57,440 --> 00:26:59,760
red team tests run all of those

727
00:26:59,760 --> 00:27:02,480
but it was still pretty good for just

728
00:27:02,480 --> 00:27:04,240
clicking a bunch of check boxes and

729
00:27:04,240 --> 00:27:06,880
hitting go

730
00:27:06,880 --> 00:27:09,120
sir

731
00:27:09,840 --> 00:27:12,080
yeah

732
00:27:14,640 --> 00:27:16,720
no candidly i did not and that's that's

733
00:27:16,720 --> 00:27:18,720
what's at the end of the paper is you

734
00:27:18,720 --> 00:27:20,559
know okay great i've succeeded

735
00:27:20,559 --> 00:27:22,720
gloriously and you know i should be

736
00:27:22,720 --> 00:27:25,200
exalted but in reality this needs a lot

737
00:27:25,200 --> 00:27:26,559
more study

738
00:27:26,559 --> 00:27:28,399
because just turning everything on as we

739
00:27:28,399 --> 00:27:30,559
talked about that spectrum before

740
00:27:30,559 --> 00:27:31,520
you know

741
00:27:31,520 --> 00:27:32,559
that

742
00:27:32,559 --> 00:27:34,880
that volume of alert may not be

743
00:27:34,880 --> 00:27:37,520
appropriate for the size of the

744
00:27:37,520 --> 00:27:40,480
organization doing the investigation um

745
00:27:40,480 --> 00:27:43,200
because i i it would have been fairly

746
00:27:43,200 --> 00:27:44,320
noisy

747
00:27:44,320 --> 00:27:46,159
especially if you have a large windows

748
00:27:46,159 --> 00:27:48,320
environment and you have a

749
00:27:48,320 --> 00:27:50,320
administrative team that just has an

750
00:27:50,320 --> 00:27:52,559
infatuation with batch scripts

751
00:27:52,559 --> 00:27:54,640
and who am i

752
00:27:54,640 --> 00:27:57,600
but abs that's a very very good point

753
00:27:57,600 --> 00:28:00,240
you've got to circle back on

754
00:28:00,240 --> 00:28:02,480
how noisy is this can i live with it was

755
00:28:02,480 --> 00:28:05,279
it effective um

756
00:28:05,279 --> 00:28:08,080
sometimes they are

757
00:28:10,640 --> 00:28:11,360
and

758
00:28:11,360 --> 00:28:13,440
you know what i found striking out of

759
00:28:13,440 --> 00:28:15,760
all of this is it really

760
00:28:15,760 --> 00:28:18,559
wasn't that hard to implement it was so

761
00:28:18,559 --> 00:28:20,559
easy someone with executive in their job

762
00:28:20,559 --> 00:28:22,799
title could do it

763
00:28:22,799 --> 00:28:24,240
which is you know that's pretty

764
00:28:24,240 --> 00:28:26,240
impressive for something that is free

765
00:28:26,240 --> 00:28:28,320
and open so

766
00:28:28,320 --> 00:28:30,080
all right well if there's no more

767
00:28:30,080 --> 00:28:33,679
questions i think i stand between you

768
00:28:33,679 --> 00:28:36,240
and his great doug burks

769
00:28:36,240 --> 00:28:39,200
i'm sure my talk was boring enough that

770
00:28:39,200 --> 00:28:41,120
you will be nothing but riveted by the

771
00:28:41,120 --> 00:28:42,880
next discussion

772
00:28:42,880 --> 00:28:44,230
all right thank you everyone

773
00:28:44,230 --> 00:28:51,849
[Applause]

