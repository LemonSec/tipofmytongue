1
00:00:09,450 --> 00:00:14,219
if you've been a member of our community

2
00:00:11,250 --> 00:00:17,580
of for any length of time you've seen

3
00:00:14,219 --> 00:00:19,680
this next speaker here in Augusta that

4
00:00:17,580 --> 00:00:21,839
besides our here security icons been a

5
00:00:19,680 --> 00:00:24,630
longtime fan of security at Mindy's

6
00:00:21,840 --> 00:00:26,759
recent we've been added to the team at

7
00:00:24,630 --> 00:00:28,979
security lighting solutions which are

8
00:00:26,760 --> 00:00:35,430
all super excited about as well so I

9
00:00:28,980 --> 00:00:39,120
need power all right how's everyone

10
00:00:35,430 --> 00:00:41,010
doing doing all right don't panic right

11
00:00:39,120 --> 00:00:43,260
so I'm already connected up at the other

12
00:00:41,010 --> 00:00:45,120
thought the other one and might go great

13
00:00:43,260 --> 00:00:46,650
I know something always happens right

14
00:00:45,120 --> 00:00:49,049
but this is great you guys did great as

15
00:00:46,650 --> 00:00:51,269
Phil mentioned I was also gonna say

16
00:00:49,049 --> 00:00:53,430
there's no way that I can be the next

17
00:00:51,269 --> 00:00:56,549
speaker afterlife or larger-than-life

18
00:00:53,430 --> 00:00:58,530
Doug is wheeled in and so we'll see how

19
00:00:56,549 --> 00:01:00,720
this goes we have lunch coming up so

20
00:00:58,530 --> 00:01:03,780
it'll be a good it'll be good time next

21
00:01:00,720 --> 00:01:06,450
30 45 minutes as Phil mentioned my name

22
00:01:03,780 --> 00:01:09,810
is Josh Brauer been in IT 15 plus years

23
00:01:06,450 --> 00:01:12,090
and InfoSec 10 plus years recently Joey

24
00:01:09,810 --> 00:01:14,310
a security onion about six weeks ago

25
00:01:12,090 --> 00:01:16,350
it's been a good six weeks thank you

26
00:01:14,310 --> 00:01:17,729
Doug and the rest of the team and Thank

27
00:01:16,350 --> 00:01:20,130
You Devin rest of the team for this

28
00:01:17,729 --> 00:01:22,320
conference this is definitely conference

29
00:01:20,130 --> 00:01:26,490
this and besides Augusta I make sure I

30
00:01:22,320 --> 00:01:28,408
tend every single year so today real

31
00:01:26,490 --> 00:01:30,390
quick you can catch me on twitter at

32
00:01:28,409 --> 00:01:32,609
defensive depth today we're going to be

33
00:01:30,390 --> 00:01:35,820
talking about constructing your PlayBook

34
00:01:32,609 --> 00:01:37,469
with insecurity onion and Chris you gave

35
00:01:35,820 --> 00:01:39,059
me a great segue thank you so much

36
00:01:37,469 --> 00:01:41,399
wherever you kind of ended up talking

37
00:01:39,060 --> 00:01:44,759
about playbook so it's almost like we

38
00:01:41,399 --> 00:01:45,450
had that planned thank you very much in

39
00:01:44,759 --> 00:01:49,499
the beginning

40
00:01:45,450 --> 00:01:51,780
Doug created the onion right and I've

41
00:01:49,499 --> 00:01:54,060
run that security onion for many years

42
00:01:51,780 --> 00:01:56,310
in production in my previous when my

43
00:01:54,060 --> 00:01:57,840
previous organizations and last few

44
00:01:56,310 --> 00:02:00,569
years I've really spent a lot of time

45
00:01:57,840 --> 00:02:02,999
and effort on integrating more endpoint

46
00:02:00,569 --> 00:02:05,460
data into the security onion ecosystem

47
00:02:02,999 --> 00:02:08,038
last year I spoke about OS query and

48
00:02:05,460 --> 00:02:10,949
integrating Oh square data into security

49
00:02:08,038 --> 00:02:13,500
onion previous to that we talked about

50
00:02:10,949 --> 00:02:14,940
sis Mon and all the runs and so we

51
00:02:13,500 --> 00:02:17,310
really have just spent a lot of time to

52
00:02:14,940 --> 00:02:19,980
last three to five years on integrating

53
00:02:17,310 --> 00:02:22,409
host data into secure Union

54
00:02:19,980 --> 00:02:23,190
I've also integrated and used the hive

55
00:02:22,409 --> 00:02:25,500
and cortex

56
00:02:23,190 --> 00:02:27,600
which Wes talked about this morning

57
00:02:25,500 --> 00:02:30,150
we'll get into that much right now we'll

58
00:02:27,600 --> 00:02:32,100
see it in just a second here but what I

59
00:02:30,150 --> 00:02:37,550
would do is I would push my alerts over

60
00:02:32,100 --> 00:02:37,549
to them um yeah now don't start that

61
00:02:39,230 --> 00:02:47,489
okay so I would push my alerts over to

62
00:02:45,300 --> 00:02:50,040
the hive in cortex and to have some of

63
00:02:47,490 --> 00:02:52,020
that some of that some of that

64
00:02:50,040 --> 00:02:52,890
integration that even Wes was talking

65
00:02:52,020 --> 00:02:55,800
about this morning

66
00:02:52,890 --> 00:02:58,920
and as I started working on more alerts

67
00:02:55,800 --> 00:03:03,060
around host data I started working on

68
00:02:58,920 --> 00:03:04,799
detections like this this is um you know

69
00:03:03,060 --> 00:03:07,110
title news sensitive shared resource

70
00:03:04,800 --> 00:03:09,510
network shares with loose access

71
00:03:07,110 --> 00:03:11,730
controls are common places that leak

72
00:03:09,510 --> 00:03:14,040
sensitive information this detection

73
00:03:11,730 --> 00:03:16,799
proactively looks for newly shared

74
00:03:14,040 --> 00:03:18,570
resources that likely contain sensitive

75
00:03:16,800 --> 00:03:21,020
data follow-up will be needed to confirm

76
00:03:18,570 --> 00:03:23,730
that appropriate access control is and

77
00:03:21,020 --> 00:03:27,959
I'm in this particular detection it's

78
00:03:23,730 --> 00:03:31,340
based on OS query because I'm hitting

79
00:03:27,959 --> 00:03:34,620
that I'm gonna try not to step on this

80
00:03:31,340 --> 00:03:36,510
this is OS query based and so we have

81
00:03:34,620 --> 00:03:39,120
the O's query query we also have the

82
00:03:36,510 --> 00:03:40,560
elastic search query what happens is you

83
00:03:39,120 --> 00:03:43,110
have most query deployed to your

84
00:03:40,560 --> 00:03:46,590
endpoints you schedule a query it says

85
00:03:43,110 --> 00:03:48,420
looks for new shared resources like map

86
00:03:46,590 --> 00:03:50,700
drives you know shared drives things

87
00:03:48,420 --> 00:03:53,160
like that and then sends it back to

88
00:03:50,700 --> 00:03:56,429
elastic search with security onion and

89
00:03:53,160 --> 00:03:58,440
then we have an elastomer rule based off

90
00:03:56,430 --> 00:04:01,620
of this query and we're looking for

91
00:03:58,440 --> 00:04:05,910
keywords like HR finance backup dub dub

92
00:04:01,620 --> 00:04:08,550
dub or scan to alert on what happened is

93
00:04:05,910 --> 00:04:11,010
as I started writing more of these

94
00:04:08,550 --> 00:04:13,530
detections and trying to scale it up it

95
00:04:11,010 --> 00:04:16,529
became a very manual process right so I

96
00:04:13,530 --> 00:04:18,600
would first I would write the elastol ER

97
00:04:16,529 --> 00:04:21,268
config file I'd even using a template

98
00:04:18,600 --> 00:04:23,490
and then manually copy and paste that a

99
00:04:21,269 --> 00:04:26,340
last alert config then that would create

100
00:04:23,490 --> 00:04:28,590
a case template with the hive manually

101
00:04:26,340 --> 00:04:32,789
and then I'd have a wiki down here that

102
00:04:28,590 --> 00:04:34,479
I would I would excuse me put all of

103
00:04:32,789 --> 00:04:36,248
this information out on

104
00:04:34,479 --> 00:04:38,349
and every time I wanted to update that

105
00:04:36,249 --> 00:04:40,150
detection I had to go through all of

106
00:04:38,349 --> 00:04:42,128
those different places and manually

107
00:04:40,150 --> 00:04:43,388
update them and that's where I decided

108
00:04:42,129 --> 00:04:44,919
there's got to be a better way to do

109
00:04:43,389 --> 00:04:46,689
this can we figure out some way that

110
00:04:44,919 --> 00:04:49,240
maybe automate a lot of this and that's

111
00:04:46,689 --> 00:04:52,180
where the idea of the PlayBook was

112
00:04:49,240 --> 00:04:54,789
formed I really took inspiration from a

113
00:04:52,180 --> 00:04:56,680
book published back in 2015 called

114
00:04:54,789 --> 00:05:01,558
crafting the InfoSec playbook anybody

115
00:04:56,680 --> 00:05:04,719
read this yes a few okay so in this

116
00:05:01,559 --> 00:05:06,400
excuse me in this context I know one in

117
00:05:04,719 --> 00:05:09,998
our industry we use the word playbook

118
00:05:06,400 --> 00:05:11,679
and play and a few different for it to

119
00:05:09,999 --> 00:05:13,659
mean a few different things in this

120
00:05:11,680 --> 00:05:16,569
context we're specifically talking about

121
00:05:13,659 --> 00:05:19,389
a playbook made up of plays plays are

122
00:05:16,569 --> 00:05:23,259
simply custom reports okay and these

123
00:05:19,389 --> 00:05:25,930
custom reports our self-contained fully

124
00:05:23,259 --> 00:05:28,149
documented prescriptive procedures for

125
00:05:25,930 --> 00:05:31,930
finding and responding to undesired

126
00:05:28,149 --> 00:05:33,610
activity and this is to me really key by

127
00:05:31,930 --> 00:05:36,039
building the documentation and

128
00:05:33,610 --> 00:05:38,589
instructions into the play we have

129
00:05:36,039 --> 00:05:41,770
directly coupled the motivation for the

130
00:05:38,589 --> 00:05:43,990
play how to analyze it and the specific

131
00:05:41,770 --> 00:05:45,430
machine query for it all right those

132
00:05:43,990 --> 00:05:48,279
three aspects I think are really

133
00:05:45,430 --> 00:05:49,689
important so drawing from this I started

134
00:05:48,279 --> 00:05:52,089
working on the concept that I simply

135
00:05:49,689 --> 00:05:54,550
call play book sits in the middle here

136
00:05:52,089 --> 00:05:56,139
and it allows me to easily document my

137
00:05:54,550 --> 00:05:58,899
detection strategies number one

138
00:05:56,139 --> 00:06:02,620
motivation number two next steps so when

139
00:05:58,899 --> 00:06:05,169
we get results from running this report

140
00:06:02,620 --> 00:06:07,930
or these this custom query what am I

141
00:06:05,169 --> 00:06:10,659
supposed to do to validate that and

142
00:06:07,930 --> 00:06:13,599
finally the specific elasticsearch query

143
00:06:10,659 --> 00:06:15,099
that we need for security onion also it

144
00:06:13,599 --> 00:06:17,199
needs to be able to easily manage the

145
00:06:15,099 --> 00:06:18,729
last alert rules and easily manage the

146
00:06:17,199 --> 00:06:21,009
hive case templates which we use for

147
00:06:18,729 --> 00:06:22,959
next steps no more this manual

148
00:06:21,009 --> 00:06:26,409
processing right should do all that

149
00:06:22,959 --> 00:06:28,599
based on based on the detection right up

150
00:06:26,409 --> 00:06:30,490
here in number one and so I'm going to

151
00:06:28,599 --> 00:06:32,949
demo for you what I simply call playbook

152
00:06:30,490 --> 00:06:36,009
it is something that you can download

153
00:06:32,949 --> 00:06:38,620
and use in hybrid hunter security and

154
00:06:36,009 --> 00:06:40,870
hybrid hunter it definitely is still

155
00:06:38,620 --> 00:06:42,099
alpha and would be considered not

156
00:06:40,870 --> 00:06:45,430
something you necessarily want to put

157
00:06:42,099 --> 00:06:46,520
into production but it is live and ready

158
00:06:45,430 --> 00:06:49,039
to use

159
00:06:46,520 --> 00:06:53,780
for testing at this point so we're gonna

160
00:06:49,039 --> 00:06:56,870
see how the demo turns out it's making

161
00:06:53,780 --> 00:06:59,690
sense so far yes somewhat

162
00:06:56,870 --> 00:07:02,150
I'm good with awkward silences as well

163
00:06:59,690 --> 00:07:05,840
yes great thank you so much all right

164
00:07:02,150 --> 00:07:07,810
so first off I am logged into hybrid

165
00:07:05,840 --> 00:07:10,039
hunter a local install of hybrid hunter

166
00:07:07,810 --> 00:07:13,190
let me make that a little bit bigger

167
00:07:10,039 --> 00:07:14,419
here and it's just the IP address slash

168
00:07:13,190 --> 00:07:17,569
playbook

169
00:07:14,419 --> 00:07:20,990
I go to sign-in I sign in with the

170
00:07:17,569 --> 00:07:23,780
analyst user with changed me a very

171
00:07:20,990 --> 00:07:26,330
super-secret password make that a little

172
00:07:23,780 --> 00:07:30,530
cleaner here so we already have a couple

173
00:07:26,330 --> 00:07:32,810
plays imported it to playbook let's

174
00:07:30,530 --> 00:07:35,508
let's go ahead and drill down into this

175
00:07:32,810 --> 00:07:39,110
one right here you can see that the name

176
00:07:35,509 --> 00:07:41,409
of this one is maybe ksdc sync we have

177
00:07:39,110 --> 00:07:47,180
some metadata about it the author's

178
00:07:41,409 --> 00:07:51,020
including references excuse me we have

179
00:07:47,180 --> 00:07:53,750
the attack technique tagged and the

180
00:07:51,020 --> 00:07:56,690
objective result analysis and the actual

181
00:07:53,750 --> 00:08:00,650
elasticsearch a query that we need to

182
00:07:56,690 --> 00:08:04,759
use for security onion we also have this

183
00:08:00,650 --> 00:08:07,039
view Sigma down here so west's already

184
00:08:04,759 --> 00:08:08,539
gave us a great introduction to Sigma is

185
00:08:07,039 --> 00:08:12,020
anybody here I didn't actually see the

186
00:08:08,539 --> 00:08:15,409
hands and how many here are using or

187
00:08:12,020 --> 00:08:16,969
have used Sigma in the past a few maybe

188
00:08:15,409 --> 00:08:20,449
a quarter of the room okay so Sigma

189
00:08:16,969 --> 00:08:23,509
think of snort rules for network data

190
00:08:20,449 --> 00:08:25,849
think of Y are rules for file data Sigma

191
00:08:23,509 --> 00:08:28,219
is for logs okay loud it's a

192
00:08:25,849 --> 00:08:31,370
specification that we can write out our

193
00:08:28,219 --> 00:08:33,950
detections in alright and I did I chose

194
00:08:31,370 --> 00:08:35,929
to really develop playbook around Sigma

195
00:08:33,950 --> 00:08:38,240
number one it's a standard I didn't have

196
00:08:35,929 --> 00:08:40,539
to develop myself and secondly allows us

197
00:08:38,240 --> 00:08:44,060
to easily share the place and import

198
00:08:40,539 --> 00:08:45,980
import detections from other people so

199
00:08:44,059 --> 00:08:48,709
first off we're going to go ahead and

200
00:08:45,980 --> 00:08:52,040
create a new play come over here and

201
00:08:48,709 --> 00:08:54,079
click on new play we're going to import

202
00:08:52,040 --> 00:08:55,760
the Sigma put it into the external

203
00:08:54,079 --> 00:08:59,329
playbook and then we have a place right

204
00:08:55,760 --> 00:09:00,910
here to paste the Sigma now if I scroll

205
00:08:59,329 --> 00:09:05,809
over to

206
00:09:00,910 --> 00:09:07,969
right here I have this is Sigma that I

207
00:09:05,809 --> 00:09:10,009
wrote specifically for that detection

208
00:09:07,970 --> 00:09:11,959
strategy that I just mentioned so we

209
00:09:10,009 --> 00:09:14,839
have a title up here description which

210
00:09:11,959 --> 00:09:17,268
I've already told you status author tags

211
00:09:14,839 --> 00:09:19,279
log source this is coming from most

212
00:09:17,269 --> 00:09:22,009
query and then the actual query itself

213
00:09:19,279 --> 00:09:22,970
that we need the detection I won't get

214
00:09:22,009 --> 00:09:25,249
into that right now

215
00:09:22,970 --> 00:09:28,039
but down here there is a section called

216
00:09:25,249 --> 00:09:30,259
tasks this is not in the course Sigma

217
00:09:28,039 --> 00:09:33,100
spec this is something that I've added

218
00:09:30,259 --> 00:09:36,529
and this allows us to have specific

219
00:09:33,100 --> 00:09:38,929
tasks for this detection for how you

220
00:09:36,529 --> 00:09:40,970
validate or what are the next steps so

221
00:09:38,929 --> 00:09:43,608
for this particular detection strategy

222
00:09:40,970 --> 00:09:45,079
we say check share permissions our share

223
00:09:43,609 --> 00:09:47,299
permissions sent to an appropriate level

224
00:09:45,079 --> 00:09:49,488
they should be tied to the relevant ATS

225
00:09:47,299 --> 00:09:52,699
security group and then contact system

226
00:09:49,489 --> 00:09:57,229
service owner again this active we're

227
00:09:52,699 --> 00:09:59,269
trying to proactively find of

228
00:09:57,229 --> 00:10:01,369
information and we want to proactively

229
00:09:59,269 --> 00:10:06,589
find that so what we're going to do is

230
00:10:01,369 --> 00:10:10,669
copy and paste this Sigma right here hit

231
00:10:06,589 --> 00:10:13,339
create what this does is create a new

232
00:10:10,669 --> 00:10:15,439
play based on that Sigma we drill down

233
00:10:13,339 --> 00:10:18,529
into that new play that was just created

234
00:10:15,439 --> 00:10:20,569
you can see that we have the new type

235
00:10:18,529 --> 00:10:23,149
the title new sensitive shared resources

236
00:10:20,569 --> 00:10:25,819
it pulled out all the metadata from the

237
00:10:23,149 --> 00:10:29,029
Sigma it also gave us our objective

238
00:10:25,819 --> 00:10:33,738
result analysis the elastic search query

239
00:10:29,029 --> 00:10:36,769
so if you saw from the Sigma that right

240
00:10:33,739 --> 00:10:38,419
here we have the elastic search query is

241
00:10:36,769 --> 00:10:41,209
not in here right so what's actually

242
00:10:38,419 --> 00:10:43,879
happening is that when playbook is

243
00:10:41,209 --> 00:10:46,149
importing the Sigma it's using a tool

244
00:10:43,879 --> 00:10:50,389
put out by these Sigma authors that

245
00:10:46,149 --> 00:10:52,999
configures or that that converts the

246
00:10:50,389 --> 00:10:54,559
Yambol that you just saw into the

247
00:10:52,999 --> 00:10:56,600
machine query that you need for your

248
00:10:54,559 --> 00:10:58,159
back-end so it could be Splunk in our

249
00:10:56,600 --> 00:11:00,979
case it's elastic search so it's

250
00:10:58,159 --> 00:11:03,199
converting that detection into elastic

251
00:11:00,979 --> 00:11:05,209
search and it's also there's some config

252
00:11:03,199 --> 00:11:07,728
files that we need for OS query or

253
00:11:05,209 --> 00:11:10,039
excuse me for OS query and some other

254
00:11:07,729 --> 00:11:11,419
event logs that we ship and so Wes and

255
00:11:10,039 --> 00:11:13,670
I've written a couple configuration

256
00:11:11,419 --> 00:11:16,069
files for security onion

257
00:11:13,670 --> 00:11:17,420
compatibility with Sigma so all that's

258
00:11:16,070 --> 00:11:19,280
happening in the back end you don't have

259
00:11:17,420 --> 00:11:21,319
to worry about that so the end of the

260
00:11:19,280 --> 00:11:24,770
day you're gonna get a query that is

261
00:11:21,320 --> 00:11:28,070
specific to this play and that will give

262
00:11:24,770 --> 00:11:30,319
us results once we once we see this

263
00:11:28,070 --> 00:11:30,890
alert in just a second we want to edit

264
00:11:30,320 --> 00:11:33,290
this

265
00:11:30,890 --> 00:11:38,600
we just hit edit we edit the actual

266
00:11:33,290 --> 00:11:41,030
Sigma itself so let's say it's a little

267
00:11:38,600 --> 00:11:44,840
bigger you see that we're looking for

268
00:11:41,030 --> 00:11:47,870
some some specific share names so HR

269
00:11:44,840 --> 00:11:49,840
finance backup let's say the HR is to

270
00:11:47,870 --> 00:11:53,330
false positive prone so we delete that

271
00:11:49,840 --> 00:11:59,120
we make a note that we have deleted the

272
00:11:53,330 --> 00:12:02,990
HR string too many false positives write

273
00:11:59,120 --> 00:12:05,600
it submit this on the fly regenerates

274
00:12:02,990 --> 00:12:09,080
that elastic search query and it also

275
00:12:05,600 --> 00:12:11,510
gives us a very nice diff as well as

276
00:12:09,080 --> 00:12:14,120
that comment and so this is really key

277
00:12:11,510 --> 00:12:16,250
because once you put a play into

278
00:12:14,120 --> 00:12:18,110
production and as you tweak it over time

279
00:12:16,250 --> 00:12:20,690
you're gonna want to be able to see the

280
00:12:18,110 --> 00:12:22,400
history that why did I change that so

281
00:12:20,690 --> 00:12:24,470
why did I tweak that six months ago or

282
00:12:22,400 --> 00:12:26,449
as a new analyst you get hits on the

283
00:12:24,470 --> 00:12:28,790
play you want to go back and find out

284
00:12:26,450 --> 00:12:30,320
the history of why you know what is

285
00:12:28,790 --> 00:12:32,780
history of this play what if other

286
00:12:30,320 --> 00:12:36,370
people talked about why did we remove HR

287
00:12:32,780 --> 00:12:39,680
from it does that making sense okay

288
00:12:36,370 --> 00:12:42,710
so excuse me once you're ready and

289
00:12:39,680 --> 00:12:46,040
you're feeling comfortable with this we

290
00:12:42,710 --> 00:12:50,740
can go to edit we can change the status

291
00:12:46,040 --> 00:12:53,030
from draft to active it submits and

292
00:12:50,740 --> 00:12:55,010
there's a couple things happening in the

293
00:12:53,030 --> 00:12:57,620
background number one playbook is

294
00:12:55,010 --> 00:13:00,230
creating in the last alert rule file

295
00:12:57,620 --> 00:13:02,420
based on the play so it's using

296
00:13:00,230 --> 00:13:04,760
templates if it's an OS query rule it'll

297
00:13:02,420 --> 00:13:06,469
use the query template otherwise it'll

298
00:13:04,760 --> 00:13:08,569
use some other generic templates we have

299
00:13:06,470 --> 00:13:11,330
so right now we have this play in

300
00:13:08,570 --> 00:13:13,910
production using a last alert all behind

301
00:13:11,330 --> 00:13:17,060
the scenes and then it's also creating a

302
00:13:13,910 --> 00:13:21,709
hive take our case template come over

303
00:13:17,060 --> 00:13:24,410
here to the hive under admin case

304
00:13:21,710 --> 00:13:27,529
templates you can see that we have some

305
00:13:24,410 --> 00:13:29,300
case templates that we've automatically

306
00:13:27,529 --> 00:13:32,089
did this the template name is that play

307
00:13:29,300 --> 00:13:34,219
ID from over here in the play you can

308
00:13:32,089 --> 00:13:36,050
see we have the description already the

309
00:13:34,220 --> 00:13:39,230
play objective the link to the play book

310
00:13:36,050 --> 00:13:42,680
as well as these specific tasks that was

311
00:13:39,230 --> 00:13:44,569
in that Sigma okay so you can tie the

312
00:13:42,680 --> 00:13:46,758
Sigma and the detection strategy

313
00:13:44,569 --> 00:13:48,229
directly to the case template and we'll

314
00:13:46,759 --> 00:13:51,279
see what that looks like from an alert

315
00:13:48,230 --> 00:13:53,959
perspective in just a minute

316
00:13:51,279 --> 00:13:56,480
alright so we've created that the last

317
00:13:53,959 --> 00:13:58,729
alert config we've created the hive case

318
00:13:56,480 --> 00:14:02,329
template this is all active let's go

319
00:13:58,730 --> 00:14:04,009
ahead and generate a new alert based off

320
00:14:02,329 --> 00:14:07,008
of this and if you recall we're looking

321
00:14:04,009 --> 00:14:09,470
for new shared drives so and this is

322
00:14:07,009 --> 00:14:15,259
based on OS query so we'll flip over to

323
00:14:09,470 --> 00:14:17,839
Clyde fleets Clyde flee now ships with

324
00:14:15,259 --> 00:14:19,879
hybrid hunter we've integrated it very

325
00:14:17,839 --> 00:14:22,339
closely so you run one command

326
00:14:19,879 --> 00:14:25,220
it sets up a fleet and O's query

327
00:14:22,339 --> 00:14:27,290
generates packages Osprey packages so

328
00:14:25,220 --> 00:14:30,410
you can download them very easily you

329
00:14:27,290 --> 00:14:32,959
install them and deploy them in your to

330
00:14:30,410 --> 00:14:34,730
your different endpoints you can see we

331
00:14:32,959 --> 00:14:37,209
currently have a Windows 10 system and

332
00:14:34,730 --> 00:14:39,500
we have the hybrid hunter system online

333
00:14:37,209 --> 00:14:41,149
I've already scheduled I'm not going to

334
00:14:39,500 --> 00:14:42,980
go into depth about how fleet works

335
00:14:41,149 --> 00:14:46,759
right now but you can see we've already

336
00:14:42,980 --> 00:14:49,250
scheduled this query so query 601 is

337
00:14:46,759 --> 00:14:50,930
that query that we're using so we've

338
00:14:49,250 --> 00:14:54,800
already scheduled that so every 30

339
00:14:50,930 --> 00:14:58,099
seconds we'll go back to packs every 30

340
00:14:54,800 --> 00:15:00,109
seconds oh is query is checking to see

341
00:14:58,100 --> 00:15:02,029
if there's any new shared resources on

342
00:15:00,110 --> 00:15:03,949
the Windows 10 system if it finds

343
00:15:02,029 --> 00:15:06,259
anything new it will send that log back

344
00:15:03,949 --> 00:15:08,599
to security onion and then from there

345
00:15:06,259 --> 00:15:11,089
put it into elasticsearch and then the

346
00:15:08,600 --> 00:15:13,899
last alert will find it and alert on it

347
00:15:11,089 --> 00:15:18,939
okay that's kind of the pipeline so

348
00:15:13,899 --> 00:15:18,939
let's flip over to the Windows 10 system

349
00:15:20,379 --> 00:15:29,120
and that looks great all right so I've

350
00:15:26,929 --> 00:15:31,069
got I'm on the root of the C Drive I got

351
00:15:29,120 --> 00:15:33,589
backup folder I've got my financials and

352
00:15:31,069 --> 00:15:35,800
QuickBooks backups in here I just need

353
00:15:33,589 --> 00:15:37,970
to get this backed up by our enterprise

354
00:15:35,800 --> 00:15:40,349
backup systems so I'm just gonna do a

355
00:15:37,970 --> 00:15:42,590
real quick share

356
00:15:40,350 --> 00:15:45,300
because we've never had people do this

357
00:15:42,590 --> 00:15:47,100
right I'm just gonna share with

358
00:15:45,300 --> 00:15:48,599
everybody I just need to get it working

359
00:15:47,100 --> 00:15:51,060
don't worry I'll come back I'll fix this

360
00:15:48,600 --> 00:15:53,430
share permissions later once the backup

361
00:15:51,060 --> 00:15:56,099
is working right we've done this before

362
00:15:53,430 --> 00:15:56,699
all right just a minute I'll come back

363
00:15:56,100 --> 00:16:00,210
to that later

364
00:15:56,700 --> 00:16:03,000
okay so once we're going to let that run

365
00:16:00,210 --> 00:16:05,700
and query we'll see the difference I'll

366
00:16:03,000 --> 00:16:07,740
send that lag that bug over while we're

367
00:16:05,700 --> 00:16:11,970
waiting for that log let me show you one

368
00:16:07,740 --> 00:16:14,130
other piece to to playbook so you have

369
00:16:11,970 --> 00:16:18,060
seen that we have a lot of these plays

370
00:16:14,130 --> 00:16:24,570
tagged with mitre attack framework tags

371
00:16:18,060 --> 00:16:27,449
I just break something it's possible so

372
00:16:24,570 --> 00:16:29,550
we see that there are some of these like

373
00:16:27,450 --> 00:16:34,020
we have this attack technique right here

374
00:16:29,550 --> 00:16:37,410
tagged and so we also ship a app called

375
00:16:34,020 --> 00:16:39,600
my attack navigator this is a web app

376
00:16:37,410 --> 00:16:42,390
put out by mitre that allows you to

377
00:16:39,600 --> 00:16:45,690
visualize the different techniques that

378
00:16:42,390 --> 00:16:48,000
are part of the framework we have this

379
00:16:45,690 --> 00:16:50,900
right here you just go to IP address

380
00:16:48,000 --> 00:16:55,290
slash so navigator ships with playbook

381
00:16:50,900 --> 00:16:58,110
and what happens is every time you

382
00:16:55,290 --> 00:17:01,110
change the status of a play we

383
00:16:58,110 --> 00:17:03,390
regenerate the JSON file so that's all

384
00:17:01,110 --> 00:17:07,439
the blue in here if i refresh this we

385
00:17:03,390 --> 00:17:09,030
should see we should see our detection

386
00:17:07,439 --> 00:17:12,510
coverage so the network share discovery

387
00:17:09,030 --> 00:17:14,369
that is based on the tagged plays over

388
00:17:12,510 --> 00:17:16,800
here in PlayBook ok

389
00:17:14,369 --> 00:17:20,839
and so if we right click we can say view

390
00:17:16,800 --> 00:17:20,839
technique and that brings us to

391
00:17:31,770 --> 00:17:38,980
we'll even slicker when it works right

392
00:17:34,270 --> 00:17:41,740
and so then you also right-click and

393
00:17:38,980 --> 00:17:44,980
save you related plays that will bring

394
00:17:41,740 --> 00:17:46,660
up the playbook with all of the tagged

395
00:17:44,980 --> 00:17:49,600
plays that you currently have in

396
00:17:46,660 --> 00:17:52,600
production okay and that's that is based

397
00:17:49,600 --> 00:17:54,490
off of all the plays that you have tat

398
00:17:52,600 --> 00:17:57,280
or that you have a change of status from

399
00:17:54,490 --> 00:18:01,390
to active does that making sense so far

400
00:17:57,280 --> 00:18:03,490
okay allows you to visualize your allows

401
00:18:01,390 --> 00:18:05,520
you to visualize the coverage that you

402
00:18:03,490 --> 00:18:08,230
have from a technique perspective

403
00:18:05,520 --> 00:18:10,629
specifically in the playbook all right

404
00:18:08,230 --> 00:18:12,760
so I have talked enough we should have

405
00:18:10,630 --> 00:18:17,380
an alert we'll see we do have an alert

406
00:18:12,760 --> 00:18:20,350
to alerts so again what's happened is OS

407
00:18:17,380 --> 00:18:22,630
query found that new super drive sent

408
00:18:20,350 --> 00:18:28,330
that log back over to secure the onion

409
00:18:22,630 --> 00:18:30,430
and elasticsearch a last alert has that

410
00:18:28,330 --> 00:18:32,949
configured rule from playbook and it

411
00:18:30,430 --> 00:18:35,170
generated an alert based on that and it

412
00:18:32,950 --> 00:18:38,140
sent that alert to the hive and that's

413
00:18:35,170 --> 00:18:41,020
what we're seeing right here so we have

414
00:18:38,140 --> 00:18:42,490
one right here from last learn and

415
00:18:41,020 --> 00:18:45,970
security on a new sense of shared

416
00:18:42,490 --> 00:18:48,700
resource so if we preview that the

417
00:18:45,970 --> 00:18:51,700
hostname is the the Windows 10 hostname

418
00:18:48,700 --> 00:18:54,820
the pivot link this allows us to pivot

419
00:18:51,700 --> 00:18:56,910
directly to fleets and if the system is

420
00:18:54,820 --> 00:19:00,250
online we can say select star from

421
00:18:56,910 --> 00:19:04,080
shared resources and it already pre

422
00:19:00,250 --> 00:19:08,140
selects the system there so hit run and

423
00:19:04,080 --> 00:19:11,590
that will allow us to see that we do

424
00:19:08,140 --> 00:19:13,810
actually have a new shared resource on

425
00:19:11,590 --> 00:19:17,050
there called backup so let's go ahead

426
00:19:13,810 --> 00:19:19,810
and import that and we see there's some

427
00:19:17,050 --> 00:19:21,790
other indicators here import that and

428
00:19:19,810 --> 00:19:24,100
you see that it's already going to show

429
00:19:21,790 --> 00:19:35,080
us right here we're importing it with a

430
00:19:24,100 --> 00:19:37,510
case templates so once we import that we

431
00:19:35,080 --> 00:19:39,460
have our play objective we have the play

432
00:19:37,510 --> 00:19:42,190
book link so we can go directly to that

433
00:19:39,460 --> 00:19:43,760
see more information about it we also

434
00:19:42,190 --> 00:19:45,800
have our tasks

435
00:19:43,760 --> 00:19:49,129
we need to complete so I'm going to

436
00:19:45,800 --> 00:19:51,290
first check the share permissions on the

437
00:19:49,130 --> 00:19:53,260
Windows 10 system or this system that's

438
00:19:51,290 --> 00:19:56,060
involved and so that gives us that task

439
00:19:53,260 --> 00:19:58,490
so I'm making sense so far so from the

440
00:19:56,060 --> 00:20:01,790
very beginning we have created a play

441
00:19:58,490 --> 00:20:05,090
detection play edited it we have made it

442
00:20:01,790 --> 00:20:08,170
change to status active that created the

443
00:20:05,090 --> 00:20:11,149
last alerts and a rule file excuse me as

444
00:20:08,170 --> 00:20:13,640
well as the hive case templates we

445
00:20:11,150 --> 00:20:16,670
generated some log data that trip that

446
00:20:13,640 --> 00:20:19,250
alert and then we imported that alert in

447
00:20:16,670 --> 00:20:21,490
the hive as a case now suffice to say if

448
00:20:19,250 --> 00:20:24,440
I went back to play book and edited that

449
00:20:21,490 --> 00:20:26,960
that detection strategy that play it

450
00:20:24,440 --> 00:20:28,580
would go out and update all of the other

451
00:20:26,960 --> 00:20:30,920
pieces it would update the hive case

452
00:20:28,580 --> 00:20:33,500
template as well as the alas lair config

453
00:20:30,920 --> 00:20:35,420
if I went back and say disable that play

454
00:20:33,500 --> 00:20:37,520
or move that to an inactive state and

455
00:20:35,420 --> 00:20:39,710
we'll go ahead and remove that alas lurk

456
00:20:37,520 --> 00:20:41,960
config will keep the hive case template

457
00:20:39,710 --> 00:20:44,870
there but it will go ahead and remove

458
00:20:41,960 --> 00:20:46,580
that alert out of last alerts ok now you

459
00:20:44,870 --> 00:20:49,370
may be saying this is great Josh but I'm

460
00:20:46,580 --> 00:20:51,620
not really comfortable writing Sigma at

461
00:20:49,370 --> 00:20:53,600
this point that look like a lot of stuff

462
00:20:51,620 --> 00:20:55,040
I'm not really comfortable the great

463
00:20:53,600 --> 00:20:58,340
thing is is that there is a lot of

464
00:20:55,040 --> 00:21:01,010
people that put out Sigma signatures on

465
00:20:58,340 --> 00:21:03,290
a regular basis Wes already mentioned it

466
00:21:01,010 --> 00:21:07,070
Florian Roth one of the authors of Sigma

467
00:21:03,290 --> 00:21:09,500
on a regular basis tweets out tweets out

468
00:21:07,070 --> 00:21:09,800
signatures one of them from earlier this

469
00:21:09,500 --> 00:21:12,530
week

470
00:21:09,800 --> 00:21:15,409
Sigma rule to detect form bug process

471
00:21:12,530 --> 00:21:17,690
injection with specific sub processes so

472
00:21:15,410 --> 00:21:21,160
the rule is right here we're going to

473
00:21:17,690 --> 00:21:27,100
open that we're just going to hit raw

474
00:21:21,160 --> 00:21:33,980
copy that come over to playbook new play

475
00:21:27,100 --> 00:21:38,540
paste it and create and that brings it

476
00:21:33,980 --> 00:21:41,750
in it's still filtering clear that out

477
00:21:38,540 --> 00:21:44,389
that brought it in as a new play ok

478
00:21:41,750 --> 00:21:46,850
and it also generated the elastic alas

479
00:21:44,390 --> 00:21:49,250
excuse me the elastic search query that

480
00:21:46,850 --> 00:21:50,719
we need for security onion all right so

481
00:21:49,250 --> 00:21:53,120
you don't have to necessarily write your

482
00:21:50,720 --> 00:21:55,220
own Sigma you can go out and find stuff

483
00:21:53,120 --> 00:21:57,620
that's already written out there now a

484
00:21:55,220 --> 00:21:59,960
couple caveats right now Sigma

485
00:21:57,620 --> 00:22:02,899
we have compatibility for logs that are

486
00:21:59,960 --> 00:22:05,650
shipped to OA square widows query win

487
00:22:02,900 --> 00:22:07,880
beat log are the windows event logs

488
00:22:05,650 --> 00:22:11,120
shipped with wind beat log and then

489
00:22:07,880 --> 00:22:12,680
network data shipped found with bro

490
00:22:11,120 --> 00:22:14,419
I believe that's all we have currently

491
00:22:12,680 --> 00:22:15,950
at this point so if you want to generate

492
00:22:14,420 --> 00:22:18,170
any of that signal with those log

493
00:22:15,950 --> 00:22:22,040
sources that should work in security

494
00:22:18,170 --> 00:22:24,080
onion all right so I think that's it for

495
00:22:22,040 --> 00:22:28,850
my demo and it did work so any questions

496
00:22:24,080 --> 00:22:41,000
comments or snide remarks I don't even

497
00:22:28,850 --> 00:22:42,439
know how much time I have left yes thank

498
00:22:41,000 --> 00:22:46,280
you so much Mike for pointing that out

499
00:22:42,440 --> 00:22:48,770
yes exactly so if you don't if this is

500
00:22:46,280 --> 00:22:51,860
really the crux of it is I was sitting

501
00:22:48,770 --> 00:22:54,170
there manually trying to figure out the

502
00:22:51,860 --> 00:22:56,959
different elastol Ertz op rule options

503
00:22:54,170 --> 00:22:59,540
the file options okay if I want to if I

504
00:22:56,960 --> 00:23:02,270
want to alert this way here's how I have

505
00:22:59,540 --> 00:23:03,980
to do it oh I ran into that issue okay

506
00:23:02,270 --> 00:23:05,870
let me copy and paste this over here

507
00:23:03,980 --> 00:23:07,760
that was one of the key issues of why I

508
00:23:05,870 --> 00:23:09,979
did this with playbook is that that's

509
00:23:07,760 --> 00:23:12,790
all abstracted for you you write the

510
00:23:09,980 --> 00:23:16,160
detection in Sigma you paste it into

511
00:23:12,790 --> 00:23:20,930
PlayBook and it writes those last alert

512
00:23:16,160 --> 00:23:22,100
configs for you thanks Mike I also have

513
00:23:20,930 --> 00:23:24,860
there's a bunch of other Sigma

514
00:23:22,100 --> 00:23:26,449
signatures out there that you can that

515
00:23:24,860 --> 00:23:29,240
you can use I have written a bulk import

516
00:23:26,450 --> 00:23:31,730
script command line script I haven't

517
00:23:29,240 --> 00:23:34,430
quite got it ready yet but we can bulk

518
00:23:31,730 --> 00:23:36,350
import a bunch of Sigma signatures as

519
00:23:34,430 --> 00:23:40,240
well into playbook that should be

520
00:23:36,350 --> 00:23:45,620
something forthcoming at some point

521
00:23:40,240 --> 00:23:50,050
thing else something that you guys think

522
00:23:45,620 --> 00:23:53,510
you might use might be useful yes okay

523
00:23:50,050 --> 00:23:56,090
certainly any feedback is useful both of

524
00:23:53,510 --> 00:23:58,370
these run in docker containers attack

525
00:23:56,090 --> 00:24:00,590
navigator and then PlayBook is simply

526
00:23:58,370 --> 00:24:02,959
read mine open source project management

527
00:24:00,590 --> 00:24:05,209
solution that we've tweaked a bit that

528
00:24:02,960 --> 00:24:07,490
runs in docker as well and then on the

529
00:24:05,210 --> 00:24:09,980
back end it's sending a web hook every

530
00:24:07,490 --> 00:24:11,420
time you you change this or anytime you

531
00:24:09,980 --> 00:24:14,180
change the

532
00:24:11,420 --> 00:24:16,610
status of one of those plays sends a web

533
00:24:14,180 --> 00:24:19,040
hook to soft puss which is that Python

534
00:24:16,610 --> 00:24:21,260
app that Wes was talking about and then

535
00:24:19,040 --> 00:24:23,720
based on the web hook we do all the

536
00:24:21,260 --> 00:24:25,280
automation from there so that's all open

537
00:24:23,720 --> 00:24:30,290
source and available for you to look at

538
00:24:25,280 --> 00:24:33,230
tweak and and send pr's to us all right

539
00:24:30,290 --> 00:24:36,350
anything else feel like I just want to

540
00:24:33,230 --> 00:24:37,490
get some lunch right okay thank you all

541
00:24:36,350 --> 00:24:45,329
so much

542
00:24:37,490 --> 00:24:45,329
[Applause]

