1
00:00:00,570 --> 00:00:07,040
[Music]

2
00:00:07,040 --> 00:00:10,040
day

3
00:00:23,600 --> 00:00:25,279
uh

4
00:00:25,279 --> 00:00:28,000
hello my name is ryan ashley i'm a

5
00:00:28,000 --> 00:00:31,039
senior software engineer with kinkytel

6
00:00:31,039 --> 00:00:33,600
labs and i'm here to talk to you today

7
00:00:33,600 --> 00:00:36,239
about some interesting things that you

8
00:00:36,239 --> 00:00:38,239
can do

9
00:00:38,239 --> 00:00:41,760
to more effectively defend your network

10
00:00:41,760 --> 00:00:42,840
with

11
00:00:42,840 --> 00:00:45,120
uh some of the tools and techniques that

12
00:00:45,120 --> 00:00:48,559
are made available to you by

13
00:00:48,559 --> 00:00:50,559
by uh

14
00:00:50,559 --> 00:00:52,879
software-defined networking

15
00:00:52,879 --> 00:00:54,719
and

16
00:00:54,719 --> 00:00:56,559
yeah let's go ahead and get started

17
00:00:56,559 --> 00:00:58,399
uh i'm going to start

18
00:00:58,399 --> 00:01:00,000
by

19
00:01:00,000 --> 00:01:02,960
giving a brief overview of what sdn is

20
00:01:02,960 --> 00:01:05,840
and why i think it is interesting and

21
00:01:05,840 --> 00:01:08,400
useful from a defensive standpoint uh

22
00:01:08,400 --> 00:01:10,479
the sort of the capabilities that it

23
00:01:10,479 --> 00:01:13,040
brings for you uh i'm going to talk to

24
00:01:13,040 --> 00:01:14,799
you about some of the the different

25
00:01:14,799 --> 00:01:18,000
tools that you can use to monitor that

26
00:01:18,000 --> 00:01:19,200
um

27
00:01:19,200 --> 00:01:20,880
and keep tabs what's going on in your

28
00:01:20,880 --> 00:01:22,960
network and then i'm going to show you

29
00:01:22,960 --> 00:01:26,640
some pretty unique and novel ways

30
00:01:26,640 --> 00:01:28,880
that my team has been researching

31
00:01:28,880 --> 00:01:30,159
to

32
00:01:30,159 --> 00:01:32,479
use those capabilities to more

33
00:01:32,479 --> 00:01:36,400
effectively defend your network

34
00:01:37,200 --> 00:01:38,560
so

35
00:01:38,560 --> 00:01:41,200
with that being said basically if you're

36
00:01:41,200 --> 00:01:43,520
not familiar with it software-defined

37
00:01:43,520 --> 00:01:47,040
networking is essentially just the idea

38
00:01:47,040 --> 00:01:49,520
that instead of treating

39
00:01:49,520 --> 00:01:50,560
the

40
00:01:50,560 --> 00:01:51,840
um

41
00:01:51,840 --> 00:01:52,960
different

42
00:01:52,960 --> 00:01:55,280
infrastructure devices on your network

43
00:01:55,280 --> 00:01:57,520
as these special purpose unique

44
00:01:57,520 --> 00:01:59,759
snowflakes

45
00:01:59,759 --> 00:02:01,119
they're just

46
00:02:01,119 --> 00:02:03,600
general purpose computers

47
00:02:03,600 --> 00:02:06,240
that you've given a special job so in

48
00:02:06,240 --> 00:02:07,520
the same way

49
00:02:07,520 --> 00:02:10,318
that you would assign a particular

50
00:02:10,318 --> 00:02:12,959
server the role of being say a mail

51
00:02:12,959 --> 00:02:16,959
server or an ad controller

52
00:02:16,959 --> 00:02:20,319
what you can do is

53
00:02:20,959 --> 00:02:23,760
basically a switch is just a computer

54
00:02:23,760 --> 00:02:26,239
that has the job of switching traffic

55
00:02:26,239 --> 00:02:29,120
throughout the network

56
00:02:30,319 --> 00:02:32,959
um architecturally this actually doesn't

57
00:02:32,959 --> 00:02:33,920
change

58
00:02:33,920 --> 00:02:36,560
your network terribly significantly the

59
00:02:36,560 --> 00:02:38,640
only real difference that you can see in

60
00:02:38,640 --> 00:02:41,440
this diagram is this green controller

61
00:02:41,440 --> 00:02:42,720
box here

62
00:02:42,720 --> 00:02:45,440
uh and what that's effectively doing is

63
00:02:45,440 --> 00:02:47,120
you're you're letting the switch

64
00:02:47,120 --> 00:02:50,480
offshore all of all of the like heavy

65
00:02:50,480 --> 00:02:53,360
thinking into this controller machine so

66
00:02:53,360 --> 00:02:55,280
that it can just do its job of switching

67
00:02:55,280 --> 00:02:57,360
traffic around and the controller gets

68
00:02:57,360 --> 00:02:59,360
to handle things like dealing with the

69
00:02:59,360 --> 00:03:01,840
topology of the network and so forth

70
00:03:01,840 --> 00:03:03,920
and then typically this also is

71
00:03:03,920 --> 00:03:05,760
conflated with the separation of the

72
00:03:05,760 --> 00:03:08,640
control and data

73
00:03:12,319 --> 00:03:15,280
so some of the reasons that i think that

74
00:03:15,280 --> 00:03:18,560
this is a really good match for security

75
00:03:18,560 --> 00:03:20,239
uh and also my team does some work with

76
00:03:20,239 --> 00:03:21,840
this with machine learning which we'll

77
00:03:21,840 --> 00:03:24,080
talk about here shortly but

78
00:03:24,080 --> 00:03:26,720
you know one i like many of you i'm an

79
00:03:26,720 --> 00:03:29,360
engineer by trade and so you know if i

80
00:03:29,360 --> 00:03:31,200
want to talk to a piece of software and

81
00:03:31,200 --> 00:03:33,599
make it do something for me my first

82
00:03:33,599 --> 00:03:35,360
thought is like

83
00:03:35,360 --> 00:03:37,360
what is the api i can go

84
00:03:37,360 --> 00:03:40,000
tell it to do that uh through the api

85
00:03:40,000 --> 00:03:41,920
just make an api call

86
00:03:41,920 --> 00:03:43,519
and

87
00:03:43,519 --> 00:03:45,680
you know it's a very native workflow so

88
00:03:45,680 --> 00:03:47,360
it lets you do that uh you can start

89
00:03:47,360 --> 00:03:48,959
doing things like

90
00:03:48,959 --> 00:03:50,239
configuring your network

91
00:03:50,239 --> 00:03:52,080
programmatically in response to events

92
00:03:52,080 --> 00:03:54,480
that are happening on the network

93
00:03:54,480 --> 00:03:56,720
so you get central management

94
00:03:56,720 --> 00:03:58,560
this is one of my favorites you can

95
00:03:58,560 --> 00:04:01,200
version control your configuration uh i

96
00:04:01,200 --> 00:04:04,319
recently had an issue where i broke my

97
00:04:04,319 --> 00:04:07,280
my dns box on my internal uh machine

98
00:04:07,280 --> 00:04:08,560
right and i had to go through and

99
00:04:08,560 --> 00:04:10,959
re-image a bunch of stuff

100
00:04:10,959 --> 00:04:13,760
but i just i re-imaged it i pulled my

101
00:04:13,760 --> 00:04:16,478
configuration back down from github put

102
00:04:16,478 --> 00:04:18,639
the files in the appropriate places and

103
00:04:18,639 --> 00:04:21,358
i was back up and running again in

104
00:04:21,358 --> 00:04:23,680
i'd say 20 to 30 minutes it wasn't a lot

105
00:04:23,680 --> 00:04:26,479
of down time so that's really cool and

106
00:04:26,479 --> 00:04:29,440
then also because the controller has

107
00:04:29,440 --> 00:04:31,360
this this holistic high-level view of

108
00:04:31,360 --> 00:04:33,680
the network you can start collecting

109
00:04:33,680 --> 00:04:34,880
data

110
00:04:34,880 --> 00:04:36,639
really easily right and you can do it

111
00:04:36,639 --> 00:04:38,560
anywhere from any perspective you don't

112
00:04:38,560 --> 00:04:40,880
need taps uh you don't need you know any

113
00:04:40,880 --> 00:04:42,479
kind of weird hardware

114
00:04:42,479 --> 00:04:44,479
um you don't have to start remoting into

115
00:04:44,479 --> 00:04:47,440
different machines to see things

116
00:04:47,440 --> 00:04:48,800
you can just grab it from that

117
00:04:48,800 --> 00:04:50,000
controller

118
00:04:50,000 --> 00:04:52,160
very handy

119
00:04:52,160 --> 00:04:54,720
so the the controller that i'm going to

120
00:04:54,720 --> 00:04:56,960
be using for the purposes of today's

121
00:04:56,960 --> 00:04:57,919
demo

122
00:04:57,919 --> 00:05:00,880
is called faucet it's an open source

123
00:05:00,880 --> 00:05:04,080
controller it's compatible with

124
00:05:04,080 --> 00:05:08,400
any open flow v3 compatible switch

125
00:05:08,400 --> 00:05:10,400
which crucially means that

126
00:05:10,400 --> 00:05:13,600
it's compatible with open v-switch um

127
00:05:13,600 --> 00:05:15,360
you know the the things that i'm going

128
00:05:15,360 --> 00:05:17,280
to be talking about today are things

129
00:05:17,280 --> 00:05:19,039
that i would like people to try i would

130
00:05:19,039 --> 00:05:21,280
like people to try and put into practice

131
00:05:21,280 --> 00:05:22,400
and so

132
00:05:22,400 --> 00:05:23,280
uh

133
00:05:23,280 --> 00:05:25,039
the fact that there's a virtual switch

134
00:05:25,039 --> 00:05:29,039
option out there so that you can go

135
00:05:29,039 --> 00:05:31,199
you know and try these things without

136
00:05:31,199 --> 00:05:33,440
needing to invest in hardware

137
00:05:33,440 --> 00:05:35,199
is very important to me at least i i

138
00:05:35,199 --> 00:05:38,160
think that's like i i hate the idea of

139
00:05:38,160 --> 00:05:39,280
people being

140
00:05:39,280 --> 00:05:41,840
priced out of learning things or or

141
00:05:41,840 --> 00:05:44,960
embracing good security practices

142
00:05:44,960 --> 00:05:46,880
so um

143
00:05:46,880 --> 00:05:48,400
some of the important features that

144
00:05:48,400 --> 00:05:50,560
we're gonna make use of

145
00:05:50,560 --> 00:05:53,440
in this uh axles and vlans which

146
00:05:53,440 --> 00:05:55,199
hopefully everybody is already familiar

147
00:05:55,199 --> 00:05:57,520
with uh if if you're not i'm i'm happy

148
00:05:57,520 --> 00:05:58,880
to talk about it but i don't want to

149
00:05:58,880 --> 00:06:00,319
belabor it here i don't want to lose

150
00:06:00,319 --> 00:06:02,000
people uh and then we're going to be

151
00:06:02,000 --> 00:06:03,840
talking about uh

152
00:06:03,840 --> 00:06:06,319
something called co-processing which to

153
00:06:06,319 --> 00:06:08,560
the best of my knowledge is

154
00:06:08,560 --> 00:06:09,520
a

155
00:06:09,520 --> 00:06:11,840
technique that's unique to faucet and

156
00:06:11,840 --> 00:06:13,919
it's really going to be the meat of the

157
00:06:13,919 --> 00:06:16,319
demo that i'm doing later

158
00:06:16,319 --> 00:06:20,319
um so we're going to talk about that in

159
00:06:20,319 --> 00:06:23,919
quite a bit of detail here today

160
00:06:24,479 --> 00:06:26,319
the way you actually go about

161
00:06:26,319 --> 00:06:28,240
configuring faucet

162
00:06:28,240 --> 00:06:30,880
and and apples that you want to use you

163
00:06:30,880 --> 00:06:32,639
you just write good old-fashioned ammo

164
00:06:32,639 --> 00:06:35,840
files i know everybody loves gamo uh i

165
00:06:35,840 --> 00:06:38,400
do uh or maybe that's stockholm syndrome

166
00:06:38,400 --> 00:06:39,840
it's hard to tell

167
00:06:39,840 --> 00:06:41,680
um

168
00:06:41,680 --> 00:06:43,280
but you know the great thing about it uh

169
00:06:43,280 --> 00:06:45,280
it's it's human readable you can diff it

170
00:06:45,280 --> 00:06:47,680
i've definitely had scenarios where i

171
00:06:47,680 --> 00:06:49,039
did something to my network

172
00:06:49,039 --> 00:06:51,599
configuration and i wasn't sure what and

173
00:06:51,599 --> 00:06:53,120
being able to just go in and say you

174
00:06:53,120 --> 00:06:56,000
know what changed between here and here

175
00:06:56,000 --> 00:06:58,479
uh was very very helpful and again you

176
00:06:58,479 --> 00:07:00,880
can version control it oh so another

177
00:07:00,880 --> 00:07:02,400
cool thing about like the version

178
00:07:02,400 --> 00:07:05,120
control thing um

179
00:07:05,120 --> 00:07:07,039
you know in our in the office of the

180
00:07:07,039 --> 00:07:09,039
company that i work at uh we actually

181
00:07:09,039 --> 00:07:12,319
have a big internal faucet deployment

182
00:07:12,319 --> 00:07:13,520
and

183
00:07:13,520 --> 00:07:16,639
we also have an internal version control

184
00:07:16,639 --> 00:07:19,360
system it's gitlab right and so what you

185
00:07:19,360 --> 00:07:20,880
can literally do

186
00:07:20,880 --> 00:07:23,120
is if you want to say add a device to

187
00:07:23,120 --> 00:07:24,720
the network or remove it from the

188
00:07:24,720 --> 00:07:27,520
network you just go into this gitlab

189
00:07:27,520 --> 00:07:29,440
instance and you make a pull request

190
00:07:29,440 --> 00:07:32,880
against the network configuration

191
00:07:32,880 --> 00:07:34,960
so then somebody from the it team goes

192
00:07:34,960 --> 00:07:37,199
through they you know review that say

193
00:07:37,199 --> 00:07:39,280
you know thumbs up thumbs down and if

194
00:07:39,280 --> 00:07:41,120
they approve your pull request that

195
00:07:41,120 --> 00:07:43,680
kicks off this ci cd pipeline that

196
00:07:43,680 --> 00:07:45,440
pushes all that config out to the

197
00:07:45,440 --> 00:07:47,520
controllers and the network is just

198
00:07:47,520 --> 00:07:50,639
ready to go so you can

199
00:07:50,639 --> 00:07:53,360
just entirely um

200
00:07:53,360 --> 00:07:56,080
self-service add these endpoints

201
00:07:56,080 --> 00:07:57,599
well mostly self-service right

202
00:07:57,599 --> 00:08:00,080
somebody's gotta review it but uh it's

203
00:08:00,080 --> 00:08:01,759
just really easy it's a really slick

204
00:08:01,759 --> 00:08:04,000
system uh those guys were very clever

205
00:08:04,000 --> 00:08:06,240
when i thought it up so

206
00:08:06,240 --> 00:08:07,680
um

207
00:08:07,680 --> 00:08:09,840
under the hood what faucet is doing is

208
00:08:09,840 --> 00:08:11,680
it's it's converting

209
00:08:11,680 --> 00:08:14,639
that yaml file into these open flow

210
00:08:14,639 --> 00:08:17,680
rules or oh sorry open flow flows

211
00:08:17,680 --> 00:08:20,000
uh and this is kind of an example of

212
00:08:20,000 --> 00:08:22,800
what an open flow flow looks like that's

213
00:08:22,800 --> 00:08:26,000
from the flow table um

214
00:08:26,000 --> 00:08:28,879
they're as you can see very hard to read

215
00:08:28,879 --> 00:08:31,199
not terribly intelligible and so i like

216
00:08:31,199 --> 00:08:32,479
to think of

217
00:08:32,479 --> 00:08:34,799
the relationship here what foss is doing

218
00:08:34,799 --> 00:08:36,958
for us is very similar to what something

219
00:08:36,958 --> 00:08:39,839
like ufw is doing for ip tables right

220
00:08:39,839 --> 00:08:41,760
you can go in and you can manually write

221
00:08:41,760 --> 00:08:43,519
those ip tables rules you can see i've

222
00:08:43,519 --> 00:08:46,000
got an example of a very very simple one

223
00:08:46,000 --> 00:08:47,120
down there

224
00:08:47,120 --> 00:08:48,480
um

225
00:08:48,480 --> 00:08:50,640
but it's way easier to just go into uh

226
00:08:50,640 --> 00:08:53,440
fw and say you know deny from block

227
00:08:53,440 --> 00:08:55,839
so it's just giving you a cleaner more

228
00:08:55,839 --> 00:08:59,360
human-friendly syntax

229
00:08:59,680 --> 00:09:02,080
among other things but

230
00:09:02,080 --> 00:09:05,440
from the standpoint of open flow folks

231
00:09:05,440 --> 00:09:07,360
so another tool that's that's going to

232
00:09:07,360 --> 00:09:09,200
be in play today and there are a few of

233
00:09:09,200 --> 00:09:11,680
these i apologize so bear with me as a

234
00:09:11,680 --> 00:09:13,440
tool that the team i'm part of wrote

235
00:09:13,440 --> 00:09:14,959
called poseidon

236
00:09:14,959 --> 00:09:16,080
and

237
00:09:16,080 --> 00:09:19,519
what poseidon is is it's an open source

238
00:09:19,519 --> 00:09:21,360
kit to

239
00:09:21,360 --> 00:09:23,519
monitor your network

240
00:09:23,519 --> 00:09:26,560
using sdn

241
00:09:29,920 --> 00:09:32,720
and what it basically does is

242
00:09:32,720 --> 00:09:37,519
poseidon interfaces with that controller

243
00:09:37,519 --> 00:09:38,720
and

244
00:09:38,720 --> 00:09:42,720
uses that interface to gather traffic

245
00:09:42,720 --> 00:09:44,640
to run through this analysis pipeline

246
00:09:44,640 --> 00:09:46,080
and we're basically trying to answer

247
00:09:46,080 --> 00:09:48,240
three questions you know what is

248
00:09:48,240 --> 00:09:51,200
actually on my network what is it doing

249
00:09:51,200 --> 00:09:53,200
there and do i care enough to do

250
00:09:53,200 --> 00:09:56,080
something about it

251
00:09:57,360 --> 00:09:59,680
the way that you go about doing that in

252
00:09:59,680 --> 00:10:01,680
an sdn is

253
00:10:01,680 --> 00:10:05,200
you have the ability to mirror traffic

254
00:10:05,200 --> 00:10:06,399
so

255
00:10:06,399 --> 00:10:09,279
what happens is that uh

256
00:10:09,279 --> 00:10:12,079
you will tell the controller i want to

257
00:10:12,079 --> 00:10:13,519
mirror traffic

258
00:10:13,519 --> 00:10:16,480
from this location to this location uh

259
00:10:16,480 --> 00:10:19,760
poseidon then we record that as a pcap

260
00:10:19,760 --> 00:10:21,920
um so i know some of you who are

261
00:10:21,920 --> 00:10:24,000
probably more privacy or liability

262
00:10:24,000 --> 00:10:26,480
conscience uh will be glad to know that

263
00:10:26,480 --> 00:10:28,640
the absolute first thing we do is just

264
00:10:28,640 --> 00:10:30,640
dump the payloads we don't want to see

265
00:10:30,640 --> 00:10:32,160
it we don't want to know anything about

266
00:10:32,160 --> 00:10:33,920
it we assume that those are going to be

267
00:10:33,920 --> 00:10:35,200
encrypted and so they're going to be

268
00:10:35,200 --> 00:10:38,560
junk from an analysis standpoint anyway

269
00:10:38,560 --> 00:10:39,680
we go through a bunch of other

270
00:10:39,680 --> 00:10:41,600
pre-processing too where we like split

271
00:10:41,600 --> 00:10:43,920
it into conversations and and do some

272
00:10:43,920 --> 00:10:45,200
different things with it and then we

273
00:10:45,200 --> 00:10:47,120
pass it off to this configurable suite

274
00:10:47,120 --> 00:10:49,279
of analysis tools that we've built up

275
00:10:49,279 --> 00:10:50,640
i'll talk about a couple of those here

276
00:10:50,640 --> 00:10:51,680
in a second

277
00:10:51,680 --> 00:10:54,320
uh and and then the basic idea is based

278
00:10:54,320 --> 00:10:56,560
on the output of those tools we can do

279
00:10:56,560 --> 00:10:57,760
one of

280
00:10:57,760 --> 00:11:00,560
three things i actually technically four

281
00:11:00,560 --> 00:11:02,640
i should have put the fourth on here so

282
00:11:02,640 --> 00:11:04,880
you can say i don't really think i have

283
00:11:04,880 --> 00:11:06,240
a handle on what's going on with this

284
00:11:06,240 --> 00:11:07,680
thing i want to keep watching it that's

285
00:11:07,680 --> 00:11:10,959
continued mirroring right you can say

286
00:11:10,959 --> 00:11:12,880
something bad is going on here i don't

287
00:11:12,880 --> 00:11:14,640
like it i want to wall this thing off

288
00:11:14,640 --> 00:11:16,640
from my network that's the quarantine

289
00:11:16,640 --> 00:11:18,240
option

290
00:11:18,240 --> 00:11:20,640
you can apply an arbitrary axle and

291
00:11:20,640 --> 00:11:23,360
we've got like a configurable rules

292
00:11:23,360 --> 00:11:24,880
engine where you can say you know based

293
00:11:24,880 --> 00:11:27,680
on these metrics at these thresholds

294
00:11:27,680 --> 00:11:29,760
this is the apple i want to apply and

295
00:11:29,760 --> 00:11:31,200
then the fourth thing

296
00:11:31,200 --> 00:11:33,519
which is tacit is like you know

297
00:11:33,519 --> 00:11:37,839
everything's fine as you work carry on

298
00:11:39,120 --> 00:11:40,640
so a couple of the things that we're

299
00:11:40,640 --> 00:11:42,880
using under the hood there uh we're

300
00:11:42,880 --> 00:11:45,839
using poff to do os fingerprinting

301
00:11:45,839 --> 00:11:48,880
we're using uh network ml which is a

302
00:11:48,880 --> 00:11:51,279
machine learning model that our team has

303
00:11:51,279 --> 00:11:53,839
developed in-house

304
00:11:53,839 --> 00:11:54,839
that

305
00:11:54,839 --> 00:11:57,200
uh is

306
00:11:57,200 --> 00:11:59,839
focused on the idea of doing device role

307
00:11:59,839 --> 00:12:01,440
identification

308
00:12:01,440 --> 00:12:03,360
sort of with the thought being that

309
00:12:03,360 --> 00:12:05,519
let's suppose you have this device and

310
00:12:05,519 --> 00:12:08,079
you know two weeks ago it was behaving

311
00:12:08,079 --> 00:12:08,880
like

312
00:12:08,880 --> 00:12:11,440
uh business user's workstation and last

313
00:12:11,440 --> 00:12:12,959
week it was behaving like a business

314
00:12:12,959 --> 00:12:15,200
users workstation and yesterday it was

315
00:12:15,200 --> 00:12:16,560
behaving like a business user's

316
00:12:16,560 --> 00:12:19,040
workstation but today for some reason

317
00:12:19,040 --> 00:12:21,920
it's starting to act like an ftp server

318
00:12:21,920 --> 00:12:23,200
you know you might want to go

319
00:12:23,200 --> 00:12:24,720
investigate like what prompted that

320
00:12:24,720 --> 00:12:26,160
change in behavior is that something

321
00:12:26,160 --> 00:12:28,000
that needs to be investigated is that

322
00:12:28,000 --> 00:12:31,120
something that you need to look into

323
00:12:31,120 --> 00:12:33,360
um and then we also ship with some

324
00:12:33,360 --> 00:12:35,279
grafana dashboards and prometheus

325
00:12:35,279 --> 00:12:37,760
metrics uh

326
00:12:37,760 --> 00:12:39,440
again the basic idea being that those

327
00:12:39,440 --> 00:12:40,079
are

328
00:12:40,079 --> 00:12:41,760
pretty standard tools that people are

329
00:12:41,760 --> 00:12:44,399
used to using um

330
00:12:44,399 --> 00:12:47,040
just to make the data more visible make

331
00:12:47,040 --> 00:12:48,720
it easier to present it out to other

332
00:12:48,720 --> 00:12:50,720
people you know one one of the things

333
00:12:50,720 --> 00:12:52,720
that at least in our group we've seen

334
00:12:52,720 --> 00:12:54,720
and kind of thought a lot about is the

335
00:12:54,720 --> 00:12:55,920
fact that

336
00:12:55,920 --> 00:12:56,880
um

337
00:12:56,880 --> 00:12:58,880
you know network-facing folks are very

338
00:12:58,880 --> 00:13:00,639
used to working in terminals and kind of

339
00:13:00,639 --> 00:13:02,320
trust that but when we try and take the

340
00:13:02,320 --> 00:13:04,079
information that we find there out to

341
00:13:04,079 --> 00:13:06,240
other people it becomes very hard to

342
00:13:06,240 --> 00:13:08,240
communicate because you know they see

343
00:13:08,240 --> 00:13:09,920
that that black and green and they just

344
00:13:09,920 --> 00:13:11,760
kind of their eyes glaze over and they

345
00:13:11,760 --> 00:13:12,800
tune out

346
00:13:12,800 --> 00:13:13,600
um

347
00:13:13,600 --> 00:13:15,440
you know the look my wife gives me when

348
00:13:15,440 --> 00:13:18,720
i start talking about stuff

349
00:13:18,839 --> 00:13:21,360
um so

350
00:13:21,360 --> 00:13:23,440
okay so co-process uh we're we're

351
00:13:23,440 --> 00:13:25,440
getting into

352
00:13:25,440 --> 00:13:27,279
sort of the meat of what's going on here

353
00:13:27,279 --> 00:13:29,760
and and co-processing again as far as i

354
00:13:29,760 --> 00:13:31,920
know is is a technique that's unique to

355
00:13:31,920 --> 00:13:34,800
the faucet controller but what it lets

356
00:13:34,800 --> 00:13:38,079
you do is use an apple

357
00:13:38,079 --> 00:13:39,600
to say

358
00:13:39,600 --> 00:13:42,880
i want to pull traffic out of the

359
00:13:42,880 --> 00:13:44,800
general traffic stream

360
00:13:44,800 --> 00:13:47,279
and i want to pass it off to this

361
00:13:47,279 --> 00:13:51,360
external entity to be processed

362
00:13:51,360 --> 00:13:52,320
okay

363
00:13:52,320 --> 00:13:53,519
um

364
00:13:53,519 --> 00:13:55,760
the co-processor can do whatever it

365
00:13:55,760 --> 00:13:58,959
would like with that traffic

366
00:13:58,959 --> 00:14:02,079
uh it is responsible for that traffic

367
00:14:02,079 --> 00:14:04,720
and one of the cool things about this is

368
00:14:04,720 --> 00:14:05,760
um

369
00:14:05,760 --> 00:14:08,399
you know you can have co-processed and

370
00:14:08,399 --> 00:14:11,360
ordinary traffic just side by side

371
00:14:11,360 --> 00:14:14,320
uh it boils down to the granularity of

372
00:14:14,320 --> 00:14:16,639
the apple you write

373
00:14:16,639 --> 00:14:19,120
so that you you can use it for a lot of

374
00:14:19,120 --> 00:14:20,560
different things depending on your use

375
00:14:20,560 --> 00:14:23,120
case so for instance you might for some

376
00:14:23,120 --> 00:14:25,120
reason want to say i only want to

377
00:14:25,120 --> 00:14:27,360
co-process traffic between

378
00:14:27,360 --> 00:14:29,519
this ip address and this ip address on

379
00:14:29,519 --> 00:14:31,680
this particular port and then it will

380
00:14:31,680 --> 00:14:33,839
just leave everything else even between

381
00:14:33,839 --> 00:14:36,880
those same two machines alone

382
00:14:36,880 --> 00:14:39,120
or you can say you know i want to grab

383
00:14:39,120 --> 00:14:40,720
everything on this port across the

384
00:14:40,720 --> 00:14:42,959
network my buddy josh one of the things

385
00:14:42,959 --> 00:14:45,040
that that he does with this

386
00:14:45,040 --> 00:14:46,320
is

387
00:14:46,320 --> 00:14:48,399
he just scoops up

388
00:14:48,399 --> 00:14:52,720
all traffic on tcp and udp 53 and

389
00:14:52,720 --> 00:14:54,639
co-processes it

390
00:14:54,639 --> 00:14:56,959
uh through his his dns server right so

391
00:14:56,959 --> 00:14:59,519
what he's done there is he's mitigated

392
00:14:59,519 --> 00:15:01,680
uh any misconfigurations

393
00:15:01,680 --> 00:15:04,399
uh so if a device has like a hard-coded

394
00:15:04,399 --> 00:15:06,240
dns server it wants to use or somebody

395
00:15:06,240 --> 00:15:08,560
sets their dns wrong it doesn't matter

396
00:15:08,560 --> 00:15:11,120
it still goes through his dns server and

397
00:15:11,120 --> 00:15:13,680
gets dns response

398
00:15:13,680 --> 00:15:14,639
um

399
00:15:14,639 --> 00:15:16,800
and as a side effect of that it looks

400
00:15:16,800 --> 00:15:18,880
like he has really really fast paying

401
00:15:18,880 --> 00:15:20,240
times to like

402
00:15:20,240 --> 00:15:23,760
stuff like 8.8.8 and 1.1.1.1

403
00:15:23,760 --> 00:15:25,839
um but the backbone of the internet is

404
00:15:25,839 --> 00:15:28,160
you know in his server closet

405
00:15:28,160 --> 00:15:29,920
um

406
00:15:29,920 --> 00:15:31,279
you know uh

407
00:15:31,279 --> 00:15:34,000
these co-process packets are at least to

408
00:15:34,000 --> 00:15:36,639
my knowledge indistinguishable um maybe

409
00:15:36,639 --> 00:15:37,920
somebody smarter than me can figure out

410
00:15:37,920 --> 00:15:41,440
a way to tell i don't know

411
00:15:41,440 --> 00:15:43,600
oh thanks

412
00:15:43,600 --> 00:15:46,959
thanks for that powerpoint

413
00:15:47,279 --> 00:15:49,600
okay so um

414
00:15:49,600 --> 00:15:51,600
some more crucial details about this for

415
00:15:51,600 --> 00:15:53,040
the purposes of what we're talking about

416
00:15:53,040 --> 00:15:56,240
today the way you actually do this is in

417
00:15:56,240 --> 00:15:58,160
that faucet config file i showed you

418
00:15:58,160 --> 00:16:00,800
earlier you're going to designate

419
00:16:00,800 --> 00:16:01,680
a

420
00:16:01,680 --> 00:16:03,279
switch port

421
00:16:03,279 --> 00:16:05,680
as a co-processor port it's going to get

422
00:16:05,680 --> 00:16:07,600
marked output only so it's not going to

423
00:16:07,600 --> 00:16:08,880
show up on you know different types of

424
00:16:08,880 --> 00:16:11,360
scans and things but the co-processor is

425
00:16:11,360 --> 00:16:13,199
now totally responsible for dealing with

426
00:16:13,199 --> 00:16:15,440
those packets right so

427
00:16:15,440 --> 00:16:17,440
um you can do whatever you'd like with

428
00:16:17,440 --> 00:16:18,160
them

429
00:16:18,160 --> 00:16:19,600
you can

430
00:16:19,600 --> 00:16:21,040
you can forward them onto where they're

431
00:16:21,040 --> 00:16:22,480
supposed to go

432
00:16:22,480 --> 00:16:25,360
you can drop them uh you can have the

433
00:16:25,360 --> 00:16:29,040
co-processor respond you can modify them

434
00:16:29,040 --> 00:16:31,279
on the way to their destination or on

435
00:16:31,279 --> 00:16:33,839
the way back from their debt

436
00:16:33,839 --> 00:16:35,600
no not on the way back that would have

437
00:16:35,600 --> 00:16:37,759
to go through something else sorry

438
00:16:37,759 --> 00:16:40,240
but you can modify them in flight

439
00:16:40,240 --> 00:16:42,560
um

440
00:16:46,000 --> 00:16:47,839
so now if you were paying attention on

441
00:16:47,839 --> 00:16:49,759
the last slide you noticed that i said

442
00:16:49,759 --> 00:16:51,519
that that happened at the switch port

443
00:16:51,519 --> 00:16:52,800
level

444
00:16:52,800 --> 00:16:54,639
and one of the problems that we bumped

445
00:16:54,639 --> 00:16:56,160
into when we were doing this is

446
00:16:56,160 --> 00:16:58,000
particularly if you're using a physical

447
00:16:58,000 --> 00:17:00,240
switch if you want to co-process

448
00:17:00,240 --> 00:17:03,360
multiple things that becomes a very real

449
00:17:03,360 --> 00:17:06,959
estate intensive type of thing

450
00:17:06,959 --> 00:17:07,839
okay

451
00:17:07,839 --> 00:17:09,039
and so

452
00:17:09,039 --> 00:17:11,280
we created this tool called pipette and

453
00:17:11,280 --> 00:17:13,280
the reason exhibit is over here is

454
00:17:13,280 --> 00:17:15,280
because literally the way this works is

455
00:17:15,280 --> 00:17:16,079
we

456
00:17:16,079 --> 00:17:18,880
we took your big sdn and we mounted a

457
00:17:18,880 --> 00:17:21,039
tiny little sdn in the back of the head

458
00:17:21,039 --> 00:17:22,319
rest

459
00:17:22,319 --> 00:17:25,520
and what that smaller sdn does is it

460
00:17:25,520 --> 00:17:27,919
acts as a network for just your

461
00:17:27,919 --> 00:17:30,320
co-processed services so under the hood

462
00:17:30,320 --> 00:17:33,120
there's just an ovs bridge that we're

463
00:17:33,120 --> 00:17:35,280
sending stuff to on different ports so

464
00:17:35,280 --> 00:17:38,160
that you can have multiple co-processing

465
00:17:38,160 --> 00:17:39,200
services

466
00:17:39,200 --> 00:17:42,320
um going at the same time on a single

467
00:17:42,320 --> 00:17:43,840
physical switchboard if you're using a

468
00:17:43,840 --> 00:17:45,200
physical switch

469
00:17:45,200 --> 00:17:46,960
um

470
00:17:46,960 --> 00:17:47,840
so

471
00:17:47,840 --> 00:17:50,240
uh

472
00:17:50,240 --> 00:17:52,160
one of two two things that i think are

473
00:17:52,160 --> 00:17:54,080
cool about it one if if you're

474
00:17:54,080 --> 00:17:55,200
interested in that sort of thing if

475
00:17:55,200 --> 00:17:56,720
you've made the decision that based on

476
00:17:56,720 --> 00:17:59,360
your use case you want to see

477
00:17:59,360 --> 00:18:02,080
what's going on uh it can be configured

478
00:18:02,080 --> 00:18:03,840
to do full capture through that

479
00:18:03,840 --> 00:18:05,679
co-processor so you have a pcap of

480
00:18:05,679 --> 00:18:07,760
everything that goes in comes out

481
00:18:07,760 --> 00:18:09,520
um

482
00:18:09,520 --> 00:18:11,039
and and then again because we're

483
00:18:11,039 --> 00:18:14,160
engineers and we're lazy uh all of that

484
00:18:14,160 --> 00:18:16,400
stuff can be controlled via an api right

485
00:18:16,400 --> 00:18:18,640
you can start things stop things

486
00:18:18,640 --> 00:18:22,480
change configuration et cetera

487
00:18:22,480 --> 00:18:24,400
um

488
00:18:24,400 --> 00:18:26,559
last tool because i feels like i've just

489
00:18:26,559 --> 00:18:28,640
been rambling through this list and i

490
00:18:28,640 --> 00:18:30,720
apologize for that thank you guys for

491
00:18:30,720 --> 00:18:32,320
bearing with me on this

492
00:18:32,320 --> 00:18:33,360
um

493
00:18:33,360 --> 00:18:35,120
the last one is this tool that we built

494
00:18:35,120 --> 00:18:38,240
called dove snap and what dovesnap does

495
00:18:38,240 --> 00:18:40,320
and this is this is really cool and i'm

496
00:18:40,320 --> 00:18:42,000
just scratching the surface here of

497
00:18:42,000 --> 00:18:43,840
things you could use this for

498
00:18:43,840 --> 00:18:46,000
but it lets you

499
00:18:46,000 --> 00:18:47,200
merge

500
00:18:47,200 --> 00:18:50,480
a a physical and a virtual network

501
00:18:50,480 --> 00:18:52,400
um

502
00:18:52,400 --> 00:18:53,919
so

503
00:18:53,919 --> 00:18:56,480
uh you can basically have a physical

504
00:18:56,480 --> 00:18:58,640
switch and a virtual switch acting as

505
00:18:58,640 --> 00:19:00,720
sort of the same switch

506
00:19:00,720 --> 00:19:02,000
from the standpoint of anything

507
00:19:02,000 --> 00:19:04,000
interfacing with them and the other

508
00:19:04,000 --> 00:19:05,440
thing that's cool is

509
00:19:05,440 --> 00:19:07,600
i mentioned again mirroring in the sdn

510
00:19:07,600 --> 00:19:10,640
context we cascade that through like the

511
00:19:10,640 --> 00:19:13,200
entire thing we create this uh we call

512
00:19:13,200 --> 00:19:15,919
it a mirror river so that you know you

513
00:19:15,919 --> 00:19:18,640
have full visibility of the traffic

514
00:19:18,640 --> 00:19:19,760
flowing

515
00:19:19,760 --> 00:19:23,360
through your network uh

516
00:19:23,360 --> 00:19:24,960
which i i at least think is really

517
00:19:24,960 --> 00:19:26,400
impressive and it lets you do some

518
00:19:26,400 --> 00:19:28,640
really fun things

519
00:19:28,640 --> 00:19:29,440
so

520
00:19:29,440 --> 00:19:30,400
um

521
00:19:30,400 --> 00:19:32,640
now we're we're going to go on to my

522
00:19:32,640 --> 00:19:35,280
demo uh so first off

523
00:19:35,280 --> 00:19:38,000
if we could all just as a moment agree

524
00:19:38,000 --> 00:19:40,400
i'm gonna try and do a live demo here i

525
00:19:40,400 --> 00:19:42,480
make zero guarantees

526
00:19:42,480 --> 00:19:44,640
if things don't quite pan out i do have

527
00:19:44,640 --> 00:19:48,559
a video of it but like

528
00:19:48,559 --> 00:19:51,120
if anybody asks it went off flawlessly

529
00:19:51,120 --> 00:19:52,480
and i am a wizard

530
00:19:52,480 --> 00:19:55,200
and in return if anybody asks me about a

531
00:19:55,200 --> 00:19:56,960
demo that you did

532
00:19:56,960 --> 00:19:58,160
i agree

533
00:19:58,160 --> 00:20:01,600
that it went off perfectly and you are

534
00:20:01,600 --> 00:20:03,679
magnificent

535
00:20:03,679 --> 00:20:04,880
everybody

536
00:20:04,880 --> 00:20:07,120
on board with that awesome

537
00:20:07,120 --> 00:20:08,799
um

538
00:20:08,799 --> 00:20:10,880
so in this demo i'm going to show you

539
00:20:10,880 --> 00:20:12,400
two different ways to use code

540
00:20:12,400 --> 00:20:15,120
processing uh the first one is this

541
00:20:15,120 --> 00:20:16,880
deception slash

542
00:20:16,880 --> 00:20:19,440
active defense use case

543
00:20:19,440 --> 00:20:21,760
uh and basically the the way it's gonna

544
00:20:21,760 --> 00:20:24,240
work is i've got this this hypothetical

545
00:20:24,240 --> 00:20:25,600
well it's not hypothetical it's a real

546
00:20:25,600 --> 00:20:28,240
network i set it up um

547
00:20:28,240 --> 00:20:30,960
it's got two web servers one of them is

548
00:20:30,960 --> 00:20:32,960
meant to be this this sort of

549
00:20:32,960 --> 00:20:34,559
data-backed

550
00:20:34,559 --> 00:20:36,640
corporate intranet type of site

551
00:20:36,640 --> 00:20:38,000
something that you would go in and look

552
00:20:38,000 --> 00:20:39,520
at you know within your enterprise if

553
00:20:39,520 --> 00:20:41,120
you wanted to track like metrics or

554
00:20:41,120 --> 00:20:43,440
something of that nature um

555
00:20:43,440 --> 00:20:46,240
and the other one is meant to be an

556
00:20:46,240 --> 00:20:49,760
approximation of like some kind of demo

557
00:20:49,760 --> 00:20:52,559
server right so something that people

558
00:20:52,559 --> 00:20:54,720
are in the process of building out uh

559
00:20:54,720 --> 00:20:56,480
they want to get feedback they want to

560
00:20:56,480 --> 00:20:58,000
share it with people but it's probably

561
00:20:58,000 --> 00:21:00,559
not quite ready for prime time um so

562
00:21:00,559 --> 00:21:02,159
we're gonna have these two endpoints and

563
00:21:02,159 --> 00:21:04,240
we're gonna use co-processing

564
00:21:04,240 --> 00:21:05,840
to

565
00:21:05,840 --> 00:21:07,919
uh sort of deceive the attacker and kind

566
00:21:07,919 --> 00:21:09,919
of try and lead them through the network

567
00:21:09,919 --> 00:21:12,799
right we're gonna try and uh

568
00:21:12,799 --> 00:21:14,960
give them some decision points but make

569
00:21:14,960 --> 00:21:16,799
it easier to go sort of one direction

570
00:21:16,799 --> 00:21:17,919
than the other

571
00:21:17,919 --> 00:21:19,200
so that we can

572
00:21:19,200 --> 00:21:21,360
kind of coax them into places that we

573
00:21:21,360 --> 00:21:24,960
want and give them reactions that maybe

574
00:21:24,960 --> 00:21:26,559
aren't what they would expect or hope

575
00:21:26,559 --> 00:21:28,720
for

576
00:21:28,799 --> 00:21:31,360
so just to kind of

577
00:21:31,360 --> 00:21:33,760
forestall the question that i inevitably

578
00:21:33,760 --> 00:21:36,159
get when i start talking about this

579
00:21:36,159 --> 00:21:38,480
uh how am i differentiating what i'm

580
00:21:38,480 --> 00:21:40,640
talking about here from a honeypot

581
00:21:40,640 --> 00:21:41,919
um

582
00:21:41,919 --> 00:21:45,440
a couple sort of important things

583
00:21:45,440 --> 00:21:47,440
not to to me at least

584
00:21:47,440 --> 00:21:48,960
uh

585
00:21:48,960 --> 00:21:52,480
a honey pot is is just a single purpose

586
00:21:52,480 --> 00:21:54,880
thing right you'll have an ssh honey pot

587
00:21:54,880 --> 00:21:56,840
or an ftp honey pot or something of that

588
00:21:56,840 --> 00:21:59,120
nature um so

589
00:21:59,120 --> 00:22:00,559
this this isn't like that it doesn't

590
00:22:00,559 --> 00:22:02,480
have the same signatures that sort of

591
00:22:02,480 --> 00:22:04,880
thing also and i can't stress this

592
00:22:04,880 --> 00:22:07,679
enough uh co-processing is not just a

593
00:22:07,679 --> 00:22:10,799
deceptive technology right so a honeypot

594
00:22:10,799 --> 00:22:13,039
is is always a deceptive thing

595
00:22:13,039 --> 00:22:15,039
co-processing isn't necessarily

596
00:22:15,039 --> 00:22:17,840
deceptive i'm using it to create a

597
00:22:17,840 --> 00:22:19,679
deceptive environment

598
00:22:19,679 --> 00:22:22,159
but you know as in my early example

599
00:22:22,159 --> 00:22:25,280
where josh uses it to mitigate dns

600
00:22:25,280 --> 00:22:28,320
misconfigurations there are other usages

601
00:22:28,320 --> 00:22:30,640
i'm just picking on some here

602
00:22:30,640 --> 00:22:32,799
the other thing that i think makes this

603
00:22:32,799 --> 00:22:33,440
a

604
00:22:33,440 --> 00:22:35,760
different from a honeypot but cool for

605
00:22:35,760 --> 00:22:36,960
deception

606
00:22:36,960 --> 00:22:37,760
is

607
00:22:37,760 --> 00:22:39,440
um

608
00:22:39,440 --> 00:22:42,799
you can have sort of deceptive services

609
00:22:42,799 --> 00:22:45,120
and and live services

610
00:22:45,120 --> 00:22:47,760
side by side on the same end point so

611
00:22:47,760 --> 00:22:49,919
you know uh for instance a very common

612
00:22:49,919 --> 00:22:52,240
pattern you have an http server of some

613
00:22:52,240 --> 00:22:54,720
sort and then you'll have ssh alongside

614
00:22:54,720 --> 00:22:57,919
of it that people use to manage that

615
00:22:57,919 --> 00:22:59,440
well uh

616
00:22:59,440 --> 00:23:02,640
totally possible to have a live http

617
00:23:02,640 --> 00:23:03,760
server

618
00:23:03,760 --> 00:23:06,400
and then co-process the ssh on that same

619
00:23:06,400 --> 00:23:08,400
server right so that

620
00:23:08,400 --> 00:23:09,840
if somebody comes in and they feel like

621
00:23:09,840 --> 00:23:11,520
they found credentials or something

622
00:23:11,520 --> 00:23:13,679
they're not

623
00:23:13,679 --> 00:23:14,799
playing with what they think that

624
00:23:14,799 --> 00:23:17,520
they're playing with

625
00:23:18,720 --> 00:23:20,880
um so

626
00:23:20,880 --> 00:23:22,480
sort of the other way that i'm going to

627
00:23:22,480 --> 00:23:23,679
use this

628
00:23:23,679 --> 00:23:25,919
is to

629
00:23:25,919 --> 00:23:28,400
protect a database

630
00:23:28,400 --> 00:23:31,360
uh this is a use case that's actually

631
00:23:31,360 --> 00:23:33,440
very near and dear to my heart i i

632
00:23:33,440 --> 00:23:35,600
started my career

633
00:23:35,600 --> 00:23:38,159
as a database admin for like a retail

634
00:23:38,159 --> 00:23:39,120
company

635
00:23:39,120 --> 00:23:41,200
um

636
00:23:41,200 --> 00:23:42,320
and so

637
00:23:42,320 --> 00:23:43,440
sort of the

638
00:23:43,440 --> 00:23:46,159
the trials and tribulations that people

639
00:23:46,159 --> 00:23:49,279
who have to manage production databases

640
00:23:49,279 --> 00:23:53,120
uh live with uh are i've got scars from

641
00:23:53,120 --> 00:23:55,360
those things and so you know if i can if

642
00:23:55,360 --> 00:23:56,880
i can give back and help them and make

643
00:23:56,880 --> 00:23:59,679
their lives easier

644
00:24:00,720 --> 00:24:02,799
so with that being said

645
00:24:02,799 --> 00:24:04,480
we're going to attempt to launch into

646
00:24:04,480 --> 00:24:06,880
the demo here

647
00:24:06,880 --> 00:24:09,200
um

648
00:24:09,600 --> 00:24:11,360
this is

649
00:24:11,360 --> 00:24:13,200
what we want the attacker to think the

650
00:24:13,200 --> 00:24:15,360
network looks like um maybe this is what

651
00:24:15,360 --> 00:24:16,880
the network looks like i would be

652
00:24:16,880 --> 00:24:19,120
hesitant to trust me if i were you i've

653
00:24:19,120 --> 00:24:20,400
already told you i'm going to try and

654
00:24:20,400 --> 00:24:21,520
deceive you

655
00:24:21,520 --> 00:24:23,360
uh so these are the things that they

656
00:24:23,360 --> 00:24:26,400
will that they will see

657
00:24:26,400 --> 00:24:28,720
um with the exception of this open flow

658
00:24:28,720 --> 00:24:30,799
controller that's not going to be

659
00:24:30,799 --> 00:24:33,279
visible that's just there

660
00:24:33,279 --> 00:24:35,760
for the sake of completeness and quite

661
00:24:35,760 --> 00:24:37,600
frankly because i borrowed this from a

662
00:24:37,600 --> 00:24:41,440
different diagram so um

663
00:24:41,440 --> 00:24:42,880
and and what we're actually going to do

664
00:24:42,880 --> 00:24:45,360
in this demo here is

665
00:24:45,360 --> 00:24:47,200
i'm gonna put on my bad guy hat for a

666
00:24:47,200 --> 00:24:49,840
minute uh we're gonna try and access

667
00:24:49,840 --> 00:24:51,679
these web servers

668
00:24:51,679 --> 00:24:53,679
um

669
00:24:53,679 --> 00:24:55,440
and we're gonna try and you know get

670
00:24:55,440 --> 00:24:57,679
into one use that as a jumping off point

671
00:24:57,679 --> 00:24:59,919
to explore the network further see we

672
00:24:59,919 --> 00:25:01,919
can find some useful information with

673
00:25:01,919 --> 00:25:04,559
the ultimate goal of you know defacing

674
00:25:04,559 --> 00:25:08,080
or polluting the data back ending

675
00:25:08,080 --> 00:25:09,600
that

676
00:25:09,600 --> 00:25:11,679
data backed internet site

677
00:25:11,679 --> 00:25:15,799
that i alluded to earlier

678
00:25:16,480 --> 00:25:18,799
so

679
00:25:20,159 --> 00:25:22,720
with that being said

680
00:25:22,720 --> 00:25:24,799
all right

681
00:25:24,799 --> 00:25:25,919
so

682
00:25:25,919 --> 00:25:26,799
that's

683
00:25:26,799 --> 00:25:30,158
okay awesome good

684
00:25:30,320 --> 00:25:33,760
don't do that to me computer

685
00:25:34,799 --> 00:25:37,120
so to start with i'm giving you sort of

686
00:25:37,120 --> 00:25:39,120
the legitimate user view of the world

687
00:25:39,120 --> 00:25:40,960
here right um

688
00:25:40,960 --> 00:25:45,200
i did that twice uh so this

689
00:25:45,200 --> 00:25:47,200
this is the data back intranet site that

690
00:25:47,200 --> 00:25:48,720
i was talking about right we want to try

691
00:25:48,720 --> 00:25:50,320
and get behind this

692
00:25:50,320 --> 00:25:51,279
and

693
00:25:51,279 --> 00:25:53,200
pollute this data or deface it whatever

694
00:25:53,200 --> 00:25:55,360
you want to call that

695
00:25:55,360 --> 00:25:57,440
and then this is meant to be the the

696
00:25:57,440 --> 00:26:00,320
secret demo server um

697
00:26:00,320 --> 00:26:02,159
if you're curious the reason the image

698
00:26:02,159 --> 00:26:04,480
is here is because in an earlier version

699
00:26:04,480 --> 00:26:07,440
of this demo i cast myself as john candy

700
00:26:07,440 --> 00:26:10,000
in the excellent film canadian bacon uh

701
00:26:10,000 --> 00:26:13,279
that was a premise that

702
00:26:13,279 --> 00:26:15,360
was much less uh understandable to

703
00:26:15,360 --> 00:26:17,279
people than i thought it would be uh

704
00:26:17,279 --> 00:26:20,480
apparently not a hugely popular movie

705
00:26:20,480 --> 00:26:22,400
uh you live you learn but i like the

706
00:26:22,400 --> 00:26:26,080
picture um so

707
00:26:26,080 --> 00:26:28,880
now i'm gonna put on my bad guy hat

708
00:26:28,880 --> 00:26:30,799
all right and i'm gonna do a couple of

709
00:26:30,799 --> 00:26:33,120
things so first off you can see as the

710
00:26:33,120 --> 00:26:34,240
bad guy

711
00:26:34,240 --> 00:26:36,840
you you

712
00:26:36,840 --> 00:26:40,320
see um the same data that the legitimate

713
00:26:40,320 --> 00:26:41,440
user does

714
00:26:41,440 --> 00:26:42,880
that is an artifact of the way i've

715
00:26:42,880 --> 00:26:44,559
configured this

716
00:26:44,559 --> 00:26:46,879
um

717
00:26:47,039 --> 00:26:49,200
but

718
00:26:49,200 --> 00:26:52,480
you also see a very very different view

719
00:26:52,480 --> 00:26:54,640
of that demo server

720
00:26:54,640 --> 00:26:57,919
than the regular user does

721
00:26:57,919 --> 00:26:59,600
uh and that's that's very deliberate

722
00:26:59,600 --> 00:27:01,760
that's that's very important we're gonna

723
00:27:01,760 --> 00:27:05,600
leverage that here right so

724
00:27:05,600 --> 00:27:06,640
you know

725
00:27:06,640 --> 00:27:08,799
just kind of looking at these two things

726
00:27:08,799 --> 00:27:11,120
okay so first off let me

727
00:27:11,120 --> 00:27:13,760
pull up my terminal window just for you

728
00:27:13,760 --> 00:27:16,799
know kind of the sake of honesty here uh

729
00:27:16,799 --> 00:27:18,880
i just i ran this earlier so i didn't

730
00:27:18,880 --> 00:27:20,559
have to waste a bunch of time doing it

731
00:27:20,559 --> 00:27:23,919
but this is a very basic nmap scan

732
00:27:23,919 --> 00:27:26,000
kind of showing you

733
00:27:26,000 --> 00:27:28,559
what is going on here you can see

734
00:27:28,559 --> 00:27:30,480
the the demo server

735
00:27:30,480 --> 00:27:34,440
and the uh

736
00:27:34,480 --> 00:27:36,880
the intranet server here uh running

737
00:27:36,880 --> 00:27:38,240
apache

738
00:27:38,240 --> 00:27:41,600
et cetera um

739
00:27:41,600 --> 00:27:43,200
and then there's also the

740
00:27:43,200 --> 00:27:46,559
the database site back there

741
00:27:46,840 --> 00:27:50,480
um uh so one thing that i'm going to do

742
00:27:50,480 --> 00:27:51,360
here

743
00:27:51,360 --> 00:27:52,960
i'm just going to start running a tcp

744
00:27:52,960 --> 00:27:55,120
dump on this don't worry about this a

745
00:27:55,120 --> 00:27:56,960
lot for a second

746
00:27:56,960 --> 00:27:59,840
but it will become material later just

747
00:27:59,840 --> 00:28:01,279
bear with me

748
00:28:01,279 --> 00:28:03,919
okay cool uh and and that just for the

749
00:28:03,919 --> 00:28:08,320
record is running on the site behind

750
00:28:08,320 --> 00:28:09,520
that uh

751
00:28:09,520 --> 00:28:11,360
the demo site right that's the server

752
00:28:11,360 --> 00:28:14,399
that i'm i'm ssh

753
00:28:14,399 --> 00:28:16,720
so i'm gonna go over here i've got

754
00:28:16,720 --> 00:28:18,720
uh yeah

755
00:28:18,720 --> 00:28:22,080
okay so you know as a as an attacker

756
00:28:22,080 --> 00:28:25,360
i've got my bad guy hat on now right

757
00:28:25,360 --> 00:28:26,640
i tried to do this once where i had a

758
00:28:26,640 --> 00:28:28,480
little hat so that you could visually

759
00:28:28,480 --> 00:28:31,039
tell but that got really confusing for

760
00:28:31,039 --> 00:28:33,840
me um

761
00:28:33,840 --> 00:28:35,840
so we go through this and if you if you

762
00:28:35,840 --> 00:28:38,080
look kind of up here at this in this

763
00:28:38,080 --> 00:28:39,039
pattern

764
00:28:39,039 --> 00:28:41,039
you'll see that it looks like somebody

765
00:28:41,039 --> 00:28:43,520
has used a very very bad php include

766
00:28:43,520 --> 00:28:45,840
pattern

767
00:28:46,080 --> 00:28:47,360
that is maybe

768
00:28:47,360 --> 00:28:49,760
maybe vulnerable to some types of file

769
00:28:49,760 --> 00:28:50,960
includes

770
00:28:50,960 --> 00:28:54,960
so let's see if that is indeed the case

771
00:28:54,960 --> 00:28:57,760
uh and yes it looks like they

772
00:28:57,760 --> 00:28:59,360
they are indeed

773
00:28:59,360 --> 00:29:01,279
vulnerable to a local file include let's

774
00:29:01,279 --> 00:29:04,559
see if rfi works

775
00:29:04,880 --> 00:29:07,279
all right

776
00:29:08,559 --> 00:29:10,840
and rfi does indeed

777
00:29:10,840 --> 00:29:14,159
work okay we're running his wwe data

778
00:29:14,159 --> 00:29:16,399
that makes sense you know we knew from

779
00:29:16,399 --> 00:29:20,559
sorry we knew from our nmap scan

780
00:29:20,559 --> 00:29:21,840
that

781
00:29:21,840 --> 00:29:25,200
we are dealing with apache right so

782
00:29:25,200 --> 00:29:26,720
let's try

783
00:29:26,720 --> 00:29:30,960
looking at the standard apache

784
00:29:32,720 --> 00:29:35,600
standard apache directory here and i'm

785
00:29:35,600 --> 00:29:38,000
gonna go

786
00:29:38,559 --> 00:29:40,960
one thing deeper just dead in the

787
00:29:40,960 --> 00:29:42,399
interest of

788
00:29:42,399 --> 00:29:44,719
time

789
00:29:45,440 --> 00:29:47,679
um

790
00:29:47,919 --> 00:29:50,640
oh of course not sorry folks i cannot

791
00:29:50,640 --> 00:29:53,200
talk and type at the same time my brain

792
00:29:53,200 --> 00:29:55,200
considers that to be some sort of stream

793
00:29:55,200 --> 00:29:57,039
crossing operation

794
00:29:57,039 --> 00:29:59,200
and it refuses to let me do it

795
00:29:59,200 --> 00:30:00,480
uh and

796
00:30:00,480 --> 00:30:02,240
i do apologize

797
00:30:02,240 --> 00:30:03,279
but

798
00:30:03,279 --> 00:30:04,399
there we are

799
00:30:04,399 --> 00:30:06,480
okay so

800
00:30:06,480 --> 00:30:08,159
we're just gonna see what's here in this

801
00:30:08,159 --> 00:30:09,840
directory

802
00:30:09,840 --> 00:30:11,440
and

803
00:30:11,440 --> 00:30:13,279
the first thing that jumps out to me is

804
00:30:13,279 --> 00:30:15,360
you've got this dot get subdirectory

805
00:30:15,360 --> 00:30:19,279
right which tells us that this came from

806
00:30:19,279 --> 00:30:21,279
some sort of version control system we

807
00:30:21,279 --> 00:30:24,320
can start asking questions about that

808
00:30:24,320 --> 00:30:26,320
right

809
00:30:26,320 --> 00:30:28,960
so we can see we've got a git server uh

810
00:30:28,960 --> 00:30:30,799
i don't want to belabor

811
00:30:30,799 --> 00:30:32,320
and waste a bunch of time on like how

812
00:30:32,320 --> 00:30:33,760
you would go about it but there are

813
00:30:33,760 --> 00:30:36,320
obviously ways to go out finding what's

814
00:30:36,320 --> 00:30:38,880
there and enumerating that sort of stuff

815
00:30:38,880 --> 00:30:40,240
uh so that you can

816
00:30:40,240 --> 00:30:43,120
can take advantage of it as an attacker

817
00:30:43,120 --> 00:30:45,200
i am uh

818
00:30:45,200 --> 00:30:47,039
i'm gonna take the the lazy man's way

819
00:30:47,039 --> 00:30:49,039
out just kind of hand wave that and i'm

820
00:30:49,039 --> 00:30:50,480
going to say we

821
00:30:50,480 --> 00:30:52,799
magically figured out that there is this

822
00:30:52,799 --> 00:30:54,480
other repo on there that we might have

823
00:30:54,480 --> 00:30:57,039
access to that as you can see from the

824
00:30:57,039 --> 00:30:58,559
name here

825
00:30:58,559 --> 00:31:00,000
purports to be

826
00:31:00,000 --> 00:31:03,360
the production database server

827
00:31:03,360 --> 00:31:04,880
so we're going to clone that

828
00:31:04,880 --> 00:31:07,440
and we are going to

829
00:31:07,440 --> 00:31:08,799
go in

830
00:31:08,799 --> 00:31:11,039
uh

831
00:31:14,240 --> 00:31:17,279
um and again you can see

832
00:31:17,279 --> 00:31:18,960
we've got a couple of interesting things

833
00:31:18,960 --> 00:31:21,840
so let's start by looking at this

834
00:31:21,840 --> 00:31:25,199
start dot essex

835
00:31:28,320 --> 00:31:30,480
all right so

836
00:31:30,480 --> 00:31:33,279
this actually tells us a lot right if we

837
00:31:33,279 --> 00:31:34,960
didn't have it from our nmap scan we've

838
00:31:34,960 --> 00:31:37,360
got an ip address and a port we've got a

839
00:31:37,360 --> 00:31:39,039
password

840
00:31:39,039 --> 00:31:40,240
um

841
00:31:40,240 --> 00:31:41,679
and we've got

842
00:31:41,679 --> 00:31:45,200
sort of this docker command here

843
00:31:45,200 --> 00:31:47,519
um and what this docker command tells us

844
00:31:47,519 --> 00:31:50,399
is that that setup directory that we're

845
00:31:50,399 --> 00:31:52,320
looking at up here

846
00:31:52,320 --> 00:31:55,120
gets mapped into docker dash entry point

847
00:31:55,120 --> 00:31:56,720
dash and it did

848
00:31:56,720 --> 00:31:59,600
init db.d which for those of you not

849
00:31:59,600 --> 00:32:02,240
familiar with docker or sorry mysql

850
00:32:02,240 --> 00:32:04,320
running in a docker container uh

851
00:32:04,320 --> 00:32:06,799
basically means that when we run this

852
00:32:06,799 --> 00:32:10,480
that setup directory gets pushed into

853
00:32:10,480 --> 00:32:12,880
that direct projected essentially into

854
00:32:12,880 --> 00:32:16,000
that directory and mysql will run

855
00:32:16,000 --> 00:32:18,559
whatever scripts are in that directory

856
00:32:18,559 --> 00:32:20,399
when it starts

857
00:32:20,399 --> 00:32:21,279
so

858
00:32:21,279 --> 00:32:22,559
um

859
00:32:22,559 --> 00:32:23,519
let's

860
00:32:23,519 --> 00:32:27,799
see what's in that directory

861
00:32:28,960 --> 00:32:31,440
oh what luck there's just one sql script

862
00:32:31,440 --> 00:32:34,080
so let's go ahead and

863
00:32:34,080 --> 00:32:37,760
look at that as well

864
00:32:38,159 --> 00:32:41,200
and again the typing

865
00:32:41,200 --> 00:32:42,480
uh

866
00:32:42,480 --> 00:32:44,960
okay so here here's the last of the

867
00:32:44,960 --> 00:32:47,039
stuff that we needed right we've got

868
00:32:47,039 --> 00:32:49,919
we've got the password again it matches

869
00:32:49,919 --> 00:32:52,640
we've got a username

870
00:32:52,640 --> 00:32:53,519
uh

871
00:32:53,519 --> 00:32:55,519
we can see the privileges

872
00:32:55,519 --> 00:32:58,240
there are way more of them than it needs

873
00:32:58,240 --> 00:33:00,399
we've got some schema information and

874
00:33:00,399 --> 00:33:01,519
we've got

875
00:33:01,519 --> 00:33:04,080
this data which

876
00:33:04,080 --> 00:33:05,360
you know

877
00:33:05,360 --> 00:33:07,760
meshes with with what we're seeing here

878
00:33:07,760 --> 00:33:08,880
right so

879
00:33:08,880 --> 00:33:10,799
again you know going back to what i was

880
00:33:10,799 --> 00:33:13,039
saying earlier taking my bad guy hat off

881
00:33:13,039 --> 00:33:14,799
for a moment uh going back to what i was

882
00:33:14,799 --> 00:33:16,000
saying earlier right we've got a

883
00:33:16,000 --> 00:33:20,399
decision to make here of sorts um

884
00:33:20,399 --> 00:33:23,840
do we choose to act on this data or not

885
00:33:23,840 --> 00:33:26,880
but it's it's a very tempting target as

886
00:33:26,880 --> 00:33:28,880
an attacker right so

887
00:33:28,880 --> 00:33:32,080
again we're going to want to follow this

888
00:33:32,080 --> 00:33:33,679
chain um

889
00:33:33,679 --> 00:33:35,840
kind of almost have to see where it

890
00:33:35,840 --> 00:33:39,279
leads so if we

891
00:33:39,279 --> 00:33:41,840
uh go ahead and follow that where it

892
00:33:41,840 --> 00:33:43,919
goes

893
00:33:43,919 --> 00:33:45,600
so we already know

894
00:33:45,600 --> 00:33:49,120
from that script that we're using real

895
00:33:49,120 --> 00:33:50,080
db

896
00:33:50,080 --> 00:33:53,279
i was feeling exceptionally lazy

897
00:33:53,279 --> 00:33:54,960
today

898
00:33:54,960 --> 00:33:56,320
well not exceptionally lazy

899
00:33:56,320 --> 00:33:58,080
exceptionally uncreative let's say that

900
00:33:58,080 --> 00:33:59,919
i couldn't think of a good

901
00:33:59,919 --> 00:34:02,080
database name so

902
00:34:02,080 --> 00:34:04,399
so we run show tables here we can see

903
00:34:04,399 --> 00:34:07,200
we've got a table uh i'm gonna start

904
00:34:07,200 --> 00:34:10,480
to do copy pasting here because

905
00:34:10,480 --> 00:34:13,040
like i wasted a bunch of time scripting

906
00:34:13,040 --> 00:34:15,280
out all these commands i wanted to run

907
00:34:15,280 --> 00:34:16,800
and i'm sitting here typing things even

908
00:34:16,800 --> 00:34:18,239
though i know i can't type and talk at

909
00:34:18,239 --> 00:34:20,239
the same time

910
00:34:20,239 --> 00:34:22,159
who am i trying to get

911
00:34:22,159 --> 00:34:24,320
um

912
00:34:24,320 --> 00:34:26,399
so

913
00:34:26,399 --> 00:34:28,800
and again we see the data that matches

914
00:34:28,800 --> 00:34:30,639
conveniently right there behind if if

915
00:34:30,639 --> 00:34:32,879
you can read through that i can't i'm

916
00:34:32,879 --> 00:34:36,639
nearly blind so let's go ahead and and

917
00:34:36,639 --> 00:34:38,079
you know take this to our logical

918
00:34:38,079 --> 00:34:40,639
conclusion

919
00:34:41,918 --> 00:34:43,760
all right so we've updated four rows

920
00:34:43,760 --> 00:34:46,560
let's just double check that data

921
00:34:46,560 --> 00:34:48,719
i didn't i didn't plan this this way but

922
00:34:48,719 --> 00:34:50,560
this is real pwned it's

923
00:34:50,560 --> 00:34:53,918
pretty funny um somebody wants a poem

924
00:34:53,918 --> 00:34:55,918
pretty happy with how that came out

925
00:34:55,918 --> 00:34:57,040
um

926
00:34:57,040 --> 00:34:58,320
okay

927
00:34:58,320 --> 00:34:59,440
so like

928
00:34:59,440 --> 00:35:01,680
at this point as an attacker you know

929
00:35:01,680 --> 00:35:03,280
we're we're starting to do our happy

930
00:35:03,280 --> 00:35:05,119
dance we're starting to feel like we've

931
00:35:05,119 --> 00:35:07,359
won

932
00:35:08,320 --> 00:35:10,079
pardon me for a moment

933
00:35:10,079 --> 00:35:13,040
right so like the last thing we kind of

934
00:35:13,040 --> 00:35:14,880
have to do before we just

935
00:35:14,880 --> 00:35:17,280
break out the old the old mission

936
00:35:17,280 --> 00:35:19,440
accomplished banner let's just go back

937
00:35:19,440 --> 00:35:22,320
over here refresh this guy and

938
00:35:22,320 --> 00:35:23,680
wait

939
00:35:23,680 --> 00:35:25,680
nothing has changed

940
00:35:25,680 --> 00:35:27,680
and i can do this all day

941
00:35:27,680 --> 00:35:29,200
um

942
00:35:29,200 --> 00:35:31,599
nothing has changed so now again

943
00:35:31,599 --> 00:35:33,359
remember we we had these different

944
00:35:33,359 --> 00:35:36,079
decision points do do i go after this

945
00:35:36,079 --> 00:35:38,960
demo server i get this information from

946
00:35:38,960 --> 00:35:39,760
git

947
00:35:39,760 --> 00:35:41,680
do you know trust this information

948
00:35:41,680 --> 00:35:43,599
following it what does it mean we have

949
00:35:43,599 --> 00:35:45,680
to go back and rethink all of those

950
00:35:45,680 --> 00:35:47,520
things

951
00:35:47,520 --> 00:35:50,640
okay so uh one last thing before i go

952
00:35:50,640 --> 00:35:51,440
back

953
00:35:51,440 --> 00:35:53,680
and

954
00:35:54,720 --> 00:35:57,520
sort of explain how all this happened is

955
00:35:57,520 --> 00:35:59,280
remember when we

956
00:35:59,280 --> 00:36:01,280
very very first started first thing i

957
00:36:01,280 --> 00:36:02,240
did

958
00:36:02,240 --> 00:36:04,720
right is i went over here to this

959
00:36:04,720 --> 00:36:06,480
particular window

960
00:36:06,480 --> 00:36:08,240
and i told you i was going to run tcp

961
00:36:08,240 --> 00:36:11,040
dump and then i was running it on

962
00:36:11,040 --> 00:36:12,560
the host

963
00:36:12,560 --> 00:36:17,200
that was hosting that machine okay

964
00:36:18,000 --> 00:36:19,760
um

965
00:36:19,760 --> 00:36:23,440
there are no entries in this tcp dump

966
00:36:23,440 --> 00:36:27,839
there are no entries in this tcp dump

967
00:36:28,400 --> 00:36:30,160
when i put my bad guy hat on and i

968
00:36:30,160 --> 00:36:31,839
thought i was talking to that server i

969
00:36:31,839 --> 00:36:34,079
was never talking to that server

970
00:36:34,079 --> 00:36:36,800
and the proof of that

971
00:36:36,800 --> 00:36:39,119
unless you're tempted to be skeptical of

972
00:36:39,119 --> 00:36:41,200
me as you should be because once again i

973
00:36:41,200 --> 00:36:43,119
told you up front that you know i was

974
00:36:43,119 --> 00:36:44,800
going to try and deceive you

975
00:36:44,800 --> 00:36:47,200
there when i refresh over here you can

976
00:36:47,200 --> 00:36:49,920
see i'm getting these entries

977
00:36:49,920 --> 00:36:51,359
um

978
00:36:51,359 --> 00:36:52,720
so

979
00:36:52,720 --> 00:36:55,839
that being said let's let's go back and

980
00:36:55,839 --> 00:36:57,440
we'll talk about

981
00:36:57,440 --> 00:36:59,839
how that happened uh because

982
00:36:59,839 --> 00:37:03,280
i'm actually under the hood playing

983
00:37:03,280 --> 00:37:05,280
some very cool tricks at least in my

984
00:37:05,280 --> 00:37:06,320
opinion

985
00:37:06,320 --> 00:37:07,520
all right

986
00:37:07,520 --> 00:37:08,480
so

987
00:37:08,480 --> 00:37:10,480
first off this is what the network

988
00:37:10,480 --> 00:37:13,200
actually looks like um i told you that i

989
00:37:13,200 --> 00:37:15,440
wasn't being totally up front if you did

990
00:37:15,440 --> 00:37:18,400
trust me it was foolish of you

991
00:37:18,400 --> 00:37:22,000
um you should never have trusted me

992
00:37:22,000 --> 00:37:24,240
so as you can see we've got this ovs

993
00:37:24,240 --> 00:37:27,040
bridge here it's being run by pipette

994
00:37:27,040 --> 00:37:29,920
and i've got the decoy demo server and a

995
00:37:29,920 --> 00:37:31,920
different database server here and we're

996
00:37:31,920 --> 00:37:33,520
going to talk through sort of the

997
00:37:33,520 --> 00:37:35,280
ramifications of both of those and the

998
00:37:35,280 --> 00:37:37,440
way they get used here because they

999
00:37:37,440 --> 00:37:38,960
they're actually two very different

1000
00:37:38,960 --> 00:37:41,280
things

1001
00:37:41,839 --> 00:37:42,880
um

1002
00:37:42,880 --> 00:37:44,240
so

1003
00:37:44,240 --> 00:37:46,480
the way i did this is again two

1004
00:37:46,480 --> 00:37:47,920
different demo servers right the

1005
00:37:47,920 --> 00:37:49,920
legitimate user gets to interact with

1006
00:37:49,920 --> 00:37:52,560
this the attacker never does the

1007
00:37:52,560 --> 00:37:54,320
attacker is talking to something else

1008
00:37:54,320 --> 00:37:57,119
entirely okay and the thing that they're

1009
00:37:57,119 --> 00:37:58,240
talking to

1010
00:37:58,240 --> 00:37:59,200
exists

1011
00:37:59,200 --> 00:38:01,760
over here hanging off of this ovs bridge

1012
00:38:01,760 --> 00:38:03,520
this is the this is the place they get

1013
00:38:03,520 --> 00:38:05,119
to go when they think they're going to

1014
00:38:05,119 --> 00:38:08,640
talk to this right um

1015
00:38:08,640 --> 00:38:09,839
you know i've run through a couple of

1016
00:38:09,839 --> 00:38:11,760
the differences here but

1017
00:38:11,760 --> 00:38:13,280
you know i think i've kind of talked

1018
00:38:13,280 --> 00:38:15,920
through that a bit anyhow so uh

1019
00:38:15,920 --> 00:38:18,480
so i mean it seems like

1020
00:38:18,480 --> 00:38:20,000
it's a whole other web server it should

1021
00:38:20,000 --> 00:38:21,680
be obvious that you're running two web

1022
00:38:21,680 --> 00:38:22,640
servers

1023
00:38:22,640 --> 00:38:24,240
but because of the way this works it's

1024
00:38:24,240 --> 00:38:26,880
actually really not uh one as i said

1025
00:38:26,880 --> 00:38:29,280
earlier that switchboard is output only

1026
00:38:29,280 --> 00:38:31,280
so it doesn't participate in things like

1027
00:38:31,280 --> 00:38:33,280
arp traffic or any kind of broadcast to

1028
00:38:33,280 --> 00:38:35,760
go on on the network

1029
00:38:35,760 --> 00:38:38,000
the other thing is um think about the

1030
00:38:38,000 --> 00:38:39,920
way a network scan works right when

1031
00:38:39,920 --> 00:38:41,839
you're running nmap or you know if you

1032
00:38:41,839 --> 00:38:43,680
run something through bash or python or

1033
00:38:43,680 --> 00:38:45,359
however you want to do your network

1034
00:38:45,359 --> 00:38:47,280
scans

1035
00:38:47,280 --> 00:38:49,440
you have to talk to that machine on that

1036
00:38:49,440 --> 00:38:52,320
port that scan traffic also goes through

1037
00:38:52,320 --> 00:38:54,160
the code processor right when i ran the

1038
00:38:54,160 --> 00:38:58,160
nmap scan it presented as an apache http

1039
00:38:58,160 --> 00:39:00,240
server and that's because i'm running an

1040
00:39:00,240 --> 00:39:03,280
apache http server on on the

1041
00:39:03,280 --> 00:39:05,359
co-processor in point of fact if you

1042
00:39:05,359 --> 00:39:08,000
were to go back and look at uh the

1043
00:39:08,000 --> 00:39:09,599
information coming off of the legitimate

1044
00:39:09,599 --> 00:39:11,280
web server you'd see under the hood that

1045
00:39:11,280 --> 00:39:13,119
i'm running in nginx box which is going

1046
00:39:13,119 --> 00:39:15,040
to present completely differently

1047
00:39:15,040 --> 00:39:16,000
um

1048
00:39:16,000 --> 00:39:17,119
so

1049
00:39:17,119 --> 00:39:19,520
right there i mean i've presented two

1050
00:39:19,520 --> 00:39:23,359
wildly differing views of the world from

1051
00:39:23,359 --> 00:39:24,800
the same box

1052
00:39:24,800 --> 00:39:28,000
you know apparently from the same box um

1053
00:39:28,000 --> 00:39:30,079
these are really really powerful from

1054
00:39:30,079 --> 00:39:33,359
from a deception standpoint

1055
00:39:34,160 --> 00:39:36,640
the databases actually work entirely

1056
00:39:36,640 --> 00:39:39,040
differently so what i did with the

1057
00:39:39,040 --> 00:39:41,839
database almost the exact opposite thing

1058
00:39:41,839 --> 00:39:43,839
right i made the command decision that

1059
00:39:43,839 --> 00:39:45,680
hey we've got this server that's serving

1060
00:39:45,680 --> 00:39:47,920
up data and because of its job it needs

1061
00:39:47,920 --> 00:39:49,760
to talk to the database

1062
00:39:49,760 --> 00:39:51,839
so i've set the apple up so the only

1063
00:39:51,839 --> 00:39:55,119
things that need to talk to the database

1064
00:39:55,119 --> 00:39:57,200
can talk to the real database right

1065
00:39:57,200 --> 00:39:59,599
everybody else goes to the fake database

1066
00:39:59,599 --> 00:40:00,880
server

1067
00:40:00,880 --> 00:40:03,200
so a couple of cool things about this

1068
00:40:03,200 --> 00:40:04,240
well

1069
00:40:04,240 --> 00:40:06,000
my favorite thing about this i think

1070
00:40:06,000 --> 00:40:07,440
it's super cool

1071
00:40:07,440 --> 00:40:08,839
okay

1072
00:40:08,839 --> 00:40:12,079
so when i was a dba every time i had you

1073
00:40:12,079 --> 00:40:14,079
know a job where i was in charge of

1074
00:40:14,079 --> 00:40:16,960
manning managing a database of any sort

1075
00:40:16,960 --> 00:40:19,240
the thing that i absolutely

1076
00:40:19,240 --> 00:40:20,800
positively

1077
00:40:20,800 --> 00:40:23,760
100 lived in fear of was sort of like

1078
00:40:23,760 --> 00:40:25,920
the whoops update right and we've all

1079
00:40:25,920 --> 00:40:26,960
done it

1080
00:40:26,960 --> 00:40:28,880
um many of us have had it happen to us

1081
00:40:28,880 --> 00:40:30,720
right but it happens a ton of different

1082
00:40:30,720 --> 00:40:33,520
ways i was logged into the wrong thing i

1083
00:40:33,520 --> 00:40:35,280
had the wrong connection string i was

1084
00:40:35,280 --> 00:40:37,680
misconfigured and you know it happens

1085
00:40:37,680 --> 00:40:40,240
but it wrecks somebody's day

1086
00:40:40,240 --> 00:40:42,480
what i've done here actually stacks the

1087
00:40:42,480 --> 00:40:46,319
odds massively massively in your favor

1088
00:40:46,319 --> 00:40:47,920
because not only

1089
00:40:47,920 --> 00:40:50,319
to to do the accidental update now

1090
00:40:50,319 --> 00:40:52,720
somebody not only has to do the wrong

1091
00:40:52,720 --> 00:40:54,400
thing but they have to do the wrong

1092
00:40:54,400 --> 00:40:57,119
thing from the exact right spot in the

1093
00:40:57,119 --> 00:41:00,000
network right so we can really really

1094
00:41:00,000 --> 00:41:02,400
make our database much more secure much

1095
00:41:02,400 --> 00:41:04,560
more walled off and we get this nice

1096
00:41:04,560 --> 00:41:06,560
little deception ploy off to the side

1097
00:41:06,560 --> 00:41:09,040
for free well for the low low price of

1098
00:41:09,040 --> 00:41:12,720
one extra docker container right

1099
00:41:15,680 --> 00:41:18,240
uh so i mean i'm sure you guys have

1100
00:41:18,240 --> 00:41:19,920
questions about the effectiveness of

1101
00:41:19,920 --> 00:41:21,839
this um so i'm going to give you just

1102
00:41:21,839 --> 00:41:23,440
kind of a couple of data points about

1103
00:41:23,440 --> 00:41:24,400
that

1104
00:41:24,400 --> 00:41:26,880
those are logical questions to ask uh if

1105
00:41:26,880 --> 00:41:29,200
you look here this

1106
00:41:29,200 --> 00:41:32,319
this is you know an ip listing coming

1107
00:41:32,319 --> 00:41:33,520
out of

1108
00:41:33,520 --> 00:41:35,839
the

1109
00:41:36,000 --> 00:41:38,480
the uh

1110
00:41:39,280 --> 00:41:42,000
fake database server right you can see

1111
00:41:42,000 --> 00:41:44,720
it's got its address and mac here

1112
00:41:44,720 --> 00:41:48,800
this is a tcp dump running from on

1113
00:41:48,800 --> 00:41:51,520
that server

1114
00:41:51,599 --> 00:41:53,839
and you can see that

1115
00:41:53,839 --> 00:41:57,040
these these mac addresses match up and

1116
00:41:57,040 --> 00:41:58,400
so what we're actually doing under the

1117
00:41:58,400 --> 00:42:00,079
hood

1118
00:42:00,079 --> 00:42:01,760
is we're doing

1119
00:42:01,760 --> 00:42:03,760
nat at l2

1120
00:42:03,760 --> 00:42:04,960
so

1121
00:42:04,960 --> 00:42:08,319
you've got a packet it's got it's

1122
00:42:08,319 --> 00:42:11,119
source ip and source mac it comes into

1123
00:42:11,119 --> 00:42:15,280
the co-processor the coprocessor so

1124
00:42:15,280 --> 00:42:18,079
grabs that source ip and source mac

1125
00:42:18,079 --> 00:42:20,800
stores them off to the side

1126
00:42:20,800 --> 00:42:21,839
okay

1127
00:42:21,839 --> 00:42:24,319
gives them the

1128
00:42:24,319 --> 00:42:26,079
sorry it's got its destination ip

1129
00:42:26,079 --> 00:42:28,640
destination mac right

1130
00:42:28,640 --> 00:42:30,480
where it's going okay

1131
00:42:30,480 --> 00:42:32,480
so

1132
00:42:32,480 --> 00:42:33,760
um

1133
00:42:33,760 --> 00:42:34,560
the

1134
00:42:34,560 --> 00:42:36,640
pipette grabs the destination ip

1135
00:42:36,640 --> 00:42:38,800
destination mac sticks them off to the

1136
00:42:38,800 --> 00:42:41,200
side replaces them with the appropriate

1137
00:42:41,200 --> 00:42:43,680
destination ip and destination mac for

1138
00:42:43,680 --> 00:42:44,880
where it should be going in the

1139
00:42:44,880 --> 00:42:46,640
co-processed network

1140
00:42:46,640 --> 00:42:48,800
the co-processor does its thing sends

1141
00:42:48,800 --> 00:42:51,280
its response back out pipette grabs that

1142
00:42:51,280 --> 00:42:54,640
response pulls its source ip and source

1143
00:42:54,640 --> 00:42:57,119
mac off replaces them with the ones it

1144
00:42:57,119 --> 00:42:59,520
got coming in and sends it back to the

1145
00:42:59,520 --> 00:43:01,760
original source right so we're swapping

1146
00:43:01,760 --> 00:43:06,000
those in and out uh at line speed

1147
00:43:06,000 --> 00:43:06,960
uh

1148
00:43:06,960 --> 00:43:08,319
which is

1149
00:43:08,319 --> 00:43:10,000
frankly incredible that we can manage to

1150
00:43:10,000 --> 00:43:11,520
do it um

1151
00:43:11,520 --> 00:43:14,000
but as as sort of one anecdotal data

1152
00:43:14,000 --> 00:43:15,599
point uh

1153
00:43:15,599 --> 00:43:18,000
our team uh actually my buddies charlie

1154
00:43:18,000 --> 00:43:19,920
and josh we're we're running our

1155
00:43:19,920 --> 00:43:21,599
internal blue team we're doing some red

1156
00:43:21,599 --> 00:43:23,359
team blue team stuff on some open source

1157
00:43:23,359 --> 00:43:24,480
5g

1158
00:43:24,480 --> 00:43:26,319
uh things for for an internal project

1159
00:43:26,319 --> 00:43:27,440
that we're doing

1160
00:43:27,440 --> 00:43:29,920
um and i was the red team

1161
00:43:29,920 --> 00:43:31,599
and i i knew

1162
00:43:31,599 --> 00:43:33,599
right i knew ahead of time that this was

1163
00:43:33,599 --> 00:43:35,200
a thing that they

1164
00:43:35,200 --> 00:43:37,359
could do and knew how to do that they

1165
00:43:37,359 --> 00:43:38,800
wanted to do and that they were going to

1166
00:43:38,800 --> 00:43:40,800
actively try to do to quite frankly

1167
00:43:40,800 --> 00:43:42,560
embarrass me because you know they're my

1168
00:43:42,560 --> 00:43:44,880
buddies that's what they do um plus

1169
00:43:44,880 --> 00:43:47,280
we're competitive right

1170
00:43:47,280 --> 00:43:48,640
like i know at the end of the day we're

1171
00:43:48,640 --> 00:43:50,079
all on the same team but there's still

1172
00:43:50,079 --> 00:43:51,920
that like i kind of want to win

1173
00:43:51,920 --> 00:43:53,040
thing

1174
00:43:53,040 --> 00:43:55,760
it happens um and they were able to fool

1175
00:43:55,760 --> 00:43:57,359
me with it even though i was looking for

1176
00:43:57,359 --> 00:43:58,880
it every step of the way like i was

1177
00:43:58,880 --> 00:44:00,880
trying to watch for it i knew it was

1178
00:44:00,880 --> 00:44:03,520
coming and they still got me and i was

1179
00:44:03,520 --> 00:44:05,440
like happy and mad at the same time

1180
00:44:05,440 --> 00:44:06,839
because it was like yes it works but

1181
00:44:06,839 --> 00:44:12,000
also they win crap you know so um

1182
00:44:12,000 --> 00:44:13,599
that was fun

1183
00:44:13,599 --> 00:44:15,119
um

1184
00:44:15,119 --> 00:44:18,160
so just kind of to recap uh what we did

1185
00:44:18,160 --> 00:44:20,160
here with software defined networking

1186
00:44:20,160 --> 00:44:22,000
and poseidon and this whole raft of

1187
00:44:22,000 --> 00:44:24,240
other tools here uh we were able to

1188
00:44:24,240 --> 00:44:26,480
configure a network

1189
00:44:26,480 --> 00:44:29,599
check the behavior on it uh in real time

1190
00:44:29,599 --> 00:44:31,760
react to that behavior

1191
00:44:31,760 --> 00:44:33,920
and then implement these really

1192
00:44:33,920 --> 00:44:37,200
uh unusual and sophisticated deceptive

1193
00:44:37,200 --> 00:44:39,520
measures and protective measures

1194
00:44:39,520 --> 00:44:41,040
um

1195
00:44:41,040 --> 00:44:43,680
without a whole lot of overhead

1196
00:44:43,680 --> 00:44:44,960
um

1197
00:44:44,960 --> 00:44:46,640
so that that being said i would be

1198
00:44:46,640 --> 00:44:49,280
remiss a if i didn't kind of shout out

1199
00:44:49,280 --> 00:44:51,200
all the different open source projects

1200
00:44:51,200 --> 00:44:53,520
that i made use of to make this happen

1201
00:44:53,520 --> 00:44:55,680
um there's a lot of really great people

1202
00:44:55,680 --> 00:44:57,920
doing a lot of really great work that

1203
00:44:57,920 --> 00:45:00,880
makes this stuff possible uh i also have

1204
00:45:00,880 --> 00:45:03,119
to give you know huge huge huge thanks

1205
00:45:03,119 --> 00:45:04,960
to my teammates charlie lewis and josh

1206
00:45:04,960 --> 00:45:06,319
bailey you've heard me mention them a

1207
00:45:06,319 --> 00:45:08,079
couple times already um they're

1208
00:45:08,079 --> 00:45:10,960
fantastic engineers fantastic people i

1209
00:45:10,960 --> 00:45:13,440
cannot cannot speak highly enough of

1210
00:45:13,440 --> 00:45:14,480
them

1211
00:45:14,480 --> 00:45:15,680
um

1212
00:45:15,680 --> 00:45:16,640
and so

1213
00:45:16,640 --> 00:45:17,599
you know

1214
00:45:17,599 --> 00:45:20,160
with that being said um first off thank

1215
00:45:20,160 --> 00:45:22,960
all of you for coming you know i know i

1216
00:45:22,960 --> 00:45:25,440
know you have a lot of other options and

1217
00:45:25,440 --> 00:45:27,440
places that you could be you could be

1218
00:45:27,440 --> 00:45:28,720
over on the other channel listening to

1219
00:45:28,720 --> 00:45:30,720
alyssa miller so just let me know how

1220
00:45:30,720 --> 00:45:33,119
much my mom paid you um so that i would

1221
00:45:33,119 --> 00:45:34,480
feel good about myself so i know how

1222
00:45:34,480 --> 00:45:37,040
guilty to feel next time i visit her um

1223
00:45:37,040 --> 00:45:40,960
but yeah if anybody has any questions

1224
00:45:45,200 --> 00:45:47,760
off my discord thing over here to see

1225
00:45:47,760 --> 00:45:51,560
if there are any questions

1226
00:46:18,640 --> 00:46:19,760
uh

1227
00:46:19,760 --> 00:46:21,839
okay so

1228
00:46:21,839 --> 00:46:24,839
um

1229
00:46:29,440 --> 00:46:31,440
uh let's see

1230
00:46:31,440 --> 00:46:33,280
uh the one question i'm seeing is what

1231
00:46:33,280 --> 00:46:35,359
was the hardest thing

1232
00:46:35,359 --> 00:46:39,359
for me to learn in regards to sdn

1233
00:46:39,359 --> 00:46:40,319
uh

1234
00:46:40,319 --> 00:46:43,319
so

1235
00:46:44,560 --> 00:46:48,079
i would say that the debugging sdn is is

1236
00:46:48,079 --> 00:46:51,040
kind of a unique and interesting thing

1237
00:46:51,040 --> 00:46:52,400
that's that's probably a little

1238
00:46:52,400 --> 00:46:54,480
different than um

1239
00:46:54,480 --> 00:46:58,079
an ordinary network now admittedly my my

1240
00:46:58,079 --> 00:46:59,280
experience with with

1241
00:46:59,280 --> 00:47:01,520
non-software-defined networks is more

1242
00:47:01,520 --> 00:47:03,440
limited but

1243
00:47:03,440 --> 00:47:07,040
uh i you know basically like debugging

1244
00:47:07,040 --> 00:47:09,760
those is you plug things in you trace

1245
00:47:09,760 --> 00:47:13,200
some cables you run some tcp dumps some

1246
00:47:13,200 --> 00:47:16,640
trace routes some pings

1247
00:47:17,200 --> 00:47:19,839
with a software-defined networking

1248
00:47:19,839 --> 00:47:21,200
debugging

1249
00:47:21,200 --> 00:47:23,520
becomes more complicated because you've

1250
00:47:23,520 --> 00:47:25,280
added like this extra layer of

1251
00:47:25,280 --> 00:47:27,200
abstraction right

1252
00:47:27,200 --> 00:47:29,680
you've got to

1253
00:47:29,680 --> 00:47:31,680
you know is my switch talking to my

1254
00:47:31,680 --> 00:47:33,599
controller correctly

1255
00:47:33,599 --> 00:47:36,559
is my configuration correct is that

1256
00:47:36,559 --> 00:47:39,839
being translated into flow table entries

1257
00:47:39,839 --> 00:47:41,920
the way that i think it is

1258
00:47:41,920 --> 00:47:43,680
uh it's

1259
00:47:43,680 --> 00:47:45,839
it's just a more drawn out debugging

1260
00:47:45,839 --> 00:47:46,800
loop

1261
00:47:46,800 --> 00:47:50,079
in my opinion so

1262
00:47:50,480 --> 00:47:54,319
that's that's probably what i would say

1263
00:47:56,640 --> 00:48:00,118
any other questions

1264
00:48:16,000 --> 00:48:18,480
all right i see somebody at least loves

1265
00:48:18,480 --> 00:48:21,200
the ammo um

1266
00:48:21,200 --> 00:48:22,880
all right um

1267
00:48:22,880 --> 00:48:25,440
okay again thank you guys for for taking

1268
00:48:25,440 --> 00:48:27,599
the time to come and listen and you know

1269
00:48:27,599 --> 00:48:29,280
if if you have any questions that didn't

1270
00:48:29,280 --> 00:48:30,559
make it into here or you think of

1271
00:48:30,559 --> 00:48:33,359
questions later uh feel free to to look

1272
00:48:33,359 --> 00:48:36,000
me up on discord um

1273
00:48:36,000 --> 00:48:40,079
and i probably could go back and like

1274
00:48:40,079 --> 00:48:42,079
slide here somewhere i have my discord

1275
00:48:42,079 --> 00:48:44,559
username

1276
00:48:44,640 --> 00:48:46,240
so yeah um

1277
00:48:46,240 --> 00:48:48,079
this birdwinger that's me here on

1278
00:48:48,079 --> 00:48:50,000
discord and on twitter if you think of

1279
00:48:50,000 --> 00:48:51,760
questions about this later

1280
00:48:51,760 --> 00:48:55,040
um or you want to talk about sdn

1281
00:48:55,040 --> 00:48:58,440
thank you guys

