1
00:00:03,919 --> 00:00:06,879
so

2
00:00:05,040 --> 00:00:08,400
thanks everybody i'm actually really

3
00:00:06,879 --> 00:00:11,759
happy to be here today and

4
00:00:08,400 --> 00:00:14,240
share this with you this is the

5
00:00:11,759 --> 00:00:16,320
story of something that i encountered

6
00:00:14,240 --> 00:00:18,640
which almost seems like it's

7
00:00:16,320 --> 00:00:19,600
too ridiculous to be true but i can

8
00:00:18,640 --> 00:00:23,119
assure you

9
00:00:19,600 --> 00:00:25,680
i have not made up any of this

10
00:00:23,119 --> 00:00:26,720
so i am going to begin by first

11
00:00:25,680 --> 00:00:31,279
introducing

12
00:00:26,720 --> 00:00:34,079
myself so i am ash wolfe i go by nemji

13
00:00:31,279 --> 00:00:34,079
online usually

14
00:00:34,320 --> 00:00:38,559
i was born in gibraltar i've been living

15
00:00:36,559 --> 00:00:39,360
in scotland for the past few and a half

16
00:00:38,559 --> 00:00:41,680
years

17
00:00:39,360 --> 00:00:43,280
i've been doing different kinds of

18
00:00:41,680 --> 00:00:44,320
programming and reverse engineering to

19
00:00:43,280 --> 00:00:46,879
some extent

20
00:00:44,320 --> 00:00:48,239
for about 16 years now i mean i started

21
00:00:46,879 --> 00:00:51,519
with like

22
00:00:48,239 --> 00:00:55,120
really basic stuff and

23
00:00:51,520 --> 00:00:56,320
now i'm actually not like semi-decent at

24
00:00:55,120 --> 00:00:59,120
it

25
00:00:56,320 --> 00:01:02,480
i did a few years in game development

26
00:00:59,120 --> 00:01:04,640
for a small social mmo i

27
00:01:02,480 --> 00:01:06,399
i'm currently in my last year of a

28
00:01:04,640 --> 00:01:08,000
degree at strathclyde's doing computer

29
00:01:06,400 --> 00:01:10,799
science

30
00:01:08,000 --> 00:01:11,760
and to just to give you a bit more of an

31
00:01:10,799 --> 00:01:13,600
idea of the

32
00:01:11,760 --> 00:01:15,360
the things i like and how i got into

33
00:01:13,600 --> 00:01:17,119
this whole mess

34
00:01:15,360 --> 00:01:19,600
there's some things i really like public

35
00:01:17,119 --> 00:01:22,080
transit graphic design

36
00:01:19,600 --> 00:01:23,119
weird old mobile tech and old operating

37
00:01:22,080 --> 00:01:25,439
systems

38
00:01:23,119 --> 00:01:28,799
i have an awful sense of humor so you

39
00:01:25,439 --> 00:01:30,960
will see a bit of that in this talk

40
00:01:28,799 --> 00:01:32,159
but i'm not gonna dwell too much on

41
00:01:30,960 --> 00:01:35,199
myself i'm

42
00:01:32,159 --> 00:01:37,200
gonna start introducing some of this

43
00:01:35,200 --> 00:01:42,320
weirdness

44
00:01:37,200 --> 00:01:45,200
so i have an absolute awful weakness for

45
00:01:42,320 --> 00:01:48,079
like weird niche mobile tech things like

46
00:01:45,200 --> 00:01:49,600
old pdas

47
00:01:48,079 --> 00:01:51,679
like the sort of things you see where

48
00:01:49,600 --> 00:01:53,360
it's like who would actually buy this

49
00:01:51,680 --> 00:01:56,640
who would actually use this in the year

50
00:01:53,360 --> 00:01:59,039
of our luigi 2020

51
00:01:56,640 --> 00:02:00,799
so as it turns out i was looking through

52
00:01:59,040 --> 00:02:03,200
twitter on

53
00:02:00,799 --> 00:02:05,200
on a nice day in november 2018 while

54
00:02:03,200 --> 00:02:08,800
traveling in london when i came across a

55
00:02:05,200 --> 00:02:13,200
very interesting proposition

56
00:02:08,800 --> 00:02:15,200
so imagine this the scion series 5 a pda

57
00:02:13,200 --> 00:02:18,560
from the 90s

58
00:02:15,200 --> 00:02:21,839
imagine if you combine that with a phone

59
00:02:18,560 --> 00:02:25,120
and then you had like 20 years worth of

60
00:02:21,840 --> 00:02:30,640
progress added on to that

61
00:02:25,120 --> 00:02:30,640
and well this is what i found online

62
00:02:32,720 --> 00:02:36,030
you might have actually seen me using

63
00:02:34,160 --> 00:02:37,760
this around the conference today

64
00:02:36,030 --> 00:02:41,519
[Music]

65
00:02:37,760 --> 00:02:42,000
so this is one of these like really

66
00:02:41,519 --> 00:02:45,280
weird

67
00:02:42,000 --> 00:02:47,360
niche android devices as you may

68
00:02:45,280 --> 00:02:49,360
be painfully aware one of the great

69
00:02:47,360 --> 00:02:50,959
things about android is that any company

70
00:02:49,360 --> 00:02:52,800
can build an android device

71
00:02:50,959 --> 00:02:54,560
and this is also one of the worst things

72
00:02:52,800 --> 00:02:56,239
about android because it means that

73
00:02:54,560 --> 00:02:58,480
you get all of these really weird things

74
00:02:56,239 --> 00:03:02,080
with like awful security

75
00:02:58,480 --> 00:03:03,599
awful software no no control whatsoever

76
00:03:02,080 --> 00:03:05,120
you get these weird form factors that

77
00:03:03,599 --> 00:03:07,518
don't work with half of the apps you

78
00:03:05,120 --> 00:03:09,360
downloads

79
00:03:07,519 --> 00:03:11,040
but yeah i'm just going to describe a

80
00:03:09,360 --> 00:03:12,959
bit more about this thing so you know

81
00:03:11,040 --> 00:03:15,200
where i'm starting from

82
00:03:12,959 --> 00:03:16,159
so it's an android device designed by

83
00:03:15,200 --> 00:03:17,679
this small

84
00:03:16,159 --> 00:03:19,519
startup in london called planet

85
00:03:17,680 --> 00:03:22,400
computers

86
00:03:19,519 --> 00:03:24,319
and since it's not really practical for

87
00:03:22,400 --> 00:03:26,400
a small company like this to

88
00:03:24,319 --> 00:03:28,238
manufacture an android device by

89
00:03:26,400 --> 00:03:30,720
themselves

90
00:03:28,239 --> 00:03:32,959
they partnered up with a company in

91
00:03:30,720 --> 00:03:35,440
china called eastern

92
00:03:32,959 --> 00:03:37,519
this is an odm or original device

93
00:03:35,440 --> 00:03:38,959
manufacturer so

94
00:03:37,519 --> 00:03:41,360
they're responsible for some of the

95
00:03:38,959 --> 00:03:42,640
hardware design things like

96
00:03:41,360 --> 00:03:44,879
building the boards they have their

97
00:03:42,640 --> 00:03:46,879
factory and they built this

98
00:03:44,879 --> 00:03:48,399
they also seem to have done a lot of the

99
00:03:46,879 --> 00:03:50,720
work on developing the firmware that

100
00:03:48,400 --> 00:03:53,280
runs on this device

101
00:03:50,720 --> 00:03:54,959
so even though it's all marketed and

102
00:03:53,280 --> 00:03:57,200
sold by planets this is kind of a group

103
00:03:54,959 --> 00:04:01,200
effort between them

104
00:03:57,200 --> 00:04:02,000
and so just to give you an idea of the

105
00:04:01,200 --> 00:04:04,079
timeline

106
00:04:02,000 --> 00:04:06,480
they launched the indiegogo campaign for

107
00:04:04,080 --> 00:04:07,680
this in november of 2018.

108
00:04:06,480 --> 00:04:10,238
they claimed they were going to ship

109
00:04:07,680 --> 00:04:13,599
them in may 2019

110
00:04:10,239 --> 00:04:16,320
but it there were delays things happened

111
00:04:13,599 --> 00:04:16,719
and they finally shipped the first ones

112
00:04:16,320 --> 00:04:19,599
in

113
00:04:16,720 --> 00:04:20,959
november 2019 out of a batch of about

114
00:04:19,600 --> 00:04:23,120
four thousand

115
00:04:20,959 --> 00:04:25,520
which i think they are now almost done

116
00:04:23,120 --> 00:04:25,520
shipping

117
00:04:25,840 --> 00:04:29,679
there have been a lot of manufacturing

118
00:04:27,520 --> 00:04:30,240
delays and so many indiegogo updates

119
00:04:29,680 --> 00:04:33,199
just

120
00:04:30,240 --> 00:04:35,600
throwing the factory as they call easter

121
00:04:33,199 --> 00:04:38,080
under the bus

122
00:04:35,600 --> 00:04:39,759
so a bit more of an overview on what's

123
00:04:38,080 --> 00:04:42,800
actually on this device

124
00:04:39,759 --> 00:04:45,280
it's got valley standards hardware

125
00:04:42,800 --> 00:04:48,080
for these like niche low budget devices

126
00:04:45,280 --> 00:04:49,599
it's a mediatek soc because

127
00:04:48,080 --> 00:04:52,800
they're not cool enough for qualcomm

128
00:04:49,600 --> 00:04:54,960
snapdragon they make up for it a bit by

129
00:04:52,800 --> 00:04:56,479
having a lot of ram and a lot of flash

130
00:04:54,960 --> 00:04:59,120
it's got these weird

131
00:04:56,479 --> 00:05:00,240
like solid unique selling points the

132
00:04:59,120 --> 00:05:02,880
clamshell

133
00:05:00,240 --> 00:05:04,800
casing with the hardware keyboards

134
00:05:02,880 --> 00:05:08,240
there's the cover display on the front

135
00:05:04,800 --> 00:05:09,440
which is kind of like a mini smart watch

136
00:05:08,240 --> 00:05:10,800
unless you do some things without

137
00:05:09,440 --> 00:05:12,320
opening it

138
00:05:10,800 --> 00:05:15,199
it's got the normal trappings of the

139
00:05:12,320 --> 00:05:16,560
phone like the old sam cameras this and

140
00:05:15,199 --> 00:05:18,800
that

141
00:05:16,560 --> 00:05:21,360
and it runs a heavily butchered build of

142
00:05:18,800 --> 00:05:23,360
android 9

143
00:05:21,360 --> 00:05:25,039
which is going to be the focus of this

144
00:05:23,360 --> 00:05:28,560
because that's

145
00:05:25,039 --> 00:05:32,560
where all of the shadiness is

146
00:05:28,560 --> 00:05:34,800
so as i mentioned i backed this thing

147
00:05:32,560 --> 00:05:36,720
in november when the indiegogo

148
00:05:34,800 --> 00:05:39,759
fundraiser launched

149
00:05:36,720 --> 00:05:42,400
i got mine a year later

150
00:05:39,759 --> 00:05:43,759
so i was like okay this is cool but i

151
00:05:42,400 --> 00:05:45,198
want to mess with the firmware i want to

152
00:05:43,759 --> 00:05:47,759
see if i can make this a bit less

153
00:05:45,199 --> 00:05:47,759
garbage

154
00:05:48,000 --> 00:05:51,759
so they didn't have any like official

155
00:05:50,160 --> 00:05:53,039
firmware images yet so i was a bit

156
00:05:51,759 --> 00:05:56,319
hesitant to mess with it

157
00:05:53,039 --> 00:05:57,680
but they did have this ota update

158
00:05:56,319 --> 00:05:59,600
software

159
00:05:57,680 --> 00:06:01,360
so they haven't actually released any

160
00:05:59,600 --> 00:06:03,759
updates yet but i figured

161
00:06:01,360 --> 00:06:05,360
maybe i can look into what services this

162
00:06:03,759 --> 00:06:06,160
is talking to and maybe i can convince

163
00:06:05,360 --> 00:06:08,560
this

164
00:06:06,160 --> 00:06:10,720
back in service to give me some firmware

165
00:06:08,560 --> 00:06:12,800
images some zip files

166
00:06:10,720 --> 00:06:14,400
something that will give me a bit more

167
00:06:12,800 --> 00:06:17,440
knowledge about this

168
00:06:14,400 --> 00:06:19,679
thing so i thought okay i've reverse

169
00:06:17,440 --> 00:06:22,479
engineered apps before i have the tools

170
00:06:19,680 --> 00:06:24,880
i have jdx which gives me mostly

171
00:06:22,479 --> 00:06:25,440
readable java code i have apk tool which

172
00:06:24,880 --> 00:06:28,159
takes

173
00:06:25,440 --> 00:06:29,919
an app and gives me and turns the

174
00:06:28,160 --> 00:06:32,560
android byte code into

175
00:06:29,919 --> 00:06:33,039
like readable smarlie which is just the

176
00:06:32,560 --> 00:06:36,000
raw

177
00:06:33,039 --> 00:06:37,280
vm instructions so you know of course

178
00:06:36,000 --> 00:06:40,880
this is probably going to be quite

179
00:06:37,280 --> 00:06:42,638
straightforward it's quite a simple app

180
00:06:40,880 --> 00:06:45,199
uh it was not as straightforward as

181
00:06:42,639 --> 00:06:47,120
expected and it was also

182
00:06:45,199 --> 00:06:48,800
like messed up in ways i was not even

183
00:06:47,120 --> 00:06:50,479
expecting

184
00:06:48,800 --> 00:06:52,960
which is what i shall be coming to

185
00:06:50,479 --> 00:06:52,960
shortly

186
00:06:53,039 --> 00:06:56,080
so here you have a screenshot of this

187
00:06:55,199 --> 00:06:58,560
updater app

188
00:06:56,080 --> 00:07:00,240
it's it looks like something out of the

189
00:06:58,560 --> 00:07:03,680
android four days it

190
00:07:00,240 --> 00:07:06,400
probably is let's be honest

191
00:07:03,680 --> 00:07:06,720
uh so this is made by a company called

192
00:07:06,400 --> 00:07:10,239
the

193
00:07:06,720 --> 00:07:11,599
time or shenzhen digital technology

194
00:07:10,240 --> 00:07:14,080
i shall not attempt to pronounce the

195
00:07:11,599 --> 00:07:14,080
chinese

196
00:07:14,479 --> 00:07:18,479
so the main business that this company

197
00:07:16,720 --> 00:07:21,759
has is that state provides

198
00:07:18,479 --> 00:07:23,120
update services like this so if you are

199
00:07:21,759 --> 00:07:24,800
building a device then

200
00:07:23,120 --> 00:07:27,599
you're responsible for building the

201
00:07:24,800 --> 00:07:29,840
firmware that goes in that device and

202
00:07:27,599 --> 00:07:31,199
this company gives you the update app

203
00:07:29,840 --> 00:07:32,960
they provide all of these servers and

204
00:07:31,199 --> 00:07:35,840
the infrastructure so

205
00:07:32,960 --> 00:07:37,599
when you have an update you build it you

206
00:07:35,840 --> 00:07:39,039
produce the installable zip file and you

207
00:07:37,599 --> 00:07:41,599
send it over to them

208
00:07:39,039 --> 00:07:42,159
and then they take care of deploying it

209
00:07:41,599 --> 00:07:44,639
to all

210
00:07:42,160 --> 00:07:46,479
of your users they take care of making

211
00:07:44,639 --> 00:07:48,560
sure that all of the right cdn's stuff

212
00:07:46,479 --> 00:07:50,800
are in place

213
00:07:48,560 --> 00:07:53,199
and they used to they used to have a

214
00:07:50,800 --> 00:07:56,639
website at digitimetech.com

215
00:07:53,199 --> 00:07:57,520
which is now dad's that might be my

216
00:07:56,639 --> 00:08:00,639
fault

217
00:07:57,520 --> 00:08:02,159
i will explain later

218
00:08:00,639 --> 00:08:04,560
but when this websites were still

219
00:08:02,160 --> 00:08:06,639
running they claimed to serve over 300

220
00:08:04,560 --> 00:08:08,160
million devices which is quite a lofty

221
00:08:06,639 --> 00:08:10,240
claim

222
00:08:08,160 --> 00:08:12,400
they claimed to serve hundreds of

223
00:08:10,240 --> 00:08:13,120
worldwide companies they had the logos

224
00:08:12,400 --> 00:08:15,039
of

225
00:08:13,120 --> 00:08:17,360
like you know quite well-known firms

226
00:08:15,039 --> 00:08:19,360
like qualcomm on their front page

227
00:08:17,360 --> 00:08:21,039
i don't know if this was like sanctioned

228
00:08:19,360 --> 00:08:23,440
by qualcomm but regardless it

229
00:08:21,039 --> 00:08:26,240
is something that they thought okay this

230
00:08:23,440 --> 00:08:28,719
is gonna make people trust us

231
00:08:26,240 --> 00:08:30,879
and they appear to be quite closely

232
00:08:28,720 --> 00:08:32,560
linked to another chinese company

233
00:08:30,879 --> 00:08:34,320
who has the same contact phone numbers

234
00:08:32,559 --> 00:08:36,958
on their website

235
00:08:34,320 --> 00:08:39,279
they a very similar business so they're

236
00:08:36,958 --> 00:08:40,958
also doing like update services

237
00:08:39,279 --> 00:08:42,559
just targeted tours like inside of

238
00:08:40,958 --> 00:08:44,479
things devices

239
00:08:42,559 --> 00:08:46,079
if you looked up this company in the

240
00:08:44,480 --> 00:08:48,640
chinese company registry

241
00:08:46,080 --> 00:08:50,480
they had the same legal representative

242
00:08:48,640 --> 00:08:54,160
and they had a website which went down

243
00:08:50,480 --> 00:08:57,760
at the same time

244
00:08:54,160 --> 00:08:59,519
so my first uh thing was like okay what

245
00:08:57,760 --> 00:08:59,839
can i find online about this company

246
00:08:59,519 --> 00:09:01,200
like

247
00:08:59,839 --> 00:09:03,440
maybe other people have researched the

248
00:09:01,200 --> 00:09:05,120
system maybe other people have written

249
00:09:03,440 --> 00:09:07,600
about them

250
00:09:05,120 --> 00:09:09,360
so i did some searching if you put digit

251
00:09:07,600 --> 00:09:12,240
time into your favorite search engine

252
00:09:09,360 --> 00:09:13,680
you will get things like there's a

253
00:09:12,240 --> 00:09:14,800
there's lenses for glasses called

254
00:09:13,680 --> 00:09:16,319
digitime

255
00:09:14,800 --> 00:09:17,839
there's a 90 publication called

256
00:09:16,320 --> 00:09:19,680
digitimes

257
00:09:17,839 --> 00:09:21,519
there's a shop in los angeles that

258
00:09:19,680 --> 00:09:23,839
installs audio and video

259
00:09:21,519 --> 00:09:25,760
equipment called digital time none of

260
00:09:23,839 --> 00:09:26,320
these are in the business of android

261
00:09:25,760 --> 00:09:29,439
updates

262
00:09:26,320 --> 00:09:32,240
to my knowledge there is

263
00:09:29,440 --> 00:09:32,640
or there was digitime's own website

264
00:09:32,240 --> 00:09:34,800
which

265
00:09:32,640 --> 00:09:37,839
had nothing technical it was just

266
00:09:34,800 --> 00:09:37,839
marketing fluff

267
00:09:37,920 --> 00:09:44,240
there's a linkedin page which listed the

268
00:09:41,120 --> 00:09:47,440
names of three employees

269
00:09:44,240 --> 00:09:49,440
and there was a github repo with

270
00:09:47,440 --> 00:09:52,399
some secret things which i will touch

271
00:09:49,440 --> 00:09:52,399
upon a bit later

272
00:09:52,800 --> 00:09:56,160
so that was kind of interesting but it

273
00:09:55,600 --> 00:09:57,680
didn't

274
00:09:56,160 --> 00:09:59,920
actually give me anything i needed at

275
00:09:57,680 --> 00:10:02,839
this point so

276
00:09:59,920 --> 00:10:04,000
the obvious next step is to start

277
00:10:02,839 --> 00:10:06,800
reversing

278
00:10:04,000 --> 00:10:07,839
so i took the ota updater of my cosmo

279
00:10:06,800 --> 00:10:11,120
using

280
00:10:07,839 --> 00:10:12,880
usbc cable and adb that's easy

281
00:10:11,120 --> 00:10:14,720
i don't you don't even need to root

282
00:10:12,880 --> 00:10:17,040
usually

283
00:10:14,720 --> 00:10:19,200
so given what i've seen of the app

284
00:10:17,040 --> 00:10:21,360
already like the really old android 4

285
00:10:19,200 --> 00:10:22,480
aesthetic i was not expecting it to be

286
00:10:21,360 --> 00:10:26,320
all that great

287
00:10:22,480 --> 00:10:28,560
but i still had like decent expectations

288
00:10:26,320 --> 00:10:29,920
like you know i wasn't expecting this to

289
00:10:28,560 --> 00:10:32,640
be malicious or anything

290
00:10:29,920 --> 00:10:34,160
right like the ot updates are supposed

291
00:10:32,640 --> 00:10:37,760
to keep your device secure and up to

292
00:10:34,160 --> 00:10:41,680
date and free of security holes

293
00:10:37,760 --> 00:10:43,439
so this is the tweet i posted back

294
00:10:41,680 --> 00:10:45,439
when i was about a day and a half into

295
00:10:43,440 --> 00:10:46,720
this whole thing so i got

296
00:10:45,440 --> 00:10:49,200
i've gotten to the point where i was

297
00:10:46,720 --> 00:10:50,880
trying to de-obfuscate lewis codes

298
00:10:49,200 --> 00:10:52,560
and i was looking at these like hidden

299
00:10:50,880 --> 00:10:54,399
urls which dates

300
00:10:52,560 --> 00:10:56,160
they were constructed out of like string

301
00:10:54,399 --> 00:10:57,600
fragments interspersed with garbage

302
00:10:56,160 --> 00:10:59,519
strings

303
00:10:57,600 --> 00:11:01,839
and there was this function which would

304
00:10:59,519 --> 00:11:03,440
generate a random domain name based of

305
00:11:01,839 --> 00:11:05,040
the timestamp

306
00:11:03,440 --> 00:11:06,880
which is a technique you see sometimes

307
00:11:05,040 --> 00:11:08,399
in malware there was this thing talking

308
00:11:06,880 --> 00:11:10,880
to like a fake domain

309
00:11:08,399 --> 00:11:13,200
pretending to be flowy analytics and i'm

310
00:11:10,880 --> 00:11:15,920
like this sounds kind of dodgy

311
00:11:13,200 --> 00:11:17,440
is this like someone trying to be a hot

312
00:11:15,920 --> 00:11:18,719
shot and pretending they're writing

313
00:11:17,440 --> 00:11:21,120
malware

314
00:11:18,720 --> 00:11:22,560
is this like someone trying to seem cool

315
00:11:21,120 --> 00:11:24,480
when they're just really bored in their

316
00:11:22,560 --> 00:11:26,959
job of writing this boring ass ot

317
00:11:24,480 --> 00:11:26,959
updater

318
00:11:27,519 --> 00:11:33,839
but as it turns out my body was not

319
00:11:30,079 --> 00:11:35,920
ready for what was to come after this

320
00:11:33,839 --> 00:11:37,040
so i'm going to save you all the the

321
00:11:35,920 --> 00:11:38,319
details of how i

322
00:11:37,040 --> 00:11:40,160
i actually tore this finger parts

323
00:11:38,320 --> 00:11:41,360
because there are a lot of them

324
00:11:40,160 --> 00:11:43,439
and if you want to know more i've

325
00:11:41,360 --> 00:11:44,959
written some blog posts but

326
00:11:43,440 --> 00:11:48,480
i'm just going to skip straight to

327
00:11:44,959 --> 00:11:51,279
describing the architecture of this app

328
00:11:48,480 --> 00:11:52,560
so i'm going to put a green rectangle

329
00:11:51,279 --> 00:11:54,480
here which i'm going to call the green

330
00:11:52,560 --> 00:11:56,800
sides

331
00:11:54,480 --> 00:11:58,240
so you have the ota update user

332
00:11:56,800 --> 00:11:59,199
interface which is what you saw in that

333
00:11:58,240 --> 00:12:00,800
screenshot

334
00:11:59,200 --> 00:12:03,040
it's just this like basic android

335
00:12:00,800 --> 00:12:04,319
activity where you have a little up

336
00:12:03,040 --> 00:12:07,279
button check for updates

337
00:12:04,320 --> 00:12:08,839
you tap it it tells you there's no

338
00:12:07,279 --> 00:12:10,720
updates or it tells you there's an

339
00:12:08,839 --> 00:12:12,560
update

340
00:12:10,720 --> 00:12:14,560
there's this piece of java code which

341
00:12:12,560 --> 00:12:15,199
just checks in with the servers to check

342
00:12:14,560 --> 00:12:18,160
if

343
00:12:15,200 --> 00:12:19,839
there's something and it also like lets

344
00:12:18,160 --> 00:12:20,800
the server know if it's succeeded or

345
00:12:19,839 --> 00:12:23,440
failed

346
00:12:20,800 --> 00:12:24,880
so the oem has these nice metrics

347
00:12:23,440 --> 00:12:26,399
available

348
00:12:24,880 --> 00:12:28,800
so they know if like something's gone

349
00:12:26,399 --> 00:12:31,440
horrendously wrong

350
00:12:28,800 --> 00:12:33,519
it's just downloads zip files over http

351
00:12:31,440 --> 00:12:35,839
and then passes them over to the

352
00:12:33,519 --> 00:12:38,720
normal android recovery system which is

353
00:12:35,839 --> 00:12:40,160
all what you'd expect really

354
00:12:38,720 --> 00:12:41,760
they've gone to the efforts of being

355
00:12:40,160 --> 00:12:43,279
gdpr compliant as well

356
00:12:41,760 --> 00:12:45,279
so if the server detects that you're

357
00:12:43,279 --> 00:12:46,800
connecting from the eu

358
00:12:45,279 --> 00:12:48,880
then it will set this nice flag that

359
00:12:46,800 --> 00:12:50,639
says gdpr equals one

360
00:12:48,880 --> 00:12:52,240
and then the client knows to not send

361
00:12:50,639 --> 00:12:53,519
certain bits of information

362
00:12:52,240 --> 00:12:55,519
because that would place them in

363
00:12:53,519 --> 00:12:57,279
violation of the law of course

364
00:12:55,519 --> 00:12:59,040
and it also connects to a different set

365
00:12:57,279 --> 00:13:02,000
of servers which is

366
00:12:59,040 --> 00:13:02,480
within the eu so you know they're being

367
00:13:02,000 --> 00:13:06,079
like

368
00:13:02,480 --> 00:13:07,680
nice and legal here so then there's this

369
00:13:06,079 --> 00:13:08,959
gap on the right side of the slides

370
00:13:07,680 --> 00:13:11,279
which i've kept

371
00:13:08,959 --> 00:13:14,079
for what i'm gonna affectionately call

372
00:13:11,279 --> 00:13:17,519
the red sides

373
00:13:14,079 --> 00:13:18,839
so you have this lua runtime which runs

374
00:13:17,519 --> 00:13:22,560
in a service that they call

375
00:13:18,839 --> 00:13:24,480
box so

376
00:13:22,560 --> 00:13:28,638
this this thing runs in a background

377
00:13:24,480 --> 00:13:28,639
service at random times basically

378
00:13:29,200 --> 00:13:33,200
it talks to all of these weird domain

379
00:13:30,880 --> 00:13:36,320
names like facebook dashboards.com

380
00:13:33,200 --> 00:13:38,160
and flurrydata.com which of course

381
00:13:36,320 --> 00:13:40,639
have nothing to do with facebook or

382
00:13:38,160 --> 00:13:40,639
flurry

383
00:13:40,959 --> 00:13:44,160
and it downloads packages of obfuscated

384
00:13:43,120 --> 00:13:45,760
white codes

385
00:13:44,160 --> 00:13:48,079
so there's like this block in the app

386
00:13:45,760 --> 00:13:50,959
and then that block goes and just

387
00:13:48,079 --> 00:13:56,000
downloads more of it and runs it

388
00:13:50,959 --> 00:13:56,000
so yeah that's a bit weird

389
00:13:56,720 --> 00:14:00,399
so that's like an overview of the whole

390
00:13:58,240 --> 00:14:03,199
thing so now i'm gonna describe

391
00:14:00,399 --> 00:14:03,839
in a bit more depth each side so on the

392
00:14:03,199 --> 00:14:07,040
legit

393
00:14:03,839 --> 00:14:08,880
side the green side you have well

394
00:14:07,040 --> 00:14:10,240
the first step is it calls into the lua

395
00:14:08,880 --> 00:14:12,399
engine to fetch

396
00:14:10,240 --> 00:14:14,639
the urls it's going to talk to which is

397
00:14:12,399 --> 00:14:17,040
actually the only place where

398
00:14:14,639 --> 00:14:19,760
the lua engine actually comes into play

399
00:14:17,040 --> 00:14:21,920
when you're updating the device

400
00:14:19,760 --> 00:14:24,240
and if it's the text that you are

401
00:14:21,920 --> 00:14:27,519
subject to the gdpr then it pulls up

402
00:14:24,240 --> 00:14:29,760
one of these alternate host names

403
00:14:27,519 --> 00:14:31,120
it gathers a bunch of information about

404
00:14:29,760 --> 00:14:32,880
your device so

405
00:14:31,120 --> 00:14:34,399
it gets the model the firmware version

406
00:14:32,880 --> 00:14:35,839
the updated version

407
00:14:34,399 --> 00:14:37,519
an id that they use to track the

408
00:14:35,839 --> 00:14:41,199
deployments which is all

409
00:14:37,519 --> 00:14:44,399
fairly normal and then in certain cases

410
00:14:41,199 --> 00:14:46,959
it also sends some id information which

411
00:14:44,399 --> 00:14:48,959
is a bit much i would say maybe but

412
00:14:46,959 --> 00:14:50,319
it's still not something that would make

413
00:14:48,959 --> 00:14:52,638
me

414
00:14:50,320 --> 00:14:53,839
say no this is malicious now i just

415
00:14:52,639 --> 00:14:55,440
assume that's maybe they're

416
00:14:53,839 --> 00:14:57,360
they're being a little bit overzealous

417
00:14:55,440 --> 00:15:00,560
and transmitting more information than

418
00:14:57,360 --> 00:15:02,800
they might need they have some really

419
00:15:00,560 --> 00:15:05,518
basic zaw encryption using

420
00:15:02,800 --> 00:15:07,359
this weird key that's kind of readable

421
00:15:05,519 --> 00:15:08,959
and follows this format which is like

422
00:15:07,360 --> 00:15:11,040
five characters underscore five

423
00:15:08,959 --> 00:15:13,439
underscore five and you'll see that

424
00:15:11,040 --> 00:15:15,839
format again

425
00:15:13,440 --> 00:15:17,920
they send it to the server endpoint v3

426
00:15:15,839 --> 00:15:19,920
mob check

427
00:15:17,920 --> 00:15:21,120
so the server comes back to the client

428
00:15:19,920 --> 00:15:24,639
and returns either

429
00:15:21,120 --> 00:15:26,079
a phone id if this device is doing its

430
00:15:24,639 --> 00:15:26,639
first check and hasn't gotten one

431
00:15:26,079 --> 00:15:30,719
already

432
00:15:26,639 --> 00:15:32,800
or it returns the update info and then

433
00:15:30,720 --> 00:15:34,639
the client stores that phone id for

434
00:15:32,800 --> 00:15:36,160
future requests

435
00:15:34,639 --> 00:15:38,000
so this is all quite quite

436
00:15:36,160 --> 00:15:41,519
straightforward this is really all you

437
00:15:38,000 --> 00:15:44,320
need for an updater let's be honest

438
00:15:41,519 --> 00:15:46,240
so but that's only covered like one half

439
00:15:44,320 --> 00:15:48,000
of it basically

440
00:15:46,240 --> 00:15:51,120
so then you have the mysterious lure

441
00:15:48,000 --> 00:15:51,120
code on the red side

442
00:15:51,199 --> 00:15:58,399
so i mentioned already this box service

443
00:15:54,720 --> 00:16:00,320
if you open up the apk there's a

444
00:15:58,399 --> 00:16:01,839
couple of zip files containing a package

445
00:16:00,320 --> 00:16:04,880
which they call boots

446
00:16:01,839 --> 00:16:08,000
so this contains a whole bunch of

447
00:16:04,880 --> 00:16:09,519
obfuscated lua bytecode files

448
00:16:08,000 --> 00:16:11,360
and this system actually has a few

449
00:16:09,519 --> 00:16:13,120
different features so

450
00:16:11,360 --> 00:16:15,519
that's the config module which they use

451
00:16:13,120 --> 00:16:17,199
to store parameters in an encrypted form

452
00:16:15,519 --> 00:16:19,040
so these are things like how long it's

453
00:16:17,199 --> 00:16:21,120
going to wait before it checks again

454
00:16:19,040 --> 00:16:22,240
or the url of the server this is going

455
00:16:21,120 --> 00:16:25,440
to talk to

456
00:16:22,240 --> 00:16:26,880
and these parameters can change based on

457
00:16:25,440 --> 00:16:28,720
what the server sends it so if they

458
00:16:26,880 --> 00:16:30,880
decide to move the servers then they can

459
00:16:28,720 --> 00:16:31,199
push this client some new config and it

460
00:16:30,880 --> 00:16:33,759
will

461
00:16:31,199 --> 00:16:36,880
replace that field and start talking to

462
00:16:33,759 --> 00:16:38,639
this other server and then there's a few

463
00:16:36,880 --> 00:16:41,120
bits and pieces as well

464
00:16:38,639 --> 00:16:42,000
which gather some data like what we saw

465
00:16:41,120 --> 00:16:45,120
for the

466
00:16:42,000 --> 00:16:46,320
normal updates and then there's the

467
00:16:45,120 --> 00:16:47,759
schedule module

468
00:16:46,320 --> 00:16:50,000
which is just a bit of logic that

469
00:16:47,759 --> 00:16:52,800
determines when it's actually gonna

470
00:16:50,000 --> 00:16:56,720
run and do its dodgy things i shall

471
00:16:52,800 --> 00:16:56,719
elaborate on these dodgy things shortly

472
00:16:57,040 --> 00:17:00,480
and there's a few entry points into this

473
00:16:59,040 --> 00:17:03,279
whole system

474
00:17:00,480 --> 00:17:04,640
so that's the bit i mentioned where the

475
00:17:03,279 --> 00:17:07,280
like actual legitimate

476
00:17:04,640 --> 00:17:09,120
ota code will ask it what service it's

477
00:17:07,280 --> 00:17:10,799
going to talk to

478
00:17:09,119 --> 00:17:12,639
there's this test condition thing which

479
00:17:10,799 --> 00:17:14,000
is some kind of unused debug

480
00:17:12,640 --> 00:17:16,319
functionality

481
00:17:14,000 --> 00:17:18,160
which i i believe it just like updates

482
00:17:16,319 --> 00:17:20,959
the parameters so

483
00:17:18,160 --> 00:17:22,799
it fires uh check in right away rather

484
00:17:20,959 --> 00:17:26,160
than waiting for the timeouts to

485
00:17:22,799 --> 00:17:27,599
pass by and then there's the boot entry

486
00:17:26,160 --> 00:17:31,200
which is

487
00:17:27,599 --> 00:17:32,799
what actually happens when this like

488
00:17:31,200 --> 00:17:34,960
code runs in a background service at

489
00:17:32,799 --> 00:17:37,679
random times

490
00:17:34,960 --> 00:17:39,760
so it gets called roughly every four

491
00:17:37,679 --> 00:17:41,120
hours

492
00:17:39,760 --> 00:17:43,520
it checks to see if it's got one of

493
00:17:41,120 --> 00:17:46,799
these worker packages which is just

494
00:17:43,520 --> 00:17:49,280
another block of mysterious lure code

495
00:17:46,799 --> 00:17:50,320
and it also checks to see if a check-in

496
00:17:49,280 --> 00:17:52,240
is due

497
00:17:50,320 --> 00:17:53,840
so it checks to make sure that enough

498
00:17:52,240 --> 00:17:54,799
time has passed since the last time it

499
00:17:53,840 --> 00:17:57,918
checked in

500
00:17:54,799 --> 00:17:59,918
so i think it's something like

501
00:17:57,919 --> 00:18:02,000
it depends on the version you have but

502
00:17:59,919 --> 00:18:04,320
one of them is like eight hours

503
00:18:02,000 --> 00:18:06,400
all the time and then another one it's

504
00:18:04,320 --> 00:18:09,918
like every week if you're on

505
00:18:06,400 --> 00:18:12,400
3g data and every hour like every 24

506
00:18:09,919 --> 00:18:14,640
hours if you're on wi-fi

507
00:18:12,400 --> 00:18:16,559
and it also checks to make sure that

508
00:18:14,640 --> 00:18:18,000
it's that's like a certain amount of

509
00:18:16,559 --> 00:18:19,840
attempts have passed so

510
00:18:18,000 --> 00:18:22,320
there was one version where on the first

511
00:18:19,840 --> 00:18:25,280
30 tries to call this code it will just

512
00:18:22,320 --> 00:18:28,080
like do nothing lie dormant so that no

513
00:18:25,280 --> 00:18:30,320
one sees anything dodgy on like the

514
00:18:28,080 --> 00:18:32,240
like firewall rules or anything and then

515
00:18:30,320 --> 00:18:35,360
after 30 activations it's like

516
00:18:32,240 --> 00:18:39,120
yes this is my time and it starts

517
00:18:35,360 --> 00:18:40,959
doing it it's dodgy crap

518
00:18:39,120 --> 00:18:42,639
and if either of these conditions fails

519
00:18:40,960 --> 00:18:44,960
then it just skips the whole thing does

520
00:18:42,640 --> 00:18:44,960
nothing

521
00:18:45,280 --> 00:18:48,399
so it talks to this so this really weird

522
00:18:47,679 --> 00:18:50,480
domain

523
00:18:48,400 --> 00:18:51,840
statistics that flurry data that's come

524
00:18:50,480 --> 00:18:55,840
on force 10 000

525
00:18:51,840 --> 00:18:57,918
slash boots and it sends it a request

526
00:18:55,840 --> 00:19:00,639
this just sends a bunch of the simple

527
00:18:57,919 --> 00:19:02,320
device metadata which is

528
00:19:00,640 --> 00:19:04,000
it's pretty much the same stuff that i

529
00:19:02,320 --> 00:19:06,000
mentioned in

530
00:19:04,000 --> 00:19:08,559
for the green side where it's just like

531
00:19:06,000 --> 00:19:10,799
device info some ids

532
00:19:08,559 --> 00:19:12,639
they don't bother with the gdpr nonsense

533
00:19:10,799 --> 00:19:14,799
here let's be real

534
00:19:12,640 --> 00:19:17,280
at this point they don't care if they're

535
00:19:14,799 --> 00:19:18,799
doing it the right way or not

536
00:19:17,280 --> 00:19:21,600
and then the server comes back to the

537
00:19:18,799 --> 00:19:23,440
client and returns some things

538
00:19:21,600 --> 00:19:25,520
so it can return some new configuration

539
00:19:23,440 --> 00:19:26,960
so maybe they've decided to like

540
00:19:25,520 --> 00:19:28,799
move the server to another shady

541
00:19:26,960 --> 00:19:31,679
sounding domain

542
00:19:28,799 --> 00:19:33,600
they can do that just send you a config

543
00:19:31,679 --> 00:19:36,000
dictionary containing a new value for

544
00:19:33,600 --> 00:19:39,439
boot url one

545
00:19:36,000 --> 00:19:41,360
or they can also send the commands which

546
00:19:39,440 --> 00:19:43,360
is either a request to register in which

547
00:19:41,360 --> 00:19:44,959
case it generates a new id

548
00:19:43,360 --> 00:19:47,120
a request to supply even more

549
00:19:44,960 --> 00:19:48,720
information or a request to download a

550
00:19:47,120 --> 00:19:50,840
worker package

551
00:19:48,720 --> 00:19:52,799
which is what i'm going to talk about

552
00:19:50,840 --> 00:19:55,120
now

553
00:19:52,799 --> 00:19:57,280
so the worker is where it gets real

554
00:19:55,120 --> 00:19:59,120
spicy

555
00:19:57,280 --> 00:20:02,879
this is another block of lua but this

556
00:19:59,120 --> 00:20:05,360
one isn't actually embedded into the app

557
00:20:02,880 --> 00:20:07,600
this one is supplied dynamically by the

558
00:20:05,360 --> 00:20:09,199
server so when it sends the boot module

559
00:20:07,600 --> 00:20:12,080
and upgrades commands

560
00:20:09,200 --> 00:20:13,679
it gives it a url pointing to a zip file

561
00:20:12,080 --> 00:20:16,000
on some cdn

562
00:20:13,679 --> 00:20:17,039
the app takes the zip file unpacks it

563
00:20:16,000 --> 00:20:18,880
and

564
00:20:17,039 --> 00:20:20,320
makes that its worker which just stays

565
00:20:18,880 --> 00:20:23,360
until a new version is

566
00:20:20,320 --> 00:20:25,360
sent to it it's got a very similar

567
00:20:23,360 --> 00:20:27,039
structure to the boot package so

568
00:20:25,360 --> 00:20:28,479
it does very similar things where it

569
00:20:27,039 --> 00:20:30,960
just activates

570
00:20:28,480 --> 00:20:32,559
at certain intervals in the background

571
00:20:30,960 --> 00:20:34,240
there's certain conditions where it will

572
00:20:32,559 --> 00:20:36,720
decide to just do nothing to try and

573
00:20:34,240 --> 00:20:36,720
hide away

574
00:20:37,200 --> 00:20:40,960
each worker has a version number like v

575
00:20:39,760 --> 00:20:44,158
1.6

576
00:20:40,960 --> 00:20:46,480
and an ext identifier which specifies

577
00:20:44,159 --> 00:20:47,600
what functions it has and these kind of

578
00:20:46,480 --> 00:20:50,480
run in parallel

579
00:20:47,600 --> 00:20:51,520
so at the same time they had multiple

580
00:20:50,480 --> 00:20:55,280
different versions of

581
00:20:51,520 --> 00:20:57,200
v 1.6 with different features

582
00:20:55,280 --> 00:20:58,559
so i found a few different ones

583
00:20:57,200 --> 00:21:00,559
[Music]

584
00:20:58,559 --> 00:21:02,320
there's b which is the one that i got

585
00:21:00,559 --> 00:21:04,799
sent on my cosmo

586
00:21:02,320 --> 00:21:06,960
so that one sends home some device data

587
00:21:04,799 --> 00:21:08,879
nothing all too weird

588
00:21:06,960 --> 00:21:10,159
and it generates a couple of device ids

589
00:21:08,880 --> 00:21:12,640
and then stores them in like four

590
00:21:10,159 --> 00:21:14,559
different locations on the file system

591
00:21:12,640 --> 00:21:15,679
and then when the phone's home it also

592
00:21:14,559 --> 00:21:18,320
sends this

593
00:21:15,679 --> 00:21:19,039
just like littlefield saying these are

594
00:21:18,320 --> 00:21:20,799
the locations

595
00:21:19,039 --> 00:21:23,039
in which i found it and if it finds a

596
00:21:20,799 --> 00:21:24,559
mismatch it also reports that

597
00:21:23,039 --> 00:21:27,520
so i guess they're trying to like cash

598
00:21:24,559 --> 00:21:29,520
out people who might delete that data

599
00:21:27,520 --> 00:21:30,799
so if they've if they get rid of one of

600
00:21:29,520 --> 00:21:32,639
them it's like ha

601
00:21:30,799 --> 00:21:35,120
i still have my other three locations

602
00:21:32,640 --> 00:21:36,799
got you

603
00:21:35,120 --> 00:21:38,399
and but there's a couple more versions i

604
00:21:36,799 --> 00:21:40,799
found as well

605
00:21:38,400 --> 00:21:42,559
there's i which gives it the ability to

606
00:21:40,799 --> 00:21:46,480
remotely install and uninstall

607
00:21:42,559 --> 00:21:47,280
apps so the server supplies a url to an

608
00:21:46,480 --> 00:21:49,440
apk

609
00:21:47,280 --> 00:21:51,760
and this one just goes and installs that

610
00:21:49,440 --> 00:21:54,000
apk in the background

611
00:21:51,760 --> 00:21:55,760
and for this it shouts out to the pm

612
00:21:54,000 --> 00:21:57,520
commands

613
00:21:55,760 --> 00:21:59,120
which is usually something you would

614
00:21:57,520 --> 00:22:01,280
only access if you're

615
00:21:59,120 --> 00:22:03,199
like accessing your phone over adb and

616
00:22:01,280 --> 00:22:06,399
debug modes

617
00:22:03,200 --> 00:22:09,039
and that's also the m worker which

618
00:22:06,400 --> 00:22:10,640
is very similar to the i1 but they made

619
00:22:09,039 --> 00:22:12,480
it even more powerful so

620
00:22:10,640 --> 00:22:14,720
now it looks at the version of the host

621
00:22:12,480 --> 00:22:15,520
app and depending on that it calls into

622
00:22:14,720 --> 00:22:18,480
one of

623
00:22:15,520 --> 00:22:20,000
four different android back doors

624
00:22:18,480 --> 00:22:23,440
because you know

625
00:22:20,000 --> 00:22:24,880
these abilities just weren't enough but

626
00:22:23,440 --> 00:22:27,280
the really sneaky thing about this whole

627
00:22:24,880 --> 00:22:29,200
system is that

628
00:22:27,280 --> 00:22:31,678
it just sends the clients an upgrade

629
00:22:29,200 --> 00:22:34,640
command and supplies an arbitrary url

630
00:22:31,679 --> 00:22:36,240
so i have no ability to know which urls

631
00:22:34,640 --> 00:22:37,919
they might send

632
00:22:36,240 --> 00:22:39,360
i found these because i got sent to be

633
00:22:37,919 --> 00:22:40,720
worker so i thought

634
00:22:39,360 --> 00:22:43,439
maybe they have other ones so i just

635
00:22:40,720 --> 00:22:45,919
like wrote this for loop that pulls down

636
00:22:43,440 --> 00:22:47,760
like every version number from 1 to 99

637
00:22:45,919 --> 00:22:49,679
every letter from a to z ads

638
00:22:47,760 --> 00:22:52,480
to see how many i could find and i found

639
00:22:49,679 --> 00:22:54,320
these two but

640
00:22:52,480 --> 00:22:55,760
they might have others well no i know

641
00:22:54,320 --> 00:22:58,639
they do have others because later on

642
00:22:55,760 --> 00:23:00,158
they sent me a different one

643
00:22:58,640 --> 00:23:02,159
but it's impossible for me to know

644
00:23:00,159 --> 00:23:03,919
without more access to their back end

645
00:23:02,159 --> 00:23:05,600
just how many they have maybe they've

646
00:23:03,919 --> 00:23:06,720
got others that

647
00:23:05,600 --> 00:23:10,480
do other weirder things like

648
00:23:06,720 --> 00:23:14,320
exfiltrating more data i just don't know

649
00:23:10,480 --> 00:23:14,320
so yeah that could be more of them

650
00:23:14,799 --> 00:23:18,080
so when i when i was looking at this

651
00:23:16,240 --> 00:23:19,600
originally i still tried to give them

652
00:23:18,080 --> 00:23:21,760
the benefits of the doubts like

653
00:23:19,600 --> 00:23:23,520
maybe this is one big misunderstanding

654
00:23:21,760 --> 00:23:25,360
maybe there's a reason for this

655
00:23:23,520 --> 00:23:26,879
but like maybe they've got legit reasons

656
00:23:25,360 --> 00:23:29,520
to have this thing where they can

657
00:23:26,880 --> 00:23:30,880
like remotely install apps on people's

658
00:23:29,520 --> 00:23:34,080
devices

659
00:23:30,880 --> 00:23:36,080
but then i did some more research so i

660
00:23:34,080 --> 00:23:36,639
found this thread on xda developers

661
00:23:36,080 --> 00:23:39,520
where

662
00:23:36,640 --> 00:23:41,600
someone had a gretel a7 which is like

663
00:23:39,520 --> 00:23:42,720
one of these weird no-name low-budget

664
00:23:41,600 --> 00:23:44,959
phones

665
00:23:42,720 --> 00:23:46,240
so it's like i got infected with malware

666
00:23:44,960 --> 00:23:48,480
for a dodgy website

667
00:23:46,240 --> 00:23:50,000
i believe the malware rooted my phone

668
00:23:48,480 --> 00:23:54,080
this is installing apps that cause

669
00:23:50,000 --> 00:23:57,760
popups so that's a little bit

670
00:23:54,080 --> 00:23:59,678
vague but later in the post they

671
00:23:57,760 --> 00:24:02,840
actually have dumps that they've taken

672
00:23:59,679 --> 00:24:04,960
off the http requests that install these

673
00:24:02,840 --> 00:24:08,080
apps

674
00:24:04,960 --> 00:24:08,960
like this so there's a request that's

675
00:24:08,080 --> 00:24:10,879
talking to us

676
00:24:08,960 --> 00:24:13,120
boots endpoints on this statistics

677
00:24:10,880 --> 00:24:15,440
flowydates.com domain

678
00:24:13,120 --> 00:24:17,600
which is precisely the one i've seen

679
00:24:15,440 --> 00:24:18,799
that's the this ot update software talks

680
00:24:17,600 --> 00:24:22,158
to

681
00:24:18,799 --> 00:24:24,158
and as luck would have it the key i

682
00:24:22,159 --> 00:24:25,440
found from reverse engineering the app

683
00:24:24,159 --> 00:24:30,000
on my device

684
00:24:25,440 --> 00:24:30,000
just works to decrypt this blob

685
00:24:30,840 --> 00:24:35,279
so

686
00:24:33,039 --> 00:24:36,799
so that's one of those decrypted

687
00:24:35,279 --> 00:24:39,760
requests from that post

688
00:24:36,799 --> 00:24:41,679
where this is one of the payloads that

689
00:24:39,760 --> 00:24:43,679
the server sends to the worker

690
00:24:41,679 --> 00:24:46,400
so that's actually using the install

691
00:24:43,679 --> 00:24:50,080
commands which i saw in the eye worker

692
00:24:46,400 --> 00:24:53,200
to send that some arbitrary apk and

693
00:24:50,080 --> 00:24:53,520
i downloaded that apk and it's just this

694
00:24:53,200 --> 00:24:56,240
like

695
00:24:53,520 --> 00:24:57,600
really really generic adware app nothing

696
00:24:56,240 --> 00:25:00,799
special

697
00:24:57,600 --> 00:25:03,039
but this is really interesting because

698
00:25:00,799 --> 00:25:04,879
this is basically proof that this system

699
00:25:03,039 --> 00:25:05,919
has been used to deploy adware in the

700
00:25:04,880 --> 00:25:08,000
wild

701
00:25:05,919 --> 00:25:09,200
and i haven't actually shown these in

702
00:25:08,000 --> 00:25:11,520
these slides but

703
00:25:09,200 --> 00:25:12,840
if you decrypt the other requests that

704
00:25:11,520 --> 00:25:16,158
were shown in that post

705
00:25:12,840 --> 00:25:18,080
then thanks to all of the info that the

706
00:25:16,159 --> 00:25:19,840
worker system puts into those requests

707
00:25:18,080 --> 00:25:22,720
it actually tags like the

708
00:25:19,840 --> 00:25:23,360
specific package id of the app that this

709
00:25:22,720 --> 00:25:25,520
came from

710
00:25:23,360 --> 00:25:26,959
confirming that this came from the ot

711
00:25:25,520 --> 00:25:29,120
updater

712
00:25:26,960 --> 00:25:30,960
so people were actually blaming the

713
00:25:29,120 --> 00:25:32,320
wrestler a7 malware and things like the

714
00:25:30,960 --> 00:25:36,720
launcher

715
00:25:32,320 --> 00:25:39,279
but no it was the otp data all along

716
00:25:36,720 --> 00:25:40,960
and hopefully since there's so much data

717
00:25:39,279 --> 00:25:42,799
in these requests

718
00:25:40,960 --> 00:25:45,120
this also gives me all the information i

719
00:25:42,799 --> 00:25:46,158
need for my script which talks to the

720
00:25:45,120 --> 00:25:48,000
server

721
00:25:46,159 --> 00:25:50,799
to pretend to be one of these gradually

722
00:25:48,000 --> 00:25:53,120
seven devices so it's given me like

723
00:25:50,799 --> 00:25:54,879
the name for the name of the device the

724
00:25:53,120 --> 00:25:56,239
exact model name the exact firmware

725
00:25:54,880 --> 00:25:58,880
version number that's the

726
00:25:56,240 --> 00:26:00,880
digit time server expects to see so i

727
00:25:58,880 --> 00:26:02,480
can talk to the server

728
00:26:00,880 --> 00:26:04,080
pretend to be one of these phones and

729
00:26:02,480 --> 00:26:07,039
see what's

730
00:26:04,080 --> 00:26:08,639
like exactly what payloads and what what

731
00:26:07,039 --> 00:26:11,840
random blobs of lure codes they will

732
00:26:08,640 --> 00:26:11,840
give me in 2020.

733
00:26:12,480 --> 00:26:16,880
so yeah we've got evidence that they use

734
00:26:15,200 --> 00:26:20,640
this for adware

735
00:26:16,880 --> 00:26:20,640
what other weird things can i find

736
00:26:21,039 --> 00:26:25,360
if you search for some of these domain

737
00:26:23,440 --> 00:26:26,559
names like the facebook third one that

738
00:26:25,360 --> 00:26:28,080
they use to distrib

739
00:26:26,559 --> 00:26:31,520
to distribute all of these android

740
00:26:28,080 --> 00:26:33,199
payloads you get things like

741
00:26:31,520 --> 00:26:35,120
this these results are the url standards

742
00:26:33,200 --> 00:26:37,760
io where you can see like

743
00:26:35,120 --> 00:26:40,959
one of these worker packages linked

744
00:26:37,760 --> 00:26:43,600
that's actually one i hadn't seen before

745
00:26:40,960 --> 00:26:45,120
and there's like these links to other

746
00:26:43,600 --> 00:26:48,158
files ending in rdf

747
00:26:45,120 --> 00:26:49,678
those are actually just apk files and

748
00:26:48,159 --> 00:26:53,039
sure enough if you download those these

749
00:26:49,679 --> 00:26:55,760
are just more generic adway

750
00:26:53,039 --> 00:26:57,520
so i actually analyzed a bunch of those

751
00:26:55,760 --> 00:26:58,960
because i was curious uh

752
00:26:57,520 --> 00:27:00,960
if i could learn more about their

753
00:26:58,960 --> 00:27:02,480
infrastructure what abilities these

754
00:27:00,960 --> 00:27:04,000
things had

755
00:27:02,480 --> 00:27:05,840
they're pretty much just all background

756
00:27:04,000 --> 00:27:06,960
services that's either spawn ad web

757
00:27:05,840 --> 00:27:09,439
views or

758
00:27:06,960 --> 00:27:11,120
they just call into like existing ad

759
00:27:09,440 --> 00:27:12,320
libraries like the sort of thing you'd

760
00:27:11,120 --> 00:27:14,158
expect to see in

761
00:27:12,320 --> 00:27:15,520
like freemium apps like free-to-play

762
00:27:14,159 --> 00:27:17,440
games where you finish a level

763
00:27:15,520 --> 00:27:18,879
and that's called into an ad library to

764
00:27:17,440 --> 00:27:22,480
pop up an ad for this

765
00:27:18,880 --> 00:27:24,080
random game that sort of thing

766
00:27:22,480 --> 00:27:26,000
they they use a bunch of different

767
00:27:24,080 --> 00:27:27,439
services and libraries for diversity

768
00:27:26,000 --> 00:27:30,000
sake

769
00:27:27,440 --> 00:27:32,640
some of them use these weird obfuscators

770
00:27:30,000 --> 00:27:34,080
a lot of them didn't bother

771
00:27:32,640 --> 00:27:35,760
some of them will actually look at what

772
00:27:34,080 --> 00:27:37,279
app you have in the foreground to

773
00:27:35,760 --> 00:27:39,840
determine whether to

774
00:27:37,279 --> 00:27:41,440
pop up with an ads because you know if

775
00:27:39,840 --> 00:27:42,559
you get a random ads when you're looking

776
00:27:41,440 --> 00:27:44,159
at your banking app

777
00:27:42,559 --> 00:27:46,158
then you're probably going to suspect

778
00:27:44,159 --> 00:27:47,520
something but if you get to random ads

779
00:27:46,159 --> 00:27:50,880
when you're looking at facebook then

780
00:27:47,520 --> 00:27:50,879
you're just going to blame facebook

781
00:27:51,360 --> 00:27:56,158
and it also reads those device ids that

782
00:27:53,520 --> 00:27:58,720
the time worker code stores

783
00:27:56,159 --> 00:27:59,200
so it looks at that id generated by the

784
00:27:58,720 --> 00:28:02,080
digital

785
00:27:59,200 --> 00:28:03,039
infrastructure and then it sends that

786
00:28:02,080 --> 00:28:06,320
home in its own

787
00:28:03,039 --> 00:28:08,879
reports it there's also some sort of

788
00:28:06,320 --> 00:28:10,559
kill switch mechanism in it

789
00:28:08,880 --> 00:28:12,799
so that's the app can be disabled

790
00:28:10,559 --> 00:28:15,760
remotely

791
00:28:12,799 --> 00:28:18,440
it uses these cool encrypted urls at

792
00:28:15,760 --> 00:28:21,440
legitimate looking domains like

793
00:28:18,440 --> 00:28:21,440
androidsecurityteam.club

794
00:28:22,159 --> 00:28:25,440
so there's been a few of these weird

795
00:28:23,679 --> 00:28:28,240
domains so i figured

796
00:28:25,440 --> 00:28:32,080
you know what let's see if we can find

797
00:28:28,240 --> 00:28:34,320
anything interesting on the who is data

798
00:28:32,080 --> 00:28:35,840
so i looked up a bunch of them to find

799
00:28:34,320 --> 00:28:39,279
that a few of them were registered

800
00:28:35,840 --> 00:28:40,959
to someone called sangomori sat in the

801
00:28:39,279 --> 00:28:41,919
address as a large office building in

802
00:28:40,960 --> 00:28:44,000
tokyo

803
00:28:41,919 --> 00:28:46,080
the home to big multinational firms like

804
00:28:44,000 --> 00:28:48,720
fujitsu

805
00:28:46,080 --> 00:28:50,399
so does things like this old domain that

806
00:28:48,720 --> 00:28:52,399
previous versions of the digital time of

807
00:28:50,399 --> 00:28:55,360
data used

808
00:28:52,399 --> 00:28:57,039
there's that side western side mentions

809
00:28:55,360 --> 00:28:59,120
there's ownerchain.com

810
00:28:57,039 --> 00:29:00,530
which i saw one of the android apk

811
00:28:59,120 --> 00:29:02,080
samples loading ads from

812
00:29:00,530 --> 00:29:03,600
[Music]

813
00:29:02,080 --> 00:29:05,279
there were a bunch of other weird

814
00:29:03,600 --> 00:29:06,799
domains i've mentioned a couple of those

815
00:29:05,279 --> 00:29:09,679
already facebook thirds

816
00:29:06,799 --> 00:29:10,320
flurry data which got registered to tim

817
00:29:09,679 --> 00:29:12,640
black

818
00:29:10,320 --> 00:29:15,120
that's my box holder at hotmail with a

819
00:29:12,640 --> 00:29:17,360
non-existent us postal address

820
00:29:15,120 --> 00:29:20,879
with with a u.s phone number that's too

821
00:29:17,360 --> 00:29:23,840
long in their non-existent zip codes

822
00:29:20,880 --> 00:29:24,799
so there you have it stone street free

823
00:29:23,840 --> 00:29:27,039
alibaba

824
00:29:24,799 --> 00:29:27,918
in new jersey that's a non-existent

825
00:29:27,039 --> 00:29:32,080
postal code

826
00:29:27,919 --> 00:29:35,760
of course i don't think ppl llc exists

827
00:29:32,080 --> 00:29:35,760
but i haven't actually looked

828
00:29:36,000 --> 00:29:39,279
and i'm going to take this moment to

829
00:29:37,520 --> 00:29:40,559
shout out one of the really useful tools

830
00:29:39,279 --> 00:29:42,240
i use for this

831
00:29:40,559 --> 00:29:44,080
there's a really handy site which is

832
00:29:42,240 --> 00:29:46,159
just view dns.info

833
00:29:44,080 --> 00:29:47,918
and it's gives you things so you can

834
00:29:46,159 --> 00:29:48,880
like search to see every domain

835
00:29:47,919 --> 00:29:51,039
registered but

836
00:29:48,880 --> 00:29:52,559
with a given email address or just do

837
00:29:51,039 --> 00:29:54,240
like who is lookups and it's got

838
00:29:52,559 --> 00:29:57,120
just like really straightforward

839
00:29:54,240 --> 00:29:58,320
no-nonsense interface

840
00:29:57,120 --> 00:30:00,399
where you can just like type in things

841
00:29:58,320 --> 00:30:03,840
and get the results no captures no login

842
00:30:00,399 --> 00:30:06,080
whatever it's actually really helpful

843
00:30:03,840 --> 00:30:09,120
uh another tool i used for this was

844
00:30:06,080 --> 00:30:11,840
curtis which has this sort of

845
00:30:09,120 --> 00:30:13,840
android malware research platform so

846
00:30:11,840 --> 00:30:15,039
they have this massive database for 55

847
00:30:13,840 --> 00:30:16,639
million samples

848
00:30:15,039 --> 00:30:18,960
and stunts more getting uploaded all the

849
00:30:16,640 --> 00:30:20,720
time so

850
00:30:18,960 --> 00:30:22,080
anyone can use it unlike somebody some

851
00:30:20,720 --> 00:30:24,880
of these services

852
00:30:22,080 --> 00:30:26,799
like i believe virustotal is still a

853
00:30:24,880 --> 00:30:28,480
service where only like

854
00:30:26,799 --> 00:30:30,879
certain registered researchers can get

855
00:30:28,480 --> 00:30:32,720
samples but this just lets anyone get

856
00:30:30,880 --> 00:30:36,240
them

857
00:30:32,720 --> 00:30:38,080
you can set up yara rule sets so

858
00:30:36,240 --> 00:30:39,840
it will scan all new uploads against the

859
00:30:38,080 --> 00:30:41,279
rules that you specify and tell you if

860
00:30:39,840 --> 00:30:42,158
it finds any matches which is really

861
00:30:41,279 --> 00:30:45,840
helpful

862
00:30:42,159 --> 00:30:49,679
if you want to find say new samples of

863
00:30:45,840 --> 00:30:52,799
at adwords deployed by this one company

864
00:30:49,679 --> 00:30:56,000
so this is an example rules as i made so

865
00:30:52,799 --> 00:30:57,200
it's checks to see if uh apks meet

866
00:30:56,000 --> 00:31:00,240
certain patterns so

867
00:30:57,200 --> 00:31:01,919
like services and then with this svc

868
00:31:00,240 --> 00:31:04,799
suffix i always saw show up

869
00:31:01,919 --> 00:31:06,320
or these like unique strings that i

870
00:31:04,799 --> 00:31:08,158
always saw being used like certain

871
00:31:06,320 --> 00:31:10,720
encryption keys

872
00:31:08,159 --> 00:31:13,200
and as it turns out this actually found

873
00:31:10,720 --> 00:31:17,039
me a few

874
00:31:13,200 --> 00:31:19,919
so there's some some recent samples that

875
00:31:17,039 --> 00:31:21,120
kudos found based of these rules the

876
00:31:19,919 --> 00:31:24,399
most recent one

877
00:31:21,120 --> 00:31:27,439
that com.perspective.refrigeration app

878
00:31:24,399 --> 00:31:28,799
called frigg was just uploaded to curtis

879
00:31:27,440 --> 00:31:30,880
two weeks ago

880
00:31:28,799 --> 00:31:33,120
there's com.impressionist stutter

881
00:31:30,880 --> 00:31:36,159
fashionable

882
00:31:33,120 --> 00:31:36,959
i mean can't i can't argue with that

883
00:31:36,159 --> 00:31:39,200
sort of naming

884
00:31:36,960 --> 00:31:42,080
they must have spent billions on a

885
00:31:39,200 --> 00:31:44,320
marketing firm for that

886
00:31:42,080 --> 00:31:46,320
now sandy you can't retroactively apply

887
00:31:44,320 --> 00:31:48,480
these yara rules to prior uploads

888
00:31:46,320 --> 00:31:51,439
so there's probably a lot more samples

889
00:31:48,480 --> 00:31:53,279
of digitime adware in kurdish that

890
00:31:51,440 --> 00:31:55,840
are a bit harder to find because i can't

891
00:31:53,279 --> 00:31:57,440
apply these searches to them

892
00:31:55,840 --> 00:31:59,360
but they do still let you search by some

893
00:31:57,440 --> 00:32:00,799
parameters presumably these are indexed

894
00:31:59,360 --> 00:32:02,158
in the back ends

895
00:32:00,799 --> 00:32:04,480
so you can search by things like the

896
00:32:02,159 --> 00:32:06,480
package name the developer name

897
00:32:04,480 --> 00:32:07,840
from the certificates that's the package

898
00:32:06,480 --> 00:32:09,840
assigned with

899
00:32:07,840 --> 00:32:12,158
you can search by the domains that get

900
00:32:09,840 --> 00:32:14,799
referenced inside of that app

901
00:32:12,159 --> 00:32:15,760
and this got there's gotta be some

902
00:32:14,799 --> 00:32:18,720
interesting things

903
00:32:15,760 --> 00:32:20,158
so i searched for the prefix used by the

904
00:32:18,720 --> 00:32:23,919
updater and they found some other

905
00:32:20,159 --> 00:32:23,919
samples of the digitime updater

906
00:32:24,480 --> 00:32:29,840
you can search by certificate and find

907
00:32:26,320 --> 00:32:29,840
other weird apps like this

908
00:32:30,880 --> 00:32:36,080
i searched for the url of the old ota

909
00:32:34,240 --> 00:32:38,159
like server domain and actually found

910
00:32:36,080 --> 00:32:40,320
some adware so i guess at one point they

911
00:32:38,159 --> 00:32:41,840
weren't

912
00:32:40,320 --> 00:32:43,678
they weren't as good as separating the

913
00:32:41,840 --> 00:32:45,279
two sides as they are now so

914
00:32:43,679 --> 00:32:46,880
these bits of hardware were actually

915
00:32:45,279 --> 00:32:50,399
talking to the same domain that they

916
00:32:46,880 --> 00:32:50,399
used for their updates at the time

917
00:32:52,640 --> 00:32:57,279
does this case were like apps with the

918
00:32:55,039 --> 00:33:02,399
same package id and name showed up

919
00:32:57,279 --> 00:33:02,399
with different random certificates names

920
00:33:03,440 --> 00:33:06,960
and then sometimes you'd get like the

921
00:33:05,600 --> 00:33:08,879
same package id with different

922
00:33:06,960 --> 00:33:12,480
random english words names like

923
00:33:08,880 --> 00:33:13,600
coordinator and provision and devices

924
00:33:12,480 --> 00:33:15,600
you can see they couldn't even be

925
00:33:13,600 --> 00:33:18,959
bothered to put in an icon it's just the

926
00:33:15,600 --> 00:33:21,600
default android app icon

927
00:33:18,960 --> 00:33:23,200
and then sometimes it's just utter utter

928
00:33:21,600 --> 00:33:25,840
complete nonsense

929
00:33:23,200 --> 00:33:25,840
like

930
00:33:26,880 --> 00:33:30,960
and rocks that's rox one showed up on a

931
00:33:29,279 --> 00:33:33,120
subreddit someone made

932
00:33:30,960 --> 00:33:34,640
called r slash wrestling seven malwares

933
00:33:33,120 --> 00:33:36,080
just to chronic

934
00:33:34,640 --> 00:33:37,760
chronicle all of the adwords that

935
00:33:36,080 --> 00:33:40,000
staggered battery 7 got from the

936
00:33:37,760 --> 00:33:42,320
time but it's only ever got like three

937
00:33:40,000 --> 00:33:44,080
posts sadly

938
00:33:42,320 --> 00:33:45,840
so i'm not going to go into all the

939
00:33:44,080 --> 00:33:47,439
details because i've already like spent

940
00:33:45,840 --> 00:33:48,480
enough time on this little part of it

941
00:33:47,440 --> 00:33:51,519
and there's more

942
00:33:48,480 --> 00:33:53,519
but i found literally hundreds of adware

943
00:33:51,519 --> 00:33:56,000
apks

944
00:33:53,519 --> 00:33:57,039
and they used a bunch of different weird

945
00:33:56,000 --> 00:34:00,320
domain names like

946
00:33:57,039 --> 00:34:03,720
google global.com and gmscenter.org

947
00:34:00,320 --> 00:34:06,639
and androidsecurityteam.club and

948
00:34:03,720 --> 00:34:08,399
bugreportsync.com and then at one point

949
00:34:06,640 --> 00:34:11,040
they just gave up and switched to

950
00:34:08,399 --> 00:34:11,679
host hotel.xyz which doesn't even try to

951
00:34:11,040 --> 00:34:14,719
sound

952
00:34:11,679 --> 00:34:17,280
legit that's that was one they did like

953
00:34:14,719 --> 00:34:17,279
last month

954
00:34:17,359 --> 00:34:21,359
there were a few of these samples

955
00:34:19,199 --> 00:34:22,638
amongst all of the like crap names just

956
00:34:21,359 --> 00:34:24,639
pretending to be

957
00:34:22,639 --> 00:34:27,200
legit developers like there was one

958
00:34:24,639 --> 00:34:28,800
pretending to be alibaba

959
00:34:27,199 --> 00:34:30,239
lots of random english words i can

960
00:34:28,800 --> 00:34:33,359
mentions

961
00:34:30,239 --> 00:34:34,638
lots of weird certificate names like

962
00:34:33,359 --> 00:34:37,918
some of them just use the default

963
00:34:34,639 --> 00:34:39,520
android some were just mediatek

964
00:34:37,918 --> 00:34:41,279
some of them just used like random

965
00:34:39,520 --> 00:34:44,960
business names in texas

966
00:34:41,280 --> 00:34:47,919
like jcpenney and michelangelo's

967
00:34:44,960 --> 00:34:49,440
so some of them we used the package ids

968
00:34:47,918 --> 00:34:51,118
like conventions

969
00:34:49,440 --> 00:34:53,359
uh i feel bad for those businesses

970
00:34:51,119 --> 00:34:54,159
because you know i don't think singular

971
00:34:53,359 --> 00:34:58,399
apparel

972
00:34:54,159 --> 00:34:58,399
is actually developing android malware

973
00:34:58,480 --> 00:35:03,440
and chilly really soft ice is probably

974
00:35:00,640 --> 00:35:06,480
also not distributing malwarebets

975
00:35:03,440 --> 00:35:06,480
you never know i guess

976
00:35:07,839 --> 00:35:12,000
so you may remember i also mentioned

977
00:35:10,160 --> 00:35:13,598
like these also generated command and

978
00:35:12,000 --> 00:35:15,280
control domains

979
00:35:13,599 --> 00:35:18,640
like very near the starts when i had the

980
00:35:15,280 --> 00:35:21,599
screenshot of this tweet i made

981
00:35:18,640 --> 00:35:23,440
so yesterday i decided to look into

982
00:35:21,599 --> 00:35:25,920
these again and as it turns out

983
00:35:23,440 --> 00:35:28,640
since i did my original research they

984
00:35:25,920 --> 00:35:32,800
had actually registered some of them

985
00:35:28,640 --> 00:35:35,279
so they registered the one for july 2019

986
00:35:32,800 --> 00:35:36,320
and they had it resolving for about

987
00:35:35,280 --> 00:35:39,520
three months

988
00:35:36,320 --> 00:35:41,280
they registered the one for january 2020

989
00:35:39,520 --> 00:35:43,280
and they had they had it resolving for

990
00:35:41,280 --> 00:35:45,920
about half of the month

991
00:35:43,280 --> 00:35:47,359
and they registered the ones for this

992
00:35:45,920 --> 00:35:48,480
month and next month but they haven't

993
00:35:47,359 --> 00:35:51,520
actually

994
00:35:48,480 --> 00:35:51,520
made it to anything yet

995
00:35:51,599 --> 00:35:54,640
uh securitytrails.com was really helpful

996
00:35:53,760 --> 00:35:57,119
for this because

997
00:35:54,640 --> 00:35:58,560
you can just type in a domain and it

998
00:35:57,119 --> 00:35:59,359
will show you all of the historical

999
00:35:58,560 --> 00:36:02,078
records

1000
00:35:59,359 --> 00:36:04,160
so you can see like which ip address

1001
00:36:02,079 --> 00:36:07,440
this domain resolved to in the past and

1002
00:36:04,160 --> 00:36:09,118
what dates it resolves to main on

1003
00:36:07,440 --> 00:36:10,960
and this is all like available for free

1004
00:36:09,119 --> 00:36:12,880
without login so

1005
00:36:10,960 --> 00:36:14,000
this is how i was able to learn

1006
00:36:12,880 --> 00:36:16,160
yesterday that

1007
00:36:14,000 --> 00:36:17,760
they they had registered this domain in

1008
00:36:16,160 --> 00:36:20,160
july and they were using it for three

1009
00:36:17,760 --> 00:36:20,160
months

1010
00:36:20,720 --> 00:36:24,240
so i don't actually know what they did

1011
00:36:22,320 --> 00:36:25,359
with this they haven't even registered

1012
00:36:24,240 --> 00:36:27,439
the last two of them

1013
00:36:25,359 --> 00:36:29,279
and of course all of these have like

1014
00:36:27,440 --> 00:36:32,720
random names and random addresses in the

1015
00:36:29,280 --> 00:36:35,839
who is info as you might expect

1016
00:36:32,720 --> 00:36:37,520
but i've spoken enough about like these

1017
00:36:35,839 --> 00:36:39,040
random foreigns into that infrastructure

1018
00:36:37,520 --> 00:36:44,240
for now so i'm

1019
00:36:39,040 --> 00:36:46,880
to go back to the firmware on my cosmo

1020
00:36:44,240 --> 00:36:47,279
so we've seen now that they have like

1021
00:36:46,880 --> 00:36:50,560
this

1022
00:36:47,280 --> 00:36:53,599
this weird ota app with like

1023
00:36:50,560 --> 00:36:55,119
remote newer execution but

1024
00:36:53,599 --> 00:36:56,880
imagine that you're at that time and you

1025
00:36:55,119 --> 00:36:57,359
have this much power people are paying

1026
00:36:56,880 --> 00:36:59,760
you

1027
00:36:57,359 --> 00:37:01,440
to install this app and you're using it

1028
00:36:59,760 --> 00:37:03,119
to run arbitrary code and install

1029
00:37:01,440 --> 00:37:05,760
arbitrary adware apps

1030
00:37:03,119 --> 00:37:07,280
but this is still not enough for you you

1031
00:37:05,760 --> 00:37:09,200
want more power

1032
00:37:07,280 --> 00:37:12,800
the next level of course is to convince

1033
00:37:09,200 --> 00:37:12,799
your customers to back door the os

1034
00:37:12,960 --> 00:37:16,640
so the cosmo chapter of this android

1035
00:37:16,000 --> 00:37:20,720
service

1036
00:37:16,640 --> 00:37:22,240
fosl enhance so this has some really

1037
00:37:20,720 --> 00:37:25,359
exciting features

1038
00:37:22,240 --> 00:37:27,118
so it has arbitrary file reads write and

1039
00:37:25,359 --> 00:37:29,839
delete privileges with

1040
00:37:27,119 --> 00:37:31,200
with system privileges so you can use

1041
00:37:29,839 --> 00:37:33,119
this to read things like the accounts

1042
00:37:31,200 --> 00:37:36,160
database for instance

1043
00:37:33,119 --> 00:37:37,920
you know you might want that sometime

1044
00:37:36,160 --> 00:37:39,520
you can want any permission to any app

1045
00:37:37,920 --> 00:37:41,839
dynamically you don't even need to

1046
00:37:39,520 --> 00:37:44,480
restart the app you just call the method

1047
00:37:41,839 --> 00:37:46,320
and that permission goes in right away

1048
00:37:44,480 --> 00:37:48,240
like the implementation actually just

1049
00:37:46,320 --> 00:37:50,560
delves into the internal os structures

1050
00:37:48,240 --> 00:37:52,640
using java reflection and messes with

1051
00:37:50,560 --> 00:37:54,560
them

1052
00:37:52,640 --> 00:37:56,799
you can silently install and remove apps

1053
00:37:54,560 --> 00:37:58,640
in case the pm command isn't good enough

1054
00:37:56,800 --> 00:38:02,000
for you

1055
00:37:58,640 --> 00:38:04,319
you can read phone information into json

1056
00:38:02,000 --> 00:38:06,079
and they even encrypt encrypted for you

1057
00:38:04,320 --> 00:38:07,839
just to make your job easier

1058
00:38:06,079 --> 00:38:11,839
and if you need to decrypt it the key is

1059
00:38:07,839 --> 00:38:13,759
only five bytes and it's a constant so

1060
00:38:11,839 --> 00:38:15,200
you can fetch the last known gps

1061
00:38:13,760 --> 00:38:16,880
location of the device

1062
00:38:15,200 --> 00:38:18,560
and once again without permissions of

1063
00:38:16,880 --> 00:38:21,040
course

1064
00:38:18,560 --> 00:38:23,680
and that's more but the rest aren't even

1065
00:38:21,040 --> 00:38:26,240
that interesting

1066
00:38:23,680 --> 00:38:26,799
and you know so even if you give this

1067
00:38:26,240 --> 00:38:28,399
back to

1068
00:38:26,800 --> 00:38:29,920
oems you want to make sure that they

1069
00:38:28,400 --> 00:38:31,440
actually use it

1070
00:38:29,920 --> 00:38:33,280
like you wouldn't want them to leave it

1071
00:38:31,440 --> 00:38:34,880
out so

1072
00:38:33,280 --> 00:38:36,720
the ot app data only works if the

1073
00:38:34,880 --> 00:38:38,240
backdoor is there it doesn't use any of

1074
00:38:36,720 --> 00:38:40,240
those features it just calls the one

1075
00:38:38,240 --> 00:38:42,720
method that returns the version number

1076
00:38:40,240 --> 00:38:43,759
and if that method fails then it won't

1077
00:38:42,720 --> 00:38:47,359
install updates

1078
00:38:43,760 --> 00:38:49,680
so that's the incentive for you the oem

1079
00:38:47,359 --> 00:38:52,640
to keep the back door in

1080
00:38:49,680 --> 00:38:53,440
so i'm going to show you how how this is

1081
00:38:52,640 --> 00:38:56,078
secured

1082
00:38:53,440 --> 00:38:57,760
how they stop like people who are not

1083
00:38:56,079 --> 00:39:01,599
that your time from using these

1084
00:38:57,760 --> 00:39:03,839
like really powerful features so

1085
00:39:01,599 --> 00:39:05,119
it takes in a string which is passed

1086
00:39:03,839 --> 00:39:07,839
when you call the function

1087
00:39:05,119 --> 00:39:10,079
and it compares it against this thing

1088
00:39:07,839 --> 00:39:13,279
uis teo pck

1089
00:39:10,079 --> 00:39:14,880
and if you don't pass that string it

1090
00:39:13,280 --> 00:39:18,960
logs check uid not

1091
00:39:14,880 --> 00:39:20,400
pass and it throws an exception so

1092
00:39:18,960 --> 00:39:22,160
if you ever want to use this backdoor

1093
00:39:20,400 --> 00:39:24,720
you just have to pass that string and

1094
00:39:22,160 --> 00:39:26,319
you can do whatever you want

1095
00:39:24,720 --> 00:39:28,000
so on the next three slides i'm going to

1096
00:39:26,320 --> 00:39:31,760
show you how how

1097
00:39:28,000 --> 00:39:31,760
little code you need to exploit this

1098
00:39:31,920 --> 00:39:36,560
so here's a a few lines of kotlin which

1099
00:39:34,800 --> 00:39:39,440
use the android

1100
00:39:36,560 --> 00:39:41,040
remote thing to call into one service so

1101
00:39:39,440 --> 00:39:42,160
this is the get service method that

1102
00:39:41,040 --> 00:39:44,960
returns

1103
00:39:42,160 --> 00:39:46,720
another binder which is android's well

1104
00:39:44,960 --> 00:39:48,960
one of android's mechanisms for

1105
00:39:46,720 --> 00:39:51,759
letting processors talk to each other so

1106
00:39:48,960 --> 00:39:53,920
you call that to get one binder

1107
00:39:51,760 --> 00:39:55,520
then you use that binder and make

1108
00:39:53,920 --> 00:39:57,359
another remote method call

1109
00:39:55,520 --> 00:39:59,280
so you pass that key and you pass some

1110
00:39:57,359 --> 00:40:01,359
data

1111
00:39:59,280 --> 00:40:03,200
and then once you have these two tools

1112
00:40:01,359 --> 00:40:05,920
you can use them

1113
00:40:03,200 --> 00:40:07,279
grant permissions package name list of

1114
00:40:05,920 --> 00:40:09,599
the permissions you want

1115
00:40:07,280 --> 00:40:10,800
and now you can use those features you

1116
00:40:09,599 --> 00:40:12,319
don't even have to like

1117
00:40:10,800 --> 00:40:14,000
declare those permissions you don't have

1118
00:40:12,319 --> 00:40:16,720
to get the user to agree to them

1119
00:40:14,000 --> 00:40:19,280
just use the back door it's easy thanks

1120
00:40:16,720 --> 00:40:19,279
to the time

1121
00:40:20,400 --> 00:40:25,040
so i'm gonna summarize where we're at so

1122
00:40:23,040 --> 00:40:26,480
far so

1123
00:40:25,040 --> 00:40:29,839
we have this updater with a hidden

1124
00:40:26,480 --> 00:40:31,520
service that executes arbitrary lure

1125
00:40:29,839 --> 00:40:34,560
we we've seen evidence that they've used

1126
00:40:31,520 --> 00:40:36,800
this to deploy adware already

1127
00:40:34,560 --> 00:40:37,759
we've seen like some fairly conclusive

1128
00:40:36,800 --> 00:40:39,839
evidence that

1129
00:40:37,760 --> 00:40:41,760
this is either developed by the same

1130
00:40:39,839 --> 00:40:42,720
people or heavily tied to them

1131
00:40:41,760 --> 00:40:44,319
considering

1132
00:40:42,720 --> 00:40:46,720
how much chad infrastructure there is

1133
00:40:44,319 --> 00:40:49,040
like internal ids

1134
00:40:46,720 --> 00:40:50,560
being generated by the worker system and

1135
00:40:49,040 --> 00:40:53,599
then being used by the adwords

1136
00:40:50,560 --> 00:40:56,078
phone home we've seen that's the

1137
00:40:53,599 --> 00:40:57,920
variant on my cosmo also shipped with an

1138
00:40:56,079 --> 00:40:59,440
android backdoor

1139
00:40:57,920 --> 00:41:01,359
i didn't see any evidence of it being

1140
00:40:59,440 --> 00:41:03,119
used but of course

1141
00:41:01,359 --> 00:41:05,119
all that will take for them to start

1142
00:41:03,119 --> 00:41:09,920
using it is for them to act to just

1143
00:41:05,119 --> 00:41:09,920
flip a switch and send me the m worker

1144
00:41:10,079 --> 00:41:14,079
and it can be used by any app as you've

1145
00:41:12,480 --> 00:41:16,880
seen there's just this one static

1146
00:41:14,079 --> 00:41:18,960
password protecting it

1147
00:41:16,880 --> 00:41:20,480
and there's evidence that there's other

1148
00:41:18,960 --> 00:41:23,200
versions of the backdoor

1149
00:41:20,480 --> 00:41:24,800
because of that that piece of code i saw

1150
00:41:23,200 --> 00:41:26,078
in the worker where it checks the host

1151
00:41:24,800 --> 00:41:27,520
apk's version

1152
00:41:26,079 --> 00:41:29,760
and that calls into different macd

1153
00:41:27,520 --> 00:41:32,560
methods depending on the version number

1154
00:41:29,760 --> 00:41:34,480
but i don't actually have sample apks

1155
00:41:32,560 --> 00:41:35,520
for those updaters and i don't know what

1156
00:41:34,480 --> 00:41:37,040
devices have them

1157
00:41:35,520 --> 00:41:38,880
so i can't actually look at the firmware

1158
00:41:37,040 --> 00:41:41,440
to figure out how those back doors work

1159
00:41:38,880 --> 00:41:42,079
like maybe they're more secure maybe

1160
00:41:41,440 --> 00:41:44,480
those

1161
00:41:42,079 --> 00:41:45,839
take some some precautions to like only

1162
00:41:44,480 --> 00:41:47,359
let certain snaps use them

1163
00:41:45,839 --> 00:41:48,960
maybe they have even more power i just

1164
00:41:47,359 --> 00:41:51,200
don't know maybe they never even

1165
00:41:48,960 --> 00:41:54,160
deployed them

1166
00:41:51,200 --> 00:41:54,560
so by this point i was fairly convinced

1167
00:41:54,160 --> 00:41:56,799
that

1168
00:41:54,560 --> 00:41:57,920
this was not just a misunderstanding

1169
00:41:56,800 --> 00:42:01,200
this actually looks

1170
00:41:57,920 --> 00:42:02,000
really heavily malicious so i decided to

1171
00:42:01,200 --> 00:42:05,279
do the responsible

1172
00:42:02,000 --> 00:42:08,480
thing and notify the vendor so

1173
00:42:05,280 --> 00:42:09,920
i wrote this email to planet computer

1174
00:42:08,480 --> 00:42:11,839
support

1175
00:42:09,920 --> 00:42:13,280
this really long write up like hey i'm

1176
00:42:11,839 --> 00:42:15,119
concerned about this

1177
00:42:13,280 --> 00:42:16,640
do you know about this please look into

1178
00:42:15,119 --> 00:42:18,160
it i would like to use this phone i've

1179
00:42:16,640 --> 00:42:20,319
paid 500 pounds for

1180
00:42:18,160 --> 00:42:23,040
without worrying about these big

1181
00:42:20,319 --> 00:42:25,359
security issues

1182
00:42:23,040 --> 00:42:28,480
so this was about two days after i'd

1183
00:42:25,359 --> 00:42:30,160
started investigating

1184
00:42:28,480 --> 00:42:32,000
and they got back to me the next day

1185
00:42:30,160 --> 00:42:33,759
with this generic reply like

1186
00:42:32,000 --> 00:42:35,200
we appreciate the time you spent writing

1187
00:42:33,760 --> 00:42:37,839
this we've passed it over

1188
00:42:35,200 --> 00:42:39,040
but we can't discuss this which okay

1189
00:42:37,839 --> 00:42:40,960
that's fair

1190
00:42:39,040 --> 00:42:42,560
they're probably not gonna tell me many

1191
00:42:40,960 --> 00:42:44,240
details especially when they've just

1192
00:42:42,560 --> 00:42:47,920
come out of nowhere with this

1193
00:42:44,240 --> 00:42:50,799
and at least it's not a legal threat

1194
00:42:47,920 --> 00:42:52,560
so i wasn't too optimistic but it could

1195
00:42:50,800 --> 00:42:54,000
have gone worse

1196
00:42:52,560 --> 00:42:56,000
so i kept on doing some of my own

1197
00:42:54,000 --> 00:42:58,960
research which led to some of the other

1198
00:42:56,000 --> 00:43:02,160
stuff that i've already talked about

1199
00:42:58,960 --> 00:43:02,960
so here's a loose timeline of how things

1200
00:43:02,160 --> 00:43:06,399
went

1201
00:43:02,960 --> 00:43:07,520
so the day after i got that reply from

1202
00:43:06,400 --> 00:43:09,280
planet

1203
00:43:07,520 --> 00:43:10,839
i started getting this new build of the

1204
00:43:09,280 --> 00:43:13,520
worker on my cosmo

1205
00:43:10,839 --> 00:43:15,279
which it was obviously a new build

1206
00:43:13,520 --> 00:43:17,440
because the files inside the zip file

1207
00:43:15,280 --> 00:43:19,760
had a new timestamp

1208
00:43:17,440 --> 00:43:22,240
and they've taken out every piece of

1209
00:43:19,760 --> 00:43:24,319
functionality from it

1210
00:43:22,240 --> 00:43:26,720
so it's like is this a coincidence or

1211
00:43:24,319 --> 00:43:28,400
have planets made inquiries and

1212
00:43:26,720 --> 00:43:29,759
have digital time realize that the game

1213
00:43:28,400 --> 00:43:30,960
is up now

1214
00:43:29,760 --> 00:43:33,839
and they're like trying to cover their

1215
00:43:30,960 --> 00:43:37,119
tracks so i wasn't quite sure

1216
00:43:33,839 --> 00:43:39,440
but i kept on investigating things

1217
00:43:37,119 --> 00:43:42,319
one day later they pushed another belt

1218
00:43:39,440 --> 00:43:44,720
to the gretel a7 but not the cosmo

1219
00:43:42,319 --> 00:43:47,200
so this one was basically the same as

1220
00:43:44,720 --> 00:43:49,520
what i previously had on my cosmo

1221
00:43:47,200 --> 00:43:52,720
like the base b worker that did some

1222
00:43:49,520 --> 00:43:55,040
things but not the most dodgy things

1223
00:43:52,720 --> 00:43:56,799
but it was obviously freshly compiled

1224
00:43:55,040 --> 00:44:01,440
because it had a new version number

1225
00:43:56,800 --> 00:44:04,160
and it had new dates the 5th of december

1226
00:44:01,440 --> 00:44:05,040
so not much change on the infrastructure

1227
00:44:04,160 --> 00:44:08,399
side of things

1228
00:44:05,040 --> 00:44:10,720
and i also took a break from it but then

1229
00:44:08,400 --> 00:44:13,920
on the 8th of january i received an a

1230
00:44:10,720 --> 00:44:16,480
very long email from planet cto

1231
00:44:13,920 --> 00:44:18,240
with a follow-up explaining some things

1232
00:44:16,480 --> 00:44:20,480
thanking me for my efforts and

1233
00:44:18,240 --> 00:44:22,160
confirming that they had actually

1234
00:44:20,480 --> 00:44:24,240
started looking into this right after

1235
00:44:22,160 --> 00:44:27,440
i'd emailed them

1236
00:44:24,240 --> 00:44:29,598
so there was some explanation the reason

1237
00:44:27,440 --> 00:44:32,800
they went with digitime was because

1238
00:44:29,599 --> 00:44:34,560
it was suggested by east and the odm

1239
00:44:32,800 --> 00:44:36,000
and the reason that easter egg only used

1240
00:44:34,560 --> 00:44:38,078
digitime and not stir google

1241
00:44:36,000 --> 00:44:40,560
app data is because they are in china

1242
00:44:38,079 --> 00:44:41,520
and usually cannot ship devices with

1243
00:44:40,560 --> 00:44:43,200
google services

1244
00:44:41,520 --> 00:44:45,040
so of course they have to look for

1245
00:44:43,200 --> 00:44:48,399
alternatives

1246
00:44:45,040 --> 00:44:49,759
but he also said that the that eastern

1247
00:44:48,400 --> 00:44:51,520
had a good relationship with them and

1248
00:44:49,760 --> 00:44:51,920
had never had any issues and recommended

1249
00:44:51,520 --> 00:44:56,400
them

1250
00:44:51,920 --> 00:44:57,760
so planet was entirely unaware and

1251
00:44:56,400 --> 00:45:00,079
really shocked to find out

1252
00:44:57,760 --> 00:45:01,680
that this company they trusted was

1253
00:45:00,079 --> 00:45:02,960
actually betraying the trust of all of

1254
00:45:01,680 --> 00:45:05,200
their customers

1255
00:45:02,960 --> 00:45:07,280
you know as like this small startup who

1256
00:45:05,200 --> 00:45:07,680
has been battling with lots of pr issues

1257
00:45:07,280 --> 00:45:09,520
and

1258
00:45:07,680 --> 00:45:10,799
being betrayed by the factory on things

1259
00:45:09,520 --> 00:45:13,119
like shadiels

1260
00:45:10,800 --> 00:45:13,839
the last thing you want is to know that

1261
00:45:13,119 --> 00:45:15,520
your

1262
00:45:13,839 --> 00:45:17,119
update provider is also screwing with

1263
00:45:15,520 --> 00:45:19,359
you

1264
00:45:17,119 --> 00:45:22,640
and after some badgering then just time

1265
00:45:19,359 --> 00:45:24,480
agreed to remove the back doors

1266
00:45:22,640 --> 00:45:27,040
i also noticed that the same day the

1267
00:45:24,480 --> 00:45:29,599
boot server stopped working

1268
00:45:27,040 --> 00:45:31,520
which is the one that's the like

1269
00:45:29,599 --> 00:45:33,680
starting lure package users as

1270
00:45:31,520 --> 00:45:36,400
a as a bootstrapping point to to

1271
00:45:33,680 --> 00:45:38,000
download more things

1272
00:45:36,400 --> 00:45:40,720
so i need more space because there's

1273
00:45:38,000 --> 00:45:42,640
just so many events

1274
00:45:40,720 --> 00:45:44,240
the next day they move their cdn to a

1275
00:45:42,640 --> 00:45:44,960
new domain and they take their websites

1276
00:45:44,240 --> 00:45:48,680
down

1277
00:45:44,960 --> 00:45:51,680
so the cdn goes from facebookford.com to

1278
00:45:48,680 --> 00:45:51,680
hosthotel.xyz

1279
00:45:52,000 --> 00:45:56,079
they repoint the a records for their

1280
00:45:54,000 --> 00:45:57,040
websites to these random residential ip

1281
00:45:56,079 --> 00:45:59,520
addresses

1282
00:45:57,040 --> 00:46:00,880
which of course do not have any websites

1283
00:45:59,520 --> 00:46:02,480
and to this day

1284
00:46:00,880 --> 00:46:05,040
they have not changed they're still

1285
00:46:02,480 --> 00:46:06,640
pointed to these random ip addresses

1286
00:46:05,040 --> 00:46:09,759
i think one's in mexico and the other

1287
00:46:06,640 --> 00:46:11,839
ones in spain or something

1288
00:46:09,760 --> 00:46:13,200
but they did keep up the update servers

1289
00:46:11,839 --> 00:46:14,960
they kept up all of the command and

1290
00:46:13,200 --> 00:46:17,359
control stuff for the malwa

1291
00:46:14,960 --> 00:46:20,800
and they kept up the manufacture portal

1292
00:46:17,359 --> 00:46:24,240
for oems to upload new stuff

1293
00:46:20,800 --> 00:46:25,440
so then the next day i got an email from

1294
00:46:24,240 --> 00:46:26,879
planets like hey

1295
00:46:25,440 --> 00:46:28,800
did the time have sent us this new

1296
00:46:26,880 --> 00:46:30,400
package do you want to look at it

1297
00:46:28,800 --> 00:46:32,000
and make sure they've actually taken out

1298
00:46:30,400 --> 00:46:35,440
the malware

1299
00:46:32,000 --> 00:46:37,200
so i looked into it they've taken out

1300
00:46:35,440 --> 00:46:40,319
all of the lure stuff so basically the

1301
00:46:37,200 --> 00:46:42,000
entire red side i discussed earlier

1302
00:46:40,319 --> 00:46:43,359
they'd replace all of the login text

1303
00:46:42,000 --> 00:46:45,520
with numbers

1304
00:46:43,359 --> 00:46:48,240
to probably to make it harder for me to

1305
00:46:45,520 --> 00:46:50,800
understand the java code

1306
00:46:48,240 --> 00:46:52,640
they'd kept the os backdoor but all of

1307
00:46:50,800 --> 00:46:55,119
the features were gone so it just like

1308
00:46:52,640 --> 00:46:56,560
sits down and does nothing which fine

1309
00:46:55,119 --> 00:47:00,319
okay you can do that

1310
00:46:56,560 --> 00:47:02,078
that works and they also took out that

1311
00:47:00,319 --> 00:47:04,000
all of the gdpr compliance stuff and

1312
00:47:02,079 --> 00:47:05,839
just made this operates in the maximum

1313
00:47:04,000 --> 00:47:10,240
privacy mode all the time

1314
00:47:05,839 --> 00:47:13,359
okay fine that's an improvement

1315
00:47:10,240 --> 00:47:15,040
so here is the official statement that

1316
00:47:13,359 --> 00:47:17,440
planets released

1317
00:47:15,040 --> 00:47:19,279
so i highlighted a couple of points the

1318
00:47:17,440 --> 00:47:21,359
oem trusts at a time

1319
00:47:19,280 --> 00:47:23,280
and then had problems with them and the

1320
00:47:21,359 --> 00:47:25,040
explanation from the time is that

1321
00:47:23,280 --> 00:47:28,400
this code was designed to hard fix the

1322
00:47:25,040 --> 00:47:30,960
application in case of serious bugs

1323
00:47:28,400 --> 00:47:32,880
i don't buy that and they also thanked

1324
00:47:30,960 --> 00:47:36,559
me for the disclosure and for confirming

1325
00:47:32,880 --> 00:47:36,559
that they had taken out these risks

1326
00:47:36,880 --> 00:47:42,319
so the cosmo rom is now patched but

1327
00:47:40,960 --> 00:47:45,040
that hasn't stopped them from doing

1328
00:47:42,319 --> 00:47:46,800
things with other devices of course

1329
00:47:45,040 --> 00:47:49,599
so yesterday i decided to poke the

1330
00:47:46,800 --> 00:47:51,839
servers a little bit more

1331
00:47:49,599 --> 00:47:52,960
so i sent her requests pretending to be

1332
00:47:51,839 --> 00:47:56,960
my cosmo

1333
00:47:52,960 --> 00:47:58,559
on the last worker version they released

1334
00:47:56,960 --> 00:48:00,079
i've i did some of the fields because

1335
00:47:58,559 --> 00:48:00,640
otherwise this will fill two slides

1336
00:48:00,079 --> 00:48:02,160
worth

1337
00:48:00,640 --> 00:48:03,759
or you would not be able to read any of

1338
00:48:02,160 --> 00:48:06,319
it

1339
00:48:03,760 --> 00:48:07,359
so i get a new reply back download this

1340
00:48:06,319 --> 00:48:10,400
new worker

1341
00:48:07,359 --> 00:48:12,720
from host hotel.xyzad so it's gone up to

1342
00:48:10,400 --> 00:48:14,720
version 1.7 from 1.6

1343
00:48:12,720 --> 00:48:17,680
and the code instead of being one letter

1344
00:48:14,720 --> 00:48:17,680
is now just yeah

1345
00:48:18,480 --> 00:48:22,240
so i download this and i unpack it so

1346
00:48:21,200 --> 00:48:24,640
it's a new version

1347
00:48:22,240 --> 00:48:26,000
and the files like the lower byte code

1348
00:48:24,640 --> 00:48:28,400
files inside are dated

1349
00:48:26,000 --> 00:48:29,359
the 8th of february so this is quite

1350
00:48:28,400 --> 00:48:31,119
recent

1351
00:48:29,359 --> 00:48:32,640
this is from like three days after they

1352
00:48:31,119 --> 00:48:34,880
got back from chinese new year

1353
00:48:32,640 --> 00:48:36,160
and fixed the downtime they were having

1354
00:48:34,880 --> 00:48:37,920
for weeks

1355
00:48:36,160 --> 00:48:41,040
so it didn't take long for them to start

1356
00:48:37,920 --> 00:48:42,960
pushing more junk here

1357
00:48:41,040 --> 00:48:45,359
i decided to death it against previous

1358
00:48:42,960 --> 00:48:45,359
version

1359
00:48:45,440 --> 00:48:48,720
so they they moved the server at talks

1360
00:48:47,920 --> 00:48:50,400
to so

1361
00:48:48,720 --> 00:48:52,000
now instead of talking to flowy data it

1362
00:48:50,400 --> 00:48:53,280
talks to bug report sync

1363
00:48:52,000 --> 00:48:55,119
they moved to ap they moved the

1364
00:48:53,280 --> 00:48:58,079
endpoints

1365
00:48:55,119 --> 00:48:58,079
they changed the key

1366
00:48:58,160 --> 00:49:02,319
they added those weird like md5 some

1367
00:49:00,559 --> 00:49:04,160
domain names to the worker as well

1368
00:49:02,319 --> 00:49:06,558
which is what spurred me to have a look

1369
00:49:04,160 --> 00:49:09,279
at them again yesterday

1370
00:49:06,559 --> 00:49:10,880
and with a couple of updates my scripts

1371
00:49:09,280 --> 00:49:11,760
could talk to this new endpoint using

1372
00:49:10,880 --> 00:49:13,760
the new key

1373
00:49:11,760 --> 00:49:17,839
but sadly they still won't send me any

1374
00:49:13,760 --> 00:49:17,839
cool malware

1375
00:49:17,920 --> 00:49:22,559
so what next so

1376
00:49:20,960 --> 00:49:25,280
this device is safe now they've taken

1377
00:49:22,559 --> 00:49:27,280
out the malware but

1378
00:49:25,280 --> 00:49:29,599
they're still using the same updater but

1379
00:49:27,280 --> 00:49:32,160
it's basically been neutralized

1380
00:49:29,599 --> 00:49:34,160
all of the so the only thing that it can

1381
00:49:32,160 --> 00:49:35,759
still do are download ota packages and

1382
00:49:34,160 --> 00:49:37,279
those are signed anyway so

1383
00:49:35,760 --> 00:49:39,760
digital time can't use this for any

1384
00:49:37,280 --> 00:49:41,520
dodgy business

1385
00:49:39,760 --> 00:49:43,599
planets are building their own solution

1386
00:49:41,520 --> 00:49:45,440
to drop digitime entirely

1387
00:49:43,599 --> 00:49:48,240
i mean i can't imagine why you would

1388
00:49:45,440 --> 00:49:51,680
want to stop paying this company

1389
00:49:48,240 --> 00:49:54,240
but other devices like that's gretel a7

1390
00:49:51,680 --> 00:49:56,319
planets older device to gemini pda are

1391
00:49:54,240 --> 00:49:58,078
still at risk

1392
00:49:56,319 --> 00:50:02,640
and as we've seen they're still actively

1393
00:49:58,079 --> 00:50:06,480
updating the malware distribution bits

1394
00:50:02,640 --> 00:50:08,160
the website is still dead and

1395
00:50:06,480 --> 00:50:10,000
and even this regarding all of this like

1396
00:50:08,160 --> 00:50:12,240
the ot updates were supposed to be their

1397
00:50:10,000 --> 00:50:16,480
main business like their crown jewel

1398
00:50:12,240 --> 00:50:18,399
but they're still not very good at it so

1399
00:50:16,480 --> 00:50:20,319
when planets released the second ot

1400
00:50:18,400 --> 00:50:22,240
updates the servers have stopped

1401
00:50:20,319 --> 00:50:24,160
delivering the first one so people who

1402
00:50:22,240 --> 00:50:27,279
bought a new device could go from one to

1403
00:50:24,160 --> 00:50:29,279
two but not from zero to one

1404
00:50:27,280 --> 00:50:31,280
and then the eu update server went down

1405
00:50:29,280 --> 00:50:33,599
for weeks

1406
00:50:31,280 --> 00:50:37,839
and so the fallback server still worked

1407
00:50:33,599 --> 00:50:37,839
but the fallback logic didn't work

1408
00:50:38,839 --> 00:50:42,400
so

1409
00:50:40,559 --> 00:50:44,160
so this is pretty much most of it but

1410
00:50:42,400 --> 00:50:45,440
you do have a couple of bits of bonus

1411
00:50:44,160 --> 00:50:48,480
content i'm going to run through real

1412
00:50:45,440 --> 00:50:52,160
quick in the last couple of minutes

1413
00:50:48,480 --> 00:50:55,440
so i'm going to show you how to secure a

1414
00:50:52,160 --> 00:50:57,440
service like this so

1415
00:50:55,440 --> 00:50:59,200
you should make sure you're using https

1416
00:50:57,440 --> 00:51:02,000
so that no one can

1417
00:50:59,200 --> 00:51:03,598
mess with it if you're on an untrusted

1418
00:51:02,000 --> 00:51:06,880
network

1419
00:51:03,599 --> 00:51:08,880
so here we can see that they used https

1420
00:51:06,880 --> 00:51:11,839
for four out of five end points

1421
00:51:08,880 --> 00:51:13,680
so 80 percent i mean if you go by most

1422
00:51:11,839 --> 00:51:14,078
universities grading rules that's first

1423
00:51:13,680 --> 00:51:17,759
class

1424
00:51:14,079 --> 00:51:17,760
so basically perfect

1425
00:51:18,640 --> 00:51:23,040
but you should also try to have a valid

1426
00:51:20,839 --> 00:51:25,759
certificate

1427
00:51:23,040 --> 00:51:25,759
they didn't

1428
00:51:26,079 --> 00:51:30,400
but you know self signs might be fine in

1429
00:51:28,960 --> 00:51:33,680
certain instances because you know

1430
00:51:30,400 --> 00:51:36,880
you can you can pin the certificates and

1431
00:51:33,680 --> 00:51:38,879
get trusted that way so

1432
00:51:36,880 --> 00:51:41,119
they they do have pen and code so that's

1433
00:51:38,880 --> 00:51:41,119
good

1434
00:51:42,480 --> 00:51:46,079
unfortunately if you actually look at

1435
00:51:45,680 --> 00:51:49,200
the

1436
00:51:46,079 --> 00:51:51,280
apk you have the certificates

1437
00:51:49,200 --> 00:51:52,399
so there's that dot crt file and you

1438
00:51:51,280 --> 00:51:54,240
also have this dot he

1439
00:51:52,400 --> 00:51:56,160
file which is the private key for that

1440
00:51:54,240 --> 00:51:59,598
certificate

1441
00:51:56,160 --> 00:52:02,558
so they basically completely

1442
00:51:59,599 --> 00:52:04,160
ruined any points in them using https in

1443
00:52:02,559 --> 00:52:05,680
the first place and

1444
00:52:04,160 --> 00:52:07,920
it's not like they can change it either

1445
00:52:05,680 --> 00:52:09,839
because that's i mean they said they

1446
00:52:07,920 --> 00:52:12,640
have 300 million devices out there

1447
00:52:09,839 --> 00:52:16,078
running their system so the 300 million

1448
00:52:12,640 --> 00:52:19,440
devices expected to see that certificate

1449
00:52:16,079 --> 00:52:19,440
so they can't change us

1450
00:52:19,520 --> 00:52:22,720
and now for the second bit of bonus

1451
00:52:21,920 --> 00:52:24,559
content

1452
00:52:22,720 --> 00:52:26,160
i mentioned that there was this github

1453
00:52:24,559 --> 00:52:29,599
repo with some of the

1454
00:52:26,160 --> 00:52:32,160
stuff so about four or five years ago

1455
00:52:29,599 --> 00:52:33,920
one of the times clients like got this

1456
00:52:32,160 --> 00:52:35,520
package from them with documentation and

1457
00:52:33,920 --> 00:52:38,480
stuff and just

1458
00:52:35,520 --> 00:52:38,480
put it on github

1459
00:52:40,559 --> 00:52:46,480
so there's some things in that there's

1460
00:52:43,040 --> 00:52:48,558
apks for old versions of the updater

1461
00:52:46,480 --> 00:52:49,680
there's the lure runtime from the days

1462
00:52:48,559 --> 00:52:52,000
when i put it into

1463
00:52:49,680 --> 00:52:54,720
slash system rather than just having it

1464
00:52:52,000 --> 00:52:56,079
inside the apk

1465
00:52:54,720 --> 00:52:57,680
there's a powerpoint presentation

1466
00:52:56,079 --> 00:52:59,040
explaining how the management portal

1467
00:52:57,680 --> 00:53:00,879
works

1468
00:52:59,040 --> 00:53:02,079
there's chinese docs including how to

1469
00:53:00,880 --> 00:53:04,240
build an updates

1470
00:53:02,079 --> 00:53:06,160
old login credentials for the portal i

1471
00:53:04,240 --> 00:53:09,359
tried them they don't work

1472
00:53:06,160 --> 00:53:10,799
contact info for an employee and

1473
00:53:09,359 --> 00:53:12,839
sadly it doesn't have the back doors

1474
00:53:10,800 --> 00:53:14,880
it's too old but it's still kind of

1475
00:53:12,839 --> 00:53:16,720
interesting

1476
00:53:14,880 --> 00:53:18,400
so i'm going to finish off by showing

1477
00:53:16,720 --> 00:53:21,759
you some slides from that

1478
00:53:18,400 --> 00:53:24,000
presentation on the portal

1479
00:53:21,760 --> 00:53:25,680
so i think that's supposed to on for

1480
00:53:24,000 --> 00:53:28,319
uploading an update

1481
00:53:25,680 --> 00:53:30,879
those are the stats for like how many

1482
00:53:28,319 --> 00:53:33,200
devices it's been deployed to

1483
00:53:30,880 --> 00:53:36,160
that's how they specify which imei is

1484
00:53:33,200 --> 00:53:38,879
getting updates early

1485
00:53:36,160 --> 00:53:39,598
and for my final slides i'm going to

1486
00:53:38,880 --> 00:53:42,319
show you

1487
00:53:39,599 --> 00:53:44,319
this this lovely image from the oem

1488
00:53:42,319 --> 00:53:47,920
management portal which is the only

1489
00:53:44,319 --> 00:53:47,920
public facing thing they still have

1490
00:53:48,559 --> 00:53:51,839
so i couldn't go into full diesel of

1491
00:53:50,880 --> 00:53:54,720
course but if you liked

1492
00:53:51,839 --> 00:53:55,200
this there's a bunch more details on my

1493
00:53:54,720 --> 00:53:56,879
blog

1494
00:53:55,200 --> 00:53:58,480
about how this thing actually works and

1495
00:53:56,880 --> 00:54:00,079
there's some other random things you

1496
00:53:58,480 --> 00:54:02,079
might find interesting like

1497
00:54:00,079 --> 00:54:03,520
a map of every rather spoon sorted by

1498
00:54:02,079 --> 00:54:07,040
price and

1499
00:54:03,520 --> 00:54:08,559
how i built that and you can also follow

1500
00:54:07,040 --> 00:54:09,680
me on twitter but i wouldn't recommend

1501
00:54:08,559 --> 00:54:11,520
that

1502
00:54:09,680 --> 00:54:20,879
but yeah thanks for your time thanks for

1503
00:54:11,520 --> 00:54:20,880
listening to all of this crap

