1
00:00:02,820 --> 00:00:04,500
basically

2
00:00:04,500 --> 00:00:06,420
um hello everyone so

3
00:00:06,420 --> 00:00:08,940
um this is my talk pop-up Master strings

4
00:00:08,940 --> 00:00:11,760
it's mainly it's mainly aimed towards

5
00:00:11,760 --> 00:00:14,099
students as a sort of like introduction

6
00:00:14,099 --> 00:00:17,699
to commanding control Frameworks and how

7
00:00:17,699 --> 00:00:19,740
they could be used uh in an offensive

8
00:00:19,740 --> 00:00:21,359
scenario

9
00:00:21,359 --> 00:00:22,980
um so don't expect that in two

10
00:00:22,980 --> 00:00:25,080
groundbreaking

11
00:00:25,080 --> 00:00:27,539
um but yeah we'll uh start with how we

12
00:00:27,539 --> 00:00:31,080
who am I um so my name is Kieran bun

13
00:00:31,080 --> 00:00:33,899
um I'm from Glasgow and I'm a third year

14
00:00:33,899 --> 00:00:35,880
ethical hacking student here at abortee

15
00:00:35,880 --> 00:00:37,680
University

16
00:00:37,680 --> 00:00:39,899
um started in cyber doing a hnc and

17
00:00:39,899 --> 00:00:41,879
cyber security networking and uh City

18
00:00:41,879 --> 00:00:44,460
Glasgow College uh my interest is in

19
00:00:44,460 --> 00:00:46,320
more like red team operations and

20
00:00:46,320 --> 00:00:48,420
malware development

21
00:00:48,420 --> 00:00:51,420
um and then in my second year uh here at

22
00:00:51,420 --> 00:00:53,640
aborte I got the chance to go to the

23
00:00:53,640 --> 00:00:56,520
United States for a year and to do a

24
00:00:56,520 --> 00:00:59,420
blue team uploading course over there

25
00:00:59,420 --> 00:01:03,719
and I took classes over there in like

26
00:01:03,719 --> 00:01:05,640
um systems Administration to human

27
00:01:05,640 --> 00:01:07,979
understanding of how Linux and Windows

28
00:01:07,979 --> 00:01:11,580
systems can integrate together and uh um

29
00:01:11,580 --> 00:01:13,380
in a network

30
00:01:13,380 --> 00:01:14,880
um two classes and operating system

31
00:01:14,880 --> 00:01:18,180
forensics so I got to see how Windows

32
00:01:18,180 --> 00:01:21,119
actually operates under the hood and I

33
00:01:21,119 --> 00:01:22,979
got a class called Advanced topics in

34
00:01:22,979 --> 00:01:25,500
cyber security which talk about buffer

35
00:01:25,500 --> 00:01:28,200
overflows uh shell code

36
00:01:28,200 --> 00:01:31,860
um you know PE files and patching and I

37
00:01:31,860 --> 00:01:34,259
also took a class in network forensics

38
00:01:34,259 --> 00:01:37,280
which introduced me to tools like like

39
00:01:37,280 --> 00:01:41,820
sock tools like snort Cabana scene tools

40
00:01:41,820 --> 00:01:42,600
like

41
00:01:42,600 --> 00:01:43,820
um you know

42
00:01:43,820 --> 00:01:46,560
security onion

43
00:01:46,560 --> 00:01:48,780
um and yeah that kind of that kind of

44
00:01:48,780 --> 00:01:50,880
gave me like a baseline of understanding

45
00:01:50,880 --> 00:01:53,220
from a red team's perspective what does

46
00:01:53,220 --> 00:01:56,340
it look like for the blue teamers

47
00:01:56,340 --> 00:01:58,619
building on that again uh the second

48
00:01:58,619 --> 00:02:00,840
semester I actually got a job

49
00:02:00,840 --> 00:02:03,060
um in America at the Lincoln Center for

50
00:02:03,060 --> 00:02:05,100
digital investigations where I worked as

51
00:02:05,100 --> 00:02:06,780
a security technician and I was

52
00:02:06,780 --> 00:02:09,660
introduced to edrs and I actually saw

53
00:02:09,660 --> 00:02:12,000
how a sock actually works from the other

54
00:02:12,000 --> 00:02:14,580
side and saying all of this you know the

55
00:02:14,580 --> 00:02:17,160
you know the tools the events and depths

56
00:02:17,160 --> 00:02:19,440
and all the procedures that they take

57
00:02:19,440 --> 00:02:21,660
um I wondered how would I get around

58
00:02:21,660 --> 00:02:24,540
that like how do you how if I'm an

59
00:02:24,540 --> 00:02:26,459
attacker how would I come across how

60
00:02:26,459 --> 00:02:27,360
would I

61
00:02:27,360 --> 00:02:30,000
you'll get across these challenges

62
00:02:30,000 --> 00:02:32,099
and that's the background which led me

63
00:02:32,099 --> 00:02:34,739
to command and control servers command

64
00:02:34,739 --> 00:02:36,780
and control Frameworks

65
00:02:36,780 --> 00:02:40,200
so I'm here to cover what they are like

66
00:02:40,200 --> 00:02:42,540
what what they are why is command

67
00:02:42,540 --> 00:02:45,780
control so popular and red teams and how

68
00:02:45,780 --> 00:02:47,280
do they actually work what's their

69
00:02:47,280 --> 00:02:49,319
architecture

70
00:02:49,319 --> 00:02:51,959
um how to like there's a little Source

71
00:02:51,959 --> 00:02:53,700
like Frameworks you can use you don't

72
00:02:53,700 --> 00:02:55,920
need to build it from scratch but how do

73
00:02:55,920 --> 00:02:57,360
you keep the ones that are on Source

74
00:02:57,360 --> 00:02:59,340
relevant how do you obfuscate them

75
00:02:59,340 --> 00:03:01,860
without doing too much C plus

76
00:03:01,860 --> 00:03:05,660
programming because that's scary

77
00:03:05,660 --> 00:03:10,440
and what these what these tools pose to

78
00:03:10,440 --> 00:03:11,940
The Blue Team or what would they see

79
00:03:11,940 --> 00:03:15,540
like what what like what would what

80
00:03:15,540 --> 00:03:17,519
would they see from like their end if

81
00:03:17,519 --> 00:03:19,200
you're attacking them

82
00:03:19,200 --> 00:03:19,920
um

83
00:03:19,920 --> 00:03:21,840
and then what Frameworks are available

84
00:03:21,840 --> 00:03:24,840
that you can just go ahead and GitHub

85
00:03:24,840 --> 00:03:26,819
and download them and play around them

86
00:03:26,819 --> 00:03:29,640
it's just as easy as Kennywood that's

87
00:03:29,640 --> 00:03:31,879
great

88
00:03:32,280 --> 00:03:34,800
so the problems that they had the

89
00:03:34,800 --> 00:03:37,260
problems that they address right so say

90
00:03:37,260 --> 00:03:39,239
you don't have like a centralized way

91
00:03:39,239 --> 00:03:41,220
say you you're like you've got a team of

92
00:03:41,220 --> 00:03:42,959
people but you don't have a C2 framework

93
00:03:42,959 --> 00:03:45,180
right how many how many of these have

94
00:03:45,180 --> 00:03:47,640
done like ctfs imagine

95
00:03:47,640 --> 00:03:51,360
a fifth few yeah so if you've done ctfs

96
00:03:51,360 --> 00:03:54,180
um say you've got a PHP reverse shell

97
00:03:54,180 --> 00:03:55,920
you've got you've just uploaded and then

98
00:03:55,920 --> 00:03:57,959
you've got a listener and that comes

99
00:03:57,959 --> 00:04:00,360
back to you how then are you actually

100
00:04:00,360 --> 00:04:02,400
going to sit there with like split your

101
00:04:02,400 --> 00:04:05,159
terminal 40 times every time you come

102
00:04:05,159 --> 00:04:06,840
across someone that's vulnerable to that

103
00:04:06,840 --> 00:04:08,879
or a vulnerability and have to like

104
00:04:08,879 --> 00:04:12,180
figure out manually who is what and then

105
00:04:12,180 --> 00:04:14,519
to share it with another with another

106
00:04:14,519 --> 00:04:16,079
team member so you've got a team you're

107
00:04:16,079 --> 00:04:17,100
just gonna like

108
00:04:17,100 --> 00:04:19,139
give them your laptop and then you can't

109
00:04:19,139 --> 00:04:22,560
do anything and they can it's just it's

110
00:04:22,560 --> 00:04:25,620
not great top that it's like these these

111
00:04:25,620 --> 00:04:28,500
you know it's quite noisy to just have a

112
00:04:28,500 --> 00:04:29,759
persistent

113
00:04:29,759 --> 00:04:31,919
um a persistent tool just running on to

114
00:04:31,919 --> 00:04:34,139
have a constant connection you'll see

115
00:04:34,139 --> 00:04:37,500
that flagged up instantly on any Sim and

116
00:04:37,500 --> 00:04:39,300
there's no yeah there's there's no

117
00:04:39,300 --> 00:04:42,180
teamwork and and then like if you want

118
00:04:42,180 --> 00:04:45,120
to upload tools onto your on your your

119
00:04:45,120 --> 00:04:46,680
uh your victim

120
00:04:46,680 --> 00:04:49,139
you're going to leave artifacts all over

121
00:04:49,139 --> 00:04:51,600
the disk and that's really messy and

122
00:04:51,600 --> 00:04:54,360
then from a an offense of like a black

123
00:04:54,360 --> 00:04:56,220
cat point of view that's going to leave

124
00:04:56,220 --> 00:04:58,620
evidence all over the place and from a

125
00:04:58,620 --> 00:05:00,180
white high point of view you then need

126
00:05:00,180 --> 00:05:03,180
to go in and clean all that and knowing

127
00:05:03,180 --> 00:05:05,639
where everything was it's just gonna

128
00:05:05,639 --> 00:05:07,620
like they're not gonna it's not gonna be

129
00:05:07,620 --> 00:05:09,960
great is it it's gonna take so much time

130
00:05:09,960 --> 00:05:11,580
cleaning

131
00:05:11,580 --> 00:05:15,479
so um and and yeah and every time you

132
00:05:15,479 --> 00:05:18,060
want a tool to work because of antivirus

133
00:05:18,060 --> 00:05:19,560
you would then you reinvent the wheel

134
00:05:19,560 --> 00:05:21,540
every time if you want to run like mini

135
00:05:21,540 --> 00:05:23,100
cats or something download it on the

136
00:05:23,100 --> 00:05:25,560
desk and then you know just execute that

137
00:05:25,560 --> 00:05:27,539
even if you completely recreate it all

138
00:05:27,539 --> 00:05:29,280
the time

139
00:05:29,280 --> 00:05:30,479
so

140
00:05:30,479 --> 00:05:32,759
command and control would be your answer

141
00:05:32,759 --> 00:05:35,820
it's um it's quite centralized so you've

142
00:05:35,820 --> 00:05:38,100
got like a server and then you've got a

143
00:05:38,100 --> 00:05:40,560
bunch of team members that connect to it

144
00:05:40,560 --> 00:05:43,680
um so it handles all the connections so

145
00:05:43,680 --> 00:05:45,419
it is it's quite you know it's

146
00:05:45,419 --> 00:05:48,060
centralized you can manage your complete

147
00:05:48,060 --> 00:05:50,160
operation from there and it's

148
00:05:50,160 --> 00:05:53,160
customizable and there'll be I'll touch

149
00:05:53,160 --> 00:05:55,320
more on that later you can change a lot

150
00:05:55,320 --> 00:05:57,120
of things around about it

151
00:05:57,120 --> 00:05:58,020
um

152
00:05:58,020 --> 00:06:00,900
you can you can change a lot of things

153
00:06:00,900 --> 00:06:03,060
about it how it behaves on the network

154
00:06:03,060 --> 00:06:06,060
how it behaves on a client you can

155
00:06:06,060 --> 00:06:08,820
change pretty much everything about it

156
00:06:08,820 --> 00:06:11,280
it's quite finite which helps you in

157
00:06:11,280 --> 00:06:13,020
your operations

158
00:06:13,020 --> 00:06:16,560
um which comes on the flexibility of it

159
00:06:16,560 --> 00:06:19,560
um and because it's centralized you've

160
00:06:19,560 --> 00:06:22,800
got one system here managing everything

161
00:06:22,800 --> 00:06:25,500
on the on the attacking front line and

162
00:06:25,500 --> 00:06:26,940
then you've got one system which

163
00:06:26,940 --> 00:06:29,520
multiple people can connect to to manage

164
00:06:29,520 --> 00:06:32,220
it it's just very well organized like

165
00:06:32,220 --> 00:06:35,039
you can organize your attack very easily

166
00:06:35,039 --> 00:06:36,419
that way

167
00:06:36,419 --> 00:06:39,560
so that's pure class

168
00:06:39,720 --> 00:06:40,860
um

169
00:06:40,860 --> 00:06:44,160
so like I said what actually makes C2

170
00:06:44,160 --> 00:06:45,360
well

171
00:06:45,360 --> 00:06:48,120
on the on the attacking site you've got

172
00:06:48,120 --> 00:06:50,520
on there for the attacking side you've

173
00:06:50,520 --> 00:06:51,300
got

174
00:06:51,300 --> 00:06:54,180
um your server and your client right now

175
00:06:54,180 --> 00:06:56,580
client or an agent is piece of software

176
00:06:56,580 --> 00:06:58,860
that you would deploy much like you know

177
00:06:58,860 --> 00:07:02,220
executing a reverse shell and PHP or you

178
00:07:02,220 --> 00:07:04,259
know running some some executing some

179
00:07:04,259 --> 00:07:06,419
malware right it is malware that you've

180
00:07:06,419 --> 00:07:09,000
just put on your victims system how you

181
00:07:09,000 --> 00:07:11,479
get it there is up to you phishing

182
00:07:11,479 --> 00:07:14,819
exploitation literally just run in with

183
00:07:14,819 --> 00:07:17,280
a USB and plug it in whatever you can do

184
00:07:17,280 --> 00:07:18,720
what you like

185
00:07:18,720 --> 00:07:21,180
um and the purpose of that right the

186
00:07:21,180 --> 00:07:24,720
main goals of of that malware is to

187
00:07:24,720 --> 00:07:27,479
maintain a persistent connection to that

188
00:07:27,479 --> 00:07:28,380
system

189
00:07:28,380 --> 00:07:32,400
so it comes with loads of evasion tools

190
00:07:32,400 --> 00:07:37,080
it comes with loads of ways to like hide

191
00:07:37,080 --> 00:07:39,419
Communications through legitimate

192
00:07:39,419 --> 00:07:42,780
programs legitimate protocols like DNS

193
00:07:42,780 --> 00:07:47,039
HTTP SMB any of these protocols it will

194
00:07:47,039 --> 00:07:51,240
hide whatever it wants to talk to the

195
00:07:51,240 --> 00:07:53,220
whatever wants to send back it'll hide

196
00:07:53,220 --> 00:07:55,440
it in these protocols

197
00:07:55,440 --> 00:07:58,080
um and it's it's another main objective

198
00:07:58,080 --> 00:07:59,940
of it is to

199
00:07:59,940 --> 00:08:02,280
um carry out or torch right so it takes

200
00:08:02,280 --> 00:08:05,220
orders it executes the orders on the

201
00:08:05,220 --> 00:08:07,620
victim and then the results are sent

202
00:08:07,620 --> 00:08:09,979
back to the server

203
00:08:09,979 --> 00:08:13,500
server is centralized point of control

204
00:08:13,500 --> 00:08:17,280
so it um it's like I said it's the thing

205
00:08:17,280 --> 00:08:20,340
that manages everything it manages all

206
00:08:20,340 --> 00:08:22,500
the the clients it takes in the

207
00:08:22,500 --> 00:08:24,539
communications and the results it dishes

208
00:08:24,539 --> 00:08:26,759
out the orders

209
00:08:26,759 --> 00:08:29,460
um it can even give complete executables

210
00:08:29,460 --> 00:08:32,339
to these agents text to them like mini

211
00:08:32,339 --> 00:08:34,740
cats which exclusive map which we just

212
00:08:34,740 --> 00:08:37,020
execute in memory so that's pure quality

213
00:08:37,020 --> 00:08:39,179
don't touch the disk

214
00:08:39,179 --> 00:08:43,380
um and it allows multiple attackers that

215
00:08:43,380 --> 00:08:45,000
are connecting to This Server share

216
00:08:45,000 --> 00:08:47,580
these resources so say you get two guys

217
00:08:47,580 --> 00:08:50,760
or three guys uh connecting to this

218
00:08:50,760 --> 00:08:52,680
server and you're attacking an

219
00:08:52,680 --> 00:08:55,320
organization if you've got a connection

220
00:08:55,320 --> 00:08:58,800
into one agent and you've came across a

221
00:08:58,800 --> 00:09:00,180
thing that you've never heard of you

222
00:09:00,180 --> 00:09:01,560
don't know how to exploit it you don't

223
00:09:01,560 --> 00:09:04,440
know what it is you can just say the to

224
00:09:04,440 --> 00:09:06,240
the person next to you

225
00:09:06,240 --> 00:09:08,399
can you see what this is all about and

226
00:09:08,399 --> 00:09:11,220
they've got their own laptop another tab

227
00:09:11,220 --> 00:09:13,380
there they go they can they can manage

228
00:09:13,380 --> 00:09:15,360
it they can manage that agent just as

229
00:09:15,360 --> 00:09:17,279
you can so

230
00:09:17,279 --> 00:09:20,220
sharing resources between uh between

231
00:09:20,220 --> 00:09:23,820
team members is pretty invaluable

232
00:09:23,820 --> 00:09:26,399
um and yeah it allows for like anything

233
00:09:26,399 --> 00:09:29,040
that you steal yes

234
00:09:29,040 --> 00:09:31,260
um it will download it and all of the

235
00:09:31,260 --> 00:09:33,360
loot is essentially held on that server

236
00:09:33,360 --> 00:09:35,700
which can be shared between all the team

237
00:09:35,700 --> 00:09:37,140
members

238
00:09:37,140 --> 00:09:40,860
so yeah that's that's more or less his

239
00:09:40,860 --> 00:09:43,740
client server architecture is quite

240
00:09:43,740 --> 00:09:44,640
simple

241
00:09:44,640 --> 00:09:47,779
but you can get more complicated

242
00:09:47,779 --> 00:09:51,360
architectures and topologies with this

243
00:09:51,360 --> 00:09:54,240
so I'm also going to touch on later

244
00:09:54,240 --> 00:09:55,320
so

245
00:09:55,320 --> 00:09:57,300
first things first how how does it like

246
00:09:57,300 --> 00:09:59,519
how how does a process of deploying this

247
00:09:59,519 --> 00:10:02,640
work well first in a compromise a system

248
00:10:02,640 --> 00:10:04,740
right whether it's fishing running with

249
00:10:04,740 --> 00:10:06,360
your USB

250
00:10:06,360 --> 00:10:08,700
um or exploiting a system you just need

251
00:10:08,700 --> 00:10:12,540
to get your agent on a victim

252
00:10:12,540 --> 00:10:15,420
get your agent once it's deployed and

253
00:10:15,420 --> 00:10:18,360
the agent then just

254
00:10:18,360 --> 00:10:21,180
when the agent deploys it then registers

255
00:10:21,180 --> 00:10:23,640
back with the server and says hello I'm

256
00:10:23,640 --> 00:10:27,839
alive I am your slave I can do whatever

257
00:10:27,839 --> 00:10:30,959
you want and yeah so once it registers

258
00:10:30,959 --> 00:10:32,580
that the server is like really cool we

259
00:10:32,580 --> 00:10:35,279
know who you are and here's some initial

260
00:10:35,279 --> 00:10:38,459
orders you can carry out and and the

261
00:10:38,459 --> 00:10:39,959
agent and receives the instructions one

262
00:10:39,959 --> 00:10:41,820
needs to do before going to the before

263
00:10:41,820 --> 00:10:43,260
going to sleep

264
00:10:43,260 --> 00:10:45,959
the reason it goes to sleep is because

265
00:10:45,959 --> 00:10:48,480
instead of a persistent connection

266
00:10:48,480 --> 00:10:49,320
um

267
00:10:49,320 --> 00:10:51,839
it basically what it does is it just

268
00:10:51,839 --> 00:10:54,120
every maybe 60 seconds or however long

269
00:10:54,120 --> 00:10:56,519
you want with a little bit of Jitter it

270
00:10:56,519 --> 00:10:58,560
will connect to the server and say hello

271
00:10:58,560 --> 00:10:59,880
I'm alive if you get anything from what

272
00:10:59,880 --> 00:11:01,980
you do it and this server goes yes

273
00:11:01,980 --> 00:11:04,079
here's something for you to do takes

274
00:11:04,079 --> 00:11:06,720
those orders executes them sends the

275
00:11:06,720 --> 00:11:09,660
results back and then goes to sleep

276
00:11:09,660 --> 00:11:11,820
that keeps it's not a persistent

277
00:11:11,820 --> 00:11:13,860
connection yeah it may be annoying that

278
00:11:13,860 --> 00:11:15,360
you need to wait a minute every time you

279
00:11:15,360 --> 00:11:18,240
want an executed command but it keeps

280
00:11:18,240 --> 00:11:20,760
the traffic low it keeps a low profile

281
00:11:20,760 --> 00:11:24,180
on the network which uh for scene

282
00:11:24,180 --> 00:11:26,640
systems or slot rules means that okay

283
00:11:26,640 --> 00:11:29,579
I've got like a lot of traffic blowing

284
00:11:29,579 --> 00:11:30,540
up here

285
00:11:30,540 --> 00:11:32,640
um it's harder to take it doesn't over

286
00:11:32,640 --> 00:11:34,140
that threshold

287
00:11:34,140 --> 00:11:36,060
and and it will just do that basically

288
00:11:36,060 --> 00:11:37,740
on repeat

289
00:11:37,740 --> 00:11:40,680
and then goes to it so it goes to sleep

290
00:11:40,680 --> 00:11:43,019
then wakes back up

291
00:11:43,019 --> 00:11:46,019
server issues the the commands executed

292
00:11:46,019 --> 00:11:48,959
by the agent and agent then executes the

293
00:11:48,959 --> 00:11:51,120
orders which it's been told to do a

294
00:11:51,120 --> 00:11:52,980
report's back with the look and then it

295
00:11:52,980 --> 00:11:54,720
goes to sleep and it's just that cycle

296
00:11:54,720 --> 00:11:58,079
of every 60 seconds with a little bit of

297
00:11:58,079 --> 00:12:00,240
Jitter so it's not always exactly 60

298
00:12:00,240 --> 00:12:01,860
seconds or you could fingerprint that

299
00:12:01,860 --> 00:12:05,220
it's maybe what 50 seconds one moment

300
00:12:05,220 --> 00:12:08,100
and then 52 seconds the next then at 48

301
00:12:08,100 --> 00:12:10,620
seconds the next it's just it randomizes

302
00:12:10,620 --> 00:12:12,540
every time to make it sort of look like

303
00:12:12,540 --> 00:12:14,760
normal traffic and like I said their

304
00:12:14,760 --> 00:12:16,980
layout uses legit protocols so maybe

305
00:12:16,980 --> 00:12:22,860
it's https or or SSH or DNS so it looks

306
00:12:22,860 --> 00:12:24,779
it doesn't look suspicious it just looks

307
00:12:24,779 --> 00:12:27,839
like a normal user browsing the internet

308
00:12:27,839 --> 00:12:28,560
um

309
00:12:28,560 --> 00:12:32,640
so yeah now on the customizability

310
00:12:32,640 --> 00:12:35,820
um in the flexibility of it we've got

311
00:12:35,820 --> 00:12:38,880
malleable C2 profiles

312
00:12:38,880 --> 00:12:39,720
um

313
00:12:39,720 --> 00:12:43,139
this is Cobalt strike it's literally

314
00:12:43,139 --> 00:12:46,820
just like a config file which tells it

315
00:12:46,820 --> 00:12:50,399
exactly how the agent should behave not

316
00:12:50,399 --> 00:12:54,300
only on the network but also on the on

317
00:12:54,300 --> 00:12:57,540
the actual client itself so here it says

318
00:12:57,540 --> 00:12:59,700
right we're wanting to communicate with

319
00:12:59,700 --> 00:13:03,600
a get request using HTTP and we're

320
00:13:03,600 --> 00:13:05,279
telling it right so we want the request

321
00:13:05,279 --> 00:13:08,760
URI to the image right so slash

322
00:13:08,760 --> 00:13:11,399
emergency the IP address slash image or

323
00:13:11,399 --> 00:13:13,320
the domain slash image that's where

324
00:13:13,320 --> 00:13:15,540
you're going to send everything and you

325
00:13:15,540 --> 00:13:17,459
can customize what the headers are going

326
00:13:17,459 --> 00:13:20,579
to look like so you know you can hash

327
00:13:20,579 --> 00:13:22,620
control and set things but you can even

328
00:13:22,620 --> 00:13:24,660
put in like user agent or something or

329
00:13:24,660 --> 00:13:26,399
even custom

330
00:13:26,399 --> 00:13:27,420
um

331
00:13:27,420 --> 00:13:29,399
but you can even put in like custom

332
00:13:29,399 --> 00:13:32,160
headers to say right okay we've got this

333
00:13:32,160 --> 00:13:34,320
header which you could program to

334
00:13:34,320 --> 00:13:37,500
identify okay this is this agent

335
00:13:37,500 --> 00:13:38,399
um

336
00:13:38,399 --> 00:13:41,399
so yeah it's it here's the math data you

337
00:13:41,399 --> 00:13:42,779
can uh

338
00:13:42,779 --> 00:13:45,300
the metadata you can change that you can

339
00:13:45,300 --> 00:13:47,579
see what the response is going to be and

340
00:13:47,579 --> 00:13:49,620
you can see right the task data is

341
00:13:49,620 --> 00:13:52,320
encrypted in Kodi and responsibility

342
00:13:52,320 --> 00:13:54,779
that's a piece of paper

343
00:13:54,779 --> 00:13:57,180
so like you can you can say right put it

344
00:13:57,180 --> 00:14:00,060
in b64 and then send it that way so

345
00:14:00,060 --> 00:14:02,339
whatever the results are encrypt it

346
00:14:02,339 --> 00:14:06,300
encode it put it into like a body as a

347
00:14:06,300 --> 00:14:09,000
you know like a get request and then

348
00:14:09,000 --> 00:14:11,160
send that off and that's

349
00:14:11,160 --> 00:14:14,040
yeah that's how you would how you could

350
00:14:14,040 --> 00:14:16,260
like change that that allows you to

351
00:14:16,260 --> 00:14:18,839
change the behavior on the agent

352
00:14:18,839 --> 00:14:20,940
um which allows you to

353
00:14:20,940 --> 00:14:23,579
emulate a three actor more accurately so

354
00:14:23,579 --> 00:14:25,560
say some companies came through and

355
00:14:25,560 --> 00:14:28,260
asked can you uh see what it would look

356
00:14:28,260 --> 00:14:30,959
like if we could you simulate how we

357
00:14:30,959 --> 00:14:33,480
could be attacked by fancy beer Cozy

358
00:14:33,480 --> 00:14:35,700
Bear some apt grip or something like or

359
00:14:35,700 --> 00:14:37,680
China or something like that you can

360
00:14:37,680 --> 00:14:40,320
literally tailor this profile to exactly

361
00:14:40,320 --> 00:14:43,139
how they behave from your threat Intel

362
00:14:43,139 --> 00:14:45,240
reports

363
00:14:45,240 --> 00:14:46,980
then we've got the other side

364
00:14:46,980 --> 00:14:50,639
so here that's what that would look like

365
00:14:50,639 --> 00:14:52,860
is that like see that config that's what

366
00:14:52,860 --> 00:14:55,440
it would look like and um

367
00:14:55,440 --> 00:14:57,779
you know and uh if you were to snapped

368
00:14:57,779 --> 00:14:58,980
the traffic

369
00:14:58,980 --> 00:15:02,459
kind of looks relatively normal to be

370
00:15:02,459 --> 00:15:03,540
honest

371
00:15:03,540 --> 00:15:06,000
um but on the offensive side it allows

372
00:15:06,000 --> 00:15:08,339
you to change then it indicator to

373
00:15:08,339 --> 00:15:10,740
compromise so if you've got an ioc and

374
00:15:10,740 --> 00:15:12,779
you've created a signature out of that

375
00:15:12,779 --> 00:15:15,540
to say we are under attack this is the

376
00:15:15,540 --> 00:15:17,699
malware that uses this change the

377
00:15:17,699 --> 00:15:20,760
profile make it not match that signature

378
00:15:20,760 --> 00:15:24,660
and it'll just fly right through

379
00:15:24,660 --> 00:15:26,699
um and you can change yeah you can

380
00:15:26,699 --> 00:15:29,820
change the network as traffic so it just

381
00:15:29,820 --> 00:15:33,660
allows you to more finite be more finite

382
00:15:33,660 --> 00:15:37,380
and how you hide what you're doing

383
00:15:37,380 --> 00:15:40,920
now on this malleable C2 profiles like I

384
00:15:40,920 --> 00:15:43,139
said about you can make custom headers

385
00:15:43,139 --> 00:15:46,320
right to change whatever you want

386
00:15:46,320 --> 00:15:49,260
that is where you can then kind of

387
00:15:49,260 --> 00:15:50,519
change

388
00:15:50,519 --> 00:15:52,199
um you can change

389
00:15:52,199 --> 00:15:55,920
how it communicates on the on the

390
00:15:55,920 --> 00:15:58,560
network with your infrastructure so

391
00:15:58,560 --> 00:16:01,440
these C2 redirectors are a thing that

392
00:16:01,440 --> 00:16:04,019
can that you can put in the middle

393
00:16:04,019 --> 00:16:07,620
between your agent and your server

394
00:16:07,620 --> 00:16:10,320
purpose of this is if you

395
00:16:10,320 --> 00:16:12,300
if you want to obfuscate and stop the

396
00:16:12,300 --> 00:16:14,399
blue teamers from actually seeing what

397
00:16:14,399 --> 00:16:16,740
you're doing and if you want a or you

398
00:16:16,740 --> 00:16:19,160
want to maintain like some reliability

399
00:16:19,160 --> 00:16:22,380
then it's much cheaper and much easier

400
00:16:22,380 --> 00:16:25,980
to just deploy like seven of these have

401
00:16:25,980 --> 00:16:28,260
a bunch of clean domains Point tab at

402
00:16:28,260 --> 00:16:30,300
seven of them and then all of them will

403
00:16:30,300 --> 00:16:34,139
just redirect to one C2

404
00:16:34,139 --> 00:16:38,040
um if it when I when a request comes in

405
00:16:38,040 --> 00:16:41,639
you can change the headers

406
00:16:41,639 --> 00:16:43,440
um and the response so if you just got

407
00:16:43,440 --> 00:16:45,839
like here we've just got a bunch of

408
00:16:45,839 --> 00:16:48,540
random strings and a post request the

409
00:16:48,540 --> 00:16:50,220
response would be you're not getting

410
00:16:50,220 --> 00:16:52,440
anything or you could you know send them

411
00:16:52,440 --> 00:16:54,899
to Google personally or some benign

412
00:16:54,899 --> 00:16:57,240
normal looking website

413
00:16:57,240 --> 00:16:58,440
but

414
00:16:58,440 --> 00:17:01,079
after you've got it set up where if you

415
00:17:01,079 --> 00:17:03,120
get a request and it contains the stream

416
00:17:03,120 --> 00:17:04,919
fubar

417
00:17:04,919 --> 00:17:06,660
then it will send you

418
00:17:06,660 --> 00:17:09,839
nothing to see here or you could do a

419
00:17:09,839 --> 00:17:11,880
reverse property which will send it to

420
00:17:11,880 --> 00:17:13,619
the C2

421
00:17:13,619 --> 00:17:17,220
that's that means that if some blue

422
00:17:17,220 --> 00:17:19,260
teamer wants to enumerate okay what is

423
00:17:19,260 --> 00:17:22,439
this domain and they type in the URL and

424
00:17:22,439 --> 00:17:24,299
they don't have your you know custom

425
00:17:24,299 --> 00:17:27,119
header in there then it's just going to

426
00:17:27,119 --> 00:17:29,100
send them straight to like Google but if

427
00:17:29,100 --> 00:17:30,780
they've got the custom header it'll

428
00:17:30,780 --> 00:17:32,760
connect to the C2

429
00:17:32,760 --> 00:17:35,820
another good thing about that

430
00:17:35,820 --> 00:17:39,840
um is if you if you have like say you've

431
00:17:39,840 --> 00:17:42,299
got an agreed scope right and you're

432
00:17:42,299 --> 00:17:44,340
doing a rental operation and one of the

433
00:17:44,340 --> 00:17:46,200
one of the things you do is you're

434
00:17:46,200 --> 00:17:48,840
walking about outside like industrial

435
00:17:48,840 --> 00:17:51,600
complex or you know maybe an office kind

436
00:17:51,600 --> 00:17:54,000
of like district and you're you're

437
00:17:54,000 --> 00:17:57,120
additional USBS like a madman and bushes

438
00:17:57,120 --> 00:17:59,280
or whatever just hoping somebody's gonna

439
00:17:59,280 --> 00:18:00,840
pick them up and plug them in and run

440
00:18:00,840 --> 00:18:02,520
whatever's on them

441
00:18:02,520 --> 00:18:05,160
you're a great scope would most likely

442
00:18:05,160 --> 00:18:07,679
be with that one company so what happens

443
00:18:07,679 --> 00:18:11,340
when someone else picks up the USB and

444
00:18:11,340 --> 00:18:13,140
they plug it in and it's another company

445
00:18:13,140 --> 00:18:16,260
and you've just compromise some random

446
00:18:16,260 --> 00:18:18,720
company you're not allowed to do that's

447
00:18:18,720 --> 00:18:21,780
going to be really bad so we can't have

448
00:18:21,780 --> 00:18:22,679
that

449
00:18:22,679 --> 00:18:26,940
so you can set it up where only these IP

450
00:18:26,940 --> 00:18:28,440
addresses

451
00:18:28,440 --> 00:18:30,360
um are allowed to communicate with the

452
00:18:30,360 --> 00:18:33,539
C2 so the agent will still deploy it

453
00:18:33,539 --> 00:18:37,260
will still execute on that victim but if

454
00:18:37,260 --> 00:18:40,200
we're not in scope the redirectors just

455
00:18:40,200 --> 00:18:43,140
won't accept them so then it will try

456
00:18:43,140 --> 00:18:45,780
and run it'll keep trying to connect and

457
00:18:45,780 --> 00:18:47,520
eventually I think it's in Cobalt strike

458
00:18:47,520 --> 00:18:49,140
they'll try like a hundred times to

459
00:18:49,140 --> 00:18:51,299
connect and if they can't connect it'll

460
00:18:51,299 --> 00:18:54,240
just terminate itself and clean up and

461
00:18:54,240 --> 00:18:56,179
just move on

462
00:18:56,179 --> 00:18:59,780
then you don't get in trouble

463
00:19:00,000 --> 00:19:01,500
so yeah

464
00:19:01,500 --> 00:19:02,299
um

465
00:19:02,299 --> 00:19:05,760
some examples of C2 Frameworks because

466
00:19:05,760 --> 00:19:07,940
like I said you don't need to just

467
00:19:07,940 --> 00:19:10,620
recreate them from scratch

468
00:19:10,620 --> 00:19:13,679
because that's painful trust me I've

469
00:19:13,679 --> 00:19:17,160
tried it and I know people who have

470
00:19:17,160 --> 00:19:20,940
managed to do it and it's not pretty

471
00:19:20,940 --> 00:19:23,220
so there are some paid options which you

472
00:19:23,220 --> 00:19:25,440
can get cobalt strike which

473
00:19:25,440 --> 00:19:28,140
um is probably the most popular one it's

474
00:19:28,140 --> 00:19:31,080
a it's a paid platform uh written by a

475
00:19:31,080 --> 00:19:33,539
guy called Rafael Munch I've met him

476
00:19:33,539 --> 00:19:35,100
there's one word to describe them

477
00:19:35,100 --> 00:19:38,039
multi-threaded is mental

478
00:19:38,039 --> 00:19:38,100
um

479
00:19:38,100 --> 00:19:39,840
[Music]

480
00:19:39,840 --> 00:19:42,660
and then yeah don't don't buy it up

481
00:19:42,660 --> 00:19:44,160
though because it's like four thousand

482
00:19:44,160 --> 00:19:46,260
five hundred dollars for a year and who

483
00:19:46,260 --> 00:19:47,700
the hell has that

484
00:19:47,700 --> 00:19:50,400
and there's also retail which is fruit

485
00:19:50,400 --> 00:19:54,000
C4 Nighthawk Haven these are all paid

486
00:19:54,000 --> 00:19:56,760
Solutions and I mean I've not used them

487
00:19:56,760 --> 00:20:00,299
because I'm not minty uh instead if you

488
00:20:00,299 --> 00:20:02,280
guys want to try them out

489
00:20:02,280 --> 00:20:05,340
um there's a free options which are

490
00:20:05,340 --> 00:20:08,280
actually to be honest just as good I

491
00:20:08,280 --> 00:20:10,320
would say um and a lot of them actually

492
00:20:10,320 --> 00:20:13,260
the three options are arrival two Cobalt

493
00:20:13,260 --> 00:20:15,480
stripe which is the the standard for it

494
00:20:15,480 --> 00:20:18,840
so we've got Powershell Empire and this

495
00:20:18,840 --> 00:20:20,700
is you know it does all of its agents

496
00:20:20,700 --> 00:20:22,500
are written in Powershell so you'll

497
00:20:22,500 --> 00:20:24,780
probably get caught but that's okay

498
00:20:24,780 --> 00:20:25,559
um

499
00:20:25,559 --> 00:20:28,919
Covenant which is written in C sharp

500
00:20:28,919 --> 00:20:31,020
um that's a free option as well and it's

501
00:20:31,020 --> 00:20:33,240
got a great it's a nicely web-based good

502
00:20:33,240 --> 00:20:35,760
you can just click stuff and it's great

503
00:20:35,760 --> 00:20:39,120
because yeah metal splits technically

504
00:20:39,120 --> 00:20:42,840
one although if Alan wasn't here yeah

505
00:20:42,840 --> 00:20:44,520
Alan's not here so I can say that tip

506
00:20:44,520 --> 00:20:46,200
maxplay is technically one if he was

507
00:20:46,200 --> 00:20:48,539
here he would kill me for that and and

508
00:20:48,539 --> 00:20:51,660
then these two or perhaps my favorite

509
00:20:51,660 --> 00:20:55,020
and have a C2 which is a very early

510
00:20:55,020 --> 00:20:57,539
access the it comes with a GUI it's like

511
00:20:57,539 --> 00:21:00,240
a direct competitor with Cobalt strike

512
00:21:00,240 --> 00:21:02,100
you'll see what I mean in the next slide

513
00:21:02,100 --> 00:21:05,100
and a sliver because there's also

514
00:21:05,100 --> 00:21:07,380
there's a much more mature than havoc

515
00:21:07,380 --> 00:21:09,780
and but it's also a direct competitor

516
00:21:09,780 --> 00:21:12,299
with Cobalt trip although the uh doesn't

517
00:21:12,299 --> 00:21:14,520
have a good way yet it's all command

518
00:21:14,520 --> 00:21:19,260
line which is okay in Saturn

519
00:21:19,260 --> 00:21:20,100
um

520
00:21:20,100 --> 00:21:22,380
so yeah so the Cobalt straight which is

521
00:21:22,380 --> 00:21:25,559
the gold standard and havoc and sliver

522
00:21:25,559 --> 00:21:27,720
which I'm about to show you here these

523
00:21:27,720 --> 00:21:29,760
are a couple of examples of of what they

524
00:21:29,760 --> 00:21:30,960
would look like

525
00:21:30,960 --> 00:21:32,039
so

526
00:21:32,039 --> 00:21:34,260
go book straight which is written in

527
00:21:34,260 --> 00:21:36,960
sleep it's literally his own programming

528
00:21:36,960 --> 00:21:39,299
language probably names for the lack of

529
00:21:39,299 --> 00:21:42,360
they had when making it

530
00:21:42,360 --> 00:21:44,220
um that's what it kind of looks like if

531
00:21:44,220 --> 00:21:46,919
anyone's used Armitage before has anyone

532
00:21:46,919 --> 00:21:50,039
heard and used of it yeah so if you've

533
00:21:50,039 --> 00:21:52,080
ever used Armitage which is like the GUI

534
00:21:52,080 --> 00:21:54,900
for metasploy it's the same guy that's

535
00:21:54,900 --> 00:21:57,000
why that looks like the same stuff it's

536
00:21:57,000 --> 00:21:59,820
the same guy that made that and it's got

537
00:21:59,820 --> 00:22:02,400
a lovely GUI you can

538
00:22:02,400 --> 00:22:05,280
um right you can customize your agents

539
00:22:05,280 --> 00:22:07,200
you can customize your profile import

540
00:22:07,200 --> 00:22:10,320
them change how they behave and just

541
00:22:10,320 --> 00:22:12,419
click about and all your options are

542
00:22:12,419 --> 00:22:13,200
there

543
00:22:13,200 --> 00:22:15,059
which are quite nice

544
00:22:15,059 --> 00:22:15,659
um

545
00:22:15,659 --> 00:22:19,620
then you've got sliver which uh can

546
00:22:19,620 --> 00:22:22,260
actually get the beacon and a shell code

547
00:22:22,260 --> 00:22:24,000
to work which is quite annoying I think

548
00:22:24,000 --> 00:22:25,380
there's a bug but I don't know how to

549
00:22:25,380 --> 00:22:27,360
tell them that it is because it was it

550
00:22:27,360 --> 00:22:29,520
was a similar bug in another option but

551
00:22:29,520 --> 00:22:32,640
this is what theirs looks like actually

552
00:22:32,640 --> 00:22:34,380
it's totally be moving but it's

553
00:22:34,380 --> 00:22:37,520
absolutely not there we go

554
00:22:38,460 --> 00:22:40,200
so yeah you can manage you manage

555
00:22:40,200 --> 00:22:42,240
everything through your uh through your

556
00:22:42,240 --> 00:22:45,840
terminal and get loads of options here

557
00:22:45,840 --> 00:22:48,539
to just you know pass teach screenshots

558
00:22:48,539 --> 00:22:51,059
regenerate shell codes or whatever here

559
00:22:51,059 --> 00:22:52,740
you've got the pictures of your

560
00:22:52,740 --> 00:22:55,020
management interact with your agents so

561
00:22:55,020 --> 00:22:57,600
use that agent

562
00:22:57,600 --> 00:22:59,179
um

563
00:22:59,179 --> 00:23:03,299
who am I so schedule a task wait for

564
00:23:03,299 --> 00:23:06,240
that to come back eventually pop up with

565
00:23:06,240 --> 00:23:09,240
all the stuff it needs to happen and

566
00:23:09,240 --> 00:23:10,980
then it'll be held in work and stuff

567
00:23:10,980 --> 00:23:12,059
like that

568
00:23:12,059 --> 00:23:14,039
yeah so like here's a bunch of like

569
00:23:14,039 --> 00:23:16,559
here's all the a lot of the uh to

570
00:23:16,559 --> 00:23:18,539
imagine you can put

571
00:23:18,539 --> 00:23:21,539
and it's great

572
00:23:21,539 --> 00:23:24,720
um and then there's Havoc which I told

573
00:23:24,720 --> 00:23:26,580
you was like a direct competitor to see

574
00:23:26,580 --> 00:23:31,080
how there's like the the same thing and

575
00:23:31,080 --> 00:23:33,059
and they're like direct competitors with

576
00:23:33,059 --> 00:23:34,919
each other well more or less this one's

577
00:23:34,919 --> 00:23:37,559
like very early access still though uh

578
00:23:37,559 --> 00:23:40,200
the front end the uh the guy and the

579
00:23:40,200 --> 00:23:43,320
servers written in go which is nice

580
00:23:43,320 --> 00:23:46,380
um and the agents are written in C C

581
00:23:46,380 --> 00:23:48,539
plus plus which comes with its

582
00:23:48,539 --> 00:23:49,980
advantages

583
00:23:49,980 --> 00:23:53,280
Slugger is written exclusively in gold

584
00:23:53,280 --> 00:23:55,679
which comes with its advantages for

585
00:23:55,679 --> 00:23:57,539
um evasion since it's a statically

586
00:23:57,539 --> 00:23:58,919
compiled

587
00:23:58,919 --> 00:24:01,380
um language so all the dependencies come

588
00:24:01,380 --> 00:24:04,020
with it but that comes with its

589
00:24:04,020 --> 00:24:07,380
disadvantages because you know well what

590
00:24:07,380 --> 00:24:10,860
havoc and with Cobalt strike you can you

591
00:24:10,860 --> 00:24:12,419
have agents and you deploy them and

592
00:24:12,419 --> 00:24:15,299
they're maybe like what about maybe 40

593
00:24:15,299 --> 00:24:18,179
40 bytes it can be sometimes with the

594
00:24:18,179 --> 00:24:20,039
Cobalt strike

595
00:24:20,039 --> 00:24:22,760
well that's you're gonna have 17

596
00:24:22,760 --> 00:24:26,880
megabytes of an agent plus Masters

597
00:24:26,880 --> 00:24:30,900
so monstrocity so if you if you want to

598
00:24:30,900 --> 00:24:33,360
be quiet remember not use this one I've

599
00:24:33,360 --> 00:24:35,400
never used this one but it's uh it does

600
00:24:35,400 --> 00:24:37,740
mean that this one in Slither is a lot

601
00:24:37,740 --> 00:24:40,500
harder to detect because it doesn't

602
00:24:40,500 --> 00:24:43,440
um interact with Windows and get caught

603
00:24:43,440 --> 00:24:46,380
by edrs quite as easily although they're

604
00:24:46,380 --> 00:24:49,380
starting to pick up on it

605
00:24:49,380 --> 00:24:51,120
um

606
00:24:51,120 --> 00:24:54,360
so like I said like you know

607
00:24:54,360 --> 00:24:57,240
sliver doesn't get caught as easily but

608
00:24:57,240 --> 00:24:59,520
it still gets caught

609
00:24:59,520 --> 00:25:00,140
um

610
00:25:00,140 --> 00:25:02,700
Cobalt strike absolutely gets caught

611
00:25:02,700 --> 00:25:04,200
because everyone knows about it and

612
00:25:04,200 --> 00:25:06,179
everyone doesn't like it

613
00:25:06,179 --> 00:25:08,480
um and Havoc which is Early Access

614
00:25:08,480 --> 00:25:12,000
doesn't get caught yet

615
00:25:12,000 --> 00:25:14,700
um they're still finding agents for it

616
00:25:14,700 --> 00:25:18,000
um but eventually give it like

617
00:25:18,000 --> 00:25:19,919
I swear I'll give it like three weeks

618
00:25:19,919 --> 00:25:21,480
and everyone's gonna know about it and

619
00:25:21,480 --> 00:25:22,919
then all your agents trying to get

620
00:25:22,919 --> 00:25:26,220
caught so how are you gonna how are you

621
00:25:26,220 --> 00:25:27,299
gonna

622
00:25:27,299 --> 00:25:31,080
keep if you like one framework but then

623
00:25:31,080 --> 00:25:32,700
all of a sudden everyone keeps catching

624
00:25:32,700 --> 00:25:35,640
it how are you actually going to um

625
00:25:35,640 --> 00:25:38,279
how are you going to keep that going

626
00:25:38,279 --> 00:25:40,020
um because it can't really be bothered

627
00:25:40,020 --> 00:25:42,720
every time just hoping that the next

628
00:25:42,720 --> 00:25:44,820
person will then just create another C2

629
00:25:44,820 --> 00:25:47,400
framework in another language and then

630
00:25:47,400 --> 00:25:49,200
you'll you use that for like a week or

631
00:25:49,200 --> 00:25:50,880
two and then it all gets caught and then

632
00:25:50,880 --> 00:25:53,100
you move on and that's one that's just

633
00:25:53,100 --> 00:25:55,140
that's just that's not four thousand

634
00:25:55,140 --> 00:25:57,419
five hundred dollars a year or I'm not

635
00:25:57,419 --> 00:25:59,760
interested in that so

636
00:25:59,760 --> 00:26:02,220
fortunately

637
00:26:02,220 --> 00:26:02,820
um

638
00:26:02,820 --> 00:26:05,520
these Frameworks come with an option

639
00:26:05,520 --> 00:26:08,100
there's havocs to just generate Shell

640
00:26:08,100 --> 00:26:10,679
Code now has anyone anyone done like

641
00:26:10,679 --> 00:26:13,320
buffer overflows and stuff I mean you'll

642
00:26:13,320 --> 00:26:15,299
yeah so buffaloes you kind of know what

643
00:26:15,299 --> 00:26:18,659
they are it's the same thing it's

644
00:26:18,659 --> 00:26:21,240
you generate a shell codes that would

645
00:26:21,240 --> 00:26:24,419
come back to your server grab a second

646
00:26:24,419 --> 00:26:26,940
stage payload load it into memory and

647
00:26:26,940 --> 00:26:29,220
then execute it that way that means that

648
00:26:29,220 --> 00:26:32,539
if you keep your agents only in memory

649
00:26:32,539 --> 00:26:36,000
and obfuscate it through like encrypting

650
00:26:36,000 --> 00:26:38,220
encrypting your shell codes

651
00:26:38,220 --> 00:26:39,000
um

652
00:26:39,000 --> 00:26:42,900
which you know there's only python take

653
00:26:42,900 --> 00:26:46,380
this and it output it and we're of

654
00:26:46,380 --> 00:26:49,320
course the EST and then all of the Shell

655
00:26:49,320 --> 00:26:52,080
Code there you put that in a variable

656
00:26:52,080 --> 00:26:54,679
decrypted order in memory there we go

657
00:26:54,679 --> 00:26:56,940
the next talk is going to talk about

658
00:26:56,940 --> 00:27:00,240
process injection which

659
00:27:00,240 --> 00:27:02,520
related to that

660
00:27:02,520 --> 00:27:05,279
um you can obfuscate your function calls

661
00:27:05,279 --> 00:27:07,620
so if you know a little bit of C you can

662
00:27:07,620 --> 00:27:09,960
hear so for example here's a virtual

663
00:27:09,960 --> 00:27:12,360
alloc so allocating yourself your own

664
00:27:12,360 --> 00:27:16,799
memory and a lot of edrs would hook on

665
00:27:16,799 --> 00:27:19,860
to that and find yourself and like you

666
00:27:19,860 --> 00:27:21,480
know know that your malware is actually

667
00:27:21,480 --> 00:27:24,240
you know going to try next to so instead

668
00:27:24,240 --> 00:27:26,360
of just importing that function directly

669
00:27:26,360 --> 00:27:30,360
you can just create a pointer in your

670
00:27:30,360 --> 00:27:32,340
own program

671
00:27:32,340 --> 00:27:34,559
encrypt your like encrypt the string

672
00:27:34,559 --> 00:27:37,980
virtual arrow and and then once you've

673
00:27:37,980 --> 00:27:41,460
decrypted that a runtime point and

674
00:27:41,460 --> 00:27:44,159
memory some like it's already in memory

675
00:27:44,159 --> 00:27:46,860
you just point it and then using H

676
00:27:46,860 --> 00:27:49,679
virtual alloc as a

677
00:27:49,679 --> 00:27:52,980
um as a like a function call

678
00:27:52,980 --> 00:27:57,360
you've more or less just imported it but

679
00:27:57,360 --> 00:27:59,520
it doesn't come up in the PE file which

680
00:27:59,520 --> 00:28:01,080
will which you can which are usually

681
00:28:01,080 --> 00:28:03,539
shown in like Yara rows so like like

682
00:28:03,539 --> 00:28:05,580
antivirus will also say if it's

683
00:28:05,580 --> 00:28:08,760
importing this function then Bennett

684
00:28:08,760 --> 00:28:11,400
well if the yarrow checks

685
00:28:11,400 --> 00:28:13,679
this doesn't look like it's this isn't

686
00:28:13,679 --> 00:28:16,380
importing it but it actually is you'll

687
00:28:16,380 --> 00:28:17,940
fly right past that you're not going to

688
00:28:17,940 --> 00:28:20,100
get caught so that's a way that you can

689
00:28:20,100 --> 00:28:23,220
keep these agents running by just maybe

690
00:28:23,220 --> 00:28:24,600
learning a little bit of C plus plus

691
00:28:24,600 --> 00:28:27,000
it's a little bit of programming and you

692
00:28:27,000 --> 00:28:28,919
can do whatever you like you can keep

693
00:28:28,919 --> 00:28:30,539
these Frameworks running

694
00:28:30,539 --> 00:28:32,760
for as long as you want

695
00:28:32,760 --> 00:28:34,440
um and because you're using encryption

696
00:28:34,440 --> 00:28:37,260
or encoding hey you're changing the

697
00:28:37,260 --> 00:28:40,380
signatures every single time so it just

698
00:28:40,380 --> 00:28:42,779
it just keeps going

699
00:28:42,779 --> 00:28:44,760
um and then yeah there's the you know

700
00:28:44,760 --> 00:28:47,340
hiding so there's um

701
00:28:47,340 --> 00:28:49,620
process injection which will come up in

702
00:28:49,620 --> 00:28:53,580
the next talk uh and I just simply hide

703
00:28:53,580 --> 00:28:55,679
in the console so if you want if you

704
00:28:55,679 --> 00:28:58,220
execute them in if you execute an agent

705
00:28:58,220 --> 00:29:00,900
more often than not you'll see a flash

706
00:29:00,900 --> 00:29:04,020
of up of a flash of like a terminal come

707
00:29:04,020 --> 00:29:05,460
up and then it would just disappear

708
00:29:05,460 --> 00:29:07,440
really quickly and if a user sees that

709
00:29:07,440 --> 00:29:09,659
oh I don't like that that's scary I

710
00:29:09,659 --> 00:29:11,760
think on 490 and ask what's going on

711
00:29:11,760 --> 00:29:14,340
they investigate it you get caught

712
00:29:14,340 --> 00:29:16,860
you just see one main instead of main

713
00:29:16,860 --> 00:29:18,840
the console doesn't pop up in their

714
00:29:18,840 --> 00:29:21,260
nonetheless

