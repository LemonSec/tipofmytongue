1
00:00:02,399 --> 00:00:08,260
so sorry configuration is definitely

2
00:00:05,050 --> 00:00:11,139
something complicated I'm very happy to

3
00:00:08,260 --> 00:00:13,149
be there as from well said I used to be

4
00:00:11,139 --> 00:00:14,230
a student sitting on this bench is about

5
00:00:13,150 --> 00:00:15,940
12 years ago

6
00:00:14,230 --> 00:00:18,310
and to be honest that somebody told me

7
00:00:15,940 --> 00:00:20,580
that I would be there presenting in

8
00:00:18,310 --> 00:00:22,810
front of us in front of you guys

9
00:00:20,580 --> 00:00:25,929
something about attacking some Microsoft

10
00:00:22,810 --> 00:00:28,750
Brad here I think I would have loved at

11
00:00:25,929 --> 00:00:31,929
that moment so here I am so my name is

12
00:00:28,750 --> 00:00:33,250
Nicolas ready so I walked for Microsoft

13
00:00:31,929 --> 00:00:35,050
I'm based in the UK

14
00:00:33,250 --> 00:00:38,379
I mean Cheltenham that's about two hours

15
00:00:35,050 --> 00:00:39,819
away from London so I walk for ve an

16
00:00:38,379 --> 00:00:42,489
Assad she's a Microsoft Security

17
00:00:39,820 --> 00:00:45,340
Response Center so it's a norm inside

18
00:00:42,489 --> 00:00:48,038
the org so and in this world I'm part of

19
00:00:45,340 --> 00:00:50,789
the variability and mitigation team so

20
00:00:48,039 --> 00:00:53,710
basically exploiting stuff and

21
00:00:50,789 --> 00:00:57,250
occasionally I'm also doing chakra cases

22
00:00:53,710 --> 00:00:58,870
like typically bronze kzo so here I'm

23
00:00:57,250 --> 00:01:01,000
not going to talk about check run away

24
00:00:58,870 --> 00:01:03,428
I'm going to talk about email security

25
00:01:01,000 --> 00:01:05,560
that's a topic I like and that's why I'm

26
00:01:03,429 --> 00:01:06,299
very happy to be here in front of you

27
00:01:05,560 --> 00:01:10,030
guys

28
00:01:06,299 --> 00:01:13,180
so roughly I'm going to divide that

29
00:01:10,030 --> 00:01:16,110
plantation into two part so roughly 40

30
00:01:13,180 --> 00:01:19,090
minutes on Outlook attacking Outlook and

31
00:01:16,110 --> 00:01:22,299
another five or so minutes on on

32
00:01:19,090 --> 00:01:25,210
exchange so for once I'm going to start

33
00:01:22,299 --> 00:01:27,189
my presentation we have a demo so that

34
00:01:25,210 --> 00:01:27,880
you guys have a good idea of what I'm

35
00:01:27,189 --> 00:01:29,919
talking about

36
00:01:27,880 --> 00:01:32,560
so think about outlook what would be

37
00:01:29,920 --> 00:01:34,869
according to you the worst case in are

38
00:01:32,560 --> 00:01:39,460
you far out to people you can probably

39
00:01:34,869 --> 00:01:41,829
think about an email that you you read

40
00:01:39,460 --> 00:01:44,259
you your read it and you see it in the

41
00:01:41,829 --> 00:01:45,820
preview pane and then you get home so I

42
00:01:44,259 --> 00:01:48,820
tell you something first even worse

43
00:01:45,820 --> 00:01:50,439
there is variability is affecting the

44
00:01:48,820 --> 00:01:52,089
sync engine for example you don't even

45
00:01:50,439 --> 00:01:54,100
need to see those emails

46
00:01:52,090 --> 00:01:55,990
somebody just sent it to you I'll cook

47
00:01:54,100 --> 00:01:58,780
is connected on the internet and you get

48
00:01:55,990 --> 00:02:00,759
out no user interaction allowed I've

49
00:01:58,780 --> 00:02:02,710
been there for like 12 years or so

50
00:02:00,759 --> 00:02:06,430
that's really one of the worst bugs I've

51
00:02:02,710 --> 00:02:09,150
seen I'm not going to talk about that

52
00:02:06,430 --> 00:02:12,490
bug to Danvers but you'll get the CV in

53
00:02:09,150 --> 00:02:14,230
reference so it's parents for a minute

54
00:02:12,490 --> 00:02:15,170
that you've never seen what I just

55
00:02:14,230 --> 00:02:18,510
showed

56
00:02:15,170 --> 00:02:21,390
so thing about Outlook exploits is it

57
00:02:18,510 --> 00:02:23,940
something come on well not ready Venus I

58
00:02:21,390 --> 00:02:28,200
think I started in that field with DES

59
00:02:23,940 --> 00:02:29,790
about 20 years ago love litres CAC kagu

60
00:02:28,200 --> 00:02:31,500
something that was spreading with

61
00:02:29,790 --> 00:02:34,679
JavaScript signatures who would send an

62
00:02:31,500 --> 00:02:37,110
email and then it would Auto Kate using

63
00:02:34,680 --> 00:02:39,870
some signature something very funny but

64
00:02:37,110 --> 00:02:41,700
then basically nothing in 20 years

65
00:02:39,870 --> 00:02:46,280
occasionally we get some very good

66
00:02:41,700 --> 00:02:50,760
reports like like the one from hi fairy

67
00:02:46,280 --> 00:02:53,610
2015 14 16 he found a way to insert

68
00:02:50,760 --> 00:02:56,730
flash a flash object into an email send

69
00:02:53,610 --> 00:02:58,680
it to the client and using known for

70
00:02:56,730 --> 00:03:01,679
ability she managed to get remote code

71
00:02:58,680 --> 00:03:02,880
execution just by viewing animate quite

72
00:03:01,680 --> 00:03:06,840
good

73
00:03:02,880 --> 00:03:09,180
another one is Ryan handsome so you know

74
00:03:06,840 --> 00:03:12,180
it's one of this base at Microsoft where

75
00:03:09,180 --> 00:03:14,610
you just look at the inbox and suddenly

76
00:03:12,180 --> 00:03:16,170
you you see some emails about some

77
00:03:14,610 --> 00:03:16,769
somebody that you've never heard of

78
00:03:16,170 --> 00:03:18,540
before

79
00:03:16,769 --> 00:03:20,519
and there are three males three

80
00:03:18,540 --> 00:03:24,540
varieties and you look at the details

81
00:03:20,519 --> 00:03:28,200
and you're like wow if even half of

82
00:03:24,540 --> 00:03:30,540
these submissions all right it's bad for

83
00:03:28,200 --> 00:03:34,070
us turns out that that day he was right

84
00:03:30,540 --> 00:03:36,358
on all of them so yeah Thank You Ryan

85
00:03:34,070 --> 00:03:40,079
something quickly to talk about these

86
00:03:36,359 --> 00:03:44,070
issues in in a minute last point is

87
00:03:40,079 --> 00:03:47,519
probably the worst all these issues that

88
00:03:44,070 --> 00:03:49,380
affect outlook we don't know about them

89
00:03:47,519 --> 00:03:51,810
so I'm thinking for example of an expert

90
00:03:49,380 --> 00:03:54,780
resume 2016 that was affecting the

91
00:03:51,810 --> 00:03:56,910
Phantom gene in Ward so the attackers

92
00:03:54,780 --> 00:04:00,120
where we are using a war document to

93
00:03:56,910 --> 00:04:02,190
spread via malware and so the thing is

94
00:04:00,120 --> 00:04:03,810
they would attach that word document to

95
00:04:02,190 --> 00:04:05,640
an email send it to you and then you

96
00:04:03,810 --> 00:04:07,920
would open the attachment and get out

97
00:04:05,640 --> 00:04:10,529
thing is that nobody realized that that

98
00:04:07,920 --> 00:04:12,720
mano at that moment that you would be

99
00:04:10,530 --> 00:04:15,180
aware able to trigger if Lee exact same

100
00:04:12,720 --> 00:04:17,910
path just with an email without cook so

101
00:04:15,180 --> 00:04:23,640
you would you would not need that

102
00:04:17,910 --> 00:04:26,310
attachment other crazy things so outlook

103
00:04:23,640 --> 00:04:28,270
so that's it's like a warehouse to

104
00:04:26,310 --> 00:04:30,130
realize it's huge

105
00:04:28,270 --> 00:04:32,380
quick very quick summary of the attack

106
00:04:30,130 --> 00:04:34,240
surface you've got everything that is

107
00:04:32,380 --> 00:04:35,800
rated to animate everything you can find

108
00:04:34,240 --> 00:04:38,259
in animal that can be attachments that

109
00:04:35,800 --> 00:04:41,919
can be calendars that can be objects can

110
00:04:38,259 --> 00:04:45,729
be pictures fonts you name it you've got

111
00:04:41,919 --> 00:04:49,090
also or V over things rated two

112
00:04:45,729 --> 00:04:52,150
protocols can be SMTP pop3 or some

113
00:04:49,090 --> 00:04:55,239
exchange protocols like go to discover

114
00:04:52,150 --> 00:05:00,099
and summer you've got all the spoofing

115
00:04:55,240 --> 00:05:02,250
issues can be certs can be grms etc and

116
00:05:00,099 --> 00:05:04,840
you've got also while also remaining

117
00:05:02,250 --> 00:05:06,639
macros because outlook is part of a fee

118
00:05:04,840 --> 00:05:08,229
so you've got micros so think for

119
00:05:06,639 --> 00:05:11,380
example the scenario would have somebody

120
00:05:08,229 --> 00:05:13,568
would send you an email and that mate

121
00:05:11,380 --> 00:05:15,130
would contain macros and you would be on

122
00:05:13,569 --> 00:05:17,310
by Michaels I've never seen that

123
00:05:15,130 --> 00:05:20,469
scenario but maybe maybe it's possible

124
00:05:17,310 --> 00:05:22,509
what I'm going to talk about here of

125
00:05:20,470 --> 00:05:25,960
course I just have 30 minutes with you

126
00:05:22,509 --> 00:05:27,880
so almost nothing or the object gief mic

127
00:05:25,960 --> 00:05:31,030
you properties under rich text format

128
00:05:27,880 --> 00:05:33,669
and before I go on so you might be

129
00:05:31,030 --> 00:05:35,229
wondering why I'm doing that because I

130
00:05:33,669 --> 00:05:37,659
told you that hello for myself and you

131
00:05:35,229 --> 00:05:39,940
might be thinking this guy's he's crazy

132
00:05:37,659 --> 00:05:41,530
he says he works so much stuff and he is

133
00:05:39,940 --> 00:05:45,009
literally going to teach us how to work

134
00:05:41,530 --> 00:05:45,638
out oh yeah I get your point and you're

135
00:05:45,009 --> 00:05:47,800
right

136
00:05:45,639 --> 00:05:49,780
but that's not the point of this

137
00:05:47,800 --> 00:05:52,360
presentation my point is that there are

138
00:05:49,780 --> 00:05:55,000
all these exploits around there in the

139
00:05:52,360 --> 00:05:56,409
wild people are using them it's a

140
00:05:55,000 --> 00:05:58,930
question that I have is how do I get

141
00:05:56,409 --> 00:06:02,139
them how do I fix them so that what

142
00:05:58,930 --> 00:06:06,240
customers are happy I don't have that

143
00:06:02,139 --> 00:06:10,300
many that many answer for that so

144
00:06:06,240 --> 00:06:13,180
question is why aren't researchers

145
00:06:10,300 --> 00:06:15,190
reporting this bugs to us or we do

146
00:06:13,180 --> 00:06:20,380
occasionally they do like I feel like

147
00:06:15,190 --> 00:06:22,870
Ryan but we did more so why maybe

148
00:06:20,380 --> 00:06:24,370
because I don't know lack of interest in

149
00:06:22,870 --> 00:06:26,380
the area maybe because they don't have

150
00:06:24,370 --> 00:06:29,110
access to view of these symbols which is

151
00:06:26,380 --> 00:06:32,979
a which is a good point it's not easy to

152
00:06:29,110 --> 00:06:35,770
debug and to reverse a huge a huge error

153
00:06:32,979 --> 00:06:38,560
so we thought what about presenting your

154
00:06:35,770 --> 00:06:40,529
research and some cases that we got and

155
00:06:38,560 --> 00:06:43,330
so of course

156
00:06:40,529 --> 00:06:45,009
and I'm sure you assume it also run

157
00:06:43,330 --> 00:06:48,550
abilities that I'm going to plant here

158
00:06:45,009 --> 00:06:51,639
I've been fixed for some quite a while

159
00:06:48,550 --> 00:06:53,979
ago so let's dive into it so where would

160
00:06:51,639 --> 00:06:56,710
you start to look for so you can type

161
00:06:53,979 --> 00:06:58,568
outlook features in Google and one of

162
00:06:56,710 --> 00:06:59,318
the first links that you will see is

163
00:06:58,569 --> 00:07:01,509
this one

164
00:06:59,319 --> 00:07:04,150
something mentioning TNF rich text

165
00:07:01,509 --> 00:07:06,249
format and specifically you look at the

166
00:07:04,150 --> 00:07:09,489
second point second bullet and you see

167
00:07:06,249 --> 00:07:11,379
the special outlook features that's

168
00:07:09,490 --> 00:07:14,319
obviously the ones that really want to

169
00:07:11,379 --> 00:07:17,080
attack here so once that pop card so

170
00:07:14,319 --> 00:07:19,330
what's a 10-year female so say that

171
00:07:17,080 --> 00:07:22,120
you're using outlook and somebody sends

172
00:07:19,330 --> 00:07:24,818
you an email so you see this and then

173
00:07:22,120 --> 00:07:28,539
you look on the server so you see the

174
00:07:24,819 --> 00:07:31,990
emitter and then you see something in

175
00:07:28,539 --> 00:07:35,710
the second tone type set to application

176
00:07:31,990 --> 00:07:37,599
MS TNF so this is that part in base64 at

177
00:07:35,710 --> 00:07:39,998
the bottom of email you decode it and

178
00:07:37,599 --> 00:07:41,979
then you see something that that is

179
00:07:39,999 --> 00:07:44,169
totally unintelligible you have just no

180
00:07:41,979 --> 00:07:46,539
idea where what's what's lying there

181
00:07:44,169 --> 00:07:48,729
it's just a another file format so good

182
00:07:46,539 --> 00:07:52,169
news is that as we've many file formats

183
00:07:48,729 --> 00:07:55,508
that belong to Microsoft the

184
00:07:52,169 --> 00:07:57,459
specifications are open so just for that

185
00:07:55,509 --> 00:07:59,379
link and you will find them so what is

186
00:07:57,459 --> 00:08:03,339
January physically just a seconds of

187
00:07:59,379 --> 00:08:06,279
objects containers properties here

188
00:08:03,339 --> 00:08:08,830
you've got an idea of how this works so

189
00:08:06,279 --> 00:08:12,099
I developed no one no template so that I

190
00:08:08,830 --> 00:08:13,539
would be able to see easily more easily

191
00:08:12,099 --> 00:08:16,509
all those properties

192
00:08:13,539 --> 00:08:20,919
I have never released that template am i

193
00:08:16,509 --> 00:08:23,680
doing I might do it one day so my my

194
00:08:20,919 --> 00:08:26,469
intentions were to reduce it when

195
00:08:23,680 --> 00:08:28,389
somebody send me a nice case affecting

196
00:08:26,469 --> 00:08:31,748
the TNF properties so I haven't got that

197
00:08:28,389 --> 00:08:34,599
case so far but maybe one of you guys

198
00:08:31,749 --> 00:08:37,180
will do and my intention was to publish

199
00:08:34,599 --> 00:08:40,510
a blog post with some buddies and a

200
00:08:37,179 --> 00:08:43,929
template so in C maybe one day hmm so

201
00:08:40,510 --> 00:08:48,310
let me talk about first any talk first

202
00:08:43,929 --> 00:08:49,849
about the rich text format so one of the

203
00:08:48,310 --> 00:08:52,939
common

204
00:08:49,850 --> 00:08:52,940
[Music]

205
00:08:53,330 --> 00:08:59,400
let's say yeah when a one of the common

206
00:08:56,610 --> 00:09:01,830
view of DNA via emails and rich text

207
00:08:59,400 --> 00:09:04,740
image is that very same people think

208
00:09:01,830 --> 00:09:06,180
that when you select rich text format in

209
00:09:04,740 --> 00:09:08,730
Outlook and you send we made that you're

210
00:09:06,180 --> 00:09:10,770
just going to send a word document to he

211
00:09:08,730 --> 00:09:14,010
to the other and that's partly true

212
00:09:10,770 --> 00:09:16,949
you're sending some rich text you're

213
00:09:14,010 --> 00:09:18,330
saying some rich text format but apart

214
00:09:16,950 --> 00:09:20,640
from that there also orders over

215
00:09:18,330 --> 00:09:22,650
properties in gif so I'm just going to

216
00:09:20,640 --> 00:09:24,870
focus here on the PR

217
00:09:22,650 --> 00:09:27,060
RTF compressed property so it's got

218
00:09:24,870 --> 00:09:30,950
various I headings so the most common

219
00:09:27,060 --> 00:09:34,349
ones is the compressed one as a review

220
00:09:30,950 --> 00:09:36,180
so something has to do with some

221
00:09:34,350 --> 00:09:39,090
compression in binary you've got also

222
00:09:36,180 --> 00:09:42,329
smella encoding which is just plain text

223
00:09:39,090 --> 00:09:45,270
to my knowledge it's not possible to

224
00:09:42,330 --> 00:09:47,490
have outlooks and anime like this in

225
00:09:45,270 --> 00:09:50,189
plain text but maybe there are some

226
00:09:47,490 --> 00:09:52,710
possibilities with the old Eclipse old

227
00:09:50,190 --> 00:09:54,840
out of versions and maybe Outlook 97

228
00:09:52,710 --> 00:09:57,600
something like that but definitely not

229
00:09:54,840 --> 00:10:01,980
in the recent versions so if you guys

230
00:09:57,600 --> 00:10:04,220
think about furthering this because some

231
00:10:01,980 --> 00:10:08,700
of you do that and we still get cases

232
00:10:04,220 --> 00:10:11,250
just be aware that as a file to a format

233
00:10:08,700 --> 00:10:14,010
parser is very pedantic and so most of

234
00:10:11,250 --> 00:10:17,160
your inputs would probably be rejected

235
00:10:14,010 --> 00:10:19,920
however in some cases you might still be

236
00:10:17,160 --> 00:10:22,920
lucky and hit some frankly conditions

237
00:10:19,920 --> 00:10:25,260
and we which might then trigger some

238
00:10:22,920 --> 00:10:28,229
bugs yeah that happens I think that we

239
00:10:25,260 --> 00:10:31,050
last I think that we fixed a bug in in

240
00:10:28,230 --> 00:10:33,210
in August last August somebody just

241
00:10:31,050 --> 00:10:35,760
first some emails and managed to find a

242
00:10:33,210 --> 00:10:38,790
user after free and so it works but yeah

243
00:10:35,760 --> 00:10:40,350
so just be aware that you're probably

244
00:10:38,790 --> 00:10:43,230
going to waste your time if you do that

245
00:10:40,350 --> 00:10:45,660
so instead if you want to face it just

246
00:10:43,230 --> 00:10:48,420
use the interrup library so it's much

247
00:10:45,660 --> 00:10:50,430
it's much easier so you use dotnet to

248
00:10:48,420 --> 00:10:53,099
create your program and send your image

249
00:10:50,430 --> 00:10:56,640
and that's it I come back to that in a

250
00:10:53,100 --> 00:10:57,570
minute so let me focus first on on the

251
00:10:56,640 --> 00:11:02,580
RTF

252
00:10:57,570 --> 00:11:05,280
PRK format so as you may know the RTF

253
00:11:02,580 --> 00:11:10,500
belongs to world so there's the dare a

254
00:11:05,280 --> 00:11:12,930
dll called WWE the DLA and so it shares

255
00:11:10,500 --> 00:11:14,310
a code is also shared by Outlook and so

256
00:11:12,930 --> 00:11:17,400
you may think well they're probably

257
00:11:14,310 --> 00:11:20,069
features in outlet that are definitely

258
00:11:17,400 --> 00:11:21,390
not needed and I knew you might be right

259
00:11:20,070 --> 00:11:24,210
so thing about all the specifications

260
00:11:21,390 --> 00:11:26,400
the RTF specifications are used there

261
00:11:24,210 --> 00:11:28,380
are lots of keywords and some of them

262
00:11:26,400 --> 00:11:30,300
are definitely not needed in Outlook so

263
00:11:28,380 --> 00:11:32,070
one of this is a template keyword and

264
00:11:30,300 --> 00:11:34,469
over one could be the object for example

265
00:11:32,070 --> 00:11:37,770
inserting a flash object in an email so

266
00:11:34,470 --> 00:11:39,780
I'm coming I'm talking more I'm going to

267
00:11:37,770 --> 00:11:42,990
talk more but the these distant played

268
00:11:39,780 --> 00:11:45,600
feature so so these issues was brought

269
00:11:42,990 --> 00:11:47,970
to us by Ryan Ryan Anson

270
00:11:45,600 --> 00:11:51,360
so you are studying 1/2 s bug are

271
00:11:47,970 --> 00:11:53,550
inserting flash into an email we fixed

272
00:11:51,360 --> 00:11:57,750
it and then he found a way to bypass

273
00:11:53,550 --> 00:12:01,140
that fixed he just sent an email with a

274
00:11:57,750 --> 00:12:05,400
sample keyword and in the template huge

275
00:12:01,140 --> 00:12:07,500
point the source to an award chef that

276
00:12:05,400 --> 00:12:11,400
would that would be an asset on a remote

277
00:12:07,500 --> 00:12:13,680
chair and and just by doing that she

278
00:12:11,400 --> 00:12:16,380
managed to work around or fix and he

279
00:12:13,680 --> 00:12:19,410
managed to load flash again so at that

280
00:12:16,380 --> 00:12:20,970
moment he was able to send an email that

281
00:12:19,410 --> 00:12:23,030
would trigger again flash and that's how

282
00:12:20,970 --> 00:12:25,920
we managed to get remote code execution

283
00:12:23,030 --> 00:12:29,370
very verse there's more in this attacks

284
00:12:25,920 --> 00:12:31,890
so if you think about it you were just

285
00:12:29,370 --> 00:12:34,350
able to trigger the the RTF parsing code

286
00:12:31,890 --> 00:12:37,199
but with this with this feature you can

287
00:12:34,350 --> 00:12:39,350
trick world into loading whatever format

288
00:12:37,200 --> 00:12:42,990
it it supports basically for example

289
00:12:39,350 --> 00:12:44,760
this is a legacy war format surrogacy

290
00:12:42,990 --> 00:12:47,850
document format which should belongs to

291
00:12:44,760 --> 00:12:50,550
to the 90s seed possible so we have a

292
00:12:47,850 --> 00:12:54,120
feature like this you opened a lot more

293
00:12:50,550 --> 00:12:55,949
of attack surface so crazy thing another

294
00:12:54,120 --> 00:12:58,170
bug with the template keyword so you

295
00:12:55,950 --> 00:13:01,260
channel several documents and in VN you

296
00:12:58,170 --> 00:13:03,209
get a u AF so how do you think is

297
00:13:01,260 --> 00:13:05,340
approaching mediated that issue

298
00:13:03,210 --> 00:13:07,560
well easy register improve the

299
00:13:05,340 --> 00:13:12,060
functionality sometimes I do that and we

300
00:13:07,560 --> 00:13:15,319
should Frank that poor so now coming to

301
00:13:12,060 --> 00:13:17,750
the interrupt API so as I as I

302
00:13:15,320 --> 00:13:20,630
tell you it's something RIT it's

303
00:13:17,750 --> 00:13:22,940
available in dotnet and it makes it

304
00:13:20,630 --> 00:13:25,399
makes your life much easier when you

305
00:13:22,940 --> 00:13:29,329
want to send emails so something that I

306
00:13:25,399 --> 00:13:31,579
I want I want to stress is a message

307
00:13:29,329 --> 00:13:34,370
class message class of an email by

308
00:13:31,579 --> 00:13:36,019
default it's set to where I don't

309
00:13:34,370 --> 00:13:37,670
remember exactly which said but like

310
00:13:36,019 --> 00:13:41,750
default in my something but you can

311
00:13:37,670 --> 00:13:44,180
specify it to be whatever you can for

312
00:13:41,750 --> 00:13:46,250
example there is that IP MDOT contact

313
00:13:44,180 --> 00:13:47,959
with such class if you send an email

314
00:13:46,250 --> 00:13:50,630
like this what do you think will happen

315
00:13:47,959 --> 00:13:53,689
well you won't see standard email

316
00:13:50,630 --> 00:13:55,490
instead you will see the contact pine so

317
00:13:53,690 --> 00:13:58,550
you've got outlook and instead of

318
00:13:55,490 --> 00:14:01,670
reading your image then suddenly you see

319
00:13:58,550 --> 00:14:04,519
a contact pain and and the thing is for

320
00:14:01,670 --> 00:14:06,680
all this message places each has its own

321
00:14:04,519 --> 00:14:08,329
form and needs own properties

322
00:14:06,680 --> 00:14:10,910
so for example for this one if you look

323
00:14:08,329 --> 00:14:12,800
at the top right corner there is a

324
00:14:10,910 --> 00:14:15,350
picture here so you're going to think

325
00:14:12,800 --> 00:14:17,959
yeah you can insert pictures in in

326
00:14:15,350 --> 00:14:21,110
Estonia on your right but here in this

327
00:14:17,959 --> 00:14:23,869
one stack to display that picture is

328
00:14:21,110 --> 00:14:27,290
different here you're using the GDI plus

329
00:14:23,870 --> 00:14:29,149
api's the GTI per stack - despite a

330
00:14:27,290 --> 00:14:30,829
teacher while that you know standard

331
00:14:29,149 --> 00:14:34,130
limit you are going to use the office

332
00:14:30,829 --> 00:14:36,439
one so if you've got an email gravity in

333
00:14:34,130 --> 00:14:38,389
GDI or GI plus then you might be able to

334
00:14:36,440 --> 00:14:41,540
trigger it from here so think about it

335
00:14:38,389 --> 00:14:43,370
when you're looking for abilities so

336
00:14:41,540 --> 00:14:47,120
there are several classes message

337
00:14:43,370 --> 00:14:51,380
classes so you you can find them there's

338
00:14:47,120 --> 00:14:53,660
another link for more if you're an even

339
00:14:51,380 --> 00:14:55,519
some that are not written not described

340
00:14:53,660 --> 00:14:57,230
on these things but if you know about

341
00:14:55,519 --> 00:14:59,990
reverse engineering and pressure that

342
00:14:57,230 --> 00:15:03,740
you can find a lot so I'd like to to

343
00:14:59,990 --> 00:15:06,199
focus on one for a moment IPM remote so

344
00:15:03,740 --> 00:15:10,819
this one this case was sent to us by a

345
00:15:06,199 --> 00:15:12,800
gentleman we didn't give it a CV because

346
00:15:10,819 --> 00:15:15,529
we didn't service so bad because that

347
00:15:12,800 --> 00:15:17,750
was just a null pointer so what HN did

348
00:15:15,529 --> 00:15:20,899
was just take a normal email and chance

349
00:15:17,750 --> 00:15:22,519
a message / to ikm remote and just by

350
00:15:20,899 --> 00:15:24,529
doing so he managed to trigger a null

351
00:15:22,519 --> 00:15:27,410
pointer in the preview pane so it's just

352
00:15:24,529 --> 00:15:29,540
an operator so not that interesting

353
00:15:27,410 --> 00:15:31,370
you you come to exploit that city you

354
00:15:29,540 --> 00:15:33,829
can't cross the client but not really

355
00:15:31,370 --> 00:15:36,860
really interesting anyway it made this

356
00:15:33,829 --> 00:15:38,750
is way unto death plantation I was still

357
00:15:36,860 --> 00:15:41,329
interesting now have you ever one that I

358
00:15:38,750 --> 00:15:43,430
wanted to talk more about was the free

359
00:15:41,329 --> 00:15:46,128
document so basically I p.m. the

360
00:15:43,430 --> 00:15:50,410
document that whatever you want so Ryan

361
00:15:46,129 --> 00:15:54,079
son sent us a case where he was able to

362
00:15:50,410 --> 00:15:57,019
open an to send an email that was by

363
00:15:54,079 --> 00:15:58,638
double bypass protected mode so

364
00:15:57,019 --> 00:16:00,439
basically you would have two attachments

365
00:15:58,639 --> 00:16:03,040
in an email one a Word document

366
00:16:00,439 --> 00:16:05,899
no Stano attachment and the other one

367
00:16:03,040 --> 00:16:08,449
and all the attachments and he noticed

368
00:16:05,899 --> 00:16:12,129
that if we opened that ot attachment

369
00:16:08,449 --> 00:16:16,279
then Ward would run without Preston mode

370
00:16:12,129 --> 00:16:20,269
this add it with this over CD where

371
00:16:16,279 --> 00:16:23,740
office documents run without without

372
00:16:20,269 --> 00:16:28,040
interaction and you can get a nice

373
00:16:23,740 --> 00:16:30,769
one-click RC so this is just the code to

374
00:16:28,040 --> 00:16:33,709
trigger Ryan issues but now I've got a

375
00:16:30,769 --> 00:16:35,149
video for you that will just show

376
00:16:33,709 --> 00:16:38,089
basically what's going on

377
00:16:35,149 --> 00:16:41,360
so that's right first issue so you've

378
00:16:38,089 --> 00:16:43,519
got animator receive it and words open

379
00:16:41,360 --> 00:16:43,910
directly in the preview pane but that's

380
00:16:43,519 --> 00:16:46,850
fine

381
00:16:43,910 --> 00:16:49,189
here we're in up container so this is

382
00:16:46,850 --> 00:16:50,750
project image so this is fine so now

383
00:16:49,189 --> 00:16:53,930
what happened if you double click that

384
00:16:50,750 --> 00:16:54,259
email if you try to open it in in a new

385
00:16:53,930 --> 00:16:56,479
window

386
00:16:54,259 --> 00:16:58,459
well then Asuka takes a totally

387
00:16:56,480 --> 00:17:01,759
different path and here we're using only

388
00:16:58,459 --> 00:17:02,959
to render the attachment and so right

389
00:17:01,759 --> 00:17:06,079
now if you look at word

390
00:17:02,959 --> 00:17:09,438
well it's run with medium integrity so

391
00:17:06,079 --> 00:17:12,168
you've actually bypass the sandbox so

392
00:17:09,439 --> 00:17:15,260
now if you look at the specifics of this

393
00:17:12,169 --> 00:17:18,169
you think about yeah well so he said

394
00:17:15,260 --> 00:17:20,990
that that attachment was inserted with

395
00:17:18,169 --> 00:17:24,140
only so maybe this has to do with re etc

396
00:17:20,990 --> 00:17:27,500
and so sorry Matt look at this email and

397
00:17:24,140 --> 00:17:29,570
see that there is a class ID of war that

398
00:17:27,500 --> 00:17:31,280
one there and you might think what if I

399
00:17:29,570 --> 00:17:33,470
change it what if I change it for

400
00:17:31,280 --> 00:17:34,549
example to be to the class idea of the

401
00:17:33,470 --> 00:17:38,090
equation editor

402
00:17:34,549 --> 00:17:40,250
yeah and you'd be successful so why did

403
00:17:38,090 --> 00:17:44,179
I use that example because

404
00:17:40,250 --> 00:17:47,420
two years ago I think we got a case of

405
00:17:44,180 --> 00:17:49,640
somebody who managed to exploit a stack

406
00:17:47,420 --> 00:17:52,250
overflow in the equation editor and the

407
00:17:49,640 --> 00:17:54,050
thing is we were still shipping that

408
00:17:52,250 --> 00:17:56,030
equation editor even if this this

409
00:17:54,050 --> 00:17:58,340
component add about 20 years ago

410
00:17:56,030 --> 00:18:00,410
we are still shipping it with the most

411
00:17:58,340 --> 00:18:02,600
recent versions of our product and the

412
00:18:00,410 --> 00:18:05,210
thing is this component has just add

413
00:18:02,600 --> 00:18:08,389
just no mitigation implement that at all

414
00:18:05,210 --> 00:18:11,240
no es are our new stack cookies so no

415
00:18:08,390 --> 00:18:14,870
nothing so if you add if you found a bug

416
00:18:11,240 --> 00:18:18,650
in there you'd be able to exploit it

417
00:18:14,870 --> 00:18:21,020
like that way so use two vulnerabilities

418
00:18:18,650 --> 00:18:24,200
and then you managed to get one clicker

419
00:18:21,020 --> 00:18:26,540
see with animal it's quite good so one

420
00:18:24,200 --> 00:18:29,270
thing I wanted to show you also is about

421
00:18:26,540 --> 00:18:31,250
that we received about six months ago so

422
00:18:29,270 --> 00:18:34,090
it was patched last August so three

423
00:18:31,250 --> 00:18:38,480
months ago from now what's one by Selam

424
00:18:34,090 --> 00:18:40,730
logic issues affecting team invites team

425
00:18:38,480 --> 00:18:42,680
meetings so here something something

426
00:18:40,730 --> 00:18:45,200
very simple you just tweak some

427
00:18:42,680 --> 00:18:48,800
properties in the TNF email and you

428
00:18:45,200 --> 00:18:52,610
would manage to - to trigger like some

429
00:18:48,800 --> 00:18:56,389
very interesting features shall execute

430
00:18:52,610 --> 00:18:59,270
on whatever you want so I'm quite I'm

431
00:18:56,390 --> 00:19:00,500
quite scared of doing that but we might

432
00:18:59,270 --> 00:19:06,680
see hopefully it will work

433
00:19:00,500 --> 00:19:09,980
yeah so I I have it here so let's see if

434
00:19:06,680 --> 00:19:14,540
I can show it to you so yes so this is

435
00:19:09,980 --> 00:19:21,100
the original email with my template so

436
00:19:14,540 --> 00:19:21,100
as you can see or as you can guess more

437
00:19:21,760 --> 00:19:28,010
naturalism sure it is because I can't

438
00:19:26,420 --> 00:19:30,650
really read what's on the screen well

439
00:19:28,010 --> 00:19:33,350
yeah okay so basically here you've got a

440
00:19:30,650 --> 00:19:36,290
property in question and right after

441
00:19:33,350 --> 00:19:39,050
you've got a call to culture so that was

442
00:19:36,290 --> 00:19:42,620
quite whirring yeah but anyway fine

443
00:19:39,050 --> 00:19:46,090
sorry I'm for reporting that to us

444
00:19:42,620 --> 00:19:46,090
all right let's carry on

445
00:19:52,210 --> 00:20:00,890
yeah all good so I wanted to talk more

446
00:19:58,010 --> 00:20:05,150
about early so if you took a phase

447
00:20:00,890 --> 00:20:07,910
research you you see that he spent some

448
00:20:05,150 --> 00:20:10,730
time finally go away to to load flash in

449
00:20:07,910 --> 00:20:12,710
an email so you're curious and you want

450
00:20:10,730 --> 00:20:15,050
to see how we fix that because we're

451
00:20:12,710 --> 00:20:17,930
running straight within an email that's

452
00:20:15,050 --> 00:20:19,790
something quite scary so one thing that

453
00:20:17,930 --> 00:20:22,790
you might want to look at is how does

454
00:20:19,790 --> 00:20:24,680
messages are are created so there are

455
00:20:22,790 --> 00:20:26,570
two formats in Outlook varies via email

456
00:20:24,680 --> 00:20:29,390
format at the results of the message one

457
00:20:26,570 --> 00:20:31,730
that energy so this this pictures just

458
00:20:29,390 --> 00:20:34,370
to show you that message is just an

459
00:20:31,730 --> 00:20:36,740
early document with some structures some

460
00:20:34,370 --> 00:20:39,260
strings inside and so this is about just

461
00:20:36,740 --> 00:20:43,340
how know the object is inserted and

462
00:20:39,260 --> 00:20:44,810
described in this and it's valid so

463
00:20:43,340 --> 00:20:46,610
you're going to say yeah but how do I

464
00:20:44,810 --> 00:20:48,560
divide that oh yeah good point you don't

465
00:20:46,610 --> 00:20:51,290
have the three symbols I do because I

466
00:20:48,560 --> 00:20:53,929
love for ourselves but what you have is

467
00:20:51,290 --> 00:20:56,960
very window symbols and everything that

468
00:20:53,930 --> 00:20:59,420
is related to Olli you is publicly

469
00:20:56,960 --> 00:21:02,210
documented for example in OD 42 you've

470
00:20:59,420 --> 00:21:04,730
got the symbols so what you could do is

471
00:21:02,210 --> 00:21:08,060
just put some breakpoints there and and

472
00:21:04,730 --> 00:21:10,670
then you will quickly realize that what

473
00:21:08,060 --> 00:21:14,629
I say was doing was he found a way to

474
00:21:10,670 --> 00:21:17,480
load another object and what we what we

475
00:21:14,630 --> 00:21:19,700
did was to stop there's all the objects

476
00:21:17,480 --> 00:21:21,290
from loading but if you're curious you

477
00:21:19,700 --> 00:21:23,240
really see that there was still one

478
00:21:21,290 --> 00:21:25,850
object that we could load and this

479
00:21:23,240 --> 00:21:28,010
object we could insert some monitors in

480
00:21:25,850 --> 00:21:30,649
there so Weinman occurs about two three

481
00:21:28,010 --> 00:21:33,080
years ago we've got loads of examples

482
00:21:30,650 --> 00:21:36,680
loads of exploits effective des and it

483
00:21:33,080 --> 00:21:39,020
turns out that you were able to load

484
00:21:36,680 --> 00:21:40,970
them in Outlook which was quite bad so

485
00:21:39,020 --> 00:21:43,550
I'm going to talk about desert so the

486
00:21:40,970 --> 00:21:45,860
first example that I have is a one that

487
00:21:43,550 --> 00:21:48,620
was reported to us by wildermann so we

488
00:21:45,860 --> 00:21:49,429
managed to insert an object using truth

489
00:21:48,620 --> 00:21:52,189
97

490
00:21:49,430 --> 00:21:55,400
a standard link and this object we just

491
00:21:52,190 --> 00:21:58,910
trigger a fine moniker and he had known

492
00:21:55,400 --> 00:22:02,180
CV affecting SMB and so he was able to

493
00:21:58,910 --> 00:22:05,410
send any animate that when you read that

494
00:22:02,180 --> 00:22:08,150
you would just crash with a blue-screen

495
00:22:05,410 --> 00:22:10,610
Charon's Obol yeah create quite annoying

496
00:22:08,150 --> 00:22:13,370
not necessary good for a remote code

497
00:22:10,610 --> 00:22:15,379
execution but still very good for dos if

498
00:22:13,370 --> 00:22:17,540
you look more at this fine moniker

499
00:22:15,380 --> 00:22:19,820
you are so see even the code that there

500
00:22:17,540 --> 00:22:22,480
is a part that can cover some link

501
00:22:19,820 --> 00:22:26,030
shortcuts so windows shortcuts dot nnk

502
00:22:22,480 --> 00:22:28,790
very famous since Stuxnet for example so

503
00:22:26,030 --> 00:22:31,220
the question is can you load the library

504
00:22:28,790 --> 00:22:33,379
for a from a shortcut within an email

505
00:22:31,220 --> 00:22:35,270
maybe I don't know I've never tried but

506
00:22:33,380 --> 00:22:37,400
this is a possibility that that we

507
00:22:35,270 --> 00:22:39,500
should have in mind instead here's a

508
00:22:37,400 --> 00:22:42,590
stack trace of a bug in structure query

509
00:22:39,500 --> 00:22:45,020
that was a possible to tree or with with

510
00:22:42,590 --> 00:22:49,459
a shortcut or with an email so I'd like

511
00:22:45,020 --> 00:22:51,590
to take more time on the AB ref moniker

512
00:22:49,460 --> 00:22:54,620
so I did that research but three years

513
00:22:51,590 --> 00:22:56,330
ago and at that moment I had just no

514
00:22:54,620 --> 00:22:59,090
idea of what this monikers where and so

515
00:22:56,330 --> 00:23:01,669
I decided to focus on the object vinegar

516
00:22:59,090 --> 00:23:04,399
and good thing that I did so this one is

517
00:23:01,670 --> 00:23:08,630
just about a marshaling custom come

518
00:23:04,400 --> 00:23:10,460
object so it turns out that you were we

519
00:23:08,630 --> 00:23:13,850
were able to send an email that would

520
00:23:10,460 --> 00:23:15,530
marshal this custom object so you don't

521
00:23:13,850 --> 00:23:18,230
you can't emotional everything I think

522
00:23:15,530 --> 00:23:20,270
there they were at that moment seventeen

523
00:23:18,230 --> 00:23:25,100
or eighteen trusted on Marshall in the

524
00:23:20,270 --> 00:23:28,460
system so I took one I chose one which

525
00:23:25,100 --> 00:23:30,139
was we a mess with control object so in

526
00:23:28,460 --> 00:23:31,460
this in this library

527
00:23:30,140 --> 00:23:34,070
there's if there were several

528
00:23:31,460 --> 00:23:36,650
undershirts and one couldn't cut my

529
00:23:34,070 --> 00:23:38,149
intention so it was this one on this one

530
00:23:36,650 --> 00:23:41,390
you can see the code that there is a

531
00:23:38,150 --> 00:23:43,100
loop that just goes over things that

532
00:23:41,390 --> 00:23:46,130
you've got in your stream and it tries

533
00:23:43,100 --> 00:23:48,350
to instantiate some come objects' on VI

534
00:23:46,130 --> 00:23:50,810
persists trimming it interface and if

535
00:23:48,350 --> 00:23:53,000
you've got some some some knowledge of

536
00:23:50,810 --> 00:23:53,659
how windows work and how does come

537
00:23:53,000 --> 00:23:55,520
objector

538
00:23:53,660 --> 00:23:58,010
huge we all know that this interface is

539
00:23:55,520 --> 00:24:00,320
the one that is used to in some shell

540
00:23:58,010 --> 00:24:03,020
scripts so typically I so at that moment

541
00:24:00,320 --> 00:24:06,800
I knew that I was able to instantiate

542
00:24:03,020 --> 00:24:08,720
flash again and so at that moment my

543
00:24:06,800 --> 00:24:10,879
skip manager I think she told me that

544
00:24:08,720 --> 00:24:13,640
Nico you've been at Microsoft for almost

545
00:24:10,880 --> 00:24:15,670
a year now it's time to leave Adobe

546
00:24:13,640 --> 00:24:18,910
behind and start to move more on some

547
00:24:15,670 --> 00:24:20,680
stuff so instead think about focus on

548
00:24:18,910 --> 00:24:21,130
work stuff that was that was a good

549
00:24:20,680 --> 00:24:23,680
point

550
00:24:21,130 --> 00:24:26,230
so I did flush and instead that I focus

551
00:24:23,680 --> 00:24:28,390
on and overcome object the XML feed

552
00:24:26,230 --> 00:24:30,760
moniker how did I found it I don't know

553
00:24:28,390 --> 00:24:32,680
I I just tried them all I think I had

554
00:24:30,760 --> 00:24:33,100
like five thousand cup object on my

555
00:24:32,680 --> 00:24:35,680
machine

556
00:24:33,100 --> 00:24:38,740
I just tried them or loading some HTML

557
00:24:35,680 --> 00:24:41,020
some script see if one would react and

558
00:24:38,740 --> 00:24:43,180
this one reacted and so thanks to that

559
00:24:41,020 --> 00:24:44,560
one I was able to load the VB script so

560
00:24:43,180 --> 00:24:46,780
you send an email and then you are able

561
00:24:44,560 --> 00:24:47,919
to load some VB script so we are still a

562
00:24:46,780 --> 00:24:50,800
bit away from occult

563
00:24:47,920 --> 00:24:52,690
but not that far away just add a zero VB

564
00:24:50,800 --> 00:24:56,620
script zero days and here we go with

565
00:24:52,690 --> 00:24:58,180
your calc with a peb zo0b so multiple

566
00:24:56,620 --> 00:25:00,550
bugs fixed in these attacks

567
00:24:58,180 --> 00:25:01,240
so in via Marshalls in them as with

568
00:25:00,550 --> 00:25:05,110
Cydia

569
00:25:01,240 --> 00:25:08,470
of course so after that we decided to

570
00:25:05,110 --> 00:25:11,560
ship the activation Victor so we added a

571
00:25:08,470 --> 00:25:13,990
via breath and the XML monitor the

572
00:25:11,560 --> 00:25:16,960
external field moniker another one is do

573
00:25:13,990 --> 00:25:19,120
not load objects in the pane not signs

574
00:25:16,960 --> 00:25:21,010
of preview pane so just a pain in

575
00:25:19,120 --> 00:25:22,870
general because if you eat reply or if

576
00:25:21,010 --> 00:25:24,850
you eat forward then you might hit some

577
00:25:22,870 --> 00:25:27,250
different code in Outlook that are not

578
00:25:24,850 --> 00:25:30,070
necessary covered by the preview pane -

579
00:25:27,250 --> 00:25:32,530
as possible for example to get a RC at

580
00:25:30,070 --> 00:25:36,010
some point with the equation editor bug

581
00:25:32,530 --> 00:25:38,170
just by replying to that email so was

582
00:25:36,010 --> 00:25:41,379
quite bad another video script Bob of

583
00:25:38,170 --> 00:25:43,540
course so one thing that we might

584
00:25:41,380 --> 00:25:45,430
mention is that nowadays we can't load

585
00:25:43,540 --> 00:25:48,670
VB script anymore which is quite a good

586
00:25:45,430 --> 00:25:50,920
news and then on restrict objects loaded

587
00:25:48,670 --> 00:25:53,080
by the diagnostic service and if you

588
00:25:50,920 --> 00:25:54,880
follow that presentation so far you

589
00:25:53,080 --> 00:25:58,120
should be wondering what I'm talking

590
00:25:54,880 --> 00:26:01,090
about here the thing is this bug

591
00:25:58,120 --> 00:26:03,639
affecting varnish or it doesn't only

592
00:26:01,090 --> 00:26:05,439
affect outlook it affects basically

593
00:26:03,640 --> 00:26:08,320
everything in the system as Windows

594
00:26:05,440 --> 00:26:11,020
relies a lot of emotionally and

595
00:26:08,320 --> 00:26:14,340
emotionally income objects so you just

596
00:26:11,020 --> 00:26:17,260
need to think about the scenario where

597
00:26:14,340 --> 00:26:21,959
come highly welcomed object come

598
00:26:17,260 --> 00:26:24,820
applications would take some string and

599
00:26:21,960 --> 00:26:26,710
sterilize it for you and then even if

600
00:26:24,820 --> 00:26:28,899
there's some restrictions in the in the

601
00:26:26,710 --> 00:26:29,639
code in might just betrayed because to

602
00:26:28,900 --> 00:26:32,429
come through

603
00:26:29,639 --> 00:26:34,649
object has already been deserialized and

604
00:26:32,429 --> 00:26:38,009
this is exactly what's happening with

605
00:26:34,649 --> 00:26:39,718
the diagnostic series so how did I found

606
00:26:38,009 --> 00:26:43,289
ID service I didn't know about it

607
00:26:39,719 --> 00:26:46,529
point one 2016 I think look he art who

608
00:26:43,289 --> 00:26:47,820
used to walk from Google she found she

609
00:26:46,529 --> 00:26:50,789
found that the service

610
00:26:47,820 --> 00:26:53,879
who was with was there just load a

611
00:26:50,789 --> 00:26:56,849
library for you with system and where

612
00:26:53,879 --> 00:26:59,218
you see that your your ID like why did

613
00:26:56,849 --> 00:27:01,229
we do that and anyway if you look at the

614
00:26:59,219 --> 00:27:02,700
code in this the service where are lots

615
00:27:01,229 --> 00:27:04,619
of meters and most of them are

616
00:27:02,700 --> 00:27:08,309
restricted the thing is that there is

617
00:27:04,619 --> 00:27:10,889
one meter to get drafted up meter that

618
00:27:08,309 --> 00:27:12,749
takes us a far way and so there's some

619
00:27:10,889 --> 00:27:14,428
coded and meter that checks if you are

620
00:27:12,749 --> 00:27:17,700
authenticated if you've got the right to

621
00:27:14,429 --> 00:27:21,149
call this IP I but the thing is when you

622
00:27:17,700 --> 00:27:23,549
call it and you enter the beginning of a

623
00:27:21,149 --> 00:27:25,468
function it's already too late because

624
00:27:23,549 --> 00:27:27,658
the commas are will be already been

625
00:27:25,469 --> 00:27:30,629
unmuffled and so I've got a demo here

626
00:27:27,659 --> 00:27:33,149
for you just showing that I can just

627
00:27:30,629 --> 00:27:35,488
send an email then you look at you view

628
00:27:33,149 --> 00:27:42,119
it in the preview pane and then you get

629
00:27:35,489 --> 00:27:44,339
oh no you get on with system that was

630
00:27:42,119 --> 00:27:50,249
quite bad at a time so here you see not

631
00:27:44,339 --> 00:27:52,529
bad running with system so that's it for

632
00:27:50,249 --> 00:27:56,399
Outlook so obviously there's there are

633
00:27:52,529 --> 00:27:59,309
lots of things that I could cover I just

634
00:27:56,399 --> 00:28:01,079
covered a very tiny part here but yeah

635
00:27:59,309 --> 00:28:03,149
there are definitely lots of other

636
00:28:01,079 --> 00:28:06,239
things to go so I'd like you know to

637
00:28:03,149 --> 00:28:08,639
mention that a few words on exchange so

638
00:28:06,239 --> 00:28:10,609
again one of the main my main issues

639
00:28:08,639 --> 00:28:14,070
that stage one our startup project is

640
00:28:10,609 --> 00:28:16,908
where where where can I get some

641
00:28:14,070 --> 00:28:20,369
resources what has been done before

642
00:28:16,909 --> 00:28:22,559
where can I get some some some examples

643
00:28:20,369 --> 00:28:24,539
work where can I find something

644
00:28:22,559 --> 00:28:26,428
interesting to stolid research so for

645
00:28:24,539 --> 00:28:28,279
exchange there was basically nothing

646
00:28:26,429 --> 00:28:31,739
when I started at there was one example

647
00:28:28,279 --> 00:28:34,950
still an attack and exploit from the

648
00:28:31,739 --> 00:28:37,739
shadow brokers targeting in 2003 on I

649
00:28:34,950 --> 00:28:40,710
think Windows Server 2003 so that was

650
00:28:37,739 --> 00:28:43,470
quite old II let's say and

651
00:28:40,710 --> 00:28:44,600
I put it here something that was

652
00:28:43,470 --> 00:28:47,010
reported to zdi

653
00:28:44,600 --> 00:28:48,629
quite a bit unrelated to that research

654
00:28:47,010 --> 00:28:51,360
but to be honest there wasn't that many

655
00:28:48,630 --> 00:28:53,790
so I put the example here so here the

656
00:28:51,360 --> 00:28:57,360
attack would work you you will have to

657
00:28:53,790 --> 00:28:59,190
leave a voicemail message and then with

658
00:28:57,360 --> 00:29:01,350
some tricks you were able to dis your

659
00:28:59,190 --> 00:29:03,660
lies on a dotnet component and get

660
00:29:01,350 --> 00:29:04,889
remote code execution so not necessary

661
00:29:03,660 --> 00:29:07,650
something that has to do with an email

662
00:29:04,890 --> 00:29:10,290
but still something affecting us that's

663
00:29:07,650 --> 00:29:12,360
why I put it here so when you attack it

664
00:29:10,290 --> 00:29:15,420
or of course various attack scenarios

665
00:29:12,360 --> 00:29:17,669
what are you doing are you authenticated

666
00:29:15,420 --> 00:29:20,310
are you an anonymous attacker what are

667
00:29:17,670 --> 00:29:22,200
you doing are you trying to to dose the

668
00:29:20,310 --> 00:29:25,379
server are you trying to get remote code

669
00:29:22,200 --> 00:29:30,390
execution are you trying to get

670
00:29:25,380 --> 00:29:33,930
exercises trying some alt attacks like

671
00:29:30,390 --> 00:29:38,220
we saw in the previous presentations so

672
00:29:33,930 --> 00:29:40,230
yeah it's up to you really so am i what

673
00:29:38,220 --> 00:29:42,750
I wanted to do was to get a remote code

674
00:29:40,230 --> 00:29:45,330
execution on exchange so I spent some

675
00:29:42,750 --> 00:29:48,630
time on it so I found one component X

676
00:29:45,330 --> 00:29:51,169
RPC 42 I'm not covering this by this bit

677
00:29:48,630 --> 00:29:54,420
in this talk but I I covered it before

678
00:29:51,170 --> 00:29:56,310
so if you wish or curse you can see my

679
00:29:54,420 --> 00:29:58,020
talk at 4-4 con yeah

680
00:29:56,310 --> 00:30:02,280
those bits are covered but basically

681
00:29:58,020 --> 00:30:05,310
this was a library written in C C++ so

682
00:30:02,280 --> 00:30:07,110
still that you would steal attacks with

683
00:30:05,310 --> 00:30:09,360
memory corruptions found some bugs in

684
00:30:07,110 --> 00:30:12,120
there but nothing that I could exploit

685
00:30:09,360 --> 00:30:14,250
so but that's it that's it what some

686
00:30:12,120 --> 00:30:16,620
interesting research one thing still

687
00:30:14,250 --> 00:30:20,730
that I wanted to show you is MFC map it

688
00:30:16,620 --> 00:30:23,729
so that one tool something very very

689
00:30:20,730 --> 00:30:27,300
useful that you can use to open your

690
00:30:23,730 --> 00:30:30,360
mail database once I used it for example

691
00:30:27,300 --> 00:30:32,010
to dump it and and get some generic

692
00:30:30,360 --> 00:30:34,439
properties that I had never seen before

693
00:30:32,010 --> 00:30:35,960
in some image so I was able to replay

694
00:30:34,440 --> 00:30:39,150
them and get some interesting

695
00:30:35,960 --> 00:30:41,490
interesting paths with them so yeah if

696
00:30:39,150 --> 00:30:43,380
you if you want to do some research in

697
00:30:41,490 --> 00:30:46,200
there definitely look at that because

698
00:30:43,380 --> 00:30:48,840
you might see things that that people

699
00:30:46,200 --> 00:30:52,539
just don't see otherwise now I want you

700
00:30:48,840 --> 00:30:55,418
to to show you an attack on

701
00:30:52,539 --> 00:30:59,499
so think about Oh so let's come back to

702
00:30:55,419 --> 00:31:01,330
the Saudi object and and of course your

703
00:30:59,499 --> 00:31:03,429
browser won't be able to run dirt is our

704
00:31:01,330 --> 00:31:06,070
objective or if you use ie if you use

705
00:31:03,429 --> 00:31:08,200
Chrome if you H whatever you you will

706
00:31:06,070 --> 00:31:10,509
you want to use you won't be able to is

707
00:31:08,200 --> 00:31:12,879
Desiree object so still there's some

708
00:31:10,509 --> 00:31:15,190
code that process is this object and

709
00:31:12,879 --> 00:31:18,070
convert this as a picture so let's say

710
00:31:15,190 --> 00:31:22,539
that you want to send energy of document

711
00:31:18,070 --> 00:31:24,549
I in like in v-mail itself so you won't

712
00:31:22,539 --> 00:31:25,989
be able to edit that object obviously

713
00:31:24,549 --> 00:31:29,168
but you will still be able to see a

714
00:31:25,989 --> 00:31:31,509
picture to wear some code covering doing

715
00:31:29,169 --> 00:31:34,330
the transformation so this is done in

716
00:31:31,509 --> 00:31:37,259
lowly converter dot exe on vehicle on

717
00:31:34,330 --> 00:31:40,570
server and what you want to to check is

718
00:31:37,259 --> 00:31:43,619
the code in OD 32 that does that so it

719
00:31:40,570 --> 00:31:48,070
basically parses three different

720
00:31:43,619 --> 00:31:53,499
keyboard format so samhita files WM f

721
00:31:48,070 --> 00:31:57,970
and EMF and anti bitmap file format so

722
00:31:53,499 --> 00:32:02,019
EMF is quite bad because it allows you

723
00:31:57,970 --> 00:32:04,509
to load all sort of pictures then so if

724
00:32:02,019 --> 00:32:07,239
you've got a bug affecting for example

725
00:32:04,509 --> 00:32:10,330
JPEG or PNG you would be able to trigger

726
00:32:07,239 --> 00:32:12,340
it from EMF it's is just a container so

727
00:32:10,330 --> 00:32:15,609
whatever box that you can find in there

728
00:32:12,340 --> 00:32:18,158
in Nvidia or GDRs we'd be able to to

729
00:32:15,609 --> 00:32:21,309
trigger it from this fight so the attack

730
00:32:18,159 --> 00:32:23,679
that I had was fixed I think in June or

731
00:32:21,309 --> 00:32:27,009
July this year so I've got a demo here

732
00:32:23,679 --> 00:32:29,679
for you my last demo so it's about

733
00:32:27,009 --> 00:32:32,739
sending an email that just crashes the

734
00:32:29,679 --> 00:32:34,599
server so I thought initially I want you

735
00:32:32,739 --> 00:32:37,179
to get a remote code execution on the

736
00:32:34,599 --> 00:32:39,220
server with a picture and engine I ended

737
00:32:37,179 --> 00:32:41,619
up with the DOS on the server that's not

738
00:32:39,220 --> 00:32:43,809
too bad I mean you son anyway and you

739
00:32:41,619 --> 00:32:46,539
able to crush the excellent server so

740
00:32:43,809 --> 00:32:48,489
here surberg was not very fancy it was

741
00:32:46,539 --> 00:32:50,499
just a stack exhaustion but still quite

742
00:32:48,489 --> 00:32:55,119
good just from the picture as you can

743
00:32:50,499 --> 00:32:57,940
see the Box didn't survive jekima was

744
00:32:55,119 --> 00:32:59,889
that research was Taylor so I failed I

745
00:32:57,940 --> 00:33:01,629
want you to get a remote cut the an

746
00:32:59,889 --> 00:33:03,530
anniversary diamond cut addiction and

747
00:33:01,629 --> 00:33:05,899
exchange

748
00:33:03,530 --> 00:33:09,889
fail it spend some time on it I couldn't

749
00:33:05,900 --> 00:33:13,100
get like a remote viable vector but

750
00:33:09,890 --> 00:33:16,370
still managed to uncover a couple of

751
00:33:13,100 --> 00:33:18,889
bugs perhaps it was still possible to

752
00:33:16,370 --> 00:33:23,540
addiction on Desa and I mean those on

753
00:33:18,890 --> 00:33:25,280
affecting X RPC I'm not sure but I'd

754
00:33:23,540 --> 00:33:27,620
love if one of you guys could prove me

755
00:33:25,280 --> 00:33:32,180
wrong on this so you've got the CDs in

756
00:33:27,620 --> 00:33:34,340
in references and so I'd really like if

757
00:33:32,180 --> 00:33:35,840
you guys could do some research on this

758
00:33:34,340 --> 00:33:38,330
and prove me wrong yeah probably that

759
00:33:35,840 --> 00:33:39,980
it's still possible to get some some

760
00:33:38,330 --> 00:33:43,250
attacks some anonymous attack on

761
00:33:39,980 --> 00:33:45,680
exchange so here's a bunch of reference

762
00:33:43,250 --> 00:33:51,820
about fleece if you want to to dig a bit

763
00:33:45,680 --> 00:33:51,820
this topic and thank you

764
00:33:57,370 --> 00:34:02,409
I realize it's quite light but computer

765
00:33:59,770 --> 00:34:05,860
tech question since you have any mention

766
00:34:02,410 --> 00:34:07,750
these guys are very hungry yeah so do we

767
00:34:05,860 --> 00:34:13,630
have an do you have any questions for

768
00:34:07,750 --> 00:34:16,570
our Nicola anyone are you too angry and

769
00:34:13,630 --> 00:34:28,270
you wanna rush to for lunch

770
00:34:16,570 --> 00:34:30,940
is there any oops no how does it

771
00:34:28,270 --> 00:34:33,550
translate or does it affect the mobile

772
00:34:30,940 --> 00:34:35,050
application in Android or iOS outlook

773
00:34:33,550 --> 00:34:38,200
client or is it a completely different

774
00:34:35,050 --> 00:34:42,909
code base yeah yeah so happy

775
00:34:38,199 --> 00:34:46,569
do they have support for tnf look at the

776
00:34:42,909 --> 00:34:49,510
Android one and it's written in Java so

777
00:34:46,570 --> 00:34:52,390
that is just nothing to do with the

778
00:34:49,510 --> 00:34:54,100
codebase on Windows could be still some

779
00:34:52,389 --> 00:34:58,330
interesting research so I know that

780
00:34:54,100 --> 00:35:00,580
Natalie on well not your team but the

781
00:34:58,330 --> 00:35:03,580
other guys in California she found a bug

782
00:35:00,580 --> 00:35:05,710
she found a way to have him drop an

783
00:35:03,580 --> 00:35:07,509
attachment using using the puffed

784
00:35:05,710 --> 00:35:09,550
reverse surfer ability she was unable to

785
00:35:07,510 --> 00:35:12,250
get a remote code execution but she was

786
00:35:09,550 --> 00:35:15,070
basically able to brick to brick via app

787
00:35:12,250 --> 00:35:15,640
was quite a good attack think much two

788
00:35:15,070 --> 00:35:19,480
years

789
00:35:15,640 --> 00:35:25,180
yeah three years ago something not seen

790
00:35:19,480 --> 00:35:28,360
interesting interesting look any of the

791
00:35:25,180 --> 00:35:33,089
question now so we're going to be

792
00:35:28,360 --> 00:35:33,090
thanking Nicola and we will resume

