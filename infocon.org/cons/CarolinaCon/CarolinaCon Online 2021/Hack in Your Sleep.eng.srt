1
00:00:11,200 --> 00:00:13,120
all right welcome to my talk

2
00:00:13,120 --> 00:00:15,759
hack in your sleep or how to hack in

3
00:00:15,759 --> 00:00:16,480
your sleep

4
00:00:16,480 --> 00:00:19,680
i'm david hunts i go by private ducky in

5
00:00:19,680 --> 00:00:21,359
most of my online profiles you can find

6
00:00:21,359 --> 00:00:22,400
me on twitter

7
00:00:22,400 --> 00:00:23,600
if you want to look me up there and get

8
00:00:23,600 --> 00:00:26,439
in contact i also blog a lot at

9
00:00:26,439 --> 00:00:27,840
feed.prelude.org

10
00:00:27,840 --> 00:00:29,359
so you can also find me there along with

11
00:00:29,359 --> 00:00:31,439
a lot of things that are just generally

12
00:00:31,439 --> 00:00:32,238
on my mind

13
00:00:32,238 --> 00:00:34,800
so today what we're going to be talking

14
00:00:34,800 --> 00:00:36,160
about

15
00:00:36,160 --> 00:00:39,600
is the concept of automated red team

16
00:00:39,600 --> 00:00:40,399
operations

17
00:00:40,399 --> 00:00:42,879
automated penetration testing the

18
00:00:42,879 --> 00:00:43,520
concept

19
00:00:43,520 --> 00:00:46,000
of how do you take offense of security

20
00:00:46,000 --> 00:00:46,879
which has

21
00:00:46,879 --> 00:00:48,960
traditionally been a manual only

22
00:00:48,960 --> 00:00:50,000
exercise

23
00:00:50,000 --> 00:00:52,640
and how do you start to incorporate

24
00:00:52,640 --> 00:00:54,320
automation

25
00:00:54,320 --> 00:00:56,320
hence hacking your sleep and how do you

26
00:00:56,320 --> 00:00:58,300
incorporate that automation to

27
00:00:58,300 --> 00:00:59,840
[Music]

28
00:00:59,840 --> 00:01:03,440
leverage your time better so instead of

29
00:01:03,440 --> 00:01:06,560
manually testing port scans

30
00:01:06,560 --> 00:01:08,880
we typically pull out python and nmap

31
00:01:08,880 --> 00:01:10,400
and we create our own

32
00:01:10,400 --> 00:01:12,400
port scanning utilities to automate that

33
00:01:12,400 --> 00:01:14,240
process so how do we take that a step

34
00:01:14,240 --> 00:01:15,040
further

35
00:01:15,040 --> 00:01:17,200
and start doing offensive security in a

36
00:01:17,200 --> 00:01:19,200
fully automated way

37
00:01:19,200 --> 00:01:22,320
so we can spend our manual effort if we

38
00:01:22,320 --> 00:01:24,000
have a red team or we have access to a

39
00:01:24,000 --> 00:01:24,640
red team

40
00:01:24,640 --> 00:01:26,720
we can spend that manual effort doing

41
00:01:26,720 --> 00:01:27,759
more complicated

42
00:01:27,759 --> 00:01:31,759
interesting creative red team operations

43
00:01:31,759 --> 00:01:33,840
instead of burning our time on the more

44
00:01:33,840 --> 00:01:35,759
mundane automatable

45
00:01:35,759 --> 00:01:38,320
aspects

46
00:01:39,040 --> 00:01:42,000
so who am i i'm the cto here at prelude

47
00:01:42,000 --> 00:01:42,799
research

48
00:01:42,799 --> 00:01:45,920
i focus heavily on automated red team

49
00:01:45,920 --> 00:01:47,119
technology so that's

50
00:01:47,119 --> 00:01:48,720
making red team technology more

51
00:01:48,720 --> 00:01:50,399
accessible to more people

52
00:01:50,399 --> 00:01:52,960
i came out of mitre where i spent the

53
00:01:52,960 --> 00:01:54,399
last couple of years

54
00:01:54,399 --> 00:01:57,200
where i was building the miter caldera

55
00:01:57,200 --> 00:01:58,880
framework so i designed the

56
00:01:58,880 --> 00:02:01,360
second version of that version 2.0 and

57
00:02:01,360 --> 00:02:02,000
up

58
00:02:02,000 --> 00:02:04,880
and in building that framework i got a

59
00:02:04,880 --> 00:02:07,040
kind of a first hand look or first

60
00:02:07,040 --> 00:02:09,919
glance at how the breach and simulation

61
00:02:09,919 --> 00:02:11,680
industry is set up how

62
00:02:11,680 --> 00:02:14,400
the different tools that deal with

63
00:02:14,400 --> 00:02:15,200
automation

64
00:02:15,200 --> 00:02:17,200
are succeeding where they're failing

65
00:02:17,200 --> 00:02:18,800
kind of where the the concepts are kind

66
00:02:18,800 --> 00:02:19,599
of headed

67
00:02:19,599 --> 00:02:22,000
and that's where a lot of the work i'm

68
00:02:22,000 --> 00:02:23,120
doing now at prelude

69
00:02:23,120 --> 00:02:25,040
is essentially birthed out of over the

70
00:02:25,040 --> 00:02:27,599
last 12 or 15 years i've

71
00:02:27,599 --> 00:02:29,599
spent time at a number of different

72
00:02:29,599 --> 00:02:30,800
organizations

73
00:02:30,800 --> 00:02:33,680
such as rockwell collins as an operator

74
00:02:33,680 --> 00:02:35,680
such as john deere where i spent time in

75
00:02:35,680 --> 00:02:38,480
software engineering and big data

76
00:02:38,480 --> 00:02:40,640
a few years at fireeye where i worked

77
00:02:40,640 --> 00:02:42,400
within the red team and threat

78
00:02:42,400 --> 00:02:43,840
intelligence spaces

79
00:02:43,840 --> 00:02:45,920
and then disconnected years at different

80
00:02:45,920 --> 00:02:47,920
startups in the security side

81
00:02:47,920 --> 00:02:50,720
and consulting for agencies and other

82
00:02:50,720 --> 00:02:53,440
types of work

83
00:02:53,840 --> 00:02:55,519
if you were to say what do i do in a

84
00:02:55,519 --> 00:02:57,760
nutshell i build autonomous systems

85
00:02:57,760 --> 00:02:58,640
which

86
00:02:58,640 --> 00:03:01,040
can hack into computers i spend a lot of

87
00:03:01,040 --> 00:03:01,920
time

88
00:03:01,920 --> 00:03:04,080
designing systems and technologies and

89
00:03:04,080 --> 00:03:06,319
processes that are

90
00:03:06,319 --> 00:03:08,959
built to make the whole red team process

91
00:03:08,959 --> 00:03:11,680
the whole offensive security process

92
00:03:11,680 --> 00:03:14,720
more accessible

93
00:03:14,720 --> 00:03:17,040
in today's world that means i am working

94
00:03:17,040 --> 00:03:18,239
on operator a lot so

95
00:03:18,239 --> 00:03:20,879
operator is a free largely open source

96
00:03:20,879 --> 00:03:22,800
autonomous c2 command and control

97
00:03:22,800 --> 00:03:23,760
framework

98
00:03:23,760 --> 00:03:26,560
that really tries to fight semantics

99
00:03:26,560 --> 00:03:28,879
complexity and technology

100
00:03:28,879 --> 00:03:32,159
and replace it with a simplistic

101
00:03:32,159 --> 00:03:33,040
approach

102
00:03:33,040 --> 00:03:36,159
to offensive security and trying to

103
00:03:36,159 --> 00:03:38,480
bring the concept of red teaming

104
00:03:38,480 --> 00:03:40,560
down to regular boots on the ground

105
00:03:40,560 --> 00:03:43,120
users who don't need to burn time

106
00:03:43,120 --> 00:03:45,040
trying to figure out semantically what

107
00:03:45,040 --> 00:03:46,640
they should be doing but instead should

108
00:03:46,640 --> 00:03:47,040
be

109
00:03:47,040 --> 00:03:51,679
focused on securing their organizations

110
00:03:51,760 --> 00:03:54,239
all right what should you learn today

111
00:03:54,239 --> 00:03:55,439
now we're going to go through a few

112
00:03:55,439 --> 00:03:57,360
different concepts the first is

113
00:03:57,360 --> 00:03:59,040
how do you think like a human you may

114
00:03:59,040 --> 00:04:00,720
think you already know because you are a

115
00:04:00,720 --> 00:04:01,360
human

116
00:04:01,360 --> 00:04:03,519
if you're listening to this conversation

117
00:04:03,519 --> 00:04:04,560
we're going to go through how you

118
00:04:04,560 --> 00:04:05,040
actually

119
00:04:05,040 --> 00:04:06,239
think we're going to break that process

120
00:04:06,239 --> 00:04:09,280
down we're then going to convert

121
00:04:09,280 --> 00:04:11,439
that human think into programmatic

122
00:04:11,439 --> 00:04:14,159
reasoning how would a computer

123
00:04:14,159 --> 00:04:16,959
do the same process of decision making

124
00:04:16,959 --> 00:04:18,399
and thinking that you do

125
00:04:18,399 --> 00:04:20,320
then we're going to overlay that by

126
00:04:20,320 --> 00:04:22,800
thinking like a malicious actor

127
00:04:22,800 --> 00:04:25,040
then we're going to build a programmatic

128
00:04:25,040 --> 00:04:27,120
repeatable adversary

129
00:04:27,120 --> 00:04:28,960
that uses this knowledge so we can

130
00:04:28,960 --> 00:04:31,120
actually put that

131
00:04:31,120 --> 00:04:33,280
good knowledge to practice and then

132
00:04:33,280 --> 00:04:34,880
we're going to apply the knowledge from

133
00:04:34,880 --> 00:04:36,960
this hour to immediately improve this

134
00:04:36,960 --> 00:04:39,360
your security posture by actually

135
00:04:39,360 --> 00:04:40,479
hacking in your sleep so we're going to

136
00:04:40,479 --> 00:04:42,320
design an adversary profile

137
00:04:42,320 --> 00:04:44,320
at the very end that will kind of

138
00:04:44,320 --> 00:04:46,639
complete the circle

139
00:04:46,639 --> 00:04:48,960
all right going into this conversation

140
00:04:48,960 --> 00:04:50,400
what are my assumptions

141
00:04:50,400 --> 00:04:51,759
you probably know a thing or two about

142
00:04:51,759 --> 00:04:54,160
red teaming it's a security conference

143
00:04:54,160 --> 00:04:55,199
after all

144
00:04:55,199 --> 00:04:57,680
you likely work in security offense

145
00:04:57,680 --> 00:04:58,400
defense

146
00:04:58,400 --> 00:05:00,720
purple team i.t infosec a lot of

147
00:05:00,720 --> 00:05:02,000
different concepts here

148
00:05:02,000 --> 00:05:03,919
you're interested in performing red team

149
00:05:03,919 --> 00:05:05,919
assessments to secure something

150
00:05:05,919 --> 00:05:08,320
or to test if some defense is or is not

151
00:05:08,320 --> 00:05:09,039
working

152
00:05:09,039 --> 00:05:10,880
so my assumptions are these are probably

153
00:05:10,880 --> 00:05:12,320
in the ballpark of who you are

154
00:05:12,320 --> 00:05:14,639
as a professional and we're gonna go

155
00:05:14,639 --> 00:05:17,919
with that as we continue

156
00:05:17,919 --> 00:05:19,919
okay let's focus on how do you make

157
00:05:19,919 --> 00:05:21,840
decisions as a human

158
00:05:21,840 --> 00:05:23,440
so what you see i'm going to give you a

159
00:05:23,440 --> 00:05:25,840
second to kind of consume this this

160
00:05:25,840 --> 00:05:27,039
information on screen

161
00:05:27,039 --> 00:05:31,120
what you see on screen are a collection

162
00:05:31,120 --> 00:05:34,240
of decisions that are possible

163
00:05:34,240 --> 00:05:36,880
so let's say these are your full extent

164
00:05:36,880 --> 00:05:38,000
of abilities

165
00:05:38,000 --> 00:05:40,080
you can do these i don't know 10 or so

166
00:05:40,080 --> 00:05:41,280
things

167
00:05:41,280 --> 00:05:44,720
now left to right is going to represent

168
00:05:44,720 --> 00:05:48,240
our chain of decisions we start off on

169
00:05:48,240 --> 00:05:48,800
the left

170
00:05:48,800 --> 00:05:51,120
we want to end up on the right let's say

171
00:05:51,120 --> 00:05:52,000
for

172
00:05:52,000 --> 00:05:54,639
example we want to drive to work today

173
00:05:54,639 --> 00:05:56,400
that's our goal is to drive to work

174
00:05:56,400 --> 00:05:59,039
so we're starting in the wake up state

175
00:05:59,039 --> 00:06:00,960
so imagine each one of these

176
00:06:00,960 --> 00:06:03,520
columns if you will is a state so we're

177
00:06:03,520 --> 00:06:05,120
going to start off waking up

178
00:06:05,120 --> 00:06:07,440
now we have three decisions in front of

179
00:06:07,440 --> 00:06:09,360
us we can eat breakfast

180
00:06:09,360 --> 00:06:12,960
we can walk the dog we can hit snooze

181
00:06:12,960 --> 00:06:16,479
now you'll notice that walk the dog is

182
00:06:16,479 --> 00:06:17,199
highlighted

183
00:06:17,199 --> 00:06:20,479
red the reason that is highlighted red

184
00:06:20,479 --> 00:06:23,280
is because we cannot immediately wake up

185
00:06:23,280 --> 00:06:24,639
and walk the dog

186
00:06:24,639 --> 00:06:28,000
that is because it has a dependency

187
00:06:28,000 --> 00:06:30,479
that dependency is that i need to put

188
00:06:30,479 --> 00:06:31,520
clothes on

189
00:06:31,520 --> 00:06:33,919
in the third column the third state i

190
00:06:33,919 --> 00:06:35,840
must put clothes on before i could walk

191
00:06:35,840 --> 00:06:36,560
the dog

192
00:06:36,560 --> 00:06:39,120
so i cannot do that as a decision that

193
00:06:39,120 --> 00:06:40,560
limits me now down to

194
00:06:40,560 --> 00:06:43,600
two decisions i can make we'll start off

195
00:06:43,600 --> 00:06:45,280
and we'll hit snooze

196
00:06:45,280 --> 00:06:47,840
okay so hitting snooze that is a valid

197
00:06:47,840 --> 00:06:48,800
decision

198
00:06:48,800 --> 00:06:51,280
however i'm at the end of the road i

199
00:06:51,280 --> 00:06:52,000
cannot

200
00:06:52,000 --> 00:06:54,800
move from here to achieve my goal given

201
00:06:54,800 --> 00:06:57,199
my set of abilities to drive to work

202
00:06:57,199 --> 00:07:01,440
so that's a no-go

203
00:07:01,680 --> 00:07:04,160
going back to the beginning i will eat

204
00:07:04,160 --> 00:07:04,720
breakfast

205
00:07:04,720 --> 00:07:07,199
okay maybe i can eat breakfast and

206
00:07:07,199 --> 00:07:07,919
there's something

207
00:07:07,919 --> 00:07:10,960
actionable i can do after that so maybe

208
00:07:10,960 --> 00:07:13,520
after eating breakfast i put clothes on

209
00:07:13,520 --> 00:07:15,360
okay so now i'm making my way through

210
00:07:15,360 --> 00:07:16,800
the decision chain

211
00:07:16,800 --> 00:07:20,080
in order to proceed

212
00:07:20,880 --> 00:07:24,080
so once i put clothes on i can now

213
00:07:24,080 --> 00:07:28,319
walk the dog that prior dependency has

214
00:07:28,319 --> 00:07:28,960
now been

215
00:07:28,960 --> 00:07:31,680
unlocked after walking the dog i may

216
00:07:31,680 --> 00:07:33,599
decide i want to go for a run this

217
00:07:33,599 --> 00:07:35,360
opened up a handful of new

218
00:07:35,360 --> 00:07:37,360
potential unlocked abilities at this

219
00:07:37,360 --> 00:07:38,400
point but

220
00:07:38,400 --> 00:07:40,400
going for a run does not get me closer

221
00:07:40,400 --> 00:07:41,680
to driving to work

222
00:07:41,680 --> 00:07:45,599
therefore bad decision

223
00:07:45,599 --> 00:07:48,800
so maybe instead after i walk the dog i

224
00:07:48,800 --> 00:07:50,479
can skip over putting clothes on i

225
00:07:50,479 --> 00:07:51,440
already did that

226
00:07:51,440 --> 00:07:53,759
and i can get in the car once i get in

227
00:07:53,759 --> 00:07:55,199
the car i could have chosen getting on a

228
00:07:55,199 --> 00:07:56,960
bike i could have chosen going

229
00:07:56,960 --> 00:07:58,800
uh going for a run although i already

230
00:07:58,800 --> 00:08:00,639
did that one um so once i go

231
00:08:00,639 --> 00:08:02,720
and jump in the car i can drive to work

232
00:08:02,720 --> 00:08:04,240
i could have driven to the circus

233
00:08:04,240 --> 00:08:06,479
but i chose to do the right thing drive

234
00:08:06,479 --> 00:08:07,280
to work

235
00:08:07,280 --> 00:08:10,639
and happy i made it from state 1

236
00:08:10,639 --> 00:08:13,840
to state five and achieve my goal

237
00:08:13,840 --> 00:08:17,039
by carefully deciding according to the

238
00:08:17,039 --> 00:08:19,039
abilities i had and chaining them

239
00:08:19,039 --> 00:08:22,560
together in a way that achieved my goal

240
00:08:24,560 --> 00:08:27,759
okay decision logic thinking in a linear

241
00:08:27,759 --> 00:08:28,479
way

242
00:08:28,479 --> 00:08:31,520
in order to break down

243
00:08:31,520 --> 00:08:35,360
how i thought through the prior process

244
00:08:35,360 --> 00:08:37,760
how i got from state one to state five i

245
00:08:37,760 --> 00:08:38,559
first had to

246
00:08:38,559 --> 00:08:40,640
achieve i first had to identify what is

247
00:08:40,640 --> 00:08:41,679
my goal

248
00:08:41,679 --> 00:08:43,760
once i understood my goal what is the

249
00:08:43,760 --> 00:08:46,160
set of abilities that i contain

250
00:08:46,160 --> 00:08:48,560
your set of abilities may or may not

251
00:08:48,560 --> 00:08:50,080
achieve your goal you may or may not

252
00:08:50,080 --> 00:08:51,680
have that capacity

253
00:08:51,680 --> 00:08:53,760
so once you understand your abilities

254
00:08:53,760 --> 00:08:55,040
what preconditions

255
00:08:55,040 --> 00:08:57,120
exist for each one of your abilities

256
00:08:57,120 --> 00:08:59,279
walking the dog as we saw had one

257
00:08:59,279 --> 00:09:01,279
do you have any overlaps in your ability

258
00:09:01,279 --> 00:09:02,399
set

259
00:09:02,399 --> 00:09:04,800
can multiple things essentially achieve

260
00:09:04,800 --> 00:09:05,839
the same goal

261
00:09:05,839 --> 00:09:07,680
and then your last and final most

262
00:09:07,680 --> 00:09:09,040
complicated thing is

263
00:09:09,040 --> 00:09:11,120
which ability should i choose and that

264
00:09:11,120 --> 00:09:13,040
kind of goes in tandem with in what

265
00:09:13,040 --> 00:09:14,000
order

266
00:09:14,000 --> 00:09:16,880
so when we looked at the prior step we

267
00:09:16,880 --> 00:09:19,040
could identify what is my goal

268
00:09:19,040 --> 00:09:21,680
i wanted to go to work what are my

269
00:09:21,680 --> 00:09:23,200
abilities

270
00:09:23,200 --> 00:09:24,720
here's a handful of them these are the

271
00:09:24,720 --> 00:09:27,519
things that i know how to do

272
00:09:27,519 --> 00:09:29,279
what preconditions did i have while

273
00:09:29,279 --> 00:09:30,800
walking the dog required me to put on

274
00:09:30,800 --> 00:09:32,640
clothes

275
00:09:32,640 --> 00:09:34,320
and then do i have any overlaps yeah

276
00:09:34,320 --> 00:09:35,920
getting in the car getting on a bike

277
00:09:35,920 --> 00:09:37,279
would have achieved the same thing mode

278
00:09:37,279 --> 00:09:38,320
of transportation

279
00:09:38,320 --> 00:09:40,240
i chose getting in the car that's an

280
00:09:40,240 --> 00:09:42,399
optimization probably on time

281
00:09:42,399 --> 00:09:44,480
and but i could have achieved that

282
00:09:44,480 --> 00:09:50,720
through getting on a bike

283
00:09:50,720 --> 00:09:53,600
next understanding finite state machines

284
00:09:53,600 --> 00:09:53,920
yes

285
00:09:53,920 --> 00:09:55,920
this is math finite state machines is a

286
00:09:55,920 --> 00:09:57,600
math concept

287
00:09:57,600 --> 00:09:59,279
now what you're going to see on the on

288
00:09:59,279 --> 00:10:01,120
the screen here looks complicated but

289
00:10:01,120 --> 00:10:01,920
it's actually

290
00:10:01,920 --> 00:10:04,160
quite quite simple so if we've ever been

291
00:10:04,160 --> 00:10:05,440
to a subway

292
00:10:05,440 --> 00:10:07,040
in a big city you probably see in the

293
00:10:07,040 --> 00:10:08,959
top right here these turn styles

294
00:10:08,959 --> 00:10:11,120
now what you see in the main picture on

295
00:10:11,120 --> 00:10:13,040
the screen are the different states that

296
00:10:13,040 --> 00:10:15,120
turn style could be in

297
00:10:15,120 --> 00:10:18,240
based on actions of people going through

298
00:10:18,240 --> 00:10:19,839
or not going through them

299
00:10:19,839 --> 00:10:21,920
so we're going to start off in the

300
00:10:21,920 --> 00:10:23,360
locked state

301
00:10:23,360 --> 00:10:24,959
so you see that big circle there on the

302
00:10:24,959 --> 00:10:26,880
left hand side that is the lock state

303
00:10:26,880 --> 00:10:30,000
now when you put a coin in you can

304
00:10:30,000 --> 00:10:32,320
follow the arrow and it jumps over to

305
00:10:32,320 --> 00:10:32,640
the

306
00:10:32,640 --> 00:10:36,079
unlocked state so

307
00:10:36,079 --> 00:10:39,200
when you enter the unlock state if a

308
00:10:39,200 --> 00:10:42,240
coin is being put into the turnstile you

309
00:10:42,240 --> 00:10:42,800
remain

310
00:10:42,800 --> 00:10:45,760
in the unlocked state otherwise you push

311
00:10:45,760 --> 00:10:47,519
through the unlock state

312
00:10:47,519 --> 00:10:49,920
back to the walk state where you can

313
00:10:49,920 --> 00:10:51,839
push it again after putting a coin in

314
00:10:51,839 --> 00:10:52,480
and enter

315
00:10:52,480 --> 00:10:54,240
the unlock state so this is a very

316
00:10:54,240 --> 00:10:55,600
simplistic way of

317
00:10:55,600 --> 00:10:59,440
how a coin an unlock state in a lock

318
00:10:59,440 --> 00:11:00,079
state

319
00:11:00,079 --> 00:11:03,600
work together in order to transition

320
00:11:03,600 --> 00:11:06,160
the user the person going through into

321
00:11:06,160 --> 00:11:08,959
different states

322
00:11:11,839 --> 00:11:14,320
now how would that sort of process the

323
00:11:14,320 --> 00:11:15,600
concept of states

324
00:11:15,600 --> 00:11:18,560
overlay on top of making human decisions

325
00:11:18,560 --> 00:11:19,200
we'll call this

326
00:11:19,200 --> 00:11:23,440
version two you've got five states

327
00:11:23,440 --> 00:11:26,800
as split up by these different columns

328
00:11:26,800 --> 00:11:29,440
states one two three four and five now

329
00:11:29,440 --> 00:11:31,760
as we transition from one state to the

330
00:11:31,760 --> 00:11:32,880
next

331
00:11:32,880 --> 00:11:36,160
we get there by making a decision that

332
00:11:36,160 --> 00:11:38,079
change that puts us squarely

333
00:11:38,079 --> 00:11:40,240
in one state at a time that's where the

334
00:11:40,240 --> 00:11:42,160
finite state machine comes in

335
00:11:42,160 --> 00:11:44,320
once we're in that state there are

336
00:11:44,320 --> 00:11:46,399
decisions we can make to move

337
00:11:46,399 --> 00:11:48,800
from one state to the other but those

338
00:11:48,800 --> 00:11:49,440
have

339
00:11:49,440 --> 00:11:51,360
repercussions such as unlocking a

340
00:11:51,360 --> 00:11:52,480
dependency

341
00:11:52,480 --> 00:11:55,200
or they may restrict what my decision is

342
00:11:55,200 --> 00:11:57,120
in the next state that i get to

343
00:11:57,120 --> 00:11:59,440
so each state comes with different

344
00:11:59,440 --> 00:12:02,800
opportunities to myself

345
00:12:03,440 --> 00:12:06,000
you might say wait isn't this a talk

346
00:12:06,000 --> 00:12:06,480
about

347
00:12:06,480 --> 00:12:09,120
security why are we talking about human

348
00:12:09,120 --> 00:12:10,240
decisions in

349
00:12:10,240 --> 00:12:13,440
turn styles and finite state machines

350
00:12:13,440 --> 00:12:16,639
yes so on the security side

351
00:12:16,639 --> 00:12:19,360
this should hopefully be building the

352
00:12:19,360 --> 00:12:20,320
blocks

353
00:12:20,320 --> 00:12:23,440
the foundation for thinking about how an

354
00:12:23,440 --> 00:12:26,079
adversary makes decisions so what i have

355
00:12:26,079 --> 00:12:27,519
on screen is something that probably

356
00:12:27,519 --> 00:12:29,839
everybody is aware of and familiar with

357
00:12:29,839 --> 00:12:33,440
the attack matrix spanning across the

358
00:12:33,440 --> 00:12:34,480
top

359
00:12:34,480 --> 00:12:36,639
top columns here you can see the

360
00:12:36,639 --> 00:12:38,399
different tactics

361
00:12:38,399 --> 00:12:40,240
that are available within the attack

362
00:12:40,240 --> 00:12:42,639
matrix so you've got things like initial

363
00:12:42,639 --> 00:12:43,440
access

364
00:12:43,440 --> 00:12:46,560
discovery lateral movement execution

365
00:12:46,560 --> 00:12:48,720
these are the tactical decisions an

366
00:12:48,720 --> 00:12:50,320
adversary could make

367
00:12:50,320 --> 00:12:53,680
we can call these if we want states

368
00:12:53,680 --> 00:12:56,079
down on the rows we can see the

369
00:12:56,079 --> 00:12:57,279
techniques

370
00:12:57,279 --> 00:13:00,240
now let's look at credential access as a

371
00:13:00,240 --> 00:13:00,880
tactic

372
00:13:00,880 --> 00:13:03,200
you have brute force that is a technique

373
00:13:03,200 --> 00:13:04,800
that is a subset

374
00:13:04,800 --> 00:13:07,200
of how to perform credential access you

375
00:13:07,200 --> 00:13:09,519
could brute force credentials

376
00:13:09,519 --> 00:13:12,399
you could input capture for credentials

377
00:13:12,399 --> 00:13:13,120
you could

378
00:13:13,120 --> 00:13:15,600
sniff the network for credentials these

379
00:13:15,600 --> 00:13:16,880
are your

380
00:13:16,880 --> 00:13:19,360
techniques that you could do now what

381
00:13:19,360 --> 00:13:20,399
isn't shown

382
00:13:20,399 --> 00:13:23,120
on this matrix are the procedures the p

383
00:13:23,120 --> 00:13:24,800
and ttps

384
00:13:24,800 --> 00:13:26,720
tactics techniques and procedures

385
00:13:26,720 --> 00:13:28,320
procedures are the

386
00:13:28,320 --> 00:13:30,519
variations of the techniques the

387
00:13:30,519 --> 00:13:31,920
implementations

388
00:13:31,920 --> 00:13:34,880
of the techniques that you could

389
00:13:34,880 --> 00:13:35,519
actually

390
00:13:35,519 --> 00:13:38,560
execute on target so an example of that

391
00:13:38,560 --> 00:13:40,079
how would you brute force

392
00:13:40,079 --> 00:13:43,279
credentials well you might grab a

393
00:13:43,279 --> 00:13:44,399
password list

394
00:13:44,399 --> 00:13:47,279
off the internet and execute a billion

395
00:13:47,279 --> 00:13:48,800
passwords against the system

396
00:13:48,800 --> 00:13:51,440
there might be thousands of different

397
00:13:51,440 --> 00:13:52,240
commands

398
00:13:52,240 --> 00:13:54,880
from powershell to bash to python to

399
00:13:54,880 --> 00:13:56,480
assembly that you could write

400
00:13:56,480 --> 00:13:59,680
in order to attempt that technique

401
00:13:59,680 --> 00:14:02,399
and that is the attack matrix from that

402
00:14:02,399 --> 00:14:02,720
10

403
00:14:02,720 --> 00:14:05,839
000 foot view

404
00:14:07,600 --> 00:14:10,079
breaking it down further especially as

405
00:14:10,079 --> 00:14:10,720
we kind of

406
00:14:10,720 --> 00:14:13,920
overlay this concept on top of

407
00:14:13,920 --> 00:14:15,600
the human decision making we talked

408
00:14:15,600 --> 00:14:17,839
about prior we

409
00:14:17,839 --> 00:14:20,000
are now going to introduce the cyber

410
00:14:20,000 --> 00:14:21,120
kill chain

411
00:14:21,120 --> 00:14:23,839
now off to the right hand side you can

412
00:14:23,839 --> 00:14:25,040
see

413
00:14:25,040 --> 00:14:27,600
familiar tactics from the prior screen

414
00:14:27,600 --> 00:14:28,720
and familiar

415
00:14:28,720 --> 00:14:32,320
technique ids and so a tactic would be

416
00:14:32,320 --> 00:14:32,959
something like

417
00:14:32,959 --> 00:14:36,880
persistence under persistence

418
00:14:36,880 --> 00:14:39,519
you'll have techniques a technique in

419
00:14:39,519 --> 00:14:42,079
this case t1037 that's a technique

420
00:14:42,079 --> 00:14:46,000
under persistence now the procedure

421
00:14:46,000 --> 00:14:49,199
is the actual implementation and so this

422
00:14:49,199 --> 00:14:50,560
is a specific

423
00:14:50,560 --> 00:14:52,880
persistence attack that you could do

424
00:14:52,880 --> 00:14:56,079
under t1037 which is under persistence

425
00:14:56,079 --> 00:14:59,360
now you've got a number of tactics each

426
00:14:59,360 --> 00:15:01,199
tactic has a number of techniques

427
00:15:01,199 --> 00:15:03,360
each technique has a larger number of

428
00:15:03,360 --> 00:15:06,000
procedures

429
00:15:08,880 --> 00:15:12,079
now the cyber kill chain was originally

430
00:15:12,079 --> 00:15:13,920
developed by lockheed martin

431
00:15:13,920 --> 00:15:16,399
and this is a model that identifies what

432
00:15:16,399 --> 00:15:17,680
adversaries

433
00:15:17,680 --> 00:15:20,560
must do or usually do to complete in

434
00:15:20,560 --> 00:15:22,399
order to achieve an objective

435
00:15:22,399 --> 00:15:25,680
and so the lockheed model the cyber kill

436
00:15:25,680 --> 00:15:26,240
chain

437
00:15:26,240 --> 00:15:28,800
has seven different steps that a threat

438
00:15:28,800 --> 00:15:29,839
analyst can use

439
00:15:29,839 --> 00:15:32,880
in order to identify an adversary

440
00:15:32,880 --> 00:15:36,000
identify compromise to attribute an

441
00:15:36,000 --> 00:15:38,720
attack to a specific adversary so it is

442
00:15:38,720 --> 00:15:41,440
the behavior that an adversary takes the

443
00:15:41,440 --> 00:15:42,639
decisions they make

444
00:15:42,639 --> 00:15:45,839
their immutable behavior inside of an

445
00:15:45,839 --> 00:15:46,800
environment

446
00:15:46,800 --> 00:15:48,800
is what the cyber kill chain attempts to

447
00:15:48,800 --> 00:15:50,000
map now

448
00:15:50,000 --> 00:15:52,720
this is very similar to the miter attack

449
00:15:52,720 --> 00:15:53,440
framework

450
00:15:53,440 --> 00:15:54,720
in a concept that they are

451
00:15:54,720 --> 00:15:56,720
classification systems so

452
00:15:56,720 --> 00:15:58,800
the miter attack matrix which we showed

453
00:15:58,800 --> 00:16:00,160
on the prior screen

454
00:16:00,160 --> 00:16:03,360
is curated knowledge base and model

455
00:16:03,360 --> 00:16:06,399
for cyber adversary behavior now very

456
00:16:06,399 --> 00:16:06,880
similar

457
00:16:06,880 --> 00:16:08,720
there's a lot more tactics there's a lot

458
00:16:08,720 --> 00:16:10,560
more techniques it is a

459
00:16:10,560 --> 00:16:14,079
more fine-grained or closer view

460
00:16:14,079 --> 00:16:15,839
than what we see in the cyber kill chain

461
00:16:15,839 --> 00:16:18,079
but they both achieve a similar goal

462
00:16:18,079 --> 00:16:20,880
which is to act as a classification

463
00:16:20,880 --> 00:16:22,800
classification system

464
00:16:22,800 --> 00:16:25,279
for threat intelligence analysts to talk

465
00:16:25,279 --> 00:16:28,160
about attacks

466
00:16:29,440 --> 00:16:31,440
so let's harbor on this for a minute so

467
00:16:31,440 --> 00:16:33,519
a cyber classification system

468
00:16:33,519 --> 00:16:35,600
offers you a couple different benefits

469
00:16:35,600 --> 00:16:36,800
from the

470
00:16:36,800 --> 00:16:39,279
intelligence the cti cyber threat

471
00:16:39,279 --> 00:16:40,880
intelligence

472
00:16:40,880 --> 00:16:43,680
point of view so the first one is common

473
00:16:43,680 --> 00:16:45,519
language to describe an attack

474
00:16:45,519 --> 00:16:48,880
so in order to describe how an adversary

475
00:16:48,880 --> 00:16:50,160
is attacking a system

476
00:16:50,160 --> 00:16:52,480
you need a way to map their behaviors

477
00:16:52,480 --> 00:16:54,160
and tools and processes

478
00:16:54,160 --> 00:16:57,600
to something and that common language is

479
00:16:57,600 --> 00:17:00,880
great to use attack cyber the cyber kill

480
00:17:00,880 --> 00:17:01,839
chain and so forth

481
00:17:01,839 --> 00:17:04,240
it also maps attacks back to something

482
00:17:04,240 --> 00:17:06,240
so because an attack can be so varied

483
00:17:06,240 --> 00:17:07,199
and creative

484
00:17:07,199 --> 00:17:09,359
you need the ability as a cyber threat

485
00:17:09,359 --> 00:17:10,959
intelligence analyst to

486
00:17:10,959 --> 00:17:13,439
map that behavior back to something in

487
00:17:13,439 --> 00:17:16,839
order to loot back into the common

488
00:17:16,839 --> 00:17:18,240
language

489
00:17:18,240 --> 00:17:20,880
let's take a look at how an attack may

490
00:17:20,880 --> 00:17:22,640
unfold

491
00:17:22,640 --> 00:17:24,799
specifically as we overlay it with

492
00:17:24,799 --> 00:17:27,039
things like classification systems

493
00:17:27,039 --> 00:17:29,120
so we'll say we have a cyber threat

494
00:17:29,120 --> 00:17:30,400
intelligence analyst

495
00:17:30,400 --> 00:17:34,240
out here in los angeles at the same time

496
00:17:34,240 --> 00:17:36,480
we have an adversary over here somewhere

497
00:17:36,480 --> 00:17:38,960
in asia

498
00:17:38,960 --> 00:17:42,240
now the adversary may attempt to attack

499
00:17:42,240 --> 00:17:43,360
new york

500
00:17:43,360 --> 00:17:45,600
and maybe they do it from an ip address

501
00:17:45,600 --> 00:17:47,039
one two three four

502
00:17:47,039 --> 00:17:49,360
we'll say that is an asian ip address

503
00:17:49,360 --> 00:17:50,400
that

504
00:17:50,400 --> 00:17:53,520
is known to come from

505
00:17:53,520 --> 00:17:57,120
a ip vendor out in

506
00:17:57,120 --> 00:17:59,840
out in asia somewhere and that is a

507
00:17:59,840 --> 00:18:00,880
known ip

508
00:18:00,880 --> 00:18:03,200
now when they attack new york with that

509
00:18:03,200 --> 00:18:05,520
specific ip address

510
00:18:05,520 --> 00:18:07,760
the threat intelligence analysts might

511
00:18:07,760 --> 00:18:08,960
notice that

512
00:18:08,960 --> 00:18:11,840
and say oh that that ip address is bad

513
00:18:11,840 --> 00:18:13,360
that is known as an indicator of

514
00:18:13,360 --> 00:18:14,240
compromise

515
00:18:14,240 --> 00:18:16,480
an objective truth about a computer

516
00:18:16,480 --> 00:18:17,280
system

517
00:18:17,280 --> 00:18:19,360
that an adversary may be using or

518
00:18:19,360 --> 00:18:21,200
leveraging to complete an attack

519
00:18:21,200 --> 00:18:23,679
and so the analyst will say ah ip

520
00:18:23,679 --> 00:18:25,200
address one two three four

521
00:18:25,200 --> 00:18:27,520
bad we will start blocking that from now

522
00:18:27,520 --> 00:18:28,320
on

523
00:18:28,320 --> 00:18:30,080
so now the adversary needs to go back to

524
00:18:30,080 --> 00:18:32,400
the beginning and say well maybe

525
00:18:32,400 --> 00:18:35,919
i will proxy my connection through south

526
00:18:35,919 --> 00:18:37,120
america

527
00:18:37,120 --> 00:18:40,000
and attack still attack new york but now

528
00:18:40,000 --> 00:18:42,080
my ip address is going to appear

529
00:18:42,080 --> 00:18:44,559
it's five six seven eight well that's

530
00:18:44,559 --> 00:18:46,080
another approach right so now it's a cat

531
00:18:46,080 --> 00:18:47,600
and most game so the analyst can look at

532
00:18:47,600 --> 00:18:49,200
the i p address five six seven eight and

533
00:18:49,200 --> 00:18:50,080
say oh

534
00:18:50,080 --> 00:18:52,000
this is a known bad eye p address coming

535
00:18:52,000 --> 00:18:53,120
out of south america

536
00:18:53,120 --> 00:18:55,760
through one of their vendors we will

537
00:18:55,760 --> 00:18:57,600
block that ip address

538
00:18:57,600 --> 00:19:00,720
and continue on now cat and mouse game

539
00:19:00,720 --> 00:19:02,720
the adversary can cycle through many

540
00:19:02,720 --> 00:19:05,200
many different

541
00:19:05,200 --> 00:19:07,360
types of ip addresses and proxy their

542
00:19:07,360 --> 00:19:08,640
connection and

543
00:19:08,640 --> 00:19:10,320
continue to stay one step ahead of the

544
00:19:10,320 --> 00:19:12,080
adversary

545
00:19:12,080 --> 00:19:14,799
so now we'll flip over and say okay well

546
00:19:14,799 --> 00:19:16,960
maybe the analysts can't use indicators

547
00:19:16,960 --> 00:19:18,720
of compromise such as

548
00:19:18,720 --> 00:19:20,559
ip addresses maybe they need to look at

549
00:19:20,559 --> 00:19:21,840
the behavior

550
00:19:21,840 --> 00:19:23,679
the cyber kill chain the miter attack

551
00:19:23,679 --> 00:19:24,960
framer they need to look at

552
00:19:24,960 --> 00:19:27,520
the immutable behavior of the adversary

553
00:19:27,520 --> 00:19:28,080
so

554
00:19:28,080 --> 00:19:30,400
maybe the adversary attacks new york

555
00:19:30,400 --> 00:19:32,000
again

556
00:19:32,000 --> 00:19:33,440
and the threat intelligence analyst

557
00:19:33,440 --> 00:19:36,240
starts looking at the techniques

558
00:19:36,240 --> 00:19:38,000
that the adversary is using to conduct

559
00:19:38,000 --> 00:19:39,840
the attack t1005

560
00:19:39,840 --> 00:19:42,880
t1010 t1113

561
00:19:42,880 --> 00:19:45,200
right so now the the analyst is saying

562
00:19:45,200 --> 00:19:46,880
okay well when i see these three

563
00:19:46,880 --> 00:19:47,919
techniques

564
00:19:47,919 --> 00:19:51,360
completed in tandem i know that this

565
00:19:51,360 --> 00:19:52,480
attack is

566
00:19:52,480 --> 00:19:54,960
both malicious and attributed to this

567
00:19:54,960 --> 00:19:56,720
threat actor out in asia

568
00:19:56,720 --> 00:19:59,440
now at the same time an adversary may

569
00:19:59,440 --> 00:20:00,880
pop up in paris

570
00:20:00,880 --> 00:20:03,840
read a threat intelligence report about

571
00:20:03,840 --> 00:20:05,600
this asian threat actor

572
00:20:05,600 --> 00:20:09,120
and say oh man everybody thinks that

573
00:20:09,120 --> 00:20:10,640
these three techniques are going to be

574
00:20:10,640 --> 00:20:13,200
attributed to them so i'm also going to

575
00:20:13,200 --> 00:20:14,159
attack new york

576
00:20:14,159 --> 00:20:16,320
and i'm also going to replicate and copy

577
00:20:16,320 --> 00:20:17,360
these three

578
00:20:17,360 --> 00:20:20,000
behaviors in order for the analysts in

579
00:20:20,000 --> 00:20:22,240
los angeles to think

580
00:20:22,240 --> 00:20:24,320
that the threat actor in asia is

581
00:20:24,320 --> 00:20:25,919
attacking new york but is really in fact

582
00:20:25,919 --> 00:20:26,559
me

583
00:20:26,559 --> 00:20:29,360
in paris and so this is a very big

584
00:20:29,360 --> 00:20:30,880
problem in the threat intelligence space

585
00:20:30,880 --> 00:20:31,280
and why

586
00:20:31,280 --> 00:20:33,919
attribution is such a tricky game and

587
00:20:33,919 --> 00:20:35,280
such an important game

588
00:20:35,280 --> 00:20:37,679
and it takes a long time to conduct but

589
00:20:37,679 --> 00:20:39,360
it is also

590
00:20:39,360 --> 00:20:42,559
a insight into how

591
00:20:42,559 --> 00:20:44,880
analysts need to leverage both

592
00:20:44,880 --> 00:20:46,240
indicators of compromise

593
00:20:46,240 --> 00:20:48,880
as well as behaviors in order to

594
00:20:48,880 --> 00:20:49,840
determine

595
00:20:49,840 --> 00:20:52,799
who did what how they did it and have a

596
00:20:52,799 --> 00:20:56,639
level of confidence in that attribution

597
00:20:58,159 --> 00:21:00,480
on the topic of indicators of compromise

598
00:21:00,480 --> 00:21:03,600
we talked about ip address in the prior

599
00:21:03,600 --> 00:21:08,080
slide now there's a variety of other

600
00:21:08,080 --> 00:21:10,080
indicators of compromise such as file

601
00:21:10,080 --> 00:21:11,440
pass network

602
00:21:11,440 --> 00:21:13,919
ports fully qualified domain names

603
00:21:13,919 --> 00:21:17,039
usernames passwords email addresses

604
00:21:17,039 --> 00:21:18,799
probably the most popular file hashes

605
00:21:18,799 --> 00:21:21,440
things like md5 shot ones 256's

606
00:21:21,440 --> 00:21:23,760
of files themselves that are known to be

607
00:21:23,760 --> 00:21:24,960
malicious

608
00:21:24,960 --> 00:21:26,559
pulling out a couple in specific we'll

609
00:21:26,559 --> 00:21:28,960
look at ip address so

610
00:21:28,960 --> 00:21:31,039
these different indicators of compromise

611
00:21:31,039 --> 00:21:33,039
can have some issues so for an ip

612
00:21:33,039 --> 00:21:34,559
address who owned it at the time of

613
00:21:34,559 --> 00:21:35,600
compromise

614
00:21:35,600 --> 00:21:39,520
ip addresses are sold in batches and

615
00:21:39,520 --> 00:21:41,520
who owns a specific ip address based on

616
00:21:41,520 --> 00:21:43,280
the dynamic nature of ips

617
00:21:43,280 --> 00:21:45,600
may change this month to next month so

618
00:21:45,600 --> 00:21:46,880
time is a factor

619
00:21:46,880 --> 00:21:50,080
in how do you determine who owned an ip

620
00:21:50,080 --> 00:21:52,960
username and passwords if you were

621
00:21:52,960 --> 00:21:55,039
looking at arbitrary text

622
00:21:55,039 --> 00:21:56,640
how would you be able to determine as an

623
00:21:56,640 --> 00:21:58,640
analyst what a password is

624
00:21:58,640 --> 00:22:02,320
versus just a plain old string

625
00:22:02,320 --> 00:22:03,919
because a password is essentially a

626
00:22:03,919 --> 00:22:06,000
string there may be some

627
00:22:06,000 --> 00:22:08,320
specific rules in an environment such as

628
00:22:08,320 --> 00:22:10,080
it needs to be 12 characters it needs to

629
00:22:10,080 --> 00:22:10,640
have

630
00:22:10,640 --> 00:22:12,400
a special character at the beginning and

631
00:22:12,400 --> 00:22:14,559
a capital letter and a lowercase letter

632
00:22:14,559 --> 00:22:16,559
but they're still strings their words

633
00:22:16,559 --> 00:22:18,000
their alphanumeric

634
00:22:18,000 --> 00:22:21,120
characters now identifying as an analyst

635
00:22:21,120 --> 00:22:22,799
what is a password

636
00:22:22,799 --> 00:22:25,120
versus just a word can be difficult but

637
00:22:25,120 --> 00:22:26,880
then understanding that

638
00:22:26,880 --> 00:22:29,039
it takes more than just a password in

639
00:22:29,039 --> 00:22:30,240
order to leverage

640
00:22:30,240 --> 00:22:32,480
say an attack on a say an initial access

641
00:22:32,480 --> 00:22:33,520
or a lateral movement

642
00:22:33,520 --> 00:22:35,840
you likely need a username as well and

643
00:22:35,840 --> 00:22:38,080
so connecting a username to a password

644
00:22:38,080 --> 00:22:39,600
in order to identify that these go

645
00:22:39,600 --> 00:22:40,240
together

646
00:22:40,240 --> 00:22:42,080
and these are used together can be a

647
00:22:42,080 --> 00:22:43,520
challenge within the indicator of

648
00:22:43,520 --> 00:22:45,440
compromise space

649
00:22:45,440 --> 00:22:48,640
okay let's circle back to

650
00:22:48,640 --> 00:22:50,320
how an adversary is going to make a

651
00:22:50,320 --> 00:22:52,320
decision so we've learned a lot so far

652
00:22:52,320 --> 00:22:54,559
hopefully about classification systems

653
00:22:54,559 --> 00:22:57,600
their pros their cons and we're going to

654
00:22:57,600 --> 00:22:59,840
leverage right now the miter attack

655
00:22:59,840 --> 00:23:04,400
system in order to talk about behaviors

656
00:23:04,400 --> 00:23:06,320
so let's say an adversary drops an

657
00:23:06,320 --> 00:23:08,240
implant and gains a foothold

658
00:23:08,240 --> 00:23:10,799
on a target network let's say that they

659
00:23:10,799 --> 00:23:11,440
have

660
00:23:11,440 --> 00:23:15,200
six different tactics or decisions that

661
00:23:15,200 --> 00:23:16,240
they could make

662
00:23:16,240 --> 00:23:18,559
so they could run discovery collection

663
00:23:18,559 --> 00:23:19,600
impact

664
00:23:19,600 --> 00:23:22,000
exfiltration of data lateral movement or

665
00:23:22,000 --> 00:23:23,600
privilege escalation

666
00:23:23,600 --> 00:23:26,400
so as an adversary maybe the first thing

667
00:23:26,400 --> 00:23:27,280
i want to do is

668
00:23:27,280 --> 00:23:29,760
is hop in and collect data there's

669
00:23:29,760 --> 00:23:31,039
something i want to collect off the

670
00:23:31,039 --> 00:23:31,600
system

671
00:23:31,600 --> 00:23:33,760
so i make a decision and i say i'm going

672
00:23:33,760 --> 00:23:35,280
to hop into collection

673
00:23:35,280 --> 00:23:37,600
and then from collection there are two

674
00:23:37,600 --> 00:23:38,320
different

675
00:23:38,320 --> 00:23:41,600
options 1560 and 1123

676
00:23:41,600 --> 00:23:44,799
on page that i could choose and

677
00:23:44,799 --> 00:23:46,240
that will be kind of the subset the

678
00:23:46,240 --> 00:23:48,480
technique level and i say i want to do a

679
00:23:48,480 --> 00:23:50,159
weapon 23

680
00:23:50,159 --> 00:23:53,919
so out of 11 23 my

681
00:23:53,919 --> 00:23:56,080
next action my procedure is to capture

682
00:23:56,080 --> 00:23:57,360
the audio

683
00:23:57,360 --> 00:24:01,039
and so i look into my database

684
00:24:01,039 --> 00:24:04,640
of ttps the commands that come out of my

685
00:24:04,640 --> 00:24:05,120
head

686
00:24:05,120 --> 00:24:06,559
or that i have written down on my

687
00:24:06,559 --> 00:24:08,799
scratch pad and i say well what can i do

688
00:24:08,799 --> 00:24:10,240
to capture audio

689
00:24:10,240 --> 00:24:13,360
i need to install an audio recording

690
00:24:13,360 --> 00:24:15,919
package on a mac os so socks is a

691
00:24:15,919 --> 00:24:18,159
popular one out of brew

692
00:24:18,159 --> 00:24:20,720
and i am going to install it real quick

693
00:24:20,720 --> 00:24:22,640
and then i'm going to record

694
00:24:22,640 --> 00:24:25,520
30 seconds of audio and dump it to a

695
00:24:25,520 --> 00:24:26,880
recording dot

696
00:24:26,880 --> 00:24:30,080
wave file and that would be my process

697
00:24:30,080 --> 00:24:32,720
for just a quick and dirty how do i make

698
00:24:32,720 --> 00:24:33,600
a decision

699
00:24:33,600 --> 00:24:36,400
how do i navigate a classification

700
00:24:36,400 --> 00:24:36,960
system

701
00:24:36,960 --> 00:24:39,919
in order to pull out the actual command

702
00:24:39,919 --> 00:24:41,360
out of my head or out of paper

703
00:24:41,360 --> 00:24:46,799
that i want to execute

704
00:24:46,799 --> 00:24:48,640
all right now how do we take that

705
00:24:48,640 --> 00:24:50,400
knowledge and hack computers

706
00:24:50,400 --> 00:24:51,679
now we're going to say we have an

707
00:24:51,679 --> 00:24:53,440
adversary sitting behind a command and

708
00:24:53,440 --> 00:24:54,720
control center

709
00:24:54,720 --> 00:24:57,520
that adversary has access to a ttp

710
00:24:57,520 --> 00:24:58,559
database

711
00:24:58,559 --> 00:25:00,960
this is their full collection of things

712
00:25:00,960 --> 00:25:02,880
they know how to do all the attacks that

713
00:25:02,880 --> 00:25:05,279
they understand

714
00:25:05,279 --> 00:25:08,559
they also have footholds on

715
00:25:08,559 --> 00:25:10,799
five different target systems in a

716
00:25:10,799 --> 00:25:12,480
network so they've been able to drop

717
00:25:12,480 --> 00:25:13,200
rats

718
00:25:13,200 --> 00:25:14,559
that are connecting back to their

719
00:25:14,559 --> 00:25:16,480
command and control center so this is

720
00:25:16,480 --> 00:25:18,400
the adversary starting off

721
00:25:18,400 --> 00:25:20,799
space

722
00:25:21,840 --> 00:25:23,279
going back to how to make human

723
00:25:23,279 --> 00:25:25,120
decisions we need to identify our goal

724
00:25:25,120 --> 00:25:25,840
first

725
00:25:25,840 --> 00:25:27,760
so we'll say that our goal is to steal

726
00:25:27,760 --> 00:25:28,960
important files

727
00:25:28,960 --> 00:25:31,200
so we want to identify the stolen file

728
00:25:31,200 --> 00:25:32,320
the important files

729
00:25:32,320 --> 00:25:34,000
and then figure out a way to exfiltrate

730
00:25:34,000 --> 00:25:36,799
them to steal them that's our goal

731
00:25:36,799 --> 00:25:39,039
the first thing we're going to try is we

732
00:25:39,039 --> 00:25:41,360
need to find the important files

733
00:25:41,360 --> 00:25:44,400
so this could vary from system to system

734
00:25:44,400 --> 00:25:46,000
especially based on the target

735
00:25:46,000 --> 00:25:48,080
but i need to identify i need to have a

736
00:25:48,080 --> 00:25:50,240
way to identify

737
00:25:50,240 --> 00:25:51,760
what is important and what is not

738
00:25:51,760 --> 00:25:53,440
important

739
00:25:53,440 --> 00:25:54,880
then i need to create a staging

740
00:25:54,880 --> 00:25:56,799
directory i need to make a directory on

741
00:25:56,799 --> 00:25:58,240
my target systems

742
00:25:58,240 --> 00:26:01,440
in order to stage

743
00:26:01,440 --> 00:26:03,760
my important files so i want to copy the

744
00:26:03,760 --> 00:26:05,840
important files from around the systems

745
00:26:05,840 --> 00:26:07,679
and drop them into a single place

746
00:26:07,679 --> 00:26:09,520
ideally on a network share if i can do

747
00:26:09,520 --> 00:26:10,559
so

748
00:26:10,559 --> 00:26:13,440
and just have a single spot then i'm

749
00:26:13,440 --> 00:26:14,640
going to compress

750
00:26:14,640 --> 00:26:16,960
the staging directory i want to do that

751
00:26:16,960 --> 00:26:18,640
because i want to make it as small as

752
00:26:18,640 --> 00:26:19,440
possible

753
00:26:19,440 --> 00:26:22,480
and instead of exfiltrating dozens or

754
00:26:22,480 --> 00:26:24,960
hundreds of files over the system

755
00:26:24,960 --> 00:26:27,600
i want to compress down to a small size

756
00:26:27,600 --> 00:26:29,360
and exfiltrate a single

757
00:26:29,360 --> 00:26:32,880
compressed directory and that leads me

758
00:26:32,880 --> 00:26:34,720
to my last thing that i need to do which

759
00:26:34,720 --> 00:26:35,600
is to actually

760
00:26:35,600 --> 00:26:37,679
exfiltrate the compressed directory this

761
00:26:37,679 --> 00:26:39,360
is how do i get it off of the

762
00:26:39,360 --> 00:26:41,919
target network and into my own computer

763
00:26:41,919 --> 00:26:43,440
and back into my command and control

764
00:26:43,440 --> 00:26:45,600
center

765
00:26:45,600 --> 00:26:48,080
the challenge of these steps when we're

766
00:26:48,080 --> 00:26:49,919
looking at this from a fully automated

767
00:26:49,919 --> 00:26:50,720
way

768
00:26:50,720 --> 00:26:53,440
is how do we take the arbitrary text

769
00:26:53,440 --> 00:26:54,240
output

770
00:26:54,240 --> 00:26:56,159
of each of these commands each of these

771
00:26:56,159 --> 00:26:59,120
steps and use it to create the input

772
00:26:59,120 --> 00:27:02,240
for the next decision so how do i once i

773
00:27:02,240 --> 00:27:03,520
find important files

774
00:27:03,520 --> 00:27:05,520
how do i dynamically take that

775
00:27:05,520 --> 00:27:06,640
information

776
00:27:06,640 --> 00:27:09,360
and weed it into staging files well

777
00:27:09,360 --> 00:27:10,960
that's what we're going to look at now

778
00:27:10,960 --> 00:27:12,080
we're going to try to solve that

779
00:27:12,080 --> 00:27:14,080
challenge so

780
00:27:14,080 --> 00:27:16,720
the very first command i need to find

781
00:27:16,720 --> 00:27:18,720
important files on the system

782
00:27:18,720 --> 00:27:20,640
we are going to say this is a command

783
00:27:20,640 --> 00:27:21,840
that could do so

784
00:27:21,840 --> 00:27:23,360
if you're familiar with bash this might

785
00:27:23,360 --> 00:27:26,080
be easier to read we want to find

786
00:27:26,080 --> 00:27:29,600
all of the files inside these three user

787
00:27:29,600 --> 00:27:31,200
directories downloads desktop and

788
00:27:31,200 --> 00:27:32,240
documents

789
00:27:32,240 --> 00:27:34,720
type as file and we want to find those

790
00:27:34,720 --> 00:27:36,240
that have been modified

791
00:27:36,240 --> 00:27:39,760
in the last one day why one day

792
00:27:39,760 --> 00:27:41,600
in my personal experience as a red

793
00:27:41,600 --> 00:27:43,679
teamer i've noticed that important files

794
00:27:43,679 --> 00:27:45,279
tend to be modified

795
00:27:45,279 --> 00:27:47,919
on a semi-regular basis so i will look

796
00:27:47,919 --> 00:27:49,440
for things that have been

797
00:27:49,440 --> 00:27:52,000
modified recently in order to determine

798
00:27:52,000 --> 00:27:53,120
importance

799
00:27:53,120 --> 00:27:55,600
now let's say i run this command on my

800
00:27:55,600 --> 00:27:56,320
again my

801
00:27:56,320 --> 00:27:58,080
instruct my rats to run this command on

802
00:27:58,080 --> 00:27:59,600
my target systems

803
00:27:59,600 --> 00:28:03,200
and this leads me to finding

804
00:28:03,200 --> 00:28:06,559
three different files they're in

805
00:28:06,559 --> 00:28:08,480
three different directories they have

806
00:28:08,480 --> 00:28:10,080
three different names

807
00:28:10,080 --> 00:28:11,840
and they have they're of three different

808
00:28:11,840 --> 00:28:13,600
file types now this is

809
00:28:13,600 --> 00:28:16,159
information that i did not know before

810
00:28:16,159 --> 00:28:16,799
so i

811
00:28:16,799 --> 00:28:19,279
couldn't predict or hard code the

812
00:28:19,279 --> 00:28:21,440
results of these so i have to work with

813
00:28:21,440 --> 00:28:24,320
what i get dynamically

814
00:28:24,320 --> 00:28:26,720
so understanding that i got these three

815
00:28:26,720 --> 00:28:27,360
i may

816
00:28:27,360 --> 00:28:30,720
have a second command that will copy

817
00:28:30,720 --> 00:28:33,760
files that i find into

818
00:28:33,760 --> 00:28:36,240
my new directory so we'll say that i

819
00:28:36,240 --> 00:28:38,080
have a stage directory already

820
00:28:38,080 --> 00:28:41,600
on the target system and notice this

821
00:28:41,600 --> 00:28:43,120
command when i do the copy

822
00:28:43,120 --> 00:28:46,159
it is a hashtag curlybraces with a

823
00:28:46,159 --> 00:28:50,320
variable inside file.t105

824
00:28:50,320 --> 00:28:52,880
now break this into the two parts to

825
00:28:52,880 --> 00:28:54,080
eliminate on the

826
00:28:54,080 --> 00:28:56,480
period here the file is the indicator of

827
00:28:56,480 --> 00:28:57,360
compromise

828
00:28:57,360 --> 00:28:59,840
in this case it's a font it is a actual

829
00:28:59,840 --> 00:29:01,600
file path that i'm looking for

830
00:29:01,600 --> 00:29:03,200
and then the right side of this period

831
00:29:03,200 --> 00:29:05,760
is the technique that it comes from

832
00:29:05,760 --> 00:29:09,120
now the first command i ran to find

833
00:29:09,120 --> 00:29:11,039
important files

834
00:29:11,039 --> 00:29:12,960
is classified under the miter attack

835
00:29:12,960 --> 00:29:14,320
framework as t

836
00:29:14,320 --> 00:29:17,360
technique t1005 and so what i'm saying

837
00:29:17,360 --> 00:29:18,960
in the second command

838
00:29:18,960 --> 00:29:21,279
is i want to fill this variable in

839
00:29:21,279 --> 00:29:22,559
automatically

840
00:29:22,559 --> 00:29:25,919
with any file that was found by running

841
00:29:25,919 --> 00:29:27,120
t1005

842
00:29:27,120 --> 00:29:29,600
so this allows me to not care or not

843
00:29:29,600 --> 00:29:30,320
know

844
00:29:30,320 --> 00:29:33,039
or predict what the first command is

845
00:29:33,039 --> 00:29:34,080
going to output

846
00:29:34,080 --> 00:29:36,000
because the second command will be able

847
00:29:36,000 --> 00:29:37,360
to consume that output

848
00:29:37,360 --> 00:29:40,480
and fill in the variable

849
00:29:40,480 --> 00:29:43,440
now copying this file this this command

850
00:29:43,440 --> 00:29:43,760
is

851
00:29:43,760 --> 00:29:46,000
actually broken down based on my prior

852
00:29:46,000 --> 00:29:49,279
result into three distinct commands

853
00:29:49,279 --> 00:29:51,520
and it's going to copy each file that

854
00:29:51,520 --> 00:29:52,480
was found

855
00:29:52,480 --> 00:29:56,159
into my directory this is how

856
00:29:56,159 --> 00:30:00,240
we can dynamically create

857
00:30:00,240 --> 00:30:03,840
the adversary behavior and create chains

858
00:30:03,840 --> 00:30:06,080
of commands together by feeding the

859
00:30:06,080 --> 00:30:07,120
output of one

860
00:30:07,120 --> 00:30:10,399
to the input of others

861
00:30:11,679 --> 00:30:13,440
now let's look at this in practice we're

862
00:30:13,440 --> 00:30:15,200
going to jump out of the slide deck

863
00:30:15,200 --> 00:30:17,760
hop into an actual environment and see

864
00:30:17,760 --> 00:30:19,279
if we can replicate

865
00:30:19,279 --> 00:30:22,320
a privilege escalation attack and an

866
00:30:22,320 --> 00:30:25,760
adversary mindset all right

867
00:30:25,760 --> 00:30:27,760
now here in the real world we have an

868
00:30:27,760 --> 00:30:29,679
environment with a command and control

869
00:30:29,679 --> 00:30:31,200
center up and running

870
00:30:31,200 --> 00:30:32,880
within the command and control center we

871
00:30:32,880 --> 00:30:34,960
have a single agent coal duct

872
00:30:34,960 --> 00:30:38,320
connected to from the target system

873
00:30:38,320 --> 00:30:40,240
into my command and control now i can

874
00:30:40,240 --> 00:30:42,559
click into it i can see that cold luck

875
00:30:42,559 --> 00:30:43,279
has not done

876
00:30:43,279 --> 00:30:45,679
anything interesting but i can see that

877
00:30:45,679 --> 00:30:46,720
it's got

878
00:30:46,720 --> 00:30:48,480
no procedures executed it's not

879
00:30:48,480 --> 00:30:50,000
currently doing anything

880
00:30:50,000 --> 00:30:52,000
so it's just kind of their beaconing

881
00:30:52,000 --> 00:30:53,679
back

882
00:30:53,679 --> 00:30:56,399
now i already have an adversary built

883
00:30:56,399 --> 00:30:56,880
called

884
00:30:56,880 --> 00:30:59,440
i want root now what i can do i'm going

885
00:30:59,440 --> 00:31:03,360
to go ahead and edit the ttps

886
00:31:03,760 --> 00:31:06,559
and i can see that i have three ttps

887
00:31:06,559 --> 00:31:07,679
associated to

888
00:31:07,679 --> 00:31:10,720
i am root now the first one

889
00:31:10,720 --> 00:31:13,519
spawning a root agent so this one will

890
00:31:13,519 --> 00:31:15,200
start a new agent

891
00:31:15,200 --> 00:31:17,840
on the target system as the root pseudo

892
00:31:17,840 --> 00:31:18,799
user

893
00:31:18,799 --> 00:31:20,480
so i can see here it's a privilege

894
00:31:20,480 --> 00:31:22,880
escalation t 1078

895
00:31:22,880 --> 00:31:26,320
classified procedure scrolling down i

896
00:31:26,320 --> 00:31:28,320
can see that it would work on a

897
00:31:28,320 --> 00:31:31,519
mac os it is a bash script

898
00:31:31,519 --> 00:31:33,039
and i can see right here that it will

899
00:31:33,039 --> 00:31:34,960
attempt to echo a

900
00:31:34,960 --> 00:31:40,399
found password from a t1010.001 the sub

901
00:31:40,399 --> 00:31:43,919
technique from one of those the output

902
00:31:43,919 --> 00:31:45,519
of that type of technique

903
00:31:45,519 --> 00:31:47,279
is the password we'll use and we're

904
00:31:47,279 --> 00:31:49,279
going to pipe that password

905
00:31:49,279 --> 00:31:52,080
into a pseudo command which will attempt

906
00:31:52,080 --> 00:31:52,720
to

907
00:31:52,720 --> 00:31:56,080
start a new agent that is running as

908
00:31:56,080 --> 00:31:57,279
that root user

909
00:31:57,279 --> 00:31:59,519
and that should come in as the name of

910
00:31:59,519 --> 00:32:00,640
the computer dash

911
00:32:00,640 --> 00:32:04,240
root the second

912
00:32:04,240 --> 00:32:06,720
procedure this adversary contains is is

913
00:32:06,720 --> 00:32:08,960
the password right

914
00:32:08,960 --> 00:32:12,399
this is a credential access

915
00:32:12,399 --> 00:32:17,360
tactic t10 or sorry t111001

916
00:32:17,360 --> 00:32:19,760
and this is password guessing so we can

917
00:32:19,760 --> 00:32:22,240
see right here it is going to

918
00:32:22,240 --> 00:32:26,000
attempt to use a password

919
00:32:26,000 --> 00:32:29,519
found from a t1552

920
00:32:29,519 --> 00:32:31,919
procedure and is going to attempt to use

921
00:32:31,919 --> 00:32:33,279
that found password

922
00:32:33,279 --> 00:32:35,440
to see does it work does it not work if

923
00:32:35,440 --> 00:32:36,320
it works

924
00:32:36,320 --> 00:32:38,720
it's going to echo out the password to

925
00:32:38,720 --> 00:32:39,679
console

926
00:32:39,679 --> 00:32:41,600
now this password because it's coming

927
00:32:41,600 --> 00:32:43,039
from an 1110

928
00:32:43,039 --> 00:32:46,880
procedure we can see here could fit in

929
00:32:46,880 --> 00:32:50,080
to this location

930
00:32:50,640 --> 00:32:52,640
going down further we can see another

931
00:32:52,640 --> 00:32:54,320
credential access tactic

932
00:32:54,320 --> 00:32:57,760
this one is a t 1552 this one

933
00:32:57,760 --> 00:33:00,640
is credentials and files so this is this

934
00:33:00,640 --> 00:33:01,279
is a

935
00:33:01,279 --> 00:33:04,000
procedure that will attempt to find

936
00:33:04,000 --> 00:33:05,760
every file

937
00:33:05,760 --> 00:33:09,039
that has the phrase pass in the file

938
00:33:09,039 --> 00:33:10,320
name

939
00:33:10,320 --> 00:33:13,440
for each one it will check against the

940
00:33:13,440 --> 00:33:14,399
popular

941
00:33:14,399 --> 00:33:16,960
roku text file it says billions of

942
00:33:16,960 --> 00:33:18,960
passwords that have come from

943
00:33:18,960 --> 00:33:21,360
different types of password dumps if you

944
00:33:21,360 --> 00:33:23,360
use cali linux this has

945
00:33:23,360 --> 00:33:25,360
dropped on there by default as a

946
00:33:25,360 --> 00:33:26,399
password list

947
00:33:26,399 --> 00:33:27,760
and so what we're doing is we're saying

948
00:33:27,760 --> 00:33:30,320
can we match up any password

949
00:33:30,320 --> 00:33:34,240
from the files that have

950
00:33:34,240 --> 00:33:36,960
p a s s in the file name can we match up

951
00:33:36,960 --> 00:33:38,559
all the names and those

952
00:33:38,559 --> 00:33:40,640
all the words in those files to the

953
00:33:40,640 --> 00:33:42,480
popular rocky password don't

954
00:33:42,480 --> 00:33:45,440
and can we filter that down into a

955
00:33:45,440 --> 00:33:47,600
actual

956
00:33:47,600 --> 00:33:49,519
potential password list things that we

957
00:33:49,519 --> 00:33:51,760
think might be passwords on the computer

958
00:33:51,760 --> 00:33:52,399
and

959
00:33:52,399 --> 00:33:58,159
that will output password.1552 variables

960
00:33:58,159 --> 00:33:59,360
so if we look at this

961
00:33:59,360 --> 00:34:02,720
backwards now we are going to attempt to

962
00:34:02,720 --> 00:34:04,720
run the password finder first

963
00:34:04,720 --> 00:34:07,039
which will filter down potential

964
00:34:07,039 --> 00:34:07,760
passwords

965
00:34:07,760 --> 00:34:11,918
on the computer this will link anything

966
00:34:11,918 --> 00:34:14,960
potentially found into this next

967
00:34:14,960 --> 00:34:17,679
procedure where this variable will get

968
00:34:17,679 --> 00:34:18,399
filled in

969
00:34:18,399 --> 00:34:22,639
from the 1552 prior now executing this

970
00:34:22,639 --> 00:34:24,560
which is checking if a given password

971
00:34:24,560 --> 00:34:25,679
from the filtered list

972
00:34:25,679 --> 00:34:29,839
is right or wrong if they are right

973
00:34:29,839 --> 00:34:32,159
it will chain into this final command

974
00:34:32,159 --> 00:34:33,520
which will attempt to spawn

975
00:34:33,520 --> 00:34:36,320
a new agent that is running a pseudo on

976
00:34:36,320 --> 00:34:38,800
the machine

977
00:34:38,960 --> 00:34:41,199
okay now let's take this first spin so

978
00:34:41,199 --> 00:34:43,918
we'll close this

979
00:34:45,280 --> 00:34:49,839
and we will click deploy

980
00:34:53,440 --> 00:34:55,839
now we can see the agent running quickly

981
00:34:55,839 --> 00:34:57,359
here it is currently running the

982
00:34:57,359 --> 00:34:59,200
commands as executed

983
00:34:59,200 --> 00:35:02,160
and we can see now we got quickly a root

984
00:35:02,160 --> 00:35:04,480
beacon

985
00:35:04,640 --> 00:35:06,480
clicking into the root beacon we can see

986
00:35:06,480 --> 00:35:08,480
it has done nothing it is currently just

987
00:35:08,480 --> 00:35:10,320
in a beaconing state

988
00:35:10,320 --> 00:35:14,079
clicking into my original

989
00:35:14,720 --> 00:35:17,520
agent i can see that it has now done a

990
00:35:17,520 --> 00:35:19,359
number of things

991
00:35:19,359 --> 00:35:23,280
as i scroll down i can look at the first

992
00:35:23,280 --> 00:35:23,760
thing

993
00:35:23,760 --> 00:35:28,000
it did a rock you password finder

994
00:35:29,599 --> 00:35:32,160
now i can see here it executed the

995
00:35:32,160 --> 00:35:34,000
command as i saw before

996
00:35:34,000 --> 00:35:36,800
and it is looking for passwords from my

997
00:35:36,800 --> 00:35:37,760
local disk

998
00:35:37,760 --> 00:35:40,560
it found four potential passwords these

999
00:35:40,560 --> 00:35:42,720
are passwords from my own files

1000
00:35:42,720 --> 00:35:46,160
that happen to match the passwords from

1001
00:35:46,160 --> 00:35:49,520
the rock u text file

1002
00:35:50,400 --> 00:35:53,359
next it used each one of the passwords

1003
00:35:53,359 --> 00:35:55,760
to attempt

1004
00:35:55,760 --> 00:35:57,760
to see if it was correct on the given

1005
00:35:57,760 --> 00:36:00,320
computer

1006
00:36:00,560 --> 00:36:02,400
so i'm scrolling through looking this

1007
00:36:02,400 --> 00:36:05,440
one to try david

1008
00:36:06,880 --> 00:36:08,400
and here we go so we can see this one

1009
00:36:08,400 --> 00:36:10,560
succeeded golden goose

1010
00:36:10,560 --> 00:36:12,880
so it executed this command and it spat

1011
00:36:12,880 --> 00:36:14,880
out a password called golden

1012
00:36:14,880 --> 00:36:17,280
goose

1013
00:36:17,920 --> 00:36:21,680
now as i scroll past the other password

1014
00:36:24,839 --> 00:36:27,839
attempts

1015
00:36:30,640 --> 00:36:33,680
i can look at the

1016
00:36:33,680 --> 00:36:35,200
now i can look at the command that is

1017
00:36:35,200 --> 00:36:37,680
currently executing

1018
00:36:37,680 --> 00:36:39,760
because this is the command that is

1019
00:36:39,760 --> 00:36:41,760
holding my root agent open

1020
00:36:41,760 --> 00:36:44,000
i can see that i echoed out the golden

1021
00:36:44,000 --> 00:36:45,680
goose found password

1022
00:36:45,680 --> 00:36:48,160
and i'm echoing that into a piped

1023
00:36:48,160 --> 00:36:49,119
command

1024
00:36:49,119 --> 00:36:52,640
which is starting a new agent

1025
00:36:52,640 --> 00:36:57,200
that is now running as the root user

1026
00:36:57,200 --> 00:36:59,760
so this command is running and holding

1027
00:36:59,760 --> 00:37:01,920
that open so now i have two beacons that

1028
00:37:01,920 --> 00:37:03,280
i'm capable of using

1029
00:37:03,280 --> 00:37:05,920
i can discard this if i want to close my

1030
00:37:05,920 --> 00:37:06,880
agent off

1031
00:37:06,880 --> 00:37:09,520
but now i was capable of fully chaining

1032
00:37:09,520 --> 00:37:11,200
a privilege escalation

1033
00:37:11,200 --> 00:37:15,200
on a mac from one non-root agent

1034
00:37:15,200 --> 00:37:18,240
into a root agent

1035
00:37:19,359 --> 00:37:23,280
okay now i removed the original agent

1036
00:37:23,280 --> 00:37:28,160
and we're now just looking at the route

1037
00:37:28,160 --> 00:37:30,960
let's go back to the slide deck where we

1038
00:37:30,960 --> 00:37:31,680
did the

1039
00:37:31,680 --> 00:37:34,079
finding of important files the staging

1040
00:37:34,079 --> 00:37:35,520
of important files

1041
00:37:35,520 --> 00:37:37,680
all the way through the exfiltration

1042
00:37:37,680 --> 00:37:38,800
let's go ahead and see if we can

1043
00:37:38,800 --> 00:37:40,400
replicate that in a real world

1044
00:37:40,400 --> 00:37:41,280
environment

1045
00:37:41,280 --> 00:37:43,280
so i'm going to start by clicking to add

1046
00:37:43,280 --> 00:37:46,079
an adversary

1047
00:37:47,200 --> 00:37:50,960
next i'm going to give it a name

1048
00:37:50,960 --> 00:37:55,040
we'll say file

1049
00:37:55,119 --> 00:37:58,960
thief file

1050
00:37:58,960 --> 00:38:02,560
and we will add ttps

1051
00:38:02,560 --> 00:38:05,119
okay so as i'm looking to create a

1052
00:38:05,119 --> 00:38:05,760
chained

1053
00:38:05,760 --> 00:38:08,000
adversary i'm going to first filter down

1054
00:38:08,000 --> 00:38:10,480
to crown jewel related

1055
00:38:10,480 --> 00:38:12,880
ttps this will always filter down what i

1056
00:38:12,880 --> 00:38:14,240
want to do

1057
00:38:14,240 --> 00:38:17,680
so as i scroll down we'll look first for

1058
00:38:17,680 --> 00:38:19,280
finding recent files

1059
00:38:19,280 --> 00:38:23,040
so let me see if i can search for that

1060
00:38:23,040 --> 00:38:26,320
perfect so when i look at this ttp

1061
00:38:26,320 --> 00:38:28,160
i can see the command i used on the

1062
00:38:28,160 --> 00:38:30,160
slide deck for finding files

1063
00:38:30,160 --> 00:38:32,000
within the last day modified within the

1064
00:38:32,000 --> 00:38:33,839
last day now i can see

1065
00:38:33,839 --> 00:38:36,400
a similar one on linux and a similar

1066
00:38:36,400 --> 00:38:38,800
command on windows for powershell

1067
00:38:38,800 --> 00:38:42,400
we will go ahead and add this ttp

1068
00:38:42,400 --> 00:38:46,000
to our adversary

1069
00:38:46,000 --> 00:38:48,960
next we will look for the creation of a

1070
00:38:48,960 --> 00:38:52,160
staging directory

1071
00:38:54,320 --> 00:38:57,680
so scrolling through ttps i can see

1072
00:38:57,680 --> 00:39:00,160
creating of a staging directory with

1073
00:39:00,160 --> 00:39:01,680
commands that will work again

1074
00:39:01,680 --> 00:39:04,320
on all three operating systems so i can

1075
00:39:04,320 --> 00:39:06,720
see here i am making directories

1076
00:39:06,720 --> 00:39:09,760
and i am echoing out back to console

1077
00:39:09,760 --> 00:39:13,119
the name of the directory

1078
00:39:13,119 --> 00:39:15,839
the reason for the echoing out is so i

1079
00:39:15,839 --> 00:39:17,200
can capture

1080
00:39:17,200 --> 00:39:20,720
the variable from 1074 that there is a

1081
00:39:20,720 --> 00:39:21,520
directory an

1082
00:39:21,520 --> 00:39:23,839
indicator of compromise that the next

1083
00:39:23,839 --> 00:39:26,079
stage that the next dependency can be

1084
00:39:26,079 --> 00:39:27,280
unlocked

1085
00:39:27,280 --> 00:39:30,880
which as i scroll up i can see that we

1086
00:39:30,880 --> 00:39:32,000
have

1087
00:39:32,000 --> 00:39:34,640
that ttp so staging collected files i'll

1088
00:39:34,640 --> 00:39:37,119
give this to my adversary as well

1089
00:39:37,119 --> 00:39:39,040
and i can see that one of its

1090
00:39:39,040 --> 00:39:42,880
dependencies is a directory.t7

1091
00:39:42,880 --> 00:39:44,800
this means thinking back to the slide

1092
00:39:44,800 --> 00:39:47,119
deck that my adversary

1093
00:39:47,119 --> 00:39:52,640
requires the output of a t1074 that is a

1094
00:39:52,640 --> 00:39:53,520
directory

1095
00:39:53,520 --> 00:39:55,440
indicator of compromise in order to fill

1096
00:39:55,440 --> 00:39:57,599
this variable in this is why i echo it

1097
00:39:57,599 --> 00:40:01,359
to console in this prior step

1098
00:40:01,599 --> 00:40:04,960
next i need to find a compress

1099
00:40:04,960 --> 00:40:08,880
for my stage directory so i can

1100
00:40:08,880 --> 00:40:10,960
see that right here again all three

1101
00:40:10,960 --> 00:40:12,079
operating systems

1102
00:40:12,079 --> 00:40:14,720
are present and i can see different

1103
00:40:14,720 --> 00:40:15,599
commands for

1104
00:40:15,599 --> 00:40:18,640
compressing the archive and

1105
00:40:18,640 --> 00:40:21,520
similar to the creation of the directory

1106
00:40:21,520 --> 00:40:23,040
i can see after i tar

1107
00:40:23,040 --> 00:40:26,240
up this directory i echo

1108
00:40:26,240 --> 00:40:29,440
it back to console to essentially tell

1109
00:40:29,440 --> 00:40:31,359
my adversary that hey here's a new

1110
00:40:31,359 --> 00:40:34,560
variable you should look for

1111
00:40:35,040 --> 00:40:38,400
and finally we will need to exfiltrate

1112
00:40:38,400 --> 00:40:41,760
this directory so scrolling through i

1113
00:40:41,760 --> 00:40:43,359
can see that i have

1114
00:40:43,359 --> 00:40:47,200
a file dot io x fill this again works on

1115
00:40:47,200 --> 00:40:50,480
all three operating systems

1116
00:40:50,800 --> 00:40:53,839
i will add this

1117
00:40:54,000 --> 00:40:56,480
now i can see that this is going to use

1118
00:40:56,480 --> 00:40:57,680
the popular

1119
00:40:57,680 --> 00:41:00,560
one use only file serve called file.io

1120
00:41:00,560 --> 00:41:02,160
there are many that like it

1121
00:41:02,160 --> 00:41:04,839
and what it will do is it will take the

1122
00:41:04,839 --> 00:41:06,160
exfiltrated

1123
00:41:06,160 --> 00:41:08,560
or sorry it will take the compressed

1124
00:41:08,560 --> 00:41:09,520
directory

1125
00:41:09,520 --> 00:41:12,400
my staging directory and it will curl

1126
00:41:12,400 --> 00:41:13,920
that

1127
00:41:13,920 --> 00:41:16,480
to file.io now this will give me

1128
00:41:16,480 --> 00:41:18,880
something that as an adversary i can now

1129
00:41:18,880 --> 00:41:22,160
navigate to the output url that this

1130
00:41:22,160 --> 00:41:23,040
command will

1131
00:41:23,040 --> 00:41:25,839
create and i can simply download my

1132
00:41:25,839 --> 00:41:27,440
compressed directory

1133
00:41:27,440 --> 00:41:30,400
so we'll close this

1134
00:41:30,640 --> 00:41:35,839
and we will deploy our file thief

1135
00:41:36,960 --> 00:41:38,640
now we can see it off here and running

1136
00:41:38,640 --> 00:41:40,880
it is executing it has things cued i

1137
00:41:40,880 --> 00:41:43,680
will click into it

1138
00:41:44,160 --> 00:41:46,800
and i can see it working so what i will

1139
00:41:46,800 --> 00:41:48,000
do is i will scroll down

1140
00:41:48,000 --> 00:41:51,280
quite a bit and see the very first thing

1141
00:41:51,280 --> 00:41:52,880
it did was attempt to find

1142
00:41:52,880 --> 00:41:57,200
recent files opening that command up

1143
00:41:57,200 --> 00:42:00,960
i can see that it located

1144
00:42:00,960 --> 00:42:03,440
quite a few so seven or eight different

1145
00:42:03,440 --> 00:42:04,480
files

1146
00:42:04,480 --> 00:42:06,640
and including some of the video clips

1147
00:42:06,640 --> 00:42:09,599
that i'm using for this particular

1148
00:42:09,599 --> 00:42:12,240
recording and i can see here the

1149
00:42:12,240 --> 00:42:14,240
arbitrary text which is this

1150
00:42:14,240 --> 00:42:17,440
output was parsed automatically and

1151
00:42:17,440 --> 00:42:20,720
broken down into indicators such as file

1152
00:42:20,720 --> 00:42:23,839
and the technique that came say t105 and

1153
00:42:23,839 --> 00:42:24,800
i can see

1154
00:42:24,800 --> 00:42:27,599
what they look like

1155
00:42:29,119 --> 00:42:31,119
scrolling down further i can see the

1156
00:42:31,119 --> 00:42:33,680
different procedures that are available

1157
00:42:33,680 --> 00:42:34,640
to me

1158
00:42:34,640 --> 00:42:37,920
if i want to change the output of this

1159
00:42:37,920 --> 00:42:39,599
command to the input of others so i can

1160
00:42:39,599 --> 00:42:40,960
see t 1074

1161
00:42:40,960 --> 00:42:45,839
1486 and so forth

1162
00:42:46,160 --> 00:42:48,079
the next command i can see i created a

1163
00:42:48,079 --> 00:42:50,800
new directory

1164
00:42:51,280 --> 00:42:53,359
and i can see here the same deal it

1165
00:42:53,359 --> 00:42:55,520
parks results and it parsed out that a

1166
00:42:55,520 --> 00:42:56,000
file

1167
00:42:56,000 --> 00:42:58,880
t-tes 1074 was in this location as well

1168
00:42:58,880 --> 00:43:00,240
as a directory

1169
00:43:00,240 --> 00:43:02,240
now as a human i can look at this and

1170
00:43:02,240 --> 00:43:04,560
say well that's a directory not a file

1171
00:43:04,560 --> 00:43:06,400
so i'm going to go ahead and remove the

1172
00:43:06,400 --> 00:43:08,720
file it's a directory

1173
00:43:08,720 --> 00:43:12,000
now what could an adversary chain to

1174
00:43:12,000 --> 00:43:15,280
this result well they could chain a

1175
00:43:15,280 --> 00:43:17,680
creating of a crypto key they could

1176
00:43:17,680 --> 00:43:18,960
compress the directory

1177
00:43:18,960 --> 00:43:20,800
they could stage there's a lot of things

1178
00:43:20,800 --> 00:43:22,640
an adversary could actually do

1179
00:43:22,640 --> 00:43:25,040
once they're capable of creating that

1180
00:43:25,040 --> 00:43:27,839
directory

1181
00:43:27,920 --> 00:43:30,319
finally we are rolling through the

1182
00:43:30,319 --> 00:43:32,160
staging process we are going to take

1183
00:43:32,160 --> 00:43:34,240
all of the files you can see this used

1184
00:43:34,240 --> 00:43:35,680
to be a variable

1185
00:43:35,680 --> 00:43:37,760
all the files that i found from the

1186
00:43:37,760 --> 00:43:39,760
first step finding recent files

1187
00:43:39,760 --> 00:43:42,560
and moving them copying them sorry into

1188
00:43:42,560 --> 00:43:42,960
the

1189
00:43:42,960 --> 00:43:46,960
newly created stage directory

1190
00:43:46,960 --> 00:43:49,119
so i can scroll up and see a number of

1191
00:43:49,119 --> 00:43:50,960
these files

1192
00:43:50,960 --> 00:43:55,119
being staged

1193
00:43:55,119 --> 00:43:57,040
as i move up a little bit further i can

1194
00:43:57,040 --> 00:43:58,160
finally say compress

1195
00:43:58,160 --> 00:44:01,359
stage directory step clicking into that

1196
00:44:01,359 --> 00:44:03,440
very similar to creating the stage

1197
00:44:03,440 --> 00:44:04,640
directory in general

1198
00:44:04,640 --> 00:44:07,680
i echo out my tar gz

1199
00:44:07,680 --> 00:44:10,000
and i can see i was able to parse it and

1200
00:44:10,000 --> 00:44:12,000
i can see that there are two steps that

1201
00:44:12,000 --> 00:44:12,640
i could do

1202
00:44:12,640 --> 00:44:15,280
in order to exfiltrate i could upload

1203
00:44:15,280 --> 00:44:16,960
the file to a target system

1204
00:44:16,960 --> 00:44:19,839
over a custom http endpoint or do what i

1205
00:44:19,839 --> 00:44:21,760
actually chose to do in this adversary

1206
00:44:21,760 --> 00:44:23,520
which is to leverage a file share to

1207
00:44:23,520 --> 00:44:24,800
exfiltrate the

1208
00:44:24,800 --> 00:44:27,359
directory

1209
00:44:28,560 --> 00:44:31,000
finally as i move up i can see that the

1210
00:44:31,000 --> 00:44:33,359
file.io

1211
00:44:33,359 --> 00:44:36,400
step failed now this one's interesting

1212
00:44:36,400 --> 00:44:37,680
right so i can see that

1213
00:44:37,680 --> 00:44:40,400
the adversary was blocked through the

1214
00:44:40,400 --> 00:44:40,880
stage

1215
00:44:40,880 --> 00:44:43,839
or through the attempt of exfiltrating

1216
00:44:43,839 --> 00:44:44,720
the

1217
00:44:44,720 --> 00:44:46,960
commands or exfiltrating the compressed

1218
00:44:46,960 --> 00:44:47,920
directory

1219
00:44:47,920 --> 00:44:51,040
now i can see command timed out well

1220
00:44:51,040 --> 00:44:53,359
this is something that is great to know

1221
00:44:53,359 --> 00:44:55,119
from both the offensive and defensive

1222
00:44:55,119 --> 00:44:56,079
standpoints

1223
00:44:56,079 --> 00:44:58,720
why would it time out probably because

1224
00:44:58,720 --> 00:45:00,640
the files that attempted to exfiltrate

1225
00:45:00,640 --> 00:45:01,040
were

1226
00:45:01,040 --> 00:45:02,720
massive they were video files multiple

1227
00:45:02,720 --> 00:45:04,079
gigabytes and they

1228
00:45:04,079 --> 00:45:06,720
probably could not be handled by file.io

1229
00:45:06,720 --> 00:45:08,000
it timed out

1230
00:45:08,000 --> 00:45:09,920
now that is something an adversary could

1231
00:45:09,920 --> 00:45:11,839
then circle back to

1232
00:45:11,839 --> 00:45:13,920
knowing that this step failed and

1233
00:45:13,920 --> 00:45:15,520
attempting to filter down those

1234
00:45:15,520 --> 00:45:17,680
important files down to a certain size

1235
00:45:17,680 --> 00:45:18,480
maybe

1236
00:45:18,480 --> 00:45:21,119
or attempting a different route in terms

1237
00:45:21,119 --> 00:45:22,640
of exfiltration maybe i should have

1238
00:45:22,640 --> 00:45:23,599
chosen that

1239
00:45:23,599 --> 00:45:26,640
custom http option when it came to

1240
00:45:26,640 --> 00:45:28,240
exfiltrating

1241
00:45:28,240 --> 00:45:30,880
but that's kind of a thing a decision

1242
00:45:30,880 --> 00:45:34,319
for the future adversary to make

1243
00:45:36,720 --> 00:45:39,520
so i hope you enjoyed this talk today i

1244
00:45:39,520 --> 00:45:40,640
hope you took

1245
00:45:40,640 --> 00:45:42,319
what you took away was essentially the

1246
00:45:42,319 --> 00:45:45,280
logic the understanding of how to change

1247
00:45:45,280 --> 00:45:47,520
the output of commands to the input of

1248
00:45:47,520 --> 00:45:49,359
others and i hope that you took that

1249
00:45:49,359 --> 00:45:51,040
knowledge and kind of

1250
00:45:51,040 --> 00:45:53,359
saw how it could apply to the real world

1251
00:45:53,359 --> 00:45:55,040
where you may be attempting to

1252
00:45:55,040 --> 00:45:58,000
automate the easier components in

1253
00:45:58,000 --> 00:46:00,400
offensive security assessments where you

1254
00:46:00,400 --> 00:46:01,119
can actually

1255
00:46:01,119 --> 00:46:02,319
take that learner knowledge the

1256
00:46:02,319 --> 00:46:04,240
contextual knowledge and

1257
00:46:04,240 --> 00:46:06,319
pass it through the chain in order to

1258
00:46:06,319 --> 00:46:08,319
create very simplistic

1259
00:46:08,319 --> 00:46:10,000
but i guess in some cases like privilege

1260
00:46:10,000 --> 00:46:11,760
escalation some more complicated

1261
00:46:11,760 --> 00:46:14,000
adversary scenarios and so i hope you

1262
00:46:14,000 --> 00:46:15,599
learned that

1263
00:46:15,599 --> 00:46:18,880
this is possible there is there are

1264
00:46:18,880 --> 00:46:21,280
places that automation can come in

1265
00:46:21,280 --> 00:46:24,000
solve problems in the red team space and

1266
00:46:24,000 --> 00:46:24,960
that

1267
00:46:24,960 --> 00:46:27,599
you can as a person on the red team blue

1268
00:46:27,599 --> 00:46:28,319
team

1269
00:46:28,319 --> 00:46:30,480
purple team you can leverage this

1270
00:46:30,480 --> 00:46:31,760
automation in ways

1271
00:46:31,760 --> 00:46:34,880
to run 24 7 if you want security

1272
00:46:34,880 --> 00:46:36,079
assessments or off-hour

1273
00:46:36,079 --> 00:46:37,760
security assessments that are that are

1274
00:46:37,760 --> 00:46:39,680
kind of poking at these different areas

1275
00:46:39,680 --> 00:46:41,200
while you spend the majority of your

1276
00:46:41,200 --> 00:46:43,359
time working in the more complicated

1277
00:46:43,359 --> 00:46:46,000
creative areas in the right team space

1278
00:46:46,000 --> 00:46:49,119
thank you very much

