1
00:00:00,719 --> 00:00:02,800
hey good evening um my name is matt

2
00:00:02,800 --> 00:00:03,760
batten

3
00:00:03,760 --> 00:00:06,080
my twitter handle is red vaughn like red

4
00:00:06,080 --> 00:00:08,400
teaming and uh vulnerability research

5
00:00:08,400 --> 00:00:11,599
and my talk is on dotnet and uh nvidia

6
00:00:11,599 --> 00:00:12,960
oh days

7
00:00:12,960 --> 00:00:16,239
so for net obviously it's under

8
00:00:16,239 --> 00:00:18,160
microsoft and videos and video for the

9
00:00:18,160 --> 00:00:19,840
gfe

10
00:00:19,840 --> 00:00:23,600
and uh i'll go more in depth of that

11
00:00:23,600 --> 00:00:25,680
so the first slide of course i have to

12
00:00:25,680 --> 00:00:27,199
go about myself

13
00:00:27,199 --> 00:00:30,000
who am i and that's my wife and my best

14
00:00:30,000 --> 00:00:32,000
friend and all my animals

15
00:00:32,000 --> 00:00:34,399
um the animals are very important to me

16
00:00:34,399 --> 00:00:36,480
and they're crazy

17
00:00:36,480 --> 00:00:37,920
uh so like i said my twitter handle is

18
00:00:37,920 --> 00:00:39,840
redvong my email if you want to hit me

19
00:00:39,840 --> 00:00:42,000
up or ask me any questions

20
00:00:42,000 --> 00:00:44,399
i enjoy having technical discussions or

21
00:00:44,399 --> 00:00:46,480
talking about whatever you like

22
00:00:46,480 --> 00:00:48,879
and uh the company i currently work at

23
00:00:48,879 --> 00:00:49,680
at 6th gen

24
00:00:49,680 --> 00:00:52,399
i had seven jobs in two years and i was

25
00:00:52,399 --> 00:00:53,680
not happy

26
00:00:53,680 --> 00:00:55,440
and i've been working at sixth gen for

27
00:00:55,440 --> 00:00:56,800
almost three years now

28
00:00:56,800 --> 00:00:58,480
and i don't plan on going anywhere else

29
00:00:58,480 --> 00:01:00,719
and i'm surrounded by

30
00:01:00,719 --> 00:01:03,199
the brightest and some of the smartest

31
00:01:03,199 --> 00:01:04,720
people i've ever met and i've never been

32
00:01:04,720 --> 00:01:06,640
the smartest person in the room

33
00:01:06,640 --> 00:01:09,280
i'm very grateful that um ethan our ceo

34
00:01:09,280 --> 00:01:11,119
took a chance on me and i'm

35
00:01:11,119 --> 00:01:12,479
you know i'm still working here and i

36
00:01:12,479 --> 00:01:14,400
love it

37
00:01:14,400 --> 00:01:16,880
um so yeah i'm a husband red teamer dog

38
00:01:16,880 --> 00:01:17,439
dad

39
00:01:17,439 --> 00:01:19,200
i'm a marine corvette i was in signals

40
00:01:19,200 --> 00:01:20,560
intelligence

41
00:01:20,560 --> 00:01:22,080
and um i got out and i've been doing

42
00:01:22,080 --> 00:01:25,680
this and i'm also a cat dad

43
00:01:25,680 --> 00:01:28,080
so what we're gonna be covering is the

44
00:01:28,080 --> 00:01:29,040
thought process

45
00:01:29,040 --> 00:01:31,280
the tools the actual examples and

46
00:01:31,280 --> 00:01:33,360
closing thoughts so the reason i put it

47
00:01:33,360 --> 00:01:34,560
out like this is because i want people

48
00:01:34,560 --> 00:01:36,000
to be able to watch this talk and then

49
00:01:36,000 --> 00:01:37,040
actually

50
00:01:37,040 --> 00:01:39,439
understand on and reason you know their

51
00:01:39,439 --> 00:01:40,479
way on how to actually find

52
00:01:40,479 --> 00:01:41,680
vulnerabilities it's not

53
00:01:41,680 --> 00:01:43,200
when when you watch this and by the end

54
00:01:43,200 --> 00:01:45,439
of it you should realize oh wow that

55
00:01:45,439 --> 00:01:47,360
actually was not that hard like

56
00:01:47,360 --> 00:01:49,520
you know i got paid for the net oh day

57
00:01:49,520 --> 00:01:51,439
prives by microsoft

58
00:01:51,439 --> 00:01:53,040
you know like that's real like the the

59
00:01:53,040 --> 00:01:55,200
nvidia one they acknowledge it now

60
00:01:55,200 --> 00:01:56,560
there's me a link at the end i got the

61
00:01:56,560 --> 00:01:59,200
cv for that and um any i think anyone

62
00:01:59,200 --> 00:01:59,520
could

63
00:01:59,520 --> 00:02:02,000
find it with a basic understanding and

64
00:02:02,000 --> 00:02:02,640
after

65
00:02:02,640 --> 00:02:04,960
watching this and i'm reading some other

66
00:02:04,960 --> 00:02:05,759
researchers

67
00:02:05,759 --> 00:02:09,520
you know work which i'll go into so

68
00:02:09,520 --> 00:02:11,038
the thought process there's so many

69
00:02:11,038 --> 00:02:12,080
different ways to do vulnerability

70
00:02:12,080 --> 00:02:12,879
research

71
00:02:12,879 --> 00:02:14,640
right there's you know code analysis the

72
00:02:14,640 --> 00:02:16,879
static analysis dynamic

73
00:02:16,879 --> 00:02:18,879
um and then there's a behavioral which

74
00:02:18,879 --> 00:02:20,480
you know i would say that

75
00:02:20,480 --> 00:02:23,440
i'm more right now behavioral analysis

76
00:02:23,440 --> 00:02:23,760
where

77
00:02:23,760 --> 00:02:26,720
i do things and i watch weird stuff

78
00:02:26,720 --> 00:02:29,280
happening and then i work backwards

79
00:02:29,280 --> 00:02:31,120
eventually i get to the code analysis

80
00:02:31,120 --> 00:02:33,440
portion but i start behavioral which

81
00:02:33,440 --> 00:02:35,280
is not as technical i would think and

82
00:02:35,280 --> 00:02:37,680
say someone might disagree but

83
00:02:37,680 --> 00:02:39,599
um i'm trying to get more into driver

84
00:02:39,599 --> 00:02:41,599
oda exploitation and everything

85
00:02:41,599 --> 00:02:44,160
um i'm really motivated at that right

86
00:02:44,160 --> 00:02:44,720
now because

87
00:02:44,720 --> 00:02:46,160
everyone wants some kernel driver stuff

88
00:02:46,160 --> 00:02:48,239
because i just i want some oday private

89
00:02:48,239 --> 00:02:49,519
windows 10

90
00:02:49,519 --> 00:02:51,120
it's like my big thing right now i'm

91
00:02:51,120 --> 00:02:53,280
going after but that's more starting out

92
00:02:53,280 --> 00:02:53,840
static

93
00:02:53,840 --> 00:02:56,879
and then working the other way um great

94
00:02:56,879 --> 00:02:57,840
researchers

95
00:02:57,840 --> 00:02:59,920
uh who published their work got me to

96
00:02:59,920 --> 00:03:01,200
where i am now

97
00:03:01,200 --> 00:03:03,040
such as james ford shaw which who am i

98
00:03:03,040 --> 00:03:05,120
right you know i really look up to he's

99
00:03:05,120 --> 00:03:06,400
um i would love i'd probably like the

100
00:03:06,400 --> 00:03:08,319
next step and my my dream goal would be

101
00:03:08,319 --> 00:03:09,040
sitting

102
00:03:09,040 --> 00:03:10,879
next to him for two weeks and just

103
00:03:10,879 --> 00:03:13,200
listen to ramble or talk about

104
00:03:13,200 --> 00:03:15,599
um how he gets to where he is where even

105
00:03:15,599 --> 00:03:17,680
i reread some of his blogs sometimes and

106
00:03:17,680 --> 00:03:18,319
i still

107
00:03:18,319 --> 00:03:21,200
only understand the half so i just need

108
00:03:21,200 --> 00:03:22,480
him to explain to me like

109
00:03:22,480 --> 00:03:25,840
i'm dumb and then uh matt nelson

110
00:03:25,840 --> 00:03:28,400
his research enigma is what he goes by

111
00:03:28,400 --> 00:03:29,360
and

112
00:03:29,360 --> 00:03:31,519
he has a great blog that i like reading

113
00:03:31,519 --> 00:03:33,200
and it helps find some vulnerabilities

114
00:03:33,200 --> 00:03:34,319
as well and

115
00:03:34,319 --> 00:03:36,000
um my closing thought and like the

116
00:03:36,000 --> 00:03:37,280
thought process is like why does this

117
00:03:37,280 --> 00:03:39,040
matter to a company or government like

118
00:03:39,040 --> 00:03:39,840
why

119
00:03:39,840 --> 00:03:40,959
like if you're watching this you're not

120
00:03:40,959 --> 00:03:42,560
going to be vulnerable researcher watch

121
00:03:42,560 --> 00:03:43,840
this matter to you and

122
00:03:43,840 --> 00:03:45,280
you know i say to that like um the

123
00:03:45,280 --> 00:03:47,120
solarwinds um issue

124
00:03:47,120 --> 00:03:48,640
there's been so many issues but that's

125
00:03:48,640 --> 00:03:50,080
just the most like one of the most

126
00:03:50,080 --> 00:03:51,200
recents where

127
00:03:51,200 --> 00:03:53,439
companies who were patching up to date

128
00:03:53,439 --> 00:03:54,799
ended up being vulnerable while

129
00:03:54,799 --> 00:03:56,400
companies who fell behind

130
00:03:56,400 --> 00:03:59,120
and did not patch properly on time ended

131
00:03:59,120 --> 00:03:59,519
up

132
00:03:59,519 --> 00:04:01,920
you know missing that obviously there's

133
00:04:01,920 --> 00:04:02,879
other vulnerabilities when they don't

134
00:04:02,879 --> 00:04:04,879
patch on time but

135
00:04:04,879 --> 00:04:06,720
every time you install new software you

136
00:04:06,720 --> 00:04:09,680
update software or something's different

137
00:04:09,680 --> 00:04:12,319
you end up introducing more things onto

138
00:04:12,319 --> 00:04:14,159
the system into the network and you know

139
00:04:14,159 --> 00:04:15,680
it can always be more vulnerabilities

140
00:04:15,680 --> 00:04:16,880
there could always be

141
00:04:16,880 --> 00:04:19,519
more issues and um you know or it's

142
00:04:19,519 --> 00:04:20,720
maybe it's more secure and completely

143
00:04:20,720 --> 00:04:22,160
locked down but from what i've seen

144
00:04:22,160 --> 00:04:23,120
whenever

145
00:04:23,120 --> 00:04:26,160
you know new software is updated or new

146
00:04:26,160 --> 00:04:26,800
software is

147
00:04:26,800 --> 00:04:28,320
added or something's updated there's

148
00:04:28,320 --> 00:04:30,000
been more issues than

149
00:04:30,000 --> 00:04:33,040
fixes normally and then uh

150
00:04:33,040 --> 00:04:35,120
the tools that we're going to talk about

151
00:04:35,120 --> 00:04:36,479
there's a lot of tools

152
00:04:36,479 --> 00:04:38,639
um there's more like nitty gritty like

153
00:04:38,639 --> 00:04:39,680
ida pro and

154
00:04:39,680 --> 00:04:40,960
guidro and things like that if you're

155
00:04:40,960 --> 00:04:42,639
actually i want to do some stack

156
00:04:42,639 --> 00:04:44,720
analysis like reverse engineering

157
00:04:44,720 --> 00:04:46,639
um but for this and that's why i'm gonna

158
00:04:46,639 --> 00:04:49,199
say it's simple and it was fun and easy

159
00:04:49,199 --> 00:04:51,360
is just process monitor you know so

160
00:04:51,360 --> 00:04:53,440
windows internal suite tool

161
00:04:53,440 --> 00:04:55,600
um you can just see what's going on and

162
00:04:55,600 --> 00:04:57,440
it shows you know the api calls and

163
00:04:57,440 --> 00:04:58,560
everything

164
00:04:58,560 --> 00:05:00,160
and then uh james for shaw's tools he

165
00:05:00,160 --> 00:05:01,840
actually made his own tools so you know

166
00:05:01,840 --> 00:05:05,039
super legit like create sim link uh like

167
00:05:05,039 --> 00:05:06,479
create hard link things like that and

168
00:05:06,479 --> 00:05:08,080
i'll talk about that later on you'll see

169
00:05:08,080 --> 00:05:08,960
it

170
00:05:08,960 --> 00:05:10,479
and then um having virtual machines

171
00:05:10,479 --> 00:05:13,199
understanding how they work

172
00:05:13,199 --> 00:05:15,199
you know having vms just be able to

173
00:05:15,199 --> 00:05:17,199
reboot them and keep your machine up

174
00:05:17,199 --> 00:05:19,280
helps a lot if you test your own host

175
00:05:19,280 --> 00:05:20,479
machine at home though you'll probably

176
00:05:20,479 --> 00:05:22,400
end up finding a lot of vulnerabilities

177
00:05:22,400 --> 00:05:24,560
from things i'm going to talk about from

178
00:05:24,560 --> 00:05:26,160
random software you've installed or

179
00:05:26,160 --> 00:05:27,600
downloaded

180
00:05:27,600 --> 00:05:30,479
so um here's pokemon this is just what

181
00:05:30,479 --> 00:05:31,919
it looks like on your screen

182
00:05:31,919 --> 00:05:33,360
i'm sure a lot of people have seen this

183
00:05:33,360 --> 00:05:35,120
but a lot of people don't know that use

184
00:05:35,120 --> 00:05:35,759
it which

185
00:05:35,759 --> 00:05:38,160
you know i find fascinating that you can

186
00:05:38,160 --> 00:05:40,720
actually enable boot logging

187
00:05:40,720 --> 00:05:44,320
where if you do enable boot logging

188
00:05:44,320 --> 00:05:46,320
and then you restart your computer while

189
00:05:46,320 --> 00:05:48,000
keeping proc mine open

190
00:05:48,000 --> 00:05:49,759
it actually will show you everything

191
00:05:49,759 --> 00:05:51,520
that happened up to the point of

192
00:05:51,520 --> 00:05:52,960
your computer booting up like when you

193
00:05:52,960 --> 00:05:54,880
open up procmond so it's all the

194
00:05:54,880 --> 00:05:56,319
services and schedules or all the

195
00:05:56,319 --> 00:05:58,400
services and tasks that started

196
00:05:58,400 --> 00:05:59,919
during the boot process and you can go

197
00:05:59,919 --> 00:06:01,360
and see like what dlls are getting

198
00:06:01,360 --> 00:06:02,400
called

199
00:06:02,400 --> 00:06:04,639
what files being created things like

200
00:06:04,639 --> 00:06:06,000
that and see if there's any way

201
00:06:06,000 --> 00:06:09,360
that you can um bypass or elevate or

202
00:06:09,360 --> 00:06:12,560
do something interesting um

203
00:06:12,560 --> 00:06:14,000
obviously they're locking down on that

204
00:06:14,000 --> 00:06:15,120
and they're doing their best but there's

205
00:06:15,120 --> 00:06:16,479
been some really funny ones that

206
00:06:16,479 --> 00:06:18,400
my previous talk because nvidia one just

207
00:06:18,400 --> 00:06:20,000
got disclosed uh the other

208
00:06:20,000 --> 00:06:21,440
day i couldn't talk about it but i

209
00:06:21,440 --> 00:06:23,360
talked about a bypass uac oh day

210
00:06:23,360 --> 00:06:25,199
which was just a dll that was getting

211
00:06:25,199 --> 00:06:26,800
called a system

212
00:06:26,800 --> 00:06:29,360
um i think it was like it was a um

213
00:06:29,360 --> 00:06:30,479
process crate

214
00:06:30,479 --> 00:06:32,479
or load process or yeah i think it was

215
00:06:32,479 --> 00:06:34,319
process create where it just

216
00:06:34,319 --> 00:06:36,880
it was just calling the uh the dll you

217
00:06:36,880 --> 00:06:38,880
know it was like some api legacy

218
00:06:38,880 --> 00:06:42,720
dll that ended up getting called um

219
00:06:42,720 --> 00:06:44,720
but for so for this you you can reboot

220
00:06:44,720 --> 00:06:46,720
that obviously the filters are um some

221
00:06:46,720 --> 00:06:48,400
of the most important

222
00:06:48,400 --> 00:06:51,440
so you'll you'll see here that it has

223
00:06:51,440 --> 00:06:53,520
like reg up and key reg load key these

224
00:06:53,520 --> 00:06:54,720
are some of the ones i look at

225
00:06:54,720 --> 00:06:56,479
this isn't one i always use this just an

226
00:06:56,479 --> 00:06:57,919
example

227
00:06:57,919 --> 00:07:01,039
um you see process start i think that's

228
00:07:01,039 --> 00:07:02,000
actually

229
00:07:02,000 --> 00:07:05,199
what was called i believe for

230
00:07:05,199 --> 00:07:07,440
that bypass uac not the process create i

231
00:07:07,440 --> 00:07:08,720
believe this process start i can't

232
00:07:08,720 --> 00:07:09,599
remember maybe

233
00:07:09,599 --> 00:07:12,000
it might have been load image um but

234
00:07:12,000 --> 00:07:12,639
anyways

235
00:07:12,639 --> 00:07:14,720
a bunch of filters you have it does

236
00:07:14,720 --> 00:07:16,400
different things create file

237
00:07:16,400 --> 00:07:17,840
is harder now because of some

238
00:07:17,840 --> 00:07:19,440
mitigations put in place by microsoft

239
00:07:19,440 --> 00:07:21,039
we'll talk about that

240
00:07:21,039 --> 00:07:24,080
i take out things like um i try to take

241
00:07:24,080 --> 00:07:25,520
out like integrity level

242
00:07:25,520 --> 00:07:27,120
like medium and low you can take it out

243
00:07:27,120 --> 00:07:28,720
or you can like i filtered in

244
00:07:28,720 --> 00:07:31,680
integrity is high integrity is system

245
00:07:31,680 --> 00:07:33,360
include because

246
00:07:33,360 --> 00:07:36,160
um if i can get from you know if i can

247
00:07:36,160 --> 00:07:37,280
get a higher system

248
00:07:37,280 --> 00:07:39,680
from a medium integrity non-admin user

249
00:07:39,680 --> 00:07:40,960
then that's a that's a privilege

250
00:07:40,960 --> 00:07:41,680
escalation

251
00:07:41,680 --> 00:07:43,520
right if somebody's medium integrity

252
00:07:43,520 --> 00:07:45,199
with admin and i can get to high

253
00:07:45,199 --> 00:07:46,479
integrity without

254
00:07:46,479 --> 00:07:48,960
something popping up then you know

255
00:07:48,960 --> 00:07:51,039
that's a it's a bypass uac that's still

256
00:07:51,039 --> 00:07:52,720
you know still worth something that's so

257
00:07:52,720 --> 00:07:54,560
interesting and valuable

258
00:07:54,560 --> 00:07:56,080
so i see a lot of people just looking

259
00:07:56,080 --> 00:07:58,400
for system there's still a lot of ways

260
00:07:58,400 --> 00:08:00,080
you know around that but these are just

261
00:08:00,080 --> 00:08:01,599
some examples of filters there's you

262
00:08:01,599 --> 00:08:03,360
know there's more out there

263
00:08:03,360 --> 00:08:06,639
um you can talk about going to but

264
00:08:06,639 --> 00:08:07,759
i'd say filters are probably the most

265
00:08:07,759 --> 00:08:10,160
important things to learn about procmod

266
00:08:10,160 --> 00:08:11,520
understanding from other people's work

267
00:08:11,520 --> 00:08:12,000
methodology

268
00:08:12,000 --> 00:08:14,479
getting it together so um so this is the

269
00:08:14,479 --> 00:08:16,080
net local privilege escalation

270
00:08:16,080 --> 00:08:18,080
so this actually affected like all of

271
00:08:18,080 --> 00:08:19,120
net or

272
00:08:19,120 --> 00:08:20,479
i think most of the versions like going

273
00:08:20,479 --> 00:08:23,120
back or maybe um it was an older one

274
00:08:23,120 --> 00:08:25,120
when i did it or it was it was actually

275
00:08:25,120 --> 00:08:27,280
the recent one but i tested others going

276
00:08:27,280 --> 00:08:28,160
back and they all

277
00:08:28,160 --> 00:08:30,160
worked as well and i found it really

278
00:08:30,160 --> 00:08:31,759
interesting where

279
00:08:31,759 --> 00:08:34,559
um so microsoft they did not give me a

280
00:08:34,559 --> 00:08:35,919
cbe

281
00:08:35,919 --> 00:08:39,200
but they paid me um i think it took them

282
00:08:39,200 --> 00:08:42,719
almost a year uh it was it was really

283
00:08:42,719 --> 00:08:44,959
interesting i emailed every now and then

284
00:08:44,959 --> 00:08:48,000
but hey they paid me eventually

285
00:08:48,000 --> 00:08:50,240
here i am you know i'm happy i got it i

286
00:08:50,240 --> 00:08:51,920
wish i got a cv i've emailed them

287
00:08:51,920 --> 00:08:53,120
four or five times i never got a

288
00:08:53,120 --> 00:08:55,040
response about cve i don't understand

289
00:08:55,040 --> 00:08:56,160
how they could just pay me and not give

290
00:08:56,160 --> 00:08:58,480
me a cve but i guess money

291
00:08:58,480 --> 00:09:00,240
money is still nice right so i'm not

292
00:09:00,240 --> 00:09:02,080
gonna complain too much even though i'd

293
00:09:02,080 --> 00:09:03,120
really like a cbe

294
00:09:03,120 --> 00:09:05,839
obviously anyways um so this is really

295
00:09:05,839 --> 00:09:06,880
important

296
00:09:06,880 --> 00:09:08,480
so the path redirect redirection

297
00:09:08,480 --> 00:09:10,640
mitigations right so they had uh

298
00:09:10,640 --> 00:09:13,360
i actually took this from uh the blue

299
00:09:13,360 --> 00:09:14,080
hat talk

300
00:09:14,080 --> 00:09:15,839
uh a microsoft employee gave i believe i

301
00:09:15,839 --> 00:09:17,120
believe is microsoft employee

302
00:09:17,120 --> 00:09:18,720
that was from his slides i have the link

303
00:09:18,720 --> 00:09:20,640
at the end for his youtube um

304
00:09:20,640 --> 00:09:23,200
talk but i thought it was amazing talk

305
00:09:23,200 --> 00:09:24,640
and uh

306
00:09:24,640 --> 00:09:26,399
it actually it goes into like what why

307
00:09:26,399 --> 00:09:27,680
mitigation is getting harder like when

308
00:09:27,680 --> 00:09:29,839
you when you do create a junction right

309
00:09:29,839 --> 00:09:32,000
um they'll immediately mark it as a

310
00:09:32,000 --> 00:09:33,040
medium integrity level

311
00:09:33,040 --> 00:09:35,120
so for services that fall like the high

312
00:09:35,120 --> 00:09:36,880
it's saying that it's gonna

313
00:09:36,880 --> 00:09:38,080
it's gonna screw you over because you're

314
00:09:38,080 --> 00:09:39,360
gonna hit medium so now you can't just

315
00:09:39,360 --> 00:09:41,200
do basic junction to get

316
00:09:41,200 --> 00:09:43,200
that that prives you want or even the

317
00:09:43,200 --> 00:09:44,560
the temp see when this temp

318
00:09:44,560 --> 00:09:48,839
was a huge um attack surface right and

319
00:09:48,839 --> 00:09:50,080
now

320
00:09:50,080 --> 00:09:51,440
due to mitigations microsoft's putting

321
00:09:51,440 --> 00:09:53,279
in place it's getting harder to stay

322
00:09:53,279 --> 00:09:54,959
logical which is why like i mean there's

323
00:09:54,959 --> 00:09:56,880
always logical vulnerabilities and

324
00:09:56,880 --> 00:09:58,399
the people like you know james foreshaw

325
00:09:58,399 --> 00:09:59,440
and others and they're always going to

326
00:09:59,440 --> 00:10:01,040
find ways around it and i hope i find a

327
00:10:01,040 --> 00:10:02,480
few more but

328
00:10:02,480 --> 00:10:04,160
um you know that's why i'm i'm looking

329
00:10:04,160 --> 00:10:05,600
more at drivers now because i think

330
00:10:05,600 --> 00:10:06,800
it'll be really fun and a little bit

331
00:10:06,800 --> 00:10:08,880
easier um

332
00:10:08,880 --> 00:10:11,760
i say easier we'll see but um i'm having

333
00:10:11,760 --> 00:10:14,480
a good time with it

334
00:10:14,480 --> 00:10:16,720
so so we're starting on the the.net so

335
00:10:16,720 --> 00:10:18,959
the net um

336
00:10:18,959 --> 00:10:20,800
lp or local privilege escalation it was

337
00:10:20,800 --> 00:10:22,480
really stupid so i was sitting there

338
00:10:22,480 --> 00:10:24,160
and i was on my host machine and i was

339
00:10:24,160 --> 00:10:25,680
just running procmond i just filtered

340
00:10:25,680 --> 00:10:26,320
like i

341
00:10:26,320 --> 00:10:27,440
showed you earlier but a little bit

342
00:10:27,440 --> 00:10:30,320
better where i did uh create file

343
00:10:30,320 --> 00:10:32,000
and query open stuff like that and i did

344
00:10:32,000 --> 00:10:34,640
things running a system i looked for um

345
00:10:34,640 --> 00:10:37,040
you know name not found and then i saw

346
00:10:37,040 --> 00:10:38,240
because if something's not found name

347
00:10:38,240 --> 00:10:39,440
not found it's getting called a system

348
00:10:39,440 --> 00:10:41,040
and user writable directory right see

349
00:10:41,040 --> 00:10:43,920
user user that's cool is the user and

350
00:10:43,920 --> 00:10:45,120
app data that's a user writable

351
00:10:45,120 --> 00:10:46,399
directory so anybody can write to that

352
00:10:46,399 --> 00:10:47,200
directory

353
00:10:47,200 --> 00:10:49,120
which means why why is the deal being

354
00:10:49,120 --> 00:10:50,800
called a system in a directory

355
00:10:50,800 --> 00:10:52,880
that a user can write to so that's the

356
00:10:52,880 --> 00:10:54,320
easy privacy but

357
00:10:54,320 --> 00:10:55,839
the issue is how many computers are

358
00:10:55,839 --> 00:10:57,920
affected by this is this just my host

359
00:10:57,920 --> 00:10:59,279
machine is this some stupid software

360
00:10:59,279 --> 00:11:00,720
that no one else uses in the world why

361
00:11:00,720 --> 00:11:01,839
does this matter

362
00:11:01,839 --> 00:11:04,880
so i saw that happen so then um

363
00:11:04,880 --> 00:11:08,320
i you know i i started working backwards

364
00:11:08,320 --> 00:11:10,240
through pokemon and i was wondering like

365
00:11:10,240 --> 00:11:10,880
okay

366
00:11:10,880 --> 00:11:13,120
this is getting called where is this

367
00:11:13,120 --> 00:11:14,959
getting called so i click where

368
00:11:14,959 --> 00:11:17,920
the extensions.dll was i see the svc

369
00:11:17,920 --> 00:11:19,600
host but then i just took off all

370
00:11:19,600 --> 00:11:20,320
filters

371
00:11:20,320 --> 00:11:22,240
and then i walked backwards and i found

372
00:11:22,240 --> 00:11:23,440
out it was

373
00:11:23,440 --> 00:11:26,480
dot net and and you can see there the

374
00:11:26,480 --> 00:11:29,760
the the actual create file um

375
00:11:29,760 --> 00:11:31,680
dot net tools right that shows this wall

376
00:11:31,680 --> 00:11:32,880
like okay this probably has something to

377
00:11:32,880 --> 00:11:33,360
do with

378
00:11:33,360 --> 00:11:35,200
net even though it's not it's not dot

379
00:11:35,200 --> 00:11:37,600
net but you know okay like

380
00:11:37,600 --> 00:11:41,120
that obviously stands out so

381
00:11:41,120 --> 00:11:42,800
so then you oh yeah i should probably

382
00:11:42,800 --> 00:11:44,240
tell you like system integrity there

383
00:11:44,240 --> 00:11:44,800
right

384
00:11:44,800 --> 00:11:47,920
path not found name not found huh

385
00:11:47,920 --> 00:11:49,360
it's really interesting name not found

386
00:11:49,360 --> 00:11:51,360
system.net okay

387
00:11:51,360 --> 00:11:53,920
so then i go what happens if i just drop

388
00:11:53,920 --> 00:11:54,880
this dll

389
00:11:54,880 --> 00:11:56,320
right this is working backwards this is

390
00:11:56,320 --> 00:11:58,000
not the most technical

391
00:11:58,000 --> 00:11:59,440
and so i could found this from the other

392
00:11:59,440 --> 00:12:01,600
way they actually dug into the code

393
00:12:01,600 --> 00:12:03,120
but this is just okay wpts

394
00:12:03,120 --> 00:12:04,720
extensions.dll there it is

395
00:12:04,720 --> 00:12:08,399
i drop it in there and i have complete

396
00:12:08,399 --> 00:12:09,200
access

397
00:12:09,200 --> 00:12:11,920
to that directory yep see user app data

398
00:12:11,920 --> 00:12:12,639
local and

399
00:12:12,639 --> 00:12:17,440
you'll see that um was it uh

400
00:12:18,000 --> 00:12:21,600
full control that's for yeah but you see

401
00:12:21,600 --> 00:12:24,160
desktop cool has full control right

402
00:12:24,160 --> 00:12:26,240
so some but desktop cool so that's he

403
00:12:26,240 --> 00:12:27,440
was an admin when he installed it so

404
00:12:27,440 --> 00:12:28,560
this is where it gets weird so right now

405
00:12:28,560 --> 00:12:30,560
it's just a bypass uac

406
00:12:30,560 --> 00:12:33,279
prives because you go okay the person

407
00:12:33,279 --> 00:12:35,440
who can drop a file in there

408
00:12:35,440 --> 00:12:38,399
is um an admin it was medium integrity

409
00:12:38,399 --> 00:12:38,959
and everything

410
00:12:38,959 --> 00:12:40,880
like okay you can do bypass pc if you're

411
00:12:40,880 --> 00:12:42,320
an admin you drop in there because

412
00:12:42,320 --> 00:12:44,720
it has to be the user who installed.net

413
00:12:44,720 --> 00:12:46,240
right

414
00:12:46,240 --> 00:12:47,760
but you see you see the permissions

415
00:12:47,760 --> 00:12:49,440
there where it says desktop cool

416
00:12:49,440 --> 00:12:53,279
allow full control in the admin so then

417
00:12:53,279 --> 00:12:55,200
then we get here i know it's really

418
00:12:55,200 --> 00:12:58,000
small but there's there's a load image

419
00:12:58,000 --> 00:12:59,920
i know it's a blue there's a load image

420
00:12:59,920 --> 00:13:01,839
wpts extensions.dll

421
00:13:01,839 --> 00:13:04,240
success right so that means ad system it

422
00:13:04,240 --> 00:13:06,639
ran the dll which means you get that's a

423
00:13:06,639 --> 00:13:09,519
bypass uac oh day right there but then

424
00:13:09,519 --> 00:13:11,360
you go okay well

425
00:13:11,360 --> 00:13:12,560
is there any way this can actually be a

426
00:13:12,560 --> 00:13:14,959
privilege escalation so then

427
00:13:14,959 --> 00:13:17,279
if you look here i walked backwards

428
00:13:17,279 --> 00:13:18,079
through pracmon

429
00:13:18,079 --> 00:13:19,680
and then i realized this registry key

430
00:13:19,680 --> 00:13:21,440
was getting modified

431
00:13:21,440 --> 00:13:24,639
and you can actually see that um the way

432
00:13:24,639 --> 00:13:26,240
it's supposed to be is the path so the

433
00:13:26,240 --> 00:13:27,440
environment variable or it's the

434
00:13:27,440 --> 00:13:29,519
environment path for hkusers.default

435
00:13:29,519 --> 00:13:30,320
environment

436
00:13:30,320 --> 00:13:32,320
and the path here supposed to be percent

437
00:13:32,320 --> 00:13:34,399
user profile for sent

438
00:13:34,399 --> 00:13:38,079
app data and then uh they made it

439
00:13:38,079 --> 00:13:41,760
path um see user cool so

440
00:13:41,760 --> 00:13:43,680
i was like man and added on the dot net

441
00:13:43,680 --> 00:13:45,279
tool so i was like

442
00:13:45,279 --> 00:13:48,320
so when dot net is installed

443
00:13:48,320 --> 00:13:52,800
it modifies that path so

444
00:13:52,800 --> 00:13:55,440
when that service runs it's it's

445
00:13:55,440 --> 00:13:56,639
checking that path

446
00:13:56,639 --> 00:13:59,680
it's actually calling this path and

447
00:13:59,680 --> 00:14:01,120
instead of going to percent user profile

448
00:14:01,120 --> 00:14:01,680
percent

449
00:14:01,680 --> 00:14:03,680
app data is going to the user who

450
00:14:03,680 --> 00:14:04,959
installed.net which you have to be an

451
00:14:04,959 --> 00:14:07,279
admin to install.net.net right so right

452
00:14:07,279 --> 00:14:08,800
now it's sold bypass jc

453
00:14:08,800 --> 00:14:11,839
but then what installs.net like what

454
00:14:11,839 --> 00:14:14,480
what what does install it boom it's um

455
00:14:14,480 --> 00:14:16,240
msi file

456
00:14:16,240 --> 00:14:18,160
so see installer so c1 is installer

457
00:14:18,160 --> 00:14:19,519
that's where msi files are when you're

458
00:14:19,519 --> 00:14:20,959
installing stuff right

459
00:14:20,959 --> 00:14:24,959
and um it's

460
00:14:24,959 --> 00:14:26,720
it ends up being like because of that i

461
00:14:26,720 --> 00:14:28,000
realize the registry key it checks the

462
00:14:28,000 --> 00:14:29,040
registry key path

463
00:14:29,040 --> 00:14:31,760
and it runs it i wish i clicked forward

464
00:14:31,760 --> 00:14:32,320
already and

465
00:14:32,320 --> 00:14:35,360
can go back but so for the dot msi file

466
00:14:35,360 --> 00:14:37,360
ends up when it's running it's it runs

467
00:14:37,360 --> 00:14:39,360
as integrity or it runs as a user you

468
00:14:39,360 --> 00:14:41,120
currently are

469
00:14:41,120 --> 00:14:43,120
so and then it modifies that registry

470
00:14:43,120 --> 00:14:45,440
key right the register value so

471
00:14:45,440 --> 00:14:49,600
if there's a msi it goes okay well

472
00:14:50,320 --> 00:14:52,560
who can run the dot msi file and see

473
00:14:52,560 --> 00:14:53,920
what is installer and that's why i did

474
00:14:53,920 --> 00:14:55,760
the icackles so you see that c1 is

475
00:14:55,760 --> 00:14:56,720
installer

476
00:14:56,720 --> 00:14:59,680
everyone can execute them right read

477
00:14:59,680 --> 00:15:00,240
execute

478
00:15:00,240 --> 00:15:01,920
x you can do eye cackles look at

479
00:15:01,920 --> 00:15:03,440
microsoft documents

480
00:15:03,440 --> 00:15:05,120
and um get a better understanding of

481
00:15:05,120 --> 00:15:07,440
that so you go okay

482
00:15:07,440 --> 00:15:10,079
anyone can run the dot msi file so then

483
00:15:10,079 --> 00:15:10,800
there's ways

484
00:15:10,800 --> 00:15:13,279
um you can search for which msi file was

485
00:15:13,279 --> 00:15:16,079
i ended up just running them all

486
00:15:16,079 --> 00:15:17,760
um but you can actually do a like fine

487
00:15:17,760 --> 00:15:19,519
string search for dlls and things like

488
00:15:19,519 --> 00:15:20,079
that

489
00:15:20,079 --> 00:15:23,519
um there's a there's a great talk i gave

490
00:15:23,519 --> 00:15:24,480
his name at the end

491
00:15:24,480 --> 00:15:26,399
of a reference i can't think of his name

492
00:15:26,399 --> 00:15:28,240
off top my head but he actually he wrote

493
00:15:28,240 --> 00:15:29,519
up a really good blog where he actually

494
00:15:29,519 --> 00:15:31,680
talked about my blog about this some

495
00:15:31,680 --> 00:15:34,560
and uh he his blog goes in such detail

496
00:15:34,560 --> 00:15:36,399
his writing is amazing on uh

497
00:15:36,399 --> 00:15:38,399
he's like.net spy and actually like went

498
00:15:38,399 --> 00:15:40,320
in and looked at the code level where i

499
00:15:40,320 --> 00:15:41,519
just did

500
00:15:41,519 --> 00:15:43,199
like behavioral analysis and figured it

501
00:15:43,199 --> 00:15:45,279
out from randomly clicking and

502
00:15:45,279 --> 00:15:49,839
being sporadic until it worked um

503
00:15:49,839 --> 00:15:51,279
i'll see i'll show his name at the end

504
00:15:51,279 --> 00:15:52,800
but his write-up's amazing if you go to

505
00:15:52,800 --> 00:15:53,440
the link

506
00:15:53,440 --> 00:15:55,120
he explains it really in depth but but

507
00:15:55,120 --> 00:15:57,199
the gist is here okay so now it's owed a

508
00:15:57,199 --> 00:15:59,440
privilege escalation exploit because

509
00:15:59,440 --> 00:16:02,800
it goes um

510
00:16:02,800 --> 00:16:04,480
you work backwards okay a dll is being

511
00:16:04,480 --> 00:16:07,519
called a system okay

512
00:16:07,519 --> 00:16:09,360
it's being called a system where it's

513
00:16:09,360 --> 00:16:10,639
being called at in the user rival

514
00:16:10,639 --> 00:16:11,440
directory

515
00:16:11,440 --> 00:16:14,480
okay but only um the user who i

516
00:16:14,480 --> 00:16:17,040
am he's an admin can write to that so

517
00:16:17,040 --> 00:16:18,399
other users can't really write to it

518
00:16:18,399 --> 00:16:19,600
because it has to be this user

519
00:16:19,600 --> 00:16:20,959
specifically

520
00:16:20,959 --> 00:16:23,920
okay well why why is it calling in this

521
00:16:23,920 --> 00:16:24,720
path

522
00:16:24,720 --> 00:16:27,519
oh this is checking this registry key

523
00:16:27,519 --> 00:16:29,839
what modifies a registry key

524
00:16:29,839 --> 00:16:32,800
oh well it's um when dot net was

525
00:16:32,800 --> 00:16:35,120
installed when dot net is installed

526
00:16:35,120 --> 00:16:37,759
it's it's uh it's calling this.msi file

527
00:16:37,759 --> 00:16:39,920
which modifies that registry key

528
00:16:39,920 --> 00:16:43,040
so then if whatever user

529
00:16:43,040 --> 00:16:46,480
runs the msi file modif it modifies that

530
00:16:46,480 --> 00:16:48,560
registry key with that user's name

531
00:16:48,560 --> 00:16:51,839
so if it's a guest user or a basic user

532
00:16:51,839 --> 00:16:54,800
then you just you just run that msi file

533
00:16:54,800 --> 00:16:56,800
then place a dll in there

534
00:16:56,800 --> 00:16:58,959
and then reboot the box and then you

535
00:16:58,959 --> 00:16:59,920
have or restart

536
00:16:59,920 --> 00:17:01,120
the service driver and then you have a

537
00:17:01,120 --> 00:17:04,000
system callback and that's odaprives

538
00:17:04,000 --> 00:17:05,520
right there i'm clapping in my head

539
00:17:05,520 --> 00:17:07,599
that's a lot i know it's kind of

540
00:17:07,599 --> 00:17:10,959
it's kind of a lot but then um

541
00:17:10,959 --> 00:17:12,720
just going and going on to that like

542
00:17:12,720 --> 00:17:14,799
something add-on this is a nvidia

543
00:17:14,799 --> 00:17:17,039
the gfe lp right so local footage

544
00:17:17,039 --> 00:17:18,400
escalation where

545
00:17:18,400 --> 00:17:20,240
uh they they just game this the other

546
00:17:20,240 --> 00:17:21,439
day

547
00:17:21,439 --> 00:17:23,439
i couldn't talk about the last talk but

548
00:17:23,439 --> 00:17:24,480
i'm glad i can talk about

549
00:17:24,480 --> 00:17:28,000
this one where um this actually you know

550
00:17:28,000 --> 00:17:28,400
this

551
00:17:28,400 --> 00:17:30,160
can actually be an lpe it can lead to

552
00:17:30,160 --> 00:17:32,000
code execution and there's other things

553
00:17:32,000 --> 00:17:32,720
you can do with it

554
00:17:32,720 --> 00:17:34,880
it's really simple and when i show it

555
00:17:34,880 --> 00:17:36,400
like this one's more simple the dot net

556
00:17:36,400 --> 00:17:38,000
one the dot net one's simple

557
00:17:38,000 --> 00:17:39,760
from like you didn't have to go in

558
00:17:39,760 --> 00:17:41,520
assembly you didn't have to use

559
00:17:41,520 --> 00:17:43,760
net spot you didn't have to you know

560
00:17:43,760 --> 00:17:45,600
like i clicked my way through

561
00:17:45,600 --> 00:17:46,720
and just banged my head on the wall

562
00:17:46,720 --> 00:17:48,480
until i figured it out which is you know

563
00:17:48,480 --> 00:17:49,919
like i'm getting more

564
00:17:49,919 --> 00:17:52,000
into assembly and like doing the drivers

565
00:17:52,000 --> 00:17:54,000
but this is just showing like man like

566
00:17:54,000 --> 00:17:54,960
cve is like

567
00:17:54,960 --> 00:17:56,480
this is not that hard and it's not that

568
00:17:56,480 --> 00:17:58,000
crazy and anyone can do it

569
00:17:58,000 --> 00:18:00,960
i hope this motivates some people to go

570
00:18:00,960 --> 00:18:02,240
and do it

571
00:18:02,240 --> 00:18:05,840
where like so for this one um

572
00:18:05,840 --> 00:18:08,640
i'll go so i that was the version of um

573
00:18:08,640 --> 00:18:10,640
geforce experience i had right

574
00:18:10,640 --> 00:18:13,039
on my box i need to upgrade my machine

575
00:18:13,039 --> 00:18:14,400
so i don't know you know i still

576
00:18:14,400 --> 00:18:16,720
i still have a 970 to be honest i

577
00:18:16,720 --> 00:18:19,600
definitely upgrade my uh graphics card

578
00:18:19,600 --> 00:18:22,480
um if you're watching nvidia you hear me

579
00:18:22,480 --> 00:18:23,200
but anyways

580
00:18:23,200 --> 00:18:26,240
um no it's nice enough that they they

581
00:18:26,240 --> 00:18:26,960
acknowledge

582
00:18:26,960 --> 00:18:28,880
uh acknowledged it and gave me the cv

583
00:18:28,880 --> 00:18:31,520
but uh what stands out here is that

584
00:18:31,520 --> 00:18:33,039
uh so the operation set rename

585
00:18:33,039 --> 00:18:36,160
information file and um

586
00:18:36,160 --> 00:18:38,480
i saw that it replaced one file to the

587
00:18:38,480 --> 00:18:39,520
other

588
00:18:39,520 --> 00:18:41,679
and uh matt nelson i think actually has

589
00:18:41,679 --> 00:18:42,880
a great blog about it

590
00:18:42,880 --> 00:18:44,480
and um there's a few others but i i

591
00:18:44,480 --> 00:18:46,480
remember it and i set my filters for

592
00:18:46,480 --> 00:18:48,720
stuff that other researchers have found

593
00:18:48,720 --> 00:18:50,640
so this this is really a collection of

594
00:18:50,640 --> 00:18:52,880
people who are smarter than me

595
00:18:52,880 --> 00:18:54,880
and then i just i i patch them together

596
00:18:54,880 --> 00:18:56,799
to make my own methodology which i think

597
00:18:56,799 --> 00:18:58,960
a lot of people do hopefully but

598
00:18:58,960 --> 00:19:02,720
um so here's the proc money uh

599
00:19:02,720 --> 00:19:06,080
event information where uh it actually

600
00:19:06,080 --> 00:19:09,840
shows okay the operations of set rename

601
00:19:09,840 --> 00:19:10,799
information file

602
00:19:10,799 --> 00:19:12,320
you know it says success and then you

603
00:19:12,320 --> 00:19:15,440
see the path see program data nvidia

604
00:19:15,440 --> 00:19:18,960
dot dot mv stream svc the file okay

605
00:19:18,960 --> 00:19:22,559
and um it says file name old dot log

606
00:19:22,559 --> 00:19:24,000
right so you see that if you look up

607
00:19:24,000 --> 00:19:27,679
and down so ssas current dot log ssas

608
00:19:27,679 --> 00:19:31,440
old log so replace if it says true

609
00:19:31,440 --> 00:19:34,799
so that's crazy so in my head i go okay

610
00:19:34,799 --> 00:19:37,919
if um this is running so it's running as

611
00:19:37,919 --> 00:19:39,120
system which you'll see in

612
00:19:39,120 --> 00:19:40,640
the next slide but if it's running a

613
00:19:40,640 --> 00:19:43,360
system and i can just do

614
00:19:43,360 --> 00:19:46,720
a sim link on um on this where

615
00:19:46,720 --> 00:19:47,840
um and like microsoft through

616
00:19:47,840 --> 00:19:49,760
mitigations like create file right

617
00:19:49,760 --> 00:19:51,200
in junctions and stuff like that but

618
00:19:51,200 --> 00:19:52,480
like i don't know about the operation

619
00:19:52,480 --> 00:19:54,559
for set rename information file

620
00:19:54,559 --> 00:19:55,919
so i figure i'm like okay well you know

621
00:19:55,919 --> 00:19:58,160
i'll give this a shot on a sim link from

622
00:19:58,160 --> 00:20:01,520
james foreshaw's tools so if you look

623
00:20:01,520 --> 00:20:02,720
here

624
00:20:02,720 --> 00:20:06,080
you'll you'll see okay nv container.exe

625
00:20:06,080 --> 00:20:08,320
the set rename information file there's

626
00:20:08,320 --> 00:20:10,000
pid cool

627
00:20:10,000 --> 00:20:12,000
and we see that the path is getting

628
00:20:12,000 --> 00:20:13,760
called successfully

629
00:20:13,760 --> 00:20:15,360
and we're seeing the details the

630
00:20:15,360 --> 00:20:17,280
replacement exists true for that file

631
00:20:17,280 --> 00:20:19,200
name again

632
00:20:19,200 --> 00:20:22,000
okay so then

633
00:20:22,240 --> 00:20:24,080
so we know that the current dialog

634
00:20:24,080 --> 00:20:25,280
replaces

635
00:20:25,280 --> 00:20:27,360
or it replaces the current.log is

636
00:20:27,360 --> 00:20:28,880
replaced by the old.log

637
00:20:28,880 --> 00:20:30,960
and runs this user or runs the system

638
00:20:30,960 --> 00:20:32,799
and use rival directory right

639
00:20:32,799 --> 00:20:35,520
so the whole point here is you can see

640
00:20:35,520 --> 00:20:37,200
that

641
00:20:37,200 --> 00:20:39,760
the envy stream svc everyone has full

642
00:20:39,760 --> 00:20:40,400
access

643
00:20:40,400 --> 00:20:42,720
so we all have full access to that and

644
00:20:42,720 --> 00:20:44,320
then we see that everyone has full

645
00:20:44,320 --> 00:20:45,440
access to the

646
00:20:45,440 --> 00:20:47,280
nvidia corporation directory and the

647
00:20:47,280 --> 00:20:49,440
reason this matters is that to do a sim

648
00:20:49,440 --> 00:20:51,200
link you have to have

649
00:20:51,200 --> 00:20:54,320
um an empty the empty directory so

650
00:20:54,320 --> 00:20:57,039
i i wondered i was like okay if i can

651
00:20:57,039 --> 00:20:57,520
delete

652
00:20:57,520 --> 00:21:00,400
everything in nvstream.svc if i just

653
00:21:00,400 --> 00:21:01,679
delete that directory with everything in

654
00:21:01,679 --> 00:21:02,480
it

655
00:21:02,480 --> 00:21:04,400
and then create a sim link um to that

656
00:21:04,400 --> 00:21:06,799
file will it actually work so

657
00:21:06,799 --> 00:21:09,120
you can't you know you can't just create

658
00:21:09,120 --> 00:21:10,080
a sim link

659
00:21:10,080 --> 00:21:12,159
to a directory that has files in it the

660
00:21:12,159 --> 00:21:13,840
directory has to be empty

661
00:21:13,840 --> 00:21:15,039
so you have to be able to have

662
00:21:15,039 --> 00:21:16,880
permissions to delete everything out of

663
00:21:16,880 --> 00:21:17,600
it

664
00:21:17,600 --> 00:21:19,039
so there's some other interesting

665
00:21:19,039 --> 00:21:20,720
vulnerabilities that go into that but

666
00:21:20,720 --> 00:21:22,559
we know that we have access because of

667
00:21:22,559 --> 00:21:24,080
these two so

668
00:21:24,080 --> 00:21:26,400
mbstream svc full access so we delete

669
00:21:26,400 --> 00:21:27,679
mbstream svc

670
00:21:27,679 --> 00:21:31,200
so then we have this so then then we go

671
00:21:31,200 --> 00:21:32,400
ahead

672
00:21:32,400 --> 00:21:34,240
and we create a sim link and this was

673
00:21:34,240 --> 00:21:36,320
this is the syntax for that right

674
00:21:36,320 --> 00:21:39,840
so we're creating a sim link

675
00:21:40,159 --> 00:21:43,679
to the sas current.log to whatever we

676
00:21:43,679 --> 00:21:44,640
want which i did

677
00:21:44,640 --> 00:21:46,799
move.dll i don't know why i did that

678
00:21:46,799 --> 00:21:47,760
that's just what i

679
00:21:47,760 --> 00:21:51,200
ended up doing and um

680
00:21:51,200 --> 00:21:55,280
i created some link from ssas current

681
00:21:55,280 --> 00:21:57,520
dialog to move.yellow why is that i

682
00:21:57,520 --> 00:21:59,039
think my head okay well

683
00:21:59,039 --> 00:22:00,880
you know that it's writing that file so

684
00:22:00,880 --> 00:22:02,080
during procmond

685
00:22:02,080 --> 00:22:04,799
you know it's like if you restart

686
00:22:04,799 --> 00:22:06,880
service or reboot the box you know that

687
00:22:06,880 --> 00:22:09,039
for the example like a poc or proof

688
00:22:09,039 --> 00:22:10,559
concept right like

689
00:22:10,559 --> 00:22:13,200
if this file is seen so because the sim

690
00:22:13,200 --> 00:22:15,360
link's there

691
00:22:15,360 --> 00:22:18,240
the service goes okay this file is there

692
00:22:18,240 --> 00:22:20,240
but instead of doing the old dot log it

693
00:22:20,240 --> 00:22:20,960
goes

694
00:22:20,960 --> 00:22:24,159
move dll system 32 and that proves

695
00:22:24,159 --> 00:22:26,799
because in a basic user context it

696
00:22:26,799 --> 00:22:28,080
proves that

697
00:22:28,080 --> 00:22:32,880
i can create a file in system 32

698
00:22:32,880 --> 00:22:35,679
not as an admin and not a system so i'm

699
00:22:35,679 --> 00:22:38,480
a i'm a medium integrity normal user

700
00:22:38,480 --> 00:22:41,760
and um because of that i can i can

701
00:22:41,760 --> 00:22:43,360
well not because of that but because i'm

702
00:22:43,360 --> 00:22:44,799
a media integrity

703
00:22:44,799 --> 00:22:47,360
user and it followed my sim links on

704
00:22:47,360 --> 00:22:49,679
that service and it created a file

705
00:22:49,679 --> 00:22:52,320
in the system 32 directory then i know

706
00:22:52,320 --> 00:22:52,720
that

707
00:22:52,720 --> 00:22:56,000
i then have a privilege escalation

708
00:22:56,000 --> 00:22:57,600
because a basic user shouldn't be able

709
00:22:57,600 --> 00:22:59,679
to write a deal on system 32

710
00:22:59,679 --> 00:23:01,120
and understanding integrity levels is

711
00:23:01,120 --> 00:23:02,400
huge here like you can see it says

712
00:23:02,400 --> 00:23:03,600
system so like

713
00:23:03,600 --> 00:23:05,520
most most users at home if you do a who

714
00:23:05,520 --> 00:23:06,960
am i slash all

715
00:23:06,960 --> 00:23:10,320
you're going to be um a medium

716
00:23:10,320 --> 00:23:11,840
uh medium integrity with uh

717
00:23:11,840 --> 00:23:13,600
administrative permission administrator

718
00:23:13,600 --> 00:23:14,559
right

719
00:23:14,559 --> 00:23:16,559
and then when you like right click cmd

720
00:23:16,559 --> 00:23:17,760
and you run as admin

721
00:23:17,760 --> 00:23:19,520
you are then if you do have my slash all

722
00:23:19,520 --> 00:23:21,120
your high integrity

723
00:23:21,120 --> 00:23:22,799
administrator right and then and then

724
00:23:22,799 --> 00:23:24,159
you can do whatever you want you can get

725
00:23:24,159 --> 00:23:25,840
system easily with like ps exec whatever

726
00:23:25,840 --> 00:23:26,799
you want but

727
00:23:26,799 --> 00:23:28,640
a lot of people don't understand the

728
00:23:28,640 --> 00:23:29,840
integrity levels because they'll jump

729
00:23:29,840 --> 00:23:31,600
they'll drop in a box near immediately

730
00:23:31,600 --> 00:23:33,679
you know they'll be in high integrity

731
00:23:33,679 --> 00:23:36,080
um on an op or or system or whatever and

732
00:23:36,080 --> 00:23:37,440
they they especially like they're just

733
00:23:37,440 --> 00:23:38,400
throwing internal blue or something like

734
00:23:38,400 --> 00:23:40,000
that around

735
00:23:40,000 --> 00:23:42,720
um but so that that's the context here

736
00:23:42,720 --> 00:23:44,559
so medium integrity

737
00:23:44,559 --> 00:23:46,400
not an admin just basic user like on a

738
00:23:46,400 --> 00:23:48,559
company network and then

739
00:23:48,559 --> 00:23:52,000
you you figure it out um by

740
00:23:52,000 --> 00:23:53,760
creating some link restarting the

741
00:23:53,760 --> 00:23:54,960
service and again like you could

742
00:23:54,960 --> 00:23:56,159
probably work this backwards instead of

743
00:23:56,159 --> 00:23:57,279
doing what i did

744
00:23:57,279 --> 00:23:59,120
if someone actually like dove into the

745
00:23:59,120 --> 00:24:01,520
code and did some static analysis

746
00:24:01,520 --> 00:24:03,520
and then saw that the file was getting

747
00:24:03,520 --> 00:24:04,880
replaced

748
00:24:04,880 --> 00:24:06,960
by the other file and then both and then

749
00:24:06,960 --> 00:24:08,880
did you know i cackles or access checks

750
00:24:08,880 --> 00:24:10,400
or whatever and then saw the permissions

751
00:24:10,400 --> 00:24:11,440
they go okay

752
00:24:11,440 --> 00:24:13,360
and there's you know that's more you

753
00:24:13,360 --> 00:24:14,480
know high speed load drag because

754
00:24:14,480 --> 00:24:16,080
they're actually like man like

755
00:24:16,080 --> 00:24:17,919
i looked in the code and i saw this wall

756
00:24:17,919 --> 00:24:19,200
while i

757
00:24:19,200 --> 00:24:21,360
just ran procmond and watched what was

758
00:24:21,360 --> 00:24:22,400
happening

759
00:24:22,400 --> 00:24:25,520
and goofed around until i got something

760
00:24:25,520 --> 00:24:28,159
which is you know it's kind of cool but

761
00:24:28,159 --> 00:24:29,120
um

762
00:24:29,120 --> 00:24:33,840
these are my references and

763
00:24:34,080 --> 00:24:37,279
um the so google project zeros and block

764
00:24:37,279 --> 00:24:39,440
link testing you know he's amazing

765
00:24:39,440 --> 00:24:43,039
i've already talked about it um

766
00:24:43,039 --> 00:24:45,520
the cisternal suite obviously and oh i t

767
00:24:45,520 --> 00:24:46,799
man that's that's the guy who i was

768
00:24:46,799 --> 00:24:48,000
talking about where he had a great write

769
00:24:48,000 --> 00:24:48,559
up for

770
00:24:48,559 --> 00:24:51,600
uh escalation of privilege for net

771
00:24:51,600 --> 00:24:53,440
um and he actually goes like.net spy and

772
00:24:53,440 --> 00:24:54,799
actually like deep dives on that instead

773
00:24:54,799 --> 00:24:56,240
of like all the behavioral analysis that

774
00:24:56,240 --> 00:24:57,440
i did

775
00:24:57,440 --> 00:24:59,600
um now the youtube channel that's one

776
00:24:59,600 --> 00:25:01,840
from um blue hat where he

777
00:25:01,840 --> 00:25:04,159
talks about the mitigations of uh cyber

778
00:25:04,159 --> 00:25:06,240
security things like that

779
00:25:06,240 --> 00:25:09,120
and um the the next two links are the

780
00:25:09,120 --> 00:25:11,039
actual uh nvidia ones where

781
00:25:11,039 --> 00:25:13,520
they they show the cbe and they grade in

782
00:25:13,520 --> 00:25:16,640
the actual acknowledgements

783
00:25:16,640 --> 00:25:18,960
um yeah if you and if you enjoyed this

784
00:25:18,960 --> 00:25:20,159
talk you'd like to know more

785
00:25:20,159 --> 00:25:21,520
um you can check out my references on

786
00:25:21,520 --> 00:25:23,039
the site earlier if you have any

787
00:25:23,039 --> 00:25:24,400
questions

788
00:25:24,400 --> 00:25:27,679
um feel free to hit me up i you know i

789
00:25:27,679 --> 00:25:28,080
answer

790
00:25:28,080 --> 00:25:29,679
any message as long as it's not

791
00:25:29,679 --> 00:25:31,520
something like really creepy

792
00:25:31,520 --> 00:25:35,120
um but that's my twitter and my email

793
00:25:35,120 --> 00:25:37,200
and uh you know what what i like to end

794
00:25:37,200 --> 00:25:38,159
this talk on

795
00:25:38,159 --> 00:25:40,559
is that you know companies need to be

796
00:25:40,559 --> 00:25:42,080
aware of the stuff when they when they

797
00:25:42,080 --> 00:25:43,679
implement new software and they're

798
00:25:43,679 --> 00:25:46,480
in their company and when they upgrade

799
00:25:46,480 --> 00:25:47,360
or update things

800
00:25:47,360 --> 00:25:49,039
that it just it could open up more

801
00:25:49,039 --> 00:25:51,440
vulnerabilities more possibilities and

802
00:25:51,440 --> 00:25:53,200
like how dumb these logical

803
00:25:53,200 --> 00:25:54,480
vulnerabilities are and like

804
00:25:54,480 --> 00:25:56,880
someone does not have to be you know

805
00:25:56,880 --> 00:25:58,480
super hacker expert

806
00:25:58,480 --> 00:26:01,520
to to get a basic understanding of oh

807
00:26:01,520 --> 00:26:02,159
man like

808
00:26:02,159 --> 00:26:05,360
a deal is being being called a system in

809
00:26:05,360 --> 00:26:07,760
this user writable directory that like

810
00:26:07,760 --> 00:26:09,200
there's ghost yells everything like that

811
00:26:09,200 --> 00:26:10,240
and they're super simple they've been

812
00:26:10,240 --> 00:26:11,600
around a long time just like

813
00:26:11,600 --> 00:26:14,799
unquoted service pass um right where

814
00:26:14,799 --> 00:26:16,159
just things aren't quoted out in their

815
00:26:16,159 --> 00:26:18,320
spaces and people replace some of their

816
00:26:18,320 --> 00:26:21,679
user writable directories uh

817
00:26:21,679 --> 00:26:23,679
but like i said there's a lot of great

818
00:26:23,679 --> 00:26:26,480
researchers who

819
00:26:26,480 --> 00:26:27,840
provided their information on the

820
00:26:27,840 --> 00:26:31,120
internet and because of that i wanted to

821
00:26:31,120 --> 00:26:33,039
you know give my support hopefully and

822
00:26:33,039 --> 00:26:35,120
this motivates some people

823
00:26:35,120 --> 00:26:38,000
and uh gets them started on their path

824
00:26:38,000 --> 00:26:39,360
of finding vulnerabilities and getting

825
00:26:39,360 --> 00:26:40,159
more excited

826
00:26:40,159 --> 00:26:42,880
and getting cbes and hopefully my next

827
00:26:42,880 --> 00:26:44,559
talk will

828
00:26:44,559 --> 00:26:48,400
be more on drivers and some sick

829
00:26:48,400 --> 00:26:52,080
windows 10 lpes and eventually the next

830
00:26:52,080 --> 00:26:52,720
one will be

831
00:26:52,720 --> 00:26:56,400
rc's it's a dream uh one can hope

832
00:26:56,400 --> 00:26:58,880
uh i really hope you enjoyed this talk

833
00:26:58,880 --> 00:27:00,000
thank you for giving me the opportunity

834
00:27:00,000 --> 00:27:01,520
to speak

835
00:27:01,520 --> 00:27:05,039
and um again feel free to reach out to

836
00:27:05,039 --> 00:27:06,080
me

837
00:27:06,080 --> 00:27:09,760
all right thanks

