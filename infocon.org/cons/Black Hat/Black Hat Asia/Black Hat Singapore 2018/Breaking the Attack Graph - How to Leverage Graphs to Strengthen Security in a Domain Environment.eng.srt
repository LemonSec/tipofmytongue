1
00:00:00,000 --> 00:00:05,370
<font color="#CCCCCC">all right so</font><font color="#E5E5E5"> hi and thanks for</font><font color="#CCCCCC"> joining</font>

2
00:00:02,100 --> 00:00:07,949
my sock<font color="#E5E5E5"> in breaking the attack graph I'm</font>

3
00:00:05,370 --> 00:00:11,490
<font color="#CCCCCC">Rena Simcoe and</font><font color="#E5E5E5"> I am security researcher</font>

4
00:00:07,950 --> 00:00:13,620
at Microsoft<font color="#CCCCCC"> in</font><font color="#E5E5E5"> the ATA slash adder</font><font color="#CCCCCC"> ATT</font>

5
00:00:11,490 --> 00:00:15,870
group and<font color="#E5E5E5"> today I want to talk to you</font>

6
00:00:13,620 --> 00:00:17,970
about how defenders can leverage graphs

7
00:00:15,870 --> 00:00:21,630
<font color="#CCCCCC">in order</font><font color="#E5E5E5"> to create a more secure domain</font>

8
00:00:17,970 --> 00:00:23,490
<font color="#CCCCCC">environment</font><font color="#E5E5E5"> so let's</font><font color="#CCCCCC"> see our</font><font color="#E5E5E5"> agenda</font><font color="#CCCCCC"> for</font>

9
00:00:21,630 --> 00:00:25,650
this<font color="#E5E5E5"> talk I'll begin with discussing a</font>

10
00:00:23,490 --> 00:00:28,288
few attack tools<font color="#E5E5E5"> today that use graphs</font>

11
00:00:25,650 --> 00:00:30,000
and graph theory such as bloodhound<font color="#E5E5E5"> and</font>

12
00:00:28,289 --> 00:00:32,279
go fetch and then we'll see how

13
00:00:30,000 --> 00:00:34,559
<font color="#E5E5E5">defenders can be using graphs for</font>

14
00:00:32,279 --> 00:00:36,780
different security purposes<font color="#CCCCCC"> starting</font>

15
00:00:34,559 --> 00:00:38,578
from attack prevention<font color="#CCCCCC"> we'll see how we</font>

16
00:00:36,780 --> 00:00:40,739
can<font color="#CCCCCC"> reduce the attack</font><font color="#E5E5E5"> surface in our</font>

17
00:00:38,579 --> 00:00:42,840
environment to begin with<font color="#E5E5E5"> we'll see how</font>

18
00:00:40,739 --> 00:00:45,328
we can<font color="#E5E5E5"> detect various attacks which</font>

19
00:00:42,840 --> 00:00:46,770
might be performing reconnaissance<font color="#E5E5E5"> or</font>

20
00:00:45,329 --> 00:00:48,719
lateral movement activities in our

21
00:00:46,770 --> 00:00:50,579
environment<font color="#E5E5E5"> and finally</font><font color="#CCCCCC"> we'll</font><font color="#E5E5E5"> see how</font>

22
00:00:48,719 --> 00:00:54,570
they can<font color="#CCCCCC"> be very helpful for</font><font color="#E5E5E5"> attack</font>

23
00:00:50,579 --> 00:00:56,370
investigation as well so very<font color="#CCCCCC"> brief</font>

24
00:00:54,570 --> 00:00:58,559
overview<font color="#CCCCCC"> of</font><font color="#E5E5E5"> bloodhound</font>

25
00:00:56,370 --> 00:01:01,410
so bloodhound was a tool which was

26
00:00:58,559 --> 00:01:03,449
originally<font color="#CCCCCC"> created for</font><font color="#E5E5E5"> attackers but it</font>

27
00:01:01,410 --> 00:01:06,390
can be<font color="#E5E5E5"> very useful for defenders as well</font>

28
00:01:03,449 --> 00:01:08,670
<font color="#E5E5E5">and what it does is it constructs a</font>

29
00:01:06,390 --> 00:01:11,130
graph it shows<font color="#CCCCCC"> path which would lead</font>

30
00:01:08,670 --> 00:01:13,830
from less privileged domain accounts to

31
00:01:11,130 --> 00:01:15,509
domain admins<font color="#E5E5E5"> so it started by scanning</font>

32
00:01:13,830 --> 00:01:17,610
<font color="#E5E5E5">the environment to gather as much</font>

33
00:01:15,509 --> 00:01:20,369
information<font color="#E5E5E5"> as possible to</font><font color="#CCCCCC"> construct the</font>

34
00:01:17,610 --> 00:01:22,259
graph<font color="#E5E5E5"> so that</font><font color="#CCCCCC"> information includes</font><font color="#E5E5E5"> local</font>

35
00:01:20,369 --> 00:01:25,080
<font color="#E5E5E5">administrators and domain computers</font>

36
00:01:22,259 --> 00:01:27,600
domain group memberships<font color="#E5E5E5"> active sessions</font>

37
00:01:25,080 --> 00:01:30,750
on the machines<font color="#E5E5E5"> access control lists and</font>

38
00:01:27,600 --> 00:01:33,000
a few more and then it<font color="#E5E5E5"> uses all that</font>

39
00:01:30,750 --> 00:01:35,400
information in order<font color="#E5E5E5"> to construct</font><font color="#CCCCCC"> that</font>

40
00:01:33,000 --> 00:01:37,409
graph which reveals paths that lead<font color="#CCCCCC"> from</font>

41
00:01:35,400 --> 00:01:39,659
less privileged domain accounts to

42
00:01:37,409 --> 00:01:41,520
domain admins so if you're<font color="#E5E5E5"> not familiar</font>

43
00:01:39,659 --> 00:01:42,840
<font color="#E5E5E5">with this tool I definitely recommend</font>

44
00:01:41,520 --> 00:01:46,920
that<font color="#E5E5E5"> you check it out and see</font><font color="#CCCCCC"> all the</font>

45
00:01:42,840 --> 00:01:49,530
<font color="#E5E5E5">features that it</font><font color="#CCCCCC"> has another cool tool</font>

46
00:01:46,920 --> 00:01:52,710
is go fetch what go fetch does is it

47
00:01:49,530 --> 00:01:54,570
takes as an input<font color="#CCCCCC"> path generated by</font><font color="#E5E5E5"> Vlad</font>

48
00:01:52,710 --> 00:01:57,149
hound<font color="#E5E5E5"> and it automates the entire</font>

49
00:01:54,570 --> 00:01:59,699
lateral movement process so it moves

50
00:01:57,149 --> 00:02:02,460
from one<font color="#CCCCCC"> node to the next extracting the</font>

51
00:01:59,700 --> 00:02:04,920
credentials of the<font color="#E5E5E5"> next user and so on</font>

52
00:02:02,460 --> 00:02:07,139
until reaching the<font color="#E5E5E5"> final node of</font><font color="#CCCCCC"> path</font>

53
00:02:04,920 --> 00:02:09,810
where it extracts the credentials of the

54
00:02:07,140 --> 00:02:12,450
<font color="#E5E5E5">domain admin and returns them to the</font>

55
00:02:09,810 --> 00:02:13,970
attacker<font color="#E5E5E5"> so as you can see once you have</font>

56
00:02:12,450 --> 00:02:16,220
the entire<font color="#E5E5E5"> process</font><font color="#CCCCCC"> autumn a</font>

57
00:02:13,970 --> 00:02:18,590
<font color="#E5E5E5">attackers don't need to necessarily have</font>

58
00:02:16,220 --> 00:02:20,450
<font color="#E5E5E5">the shortest</font><font color="#CCCCCC"> path possible any path</font>

59
00:02:18,590 --> 00:02:24,710
which would lead them to<font color="#E5E5E5"> domain admin</font>

60
00:02:20,450 --> 00:02:26,959
credentials is good<font color="#E5E5E5"> enough</font><font color="#CCCCCC"> a short</font>

61
00:02:24,710 --> 00:02:29,420
<font color="#E5E5E5">comparison between what attackers are</font>

62
00:02:26,960 --> 00:02:29,840
doing<font color="#E5E5E5"> today versus what defenders can be</font>

63
00:02:29,420 --> 00:02:32,000
doing

64
00:02:29,840 --> 00:02:33,830
so when attackers are<font color="#E5E5E5"> scanning the</font>

65
00:02:32,000 --> 00:02:35,960
network<font color="#E5E5E5"> to gather the</font><font color="#CCCCCC"> information</font>

66
00:02:33,830 --> 00:02:37,580
they're using limited privileges<font color="#CCCCCC"> they're</font>

67
00:02:35,960 --> 00:02:39,740
<font color="#E5E5E5">using that initial account that they</font>

68
00:02:37,580 --> 00:02:41,540
were<font color="#CCCCCC"> able to compromise since the entire</font>

69
00:02:39,740 --> 00:02:43,240
purpose<font color="#E5E5E5"> is to find a path that would</font>

70
00:02:41,540 --> 00:02:45,560
lead<font color="#CCCCCC"> them to</font><font color="#E5E5E5"> high</font><font color="#CCCCCC"> privileged account</font>

71
00:02:43,240 --> 00:02:48,410
<font color="#E5E5E5">defenders however can use any</font>

72
00:02:45,560 --> 00:02:50,750
permissions that<font color="#CCCCCC"> they want now as a</font>

73
00:02:48,410 --> 00:02:53,000
result<font color="#E5E5E5"> attackers have limited access to</font>

74
00:02:50,750 --> 00:02:55,370
<font color="#E5E5E5">network resources so this is something</font>

75
00:02:53,000 --> 00:02:57,830
<font color="#CCCCCC">that depends on the</font><font color="#E5E5E5"> configuration and</font>

76
00:02:55,370 --> 00:02:59,780
hardening of the environment since<font color="#E5E5E5"> a lot</font>

77
00:02:57,830 --> 00:03:01,310
<font color="#CCCCCC">of the data gathering methods require</font>

78
00:02:59,780 --> 00:03:03,950
that you have<font color="#CCCCCC"> administrative privileges</font>

79
00:03:01,310 --> 00:03:05,840
<font color="#E5E5E5">on</font><font color="#CCCCCC"> the target machine</font><font color="#E5E5E5"> so attackers would</font>

80
00:03:03,950 --> 00:03:08,720
not be able<font color="#E5E5E5"> to retrieve</font><font color="#CCCCCC"> the information</font>

81
00:03:05,840 --> 00:03:11,890
from<font color="#E5E5E5"> all the computers again defenders</font>

82
00:03:08,720 --> 00:03:14,750
can access any resources<font color="#CCCCCC"> that they want</font>

83
00:03:11,890 --> 00:03:17,000
now even though attackers have limited

84
00:03:14,750 --> 00:03:18,890
access they're still able<font color="#CCCCCC"> to construct a</font>

85
00:03:17,000 --> 00:03:20,989
graph based on the information<font color="#E5E5E5"> that they</font>

86
00:03:18,890 --> 00:03:24,019
were<font color="#CCCCCC"> able to retrieve</font><font color="#E5E5E5"> so that graph</font>

87
00:03:20,989 --> 00:03:26,900
would<font color="#E5E5E5"> be a partial graph the feathers</font>

88
00:03:24,020 --> 00:03:29,420
however can create full graphs which

89
00:03:26,900 --> 00:03:32,600
contains<font color="#E5E5E5"> any date data and network</font>

90
00:03:29,420 --> 00:03:34,760
<font color="#CCCCCC">resources that they want even though</font>

91
00:03:32,600 --> 00:03:36,890
<font color="#E5E5E5">it's a</font><font color="#CCCCCC"> KERS</font><font color="#E5E5E5"> are only working with</font><font color="#CCCCCC"> a</font>

92
00:03:34,760 --> 00:03:38,810
partial<font color="#E5E5E5"> graph</font><font color="#CCCCCC"> they we just saw with the</font>

93
00:03:36,890 --> 00:03:41,149
<font color="#E5E5E5">bloodhound how they can use that graph</font>

94
00:03:38,810 --> 00:03:43,489
to<font color="#CCCCCC"> gain very valuable insight into our</font>

95
00:03:41,150 --> 00:03:44,959
environment<font color="#E5E5E5"> and find complex attack</font>

96
00:03:43,489 --> 00:03:46,880
paths<font color="#CCCCCC"> which would lead them to</font>

97
00:03:44,959 --> 00:03:47,920
<font color="#E5E5E5">compromise one</font><font color="#CCCCCC"> of our domain</font>

98
00:03:46,880 --> 00:03:50,540
administrators

99
00:03:47,920 --> 00:03:52,940
well if attackers are using those

100
00:03:50,540 --> 00:03:54,920
limited permissions and<font color="#E5E5E5"> data sources and</font>

101
00:03:52,940 --> 00:03:57,200
<font color="#E5E5E5">are still able to leverage graphs to</font>

102
00:03:54,920 --> 00:03:59,600
their benefit<font color="#E5E5E5"> the question is what can</font>

103
00:03:57,200 --> 00:04:01,820
<font color="#E5E5E5">we as defenders do with our unlimited</font>

104
00:03:59,600 --> 00:04:03,980
permissions and data sources<font color="#E5E5E5"> and</font><font color="#CCCCCC"> use</font>

105
00:04:01,820 --> 00:04:05,690
graphs to defend our environment<font color="#E5E5E5"> so this</font>

106
00:04:03,980 --> 00:04:09,410
<font color="#E5E5E5">is exactly what I'll</font><font color="#CCCCCC"> be covering in this</font>

107
00:04:05,690 --> 00:04:12,050
session<font color="#E5E5E5"> today</font><font color="#CCCCCC"> so how</font><font color="#E5E5E5"> can we use graphs</font>

108
00:04:09,410 --> 00:04:13,850
<font color="#E5E5E5">well first of all we can see</font><font color="#CCCCCC"> how we can</font>

109
00:04:12,050 --> 00:04:16,400
<font color="#CCCCCC">use them to</font><font color="#E5E5E5"> prevent attacks</font><font color="#CCCCCC"> we'll see</font>

110
00:04:13,850 --> 00:04:18,320
how we can reduce the<font color="#CCCCCC"> attack surface</font><font color="#E5E5E5"> how</font>

111
00:04:16,399 --> 00:04:20,029
we can detect<font color="#E5E5E5"> the most vulnerable nodes</font>

112
00:04:18,320 --> 00:04:22,490
that we have in our environment<font color="#E5E5E5"> which</font>

113
00:04:20,029 --> 00:04:24,080
<font color="#CCCCCC">can be either</font><font color="#E5E5E5"> users and computers and</font>

114
00:04:22,490 --> 00:04:25,030
then we'll see<font color="#E5E5E5"> how we can disconnect</font>

115
00:04:24,080 --> 00:04:28,270
<font color="#E5E5E5">them from the</font>

116
00:04:25,030 --> 00:04:30,099
check<font color="#E5E5E5"> that next we'll see how</font><font color="#CCCCCC"> we can use</font>

117
00:04:28,270 --> 00:04:32,740
them for attack detection<font color="#E5E5E5"> see how to</font>

118
00:04:30,100 --> 00:04:35,040
study<font color="#CCCCCC"> love and patterns of users and</font>

119
00:04:32,740 --> 00:04:36,940
detect anomalies which might indicate

120
00:04:35,040 --> 00:04:40,450
reconnaissance or lateral movement

121
00:04:36,940 --> 00:04:42,250
activities<font color="#E5E5E5"> and finally</font><font color="#CCCCCC"> very briefly</font>

122
00:04:40,450 --> 00:04:44,590
we'll see how they<font color="#CCCCCC"> can</font><font color="#E5E5E5"> help us with</font>

123
00:04:42,250 --> 00:04:46,990
<font color="#E5E5E5">attack investigation as well we'll see</font>

124
00:04:44,590 --> 00:04:49,090
how it can<font color="#E5E5E5"> help us gain insights into</font>

125
00:04:46,990 --> 00:04:51,370
<font color="#E5E5E5">the attack</font><font color="#CCCCCC"> path maybe understand what</font>

126
00:04:49,090 --> 00:04:53,500
the attack source was and even find

127
00:04:51,370 --> 00:04:57,070
additional<font color="#E5E5E5"> accounts which may have been</font>

128
00:04:53,500 --> 00:04:59,110
compromised<font color="#E5E5E5"> during the attack right</font>

129
00:04:57,070 --> 00:05:01,270
before diving into<font color="#E5E5E5"> every one</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the</font>

130
00:04:59,110 --> 00:05:03,180
<font color="#E5E5E5">stages that we just seen let's see which</font>

131
00:05:01,270 --> 00:05:05,620
data sources we'll be using

132
00:05:03,180 --> 00:05:07,450
first thing<font color="#E5E5E5"> that we need are the domain</font>

133
00:05:05,620 --> 00:05:09,340
group memberships we need to understand

134
00:05:07,450 --> 00:05:11,770
who<font color="#CCCCCC"> are the</font><font color="#E5E5E5"> high privileged accounts in</font>

135
00:05:09,340 --> 00:05:13,929
our environment<font color="#E5E5E5"> those are the accounts</font>

136
00:05:11,770 --> 00:05:15,430
that are<font color="#E5E5E5"> members of those high</font>

137
00:05:13,930 --> 00:05:18,430
<font color="#CCCCCC">privileges built-in groups</font><font color="#E5E5E5"> in Active</font>

138
00:05:15,430 --> 00:05:19,930
Directory<font color="#CCCCCC"> then we need</font><font color="#E5E5E5"> to get the local</font>

139
00:05:18,430 --> 00:05:22,390
<font color="#E5E5E5">group memberships on the domain</font>

140
00:05:19,930 --> 00:05:24,250
computers in order<font color="#CCCCCC"> to understand who has</font>

141
00:05:22,390 --> 00:05:26,950
administrative privileges on every

142
00:05:24,250 --> 00:05:28,840
domain machine and last<font color="#E5E5E5"> and most</font>

143
00:05:26,950 --> 00:05:31,120
important piece<font color="#CCCCCC"> of the puzzle would be</font>

144
00:05:28,840 --> 00:05:33,669
the existing credentials<font color="#E5E5E5"> on every domain</font>

145
00:05:31,120 --> 00:05:36,220
machine so when I say credentials I mean

146
00:05:33,669 --> 00:05:39,729
either the ntlm hash of the user<font color="#E5E5E5"> or the</font>

147
00:05:36,220 --> 00:05:42,370
Kerberos ticket<font color="#E5E5E5"> as defenders we can get</font>

148
00:05:39,729 --> 00:05:44,530
that information<font color="#CCCCCC"> either from</font><font color="#E5E5E5"> login</font>

149
00:05:42,370 --> 00:05:47,229
<font color="#E5E5E5">events which are usually</font><font color="#CCCCCC"> collected to a</font>

150
00:05:44,530 --> 00:05:48,760
sim in most environments<font color="#E5E5E5"> or from network</font>

151
00:05:47,229 --> 00:05:51,460
traffic that<font color="#E5E5E5"> comes to the domain</font>

152
00:05:48,760 --> 00:05:53,590
controller now for<font color="#E5E5E5"> most organizations it</font>

153
00:05:51,460 --> 00:05:55,570
would be probably<font color="#CCCCCC"> easier to use login</font>

154
00:05:53,590 --> 00:05:57,880
events however I already had the

155
00:05:55,570 --> 00:05:59,800
Kerberos traffic parsed<font color="#E5E5E5"> so I</font><font color="#CCCCCC"> use</font><font color="#E5E5E5"> the</font>

156
00:05:57,880 --> 00:06:01,990
<font color="#CCCCCC">combination of the two</font><font color="#E5E5E5"> so what I did is</font>

157
00:05:59,800 --> 00:06:04,900
in order<font color="#E5E5E5"> to cover the Kerberos I think</font>

158
00:06:01,990 --> 00:06:07,090
occasions<font color="#CCCCCC"> I looked into successful a</font><font color="#E5E5E5"> s</font>

159
00:06:04,900 --> 00:06:09,700
and TGS request to the domain controller

160
00:06:07,090 --> 00:06:12,190
<font color="#E5E5E5">so if there was</font><font color="#CCCCCC"> a computer</font><font color="#E5E5E5"> from</font><font color="#CCCCCC"> which</font>

161
00:06:09,700 --> 00:06:14,440
there was a successful<font color="#CCCCCC"> ASO</font><font color="#E5E5E5"> TGS request</font>

162
00:06:12,190 --> 00:06:16,870
<font color="#E5E5E5">it means that that computer now holds</font>

163
00:06:14,440 --> 00:06:19,539
<font color="#E5E5E5">the credentials of the</font><font color="#CCCCCC"> user</font><font color="#E5E5E5"> so that</font>

164
00:06:16,870 --> 00:06:21,490
covers<font color="#CCCCCC"> kevro site</font><font color="#E5E5E5"> indications since the</font>

165
00:06:19,539 --> 00:06:24,250
ntlm traffic is encrypted

166
00:06:21,490 --> 00:06:26,320
I used a dedicated event which can be

167
00:06:24,250 --> 00:06:28,630
located<font color="#CCCCCC"> on the domain controller which</font>

168
00:06:26,320 --> 00:06:30,370
states both the source<font color="#E5E5E5"> computer the</font>

169
00:06:28,630 --> 00:06:32,800
target computer<font color="#E5E5E5"> and also the</font>

170
00:06:30,370 --> 00:06:35,500
<font color="#E5E5E5">authenticated</font><font color="#CCCCCC"> user</font><font color="#E5E5E5"> so by using the</font>

171
00:06:32,800 --> 00:06:37,610
domain controller as the main source<font color="#E5E5E5"> of</font>

172
00:06:35,500 --> 00:06:39,229
information<font color="#CCCCCC"> I was able to map</font>

173
00:06:37,610 --> 00:06:40,550
all the<font color="#E5E5E5"> credentials</font><font color="#CCCCCC"> that are present on</font>

174
00:06:39,229 --> 00:06:42,979
<font color="#E5E5E5">the environment the good thing</font><font color="#CCCCCC"> about</font>

175
00:06:40,550 --> 00:06:44,719
this is that<font color="#CCCCCC"> we</font><font color="#E5E5E5"> don't need to query all</font>

176
00:06:42,979 --> 00:06:46,758
the machines to get the active sessions

177
00:06:44,719 --> 00:06:48,949
all the time<font color="#E5E5E5"> since it's something that</font>

178
00:06:46,759 --> 00:06:51,080
is constantly<font color="#CCCCCC"> changing and we're also</font>

179
00:06:48,949 --> 00:06:53,120
not creating any additional<font color="#E5E5E5"> load on</font><font color="#CCCCCC"> our</font>

180
00:06:51,080 --> 00:06:55,159
network<font color="#E5E5E5"> simply</font><font color="#CCCCCC"> using the</font><font color="#E5E5E5"> domain</font>

181
00:06:53,120 --> 00:06:59,000
controller in<font color="#CCCCCC"> order to map all the</font>

182
00:06:55,159 --> 00:07:00,979
credentials<font color="#E5E5E5"> all right now we know which</font>

183
00:06:59,000 --> 00:07:02,870
data sources we're using let's see how

184
00:07:00,979 --> 00:07:05,330
we can<font color="#CCCCCC"> use this data let's start with</font>

185
00:07:02,870 --> 00:07:07,340
the tag prevention so here<font color="#E5E5E5"> our goal</font>

186
00:07:05,330 --> 00:07:09,139
would be<font color="#E5E5E5"> to</font><font color="#CCCCCC"> reduce</font><font color="#E5E5E5"> the attack</font><font color="#CCCCCC"> surface in</font>

187
00:07:07,340 --> 00:07:11,419
the environment<font color="#E5E5E5"> we'll see how we can</font>

188
00:07:09,139 --> 00:07:13,250
discover the most vulnerable nodes that

189
00:07:11,419 --> 00:07:14,539
<font color="#E5E5E5">we have in our network and then we'll</font>

190
00:07:13,250 --> 00:07:16,610
see different<font color="#CCCCCC"> ways</font><font color="#E5E5E5"> in which</font><font color="#CCCCCC"> we can</font>

191
00:07:14,539 --> 00:07:19,699
<font color="#E5E5E5">disconnect them from as many attack</font>

192
00:07:16,610 --> 00:07:22,279
paths as we can<font color="#CCCCCC"> the</font><font color="#E5E5E5"> biggest problem with</font>

193
00:07:19,699 --> 00:07:24,590
this<font color="#CCCCCC"> approach is</font><font color="#E5E5E5"> that computing all the</font>

194
00:07:22,279 --> 00:07:26,750
attack paths is a hard task<font color="#E5E5E5"> so if you</font>

195
00:07:24,590 --> 00:07:29,090
have a large<font color="#CCCCCC"> environment</font><font color="#E5E5E5"> it will require</font>

196
00:07:26,750 --> 00:07:30,919
a<font color="#E5E5E5"> lot of running time</font><font color="#CCCCCC"> resources</font><font color="#E5E5E5"> and also</font>

197
00:07:29,090 --> 00:07:33,138
<font color="#E5E5E5">the attack graph is constantly changing</font>

198
00:07:30,919 --> 00:07:35,359
you<font color="#CCCCCC"> have constantly</font><font color="#E5E5E5"> new sessions added</font>

199
00:07:33,139 --> 00:07:37,129
or removed<font color="#E5E5E5"> from the</font><font color="#CCCCCC"> environment</font><font color="#E5E5E5"> so the</font>

200
00:07:35,360 --> 00:07:39,199
solution would be<font color="#E5E5E5"> that</font><font color="#CCCCCC"> we would not be</font>

201
00:07:37,129 --> 00:07:41,839
computing<font color="#E5E5E5"> the entire attack graph any</font>

202
00:07:39,199 --> 00:07:43,969
stage will only be computing<font color="#E5E5E5"> the last</font>

203
00:07:41,839 --> 00:07:46,219
layers on the graph and<font color="#CCCCCC"> will try to</font>

204
00:07:43,969 --> 00:07:48,169
disconnect<font color="#CCCCCC"> one of the last edges in</font>

205
00:07:46,219 --> 00:07:51,560
those layers<font color="#E5E5E5"> let's see what I mean by</font>

206
00:07:48,169 --> 00:07:54,020
that<font color="#E5E5E5"> here you can</font><font color="#CCCCCC"> see an example</font><font color="#E5E5E5"> of a</font>

207
00:07:51,560 --> 00:07:56,599
graph<font color="#E5E5E5"> generated by bloodhound</font><font color="#CCCCCC"> you can</font>

208
00:07:54,020 --> 00:07:58,609
see different<font color="#E5E5E5"> paths which</font><font color="#CCCCCC"> lead from</font><font color="#E5E5E5"> less</font>

209
00:07:56,599 --> 00:08:01,339
privileged domain accounts on the left

210
00:07:58,610 --> 00:08:03,440
<font color="#E5E5E5">to the main admins on the right now</font>

211
00:08:01,339 --> 00:08:06,020
there<font color="#E5E5E5"> can be different types of paths</font>

212
00:08:03,440 --> 00:08:06,830
however most of them would end in a

213
00:08:06,020 --> 00:08:09,139
similar pattern

214
00:08:06,830 --> 00:08:11,419
the most common ending of the path would

215
00:08:09,139 --> 00:08:14,120
<font color="#E5E5E5">be that you would have a less privileged</font>

216
00:08:11,419 --> 00:08:16,789
domain account which has<font color="#E5E5E5"> administrative</font>

217
00:08:14,120 --> 00:08:19,969
privileges on a<font color="#E5E5E5"> machine with a session</font>

218
00:08:16,789 --> 00:08:21,378
of a domain admin<font color="#E5E5E5"> in that case if</font><font color="#CCCCCC"> that</font>

219
00:08:19,969 --> 00:08:23,300
less<font color="#CCCCCC"> privileged</font><font color="#E5E5E5"> domain account is</font>

220
00:08:21,379 --> 00:08:25,699
compromised it can<font color="#E5E5E5"> be used to connect to</font>

221
00:08:23,300 --> 00:08:27,159
<font color="#CCCCCC">that vulnerable machine</font><font color="#E5E5E5"> and extract the</font>

222
00:08:25,699 --> 00:08:30,620
credentials<font color="#E5E5E5"> of</font><font color="#CCCCCC"> the domain administrator</font>

223
00:08:27,159 --> 00:08:34,010
<font color="#E5E5E5">so I will try to do is</font><font color="#CCCCCC"> we'll focus on</font>

224
00:08:30,620 --> 00:08:36,140
the last<font color="#E5E5E5"> part of the graph only on the</font>

225
00:08:34,010 --> 00:08:38,809
last layers<font color="#E5E5E5"> and we'll try to disconnect</font>

226
00:08:36,140 --> 00:08:41,479
<font color="#CCCCCC">as many</font><font color="#E5E5E5"> edges as we can that intersect</font>

227
00:08:38,809 --> 00:08:43,669
with<font color="#CCCCCC"> one of the</font><font color="#E5E5E5"> vertical red lines so</font>

228
00:08:41,479 --> 00:08:45,829
notice that<font color="#E5E5E5"> by</font><font color="#CCCCCC"> removing those edges</font>

229
00:08:43,669 --> 00:08:47,720
we'll also be affecting<font color="#CCCCCC"> paths of longer</font>

230
00:08:45,829 --> 00:08:49,609
<font color="#CCCCCC">length</font><font color="#E5E5E5"> as well since those would</font>

231
00:08:47,720 --> 00:08:51,640
eventually merge into one<font color="#E5E5E5"> of the</font>

232
00:08:49,610 --> 00:08:54,260
shortest

233
00:08:51,640 --> 00:08:56,600
<font color="#E5E5E5">okay so our goal is to find the notes</font>

234
00:08:54,260 --> 00:08:59,720
that<font color="#E5E5E5"> are part of the most</font><font color="#CCCCCC"> attacked path</font>

235
00:08:56,600 --> 00:09:01,610
<font color="#E5E5E5">so let's see a definition</font><font color="#CCCCCC"> a vulnerable</font>

236
00:08:59,720 --> 00:09:03,590
node is a node which<font color="#CCCCCC"> has a high</font>

237
00:09:01,610 --> 00:09:05,540
probability of<font color="#E5E5E5"> being compromised during</font>

238
00:09:03,590 --> 00:09:09,560
<font color="#E5E5E5">an attack and it can be either</font><font color="#CCCCCC"> a</font>

239
00:09:05,540 --> 00:09:11,270
<font color="#E5E5E5">computer or a user node a vulnerable</font>

240
00:09:09,560 --> 00:09:13,520
computer is a<font color="#E5E5E5"> computer which has</font><font color="#CCCCCC"> a</font>

241
00:09:11,270 --> 00:09:15,980
session<font color="#E5E5E5"> of at least one high privileged</font>

242
00:09:13,520 --> 00:09:17,930
account<font color="#E5E5E5"> and it has many low privileged</font>

243
00:09:15,980 --> 00:09:20,480
accounts that have<font color="#E5E5E5"> local admin</font>

244
00:09:17,930 --> 00:09:22,880
privileges at this<font color="#E5E5E5"> machine so this means</font>

245
00:09:20,480 --> 00:09:24,800
<font color="#E5E5E5">that if any one of those low privileged</font>

246
00:09:22,880 --> 00:09:26,390
<font color="#E5E5E5">accounts is compromised it can be used</font>

247
00:09:24,800 --> 00:09:28,339
to connect to<font color="#E5E5E5"> the vulnerable machine and</font>

248
00:09:26,390 --> 00:09:31,510
extract the credentials of<font color="#E5E5E5"> the domain</font>

249
00:09:28,340 --> 00:09:34,220
admin so if a computer<font color="#E5E5E5"> has more</font>

250
00:09:31,510 --> 00:09:35,960
<font color="#E5E5E5">administrative sessions and more low</font>

251
00:09:34,220 --> 00:09:37,820
privileged accounts that have<font color="#CCCCCC"> local</font>

252
00:09:35,960 --> 00:09:41,960
admin privileges we would consider the

253
00:09:37,820 --> 00:09:44,000
computer to be<font color="#E5E5E5"> more vulnerable second</font>

254
00:09:41,960 --> 00:09:47,000
type of vulnerable node is the<font color="#E5E5E5"> user node</font>

255
00:09:44,000 --> 00:09:49,040
so this is a node that<font color="#CCCCCC"> represents a user</font>

256
00:09:47,000 --> 00:09:51,170
<font color="#E5E5E5">that has high privileges in the</font>

257
00:09:49,040 --> 00:09:53,900
environment<font color="#E5E5E5"> and it has a session on at</font>

258
00:09:51,170 --> 00:09:56,120
<font color="#E5E5E5">least one vulnerable computer so if the</font>

259
00:09:53,900 --> 00:09:58,160
user has more sessions on more

260
00:09:56,120 --> 00:09:59,870
vulnerable computers will consider the

261
00:09:58,160 --> 00:10:04,189
user as more vulnerable<font color="#E5E5E5"> in the</font>

262
00:09:59,870 --> 00:10:05,870
environment something<font color="#CCCCCC"> which is important</font>

263
00:10:04,190 --> 00:10:07,850
<font color="#E5E5E5">to state is that the status of a node</font>

264
00:10:05,870 --> 00:10:09,410
can change over<font color="#E5E5E5"> time so if a</font><font color="#CCCCCC"> node is</font>

265
00:10:07,850 --> 00:10:11,240
considered to<font color="#CCCCCC"> be vulnerable</font><font color="#E5E5E5"> today it</font>

266
00:10:09,410 --> 00:10:12,770
will<font color="#E5E5E5"> not be necessary</font><font color="#CCCCCC"> for being</font>

267
00:10:11,240 --> 00:10:14,720
considered vulnerable tomorrow as well

268
00:10:12,770 --> 00:10:16,790
so<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is something which depends</font><font color="#E5E5E5"> on</font>

269
00:10:14,720 --> 00:10:19,070
<font color="#CCCCCC">the user behavior</font><font color="#E5E5E5"> every</font><font color="#CCCCCC"> day user</font>

270
00:10:16,790 --> 00:10:21,469
connects different<font color="#CCCCCC"> computers and also on</font>

271
00:10:19,070 --> 00:10:24,020
computer configurations<font color="#CCCCCC"> so a</font><font color="#E5E5E5"> user can</font>

272
00:10:21,470 --> 00:10:26,300
constantly<font color="#E5E5E5"> add or remove local admins</font>

273
00:10:24,020 --> 00:10:29,030
from the machine so in order to<font color="#E5E5E5"> find the</font>

274
00:10:26,300 --> 00:10:30,949
nodes<font color="#CCCCCC"> that pose the largest risk</font><font color="#E5E5E5"> in our</font>

275
00:10:29,030 --> 00:10:33,439
environment<font color="#E5E5E5"> we need to track the status</font>

276
00:10:30,950 --> 00:10:35,600
<font color="#E5E5E5">of the nodes</font><font color="#CCCCCC"> over time</font><font color="#E5E5E5"> so since we're</font>

277
00:10:33,440 --> 00:10:37,580
collecting<font color="#E5E5E5"> the sessions and we know the</font>

278
00:10:35,600 --> 00:10:39,770
local<font color="#E5E5E5"> admins on the computer we can</font>

279
00:10:37,580 --> 00:10:41,450
compute what percentage of<font color="#E5E5E5"> the time is</font>

280
00:10:39,770 --> 00:10:43,880
<font color="#E5E5E5">the node actually considered vulnerable</font>

281
00:10:41,450 --> 00:10:46,040
<font color="#E5E5E5">that would allow us to detect whether</font>

282
00:10:43,880 --> 00:10:47,960
we're dealing<font color="#CCCCCC"> with</font><font color="#E5E5E5"> a constant issue in</font>

283
00:10:46,040 --> 00:10:50,180
the environment thus node is constantly

284
00:10:47,960 --> 00:10:52,520
part of many attack paths in the attack

285
00:10:50,180 --> 00:10:55,640
graph<font color="#CCCCCC"> or just one-time occurrence that</font>

286
00:10:52,520 --> 00:10:57,260
<font color="#E5E5E5">we might not need to do anything with so</font>

287
00:10:55,640 --> 00:10:59,689
by computing this and adding the

288
00:10:57,260 --> 00:11:01,370
criteria from<font color="#E5E5E5"> the previous slide we</font><font color="#CCCCCC"> can</font>

289
00:10:59,690 --> 00:11:03,050
create<font color="#E5E5E5"> a ranking of the nodes by</font>

290
00:11:01,370 --> 00:11:05,360
vulnerabilities to<font color="#E5E5E5"> detect</font>

291
00:11:03,050 --> 00:11:08,060
which are the most problematic<font color="#CCCCCC"> user and</font>

292
00:11:05,360 --> 00:11:10,160
computer nodes<font color="#E5E5E5"> in our environment once</font>

293
00:11:08,060 --> 00:11:12,319
we found those we need<font color="#E5E5E5"> to secure them</font>

294
00:11:10,160 --> 00:11:14,839
somehow<font color="#E5E5E5"> how can we secure those</font><font color="#CCCCCC"> nodes</font>

295
00:11:12,320 --> 00:11:17,270
<font color="#E5E5E5">well we can either</font><font color="#CCCCCC"> use the</font><font color="#E5E5E5"> ception</font>

296
00:11:14,840 --> 00:11:18,800
<font color="#E5E5E5">we can plant traps in our environment</font>

297
00:11:17,270 --> 00:11:20,840
and hope that the attacker<font color="#E5E5E5"> would fall</font>

298
00:11:18,800 --> 00:11:22,849
<font color="#E5E5E5">into one of those so if you want to hear</font>

299
00:11:20,840 --> 00:11:24,890
<font color="#E5E5E5">more about this</font><font color="#CCCCCC"> I recommend</font><font color="#E5E5E5"> that you</font>

300
00:11:22,850 --> 00:11:27,190
<font color="#E5E5E5">check</font><font color="#CCCCCC"> out Tom</font><font color="#E5E5E5"> sell a stock from Def Con</font>

301
00:11:24,890 --> 00:11:30,140
last<font color="#E5E5E5"> year where</font><font color="#CCCCCC"> he explained this</font>

302
00:11:27,190 --> 00:11:32,300
basically what what they do is they

303
00:11:30,140 --> 00:11:34,189
create<font color="#CCCCCC"> new attack</font><font color="#E5E5E5"> paths and hope that</font>

304
00:11:32,300 --> 00:11:36,640
the attacker would choose one<font color="#CCCCCC"> of</font><font color="#E5E5E5"> those</font>

305
00:11:34,190 --> 00:11:39,170
<font color="#E5E5E5">and then they'll be able to detect them</font>

306
00:11:36,640 --> 00:11:40,939
another thing<font color="#E5E5E5"> that we</font><font color="#CCCCCC"> can do is this can</font>

307
00:11:39,170 --> 00:11:43,189
simply disconnect the vulnerable nodes

308
00:11:40,940 --> 00:11:46,010
from<font color="#CCCCCC"> the attack graph so in</font><font color="#E5E5E5"> both methods</font>

309
00:11:43,190 --> 00:11:48,140
<font color="#CCCCCC">we are changing the attack graph in one</font>

310
00:11:46,010 --> 00:11:50,030
of them were simply<font color="#E5E5E5"> adding new attack</font>

311
00:11:48,140 --> 00:11:52,010
<font color="#CCCCCC">paths and in the second one we're</font>

312
00:11:50,030 --> 00:11:54,500
removing<font color="#E5E5E5"> existing</font><font color="#CCCCCC"> paths</font><font color="#E5E5E5"> so I'll be</font>

313
00:11:52,010 --> 00:11:59,090
focusing on the<font color="#E5E5E5"> next</font><font color="#CCCCCC"> method in the next</font>

314
00:11:54,500 --> 00:12:01,220
<font color="#CCCCCC">slide right so now that</font><font color="#E5E5E5"> we found the</font>

315
00:11:59,090 --> 00:12:03,290
most<font color="#CCCCCC"> vulnerable nodes</font><font color="#E5E5E5"> the question is</font>

316
00:12:01,220 --> 00:12:05,690
how can<font color="#CCCCCC"> we disconnect them from</font><font color="#E5E5E5"> the</font>

317
00:12:03,290 --> 00:12:08,390
attack graph well first thing that we

318
00:12:05,690 --> 00:12:10,820
<font color="#E5E5E5">can do is perform configuration changes</font>

319
00:12:08,390 --> 00:12:12,980
on the vulnerable computers so we<font color="#CCCCCC"> need</font>

320
00:12:10,820 --> 00:12:15,110
to<font color="#CCCCCC"> examine the local</font><font color="#E5E5E5"> admins on those</font>

321
00:12:12,980 --> 00:12:16,940
vulnerable computers and their log and

322
00:12:15,110 --> 00:12:19,550
patterns<font color="#CCCCCC"> and remove any redundant</font>

323
00:12:16,940 --> 00:12:22,490
members so the solution would be most

324
00:12:19,550 --> 00:12:24,770
<font color="#E5E5E5">common for scenarios with vulnerable</font>

325
00:12:22,490 --> 00:12:26,720
machines that have constantly many high

326
00:12:24,770 --> 00:12:28,880
<font color="#E5E5E5">privileged sessions but also many</font>

327
00:12:26,720 --> 00:12:30,410
inactive local admins so this shows<font color="#CCCCCC"> us</font>

328
00:12:28,880 --> 00:12:32,240
that<font color="#E5E5E5"> maybe that</font><font color="#CCCCCC"> is the miss</font>

329
00:12:30,410 --> 00:12:33,860
configuration and that<font color="#E5E5E5"> local admins</font>

330
00:12:32,240 --> 00:12:36,080
should not be present there so<font color="#CCCCCC"> this is a</font>

331
00:12:33,860 --> 00:12:37,970
pretty simple change and remember that

332
00:12:36,080 --> 00:12:39,800
every time<font color="#CCCCCC"> you</font><font color="#E5E5E5"> have a less privileged</font>

333
00:12:37,970 --> 00:12:41,630
domain account that has local admin

334
00:12:39,800 --> 00:12:44,030
privileges on a vulnerable machine you

335
00:12:41,630 --> 00:12:47,510
are<font color="#E5E5E5"> adding additional attack paths in</font>

336
00:12:44,030 --> 00:12:49,970
the underlying graph<font color="#E5E5E5"> now second thing</font>

337
00:12:47,510 --> 00:12:51,500
<font color="#CCCCCC">that we can do is both the easiest and</font>

338
00:12:49,970 --> 00:12:53,870
the hardest solution so it's easiest

339
00:12:51,500 --> 00:12:56,360
<font color="#CCCCCC">because it doesn't</font><font color="#E5E5E5"> require any extreme</font>

340
00:12:53,870 --> 00:12:58,220
changes to the<font color="#CCCCCC"> environment</font><font color="#E5E5E5"> however</font><font color="#CCCCCC"> it</font>

341
00:12:56,360 --> 00:13:00,560
does deal with<font color="#E5E5E5"> human</font><font color="#CCCCCC"> behavior which</font>

342
00:12:58,220 --> 00:13:02,630
<font color="#E5E5E5">might be a bit trickier</font><font color="#CCCCCC"> to change</font><font color="#E5E5E5"> so</font>

343
00:13:00,560 --> 00:13:03,890
this one has<font color="#E5E5E5"> to do with what</font><font color="#CCCCCC"> our admins</font>

344
00:13:02,630 --> 00:13:05,590
doing the environment when they're

345
00:13:03,890 --> 00:13:07,819
connecting to<font color="#E5E5E5"> the vulnerable machines</font>

346
00:13:05,590 --> 00:13:10,220
first thing<font color="#E5E5E5"> that we would like</font><font color="#CCCCCC"> them to</font>

347
00:13:07,820 --> 00:13:12,320
<font color="#E5E5E5">do is</font><font color="#CCCCCC"> to do it</font><font color="#E5E5E5"> by using a network logon</font>

348
00:13:10,220 --> 00:13:14,420
and<font color="#CCCCCC"> not for example</font><font color="#E5E5E5"> interactive logon</font>

349
00:13:12,320 --> 00:13:16,820
<font color="#E5E5E5">in order to not expose the credentials</font>

350
00:13:14,420 --> 00:13:17,089
on the vulnerable machine that way the

351
00:13:16,820 --> 00:13:18,860
<font color="#E5E5E5">credit</font>

352
00:13:17,089 --> 00:13:22,160
would not<font color="#E5E5E5"> be stored on the target</font>

353
00:13:18,860 --> 00:13:23,749
<font color="#E5E5E5">machine another thing is simply log on</font>

354
00:13:22,160 --> 00:13:25,639
<font color="#E5E5E5">to the vulnerable machine by</font><font color="#CCCCCC"> using a</font>

355
00:13:23,749 --> 00:13:27,740
<font color="#CCCCCC">less privileged</font><font color="#E5E5E5"> domain account there are</font>

356
00:13:25,639 --> 00:13:29,449
many other local<font color="#E5E5E5"> admins there perhaps</font>

357
00:13:27,740 --> 00:13:30,220
<font color="#E5E5E5">another one can be used to connect to</font>

358
00:13:29,449 --> 00:13:33,290
the<font color="#E5E5E5"> computer</font>

359
00:13:30,220 --> 00:13:35,240
also when connecting by using<font color="#E5E5E5"> remote</font>

360
00:13:33,290 --> 00:13:37,160
<font color="#E5E5E5">desktop use remote credential guard</font>

361
00:13:35,240 --> 00:13:39,110
<font color="#E5E5E5">again in that way the credentials of the</font>

362
00:13:37,160 --> 00:13:42,379
<font color="#E5E5E5">high privileged account would not be</font>

363
00:13:39,110 --> 00:13:44,240
stored<font color="#E5E5E5"> on the target computer well as I</font>

364
00:13:42,379 --> 00:13:46,519
said this might be a bit trickier to

365
00:13:44,240 --> 00:13:48,920
implement however if we create a ranking

366
00:13:46,519 --> 00:13:51,139
which shows us which users are<font color="#CCCCCC"> the most</font>

367
00:13:48,920 --> 00:13:52,910
<font color="#E5E5E5">problematic</font><font color="#CCCCCC"> ones in the environment this</font>

368
00:13:51,139 --> 00:13:57,110
<font color="#E5E5E5">is something that might inspire</font><font color="#CCCCCC"> a change</font>

369
00:13:52,910 --> 00:13:58,699
for<font color="#E5E5E5"> those problematic admins now last</font>

370
00:13:57,110 --> 00:14:00,800
one is more of a side<font color="#CCCCCC"> note which is</font>

371
00:13:58,699 --> 00:14:02,809
<font color="#E5E5E5">mostly relevant for security solutions</font>

372
00:14:00,800 --> 00:14:05,120
that have admin privileges on the

373
00:14:02,809 --> 00:14:07,279
<font color="#E5E5E5">machine and what they can do is monitor</font>

374
00:14:05,120 --> 00:14:09,589
the<font color="#E5E5E5"> sessions on the vulnerable computer</font>

375
00:14:07,279 --> 00:14:11,480
and<font color="#E5E5E5"> disconnect any inactive sessions of</font>

376
00:14:09,589 --> 00:14:13,129
high privileged accounts<font color="#E5E5E5"> in order</font><font color="#CCCCCC"> to</font>

377
00:14:11,480 --> 00:14:15,230
remove them<font color="#CCCCCC"> from the logon</font><font color="#E5E5E5"> session and</font>

378
00:14:13,129 --> 00:14:17,240
delete it from the computer's<font color="#CCCCCC"> memory now</font>

379
00:14:15,230 --> 00:14:18,740
this would<font color="#CCCCCC"> be a bit trickier to</font>

380
00:14:17,240 --> 00:14:21,139
implement it requires a bit more work

381
00:14:18,740 --> 00:14:22,699
<font color="#CCCCCC">but the first two are actually very easy</font>

382
00:14:21,139 --> 00:14:24,740
to<font color="#CCCCCC"> implement you can do it in any</font>

383
00:14:22,699 --> 00:14:27,109
environment<font color="#E5E5E5"> and just by implementing</font>

384
00:14:24,740 --> 00:14:29,420
<font color="#E5E5E5">those first two you will be removing</font><font color="#CCCCCC"> the</font>

385
00:14:27,110 --> 00:14:31,040
vast majority<font color="#CCCCCC"> of the attack</font><font color="#E5E5E5"> path in the</font>

386
00:14:29,420 --> 00:14:33,139
underlying<font color="#E5E5E5"> graph so I suggest that you</font>

387
00:14:31,040 --> 00:14:35,329
<font color="#E5E5E5">try to</font><font color="#CCCCCC"> implement as many of those</font><font color="#E5E5E5"> as</font>

388
00:14:33,139 --> 00:14:38,629
possible<font color="#CCCCCC"> especially</font><font color="#E5E5E5"> for the most</font>

389
00:14:35,329 --> 00:14:40,638
vulnerable notes that you find<font color="#E5E5E5"> now we</font>

390
00:14:38,629 --> 00:14:43,490
know that<font color="#CCCCCC"> no matter how much we</font><font color="#E5E5E5"> try to</font>

391
00:14:40,639 --> 00:14:45,649
reduce<font color="#E5E5E5"> the attack surface</font><font color="#CCCCCC"> will</font><font color="#E5E5E5"> not be</font>

392
00:14:43,490 --> 00:14:47,509
able<font color="#E5E5E5"> to remove it entirely</font><font color="#CCCCCC"> we'll still</font>

393
00:14:45,649 --> 00:14:49,069
<font color="#E5E5E5">have high privileged accounts logging</font>

394
00:14:47,509 --> 00:14:51,740
<font color="#E5E5E5">into computers that it shouldn't be</font>

395
00:14:49,069 --> 00:14:54,378
logging<font color="#CCCCCC"> into or will have miss</font>

396
00:14:51,740 --> 00:14:55,790
configuration where a<font color="#E5E5E5"> user adds local</font>

397
00:14:54,379 --> 00:14:57,230
admin to a vulnerable machine that

398
00:14:55,790 --> 00:14:59,240
<font color="#E5E5E5">should have been present there the</font>

399
00:14:57,230 --> 00:15:01,850
question is what<font color="#E5E5E5"> can we do with the</font>

400
00:14:59,240 --> 00:15:05,809
remaining attack<font color="#E5E5E5"> path well we can hope</font>

401
00:15:01,850 --> 00:15:08,179
to detect them first let's<font color="#CCCCCC"> begin with a</font>

402
00:15:05,809 --> 00:15:10,850
<font color="#E5E5E5">few definition before seeing the</font>

403
00:15:08,179 --> 00:15:13,759
detection itself<font color="#E5E5E5"> so first we have a</font>

404
00:15:10,850 --> 00:15:16,069
<font color="#E5E5E5">logon graph so a logon graph is a graph</font>

405
00:15:13,759 --> 00:15:18,740
<font color="#CCCCCC">which consists of vertices</font><font color="#E5E5E5"> which</font>

406
00:15:16,069 --> 00:15:20,479
represent<font color="#E5E5E5"> the domain computers and the</font>

407
00:15:18,740 --> 00:15:23,029
edges represent<font color="#E5E5E5"> the session between</font>

408
00:15:20,480 --> 00:15:25,129
<font color="#E5E5E5">those computers so every time a user</font>

409
00:15:23,029 --> 00:15:26,990
connects from source<font color="#E5E5E5"> computer to a</font>

410
00:15:25,129 --> 00:15:29,960
target computer we would add a

411
00:15:26,990 --> 00:15:32,480
corresponding directed edge in the graph

412
00:15:29,960 --> 00:15:35,150
and add a label<font color="#E5E5E5"> to the edge representing</font>

413
00:15:32,480 --> 00:15:37,550
<font color="#CCCCCC">the user which made</font><font color="#E5E5E5"> that connection for</font>

414
00:15:35,150 --> 00:15:39,770
<font color="#CCCCCC">example here you can see</font><font color="#E5E5E5"> that user one</font>

415
00:15:37,550 --> 00:15:41,780
connected<font color="#E5E5E5"> from computer one to computer</font>

416
00:15:39,770 --> 00:15:46,370
<font color="#E5E5E5">three sorry computer two and then from</font>

417
00:15:41,780 --> 00:15:48,110
computer to computer<font color="#CCCCCC"> three</font><font color="#E5E5E5"> ok next and</font>

418
00:15:46,370 --> 00:15:50,300
last<font color="#E5E5E5"> definition is the weighted logon</font>

419
00:15:48,110 --> 00:15:52,100
graph so this<font color="#E5E5E5"> is the same as the</font>

420
00:15:50,300 --> 00:15:54,650
previous<font color="#E5E5E5"> graph with addition an</font>

421
00:15:52,100 --> 00:15:56,510
additional parameter<font color="#CCCCCC"> on the edge we're</font>

422
00:15:54,650 --> 00:15:59,209
adding a weight to every edge in the

423
00:15:56,510 --> 00:16:01,520
graph<font color="#E5E5E5"> and that</font><font color="#CCCCCC"> edge and that weight</font>

424
00:15:59,210 --> 00:16:04,280
<font color="#CCCCCC">represents the probability of that</font><font color="#E5E5E5"> user</font>

425
00:16:01,520 --> 00:16:05,449
performing that connection<font color="#E5E5E5"> so we still</font>

426
00:16:04,280 --> 00:16:06,800
<font color="#E5E5E5">don't know how we compute this</font>

427
00:16:05,450 --> 00:16:09,110
probability<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is just a definition</font>

428
00:16:06,800 --> 00:16:11,510
<font color="#E5E5E5">for</font><font color="#CCCCCC"> example here</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> can</font><font color="#E5E5E5"> see that the</font>

429
00:16:09,110 --> 00:16:13,250
probability<font color="#CCCCCC"> of user one connecting from</font>

430
00:16:11,510 --> 00:16:16,310
computer<font color="#E5E5E5"> one to computer -</font><font color="#CCCCCC"> it's</font><font color="#E5E5E5"> pretty</font>

431
00:16:13,250 --> 00:16:18,110
high<font color="#CCCCCC"> it's zero point nine however the</font>

432
00:16:16,310 --> 00:16:20,150
probability<font color="#E5E5E5"> of the same user connecting</font>

433
00:16:18,110 --> 00:16:21,800
<font color="#E5E5E5">from computer to computer</font><font color="#CCCCCC"> three it's</font>

434
00:16:20,150 --> 00:16:24,770
pretty low it's just zero point zero

435
00:16:21,800 --> 00:16:27,020
five<font color="#E5E5E5"> okay so this is just an example</font>

436
00:16:24,770 --> 00:16:30,370
<font color="#E5E5E5">let's see how those definitions have</font>

437
00:16:27,020 --> 00:16:32,660
anything to do with detecting<font color="#E5E5E5"> an attack</font>

438
00:16:30,370 --> 00:16:35,120
<font color="#CCCCCC">alright so first thing that we need to</font>

439
00:16:32,660 --> 00:16:36,860
<font color="#E5E5E5">do is to compute a weighted log on graph</font>

440
00:16:35,120 --> 00:16:38,810
<font color="#E5E5E5">so this is something which</font><font color="#CCCCCC"> would be</font>

441
00:16:36,860 --> 00:16:40,760
constructed<font color="#CCCCCC"> based on</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> logon</font>

442
00:16:38,810 --> 00:16:42,920
activities<font color="#E5E5E5"> of the users in our</font>

443
00:16:40,760 --> 00:16:45,290
environment during<font color="#E5E5E5"> some learning period</font>

444
00:16:42,920 --> 00:16:47,089
<font color="#E5E5E5">so we'll have a month or two month in</font>

445
00:16:45,290 --> 00:16:50,180
<font color="#E5E5E5">which we study the</font><font color="#CCCCCC"> behavior of</font><font color="#E5E5E5"> all the</font>

446
00:16:47,090 --> 00:16:52,730
<font color="#E5E5E5">users and then we compute the weight of</font>

447
00:16:50,180 --> 00:16:54,560
the end of every edge<font color="#E5E5E5"> based on the</font>

448
00:16:52,730 --> 00:16:57,200
activities<font color="#CCCCCC"> of that users between</font><font color="#E5E5E5"> the two</font>

449
00:16:54,560 --> 00:16:59,119
<font color="#E5E5E5">computers meaning if the user frequently</font>

450
00:16:57,200 --> 00:17:01,760
connects<font color="#E5E5E5"> from one computer</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the other</font>

451
00:16:59,120 --> 00:17:04,010
<font color="#E5E5E5">the corresponding edge would get a high</font>

452
00:17:01,760 --> 00:17:06,920
<font color="#CCCCCC">probability and if there's a connection</font>

453
00:17:04,010 --> 00:17:08,480
<font color="#E5E5E5">that the user rarely makes or he never</font>

454
00:17:06,920 --> 00:17:10,910
connected to the machine then the

455
00:17:08,480 --> 00:17:15,260
<font color="#CCCCCC">corresponding edge would be given a low</font>

456
00:17:10,910 --> 00:17:17,540
or a zero probability second thing we

457
00:17:15,260 --> 00:17:19,310
<font color="#CCCCCC">need is the daily log on RAM so this is</font>

458
00:17:17,540 --> 00:17:21,500
<font color="#E5E5E5">something that is constructed based on</font>

459
00:17:19,310 --> 00:17:24,379
<font color="#E5E5E5">the</font><font color="#CCCCCC"> logon activities</font><font color="#E5E5E5"> of all the users on</font>

460
00:17:21,500 --> 00:17:26,420
a given day after the learning<font color="#E5E5E5"> period</font><font color="#CCCCCC"> so</font>

461
00:17:24,380 --> 00:17:28,490
first stage<font color="#CCCCCC"> that we do is we take all</font>

462
00:17:26,420 --> 00:17:31,430
the<font color="#E5E5E5"> logon activities during that day and</font>

463
00:17:28,490 --> 00:17:32,990
construct a regular logon graph<font color="#CCCCCC"> so every</font>

464
00:17:31,430 --> 00:17:35,030
time user connects to a machine

465
00:17:32,990 --> 00:17:38,300
we had a corresponding edge in the graph

466
00:17:35,030 --> 00:17:40,940
<font color="#E5E5E5">in the second stage we will remove all</font>

467
00:17:38,300 --> 00:17:42,620
the edges which were aside a high weight

468
00:17:40,940 --> 00:17:44,750
in the weighted graph<font color="#E5E5E5"> that we computed</font>

469
00:17:42,620 --> 00:17:47,060
in a previous stage<font color="#E5E5E5"> basically</font><font color="#CCCCCC"> we want</font><font color="#E5E5E5"> to</font>

470
00:17:44,750 --> 00:17:49,130
remove all the<font color="#E5E5E5"> edges that we expect to</font>

471
00:17:47,060 --> 00:17:50,720
<font color="#CCCCCC">see on</font><font color="#E5E5E5"> the given on a given day and only</font>

472
00:17:49,130 --> 00:17:52,940
<font color="#E5E5E5">be left with the edges that</font><font color="#CCCCCC"> are less</font>

473
00:17:50,720 --> 00:17:54,950
likely<font color="#CCCCCC"> to appear in our environment and</font>

474
00:17:52,940 --> 00:17:57,080
on that graph<font color="#CCCCCC"> you try to detect</font>

475
00:17:54,950 --> 00:18:00,980
anomalies which might<font color="#E5E5E5"> indicate that an</font>

476
00:17:57,080 --> 00:18:02,780
attack might be going<font color="#E5E5E5"> on right then</font><font color="#CCCCCC"> then</font>

477
00:18:00,980 --> 00:18:07,190
as I said<font color="#CCCCCC"> we'll try</font><font color="#E5E5E5"> to detect anomalies</font>

478
00:18:02,780 --> 00:18:09,550
based on that graph so which structures

479
00:18:07,190 --> 00:18:12,560
should<font color="#CCCCCC"> we be looking for</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> that graph</font>

480
00:18:09,550 --> 00:18:14,210
first interesting structure<font color="#E5E5E5"> is a star</font>

481
00:18:12,560 --> 00:18:16,820
structures so that<font color="#CCCCCC"> would be a computer</font>

482
00:18:14,210 --> 00:18:22,400
<font color="#E5E5E5">with many outgoing edges to other</font>

483
00:18:16,820 --> 00:18:24,260
computers<font color="#E5E5E5"> all right so this is something</font>

484
00:18:22,400 --> 00:18:26,180
<font color="#CCCCCC">that might indicate reconnaissance</font>

485
00:18:24,260 --> 00:18:28,550
activities an attacker that<font color="#CCCCCC"> is scanning</font>

486
00:18:26,180 --> 00:18:31,250
<font color="#E5E5E5">the network trying to</font><font color="#CCCCCC"> access to as many</font>

487
00:18:28,550 --> 00:18:32,990
computers<font color="#CCCCCC"> as possible and gather as much</font>

488
00:18:31,250 --> 00:18:35,960
<font color="#E5E5E5">information from other domain machines</font>

489
00:18:32,990 --> 00:18:37,730
for example<font color="#CCCCCC"> if you run bloodhound this</font>

490
00:18:35,960 --> 00:18:41,390
is the<font color="#E5E5E5"> structure that you'll expect to</font>

491
00:18:37,730 --> 00:18:43,250
see in the graph<font color="#E5E5E5"> so in that case all the</font>

492
00:18:41,390 --> 00:18:46,430
edges would be assigned<font color="#E5E5E5"> a label</font><font color="#CCCCCC"> that</font>

493
00:18:43,250 --> 00:18:48,140
correspond to the same<font color="#CCCCCC"> user</font><font color="#E5E5E5"> also</font><font color="#CCCCCC"> it can</font>

494
00:18:46,430 --> 00:18:49,910
be a main attack<font color="#CCCCCC"> machine that the</font>

495
00:18:48,140 --> 00:18:51,800
attacker is using<font color="#E5E5E5"> to connect to more</font>

496
00:18:49,910 --> 00:18:54,290
domain computers extract more

497
00:18:51,800 --> 00:18:56,330
<font color="#CCCCCC">credentials</font><font color="#E5E5E5"> and use them</font><font color="#CCCCCC"> to connect to</font>

498
00:18:54,290 --> 00:18:59,629
other<font color="#E5E5E5"> machines now in that case every</font>

499
00:18:56,330 --> 00:19:03,639
edge might get a user which might get a

500
00:18:59,630 --> 00:19:03,640
<font color="#E5E5E5">label which represents a different user</font>

501
00:19:03,670 --> 00:19:09,230
next interesting<font color="#E5E5E5"> structures that will</font>

502
00:19:06,020 --> 00:19:11,660
search for are suspicious chains<font color="#E5E5E5"> so</font>

503
00:19:09,230 --> 00:19:15,110
those are<font color="#E5E5E5"> consecutive edges which were</font>

504
00:19:11,660 --> 00:19:17,030
assigned<font color="#E5E5E5"> a low probability so for</font>

505
00:19:15,110 --> 00:19:18,770
<font color="#E5E5E5">example this might indicate lateral</font>

506
00:19:17,030 --> 00:19:20,780
movement activities going on in<font color="#E5E5E5"> our</font>

507
00:19:18,770 --> 00:19:22,430
<font color="#E5E5E5">environment</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> if you run go fetch this</font>

508
00:19:20,780 --> 00:19:26,240
is the structure that<font color="#CCCCCC"> you'll</font><font color="#E5E5E5"> expect to</font>

509
00:19:22,430 --> 00:19:27,740
<font color="#CCCCCC">see in the graph</font><font color="#E5E5E5"> or it can be also a</font>

510
00:19:26,240 --> 00:19:29,720
combination<font color="#CCCCCC"> of the two it</font><font color="#E5E5E5"> can be an</font>

511
00:19:27,740 --> 00:19:31,970
attacker<font color="#E5E5E5"> that started with</font>

512
00:19:29,720 --> 00:19:33,770
reconnaissance and then moving on<font color="#E5E5E5"> to</font>

513
00:19:31,970 --> 00:19:36,620
perform lateral and movement activities

514
00:19:33,770 --> 00:19:38,480
from one of the computers<font color="#CCCCCC"> alright so</font>

515
00:19:36,620 --> 00:19:40,959
that was<font color="#CCCCCC"> a lot of theoretical talk let's</font>

516
00:19:38,480 --> 00:19:43,700
see an<font color="#CCCCCC"> example from a real environment</font>

517
00:19:40,960 --> 00:19:45,770
<font color="#E5E5E5">so here you can see the daily logon</font>

518
00:19:43,700 --> 00:19:48,740
graph<font color="#E5E5E5"> that I got from a real</font><font color="#CCCCCC"> environment</font>

519
00:19:45,770 --> 00:19:50,930
those are only<font color="#E5E5E5"> the edges that happen</font>

520
00:19:48,740 --> 00:19:53,390
during a day<font color="#E5E5E5"> that were signed a low</font>

521
00:19:50,930 --> 00:19:53,779
probability<font color="#CCCCCC"> and as you can</font><font color="#E5E5E5"> see there's</font>

522
00:19:53,390 --> 00:19:55,279
<font color="#CCCCCC">two</font>

523
00:19:53,779 --> 00:19:57,559
<font color="#E5E5E5">data here it's hard</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> find anomalies</font>

524
00:19:55,279 --> 00:19:59,029
based on this<font color="#E5E5E5"> graph and we need to find</font>

525
00:19:57,559 --> 00:20:01,129
a way<font color="#E5E5E5"> to filter out the benign</font>

526
00:19:59,029 --> 00:20:05,149
activities now let's see different<font color="#CCCCCC"> ways</font>

527
00:20:01,129 --> 00:20:07,488
in which<font color="#CCCCCC"> we can</font><font color="#E5E5E5"> do this first thing that</font>

528
00:20:05,149 --> 00:20:10,758
we<font color="#E5E5E5"> can do is remove connected components</font>

529
00:20:07,489 --> 00:20:12,679
that<font color="#E5E5E5"> consists of only two nodes</font><font color="#CCCCCC"> so those</font>

530
00:20:10,759 --> 00:20:15,080
<font color="#CCCCCC">will be the</font><font color="#E5E5E5"> cases where we just have two</font>

531
00:20:12,679 --> 00:20:17,210
nodes connected by<font color="#CCCCCC"> a</font><font color="#E5E5E5"> single edge without</font>

532
00:20:15,080 --> 00:20:19,039
<font color="#E5E5E5">any additional</font><font color="#CCCCCC"> connection so it's a very</font>

533
00:20:17,210 --> 00:20:21,320
<font color="#CCCCCC">counter for user</font><font color="#E5E5E5"> to connect to at least</font>

534
00:20:19,039 --> 00:20:24,109
one new resource on<font color="#E5E5E5"> a given day</font><font color="#CCCCCC"> so</font>

535
00:20:21,320 --> 00:20:26,330
that's<font color="#E5E5E5"> not very</font><font color="#CCCCCC"> interesting</font><font color="#E5E5E5"> however as</font>

536
00:20:24,109 --> 00:20:29,289
<font color="#E5E5E5">you</font><font color="#CCCCCC"> can see we still</font><font color="#E5E5E5"> have too much data</font>

537
00:20:26,330 --> 00:20:31,999
<font color="#E5E5E5">and we need to keep filtering it out</font>

538
00:20:29,289 --> 00:20:34,249
next thing that I did<font color="#CCCCCC"> is I decided</font><font color="#E5E5E5"> to</font>

539
00:20:31,999 --> 00:20:36,169
use different<font color="#E5E5E5"> features for every</font>

540
00:20:34,249 --> 00:20:38,359
structure<font color="#E5E5E5"> that I was looking</font><font color="#CCCCCC"> for so here</font>

541
00:20:36,169 --> 00:20:40,099
I'll show you<font color="#E5E5E5"> how I was able to find the</font>

542
00:20:38,359 --> 00:20:42,649
suspicious chain in the environment and

543
00:20:40,099 --> 00:20:44,629
in order<font color="#CCCCCC"> to do that I removed all the</font>

544
00:20:42,649 --> 00:20:47,359
<font color="#CCCCCC">star structures that were not leading</font><font color="#E5E5E5"> to</font>

545
00:20:44,629 --> 00:20:48,769
<font color="#CCCCCC">any</font><font color="#E5E5E5"> lateral movement activity again as</font>

546
00:20:47,359 --> 00:20:50,928
<font color="#E5E5E5">you can see we still need to keep</font>

547
00:20:48,769 --> 00:20:53,719
filtering<font color="#CCCCCC"> the data so let's see some</font>

548
00:20:50,929 --> 00:20:55,820
more ways in which we<font color="#E5E5E5"> can do this so</font>

549
00:20:53,719 --> 00:20:58,009
some more things that<font color="#CCCCCC"> I did is</font><font color="#E5E5E5"> take into</font>

550
00:20:55,820 --> 00:21:00,439
account new users<font color="#CCCCCC"> and computers which</font>

551
00:20:58,009 --> 00:21:02,599
<font color="#E5E5E5">are added to the environment</font><font color="#CCCCCC"> also take a</font>

552
00:21:00,440 --> 00:21:04,489
<font color="#E5E5E5">look at the computer resource popularity</font>

553
00:21:02,599 --> 00:21:06,889
meaning how<font color="#CCCCCC"> many users connect to the</font>

554
00:21:04,489 --> 00:21:10,129
computer<font color="#CCCCCC"> on a given day</font><font color="#E5E5E5"> and all those</font>

555
00:21:06,889 --> 00:21:13,008
high privileged users or not<font color="#E5E5E5"> also</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> took</font>

556
00:21:10,129 --> 00:21:15,228
into account peers behavior so peers<font color="#E5E5E5"> are</font>

557
00:21:13,009 --> 00:21:17,899
users that have<font color="#E5E5E5"> similar permissions and</font>

558
00:21:15,229 --> 00:21:20,119
<font color="#E5E5E5">access similar resources so if the user</font>

559
00:21:17,899 --> 00:21:22,189
accesses a resource<font color="#E5E5E5"> whose peers</font>

560
00:21:20,119 --> 00:21:24,709
constantly access as well it would not

561
00:21:22,190 --> 00:21:26,690
be considered<font color="#CCCCCC"> as suspicious</font><font color="#E5E5E5"> so as you</font>

562
00:21:24,710 --> 00:21:28,489
can<font color="#E5E5E5"> see when using those features</font><font color="#CCCCCC"> I was</font>

563
00:21:26,690 --> 00:21:30,440
able<font color="#CCCCCC"> to get a graph which looks a lot</font>

564
00:21:28,489 --> 00:21:31,879
better<font color="#CCCCCC"> however it's</font><font color="#E5E5E5"> still not good</font>

565
00:21:30,440 --> 00:21:34,700
enough<font color="#CCCCCC"> since we can't start</font>

566
00:21:31,879 --> 00:21:36,379
investigating every<font color="#E5E5E5"> edge here so since</font>

567
00:21:34,700 --> 00:21:38,269
<font color="#E5E5E5">we're</font><font color="#CCCCCC"> looking</font><font color="#E5E5E5"> for suspicious change</font>

568
00:21:36,379 --> 00:21:40,998
<font color="#E5E5E5">those are the ones</font><font color="#CCCCCC"> that might represent</font>

569
00:21:38,269 --> 00:21:43,119
a lateral movement activity this<font color="#CCCCCC"> is</font><font color="#E5E5E5"> the</font>

570
00:21:40,999 --> 00:21:46,190
last feature<font color="#CCCCCC"> that really sealed</font><font color="#E5E5E5"> the deal</font>

571
00:21:43,119 --> 00:21:48,109
<font color="#E5E5E5">so only considered connection when the</font>

572
00:21:46,190 --> 00:21:50,659
user that performs a connection is a

573
00:21:48,109 --> 00:21:52,158
local admin on the target<font color="#E5E5E5"> computer this</font>

574
00:21:50,659 --> 00:21:53,479
would<font color="#E5E5E5"> be</font><font color="#CCCCCC"> usually the case when we're</font>

575
00:21:52,159 --> 00:21:55,789
talking about lateral<font color="#E5E5E5"> movement</font>

576
00:21:53,479 --> 00:21:58,429
activities<font color="#E5E5E5"> and as you can see the data</font>

577
00:21:55,789 --> 00:22:00,619
looks a lot better we only have<font color="#CCCCCC"> two sub</font>

578
00:21:58,429 --> 00:22:02,599
graphs left<font color="#E5E5E5"> so the one</font><font color="#CCCCCC"> on the top</font><font color="#E5E5E5"> is</font>

579
00:22:00,619 --> 00:22:04,249
benign and<font color="#CCCCCC"> it's not it's</font><font color="#E5E5E5"> not a</font>

580
00:22:02,599 --> 00:22:05,928
suspicious change<font color="#E5E5E5"> simply to computers</font>

581
00:22:04,249 --> 00:22:07,280
connecting to the same one so that could

582
00:22:05,929 --> 00:22:11,210
be<font color="#E5E5E5"> easily filtered</font>

583
00:22:07,280 --> 00:22:12,950
out and the second one is a chain as a

584
00:22:11,210 --> 00:22:15,830
species chain which consists of two

585
00:22:12,950 --> 00:22:18,230
edges<font color="#CCCCCC"> and</font><font color="#E5E5E5"> this was actually a lateral</font>

586
00:22:15,830 --> 00:22:19,760
movement activity which was performed<font color="#E5E5E5"> in</font>

587
00:22:18,230 --> 00:22:22,280
the environment as part<font color="#E5E5E5"> of a testing</font>

588
00:22:19,760 --> 00:22:24,320
scenario and we found a<font color="#E5E5E5"> credentials</font>

589
00:22:22,280 --> 00:22:26,899
<font color="#E5E5E5">dumping tool on the computer in the</font>

590
00:22:24,320 --> 00:22:29,300
middle<font color="#E5E5E5"> so that was pretty cool so in a</font>

591
00:22:26,900 --> 00:22:31,820
<font color="#E5E5E5">very similar way</font><font color="#CCCCCC"> you can either use all</font>

592
00:22:29,300 --> 00:22:34,310
the<font color="#E5E5E5"> features a part of them add some new</font>

593
00:22:31,820 --> 00:22:37,700
ones<font color="#E5E5E5"> and also detect suspicious star</font>

594
00:22:34,310 --> 00:22:39,500
structures in the environment as<font color="#CCCCCC"> well so</font>

595
00:22:37,700 --> 00:22:41,840
what are the pros<font color="#CCCCCC"> and cons of this</font>

596
00:22:39,500 --> 00:22:43,570
approach first<font color="#E5E5E5"> of all some of the pros</font>

597
00:22:41,840 --> 00:22:45,980
in order to fully avoid detection

598
00:22:43,570 --> 00:22:47,870
<font color="#CCCCCC">attackers need to be aware of all the</font>

599
00:22:45,980 --> 00:22:49,610
behavior<font color="#CCCCCC"> of all the entities</font><font color="#E5E5E5"> in the</font>

600
00:22:47,870 --> 00:22:51,679
environment in order<font color="#E5E5E5"> to not generate</font>

601
00:22:49,610 --> 00:22:53,659
<font color="#E5E5E5">those edges which would be assigned a</font>

602
00:22:51,680 --> 00:22:56,450
low probability so this is<font color="#E5E5E5"> pretty hard</font>

603
00:22:53,660 --> 00:22:58,610
for an attacker also it allows<font color="#CCCCCC"> us</font><font color="#E5E5E5"> to</font>

604
00:22:56,450 --> 00:23:00,860
detect paths which involve multiple

605
00:22:58,610 --> 00:23:03,949
users<font color="#CCCCCC"> I've either in the start</font>

606
00:23:00,860 --> 00:23:06,080
structures or in the<font color="#E5E5E5"> chain structures it</font>

607
00:23:03,950 --> 00:23:08,060
can help us detect<font color="#E5E5E5"> both outsider and</font>

608
00:23:06,080 --> 00:23:10,250
insider<font color="#CCCCCC"> threats so it can be a</font><font color="#E5E5E5"> user that</font>

609
00:23:08,060 --> 00:23:13,250
starts accessing<font color="#CCCCCC"> resources that he</font>

610
00:23:10,250 --> 00:23:15,620
shouldn't be<font color="#E5E5E5"> accessing and last thing is</font>

611
00:23:13,250 --> 00:23:17,150
<font color="#E5E5E5">that it can</font><font color="#CCCCCC"> be in corporate incorporated</font>

612
00:23:15,620 --> 00:23:19,459
with data that<font color="#CCCCCC"> we have</font><font color="#E5E5E5"> from the</font>

613
00:23:17,150 --> 00:23:22,040
<font color="#CCCCCC">endpoints in order to strengthen</font><font color="#E5E5E5"> our</font>

614
00:23:19,460 --> 00:23:23,810
certainty in the signal and understand

615
00:23:22,040 --> 00:23:27,440
whether we are dealing<font color="#E5E5E5"> with a benign</font>

616
00:23:23,810 --> 00:23:29,000
activity<font color="#CCCCCC"> or an actual attack</font><font color="#E5E5E5"> so we</font><font color="#CCCCCC"> can</font>

617
00:23:27,440 --> 00:23:31,070
<font color="#CCCCCC">take a look at what was going on and</font>

618
00:23:29,000 --> 00:23:33,050
<font color="#CCCCCC">that source of</font><font color="#E5E5E5"> the start structure or</font>

619
00:23:31,070 --> 00:23:36,050
any<font color="#E5E5E5"> machine in the suspicious chain to</font>

620
00:23:33,050 --> 00:23:37,820
understand what<font color="#E5E5E5"> exactly happened some of</font>

621
00:23:36,050 --> 00:23:39,800
the cons first<font color="#E5E5E5"> of all if the attack</font>

622
00:23:37,820 --> 00:23:42,020
<font color="#CCCCCC">responds to an entity's usual behavior</font>

623
00:23:39,800 --> 00:23:43,669
<font color="#E5E5E5">it would be harder to detect</font><font color="#CCCCCC"> since we</font>

624
00:23:42,020 --> 00:23:45,320
<font color="#E5E5E5">are relying on the fact that we would</font>

625
00:23:43,670 --> 00:23:48,230
have edges that would be assigned<font color="#E5E5E5"> a low</font>

626
00:23:45,320 --> 00:23:50,720
probability<font color="#E5E5E5"> second is regarding the</font><font color="#CCCCCC"> wait</font>

627
00:23:48,230 --> 00:23:53,000
threshold which edges do we want to keep

628
00:23:50,720 --> 00:23:55,640
in our daily logon graph so if we set it

629
00:23:53,000 --> 00:23:57,980
<font color="#CCCCCC">to</font><font color="#E5E5E5"> be too high we might get more false</font>

630
00:23:55,640 --> 00:23:59,660
positives<font color="#CCCCCC"> if we set it</font><font color="#E5E5E5"> too low</font><font color="#CCCCCC"> we might</font>

631
00:23:57,980 --> 00:24:01,990
miss real attacks so we need to<font color="#E5E5E5"> find the</font>

632
00:23:59,660 --> 00:24:05,150
ideal<font color="#E5E5E5"> value here for</font><font color="#CCCCCC"> your environment</font>

633
00:24:01,990 --> 00:24:07,520
<font color="#E5E5E5">last thing is that it's harder to detect</font>

634
00:24:05,150 --> 00:24:09,290
scattered attacks<font color="#E5E5E5"> cases in which an</font>

635
00:24:07,520 --> 00:24:11,780
attacker connects from<font color="#E5E5E5"> one computer</font><font color="#CCCCCC"> to</font>

636
00:24:09,290 --> 00:24:13,639
another<font color="#CCCCCC"> by using one user then</font>

637
00:24:11,780 --> 00:24:15,200
connecting from<font color="#CCCCCC"> a completely</font><font color="#E5E5E5"> unrelated</font>

638
00:24:13,640 --> 00:24:17,600
machine to<font color="#E5E5E5"> another computer by using</font>

639
00:24:15,200 --> 00:24:19,580
another<font color="#E5E5E5"> user so those are less common</font>

640
00:24:17,600 --> 00:24:21,080
but they're still possible and need to

641
00:24:19,580 --> 00:24:24,179
be aware of those

642
00:24:21,080 --> 00:24:26,040
well if we<font color="#CCCCCC"> weren't able to</font><font color="#E5E5E5"> detect an</font>

643
00:24:24,180 --> 00:24:28,140
attack by<font color="#CCCCCC"> using this method no method</font>

644
00:24:26,040 --> 00:24:30,659
can detect<font color="#E5E5E5"> everything what can we do</font>

645
00:24:28,140 --> 00:24:33,600
well<font color="#E5E5E5"> we can always</font><font color="#CCCCCC"> use graphs to help</font><font color="#E5E5E5"> us</font>

646
00:24:30,660 --> 00:24:36,900
investigate<font color="#E5E5E5"> what happened so just very</font>

647
00:24:33,600 --> 00:24:39,800
briefly<font color="#E5E5E5"> what we can do is take all the</font>

648
00:24:36,900 --> 00:24:42,360
known compromised machines and users and

649
00:24:39,800 --> 00:24:45,210
construct a<font color="#E5E5E5"> logon graph based on those</font>

650
00:24:42,360 --> 00:24:47,490
entities so<font color="#CCCCCC"> that can help</font><font color="#E5E5E5"> us understand</font>

651
00:24:45,210 --> 00:24:50,280
what was the attack path<font color="#CCCCCC"> the attacker</font>

652
00:24:47,490 --> 00:24:51,990
took<font color="#E5E5E5"> maybe discover the source</font><font color="#CCCCCC"> of the</font>

653
00:24:50,280 --> 00:24:54,030
attack<font color="#E5E5E5"> and even discover additional</font>

654
00:24:51,990 --> 00:24:55,950
<font color="#E5E5E5">accounts which may have been compromised</font>

655
00:24:54,030 --> 00:24:58,290
<font color="#E5E5E5">during the attack since we know which</font>

656
00:24:55,950 --> 00:25:02,640
users were logged on to<font color="#E5E5E5"> every</font><font color="#CCCCCC"> computer</font>

657
00:24:58,290 --> 00:25:05,100
at that<font color="#E5E5E5"> time</font><font color="#CCCCCC"> alright</font><font color="#E5E5E5"> let's see some of</font>

658
00:25:02,640 --> 00:25:07,380
<font color="#CCCCCC">the conclusions</font><font color="#E5E5E5"> we know that attackers</font>

659
00:25:05,100 --> 00:25:09,899
have access to limited<font color="#E5E5E5"> data sources</font>

660
00:25:07,380 --> 00:25:12,540
however<font color="#E5E5E5"> they're</font><font color="#CCCCCC"> still able</font><font color="#E5E5E5"> to leverage</font>

661
00:25:09,900 --> 00:25:14,340
graphs and create a partial graph which

662
00:25:12,540 --> 00:25:16,710
would<font color="#E5E5E5"> help them to gain very valuable</font>

663
00:25:14,340 --> 00:25:18,959
<font color="#E5E5E5">insights into our environment</font><font color="#CCCCCC"> and help</font>

664
00:25:16,710 --> 00:25:20,880
them find a<font color="#CCCCCC"> path</font><font color="#E5E5E5"> that would allow them</font>

665
00:25:18,960 --> 00:25:22,980
<font color="#CCCCCC">to compromise</font><font color="#E5E5E5"> high privileged</font><font color="#CCCCCC"> accounts</font>

666
00:25:20,880 --> 00:25:24,990
<font color="#E5E5E5">so even though they're</font><font color="#CCCCCC"> working with</font>

667
00:25:22,980 --> 00:25:27,210
limited<font color="#E5E5E5"> data and permissions they're</font>

668
00:25:24,990 --> 00:25:28,530
still<font color="#CCCCCC"> able</font><font color="#E5E5E5"> to target</font><font color="#CCCCCC"> those domain</font>

669
00:25:27,210 --> 00:25:30,510
administrative accounts in<font color="#E5E5E5"> our</font>

670
00:25:28,530 --> 00:25:33,180
environment<font color="#CCCCCC"> as we've seen however</font>

671
00:25:30,510 --> 00:25:35,520
defenders have access to<font color="#E5E5E5"> unlimited data</font>

672
00:25:33,180 --> 00:25:38,040
sources<font color="#E5E5E5"> so</font><font color="#CCCCCC"> we have so much more data</font><font color="#E5E5E5"> and</font>

673
00:25:35,520 --> 00:25:40,350
we need to use it accordingly<font color="#E5E5E5"> we saw how</font>

674
00:25:38,040 --> 00:25:42,570
this data<font color="#E5E5E5"> can</font><font color="#CCCCCC"> be used to create much</font>

675
00:25:40,350 --> 00:25:45,330
more<font color="#E5E5E5"> informative graphs</font><font color="#CCCCCC"> that can help us</font>

676
00:25:42,570 --> 00:25:46,950
in attack prevention<font color="#CCCCCC"> we saw how we</font><font color="#E5E5E5"> can</font>

677
00:25:45,330 --> 00:25:48,629
<font color="#CCCCCC">detect</font><font color="#E5E5E5"> the most vulnerable nodes that we</font>

678
00:25:46,950 --> 00:25:51,150
have in our environment<font color="#CCCCCC"> and disconnect</font>

679
00:25:48,630 --> 00:25:53,310
them from the<font color="#E5E5E5"> attack graph we saw how</font><font color="#CCCCCC"> it</font>

680
00:25:51,150 --> 00:25:55,260
can help us<font color="#E5E5E5"> for detecting an attack</font>

681
00:25:53,310 --> 00:25:57,120
which might be performing reconnaissance

682
00:25:55,260 --> 00:25:59,730
<font color="#E5E5E5">or lateral movement activities and</font>

683
00:25:57,120 --> 00:26:02,189
finally we saw how they can help us for

684
00:25:59,730 --> 00:26:03,420
investigating an attack<font color="#CCCCCC"> so</font><font color="#E5E5E5"> hopefully you</font>

685
00:26:02,190 --> 00:26:05,580
can<font color="#E5E5E5"> start</font><font color="#CCCCCC"> looking into how you can</font>

686
00:26:03,420 --> 00:26:08,460
<font color="#E5E5E5">incorporate some of those ideas in your</font>

687
00:26:05,580 --> 00:26:09,929
<font color="#E5E5E5">environment</font><font color="#CCCCCC"> thank you</font>

688
00:26:08,460 --> 00:26:12,140
[Applause]

689
00:26:09,930 --> 00:26:15,859
[Music]

690
00:26:12,140 --> 00:26:15,859
[Applause]

