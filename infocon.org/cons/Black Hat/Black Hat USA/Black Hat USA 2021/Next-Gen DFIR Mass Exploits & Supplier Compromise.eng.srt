1
00:00:01,090 --> 00:00:14,660
[Music]

2
00:00:15,120 --> 00:00:18,160
welcome to next gen dfir mass exploits

3
00:00:18,160 --> 00:00:20,720
and supplier compromises criminals have

4
00:00:20,720 --> 00:00:23,119
started targeting suppliers and also

5
00:00:23,119 --> 00:00:25,359
leveraging zero-day vulnerabilities in

6
00:00:25,359 --> 00:00:27,920
order to break into systems worldwide

7
00:00:27,920 --> 00:00:29,920
and this is not an isolated incident

8
00:00:29,920 --> 00:00:31,679
this has become the new norm as

9
00:00:31,679 --> 00:00:33,600
criminals realize that they can maximize

10
00:00:33,600 --> 00:00:35,680
their return on investment and by

11
00:00:35,680 --> 00:00:37,600
hacking into a relatively small number

12
00:00:37,600 --> 00:00:39,920
of systems they can spread malware and

13
00:00:39,920 --> 00:00:42,719
gain unauthorized access on a wide scale

14
00:00:42,719 --> 00:00:44,320
so today we're going to talk about how

15
00:00:44,320 --> 00:00:46,239
incident response needs to change and we

16
00:00:46,239 --> 00:00:49,600
all need to adapt to this new norm

17
00:00:49,600 --> 00:00:51,840
my name is sherry davidoff i'm the ceo

18
00:00:51,840 --> 00:00:54,320
of lmg security you may also know me as

19
00:00:54,320 --> 00:00:56,399
alien from the book breaking and

20
00:00:56,399 --> 00:00:58,559
entering i have a degree in electrical

21
00:00:58,559 --> 00:01:00,079
engineering and computer science from

22
00:01:00,079 --> 00:01:03,359
mit and i'm a gcfa and g pin and my name

23
00:01:03,359 --> 00:01:05,438
is matt durin i am the ir team lead for

24
00:01:05,438 --> 00:01:06,960
lmg security a senior security

25
00:01:06,960 --> 00:01:08,720
consultant certified forensics examiner

26
00:01:08,720 --> 00:01:10,000
and head of r d

27
00:01:10,000 --> 00:01:11,360
together with our colleague karen

28
00:01:11,360 --> 00:01:12,960
springer we have a new book coming out

29
00:01:12,960 --> 00:01:15,360
on ransomware and cyber extortion so

30
00:01:15,360 --> 00:01:16,799
check it out should be out by the end of

31
00:01:16,799 --> 00:01:18,720
this year

32
00:01:18,720 --> 00:01:19,840
today we're going to start off by

33
00:01:19,840 --> 00:01:21,920
talking about why we need to adapt our

34
00:01:21,920 --> 00:01:23,920
incident response processes and how the

35
00:01:23,920 --> 00:01:26,560
attackers tactics are changing we'll use

36
00:01:26,560 --> 00:01:28,640
solarwinds as an example and step

37
00:01:28,640 --> 00:01:30,720
through that to discuss our new

38
00:01:30,720 --> 00:01:32,159
checklist and things that you need to

39
00:01:32,159 --> 00:01:33,759
include in your incident response

40
00:01:33,759 --> 00:01:36,079
processes then we're going to flip over

41
00:01:36,079 --> 00:01:38,720
to a zero day exploit and analyze the

42
00:01:38,720 --> 00:01:40,320
microsoft exchange zero day

43
00:01:40,320 --> 00:01:41,920
vulnerability that was announced in

44
00:01:41,920 --> 00:01:44,240
early 2020 and finally we're going to

45
00:01:44,240 --> 00:01:46,720
dig into the cassaya attacks and apply

46
00:01:46,720 --> 00:01:49,360
our new checklist to this recent hack

47
00:01:49,360 --> 00:01:50,640
along the way we're going to talk about

48
00:01:50,640 --> 00:01:52,399
how incident response needs to evolve

49
00:01:52,399 --> 00:01:53,840
and we'll leave you at the end with that

50
00:01:53,840 --> 00:01:56,479
checklist that you can use

51
00:01:56,479 --> 00:01:58,880
so of course recently we saw uh in the

52
00:01:58,880 --> 00:02:01,360
news that casseya was hacked kasey of

53
00:02:01,360 --> 00:02:02,719
course is remote management and

54
00:02:02,719 --> 00:02:04,399
monitoring software that's used by

55
00:02:04,399 --> 00:02:06,399
enterprises and also managed service

56
00:02:06,399 --> 00:02:08,479
providers to gain remote access to

57
00:02:08,479 --> 00:02:10,479
networks around the world multiple

58
00:02:10,479 --> 00:02:12,720
zero-day exploits were discovered back

59
00:02:12,720 --> 00:02:14,879
in april and hackers were able to

60
00:02:14,879 --> 00:02:16,959
exploit those in july

61
00:02:16,959 --> 00:02:18,800
the rival ransomware gang and an

62
00:02:18,800 --> 00:02:21,040
affiliate of that deployed ransomware to

63
00:02:21,040 --> 00:02:24,239
at least 1500 organizations that we know

64
00:02:24,239 --> 00:02:27,120
of this is the largest ransomware attack

65
00:02:27,120 --> 00:02:29,680
on record

66
00:02:29,680 --> 00:02:32,080
so again this is just another of the

67
00:02:32,080 --> 00:02:34,319
recent mass zero days and supply chain

68
00:02:34,319 --> 00:02:36,640
exploitations that we've seen from solar

69
00:02:36,640 --> 00:02:39,280
winds to blackbaud to microsoft exchange

70
00:02:39,280 --> 00:02:41,680
to excellian and many many more and even

71
00:02:41,680 --> 00:02:43,280
though these are slightly different

72
00:02:43,280 --> 00:02:45,440
types of incidents our response will

73
00:02:45,440 --> 00:02:47,840
have many similarities so there's some

74
00:02:47,840 --> 00:02:49,519
debate over whether something like the

75
00:02:49,519 --> 00:02:52,640
cassaya rmm exploit counts as a supply

76
00:02:52,640 --> 00:02:55,200
chain attack so we like to summarize it

77
00:02:55,200 --> 00:02:57,040
in this way supply chain attacks are

78
00:02:57,040 --> 00:02:58,080
where the vector is through a

79
00:02:58,080 --> 00:03:00,400
third-party technology vendor whereas a

80
00:03:00,400 --> 00:03:02,400
mass zero day exploit is when the

81
00:03:02,400 --> 00:03:04,480
exploitation occurs after the software

82
00:03:04,480 --> 00:03:06,319
is already deployed in the victim

83
00:03:06,319 --> 00:03:08,560
environment and again the response is

84
00:03:08,560 --> 00:03:11,360
surprisingly similar as we'll see

85
00:03:11,360 --> 00:03:13,280
let's take solar winds as our first

86
00:03:13,280 --> 00:03:15,440
example we're going to dissect this so

87
00:03:15,440 --> 00:03:17,680
fireeye announced that they had suffered

88
00:03:17,680 --> 00:03:19,599
a supply chain malware infection in

89
00:03:19,599 --> 00:03:21,760
december of 2020. so they had been

90
00:03:21,760 --> 00:03:23,280
hatched some of their offensive tools

91
00:03:23,280 --> 00:03:25,680
were leaked and they notified the public

92
00:03:25,680 --> 00:03:27,920
now they were able to trace this back to

93
00:03:27,920 --> 00:03:31,360
a back door in the solar winds platform

94
00:03:31,360 --> 00:03:33,280
their orion network monitoring software

95
00:03:33,280 --> 00:03:35,280
is widely used by organizations around

96
00:03:35,280 --> 00:03:37,440
the world and the unfortunate thing is

97
00:03:37,440 --> 00:03:39,280
that this meant that criminals had

98
00:03:39,280 --> 00:03:41,280
installed a back door to approximately

99
00:03:41,280 --> 00:03:44,480
18 000 customer networks

100
00:03:44,480 --> 00:03:46,760
now solar winds have been hacked since

101
00:03:46,760 --> 00:03:50,560
2019 september of 2019 and this was a

102
00:03:50,560 --> 00:03:52,239
little bit shocking because again the

103
00:03:52,239 --> 00:03:54,000
first time that this was publicized in

104
00:03:54,000 --> 00:03:56,959
this was in december of 2020 so think

105
00:03:56,959 --> 00:03:59,200
about how does your response team find

106
00:03:59,200 --> 00:04:01,599
out about a supply chain attack in the

107
00:04:01,599 --> 00:04:04,159
case of solar winds the criminals went

108
00:04:04,159 --> 00:04:06,080
went hands-on to the solarwinds network

109
00:04:06,080 --> 00:04:09,200
and did some test deployment of code

110
00:04:09,200 --> 00:04:12,159
starting in the fall of 2019. by march

111
00:04:12,159 --> 00:04:14,239
they had actually rolled out that back

112
00:04:14,239 --> 00:04:16,238
door into the platform and customers

113
00:04:16,238 --> 00:04:18,399
started to install it the code was

114
00:04:18,399 --> 00:04:20,560
properly signed by solarwinds and so

115
00:04:20,560 --> 00:04:22,000
there was really nothing to indicate

116
00:04:22,000 --> 00:04:23,680
that there was a problem

117
00:04:23,680 --> 00:04:25,440
shortly thereafter the criminals started

118
00:04:25,440 --> 00:04:27,759
actually reaching out into customer

119
00:04:27,759 --> 00:04:30,160
networks and interacting with customer

120
00:04:30,160 --> 00:04:32,400
networks getting hands-on access to

121
00:04:32,400 --> 00:04:34,639
their enterprises as well

122
00:04:34,639 --> 00:04:37,120
again it was still many months before

123
00:04:37,120 --> 00:04:39,440
any customer that we know of detected

124
00:04:39,440 --> 00:04:42,320
this and publicly reported it and

125
00:04:42,320 --> 00:04:44,400
fireeye one of their customers was

126
00:04:44,400 --> 00:04:46,080
actually the first to announce it not

127
00:04:46,080 --> 00:04:48,000
the vendor themselves which has some

128
00:04:48,000 --> 00:04:50,400
implications for our threat intelligence

129
00:04:50,400 --> 00:04:51,840
you may be looking for notifications

130
00:04:51,840 --> 00:04:54,160
from their vendor from your vendors when

131
00:04:54,160 --> 00:04:56,160
really the notifications may come from a

132
00:04:56,160 --> 00:04:57,600
different third party and you also have

133
00:04:57,600 --> 00:04:58,960
to think about how how much can you

134
00:04:58,960 --> 00:05:01,600
trust those notifications so we need to

135
00:05:01,600 --> 00:05:04,080
be monitoring threat intelligence

136
00:05:04,080 --> 00:05:06,960
platforms so identify your key software

137
00:05:06,960 --> 00:05:08,720
products and suppliers what do you need

138
00:05:08,720 --> 00:05:10,479
to be monitoring what announcements you

139
00:05:10,479 --> 00:05:12,240
need do you need to be watching for and

140
00:05:12,240 --> 00:05:14,080
then set up your threat intelligence

141
00:05:14,080 --> 00:05:16,479
sources so think about receiving vendor

142
00:05:16,479 --> 00:05:18,320
alerts uh getting you know following

143
00:05:18,320 --> 00:05:20,080
your vendors on twitter things like that

144
00:05:20,080 --> 00:05:21,759
it's actually very effective even though

145
00:05:21,759 --> 00:05:23,600
it's low low tech

146
00:05:23,600 --> 00:05:25,680
also you can subscribe to various threat

147
00:05:25,680 --> 00:05:27,199
intelligence platforms there's

148
00:05:27,199 --> 00:05:30,000
commercial options you can also you can

149
00:05:30,000 --> 00:05:32,000
also follow security vendors critical

150
00:05:32,000 --> 00:05:34,160
stack crowdstrike and others

151
00:05:34,160 --> 00:05:36,960
academic organizations and security

152
00:05:36,960 --> 00:05:39,039
training companies like sans are very

153
00:05:39,039 --> 00:05:40,960
good at announcing these also government

154
00:05:40,960 --> 00:05:42,000
agencies

155
00:05:42,000 --> 00:05:44,000
tend to circulate this type of news this

156
00:05:44,000 --> 00:05:45,759
is the carbon black threat research

157
00:05:45,759 --> 00:05:48,479
center which is a community driven

158
00:05:48,479 --> 00:05:50,479
threat research repository offered by

159
00:05:50,479 --> 00:05:52,160
the vmware carbon black company we use

160
00:05:52,160 --> 00:05:53,360
them a lot when we're when we're

161
00:05:53,360 --> 00:05:55,280
responding to incidents and uh it's a

162
00:05:55,280 --> 00:05:56,880
it's a great place to find updates and

163
00:05:56,880 --> 00:05:59,360
indicators of compromise for new and out

164
00:05:59,360 --> 00:06:01,759
or kind of upcoming cyber attacks before

165
00:06:01,759 --> 00:06:03,280
they really hit any of the mainstream

166
00:06:03,280 --> 00:06:05,360
media feeds also think about whether

167
00:06:05,360 --> 00:06:07,280
your suppliers are also monitoring for

168
00:06:07,280 --> 00:06:09,120
threat intelligence what software do

169
00:06:09,120 --> 00:06:11,039
they rely on that is then deployed to

170
00:06:11,039 --> 00:06:13,680
you or that affects your risk

171
00:06:13,680 --> 00:06:15,280
the next thing you do you need to do

172
00:06:15,280 --> 00:06:17,280
once you hear about an alert involving a

173
00:06:17,280 --> 00:06:19,199
vendor that relates to you is you need

174
00:06:19,199 --> 00:06:22,000
to evaluate your risk so in the case of

175
00:06:22,000 --> 00:06:24,560
solarwinds we knew where we found out

176
00:06:24,560 --> 00:06:26,560
early on what versions of their software

177
00:06:26,560 --> 00:06:28,479
were affected but it still wasn't

178
00:06:28,479 --> 00:06:30,720
trivial to figure out exactly who was

179
00:06:30,720 --> 00:06:32,000
impacted

180
00:06:32,000 --> 00:06:33,919
some organizations were running that

181
00:06:33,919 --> 00:06:35,919
version of the software others had never

182
00:06:35,919 --> 00:06:38,560
patched or never upgraded and in fact we

183
00:06:38,560 --> 00:06:39,360
found

184
00:06:39,360 --> 00:06:42,639
organizations that had been very slow

185
00:06:42,639 --> 00:06:44,000
and didn't keep their software up to

186
00:06:44,000 --> 00:06:46,000
date weren't impacted by this issue so

187
00:06:46,000 --> 00:06:47,840
they kind of dodged a bullet but i'm not

188
00:06:47,840 --> 00:06:50,080
sure we really need an incentive to not

189
00:06:50,080 --> 00:06:52,000
apply patches yeah again we don't want

190
00:06:52,000 --> 00:06:53,360
to we don't want to recommend uh

191
00:06:53,360 --> 00:06:55,039
skipping security patches on your on

192
00:06:55,039 --> 00:06:56,400
your systems but in this case it did

193
00:06:56,400 --> 00:06:58,800
save a few people yeah

194
00:06:58,800 --> 00:07:00,319
in some cases you also need to think

195
00:07:00,319 --> 00:07:01,280
about

196
00:07:01,280 --> 00:07:04,000
the window of compromise so

197
00:07:04,000 --> 00:07:05,680
were you running an affected version

198
00:07:05,680 --> 00:07:07,599
during that period of compromise you

199
00:07:07,599 --> 00:07:08,800
might need to look at your change

200
00:07:08,800 --> 00:07:10,800
management logs now what do you do if

201
00:07:10,800 --> 00:07:12,639
you're not sure again often in these

202
00:07:12,639 --> 00:07:14,560
early phase phases you may not be

203
00:07:14,560 --> 00:07:16,160
certain if you're impacted and we need

204
00:07:16,160 --> 00:07:18,240
to take quick action with very little

205
00:07:18,240 --> 00:07:20,960
information so talk ahead of time about

206
00:07:20,960 --> 00:07:22,400
whether or not you should take down

207
00:07:22,400 --> 00:07:24,960
software that might be impacted and what

208
00:07:24,960 --> 00:07:27,199
the balance is between taking action

209
00:07:27,199 --> 00:07:29,680
versus keeping things online you also

210
00:07:29,680 --> 00:07:31,120
want to coordinate with your suppliers

211
00:07:31,120 --> 00:07:33,039
if there's a supplier running software

212
00:07:33,039 --> 00:07:35,199
on your behalf ask them ahead of time

213
00:07:35,199 --> 00:07:37,599
how will you react um when will you get

214
00:07:37,599 --> 00:07:39,759
notified will they be

215
00:07:39,759 --> 00:07:42,160
changing your software on the fly or

216
00:07:42,160 --> 00:07:44,479
coordinating with you

217
00:07:44,479 --> 00:07:46,800
one new tool that we have in our arsenal

218
00:07:46,800 --> 00:07:49,919
is a software bill of materials s-bomb

219
00:07:49,919 --> 00:07:52,240
so recently there was an executive order

220
00:07:52,240 --> 00:07:54,000
from the white house and one of the

221
00:07:54,000 --> 00:07:55,680
things that was required was a software

222
00:07:55,680 --> 00:07:57,360
bill of materials for any suppliers that

223
00:07:57,360 --> 00:07:59,120
do business with the government and we

224
00:07:59,120 --> 00:08:00,639
do anticipate that this will trickle

225
00:08:00,639 --> 00:08:02,960
down to the public sooner or later so

226
00:08:02,960 --> 00:08:05,120
that means that any software you rely on

227
00:08:05,120 --> 00:08:08,240
or suppliers may have to produce a list

228
00:08:08,240 --> 00:08:10,800
of software that they rely on now this

229
00:08:10,800 --> 00:08:12,479
is going to become in part of our

230
00:08:12,479 --> 00:08:14,400
incident response processes over the

231
00:08:14,400 --> 00:08:16,879
next few years because you will have the

232
00:08:16,879 --> 00:08:19,440
if if this comes to pass you may have

233
00:08:19,440 --> 00:08:22,240
the ability to review those s-bombs when

234
00:08:22,240 --> 00:08:24,400
there's an announcement to determine

235
00:08:24,400 --> 00:08:26,479
what your risk is of

236
00:08:26,479 --> 00:08:28,479
downstream compromise because of

237
00:08:28,479 --> 00:08:30,319
software that your vendors are relying

238
00:08:30,319 --> 00:08:32,080
on so stay tuned

239
00:08:32,080 --> 00:08:33,919
we do expect to see incident response

240
00:08:33,919 --> 00:08:36,000
practices evolving and taking into

241
00:08:36,000 --> 00:08:37,599
account increased availability of

242
00:08:37,599 --> 00:08:40,880
software bills of materials

243
00:08:40,880 --> 00:08:42,719
all right so let's get back to solar

244
00:08:42,719 --> 00:08:44,399
winds so in the case of solar winds we

245
00:08:44,399 --> 00:08:46,560
want to evaluate our risk and what is

246
00:08:46,560 --> 00:08:48,560
the risk of a potential data breach or

247
00:08:48,560 --> 00:08:52,000
widespread attack or a lurking piece of

248
00:08:52,000 --> 00:08:53,200
malware within our network well

249
00:08:53,200 --> 00:08:55,600
unfortunately it was very high once the

250
00:08:55,600 --> 00:08:56,880
solarwinds

251
00:08:56,880 --> 00:08:59,120
adversary had access to customer

252
00:08:59,120 --> 00:09:00,720
networks they could really do whatever

253
00:09:00,720 --> 00:09:02,560
they wanted so they could steal files

254
00:09:02,560 --> 00:09:04,160
they could install new software they

255
00:09:04,160 --> 00:09:05,760
could gather information about your

256
00:09:05,760 --> 00:09:08,320
network disable security tools we saw a

257
00:09:08,320 --> 00:09:10,880
lot of evasive behavior

258
00:09:10,880 --> 00:09:12,640
they were deliberately trying to avoid

259
00:09:12,640 --> 00:09:14,240
detection and that's why they were so

260
00:09:14,240 --> 00:09:16,399
successful so there was a very high risk

261
00:09:16,399 --> 00:09:18,800
of a breach the good thing is that in

262
00:09:18,800 --> 00:09:21,279
the government advisory the csi advisory

263
00:09:21,279 --> 00:09:23,120
they specifically said hey you're going

264
00:09:23,120 --> 00:09:24,720
to want to forensically image system

265
00:09:24,720 --> 00:09:27,279
memory and or host operating systems if

266
00:09:27,279 --> 00:09:29,360
you have that capability

267
00:09:29,360 --> 00:09:30,959
so remember when there's a risk of a

268
00:09:30,959 --> 00:09:32,800
breach you probably want to pull in your

269
00:09:32,800 --> 00:09:34,560
cyber insurer your breach coach your

270
00:09:34,560 --> 00:09:36,720
forensics team and really think about

271
00:09:36,720 --> 00:09:38,560
preserving that evidence in a lot of

272
00:09:38,560 --> 00:09:40,240
these cases especially with a zero day

273
00:09:40,240 --> 00:09:42,000
or a supplier compromise we have to act

274
00:09:42,000 --> 00:09:43,200
quickly with very very little

275
00:09:43,200 --> 00:09:44,480
information about what is actually

276
00:09:44,480 --> 00:09:46,560
happening with the system advisories and

277
00:09:46,560 --> 00:09:47,839
early information can help but it's

278
00:09:47,839 --> 00:09:49,839
usually largely incomplete data so we go

279
00:09:49,839 --> 00:09:51,360
with standard options uh you know if

280
00:09:51,360 --> 00:09:52,640
we're going for the nuclear option we

281
00:09:52,640 --> 00:09:54,080
can yank the power cable we can yank the

282
00:09:54,080 --> 00:09:56,000
network cable uh and then it's kind of a

283
00:09:56,000 --> 00:09:57,600
general step we want to do system-wide

284
00:09:57,600 --> 00:09:59,040
password resets but there are impacts

285
00:09:59,040 --> 00:10:00,640
that we need to be concerned with are

286
00:10:00,640 --> 00:10:02,079
there going to be operational impacts to

287
00:10:02,079 --> 00:10:03,680
the organization if we take this service

288
00:10:03,680 --> 00:10:05,360
offline are there going to be help desk

289
00:10:05,360 --> 00:10:06,959
calls is is the help desk department

290
00:10:06,959 --> 00:10:09,600
going to be overwhelmed by tech support

291
00:10:09,600 --> 00:10:11,519
now pulling a plug on solarwinds

292
00:10:11,519 --> 00:10:12,959
unfortunately might not have saved

293
00:10:12,959 --> 00:10:14,720
people who were impacted directly by

294
00:10:14,720 --> 00:10:16,959
this by this vulnerability solarwinds

295
00:10:16,959 --> 00:10:18,480
was a multi-component attack the back

296
00:10:18,480 --> 00:10:20,000
door the original backdoor was in the

297
00:10:20,000 --> 00:10:21,519
solarwind software but the attackers

298
00:10:21,519 --> 00:10:23,680
rarely stayed within that system uh they

299
00:10:23,680 --> 00:10:25,200
would move laterally into other systems

300
00:10:25,200 --> 00:10:26,720
and in most cases we saw them deploying

301
00:10:26,720 --> 00:10:28,480
things like cobalt strike beacons these

302
00:10:28,480 --> 00:10:30,079
were used for both lateral movement and

303
00:10:30,079 --> 00:10:32,160
for persistence inside of the network so

304
00:10:32,160 --> 00:10:33,920
taking the the solar one server offline

305
00:10:33,920 --> 00:10:36,320
was great but if they had a if they had

306
00:10:36,320 --> 00:10:37,440
a beacon or some other means of

307
00:10:37,440 --> 00:10:38,880
accessing the network it was a little

308
00:10:38,880 --> 00:10:40,480
too late at that point to really rely on

309
00:10:40,480 --> 00:10:42,000
that uh and cobalt strike is something

310
00:10:42,000 --> 00:10:44,399
we're seeing in a lot of new uh new

311
00:10:44,399 --> 00:10:45,920
adversary attacks i mean it's become a

312
00:10:45,920 --> 00:10:47,519
very very common occurrence especially

313
00:10:47,519 --> 00:10:49,360
in ransomware and system compromise uh

314
00:10:49,360 --> 00:10:51,200
to see these legitimate tools being uh

315
00:10:51,200 --> 00:10:53,040
being used by malicious actors yeah

316
00:10:53,040 --> 00:10:54,560
that's a recurring theme

317
00:10:54,560 --> 00:10:56,640
so that that brings up our very

318
00:10:56,640 --> 00:10:58,079
important next point uh threat hunting

319
00:10:58,079 --> 00:11:00,000
needs to be included in everyone's ir

320
00:11:00,000 --> 00:11:01,279
plans this needs to be standard

321
00:11:01,279 --> 00:11:02,880
operating procedure for any kind of

322
00:11:02,880 --> 00:11:05,200
malicious or remediation activities that

323
00:11:05,200 --> 00:11:07,040
are taking place uh we tend to use

324
00:11:07,040 --> 00:11:08,640
carbon black when we do our incident

325
00:11:08,640 --> 00:11:10,480
response and here's an example of that

326
00:11:10,480 --> 00:11:12,880
this is an example of us finding a a

327
00:11:12,880 --> 00:11:14,720
cobalt strike beacon dropper being

328
00:11:14,720 --> 00:11:15,920
executed on the network and that's

329
00:11:15,920 --> 00:11:18,399
executing using powershell and a base64

330
00:11:18,399 --> 00:11:20,320
encoded command this is something that

331
00:11:20,320 --> 00:11:21,519
is kind of a hallmark for a lot of

332
00:11:21,519 --> 00:11:23,040
malicious activity we'll see when we

333
00:11:23,040 --> 00:11:24,720
talk about exchange as well

334
00:11:24,720 --> 00:11:25,680
but

335
00:11:25,680 --> 00:11:27,440
knowing this ahead of time means that uh

336
00:11:27,440 --> 00:11:29,519
we we need to be careful there are other

337
00:11:29,519 --> 00:11:31,360
pieces of the network that may use the

338
00:11:31,360 --> 00:11:33,279
exact same tactics and procedures that

339
00:11:33,279 --> 00:11:35,519
uh the malicious adversaries are using

340
00:11:35,519 --> 00:11:37,279
that may or may not be malicious at all

341
00:11:37,279 --> 00:11:39,600
a good example of that is well ansible

342
00:11:39,600 --> 00:11:41,279
so in a couple of the networks we were

343
00:11:41,279 --> 00:11:42,720
working with we're actively looking for

344
00:11:42,720 --> 00:11:44,079
these these cobalt straight beacon

345
00:11:44,079 --> 00:11:45,519
payloads and again that's a powershell

346
00:11:45,519 --> 00:11:48,079
command running a base64 encoded string

347
00:11:48,079 --> 00:11:50,320
that then acts to install the beacon

348
00:11:50,320 --> 00:11:52,480
ansible functions in a very very similar

349
00:11:52,480 --> 00:11:54,560
way for network automation so if we're

350
00:11:54,560 --> 00:11:56,480
taking steps to block encoded powershell

351
00:11:56,480 --> 00:11:57,920
usage we could also be breaking a

352
00:11:57,920 --> 00:11:59,279
critical component of the system at the

353
00:11:59,279 --> 00:12:01,760
same time again not a not a new tactic

354
00:12:01,760 --> 00:12:03,519
but something that especially with these

355
00:12:03,519 --> 00:12:04,800
these newer kinds of attacks and the

356
00:12:04,800 --> 00:12:06,079
sophistication of networks that we're

357
00:12:06,079 --> 00:12:07,600
working with we need to be very very

358
00:12:07,600 --> 00:12:09,519
cognizant of as we move forward with

359
00:12:09,519 --> 00:12:11,360
response so i think this really gets to

360
00:12:11,360 --> 00:12:13,040
the point you need to be prepared to do

361
00:12:13,040 --> 00:12:14,720
threat hunting so have the tools in

362
00:12:14,720 --> 00:12:16,320
place that you're going to want to use

363
00:12:16,320 --> 00:12:17,920
and understand what you're going to be

364
00:12:17,920 --> 00:12:19,360
looking for to avoid these false

365
00:12:19,360 --> 00:12:21,200
positives or be prepared to pull in a

366
00:12:21,200 --> 00:12:23,360
third party if necessary that's that's

367
00:12:23,360 --> 00:12:24,399
totally right

368
00:12:24,399 --> 00:12:25,760
so the next thing we want to think about

369
00:12:25,760 --> 00:12:26,800
since we are going to be doing threat

370
00:12:26,800 --> 00:12:28,720
hunting is how do we do that effectively

371
00:12:28,720 --> 00:12:30,639
in one of these new these new types of

372
00:12:30,639 --> 00:12:31,920
cyber attacks something that we know

373
00:12:31,920 --> 00:12:34,000
very little about uh first we need to

374
00:12:34,000 --> 00:12:35,920
obtain the indicators of compromise that

375
00:12:35,920 --> 00:12:37,920
we have available for us when these

376
00:12:37,920 --> 00:12:39,600
first break out now in the case of

377
00:12:39,600 --> 00:12:41,440
solarwinds we had indicators of

378
00:12:41,440 --> 00:12:43,120
compromise provided by both fireeye and

379
00:12:43,120 --> 00:12:44,959
microsoft very very early in the

380
00:12:44,959 --> 00:12:46,639
outbreak they were two of the more

381
00:12:46,639 --> 00:12:48,480
highly impacted organizations that were

382
00:12:48,480 --> 00:12:49,760
public about it anyway and those were

383
00:12:49,760 --> 00:12:51,839
pretty reliable indicators of compromise

384
00:12:51,839 --> 00:12:53,440
so we were lucky in that respect exactly

385
00:12:53,440 --> 00:12:54,639
we could trust the data we were getting

386
00:12:54,639 --> 00:12:56,000
from them we also had some good

387
00:12:56,000 --> 00:12:57,600
indicators of compromise provided by the

388
00:12:57,600 --> 00:12:59,680
u.s government from sisa they offered

389
00:12:59,680 --> 00:13:01,360
things like hash values specific pieces

390
00:13:01,360 --> 00:13:03,040
of behavioral activity to look for it

391
00:13:03,040 --> 00:13:04,639
was very good

392
00:13:04,639 --> 00:13:05,920
other times you can look for the vendor

393
00:13:05,920 --> 00:13:08,160
the vendor may release these uh these

394
00:13:08,160 --> 00:13:10,079
assistant guides to help you hunt for

395
00:13:10,079 --> 00:13:11,760
these these malicious infections inside

396
00:13:11,760 --> 00:13:13,680
your network uh next security firms and

397
00:13:13,680 --> 00:13:15,200
researchers are are usually a pretty

398
00:13:15,200 --> 00:13:16,720
good resource although we do have to vet

399
00:13:16,720 --> 00:13:17,839
those a little bit more carefully

400
00:13:17,839 --> 00:13:19,440
because really anyone can put up a blog

401
00:13:19,440 --> 00:13:20,399
post

402
00:13:20,399 --> 00:13:21,600
and then thread hunting and intelligence

403
00:13:21,600 --> 00:13:23,440
software so things like carbon black

404
00:13:23,440 --> 00:13:24,880
what you see on the screen here is a

405
00:13:24,880 --> 00:13:26,240
list out of the watch list they're

406
00:13:26,240 --> 00:13:27,680
available through the carbon black edr

407
00:13:27,680 --> 00:13:28,720
tool kit

408
00:13:28,720 --> 00:13:30,800
and they are subscription feeds that are

409
00:13:30,800 --> 00:13:32,320
regularly updated that we can use to

410
00:13:32,320 --> 00:13:33,519
assist in these threat homes so things

411
00:13:33,519 --> 00:13:36,240
like us cybercom amc uh built-in miter

412
00:13:36,240 --> 00:13:38,000
attack framework notifications are

413
00:13:38,000 --> 00:13:39,760
really helpful here there's also open

414
00:13:39,760 --> 00:13:41,279
source threat intelligent projects like

415
00:13:41,279 --> 00:13:43,519
misp misc is a

416
00:13:43,519 --> 00:13:46,079
you know a very good source of community

417
00:13:46,079 --> 00:13:47,600
driven information that can be used and

418
00:13:47,600 --> 00:13:49,440
directly integrated into a lot of ids

419
00:13:49,440 --> 00:13:50,880
systems so definitely something to watch

420
00:13:50,880 --> 00:13:51,920
out for

421
00:13:51,920 --> 00:13:53,760
and then also structured formats for

422
00:13:53,760 --> 00:13:54,959
these are really good to be familiar

423
00:13:54,959 --> 00:13:56,560
with so if you're not familiar with yara

424
00:13:56,560 --> 00:13:57,600
or styx

425
00:13:57,600 --> 00:13:58,880
take a little bit of time get familiar

426
00:13:58,880 --> 00:14:00,240
with it they can be incredibly useful

427
00:14:00,240 --> 00:14:02,000
for quickly identifying indicators of

428
00:14:02,000 --> 00:14:03,440
compromise on your network without

429
00:14:03,440 --> 00:14:04,639
having to sift through a lot of

430
00:14:04,639 --> 00:14:06,720
superfluous data now if you want to have

431
00:14:06,720 --> 00:14:08,000
an effective response you're not going

432
00:14:08,000 --> 00:14:10,240
to be able to assemble these on the fly

433
00:14:10,240 --> 00:14:11,680
in the heat of the moment and have a

434
00:14:11,680 --> 00:14:13,680
really effective thread hunting campaign

435
00:14:13,680 --> 00:14:15,680
so again you want to understand ahead of

436
00:14:15,680 --> 00:14:16,880
time where you're going to get your

437
00:14:16,880 --> 00:14:18,560
indicators of compromise and make sure

438
00:14:18,560 --> 00:14:21,680
that they're sources you can trust

439
00:14:21,680 --> 00:14:23,360
so in this case

440
00:14:23,360 --> 00:14:25,040
one of the challenges was that this was

441
00:14:25,040 --> 00:14:27,360
a nation-state attack so

442
00:14:27,360 --> 00:14:29,279
there are there are sources of evidence

443
00:14:29,279 --> 00:14:31,279
that indicate this was nobelium which is

444
00:14:31,279 --> 00:14:33,440
a russian state-sponsored hacker

445
00:14:33,440 --> 00:14:35,360
microsoft believes that over a thousand

446
00:14:35,360 --> 00:14:37,279
developers contributed to that solar

447
00:14:37,279 --> 00:14:40,160
winds attack um 44

448
00:14:40,160 --> 00:14:42,240
of the organizations impacted by this

449
00:14:42,240 --> 00:14:44,320
were themselves information technology

450
00:14:44,320 --> 00:14:46,160
companies and i find that particularly

451
00:14:46,160 --> 00:14:48,160
scary because it means that the

452
00:14:48,160 --> 00:14:50,240
criminals uh the adversary could have

453
00:14:50,240 --> 00:14:51,760
gotten into not just solar winds and

454
00:14:51,760 --> 00:14:53,920
their customers but then customers of

455
00:14:53,920 --> 00:14:56,240
those customers so we anticipate that

456
00:14:56,240 --> 00:14:57,920
there will be ripple effects from this

457
00:14:57,920 --> 00:14:59,440
creating risk throughout the entire

458
00:14:59,440 --> 00:15:02,959
technology ecosystem for years to come

459
00:15:02,959 --> 00:15:04,639
now one of the things that made solar

460
00:15:04,639 --> 00:15:06,320
runs particularly difficult to uh to

461
00:15:06,320 --> 00:15:08,240
analyze especially at first was how

462
00:15:08,240 --> 00:15:09,680
difficult it was to actually obtain

463
00:15:09,680 --> 00:15:11,839
indicators of compromise from networks

464
00:15:11,839 --> 00:15:13,680
that were not actively experiencing an

465
00:15:13,680 --> 00:15:15,600
infection from the the sunburst malware

466
00:15:15,600 --> 00:15:17,440
at the time sunburst malware was

467
00:15:17,440 --> 00:15:19,360
specifically designed to evade detection

468
00:15:19,360 --> 00:15:20,720
and analysis so they employed things

469
00:15:20,720 --> 00:15:22,800
like a 12 to 14 day sleep timer

470
00:15:22,800 --> 00:15:24,480
verifications of very very specific

471
00:15:24,480 --> 00:15:26,320
solarwinds dll names before the software

472
00:15:26,320 --> 00:15:28,000
would execute random delays and

473
00:15:28,000 --> 00:15:29,600
execution which made sandboxing

474
00:15:29,600 --> 00:15:31,759
incredibly difficult multiple domain

475
00:15:31,759 --> 00:15:33,120
checks and then security analysis and

476
00:15:33,120 --> 00:15:34,560
software checks again they designed this

477
00:15:34,560 --> 00:15:37,120
to not be analyzed and it made it very

478
00:15:37,120 --> 00:15:38,720
very difficult at first

479
00:15:38,720 --> 00:15:40,160
for individuals to obtain these

480
00:15:40,160 --> 00:15:41,440
indicators of compromise unless they

481
00:15:41,440 --> 00:15:43,120
have direct access to this running in

482
00:15:43,120 --> 00:15:46,079
the wild again this is our new norm so

483
00:15:46,079 --> 00:15:48,240
responders should expect those iocs to

484
00:15:48,240 --> 00:15:50,399
be updated throughout your response the

485
00:15:50,399 --> 00:15:52,800
initial iocs that you receive are

486
00:15:52,800 --> 00:15:54,639
probably just going to be a small subset

487
00:15:54,639 --> 00:15:57,040
of the ones that exist in the long term

488
00:15:57,040 --> 00:15:59,120
so you want to constantly get updates

489
00:15:59,120 --> 00:16:01,519
and be checking regularly 12 to 14 days

490
00:16:01,519 --> 00:16:03,120
is a pretty long period of time we're

491
00:16:03,120 --> 00:16:04,639
also seeing things like heavy decoy

492
00:16:04,639 --> 00:16:06,720
traffic being used in in pretty much

493
00:16:06,720 --> 00:16:08,000
every new piece of malware we're seeing

494
00:16:08,000 --> 00:16:09,839
banking trojans uh specifically are

495
00:16:09,839 --> 00:16:11,360
really bad about this

496
00:16:11,360 --> 00:16:13,600
basically what this means is the malware

497
00:16:13,600 --> 00:16:15,040
is going to generate its own malicious

498
00:16:15,040 --> 00:16:16,240
outbound traffic that it's sending it

499
00:16:16,240 --> 00:16:18,000
out or sending out to its own c2 servers

500
00:16:18,000 --> 00:16:19,519
but at the same time it's going to

501
00:16:19,519 --> 00:16:21,680
generate almost identical traffic that

502
00:16:21,680 --> 00:16:23,199
it's going to send out to a bunch of

503
00:16:23,199 --> 00:16:25,040
legitimate sources things like jquery

504
00:16:25,040 --> 00:16:27,120
google g static one tech company

505
00:16:27,120 --> 00:16:29,759
facebook yahoo uh the list is very very

506
00:16:29,759 --> 00:16:31,440
long here but again it obscures that

507
00:16:31,440 --> 00:16:32,800
outbound traffic and makes it very

508
00:16:32,800 --> 00:16:34,160
difficult to find unless you're

509
00:16:34,160 --> 00:16:37,360
specifically looking for it okay so our

510
00:16:37,360 --> 00:16:39,279
next step after you hunt for threats or

511
00:16:39,279 --> 00:16:40,560
while you're hunting for threats is you

512
00:16:40,560 --> 00:16:42,480
need to consider applying emergency

513
00:16:42,480 --> 00:16:44,720
patches and software updates so when you

514
00:16:44,720 --> 00:16:47,360
have a supplier like solarwinds

515
00:16:47,360 --> 00:16:49,440
that has an issue with their software

516
00:16:49,440 --> 00:16:51,920
they issued multiple patches to deal

517
00:16:51,920 --> 00:16:54,639
with it and again there wasn't even a

518
00:16:54,639 --> 00:16:56,160
patch for this when it was first

519
00:16:56,160 --> 00:16:58,240
announced so you can see that the first

520
00:16:58,240 --> 00:17:01,279
patch was released december 23rd of 2020

521
00:17:01,279 --> 00:17:02,800
and there were three patches released on

522
00:17:02,800 --> 00:17:04,959
that day another one was released in

523
00:17:04,959 --> 00:17:07,119
late january and two more were released

524
00:17:07,119 --> 00:17:09,520
in february so as responders you need to

525
00:17:09,520 --> 00:17:11,520
be aware of the fact that there will be

526
00:17:11,520 --> 00:17:13,599
emergency patches but they may not exist

527
00:17:13,599 --> 00:17:14,959
right away and so you need to have

528
00:17:14,959 --> 00:17:17,039
workarounds if they do exist they may

529
00:17:17,039 --> 00:17:19,520
not fully solve the problem they may be

530
00:17:19,520 --> 00:17:21,520
just a partial solution so you still

531
00:17:21,520 --> 00:17:24,000
need to take some other steps to reduce

532
00:17:24,000 --> 00:17:26,480
your risk and deal with it sometimes new

533
00:17:26,480 --> 00:17:28,559
patches can break things and that's a

534
00:17:28,559 --> 00:17:30,799
real balancing act

535
00:17:30,799 --> 00:17:33,760
we do need patches matt

536
00:17:33,760 --> 00:17:36,400
plan for elevated risks longer term this

537
00:17:36,400 --> 00:17:38,559
goes for you as well as any suppliers

538
00:17:38,559 --> 00:17:40,880
that may have been impacted so again

539
00:17:40,880 --> 00:17:43,280
solarwinds has now been hacked we know

540
00:17:43,280 --> 00:17:45,360
that and organizations that were

541
00:17:45,360 --> 00:17:46,799
leveraging their software many of them

542
00:17:46,799 --> 00:17:48,640
have been hacked as well the result of

543
00:17:48,640 --> 00:17:50,720
this is that hackers may have extensive

544
00:17:50,720 --> 00:17:52,640
data that they can leverage to launch

545
00:17:52,640 --> 00:17:54,559
future attacks that could include

546
00:17:54,559 --> 00:17:57,360
employee emails internal sensitive

547
00:17:57,360 --> 00:18:00,400
information passwords keys and more so

548
00:18:00,400 --> 00:18:02,240
this affects the risk of our entire

549
00:18:02,240 --> 00:18:04,640
software ecosystem that relies on that

550
00:18:04,640 --> 00:18:06,799
one supplier we've also seen the

551
00:18:06,799 --> 00:18:08,640
installation of advanced persistent

552
00:18:08,640 --> 00:18:10,640
threats and additional malware as matt

553
00:18:10,640 --> 00:18:12,000
alluded to

554
00:18:12,000 --> 00:18:13,760
criminals may also have obtained

555
00:18:13,760 --> 00:18:16,000
software source code and vulnerability

556
00:18:16,000 --> 00:18:18,080
details and that's something fairly

557
00:18:18,080 --> 00:18:19,919
common and then they can leverage that

558
00:18:19,919 --> 00:18:23,039
in future attacks if an msp is hacked

559
00:18:23,039 --> 00:18:24,880
you might see customer lists that get

560
00:18:24,880 --> 00:18:27,360
stolen or software providers as well and

561
00:18:27,360 --> 00:18:28,880
then again the criminals can go after

562
00:18:28,880 --> 00:18:31,679
them so remember this doesn't just apply

563
00:18:31,679 --> 00:18:33,840
to suppliers that are in the news in

564
00:18:33,840 --> 00:18:35,600
many cases suppliers may have been

565
00:18:35,600 --> 00:18:37,679
hacked and not detected it or may have

566
00:18:37,679 --> 00:18:39,520
been hacked and not reported it because

567
00:18:39,520 --> 00:18:41,360
there weren't any laws or contractual

568
00:18:41,360 --> 00:18:43,520
obligations in place at the time that

569
00:18:43,520 --> 00:18:47,280
required that level of of reporting

570
00:18:47,280 --> 00:18:49,360
so here's our checklist when we analyze

571
00:18:49,360 --> 00:18:51,200
the solar winds attack

572
00:18:51,200 --> 00:18:53,280
here are seven things that we need to

573
00:18:53,280 --> 00:18:55,280
think about integrating into modern

574
00:18:55,280 --> 00:18:56,960
incident response processes so number

575
00:18:56,960 --> 00:18:59,440
one we need to be proactively monitoring

576
00:18:59,440 --> 00:19:01,520
threat intelligence for the tools that

577
00:19:01,520 --> 00:19:03,039
we rely on

578
00:19:03,039 --> 00:19:05,120
you also need to have someone assigned

579
00:19:05,120 --> 00:19:07,679
to capture this information and evaluate

580
00:19:07,679 --> 00:19:09,120
the risk

581
00:19:09,120 --> 00:19:11,919
when a new risk is announced you need to

582
00:19:11,919 --> 00:19:13,919
consider preserving forensic evidence

583
00:19:13,919 --> 00:19:16,000
even before you step up to contain the

584
00:19:16,000 --> 00:19:18,080
damage and then threat hunting needs to

585
00:19:18,080 --> 00:19:20,080
be included in all of our response

586
00:19:20,080 --> 00:19:21,840
processes it just needs to be part of

587
00:19:21,840 --> 00:19:24,799
our new norm also expect emergency

588
00:19:24,799 --> 00:19:27,120
patches and emergency updates and have

589
00:19:27,120 --> 00:19:28,799
those conversations in advance about

590
00:19:28,799 --> 00:19:30,640
whether or not you want to apply them

591
00:19:30,640 --> 00:19:32,799
and finally plan for elevated risks that

592
00:19:32,799 --> 00:19:34,880
pertain to either your organization or

593
00:19:34,880 --> 00:19:37,360
your supplier

594
00:19:37,360 --> 00:19:38,880
all right now that we've analyzed a

595
00:19:38,880 --> 00:19:41,200
supply chain attack let's talk about how

596
00:19:41,200 --> 00:19:43,760
these same tactics apply to a mass

597
00:19:43,760 --> 00:19:45,280
zero-day vulnerability and a great

598
00:19:45,280 --> 00:19:47,039
example of this is the microsoft

599
00:19:47,039 --> 00:19:48,320
exchange vulnerability that was

600
00:19:48,320 --> 00:19:50,720
announced in the first quarter of 2020.

601
00:19:50,720 --> 00:19:52,320
so of course microsoft announced on

602
00:19:52,320 --> 00:19:54,640
march 2nd sorry 2021

603
00:19:54,640 --> 00:19:57,600
microsoft announced on march 2nd

604
00:19:57,600 --> 00:19:59,440
that there were zero-day vulnerabilities

605
00:19:59,440 --> 00:20:01,600
in the microsoft exchange software that

606
00:20:01,600 --> 00:20:03,520
many organizations around the world used

607
00:20:03,520 --> 00:20:05,440
to host email and they released those

608
00:20:05,440 --> 00:20:07,520
security updates but even before they

609
00:20:07,520 --> 00:20:09,280
released them organizations around the

610
00:20:09,280 --> 00:20:11,600
world had been hacked now the adversary

611
00:20:11,600 --> 00:20:14,080
behind this was linked to chinese

612
00:20:14,080 --> 00:20:16,159
state-sponsored hackers the hafnium

613
00:20:16,159 --> 00:20:18,480
group so again we saw some very advanced

614
00:20:18,480 --> 00:20:20,880
tactics deployed by march 5th we knew

615
00:20:20,880 --> 00:20:23,520
that at least 30 000 organizations were

616
00:20:23,520 --> 00:20:25,919
already hacked and when your email gets

617
00:20:25,919 --> 00:20:28,880
hacked you may have a major data breach

618
00:20:28,880 --> 00:20:31,039
on your hands or other fallout as a

619
00:20:31,039 --> 00:20:33,520
result of that email is very sensitive

620
00:20:33,520 --> 00:20:35,520
so what could the hackers do in this

621
00:20:35,520 --> 00:20:37,440
case well by exploiting these

622
00:20:37,440 --> 00:20:39,280
vulnerabilities they could gain full

623
00:20:39,280 --> 00:20:41,600
administrative control over this server

624
00:20:41,600 --> 00:20:43,600
they could steal your email they could

625
00:20:43,600 --> 00:20:45,600
steal credentials they could install

626
00:20:45,600 --> 00:20:47,440
more malware and pivot into your

627
00:20:47,440 --> 00:20:50,000
organization's network and infect other

628
00:20:50,000 --> 00:20:52,480
computers so this was a very high risk

629
00:20:52,480 --> 00:20:54,000
situation

630
00:20:54,000 --> 00:20:56,400
now how do we as responders find out

631
00:20:56,400 --> 00:20:58,320
about it well this is an interesting

632
00:20:58,320 --> 00:21:00,559
case to analyze we know that researchers

633
00:21:00,559 --> 00:21:01,919
discovered the vulnerabilities on

634
00:21:01,919 --> 00:21:05,360
january 5th 2021 and alerted microsoft

635
00:21:05,360 --> 00:21:07,120
microsoft actually responded fairly

636
00:21:07,120 --> 00:21:09,679
quickly compared to many suppliers they

637
00:21:09,679 --> 00:21:11,360
clearly jumped on this and worked hard

638
00:21:11,360 --> 00:21:13,679
to create patches but unfortunately the

639
00:21:13,679 --> 00:21:15,760
release did not happen quickly enough

640
00:21:15,760 --> 00:21:17,760
for many of their customers

641
00:21:17,760 --> 00:21:20,400
on february 23rd microsoft shared

642
00:21:20,400 --> 00:21:23,120
information about the attack with some

643
00:21:23,120 --> 00:21:26,320
of their partners and on february 26

644
00:21:26,320 --> 00:21:28,960
three days later attackers started to

645
00:21:28,960 --> 00:21:31,679
exploit it now the public was not yet

646
00:21:31,679 --> 00:21:33,840
aware of this so literally before most

647
00:21:33,840 --> 00:21:35,840
people even found out about it many

648
00:21:35,840 --> 00:21:37,520
exchange servers were already hacked

649
00:21:37,520 --> 00:21:39,520
most people found out on march 2nd when

650
00:21:39,520 --> 00:21:41,679
microsoft released patches but it was

651
00:21:41,679 --> 00:21:44,320
already too late by then and the next

652
00:21:44,320 --> 00:21:45,120
day

653
00:21:45,120 --> 00:21:46,960
tens of thousands of exchange surveys

654
00:21:46,960 --> 00:21:48,320
were already compromised so unless you

655
00:21:48,320 --> 00:21:50,640
were right on top of that and installed

656
00:21:50,640 --> 00:21:52,559
the patches right away chances are

657
00:21:52,559 --> 00:21:54,159
pretty good that you were already

658
00:21:54,159 --> 00:21:56,559
compromised in some form or fashion and

659
00:21:56,559 --> 00:21:59,280
even then it might have been too late

660
00:21:59,280 --> 00:22:00,720
so it's interesting to think about how

661
00:22:00,720 --> 00:22:02,480
that exploit actually got leaked out

662
00:22:02,480 --> 00:22:04,960
into the uh you know the hackers sphere

663
00:22:04,960 --> 00:22:07,360
uh devcor the uh the pen testing group

664
00:22:07,360 --> 00:22:08,159
that actually discovered the

665
00:22:08,159 --> 00:22:09,679
vulnerability kept things pretty

666
00:22:09,679 --> 00:22:11,360
tight-lipped but one of their testers

667
00:22:11,360 --> 00:22:13,280
who went by the name orange tsai noticed

668
00:22:13,280 --> 00:22:15,200
that the code that was being used by the

669
00:22:15,200 --> 00:22:16,799
by the adversaries in this case looked

670
00:22:16,799 --> 00:22:18,400
very very similar to the code he had

671
00:22:18,400 --> 00:22:20,480
submitted to actually report the exploit

672
00:22:20,480 --> 00:22:22,480
to microsoft up to and including the

673
00:22:22,480 --> 00:22:24,240
fact that the web shell password orange

674
00:22:24,240 --> 00:22:26,640
that he had hard coded into his exploit

675
00:22:26,640 --> 00:22:28,480
was being used by hackers in the wild so

676
00:22:28,480 --> 00:22:30,000
it got out somehow we're just not quite

677
00:22:30,000 --> 00:22:31,120
sure how

678
00:22:31,120 --> 00:22:33,679
yeah so one of the things um that people

679
00:22:33,679 --> 00:22:36,240
been wondering out about is was this

680
00:22:36,240 --> 00:22:37,919
leaked through microsoft active's

681
00:22:37,919 --> 00:22:40,320
protection program so this is a method

682
00:22:40,320 --> 00:22:42,480
where microsoft partners key partners

683
00:22:42,480 --> 00:22:44,960
get a heads up about upcoming patches

684
00:22:44,960 --> 00:22:46,240
and vulnerabilities so that they can

685
00:22:46,240 --> 00:22:48,880
prepare and support their customers

686
00:22:48,880 --> 00:22:51,120
unfortunately you know a small number of

687
00:22:51,120 --> 00:22:52,720
people may be able to keep a secret but

688
00:22:52,720 --> 00:22:55,760
can 82 possibly not

689
00:22:55,760 --> 00:22:57,520
now microsoft warns that if a map

690
00:22:57,520 --> 00:22:59,039
partner was the source of the leak they

691
00:22:59,039 --> 00:23:01,600
would face consequences unfortunately

692
00:23:01,600 --> 00:23:04,240
think about the um the attack surface

693
00:23:04,240 --> 00:23:06,400
here if any one of those partners had an

694
00:23:06,400 --> 00:23:08,640
email hack or some kind of compromise

695
00:23:08,640 --> 00:23:10,320
criminals might be able to steal

696
00:23:10,320 --> 00:23:12,640
information about these upcoming

697
00:23:12,640 --> 00:23:15,679
exploits and patches so and this is

698
00:23:15,679 --> 00:23:17,120
something that hackers are really

699
00:23:17,120 --> 00:23:18,159
targeting

700
00:23:18,159 --> 00:23:20,159
so that's something to consider is how

701
00:23:20,159 --> 00:23:22,559
that information gets distributed

702
00:23:22,559 --> 00:23:24,559
we know that historically hackers are

703
00:23:24,559 --> 00:23:26,000
actually very interested in bug

704
00:23:26,000 --> 00:23:27,919
information and source codes so that

705
00:23:27,919 --> 00:23:30,480
they can find vulnerabilities and

706
00:23:30,480 --> 00:23:31,840
exploit

707
00:23:31,840 --> 00:23:33,520
known issues

708
00:23:33,520 --> 00:23:35,360
for example and we also know that we

709
00:23:35,360 --> 00:23:36,880
don't necessarily get a heads up about

710
00:23:36,880 --> 00:23:39,280
these so for example microsoft's bug

711
00:23:39,280 --> 00:23:42,240
tracking database was hacked in 2013

712
00:23:42,240 --> 00:23:43,600
but the public didn't find out about

713
00:23:43,600 --> 00:23:46,320
that for four years four years later in

714
00:23:46,320 --> 00:23:49,120
2017 this finally hit the news and

715
00:23:49,120 --> 00:23:51,039
chances are pretty good that many other

716
00:23:51,039 --> 00:23:53,520
technology vendors have had similar

717
00:23:53,520 --> 00:23:55,360
issues where their networks have been

718
00:23:55,360 --> 00:23:57,039
hacked maybe their source code has been

719
00:23:57,039 --> 00:23:58,880
accessed or their bug tracking database

720
00:23:58,880 --> 00:24:00,480
has been accessed and either they

721
00:24:00,480 --> 00:24:02,400
haven't detected that or they haven't

722
00:24:02,400 --> 00:24:04,559
reported it because there's no legal or

723
00:24:04,559 --> 00:24:06,720
contractual obligation at that time for

724
00:24:06,720 --> 00:24:09,039
that particular firm researchers may

725
00:24:09,039 --> 00:24:11,200
also be targeted and many of these are

726
00:24:11,200 --> 00:24:13,679
not many many researchers are not

727
00:24:13,679 --> 00:24:14,960
deploying

728
00:24:14,960 --> 00:24:16,880
security technologies or staff that

729
00:24:16,880 --> 00:24:19,840
could rival nation-state attacks

730
00:24:19,840 --> 00:24:21,919
so again we have to think about the fact

731
00:24:21,919 --> 00:24:24,799
that bugs vulnerabilities all of this

732
00:24:24,799 --> 00:24:26,559
information may fall into the wrong

733
00:24:26,559 --> 00:24:28,720
hands before customers or the public

734
00:24:28,720 --> 00:24:30,840
have a chance to

735
00:24:30,840 --> 00:24:33,039
respond all right so with exchange how

736
00:24:33,039 --> 00:24:34,720
did he know if you were affected by the

737
00:24:34,720 --> 00:24:36,960
by the exchange zero day attack well

738
00:24:36,960 --> 00:24:38,240
unfortunately if you were running

739
00:24:38,240 --> 00:24:39,760
microsoft exchange in an on-premise

740
00:24:39,760 --> 00:24:40,960
server and it connected out to the

741
00:24:40,960 --> 00:24:42,720
public internet there's a really good

742
00:24:42,720 --> 00:24:44,400
chance that you were affected by this in

743
00:24:44,400 --> 00:24:46,480
one form or another this means that all

744
00:24:46,480 --> 00:24:48,240
the email data on the server and user

745
00:24:48,240 --> 00:24:50,080
data on the server is potentially a risk

746
00:24:50,080 --> 00:24:51,440
now the vulnerable code that was

747
00:24:51,440 --> 00:24:53,120
exploited in this uh this particular

748
00:24:53,120 --> 00:24:55,440
outbreak had been in place for over 10

749
00:24:55,440 --> 00:24:57,840
years in the the exchange code base for

750
00:24:57,840 --> 00:24:58,960
those who are counting that means it's

751
00:24:58,960 --> 00:25:01,120
been out since at least 2011 and this

752
00:25:01,120 --> 00:25:05,039
affected uh virgins 2010 2013 2016 2019

753
00:25:05,039 --> 00:25:07,360
the entire fleet of exchange products

754
00:25:07,360 --> 00:25:09,760
now once these exploits become or became

755
00:25:09,760 --> 00:25:10,640
public

756
00:25:10,640 --> 00:25:12,480
what we saw was a mass seeding event

757
00:25:12,480 --> 00:25:13,919
this meant that every hacker on the

758
00:25:13,919 --> 00:25:15,919
planet who now wanted to exploit these

759
00:25:15,919 --> 00:25:17,200
probably did

760
00:25:17,200 --> 00:25:18,799
this was going out to tens if not

761
00:25:18,799 --> 00:25:20,400
hundreds of thousands of active servers

762
00:25:20,400 --> 00:25:21,919
all across the country we were seeing

763
00:25:21,919 --> 00:25:23,760
organizations being or at least

764
00:25:23,760 --> 00:25:25,600
attempting to be compromised by multiple

765
00:25:25,600 --> 00:25:27,840
threat actors at the same time

766
00:25:27,840 --> 00:25:29,520
and really all you had to do was go on

767
00:25:29,520 --> 00:25:30,960
to something like showdown and look for

768
00:25:30,960 --> 00:25:32,240
exchange servers and that would give you

769
00:25:32,240 --> 00:25:34,000
your attack list and it was a reasonably

770
00:25:34,000 --> 00:25:36,080
simple exploit to execute everything was

771
00:25:36,080 --> 00:25:38,000
pre-scripted so these these adversaries

772
00:25:38,000 --> 00:25:39,919
became very very aggressive with their

773
00:25:39,919 --> 00:25:41,360
tactics and how to break into these

774
00:25:41,360 --> 00:25:42,880
servers

775
00:25:42,880 --> 00:25:44,400
so again in response we had to start

776
00:25:44,400 --> 00:25:46,080
with forensics preservation and this

777
00:25:46,080 --> 00:25:47,360
this needs to be one of the very first

778
00:25:47,360 --> 00:25:48,720
things that we think about it's often a

779
00:25:48,720 --> 00:25:50,400
time consuming process nobody wants to

780
00:25:50,400 --> 00:25:52,080
stop and do it but it's incredibly

781
00:25:52,080 --> 00:25:53,520
important so first we need to

782
00:25:53,520 --> 00:25:55,279
forensically image all of our exchange

783
00:25:55,279 --> 00:25:56,559
servers uh we need to obtain the

784
00:25:56,559 --> 00:25:57,840
volatile memory too because we want to

785
00:25:57,840 --> 00:25:59,279
know active network connections and

786
00:25:59,279 --> 00:26:01,200
active programs that were running on the

787
00:26:01,200 --> 00:26:03,200
computer when this actually happened

788
00:26:03,200 --> 00:26:04,559
and we want to preserve our network and

789
00:26:04,559 --> 00:26:06,320
iis logs this is really important

790
00:26:06,320 --> 00:26:08,000
because it's a potential business email

791
00:26:08,000 --> 00:26:09,200
compromise and business email

792
00:26:09,200 --> 00:26:11,520
compromises are serious business there

793
00:26:11,520 --> 00:26:13,039
is a lot of sensitive information in

794
00:26:13,039 --> 00:26:15,120
email there's a lot of recon information

795
00:26:15,120 --> 00:26:17,039
these are future target lists it's

796
00:26:17,039 --> 00:26:18,960
potential financial information medical

797
00:26:18,960 --> 00:26:20,880
information personal information

798
00:26:20,880 --> 00:26:22,240
a lot of stuff in there that we don't

799
00:26:22,240 --> 00:26:23,520
want getting out

800
00:26:23,520 --> 00:26:24,640
we then needed to go through and do a

801
00:26:24,640 --> 00:26:26,000
check for unauthorized access so we

802
00:26:26,000 --> 00:26:27,600
needed to see if the server was affected

803
00:26:27,600 --> 00:26:29,440
and if so how deep that access went and

804
00:26:29,440 --> 00:26:31,440
then we could determine the risk of both

805
00:26:31,440 --> 00:26:33,600
email access and acquisition and network

806
00:26:33,600 --> 00:26:35,919
compromise according to the fbi business

807
00:26:35,919 --> 00:26:38,080
email compromise cases were the route of

808
00:26:38,080 --> 00:26:41,679
1.8 billion dollars in cash losses last

809
00:26:41,679 --> 00:26:44,240
year so the dollar amount is high and

810
00:26:44,240 --> 00:26:45,760
the risk of a breach is high as well

811
00:26:45,760 --> 00:26:48,000
which is why we saw customers microsoft

812
00:26:48,000 --> 00:26:49,520
customers like the european banking

813
00:26:49,520 --> 00:26:52,159
authority announcing breaches um and

814
00:26:52,159 --> 00:26:53,919
there was a lot of fallout to this yeah

815
00:26:53,919 --> 00:26:56,080
there's there certainly was uh next just

816
00:26:56,080 --> 00:26:57,440
like solar winds we need to contain the

817
00:26:57,440 --> 00:27:00,080
damage so we need to act well yesterday

818
00:27:00,080 --> 00:27:01,600
on these things literally we cannot

819
00:27:01,600 --> 00:27:02,960
leave these servers online if they're if

820
00:27:02,960 --> 00:27:04,960
they're that one time everybody yeah

821
00:27:04,960 --> 00:27:07,600
exactly uh so sisa and microsoft

822
00:27:07,600 --> 00:27:09,360
released guidance for the proxy logon

823
00:27:09,360 --> 00:27:10,960
remediation which was very helpful at

824
00:27:10,960 --> 00:27:13,760
first to to get things offline uh but

825
00:27:13,760 --> 00:27:15,600
again we we didn't know a ton about how

826
00:27:15,600 --> 00:27:17,039
exactly this was happening when it

827
00:27:17,039 --> 00:27:18,720
happened so we have our standard options

828
00:27:18,720 --> 00:27:20,720
you know yank the power cable and yank

829
00:27:20,720 --> 00:27:22,559
the network connection of your company's

830
00:27:22,559 --> 00:27:24,559
exchange server so let's keep that one

831
00:27:24,559 --> 00:27:26,720
in mind uh and then in this case because

832
00:27:26,720 --> 00:27:28,880
we knew a couple of the uh the ttps that

833
00:27:28,880 --> 00:27:30,880
were being used by the adversaries in

834
00:27:30,880 --> 00:27:33,200
this case uh we we knew that domain wide

835
00:27:33,200 --> 00:27:34,559
password reset was likely one of the

836
00:27:34,559 --> 00:27:36,080
very very first things we wanted to do

837
00:27:36,080 --> 00:27:37,279
we could see them using proctom to

838
00:27:37,279 --> 00:27:38,960
capture passwords and and harvest

839
00:27:38,960 --> 00:27:40,640
credentials uh but again there are some

840
00:27:40,640 --> 00:27:42,080
major impacts that we need to consider

841
00:27:42,080 --> 00:27:43,360
before any actions are taken this is

842
00:27:43,360 --> 00:27:44,960
your exchange server so your email might

843
00:27:44,960 --> 00:27:46,480
be down how does that affect your

844
00:27:46,480 --> 00:27:48,559
organization again help desk calls

845
00:27:48,559 --> 00:27:50,159
evidence destruction and operational

846
00:27:50,159 --> 00:27:51,760
impact all need to be factored into how

847
00:27:51,760 --> 00:27:54,320
we respond for these things

848
00:27:54,320 --> 00:27:55,679
now this brings into threat hunting one

849
00:27:55,679 --> 00:27:58,640
more time our our you know primary new

850
00:27:58,640 --> 00:27:59,840
goal when we start into incident

851
00:27:59,840 --> 00:28:02,000
response is to start threat hunting

852
00:28:02,000 --> 00:28:03,760
microsoft and sisa published a great

853
00:28:03,760 --> 00:28:05,279
list of indicators of compromise right

854
00:28:05,279 --> 00:28:06,720
away remember microsoft actually had a

855
00:28:06,720 --> 00:28:08,000
little bit of time to get these things

856
00:28:08,000 --> 00:28:09,520
out the door before this really became

857
00:28:09,520 --> 00:28:10,640
huge

858
00:28:10,640 --> 00:28:12,159
and we had an example of a financial

859
00:28:12,159 --> 00:28:14,000
services firm that we we worked with we

860
00:28:14,000 --> 00:28:15,360
dropped carbon black onto their network

861
00:28:15,360 --> 00:28:16,799
so we could look at their local computer

862
00:28:16,799 --> 00:28:17,919
systems and their local network

863
00:28:17,919 --> 00:28:19,600
infrastructure and then we did a very

864
00:28:19,600 --> 00:28:21,600
targeted analysis of the iis logs from

865
00:28:21,600 --> 00:28:24,480
their exchange servers to look for any

866
00:28:24,480 --> 00:28:26,320
email system specific activities that

867
00:28:26,320 --> 00:28:28,000
might indicate that the company had been

868
00:28:28,000 --> 00:28:30,320
actually compromised and we did this uh

869
00:28:30,320 --> 00:28:31,840
using some known happening behavioral

870
00:28:31,840 --> 00:28:33,600
characteristics and when we were looking

871
00:28:33,600 --> 00:28:35,200
we actually identified literally

872
00:28:35,200 --> 00:28:36,799
hundreds of attempts to exploit the

873
00:28:36,799 --> 00:28:38,080
vulnerable server and these were coming

874
00:28:38,080 --> 00:28:39,840
from all across the world likely from

875
00:28:39,840 --> 00:28:41,760
multiple different adversary groups some

876
00:28:41,760 --> 00:28:43,600
were successful others were not i think

877
00:28:43,600 --> 00:28:45,039
it all depended on the skill level of

878
00:28:45,039 --> 00:28:46,320
the adversary that was going after the

879
00:28:46,320 --> 00:28:48,080
server at that point in time but again

880
00:28:48,080 --> 00:28:49,520
it was really eye-opening as to how

881
00:28:49,520 --> 00:28:52,399
pervasive this threat actually was

882
00:28:52,399 --> 00:28:53,679
so these are some of the indicators of

883
00:28:53,679 --> 00:28:55,360
compromise that we were looking for with

884
00:28:55,360 --> 00:28:57,200
the with the exchange vulnerability we

885
00:28:57,200 --> 00:28:58,799
were looking for eight character aspx

886
00:28:58,799 --> 00:29:01,120
files in the inet pub folders uh this

887
00:29:01,120 --> 00:29:02,640
was an indication that with some

888
00:29:02,640 --> 00:29:04,000
specific naming conventions and of

889
00:29:04,000 --> 00:29:06,880
course the the time the uh shells were

890
00:29:06,880 --> 00:29:09,200
installed that the exploit had actually

891
00:29:09,200 --> 00:29:10,559
been successfully used and that there

892
00:29:10,559 --> 00:29:11,840
was now a web webshell present on the

893
00:29:11,840 --> 00:29:13,679
server we also again were looking for

894
00:29:13,679 --> 00:29:15,679
encoded powershell activity uh and there

895
00:29:15,679 --> 00:29:17,360
was there was a lot of that the problem

896
00:29:17,360 --> 00:29:19,120
that we had here was so many people were

897
00:29:19,120 --> 00:29:20,880
jumping in to do these investigations on

898
00:29:20,880 --> 00:29:22,000
exchange servers that we had an

899
00:29:22,000 --> 00:29:24,000
overwhelming amount of community

900
00:29:24,000 --> 00:29:25,919
indicators of compromise being provided

901
00:29:25,919 --> 00:29:27,279
and in a lot of cases those turned out

902
00:29:27,279 --> 00:29:28,799
to be false positives it was people

903
00:29:28,799 --> 00:29:30,240
seeing malicious activity where there

904
00:29:30,240 --> 00:29:32,000
wasn't any because they were in such a

905
00:29:32,000 --> 00:29:33,679
heightened state of alert so again we

906
00:29:33,679 --> 00:29:35,039
need to vet those things it really

907
00:29:35,039 --> 00:29:36,399
seemed like everybody and their mom was

908
00:29:36,399 --> 00:29:38,320
releasing iocs even chile's bank

909
00:29:38,320 --> 00:29:39,679
regulator

910
00:29:39,679 --> 00:29:41,360
and another problem was that the iocs

911
00:29:41,360 --> 00:29:43,679
kept changing so and that was partly

912
00:29:43,679 --> 00:29:45,360
because the adversary's tactics kept

913
00:29:45,360 --> 00:29:46,799
changing as well so many different

914
00:29:46,799 --> 00:29:49,279
attackers were involved um ransomware

915
00:29:49,279 --> 00:29:51,039
operators started taking advantage of

916
00:29:51,039 --> 00:29:53,120
the exchange vulnerabilities many many

917
00:29:53,120 --> 00:29:54,640
others we even saw law enforcement which

918
00:29:54,640 --> 00:29:57,039
we'll get to in a moment um but again

919
00:29:57,039 --> 00:29:59,520
those iocs kept evolving and responders

920
00:29:59,520 --> 00:30:01,440
had to keep on top of that we did here's

921
00:30:01,440 --> 00:30:02,799
a good example of another one of the

922
00:30:02,799 --> 00:30:04,559
iocs that we we pulled from one of our

923
00:30:04,559 --> 00:30:07,120
cases so this is an encoded powershell

924
00:30:07,120 --> 00:30:08,399
that we saw or encoded powershell

925
00:30:08,399 --> 00:30:10,080
command we saw running in the iis server

926
00:30:10,080 --> 00:30:11,520
they're they're invoking a web shell

927
00:30:11,520 --> 00:30:13,200
which is the support with a zero instead

928
00:30:13,200 --> 00:30:15,600
of an o file uh and then executing what

929
00:30:15,600 --> 00:30:18,320
uh what was later revealed to be a recon

930
00:30:18,320 --> 00:30:19,919
attempt to get process information back

931
00:30:19,919 --> 00:30:21,520
from the host and we saw multiple

932
00:30:21,520 --> 00:30:22,880
different iterations of these exact

933
00:30:22,880 --> 00:30:24,080
types of commands but they were things

934
00:30:24,080 --> 00:30:25,919
that we could key into uh to determine

935
00:30:25,919 --> 00:30:27,279
if the attack was successful and if it

936
00:30:27,279 --> 00:30:28,559
was still happening which was really

937
00:30:28,559 --> 00:30:30,320
important to know

938
00:30:30,320 --> 00:30:31,840
we also wanted to look at post exploit

939
00:30:31,840 --> 00:30:33,600
behavior uh and the thing i really want

940
00:30:33,600 --> 00:30:35,120
to point out here is not just the list

941
00:30:35,120 --> 00:30:36,480
of things they were doing but how they

942
00:30:36,480 --> 00:30:38,159
were doing it so so we can see the

943
00:30:38,159 --> 00:30:40,000
adversary using things like 7-zip we can

944
00:30:40,000 --> 00:30:41,919
see them using the ps exec toolkit the

945
00:30:41,919 --> 00:30:43,919
system turns tool kit from microsoft and

946
00:30:43,919 --> 00:30:45,360
this is another one of those trends that

947
00:30:45,360 --> 00:30:46,960
we're really starting to run into in ir

948
00:30:46,960 --> 00:30:48,159
is that a lot of

949
00:30:48,159 --> 00:30:49,600
adversaries once they reach into a

950
00:30:49,600 --> 00:30:51,520
network are not using custom designed

951
00:30:51,520 --> 00:30:53,679
malware to infect and recover data from

952
00:30:53,679 --> 00:30:54,720
your network they're using commercial

953
00:30:54,720 --> 00:30:56,240
tool kits and a lot of times they're

954
00:30:56,240 --> 00:30:57,919
tool kits that the actual environment

955
00:30:57,919 --> 00:30:59,200
that they're breaking into uses

956
00:30:59,200 --> 00:31:01,760
regularly so again that blends into the

957
00:31:01,760 --> 00:31:03,039
background it makes it really difficult

958
00:31:03,039 --> 00:31:04,720
to tell when something is malicious and

959
00:31:04,720 --> 00:31:06,399
when it's not if it's not clearly

960
00:31:06,399 --> 00:31:08,640
defined like happening at 2am when the

961
00:31:08,640 --> 00:31:10,159
office closes at 5 or something like

962
00:31:10,159 --> 00:31:11,840
that so again something you really need

963
00:31:11,840 --> 00:31:13,200
to watch out for

964
00:31:13,200 --> 00:31:14,960
now microsoft was very helpful in the

965
00:31:14,960 --> 00:31:16,240
exchange

966
00:31:16,240 --> 00:31:17,519
in the exchange zero day attack and

967
00:31:17,519 --> 00:31:19,039
released some very nice scripting that

968
00:31:19,039 --> 00:31:20,880
we could use to one tell if the server

969
00:31:20,880 --> 00:31:23,200
was uh was vulnerable to the compromise

970
00:31:23,200 --> 00:31:24,559
if it had been compromised and then if

971
00:31:24,559 --> 00:31:27,200
we chose to we could utilize a uh an

972
00:31:27,200 --> 00:31:29,120
on-premise mitigation tool to identify

973
00:31:29,120 --> 00:31:30,399
and remove the web shells from the

974
00:31:30,399 --> 00:31:32,000
environment and kind of cut off that

975
00:31:32,000 --> 00:31:34,000
initial point of access again this was

976
00:31:34,000 --> 00:31:35,440
automated remediation but we had to be

977
00:31:35,440 --> 00:31:36,960
really careful because this does delete

978
00:31:36,960 --> 00:31:38,000
things from the system and if we're

979
00:31:38,000 --> 00:31:39,279
deleting things we're potentially

980
00:31:39,279 --> 00:31:41,279
deleting evidence from response again we

981
00:31:41,279 --> 00:31:42,480
need to make sure that we're

982
00:31:42,480 --> 00:31:43,679
we're preserving these things to the

983
00:31:43,679 --> 00:31:45,679
best of our ability for that follow-on

984
00:31:45,679 --> 00:31:47,440
investigation because we may need to

985
00:31:47,440 --> 00:31:49,200
report a data breach because of it again

986
00:31:49,200 --> 00:31:51,200
we need to we needed to apply emergency

987
00:31:51,200 --> 00:31:53,039
patches and updates and the good thing

988
00:31:53,039 --> 00:31:55,440
was that microsoft was prepared before

989
00:31:55,440 --> 00:31:56,799
this was publicly announced the bad

990
00:31:56,799 --> 00:31:58,880
thing was that the patches were not

991
00:31:58,880 --> 00:32:01,519
available before many organizations got

992
00:32:01,519 --> 00:32:04,000
hacked and after they announced it not

993
00:32:04,000 --> 00:32:06,320
everybody was ready to immediately patch

994
00:32:06,320 --> 00:32:08,080
their exchange server if you didn't

995
00:32:08,080 --> 00:32:10,720
patch immediately you were likely hacked

996
00:32:10,720 --> 00:32:12,480
so you want to have these conversations

997
00:32:12,480 --> 00:32:14,640
ahead of time and decide are you going

998
00:32:14,640 --> 00:32:16,320
to immediately deploy patches to

999
00:32:16,320 --> 00:32:18,159
critical systems when an issue like this

1000
00:32:18,159 --> 00:32:21,440
occurs or are you going to be a later

1001
00:32:21,440 --> 00:32:23,440
adopter

1002
00:32:23,440 --> 00:32:25,360
in this case we also saw law enforcement

1003
00:32:25,360 --> 00:32:27,679
intervention so the fbi received a

1004
00:32:27,679 --> 00:32:30,080
secret court order to hack into i mean

1005
00:32:30,080 --> 00:32:31,760
there's no better word for it to hack

1006
00:32:31,760 --> 00:32:33,360
into organizations using these same

1007
00:32:33,360 --> 00:32:35,760
exploits and then remove the web shells

1008
00:32:35,760 --> 00:32:38,080
they then attempted to provide notice

1009
00:32:38,080 --> 00:32:40,159
they made their best effort so they're

1010
00:32:40,159 --> 00:32:41,840
pros and cons to this right matt oh yeah

1011
00:32:41,840 --> 00:32:43,919
of course i mean one i'm sure they had

1012
00:32:43,919 --> 00:32:45,200
the best intentions you know we're from

1013
00:32:45,200 --> 00:32:47,039
the government and here to help you uh

1014
00:32:47,039 --> 00:32:48,159
but uh

1015
00:32:48,159 --> 00:32:49,519
when when you have somebody coming into

1016
00:32:49,519 --> 00:32:51,039
your into your server and removing these

1017
00:32:51,039 --> 00:32:52,880
things a responder doesn't know if this

1018
00:32:52,880 --> 00:32:54,640
is the fbi or an adversary doing this so

1019
00:32:54,640 --> 00:32:55,840
it becomes kind of confusing for him at

1020
00:32:55,840 --> 00:32:57,440
that point also there's the potential

1021
00:32:57,440 --> 00:32:59,200
for evidence destruction and then we

1022
00:32:59,200 --> 00:33:00,480
look down the road i mean is something

1023
00:33:00,480 --> 00:33:02,159
like this going to happen again and what

1024
00:33:02,159 --> 00:33:03,919
are the future implications of this type

1025
00:33:03,919 --> 00:33:05,760
of this type of activity i think this

1026
00:33:05,760 --> 00:33:08,000
poses unique challenges for

1027
00:33:08,000 --> 00:33:10,640
investigators as well because

1028
00:33:10,640 --> 00:33:12,960
when you're analyzing access logs it's

1029
00:33:12,960 --> 00:33:15,760
hard to tell if something is if access

1030
00:33:15,760 --> 00:33:18,240
is initiated by a government agency or

1031
00:33:18,240 --> 00:33:20,159
by an adversary and you may only find

1032
00:33:20,159 --> 00:33:22,080
out about it days or weeks or months

1033
00:33:22,080 --> 00:33:24,720
down the road yeah exactly

1034
00:33:24,720 --> 00:33:27,200
so plan for elevated risks long term

1035
00:33:27,200 --> 00:33:29,120
again like in the solar winds attack

1036
00:33:29,120 --> 00:33:31,360
email theft can be very impactful you

1037
00:33:31,360 --> 00:33:33,360
may see financial fraud or targeted

1038
00:33:33,360 --> 00:33:35,600
follow-on attacks and this could impact

1039
00:33:35,600 --> 00:33:39,519
your vendor or your organization

1040
00:33:39,519 --> 00:33:41,279
okay so now that we've gone through our

1041
00:33:41,279 --> 00:33:43,120
checklist with solarwinds the supply

1042
00:33:43,120 --> 00:33:45,679
chain attack and with microsoft exchange

1043
00:33:45,679 --> 00:33:47,760
a mass zero day vulnerability let's get

1044
00:33:47,760 --> 00:33:49,840
back to our recent cassaya ransomware

1045
00:33:49,840 --> 00:33:51,840
attacks first of all this was announced

1046
00:33:51,840 --> 00:33:53,919
on the 4th of july weekend that this

1047
00:33:53,919 --> 00:33:55,279
remote monitoring and management

1048
00:33:55,279 --> 00:33:56,720
software was

1049
00:33:56,720 --> 00:33:59,039
had a major vulnerability

1050
00:33:59,039 --> 00:34:00,559
uh this happened fourth of july weekend

1051
00:34:00,559 --> 00:34:02,399
was this a coincidence probably not

1052
00:34:02,399 --> 00:34:04,880
probably not at lng we call friday's

1053
00:34:04,880 --> 00:34:07,519
forensics friday because so many hackers

1054
00:34:07,519 --> 00:34:09,440
are deploying ransomware after business

1055
00:34:09,440 --> 00:34:11,839
hours on a friday according to fireeye

1056
00:34:11,839 --> 00:34:14,719
76 of the time ransomware is executed

1057
00:34:14,719 --> 00:34:17,199
outside normal work hours so 27 of the

1058
00:34:17,199 --> 00:34:20,079
time on the weekends and 49 of the time

1059
00:34:20,079 --> 00:34:22,320
after hours on weekdays so think about

1060
00:34:22,320 --> 00:34:24,320
who is on call for your organization

1061
00:34:24,320 --> 00:34:25,918
who's going to be monitoring over 4th of

1062
00:34:25,918 --> 00:34:28,159
july weekend and what kind of decisions

1063
00:34:28,159 --> 00:34:30,719
are they empowered to make also talk

1064
00:34:30,719 --> 00:34:32,639
with your key suppliers that you rely on

1065
00:34:32,639 --> 00:34:34,399
are your msps monitoring threat

1066
00:34:34,399 --> 00:34:36,399
intelligence how quickly are they going

1067
00:34:36,399 --> 00:34:38,399
to notify you and are they going to take

1068
00:34:38,399 --> 00:34:41,760
action msp communication is absolutely

1069
00:34:41,760 --> 00:34:42,480
key

1070
00:34:42,480 --> 00:34:44,800
as a supplier can a software vendor's

1071
00:34:44,800 --> 00:34:46,239
communication

1072
00:34:46,239 --> 00:34:48,639
now in this case we had some interesting

1073
00:34:48,639 --> 00:34:51,280
impacts uh surrounding disclosure as we

1074
00:34:51,280 --> 00:34:54,000
often do so the timeline of the

1075
00:34:54,000 --> 00:34:56,239
vulnerability detection and notification

1076
00:34:56,239 --> 00:34:58,400
is as shown here so the vulnerabilities

1077
00:34:58,400 --> 00:35:00,240
were detected by the dutch institute for

1078
00:35:00,240 --> 00:35:02,720
vulnerability disclosure in early april

1079
00:35:02,720 --> 00:35:05,839
of 2021 and at that time they discovered

1080
00:35:05,839 --> 00:35:08,000
at least seven vulnerabilities they

1081
00:35:08,000 --> 00:35:10,400
pulled a list and discovered at least 2

1082
00:35:10,400 --> 00:35:12,800
200 vulnerable vulnerable systems and

1083
00:35:12,800 --> 00:35:14,800
they provided all this information to

1084
00:35:14,800 --> 00:35:17,920
the software vendor cassaya so that

1085
00:35:17,920 --> 00:35:19,119
that's nice that they were there to

1086
00:35:19,119 --> 00:35:21,280
support cassaya and cassaya worked very

1087
00:35:21,280 --> 00:35:23,040
collaboratively with the researchers

1088
00:35:23,040 --> 00:35:25,200
according to the research team now the

1089
00:35:25,200 --> 00:35:28,320
researchers gave them a 90-day timeline

1090
00:35:28,320 --> 00:35:30,880
on the disclosure and on april 10th and

1091
00:35:30,880 --> 00:35:33,200
may 8th cassaya released patches for

1092
00:35:33,200 --> 00:35:34,960
four of those vulnerabilities but the

1093
00:35:34,960 --> 00:35:37,760
remaining three were not slated for

1094
00:35:37,760 --> 00:35:40,480
actual uh correction until july they

1095
00:35:40,480 --> 00:35:42,079
were working diligently on them

1096
00:35:42,079 --> 00:35:43,520
according to the researchers but and

1097
00:35:43,520 --> 00:35:45,760
they were just about to be released when

1098
00:35:45,760 --> 00:35:47,760
the attackers struck and took advantage

1099
00:35:47,760 --> 00:35:50,079
of those so uh the timing on that

1100
00:35:50,079 --> 00:35:52,000
honestly is a little bit suspicious and

1101
00:35:52,000 --> 00:35:53,839
it should really make us think about

1102
00:35:53,839 --> 00:35:56,079
again who has access to information

1103
00:35:56,079 --> 00:35:57,920
about those vulnerabilities because

1104
00:35:57,920 --> 00:35:59,760
hackers are always looking to take

1105
00:35:59,760 --> 00:36:02,000
advantage before a patch is released

1106
00:36:02,000 --> 00:36:03,119
whenever

1107
00:36:03,119 --> 00:36:05,119
often we have some challenges in

1108
00:36:05,119 --> 00:36:06,800
communication with suppliers so you

1109
00:36:06,800 --> 00:36:08,960
really need to think about what to

1110
00:36:08,960 --> 00:36:10,400
expect

1111
00:36:10,400 --> 00:36:12,480
in terms of your communication matt do

1112
00:36:12,480 --> 00:36:14,079
you want to share an earlier case

1113
00:36:14,079 --> 00:36:16,079
involving rival and a managed service

1114
00:36:16,079 --> 00:36:18,640
provider yeah of course in 2019 uh rival

1115
00:36:18,640 --> 00:36:20,640
took over an msp that serviced dental

1116
00:36:20,640 --> 00:36:22,240
facilities specifically this is an msp

1117
00:36:22,240 --> 00:36:24,560
out of colorado uh they demanded seven

1118
00:36:24,560 --> 00:36:25,839
hundred thousand dollars for a master

1119
00:36:25,839 --> 00:36:28,000
decrypter from the msp uh who initially

1120
00:36:28,000 --> 00:36:29,839
refused payment uh odds are good they

1121
00:36:29,839 --> 00:36:30,960
probably paid a little bit farther down

1122
00:36:30,960 --> 00:36:32,560
the road but they were very tight-lipped

1123
00:36:32,560 --> 00:36:33,760
about the entire thing and didn't want

1124
00:36:33,760 --> 00:36:35,599
to share info so as a responder we had a

1125
00:36:35,599 --> 00:36:37,200
really hard time getting any indicators

1126
00:36:37,200 --> 00:36:38,960
of compromise or any assistance from the

1127
00:36:38,960 --> 00:36:41,440
msp at that point so again it brings up

1128
00:36:41,440 --> 00:36:43,200
a very important point do you know what

1129
00:36:43,200 --> 00:36:44,560
your supplier is going to do do you know

1130
00:36:44,560 --> 00:36:46,079
how they're going to behave in the case

1131
00:36:46,079 --> 00:36:47,280
that something like this happens and if

1132
00:36:47,280 --> 00:36:48,880
not it probably should be something that

1133
00:36:48,880 --> 00:36:50,800
you have a discussion with them about

1134
00:36:50,800 --> 00:36:52,320
yup exactly

1135
00:36:52,320 --> 00:36:54,400
also think about where you get your

1136
00:36:54,400 --> 00:36:56,320
information from immediately after the

1137
00:36:56,320 --> 00:36:58,240
cassaya attacks criminals started

1138
00:36:58,240 --> 00:37:00,240
pretending that they were your partners

1139
00:37:00,240 --> 00:37:02,160
so um cassaya came out with a warning

1140
00:37:02,160 --> 00:37:04,079
and said watch out spammers baby may be

1141
00:37:04,079 --> 00:37:05,680
making phone calls claiming to be a

1142
00:37:05,680 --> 00:37:08,079
cassaya partner reaching out to help

1143
00:37:08,079 --> 00:37:09,440
they're also using news about the

1144
00:37:09,440 --> 00:37:12,000
cassette incident to send out fake email

1145
00:37:12,000 --> 00:37:14,160
notifications that appear to be caseah

1146
00:37:14,160 --> 00:37:16,240
updates and you can see one of those in

1147
00:37:16,240 --> 00:37:18,160
the screenshot here where there's an

1148
00:37:18,160 --> 00:37:20,160
adversary sending out spam pretending

1149
00:37:20,160 --> 00:37:22,000
it's a microsoft update to protect

1150
00:37:22,000 --> 00:37:24,000
against ransomware and it fixes a

1151
00:37:24,000 --> 00:37:26,160
vulnerability in cassaya so never mind

1152
00:37:26,160 --> 00:37:28,240
that this makes no sense people do fall

1153
00:37:28,240 --> 00:37:30,160
for these or at least click on the link

1154
00:37:30,160 --> 00:37:33,440
and if they do it's a cobalt strike

1155
00:37:33,440 --> 00:37:35,200
installer yeah

1156
00:37:35,200 --> 00:37:37,359
so how do you contain the damage again

1157
00:37:37,359 --> 00:37:39,599
this is a standard part of our checklist

1158
00:37:39,599 --> 00:37:42,000
unfortunately um in this case really the

1159
00:37:42,000 --> 00:37:44,000
main way to contain it right off the bat

1160
00:37:44,000 --> 00:37:46,079
was to immediately shut down your vsa

1161
00:37:46,079 --> 00:37:48,160
server and cassaya announced this and

1162
00:37:48,160 --> 00:37:49,839
said it's critical that you do this

1163
00:37:49,839 --> 00:37:51,359
immediately because one of the first

1164
00:37:51,359 --> 00:37:53,040
things the attacker does is shut off

1165
00:37:53,040 --> 00:37:55,920
administrative access to the vsa yeah so

1166
00:37:55,920 --> 00:37:58,160
you got to proactively do it yourself of

1167
00:37:58,160 --> 00:38:00,400
course that is not so easy

1168
00:38:00,400 --> 00:38:02,880
to shut off your remote management

1169
00:38:02,880 --> 00:38:05,040
software when you're trying to remotely

1170
00:38:05,040 --> 00:38:07,200
manage your network so again a lot of

1171
00:38:07,200 --> 00:38:08,720
challenges

1172
00:38:08,720 --> 00:38:10,320
we also saw them

1173
00:38:10,320 --> 00:38:12,480
hoping to roll out a patch unlike the

1174
00:38:12,480 --> 00:38:14,880
microsoft case the patch was not ready

1175
00:38:14,880 --> 00:38:17,839
when news of the cassette vulnerability

1176
00:38:17,839 --> 00:38:19,359
emerged because

1177
00:38:19,359 --> 00:38:21,520
criminals had taken advantage of it and

1178
00:38:21,520 --> 00:38:24,079
it was a ransomware deployment and when

1179
00:38:24,079 --> 00:38:25,760
they were attempting to release the

1180
00:38:25,760 --> 00:38:27,440
patches they ran into multiple

1181
00:38:27,440 --> 00:38:30,320
unforeseen delays so that time frame

1182
00:38:30,320 --> 00:38:32,400
kept changing and as we've seen in

1183
00:38:32,400 --> 00:38:34,240
previous cases even if the patches do

1184
00:38:34,240 --> 00:38:36,160
get rolled out there's no guarantee that

1185
00:38:36,160 --> 00:38:38,560
they will fully remediate the issue

1186
00:38:38,560 --> 00:38:39,839
there could potentially be other

1187
00:38:39,839 --> 00:38:41,920
vulnerabilities and you need to

1188
00:38:41,920 --> 00:38:43,839
understand what is your organization's

1189
00:38:43,839 --> 00:38:46,960
policy what's your msps policy regarding

1190
00:38:46,960 --> 00:38:49,599
applying those patches

1191
00:38:49,599 --> 00:38:52,800
do you want to be the guinea pig or not

1192
00:38:52,800 --> 00:38:56,240
okay so this will happen again hackers

1193
00:38:56,240 --> 00:38:58,560
want the most return on their investment

1194
00:38:58,560 --> 00:39:00,640
and they figured out that if they target

1195
00:39:00,640 --> 00:39:02,400
widely used software or they target

1196
00:39:02,400 --> 00:39:04,640
service providers they can have a

1197
00:39:04,640 --> 00:39:06,960
widespread impact and get the most bang

1198
00:39:06,960 --> 00:39:09,040
for for their buck we've also seen that

1199
00:39:09,040 --> 00:39:11,599
breaches lead to more breaches so the

1200
00:39:11,599 --> 00:39:13,119
information and access that the

1201
00:39:13,119 --> 00:39:15,040
attackers have gained from previous

1202
00:39:15,040 --> 00:39:17,520
hacks can help them to launch more

1203
00:39:17,520 --> 00:39:19,920
effective attacks in the future

1204
00:39:19,920 --> 00:39:21,520
so be careful

1205
00:39:21,520 --> 00:39:23,839
um sorry for the image matt you now owe

1206
00:39:23,839 --> 00:39:25,440
me a bottle of whiskey

1207
00:39:25,440 --> 00:39:26,960
we had a little bet that i couldn't use

1208
00:39:26,960 --> 00:39:29,440
that image in this presentation

1209
00:39:29,440 --> 00:39:32,240
all right adapt your dfir processes how

1210
00:39:32,240 --> 00:39:34,160
do we do that number one make sure that

1211
00:39:34,160 --> 00:39:36,160
you're monitoring threat intelligence as

1212
00:39:36,160 --> 00:39:39,359
we talked about evaluate your risk um

1213
00:39:39,359 --> 00:39:41,119
first responders need to be doing this

1214
00:39:41,119 --> 00:39:43,520
when a new alert comes out you want to

1215
00:39:43,520 --> 00:39:45,359
think about conducting forensic

1216
00:39:45,359 --> 00:39:47,599
preservation it may not necessarily be

1217
00:39:47,599 --> 00:39:49,680
important in all cases but in many cases

1218
00:39:49,680 --> 00:39:51,920
it is you have to contain the damage

1219
00:39:51,920 --> 00:39:54,079
before you have extensive information

1220
00:39:54,079 --> 00:39:56,240
about the problem which again is its own

1221
00:39:56,240 --> 00:39:58,640
challenge threat hunting needs to be a

1222
00:39:58,640 --> 00:40:00,800
regular part of our incident response in

1223
00:40:00,800 --> 00:40:03,760
these types of cases also emergency

1224
00:40:03,760 --> 00:40:05,520
patches and updates are become going to

1225
00:40:05,520 --> 00:40:07,280
become the norm in supply chain

1226
00:40:07,280 --> 00:40:09,440
compromises and these mass zero day

1227
00:40:09,440 --> 00:40:11,520
vulnerabilities and finally plan for

1228
00:40:11,520 --> 00:40:13,920
those elevated risks this is the new

1229
00:40:13,920 --> 00:40:16,480
norm my name is sherry davidoff and i am

1230
00:40:16,480 --> 00:40:18,560
matt durin we are from lmg security

1231
00:40:18,560 --> 00:40:20,160
check out our upcoming book ransomware

1232
00:40:20,160 --> 00:40:22,160
and cyber extortion and our podcast

1233
00:40:22,160 --> 00:40:24,000
breaking breeches and drop us a line on

1234
00:40:24,000 --> 00:40:28,200
linkedin if you have any questions

