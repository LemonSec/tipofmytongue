1
00:00:00,000 --> 00:00:03,959
hi everybody<font color="#CCCCCC"> so my name is Greg Dodds</font>

2
00:00:02,790 --> 00:00:06,089
I'm one of the chief architects

3
00:00:03,959 --> 00:00:07,798
responsible for security<font color="#CCCCCC"> at juniper and</font>

4
00:00:06,089 --> 00:00:10,950
today we're going<font color="#E5E5E5"> to be talking</font><font color="#CCCCCC"> about</font>

5
00:00:07,799 --> 00:00:12,599
combining<font color="#CCCCCC"> office 365 and PowerShell</font><font color="#E5E5E5"> for</font>

6
00:00:10,950 --> 00:00:14,809
con covert

7
00:00:12,599 --> 00:00:17,850
command control within<font color="#E5E5E5"> office</font>

8
00:00:14,809 --> 00:00:20,250
enterprises I should say in<font color="#CCCCCC"> the interest</font>

9
00:00:17,850 --> 00:00:21,900
of time I cut out my<font color="#E5E5E5"> biography slide but</font>

10
00:00:20,250 --> 00:00:24,029
the Cliff's Notes version is<font color="#E5E5E5"> I've been</font>

11
00:00:21,900 --> 00:00:25,948
at<font color="#E5E5E5"> juniper for a little bit over a</font><font color="#CCCCCC"> year</font>

12
00:00:24,029 --> 00:00:29,400
at this point<font color="#CCCCCC"> prior to that I spent</font>

13
00:00:25,949 --> 00:00:30,869
<font color="#E5E5E5">about</font><font color="#CCCCCC"> five</font><font color="#E5E5E5"> years at IBM security and</font>

14
00:00:29,400 --> 00:00:36,390
before<font color="#CCCCCC"> that I spent</font><font color="#E5E5E5"> many years at</font>

15
00:00:30,869 --> 00:00:36,899
checkpoint software and Nokia<font color="#CCCCCC"> so moving</font>

16
00:00:36,390 --> 00:00:39,239
on

17
00:00:36,899 --> 00:00:42,590
first and<font color="#E5E5E5"> foremost our agenda we need to</font>

18
00:00:39,239 --> 00:00:46,919
discuss why office 365<font color="#E5E5E5"> makes for ideal</font>

19
00:00:42,590 --> 00:00:49,190
<font color="#E5E5E5">c2 infrastructure after</font><font color="#CCCCCC"> that we're going</font>

20
00:00:46,920 --> 00:00:52,350
to discuss how PowerShell fits into<font color="#E5E5E5"> this</font>

21
00:00:49,190 --> 00:00:54,390
specifically<font color="#E5E5E5"> around the new PS</font><font color="#CCCCCC"> Drive</font>

22
00:00:52,350 --> 00:00:56,309
<font color="#CCCCCC">commands</font><font color="#E5E5E5"> and if you're not familiar with</font>

23
00:00:54,390 --> 00:00:59,609
<font color="#E5E5E5">that you</font><font color="#CCCCCC"> can make a pretty</font><font color="#E5E5E5"> quick guess</font>

24
00:00:56,309 --> 00:01:02,669
what it's responsible for mounting local

25
00:00:59,609 --> 00:01:04,619
and remote file systems within

26
00:01:02,670 --> 00:01:07,530
PowerShell after that we're going<font color="#CCCCCC"> to go</font>

27
00:01:04,619 --> 00:01:10,020
through a simple<font color="#CCCCCC"> four stage proof of</font>

28
00:01:07,530 --> 00:01:11,939
<font color="#E5E5E5">concept I've tried to keep all the</font>

29
00:01:10,020 --> 00:01:13,950
<font color="#E5E5E5">examples as simple as possible so even</font>

30
00:01:11,939 --> 00:01:15,899
<font color="#CCCCCC">those of you who are</font><font color="#E5E5E5"> not familiar with</font>

31
00:01:13,950 --> 00:01:18,689
PowerShell necessarily should be<font color="#CCCCCC"> able</font><font color="#E5E5E5"> to</font>

32
00:01:15,900 --> 00:01:20,990
<font color="#E5E5E5">follow</font><font color="#CCCCCC"> along</font><font color="#E5E5E5"> after</font><font color="#CCCCCC"> that we</font><font color="#E5E5E5"> will talk</font>

33
00:01:18,689 --> 00:01:23,158
<font color="#E5E5E5">about some mitigation strategies and</font>

34
00:01:20,990 --> 00:01:24,899
after that of course<font color="#E5E5E5"> we're going to come</font>

35
00:01:23,159 --> 00:01:26,790
at it from a<font color="#CCCCCC"> Red Team perspective and</font>

36
00:01:24,900 --> 00:01:28,799
discuss evading detection<font color="#E5E5E5"> primarily</font>

37
00:01:26,790 --> 00:01:33,210
focused on sandbox evasion as<font color="#CCCCCC"> well as</font>

38
00:01:28,799 --> 00:01:34,380
our final demo all right<font color="#CCCCCC"> so first and</font>

39
00:01:33,210 --> 00:01:37,919
<font color="#CCCCCC">foremost</font><font color="#E5E5E5"> it's important to talk</font><font color="#CCCCCC"> about</font>

40
00:01:34,380 --> 00:01:39,658
office 365 adoption rates<font color="#E5E5E5"> first and</font>

41
00:01:37,920 --> 00:01:41,549
<font color="#E5E5E5">foremost of course</font><font color="#CCCCCC"> credit</font><font color="#E5E5E5"> goes to sky</font>

42
00:01:39,659 --> 00:01:43,799
high for the data<font color="#E5E5E5"> that they collected</font>

43
00:01:41,549 --> 00:01:46,049
<font color="#E5E5E5">last year but as you can see for any</font>

44
00:01:43,799 --> 00:01:50,549
<font color="#CCCCCC">enterprise it's got</font><font color="#E5E5E5"> more</font><font color="#CCCCCC"> than 100 users</font>

45
00:01:46,049 --> 00:01:52,470
adoption rates are quite<font color="#CCCCCC"> high up to 80%</font>

46
00:01:50,549 --> 00:01:55,740
in<font color="#E5E5E5"> some</font><font color="#CCCCCC"> cases for certain</font><font color="#E5E5E5"> services such</font>

47
00:01:52,470 --> 00:01:57,750
as onedrive and in the case<font color="#E5E5E5"> of our</font>

48
00:01:55,740 --> 00:01:59,908
<font color="#E5E5E5">specific talk here we're focusing on</font>

49
00:01:57,750 --> 00:02:04,100
those enterprises<font color="#E5E5E5"> who have adopted both</font>

50
00:01:59,909 --> 00:02:04,100
onedrive as well as share points

51
00:02:04,750 --> 00:02:09,130
so getting<font color="#E5E5E5"> into it why it's actually</font>

52
00:02:07,690 --> 00:02:11,290
<font color="#E5E5E5">interesting</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> commanding control</font><font color="#CCCCCC"> as</font>

53
00:02:09,130 --> 00:02:13,000
you<font color="#CCCCCC"> saw in the last slide the vast</font>

54
00:02:11,290 --> 00:02:16,269
<font color="#E5E5E5">majority of enterprises are</font><font color="#CCCCCC"> alright are</font>

55
00:02:13,000 --> 00:02:19,630
<font color="#E5E5E5">already permitting traffic to office 365</font>

56
00:02:16,270 --> 00:02:20,980
hopefully it's<font color="#E5E5E5"> all TLS at this point but</font>

57
00:02:19,630 --> 00:02:23,109
if you're going to<font color="#E5E5E5"> be using the service</font>

58
00:02:20,980 --> 00:02:24,160
you<font color="#E5E5E5"> can make a really</font><font color="#CCCCCC"> easy assumption</font>

59
00:02:23,110 --> 00:02:25,360
that the network infrastructure and

60
00:02:24,160 --> 00:02:29,680
security<font color="#E5E5E5"> infrastructure that's in place</font>

61
00:02:25,360 --> 00:02:31,900
today has access to this<font color="#E5E5E5"> already</font><font color="#CCCCCC"> and of</font>

62
00:02:29,680 --> 00:02:33,400
course we can take advantage<font color="#CCCCCC"> of this but</font>

63
00:02:31,900 --> 00:02:35,800
larger<font color="#E5E5E5"> enterprises do the volume of</font>

64
00:02:33,400 --> 00:02:37,450
their<font color="#CCCCCC"> traffic</font><font color="#E5E5E5"> have enrolled in a service</font>

65
00:02:35,800 --> 00:02:39,340
called<font color="#E5E5E5"> Express route that microsoft</font>

66
00:02:37,450 --> 00:02:41,260
<font color="#E5E5E5">offers and with that service</font><font color="#CCCCCC"> you</font>

67
00:02:39,340 --> 00:02:43,510
<font color="#CCCCCC">actually enter</font><font color="#E5E5E5"> into a direct peering</font>

68
00:02:41,260 --> 00:02:45,880
agreement with<font color="#CCCCCC"> microsoft's between your</font>

69
00:02:43,510 --> 00:02:51,340
premise such as a data center<font color="#E5E5E5"> and Azure</font>

70
00:02:45,880 --> 00:02:54,209
<font color="#E5E5E5">and you can buy</font><font color="#CCCCCC"> these pipes</font><font color="#E5E5E5"> sorry you</font>

71
00:02:51,340 --> 00:02:57,130
can buy<font color="#CCCCCC"> these pipes in significantly</font>

72
00:02:54,209 --> 00:02:58,330
large quantities so<font color="#E5E5E5"> most fortune 100</font><font color="#CCCCCC"> s</font>

73
00:02:57,130 --> 00:02:59,890
if you look at it they've at<font color="#CCCCCC"> least got a</font>

74
00:02:58,330 --> 00:03:05,560
<font color="#E5E5E5">single 10 gig link in to assure at this</font>

75
00:02:59,890 --> 00:03:07,420
point if not<font color="#CCCCCC"> multiple</font><font color="#E5E5E5"> ones so due</font><font color="#CCCCCC"> to the</font>

76
00:03:05,560 --> 00:03:09,519
aforementioned volume of traffic<font color="#E5E5E5"> and</font>

77
00:03:07,420 --> 00:03:11,559
generally associated level of<font color="#E5E5E5"> trust most</font>

78
00:03:09,519 --> 00:03:13,900
enterprises<font color="#CCCCCC"> today are not decrypting any</font>

79
00:03:11,560 --> 00:03:16,660
traffic<font color="#E5E5E5"> at least from a TLS perspective</font>

80
00:03:13,900 --> 00:03:18,790
going<font color="#E5E5E5"> to office 365</font><font color="#CCCCCC"> they may be</font><font color="#E5E5E5"> looking</font>

81
00:03:16,660 --> 00:03:20,470
<font color="#E5E5E5">at email but generally not web traffic's</font>

82
00:03:18,790 --> 00:03:23,739
so we can of<font color="#CCCCCC"> course take advantage of</font>

83
00:03:20,470 --> 00:03:25,420
this another minor advantage of course

84
00:03:23,739 --> 00:03:27,100
<font color="#E5E5E5">of using office 365</font><font color="#CCCCCC"> is it can</font><font color="#E5E5E5"> be</font>

85
00:03:25,420 --> 00:03:28,660
<font color="#E5E5E5">considered an out-of-band method of</font>

86
00:03:27,100 --> 00:03:30,970
attack<font color="#CCCCCC"> so when you're interacting with</font>

87
00:03:28,660 --> 00:03:33,070
<font color="#CCCCCC">your target</font><font color="#E5E5E5"> your target is communicating</font>

88
00:03:30,970 --> 00:03:34,900
with<font color="#CCCCCC"> microsoft's IP ranges and not</font>

89
00:03:33,070 --> 00:03:36,340
necessarily<font color="#E5E5E5"> your own not to say</font>

90
00:03:34,900 --> 00:03:38,440
Microsoft<font color="#E5E5E5"> isn't monitoring what you're</font>

91
00:03:36,340 --> 00:03:40,209
doing on their service but your target

92
00:03:38,440 --> 00:03:43,390
generally will<font color="#CCCCCC"> not see what IP are</font>

93
00:03:40,209 --> 00:03:45,250
coming from<font color="#CCCCCC"> and</font><font color="#E5E5E5"> this is really one of</font>

94
00:03:43,390 --> 00:03:47,859
<font color="#E5E5E5">the focuses</font><font color="#CCCCCC"> of the attack of the the</font>

95
00:03:45,250 --> 00:03:50,739
talk rather but when you are mounting<font color="#CCCCCC"> as</font>

96
00:03:47,860 --> 00:03:52,510
an<font color="#E5E5E5"> example</font><font color="#CCCCCC"> a SharePoint</font><font color="#E5E5E5"> drive on a</font>

97
00:03:50,739 --> 00:03:55,330
target which is<font color="#CCCCCC"> something you can do and</font>

98
00:03:52,510 --> 00:03:57,070
we<font color="#E5E5E5"> will get into it on this talk</font><font color="#CCCCCC"> you can</font>

99
00:03:55,330 --> 00:03:59,110
do<font color="#E5E5E5"> it in a way</font><font color="#CCCCCC"> that's invisible</font><font color="#E5E5E5"> to</font>

100
00:03:57,070 --> 00:04:01,180
almost any service that<font color="#CCCCCC"> the user or the</font>

101
00:03:59,110 --> 00:04:02,560
admin is running so when you mount one

102
00:04:01,180 --> 00:04:05,110
of<font color="#CCCCCC"> these</font><font color="#E5E5E5"> drives you can have a remote</font>

103
00:04:02,560 --> 00:04:08,209
<font color="#CCCCCC">filesystem point on your target but it's</font>

104
00:04:05,110 --> 00:04:10,480
invisible to<font color="#E5E5E5"> File Explorer</font><font color="#CCCCCC"> WMI</font>

105
00:04:08,209 --> 00:04:13,340
and anything<font color="#E5E5E5"> built on dotnet frameworks</font>

106
00:04:10,480 --> 00:04:15,439
like net use as an<font color="#E5E5E5"> example</font><font color="#CCCCCC"> so it's</font>

107
00:04:13,340 --> 00:04:17,570
extremely<font color="#E5E5E5"> difficult to</font><font color="#CCCCCC"> even track the</font>

108
00:04:15,439 --> 00:04:19,699
usage<font color="#CCCCCC"> of these things let alone for a</font>

109
00:04:17,570 --> 00:04:21,849
typical end user to identify that hey

110
00:04:19,699 --> 00:04:24,320
I've got<font color="#E5E5E5"> this remote drive on my system</font>

111
00:04:21,850 --> 00:04:26,360
<font color="#E5E5E5">and of course if you are subscribed to</font>

112
00:04:24,320 --> 00:04:28,669
to do<font color="#CCCCCC"> B</font><font color="#E5E5E5"> solutions</font><font color="#CCCCCC"> assuming they're even</font>

113
00:04:26,360 --> 00:04:31,970
able<font color="#E5E5E5"> to identify that a PowerShell</font><font color="#CCCCCC"> drive</font>

114
00:04:28,669 --> 00:04:33,830
has<font color="#CCCCCC"> been mounted</font><font color="#E5E5E5"> generally speaking they</font>

115
00:04:31,970 --> 00:04:35,630
don't view<font color="#E5E5E5"> network storage as being</font>

116
00:04:33,830 --> 00:04:37,490
<font color="#E5E5E5">outside of</font><font color="#CCCCCC"> the enterprise</font><font color="#E5E5E5"> so you're able</font>

117
00:04:35,630 --> 00:04:39,289
<font color="#E5E5E5">to transfer things assuming</font><font color="#CCCCCC"> your coming</font>

118
00:04:37,490 --> 00:04:42,710
at this<font color="#E5E5E5"> from</font><font color="#CCCCCC"> a data exfiltration use</font>

119
00:04:39,289 --> 00:04:44,030
case<font color="#CCCCCC"> they generally</font><font color="#E5E5E5"> don't see it as</font>

120
00:04:42,710 --> 00:04:45,830
<font color="#E5E5E5">being an issue whatsoever of course</font>

121
00:04:44,030 --> 00:04:47,179
because whom else drives outside of

122
00:04:45,830 --> 00:04:51,109
their enterprise<font color="#CCCCCC"> that</font><font color="#E5E5E5"> sounds like a bad</font>

123
00:04:47,180 --> 00:04:55,970
idea<font color="#CCCCCC"> so Microsoft</font><font color="#E5E5E5"> of course saw this</font>

124
00:04:51,110 --> 00:04:58,099
coming so even if you're able<font color="#CCCCCC"> to figure</font>

125
00:04:55,970 --> 00:05:00,139
<font color="#E5E5E5">out how to mount a remote</font><font color="#CCCCCC"> sharepoint</font>

126
00:04:58,099 --> 00:05:02,469
<font color="#E5E5E5">drive as an example you don't actually</font>

127
00:05:00,139 --> 00:05:05,240
get read or write access<font color="#CCCCCC"> to that drive</font>

128
00:05:02,470 --> 00:05:07,009
<font color="#E5E5E5">so if you want to actually be</font><font color="#CCCCCC"> able to</font>

129
00:05:05,240 --> 00:05:09,500
use<font color="#E5E5E5"> that drive you need to figure out</font><font color="#CCCCCC"> a</font>

130
00:05:07,009 --> 00:05:13,639
way<font color="#CCCCCC"> to fetch a sam'l token</font><font color="#E5E5E5"> from office</font>

131
00:05:09,500 --> 00:05:16,699
365<font color="#E5E5E5"> before mounting that drive and as an</font>

132
00:05:13,639 --> 00:05:18,740
example<font color="#E5E5E5"> I've</font><font color="#CCCCCC"> mounted a drive here</font><font color="#E5E5E5"> and</font>

133
00:05:16,699 --> 00:05:20,780
<font color="#E5E5E5">I'm simply trying to echo test into a</font>

134
00:05:18,740 --> 00:05:22,310
test file and are presented<font color="#CCCCCC"> with an</font>

135
00:05:20,780 --> 00:05:24,349
error<font color="#CCCCCC"> so I'll read this</font><font color="#E5E5E5"> for the guys</font><font color="#CCCCCC"> in</font>

136
00:05:22,310 --> 00:05:26,120
the back<font color="#CCCCCC"> but basically</font><font color="#E5E5E5"> all it says is</font>

137
00:05:24,349 --> 00:05:28,250
when you try to<font color="#E5E5E5"> write a file you get</font>

138
00:05:26,120 --> 00:05:29,810
<font color="#CCCCCC">access denied before</font><font color="#E5E5E5"> opening files in</font>

139
00:05:28,250 --> 00:05:31,310
this<font color="#CCCCCC"> location you must</font><font color="#E5E5E5"> first add</font><font color="#CCCCCC"> the</font>

140
00:05:29,810 --> 00:05:34,130
<font color="#CCCCCC">website to your trusted sites list</font>

141
00:05:31,310 --> 00:05:36,560
browse<font color="#E5E5E5"> to the</font><font color="#CCCCCC"> web site and</font><font color="#E5E5E5"> select the</font>

142
00:05:34,130 --> 00:05:39,469
option to<font color="#E5E5E5"> log in automatically sounds</font>

143
00:05:36,560 --> 00:05:41,120
<font color="#E5E5E5">easy right so this</font><font color="#CCCCCC"> is where</font><font color="#E5E5E5"> PowerShell</font>

144
00:05:39,470 --> 00:05:42,289
comes in so fortunately or unfortunately

145
00:05:41,120 --> 00:05:44,030
for<font color="#E5E5E5"> us</font>

146
00:05:42,289 --> 00:05:46,099
Microsoft has<font color="#E5E5E5"> spent a lot of time</font>

147
00:05:44,030 --> 00:05:48,049
developing<font color="#E5E5E5"> the libraries</font><font color="#CCCCCC"> in PowerShell</font>

148
00:05:46,099 --> 00:05:50,930
so that it can<font color="#CCCCCC"> interact with</font><font color="#E5E5E5"> and control</font>

149
00:05:48,050 --> 00:05:53,659
Internet Explorer and<font color="#E5E5E5"> we can use this of</font>

150
00:05:50,930 --> 00:05:56,210
<font color="#CCCCCC">course to load up portal dot office comm</font>

151
00:05:53,659 --> 00:05:58,280
<font color="#E5E5E5">we can avoid</font><font color="#CCCCCC"> any single sign-on</font>

152
00:05:56,210 --> 00:06:00,830
technologies of course<font color="#CCCCCC"> if a</font><font color="#E5E5E5"> target is</font>

153
00:05:58,280 --> 00:06:02,059
<font color="#E5E5E5">already using</font><font color="#CCCCCC"> office 365 generally</font>

154
00:06:00,830 --> 00:06:03,289
<font color="#CCCCCC">speaking when you navigate there you'll</font>

155
00:06:02,060 --> 00:06:05,270
<font color="#CCCCCC">be automatically</font><font color="#E5E5E5"> logged into their</font>

156
00:06:03,289 --> 00:06:07,490
<font color="#E5E5E5">account which will of</font><font color="#CCCCCC"> course defeat our</font>

157
00:06:05,270 --> 00:06:08,840
purpose<font color="#CCCCCC"> and then we can</font><font color="#E5E5E5"> enter</font>

158
00:06:07,490 --> 00:06:10,520
credentials<font color="#E5E5E5"> click on a few buttons and</font>

159
00:06:08,840 --> 00:06:12,258
<font color="#CCCCCC">we can do all of this without launching</font>

160
00:06:10,520 --> 00:06:13,639
<font color="#CCCCCC">Internet explorer in a way that the</font><font color="#E5E5E5"> user</font>

161
00:06:12,259 --> 00:06:14,750
<font color="#E5E5E5">can see it so if they're staring at</font>

162
00:06:13,639 --> 00:06:18,349
their desktop<font color="#CCCCCC"> and you do this nothing</font>

163
00:06:14,750 --> 00:06:20,090
<font color="#E5E5E5">pops up so an important part</font><font color="#CCCCCC"> of the talk</font>

164
00:06:18,349 --> 00:06:21,590
of<font color="#E5E5E5"> course but if anyone can come up</font><font color="#CCCCCC"> with</font>

165
00:06:20,090 --> 00:06:23,359
a<font color="#E5E5E5"> legitimate reason</font><font color="#CCCCCC"> for being</font>

166
00:06:21,590 --> 00:06:26,469
able to<font color="#E5E5E5"> set ie visible to false</font><font color="#CCCCCC"> I will</font>

167
00:06:23,360 --> 00:06:29,210
<font color="#CCCCCC">buy them a cookie you can</font><font color="#E5E5E5"> find me after</font>

168
00:06:26,470 --> 00:06:30,980
so<font color="#E5E5E5"> face one of course for</font><font color="#CCCCCC"> our first</font>

169
00:06:29,210 --> 00:06:32,510
proof of concept is being<font color="#E5E5E5"> able to get</font>

170
00:06:30,980 --> 00:06:34,250
that<font color="#E5E5E5"> sample token since we can't do</font>

171
00:06:32,510 --> 00:06:36,110
anything without<font color="#E5E5E5"> its and this is just</font>

172
00:06:34,250 --> 00:06:37,610
the site that you are<font color="#E5E5E5"> the page that you</font>

173
00:06:36,110 --> 00:06:39,410
see<font color="#E5E5E5"> when you actually navigate to portal</font>

174
00:06:37,610 --> 00:06:41,510
<font color="#CCCCCC">dot</font><font color="#E5E5E5"> office</font><font color="#CCCCCC"> com you</font><font color="#E5E5E5"> actually get</font>

175
00:06:39,410 --> 00:06:44,420
redirected<font color="#E5E5E5"> to log</font><font color="#CCCCCC"> in Microsoft online</font>

176
00:06:41,510 --> 00:06:46,099
comm<font color="#E5E5E5"> and then a very important check</font><font color="#CCCCCC"> box</font>

177
00:06:44,420 --> 00:06:48,170
<font color="#CCCCCC">this was actually</font><font color="#E5E5E5"> what triggers</font><font color="#CCCCCC"> that</font>

178
00:06:46,100 --> 00:06:50,030
sam'l token to be pushed<font color="#CCCCCC"> is the keep me</font>

179
00:06:48,170 --> 00:06:55,940
signed in button of course<font color="#CCCCCC"> and we're</font>

180
00:06:50,030 --> 00:06:58,190
using bad guy as our user<font color="#E5E5E5"> so it's gonna</font>

181
00:06:55,940 --> 00:06:59,930
take a quick drink<font color="#E5E5E5"> this is some again</font>

182
00:06:58,190 --> 00:07:01,460
very simple<font color="#CCCCCC"> PowerShell we've got clear</font>

183
00:06:59,930 --> 00:07:04,220
text credentials of course since again

184
00:07:01,460 --> 00:07:05,510
<font color="#E5E5E5">we're trying</font><font color="#CCCCCC"> to keep</font><font color="#E5E5E5"> things</font><font color="#CCCCCC"> simple we go</font>

185
00:07:04,220 --> 00:07:07,010
through initially killing<font color="#E5E5E5"> internet</font>

186
00:07:05,510 --> 00:07:09,890
<font color="#E5E5E5">explorer so we can manipulate what we</font>

187
00:07:07,010 --> 00:07:11,750
need to online five<font color="#E5E5E5"> lines seven through</font>

188
00:07:09,890 --> 00:07:14,390
<font color="#CCCCCC">ten is using run DLL thirty-two to</font>

189
00:07:11,750 --> 00:07:16,400
simply clean up forms passwords<font color="#E5E5E5"> and</font>

190
00:07:14,390 --> 00:07:19,490
cookies which is<font color="#E5E5E5"> generally where</font><font color="#CCCCCC"> SSO</font>

191
00:07:16,400 --> 00:07:22,520
lives<font color="#CCCCCC"> twelve will instantiate</font><font color="#E5E5E5"> ie</font>

192
00:07:19,490 --> 00:07:24,620
<font color="#E5E5E5">thirteen as our lovely set a evil to</font>

193
00:07:22,520 --> 00:07:27,409
false which<font color="#CCCCCC"> means it's not</font><font color="#E5E5E5"> going to pop</font>

194
00:07:24,620 --> 00:07:29,150
up<font color="#E5E5E5"> for the user to see</font><font color="#CCCCCC"> the next couple</font>

195
00:07:27,410 --> 00:07:31,790
lines actually<font color="#E5E5E5"> navigate to the URL</font><font color="#CCCCCC"> and</font>

196
00:07:29,150 --> 00:07:34,340
we sleep while<font color="#CCCCCC"> Internet</font><font color="#E5E5E5"> Explorer is</font>

197
00:07:31,790 --> 00:07:36,590
loading<font color="#E5E5E5"> it to deal with latency but then</font>

198
00:07:34,340 --> 00:07:39,049
thankfully<font color="#E5E5E5"> for us we've got the ability</font>

199
00:07:36,590 --> 00:07:41,150
<font color="#CCCCCC">to search for specific element IDs</font>

200
00:07:39,050 --> 00:07:44,150
within<font color="#CCCCCC"> powershell so we look for</font>

201
00:07:41,150 --> 00:07:46,310
<font color="#E5E5E5">specifically our user ID input text our</font>

202
00:07:44,150 --> 00:07:47,989
passwords<font color="#E5E5E5"> and then the most important</font>

203
00:07:46,310 --> 00:07:50,840
one is keep me signed in as a<font color="#E5E5E5"> checkbox</font>

204
00:07:47,990 --> 00:07:52,640
<font color="#CCCCCC">we set</font><font color="#E5E5E5"> it to checked and true and then</font>

205
00:07:50,840 --> 00:07:54,140
we actually<font color="#E5E5E5"> have to go in and click on</font>

206
00:07:52,640 --> 00:07:56,080
the buttons of course<font color="#CCCCCC"> so there</font><font color="#E5E5E5"> are is</font>

207
00:07:54,140 --> 00:07:58,219
some filler text<font color="#CCCCCC"> that you will see</font>

208
00:07:56,080 --> 00:07:59,930
basically sample<font color="#E5E5E5"> usernames that you</font>

209
00:07:58,220 --> 00:08:03,230
actually have to<font color="#E5E5E5"> click</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> to delete and</font>

210
00:07:59,930 --> 00:08:06,530
<font color="#E5E5E5">then we click and click on sign in so</font>

211
00:08:03,230 --> 00:08:07,960
this<font color="#E5E5E5"> is our first demo it's a very</font>

212
00:08:06,530 --> 00:08:10,280
simple<font color="#E5E5E5"> of</font><font color="#CCCCCC"> course and we've set I equal</font>

213
00:08:07,960 --> 00:08:13,400
so you<font color="#E5E5E5"> guys can</font><font color="#CCCCCC"> follow along</font><font color="#E5E5E5"> with what's</font>

214
00:08:10,280 --> 00:08:15,109
<font color="#CCCCCC">going on but</font><font color="#E5E5E5"> we load things up you can</font>

215
00:08:13,400 --> 00:08:16,669
<font color="#CCCCCC">see the sample</font><font color="#E5E5E5"> text here</font><font color="#CCCCCC"> so someone an</font>

216
00:08:15,110 --> 00:08:19,340
example you do have to click on<font color="#CCCCCC"> that</font>

217
00:08:16,670 --> 00:08:20,750
unfortunately<font color="#E5E5E5"> for it to go away but</font>

218
00:08:19,340 --> 00:08:21,770
<font color="#E5E5E5">we're just gonna copy paste in the</font>

219
00:08:20,750 --> 00:08:24,590
<font color="#CCCCCC">powershell that we were</font><font color="#E5E5E5"> looking at</font>

220
00:08:21,770 --> 00:08:26,900
<font color="#E5E5E5">before we can see</font><font color="#CCCCCC"> IE pops up we delete</font>

221
00:08:24,590 --> 00:08:28,909
our cookies and it takes about one<font color="#CCCCCC"> to</font>

222
00:08:26,900 --> 00:08:31,090
<font color="#CCCCCC">two seconds</font><font color="#E5E5E5"> for this to happen and we're</font>

223
00:08:28,910 --> 00:08:33,060
presented with<font color="#CCCCCC"> bad guys sharepoint dr</font>

224
00:08:31,090 --> 00:08:36,150
easy enough

225
00:08:33,059 --> 00:08:38,390
so<font color="#E5E5E5"> Phase</font><font color="#CCCCCC"> two of what we're trying to do</font>

226
00:08:36,150 --> 00:08:41,189
<font color="#E5E5E5">here of</font><font color="#CCCCCC"> course we need to</font><font color="#E5E5E5"> then add</font>

227
00:08:38,390 --> 00:08:42,539
<font color="#CCCCCC">SharePoint into our trusted sites so we</font>

228
00:08:41,190 --> 00:08:44,700
<font color="#CCCCCC">can mount the drive and then of course</font>

229
00:08:42,539 --> 00:08:46,740
<font color="#E5E5E5">most interestingly is actually matching</font>

230
00:08:44,700 --> 00:08:48,690
the drive itself<font color="#E5E5E5"> so again we have to</font>

231
00:08:46,740 --> 00:08:50,640
define some<font color="#E5E5E5"> credentials to use for our</font>

232
00:08:48,690 --> 00:08:52,350
<font color="#CCCCCC">SharePoint Drive</font><font color="#E5E5E5"> and they do need</font><font color="#CCCCCC"> to be</font>

233
00:08:50,640 --> 00:08:54,360
<font color="#CCCCCC">stored as a secure string</font><font color="#E5E5E5"> which is why</font>

234
00:08:52,350 --> 00:08:56,490
you<font color="#E5E5E5"> see that</font><font color="#CCCCCC"> up there</font><font color="#E5E5E5"> but generic</font>

235
00:08:54,360 --> 00:08:59,240
domains are generic credentials I should

236
00:08:56,490 --> 00:09:02,040
say<font color="#E5E5E5"> then we actually have to go and add</font>

237
00:08:59,240 --> 00:09:05,250
some<font color="#E5E5E5"> registry keys so</font><font color="#CCCCCC"> that I</font><font color="#E5E5E5"> recognizes</font>

238
00:09:02,040 --> 00:09:06,660
the place as a<font color="#E5E5E5"> trusted site</font><font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> assuming</font>

239
00:09:05,250 --> 00:09:08,280
most of<font color="#E5E5E5"> you</font><font color="#CCCCCC"> guys know how to do this at</font>

240
00:09:06,660 --> 00:09:09,810
this point<font color="#E5E5E5"> but basically</font><font color="#CCCCCC"> all it is</font><font color="#E5E5E5"> is</font>

241
00:09:08,280 --> 00:09:12,420
doing<font color="#E5E5E5"> you're setting a location you're</font>

242
00:09:09,810 --> 00:09:14,400
creating a key and then<font color="#E5E5E5"> depending on the</font>

243
00:09:12,420 --> 00:09:16,469
OS version so in Windows 10 you'll see

244
00:09:14,400 --> 00:09:18,000
this<font color="#E5E5E5"> pop up as red text but</font><font color="#CCCCCC"> you may have</font>

245
00:09:16,470 --> 00:09:21,060
<font color="#E5E5E5">to</font><font color="#CCCCCC"> hard-code your sub domain in there in</font>

246
00:09:18,000 --> 00:09:22,680
this<font color="#E5E5E5"> case bad domain</font><font color="#CCCCCC"> Windows 10 you</font>

247
00:09:21,060 --> 00:09:24,540
<font color="#E5E5E5">don't have to do that of</font><font color="#CCCCCC"> course and then</font>

248
00:09:22,680 --> 00:09:26,219
<font color="#E5E5E5">we just add some</font><font color="#CCCCCC"> D words so generally</font>

249
00:09:24,540 --> 00:09:29,760
speaking<font color="#E5E5E5"> you</font><font color="#CCCCCC"> still only need to add</font>

250
00:09:26,220 --> 00:09:31,380
<font color="#E5E5E5">HTTPS here but we've added HTTP and a</font>

251
00:09:29,760 --> 00:09:33,590
<font color="#CCCCCC">wild-card just</font><font color="#E5E5E5"> in case there is some</font>

252
00:09:31,380 --> 00:09:35,700
strange web peroxy downgrading or

253
00:09:33,590 --> 00:09:38,640
something else is going<font color="#CCCCCC"> on the wire and</font>

254
00:09:35,700 --> 00:09:39,750
<font color="#E5E5E5">then of course 16 and 17 are the</font><font color="#CCCCCC"> root of</font>

255
00:09:38,640 --> 00:09:42,240
what we're trying<font color="#E5E5E5"> to do here</font><font color="#CCCCCC"> but</font>

256
00:09:39,750 --> 00:09:43,770
mounting<font color="#E5E5E5"> the drive itself</font><font color="#CCCCCC"> so new PS</font>

257
00:09:42,240 --> 00:09:45,830
<font color="#E5E5E5">drive is</font><font color="#CCCCCC"> pretty simple</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> use</font><font color="#E5E5E5"> and by</font>

258
00:09:43,770 --> 00:09:48,060
default<font color="#E5E5E5"> it will mount a temporary</font><font color="#CCCCCC"> drive</font>

259
00:09:45,830 --> 00:09:49,680
which disappears<font color="#CCCCCC"> after the shell has</font>

260
00:09:48,060 --> 00:09:51,150
been<font color="#E5E5E5"> closed but it's also harder to</font>

261
00:09:49,680 --> 00:09:53,400
detect of course so for<font color="#E5E5E5"> our purposes</font>

262
00:09:51,150 --> 00:09:55,680
<font color="#CCCCCC">that's</font><font color="#E5E5E5"> what we're gonna do we specify</font>

263
00:09:53,400 --> 00:09:57,630
<font color="#CCCCCC">the name</font><font color="#E5E5E5"> so we've gone with J</font><font color="#CCCCCC"> Drive we</font>

264
00:09:55,680 --> 00:09:59,569
set the provider to<font color="#CCCCCC"> be the filesystem</font><font color="#E5E5E5"> of</font>

265
00:09:57,630 --> 00:10:02,160
course and we specify the root directory

266
00:09:59,570 --> 00:10:04,080
<font color="#CCCCCC">now it's a long string of course but</font>

267
00:10:02,160 --> 00:10:06,540
we've<font color="#E5E5E5"> specified eviler - my SharePoint</font>

268
00:10:04,080 --> 00:10:09,090
<font color="#CCCCCC">comm and</font><font color="#E5E5E5"> the most important one is SSL</font>

269
00:10:06,540 --> 00:10:11,430
of course so it gets encrypted<font color="#E5E5E5"> excuse me</font>

270
00:10:09,090 --> 00:10:12,960
<font color="#E5E5E5">and then we specify root personal and</font>

271
00:10:11,430 --> 00:10:15,030
then the the full<font color="#CCCCCC"> username and</font><font color="#E5E5E5"> domain</font>

272
00:10:12,960 --> 00:10:17,010
and we<font color="#E5E5E5"> specified documents as the root</font>

273
00:10:15,030 --> 00:10:20,130
directory<font color="#CCCCCC"> and then we feed in the</font>

274
00:10:17,010 --> 00:10:21,510
credentials<font color="#E5E5E5"> it's not too difficult but</font>

275
00:10:20,130 --> 00:10:23,790
<font color="#E5E5E5">we're gonna have another demo here of</font>

276
00:10:21,510 --> 00:10:25,980
just going<font color="#CCCCCC"> through</font><font color="#E5E5E5"> this quickly</font><font color="#CCCCCC"> and as</font>

277
00:10:23,790 --> 00:10:27,240
we<font color="#E5E5E5"> mentioned before of</font><font color="#CCCCCC"> course in File</font>

278
00:10:25,980 --> 00:10:28,710
<font color="#CCCCCC">Explorer most users are</font><font color="#E5E5E5"> going to</font>

279
00:10:27,240 --> 00:10:30,510
<font color="#CCCCCC">interact just simply by clicking on my</font>

280
00:10:28,710 --> 00:10:32,550
<font color="#E5E5E5">computer</font><font color="#CCCCCC"> or my</font><font color="#E5E5E5"> PC depending on the</font>

281
00:10:30,510 --> 00:10:34,230
version and they're gonna see devices

282
00:10:32,550 --> 00:10:35,490
and drives pop up first<font color="#CCCCCC"> and</font><font color="#E5E5E5"> of course</font>

283
00:10:34,230 --> 00:10:37,440
you're gonna see<font color="#E5E5E5"> that this is not</font>

284
00:10:35,490 --> 00:10:40,070
present so we're<font color="#CCCCCC"> just looking to zone</font>

285
00:10:37,440 --> 00:10:42,420
map obviously nothing is<font color="#E5E5E5"> there right now</font>

286
00:10:40,070 --> 00:10:43,770
<font color="#E5E5E5">I'm gonna show get PS Drive which is</font><font color="#CCCCCC"> a</font>

287
00:10:42,420 --> 00:10:45,540
way to<font color="#CCCCCC"> actually display</font><font color="#E5E5E5"> PowerShell</font>

288
00:10:43,770 --> 00:10:46,110
drives<font color="#E5E5E5"> but of course we can see nothing</font>

289
00:10:45,540 --> 00:10:48,029
is

290
00:10:46,110 --> 00:10:51,540
mounted<font color="#E5E5E5"> at all other</font><font color="#CCCCCC"> than C and D at</font>

291
00:10:48,029 --> 00:10:52,500
this point so we're gonna paste in the

292
00:10:51,540 --> 00:10:54,120
<font color="#CCCCCC">powershell that we were</font><font color="#E5E5E5"> looking at</font>

293
00:10:52,500 --> 00:10:57,000
<font color="#E5E5E5">before</font><font color="#CCCCCC"> there's the red text</font><font color="#E5E5E5"> e what</font>

294
00:10:54,120 --> 00:10:58,620
expects but now we can see that<font color="#CCCCCC"> g has</font>

295
00:10:57,000 --> 00:11:01,470
actually been added and<font color="#E5E5E5"> we can see the</font>

296
00:10:58,620 --> 00:11:04,320
full path there as<font color="#E5E5E5"> it's on SharePoint at</font>

297
00:11:01,470 --> 00:11:06,209
SSL so we're gonna<font color="#E5E5E5"> see D into the drive</font>

298
00:11:04,320 --> 00:11:08,459
and we're gonna<font color="#E5E5E5"> validate that we now</font>

299
00:11:06,209 --> 00:11:10,339
have<font color="#E5E5E5"> write and read access to the</font>

300
00:11:08,459 --> 00:11:13,399
<font color="#CCCCCC">directory so</font><font color="#E5E5E5"> nothing's present right</font><font color="#CCCCCC"> now</font>

301
00:11:10,339 --> 00:11:16,529
but we're<font color="#E5E5E5"> gonna echo in this is a text</font>

302
00:11:13,399 --> 00:11:22,680
into a test file<font color="#E5E5E5"> and we're gonna see</font>

303
00:11:16,529 --> 00:11:24,899
that<font color="#CCCCCC"> it works</font><font color="#E5E5E5"> so we can see we now have</font>

304
00:11:22,680 --> 00:11:26,160
a<font color="#CCCCCC"> a usable</font><font color="#E5E5E5"> Drive thankfully and we can</font>

305
00:11:24,899 --> 00:11:28,500
see the full path there if you'd like<font color="#E5E5E5"> to</font>

306
00:11:26,160 --> 00:11:30,240
look at it and<font color="#E5E5E5"> we'll validate that we've</font>

307
00:11:28,500 --> 00:11:32,490
also got read<font color="#E5E5E5"> access which isn't</font>

308
00:11:30,240 --> 00:11:33,959
necessarily implied but we can just<font color="#CCCCCC"> you</font>

309
00:11:32,490 --> 00:11:36,630
get content on the file and<font color="#CCCCCC"> we see that</font>

310
00:11:33,959 --> 00:11:37,920
<font color="#E5E5E5">this is a test so checking out</font><font color="#CCCCCC"> file</font>

311
00:11:36,630 --> 00:11:40,200
<font color="#CCCCCC">explorer</font><font color="#E5E5E5"> again we can see again</font>

312
00:11:37,920 --> 00:11:41,550
refreshing it<font color="#E5E5E5"> the user sees nothing</font><font color="#CCCCCC"> they</font>

313
00:11:40,200 --> 00:11:44,160
<font color="#E5E5E5">are completely</font><font color="#CCCCCC"> unaware that</font><font color="#E5E5E5"> there's a</font>

314
00:11:41,550 --> 00:11:45,959
drive<font color="#CCCCCC"> now mounted</font><font color="#E5E5E5"> on their system and</font><font color="#CCCCCC"> of</font>

315
00:11:44,160 --> 00:11:47,430
<font color="#E5E5E5">course going</font><font color="#CCCCCC"> back and refreshing we now</font>

316
00:11:45,959 --> 00:11:53,489
see<font color="#E5E5E5"> sharepoint with all of our</font><font color="#CCCCCC"> d words</font>

317
00:11:47,430 --> 00:11:55,019
that we would expect<font color="#CCCCCC"> alright moving on</font>

318
00:11:53,490 --> 00:11:57,449
<font color="#CCCCCC">so phase</font><font color="#E5E5E5"> 3 is</font><font color="#CCCCCC"> actually doing something</font>

319
00:11:55,019 --> 00:12:00,180
<font color="#E5E5E5">interesting of</font><font color="#CCCCCC"> course again in the</font>

320
00:11:57,449 --> 00:12:01,469
spirit of keeping<font color="#E5E5E5"> things simple we're</font>

321
00:12:00,180 --> 00:12:03,029
<font color="#CCCCCC">just simply going through were</font>

322
00:12:01,470 --> 00:12:05,220
identifying all files<font color="#E5E5E5"> in the users</font>

323
00:12:03,029 --> 00:12:07,290
directory where<font color="#CCCCCC"> quote-unquote stealing</font>

324
00:12:05,220 --> 00:12:09,630
all<font color="#CCCCCC"> of their PDFs</font><font color="#E5E5E5"> recursively within</font>

325
00:12:07,290 --> 00:12:11,519
their users directory and then for the

326
00:12:09,630 --> 00:12:12,839
<font color="#CCCCCC">c2 portion of things we're going to go</font>

327
00:12:11,519 --> 00:12:16,829
<font color="#CCCCCC">and run some commands</font>

328
00:12:12,839 --> 00:12:18,120
so<font color="#E5E5E5"> today's commands not txt and most of</font>

329
00:12:16,829 --> 00:12:21,899
you are probably aware<font color="#E5E5E5"> this are any of a</font>

330
00:12:18,120 --> 00:12:23,519
powershell by default<font color="#CCCCCC"> prevents you from</font>

331
00:12:21,899 --> 00:12:25,890
running<font color="#E5E5E5"> powershell scripts on a default</font>

332
00:12:23,519 --> 00:12:28,050
<font color="#E5E5E5">install of</font><font color="#CCCCCC"> Windows so there's many ways</font>

333
00:12:25,890 --> 00:12:30,209
around that<font color="#CCCCCC"> specific execution policy</font>

334
00:12:28,050 --> 00:12:31,920
<font color="#E5E5E5">restriction but the simplest and</font>

335
00:12:30,209 --> 00:12:33,660
probably<font color="#CCCCCC"> my favorite is simply reading</font>

336
00:12:31,920 --> 00:12:35,939
<font color="#E5E5E5">in those commands from say a text file</font>

337
00:12:33,660 --> 00:12:37,079
and piping them<font color="#E5E5E5"> into PowerShell that's</font>

338
00:12:35,940 --> 00:12:40,290
good<font color="#CCCCCC"> enough to get around that</font>

339
00:12:37,079 --> 00:12:43,439
restriction so I'm gonna<font color="#E5E5E5"> have another</font>

340
00:12:40,290 --> 00:12:48,149
simple demo here we can see that<font color="#CCCCCC"> we're</font>

341
00:12:43,440 --> 00:12:49,230
currently in our<font color="#CCCCCC"> sharepoint drive we're</font>

342
00:12:48,149 --> 00:12:52,829
gonna paste in the commands<font color="#E5E5E5"> we were</font>

343
00:12:49,230 --> 00:12:54,420
talking<font color="#E5E5E5"> about earlier and we can see it</font>

344
00:12:52,829 --> 00:12:57,569
<font color="#E5E5E5">slowly go</font><font color="#CCCCCC"> through and identify all the</font>

345
00:12:54,420 --> 00:12:58,170
files and identify and upload all PDFs

346
00:12:57,569 --> 00:13:00,329
into<font color="#CCCCCC"> that</font><font color="#E5E5E5"> sheriff</font>

347
00:12:58,170 --> 00:13:01,979
so this is<font color="#CCCCCC"> coming at it from the data</font>

348
00:13:00,329 --> 00:13:05,099
exfiltration perspective of course<font color="#E5E5E5"> which</font>

349
00:13:01,980 --> 00:13:06,870
is most concerning<font color="#CCCCCC"> to enterprise</font>

350
00:13:05,100 --> 00:13:09,540
<font color="#E5E5E5">customers of course it's not</font><font color="#CCCCCC"> the only</font>

351
00:13:06,870 --> 00:13:11,670
<font color="#E5E5E5">thing you can do but it's an example so</font>

352
00:13:09,540 --> 00:13:13,889
we<font color="#CCCCCC"> can</font><font color="#E5E5E5"> see we've got</font><font color="#CCCCCC"> current files we've</font>

353
00:13:11,670 --> 00:13:15,719
got<font color="#E5E5E5"> financial statements etc etc just a</font>

354
00:13:13,889 --> 00:13:17,820
demo<font color="#E5E5E5"> and we can see</font><font color="#CCCCCC"> that we've now</font>

355
00:13:15,720 --> 00:13:23,070
<font color="#E5E5E5">popped calc and we've</font><font color="#CCCCCC"> loaded up blackhat</font>

356
00:13:17,820 --> 00:13:25,620
<font color="#CCCCCC">calm nice and simple so I guess</font><font color="#E5E5E5"> for the</font>

357
00:13:23,070 --> 00:13:26,820
purposes of<font color="#E5E5E5"> the talk obviously that's</font>

358
00:13:25,620 --> 00:13:30,240
nice but<font color="#E5E5E5"> we need to look at it</font>

359
00:13:26,820 --> 00:13:31,589
weaponizing it a little bit so we've

360
00:13:30,240 --> 00:13:34,500
gone with<font color="#E5E5E5"> something simple again and</font>

361
00:13:31,589 --> 00:13:37,649
just<font color="#E5E5E5"> gone with a macro enabled Word</font>

362
00:13:34,500 --> 00:13:39,240
documents<font color="#CCCCCC"> and doing</font><font color="#E5E5E5"> this just using</font>

363
00:13:37,649 --> 00:13:41,370
<font color="#E5E5E5">unicorn so one of my</font><font color="#CCCCCC"> favorite</font><font color="#E5E5E5"> tools of</font>

364
00:13:39,240 --> 00:13:43,350
course<font color="#E5E5E5"> written by trusted</font><font color="#CCCCCC"> SEC but it's</font>

365
00:13:41,370 --> 00:13:45,029
probably<font color="#CCCCCC"> the easiest way to take some</font>

366
00:13:43,350 --> 00:13:46,980
raw<font color="#CCCCCC"> powershell that you've</font><font color="#E5E5E5"> developed and</font>

367
00:13:45,029 --> 00:13:49,050
instantly convert it into<font color="#E5E5E5"> something you</font>

368
00:13:46,980 --> 00:13:51,000
can<font color="#E5E5E5"> paste into vb editor and use as a</font>

369
00:13:49,050 --> 00:13:53,040
macro it's<font color="#E5E5E5"> very simple and</font><font color="#CCCCCC"> i'll show you</font>

370
00:13:51,000 --> 00:13:56,010
<font color="#E5E5E5">how to do that as you'll see on the next</font>

371
00:13:53,040 --> 00:13:57,599
<font color="#CCCCCC">slide at least using</font><font color="#E5E5E5"> this method most</font>

372
00:13:56,010 --> 00:14:00,600
detections for<font color="#CCCCCC"> endpoints tools are</font>

373
00:13:57,600 --> 00:14:02,130
relatively<font color="#E5E5E5"> non-existent</font><font color="#CCCCCC"> and unicorn</font>

374
00:14:00,600 --> 00:14:04,589
<font color="#E5E5E5">although it's not overly affected with</font>

375
00:14:02,130 --> 00:14:06,240
sandboxes it does try to evade them by

376
00:14:04,589 --> 00:14:09,300
delaying detonation until after the

377
00:14:06,240 --> 00:14:11,699
documents been closed so<font color="#E5E5E5"> you can try to</font>

378
00:14:09,300 --> 00:14:15,180
<font color="#E5E5E5">remember this hash for later</font><font color="#CCCCCC"> but it</font>

379
00:14:11,699 --> 00:14:16,620
starts with<font color="#E5E5E5"> C 10 and in F 83 but at the</font>

380
00:14:15,180 --> 00:14:19,199
time<font color="#E5E5E5"> of submission our quote unquote</font>

381
00:14:16,620 --> 00:14:22,769
<font color="#E5E5E5">totally legitimate document was only</font>

382
00:14:19,199 --> 00:14:25,310
detected by<font color="#CCCCCC"> 4 out</font><font color="#E5E5E5"> of 58 vendors and it's</font>

383
00:14:22,769 --> 00:14:29,640
likely<font color="#CCCCCC"> that the four that</font><font color="#E5E5E5"> did detect it</font>

384
00:14:25,310 --> 00:14:31,619
identified a generic string<font color="#E5E5E5"> that</font><font color="#CCCCCC"> unicorn</font>

385
00:14:29,640 --> 00:14:33,269
uses as an error message<font color="#E5E5E5"> so if they look</font>

386
00:14:31,620 --> 00:14:37,320
<font color="#E5E5E5">for that they can usually find unicorn</font>

387
00:14:33,269 --> 00:14:38,610
quite easily and again for those<font color="#CCCCCC"> who</font>

388
00:14:37,320 --> 00:14:41,279
haven't actually seen<font color="#E5E5E5"> the output</font><font color="#CCCCCC"> of what</font>

389
00:14:38,610 --> 00:14:43,620
<font color="#E5E5E5">unicorn creates when you generate some</font>

390
00:14:41,279 --> 00:14:45,149
<font color="#CCCCCC">powershell</font><font color="#E5E5E5"> or feed a powershell</font><font color="#CCCCCC"> i should</font>

391
00:14:43,620 --> 00:14:47,250
say this<font color="#E5E5E5"> is just</font><font color="#CCCCCC"> what</font><font color="#E5E5E5"> it looks like</font>

392
00:14:45,149 --> 00:14:48,990
inside<font color="#CCCCCC"> of vb editor and you see</font><font color="#E5E5E5"> that</font>

393
00:14:47,250 --> 00:14:50,819
generic string<font color="#CCCCCC"> down here hopefully yeah</font>

394
00:14:48,990 --> 00:14:52,079
you can see my mouse you've got the

395
00:14:50,819 --> 00:14:53,370
document<font color="#E5E5E5"> appears to be made on an older</font>

396
00:14:52,079 --> 00:14:55,349
<font color="#E5E5E5">version of microsoft please have the</font>

397
00:14:53,370 --> 00:14:57,240
<font color="#E5E5E5">creator save to a newer and supported</font>

398
00:14:55,350 --> 00:14:58,860
format so frankly<font color="#E5E5E5"> that works on a lot</font><font color="#CCCCCC"> of</font>

399
00:14:57,240 --> 00:15:00,899
users<font color="#CCCCCC"> of course</font><font color="#E5E5E5"> but you can</font><font color="#CCCCCC"> write</font><font color="#E5E5E5"> easy</font>

400
00:14:58,860 --> 00:15:02,279
signatures to look for<font color="#E5E5E5"> that string so</font><font color="#CCCCCC"> if</font>

401
00:15:00,899 --> 00:15:06,980
you're going<font color="#E5E5E5"> to do this in a real pen</font>

402
00:15:02,279 --> 00:15:06,980
test of course probably change it

403
00:15:07,420 --> 00:15:14,329
so this is the<font color="#E5E5E5"> final demo for the first</font>

404
00:15:11,090 --> 00:15:16,490
proof of concepts<font color="#E5E5E5"> we're looking at the</font>

405
00:15:14,330 --> 00:15:20,029
attackers machine of course<font color="#CCCCCC"> so this is</font>

406
00:15:16,490 --> 00:15:21,140
on share points<font color="#E5E5E5"> and we're simply we</font><font color="#CCCCCC"> were</font>

407
00:15:20,029 --> 00:15:22,550
<font color="#E5E5E5">just refreshed it and we're gonna look</font>

408
00:15:21,140 --> 00:15:23,569
at today's commands of course<font color="#E5E5E5"> this is</font>

409
00:15:22,550 --> 00:15:25,520
completely arbitrary

410
00:15:23,570 --> 00:15:28,070
we're<font color="#E5E5E5"> just</font><font color="#CCCCCC"> poppin calc in this case and</font>

411
00:15:25,520 --> 00:15:29,630
loading up<font color="#E5E5E5"> ie but if you're doing this</font>

412
00:15:28,070 --> 00:15:32,270
<font color="#E5E5E5">for</font><font color="#CCCCCC"> real</font><font color="#E5E5E5"> you probably look at adding</font>

413
00:15:29,630 --> 00:15:33,950
some type of persistence mechanism or

414
00:15:32,270 --> 00:15:37,339
something else<font color="#CCCCCC"> that allow you to do</font><font color="#E5E5E5"> this</font>

415
00:15:33,950 --> 00:15:39,050
<font color="#E5E5E5">on a recurring basis so looking at our</font>

416
00:15:37,339 --> 00:15:42,740
<font color="#CCCCCC">powershell you'll notice that it's it's</font>

417
00:15:39,050 --> 00:15:45,770
called compressed<font color="#CCCCCC"> instead of having</font>

418
00:15:42,740 --> 00:15:48,320
<font color="#E5E5E5">every line</font><font color="#CCCCCC"> generator carriage return</font>

419
00:15:45,770 --> 00:15:49,699
<font color="#CCCCCC">VBA derp is</font><font color="#E5E5E5"> very particular about how</font>

420
00:15:48,320 --> 00:15:51,620
many carriage returns are present in the

421
00:15:49,700 --> 00:15:53,300
file<font color="#E5E5E5"> so you</font><font color="#CCCCCC"> can actually</font><font color="#E5E5E5"> compress say a</font>

422
00:15:51,620 --> 00:15:55,670
<font color="#E5E5E5">hundred lines of PowerShell like what</font>

423
00:15:53,300 --> 00:15:57,109
you see here down into one line<font color="#CCCCCC"> simply</font>

424
00:15:55,670 --> 00:15:59,779
by deleting<font color="#E5E5E5"> the carriage returns and</font>

425
00:15:57,110 --> 00:16:02,000
replacing them with semicolons there is

426
00:15:59,779 --> 00:16:04,970
a very low limit<font color="#E5E5E5"> when it comes to</font>

427
00:16:02,000 --> 00:16:06,890
carriage returns in most macros<font color="#CCCCCC"> so we</font>

428
00:16:04,970 --> 00:16:08,360
can see what it looks<font color="#E5E5E5"> like</font><font color="#CCCCCC"> and we're</font>

429
00:16:06,890 --> 00:16:10,040
<font color="#CCCCCC">just feeding</font><font color="#E5E5E5"> this in a unicorn it's very</font>

430
00:16:08,360 --> 00:16:13,460
simple so basically you just<font color="#E5E5E5"> specify</font>

431
00:16:10,040 --> 00:16:15,800
<font color="#E5E5E5">that what powershell you'd like to use</font>

432
00:16:13,460 --> 00:16:17,420
you specify<font color="#CCCCCC"> that you want to</font><font color="#E5E5E5"> generate a</font>

433
00:16:15,800 --> 00:16:19,969
macro and<font color="#CCCCCC"> you create</font><font color="#E5E5E5"> your character</font>

434
00:16:17,420 --> 00:16:22,550
limit of<font color="#CCCCCC"> 500 and that is all</font><font color="#E5E5E5"> you have to</font>

435
00:16:19,970 --> 00:16:26,089
do<font color="#CCCCCC"> - now get</font><font color="#E5E5E5"> powershell attack that txt</font>

436
00:16:22,550 --> 00:16:28,069
<font color="#CCCCCC">and that is a fully</font><font color="#E5E5E5"> working macro with</font>

437
00:16:26,089 --> 00:16:30,230
whatever powershell you've given it so

438
00:16:28,070 --> 00:16:33,290
that's<font color="#E5E5E5"> what it looks like it's important</font>

439
00:16:30,230 --> 00:16:35,480
to<font color="#E5E5E5"> note depending on what application</font>

440
00:16:33,290 --> 00:16:37,250
you're<font color="#CCCCCC"> targeting you may have to change</font>

441
00:16:35,480 --> 00:16:39,770
<font color="#E5E5E5">the sub-game so in this case by default</font>

442
00:16:37,250 --> 00:16:42,440
<font color="#E5E5E5">unicorn adds an underscore between</font><font color="#CCCCCC"> auto</font>

443
00:16:39,770 --> 00:16:44,480
and open<font color="#E5E5E5"> this works for</font><font color="#CCCCCC"> excel</font><font color="#E5E5E5"> but it</font>

444
00:16:42,440 --> 00:16:46,130
does not work<font color="#E5E5E5"> on</font><font color="#CCCCCC"> word</font><font color="#E5E5E5"> you actually have</font>

445
00:16:44,480 --> 00:16:47,780
to delete<font color="#E5E5E5"> the underscore and make sure</font>

446
00:16:46,130 --> 00:16:50,360
the macro is named correctly<font color="#E5E5E5"> as</font><font color="#CCCCCC"> well</font>

447
00:16:47,780 --> 00:16:53,870
it's a little<font color="#E5E5E5"> finicky but just so that</font>

448
00:16:50,360 --> 00:16:55,400
<font color="#E5E5E5">you're aware alright so moving on so</font>

449
00:16:53,870 --> 00:16:56,930
we're we're now<font color="#E5E5E5"> looking at corporate</font>

450
00:16:55,400 --> 00:16:59,750
<font color="#E5E5E5">drones workstation and we're</font><font color="#CCCCCC"> gonna need</font>

451
00:16:56,930 --> 00:17:01,280
to<font color="#E5E5E5"> use a bit</font><font color="#CCCCCC"> of our imagination and</font>

452
00:16:59,750 --> 00:17:03,860
assume<font color="#CCCCCC"> that he's been the target</font><font color="#E5E5E5"> of some</font>

453
00:17:01,280 --> 00:17:05,569
type of phishing attack but totally

454
00:17:03,860 --> 00:17:08,270
<font color="#E5E5E5">legitimate document has now ended up on</font>

455
00:17:05,569 --> 00:17:11,270
his desktop<font color="#CCCCCC"> as we can see there and</font>

456
00:17:08,270 --> 00:17:12,920
<font color="#E5E5E5">unlike most users more for the purposes</font>

457
00:17:11,270 --> 00:17:15,170
of<font color="#CCCCCC"> the demo we've got Wireshark running</font>

458
00:17:12,920 --> 00:17:17,380
here with a search query specifically

459
00:17:15,170 --> 00:17:20,740
looking for SSL handshake extensions

460
00:17:17,380 --> 00:17:23,290
for the<font color="#CCCCCC"> SNI of portal office.com and</font>

461
00:17:20,740 --> 00:17:24,849
this is just<font color="#E5E5E5"> a display what your</font>

462
00:17:23,290 --> 00:17:26,740
security infrastructure<font color="#E5E5E5"> is going</font><font color="#CCCCCC"> to</font>

463
00:17:24,849 --> 00:17:29,169
<font color="#CCCCCC">identify on the wire</font>

464
00:17:26,740 --> 00:17:32,200
when these attempts are made<font color="#E5E5E5"> assuming</font>

465
00:17:29,170 --> 00:17:33,160
you're not<font color="#E5E5E5"> doing SSL decryption so we'll</font>

466
00:17:32,200 --> 00:17:34,780
come back<font color="#CCCCCC"> to that in a minute</font>

467
00:17:33,160 --> 00:17:36,910
and we're just<font color="#CCCCCC"> going to</font><font color="#E5E5E5"> show</font><font color="#CCCCCC"> the hash</font>

468
00:17:34,780 --> 00:17:39,670
here<font color="#E5E5E5"> so you guys can try to remember or</font>

469
00:17:36,910 --> 00:17:43,180
recall what it<font color="#CCCCCC"> was in the last slide but</font>

470
00:17:39,670 --> 00:17:44,560
<font color="#E5E5E5">it's C 10 F 83 and yes you can do this</font>

471
00:17:43,180 --> 00:17:49,390
<font color="#E5E5E5">through PowerShell but this is easier to</font>

472
00:17:44,560 --> 00:17:50,350
read<font color="#E5E5E5"> at the back</font><font color="#CCCCCC"> anyways moving on</font><font color="#E5E5E5"> so</font>

473
00:17:49,390 --> 00:17:52,030
we're gonna<font color="#CCCCCC"> actually execute the</font>

474
00:17:50,350 --> 00:17:54,159
<font color="#E5E5E5">document and as you would expect word</font>

475
00:17:52,030 --> 00:17:56,200
has built-in macro protections so I

476
00:17:54,160 --> 00:17:58,720
actually before it<font color="#E5E5E5"> goes I lifted this</font>

477
00:17:56,200 --> 00:18:00,100
from an actual<font color="#CCCCCC"> sample of malware which I</font>

478
00:17:58,720 --> 00:18:02,500
guess is the credit<font color="#CCCCCC"> to Norton</font><font color="#E5E5E5"> but</font>

479
00:18:00,100 --> 00:18:04,449
<font color="#CCCCCC">end-users find this very trustworthy and</font>

480
00:18:02,500 --> 00:18:06,400
for<font color="#CCCCCC"> those of the back it simply says the</font>

481
00:18:04,450 --> 00:18:07,930
documents been secured<font color="#CCCCCC"> by Norton</font><font color="#E5E5E5"> to view</font>

482
00:18:06,400 --> 00:18:10,270
<font color="#E5E5E5">this protected</font><font color="#CCCCCC"> document click enable</font>

483
00:18:07,930 --> 00:18:12,430
content and this type of message works

484
00:18:10,270 --> 00:18:15,010
on a<font color="#E5E5E5"> very large</font><font color="#CCCCCC"> percentage of</font><font color="#E5E5E5"> end-users</font>

485
00:18:12,430 --> 00:18:17,140
unfortunately so just<font color="#E5E5E5"> clicking it we see</font>

486
00:18:15,010 --> 00:18:19,030
<font color="#CCCCCC">that generic message pop up saying</font><font color="#E5E5E5"> older</font>

487
00:18:17,140 --> 00:18:25,000
version of words<font color="#CCCCCC"> try to get a new one</font>

488
00:18:19,030 --> 00:18:26,530
<font color="#E5E5E5">from your from your sender and pressing</font>

489
00:18:25,000 --> 00:18:29,890
<font color="#E5E5E5">ok</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> course from the users perspective</font>

490
00:18:26,530 --> 00:18:32,230
<font color="#E5E5E5">nothing happens it goes blank as you</font>

491
00:18:29,890 --> 00:18:33,940
would<font color="#CCCCCC"> probably expect</font><font color="#E5E5E5"> but jumping on</font>

492
00:18:32,230 --> 00:18:36,660
Wireshark<font color="#E5E5E5"> and looking at the wire we see</font>

493
00:18:33,940 --> 00:18:40,960
multiple requests to portal office comm

494
00:18:36,660 --> 00:18:43,090
<font color="#CCCCCC">and that's all you see so if you are not</font>

495
00:18:40,960 --> 00:18:45,430
<font color="#E5E5E5">looking at doing SSL decryption between</font>

496
00:18:43,090 --> 00:18:48,820
your enterprise and<font color="#CCCCCC"> office</font><font color="#E5E5E5"> that's what</font>

497
00:18:45,430 --> 00:18:50,440
you see it's very<font color="#E5E5E5"> difficult to identify</font>

498
00:18:48,820 --> 00:18:52,510
this<font color="#E5E5E5"> as being any type of malicious</font>

499
00:18:50,440 --> 00:18:57,970
behavior whatsoever<font color="#CCCCCC"> especially if it's</font>

500
00:18:52,510 --> 00:19:00,670
being run once moving on of course<font color="#E5E5E5"> calc</font>

501
00:18:57,970 --> 00:19:03,070
eventually pops<font color="#E5E5E5"> as</font><font color="#CCCCCC"> well as</font><font color="#E5E5E5"> blackhat</font>

502
00:19:00,670 --> 00:19:04,390
coming up<font color="#E5E5E5"> that we can see you moving</font>

503
00:19:03,070 --> 00:19:06,159
<font color="#E5E5E5">back to the attackers machine as</font><font color="#CCCCCC"> you</font>

504
00:19:04,390 --> 00:19:07,900
would probably<font color="#CCCCCC"> expect the files that</font><font color="#E5E5E5"> we</font>

505
00:19:06,160 --> 00:19:10,540
looked<font color="#E5E5E5"> at before have now been</font><font color="#CCCCCC"> uploaded</font>

506
00:19:07,900 --> 00:19:12,040
into<font color="#E5E5E5"> SharePoint</font><font color="#CCCCCC"> we can click</font><font color="#E5E5E5"> on the</font>

507
00:19:10,540 --> 00:19:15,070
desktop we've got it named appropriately

508
00:19:12,040 --> 00:19:17,050
<font color="#E5E5E5">for that specific user going</font><font color="#CCCCCC"> to uploads</font>

509
00:19:15,070 --> 00:19:18,370
and we can see once it loads that all of

510
00:19:17,050 --> 00:19:21,210
the files that we would expect<font color="#E5E5E5"> to be</font>

511
00:19:18,370 --> 00:19:21,209
<font color="#E5E5E5">there are now there</font>

512
00:19:23,350 --> 00:19:29,280
and it's<font color="#E5E5E5"> um</font><font color="#CCCCCC"> it's surprisingly easy</font><font color="#E5E5E5"> to do</font>

513
00:19:26,410 --> 00:19:29,280
this as you<font color="#CCCCCC"> guys have</font><font color="#E5E5E5"> seen</font>

514
00:19:32,950 --> 00:19:37,720
<font color="#E5E5E5">all right so as you</font><font color="#CCCCCC"> would expect just</font><font color="#E5E5E5"> a</font>

515
00:19:36,160 --> 00:19:39,220
list<font color="#E5E5E5"> but again it's a demo it's a</font>

516
00:19:37,720 --> 00:19:41,050
<font color="#CCCCCC">proof-of-concept you guys can use your</font>

517
00:19:39,220 --> 00:19:43,120
<font color="#E5E5E5">imagination and think of what an actual</font>

518
00:19:41,050 --> 00:19:48,280
pen test or something<font color="#CCCCCC"> worse might be</font>

519
00:19:43,120 --> 00:19:49,780
conducting here so for the<font color="#E5E5E5"> blue</font><font color="#CCCCCC"> teams in</font>

520
00:19:48,280 --> 00:19:51,610
the room of<font color="#CCCCCC"> course</font>

521
00:19:49,780 --> 00:19:53,800
the easiest way<font color="#CCCCCC"> of course the CIM at</font>

522
00:19:51,610 --> 00:19:56,020
this is from the network side<font color="#CCCCCC"> but it</font>

523
00:19:53,800 --> 00:20:00,250
does<font color="#E5E5E5"> require you to decrypt TLS on the</font>

524
00:19:56,020 --> 00:20:02,230
wire which can be of course<font color="#E5E5E5"> expensive</font><font color="#CCCCCC"> if</font>

525
00:20:00,250 --> 00:20:03,760
you want to look at actually blocking

526
00:20:02,230 --> 00:20:05,770
<font color="#E5E5E5">this</font><font color="#CCCCCC"> inline</font><font color="#E5E5E5"> instead of dealing it with</font>

527
00:20:03,760 --> 00:20:07,840
it as kind<font color="#E5E5E5"> of an incident forensic</font>

528
00:20:05,770 --> 00:20:09,520
perspective<font color="#E5E5E5"> after the fact you</font><font color="#CCCCCC"> can</font>

529
00:20:07,840 --> 00:20:11,919
create custom signatures with most

530
00:20:09,520 --> 00:20:14,139
products that identify either<font color="#CCCCCC"> your</font>

531
00:20:11,920 --> 00:20:15,940
office domain or negate that<font color="#E5E5E5"> so that any</font>

532
00:20:14,140 --> 00:20:19,650
other domain other than yours gets

533
00:20:15,940 --> 00:20:21,490
dropped<font color="#CCCCCC"> immediately you can do of course</font>

534
00:20:19,650 --> 00:20:23,230
endpoint log forwarding you can pick

535
00:20:21,490 --> 00:20:24,640
your product<font color="#CCCCCC"> or choice obviously Windows</font>

536
00:20:23,230 --> 00:20:26,740
has<font color="#CCCCCC"> built-in utilities to do this</font><font color="#E5E5E5"> as</font>

537
00:20:24,640 --> 00:20:29,500
well<font color="#CCCCCC"> by</font><font color="#E5E5E5"> just creating alert every time</font>

538
00:20:26,740 --> 00:20:31,420
new PS<font color="#E5E5E5"> drive is</font><font color="#CCCCCC"> used or doing bulk</font>

539
00:20:29,500 --> 00:20:33,400
analysis you can reach<font color="#E5E5E5"> out through</font><font color="#CCCCCC"> WMI</font>

540
00:20:31,420 --> 00:20:35,560
or whatever you'd like<font color="#E5E5E5"> and</font><font color="#CCCCCC"> just run get</font>

541
00:20:33,400 --> 00:20:37,570
PS<font color="#E5E5E5"> drive and look at the outputs of</font>

542
00:20:35,560 --> 00:20:39,370
<font color="#E5E5E5">course and see if the</font><font color="#CCCCCC"> sharepoint tries</font>

543
00:20:37,570 --> 00:20:40,090
<font color="#E5E5E5">that are mounted and if there are is</font>

544
00:20:39,370 --> 00:20:44,110
<font color="#CCCCCC">that ok</font>

545
00:20:40,090 --> 00:20:45,699
this is more suggestion<font color="#E5E5E5"> for forensics of</font>

546
00:20:44,110 --> 00:20:47,320
course but network<font color="#E5E5E5"> devices not just</font>

547
00:20:45,700 --> 00:20:48,400
firewalls but anything with<font color="#E5E5E5"> NetFlow or</font>

548
00:20:47,320 --> 00:20:50,919
something that's<font color="#E5E5E5"> keeping track of the</font>

549
00:20:48,400 --> 00:20:53,320
bike counters on the flow<font color="#CCCCCC"> stemcells coin</font>

550
00:20:50,920 --> 00:20:55,240
can identify extraneous external uploads

551
00:20:53,320 --> 00:20:57,639
of course so in a<font color="#CCCCCC"> normal connection</font>

552
00:20:55,240 --> 00:20:59,530
<font color="#E5E5E5">you'll see</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> disproportionate</font><font color="#CCCCCC"> amount of</font>

553
00:20:57,640 --> 00:21:00,910
bytes<font color="#E5E5E5"> allocated to the server side</font><font color="#CCCCCC"> of</font>

554
00:20:59,530 --> 00:21:03,790
course since the client<font color="#E5E5E5"> is requesting</font>

555
00:21:00,910 --> 00:21:06,010
data<font color="#E5E5E5"> but in an external upload of course</font>

556
00:21:03,790 --> 00:21:07,330
your client<font color="#E5E5E5"> maybe has a</font><font color="#CCCCCC"> ten to one or</font>

557
00:21:06,010 --> 00:21:08,830
<font color="#CCCCCC">twenty to one ratio with the</font><font color="#E5E5E5"> amount of</font>

558
00:21:07,330 --> 00:21:10,750
<font color="#CCCCCC">traffic</font><font color="#E5E5E5"> it's generating versus the</font>

559
00:21:08,830 --> 00:21:14,350
server<font color="#E5E5E5"> so they do stand out quite well</font>

560
00:21:10,750 --> 00:21:15,910
again for data exfiltration<font color="#CCCCCC"> and of</font>

561
00:21:14,350 --> 00:21:19,030
course<font color="#E5E5E5"> depending on how you're coming</font>

562
00:21:15,910 --> 00:21:21,010
into the network<font color="#E5E5E5"> itself you can defend</font>

563
00:21:19,030 --> 00:21:22,750
against a lot<font color="#E5E5E5"> of this using some type of</font>

564
00:21:21,010 --> 00:21:25,150
sandbox of<font color="#E5E5E5"> course behavioral analysis</font>

565
00:21:22,750 --> 00:21:26,710
does work sometimes<font color="#CCCCCC"> and of course email</font>

566
00:21:25,150 --> 00:21:31,690
<font color="#E5E5E5">is the</font><font color="#CCCCCC"> primary factor that were</font>

567
00:21:26,710 --> 00:21:33,190
concerned about<font color="#E5E5E5"> here so what about</font>

568
00:21:31,690 --> 00:21:34,570
sandbox is we've kind<font color="#CCCCCC"> of already</font><font color="#E5E5E5"> touched</font>

569
00:21:33,190 --> 00:21:36,850
<font color="#E5E5E5">on this of course but this specific</font>

570
00:21:34,570 --> 00:21:39,310
<font color="#E5E5E5">techniques insisted just generic</font>

571
00:21:36,850 --> 00:21:40,990
<font color="#E5E5E5">PowerShell detection rates are pretty</font>

572
00:21:39,310 --> 00:21:44,340
<font color="#E5E5E5">low especially for static analysis</font>

573
00:21:40,990 --> 00:21:46,270
engines and obviously<font color="#CCCCCC"> signature-based</font>

574
00:21:44,340 --> 00:21:46,770
<font color="#E5E5E5">again we've kind of touched</font><font color="#CCCCCC"> on this as</font>

575
00:21:46,270 --> 00:21:48,030
well<font color="#E5E5E5"> but</font>

576
00:21:46,770 --> 00:21:49,920
sandboxes do not like when<font color="#E5E5E5"> you're</font>

577
00:21:48,030 --> 00:21:51,930
modifying<font color="#E5E5E5"> the registry and interacting</font>

578
00:21:49,920 --> 00:21:55,040
<font color="#CCCCCC">with the browser in some way shape or</font>

579
00:21:51,930 --> 00:21:57,180
<font color="#CCCCCC">form so what can we do about sandboxes</font>

580
00:21:55,040 --> 00:21:58,830
<font color="#CCCCCC">and before we get</font><font color="#E5E5E5"> into this I'll just</font>

581
00:21:57,180 --> 00:22:02,190
<font color="#E5E5E5">give</font><font color="#CCCCCC"> you a</font><font color="#E5E5E5"> really</font><font color="#CCCCCC"> quick primer on</font>

582
00:21:58,830 --> 00:22:03,720
sandbox evasion at guess<font color="#E5E5E5"> so initially it</font>

583
00:22:02,190 --> 00:22:05,220
started out there were a couple

584
00:22:03,720 --> 00:22:08,400
<font color="#E5E5E5">different camps on how to do this but</font>

585
00:22:05,220 --> 00:22:11,100
<font color="#CCCCCC">primarily</font><font color="#E5E5E5"> folks function focused rather</font>

586
00:22:08,400 --> 00:22:13,950
<font color="#E5E5E5">on sleep functions so if they're able to</font>

587
00:22:11,100 --> 00:22:15,629
out sleep the sandbox<font color="#E5E5E5"> of course given</font>

588
00:22:13,950 --> 00:22:17,070
<font color="#CCCCCC">that most</font><font color="#E5E5E5"> sand boxes have a hard-coded</font>

589
00:22:15,630 --> 00:22:18,900
timer set whether it's<font color="#CCCCCC"> 5 minutes 10</font>

590
00:22:17,070 --> 00:22:20,520
minutes<font color="#CCCCCC"> they have a limit amount</font><font color="#E5E5E5"> of time</font>

591
00:22:18,900 --> 00:22:23,640
to determine<font color="#E5E5E5"> that a file is actually</font>

592
00:22:20,520 --> 00:22:25,530
malicious<font color="#E5E5E5"> or not and of course using</font>

593
00:22:23,640 --> 00:22:28,920
sleep is a<font color="#E5E5E5"> very simple way</font><font color="#CCCCCC"> to sleep</font>

594
00:22:25,530 --> 00:22:30,660
longer<font color="#CCCCCC"> than the same box looking at VM</font>

595
00:22:28,920 --> 00:22:32,340
detection just generic<font color="#CCCCCC"> VM detection</font>

596
00:22:30,660 --> 00:22:33,870
system properties how many CPUs you have

597
00:22:32,340 --> 00:22:35,970
how much<font color="#CCCCCC"> RAM if you're using say</font>

598
00:22:33,870 --> 00:22:37,320
<font color="#CCCCCC">paravirtualized storage drivers</font><font color="#E5E5E5"> anything</font>

599
00:22:35,970 --> 00:22:39,570
<font color="#E5E5E5">like that that</font><font color="#CCCCCC"> gives away that are the</font>

600
00:22:37,320 --> 00:22:41,970
VMS<font color="#CCCCCC"> there VMware tools VirtualBox</font>

601
00:22:39,570 --> 00:22:44,879
add-ons etc there's many<font color="#CCCCCC"> many</font><font color="#E5E5E5"> ways</font><font color="#CCCCCC"> to</font>

602
00:22:41,970 --> 00:22:47,100
determine<font color="#E5E5E5"> that you're in a VM but as an</font>

603
00:22:44,880 --> 00:22:50,310
industry<font color="#E5E5E5"> we've overcome almost all</font><font color="#CCCCCC"> of</font>

604
00:22:47,100 --> 00:22:52,379
these of<font color="#CCCCCC"> course</font><font color="#E5E5E5"> then we</font><font color="#CCCCCC"> get</font><font color="#E5E5E5"> into more</font>

605
00:22:50,310 --> 00:22:54,090
complex attackers of<font color="#E5E5E5"> course that have</font>

606
00:22:52,380 --> 00:22:56,750
started fingerprinting<font color="#E5E5E5"> vendor or</font>

607
00:22:54,090 --> 00:22:59,790
individual<font color="#CCCCCC"> vendor sandboxes</font><font color="#E5E5E5"> of course so</font>

608
00:22:56,750 --> 00:23:01,380
it should<font color="#E5E5E5"> come as no</font><font color="#CCCCCC"> surprise</font><font color="#E5E5E5"> but if you</font>

609
00:22:59,790 --> 00:23:03,360
are<font color="#E5E5E5"> building a custom sandbox there is</font>

610
00:23:01,380 --> 00:23:06,090
going<font color="#CCCCCC"> to be some sort of artifacts from</font>

611
00:23:03,360 --> 00:23:09,649
your technology<font color="#CCCCCC"> on that</font><font color="#E5E5E5"> OS whether it's</font>

612
00:23:06,090 --> 00:23:11,580
dll's<font color="#E5E5E5"> kernel hooks specific drivers</font>

613
00:23:09,650 --> 00:23:12,930
<font color="#CCCCCC">there's something there that probably</font>

614
00:23:11,580 --> 00:23:15,419
<font color="#CCCCCC">gives it</font><font color="#E5E5E5"> away that it's the sandbox but</font>

615
00:23:12,930 --> 00:23:17,010
again we can do<font color="#E5E5E5"> pretty well</font><font color="#CCCCCC"> especially</font>

616
00:23:15,420 --> 00:23:20,130
if we've gone to<font color="#E5E5E5"> something like bare</font>

617
00:23:17,010 --> 00:23:24,930
metal<font color="#E5E5E5"> when we're we're detonating these</font>

618
00:23:20,130 --> 00:23:26,820
payloads after that of<font color="#CCCCCC"> course</font><font color="#E5E5E5"> this one's</font>

619
00:23:24,930 --> 00:23:28,740
still<font color="#E5E5E5"> a little hard to overcome from a</font>

620
00:23:26,820 --> 00:23:31,110
sandbox perspective but doing generic

621
00:23:28,740 --> 00:23:33,660
human<font color="#CCCCCC"> behavior analysis</font><font color="#E5E5E5"> within the VM</font>

622
00:23:31,110 --> 00:23:36,090
itself<font color="#E5E5E5"> is still quite effective just</font>

623
00:23:33,660 --> 00:23:39,210
looking for say ensure the user has

624
00:23:36,090 --> 00:23:40,350
scrolled through say 50 pages or check

625
00:23:39,210 --> 00:23:41,430
the browsing history make sure it<font color="#E5E5E5"> goes</font>

626
00:23:40,350 --> 00:23:44,730
back<font color="#CCCCCC"> 6 months and that they've</font>

627
00:23:41,430 --> 00:23:46,820
bookmarked website<font color="#CCCCCC"> X is still a pretty</font>

628
00:23:44,730 --> 00:23:49,140
effective<font color="#CCCCCC"> way to get</font><font color="#E5E5E5"> around sandboxes</font>

629
00:23:46,820 --> 00:23:50,879
<font color="#E5E5E5">the last two are more concerning of</font>

630
00:23:49,140 --> 00:23:54,210
course what a lot<font color="#E5E5E5"> of</font><font color="#CCCCCC"> vendors</font><font color="#E5E5E5"> technology</font>

631
00:23:50,880 --> 00:23:55,800
requires a sandbox<font color="#CCCCCC"> to be vulnerable to</font>

632
00:23:54,210 --> 00:23:58,480
<font color="#E5E5E5">that specific exploit for them to be</font>

633
00:23:55,800 --> 00:24:00,700
able to<font color="#CCCCCC"> TechEd</font><font color="#E5E5E5"> it's been executed</font>

634
00:23:58,480 --> 00:24:02,290
so an intelligent attacker can make an

635
00:24:00,700 --> 00:24:03,820
assumption about their<font color="#CCCCCC"> target saying hey</font>

636
00:24:02,290 --> 00:24:05,620
I know this<font color="#E5E5E5"> enterprise</font><font color="#CCCCCC"> this patch</font>

637
00:24:03,820 --> 00:24:07,840
management<font color="#E5E5E5"> schedule</font><font color="#CCCCCC"> usually takes a 12</font>

638
00:24:05,620 --> 00:24:10,209
months to<font color="#E5E5E5"> catch up if I pick an exploit</font>

639
00:24:07,840 --> 00:24:13,959
that's 18 months out 18<font color="#CCCCCC"> months old</font><font color="#E5E5E5"> I</font>

640
00:24:10,210 --> 00:24:16,900
should say<font color="#CCCCCC"> and detonate it or check its</font>

641
00:24:13,960 --> 00:24:17,980
vulnerability status rather I can<font color="#E5E5E5"> make a</font>

642
00:24:16,900 --> 00:24:18,580
<font color="#CCCCCC">reasonable assumption that if it's</font>

643
00:24:17,980 --> 00:24:19,930
<font color="#CCCCCC">vulnerable</font>

644
00:24:18,580 --> 00:24:21,520
I shouldn't be detonating my payload

645
00:24:19,930 --> 00:24:24,130
because I'm<font color="#E5E5E5"> probably in a sandbox</font><font color="#CCCCCC"> or</font>

646
00:24:21,520 --> 00:24:25,450
some type of honeypot that one's

647
00:24:24,130 --> 00:24:27,280
problematic to deal with and arguably

648
00:24:25,450 --> 00:24:30,040
<font color="#E5E5E5">the most problematic would to deal with</font>

649
00:24:27,280 --> 00:24:32,889
at least<font color="#E5E5E5"> as far</font><font color="#CCCCCC"> as I guess a global</font>

650
00:24:30,040 --> 00:24:36,399
sandbox<font color="#E5E5E5"> issue is just delaying execution</font>

651
00:24:32,890 --> 00:24:38,140
through<font color="#E5E5E5"> generic routines so the best</font>

652
00:24:36,400 --> 00:24:41,110
<font color="#E5E5E5">example here is computing</font><font color="#CCCCCC"> PI to</font><font color="#E5E5E5"> 10</font>

653
00:24:38,140 --> 00:24:44,380
<font color="#E5E5E5">million digits</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> a slow sandbox that</font>

654
00:24:41,110 --> 00:24:46,030
can take days<font color="#CCCCCC"> and the sandbox</font><font color="#E5E5E5"> doesn't</font>

655
00:24:44,380 --> 00:24:48,250
<font color="#E5E5E5">necessarily view that as malicious</font>

656
00:24:46,030 --> 00:24:50,350
especially if you say apply some type<font color="#E5E5E5"> of</font>

657
00:24:48,250 --> 00:24:52,510
nice level where it's not<font color="#E5E5E5"> consuming much</font>

658
00:24:50,350 --> 00:24:54,840
<font color="#CCCCCC">CPU if it doesn't detonate until it's</font>

659
00:24:52,510 --> 00:24:58,260
<font color="#CCCCCC">computed</font><font color="#E5E5E5"> PI it's very very difficult for</font>

660
00:24:54,840 --> 00:25:02,590
<font color="#E5E5E5">sandboxes to identify this type</font><font color="#CCCCCC"> of thing</font>

661
00:24:58,260 --> 00:25:05,140
but we're working<font color="#E5E5E5"> on it so what else can</font>

662
00:25:02,590 --> 00:25:06,720
we do on the probably<font color="#CCCCCC"> most effective</font>

663
00:25:05,140 --> 00:25:09,370
method that I'm aware of<font color="#E5E5E5"> right now is</font>

664
00:25:06,720 --> 00:25:11,020
designing malware<font color="#E5E5E5"> that places malicious</font>

665
00:25:09,370 --> 00:25:12,879
payloads and interesting locations that

666
00:25:11,020 --> 00:25:14,889
<font color="#E5E5E5">are likely to</font><font color="#CCCCCC"> be detonated</font><font color="#E5E5E5"> by the end</font>

667
00:25:12,880 --> 00:25:18,910
user<font color="#CCCCCC"> but they lack</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> ability to</font>

668
00:25:14,890 --> 00:25:20,290
detonate themselves<font color="#E5E5E5"> completely so I know</font>

669
00:25:18,910 --> 00:25:22,870
<font color="#E5E5E5">that's kind</font><font color="#CCCCCC"> of nebulous but as a</font>

670
00:25:20,290 --> 00:25:24,610
specific example<font color="#E5E5E5"> as a malware author you</font>

671
00:25:22,870 --> 00:25:27,040
<font color="#CCCCCC">can look for recently</font><font color="#E5E5E5"> accessed files</font>

672
00:25:24,610 --> 00:25:28,330
such<font color="#CCCCCC"> as say the last 10 modified</font>

673
00:25:27,040 --> 00:25:30,399
documents and make a reasonable

674
00:25:28,330 --> 00:25:32,260
<font color="#CCCCCC">assumption that a user will</font><font color="#E5E5E5"> come back at</font>

675
00:25:30,400 --> 00:25:33,910
<font color="#E5E5E5">some points and try to model and whether</font>

676
00:25:32,260 --> 00:25:36,460
it's a<font color="#E5E5E5"> grocery list the presentation</font>

677
00:25:33,910 --> 00:25:38,500
doesn't<font color="#CCCCCC"> matter</font><font color="#E5E5E5"> if you embed something</font>

678
00:25:36,460 --> 00:25:40,060
<font color="#E5E5E5">into those files</font><font color="#CCCCCC"> you can</font><font color="#E5E5E5"> make us an</font>

679
00:25:38,500 --> 00:25:42,190
assumption that it will get<font color="#E5E5E5"> triggered</font>

680
00:25:40,060 --> 00:25:44,470
eventually and of course the sandbox has

681
00:25:42,190 --> 00:25:46,150
<font color="#E5E5E5">a very hard time dealing</font><font color="#CCCCCC"> with this so</font>

682
00:25:44,470 --> 00:25:48,370
this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> just a</font><font color="#E5E5E5"> quick</font><font color="#CCCCCC"> example</font><font color="#E5E5E5"> on how to</font>

683
00:25:46,150 --> 00:25:50,710
<font color="#E5E5E5">find your last top 10 modified documents</font>

684
00:25:48,370 --> 00:25:52,570
and then sort them and then of course

685
00:25:50,710 --> 00:25:57,040
<font color="#CCCCCC">most usually provide the full path to</font>

686
00:25:52,570 --> 00:25:58,030
them so we've got a couple<font color="#CCCCCC"> options if</font>

687
00:25:57,040 --> 00:26:00,250
we're<font color="#CCCCCC"> going to try</font><font color="#E5E5E5"> to do this</font><font color="#CCCCCC"> through a</font>

688
00:25:58,030 --> 00:26:02,230
sandbox<font color="#E5E5E5"> easy mode is simply outright</font>

689
00:26:00,250 --> 00:26:04,780
replacing those<font color="#E5E5E5"> files with malware same</font>

690
00:26:02,230 --> 00:26:06,460
name same<font color="#E5E5E5"> extensions same icon sometimes</font>

691
00:26:04,780 --> 00:26:08,950
works but honestly it's<font color="#E5E5E5"> it's not that</font>

692
00:26:06,460 --> 00:26:10,450
<font color="#CCCCCC">effective</font><font color="#E5E5E5"> hard mode which works quite</font>

693
00:26:08,950 --> 00:26:12,220
<font color="#CCCCCC">well but</font><font color="#E5E5E5"> it does require some</font>

694
00:26:10,450 --> 00:26:13,270
permissions or at least making some

695
00:26:12,220 --> 00:26:15,580
sumption<font color="#CCCCCC"> 'he's about the</font><font color="#E5E5E5"> environment</font>

696
00:26:13,270 --> 00:26:17,860
before<font color="#E5E5E5"> you</font><font color="#CCCCCC"> launched it</font><font color="#E5E5E5"> but</font><font color="#CCCCCC"> it does</font><font color="#E5E5E5"> you</font>

697
00:26:15,580 --> 00:26:19,629
are<font color="#E5E5E5"> able</font><font color="#CCCCCC"> to inject macros into existing</font>

698
00:26:17,860 --> 00:26:21,309
<font color="#E5E5E5">Word documents and then exits and of</font>

699
00:26:19,630 --> 00:26:23,590
course the sandbox will not follow up

700
00:26:21,309 --> 00:26:25,389
and<font color="#E5E5E5"> then detonate that word document it</font>

701
00:26:23,590 --> 00:26:27,520
just sees that hey you ended<font color="#CCCCCC"> vbscript</font>

702
00:26:25,390 --> 00:26:30,190
somewhere that's<font color="#E5E5E5"> not really a</font><font color="#CCCCCC"> problem</font>

703
00:26:27,520 --> 00:26:32,020
from<font color="#E5E5E5"> my perspective</font><font color="#CCCCCC"> or my</font><font color="#E5E5E5"> personal</font>

704
00:26:30,190 --> 00:26:33,940
favorite at the<font color="#CCCCCC"> moment</font><font color="#E5E5E5"> replacing those</font>

705
00:26:32,020 --> 00:26:36,668
<font color="#E5E5E5">files with shortcuts that then point to</font>

706
00:26:33,940 --> 00:26:39,100
<font color="#CCCCCC">a</font><font color="#E5E5E5"> malicious second stage in a whitelist</font>

707
00:26:36,669 --> 00:26:41,200
<font color="#E5E5E5">of location such as offices trusted</font>

708
00:26:39,100 --> 00:26:45,158
locations which override a lot of the

709
00:26:41,200 --> 00:26:46,990
generic protections such as macro<font color="#E5E5E5"> before</font>

710
00:26:45,159 --> 00:26:48,850
your files<font color="#E5E5E5"> so instead of getting that</font>

711
00:26:46,990 --> 00:26:50,230
<font color="#E5E5E5">and able content pop up it just</font>

712
00:26:48,850 --> 00:26:52,059
automatically detonates once it's

713
00:26:50,230 --> 00:26:56,919
launched and this is surprisingly easy

714
00:26:52,059 --> 00:26:58,629
<font color="#CCCCCC">to do so as</font><font color="#E5E5E5"> you can assume since</font><font color="#CCCCCC"> you're</font>

715
00:26:56,919 --> 00:27:00,250
not distributing malicious payloads in

716
00:26:58,630 --> 00:27:02,590
your first stage you<font color="#CCCCCC"> do have to</font><font color="#E5E5E5"> have</font>

717
00:27:00,250 --> 00:27:07,090
<font color="#CCCCCC">some way</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> downloading that's malicious</font>

718
00:27:02,590 --> 00:27:09,370
second stage to the<font color="#E5E5E5"> endpoint</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> the</font>

719
00:27:07,090 --> 00:27:11,590
easiest way of course<font color="#E5E5E5"> is web clients</font>

720
00:27:09,370 --> 00:27:13,928
<font color="#E5E5E5">although as many of you may</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> aware</font>

721
00:27:11,590 --> 00:27:15,428
<font color="#E5E5E5">you'll generally get flagged by an AV</font>

722
00:27:13,929 --> 00:27:17,070
vendor because<font color="#E5E5E5"> it's just a generic</font>

723
00:27:15,429 --> 00:27:19,330
trojan.downloader

724
00:27:17,070 --> 00:27:22,059
<font color="#CCCCCC">this is pretty common</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> course so there</font>

725
00:27:19,330 --> 00:27:23,710
are lots of other<font color="#CCCCCC"> methods but if you're</font>

726
00:27:22,059 --> 00:27:26,080
just if your sole purpose<font color="#E5E5E5"> is getting</font>

727
00:27:23,710 --> 00:27:28,240
that office 365<font color="#CCCCCC"> Drive mounted</font><font color="#E5E5E5"> because</font>

728
00:27:26,080 --> 00:27:30,070
frankly once you have a<font color="#E5E5E5"> local mount on a</font>

729
00:27:28,240 --> 00:27:32,770
file system your job as a pen tester

730
00:27:30,070 --> 00:27:34,480
becomes immediately<font color="#E5E5E5"> easier almost</font>

731
00:27:32,770 --> 00:27:37,418
infinitely<font color="#CCCCCC"> easier</font><font color="#E5E5E5"> because</font><font color="#CCCCCC"> even interact</font>

732
00:27:34,480 --> 00:27:38,950
with it<font color="#E5E5E5"> using normal user commands</font>

733
00:27:37,419 --> 00:27:41,230
<font color="#E5E5E5">instead of fetching and doing other</font>

734
00:27:38,950 --> 00:27:42,700
nefarious<font color="#E5E5E5"> things but if you need to get</font>

735
00:27:41,230 --> 00:27:44,919
that<font color="#E5E5E5"> and you don't want</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> use web</font>

736
00:27:42,700 --> 00:27:46,270
client<font color="#E5E5E5"> you can use reverse shells and</font>

737
00:27:44,919 --> 00:27:48,850
paste it in manually you can<font color="#CCCCCC"> do</font>

738
00:27:46,270 --> 00:27:49,179
tunneling through ICMP DNS<font color="#E5E5E5"> take your</font>

739
00:27:48,850 --> 00:27:51,250
pick

740
00:27:49,179 --> 00:27:53,320
just get it there somewhere somehow

741
00:27:51,250 --> 00:27:55,000
rather and again that's<font color="#CCCCCC"> kind of alluded</font>

742
00:27:53,320 --> 00:27:56,678
to<font color="#E5E5E5"> in the last slide</font><font color="#CCCCCC"> the most effective</font>

743
00:27:55,000 --> 00:27:58,390
place<font color="#E5E5E5"> to put this assuming or sticking</font>

744
00:27:56,679 --> 00:28:00,460
<font color="#E5E5E5">with Microsoft</font><font color="#CCCCCC"> Office documents is to</font>

745
00:27:58,390 --> 00:28:02,470
put it into<font color="#CCCCCC"> one of</font><font color="#E5E5E5"> the trusted locations</font>

746
00:28:00,460 --> 00:28:04,360
<font color="#E5E5E5">they are not protected</font><font color="#CCCCCC"> locations but</font>

747
00:28:02,470 --> 00:28:06,580
they are<font color="#E5E5E5"> white listed so when again the</font>

748
00:28:04,360 --> 00:28:08,530
<font color="#E5E5E5">user opens up that shortcut</font><font color="#CCCCCC"> it's going</font>

749
00:28:06,580 --> 00:28:09,460
to link<font color="#E5E5E5"> to the malicious file which no</font>

750
00:28:08,530 --> 00:28:12,908
longer<font color="#CCCCCC"> has any of the traditional</font>

751
00:28:09,460 --> 00:28:16,539
protections<font color="#CCCCCC"> that work provides you so I</font>

752
00:28:12,909 --> 00:28:17,919
know sorry I know I said I would keep<font color="#E5E5E5"> it</font>

753
00:28:16,539 --> 00:28:19,750
simple and<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is a lot</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> PowerShell</font>

754
00:28:17,919 --> 00:28:22,419
on the<font color="#E5E5E5"> screen but it's still quite</font>

755
00:28:19,750 --> 00:28:24,580
simple<font color="#E5E5E5"> so again we're looking at our our</font>

756
00:28:22,419 --> 00:28:25,149
top files on the top and we create two

757
00:28:24,580 --> 00:28:28,089
arrays one

758
00:28:25,149 --> 00:28:30,129
<font color="#E5E5E5">was originally the</font><font color="#CCCCCC"> the normal file so</font>

759
00:28:28,089 --> 00:28:32,229
the top<font color="#CCCCCC"> ten documents and then we create</font>

760
00:28:30,129 --> 00:28:35,259
another<font color="#E5E5E5"> array that simply replaces our</font>

761
00:28:32,229 --> 00:28:38,080
<font color="#E5E5E5">doc X's with shortcuts so</font><font color="#CCCCCC"> LM case and</font>

762
00:28:35,259 --> 00:28:40,839
then<font color="#E5E5E5"> we have a simple for loop</font><font color="#CCCCCC"> so for</font>

763
00:28:38,080 --> 00:28:42,699
every file in that<font color="#CCCCCC"> LNK</font><font color="#E5E5E5"> array we create a</font>

764
00:28:40,839 --> 00:28:45,609
new object<font color="#E5E5E5"> which is a shortcut of course</font>

765
00:28:42,700 --> 00:28:46,899
and we point that to our again<font color="#E5E5E5"> totally</font>

766
00:28:45,609 --> 00:28:48,879
legitimate document<font color="#E5E5E5"> keeping things</font>

767
00:28:46,899 --> 00:28:50,139
consistent and that<font color="#CCCCCC"> resides in that</font>

768
00:28:48,879 --> 00:28:54,339
trusted location which is<font color="#CCCCCC"> app data</font>

769
00:28:50,139 --> 00:28:56,228
roaming<font color="#CCCCCC"> microsoft word</font><font color="#E5E5E5"> startup etc saves</font>

770
00:28:54,339 --> 00:28:57,908
it and<font color="#E5E5E5"> then it sleeps for one second to</font>

771
00:28:56,229 --> 00:29:00,219
ensure<font color="#CCCCCC"> that all of the files don't have</font>

772
00:28:57,909 --> 00:29:04,210
by I guess<font color="#E5E5E5"> similar</font><font color="#CCCCCC"> or identical</font>

773
00:29:00,219 --> 00:29:06,460
timestamps and after that<font color="#E5E5E5"> on so line 18</font>

774
00:29:04,210 --> 00:29:08,499
down<font color="#E5E5E5"> basically it's just fetching the</font>

775
00:29:06,460 --> 00:29:10,299
file it<font color="#E5E5E5"> is using a web client</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> to</font>

776
00:29:08,499 --> 00:29:12,460
show you a different way<font color="#CCCCCC"> of fetching the</font>

777
00:29:10,299 --> 00:29:17,950
file but it's still hosted on<font color="#E5E5E5"> SharePoint</font>

778
00:29:12,460 --> 00:29:18,879
and you excuse me<font color="#E5E5E5"> sorry still good I</font>

779
00:29:17,950 --> 00:29:20,979
<font color="#E5E5E5">think all right</font>

780
00:29:18,879 --> 00:29:23,889
the<font color="#E5E5E5"> URL</font><font color="#CCCCCC"> is all there</font><font color="#E5E5E5"> so you can actually</font>

781
00:29:20,979 --> 00:29:26,320
<font color="#E5E5E5">generate</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> URL by doing get link or</font>

782
00:29:23,889 --> 00:29:28,149
copy or share<font color="#E5E5E5"> through one of the gooeys</font>

783
00:29:26,320 --> 00:29:30,070
that you have the<font color="#E5E5E5"> only minor</font>

784
00:29:28,149 --> 00:29:33,339
modification you have to do is replace

785
00:29:30,070 --> 00:29:34,869
guest access<font color="#E5E5E5"> with download ASP so</font>

786
00:29:33,339 --> 00:29:36,519
generically if you use the normal<font color="#E5E5E5"> link</font>

787
00:29:34,869 --> 00:29:38,109
it's<font color="#CCCCCC"> gonna open up</font><font color="#E5E5E5"> a browser and</font><font color="#CCCCCC"> it's</font>

788
00:29:36,519 --> 00:29:41,109
<font color="#E5E5E5">going to navigate to the online portal</font>

789
00:29:38,109 --> 00:29:42,369
<font color="#CCCCCC">forward and let you maybe have read</font>

790
00:29:41,109 --> 00:29:44,468
access<font color="#CCCCCC"> or right depending</font><font color="#E5E5E5"> on where you</font>

791
00:29:42,369 --> 00:29:46,718
generates so that's the full link of

792
00:29:44,469 --> 00:29:48,429
<font color="#CCCCCC">course web client downloads it and then</font>

793
00:29:46,719 --> 00:29:50,529
we make an assumption of<font color="#E5E5E5"> course that</font>

794
00:29:48,429 --> 00:29:51,729
7-zip is present on<font color="#E5E5E5"> the endpoints but</font>

795
00:29:50,529 --> 00:29:53,950
<font color="#E5E5E5">we're doing</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> that we can have an</font>

796
00:29:51,729 --> 00:29:55,690
encrypted<font color="#E5E5E5"> payload</font><font color="#CCCCCC"> leas frankly most</font>

797
00:29:53,950 --> 00:29:58,299
tools even<font color="#E5E5E5"> if they're able to intercept</font>

798
00:29:55,690 --> 00:29:59,589
<font color="#E5E5E5">that web client</font><font color="#CCCCCC"> request they don't</font>

799
00:29:58,299 --> 00:30:03,369
necessarily alert you if they're unable

800
00:29:59,589 --> 00:30:04,899
to extract<font color="#E5E5E5"> an encrypted payload so in</font>

801
00:30:03,369 --> 00:30:07,570
this case we've got latest forms<font color="#CCCCCC"> dot</font>

802
00:30:04,899 --> 00:30:09,008
7-zip innocuous sounding<font color="#E5E5E5"> and then we</font>

803
00:30:07,570 --> 00:30:10,928
basically<font color="#CCCCCC"> feed in the password of</font>

804
00:30:09,009 --> 00:30:14,769
blackhat<font color="#CCCCCC"> 2017 password</font><font color="#E5E5E5"> one two three</font>

805
00:30:10,929 --> 00:30:16,570
<font color="#E5E5E5">four five</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> the line 30 down here and</font>

806
00:30:14,769 --> 00:30:18,729
then<font color="#E5E5E5"> we extract that into our trusted</font>

807
00:30:16,570 --> 00:30:21,809
location and then we clean up and delete

808
00:30:18,729 --> 00:30:21,809
the the original files

809
00:30:22,240 --> 00:30:27,889
excuse me<font color="#CCCCCC"> all</font><font color="#E5E5E5"> right so this is a bit of</font>

810
00:30:25,850 --> 00:30:30,139
a prettier demo<font color="#E5E5E5"> but this is corporate</font>

811
00:30:27,889 --> 00:30:31,639
<font color="#E5E5E5">drone again and he's the subject of a</font>

812
00:30:30,139 --> 00:30:33,740
phishing attempt<font color="#E5E5E5"> which simply reads</font>

813
00:30:31,639 --> 00:30:35,479
<font color="#E5E5E5">hello corporate drone as discussed</font>

814
00:30:33,740 --> 00:30:36,740
please find my cover letter attached to

815
00:30:35,480 --> 00:30:39,289
the email<font color="#CCCCCC"> thank you</font><font color="#E5E5E5"> for your</font>

816
00:30:36,740 --> 00:30:41,539
consideration<font color="#CCCCCC"> very generic attempt of</font>

817
00:30:39,289 --> 00:30:48,590
course<font color="#E5E5E5"> and then we've got</font><font color="#CCCCCC"> our original</font>

818
00:30:41,539 --> 00:30:50,509
documents<font color="#E5E5E5"> on the right hand side we can</font>

819
00:30:48,590 --> 00:30:52,549
<font color="#E5E5E5">see the path of course</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> just see</font><font color="#CCCCCC"> user</font>

820
00:30:50,509 --> 00:30:55,309
<font color="#CCCCCC">name documents where you would expect</font><font color="#E5E5E5"> it</font>

821
00:30:52,549 --> 00:30:56,840
so corporate Jones<font color="#CCCCCC"> maybe learned a few</font>

822
00:30:55,309 --> 00:30:58,100
lessons over<font color="#E5E5E5"> the last couple</font><font color="#CCCCCC"> months and</font>

823
00:30:56,840 --> 00:31:00,259
<font color="#E5E5E5">thanks hey this is pretty suspicious</font>

824
00:30:58,100 --> 00:31:01,820
<font color="#E5E5E5">maybe I shouldn't open it so he's gonna</font>

825
00:31:00,259 --> 00:31:05,539
<font color="#E5E5E5">run it through defender and then he's</font>

826
00:31:01,820 --> 00:31:07,100
<font color="#E5E5E5">gonna try a sandbox did you extract it</font>

827
00:31:05,539 --> 00:31:09,889
to his<font color="#E5E5E5"> desktop which arguably is kind of</font>

828
00:31:07,100 --> 00:31:12,590
<font color="#E5E5E5">dangerous</font><font color="#CCCCCC"> anyways but</font><font color="#E5E5E5"> he's</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> run it</font>

829
00:31:09,889 --> 00:31:16,610
<font color="#E5E5E5">through defender and we're assuming lis</font>

830
00:31:12,590 --> 00:31:18,168
going to go around<font color="#CCCCCC"> it just</font><font color="#E5E5E5"> fine scanning</font>

831
00:31:16,610 --> 00:31:21,949
<font color="#E5E5E5">the whole desktop to be certain and</font>

832
00:31:18,169 --> 00:31:24,710
defenders not flagging it<font color="#E5E5E5"> so he's going</font>

833
00:31:21,950 --> 00:31:26,720
<font color="#CCCCCC">to try something else and we're gonna</font>

834
00:31:24,710 --> 00:31:28,129
use<font color="#E5E5E5"> kuku here and just an immediate</font>

835
00:31:26,720 --> 00:31:31,250
<font color="#CCCCCC">shout-out to the</font><font color="#E5E5E5"> cuckoo guys it's a</font>

836
00:31:28,129 --> 00:31:32,629
fantastic product<font color="#E5E5E5"> really recommend</font>

837
00:31:31,250 --> 00:31:34,610
checking<font color="#E5E5E5"> it out and if you</font><font color="#CCCCCC"> aren't aware</font>

838
00:31:32,629 --> 00:31:36,620
<font color="#CCCCCC">most major commercial sandboxes are</font>

839
00:31:34,610 --> 00:31:38,059
actually leveraging<font color="#E5E5E5"> cuckoo as well for</font>

840
00:31:36,620 --> 00:31:41,178
at least part of their<font color="#E5E5E5"> infrastructure</font>

841
00:31:38,059 --> 00:31:42,980
<font color="#E5E5E5">it's a very nice</font><font color="#CCCCCC"> easy-to-use tool</font><font color="#E5E5E5"> so</font>

842
00:31:41,179 --> 00:31:46,419
here he's saying<font color="#E5E5E5"> I'm gonna specify that</font>

843
00:31:42,980 --> 00:31:49,879
<font color="#CCCCCC">it's</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> document</font><font color="#E5E5E5"> and see what happens</font><font color="#CCCCCC"> and</font>

844
00:31:46,419 --> 00:31:51,409
<font color="#E5E5E5">for the I guess</font><font color="#CCCCCC"> save one time we've sped</font>

845
00:31:49,879 --> 00:31:54,408
this up of<font color="#CCCCCC"> course but</font><font color="#E5E5E5"> the report comes</font>

846
00:31:51,409 --> 00:31:55,940
out<font color="#E5E5E5"> and immediately you can</font><font color="#CCCCCC"> see</font><font color="#E5E5E5"> that the</font>

847
00:31:54,409 --> 00:31:57,350
threat level of the file is not

848
00:31:55,940 --> 00:31:59,720
considered<font color="#E5E5E5"> threatening it's one point</font>

849
00:31:57,350 --> 00:32:02,539
eight out of ten<font color="#CCCCCC"> it's not a perfect</font>

850
00:31:59,720 --> 00:32:04,820
analysis of course but generally

851
00:32:02,539 --> 00:32:06,379
speaking<font color="#E5E5E5"> anything under four depending</font>

852
00:32:04,820 --> 00:32:09,678
<font color="#CCCCCC">on</font><font color="#E5E5E5"> the product you're looking at seven</font>

853
00:32:06,379 --> 00:32:11,509
or<font color="#E5E5E5"> eight will usually get through anyway</font>

854
00:32:09,679 --> 00:32:13,220
so he's gonna go and<font color="#E5E5E5"> look you</font><font color="#CCCCCC"> can see</font>

855
00:32:11,509 --> 00:32:15,769
<font color="#E5E5E5">screenshots you got a full behavior</font>

856
00:32:13,220 --> 00:32:18,139
breakdown<font color="#E5E5E5"> but he sees that</font><font color="#CCCCCC"> oh hey</font><font color="#E5E5E5"> it</font>

857
00:32:15,769 --> 00:32:20,269
looks<font color="#CCCCCC"> like there's a version issue</font><font color="#E5E5E5"> it's</font>

858
00:32:18,139 --> 00:32:22,279
the<font color="#E5E5E5"> same error we saw with the unicorn</font>

859
00:32:20,269 --> 00:32:25,039
from before of course<font color="#CCCCCC"> but he's gonna</font>

860
00:32:22,279 --> 00:32:26,120
keep looking<font color="#CCCCCC"> and he clearly knows enough</font>

861
00:32:25,039 --> 00:32:27,590
<font color="#E5E5E5">to be</font><font color="#CCCCCC"> dangerous but he hasn't</font><font color="#E5E5E5"> really</font>

862
00:32:26,120 --> 00:32:29,649
<font color="#E5E5E5">learned that launching tower shell</font><font color="#CCCCCC"> I</font>

863
00:32:27,590 --> 00:32:32,600
<font color="#E5E5E5">would have word is probably a bad thing</font>

864
00:32:29,649 --> 00:32:34,469
<font color="#E5E5E5">but um it's there of course it dropped</font>

865
00:32:32,600 --> 00:32:36,809
some files as you<font color="#CCCCCC"> would expect</font>

866
00:32:34,470 --> 00:32:38,700
but frankly it's not doing<font color="#CCCCCC"> anything bad</font>

867
00:32:36,809 --> 00:32:39,570
<font color="#E5E5E5">from the sandboxes perspective so he</font>

868
00:32:38,700 --> 00:32:42,870
thinks it's<font color="#E5E5E5"> okay</font>

869
00:32:39,570 --> 00:32:44,700
so he's gonna go<font color="#CCCCCC"> and open it</font><font color="#E5E5E5"> and we're</font>

870
00:32:42,870 --> 00:32:46,189
gonna see<font color="#CCCCCC"> what we</font><font color="#E5E5E5"> probably expect here</font>

871
00:32:44,700 --> 00:32:48,690
we enable<font color="#CCCCCC"> content</font>

872
00:32:46,190 --> 00:32:50,340
it's a macro right it's not interesting

873
00:32:48,690 --> 00:32:52,169
<font color="#E5E5E5">and then we press</font><font color="#CCCCCC"> ok and</font><font color="#E5E5E5"> then</font>

874
00:32:50,340 --> 00:32:54,570
immediately we<font color="#E5E5E5"> see our documents have</font>

875
00:32:52,169 --> 00:32:56,220
suddenly transformed from documents<font color="#E5E5E5"> into</font>

876
00:32:54,570 --> 00:32:58,020
shortcuts<font color="#E5E5E5"> and of course they look</font><font color="#CCCCCC"> like</font>

877
00:32:56,220 --> 00:33:00,809
<font color="#CCCCCC">doc</font><font color="#E5E5E5"> ends you can change that if you'd</font>

878
00:32:58,020 --> 00:33:03,658
<font color="#E5E5E5">like but now they</font><font color="#CCCCCC"> are only</font><font color="#E5E5E5"> a shortcut</font>

879
00:33:00,809 --> 00:33:06,740
pointing<font color="#E5E5E5"> to that malicious file so you</font>

880
00:33:03,659 --> 00:33:06,740
<font color="#E5E5E5">can</font><font color="#CCCCCC"> see when you open</font><font color="#E5E5E5"> the path</font>

881
00:33:07,039 --> 00:33:12,240
specifically it's sitting in that<font color="#E5E5E5"> app</font>

882
00:33:09,659 --> 00:33:13,409
<font color="#E5E5E5">data trusted location so when you go and</font>

883
00:33:12,240 --> 00:33:14,340
<font color="#E5E5E5">click on and of course</font><font color="#CCCCCC"> he wants to work</font>

884
00:33:13,409 --> 00:33:18,150
<font color="#E5E5E5">on its grocery list</font>

885
00:33:14,340 --> 00:33:20,010
<font color="#E5E5E5">you don't</font><font color="#CCCCCC"> actually open a grocery</font><font color="#E5E5E5"> list</font>

886
00:33:18,150 --> 00:33:21,179
you go to your malicious file and in

887
00:33:20,010 --> 00:33:23,158
<font color="#E5E5E5">this case you've noticed you did not</font>

888
00:33:21,179 --> 00:33:24,480
have<font color="#E5E5E5"> to click enable contents so it is a</font>

889
00:33:23,159 --> 00:33:26,400
very<font color="#CCCCCC"> effective</font><font color="#E5E5E5"> way of getting a</font>

890
00:33:24,480 --> 00:33:28,559
malicious payload detonated without

891
00:33:26,400 --> 00:33:33,570
obviously worrying about the user

892
00:33:28,559 --> 00:33:35,010
cooking on things so what is next<font color="#E5E5E5"> so</font>

893
00:33:33,570 --> 00:33:36,450
this<font color="#E5E5E5"> is a lovely</font><font color="#CCCCCC"> proof of concept of</font>

894
00:33:35,010 --> 00:33:38,220
course but you can't necessarily take it

895
00:33:36,450 --> 00:33:40,200
home<font color="#CCCCCC"> obviously if you have a reverse</font>

896
00:33:38,220 --> 00:33:41,669
shell<font color="#CCCCCC"> you can copy/paste this in or just</font>

897
00:33:40,200 --> 00:33:43,530
<font color="#CCCCCC">copy</font><font color="#E5E5E5"> from github that I'll give you</font>

898
00:33:41,669 --> 00:33:44,669
<font color="#E5E5E5">links for but having a tool that</font><font color="#CCCCCC"> does</font>

899
00:33:43,530 --> 00:33:47,250
this<font color="#CCCCCC"> for you would be</font><font color="#E5E5E5"> nice</font>

900
00:33:44,669 --> 00:33:49,559
so specifically working with Empire

901
00:33:47,250 --> 00:33:52,470
rather excited about it frankly<font color="#E5E5E5"> on a</font>

902
00:33:49,559 --> 00:33:54,000
<font color="#E5E5E5">office 365</font><font color="#CCCCCC"> listener module</font><font color="#E5E5E5"> very similar</font>

903
00:33:52,470 --> 00:33:58,559
<font color="#E5E5E5">to the module that was just released for</font>

904
00:33:54,000 --> 00:34:01,200
Dropbox<font color="#CCCCCC"> excited about it we can talk</font>

905
00:33:58,559 --> 00:34:03,480
about that after<font color="#E5E5E5"> if you'd like</font><font color="#CCCCCC"> after</font>

906
00:34:01,200 --> 00:34:06,150
<font color="#E5E5E5">that of</font><font color="#CCCCCC"> course</font><font color="#E5E5E5"> logically</font><font color="#CCCCCC"> Metasploit</font>

907
00:34:03,480 --> 00:34:07,380
makes the most sense<font color="#CCCCCC"> I'm taking</font><font color="#E5E5E5"> feedback</font>

908
00:34:06,150 --> 00:34:10,230
right<font color="#E5E5E5"> now on what you guys would think</font>

909
00:34:07,380 --> 00:34:11,810
<font color="#CCCCCC">is</font><font color="#E5E5E5"> useful in this case but it's gonna be</font>

910
00:34:10,230 --> 00:34:15,540
a generic<font color="#E5E5E5"> kind of proof of concept</font>

911
00:34:11,810 --> 00:34:16,739
initially and then most importantly<font color="#E5E5E5"> just</font>

912
00:34:15,540 --> 00:34:18,029
due to<font color="#E5E5E5"> the time constraint that we had</font>

913
00:34:16,739 --> 00:34:20,250
here we didn't really<font color="#E5E5E5"> have time to</font><font color="#CCCCCC"> talk</font>

914
00:34:18,030 --> 00:34:22,230
<font color="#CCCCCC">about</font><font color="#E5E5E5"> the api's within office</font><font color="#CCCCCC"> 365</font><font color="#E5E5E5"> but</font>

915
00:34:20,250 --> 00:34:24,510
<font color="#CCCCCC">being able to</font><font color="#E5E5E5"> leverage those within the</font>

916
00:34:22,230 --> 00:34:26,639
<font color="#E5E5E5">tools would obviously make a lot</font><font color="#CCCCCC"> of</font>

917
00:34:24,510 --> 00:34:28,020
sense right<font color="#E5E5E5"> now the api's are somewhat</font>

918
00:34:26,639 --> 00:34:30,750
limited<font color="#CCCCCC"> when</font><font color="#E5E5E5"> it comes to sharepoint</font>

919
00:34:28,020 --> 00:34:32,369
they're almost non-existent but a

920
00:34:30,750 --> 00:34:33,989
onedrive does allow you to interact<font color="#E5E5E5"> with</font>

921
00:34:32,369 --> 00:34:36,210
the file<font color="#CCCCCC"> system as</font><font color="#E5E5E5"> well as add and</font>

922
00:34:33,989 --> 00:34:40,638
remove files<font color="#E5E5E5"> so that that can of course</font>

923
00:34:36,210 --> 00:34:42,960
have a lot of value so closing remarks<font color="#E5E5E5"> I</font>

924
00:34:40,639 --> 00:34:45,060
think I've kind<font color="#E5E5E5"> of beat this to death at</font>

925
00:34:42,960 --> 00:34:47,849
<font color="#E5E5E5">this</font><font color="#CCCCCC"> point but</font><font color="#E5E5E5"> you need to decrypt your</font>

926
00:34:45,060 --> 00:34:48,060
TLS traffic<font color="#E5E5E5"> it's unfortunate but it's a</font>

927
00:34:47,849 --> 00:34:50,910
real

928
00:34:48,060 --> 00:34:53,070
especially if you<font color="#CCCCCC"> want</font><font color="#E5E5E5"> to intercept</font><font color="#CCCCCC"> this</font>

929
00:34:50,909 --> 00:34:54,929
<font color="#CCCCCC">communication on the wire</font><font color="#E5E5E5"> it's fine to</font>

930
00:34:53,070 --> 00:34:56,990
do incident response after but this will

931
00:34:54,929 --> 00:34:59,549
<font color="#CCCCCC">actually prevent these types of attacks</font>

932
00:34:56,989 --> 00:35:02,459
<font color="#E5E5E5">before</font><font color="#CCCCCC"> they occur</font><font color="#E5E5E5"> so again you can</font>

933
00:34:59,550 --> 00:35:04,110
monitor for<font color="#E5E5E5"> PS</font><font color="#CCCCCC"> Drive usage or you can</font>

934
00:35:02,460 --> 00:35:06,240
deploy signatures if<font color="#CCCCCC"> you're decrypting</font>

935
00:35:04,110 --> 00:35:09,930
<font color="#CCCCCC">the signatures are quite</font><font color="#E5E5E5"> effective at</font>

936
00:35:06,240 --> 00:35:11,970
stopping this of course but it does come

937
00:35:09,930 --> 00:35:15,120
with<font color="#E5E5E5"> a resource penalty on your network</font>

938
00:35:11,970 --> 00:35:17,520
appliances<font color="#E5E5E5"> so this is more of a an</font>

939
00:35:15,120 --> 00:35:20,400
industry-wide<font color="#CCCCCC"> problem I suppose but</font><font color="#E5E5E5"> Sam</font>

940
00:35:17,520 --> 00:35:22,440
<font color="#E5E5E5">boxes need to get better only basing</font>

941
00:35:20,400 --> 00:35:24,060
your analysis on the first file in the

942
00:35:22,440 --> 00:35:26,370
chain<font color="#E5E5E5"> not necessarily looking at all</font>

943
00:35:24,060 --> 00:35:28,710
files and<font color="#E5E5E5"> how they behave</font><font color="#CCCCCC"> is kind of a</font>

944
00:35:26,370 --> 00:35:30,930
flawed approach frankly<font color="#CCCCCC"> you do need to</font>

945
00:35:28,710 --> 00:35:34,620
do secondary or tertiary file<font color="#CCCCCC"> analysis</font>

946
00:35:30,930 --> 00:35:36,629
to detect<font color="#E5E5E5"> this stuff and of course</font>

947
00:35:34,620 --> 00:35:38,940
inspiration<font color="#E5E5E5"> none</font><font color="#CCCCCC"> of us</font><font color="#E5E5E5"> really work in a</font>

948
00:35:36,630 --> 00:35:40,200
bubble here<font color="#E5E5E5"> of course but the</font><font color="#CCCCCC"> initial</font>

949
00:35:38,940 --> 00:35:41,730
<font color="#E5E5E5">inspiration came out of a talk</font><font color="#CCCCCC"> that</font>

950
00:35:40,200 --> 00:35:43,859
<font color="#E5E5E5">George and</font><font color="#CCCCCC"> Dmitriy were doing from</font>

951
00:35:41,730 --> 00:35:45,630
CrowdStrike back at RSA in February and

952
00:35:43,860 --> 00:35:47,490
they were<font color="#E5E5E5"> talking specifically about</font>

953
00:35:45,630 --> 00:35:50,100
techniques that bears and<font color="#E5E5E5"> pandas were</font>

954
00:35:47,490 --> 00:35:51,450
using<font color="#E5E5E5"> but for this talk of course this</font>

955
00:35:50,100 --> 00:35:54,720
came out<font color="#CCCCCC"> of their cozy</font><font color="#E5E5E5"> bear analysis</font>

956
00:35:51,450 --> 00:35:56,939
that was using net use and the public

957
00:35:54,720 --> 00:35:58,410
version<font color="#E5E5E5"> of onedrive so it's a little</font>

958
00:35:56,940 --> 00:36:01,710
<font color="#CCCCCC">different of course</font><font color="#E5E5E5"> and it's it's much</font>

959
00:35:58,410 --> 00:36:03,839
more easy to block<font color="#E5E5E5"> in an enterprise than</font>

960
00:36:01,710 --> 00:36:06,240
office 365<font color="#CCCCCC"> but it's a similar</font><font color="#E5E5E5"> approach</font>

961
00:36:03,840 --> 00:36:08,220
<font color="#CCCCCC">of course</font><font color="#E5E5E5"> and then of course Kaspersky</font>

962
00:36:06,240 --> 00:36:15,509
Labs has a very similar write-up on cozy

963
00:36:08,220 --> 00:36:16,770
Duke so as far as references go<font color="#CCCCCC"> you guys</font>

964
00:36:15,510 --> 00:36:18,840
<font color="#E5E5E5">don't have to write this down the slides</font>

965
00:36:16,770 --> 00:36:20,280
will be up<font color="#E5E5E5"> later of course but all of</font>

966
00:36:18,840 --> 00:36:25,640
the<font color="#E5E5E5"> PowerShell that we used here is</font>

967
00:36:20,280 --> 00:36:26,430
<font color="#E5E5E5">available and that's it thank you</font>

968
00:36:25,640 --> 00:36:29,839
[Applause]

969
00:36:26,430 --> 00:36:29,839
[Music]

