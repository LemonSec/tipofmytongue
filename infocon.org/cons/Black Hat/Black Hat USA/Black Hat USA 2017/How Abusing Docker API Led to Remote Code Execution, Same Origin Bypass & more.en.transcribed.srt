1
00:00:00,030 --> 00:00:08,940
welcome to well that<font color="#CCCCCC"> escalated quickly</font>

2
00:00:04,790 --> 00:00:12,379
my name is<font color="#E5E5E5"> saga</font><font color="#CCCCCC"> Dulce I am a senior</font>

3
00:00:08,940 --> 00:00:15,450
<font color="#CCCCCC">security researcher</font><font color="#E5E5E5"> for aqua security</font>

4
00:00:12,380 --> 00:00:19,740
evidently<font color="#E5E5E5"> not with me here today is</font>

5
00:00:15,450 --> 00:00:20,400
<font color="#E5E5E5">Michael journey</font><font color="#CCCCCC"> he couldn't make it</font><font color="#E5E5E5"> but</font>

6
00:00:19,740 --> 00:00:23,389
<font color="#E5E5E5">no worries</font>

7
00:00:20,400 --> 00:00:26,970
it's for a<font color="#E5E5E5"> good</font><font color="#CCCCCC"> reason he just recently</font>

8
00:00:23,390 --> 00:00:31,309
had a new<font color="#E5E5E5"> baby so he'll</font><font color="#CCCCCC"> be doing</font><font color="#E5E5E5"> a lot</font>

9
00:00:26,970 --> 00:00:35,280
<font color="#CCCCCC">of diapers and I'll be doing this talk</font>

10
00:00:31,309 --> 00:00:39,930
<font color="#CCCCCC">so I want you</font><font color="#E5E5E5"> to focus mainly on three</font>

11
00:00:35,280 --> 00:00:43,079
<font color="#E5E5E5">things when we're</font><font color="#CCCCCC"> going through</font><font color="#E5E5E5"> a lot of</font>

12
00:00:39,930 --> 00:00:47,309
<font color="#E5E5E5">slides and a lot</font><font color="#CCCCCC"> of demos we're going to</font>

13
00:00:43,079 --> 00:00:51,210
discuss how developers are<font color="#E5E5E5"> actually</font>

14
00:00:47,309 --> 00:00:54,539
becoming new targets especially<font color="#CCCCCC"> if we're</font>

15
00:00:51,210 --> 00:00:56,850
<font color="#E5E5E5">talking about micro</font><font color="#CCCCCC"> service developers</font>

16
00:00:54,539 --> 00:01:00,239
developers who like are<font color="#CCCCCC"> in charge of</font><font color="#E5E5E5"> an</font>

17
00:00:56,850 --> 00:01:04,920
entire thing<font color="#E5E5E5"> an entire container and how</font>

18
00:01:00,239 --> 00:01:09,179
one infection<font color="#E5E5E5"> can quickly spread through</font>

19
00:01:04,920 --> 00:01:11,760
your entire<font color="#E5E5E5"> pipeline and the main course</font>

20
00:01:09,180 --> 00:01:14,760
of<font color="#E5E5E5"> this stuff would</font><font color="#CCCCCC"> be an advanced</font>

21
00:01:11,760 --> 00:01:17,460
persistent threat against a developer

22
00:01:14,760 --> 00:01:20,040
running<font color="#E5E5E5"> in our case docker</font>

23
00:01:17,460 --> 00:01:22,919
we're going to dive into the attack

24
00:01:20,040 --> 00:01:25,530
<font color="#CCCCCC">we're going to do three demos</font><font color="#E5E5E5"> it's gonna</font>

25
00:01:22,920 --> 00:01:28,229
make<font color="#CCCCCC"> it</font><font color="#E5E5E5"> feel like it's maybe a little</font>

26
00:01:25,530 --> 00:01:32,130
bit<font color="#CCCCCC"> over complicated</font><font color="#E5E5E5"> but it just for the</font>

27
00:01:28,229 --> 00:01:36,119
sake of<font color="#CCCCCC"> education</font><font color="#E5E5E5"> it's not sexually</font>

28
00:01:32,130 --> 00:01:38,520
pretty feasible<font color="#E5E5E5"> attack and also I want</font>

29
00:01:36,119 --> 00:01:40,020
you<font color="#E5E5E5"> to look out for two new types of</font>

30
00:01:38,520 --> 00:01:43,500
attack<font color="#CCCCCC"> that we're going to</font><font color="#E5E5E5"> introduce</font>

31
00:01:40,020 --> 00:01:45,539
<font color="#CCCCCC">today</font><font color="#E5E5E5"> and these are the</font><font color="#CCCCCC"> host</font><font color="#E5E5E5"> rebinding</font>

32
00:01:43,500 --> 00:01:50,040
attack and the shadow container attack

33
00:01:45,540 --> 00:01:55,140
and each one<font color="#E5E5E5"> of those sort of stands on</font>

34
00:01:50,040 --> 00:01:58,110
its own as a sort of a attack vector so

35
00:01:55,140 --> 00:02:02,390
what's on<font color="#CCCCCC"> the</font><font color="#E5E5E5"> menu</font><font color="#CCCCCC"> like you expected</font>

36
00:01:58,110 --> 00:02:04,439
containers and container development

37
00:02:02,390 --> 00:02:07,200
<font color="#E5E5E5">hopefully if you're in this room like</font>

38
00:02:04,439 --> 00:02:10,500
how many<font color="#E5E5E5"> people heard about containers</font>

39
00:02:07,200 --> 00:02:12,180
<font color="#E5E5E5">know something</font><font color="#CCCCCC"> okay so even</font><font color="#E5E5E5"> if you</font>

40
00:02:10,500 --> 00:02:13,380
haven't<font color="#E5E5E5"> we're still going</font><font color="#CCCCCC"> to do a short</font>

41
00:02:12,180 --> 00:02:15,750
<font color="#CCCCCC">introduction</font>

42
00:02:13,380 --> 00:02:17,549
then we're going to dive straight into

43
00:02:15,750 --> 00:02:22,200
<font color="#E5E5E5">the attack</font><font color="#CCCCCC"> we're going to break it down</font>

44
00:02:17,550 --> 00:02:24,660
to three<font color="#E5E5E5"> we have a demo for its stage so</font>

45
00:02:22,200 --> 00:02:27,570
it will give you a sense how it works

46
00:02:24,660 --> 00:02:31,079
<font color="#CCCCCC">and finally we'll just weave</font><font color="#E5E5E5"> it on</font>

47
00:02:27,570 --> 00:02:33,930
<font color="#CCCCCC">together</font><font color="#E5E5E5"> with a full demo and then</font>

48
00:02:31,080 --> 00:02:35,270
hopefully<font color="#CCCCCC"> have something</font><font color="#E5E5E5"> smart to say</font>

49
00:02:33,930 --> 00:02:40,800
about it

50
00:02:35,270 --> 00:02:43,200
containers so what are they<font color="#CCCCCC"> if you have</font>

51
00:02:40,800 --> 00:02:45,300
ever<font color="#E5E5E5"> been to talk about containers</font>

52
00:02:43,200 --> 00:02:47,070
<font color="#E5E5E5">you've probably seen this slide</font><font color="#CCCCCC"> a</font>

53
00:02:45,300 --> 00:02:51,390
hundred times so I<font color="#E5E5E5"> don't know why you're</font>

54
00:02:47,070 --> 00:02:54,750
taking<font color="#E5E5E5"> a picture just yesterday I've</font>

55
00:02:51,390 --> 00:02:57,390
been in a talk<font color="#E5E5E5"> and I saw the exact same</font>

56
00:02:54,750 --> 00:02:59,880
slide<font color="#E5E5E5"> so whenever you</font><font color="#CCCCCC"> want</font><font color="#E5E5E5"> to say what a</font>

57
00:02:57,390 --> 00:03:03,329
container is you always show like a

58
00:02:59,880 --> 00:03:07,109
<font color="#E5E5E5">virtual machine on the</font><font color="#CCCCCC"> left side against</font>

59
00:03:03,330 --> 00:03:08,970
a container on<font color="#CCCCCC"> the right so if I'm a</font>

60
00:03:07,110 --> 00:03:12,540
<font color="#CCCCCC">developer</font><font color="#E5E5E5"> and I want to develop an</font>

61
00:03:08,970 --> 00:03:14,340
application<font color="#CCCCCC"> and I want to isolate</font><font color="#E5E5E5"> it</font>

62
00:03:12,540 --> 00:03:16,859
using a virtual<font color="#E5E5E5"> machine</font><font color="#CCCCCC"> I see that I</font>

63
00:03:14,340 --> 00:03:19,140
<font color="#E5E5E5">have a lot</font><font color="#CCCCCC"> more work to do I have to</font>

64
00:03:16,860 --> 00:03:23,490
take care<font color="#CCCCCC"> of the entire</font><font color="#E5E5E5"> guest operating</font>

65
00:03:19,140 --> 00:03:25,799
system<font color="#CCCCCC"> to spin up and take</font><font color="#E5E5E5"> down a</font>

66
00:03:23,490 --> 00:03:29,730
virtual<font color="#E5E5E5"> machine takes a lot more time</font>

67
00:03:25,800 --> 00:03:32,670
<font color="#CCCCCC">and heavier</font><font color="#E5E5E5"> than a container and</font><font color="#CCCCCC"> a</font>

68
00:03:29,730 --> 00:03:36,720
container is simply a<font color="#CCCCCC"> process a process</font>

69
00:03:32,670 --> 00:03:39,690
that is<font color="#E5E5E5"> isolated it's running in its own</font>

70
00:03:36,720 --> 00:03:44,250
little<font color="#E5E5E5"> virtual world so it has its own</font>

71
00:03:39,690 --> 00:03:48,570
file system<font color="#CCCCCC"> network it can spins its own</font>

72
00:03:44,250 --> 00:03:50,700
processes<font color="#CCCCCC"> and basically it's a mini</font>

73
00:03:48,570 --> 00:03:53,280
virtual machine<font color="#E5E5E5"> that shares the same</font>

74
00:03:50,700 --> 00:03:56,609
<font color="#CCCCCC">house and you don't</font><font color="#E5E5E5"> really have to</font><font color="#CCCCCC"> add</font>

75
00:03:53,280 --> 00:03:58,380
the entire guest operating system<font color="#E5E5E5"> and of</font>

76
00:03:56,610 --> 00:04:01,170
<font color="#E5E5E5">course I'll have</font><font color="#CCCCCC"> the container</font><font color="#E5E5E5"> engine</font>

77
00:03:58,380 --> 00:04:03,680
<font color="#E5E5E5">that helps me manage these containers to</font>

78
00:04:01,170 --> 00:04:08,040
start them stop them spin them up or

79
00:04:03,680 --> 00:04:11,700
kill them so that's<font color="#E5E5E5"> good news that's</font>

80
00:04:08,040 --> 00:04:14,160
good news<font color="#CCCCCC"> if I am</font><font color="#E5E5E5"> a container developer</font>

81
00:04:11,700 --> 00:04:16,620
because<font color="#E5E5E5"> now I can write for example</font>

82
00:04:14,160 --> 00:04:21,238
<font color="#E5E5E5">Linux containers and I can spin them up</font>

83
00:04:16,620 --> 00:04:24,630
<font color="#E5E5E5">over</font><font color="#CCCCCC"> Linux for obviously and</font><font color="#E5E5E5"> windows</font>

84
00:04:21,238 --> 00:04:26,700
<font color="#CCCCCC">also and also Mac so I can develop</font><font color="#E5E5E5"> and</font>

85
00:04:24,630 --> 00:04:30,900
run a container anywhere

86
00:04:26,700 --> 00:04:33,180
and of<font color="#E5E5E5"> also you know this it is a big</font>

87
00:04:30,900 --> 00:04:36,870
<font color="#E5E5E5">game because</font><font color="#CCCCCC"> also Microsoft</font><font color="#E5E5E5"> are now</font>

88
00:04:33,180 --> 00:04:39,780
<font color="#E5E5E5">actually enabling you to write and run</font>

89
00:04:36,870 --> 00:04:42,990
<font color="#E5E5E5">Windows containers and just to get a</font>

90
00:04:39,780 --> 00:04:47,010
sense of how big<font color="#CCCCCC"> this thing is</font><font color="#E5E5E5"> let's</font>

91
00:04:42,990 --> 00:04:50,190
look<font color="#E5E5E5"> at of course</font><font color="#CCCCCC"> darker</font><font color="#E5E5E5"> engine and</font>

92
00:04:47,010 --> 00:04:52,860
these are some statistics<font color="#E5E5E5"> from the</font>

93
00:04:50,190 --> 00:04:55,170
beginning of the year I believe<font color="#CCCCCC"> of</font><font color="#E5E5E5"> dr.</font>

94
00:04:52,860 --> 00:04:57,540
<font color="#E5E5E5">Khan they presented the growth of and</font>

95
00:04:55,170 --> 00:05:01,020
the adoption of containers<font color="#CCCCCC"> over the past</font>

96
00:04:57,540 --> 00:05:04,920
three years and<font color="#E5E5E5"> we see pretty high</font>

97
00:05:01,020 --> 00:05:06,900
numbers numbers like<font color="#CCCCCC"> 900,000 which</font><font color="#E5E5E5"> is</font>

98
00:05:04,920 --> 00:05:09,270
number of<font color="#CCCCCC"> dick Euler different doctor</font>

99
00:05:06,900 --> 00:05:13,229
application on the public docker hub

100
00:05:09,270 --> 00:05:14,990
<font color="#E5E5E5">with over 12 billion pools and 14</font>

101
00:05:13,230 --> 00:05:18,840
million different house<font color="#E5E5E5"> pulling</font><font color="#CCCCCC"> together</font>

102
00:05:14,990 --> 00:05:23,870
so there's a pretty big community here

103
00:05:18,840 --> 00:05:26,070
of developers writing containers and

104
00:05:23,870 --> 00:05:28,560
users actually using and running

105
00:05:26,070 --> 00:05:31,290
containers so if there's a big<font color="#CCCCCC"> community</font>

106
00:05:28,560 --> 00:05:33,810
there's a big<font color="#CCCCCC"> taxes surface and we have</font>

107
00:05:31,290 --> 00:05:37,020
something<font color="#E5E5E5"> to attack so why not go after</font>

108
00:05:33,810 --> 00:05:40,620
<font color="#E5E5E5">these developers so developers are</font>

109
00:05:37,020 --> 00:05:42,719
basically getting<font color="#CCCCCC"> paid to write code and</font>

110
00:05:40,620 --> 00:05:44,430
features they don't get<font color="#E5E5E5"> to paid they</font>

111
00:05:42,720 --> 00:05:50,220
don't get paid to do like things

112
00:05:44,430 --> 00:05:54,680
securely so if<font color="#E5E5E5"> security gets in the way</font>

113
00:05:50,220 --> 00:05:59,580
<font color="#E5E5E5">like you</font><font color="#CCCCCC"> need to</font><font color="#E5E5E5"> open a port on</font><font color="#CCCCCC"> your</font>

114
00:05:54,680 --> 00:06:02,280
darker<font color="#CCCCCC"> daemon to enable some tool to</font>

115
00:05:59,580 --> 00:06:04,169
<font color="#E5E5E5">interact with it but it's not that</font>

116
00:06:02,280 --> 00:06:06,619
secure<font color="#CCCCCC"> maybe you're gonna do it because</font>

117
00:06:04,170 --> 00:06:09,300
it<font color="#E5E5E5"> helps you like get things</font><font color="#CCCCCC"> done so</font>

118
00:06:06,620 --> 00:06:13,590
<font color="#CCCCCC">these are people that are</font><font color="#E5E5E5"> very</font><font color="#CCCCCC"> technical</font>

119
00:06:09,300 --> 00:06:15,690
<font color="#CCCCCC">they very have very high confidence</font><font color="#E5E5E5"> but</font>

120
00:06:13,590 --> 00:06:20,099
almost<font color="#E5E5E5"> by definition have access to</font>

121
00:06:15,690 --> 00:06:23,270
sensitive data<font color="#E5E5E5"> like code IP and in the</font>

122
00:06:20,100 --> 00:06:27,090
case of developing<font color="#E5E5E5"> containers registries</font>

123
00:06:23,270 --> 00:06:30,030
<font color="#E5E5E5">so if you take like we said a single</font>

124
00:06:27,090 --> 00:06:31,590
developer<font color="#CCCCCC"> and now you remove to like</font>

125
00:06:30,030 --> 00:06:34,559
continuous development<font color="#E5E5E5"> so you always</font>

126
00:06:31,590 --> 00:06:36,840
<font color="#E5E5E5">pushing new micro services and</font>

127
00:06:34,560 --> 00:06:39,710
containers out<font color="#E5E5E5"> to</font><font color="#CCCCCC"> production even a</font>

128
00:06:36,840 --> 00:06:44,869
single<font color="#CCCCCC"> developer may cause your entire</font>

129
00:06:39,710 --> 00:06:47,330
<font color="#CCCCCC">pipelined to</font><font color="#E5E5E5"> be infected so that's the</font>

130
00:06:44,870 --> 00:06:50,330
intro<font color="#CCCCCC"> out of the way and let's jump into</font>

131
00:06:47,330 --> 00:06:54,590
the attack and let's<font color="#E5E5E5"> have a bird's eye</font>

132
00:06:50,330 --> 00:06:59,320
view<font color="#E5E5E5"> of the</font><font color="#CCCCCC"> entire attack</font><font color="#E5E5E5"> so all I ask</font>

133
00:06:54,590 --> 00:07:02,479
<font color="#E5E5E5">for this attack to work is a victim</font>

134
00:06:59,320 --> 00:07:07,180
running darker and the darker<font color="#CCCCCC"> demon has</font>

135
00:07:02,480 --> 00:07:10,730
<font color="#CCCCCC">it has a port listening for incoming</font>

136
00:07:07,180 --> 00:07:13,370
HTTP requests<font color="#E5E5E5"> and that may look</font><font color="#CCCCCC"> like I'm</font>

137
00:07:10,730 --> 00:07:15,550
<font color="#CCCCCC">asking a lot but</font><font color="#E5E5E5"> like I said the</font>

138
00:07:13,370 --> 00:07:18,890
developer<font color="#CCCCCC"> needs to</font><font color="#E5E5E5"> get things done</font><font color="#CCCCCC"> and</font>

139
00:07:15,550 --> 00:07:22,040
by<font color="#E5E5E5"> default</font><font color="#CCCCCC"> for example if you install</font>

140
00:07:18,890 --> 00:07:24,590
docker for<font color="#E5E5E5"> Windows in previous versions</font>

141
00:07:22,040 --> 00:07:26,360
<font color="#E5E5E5">that was the default installation so</font>

142
00:07:24,590 --> 00:07:30,289
whenever you<font color="#E5E5E5"> install</font><font color="#CCCCCC"> the docker for</font>

143
00:07:26,360 --> 00:07:33,230
Windows it has TCP port open listening

144
00:07:30,290 --> 00:07:35,300
for incoming<font color="#E5E5E5"> quests and the second thing</font>

145
00:07:33,230 --> 00:07:38,470
I'm going to<font color="#E5E5E5"> do is simply get</font><font color="#CCCCCC"> the</font>

146
00:07:35,300 --> 00:07:43,610
attacker<font color="#E5E5E5"> to visit some malicious</font><font color="#CCCCCC"> website</font>

147
00:07:38,470 --> 00:07:46,010
social<font color="#E5E5E5"> engineering water-holding insert</font>

148
00:07:43,610 --> 00:07:48,290
clever method here<font color="#E5E5E5"> whatever</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> takes</font>

149
00:07:46,010 --> 00:07:50,180
just<font color="#E5E5E5"> like to get him to</font><font color="#CCCCCC"> visit the</font>

150
00:07:48,290 --> 00:07:51,860
<font color="#E5E5E5">website and then from there we're going</font>

151
00:07:50,180 --> 00:07:55,250
to escalate<font color="#E5E5E5"> the attack we're going to</font>

152
00:07:51,860 --> 00:07:58,010
deep dive<font color="#E5E5E5"> on a Windows 10 attack</font>

153
00:07:55,250 --> 00:08:01,070
scenario so like I<font color="#CCCCCC"> said we have three</font>

154
00:07:58,010 --> 00:08:03,289
phases<font color="#E5E5E5"> of the attack the first phase</font>

155
00:08:01,070 --> 00:08:06,110
like many other attacks<font color="#E5E5E5"> it's a form of</font>

156
00:08:03,290 --> 00:08:09,980
remote code execution<font color="#E5E5E5"> and we'll do</font><font color="#CCCCCC"> that</font>

157
00:08:06,110 --> 00:08:12,430
<font color="#E5E5E5">by simply</font><font color="#CCCCCC"> abusing the darker</font><font color="#E5E5E5"> API</font><font color="#CCCCCC"> the</font>

158
00:08:09,980 --> 00:08:15,170
second step is an attack we call

159
00:08:12,430 --> 00:08:18,950
<font color="#E5E5E5">privilege escalation as it's a new form</font>

160
00:08:15,170 --> 00:08:21,530
<font color="#E5E5E5">of attack similar to another attack</font><font color="#CCCCCC"> that</font>

161
00:08:18,950 --> 00:08:23,180
will introduce<font color="#E5E5E5"> us we'll have an intro</font>

162
00:08:21,530 --> 00:08:25,760
here and say why we chose<font color="#E5E5E5"> to</font><font color="#CCCCCC"> do a</font>

163
00:08:23,180 --> 00:08:28,850
different form<font color="#E5E5E5"> of attack and that is a</font>

164
00:08:25,760 --> 00:08:31,219
kind<font color="#E5E5E5"> of privilege escalation over the</font>

165
00:08:28,850 --> 00:08:33,620
darker<font color="#CCCCCC"> daemon</font><font color="#E5E5E5"> so now we'll have full</font>

166
00:08:31,220 --> 00:08:35,960
control<font color="#E5E5E5"> of the darker demon and we'll</font>

167
00:08:33,620 --> 00:08:38,690
ask<font color="#CCCCCC"> ourself what</font><font color="#E5E5E5"> you do next</font><font color="#CCCCCC"> and the</font>

168
00:08:35,960 --> 00:08:41,000
answer will<font color="#CCCCCC"> be to run shadow containers</font>

169
00:08:38,690 --> 00:08:44,480
and shadow containers is a method of

170
00:08:41,000 --> 00:08:49,280
persisting inside the host<font color="#E5E5E5"> or more</font>

171
00:08:44,480 --> 00:08:53,510
accurately inside the hypervisor<font color="#CCCCCC"> so I</font>

172
00:08:49,280 --> 00:08:56,810
start off with<font color="#E5E5E5"> step</font><font color="#CCCCCC"> 1</font><font color="#E5E5E5"> so let's abused</font>

173
00:08:53,510 --> 00:08:59,810
dr. API<font color="#E5E5E5"> so the idea to boost the dr. API</font>

174
00:08:56,810 --> 00:09:02,569
<font color="#E5E5E5">came to us when we try to understand how</font>

175
00:08:59,810 --> 00:09:05,089
<font color="#E5E5E5">does this</font><font color="#CCCCCC"> magic work when you're sitting</font>

176
00:09:02,570 --> 00:09:07,910
on your laptop<font color="#CCCCCC"> running</font><font color="#E5E5E5"> Windows for</font>

177
00:09:05,090 --> 00:09:09,770
<font color="#CCCCCC">example or Mac</font><font color="#E5E5E5"> Iran duck L'Orange</font>

178
00:09:07,910 --> 00:09:12,110
<font color="#E5E5E5">something and you have a container</font>

179
00:09:09,770 --> 00:09:16,130
<font color="#CCCCCC">running on your machine</font><font color="#E5E5E5"> doesn't</font><font color="#CCCCCC"> make</font>

180
00:09:12,110 --> 00:09:18,710
<font color="#E5E5E5">sense</font><font color="#CCCCCC"> and there's of course</font><font color="#E5E5E5"> no magic</font>

181
00:09:16,130 --> 00:09:21,530
<font color="#CCCCCC">here what happens is actually</font><font color="#E5E5E5"> doctor</font>

182
00:09:18,710 --> 00:09:25,070
installs<font color="#E5E5E5"> a virtual machine on your host</font>

183
00:09:21,530 --> 00:09:28,100
and that's a Linux<font color="#CCCCCC"> machine called mobile</font>

184
00:09:25,070 --> 00:09:30,680
Linux and it's actually running<font color="#CCCCCC"> Dugger</font>

185
00:09:28,100 --> 00:09:32,960
<font color="#E5E5E5">and the container that you are running</font>

186
00:09:30,680 --> 00:09:36,650
<font color="#E5E5E5">is actually running inside a virtual</font>

187
00:09:32,960 --> 00:09:38,660
<font color="#E5E5E5">machine</font><font color="#CCCCCC"> and the dr. demian</font><font color="#E5E5E5"> on the house</font>

188
00:09:36,650 --> 00:09:41,590
is<font color="#CCCCCC"> actually talking through a virtual</font>

189
00:09:38,660 --> 00:09:45,260
socket to the<font color="#E5E5E5"> virtual machine and</font>

190
00:09:41,590 --> 00:09:47,690
finally on the other side you<font color="#CCCCCC"> have</font><font color="#E5E5E5"> the</font>

191
00:09:45,260 --> 00:09:50,420
<font color="#E5E5E5">client which can be command line or</font>

192
00:09:47,690 --> 00:09:53,390
anything else<font color="#CCCCCC"> talking through a restful</font>

193
00:09:50,420 --> 00:09:55,880
api with the<font color="#CCCCCC"> dr.</font><font color="#E5E5E5"> demon so this</font>

194
00:09:53,390 --> 00:09:57,800
<font color="#E5E5E5">connection can happen over a UNIX socket</font>

195
00:09:55,880 --> 00:10:00,500
you can have an over

196
00:09:57,800 --> 00:10:03,530
named pipe or like we said in our case

197
00:10:00,500 --> 00:10:06,620
and the default<font color="#E5E5E5"> installation of previous</font>

198
00:10:03,530 --> 00:10:09,650
Windows version<font color="#E5E5E5"> over TCP so why not</font>

199
00:10:06,620 --> 00:10:13,570
simply change the client<font color="#E5E5E5"> to malicious</font>

200
00:10:09,650 --> 00:10:17,000
web page and do whatever<font color="#E5E5E5"> we want</font><font color="#CCCCCC"> right</font>

201
00:10:13,570 --> 00:10:19,430
<font color="#E5E5E5">so it's a little</font><font color="#CCCCCC"> bit complicated so it's</font>

202
00:10:17,000 --> 00:10:21,050
a<font color="#E5E5E5"> little complicated</font><font color="#CCCCCC"> and the</font>

203
00:10:19,430 --> 00:10:25,010
complication mainly counts for something

204
00:10:21,050 --> 00:10:26,719
<font color="#CCCCCC">called</font><font color="#E5E5E5"> the Sabre</font><font color="#CCCCCC"> region policy and also</font>

205
00:10:25,010 --> 00:10:30,830
if you're not familiar<font color="#E5E5E5"> with the same</font>

206
00:10:26,720 --> 00:10:33,380
origin<font color="#CCCCCC"> policy when</font><font color="#E5E5E5"> your browser loads up</font>

207
00:10:30,830 --> 00:10:35,930
a page it may look<font color="#CCCCCC"> like the</font><font color="#E5E5E5"> pages like</font>

208
00:10:33,380 --> 00:10:39,050
this<font color="#E5E5E5"> one single thing but of course the</font>

209
00:10:35,930 --> 00:10:41,150
reality<font color="#E5E5E5"> is that</font><font color="#CCCCCC"> it's made up of dozens</font>

210
00:10:39,050 --> 00:10:46,459
of<font color="#E5E5E5"> different</font><font color="#CCCCCC"> elements each one can come</font>

211
00:10:41,150 --> 00:10:49,459
<font color="#E5E5E5">from a different domain or host so it's</font>

212
00:10:46,460 --> 00:10:51,830
the browser's job to make<font color="#CCCCCC"> sure that one</font>

213
00:10:49,460 --> 00:10:53,780
element<font color="#E5E5E5"> doesn't read or write data from</font>

214
00:10:51,830 --> 00:11:00,190
another element<font color="#CCCCCC"> that belongs to a</font>

215
00:10:53,780 --> 00:11:03,540
<font color="#E5E5E5">different domain and did everybody see</font>

216
00:11:00,190 --> 00:11:07,260
<font color="#E5E5E5">Underpants</font><font color="#CCCCCC"> in the last slide</font>

217
00:11:03,540 --> 00:11:11,459
if you pay<font color="#E5E5E5"> attention the rest of you</font>

218
00:11:07,260 --> 00:11:14,160
failed so it does so with<font color="#E5E5E5"> something</font>

219
00:11:11,460 --> 00:11:18,870
called<font color="#E5E5E5"> the same origin policy and the</font>

220
00:11:14,160 --> 00:11:22,650
same<font color="#CCCCCC"> origin policy simply</font><font color="#E5E5E5"> says</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> if a</font>

221
00:11:18,870 --> 00:11:24,960
request<font color="#E5E5E5"> is not the request is not from</font>

222
00:11:22,650 --> 00:11:29,550
the<font color="#E5E5E5"> same origin if it has a different</font>

223
00:11:24,960 --> 00:11:31,650
port<font color="#E5E5E5"> domain or protocol</font><font color="#CCCCCC"> and if it's not</font>

224
00:11:29,550 --> 00:11:35,689
from<font color="#E5E5E5"> the same origin if it's made across</font>

225
00:11:31,650 --> 00:11:38,640
<font color="#CCCCCC">the regions</font><font color="#E5E5E5"> then it's subject</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> more</font>

226
00:11:35,690 --> 00:11:41,900
limitations<font color="#CCCCCC"> you can send any request</font>

227
00:11:38,640 --> 00:11:45,300
<font color="#CCCCCC">that</font><font color="#E5E5E5"> you want</font><font color="#CCCCCC"> only get help</font><font color="#E5E5E5"> post methods</font>

228
00:11:41,900 --> 00:11:49,439
<font color="#E5E5E5">you can read back</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> response body of</font>

229
00:11:45,300 --> 00:11:52,219
<font color="#E5E5E5">requests</font><font color="#CCCCCC"> and you can't post</font><font color="#E5E5E5"> a body</font><font color="#CCCCCC"> a</font>

230
00:11:49,440 --> 00:11:54,540
request with<font color="#CCCCCC"> the body to another</font><font color="#E5E5E5"> element</font>

231
00:11:52,220 --> 00:11:56,280
<font color="#E5E5E5">so we said we</font><font color="#CCCCCC"> don't want to start off</font>

232
00:11:54,540 --> 00:11:58,770
<font color="#E5E5E5">the attack with doing something</font>

233
00:11:56,280 --> 00:12:00,810
malicious we want to start<font color="#E5E5E5"> off clean so</font>

234
00:11:58,770 --> 00:12:04,079
we went ahead<font color="#CCCCCC"> and list all the darker</font>

235
00:12:00,810 --> 00:12:07,709
api's<font color="#CCCCCC"> that didn't violate the</font><font color="#E5E5E5"> same</font>

236
00:12:04,080 --> 00:12:11,430
<font color="#E5E5E5">origin</font><font color="#CCCCCC"> policy</font><font color="#E5E5E5"> and immediately after a</font>

237
00:12:07,710 --> 00:12:13,470
couple<font color="#E5E5E5"> of minutes we said okay there's a</font>

238
00:12:11,430 --> 00:12:19,020
single API<font color="#E5E5E5"> call that looks interesting</font>

239
00:12:13,470 --> 00:12:24,510
<font color="#CCCCCC">and that is the build a P I so when you</font>

240
00:12:19,020 --> 00:12:26,910
are building when it doesn't work<font color="#E5E5E5"> so</font>

241
00:12:24,510 --> 00:12:29,610
when<font color="#E5E5E5"> you're building a container or an</font>

242
00:12:26,910 --> 00:12:33,420
image more accurately<font color="#E5E5E5"> what you're</font>

243
00:12:29,610 --> 00:12:36,780
<font color="#E5E5E5">telling the</font><font color="#CCCCCC"> doctor engine is to look at</font>

244
00:12:33,420 --> 00:12:39,300
a text file<font color="#E5E5E5"> called the docker file and</font>

245
00:12:36,780 --> 00:12:42,689
then go<font color="#E5E5E5"> lie by line by line and tell it</font>

246
00:12:39,300 --> 00:12:45,240
how<font color="#CCCCCC"> to layer up your image and if you</font>

247
00:12:42,690 --> 00:12:46,620
ever<font color="#CCCCCC"> written</font><font color="#E5E5E5"> a container of public down</font>

248
00:12:45,240 --> 00:12:48,750
this or maybe<font color="#CCCCCC"> Daleks</font>

249
00:12:46,620 --> 00:12:51,000
a<font color="#E5E5E5"> hundred times</font><font color="#CCCCCC"> maybe didn't</font><font color="#E5E5E5"> even notice</font>

250
00:12:48,750 --> 00:12:53,910
but there is a command<font color="#E5E5E5"> here that is</font>

251
00:12:51,000 --> 00:12:57,920
really enables you to do like bad<font color="#CCCCCC"> things</font>

252
00:12:53,910 --> 00:13:00,930
<font color="#E5E5E5">and it is of course the run command</font>

253
00:12:57,920 --> 00:13:04,680
<font color="#E5E5E5">because when you're building an image</font>

254
00:13:00,930 --> 00:13:06,540
you're actually executing code so in my

255
00:13:04,680 --> 00:13:10,770
<font color="#CCCCCC">case I can just</font><font color="#E5E5E5"> load up whatever shell</font>

256
00:13:06,540 --> 00:13:13,349
script<font color="#E5E5E5"> that I want and run it so if you</font>

257
00:13:10,770 --> 00:13:15,970
dive<font color="#E5E5E5"> deeper into the API call will</font>

258
00:13:13,350 --> 00:13:18,700
notice some interesting parameters

259
00:13:15,970 --> 00:13:20,320
the first one is the tag parameter<font color="#E5E5E5"> so</font>

260
00:13:18,700 --> 00:13:22,450
you can build an image<font color="#E5E5E5"> and you can</font><font color="#CCCCCC"> name</font>

261
00:13:20,320 --> 00:13:25,180
<font color="#E5E5E5">it whatever you want</font><font color="#CCCCCC"> makes it easier</font>

262
00:13:22,450 --> 00:13:30,430
<font color="#E5E5E5">later in the attack to reference it</font>

263
00:13:25,180 --> 00:13:33,010
<font color="#E5E5E5">delete it</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> example</font><font color="#CCCCCC"> the second tag is</font>

264
00:13:30,430 --> 00:13:35,620
the<font color="#CCCCCC"> remote tag</font><font color="#E5E5E5"> and that's</font><font color="#CCCCCC"> also very</font>

265
00:13:33,010 --> 00:13:39,220
<font color="#E5E5E5">interesting</font><font color="#CCCCCC"> because it tells</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> darker</font>

266
00:13:35,620 --> 00:13:42,670
<font color="#CCCCCC">demon</font><font color="#E5E5E5"> to go</font><font color="#CCCCCC"> ahead</font><font color="#E5E5E5"> and pull your build</font>

267
00:13:39,220 --> 00:13:45,190
context from a remote git repository<font color="#E5E5E5"> so</font>

268
00:13:42,670 --> 00:13:47,560
that's an entire<font color="#E5E5E5"> kinetic control so you</font>

269
00:13:45,190 --> 00:13:50,400
can depending on your victim you can

270
00:13:47,560 --> 00:13:53,439
actually have the entire git repository

271
00:13:50,400 --> 00:13:55,270
<font color="#E5E5E5">do some fun do ransomware do</font>

272
00:13:53,440 --> 00:13:59,830
reconnaissance do whatever you want<font color="#CCCCCC"> and</font>

273
00:13:55,270 --> 00:14:02,020
pull it<font color="#CCCCCC"> and run it</font><font color="#E5E5E5"> and the last thing is</font>

274
00:13:59,830 --> 00:14:04,780
the<font color="#CCCCCC"> network mode so now you can control</font>

275
00:14:02,020 --> 00:14:07,150
what is the network<font color="#E5E5E5"> stack of your</font>

276
00:14:04,780 --> 00:14:10,030
<font color="#E5E5E5">running container is it running without</font>

277
00:14:07,150 --> 00:14:11,709
<font color="#E5E5E5">a network not a good idea or is</font><font color="#CCCCCC"> it</font>

278
00:14:10,030 --> 00:14:13,209
running<font color="#E5E5E5"> with the host network so that</font>

279
00:14:11,710 --> 00:14:16,540
<font color="#CCCCCC">you can actually</font><font color="#E5E5E5"> access the network</font>

280
00:14:13,210 --> 00:14:18,610
<font color="#E5E5E5">stack of the hosts so if you</font><font color="#CCCCCC"> demonstrate</font>

281
00:14:16,540 --> 00:14:21,069
that<font color="#E5E5E5"> this actually works it can run code</font>

282
00:14:18,610 --> 00:14:25,030
we're going<font color="#CCCCCC"> to do a simple reverse shell</font>

283
00:14:21,070 --> 00:14:28,690
<font color="#CCCCCC">and all we need is a simple a</font><font color="#E5E5E5"> simple</font>

284
00:14:25,030 --> 00:14:33,010
post request and<font color="#CCCCCC"> that post request will</font>

285
00:14:28,690 --> 00:14:36,730
be<font color="#E5E5E5"> the direct the darker demon to pull</font>

286
00:14:33,010 --> 00:14:39,069
<font color="#E5E5E5">from our malicious repository and in our</font>

287
00:14:36,730 --> 00:14:43,780
<font color="#CCCCCC">repository we simply have a reverse</font>

288
00:14:39,070 --> 00:14:45,640
<font color="#CCCCCC">shell so the demo</font><font color="#E5E5E5"> and any other demo</font>

289
00:14:43,780 --> 00:14:49,360
basically starts like this<font color="#CCCCCC"> so</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> is</font>

290
00:14:45,640 --> 00:14:51,250
<font color="#E5E5E5">the victims machine</font><font color="#CCCCCC"> he has the virtual</font>

291
00:14:49,360 --> 00:14:53,530
machine<font color="#CCCCCC"> running the containers he has</font>

292
00:14:51,250 --> 00:14:55,630
the darker<font color="#CCCCCC"> daemon on the host</font><font color="#E5E5E5"> and he has</font>

293
00:14:53,530 --> 00:14:59,020
his browser visiting the malicious web

294
00:14:55,630 --> 00:15:01,780
page so<font color="#E5E5E5"> all the malicious</font><font color="#CCCCCC"> weapons</font><font color="#E5E5E5"> does</font>

295
00:14:59,020 --> 00:15:05,050
is if you<font color="#E5E5E5"> post</font><font color="#CCCCCC"> commands it goes to the</font>

296
00:15:01,780 --> 00:15:08,410
<font color="#E5E5E5">darker demon it pulls from</font><font color="#CCCCCC"> the github</font>

297
00:15:05,050 --> 00:15:10,439
and now we have a running container and

298
00:15:08,410 --> 00:15:14,380
<font color="#CCCCCC">that running container what it does is</font>

299
00:15:10,440 --> 00:15:17,940
opens up a reverse<font color="#E5E5E5"> shell</font><font color="#CCCCCC"> so let's see</font>

300
00:15:14,380 --> 00:15:20,800
how does<font color="#CCCCCC"> it work</font><font color="#E5E5E5"> so this demo we show</font>

301
00:15:17,940 --> 00:15:24,520
<font color="#CCCCCC">two windows of the victim and two</font>

302
00:15:20,800 --> 00:15:28,819
<font color="#E5E5E5">windows of the attacker and like many</font>

303
00:15:24,520 --> 00:15:30,889
<font color="#E5E5E5">other demos we start by listing images</font>

304
00:15:28,819 --> 00:15:34,939
the containers<font color="#CCCCCC"> over the victim so he has</font>

305
00:15:30,889 --> 00:15:38,410
only one<font color="#CCCCCC"> image and all the attacker</font><font color="#E5E5E5"> does</font>

306
00:15:34,939 --> 00:15:41,929
is<font color="#E5E5E5"> simply host the malicious web page</font>

307
00:15:38,410 --> 00:15:45,559
<font color="#E5E5E5">using Python and all that</font><font color="#CCCCCC"> webpage</font><font color="#E5E5E5"> does</font>

308
00:15:41,929 --> 00:15:48,738
again<font color="#CCCCCC"> is it does a</font><font color="#E5E5E5"> simple post message</font>

309
00:15:45,559 --> 00:15:55,488
<font color="#E5E5E5">and I'm waiting for incoming</font><font color="#CCCCCC"> connections</font>

310
00:15:48,739 --> 00:15:58,039
from for my<font color="#E5E5E5"> rivers shell right so now as</font>

311
00:15:55,489 --> 00:16:02,059
<font color="#E5E5E5">the victim I simply visit some malicious</font>

312
00:15:58,039 --> 00:16:03,850
web page<font color="#E5E5E5"> and I'm seeing</font><font color="#CCCCCC"> like the button</font>

313
00:16:02,059 --> 00:16:07,189
that<font color="#E5E5E5"> I can click and then I get</font><font color="#CCCCCC"> pawned</font>

314
00:16:03,850 --> 00:16:10,279
and I'll also see the<font color="#E5E5E5"> entire building</font>

315
00:16:07,189 --> 00:16:12,019
process feedback<font color="#E5E5E5"> but these are things</font>

316
00:16:10,279 --> 00:16:13,489
that<font color="#E5E5E5"> like in a real world that you can</font>

317
00:16:12,019 --> 00:16:16,039
hide<font color="#CCCCCC"> from the user</font>

318
00:16:13,489 --> 00:16:19,309
and while the attack is going<font color="#E5E5E5"> on I can</font>

319
00:16:16,039 --> 00:16:22,910
<font color="#E5E5E5">actually look at my</font><font color="#CCCCCC"> duck or demon and</font>

320
00:16:19,309 --> 00:16:24,738
see that I have a running container and

321
00:16:22,910 --> 00:16:26,779
the images that that container pulled

322
00:16:24,739 --> 00:16:30,160
<font color="#E5E5E5">like we said the</font><font color="#CCCCCC"> container</font><font color="#E5E5E5"> simply opened</font>

323
00:16:26,779 --> 00:16:33,169
up<font color="#CCCCCC"> overs shell back to the attacker</font><font color="#E5E5E5"> and</font>

324
00:16:30,160 --> 00:16:37,459
here on the attacker side<font color="#E5E5E5"> I already have</font>

325
00:16:33,169 --> 00:16:40,459
the shell so now I can list the network

326
00:16:37,459 --> 00:16:44,388
interface and I see the<font color="#CCCCCC"> hv</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> zero</font>

327
00:16:40,459 --> 00:16:49,238
interface of the virtual machine so we

328
00:16:44,389 --> 00:16:52,369
<font color="#E5E5E5">prove that we can run malicious code on</font>

329
00:16:49,239 --> 00:16:53,779
the virtual machine by simply visiting<font color="#CCCCCC"> a</font>

330
00:16:52,369 --> 00:16:57,139
<font color="#CCCCCC">website without breaking anything</font>

331
00:16:53,779 --> 00:16:59,539
<font color="#E5E5E5">without doing anything</font><font color="#CCCCCC"> to malicious so</font>

332
00:16:57,139 --> 00:17:02,029
when we notify darker this simply said

333
00:16:59,539 --> 00:17:05,209
<font color="#CCCCCC">okay so from now on like many other</font>

334
00:17:02,029 --> 00:17:08,059
installation the<font color="#E5E5E5"> TCP is simply an opt-in</font>

335
00:17:05,209 --> 00:17:12,409
feature<font color="#E5E5E5"> so you</font><font color="#CCCCCC"> can stick a figure it on</font>

336
00:17:08,059 --> 00:17:14,720
<font color="#E5E5E5">any house but it's not on by default so</font>

337
00:17:12,409 --> 00:17:19,669
let's move on to the second<font color="#E5E5E5"> stage and</font>

338
00:17:14,720 --> 00:17:20,480
that<font color="#E5E5E5"> is the host rebinding attack so we</font>

339
00:17:19,669 --> 00:17:23,539
<font color="#E5E5E5">ask</font><font color="#CCCCCC"> ourselves</font>

340
00:17:20,480 --> 00:17:26,870
what<font color="#E5E5E5"> should we do next so we have a</font>

341
00:17:23,539 --> 00:17:29,600
building container running<font color="#E5E5E5"> and we don't</font>

342
00:17:26,869 --> 00:17:31,489
have full access<font color="#E5E5E5"> to the dr. demian API</font>

343
00:17:29,600 --> 00:17:36,230
<font color="#E5E5E5">again because of the same origin policy</font>

344
00:17:31,490 --> 00:17:39,590
and the running container has actually a

345
00:17:36,230 --> 00:17:41,750
<font color="#E5E5E5">limited lifetime it won't run forever so</font>

346
00:17:39,590 --> 00:17:43,850
we<font color="#CCCCCC"> ask</font><font color="#E5E5E5"> ourselves what can we do</font>

347
00:17:41,750 --> 00:17:47,630
I know what you're thinking<font color="#CCCCCC"> I can see it</font>

348
00:17:43,850 --> 00:17:52,189
in<font color="#E5E5E5"> your heads</font><font color="#CCCCCC"> screaming out why not</font><font color="#E5E5E5"> do</font>

349
00:17:47,630 --> 00:17:53,289
DNS rebinding<font color="#CCCCCC"> and bypass that pesky same</font>

350
00:17:52,190 --> 00:17:56,450
<font color="#CCCCCC">origin policy</font>

351
00:17:53,289 --> 00:17:58,789
so again if you spoiler we're not going

352
00:17:56,450 --> 00:18:02,809
to<font color="#CCCCCC"> use DNS rebinding we'll do</font><font color="#E5E5E5"> something</font>

353
00:17:58,789 --> 00:18:05,299
<font color="#CCCCCC">else some believe it was</font><font color="#E5E5E5"> discovered the</font>

354
00:18:02,809 --> 00:18:09,110
work around<font color="#E5E5E5"> 20 years ago really</font><font color="#CCCCCC"> became</font>

355
00:18:05,299 --> 00:18:12,110
<font color="#CCCCCC">popular around 2007</font><font color="#E5E5E5"> with paper by</font>

356
00:18:09,110 --> 00:18:15,740
<font color="#E5E5E5">Stanford I think with cooperation with</font>

357
00:18:12,110 --> 00:18:19,939
Dan Kaminsky<font color="#CCCCCC"> and then it spawned a lot</font>

358
00:18:15,740 --> 00:18:24,230
<font color="#E5E5E5">of other talks in</font><font color="#CCCCCC"> blackhat and in our</font>

359
00:18:19,940 --> 00:18:26,150
say what is DNS rebinding how to protect

360
00:18:24,230 --> 00:18:29,539
against it I think today there's also a

361
00:18:26,150 --> 00:18:32,299
talk in DEFCON<font color="#E5E5E5"> talking about DNS</font>

362
00:18:29,539 --> 00:18:34,100
rebinding<font color="#E5E5E5"> so just to get the gist of how</font>

363
00:18:32,299 --> 00:18:37,250
it works we're not going to<font color="#E5E5E5"> deep dive</font>

364
00:18:34,100 --> 00:18:38,689
<font color="#CCCCCC">into the industry buying if I am an</font>

365
00:18:37,250 --> 00:18:41,000
attacker<font color="#CCCCCC"> and I want to attack an</font>

366
00:18:38,690 --> 00:18:43,100
internal IP address<font color="#CCCCCC"> that</font><font color="#E5E5E5"> I can't get</font>

367
00:18:41,000 --> 00:18:44,330
<font color="#E5E5E5">through</font><font color="#CCCCCC"> because of</font><font color="#E5E5E5"> firewalls and stuff</font>

368
00:18:43,100 --> 00:18:46,340
like that

369
00:18:44,330 --> 00:18:49,158
I can set up<font color="#CCCCCC"> a domain</font><font color="#E5E5E5"> called attacker</font>

370
00:18:46,340 --> 00:18:52,178
comm and I get the victim<font color="#CCCCCC"> to visit</font>

371
00:18:49,159 --> 00:18:55,370
attacker comm so he's going to<font color="#E5E5E5"> query</font>

372
00:18:52,179 --> 00:18:57,559
<font color="#CCCCCC">he's going to perform a DNS query asking</font>

373
00:18:55,370 --> 00:19:00,830
where is attacker<font color="#E5E5E5"> calm and I'm going to</font>

374
00:18:57,559 --> 00:19:02,690
ask answer<font color="#CCCCCC"> with two different IPS my IP</font>

375
00:19:00,830 --> 00:19:05,750
and of course the<font color="#E5E5E5"> internal IP that I</font>

376
00:19:02,690 --> 00:19:08,929
want to attack then is going<font color="#E5E5E5"> to do HTTP</font>

377
00:19:05,750 --> 00:19:12,200
<font color="#E5E5E5">GET load up some malicious script that</font>

378
00:19:08,929 --> 00:19:14,630
malicious script is going to pull do

379
00:19:12,200 --> 00:19:18,650
another request<font color="#E5E5E5"> and now the attacker</font>

380
00:19:14,630 --> 00:19:21,200
<font color="#E5E5E5">performs disappear reset in and some</font>

381
00:19:18,650 --> 00:19:23,299
<font color="#E5E5E5">versions of browser perhaps say to</font>

382
00:19:21,200 --> 00:19:25,700
themselves<font color="#CCCCCC"> okay there was</font><font color="#E5E5E5"> a reset</font><font color="#CCCCCC"> I have</font>

383
00:19:23,299 --> 00:19:28,940
<font color="#E5E5E5">two</font><font color="#CCCCCC"> IPS</font><font color="#E5E5E5"> maybe I'll go to the second</font><font color="#CCCCCC"> one</font>

384
00:19:25,700 --> 00:19:33,169
<font color="#E5E5E5">and now</font><font color="#CCCCCC"> he</font><font color="#E5E5E5"> thinks that the internal IP</font>

385
00:19:28,940 --> 00:19:34,730
actually belongs to<font color="#CCCCCC"> attacker calm so now</font>

386
00:19:33,169 --> 00:19:37,100
we<font color="#E5E5E5"> basically</font><font color="#CCCCCC"> bypass the same origin</font>

387
00:19:34,730 --> 00:19:39,049
<font color="#CCCCCC">policy because there is no limitation</font>

388
00:19:37,100 --> 00:19:41,658
everything<font color="#E5E5E5"> that we can do on attacker</font>

389
00:19:39,049 --> 00:19:44,389
comm the malicious script can do on the

390
00:19:41,659 --> 00:19:48,860
internal IP so like I said<font color="#E5E5E5"> we're</font><font color="#CCCCCC"> not</font>

391
00:19:44,390 --> 00:19:50,030
going to<font color="#E5E5E5"> use DNS rebinding</font><font color="#CCCCCC"> first because</font>

392
00:19:48,860 --> 00:19:52,760
it may fail

393
00:19:50,030 --> 00:19:55,460
it's an old attack<font color="#CCCCCC"> you can discover it</font>

394
00:19:52,760 --> 00:19:57,230
it happens like over<font color="#E5E5E5"> your perimeter</font>

395
00:19:55,460 --> 00:20:00,770
<font color="#E5E5E5">you can detect it over the network</font><font color="#CCCCCC"> you</font>

396
00:19:57,230 --> 00:20:02,870
can<font color="#E5E5E5"> detect it in DNS and block it and me</font>

397
00:20:00,770 --> 00:20:05,270
<font color="#E5E5E5">is an attacker I don't want to set</font><font color="#CCCCCC"> up a</font>

398
00:20:02,870 --> 00:20:07,399
domain and maintain it and just some

399
00:20:05,270 --> 00:20:10,629
<font color="#E5E5E5">money and make sure it doesn't</font><font color="#CCCCCC"> get</font>

400
00:20:07,399 --> 00:20:14,899
blocked<font color="#CCCCCC"> it's too it's too</font><font color="#E5E5E5"> much work</font><font color="#CCCCCC"> so</font>

401
00:20:10,630 --> 00:20:18,350
<font color="#CCCCCC">instead we're going to attack local name</font>

402
00:20:14,899 --> 00:20:22,699
resolution protocols like LM<font color="#E5E5E5"> n R which</font>

403
00:20:18,350 --> 00:20:26,539
is a Microsoft protocol<font color="#E5E5E5"> stands for local</font>

404
00:20:22,700 --> 00:20:31,100
link multicast<font color="#CCCCCC"> name resolution basically</font>

405
00:20:26,539 --> 00:20:34,520
<font color="#CCCCCC">it's</font><font color="#E5E5E5"> DNS performed in environments where</font>

406
00:20:31,100 --> 00:20:37,039
<font color="#E5E5E5">you don't have a DNS server so every</font>

407
00:20:34,520 --> 00:20:38,720
host can simply broadcast says hey who

408
00:20:37,039 --> 00:20:41,658
knows<font color="#CCCCCC"> such-and-such</font>

409
00:20:38,720 --> 00:20:46,309
and<font color="#E5E5E5"> you can respond and say this is me</font>

410
00:20:41,659 --> 00:20:49,760
or this is the IP address<font color="#CCCCCC"> so it's</font><font color="#E5E5E5"> very</font>

411
00:20:46,309 --> 00:20:52,039
<font color="#CCCCCC">easy to attack anybody can spoof</font>

412
00:20:49,760 --> 00:20:55,129
responses and pretend<font color="#E5E5E5"> to be some</font>

413
00:20:52,039 --> 00:20:59,090
somebody<font color="#E5E5E5"> else and what's also</font>

414
00:20:55,130 --> 00:21:02,570
interesting that<font color="#E5E5E5"> by default your host</font>

415
00:20:59,090 --> 00:21:06,080
will query every interface<font color="#E5E5E5"> using a lemon</font>

416
00:21:02,570 --> 00:21:07,879
<font color="#CCCCCC">our including</font><font color="#E5E5E5"> virtual interface so of</font>

417
00:21:06,080 --> 00:21:11,210
course<font color="#E5E5E5"> it will include the virtual</font>

418
00:21:07,880 --> 00:21:13,250
machine<font color="#E5E5E5"> and if you spoof llm and</font><font color="#CCCCCC"> now</font>

419
00:21:11,210 --> 00:21:16,190
replies they don't get cached<font color="#E5E5E5"> on the</font>

420
00:21:13,250 --> 00:21:19,789
<font color="#CCCCCC">host</font><font color="#E5E5E5"> so it's the browser's job to catch</font>

421
00:21:16,190 --> 00:21:22,340
them and browsers do it for just<font color="#E5E5E5"> about a</font>

422
00:21:19,789 --> 00:21:25,700
<font color="#CCCCCC">minute</font><font color="#E5E5E5"> and we said maybe we can pay</font>

423
00:21:22,340 --> 00:21:28,370
<font color="#CCCCCC">bypass that</font><font color="#E5E5E5"> and we successfully</font><font color="#CCCCCC"> did so</font>

424
00:21:25,700 --> 00:21:32,899
in Firefox<font color="#E5E5E5"> so in Firefox if you simply</font>

425
00:21:28,370 --> 00:21:35,479
delay the HTTP<font color="#CCCCCC"> get the response for an</font>

426
00:21:32,899 --> 00:21:37,428
HTTP request<font color="#CCCCCC"> in half a second it</font><font color="#E5E5E5"> will</font>

427
00:21:35,480 --> 00:21:40,039
get a<font color="#E5E5E5"> little bit mad and will issue</font>

428
00:21:37,429 --> 00:21:42,320
another element<font color="#CCCCCC"> or request</font><font color="#E5E5E5"> so instead of</font>

429
00:21:40,039 --> 00:21:45,860
waiting<font color="#E5E5E5"> 60 seconds to perform the attack</font>

430
00:21:42,320 --> 00:21:49,039
<font color="#E5E5E5">you</font><font color="#CCCCCC"> can do it in</font><font color="#E5E5E5"> half a second so let's</font>

431
00:21:45,860 --> 00:21:51,949
do the demo of<font color="#E5E5E5"> host rebinding again</font>

432
00:21:49,039 --> 00:21:54,260
we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> start with visiting</font>

433
00:21:51,950 --> 00:21:56,450
<font color="#CCCCCC">i'm sorry we're</font><font color="#E5E5E5"> going to start off where</font>

434
00:21:54,260 --> 00:21:59,510
<font color="#CCCCCC">we already</font><font color="#E5E5E5"> have a reminder container</font>

435
00:21:56,450 --> 00:22:02,809
running<font color="#E5E5E5"> from the first step and</font><font color="#CCCCCC"> that</font>

436
00:21:59,510 --> 00:22:05,419
reminder<font color="#CCCCCC"> container running this job is</font>

437
00:22:02,809 --> 00:22:07,639
to perform the<font color="#E5E5E5"> host</font><font color="#CCCCCC"> rebinding</font><font color="#E5E5E5"> attack now</font>

438
00:22:05,419 --> 00:22:08,600
we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to visit some local host</font>

439
00:22:07,639 --> 00:22:11,060
called<font color="#CCCCCC"> pond</font>

440
00:22:08,600 --> 00:22:14,389
on the same port that<font color="#E5E5E5"> the</font><font color="#CCCCCC"> dr. Damon</font><font color="#E5E5E5"> is</font>

441
00:22:11,060 --> 00:22:16,580
listening<font color="#E5E5E5"> so the first thing is going to</font>

442
00:22:14,390 --> 00:22:19,550
<font color="#E5E5E5">happen it's going</font><font color="#CCCCCC"> to query LM an hour</font>

443
00:22:16,580 --> 00:22:22,820
where is<font color="#E5E5E5"> pond and the reminder container</font>

444
00:22:19,550 --> 00:22:24,740
will answer<font color="#CCCCCC"> that he is pond</font><font color="#E5E5E5"> so now we're</font>

445
00:22:22,820 --> 00:22:26,360
going<font color="#E5E5E5"> to load some malicious script and</font>

446
00:22:24,740 --> 00:22:30,560
that<font color="#E5E5E5"> scripts job is basically to</font><font color="#CCCCCC"> wade</font>

447
00:22:26,360 --> 00:22:33,560
out<font color="#CCCCCC"> the caching</font><font color="#E5E5E5"> of the browser and it</font>

448
00:22:30,560 --> 00:22:36,260
does so by simply querying<font color="#E5E5E5"> for a path</font>

449
00:22:33,560 --> 00:22:38,990
and that path<font color="#E5E5E5"> doesn't exist on the</font>

450
00:22:36,260 --> 00:22:41,570
reminder container so it does so<font color="#E5E5E5"> every</font>

451
00:22:38,990 --> 00:22:45,470
<font color="#CCCCCC">five</font><font color="#E5E5E5"> seconds but finally the caching</font>

452
00:22:41,570 --> 00:22:48,649
<font color="#E5E5E5">expires and another request is issued</font>

453
00:22:45,470 --> 00:22:52,880
and this time the reminder says I'm on

454
00:22:48,650 --> 00:22:55,310
the localhost<font color="#E5E5E5"> so now the same path get</font>

455
00:22:52,880 --> 00:22:57,920
actually an HTTP 200<font color="#E5E5E5"> from the dr.</font><font color="#CCCCCC"> demian</font>

456
00:22:55,310 --> 00:22:59,570
because that's a valid<font color="#E5E5E5"> request</font><font color="#CCCCCC"> so now we</font>

457
00:22:57,920 --> 00:23:01,760
know that<font color="#E5E5E5"> we bypass the</font><font color="#CCCCCC"> same</font><font color="#E5E5E5"> origin</font>

458
00:22:59,570 --> 00:23:04,669
policy<font color="#E5E5E5"> and we can do whatever we want</font>

459
00:23:01,760 --> 00:23:07,460
just for the demo we're going<font color="#CCCCCC"> to read</font>

460
00:23:04,670 --> 00:23:09,260
some secrets from docker and secrets is

461
00:23:07,460 --> 00:23:12,230
like the most sensitive information<font color="#E5E5E5"> is</font>

462
00:23:09,260 --> 00:23:13,520
the password<font color="#CCCCCC"> and keys</font><font color="#E5E5E5"> and tokens</font><font color="#CCCCCC"> that</font>

463
00:23:12,230 --> 00:23:15,830
<font color="#E5E5E5">you want to protect you put them in</font>

464
00:23:13,520 --> 00:23:19,700
<font color="#E5E5E5">secrets and we're going to post them</font>

465
00:23:15,830 --> 00:23:22,639
back to the container<font color="#E5E5E5"> so let's see how</font>

466
00:23:19,700 --> 00:23:27,760
<font color="#CCCCCC">that works</font><font color="#E5E5E5"> so I'm going to start off</font><font color="#CCCCCC"> a</font>

467
00:23:22,640 --> 00:23:31,130
demo<font color="#E5E5E5"> we're listing the secrets from my</font>

468
00:23:27,760 --> 00:23:32,629
browser on the<font color="#CCCCCC"> localhost</font><font color="#E5E5E5"> and there's no</font>

469
00:23:31,130 --> 00:23:35,300
problem there I'm talking<font color="#CCCCCC"> directly with</font>

470
00:23:32,630 --> 00:23:39,500
the<font color="#CCCCCC"> docker</font><font color="#E5E5E5"> demon and these is this is my</font>

471
00:23:35,300 --> 00:23:42,070
secret<font color="#E5E5E5"> this is called my secret and I'm</font>

472
00:23:39,500 --> 00:23:45,890
going<font color="#CCCCCC"> to run a reminder container</font>

473
00:23:42,070 --> 00:23:48,770
directly<font color="#E5E5E5"> from command line and it's</font>

474
00:23:45,890 --> 00:23:50,630
going<font color="#E5E5E5"> to</font><font color="#CCCCCC"> use the</font><font color="#E5E5E5"> host the network of the</font>

475
00:23:48,770 --> 00:23:53,120
<font color="#E5E5E5">host so it does like we said it's</font>

476
00:23:50,630 --> 00:23:57,680
spoofing<font color="#E5E5E5"> LM in our request</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> its host</font>

477
00:23:53,120 --> 00:24:02,479
some malicious script now I'm going<font color="#E5E5E5"> to</font>

478
00:23:57,680 --> 00:24:07,340
visit<font color="#E5E5E5"> pond I'm going to open the debug</font>

479
00:24:02,480 --> 00:24:09,710
window and see the<font color="#CCCCCC"> script in action so</font>

480
00:24:07,340 --> 00:24:12,679
this is the page from<font color="#E5E5E5"> the reminder</font>

481
00:24:09,710 --> 00:24:15,500
container and on the debug window I see

482
00:24:12,680 --> 00:24:19,610
that every few seconds<font color="#E5E5E5"> I'm querying from</font>

483
00:24:15,500 --> 00:24:22,190
for the images<font color="#E5E5E5"> Jason and I'm failing and</font>

484
00:24:19,610 --> 00:24:24,100
this takes like I said about a minute

485
00:24:22,190 --> 00:24:27,559
<font color="#CCCCCC">but for your convenience we</font>

486
00:24:24,100 --> 00:24:31,668
<font color="#E5E5E5">fast-forwarded it so it only takes and</font>

487
00:24:27,559 --> 00:24:35,090
<font color="#CCCCCC">twenty seconds</font><font color="#E5E5E5"> so it will speed up a</font>

488
00:24:31,669 --> 00:24:38,120
<font color="#CCCCCC">little bit</font><font color="#E5E5E5"> and after</font><font color="#CCCCCC"> a minute the</font>

489
00:24:35,090 --> 00:24:41,029
caching expires<font color="#E5E5E5"> and we'll get an HTTP</font>

490
00:24:38,120 --> 00:24:42,739
<font color="#CCCCCC">we'll do the query again and we get a</font>

491
00:24:41,029 --> 00:24:45,320
good response<font color="#E5E5E5"> so we'll read the secrets</font>

492
00:24:42,740 --> 00:24:47,450
<font color="#E5E5E5">and then we'll post them back to the</font>

493
00:24:45,320 --> 00:24:50,120
<font color="#E5E5E5">container so from the container we were</font>

494
00:24:47,450 --> 00:24:55,330
able<font color="#E5E5E5"> to read secrets from the docker</font>

495
00:24:50,120 --> 00:24:58,639
<font color="#CCCCCC">diamond</font><font color="#E5E5E5"> so to recap</font><font color="#CCCCCC"> the first step is</font>

496
00:24:55,330 --> 00:25:01,549
<font color="#CCCCCC">abusive docker API and then get remote</font>

497
00:24:58,639 --> 00:25:03,918
code executed<font color="#E5E5E5"> and this is a reminder</font>

498
00:25:01,549 --> 00:25:07,370
container<font color="#E5E5E5"> so now it's the reminder</font>

499
00:25:03,919 --> 00:25:09,080
container job to do privilege escalation

500
00:25:07,370 --> 00:25:12,830
<font color="#E5E5E5">and basically bypass the</font><font color="#CCCCCC"> same-origin</font>

501
00:25:09,080 --> 00:25:16,639
<font color="#CCCCCC">policy</font><font color="#E5E5E5"> so now we have full access to the</font>

502
00:25:12,830 --> 00:25:18,320
docker demon so the question is what do

503
00:25:16,639 --> 00:25:22,158
<font color="#E5E5E5">we do now so we have full</font><font color="#CCCCCC"> access to</font><font color="#E5E5E5"> the</font>

504
00:25:18,320 --> 00:25:25,340
<font color="#CCCCCC">dock or demon what do we do now and the</font>

505
00:25:22,159 --> 00:25:27,320
<font color="#E5E5E5">answer there are many answers we chose</font>

506
00:25:25,340 --> 00:25:30,980
to go with something<font color="#E5E5E5"> called shadow</font>

507
00:25:27,320 --> 00:25:33,259
containers so the problem I have is I

508
00:25:30,980 --> 00:25:35,419
can run a<font color="#CCCCCC"> privileged container which</font>

509
00:25:33,259 --> 00:25:39,529
will<font color="#CCCCCC"> have full</font><font color="#E5E5E5"> access</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> virtual</font>

510
00:25:35,419 --> 00:25:42,080
<font color="#E5E5E5">machine</font><font color="#CCCCCC"> access to the filesystem I also</font>

511
00:25:39,529 --> 00:25:45,350
have access<font color="#E5E5E5"> to</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> internal</font><font color="#CCCCCC"> network but</font>

512
00:25:42,080 --> 00:25:48,379
I am not<font color="#E5E5E5"> really concealed anybody can</font>

513
00:25:45,350 --> 00:25:51,469
see my running container by simply<font color="#E5E5E5"> doing</font>

514
00:25:48,379 --> 00:25:53,719
docker PS<font color="#E5E5E5"> you'll see the container you</font>

515
00:25:51,470 --> 00:25:56,480
can kill<font color="#E5E5E5"> it</font><font color="#CCCCCC"> and I'm not</font><font color="#E5E5E5"> really</font>

516
00:25:53,720 --> 00:25:59,210
persistent<font color="#E5E5E5"> and that is because whenever</font>

517
00:25:56,480 --> 00:26:02,600
<font color="#E5E5E5">you restart your machine or whenever you</font>

518
00:25:59,210 --> 00:26:05,659
restart<font color="#E5E5E5"> your doctor daemon the virtual</font>

519
00:26:02,600 --> 00:26:07,100
machine<font color="#E5E5E5"> is booting</font><font color="#CCCCCC"> up from an image</font><font color="#E5E5E5"> so</font>

520
00:26:05,659 --> 00:26:10,580
everything that you<font color="#E5E5E5"> left on the machine</font>

521
00:26:07,100 --> 00:26:14,360
gets deleted<font color="#CCCCCC"> and that is except of</font>

522
00:26:10,580 --> 00:26:18,019
course for the state of docker<font color="#E5E5E5"> so how do</font>

523
00:26:14,360 --> 00:26:20,449
you make<font color="#CCCCCC"> it persistent and</font><font color="#E5E5E5"> conceal so</font>

524
00:26:18,019 --> 00:26:23,840
let's start by assuming<font color="#E5E5E5"> to understand</font>

525
00:26:20,450 --> 00:26:27,320
how it works<font color="#CCCCCC"> we</font><font color="#E5E5E5"> already have a shutdown</font>

526
00:26:23,840 --> 00:26:30,678
script written<font color="#E5E5E5"> to the virtual machine</font>

527
00:26:27,320 --> 00:26:33,918
<font color="#CCCCCC">and the job of the shadowing script is</font>

528
00:26:30,679 --> 00:26:35,179
<font color="#E5E5E5">whenever there is a shutdown</font><font color="#CCCCCC"> it runs</font><font color="#E5E5E5"> a</font>

529
00:26:33,919 --> 00:26:38,659
container

530
00:26:35,179 --> 00:26:41,599
and I have another script which I call

531
00:26:38,659 --> 00:26:44,719
my script<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> basically the attack</font>

532
00:26:41,599 --> 00:26:48,649
script and this does<font color="#E5E5E5"> something bad this</font>

533
00:26:44,719 --> 00:26:51,379
installs<font color="#E5E5E5"> a kernel model or a service or</font>

534
00:26:48,649 --> 00:26:54,678
scans the network<font color="#E5E5E5"> or it does whatever or</font>

535
00:26:51,379 --> 00:26:56,959
ransomware<font color="#E5E5E5"> whatever it does it does it's</font>

536
00:26:54,679 --> 00:27:00,559
inside the<font color="#E5E5E5"> script and this is the attack</font>

537
00:26:56,960 --> 00:27:03,379
script so once I'm going<font color="#E5E5E5"> to reset</font><font color="#CCCCCC"> the</font>

538
00:27:00,559 --> 00:27:05,479
<font color="#E5E5E5">darker</font><font color="#CCCCCC"> demon it's going to run a shadow</font>

539
00:27:03,379 --> 00:27:07,759
container<font color="#E5E5E5"> and the job of</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> shadow</font>

540
00:27:05,479 --> 00:27:09,440
container is to save the<font color="#E5E5E5"> script</font><font color="#CCCCCC"> and the</font>

541
00:27:07,759 --> 00:27:12,499
attack<font color="#CCCCCC"> State inside the container</font>

542
00:27:09,440 --> 00:27:14,960
<font color="#E5E5E5">so whenever the darker demon boots up</font>

543
00:27:12,499 --> 00:27:17,210
again it's going<font color="#E5E5E5"> to go back into the</font>

544
00:27:14,960 --> 00:27:20,559
virtual<font color="#E5E5E5"> machine so now we have a sort of</font>

545
00:27:17,210 --> 00:27:24,200
a<font color="#E5E5E5"> ping pong situation so whenever you</font>

546
00:27:20,559 --> 00:27:25,908
have<font color="#E5E5E5"> the docker container running you</font>

547
00:27:24,200 --> 00:27:28,759
have your<font color="#E5E5E5"> entire attack inside the</font>

548
00:27:25,909 --> 00:27:31,969
<font color="#CCCCCC">virtual machines so the user</font><font color="#E5E5E5"> and most</font>

549
00:27:28,759 --> 00:27:35,499
other tools can't really see it and when

550
00:27:31,969 --> 00:27:38,119
the container<font color="#CCCCCC"> I'm sorry</font><font color="#E5E5E5"> when the demon</font>

551
00:27:35,499 --> 00:27:39,999
reboots<font color="#E5E5E5"> you have the state of</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> attack</font>

552
00:27:38,119 --> 00:27:42,320
saved<font color="#CCCCCC"> inside the shadow container and</font>

553
00:27:39,999 --> 00:27:43,789
when it boots up again it goes back<font color="#E5E5E5"> to</font>

554
00:27:42,320 --> 00:27:45,678
<font color="#E5E5E5">the script so</font><font color="#CCCCCC"> we have a ping pong go</font>

555
00:27:43,789 --> 00:27:48,830
between the attack on the virtual

556
00:27:45,679 --> 00:27:51,619
machine<font color="#CCCCCC"> and on the container</font><font color="#E5E5E5"> so this is</font>

557
00:27:48,830 --> 00:27:54,199
the actual code<font color="#CCCCCC"> for a shadow script that</font>

558
00:27:51,619 --> 00:27:56,149
<font color="#E5E5E5">I used in this demo it's a very simple</font>

559
00:27:54,200 --> 00:27:58,789
code<font color="#E5E5E5"> first</font>

560
00:27:56,149 --> 00:28:02,178
<font color="#E5E5E5">I simply load into an environment</font>

561
00:27:58,789 --> 00:28:04,158
variable<font color="#E5E5E5"> my attack script and I save it</font>

562
00:28:02,179 --> 00:28:06,830
inside an environment variable<font color="#E5E5E5"> on the</font>

563
00:28:04,159 --> 00:28:09,259
<font color="#E5E5E5">container I'm running privileged</font>

564
00:28:06,830 --> 00:28:12,379
containers as you can see I'm going<font color="#CCCCCC"> to</font>

565
00:28:09,259 --> 00:28:14,389
<font color="#CCCCCC">name it shadow and I'm using the restart</font>

566
00:28:12,379 --> 00:28:16,908
policy so<font color="#CCCCCC"> that tells the dr. demon to</font>

567
00:28:14,389 --> 00:28:21,498
continuously reboot the container<font color="#E5E5E5"> until</font>

568
00:28:16,909 --> 00:28:24,799
<font color="#CCCCCC">some condition happens the image</font><font color="#E5E5E5"> that I</font>

569
00:28:21,499 --> 00:28:26,509
use is<font color="#E5E5E5"> also not available I think</font><font color="#CCCCCC"> in</font>

570
00:28:24,799 --> 00:28:29,089
newer version of docker

571
00:28:26,509 --> 00:28:31,909
it's called the NS<font color="#CCCCCC"> Enter dr. from</font>

572
00:28:29,089 --> 00:28:33,950
windows<font color="#E5E5E5"> and</font><font color="#CCCCCC"> a Center image so in all the</font>

573
00:28:31,909 --> 00:28:36,019
versions of docker<font color="#E5E5E5"> for</font><font color="#CCCCCC"> Windows you when</font>

574
00:28:33,950 --> 00:28:38,239
you stalled it it came with the<font color="#CCCCCC"> NS enter</font>

575
00:28:36,019 --> 00:28:41,599
<font color="#E5E5E5">image and even</font><font color="#CCCCCC"> if you delete it</font><font color="#E5E5E5"> and you</font>

576
00:28:38,239 --> 00:28:45,799
rebuilt<font color="#CCCCCC"> darker you still have that</font><font color="#E5E5E5"> image</font>

577
00:28:41,599 --> 00:28:47,990
<font color="#E5E5E5">so it's the perfect one to</font><font color="#CCCCCC"> use</font><font color="#E5E5E5"> nothing</font>

578
00:28:45,799 --> 00:28:50,450
<font color="#CCCCCC">that contaminates the host</font>

579
00:28:47,990 --> 00:28:53,660
and the container is actually running

580
00:28:50,450 --> 00:28:56,090
the attack script and here for<font color="#E5E5E5"> example</font>

581
00:28:53,660 --> 00:28:59,860
<font color="#E5E5E5">the attack strip is also very simple a</font>

582
00:28:56,090 --> 00:29:02,540
simple<font color="#CCCCCC"> if an ass else clause</font><font color="#E5E5E5"> so if I'm</font>

583
00:28:59,860 --> 00:29:03,919
if the<font color="#E5E5E5"> machine is actually booting up</font>

584
00:29:02,540 --> 00:29:07,159
<font color="#CCCCCC">I'm going to look if there is a</font>

585
00:29:03,920 --> 00:29:09,320
persistent<font color="#CCCCCC"> this is the shot on script if</font>

586
00:29:07,160 --> 00:29:11,660
it's there<font color="#CCCCCC"> then it means I've still</font>

587
00:29:09,320 --> 00:29:13,669
haven't put<font color="#E5E5E5"> it up if it's not there I'm</font>

588
00:29:11,660 --> 00:29:16,700
simply writing<font color="#E5E5E5"> back the</font><font color="#CCCCCC"> shell on script</font>

589
00:29:13,670 --> 00:29:19,250
<font color="#E5E5E5">I write back</font><font color="#CCCCCC"> the attack script</font><font color="#E5E5E5"> from</font><font color="#CCCCCC"> the</font>

590
00:29:16,700 --> 00:29:20,990
environment<font color="#E5E5E5"> variable I install the</font>

591
00:29:19,250 --> 00:29:24,050
shadow script and then I'm doing

592
00:29:20,990 --> 00:29:26,390
<font color="#E5E5E5">something evil so my evil thoughts are</font>

593
00:29:24,050 --> 00:29:29,360
not that sophisticated I simply write a

594
00:29:26,390 --> 00:29:33,170
shadow file to the virtual<font color="#E5E5E5"> machine and</font>

595
00:29:29,360 --> 00:29:34,790
then it<font color="#E5E5E5"> commits suicide so let's see a</font>

596
00:29:33,170 --> 00:29:38,270
demo of<font color="#E5E5E5"> running shadow container</font>

597
00:29:34,790 --> 00:29:40,220
<font color="#CCCCCC">directly from command</font><font color="#E5E5E5"> line so if I go</font>

598
00:29:38,270 --> 00:29:41,930
and run it from<font color="#E5E5E5"> command</font><font color="#CCCCCC"> line if</font><font color="#E5E5E5"> you look</font>

599
00:29:40,220 --> 00:29:43,850
I'm sorry<font color="#E5E5E5"> before</font><font color="#CCCCCC"> I run from command line</font>

600
00:29:41,930 --> 00:29:46,310
<font color="#CCCCCC">I'll show you that</font><font color="#E5E5E5"> I have nothing up my</font>

601
00:29:43,850 --> 00:29:49,429
sleeves I'll show you the images<font color="#E5E5E5"> and the</font>

602
00:29:46,310 --> 00:29:52,360
containers<font color="#E5E5E5"> so we have two images and two</font>

603
00:29:49,430 --> 00:29:55,190
containers<font color="#E5E5E5"> and we'll use an inspector</font>

604
00:29:52,360 --> 00:29:58,429
<font color="#E5E5E5">container and we use that</font><font color="#CCCCCC"> to look inside</font>

605
00:29:55,190 --> 00:30:00,970
<font color="#E5E5E5">the virtual machine so we see that we</font>

606
00:29:58,430 --> 00:30:04,880
don't<font color="#E5E5E5"> have any shadow files</font>

607
00:30:00,970 --> 00:30:08,240
so now we'll run this big command which

608
00:30:04,880 --> 00:30:10,460
runs<font color="#E5E5E5"> the shadow container and after we</font>

609
00:30:08,240 --> 00:30:12,590
were<font color="#E5E5E5"> on it again we'll lose the images</font>

610
00:30:10,460 --> 00:30:14,990
and containers<font color="#E5E5E5"> so again I have two</font>

611
00:30:12,590 --> 00:30:18,080
<font color="#CCCCCC">images into containers so nothing</font>

612
00:30:14,990 --> 00:30:21,970
changed apparently but when I run this

613
00:30:18,080 --> 00:30:25,460
<font color="#CCCCCC">Specter I will see I have</font><font color="#E5E5E5"> a shadow file</font>

614
00:30:21,970 --> 00:30:28,400
there we go<font color="#E5E5E5"> so doesn't this doesn't</font>

615
00:30:25,460 --> 00:30:31,190
<font color="#E5E5E5">prove anything just that I have a file</font><font color="#CCCCCC"> I</font>

616
00:30:28,400 --> 00:30:33,800
can also see<font color="#E5E5E5"> the</font><font color="#CCCCCC"> shadow</font><font color="#E5E5E5"> script that</font>

617
00:30:31,190 --> 00:30:36,260
we've seen<font color="#E5E5E5"> in the presentation</font><font color="#CCCCCC"> this is</font>

618
00:30:33,800 --> 00:30:39,290
<font color="#E5E5E5">the my script the attack script and we</font>

619
00:30:36,260 --> 00:30:43,070
<font color="#E5E5E5">have the shadow script so to prove</font><font color="#CCCCCC"> this</font>

620
00:30:39,290 --> 00:30:45,350
actually persists<font color="#E5E5E5"> we have to reset the</font>

621
00:30:43,070 --> 00:30:48,260
darker<font color="#E5E5E5"> demon</font><font color="#CCCCCC"> and this is that what I'm</font>

622
00:30:45,350 --> 00:30:52,520
<font color="#CCCCCC">doing going to reset it</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> take a couple</font>

623
00:30:48,260 --> 00:30:55,690
of seconds<font color="#E5E5E5"> and once it's up we're going</font>

624
00:30:52,520 --> 00:30:55,690
<font color="#E5E5E5">to repeat the entire thing</font>

625
00:31:02,560 --> 00:31:10,580
right yeah<font color="#CCCCCC"> so it's up again and I'm</font>

626
00:31:09,320 --> 00:31:13,429
going<font color="#CCCCCC"> to repeat</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> entire</font><font color="#E5E5E5"> thing I'm</font>

627
00:31:10,580 --> 00:31:15,620
going<font color="#E5E5E5"> to list</font><font color="#CCCCCC"> I'm going</font><font color="#E5E5E5"> to run the</font>

628
00:31:13,430 --> 00:31:21,530
inspector<font color="#CCCCCC"> I'm going to use a little</font><font color="#E5E5E5"> bit</font>

629
00:31:15,620 --> 00:31:23,659
later and now<font color="#E5E5E5"> I'm going</font><font color="#CCCCCC"> to look</font><font color="#E5E5E5"> at the</font>

630
00:31:21,530 --> 00:31:25,840
images so again we have two images<font color="#CCCCCC"> two</font>

631
00:31:23,660 --> 00:31:28,910
containers apparently nothing changed

632
00:31:25,840 --> 00:31:30,679
<font color="#CCCCCC">when we use the</font><font color="#E5E5E5"> inspector we still see</font>

633
00:31:28,910 --> 00:31:35,360
the shadow file so we persisted

634
00:31:30,680 --> 00:31:40,330
throughout reboots so now we have

635
00:31:35,360 --> 00:31:44,600
<font color="#E5E5E5">basically the final piece</font><font color="#CCCCCC"> of the puzzle</font>

636
00:31:40,330 --> 00:31:47,720
<font color="#CCCCCC">so let's see the entire attack flow so</font>

637
00:31:44,600 --> 00:31:50,149
it's gonna<font color="#E5E5E5"> start off like all the</font>

638
00:31:47,720 --> 00:31:54,200
previous demos the victim is going<font color="#E5E5E5"> to</font>

639
00:31:50,150 --> 00:31:56,180
visit<font color="#E5E5E5"> shadow containers dot-com and the</font>

640
00:31:54,200 --> 00:31:58,700
<font color="#E5E5E5">first step like we said we're going to</font>

641
00:31:56,180 --> 00:32:02,030
<font color="#E5E5E5">abuse docker API and we'll get a</font>

642
00:31:58,700 --> 00:32:04,430
<font color="#E5E5E5">reminder container running the reminder</font>

643
00:32:02,030 --> 00:32:07,040
containers job is to perform<font color="#CCCCCC"> host</font>

644
00:32:04,430 --> 00:32:10,190
<font color="#E5E5E5">reburning attack so now we have full</font>

645
00:32:07,040 --> 00:32:12,909
<font color="#E5E5E5">access to the</font><font color="#CCCCCC"> doctor</font><font color="#E5E5E5"> daemon so if</font><font color="#CCCCCC"> i have</font>

646
00:32:10,190 --> 00:32:15,830
full access to<font color="#E5E5E5"> the document i</font><font color="#CCCCCC"> can now</font>

647
00:32:12,910 --> 00:32:18,860
run<font color="#E5E5E5"> a privilege payload and that</font>

648
00:32:15,830 --> 00:32:22,250
privilege payload can write the<font color="#CCCCCC"> shutdown</font>

649
00:32:18,860 --> 00:32:24,169
script to the virtual machine<font color="#E5E5E5"> now all</font><font color="#CCCCCC"> i</font>

650
00:32:22,250 --> 00:32:28,550
have<font color="#CCCCCC"> to</font><font color="#E5E5E5"> do some housekeeping</font><font color="#CCCCCC"> i will</font>

651
00:32:24,170 --> 00:32:31,520
delete the reminder<font color="#CCCCCC"> and the payload from</font>

652
00:32:28,550 --> 00:32:34,879
the<font color="#E5E5E5"> virtual machine and now whenever we</font>

653
00:32:31,520 --> 00:32:36,650
reset the<font color="#E5E5E5"> doctor demon on the host it's</font>

654
00:32:34,880 --> 00:32:38,780
going to create the shadow container and

655
00:32:36,650 --> 00:32:40,850
of course when the demon is up again

656
00:32:38,780 --> 00:32:42,530
<font color="#E5E5E5">it's going to write</font><font color="#CCCCCC"> down the shuttle</font>

657
00:32:40,850 --> 00:32:44,659
script<font color="#E5E5E5"> in my script back to the virtual</font>

658
00:32:42,530 --> 00:32:50,899
machine<font color="#E5E5E5"> so let's see this whole thing</font>

659
00:32:44,660 --> 00:32:53,870
<font color="#CCCCCC">working from end to end so again i'm</font>

660
00:32:50,900 --> 00:32:57,260
<font color="#E5E5E5">going to show that i have nothing up our</font>

661
00:32:53,870 --> 00:33:01,310
sleeves<font color="#E5E5E5"> we have two images and two</font>

662
00:32:57,260 --> 00:33:03,050
containers running<font color="#E5E5E5"> on the host and we're</font>

663
00:33:01,310 --> 00:33:07,190
going<font color="#E5E5E5"> to use a specter again to look at</font>

664
00:33:03,050 --> 00:33:11,810
the underlying<font color="#CCCCCC"> virtual machine</font><font color="#E5E5E5"> and of</font>

665
00:33:07,190 --> 00:33:14,010
course there<font color="#E5E5E5"> is no shadow file right so</font>

666
00:33:11,810 --> 00:33:16,110
let's<font color="#CCCCCC"> start the attack</font>

667
00:33:14,010 --> 00:33:20,250
I'm going to visit<font color="#CCCCCC"> chatter container</font>

668
00:33:16,110 --> 00:33:23,729
calm<font color="#E5E5E5"> and again I'm going to click a</font>

669
00:33:20,250 --> 00:33:25,320
button<font color="#CCCCCC"> we have two</font><font color="#E5E5E5"> iframes here the top</font>

670
00:33:23,730 --> 00:33:27,900
<font color="#CCCCCC">one will show you the</font><font color="#E5E5E5"> entire building</font>

671
00:33:25,320 --> 00:33:31,049
process of the container<font color="#E5E5E5"> again</font><font color="#CCCCCC"> in a real</font>

672
00:33:27,900 --> 00:33:34,740
attack you can hide this from the user

673
00:33:31,049 --> 00:33:38,340
<font color="#E5E5E5">and on the bottom</font><font color="#CCCCCC"> we have another iframe</font>

674
00:33:34,740 --> 00:33:40,080
waiting for the reminder container<font color="#CCCCCC"> to</font>

675
00:33:38,340 --> 00:33:43,649
load the malicious script<font color="#E5E5E5"> and perform</font>

676
00:33:40,080 --> 00:33:46,860
<font color="#E5E5E5">the host rebinding attack so</font><font color="#CCCCCC"> we'll take</font>

677
00:33:43,650 --> 00:33:49,970
<font color="#E5E5E5">a couple of seconds</font><font color="#CCCCCC"> I'm waiting for the</font>

678
00:33:46,860 --> 00:33:53,030
reminder<font color="#CCCCCC"> and the</font><font color="#E5E5E5"> rebuttal is now running</font>

679
00:33:49,970 --> 00:33:56,400
serving the malicious script and

680
00:33:53,030 --> 00:33:58,139
spoofing<font color="#CCCCCC"> llm</font><font color="#E5E5E5"> in our response so only</font>

681
00:33:56,400 --> 00:34:01,530
while this attack is going<font color="#E5E5E5"> on you can</font>

682
00:33:58,140 --> 00:34:06,360
<font color="#E5E5E5">actually you</font><font color="#CCCCCC"> can actually</font><font color="#E5E5E5"> go to the host</font>

683
00:34:01,530 --> 00:34:09,659
<font color="#E5E5E5">and see the containers</font><font color="#CCCCCC"> that is</font><font color="#E5E5E5"> running</font>

684
00:34:06,360 --> 00:34:11,639
so I see the running<font color="#E5E5E5"> container the</font>

685
00:34:09,659 --> 00:34:14,040
reminder container I can see the<font color="#E5E5E5"> images</font>

686
00:34:11,639 --> 00:34:17,159
that<font color="#E5E5E5"> it pulled so I have some extra</font>

687
00:34:14,040 --> 00:34:18,869
images<font color="#E5E5E5"> from before but this whole</font><font color="#CCCCCC"> thing</font>

688
00:34:17,159 --> 00:34:21,659
will be deleted<font color="#E5E5E5"> after the attack is</font>

689
00:34:18,869 --> 00:34:24,359
complete<font color="#CCCCCC"> and like we</font><font color="#E5E5E5"> said it takes a</font>

690
00:34:21,659 --> 00:34:27,750
couple<font color="#E5E5E5"> of time for for the cache to</font>

691
00:34:24,359 --> 00:34:32,489
<font color="#CCCCCC">clear</font><font color="#E5E5E5"> up but once it does we get an HTTP</font>

692
00:34:27,750 --> 00:34:34,770
200 back to our malicious script<font color="#E5E5E5"> and now</font>

693
00:34:32,489 --> 00:34:37,888
we can go ahead<font color="#E5E5E5"> and run the privilege</font>

694
00:34:34,770 --> 00:34:40,918
payload so we run<font color="#CCCCCC"> the privilege payload</font>

695
00:34:37,889 --> 00:34:44,190
and we start it<font color="#E5E5E5"> and after it</font><font color="#CCCCCC"> starts we</font>

696
00:34:40,918 --> 00:34:49,980
can simply<font color="#E5E5E5"> remove it and delete whatever</font>

697
00:34:44,190 --> 00:34:52,230
<font color="#E5E5E5">images it pulled so now if I go</font><font color="#CCCCCC"> back</font><font color="#E5E5E5"> to</font>

698
00:34:49,980 --> 00:34:55,740
the house<font color="#CCCCCC"> I'll see that I'm back to</font><font color="#E5E5E5"> the</font>

699
00:34:52,230 --> 00:35:00,119
first state<font color="#E5E5E5"> I have two images and I too</font>

700
00:34:55,739 --> 00:35:02,129
have<font color="#E5E5E5"> two containers so nothing is left</font>

701
00:35:00,119 --> 00:35:05,840
behind<font color="#CCCCCC"> and again we're going to use the</font>

702
00:35:02,130 --> 00:35:05,840
<font color="#E5E5E5">inspector to look at the</font><font color="#CCCCCC"> virtual machine</font>

703
00:35:06,950 --> 00:35:15,029
<font color="#E5E5E5">and we have the shadow file but I'll be</font>

704
00:35:11,970 --> 00:35:18,919
<font color="#CCCCCC">I'll neg and I'll prove that</font><font color="#E5E5E5"> it still</font>

705
00:35:15,030 --> 00:35:23,510
works<font color="#CCCCCC"> by resetting the</font><font color="#E5E5E5"> doctor daemon so</font>

706
00:35:18,920 --> 00:35:23,510
we'll know that<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> actually persistent</font>

707
00:35:26,369 --> 00:35:31,859
and again when<font color="#E5E5E5"> it's back</font><font color="#CCCCCC"> up we're going</font>

708
00:35:29,079 --> 00:35:33,940
<font color="#E5E5E5">to repeat the whole</font><font color="#CCCCCC"> thing</font><font color="#E5E5E5"> to prove</font>

709
00:35:31,859 --> 00:35:42,999
<font color="#E5E5E5">persistency and that nothing is left</font>

710
00:35:33,940 --> 00:35:45,160
<font color="#E5E5E5">behind</font><font color="#CCCCCC"> so the doctor diamond is up again</font>

711
00:35:42,999 --> 00:35:47,769
we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> use</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> specter look</font>

712
00:35:45,160 --> 00:35:49,749
inside<font color="#CCCCCC"> a virtual</font><font color="#E5E5E5"> machine</font><font color="#CCCCCC"> and we still</font>

713
00:35:47,769 --> 00:35:55,419
have the shadow<font color="#E5E5E5"> file so the attack</font>

714
00:35:49,749 --> 00:36:00,629
<font color="#CCCCCC">worked and finally</font><font color="#E5E5E5"> these</font><font color="#CCCCCC"> are again the</font>

715
00:35:55,420 --> 00:36:00,630
attack script and the<font color="#CCCCCC"> shutdown script</font>

716
00:36:03,299 --> 00:36:10,359
and finally just<font color="#E5E5E5"> to make sure there are</font>

717
00:36:07,900 --> 00:36:16,869
no<font color="#CCCCCC"> images left behind</font><font color="#E5E5E5"> in the containers</font>

718
00:36:10,359 --> 00:36:20,650
so again<font color="#E5E5E5"> two images</font><font color="#CCCCCC"> into containers so</font>

719
00:36:16,869 --> 00:36:26,650
what does it mean<font color="#CCCCCC"> what</font><font color="#E5E5E5"> we've actually</font>

720
00:36:20,650 --> 00:36:29,769
saw is a form of a<font color="#E5E5E5"> PT if we still use</font>

721
00:36:26,650 --> 00:36:32,589
<font color="#CCCCCC">that word</font><font color="#E5E5E5"> advanced persistent threat so</font>

722
00:36:29,769 --> 00:36:37,149
we have persistency with the shadow

723
00:36:32,589 --> 00:36:40,420
container we are concealed<font color="#CCCCCC"> inside the</font>

724
00:36:37,150 --> 00:36:44,160
<font color="#CCCCCC">virtual machine we</font><font color="#E5E5E5"> have a very low</font>

725
00:36:40,420 --> 00:36:48,130
forensic footprint and that is because

726
00:36:44,160 --> 00:36:50,259
the darker engine on the host<font color="#E5E5E5"> logs the</font>

727
00:36:48,130 --> 00:36:52,839
initial step of the attack<font color="#E5E5E5"> but</font>

728
00:36:50,259 --> 00:36:54,670
everything else<font color="#E5E5E5"> that we do is inside the</font>

729
00:36:52,839 --> 00:36:56,288
<font color="#CCCCCC">virtual machine</font><font color="#E5E5E5"> and you have full</font>

730
00:36:54,670 --> 00:36:59,190
control<font color="#CCCCCC"> the virtual machine you can</font>

731
00:36:56,289 --> 00:37:02,349
manipulate these logs or delete them and

732
00:36:59,190 --> 00:37:04,059
probably<font color="#E5E5E5"> nobody's actually pulling logs</font>

733
00:37:02,349 --> 00:37:07,299
from<font color="#CCCCCC"> the virtual machine</font><font color="#E5E5E5"> actually</font>

734
00:37:04,059 --> 00:37:09,729
looking at them and we have persistent

735
00:37:07,299 --> 00:37:12,279
access to the internal<font color="#E5E5E5"> enterprise</font>

736
00:37:09,729 --> 00:37:14,879
network from<font color="#E5E5E5"> that</font><font color="#CCCCCC"> virtual house because</font>

737
00:37:12,279 --> 00:37:18,549
<font color="#E5E5E5">it has</font><font color="#CCCCCC"> access to the network</font><font color="#E5E5E5"> and</font>

738
00:37:14,880 --> 00:37:22,960
possibly if the developer is running

739
00:37:18,549 --> 00:37:26,109
some writing micro services you can

740
00:37:22,960 --> 00:37:32,739
infect<font color="#CCCCCC"> the images that is writing and</font>

741
00:37:26,109 --> 00:37:35,710
you can infect<font color="#E5E5E5"> the</font><font color="#CCCCCC"> entire pipeline so</font>

742
00:37:32,739 --> 00:37:36,580
you may get the sense from<font color="#CCCCCC"> the attack</font>

743
00:37:35,710 --> 00:37:40,810
<font color="#CCCCCC">that</font>

744
00:37:36,580 --> 00:37:43,430
it only will it will<font color="#E5E5E5"> only work on</font><font color="#CCCCCC"> Ducker</font>

745
00:37:40,810 --> 00:37:46,850
running on<font color="#E5E5E5"> Windows 10 but</font><font color="#CCCCCC"> you can</font><font color="#E5E5E5"> change</font>

746
00:37:43,430 --> 00:37:50,750
the attack<font color="#E5E5E5"> depending</font><font color="#CCCCCC"> on your victim</font><font color="#E5E5E5"> so</font>

747
00:37:46,850 --> 00:37:52,700
if<font color="#CCCCCC"> it's</font><font color="#E5E5E5"> running Mac you can you don't</font>

748
00:37:50,750 --> 00:37:55,040
you<font color="#CCCCCC"> can't do host rebinding attack</font>

749
00:37:52,700 --> 00:37:57,799
because<font color="#CCCCCC"> meant don't use the Microsoft</font>

750
00:37:55,040 --> 00:37:59,480
protocols<font color="#CCCCCC"> but</font><font color="#E5E5E5"> you can still do DNS</font>

751
00:37:57,800 --> 00:38:01,190
rebinding attack and then move back<font color="#E5E5E5"> to</font>

752
00:37:59,480 --> 00:38:04,430
share the containers<font color="#CCCCCC"> to persist</font><font color="#E5E5E5"> on the</font>

753
00:38:01,190 --> 00:38:07,700
Mac<font color="#E5E5E5"> you can do a similar attack on Linux</font>

754
00:38:04,430 --> 00:38:10,370
<font color="#CCCCCC">and you can perform again the DNS</font>

755
00:38:07,700 --> 00:38:11,960
rebinding<font color="#CCCCCC"> and after you do so you can</font>

756
00:38:10,370 --> 00:38:14,359
run a<font color="#CCCCCC"> privilege container which give you</font>

757
00:38:11,960 --> 00:38:16,670
full access<font color="#E5E5E5"> to the</font><font color="#CCCCCC"> host</font><font color="#E5E5E5"> so you don't</font>

758
00:38:14,360 --> 00:38:18,080
<font color="#E5E5E5">really</font><font color="#CCCCCC"> have to use shadow containers</font><font color="#E5E5E5"> you</font>

759
00:38:16,670 --> 00:38:21,080
<font color="#E5E5E5">can choose to do so but you</font><font color="#CCCCCC"> can do</font>

760
00:38:18,080 --> 00:38:23,720
something else<font color="#E5E5E5"> and the same thing is</font>

761
00:38:21,080 --> 00:38:25,730
true for Windows containers<font color="#E5E5E5"> so when</font>

762
00:38:23,720 --> 00:38:27,500
you're running on<font color="#E5E5E5"> Windows containers</font><font color="#CCCCCC"> you</font>

763
00:38:25,730 --> 00:38:30,260
can<font color="#CCCCCC"> still go through the</font><font color="#E5E5E5"> abusing of the</font>

764
00:38:27,500 --> 00:38:31,820
<font color="#E5E5E5">API host rebinding attack and then when</font>

765
00:38:30,260 --> 00:38:33,500
you<font color="#E5E5E5"> run a privilege container you have</font>

766
00:38:31,820 --> 00:38:35,660
<font color="#E5E5E5">full</font><font color="#CCCCCC"> access</font><font color="#E5E5E5"> basically through the</font>

767
00:38:33,500 --> 00:38:37,850
<font color="#CCCCCC">windows host</font><font color="#E5E5E5"> so you can still run a</font>

768
00:38:35,660 --> 00:38:44,020
shallow container<font color="#E5E5E5"> but you can do</font>

769
00:38:37,850 --> 00:38:44,020
something else<font color="#E5E5E5"> so what should you do</font>

770
00:38:44,080 --> 00:38:51,590
<font color="#CCCCCC">don't expose your container API it's a</font>

771
00:38:48,500 --> 00:38:53,450
bad<font color="#CCCCCC"> idea</font><font color="#E5E5E5"> if you do have to expose it</font>

772
00:38:51,590 --> 00:38:57,620
make sure your clients are actually

773
00:38:53,450 --> 00:38:59,810
authenticated<font color="#E5E5E5"> and if you can't for</font>

774
00:38:57,620 --> 00:39:02,240
example<font color="#CCCCCC"> in some versions of docker it</font>

775
00:38:59,810 --> 00:39:06,920
doesn't work to enable authentication

776
00:39:02,240 --> 00:39:09,500
<font color="#E5E5E5">then</font><font color="#CCCCCC"> simply block it don't forget to</font>

777
00:39:06,920 --> 00:39:12,970
analyze your container engine logs they

778
00:39:09,500 --> 00:39:16,310
may can contain<font color="#E5E5E5"> some interesting</font>

779
00:39:12,970 --> 00:39:17,470
information like if<font color="#CCCCCC"> you're</font><font color="#E5E5E5"> being</font>

780
00:39:16,310 --> 00:39:21,320
attacked

781
00:39:17,470 --> 00:39:24,200
<font color="#CCCCCC">don't use NetBIOS or lmn</font><font color="#E5E5E5"> are if you</font>

782
00:39:21,320 --> 00:39:27,580
don't have to they're also very

783
00:39:24,200 --> 00:39:30,649
<font color="#E5E5E5">vulnerable to all</font><font color="#CCCCCC"> sorts of attack and</font>

784
00:39:27,580 --> 00:39:32,180
the bottom<font color="#E5E5E5"> line is you</font><font color="#CCCCCC"> don't know how</font>

785
00:39:30,650 --> 00:39:34,940
you're going<font color="#CCCCCC"> to be attacked so make sure</font>

786
00:39:32,180 --> 00:39:37,490
<font color="#E5E5E5">you always scan images on the registries</font>

787
00:39:34,940 --> 00:39:41,300
and always monitor your containers in

788
00:39:37,490 --> 00:39:44,750
<font color="#E5E5E5">runtime so these are our black hats</font>

789
00:39:41,300 --> 00:39:46,790
<font color="#CCCCCC">sound bites they asked everybody to</font>

790
00:39:44,750 --> 00:39:47,180
<font color="#E5E5E5">attend</font><font color="#CCCCCC"> black had to have a slide of some</font>

791
00:39:46,790 --> 00:39:48,450
<font color="#CCCCCC">BOTS</font>

792
00:39:47,180 --> 00:39:51,828
<font color="#E5E5E5">bytes</font>

793
00:39:48,450 --> 00:39:54,419
I'm the only one who did<font color="#CCCCCC"> it so</font>

794
00:39:51,829 --> 00:39:56,880
<font color="#CCCCCC">developers are the new targets</font><font color="#E5E5E5"> there are</font>

795
00:39:54,420 --> 00:39:58,200
two<font color="#E5E5E5"> new forms of attack like we said</font>

796
00:39:56,880 --> 00:40:00,599
before<font color="#E5E5E5"> the host</font><font color="#CCCCCC"> rebinding</font>

797
00:39:58,200 --> 00:40:03,270
and the shadow containers and please

798
00:40:00,599 --> 00:40:05,940
<font color="#E5E5E5">people protect your pipes always scan</font>

799
00:40:03,270 --> 00:40:09,390
images and monitors<font color="#CCCCCC"> the containers</font><font color="#E5E5E5"> in</font>

800
00:40:05,940 --> 00:40:13,230
runtime<font color="#CCCCCC"> will have a white paper</font><font color="#E5E5E5"> on our</font>

801
00:40:09,390 --> 00:40:16,770
<font color="#E5E5E5">website</font><font color="#CCCCCC"> probably also</font><font color="#E5E5E5"> on the blackhat</font>

802
00:40:13,230 --> 00:40:21,210
website and of course you can<font color="#CCCCCC"> hit</font><font color="#E5E5E5"> us up</font>

803
00:40:16,770 --> 00:40:24,570
<font color="#E5E5E5">on or me or whoever on Twitter or follow</font>

804
00:40:21,210 --> 00:40:27,280
us or follow up with<font color="#CCCCCC"> questions so thank</font>

805
00:40:24,570 --> 00:40:35,780
<font color="#E5E5E5">you</font><font color="#CCCCCC"> all for coming</font><font color="#E5E5E5"> and</font>

806
00:40:27,280 --> 00:40:35,780
[Applause]

