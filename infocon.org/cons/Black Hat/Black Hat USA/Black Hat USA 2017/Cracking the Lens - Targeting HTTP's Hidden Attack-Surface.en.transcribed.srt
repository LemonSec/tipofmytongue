1
00:00:00,000 --> 00:00:04,350
good afternoon again and welcome<font color="#CCCCCC"> to</font>

2
00:00:01,469 --> 00:00:07,470
<font color="#E5E5E5">cracking the lens exploiting</font><font color="#CCCCCC"> HTTP hidden</font>

3
00:00:04,350 --> 00:00:10,050
attack surface<font color="#E5E5E5"> have you ever seen a</font>

4
00:00:07,470 --> 00:00:12,599
tempting target<font color="#CCCCCC"> but had to ignore</font><font color="#E5E5E5"> it</font>

5
00:00:10,050 --> 00:00:16,350
<font color="#E5E5E5">because it's not quite within the scope</font>

6
00:00:12,599 --> 00:00:18,060
<font color="#E5E5E5">of your test</font><font color="#CCCCCC"> or maybe you saw something</font>

7
00:00:16,350 --> 00:00:20,010
that<font color="#CCCCCC"> is</font><font color="#E5E5E5"> within scope but it's just not</font>

8
00:00:18,060 --> 00:00:23,669
<font color="#CCCCCC">very interesting looking</font><font color="#E5E5E5"> and not worth</font>

9
00:00:20,010 --> 00:00:25,859
wasting<font color="#E5E5E5"> any time on load</font><font color="#CCCCCC"> balances and</font>

10
00:00:23,670 --> 00:00:28,470
analytic systems are everywhere<font color="#E5E5E5"> but</font>

11
00:00:25,859 --> 00:00:30,300
they're<font color="#CCCCCC"> just a bit</font><font color="#E5E5E5"> boring</font><font color="#CCCCCC"> they form a</font>

12
00:00:28,470 --> 00:00:32,729
lens in front<font color="#CCCCCC"> of website still we're</font>

13
00:00:30,300 --> 00:00:35,520
used to looking<font color="#CCCCCC"> through</font><font color="#E5E5E5"> rather than at</font>

14
00:00:32,729 --> 00:00:38,010
in this session<font color="#CCCCCC"> I'll share with you</font>

15
00:00:35,520 --> 00:00:40,230
<font color="#E5E5E5">proven techniques to hunt these systems</font>

16
00:00:38,010 --> 00:00:43,699
down<font color="#E5E5E5"> crack them open</font><font color="#CCCCCC"> and use them as</font>

17
00:00:40,230 --> 00:00:46,140
gateways into<font color="#E5E5E5"> our targets infrastructure</font>

18
00:00:43,700 --> 00:00:48,780
<font color="#E5E5E5">some of these techniques involve</font>

19
00:00:46,140 --> 00:00:51,329
requests so malformed<font color="#CCCCCC"> that they break</font>

20
00:00:48,780 --> 00:00:52,890
certain hacker tools and may exploit

21
00:00:51,329 --> 00:00:55,559
systems that you never<font color="#CCCCCC"> even realized</font>

22
00:00:52,890 --> 00:00:57,870
<font color="#CCCCCC">existed right</font><font color="#E5E5E5"> at the start</font><font color="#CCCCCC"> of this</font>

23
00:00:55,559 --> 00:00:59,820
research I wrote a simple payload<font color="#E5E5E5"> that</font>

24
00:00:57,870 --> 00:01:02,879
was designed<font color="#E5E5E5"> to make vulnerable systems</font>

25
00:00:59,820 --> 00:01:04,319
<font color="#E5E5E5">send a ping back back to my server</font><font color="#CCCCCC"> and I</font>

26
00:01:02,879 --> 00:01:05,908
send that<font color="#E5E5E5"> payload to a couple of</font>

27
00:01:04,319 --> 00:01:08,460
thousand sites and I got<font color="#E5E5E5"> quite a few</font>

28
00:01:05,909 --> 00:01:10,770
pingbacks<font color="#E5E5E5"> but there was something</font>

29
00:01:08,460 --> 00:01:12,899
slightly<font color="#E5E5E5"> strange about</font><font color="#CCCCCC"> a few of</font><font color="#E5E5E5"> them</font>

30
00:01:10,770 --> 00:01:16,199
I noticed the ping backs coming from

31
00:01:12,900 --> 00:01:18,479
cloud<font color="#E5E5E5"> mailed over and Inga</font><font color="#CCCCCC"> comm</font><font color="#E5E5E5"> were</font>

32
00:01:16,200 --> 00:01:19,590
coming from<font color="#E5E5E5"> the same ip address which</font>

33
00:01:18,479 --> 00:01:20,939
was<font color="#CCCCCC"> a bit weird</font><font color="#E5E5E5"> because you wouldn't</font>

34
00:01:19,590 --> 00:01:24,600
think that<font color="#E5E5E5"> they would be</font><font color="#CCCCCC"> on shared</font>

35
00:01:20,939 --> 00:01:27,089
hosting<font color="#E5E5E5"> and so I did a reverse DNS</font>

36
00:01:24,600 --> 00:01:29,270
lookup on this mysterious<font color="#CCCCCC"> IP address and</font>

37
00:01:27,090 --> 00:01:32,670
found<font color="#E5E5E5"> that it belonged to my own ISP</font>

38
00:01:29,270 --> 00:01:34,890
<font color="#E5E5E5">which is even stranger bear in mind that</font>

39
00:01:32,670 --> 00:01:38,159
this can't be<font color="#E5E5E5"> caused by some kind</font><font color="#CCCCCC"> of</font>

40
00:01:34,890 --> 00:01:40,200
caching solution<font color="#E5E5E5"> because they're clearly</font>

41
00:01:38,159 --> 00:01:43,259
doing dynamic<font color="#CCCCCC"> processing of my input</font><font color="#E5E5E5"> or</font>

42
00:01:40,200 --> 00:01:45,299
they would have<font color="#E5E5E5"> been exploited</font><font color="#CCCCCC"> and so I</font>

43
00:01:43,259 --> 00:01:47,280
took the<font color="#CCCCCC"> request that's in the payload</font>

44
00:01:45,299 --> 00:01:49,829
<font color="#E5E5E5">and I resent it a few times in the</font>

45
00:01:47,280 --> 00:01:52,320
repeater<font color="#CCCCCC"> and I noticed that the response</font>

46
00:01:49,829 --> 00:01:55,490
from<font color="#CCCCCC"> Cloud Mayor was</font><font color="#E5E5E5"> coming back</font><font color="#CCCCCC"> to me</font>

47
00:01:52,320 --> 00:01:58,110
<font color="#E5E5E5">in about 52 milliseconds which is</font>

48
00:01:55,490 --> 00:02:00,329
suspiciously fast for a request<font color="#E5E5E5"> that's</font>

49
00:01:58,110 --> 00:02:02,759
<font color="#CCCCCC">supposedly going for me in England</font><font color="#E5E5E5"> to</font>

50
00:02:00,329 --> 00:02:04,350
the<font color="#E5E5E5"> server in Russia and then all the</font>

51
00:02:02,759 --> 00:02:07,920
way<font color="#E5E5E5"> to the</font><font color="#CCCCCC"> ping back server in</font><font color="#E5E5E5"> Ireland</font>

52
00:02:04,350 --> 00:02:10,669
<font color="#E5E5E5">and then all the way back</font><font color="#CCCCCC"> again</font><font color="#E5E5E5"> and so I</font>

53
00:02:07,920 --> 00:02:13,740
<font color="#E5E5E5">decided to do a couple of</font><font color="#CCCCCC"> trace routes</font>

54
00:02:10,669 --> 00:02:15,839
the one on<font color="#CCCCCC"> the Left</font><font color="#E5E5E5"> simulates</font>

55
00:02:13,740 --> 00:02:19,700
<font color="#CCCCCC">a HTTP connection because it's a trace</font>

56
00:02:15,840 --> 00:02:22,170
<font color="#CCCCCC">route to port 80</font><font color="#E5E5E5"> and as you can see this</font>

57
00:02:19,700 --> 00:02:23,609
<font color="#E5E5E5">connection is never getting on to the</font>

58
00:02:22,170 --> 00:02:28,100
actual<font color="#CCCCCC"> Internet it's being terminated</font>

59
00:02:23,610 --> 00:02:30,180
<font color="#E5E5E5">inside my ISP whereas the HTTP</font>

60
00:02:28,100 --> 00:02:33,540
connection goes all the way<font color="#E5E5E5"> to where the</font>

61
00:02:30,180 --> 00:02:36,480
server<font color="#E5E5E5"> is actually</font><font color="#CCCCCC"> located in Russia</font><font color="#E5E5E5"> you</font>

62
00:02:33,540 --> 00:02:38,940
<font color="#E5E5E5">can see that on the right and that is</font>

63
00:02:36,480 --> 00:02:40,709
<font color="#E5E5E5">even more suspicious because it suggests</font>

64
00:02:38,940 --> 00:02:43,530
that<font color="#E5E5E5"> the</font><font color="#CCCCCC"> person who's doing</font><font color="#E5E5E5"> the</font>

65
00:02:40,710 --> 00:02:45,090
interception<font color="#CCCCCC"> doesn't have their</font><font color="#E5E5E5"> HTTP</font>

66
00:02:43,530 --> 00:02:47,370
secret keys that would enable them<font color="#E5E5E5"> to</font>

67
00:02:45,090 --> 00:02:49,610
<font color="#E5E5E5">actually intercept HTTPS safely and</font>

68
00:02:47,370 --> 00:02:52,680
without<font color="#E5E5E5"> notifying</font><font color="#CCCCCC"> the user</font><font color="#E5E5E5"> so it means</font>

69
00:02:49,610 --> 00:02:54,540
this interception<font color="#E5E5E5"> is going on probably</font>

70
00:02:52,680 --> 00:02:59,070
without<font color="#E5E5E5"> the permission or knowledge of</font>

71
00:02:54,540 --> 00:03:02,429
<font color="#CCCCCC">cloud mail government and also I found</font>

72
00:02:59,070 --> 00:03:05,519
<font color="#E5E5E5">that</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> was affecting not only me at</font>

73
00:03:02,430 --> 00:03:07,380
work<font color="#E5E5E5"> but also on my home connection so</font>

74
00:03:05,520 --> 00:03:10,410
this was affecting all consumer and

75
00:03:07,380 --> 00:03:12,329
commercial users of BT Broadband BT

76
00:03:10,410 --> 00:03:15,600
Broadband being the largest ISP in

77
00:03:12,330 --> 00:03:17,250
England by quite a long way and I

78
00:03:15,600 --> 00:03:18,720
<font color="#E5E5E5">investigated this further and I found</font>

79
00:03:17,250 --> 00:03:21,630
out what<font color="#E5E5E5"> the purpose</font><font color="#CCCCCC"> of this system</font><font color="#E5E5E5"> was</font>

80
00:03:18,720 --> 00:03:24,300
and I found<font color="#E5E5E5"> out that I could potentially</font>

81
00:03:21,630 --> 00:03:26,519
you hijack the system using the

82
00:03:24,300 --> 00:03:28,350
vulnerability in it and make<font color="#CCCCCC"> alterations</font>

83
00:03:26,520 --> 00:03:30,960
to the traffic of millions of<font color="#CCCCCC"> BT users</font>

84
00:03:28,350 --> 00:03:32,790
which would be kind of cool but that's

85
00:03:30,960 --> 00:03:35,790
just a<font color="#CCCCCC"> distraction from the question</font>

86
00:03:32,790 --> 00:03:39,329
that we<font color="#CCCCCC"> should be asking</font><font color="#E5E5E5"> which</font><font color="#CCCCCC"> is given</font>

87
00:03:35,790 --> 00:03:41,280
that for many<font color="#E5E5E5"> years</font><font color="#CCCCCC"> I and many</font><font color="#E5E5E5"> are the</font>

88
00:03:39,330 --> 00:03:43,920
<font color="#E5E5E5">British pen testers have been doing the</font>

89
00:03:41,280 --> 00:03:47,130
security<font color="#CCCCCC"> audits through an exploitable</font>

90
00:03:43,920 --> 00:03:50,970
proxy<font color="#CCCCCC"> system without ever realizing it</font>

91
00:03:47,130 --> 00:03:53,700
what else<font color="#E5E5E5"> have we missed there was one</font>

92
00:03:50,970 --> 00:03:56,700
<font color="#CCCCCC">other suspicious</font><font color="#E5E5E5"> thing about</font><font color="#CCCCCC"> this server</font>

93
00:03:53,700 --> 00:03:58,619
which was that that was a reverse<font color="#E5E5E5"> DNS</font>

94
00:03:56,700 --> 00:04:01,230
was<font color="#CCCCCC"> hoped to predator door alias not BT</font>

95
00:03:58,620 --> 00:04:02,940
dog coat UK which doesn't exactly

96
00:04:01,230 --> 00:04:08,070
<font color="#E5E5E5">suggest this</font><font color="#CCCCCC"> is a friendly</font><font color="#E5E5E5"> kind of</font>

97
00:04:02,940 --> 00:04:10,470
system so first I'll talk<font color="#CCCCCC"> about how</font><font color="#E5E5E5"> to</font>

98
00:04:08,070 --> 00:04:13,200
build<font color="#E5E5E5"> a speculative attack pipeline</font><font color="#CCCCCC"> then</font>

99
00:04:10,470 --> 00:04:15,690
<font color="#CCCCCC">lets</font><font color="#E5E5E5"> us efficiently hunt these systems</font>

100
00:04:13,200 --> 00:04:18,450
down and initiate a conversation with

101
00:04:15,690 --> 00:04:20,190
them after that I'll describe two key

102
00:04:18,450 --> 00:04:22,320
<font color="#E5E5E5">types of attacks one focused on</font>

103
00:04:20,190 --> 00:04:24,120
targeting<font color="#E5E5E5"> front-end systems like reverse</font>

104
00:04:22,320 --> 00:04:26,729
proxies by making the<font color="#CCCCCC"> Miss route</font>

105
00:04:24,120 --> 00:04:27,500
requests and one focused on targeting

106
00:04:26,729 --> 00:04:29,690
back in the system

107
00:04:27,500 --> 00:04:31,820
like analytic systems where we<font color="#CCCCCC"> have to</font>

108
00:04:29,690 --> 00:04:34,460
be a bit more<font color="#E5E5E5"> inventive to actually get</font>

109
00:04:31,820 --> 00:04:36,080
to a<font color="#E5E5E5"> useful exploit after that I'll do a</font>

110
00:04:34,460 --> 00:04:38,960
brief<font color="#E5E5E5"> demo</font><font color="#CCCCCC"> of one of the tools</font><font color="#E5E5E5"> I'll be</font>

111
00:04:36,080 --> 00:04:43,760
<font color="#E5E5E5">releasing and then wrap up and take five</font>

112
00:04:38,960 --> 00:04:46,039
minutes<font color="#E5E5E5"> of questions the systems that</font>

113
00:04:43,760 --> 00:04:49,370
we'll be targeting<font color="#CCCCCC"> are designed to</font>

114
00:04:46,040 --> 00:04:51,290
<font color="#E5E5E5">remain invisible and as such the process</font>

115
00:04:49,370 --> 00:04:53,360
of finding and interacting<font color="#CCCCCC"> with them is</font>

116
00:04:51,290 --> 00:04:56,240
really<font color="#CCCCCC"> important otherwise you just</font>

117
00:04:53,360 --> 00:04:57,470
<font color="#E5E5E5">won't</font><font color="#CCCCCC"> for even finding systems for the</font>

118
00:04:56,240 --> 00:04:59,150
purpose<font color="#E5E5E5"> of this research</font>

119
00:04:57,470 --> 00:05:02,419
I sent payloads designed to make

120
00:04:59,150 --> 00:05:06,169
vulnerable servers send a DNS or HTTP

121
00:05:02,419 --> 00:05:08,270
query<font color="#E5E5E5"> back to my server this approach</font><font color="#CCCCCC"> to</font>

122
00:05:06,169 --> 00:05:10,669
finding vulnerabilities<font color="#CCCCCC"> has been so</font>

123
00:05:08,270 --> 00:05:13,190
<font color="#CCCCCC">effective in recent years</font><font color="#E5E5E5"> that my boss</font>

124
00:05:10,669 --> 00:05:15,200
recently coined<font color="#CCCCCC"> an acronym for it</font><font color="#E5E5E5"> to try</font>

125
00:05:13,190 --> 00:05:17,480
getting more attention<font color="#CCCCCC"> to it so</font><font color="#E5E5E5"> we call</font>

126
00:05:15,200 --> 00:05:19,520
<font color="#E5E5E5">it</font><font color="#CCCCCC"> Oh asked out-of-band application</font>

127
00:05:17,480 --> 00:05:21,169
security testing<font color="#CCCCCC"> and if I use that</font>

128
00:05:19,520 --> 00:05:23,479
acronym<font color="#CCCCCC"> now you know what I mean</font><font color="#E5E5E5"> it's</font>

129
00:05:21,169 --> 00:05:25,490
<font color="#CCCCCC">just trying</font><font color="#E5E5E5"> to find a vulnerability</font><font color="#CCCCCC"> by</font>

130
00:05:23,480 --> 00:05:29,390
sending a payload that<font color="#E5E5E5"> will cause a ping</font>

131
00:05:25,490 --> 00:05:31,520
back at the start of<font color="#E5E5E5"> this research I had</font>

132
00:05:29,390 --> 00:05:34,010
absolutely<font color="#E5E5E5"> no idea if anything was</font>

133
00:05:31,520 --> 00:05:36,109
actually going<font color="#E5E5E5"> to work</font><font color="#CCCCCC"> and as such I</font>

134
00:05:34,010 --> 00:05:38,780
injected payloads<font color="#E5E5E5"> in the laziest way</font>

135
00:05:36,110 --> 00:05:40,790
possible<font color="#CCCCCC"> I simply made a burp</font><font color="#E5E5E5"> match</font>

136
00:05:38,780 --> 00:05:42,469
<font color="#E5E5E5">interface rule that put a hard-coded</font>

137
00:05:40,790 --> 00:05:44,540
payload in every request<font color="#E5E5E5"> that got</font>

138
00:05:42,470 --> 00:05:48,020
proxied through<font color="#E5E5E5"> book and then just</font>

139
00:05:44,540 --> 00:05:50,210
browsed some<font color="#E5E5E5"> websites and that found</font>

140
00:05:48,020 --> 00:05:51,590
<font color="#CCCCCC">quite a few interesting</font><font color="#E5E5E5"> bits of behavior</font>

141
00:05:50,210 --> 00:05:54,440
but it didn't get me much useful

142
00:05:51,590 --> 00:05:56,630
<font color="#CCCCCC">information because</font><font color="#E5E5E5"> it didn't correlate</font>

143
00:05:54,440 --> 00:05:59,719
the paint back that my server received

144
00:05:56,630 --> 00:06:01,340
with the<font color="#E5E5E5"> payload or</font><font color="#CCCCCC"> the request that</font>

145
00:05:59,720 --> 00:06:03,020
caused the ping<font color="#E5E5E5"> back so in many</font><font color="#CCCCCC"> cases I</font>

146
00:06:01,340 --> 00:06:05,390
couldn't even<font color="#E5E5E5"> tell which website a ping</font>

147
00:06:03,020 --> 00:06:06,859
back was coming from<font color="#E5E5E5"> I thought</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> could</font>

148
00:06:05,390 --> 00:06:08,240
correlate it by<font color="#CCCCCC"> looking</font><font color="#E5E5E5"> at the time the</font>

149
00:06:06,860 --> 00:06:10,250
request<font color="#E5E5E5"> was</font><font color="#CCCCCC"> sent and the time the ping</font>

150
00:06:08,240 --> 00:06:13,460
back happened but that<font color="#E5E5E5"> doesn't actually</font>

151
00:06:10,250 --> 00:06:15,530
work<font color="#E5E5E5"> in many cases for</font><font color="#CCCCCC"> example what</font>

152
00:06:13,460 --> 00:06:17,239
we've<font color="#E5E5E5"> got here</font><font color="#CCCCCC"> is a server that</font><font color="#E5E5E5"> for some</font>

153
00:06:15,530 --> 00:06:21,289
mysterious<font color="#E5E5E5"> reason it's decided to ping</font>

154
00:06:17,240 --> 00:06:23,750
<font color="#E5E5E5">me once every 24 hours and it just kept</font>

155
00:06:21,290 --> 00:06:25,340
doing that for days<font color="#E5E5E5"> and I was never able</font>

156
00:06:23,750 --> 00:06:27,260
to<font color="#E5E5E5"> find out what caused that behavior</font>

157
00:06:25,340 --> 00:06:30,500
<font color="#E5E5E5">what's</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> then that</font><font color="#CCCCCC"> was will actually</font>

158
00:06:27,260 --> 00:06:30,919
get anywhere useful with that<font color="#E5E5E5"> so to fix</font>

159
00:06:30,500 --> 00:06:32,600
<font color="#E5E5E5">this issue</font>

160
00:06:30,919 --> 00:06:35,000
I won't collaborate everywhere<font color="#E5E5E5"> which is</font>

161
00:06:32,600 --> 00:06:38,390
<font color="#E5E5E5">an open source burp suite extension</font>

162
00:06:35,000 --> 00:06:40,550
which injects<font color="#E5E5E5"> a number of unique being</font>

163
00:06:38,390 --> 00:06:41,800
back payloads<font color="#E5E5E5"> into every request being</font>

164
00:06:40,550 --> 00:06:44,050
proxied<font color="#CCCCCC"> through</font>

165
00:06:41,800 --> 00:06:46,510
and it uses those to automatically

166
00:06:44,050 --> 00:06:49,150
correlate the<font color="#CCCCCC"> requests with</font><font color="#E5E5E5"> the response</font>

167
00:06:46,510 --> 00:06:51,700
<font color="#CCCCCC">Oh with</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> pingback</font><font color="#E5E5E5"> so even if you get</font>

168
00:06:49,150 --> 00:06:53,320
<font color="#E5E5E5">a ping back</font><font color="#CCCCCC"> 12 hours after you send the</font>

169
00:06:51,700 --> 00:06:55,420
payload it will still<font color="#E5E5E5"> be able to link</font>

170
00:06:53,320 --> 00:06:58,960
<font color="#E5E5E5">those together for</font><font color="#CCCCCC"> you and give you some</font>

171
00:06:55,420 --> 00:07:01,300
information<font color="#E5E5E5"> that's actually useful now</font>

172
00:06:58,960 --> 00:07:02,859
that to work<font color="#E5E5E5"> pretty well it found about</font>

173
00:07:01,300 --> 00:07:05,350
<font color="#CCCCCC">half the vulnerabilities that I'm going</font>

174
00:07:02,860 --> 00:07:07,450
<font color="#E5E5E5">to show you in this presentation but I</font>

175
00:07:05,350 --> 00:07:09,850
noticed on<font color="#E5E5E5"> one site it was only finding</font>

176
00:07:07,450 --> 00:07:13,180
an issue intermittently<font color="#E5E5E5"> and that was</font>

177
00:07:09,850 --> 00:07:16,060
<font color="#E5E5E5">because they were using a round robin</font>

178
00:07:13,180 --> 00:07:18,550
<font color="#CCCCCC">DNS to point me to one of</font><font color="#E5E5E5"> their five</font>

179
00:07:16,060 --> 00:07:21,610
front-end load balances and only one<font color="#E5E5E5"> of</font>

180
00:07:18,550 --> 00:07:23,470
their load balances was vulnerable<font color="#E5E5E5"> so</font>

181
00:07:21,610 --> 00:07:24,910
when you're targeting<font color="#CCCCCC"> front-end systems</font>

182
00:07:23,470 --> 00:07:26,440
you need<font color="#CCCCCC"> to bear in mind that you need</font>

183
00:07:24,910 --> 00:07:29,470
<font color="#E5E5E5">to hit all of the systems rather than</font>

184
00:07:26,440 --> 00:07:31,719
just an<font color="#E5E5E5"> arbitrary one and to do that I</font>

185
00:07:29,470 --> 00:07:34,000
<font color="#CCCCCC">switched</font><font color="#E5E5E5"> using</font><font color="#CCCCCC"> masscan and then</font>

186
00:07:31,720 --> 00:07:36,040
eventually switched<font color="#CCCCCC"> using Z grab which</font>

187
00:07:34,000 --> 00:07:37,990
is basically<font color="#CCCCCC"> masscan but with more</font>

188
00:07:36,040 --> 00:07:41,980
<font color="#E5E5E5">useful features</font><font color="#CCCCCC"> for sending attacks the</font>

189
00:07:37,990 --> 00:07:44,070
<font color="#CCCCCC">websites so if you want</font><font color="#E5E5E5"> to do a focused</font>

190
00:07:41,980 --> 00:07:46,120
manual<font color="#E5E5E5"> audit on a specific site</font>

191
00:07:44,070 --> 00:07:48,390
collaborate<font color="#CCCCCC"> Everywhere is the best tool</font>

192
00:07:46,120 --> 00:07:50,500
for the job<font color="#E5E5E5"> but if you want to send</font>

193
00:07:48,390 --> 00:07:52,900
payloads<font color="#CCCCCC"> to thousands of different web</font>

194
00:07:50,500 --> 00:07:55,060
<font color="#CCCCCC">sites</font><font color="#E5E5E5"> and spray them over someone's</font>

195
00:07:52,900 --> 00:08:01,929
entire infrastructure<font color="#CCCCCC"> Zed grabbed is the</font>

196
00:07:55,060 --> 00:08:04,480
way to go so who did<font color="#CCCCCC"> I target well I</font>

197
00:08:01,930 --> 00:08:07,510
targeted everyone that I could legally

198
00:08:04,480 --> 00:08:09,400
target<font color="#E5E5E5"> which means every site that has a</font>

199
00:08:07,510 --> 00:08:12,550
bug bounty<font color="#E5E5E5"> program that doesn't forbid</font>

200
00:08:09,400 --> 00:08:14,679
automated testing<font color="#E5E5E5"> and to identify them I</font>

201
00:08:12,550 --> 00:08:17,410
manually reviewed every single<font color="#E5E5E5"> program</font>

202
00:08:14,680 --> 00:08:20,560
on<font color="#CCCCCC"> hacker one and bug route which was</font>

203
00:08:17,410 --> 00:08:22,480
<font color="#E5E5E5">quite boring but at</font><font color="#CCCCCC"> the end of that</font><font color="#E5E5E5"> I</font>

204
00:08:20,560 --> 00:08:24,970
<font color="#E5E5E5">had a spreadsheet from which I could</font>

205
00:08:22,480 --> 00:08:27,070
<font color="#E5E5E5">generate a regular expression</font><font color="#CCCCCC"> that would</font>

206
00:08:24,970 --> 00:08:28,960
match any<font color="#E5E5E5"> domain name</font><font color="#CCCCCC"> that was within</font>

207
00:08:27,070 --> 00:08:29,919
<font color="#E5E5E5">the scope</font><font color="#CCCCCC"> of any bounty</font><font color="#E5E5E5"> program that I</font>

208
00:08:28,960 --> 00:08:34,299
could legally test

209
00:08:29,919 --> 00:08:34,750
<font color="#CCCCCC">I then combined that regex with rapid</font>

210
00:08:34,299 --> 00:08:37,510
<font color="#CCCCCC">evans</font>

211
00:08:34,750 --> 00:08:40,990
project sonar database of all known host

212
00:08:37,510 --> 00:08:42,849
names<font color="#E5E5E5"> and by combining</font><font color="#CCCCCC"> those two I had a</font>

213
00:08:40,990 --> 00:08:44,229
short list of<font color="#E5E5E5"> three million hosts that I</font>

214
00:08:42,849 --> 00:08:46,300
could send payloads to<font color="#E5E5E5"> they were all</font>

215
00:08:44,229 --> 00:08:47,950
<font color="#CCCCCC">within</font><font color="#E5E5E5"> scope of bug bounties and I</font>

216
00:08:46,300 --> 00:08:50,800
hadn't<font color="#CCCCCC"> actually had to send any requests</font>

217
00:08:47,950 --> 00:08:54,320
or<font color="#E5E5E5"> do any DNS lookups myself that was</font>

218
00:08:50,800 --> 00:08:58,040
over<font color="#E5E5E5"> to about</font><font color="#CCCCCC"> 50,000</font><font color="#E5E5E5"> active web servers</font>

219
00:08:54,320 --> 00:09:00,889
I initially populated this list of

220
00:08:58,040 --> 00:09:03,079
targets also<font color="#E5E5E5"> using reverse DNS lookups</font>

221
00:09:00,889 --> 00:09:06,949
<font color="#CCCCCC">but I only do a little bit</font><font color="#E5E5E5"> of a problem</font>

222
00:09:03,079 --> 00:09:09,888
<font color="#E5E5E5">with</font><font color="#CCCCCC"> that the problem is the google has</font>

223
00:09:06,949 --> 00:09:11,870
got a bug bounty<font color="#E5E5E5"> program and some</font>

224
00:09:09,889 --> 00:09:14,839
websites<font color="#E5E5E5"> for whatever reason that like</font>

225
00:09:11,870 --> 00:09:17,750
to spoof<font color="#E5E5E5"> Google's reverse DNS they like</font>

226
00:09:14,839 --> 00:09:19,399
to<font color="#E5E5E5"> pretend to be</font><font color="#CCCCCC"> Google I'm not entirely</font>

227
00:09:17,750 --> 00:09:22,279
<font color="#E5E5E5">sure why they do this</font><font color="#CCCCCC"> but the result</font><font color="#E5E5E5"> is</font>

228
00:09:19,399 --> 00:09:24,380
<font color="#CCCCCC">that if you</font><font color="#E5E5E5"> use if you trust reverse DNS</font>

229
00:09:22,279 --> 00:09:25,819
you end up<font color="#E5E5E5"> sending payloads</font><font color="#CCCCCC"> to people</font>

230
00:09:24,380 --> 00:09:27,649
who are<font color="#CCCCCC"> probably not expecting you to</font>

231
00:09:25,819 --> 00:09:30,680
send payloads to<font color="#E5E5E5"> them and might not</font><font color="#CCCCCC"> be</font>

232
00:09:27,649 --> 00:09:33,019
too<font color="#E5E5E5"> happy about it now you could argue</font>

233
00:09:30,680 --> 00:09:35,540
<font color="#E5E5E5">that they're asking for</font><font color="#CCCCCC"> it but in</font><font color="#E5E5E5"> making</font>

234
00:09:33,019 --> 00:09:39,139
that reverse DNS setup but I wouldn't

235
00:09:35,540 --> 00:09:40,699
<font color="#E5E5E5">recommend that overall now if you're</font>

236
00:09:39,139 --> 00:09:42,860
<font color="#CCCCCC">gonna</font><font color="#E5E5E5"> send in requests to 50,000 web</font>

237
00:09:40,699 --> 00:09:44,599
servers<font color="#E5E5E5"> you might as well make sure</font><font color="#CCCCCC"> that</font>

238
00:09:42,860 --> 00:09:47,240
it's optimized to hit as much attack

239
00:09:44,600 --> 00:09:49,579
surface as possible<font color="#E5E5E5"> one way to do that</font>

240
00:09:47,240 --> 00:09:50,959
is<font color="#CCCCCC"> using the mode transform directive</font>

241
00:09:49,579 --> 00:09:53,930
for the cache control header which

242
00:09:50,959 --> 00:09:55,969
instructs systems<font color="#E5E5E5"> like reverse proxies</font>

243
00:09:53,930 --> 00:09:58,250
not to rewrite the<font color="#CCCCCC"> request in any way</font>

244
00:09:55,970 --> 00:09:59,569
that before passing it<font color="#E5E5E5"> along because</font>

245
00:09:58,250 --> 00:10:03,110
that might break the payload<font color="#CCCCCC"> that you're</font>

246
00:09:59,569 --> 00:10:04,939
sending also you could try resending

247
00:10:03,110 --> 00:10:07,069
your payloads but using<font color="#CCCCCC"> their exported</font>

248
00:10:04,940 --> 00:10:08,720
proto header to pretend though you're

249
00:10:07,069 --> 00:10:11,540
<font color="#E5E5E5">using a protocol other than the one that</font>

250
00:10:08,720 --> 00:10:14,060
you're<font color="#CCCCCC"> really</font><font color="#E5E5E5"> using now which</font><font color="#CCCCCC"> can also</font>

251
00:10:11,540 --> 00:10:15,860
just cause unexpected scenarios and let

252
00:10:14,060 --> 00:10:21,399
you hit code paths that most people

253
00:10:15,860 --> 00:10:24,470
never touch the end result<font color="#CCCCCC"> of the</font><font color="#E5E5E5"> setup</font>

254
00:10:21,399 --> 00:10:26,120
<font color="#E5E5E5">was that during this research whenever I</font>

255
00:10:24,470 --> 00:10:28,190
had an<font color="#CCCCCC"> idea for a new type of technique</font>

256
00:10:26,120 --> 00:10:31,459
<font color="#CCCCCC">I could spend a</font><font color="#E5E5E5"> couple of minutes</font>

257
00:10:28,190 --> 00:10:33,649
<font color="#CCCCCC">writing</font><font color="#E5E5E5"> HTTP requests manually with that</font>

258
00:10:31,459 --> 00:10:35,329
payload in it<font color="#E5E5E5"> and then user</font><font color="#CCCCCC"> draft us in</font>

259
00:10:33,649 --> 00:10:36,709
that<font color="#CCCCCC"> 250-thousand web servers</font><font color="#E5E5E5"> in the</font>

260
00:10:35,329 --> 00:10:40,550
space<font color="#CCCCCC"> of about</font><font color="#E5E5E5"> five minutes and just</font>

261
00:10:36,709 --> 00:10:42,319
<font color="#CCCCCC">collect the results</font><font color="#E5E5E5"> that capability to</font>

262
00:10:40,550 --> 00:10:45,410
<font color="#E5E5E5">quickly try out ideas and</font><font color="#CCCCCC"> then</font>

263
00:10:42,319 --> 00:10:47,269
iteratively improve them<font color="#E5E5E5"> is a large part</font>

264
00:10:45,410 --> 00:10:52,029
<font color="#E5E5E5">of the reason why this research was so</font>

265
00:10:47,269 --> 00:10:55,579
successful<font color="#E5E5E5"> okay that's enough about the</font>

266
00:10:52,029 --> 00:10:56,660
<font color="#E5E5E5">tooling and now for some exploits so</font>

267
00:10:55,579 --> 00:10:58,160
first of all we're going to<font color="#E5E5E5"> target</font>

268
00:10:56,660 --> 00:10:59,959
<font color="#E5E5E5">things that sit in front of the</font>

269
00:10:58,160 --> 00:11:01,939
application<font color="#E5E5E5"> how we're going</font><font color="#CCCCCC"> to try</font><font color="#E5E5E5"> and</font>

270
00:10:59,959 --> 00:11:03,660
trick<font color="#E5E5E5"> them into routing requests to</font>

271
00:11:01,939 --> 00:11:05,760
internal services<font color="#CCCCCC"> this</font>

272
00:11:03,660 --> 00:11:07,500
services<font color="#CCCCCC"> that are meant to</font><font color="#E5E5E5"> be private</font><font color="#CCCCCC"> so</font>

273
00:11:05,760 --> 00:11:10,860
this is a type of<font color="#CCCCCC"> server-side</font><font color="#E5E5E5"> request</font>

274
00:11:07,500 --> 00:11:12,900
forgery but it's a lot<font color="#E5E5E5"> more</font><font color="#CCCCCC"> powerful</font>

275
00:11:10,860 --> 00:11:16,350
<font color="#CCCCCC">than your rock than your run-of-the-mill</font>

276
00:11:12,900 --> 00:11:18,600
<font color="#CCCCCC">SSR F that's because we've got generally</font>

277
00:11:16,350 --> 00:11:20,250
here got a huge<font color="#CCCCCC"> amount of control</font><font color="#E5E5E5"> over</font>

278
00:11:18,600 --> 00:11:22,890
the<font color="#E5E5E5"> requests that we're sending to the</font>

279
00:11:20,250 --> 00:11:24,960
internal service which makes it much

280
00:11:22,890 --> 00:11:29,610
<font color="#CCCCCC">easier to</font><font color="#E5E5E5"> exploit internal services as</font>

281
00:11:24,960 --> 00:11:31,440
we'll see shortly the simplest way<font color="#E5E5E5"> to</font>

282
00:11:29,610 --> 00:11:33,390
<font color="#CCCCCC">make your request</font><font color="#E5E5E5"> get miss routed is</font>

283
00:11:31,440 --> 00:11:35,040
simply to<font color="#CCCCCC"> change the host header</font><font color="#E5E5E5"> to</font>

284
00:11:33,390 --> 00:11:37,319
where you want the request to<font color="#E5E5E5"> get routed</font>

285
00:11:35,040 --> 00:11:41,130
to this approach<font color="#E5E5E5"> works on an amazing</font>

286
00:11:37,320 --> 00:11:43,910
<font color="#E5E5E5">number</font><font color="#CCCCCC"> of sites</font><font color="#E5E5E5"> now this technique is</font>

287
00:11:41,130 --> 00:11:48,390
publicly<font color="#CCCCCC"> known in some locations but</font>

288
00:11:43,910 --> 00:11:51,030
it's hugely underappreciated<font color="#CCCCCC"> I can say</font>

289
00:11:48,390 --> 00:11:53,160
that with confidence<font color="#E5E5E5"> because using my</font>

290
00:11:51,030 --> 00:11:56,250
pipeline<font color="#CCCCCC"> I just mentioned</font><font color="#E5E5E5"> in the space</font>

291
00:11:53,160 --> 00:11:57,660
<font color="#CCCCCC">of five minutes I was</font><font color="#E5E5E5"> able to exploit 27</font>

292
00:11:56,250 --> 00:12:01,680
different Department of Defense servers

293
00:11:57,660 --> 00:12:06,780
a couple of<font color="#E5E5E5"> Yahoo load balances my only</font>

294
00:12:01,680 --> 00:12:09,060
ISP by accident<font color="#E5E5E5"> and also a Colombian</font><font color="#CCCCCC"> RSP</font>

295
00:12:06,780 --> 00:12:10,709
that<font color="#E5E5E5"> threw itself into the firing line</font>

296
00:12:09,060 --> 00:12:16,349
by doing DNS poisoning on one of my

297
00:12:10,710 --> 00:12:18,930
targets so let's take a<font color="#E5E5E5"> look at what the</font>

298
00:12:16,350 --> 00:12:21,840
<font color="#CCCCCC">impact of this very simple</font><font color="#E5E5E5"> mishap can be</font>

299
00:12:18,930 --> 00:12:24,180
here<font color="#E5E5E5"> I'm sending</font><font color="#CCCCCC"> a request</font><font color="#E5E5E5"> to one of</font>

300
00:12:21,840 --> 00:12:26,190
Yahoo's load balancers and I'm using the

301
00:12:24,180 --> 00:12:30,780
host header<font color="#E5E5E5"> to trick them into routing</font>

302
00:12:26,190 --> 00:12:32,790
it to port 8080 to on on a nearby IP<font color="#E5E5E5"> so</font>

303
00:12:30,780 --> 00:12:34,170
<font color="#E5E5E5">the service I'm accessing that you can</font>

304
00:12:32,790 --> 00:12:37,650
see in<font color="#CCCCCC"> the response is not</font><font color="#E5E5E5"> publicly</font>

305
00:12:34,170 --> 00:12:39,839
accessible now judging by the repeated

306
00:12:37,650 --> 00:12:42,329
<font color="#E5E5E5">are unknown command lines</font><font color="#CCCCCC"> in the</font>

307
00:12:39,840 --> 00:12:45,270
response this service is not talking

308
00:12:42,330 --> 00:12:47,700
<font color="#E5E5E5">HTTP it's using some kind of line based</font>

309
00:12:45,270 --> 00:12:50,569
protocol<font color="#E5E5E5"> and is therefore interpreting</font>

310
00:12:47,700 --> 00:12:53,730
every HTTP header<font color="#E5E5E5"> as a separate command</font>

311
00:12:50,570 --> 00:12:57,150
other than that<font color="#E5E5E5"> I had no real idea what</font>

312
00:12:53,730 --> 00:13:00,780
the system was but I had an idea<font color="#E5E5E5"> to find</font>

313
00:12:57,150 --> 00:13:04,260
out I changed the HTTP<font color="#CCCCCC"> method from get</font>

314
00:13:00,780 --> 00:13:07,410
to help<font color="#E5E5E5"> how amazingly that actually</font>

315
00:13:04,260 --> 00:13:10,050
worked<font color="#E5E5E5"> so the service was like hi</font><font color="#CCCCCC"> i'm</font>

316
00:13:07,410 --> 00:13:12,360
<font color="#CCCCCC">i'm</font><font color="#E5E5E5"> an</font><font color="#CCCCCC"> apache traffic overseer</font><font color="#E5E5E5"> which</font>

317
00:13:10,050 --> 00:13:15,089
means<font color="#E5E5E5"> i'm responsible for distributing</font>

318
00:13:12,360 --> 00:13:17,190
<font color="#E5E5E5">the configuration of probably a large</font>

319
00:13:15,090 --> 00:13:19,980
number of Yahoo's<font color="#E5E5E5"> front-end load balance</font>

320
00:13:17,190 --> 00:13:24,389
and also<font color="#E5E5E5"> here's how you can change</font>

321
00:13:19,980 --> 00:13:26,160
configuration settings on me now know

322
00:13:24,389 --> 00:13:28,440
that if this was<font color="#CCCCCC"> no more</font><font color="#E5E5E5"> server side</font>

323
00:13:26,160 --> 00:13:32,279
request forgery it would be impossible

324
00:13:28,440 --> 00:13:34,620
to exploit<font color="#E5E5E5"> this service because to get</font>

325
00:13:32,279 --> 00:13:36,839
<font color="#CCCCCC">in second man's we</font><font color="#E5E5E5"> need to send requests</font>

326
00:13:34,620 --> 00:13:38,459
to<font color="#CCCCCC"> have</font><font color="#E5E5E5"> white space in them and you</font>

327
00:13:36,839 --> 00:13:41,160
can't do<font color="#E5E5E5"> that with a</font><font color="#CCCCCC"> normal server side</font>

328
00:13:38,459 --> 00:13:42,660
request forgery but because we<font color="#E5E5E5"> can send</font>

329
00:13:41,160 --> 00:13:44,670
pretty much whatever<font color="#E5E5E5"> the quest we like</font>

330
00:13:42,660 --> 00:13:47,459
it's<font color="#CCCCCC"> actually</font><font color="#E5E5E5"> pretty easy to exploit</font>

331
00:13:44,670 --> 00:13:49,680
<font color="#E5E5E5">this system so here you can see at the</font>

332
00:13:47,459 --> 00:13:51,779
top<font color="#E5E5E5"> I'm saying what is the value of</font>

333
00:13:49,680 --> 00:13:53,910
proxy configured or alarm email<font color="#E5E5E5"> and</font>

334
00:13:51,779 --> 00:13:58,410
they're like hey yep<font color="#CCCCCC"> that's set</font><font color="#E5E5E5"> to</font>

335
00:13:53,910 --> 00:14:00,629
nobody at Yahoo Inc<font color="#CCCCCC"> com perfect</font><font color="#E5E5E5"> and by</font>

336
00:13:58,410 --> 00:14:03,540
setting<font color="#E5E5E5"> variables I could potentially</font>

337
00:14:00,629 --> 00:14:06,329
<font color="#E5E5E5">whitelist to my own external</font><font color="#CCCCCC"> IP address</font>

338
00:14:03,540 --> 00:14:08,310
to give me permission to push items into

339
00:14:06,329 --> 00:14:10,589
their cache and overwrite items in all

340
00:14:08,310 --> 00:14:12,869
of<font color="#CCCCCC"> their caches</font><font color="#E5E5E5"> which would give</font><font color="#CCCCCC"> me</font><font color="#E5E5E5"> the</font>

341
00:14:10,589 --> 00:14:16,889
<font color="#E5E5E5">ability to deface</font><font color="#CCCCCC"> a good number of</font><font color="#E5E5E5"> the</font>

342
00:14:12,870 --> 00:14:18,930
<font color="#CCCCCC">Apple services also</font><font color="#E5E5E5"> I could enable Sox</font>

343
00:14:16,889 --> 00:14:21,449
<font color="#E5E5E5">Fox seeing on all of their load</font>

344
00:14:18,930 --> 00:14:23,130
<font color="#E5E5E5">balancers thereby giving me full IP</font>

345
00:14:21,449 --> 00:14:26,189
<font color="#E5E5E5">level access to</font><font color="#CCCCCC"> their internal</font><font color="#E5E5E5"> network</font>

346
00:14:23,130 --> 00:14:27,449
which would be pretty<font color="#E5E5E5"> nice</font><font color="#CCCCCC"> disadvantage</font>

347
00:14:26,189 --> 00:14:29,639
<font color="#CCCCCC">with that approach</font><font color="#E5E5E5"> is that it would also</font>

348
00:14:27,449 --> 00:14:31,589
<font color="#E5E5E5">give everybody else full tcp/ip access</font>

349
00:14:29,639 --> 00:14:34,889
to their network<font color="#E5E5E5"> which would make things</font>

350
00:14:31,589 --> 00:14:37,529
pretty short-lived<font color="#CCCCCC"> I think I reported</font>

351
00:14:34,889 --> 00:14:39,990
<font color="#E5E5E5">this issue to Yahoo</font><font color="#CCCCCC"> and got a fifteen</font>

352
00:14:37,529 --> 00:14:42,300
thousand dollar payout<font color="#E5E5E5"> for it</font><font color="#CCCCCC"> so that</font>

353
00:14:39,990 --> 00:14:49,290
was pretty cool<font color="#CCCCCC"> and I found</font><font color="#E5E5E5"> this issue</font>

354
00:14:42,300 --> 00:14:49,740
using thank<font color="#E5E5E5"> you there's more where that</font>

355
00:14:49,290 --> 00:14:52,410
came from

356
00:14:49,740 --> 00:14:54,750
I found this issue using<font color="#E5E5E5"> collaborated</font>

357
00:14:52,410 --> 00:14:57,740
<font color="#E5E5E5">collaborator everywhere and when I made</font>

358
00:14:54,750 --> 00:15:00,779
<font color="#CCCCCC">that and they fixed it</font><font color="#E5E5E5"> pretty fast</font><font color="#CCCCCC"> and</font>

359
00:14:57,740 --> 00:15:02,399
when I made that<font color="#E5E5E5"> pipeline</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> mentioned a</font>

360
00:15:00,779 --> 00:15:04,620
<font color="#CCCCCC">couple</font><font color="#E5E5E5"> of weeks later I</font><font color="#CCCCCC"> found another</font>

361
00:15:02,399 --> 00:15:06,300
server with<font color="#CCCCCC"> the same vulnerability so I</font>

362
00:15:04,620 --> 00:15:09,120
got another<font color="#E5E5E5"> five thousand for that for</font>

363
00:15:06,300 --> 00:15:13,170
twenty thousand total which was a really

364
00:15:09,120 --> 00:15:16,529
<font color="#CCCCCC">good</font><font color="#E5E5E5"> start to this research as mentioned</font>

365
00:15:13,170 --> 00:15:20,790
the same technique<font color="#E5E5E5"> also worked on my ISP</font>

366
00:15:16,529 --> 00:15:22,500
<font color="#E5E5E5">and I could use it to</font><font color="#CCCCCC"> make this set of</font>

367
00:15:20,790 --> 00:15:25,529
proxy servers<font color="#CCCCCC"> route my request to their</font>

368
00:15:22,500 --> 00:15:27,269
own administration<font color="#E5E5E5"> interface and if I</font>

369
00:15:25,529 --> 00:15:30,029
could prove force the password on<font color="#CCCCCC"> that</font>

370
00:15:27,269 --> 00:15:30,780
or he<font color="#E5E5E5"> was using default credentials they</font>

371
00:15:30,029 --> 00:15:32,730
don't have a bug bound

372
00:15:30,780 --> 00:15:36,120
<font color="#CCCCCC">program so</font><font color="#E5E5E5"> I don't actually know if they</font>

373
00:15:32,730 --> 00:15:38,670
were I could I could use rewrite rules

374
00:15:36,120 --> 00:15:40,050
to like do rewrite the requests<font color="#E5E5E5"> of</font>

375
00:15:38,670 --> 00:15:42,719
millions of<font color="#CCCCCC"> BT</font><font color="#E5E5E5"> users which would be</font>

376
00:15:40,050 --> 00:15:44,790
<font color="#E5E5E5">quite nice but what I really wanted to</font>

377
00:15:42,720 --> 00:15:47,370
<font color="#E5E5E5">know was what is the point of this</font>

378
00:15:44,790 --> 00:15:50,819
interception<font color="#E5E5E5"> system was what is it doing</font>

379
00:15:47,370 --> 00:15:53,130
<font color="#E5E5E5">and to try and find</font><font color="#CCCCCC"> out</font><font color="#E5E5E5"> I did a</font><font color="#CCCCCC"> trace</font>

380
00:15:50,820 --> 00:15:54,930
<font color="#CCCCCC">view of the whole ipv4</font><font color="#E5E5E5"> space well the</font>

381
00:15:53,130 --> 00:15:57,810
tto of<font color="#CCCCCC"> ten which meant the packet never</font>

382
00:15:54,930 --> 00:16:00,839
left to my ISPs infrastructure and that

383
00:15:57,810 --> 00:16:03,300
showed me<font color="#E5E5E5"> the roughly</font><font color="#CCCCCC"> 5%</font><font color="#E5E5E5"> of website IP</font>

384
00:16:00,840 --> 00:16:06,930
addresses<font color="#E5E5E5"> had been blacklisted</font><font color="#CCCCCC"> and would</font>

385
00:16:03,300 --> 00:16:08,550
be<font color="#E5E5E5"> routed</font><font color="#CCCCCC"> into this proxy system there's</font>

386
00:16:06,930 --> 00:16:11,339
an interesting side effect<font color="#E5E5E5"> of</font><font color="#CCCCCC"> that which</font>

387
00:16:08,550 --> 00:16:12,209
is<font color="#E5E5E5"> that if your website</font><font color="#CCCCCC"> hypee address is</font>

388
00:16:11,340 --> 00:16:13,440
on<font color="#E5E5E5"> this blacklist</font>

389
00:16:12,210 --> 00:16:15,690
<font color="#E5E5E5">perhaps because you were</font><font color="#CCCCCC"> just using</font>

390
00:16:13,440 --> 00:16:18,510
cloud hosting and you've got no<font color="#CCCCCC"> control</font>

391
00:16:15,690 --> 00:16:21,060
over<font color="#E5E5E5"> what IP address is you're on all</font>

392
00:16:18,510 --> 00:16:22,980
traffic<font color="#CCCCCC"> from all BT users which is</font><font color="#E5E5E5"> the</font>

393
00:16:21,060 --> 00:16:26,489
<font color="#CCCCCC">majority of England</font><font color="#E5E5E5"> is going</font><font color="#CCCCCC"> to come</font>

394
00:16:22,980 --> 00:16:27,960
from about<font color="#CCCCCC"> five IP addresses and that</font>

395
00:16:26,490 --> 00:16:29,850
means if you're doing any IP based

396
00:16:27,960 --> 00:16:33,120
authentication it's gonna fail horribly

397
00:16:29,850 --> 00:16:35,040
<font color="#E5E5E5">and also if you decide to IP ban any of</font>

398
00:16:33,120 --> 00:16:36,660
<font color="#E5E5E5">these users for bad behavior</font><font color="#CCCCCC"> you might</font>

399
00:16:35,040 --> 00:16:39,290
<font color="#CCCCCC">end up banning a substantial part of</font>

400
00:16:36,660 --> 00:16:42,000
England which<font color="#CCCCCC"> wouldn't</font><font color="#E5E5E5"> be much good</font>

401
00:16:39,290 --> 00:16:43,410
anyway<font color="#E5E5E5"> after your</font><font color="#CCCCCC"> traffic</font><font color="#E5E5E5"> if your</font>

402
00:16:42,000 --> 00:16:45,750
<font color="#E5E5E5">request is to one of these blacklisted</font>

403
00:16:43,410 --> 00:16:47,400
by piece it gets routed into<font color="#CCCCCC"> this</font><font color="#E5E5E5"> pool</font>

404
00:16:45,750 --> 00:16:49,680
<font color="#E5E5E5">of proxies and then they apply a black</font>

405
00:16:47,400 --> 00:16:51,870
list<font color="#CCCCCC"> of hosts names</font><font color="#E5E5E5"> and if you're trying</font>

406
00:16:49,680 --> 00:16:54,209
<font color="#E5E5E5">to access a dodgy</font><font color="#CCCCCC"> hostname like icefilms</font>

407
00:16:51,870 --> 00:16:56,130
thought info you see<font color="#CCCCCC"> this</font><font color="#E5E5E5"> message which</font>

408
00:16:54,210 --> 00:16:57,510
I'm sure<font color="#CCCCCC"> none of the upstanding</font><font color="#E5E5E5"> English</font>

409
00:16:56,130 --> 00:17:00,810
<font color="#CCCCCC">people</font><font color="#E5E5E5"> in the audience have ever seen</font>

410
00:16:57,510 --> 00:17:02,640
<font color="#CCCCCC">before it says access</font><font color="#E5E5E5"> to the websites</font>

411
00:17:00,810 --> 00:17:04,889
<font color="#CCCCCC">listed on this page has been</font><font color="#E5E5E5"> blocked</font>

412
00:17:02,640 --> 00:17:07,349
<font color="#E5E5E5">pursuant to orders of the High Court</font>

413
00:17:04,890 --> 00:17:11,040
although<font color="#E5E5E5"> of course it's pretty easy to</font>

414
00:17:07,349 --> 00:17:13,500
bypass so it looks<font color="#E5E5E5"> like this system is</font>

415
00:17:11,040 --> 00:17:15,990
being<font color="#CCCCCC"> used to prevent copyright</font>

416
00:17:13,500 --> 00:17:18,750
infringement<font color="#E5E5E5"> but when I reported the</font>

417
00:17:15,990 --> 00:17:21,690
admin access vulnerability to<font color="#E5E5E5"> BT I got a</font>

418
00:17:18,750 --> 00:17:23,540
little<font color="#E5E5E5"> bit of backstory</font><font color="#CCCCCC"> this system was</font>

419
00:17:21,690 --> 00:17:25,950
<font color="#CCCCCC">actually originally</font><font color="#E5E5E5"> built as path</font>

420
00:17:23,540 --> 00:17:28,020
<font color="#CCCCCC">cleaner feet</font><font color="#E5E5E5"> which is</font><font color="#CCCCCC"> a government</font>

421
00:17:25,950 --> 00:17:30,870
initiative<font color="#E5E5E5"> to block access to</font><font color="#CCCCCC"> images of</font>

422
00:17:28,020 --> 00:17:33,060
<font color="#E5E5E5">child abuse it's just that after it was</font>

423
00:17:30,870 --> 00:17:37,500
<font color="#E5E5E5">made here was quickly repurposed to</font>

424
00:17:33,060 --> 00:17:39,690
target copyright abuse<font color="#CCCCCC"> a while later</font><font color="#E5E5E5"> I</font>

425
00:17:37,500 --> 00:17:42,010
<font color="#E5E5E5">send a payload</font><font color="#CCCCCC"> to a different</font><font color="#E5E5E5"> Russian</font>

426
00:17:39,690 --> 00:17:43,450
application<font color="#E5E5E5"> this</font><font color="#CCCCCC"> time it was vk.com and</font>

427
00:17:42,010 --> 00:17:45,700
once again<font color="#E5E5E5"> got a ping back from an</font>

428
00:17:43,450 --> 00:17:49,110
unexpected<font color="#CCCCCC"> location</font><font color="#E5E5E5"> this time</font><font color="#CCCCCC"> it was</font>

429
00:17:45,700 --> 00:17:51,760
from<font color="#CCCCCC"> Columbia nice ISP called</font><font color="#E5E5E5"> Metro</font><font color="#CCCCCC"> tell</font>

430
00:17:49,110 --> 00:17:53,679
and because they're<font color="#E5E5E5"> not my</font><font color="#CCCCCC"> ISP</font><font color="#E5E5E5"> I knew</font>

431
00:17:51,760 --> 00:17:55,180
that to get my payload to go to their

432
00:17:53,680 --> 00:17:57,700
server they had to have done DNS

433
00:17:55,180 --> 00:18:01,510
poisoning<font color="#E5E5E5"> and I was using rapid</font><font color="#CCCCCC"> sevens</font>

434
00:17:57,700 --> 00:18:03,070
<font color="#E5E5E5">DNS database so I contacted rapid7</font>

435
00:18:01,510 --> 00:18:06,250
and they hopefully identified the

436
00:18:03,070 --> 00:18:07,689
responsible DNS server<font color="#E5E5E5"> and then I did</font>

437
00:18:06,250 --> 00:18:10,030
lookups for the Alexa top million

438
00:18:07,690 --> 00:18:12,820
through this server<font color="#E5E5E5"> to figure out who</font>

439
00:18:10,030 --> 00:18:14,470
they were<font color="#CCCCCC"> targeting that showed that</font>

440
00:18:12,820 --> 00:18:16,600
they<font color="#CCCCCC"> were mostly focused on image hosts</font>

441
00:18:14,470 --> 00:18:19,330
and social networks<font color="#E5E5E5"> and if you try to</font>

442
00:18:16,600 --> 00:18:20,530
hit<font color="#E5E5E5"> some</font><font color="#CCCCCC"> of those</font><font color="#E5E5E5"> you would gain once</font>

443
00:18:19,330 --> 00:18:22,990
<font color="#E5E5E5">that you just get blocked and it would</font>

444
00:18:20,530 --> 00:18:24,820
say access to this has been blocked<font color="#CCCCCC"> due</font>

445
00:18:22,990 --> 00:18:28,780
<font color="#CCCCCC">to</font><font color="#E5E5E5"> images of child abuse along with this</font>

446
00:18:24,820 --> 00:18:30,879
logo<font color="#CCCCCC"> here however</font><font color="#E5E5E5"> once</font><font color="#CCCCCC"> again</font><font color="#E5E5E5"> that's</font><font color="#CCCCCC"> not</font>

447
00:18:28,780 --> 00:18:33,940
<font color="#E5E5E5">all this system was</font><font color="#CCCCCC"> fought because they</font>

448
00:18:30,880 --> 00:18:37,150
were also<font color="#CCCCCC"> poisoned the DNS</font><font color="#E5E5E5"> for BBC dog</font>

449
00:18:33,940 --> 00:18:38,260
code or UK which<font color="#E5E5E5"> is a news website and I</font>

450
00:18:37,150 --> 00:18:41,110
<font color="#CCCCCC">don't</font><font color="#E5E5E5"> think you'll find many dodgy</font>

451
00:18:38,260 --> 00:18:42,670
images on<font color="#CCCCCC"> that site which raises the</font>

452
00:18:41,110 --> 00:18:44,649
<font color="#E5E5E5">question</font><font color="#CCCCCC"> of why they want to</font><font color="#E5E5E5"> VU all</font>

453
00:18:42,670 --> 00:18:48,250
<font color="#CCCCCC">traffic to that site</font><font color="#E5E5E5"> through their</font>

454
00:18:44,650 --> 00:18:50,110
proxies<font color="#E5E5E5"> unfortunately finding out why is</font>

455
00:18:48,250 --> 00:18:52,890
quite difficult<font color="#CCCCCC"> they</font><font color="#E5E5E5"> weren't doing any</font>

456
00:18:50,110 --> 00:18:56,320
kind of injection<font color="#E5E5E5"> or rewriting on all</font>

457
00:18:52,890 --> 00:18:57,820
all requests as far as I<font color="#CCCCCC"> could tell</font><font color="#E5E5E5"> so</font>

458
00:18:56,320 --> 00:18:59,919
they're<font color="#E5E5E5"> either targeting specific</font>

459
00:18:57,820 --> 00:19:02,200
articles and<font color="#CCCCCC"> maybe</font><font color="#E5E5E5"> blocking access to or</font>

460
00:18:59,920 --> 00:19:03,370
changing the content of those or<font color="#CCCCCC"> maybe</font>

461
00:19:02,200 --> 00:19:05,590
they're just passively watching maybe

462
00:19:03,370 --> 00:19:07,419
<font color="#E5E5E5">they simply want to</font><font color="#CCCCCC"> know</font><font color="#E5E5E5"> which articles</font>

463
00:19:05,590 --> 00:19:09,459
on the BBC you're actually<font color="#E5E5E5"> meeting so</font>

464
00:19:07,420 --> 00:19:16,840
they can pass that<font color="#CCCCCC"> information along to</font>

465
00:19:09,460 --> 00:19:19,410
<font color="#CCCCCC">someone now although the payload that</font>

466
00:19:16,840 --> 00:19:22,060
<font color="#E5E5E5">I've shown you is really very simple</font>

467
00:19:19,410 --> 00:19:23,380
thinking you can reliably predict what

468
00:19:22,060 --> 00:19:26,050
will<font color="#E5E5E5"> happen</font><font color="#CCCCCC"> when you</font><font color="#E5E5E5"> send that payload</font>

469
00:19:23,380 --> 00:19:29,260
<font color="#CCCCCC">it is always a mistake I found</font><font color="#E5E5E5"> seven</font>

470
00:19:26,050 --> 00:19:30,820
<font color="#CCCCCC">Yahoo servers that would take the host</font>

471
00:19:29,260 --> 00:19:32,260
header<font color="#E5E5E5"> that I gave in this case</font><font color="#CCCCCC"> recap</font>

472
00:19:30,820 --> 00:19:35,740
<font color="#CCCCCC">not me and they would</font><font color="#E5E5E5"> route the request</font>

473
00:19:32,260 --> 00:19:37,690
to outage<font color="#E5E5E5"> dot that host header and I</font>

474
00:19:35,740 --> 00:19:42,460
would also put the host in the path

475
00:19:37,690 --> 00:19:44,320
<font color="#E5E5E5">twice now I've got no</font><font color="#CCCCCC"> idea what the</font>

476
00:19:42,460 --> 00:19:46,630
point of a is but luckily<font color="#E5E5E5"> all I need to</font>

477
00:19:44,320 --> 00:19:49,179
<font color="#E5E5E5">know is how to exploit it and as</font>

478
00:19:46,630 --> 00:19:50,830
presented there<font color="#CCCCCC"> it's not much use right</font>

479
00:19:49,180 --> 00:19:53,660
because you're just<font color="#E5E5E5"> going to get a 404</font>

480
00:19:50,830 --> 00:19:56,790
from<font color="#CCCCCC"> whatever internal</font><font color="#E5E5E5"> server you</font><font color="#CCCCCC"> here</font>

481
00:19:53,660 --> 00:19:58,950
fortunately this the vulnerable service

482
00:19:56,790 --> 00:20:00,899
that was<font color="#CCCCCC"> rewriting the</font><font color="#E5E5E5"> request was</font>

483
00:19:58,950 --> 00:20:03,090
incredibly tolerant<font color="#E5E5E5"> of what you put in</font>

484
00:20:00,900 --> 00:20:04,410
the host header<font color="#E5E5E5"> so if you sent the</font>

485
00:20:03,090 --> 00:20:06,990
following host header it would rewrite

486
00:20:04,410 --> 00:20:08,760
it as you see on the<font color="#CCCCCC"> right and</font><font color="#E5E5E5"> that</font>

487
00:20:06,990 --> 00:20:10,770
request<font color="#CCCCCC"> to when the back in the server</font>

488
00:20:08,760 --> 00:20:14,070
gets it will get normalized to enter a

489
00:20:10,770 --> 00:20:15,330
<font color="#E5E5E5">request to the web loop so we can</font>

490
00:20:14,070 --> 00:20:18,389
<font color="#CCCCCC">actually fetch pretty much</font><font color="#E5E5E5"> arbitary</font>

491
00:20:15,330 --> 00:20:21,270
stuff<font color="#E5E5E5"> using</font><font color="#CCCCCC"> this technique</font><font color="#E5E5E5"> that got an</font>

492
00:20:18,390 --> 00:20:23,550
another<font color="#E5E5E5"> 5,000 of your home to be honest</font>

493
00:20:21,270 --> 00:20:25,920
I'm not sure<font color="#E5E5E5"> why the bounty values from</font>

494
00:20:23,550 --> 00:20:27,870
Yahoo<font color="#E5E5E5"> varied so much they seem to be a</font>

495
00:20:25,920 --> 00:20:29,310
little<font color="#E5E5E5"> bit random but that the total</font>

496
00:20:27,870 --> 00:20:30,860
amount was a good<font color="#E5E5E5"> amount of money so I'm</font>

497
00:20:29,310 --> 00:20:35,100
<font color="#CCCCCC">not really complaining</font>

498
00:20:30,860 --> 00:20:37,080
anyway the<font color="#CCCCCC"> moral</font><font color="#E5E5E5"> of this issue is that</font>

499
00:20:35,100 --> 00:20:39,120
on your<font color="#E5E5E5"> on your server that's receiving</font>

500
00:20:37,080 --> 00:20:41,159
pingbacks you need to use wildcard

501
00:20:39,120 --> 00:20:42,570
<font color="#E5E5E5">dearness to make sure that you</font><font color="#CCCCCC"> receive</font>

502
00:20:41,160 --> 00:20:48,420
everything<font color="#E5E5E5"> that's been triggered by</font><font color="#CCCCCC"> your</font>

503
00:20:42,570 --> 00:20:48,840
payloads<font color="#CCCCCC"> know this request</font><font color="#E5E5E5"> may look</font>

504
00:20:48,420 --> 00:20:51,240
familiar

505
00:20:48,840 --> 00:20:55,080
I used<font color="#E5E5E5"> it back in 2013 to poison</font>

506
00:20:51,240 --> 00:20:57,660
<font color="#E5E5E5">Django's password reset emails but here</font>

507
00:20:55,080 --> 00:21:00,419
I found<font color="#E5E5E5"> this certain US military server</font>

508
00:20:57,660 --> 00:21:03,600
<font color="#E5E5E5">which would move the</font><font color="#CCCCCC"> request to wherever</font>

509
00:21:00,420 --> 00:21:04,740
I specified in the request line so I

510
00:21:03,600 --> 00:21:06,480
think<font color="#E5E5E5"> they had a white list of</font>

511
00:21:04,740 --> 00:21:10,140
acceptable hosts but<font color="#E5E5E5"> the request line</font>

512
00:21:06,480 --> 00:21:12,170
<font color="#E5E5E5">takes priority however I had a little</font>

513
00:21:10,140 --> 00:21:14,760
bit of<font color="#CCCCCC"> an</font><font color="#E5E5E5"> issue here which is that I</font>

514
00:21:12,170 --> 00:21:16,230
wanted<font color="#CCCCCC"> to prove</font><font color="#E5E5E5"> I could access</font><font color="#CCCCCC"> an</font>

515
00:21:14,760 --> 00:21:19,110
internal service<font color="#E5E5E5"> to show that this issue</font>

516
00:21:16,230 --> 00:21:20,820
<font color="#E5E5E5">had some kind of severity but I was too</font>

517
00:21:19,110 --> 00:21:23,149
nervous to<font color="#E5E5E5"> do a proper internal port</font>

518
00:21:20,820 --> 00:21:26,490
scan on a Department of Defense server

519
00:21:23,150 --> 00:21:28,040
so instead<font color="#E5E5E5"> I decided to Google a bit and</font>

520
00:21:26,490 --> 00:21:31,080
see<font color="#E5E5E5"> if I could find anything useful</font><font color="#CCCCCC"> and</font>

521
00:21:28,040 --> 00:21:33,930
<font color="#E5E5E5">I found an</font><font color="#CCCCCC"> amazing forum post on</font><font color="#E5E5E5"> defense</font>

522
00:21:31,080 --> 00:21:35,669
of caring<font color="#CCCCCC"> comm</font><font color="#E5E5E5"> it says if you're</font><font color="#CCCCCC"> looking</font>

523
00:21:33,930 --> 00:21:37,800
at this and<font color="#CCCCCC"> I'm not in the military or</font>

524
00:21:35,670 --> 00:21:39,270
DoD then this<font color="#E5E5E5"> won't mean</font><font color="#CCCCCC"> anything to you</font>

525
00:21:37,800 --> 00:21:40,950
nor<font color="#CCCCCC"> will you be able</font><font color="#E5E5E5"> to access it and</font>

526
00:21:39,270 --> 00:21:43,770
<font color="#CCCCCC">then it linked a couple of internal</font>

527
00:21:40,950 --> 00:21:45,510
Department of Defense<font color="#E5E5E5"> websites and sure</font>

528
00:21:43,770 --> 00:21:49,490
enough using this technique<font color="#E5E5E5"> I could</font>

529
00:21:45,510 --> 00:21:53,340
access<font color="#E5E5E5"> them so that was handy</font><font color="#CCCCCC"> I think</font>

530
00:21:49,490 --> 00:21:56,310
the<font color="#E5E5E5"> mall here is number one</font><font color="#CCCCCC"> I if you can</font>

531
00:21:53,340 --> 00:21:58,230
of avoid<font color="#CCCCCC"> during a port scan of someone's</font>

532
00:21:56,310 --> 00:22:00,720
internal network I would recommend doing

533
00:21:58,230 --> 00:22:05,310
so people<font color="#E5E5E5"> can get quite twitchy</font><font color="#CCCCCC"> about</font>

534
00:22:00,720 --> 00:22:06,600
that<font color="#E5E5E5"> Yahoo's certainly did and also the</font>

535
00:22:05,310 --> 00:22:08,370
<font color="#CCCCCC">lord of the target company</font>

536
00:22:06,600 --> 00:22:09,659
less likely<font color="#CCCCCC"> is that you</font><font color="#E5E5E5"> actually need</font><font color="#CCCCCC"> to</font>

537
00:22:08,370 --> 00:22:13,860
because<font color="#CCCCCC"> people are just leaking</font><font color="#E5E5E5"> tons of</font>

538
00:22:09,660 --> 00:22:16,890
useful<font color="#CCCCCC"> stuff online</font><font color="#E5E5E5"> now although the</font>

539
00:22:13,860 --> 00:22:19,469
network diagram<font color="#E5E5E5"> only</font><font color="#CCCCCC"> shows one proxy</font>

540
00:22:16,890 --> 00:22:21,990
server<font color="#E5E5E5"> it's possible that some</font><font color="#CCCCCC"> people</font>

541
00:22:19,470 --> 00:22:23,490
like<font color="#CCCCCC"> to chain proxy servers</font><font color="#E5E5E5"> and if you</font>

542
00:22:21,990 --> 00:22:25,410
want to target<font color="#CCCCCC"> the server in the middle</font>

543
00:22:23,490 --> 00:22:26,880
of a chain that<font color="#E5E5E5"> can make</font><font color="#CCCCCC"> life a bit</font>

544
00:22:25,410 --> 00:22:28,770
difficult<font color="#E5E5E5"> because your payload is likely</font>

545
00:22:26,880 --> 00:22:31,830
to get rejected<font color="#E5E5E5"> by the first proxy in</font>

546
00:22:28,770 --> 00:22:33,299
the chain for<font color="#CCCCCC"> example in caps Allah uses</font>

547
00:22:31,830 --> 00:22:34,860
the host header to work out which<font color="#CCCCCC"> of</font>

548
00:22:33,299 --> 00:22:36,360
their clients to<font color="#CCCCCC"> route</font><font color="#E5E5E5"> the quests</font><font color="#CCCCCC"> onto</font>

549
00:22:34,860 --> 00:22:38,129
so if<font color="#E5E5E5"> you try the normal payload that</font><font color="#CCCCCC"> I</font>

550
00:22:36,360 --> 00:22:41,820
showed at<font color="#CCCCCC"> the start</font><font color="#E5E5E5"> it will just get</font>

551
00:22:38,130 --> 00:22:43,590
<font color="#E5E5E5">dropped fortunately in caps Allah is</font>

552
00:22:41,820 --> 00:22:45,178
incredibly tolerant<font color="#CCCCCC"> about what they</font>

553
00:22:43,590 --> 00:22:47,549
allow in<font color="#E5E5E5"> the host header basically they</font>

554
00:22:45,179 --> 00:22:50,220
<font color="#CCCCCC">ignore everything that comes after the</font>

555
00:22:47,549 --> 00:22:51,889
<font color="#E5E5E5">colon</font><font color="#CCCCCC"> in the</font><font color="#E5E5E5"> request</font><font color="#CCCCCC"> so you can send a</font>

556
00:22:50,220 --> 00:22:53,940
<font color="#CCCCCC">request like</font><font color="#E5E5E5"> the one shown there and</font>

557
00:22:51,890 --> 00:22:56,880
<font color="#CCCCCC">encapsulated will route on to the target</font>

558
00:22:53,940 --> 00:22:58,320
<font color="#CCCCCC">and</font><font color="#E5E5E5"> then</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> target or a particular</font>

559
00:22:56,880 --> 00:23:02,190
target that I found in this case would

560
00:22:58,320 --> 00:23:03,960
rewrite that as a<font color="#E5E5E5"> URL</font><font color="#CCCCCC"> like</font><font color="#E5E5E5"> so and it</font>

561
00:23:02,190 --> 00:23:06,240
<font color="#E5E5E5">would</font><font color="#CCCCCC"> end up</font><font color="#E5E5E5"> getting routed to where by</font>

562
00:23:03,960 --> 00:23:07,380
choice<font color="#CCCCCC"> so even though that target hadn't</font>

563
00:23:06,240 --> 00:23:09,630
captured in front of it with a bit<font color="#E5E5E5"> of</font>

564
00:23:07,380 --> 00:23:11,309
creativity<font color="#CCCCCC"> you can</font><font color="#E5E5E5"> get around</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> and</font>

565
00:23:09,630 --> 00:23:14,250
still get your<font color="#CCCCCC"> server</font><font color="#E5E5E5"> side request</font>

566
00:23:11,309 --> 00:23:16,860
forgery<font color="#E5E5E5"> this adds a slightly cool side</font>

567
00:23:14,250 --> 00:23:18,570
effect which is because the payload

568
00:23:16,860 --> 00:23:21,030
<font color="#CCCCCC">cause the</font><font color="#E5E5E5"> backend to connect directly to</font>

569
00:23:18,570 --> 00:23:23,220
<font color="#E5E5E5">my server that told me exactly where the</font>

570
00:23:21,030 --> 00:23:24,720
<font color="#CCCCCC">backend</font><font color="#E5E5E5"> was and</font><font color="#CCCCCC"> off from that</font><font color="#E5E5E5"> point I</font>

571
00:23:23,220 --> 00:23:27,000
could speak<font color="#CCCCCC"> directly to</font><font color="#E5E5E5"> the backend and</font>

572
00:23:24,720 --> 00:23:31,919
just and<font color="#E5E5E5"> just avoiding capsuleer</font>

573
00:23:27,000 --> 00:23:33,690
entirely so although<font color="#E5E5E5"> this isn't strictly</font>

574
00:23:31,919 --> 00:23:34,890
a vulnerability in encapsulator it's

575
00:23:33,690 --> 00:23:38,580
still probably something they might<font color="#E5E5E5"> want</font>

576
00:23:34,890 --> 00:23:41,039
to think<font color="#E5E5E5"> about fixing these</font>

577
00:23:38,580 --> 00:23:42,030
vulnerabilities<font color="#E5E5E5"> aren't just caused by</font>

578
00:23:41,039 --> 00:23:43,860
misconfigurations

579
00:23:42,030 --> 00:23:47,460
what we've<font color="#E5E5E5"> got here is some code that</font>

580
00:23:43,860 --> 00:23:50,939
<font color="#CCCCCC">New Relic</font><font color="#E5E5E5"> had on their main on their</font>

581
00:23:47,460 --> 00:23:53,460
main official<font color="#CCCCCC"> web site and well it</font>

582
00:23:50,940 --> 00:23:56,280
<font color="#E5E5E5">probably looks absolutely fine</font><font color="#CCCCCC"> to you it</font>

583
00:23:53,460 --> 00:23:59,190
does<font color="#E5E5E5"> tomato</font><font color="#CCCCCC"> to be honest</font><font color="#E5E5E5"> it just</font><font color="#CCCCCC"> takes</font>

584
00:23:56,280 --> 00:24:02,428
the<font color="#E5E5E5"> user supplied</font><font color="#CCCCCC"> llamó and it over</font>

585
00:23:59,190 --> 00:24:04,950
writes the host and the port<font color="#E5E5E5"> specified</font>

586
00:24:02,429 --> 00:24:06,750
in that<font color="#CCCCCC"> URL with a</font><font color="#E5E5E5"> hard-coded one of the</font>

587
00:24:04,950 --> 00:24:09,570
<font color="#E5E5E5">internal server that they want to</font><font color="#CCCCCC"> root</font>

588
00:24:06,750 --> 00:24:09,870
your request to unfortunately for New

589
00:24:09,570 --> 00:24:11,789
Relic

590
00:24:09,870 --> 00:24:13,549
they were using<font color="#E5E5E5"> the Apache HTTP</font>

591
00:24:11,789 --> 00:24:17,520
components library for their server and

592
00:24:13,549 --> 00:24:19,480
this server fails to require that<font color="#CCCCCC"> paths</font>

593
00:24:17,520 --> 00:24:22,418
<font color="#CCCCCC">start with a</font><font color="#E5E5E5"> forward</font><font color="#CCCCCC"> slash</font>

594
00:24:19,480 --> 00:24:25,510
so that means if you<font color="#E5E5E5"> send a malformed</font>

595
00:24:22,419 --> 00:24:28,659
illegal HTTP request like<font color="#CCCCCC"> that</font><font color="#E5E5E5"> then</font>

596
00:24:25,510 --> 00:24:30,370
their code<font color="#E5E5E5"> rewrites it like that</font><font color="#CCCCCC"> and</font>

597
00:24:28,659 --> 00:24:33,760
once<font color="#CCCCCC"> again they're accessing a server</font><font color="#E5E5E5"> of</font>

598
00:24:30,370 --> 00:24:37,299
my choice<font color="#CCCCCC"> with a username</font><font color="#E5E5E5"> of back-end</font>

599
00:24:33,760 --> 00:24:39,519
server so this got me access<font color="#CCCCCC"> to new</font>

600
00:24:37,299 --> 00:24:42,309
<font color="#CCCCCC">relics internal network which had some</font>

601
00:24:39,519 --> 00:24:44,620
<font color="#CCCCCC">amazing stuff on it for a start it</font><font color="#E5E5E5"> had</font>

602
00:24:42,309 --> 00:24:46,899
some<font color="#CCCCCC"> incredible developer in jokes</font>

603
00:24:44,620 --> 00:24:48,629
such as this page which was blasting out

604
00:24:46,899 --> 00:24:51,610
music<font color="#CCCCCC"> and had</font><font color="#E5E5E5"> marquees</font><font color="#CCCCCC"> and everything</font>

605
00:24:48,630 --> 00:24:53,799
they also had<font color="#CCCCCC"> some administration panels</font>

606
00:24:51,610 --> 00:24:57,908
with no authentication<font color="#CCCCCC"> on them which was</font>

607
00:24:53,799 --> 00:25:00,429
cool<font color="#E5E5E5"> now unfortunately New Relic don't</font>

608
00:24:57,909 --> 00:25:02,019
pay cash bounties but to their<font color="#CCCCCC"> credit</font>

609
00:25:00,429 --> 00:25:03,880
they<font color="#E5E5E5"> patch this issue really quite fast</font>

610
00:25:02,019 --> 00:25:06,760
on a public holiday<font color="#E5E5E5"> and they also</font>

611
00:25:03,880 --> 00:25:09,549
reported this problem with this problem

612
00:25:06,760 --> 00:25:12,700
back to apache HTTP components where

613
00:25:09,549 --> 00:25:14,710
it's now been<font color="#CCCCCC"> fixed so if you're using</font>

614
00:25:12,700 --> 00:25:16,419
that library then you don't<font color="#E5E5E5"> need to be</font>

615
00:25:14,710 --> 00:25:19,630
panicking right now<font color="#E5E5E5"> as long</font><font color="#CCCCCC"> as you're</font>

616
00:25:16,419 --> 00:25:21,700
using<font color="#E5E5E5"> the latest</font><font color="#CCCCCC"> version</font><font color="#E5E5E5"> of fortunately</font>

617
00:25:19,630 --> 00:25:24,090
for me<font color="#CCCCCC"> this</font><font color="#E5E5E5"> technique also works on 17</font>

618
00:25:21,700 --> 00:25:31,470
different Yahoo servers<font color="#E5E5E5"> so I got another</font>

619
00:25:24,090 --> 00:25:33,970
<font color="#E5E5E5">$8,000</font><font color="#CCCCCC"> now that made a total of of</font>

620
00:25:31,470 --> 00:25:37,210
<font color="#E5E5E5">33,000 which is how much I enter in</font>

621
00:25:33,970 --> 00:25:39,580
bounties during this research and you

622
00:25:37,210 --> 00:25:41,919
might be wondering<font color="#E5E5E5"> what happened to</font><font color="#CCCCCC"> that</font>

623
00:25:39,580 --> 00:25:44,500
<font color="#E5E5E5">money now when I started this research</font><font color="#CCCCCC"> I</font>

624
00:25:41,919 --> 00:25:48,360
had to deal with my company<font color="#CCCCCC"> that any</font>

625
00:25:44,500 --> 00:25:52,899
bounties I owned would get spent on beer

626
00:25:48,360 --> 00:25:54,219
however<font color="#CCCCCC"> we were fairly small company in</font>

627
00:25:52,899 --> 00:25:56,469
spending<font color="#E5E5E5"> thirty two thousand</font><font color="#CCCCCC"> dollars</font><font color="#E5E5E5"> on</font>

628
00:25:54,220 --> 00:25:59,529
<font color="#E5E5E5">beer was looking like</font><font color="#CCCCCC"> it was</font><font color="#E5E5E5"> going to be</font>

629
00:25:56,470 --> 00:26:01,570
quite challenging<font color="#CCCCCC"> so we gave the</font>

630
00:25:59,529 --> 00:26:04,260
majority<font color="#CCCCCC"> to charity and spent a small</font>

631
00:26:01,570 --> 00:26:04,260
amount<font color="#E5E5E5"> of it on beer</font>

632
00:26:10,490 --> 00:26:15,990
so possibly the strangest behavior that

633
00:26:13,440 --> 00:26:19,440
I saw<font color="#CCCCCC"> during this research</font><font color="#E5E5E5"> was courtesy</font>

634
00:26:15,990 --> 00:26:21,750
of our<font color="#E5E5E5"> website called called</font><font color="#CCCCCC"> global eeks</font>

635
00:26:19,440 --> 00:26:25,800
<font color="#CCCCCC">which is a bit like</font><font color="#E5E5E5"> WikiLeaks except</font>

636
00:26:21,750 --> 00:26:27,930
<font color="#E5E5E5">actually legitimate and so what I found</font>

637
00:26:25,800 --> 00:26:29,940
<font color="#E5E5E5">these guys was if I</font><font color="#CCCCCC"> sent them the</font>

638
00:26:27,930 --> 00:26:31,410
following<font color="#E5E5E5"> HTTP</font><font color="#CCCCCC"> request which is</font>

639
00:26:29,940 --> 00:26:34,980
<font color="#E5E5E5">malformed because it doesn't start with</font>

640
00:26:31,410 --> 00:26:38,160
a forward<font color="#CCCCCC"> slash</font><font color="#E5E5E5"> then I got about 15 DNS</font>

641
00:26:34,980 --> 00:26:40,410
lookups<font color="#E5E5E5"> all in mixed case coming</font><font color="#CCCCCC"> from</font>

642
00:26:38,160 --> 00:26:43,430
<font color="#E5E5E5">different IP addresses which is</font>

643
00:26:40,410 --> 00:26:46,590
<font color="#CCCCCC">definitely</font><font color="#E5E5E5"> not what I expected to happen</font>

644
00:26:43,430 --> 00:26:47,940
now<font color="#E5E5E5"> eventually due to the nature</font><font color="#CCCCCC"> of the</font>

645
00:26:46,590 --> 00:26:49,290
site and the fact that all the IP

646
00:26:47,940 --> 00:26:52,980
addresses the lookups were coming from

647
00:26:49,290 --> 00:26:54,889
were different<font color="#CCCCCC"> I had an idea as</font><font color="#E5E5E5"> to what</font>

648
00:26:52,980 --> 00:26:57,300
the cause of this<font color="#CCCCCC"> behavior might be</font>

649
00:26:54,890 --> 00:26:59,760
because this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> a whistleblowing website</font>

650
00:26:57,300 --> 00:27:02,460
they want<font color="#E5E5E5"> to hide the physical location</font>

651
00:26:59,760 --> 00:27:04,050
of<font color="#CCCCCC"> their back-end server to stop like</font>

652
00:27:02,460 --> 00:27:07,260
<font color="#E5E5E5">governments from raiding it in that</font><font color="#CCCCCC"> kind</font>

653
00:27:04,050 --> 00:27:09,629
of stuff<font color="#CCCCCC"> so they connect to it as a tor</font>

654
00:27:07,260 --> 00:27:12,260
hidden<font color="#E5E5E5"> service so what I've got is</font>

655
00:27:09,630 --> 00:27:15,990
server side request forgery through talk

656
00:27:12,260 --> 00:27:19,110
which<font color="#E5E5E5"> is quite</font><font color="#CCCCCC"> interesting from an</font>

657
00:27:15,990 --> 00:27:20,520
exploitation<font color="#E5E5E5"> perspective so it going</font>

658
00:27:19,110 --> 00:27:22,260
<font color="#E5E5E5">through</font><font color="#CCCCCC"> tor</font><font color="#E5E5E5"> is the reason that all the</font>

659
00:27:20,520 --> 00:27:23,160
IP addresses of the lookups are

660
00:27:22,260 --> 00:27:25,860
different they're coming<font color="#E5E5E5"> from different</font>

661
00:27:23,160 --> 00:27:27,870
exit nodes and<font color="#E5E5E5"> also the mixed</font><font color="#CCCCCC"> case</font><font color="#E5E5E5"> DNS</font>

662
00:27:25,860 --> 00:27:30,389
lookups<font color="#E5E5E5"> are the result of a fairly</font>

663
00:27:27,870 --> 00:27:33,389
obscure mechanism that<font color="#E5E5E5"> tor users to try</font>

664
00:27:30,390 --> 00:27:36,960
and increase the<font color="#E5E5E5"> entropy in DNS by</font>

665
00:27:33,390 --> 00:27:38,490
making the<font color="#E5E5E5"> requests</font><font color="#CCCCCC"> a mixed case so the</font>

666
00:27:36,960 --> 00:27:40,800
impact of this<font color="#CCCCCC"> is</font><font color="#E5E5E5"> hard to qualify</font>

667
00:27:38,490 --> 00:27:41,430
because<font color="#E5E5E5"> I can't access</font><font color="#CCCCCC"> the internal</font>

668
00:27:40,800 --> 00:27:42,750
<font color="#CCCCCC">network</font>

669
00:27:41,430 --> 00:27:45,510
it's definitely<font color="#E5E5E5"> server side request</font>

670
00:27:42,750 --> 00:27:49,410
forgery but I'm<font color="#E5E5E5"> accessing whatever I try</font>

671
00:27:45,510 --> 00:27:51,960
and<font color="#CCCCCC"> access through tor what I can do</font>

672
00:27:49,410 --> 00:27:53,430
though is get a decent expansion of

673
00:27:51,960 --> 00:27:55,320
attack surface because I can make their

674
00:27:53,430 --> 00:27:58,830
client<font color="#E5E5E5"> their talk</font><font color="#CCCCCC"> line to connect</font>

675
00:27:55,320 --> 00:28:00,240
directly to<font color="#CCCCCC"> my server and if I've got a</font>

676
00:27:58,830 --> 00:28:03,210
vulnerability<font color="#E5E5E5"> for a tall client then</font>

677
00:28:00,240 --> 00:28:06,360
that could<font color="#CCCCCC"> be</font><font color="#E5E5E5"> quite useful also I can</font>

678
00:28:03,210 --> 00:28:08,580
potentially<font color="#CCCCCC"> use it</font><font color="#E5E5E5"> to obscure and attack</font>

679
00:28:06,360 --> 00:28:10,350
on a target because<font color="#CCCCCC"> I can use them as a</font>

680
00:28:08,580 --> 00:28:12,300
hop and make them<font color="#CCCCCC"> route my payload</font>

681
00:28:10,350 --> 00:28:14,820
through tor to my target<font color="#CCCCCC"> and that means</font>

682
00:28:12,300 --> 00:28:17,040
even<font color="#E5E5E5"> if the attack gets traced backwards</font>

683
00:28:14,820 --> 00:28:18,540
through tor<font color="#CCCCCC"> they'll just end up looking</font>

684
00:28:17,040 --> 00:28:20,250
at<font color="#E5E5E5"> this highly suspicious global</font><font color="#CCCCCC"> links</font>

685
00:28:18,540 --> 00:28:21,960
<font color="#CCCCCC">website that</font><font color="#E5E5E5"> probably doesn't keep any</font>

686
00:28:20,250 --> 00:28:24,380
logs<font color="#E5E5E5"> and won't be able to figure out</font>

687
00:28:21,960 --> 00:28:27,360
that it was me

688
00:28:24,380 --> 00:28:30,480
right now let's talk about exploiting

689
00:28:27,360 --> 00:28:33,479
helper systems unlike<font color="#E5E5E5"> miss routing</font>

690
00:28:30,480 --> 00:28:36,470
<font color="#CCCCCC">attacks with helper systems causing pink</font>

691
00:28:33,480 --> 00:28:38,760
backs is often really<font color="#CCCCCC"> easy but</font>

692
00:28:36,470 --> 00:28:40,950
<font color="#E5E5E5">exploiting the systems in a meaningful</font>

693
00:28:38,760 --> 00:28:43,080
way it can be<font color="#E5E5E5"> quite hard that's because</font>

694
00:28:40,950 --> 00:28:45,030
<font color="#CCCCCC">a server-side</font><font color="#E5E5E5"> request forgery we found</font>

695
00:28:43,080 --> 00:28:47,399
in<font color="#E5E5E5"> back-end systems is normally blind</font>

696
00:28:45,030 --> 00:28:49,470
<font color="#CCCCCC">which means we can't see the result from</font>

697
00:28:47,400 --> 00:28:51,510
the internal<font color="#E5E5E5"> requests we've triggered</font>

698
00:28:49,470 --> 00:28:55,350
which means we can't adapt our attacks

699
00:28:51,510 --> 00:28:57,870
based<font color="#E5E5E5"> on what we see this research</font>

700
00:28:55,350 --> 00:29:00,300
started<font color="#CCCCCC"> on a really old website</font><font color="#E5E5E5"> that had</font>

701
00:28:57,870 --> 00:29:02,459
an amazing sentence on it<font color="#E5E5E5"> it said the</font>

702
00:29:00,300 --> 00:29:05,040
extract profile header<font color="#E5E5E5"> should contain a</font>

703
00:29:02,460 --> 00:29:06,870
URL pointing to an XML<font color="#CCCCCC"> document that</font>

704
00:29:05,040 --> 00:29:10,350
specifies<font color="#E5E5E5"> the features of a mobile</font>

705
00:29:06,870 --> 00:29:12,899
<font color="#CCCCCC">device so it specifies the specification</font>

706
00:29:10,350 --> 00:29:14,639
<font color="#E5E5E5">gives you two amazingly 5s pieces of</font>

707
00:29:12,900 --> 00:29:17,010
functionality<font color="#CCCCCC"> one you've got</font><font color="#E5E5E5"> to fetch</font><font color="#CCCCCC"> a</font>

708
00:29:14,640 --> 00:29:20,340
user supplied URL<font color="#E5E5E5"> - you've got a pause</font>

709
00:29:17,010 --> 00:29:21,629
the resulting untrusted XML file<font color="#E5E5E5"> and I</font>

710
00:29:20,340 --> 00:29:24,240
immediately try this out<font color="#CCCCCC"> on a bunch of</font>

711
00:29:21,630 --> 00:29:26,610
websites<font color="#CCCCCC"> but it didn't work on any of</font>

712
00:29:24,240 --> 00:29:30,390
<font color="#E5E5E5">them sadly probably</font><font color="#CCCCCC"> cuz it's so old so I</font>

713
00:29:26,610 --> 00:29:33,270
just tweeted<font color="#E5E5E5"> it and then I got</font><font color="#CCCCCC"> a ping</font>

714
00:29:30,390 --> 00:29:35,820
back from Facebook it turns out<font color="#E5E5E5"> Facebook</font>

715
00:29:33,270 --> 00:29:39,240
does support this but they<font color="#E5E5E5"> fetched the</font>

716
00:29:35,820 --> 00:29:43,260
URL<font color="#CCCCCC"> you supply about 26 hours</font><font color="#E5E5E5"> after you</font>

717
00:29:39,240 --> 00:29:45,990
send the request<font color="#CCCCCC"> unfortunately their</font>

718
00:29:43,260 --> 00:29:48,270
implementation of<font color="#E5E5E5"> this and their XML</font>

719
00:29:45,990 --> 00:29:49,500
parsing<font color="#E5E5E5"> seems to be secure</font><font color="#CCCCCC"> as far as I</font>

720
00:29:48,270 --> 00:29:51,840
can tell although the fact there was a

721
00:29:49,500 --> 00:29:54,900
26<font color="#E5E5E5"> hour time like that</font><font color="#CCCCCC"> between each</font>

722
00:29:51,840 --> 00:29:56,250
attack made it<font color="#E5E5E5"> really tedious so I might</font>

723
00:29:54,900 --> 00:30:00,330
miss something<font color="#CCCCCC"> so if you want</font><font color="#E5E5E5"> to try and</font>

724
00:29:56,250 --> 00:30:02,070
hack the<font color="#CCCCCC"> hat feel free fortunately there</font>

725
00:30:00,330 --> 00:30:03,780
are<font color="#CCCCCC"> many other</font><font color="#E5E5E5"> useful ways to trigger</font>

726
00:30:02,070 --> 00:30:08,149
pingbacks from helper systems that are

727
00:30:03,780 --> 00:30:11,010
actually effective<font color="#E5E5E5"> are widely supported</font>

728
00:30:08,150 --> 00:30:13,890
through a<font color="#CCCCCC"> fervor header is</font><font color="#E5E5E5"> the most</font>

729
00:30:11,010 --> 00:30:15,210
popular one a huge<font color="#E5E5E5"> number</font><font color="#CCCCCC"> of websites</font>

730
00:30:13,890 --> 00:30:17,700
you<font color="#CCCCCC"> will not</font><font color="#E5E5E5"> believe how</font><font color="#CCCCCC"> many websites</font>

731
00:30:15,210 --> 00:30:19,440
<font color="#CCCCCC">do this will fetch</font><font color="#E5E5E5"> whatever URL you</font>

732
00:30:17,700 --> 00:30:21,660
specify in the refer header

733
00:30:19,440 --> 00:30:23,750
I'm not hundred percent<font color="#CCCCCC"> sure why they're</font>

734
00:30:21,660 --> 00:30:28,320
doing<font color="#E5E5E5"> it by assume it's for some kind of</font>

735
00:30:23,750 --> 00:30:30,480
analytics purpose so that's probably the

736
00:30:28,320 --> 00:30:32,610
<font color="#CCCCCC">most effective way of tricking</font><font color="#E5E5E5"> pingbacks</font>

737
00:30:30,480 --> 00:30:33,930
and<font color="#CCCCCC"> back-end systems but</font><font color="#E5E5E5"> also you'll be</font>

738
00:30:32,610 --> 00:30:36,010
familiar<font color="#CCCCCC"> with the x-forwarded-for header</font>

739
00:30:33,930 --> 00:30:39,160
<font color="#CCCCCC">you've probably used it</font><font color="#E5E5E5"> to spoof</font><font color="#CCCCCC"> your IP</font>

740
00:30:36,010 --> 00:30:40,780
it also supports<font color="#E5E5E5"> host names and if you</font>

741
00:30:39,160 --> 00:30:42,760
specify a host name in there then<font color="#CCCCCC"> you</font>

742
00:30:40,780 --> 00:30:45,309
can<font color="#E5E5E5"> use the fact</font><font color="#CCCCCC"> that you did or didn't</font>

743
00:30:42,760 --> 00:30:47,379
receive a DNS lookup<font color="#E5E5E5"> for that host name</font>

744
00:30:45,309 --> 00:30:49,240
to work out whether they're trusting

745
00:30:47,380 --> 00:30:51,040
<font color="#E5E5E5">this header and therefore whether it's</font>

746
00:30:49,240 --> 00:30:54,190
worth using<font color="#E5E5E5"> exploits that try and take</font>

747
00:30:51,040 --> 00:30:56,020
advantage<font color="#CCCCCC"> of this and similarly the</font>

748
00:30:54,190 --> 00:30:58,270
slightly more<font color="#E5E5E5"> obscure variants</font><font color="#CCCCCC"> to client</font>

749
00:30:56,020 --> 00:31:03,309
IP and excellent<font color="#CCCCCC"> ex via IP</font><font color="#E5E5E5"> can be used</font>

750
00:30:58,270 --> 00:31:07,480
in exactly the<font color="#CCCCCC"> same way</font><font color="#E5E5E5"> also for some</font>

751
00:31:03,309 --> 00:31:10,090
reason<font color="#E5E5E5"> capsular will fetch any URL that</font>

752
00:31:07,480 --> 00:31:11,830
you specify<font color="#E5E5E5"> provided</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> you specify it</font>

753
00:31:10,090 --> 00:31:13,990
with the same parameter name twice<font color="#CCCCCC"> I</font>

754
00:31:11,830 --> 00:31:16,178
have no idea why<font color="#E5E5E5"> they're doing that</font><font color="#CCCCCC"> I</font>

755
00:31:13,990 --> 00:31:18,040
only found<font color="#E5E5E5"> it by accident because</font><font color="#CCCCCC"> a bug</font>

756
00:31:16,179 --> 00:31:20,830
in my<font color="#CCCCCC"> code meant that URL famis has got</font>

757
00:31:18,040 --> 00:31:22,299
specified twice and I don't know if<font color="#E5E5E5"> it's</font>

758
00:31:20,830 --> 00:31:23,949
exploitable because they don't<font color="#CCCCCC"> have a</font>

759
00:31:22,299 --> 00:31:26,350
bug<font color="#CCCCCC"> bounty program so I'm not allowed to</font>

760
00:31:23,950 --> 00:31:27,059
actually<font color="#E5E5E5"> try</font><font color="#CCCCCC"> and find out but there</font><font color="#E5E5E5"> you</font>

761
00:31:26,350 --> 00:31:30,040
go

762
00:31:27,059 --> 00:31:31,899
so say<font color="#E5E5E5"> that a site is stretching the URL</font>

763
00:31:30,040 --> 00:31:33,730
specified in them<font color="#CCCCCC"> afirma header I so</font>

764
00:31:31,900 --> 00:31:35,410
what what<font color="#E5E5E5"> can you do well one option is</font>

765
00:31:33,730 --> 00:31:36,970
<font color="#E5E5E5">to try an off-the-shelf</font><font color="#CCCCCC"> exploit</font><font color="#E5E5E5"> for</font>

766
00:31:35,410 --> 00:31:38,980
<font color="#E5E5E5">example you can make them connect to</font>

767
00:31:36,970 --> 00:31:41,110
your server and<font color="#CCCCCC"> run responder</font><font color="#E5E5E5"> on your</font>

768
00:31:38,980 --> 00:31:43,120
server which is a<font color="#E5E5E5"> wonderful piece</font><font color="#CCCCCC"> of</font>

769
00:31:41,110 --> 00:31:45,399
code that<font color="#E5E5E5"> tries</font><font color="#CCCCCC"> to trick connecting</font>

770
00:31:43,120 --> 00:31:49,270
clients into linking credentials<font color="#E5E5E5"> to your</font>

771
00:31:45,400 --> 00:31:51,190
server<font color="#CCCCCC"> I out</font><font color="#E5E5E5"> on all of my targets it</font>

772
00:31:49,270 --> 00:31:53,139
didn't work<font color="#E5E5E5"> on any of them but while I</font>

773
00:31:51,190 --> 00:31:54,520
was<font color="#E5E5E5"> trying it out some random guy with</font>

774
00:31:53,140 --> 00:31:57,700
the vulnerability scanner hit my server

775
00:31:54,520 --> 00:32:01,360
<font color="#CCCCCC">and did get</font><font color="#E5E5E5"> exploited so I still</font><font color="#CCCCCC"> count</font>

776
00:31:57,700 --> 00:32:05,230
<font color="#E5E5E5">that as a kind of win you can also trow</font>

777
00:32:01,360 --> 00:32:06,820
a pacemaker<font color="#E5E5E5"> which is and which is a</font>

778
00:32:05,230 --> 00:32:09,940
<font color="#E5E5E5">Python the fake as a cell server that</font>

779
00:32:06,820 --> 00:32:12,610
tries the<font color="#CCCCCC"> lesser-used client hardly an</font>

780
00:32:09,940 --> 00:32:14,620
attack on<font color="#E5E5E5"> connecting clients and I did</font>

781
00:32:12,610 --> 00:32:16,659
work on one of my targets so honest I

782
00:32:14,620 --> 00:32:18,520
thought I had blind<font color="#CCCCCC"> server</font><font color="#E5E5E5"> side</font><font color="#CCCCCC"> request</font>

783
00:32:16,660 --> 00:32:20,440
forgery on<font color="#E5E5E5"> I was</font><font color="#CCCCCC"> able to</font><font color="#E5E5E5"> make them</font>

784
00:32:18,520 --> 00:32:22,410
connect to my server<font color="#E5E5E5"> and</font><font color="#CCCCCC"> rida memory</font>

785
00:32:20,440 --> 00:32:26,549
from their<font color="#E5E5E5"> back-end which was quite cool</font>

786
00:32:22,410 --> 00:32:29,590
<font color="#E5E5E5">also you can do you can use tools</font><font color="#CCCCCC"> like</font>

787
00:32:26,549 --> 00:32:33,040
tough to<font color="#CCCCCC"> do tcp/ip fingerprinting</font><font color="#E5E5E5"> and</font>

788
00:32:29,590 --> 00:32:34,449
<font color="#CCCCCC">they're like but that's</font><font color="#E5E5E5"> a bit boring why</font>

789
00:32:33,040 --> 00:32:36,639
<font color="#E5E5E5">off-the-shelf exploits only get you so</font>

790
00:32:34,450 --> 00:32:40,750
far<font color="#CCCCCC"> what else can you do</font><font color="#E5E5E5"> well you</font><font color="#CCCCCC"> can do</font>

791
00:32:36,640 --> 00:32:43,299
more<font color="#CCCCCC"> Oh asked so you will</font><font color="#E5E5E5"> have found</font>

792
00:32:40,750 --> 00:32:44,530
<font color="#E5E5E5">this behavior using</font><font color="#CCCCCC"> a pingback technique</font>

793
00:32:43,299 --> 00:32:46,600
but that doesn't mean<font color="#E5E5E5"> you</font><font color="#CCCCCC"> have to stop</font>

794
00:32:44,530 --> 00:32:48,519
using those techniques<font color="#E5E5E5"> you can take the</font>

795
00:32:46,600 --> 00:32:50,559
<font color="#E5E5E5">latest struts to remote code execution</font>

796
00:32:48,519 --> 00:32:52,450
<font color="#E5E5E5">the week and revite the exploit so it</font>

797
00:32:50,559 --> 00:32:54,789
<font color="#CCCCCC">triggers a ping back</font><font color="#E5E5E5"> and then make their</font>

798
00:32:52,450 --> 00:32:56,799
afirma<font color="#E5E5E5"> caller spray that payload across</font>

799
00:32:54,789 --> 00:33:00,609
their<font color="#CCCCCC"> own internal network</font><font color="#E5E5E5"> and maybe</font>

800
00:32:56,799 --> 00:33:03,209
you'll get some shouts<font color="#E5E5E5"> even better some</font>

801
00:33:00,609 --> 00:33:06,070
<font color="#CCCCCC">of these</font><font color="#E5E5E5"> clients that fetch</font><font color="#CCCCCC"> the referrer</font>

802
00:33:03,209 --> 00:33:09,070
<font color="#E5E5E5">vendor the page that they fetch using</font>

803
00:33:06,070 --> 00:33:11,080
phantom<font color="#E5E5E5"> Jes or the like</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> that means</font>

804
00:33:09,070 --> 00:33:13,119
that we can<font color="#E5E5E5"> make them spray a cross-site</font>

805
00:33:11,080 --> 00:33:16,269
scripting payload across their<font color="#CCCCCC"> own</font>

806
00:33:13,119 --> 00:33:18,399
internal network<font color="#CCCCCC"> and if that works then</font>

807
00:33:16,269 --> 00:33:21,039
we can inject a beef hook onto<font color="#CCCCCC"> that site</font>

808
00:33:18,399 --> 00:33:23,049
<font color="#E5E5E5">and we've got full access like</font>

809
00:33:21,039 --> 00:33:24,879
persistent<font color="#E5E5E5"> access to an internal website</font>

810
00:33:23,049 --> 00:33:28,619
<font color="#CCCCCC">which is pretty nice so I've decided to</font>

811
00:33:24,879 --> 00:33:31,988
dub this blind reflected server-side XSS

812
00:33:28,619 --> 00:33:35,228
also depending<font color="#E5E5E5"> on how they implement</font>

813
00:33:31,989 --> 00:33:37,239
cross protocol access restrictions in

814
00:33:35,229 --> 00:33:39,639
this thick line that they've been<font color="#E5E5E5"> doing</font>

815
00:33:37,239 --> 00:33:43,109
pages with you can potentially<font color="#E5E5E5"> get XSS</font>

816
00:33:39,639 --> 00:33:45,248
in local files like<font color="#CCCCCC"> Fox</font><font color="#E5E5E5"> elf</font><font color="#CCCCCC"> environment</font>

817
00:33:43,109 --> 00:33:47,499
that can mean if you can pull that<font color="#E5E5E5"> off</font>

818
00:33:45,249 --> 00:33:50,169
<font color="#CCCCCC">that can mean that you can potentially</font>

819
00:33:47,499 --> 00:33:52,179
<font color="#CCCCCC">use</font><font color="#E5E5E5"> javascript in a local file like that</font>

820
00:33:50,169 --> 00:33:54,459
to read files from their file system on

821
00:33:52,179 --> 00:34:00,159
their server which is once again<font color="#E5E5E5"> pretty</font>

822
00:33:54,459 --> 00:34:01,809
nice in fact if<font color="#E5E5E5"> they're rendering there</font>

823
00:34:00,159 --> 00:34:03,279
<font color="#CCCCCC">are loads of interesting things and</font>

824
00:34:01,809 --> 00:34:05,349
loads of questions<font color="#CCCCCC"> that it rates its for</font>

825
00:34:03,279 --> 00:34:07,089
example do they<font color="#CCCCCC"> even enforce the same</font>

826
00:34:05,349 --> 00:34:08,859
<font color="#E5E5E5">origin</font><font color="#CCCCCC"> policy because some of them don't</font>

827
00:34:07,089 --> 00:34:10,239
<font color="#CCCCCC">and that means you can basically</font><font color="#E5E5E5"> use</font>

828
00:34:08,859 --> 00:34:13,239
them as a permanent proxy with the<font color="#E5E5E5"> right</font>

829
00:34:10,239 --> 00:34:17,168
JavaScript code also<font color="#E5E5E5"> maybe you can open</font>

830
00:34:13,239 --> 00:34:18,908
<font color="#CCCCCC">a</font><font color="#E5E5E5"> pop-up that subsequently won't get</font>

831
00:34:17,168 --> 00:34:21,190
closed giving yourself<font color="#E5E5E5"> persistent</font>

832
00:34:18,909 --> 00:34:22,419
JavaScript execution<font color="#CCCCCC"> on their server</font><font color="#E5E5E5"> and</font>

833
00:34:21,190 --> 00:34:25,359
you know what plugins<font color="#CCCCCC"> do they support</font>

834
00:34:22,418 --> 00:34:27,848
<font color="#CCCCCC">that</font><font color="#E5E5E5"> could be interesting to answer</font>

835
00:34:25,359 --> 00:34:30,250
these<font color="#E5E5E5"> questions</font><font color="#CCCCCC"> my colleague</font><font color="#E5E5E5"> Gareth</font>

836
00:34:27,849 --> 00:34:32,919
<font color="#CCCCCC">Hayes wrote a tool called</font><font color="#E5E5E5"> hack ability</font>

837
00:34:30,250 --> 00:34:34,659
this<font color="#E5E5E5"> is a website that</font><font color="#CCCCCC"> you can connect</font>

838
00:34:32,918 --> 00:34:37,629
you in<font color="#E5E5E5"> a browser or anything that will</font>

839
00:34:34,659 --> 00:34:39,399
render<font color="#CCCCCC"> a webpage</font><font color="#E5E5E5"> and it</font><font color="#CCCCCC"> will perform</font>

840
00:34:37,629 --> 00:34:41,489
<font color="#E5E5E5">tests to try and</font><font color="#CCCCCC"> answer these questions</font>

841
00:34:39,399 --> 00:34:45,578
<font color="#CCCCCC">for</font><font color="#E5E5E5"> you it will show</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> the answers</font>

842
00:34:41,489 --> 00:34:47,379
visually<font color="#E5E5E5"> and</font><font color="#CCCCCC"> it will also trigger</font>

843
00:34:45,579 --> 00:34:49,059
requests to the server so even if this

844
00:34:47,379 --> 00:34:50,469
<font color="#E5E5E5">is a blind server side request forgery</font>

845
00:34:49,059 --> 00:34:52,149
vulnerability<font color="#E5E5E5"> that you've got you</font><font color="#CCCCCC"> can</font>

846
00:34:50,469 --> 00:34:55,449
just look in<font color="#CCCCCC"> your server logs</font><font color="#E5E5E5"> and see</font>

847
00:34:52,149 --> 00:34:57,900
what the results<font color="#E5E5E5"> of these tests are with</font>

848
00:34:55,449 --> 00:35:01,058
this particular example<font color="#CCCCCC"> I've pointed</font>

849
00:34:57,900 --> 00:35:02,210
parity at this which is the second most

850
00:35:01,059 --> 00:35:04,369
<font color="#E5E5E5">popular Ethan</font>

851
00:35:02,210 --> 00:35:05,900
client<font color="#CCCCCC"> most</font><font color="#E5E5E5"> notable because last</font><font color="#CCCCCC"> week</font>

852
00:35:04,369 --> 00:35:07,450
someone<font color="#E5E5E5"> hacked it and stole</font><font color="#CCCCCC"> 30 million</font>

853
00:35:05,900 --> 00:35:10,760
dollars worth of<font color="#CCCCCC"> beef earring using</font><font color="#E5E5E5"> it</font>

854
00:35:07,450 --> 00:35:13,549
<font color="#E5E5E5">and it integrates into a web browser and</font>

855
00:35:10,760 --> 00:35:14,839
what hack ability has spotted<font color="#E5E5E5"> here is</font>

856
00:35:13,550 --> 00:35:17,480
some interesting<font color="#CCCCCC"> objects in the</font>

857
00:35:14,839 --> 00:35:19,490
JavaScript environment<font color="#CCCCCC"> so these are</font>

858
00:35:17,480 --> 00:35:21,260
objects<font color="#CCCCCC"> that</font><font color="#E5E5E5"> are</font><font color="#CCCCCC"> not</font><font color="#E5E5E5"> present in a normal</font>

859
00:35:19,490 --> 00:35:23,509
browser<font color="#CCCCCC"> environment which strongly</font>

860
00:35:21,260 --> 00:35:26,270
suggests<font color="#E5E5E5"> that parity itself has injected</font>

861
00:35:23,510 --> 00:35:28,940
<font color="#E5E5E5">them and sure enough using those you</font><font color="#CCCCCC"> can</font>

862
00:35:26,270 --> 00:35:32,290
do things<font color="#CCCCCC"> like you can get the current</font>

863
00:35:28,940 --> 00:35:34,250
<font color="#E5E5E5">uses he theorem wallet my ID</font><font color="#CCCCCC"> and</font>

864
00:35:32,290 --> 00:35:36,890
potentially see what<font color="#E5E5E5"> balance they have</font>

865
00:35:34,250 --> 00:35:38,119
in<font color="#CCCCCC"> that wallet and also initiate</font>

866
00:35:36,890 --> 00:35:44,029
transactions and other kinds<font color="#E5E5E5"> of</font>

867
00:35:38,119 --> 00:35:45,260
interesting<font color="#CCCCCC"> stuff ok</font><font color="#E5E5E5"> it's time</font><font color="#CCCCCC"> for one</font>

868
00:35:44,030 --> 00:35:49,220
final<font color="#E5E5E5"> exploit this one's my favorite</font>

869
00:35:45,260 --> 00:35:50,900
<font color="#CCCCCC">I've got</font><font color="#E5E5E5"> the best</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> last here I sent</font>

870
00:35:49,220 --> 00:35:53,270
that payload that<font color="#E5E5E5"> I showed you</font><font color="#CCCCCC"> right at</font>

871
00:35:50,900 --> 00:35:55,119
<font color="#E5E5E5">the start but</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> request they didn't</font>

872
00:35:53,270 --> 00:35:57,650
get<font color="#CCCCCC"> Miss</font><font color="#E5E5E5"> routed it got routed correctly</font>

873
00:35:55,119 --> 00:36:01,580
<font color="#E5E5E5">but several seconds after I sent it I</font>

874
00:35:57,650 --> 00:36:04,700
received some attempts to request

875
00:36:01,580 --> 00:36:06,259
certain resources<font color="#E5E5E5"> for my server and I</font>

876
00:36:04,700 --> 00:36:09,770
confirmed if I try to load a history of

877
00:36:06,260 --> 00:36:12,320
<font color="#E5E5E5">blimps page on this military</font><font color="#CCCCCC"> website</font><font color="#E5E5E5"> and</font>

878
00:36:09,770 --> 00:36:14,570
<font color="#E5E5E5">on why is this</font><font color="#CCCCCC"> slyly then the server</font>

879
00:36:12,320 --> 00:36:18,109
<font color="#E5E5E5">would try to grab a picture of a blimp</font>

880
00:36:14,570 --> 00:36:19,970
from my server<font color="#E5E5E5"> which is pretty weird</font><font color="#CCCCCC"> I</font>

881
00:36:18,109 --> 00:36:22,250
wonder<font color="#E5E5E5"> if we can exploit that</font><font color="#CCCCCC"> it's</font>

882
00:36:19,970 --> 00:36:24,939
obvious that well the<font color="#CCCCCC"> only explanation</font>

883
00:36:22,250 --> 00:36:27,920
<font color="#CCCCCC">for this</font><font color="#E5E5E5"> is that</font><font color="#CCCCCC"> there's some</font><font color="#E5E5E5"> kind of</font>

884
00:36:24,940 --> 00:36:30,170
reverse proxy some kind of caching

885
00:36:27,920 --> 00:36:31,790
reverse proxy that's scanning the

886
00:36:30,170 --> 00:36:33,230
sponsors<font color="#CCCCCC"> from the application</font><font color="#E5E5E5"> looking</font>

887
00:36:31,790 --> 00:36:35,450
for resource import statements like

888
00:36:33,230 --> 00:36:40,570
image source equals<font color="#E5E5E5"> and is then fetching</font>

889
00:36:35,450 --> 00:36:42,799
those presumably<font color="#E5E5E5"> so it can cache it so</font>

890
00:36:40,570 --> 00:36:45,349
maybe<font color="#E5E5E5"> I can send a request to the</font>

891
00:36:42,800 --> 00:36:48,910
application that<font color="#CCCCCC"> triggers a response</font><font color="#E5E5E5"> to</font>

892
00:36:45,349 --> 00:36:51,020
me that makes the reverse proxy fetch an

893
00:36:48,910 --> 00:36:53,598
internal URL that<font color="#E5E5E5"> I don't have</font><font color="#CCCCCC"> access to</font>

894
00:36:51,020 --> 00:36:58,250
<font color="#E5E5E5">and cache the response and then I can</font>

895
00:36:53,599 --> 00:37:01,369
just<font color="#CCCCCC"> grab it out the cache</font><font color="#E5E5E5"> hopefully so</font>

896
00:36:58,250 --> 00:37:03,890
I found some some normal reflected XSS

897
00:37:01,369 --> 00:37:07,250
in the target<font color="#E5E5E5"> and I used it to inject</font>

898
00:37:03,890 --> 00:37:09,290
the following the spots so from the

899
00:37:07,250 --> 00:37:11,150
proxies point of view this<font color="#CCCCCC"> is definitely</font>

900
00:37:09,290 --> 00:37:12,400
a static image import<font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> using the</font>

901
00:37:11,150 --> 00:37:16,270
image source<font color="#E5E5E5"> equals state</font>

902
00:37:12,400 --> 00:37:18,970
and the foil name ends in a<font color="#CCCCCC"> dot jpg but</font>

903
00:37:16,270 --> 00:37:21,730
from the<font color="#CCCCCC"> backend the</font><font color="#E5E5E5"> server's point of</font>

904
00:37:18,970 --> 00:37:25,480
view this is<font color="#CCCCCC"> a</font><font color="#E5E5E5"> request</font><font color="#CCCCCC"> to the root</font><font color="#E5E5E5"> of a</font>

905
00:37:21,730 --> 00:37:27,640
PHP application<font color="#E5E5E5"> so the proxy saw that</font>

906
00:37:25,480 --> 00:37:29,920
response that<font color="#CCCCCC"> I injected through XSS</font>

907
00:37:27,640 --> 00:37:32,379
<font color="#E5E5E5">they fetch that euro</font><font color="#CCCCCC"> and they cashed it</font>

908
00:37:29,920 --> 00:37:36,190
and then I was able<font color="#E5E5E5"> to grab that out</font><font color="#CCCCCC"> of</font>

909
00:37:32,380 --> 00:37:37,960
the cache<font color="#E5E5E5"> so the key problem here is</font>

910
00:37:36,190 --> 00:37:40,029
<font color="#CCCCCC">that we've just got a foxy that's really</font>

911
00:37:37,960 --> 00:37:41,589
enthusiastic it will<font color="#E5E5E5"> cache anything it</font>

912
00:37:40,029 --> 00:37:43,690
<font color="#CCCCCC">sees regardless of what the main it's on</font>

913
00:37:41,589 --> 00:37:45,609
and it has no concept of things that

914
00:37:43,690 --> 00:37:50,770
should be internally accessible<font color="#CCCCCC"> and</font>

915
00:37:45,609 --> 00:37:56,380
things they should not<font color="#E5E5E5"> okay looks like</font>

916
00:37:50,770 --> 00:38:01,240
<font color="#CCCCCC">it's time</font><font color="#E5E5E5"> for a brief demo I'm going to</font>

917
00:37:56,380 --> 00:38:09,400
demo collaborate it everywhere<font color="#E5E5E5"> so I'm</font>

918
00:38:01,240 --> 00:38:13,390
just gonna enable that<font color="#E5E5E5"> okay it works</font>

919
00:38:09,400 --> 00:38:16,390
good<font color="#CCCCCC"> so you you can see</font><font color="#E5E5E5"> here it's worked</font>

920
00:38:13,390 --> 00:38:18,700
out what my IP<font color="#CCCCCC"> address is</font>

921
00:38:16,390 --> 00:38:20,170
that's because<font color="#E5E5E5"> sometimes when you're</font>

922
00:38:18,700 --> 00:38:22,720
browsing your browser will cause

923
00:38:20,170 --> 00:38:24,099
interactions and<font color="#E5E5E5"> if you don't realize</font>

924
00:38:22,720 --> 00:38:26,169
<font color="#CCCCCC">that Zuko's</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> them</font><font color="#E5E5E5"> you can get very</font>

925
00:38:24,099 --> 00:38:26,920
excited<font color="#E5E5E5"> before you found out found out</font>

926
00:38:26,170 --> 00:38:29,079
that you<font color="#E5E5E5"> haven't really achieved</font>

927
00:38:26,920 --> 00:38:31,539
anything whatsoever<font color="#E5E5E5"> so now I'm gonna</font>

928
00:38:29,079 --> 00:38:34,299
<font color="#E5E5E5">load Firefox and it's gonna ping open a</font>

929
00:38:31,539 --> 00:38:35,980
bunch<font color="#E5E5E5"> of</font><font color="#CCCCCC"> websites please no I'm not</font>

930
00:38:34,299 --> 00:38:37,049
demonstrating vulnerabilities in these

931
00:38:35,980 --> 00:38:40,140
<font color="#E5E5E5">websites I'm just demonstrating</font>

932
00:38:37,049 --> 00:38:42,549
<font color="#E5E5E5">interesting behavior in these websites</font>

933
00:38:40,140 --> 00:38:44,410
as far<font color="#E5E5E5"> as I know none of these issues</font>

934
00:38:42,549 --> 00:38:49,420
<font color="#CCCCCC">that I'm none of these websites</font><font color="#E5E5E5"> have</font>

935
00:38:44,410 --> 00:38:51,308
<font color="#E5E5E5">exploitable issues I mentioned Facebook</font>

936
00:38:49,420 --> 00:38:52,990
<font color="#CCCCCC">but that one's gonna happen</font><font color="#E5E5E5"> in 26 hours</font>

937
00:38:51,309 --> 00:38:58,390
<font color="#E5E5E5">times so you're not actually gonna see</font>

938
00:38:52,990 --> 00:39:01,598
that<font color="#E5E5E5"> one so if we look in burp then you</font>

939
00:38:58,390 --> 00:39:03,098
can see that's the normal<font color="#E5E5E5"> request that</font>

940
00:39:01,599 --> 00:39:04,960
the<font color="#CCCCCC"> browser</font><font color="#E5E5E5"> sent but collaborator</font>

941
00:39:03,099 --> 00:39:07,029
everywhere has rewritten it and it's

942
00:39:04,960 --> 00:39:08,619
<font color="#E5E5E5">injected a lot of payloads</font>

943
00:39:07,029 --> 00:39:09,789
it's called<font color="#E5E5E5"> collaborate everywhere</font>

944
00:39:08,619 --> 00:39:13,210
because<font color="#E5E5E5"> it</font><font color="#CCCCCC"> just injects payloads</font>

945
00:39:09,789 --> 00:39:16,089
everywhere<font color="#E5E5E5"> and if we look at the target</font>

946
00:39:13,210 --> 00:39:20,020
then we can see<font color="#E5E5E5"> that we've got some</font>

947
00:39:16,089 --> 00:39:23,788
<font color="#CCCCCC">interactions so for example here strike</font>

948
00:39:20,020 --> 00:39:25,650
<font color="#E5E5E5">after</font><font color="#CCCCCC"> two seconds has fetched</font><font color="#E5E5E5"> the euro</font>

949
00:39:23,789 --> 00:39:29,609
specified

950
00:39:25,650 --> 00:39:31,470
in the referer header<font color="#E5E5E5"> over there</font><font color="#CCCCCC"> and we</font>

951
00:39:29,609 --> 00:39:34,380
<font color="#E5E5E5">can see</font><font color="#CCCCCC"> that they using</font><font color="#E5E5E5"> Ruby and the</font>

952
00:39:31,470 --> 00:39:37,890
next thing to do would be<font color="#E5E5E5"> to point that</font>

953
00:39:34,380 --> 00:39:41,039
attack ability and work out how how to

954
00:39:37,890 --> 00:39:43,410
exploit it<font color="#E5E5E5"> but also here's wonderful</font>

955
00:39:41,039 --> 00:39:46,349
Netflix<font color="#E5E5E5"> I triggered this earlier because</font>

956
00:39:43,410 --> 00:39:48,598
<font color="#CCCCCC">there's a nine</font><font color="#E5E5E5"> hour and</font><font color="#CCCCCC"> 30 minute time</font>

957
00:39:46,349 --> 00:39:50,009
gap in between<font color="#E5E5E5"> you send you send in the</font>

958
00:39:48,599 --> 00:39:52,710
payload<font color="#CCCCCC"> and</font><font color="#E5E5E5"> them getting</font><font color="#CCCCCC"> the response</font>

959
00:39:50,009 --> 00:39:56,039
<font color="#E5E5E5">yeah interestingly here they claim that</font>

960
00:39:52,710 --> 00:40:01,319
<font color="#CCCCCC">they</font><font color="#E5E5E5"> using an iPhone but they also claim</font>

961
00:39:56,039 --> 00:40:07,980
<font color="#CCCCCC">to be using an x86 CPU so yeah I know</font>

962
00:40:01,319 --> 00:40:10,980
which one I believe<font color="#CCCCCC"> also we can see some</font>

963
00:40:07,980 --> 00:40:12,990
people<font color="#E5E5E5"> using the true client IP header</font>

964
00:40:10,980 --> 00:40:16,200
which is<font color="#E5E5E5"> less well known these guys</font>

965
00:40:12,990 --> 00:40:18,808
fetch it after quite a few<font color="#CCCCCC"> hours and</font>

966
00:40:16,200 --> 00:40:21,149
<font color="#E5E5E5">interestingly so these two payloads both</font>

967
00:40:18,809 --> 00:40:23,430
come from Starbucks but they come from

968
00:40:21,150 --> 00:40:26,549
<font color="#CCCCCC">completely different servers after a</font>

969
00:40:23,430 --> 00:40:28,649
<font color="#E5E5E5">different length of time so this has</font>

970
00:40:26,549 --> 00:40:30,690
given<font color="#E5E5E5"> you a point as</font><font color="#CCCCCC"> to a back-end</font>

971
00:40:28,650 --> 00:40:31,650
system<font color="#E5E5E5"> so as well as</font><font color="#CCCCCC"> being useful</font>

972
00:40:30,690 --> 00:40:33,720
information<font color="#E5E5E5"> that they support this</font>

973
00:40:31,650 --> 00:40:35,880
header<font color="#E5E5E5"> you now know what back</font><font color="#CCCCCC"> in the</font>

974
00:40:33,720 --> 00:40:37,529
<font color="#E5E5E5">analytic system they're</font><font color="#CCCCCC"> using and maybe</font>

975
00:40:35,880 --> 00:40:39,450
you can just<font color="#E5E5E5"> go find their website</font><font color="#CCCCCC"> and</font>

976
00:40:37,529 --> 00:40:42,839
exploit that<font color="#E5E5E5"> if you're a proper hacker</font>

977
00:40:39,450 --> 00:40:50,359
<font color="#E5E5E5">and similarly loads of guys use</font><font color="#CCCCCC"> X for it</font>

978
00:40:42,839 --> 00:40:50,359
for<font color="#E5E5E5"> okay</font>

979
00:40:51,460 --> 00:40:57,340
<font color="#E5E5E5">all right so as far as replicating these</font>

980
00:40:54,730 --> 00:40:58,600
issues<font color="#E5E5E5"> goes you can like you can</font>

981
00:40:57,340 --> 00:41:00,100
replicate them all of them are using

982
00:40:58,600 --> 00:41:03,819
burp of course so I wouldn't found them

983
00:41:00,100 --> 00:41:05,290
<font color="#E5E5E5">as of today there's an update to burp</font>

984
00:41:03,820 --> 00:41:07,600
<font color="#CCCCCC">that will make it scanner or to</font>

985
00:41:05,290 --> 00:41:09,790
automatically find all of<font color="#CCCCCC"> them all of</font>

986
00:41:07,600 --> 00:41:11,890
<font color="#E5E5E5">the vulnerabilities</font><font color="#CCCCCC"> are found</font><font color="#E5E5E5"> about now</font>

987
00:41:09,790 --> 00:41:14,050
you could replicate these issues using

988
00:41:11,890 --> 00:41:15,640
<font color="#CCCCCC">this app if it wasn't for issue</font><font color="#E5E5E5"> one</font>

989
00:41:14,050 --> 00:41:17,320
<font color="#E5E5E5">three one eight which I'm</font><font color="#CCCCCC"> imported to</font>

990
00:41:15,640 --> 00:41:19,330
them a few<font color="#CCCCCC"> years ago which</font><font color="#E5E5E5"> means that if</font>

991
00:41:17,320 --> 00:41:21,160
<font color="#E5E5E5">you change the host header in zap does</font>

992
00:41:19,330 --> 00:41:23,770
that<font color="#E5E5E5"> will send that request to the wrong</font>

993
00:41:21,160 --> 00:41:26,799
place<font color="#CCCCCC"> so if you want to</font><font color="#E5E5E5"> use an</font>

994
00:41:23,770 --> 00:41:29,400
<font color="#CCCCCC">open-source tool I'd recommend using</font><font color="#E5E5E5"> MIT</font>

995
00:41:26,800 --> 00:41:32,080
<font color="#CCCCCC">M</font><font color="#E5E5E5"> proxy it's extremely late looking so</font>

996
00:41:29,400 --> 00:41:34,180
now if you want<font color="#CCCCCC"> to help your clients</font>

997
00:41:32,080 --> 00:41:35,830
replicate this issues they might<font color="#CCCCCC"> not be</font>

998
00:41:34,180 --> 00:41:37,049
familiar<font color="#CCCCCC"> with any</font><font color="#E5E5E5"> of these tools</font><font color="#CCCCCC"> so you</font>

999
00:41:35,830 --> 00:41:40,270
probably want to give them some kind<font color="#E5E5E5"> of</font>

1000
00:41:37,050 --> 00:41:42,820
shell commands you can use curl to

1001
00:41:40,270 --> 00:41:44,410
replicate some of<font color="#CCCCCC"> these</font><font color="#E5E5E5"> attacks but the</font>

1002
00:41:42,820 --> 00:41:46,060
more<font color="#CCCCCC"> mount</font><font color="#E5E5E5"> the ones with in a more</font>

1003
00:41:44,410 --> 00:41:48,819
malformed<font color="#E5E5E5"> the more advanced attacks</font>

1004
00:41:46,060 --> 00:41:51,790
<font color="#E5E5E5">can't be done using curl so you'll have</font>

1005
00:41:48,820 --> 00:41:53,620
to use<font color="#CCCCCC"> end cap and then just pipe that</font>

1006
00:41:51,790 --> 00:41:56,350
<font color="#E5E5E5">your so you have to use echo and then</font>

1007
00:41:53,620 --> 00:41:58,810
pipe that into<font color="#CCCCCC"> end cap or open SSL as</font>

1008
00:41:56,350 --> 00:42:01,299
appropriate also you may need to use<font color="#CCCCCC"> a</font>

1009
00:41:58,810 --> 00:42:03,850
<font color="#E5E5E5">server name</font><font color="#CCCCCC"> Drive active with open SSL</font>

1010
00:42:01,300 --> 00:42:05,500
to set the server name indicator field

1011
00:42:03,850 --> 00:42:12,700
<font color="#E5E5E5">to make</font><font color="#CCCCCC"> sure that it gets routed to the</font>

1012
00:42:05,500 --> 00:42:15,730
right<font color="#E5E5E5"> place</font><font color="#CCCCCC"> so how do you</font><font color="#E5E5E5"> prevent these</font>

1013
00:42:12,700 --> 00:42:18,640
attacks<font color="#CCCCCC"> cool as far</font><font color="#E5E5E5"> as the reverse proxy</font>

1014
00:42:15,730 --> 00:42:20,050
attacks go I think you<font color="#CCCCCC"> just have to</font>

1015
00:42:18,640 --> 00:42:23,080
acknowledge<font color="#E5E5E5"> that reverse proxies</font><font color="#CCCCCC"> are</font>

1016
00:42:20,050 --> 00:42:25,660
designed to proxy traffic so they're

1017
00:42:23,080 --> 00:42:27,790
<font color="#E5E5E5">going to proxy traffic and only takes a</font>

1018
00:42:25,660 --> 00:42:30,160
tiny bug to make them proxy traffic to

1019
00:42:27,790 --> 00:42:32,980
the wrong place<font color="#CCCCCC"> as such they should be</font>

1020
00:42:30,160 --> 00:42:34,299
put in inside<font color="#E5E5E5"> a demilitarized zone where</font>

1021
00:42:32,980 --> 00:42:36,070
they don't<font color="#E5E5E5"> have</font><font color="#CCCCCC"> access to</font><font color="#E5E5E5"> anything</font>

1022
00:42:34,300 --> 00:42:38,130
sensitive<font color="#E5E5E5"> where they don't have</font><font color="#CCCCCC"> access</font>

1023
00:42:36,070 --> 00:42:42,250
<font color="#CCCCCC">to an</font><font color="#E5E5E5"> or thinking unauthenticated</font>

1024
00:42:38,130 --> 00:42:44,190
<font color="#E5E5E5">administration panels as for callers it</font>

1025
00:42:42,250 --> 00:42:47,740
may help<font color="#E5E5E5"> to</font><font color="#CCCCCC"> think of them as employees</font>

1026
00:42:44,190 --> 00:42:50,650
<font color="#E5E5E5">with really</font><font color="#CCCCCC"> old web browsers who click</font>

1027
00:42:47,740 --> 00:42:53,140
on every link<font color="#E5E5E5"> that you give them on the</font>

1028
00:42:50,650 --> 00:42:54,700
brighter<font color="#CCCCCC"> side</font><font color="#E5E5E5"> unlike employees they</font>

1029
00:42:53,140 --> 00:42:56,740
won't complain very much if you stick

1030
00:42:54,700 --> 00:42:59,830
<font color="#E5E5E5">them in a sandbox</font><font color="#CCCCCC"> so once again that's</font>

1031
00:42:56,740 --> 00:43:02,439
what I recommend<font color="#CCCCCC"> as for research</font><font color="#E5E5E5"> is what</font>

1032
00:42:59,830 --> 00:43:04,150
I recommend<font color="#E5E5E5"> welcoming</font>

1033
00:43:02,440 --> 00:43:05,650
researchers if you've got a bug<font color="#CCCCCC"> bounty</font>

1034
00:43:04,150 --> 00:43:07,589
program that's public and allow us

1035
00:43:05,650 --> 00:43:11,500
automated testing<font color="#E5E5E5"> I've probably already</font>

1036
00:43:07,589 --> 00:43:16,000
tested<font color="#E5E5E5"> your site so you can have a</font>

1037
00:43:11,500 --> 00:43:17,829
<font color="#E5E5E5">little</font><font color="#CCCCCC"> bit of peace of mind</font><font color="#E5E5E5"> so I see a</font>

1038
00:43:16,000 --> 00:43:19,839
<font color="#E5E5E5">lot of bug bounty programs that forbid</font>

1039
00:43:17,829 --> 00:43:21,160
automated<font color="#E5E5E5"> testing and I understand</font>

1040
00:43:19,839 --> 00:43:22,720
<font color="#E5E5E5">they're probably doing</font><font color="#CCCCCC"> that because</font><font color="#E5E5E5"> that</font>

1041
00:43:21,160 --> 00:43:24,339
otherwise they get flooded with traffic

1042
00:43:22,720 --> 00:43:26,200
by people scanning<font color="#E5E5E5"> them without</font><font color="#CCCCCC"> genetics</font>

1043
00:43:24,339 --> 00:43:28,180
and<font color="#CCCCCC"> burp millions of times</font><font color="#E5E5E5"> so what I</font>

1044
00:43:26,200 --> 00:43:30,040
recommend<font color="#CCCCCC"> doing</font><font color="#E5E5E5"> is saying please don't</font>

1045
00:43:28,180 --> 00:43:32,500
use off-the-shelf tools on our<font color="#E5E5E5"> website</font>

1046
00:43:30,040 --> 00:43:37,390
<font color="#CCCCCC">but still allowing the use of custom</font>

1047
00:43:32,500 --> 00:43:39,910
<font color="#E5E5E5">tools so the three key</font><font color="#CCCCCC"> takeaways</font><font color="#E5E5E5"> are the</font>

1048
00:43:37,390 --> 00:43:43,299
bug bounties enable white hat research

1049
00:43:39,910 --> 00:43:46,210
<font color="#E5E5E5">its scale load</font><font color="#CCCCCC"> balancers our VPNs for</font>

1050
00:43:43,300 --> 00:43:48,640
the public<font color="#E5E5E5"> and coolers our employees who</font>

1051
00:43:46,210 --> 00:43:50,200
click I'll take five<font color="#CCCCCC"> minutes</font><font color="#E5E5E5"> of</font>

1052
00:43:48,640 --> 00:43:51,549
<font color="#CCCCCC">questions now and if you have any</font><font color="#E5E5E5"> more</font>

1053
00:43:50,200 --> 00:43:53,919
after<font color="#E5E5E5"> that feel free to come and</font><font color="#CCCCCC"> speak</font>

1054
00:43:51,550 --> 00:43:55,900
to<font color="#E5E5E5"> me at the back</font><font color="#CCCCCC"> or</font><font color="#E5E5E5"> semi and email</font>

1055
00:43:53,920 --> 00:43:57,830
<font color="#E5E5E5">don't forget to follow me</font><font color="#CCCCCC"> on Twitter</font>

1056
00:43:55,900 --> 00:43:59,810
thank you<font color="#E5E5E5"> for listening</font>

1057
00:43:57,830 --> 00:44:04,009
[Applause]

1058
00:43:59,810 --> 00:44:04,009
[Music]

1059
00:44:04,230 --> 00:44:07,429
[Applause]

