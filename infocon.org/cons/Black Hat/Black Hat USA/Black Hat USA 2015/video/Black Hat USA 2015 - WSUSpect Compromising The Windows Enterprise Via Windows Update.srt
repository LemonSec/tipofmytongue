1
00:00:00,000 --> 00:00:06,049
you are in room lagoon K and you are
here to see her get it right here

2
00:00:06,049 --> 00:00:10,200
Paul stone and Alex Chapman and their
talk W suspect compromising the windows

3
00:00:10,200 --> 00:00:23,189
enterprise by a Windows Update turnover
you ok I'm going to start them so we're

4
00:00:23,189 --> 00:00:26,769
going to talk about Windows Update and
the kind of focus of that device all his

5
00:00:26,769 --> 00:00:31,549
windows update in an enterprise scenario
so to do a brief overview of what we

6
00:00:31,550 --> 00:00:36,940
gonna be looking up so first we're going
to talk about why besides a little

7
00:00:36,940 --> 00:00:44,430
update explosive attacks they think we
wanted to do with it

8
00:00:44,430 --> 00:00:51,559
drive is available by Windows Update and
I'm gonna be fun to UW sauce which is

9
00:00:51,559 --> 00:00:58,120
kind of enterprise variants that updates
W W sauce and we talked about how to

10
00:00:58,120 --> 00:01:02,669
compromise it in certain situations and
irresponsible we're gonna tell me how to

11
00:01:02,670 --> 00:01:05,420
fix their problems as well

12
00:01:05,420 --> 00:01:13,830
brief introductions were introduced Alex
we both are researchers we work for

13
00:01:13,830 --> 00:01:21,580
context information security based in
the UK so the question what happened is

14
00:01:21,580 --> 00:01:25,119
that they well what one question we had
which apparently a lot of people will

15
00:01:25,119 --> 00:01:31,360
share the same question is why is it so
damn slow food security perspective why

16
00:01:31,360 --> 00:01:35,360
we're here whenever they will be
interesting things but when is up there

17
00:01:35,360 --> 00:01:39,900
is it is a very privileged status
updates can be downloaded and installed

18
00:01:39,900 --> 00:01:45,360
by new me he says the number of it she
is so this potential death potential for

19
00:01:45,360 --> 00:01:52,220
elevation of privilege is getting about
when this update is it increases and

20
00:01:52,220 --> 00:01:58,689
decreases when it acts up its so in a
sense of these downloads and bonds goes

21
00:01:58,689 --> 00:02:01,320
over the internet which can be a
dangerous thing to do it's not

22
00:02:01,320 --> 00:02:07,469
improperly and obviously it is a
necessary thing you know every so often

23
00:02:07,469 --> 00:02:09,109
is patching

24
00:02:09,110 --> 00:02:13,260
and windows update lets you know when
there is a true self against liabilities

25
00:02:13,260 --> 00:02:18,630
and other books and so on and the
interesting thing about when this update

26
00:02:18,630 --> 00:02:24,760
which clearly Peter Peter interests
start with is that's known as much for

27
00:02:24,760 --> 00:02:28,000
carried available but when it updates
but there was also a lot of third-party

28
00:02:28,000 --> 00:02:36,350
code clean drivers so drivers were
talking about burning the candle and

29
00:02:36,350 --> 00:02:45,390
other stuff going on so good reasons to
look it up they finally seems a very few

30
00:02:45,390 --> 00:02:49,309
people have actually look at the past we
didn't find that much research on that

31
00:02:49,310 --> 00:02:57,160
so we thought we would have a look in a
brief overview of the various data

32
00:02:57,160 --> 00:03:03,600
components net update so when is a place
with a service that runs there's an

33
00:03:03,600 --> 00:03:09,620
executable colds wau CLT I know it
sounds cool but that's the thing that

34
00:03:09,620 --> 00:03:14,080
runs periodically and she checks for
updates to service to see if there's

35
00:03:14,080 --> 00:03:20,330
anything downloads business registry
keys which control things like health

36
00:03:20,330 --> 00:03:26,470
and updates check for when they get
planes which what serbs talk to and so

37
00:03:26,470 --> 00:03:31,900
on and that will propel itself the
actual the way that your computer talks

38
00:03:31,900 --> 00:03:39,090
nonstop service that's just a web
service that goes over HTTPS and we're

39
00:03:39,090 --> 00:03:45,590
going to take a look at these local
database that they keep track of what

40
00:03:45,590 --> 00:03:52,410
what it's been stalled and so on and
there's this CD Windows software

41
00:03:52,410 --> 00:03:55,700
distribution that's where a lot of the
stuff happens so they get down there

42
00:03:55,700 --> 00:04:01,619
then extracted them so warm and also if
you're looking into Sarah doing research

43
00:04:01,620 --> 00:04:05,970
in this area the log press release will
actually see what's going on the

44
00:04:05,970 --> 00:04:12,910
background so these are the kind of
things that we were looking at the start

45
00:04:12,910 --> 00:04:16,750
so just briefly what what stuff is there
on Windows Update so obviously there are

46
00:04:16,750 --> 00:04:20,940
security update says this critical
updates and I guess less critical

47
00:04:20,940 --> 00:04:26,370
security updates and other stuff too
general software update seems like it's

48
00:04:26,370 --> 00:04:32,770
explorer and obvious and so on but the
thing that caught our eye on his

49
00:04:32,770 --> 00:04:45,740
driver's side will hand over to Alex
about what hardware drivers actually

50
00:04:45,740 --> 00:04:51,080
kills us so by default when a new
devices plugged into a Windows machine

51
00:04:51,080 --> 00:04:55,669
news update will actually going download
and install the drivers and associated

52
00:04:55,670 --> 00:05:01,260
software for that but after so I don't
see some common ones like the nvidia

53
00:05:01,260 --> 00:05:04,830
control panel that sort of thing and she
come down as part of the Windows Update

54
00:05:04,830 --> 00:05:14,430
so the hardware vendors code to be
distributed by much so that drives you

55
00:05:14,430 --> 00:05:20,520
have to be signed by Microsoft but
actually as works of saying something

56
00:05:20,520 --> 00:05:22,060
guidelines fries fees

57
00:05:22,060 --> 00:05:27,690
Co qualities actually the responsibility
of the vendor so I'll say to do some

58
00:05:27,690 --> 00:05:30,120
checks they don't actually

59
00:05:30,120 --> 00:05:35,970
rigorous checking of the code submitted
them and ecotourism its them will

60
00:05:35,970 --> 00:05:40,750
actually be distracted by something
that's really interesting you've got

61
00:05:40,750 --> 00:05:44,840
third party vendors serving actually
very highly privileged codes were

62
00:05:44,840 --> 00:05:48,190
talking kernel drivers here running in
the core of the operating system to

63
00:05:48,190 --> 00:05:51,650
Microsoft and we're supposed to trust
them and the quality of their code to

64
00:05:51,650 --> 00:05:55,729
keep operating system security so

65
00:05:55,729 --> 00:06:00,339
I guess we will see what happens when
you plug it in a hardware device so you

66
00:06:00,339 --> 00:06:03,849
plug it in the deployment place service
will detect that a new device has been

67
00:06:03,849 --> 00:06:09,620
added to the system and as it to the
windows device tree if the driver is

68
00:06:09,620 --> 00:06:12,339
recognition of advice is recognizing the
driver available

69
00:06:12,339 --> 00:06:16,749
tribal be loaded and the device will
communicate and work as expected from

70
00:06:16,749 --> 00:06:22,469
there where the dry season recognized
the service will send the entire device

71
00:06:22,469 --> 00:06:29,058
tree up to it as a date so that every
single devices storm system Windows

72
00:06:29,059 --> 00:06:33,889
Update them responsible list of
available packages and downloads and

73
00:06:33,889 --> 00:06:39,249
drivers and in the update service will
pick the most relevant down and begin

74
00:06:39,249 --> 00:06:46,050
installation I guess as alluded to
earlier cities from practice to include

75
00:06:46,050 --> 00:06:50,909
other things than just drivers so you
will get user application support

76
00:06:50,909 --> 00:06:56,819
applications a number of Windows
Services insulation with it and other

77
00:06:56,819 --> 00:07:02,770
such software along with your required
kind of private so these are just a few

78
00:07:02,770 --> 00:07:07,799
of the processes involved so the service
running in SVC host there is a high

79
00:07:07,800 --> 00:07:16,360
issues that their hands off to drive
east direction to actually do the driver

80
00:07:16,360 --> 00:07:24,419
installation to place the co-driver in
in system32 we see the the run to a land

81
00:07:24,419 --> 00:07:30,128
deal known as the current users so
that's the user interface that pops up

82
00:07:30,129 --> 00:07:34,189
say winners are searching for a new
device driver for this has been a

83
00:07:34,189 --> 00:07:38,639
hardware device thing still etcetera
etcetera and then in this case there was

84
00:07:38,639 --> 00:07:42,789
an installation wizard that came along
with this driver installation and that's

85
00:07:42,789 --> 00:07:50,610
there again running a liberal issues are
underfunded lol 32 and so

86
00:07:50,610 --> 00:07:55,139
that's kind of what happened when you
plug in advice how would you go about

87
00:07:55,139 --> 00:08:02,310
researching so wassup has drivers for a
large number of types of devices so

88
00:08:02,310 --> 00:08:06,639
graphics cards bus controllers network
cards all of these types of things will

89
00:08:06,639 --> 00:08:12,689
trigger a Windows Update search and
download the drivers required drivers

90
00:08:12,689 --> 00:08:21,159
but installing these bits of hardware is
actually quite slow it's it's a very

91
00:08:21,159 --> 00:08:25,639
difficult thing to do on a on a large
scale basis so we wanted to do something

92
00:08:25,639 --> 00:08:30,650
that would be a bit easier and cheaper
primarily cheaper for us today so we

93
00:08:30,650 --> 00:08:36,610
thought we'd look at a subset drivers
USB device drivers so how do you go

94
00:08:36,610 --> 00:08:39,870
about finding other drivers on Windows
up there so the first thing we don't

95
00:08:39,870 --> 00:08:45,190
hear that all the USB device would find
the declining in actually monitoring

96
00:08:45,190 --> 00:08:52,490
what's happening in September there's
little doubt that but we ran out of

97
00:08:52,490 --> 00:08:56,519
myself quite quickly and we have this
sort of devices should have around you

98
00:08:56,519 --> 00:09:05,079
normal office so we were a number of
options we could go by as many devices

99
00:09:05,079 --> 00:09:08,359
as we could find but there's no
guarantee of some point all the devices

100
00:09:08,360 --> 00:09:16,430
costs are recognized and slow turnaround
so what do you wanna do we want to make

101
00:09:16,430 --> 00:09:20,880
this in some way make it easier for
cells so I first thought was right

102
00:09:20,880 --> 00:09:24,810
we've been playing around with based on
something about this sort of thing we

103
00:09:24,810 --> 00:09:30,989
could use one of those to emulate USB
device drivers and do things that we

104
00:09:30,990 --> 00:09:34,449
just brute force your speed minorities
and product IDs and will be done in

105
00:09:34,449 --> 00:09:39,839
actually quite a long time and also this
doesn't paralyze well these devices are

106
00:09:39,839 --> 00:09:43,170
quite expensive so getting an array of
10 of them

107
00:09:43,170 --> 00:09:50,589
gonna start up costs and actually not
not being all that quick so much better

108
00:09:50,589 --> 00:09:55,860
for gets up to this no such interface
inside Windows operating system itself

109
00:09:55,860 --> 00:10:00,970
so the operating system can only check
for updates applied to itself and its

110
00:10:00,970 --> 00:10:01,420
current

111
00:10:01,420 --> 00:10:08,870
so what if it bit of a bust their local
database does have some hardware drivers

112
00:10:08,870 --> 00:10:16,020
listed on your story but by no means all
of them so i didnt wanna do is be upset

113
00:10:16,020 --> 00:10:28,680
she searched the web web page to do this
so catalog to update on March so I don't

114
00:10:28,680 --> 00:10:34,729
have anyone remembers assist from the
spirit and it actually you can see so

115
00:10:34,730 --> 00:10:40,280
its requirements ie 6 or above and
actually an ActiveX control we're

116
00:10:40,280 --> 00:10:45,540
talking that area of the web but it does
include all modern updates for all women

117
00:10:45,540 --> 00:10:51,599
arrested so that's actually really so
first then see you go to the catalog

118
00:10:51,600 --> 00:10:58,390
with butter and cheese I six so we get
our iOS 6 out we will still expect

119
00:10:58,390 --> 00:11:04,060
control over so we can then actually
access to the catalogue interface and

120
00:11:04,060 --> 00:11:07,010
start searching for flights so this is
gonna make your life a lot easier and

121
00:11:07,010 --> 00:11:13,810
quicker and cheaper in terms of USB
device drivers will let you search the

122
00:11:13,810 --> 00:11:17,859
USB pendrive day and productivity which
is really useful or we can just go

123
00:11:17,860 --> 00:11:22,300
blanket search for the USB been writing
this allows us to find all device

124
00:11:22,300 --> 00:11:25,040
drivers for a particular vendor

125
00:11:25,040 --> 00:11:29,380
available Windows Update so that's kind
of come down from heaven brute force

126
00:11:29,380 --> 00:11:36,530
minorities and product IDs to purely
generalities so come up with a plan so

127
00:11:36,530 --> 00:11:40,550
we get a list of chinese cities are
actually published individual vendors

128
00:11:40,550 --> 00:11:41,370
are signed

129
00:11:41,370 --> 00:11:47,470
early days so we we find one of the
public place and we can use that in this

130
00:11:47,470 --> 00:11:54,650
catalog all USB products each individual
benda gonna make a database of the older

131
00:11:54,650 --> 00:12:03,949
drivers download movie is still
something like a plan star who did this

132
00:12:03,950 --> 00:12:17,160
work back in April this year recording
critic estate in this case

133
00:12:17,160 --> 00:12:27,350
scrapes we identified for him 25 vendors
that have updates on the twenty 5125

134
00:12:27,350 --> 00:12:32,810
unique driver update to its that she
brought down to a much smaller numbers

135
00:12:32,810 --> 00:12:35,459
only 4600

136
00:12:35,460 --> 00:12:40,250
downloading dammit ashes but still in
there is a lot of duplicates and

137
00:12:40,250 --> 00:12:46,400
obsolete driver versions and things so
in the end we were down to 2284 drivers

138
00:12:46,400 --> 00:12:51,740
download so settle down with going came
out with about 5 gigabytes worth of

139
00:12:51,740 --> 00:12:57,160
drivers must restore and tested and is
running shoe size from under 250

140
00:12:57,160 --> 00:13:05,510
megabytes down to just a few kilobytes
age so huge variety in this list as will

141
00:13:05,510 --> 00:13:09,569
expects a lot of standard devices so
printers memory cards

142
00:13:09,570 --> 00:13:14,540
devices except exception so lots of
weird and wonderful sounding things to

143
00:13:14,540 --> 00:13:19,199
my favorite various the AC market
electronics in till sensor solution Blue

144
00:13:19,200 --> 00:13:24,820
Book stay here but no whatever that is
sounds cool display just something that

145
00:13:24,820 --> 00:13:32,180
allows you to fight video via USB to
actually quite interesting device is

146
00:13:32,180 --> 00:13:37,670
there a lot of the listening devices
actually just ended in your speech

147
00:13:37,670 --> 00:13:43,920
Series driver so generic and less
interesting and some of the drive it

148
00:13:43,920 --> 00:13:48,810
down it's a just and built-in drive is
setting up the registry keys and did

149
00:13:48,810 --> 00:13:50,349
nothing else so

150
00:13:50,350 --> 00:14:01,570
a bit of a variety there so it is down
notes is a camp also marks archive

151
00:14:01,570 --> 00:14:08,430
format which can be signed so all of
them signed they contain the the info

152
00:14:08,430 --> 00:14:13,709
which is the installation directives and
supported Pamela so actually how

153
00:14:13,710 --> 00:14:17,930
installs what would have been goes in
the stalls and then the password expects

154
00:14:17,930 --> 00:14:22,469
the kernel drivers sales actually help
files we saw quite a lot of things

155
00:14:22,470 --> 00:14:27,820
developed us into forgot to remove so a
lot of a single files are included along

156
00:14:27,820 --> 00:14:34,410
with the drivers and other fossil
expected that so back to the plan we've

157
00:14:34,410 --> 00:14:40,670
got our list of drivers with damaged
ones are interested in we don't need to

158
00:14:40,670 --> 00:14:46,400
install drivers so I don't you i felt
quite a few Windows systems in my time

159
00:14:46,400 --> 00:14:51,010
installing drivers can take a very long
time I didn't want to sit there and do

160
00:14:51,010 --> 00:14:59,780
many 2284 drivers so we want to find a
way of all things so fortunately marxist

161
00:14:59,780 --> 00:15:05,140
very kindly provide an application to
this application so the windows device

162
00:15:05,140 --> 00:15:10,860
concern for the driver development kit
this requires a high provisions and come

163
00:15:10,860 --> 00:15:16,670
back so we can actually provide it with
an in and kept falling heard you speak

164
00:15:16,670 --> 00:15:21,390
DeviceID it will take that it will then
go in store for us on the local system

165
00:15:21,390 --> 00:15:27,750
so example there and then we get
obviously D success or failure status of

166
00:15:27,750 --> 00:15:35,180
that insulation so but your box via
endorsement from the command line bring

167
00:15:35,180 --> 00:15:41,949
up its inception we launched our convo
we monitor installation so we take

168
00:15:41,950 --> 00:15:51,470
snapshots of the file system we run
problem formulation record changes so I

169
00:15:51,470 --> 00:15:56,220
can change the file system services
install process is running a very

170
00:15:56,220 --> 00:16:02,120
interesting things like that so this
we've gone from our hardware solution or

171
00:16:02,120 --> 00:16:02,950
initial idea

172
00:16:02,950 --> 00:16:09,830
and somehow she highly parallel lines of
oil and we can run across as many as 12

173
00:16:09,830 --> 00:16:15,230
really speed this up however it's not a
perfect situation as I mentioned that

174
00:16:15,230 --> 00:16:20,790
she has to be run hyperplasia so the
things we're trying to sing and I hear

175
00:16:20,790 --> 00:16:25,689
is actually lower provisions applauding
in physical USB device and we're kind of

176
00:16:25,690 --> 00:16:31,660
seventy percent of the way there but
it's not quite what we want so we did

177
00:16:31,660 --> 00:16:34,730
run it this way we collected some
results but then try to improve our

178
00:16:34,730 --> 00:16:40,120
methodology and this is where we come
across the windows device simulation

179
00:16:40,120 --> 00:16:44,510
framework so this is again part of the
driver development kit only in older

180
00:16:44,510 --> 00:16:50,910
versions so the latest version was in
7.1 it's since been discontinued in aids

181
00:16:50,910 --> 00:16:58,240
and above this allows the simulation
software simulation of USB devices such

182
00:16:58,240 --> 00:17:03,410
perfect docking stations a bit thin on
the ground but it does come with some

183
00:17:03,410 --> 00:17:10,020
very useful conscripts cool scriptable
example devices so using BBS we can

184
00:17:10,020 --> 00:17:17,250
actually create these devices and
simulate enough for our needs so we're

185
00:17:17,250 --> 00:17:24,569
quietness and then waited VirtualBox
using USB filters to do is pass through

186
00:17:24,569 --> 00:17:30,510
the simulated device so guests and this
automatically triggers the deployment

187
00:17:30,510 --> 00:17:34,870
play service to identify the new the new
hardware and actually been we can also

188
00:17:34,870 --> 00:17:42,629
at this as a liberal issues across all
devices very very easily

189
00:17:42,630 --> 00:17:51,350
at the end of this process we attempt to
install 2284 USB Drive only about half

190
00:17:51,350 --> 00:17:55,300
of them 1150 installed successfully

191
00:17:55,300 --> 00:18:00,659
of those only about 600 anything
actually interesting so we ended up with

192
00:18:00,660 --> 00:18:07,780
533 new code I miss you so we didn't
just do this on a single system that's a

193
00:18:07,780 --> 00:18:14,210
lot of drivers running one system 58
water and programs to run into when the

194
00:18:14,210 --> 00:18:19,670
user logs in and 12 is thought services
running a stipend reaches its so I think

195
00:18:19,670 --> 00:18:23,610
we can say from our initial attack
surface to running all of these

196
00:18:23,610 --> 00:18:29,370
installations such increased hugely and
remember this is the third time code so

197
00:18:29,370 --> 00:18:32,530
I'm set up I'm thinking right

198
00:18:32,530 --> 00:18:40,910
anything next is create some automated
disassembly vulnerability finding system

199
00:18:40,910 --> 00:18:45,380
I'll do this and find some fantastic
results

200
00:18:45,380 --> 00:18:51,110
unfortunately we have a lot of research
to make robots that the first time

201
00:18:51,110 --> 00:18:56,649
that's a presentation in and of itself
but the more important one was actually

202
00:18:56,650 --> 00:19:02,820
scope so whilst doing all of this I'm
doing on standalone virtual machines are

203
00:19:02,820 --> 00:19:06,760
connected to the network and we
certainly thought actually will this

204
00:19:06,760 --> 00:19:10,540
work in an enterprise environment
because that's the focus of our research

205
00:19:10,540 --> 00:19:18,490
so we find out when the 2012 domain put
it all in WSUS

206
00:19:18,490 --> 00:19:25,580
WSUS it turns out the deficit
ministrations have to specifically

207
00:19:25,580 --> 00:19:33,149
enable Windows drivers for insulation so
in a deep hole installation of WSUS

208
00:19:33,150 --> 00:19:42,420
muscle work so let's take a look at the
resources and little bit closer to thank

209
00:19:42,420 --> 00:19:44,179
you

210
00:19:44,179 --> 00:19:58,509
diving into WSUS brief introduction to
WSUS is essentially a software that you

211
00:19:58,509 --> 00:20:02,919
would you make that 20 months of service
but you can still run it on your own

212
00:20:02,919 --> 00:20:11,429
local server it's pretty much the same
as last names web service client point

213
00:20:11,429 --> 00:20:15,090
of view it's it's almost identical the
big difference is a tremendous rate is

214
00:20:15,090 --> 00:20:20,879
that I did with WSUS is that it will go
to download updates and cash them from

215
00:20:20,879 --> 00:20:25,139
what's the status and then distribute
them out to its all the machines and

216
00:20:25,139 --> 00:20:30,668
Windows network and benefits
administration says they can control

217
00:20:30,669 --> 00:20:35,269
when the updates go out they can test
update and improve them they can

218
00:20:35,269 --> 00:20:38,759
withhold send updates and so on and have
the ability of which machines installed

219
00:20:38,759 --> 00:20:46,350
which updates which means that in which
machines having people to get so mad

220
00:20:46,350 --> 00:20:55,459
about the security of WSUS so I tried
this I setup will lose 7 2012 machine

221
00:20:55,460 --> 00:21:02,480
that is very simple to set up this mess
with it takes about 10 minutes 13 and

222
00:21:02,480 --> 00:21:09,690
the internet setup with it is running
things working and all is left to do is

223
00:21:09,690 --> 00:21:15,320
configure the globe machines to connect
to it and it was like they once the

224
00:21:15,320 --> 00:21:19,999
problem is that I did it was it and
still is not enabled so this is the

225
00:21:19,999 --> 00:21:24,519
default setup you want to do with it
doesn't sell for that soap webservice

226
00:21:24,519 --> 00:21:27,549
now too much credit

227
00:21:27,549 --> 00:21:31,460
the very first thing you see often
competing with it is this going down

228
00:21:31,460 --> 00:21:36,480
here says next steps to configure system
you should explore the following topics

229
00:21:36,480 --> 00:21:42,830
and the very first link there is a link
to using WSUS so if you follow that link

230
00:21:42,830 --> 00:21:47,908
to the sites you get your page includes
this text here so explains a bit about

231
00:21:47,909 --> 00:21:53,820
the security there so what it says is
that WSUS uses SSL for metadata

232
00:21:53,820 --> 00:21:58,409
not Friday calls so that they've always
fetched over HTTP and that's that's the

233
00:21:58,410 --> 00:22:03,030
same for Windows updates one thing
doesn't say that actually caused them

234
00:22:03,030 --> 00:22:09,360
selves are signs and its use has to the
files as well so when nothing is

235
00:22:09,360 --> 00:22:15,469
downloaded it says here when I double
checked and hash and if the update has

236
00:22:15,470 --> 00:22:19,960
been changed then it doesn't install it
essentially if that's been tampered with

237
00:22:19,960 --> 00:22:26,850
in any way then it's game over and one
very important thing is the updates to

238
00:22:26,850 --> 00:22:34,909
be signed by Microsoft so let's have a
thing now is everything about the

239
00:22:34,910 --> 00:22:39,400
potential attacks we could do this
within these parameters let's let's

240
00:22:39,400 --> 00:22:48,310
imagine that administrators not set up a
cell that I W W insulation so if I said

241
00:22:48,310 --> 00:22:51,889
I wasn't being used then potentially
intact and that were better tackle on

242
00:22:51,890 --> 00:22:56,150
the winners network kids see the traffic
they could set the traffic and they've

243
00:22:56,150 --> 00:23:02,460
modify it sounds we can modify days
where we're going to assume that we

244
00:23:02,460 --> 00:23:04,720
haven't gone crazy

245
00:23:04,720 --> 00:23:12,660
by bosses or anything like that so far
the updates but so what can we do so

246
00:23:12,660 --> 00:23:18,870
what we can do to him what if I metadata
itself so things we can do maybe with

247
00:23:18,870 --> 00:23:22,449
kids but instead the management of
traffic we can prevent updates can be

248
00:23:22,450 --> 00:23:26,670
applied to maybe we could have been
critical updates and compliance very bad

249
00:23:26,670 --> 00:23:30,690
we could perhaps go back to the drawing
stuff we can force drivers to be

250
00:23:30,690 --> 00:23:33,950
installed maybe third-party drivers if
we know there's a possibility then

251
00:23:33,950 --> 00:23:38,070
perhaps we could even attention to
things like downgraded tax perhaps we

252
00:23:38,070 --> 00:23:43,970
could find they if the machine being
passed against a recent day we could

253
00:23:43,970 --> 00:23:49,060
downgrade 4.3% they cannot remove that
protection

254
00:23:49,060 --> 00:23:54,909
the update and then going to tax
liability so there's all possible things

255
00:23:54,910 --> 00:23:57,799
but none of them really really stand out
to me as being

256
00:23:57,799 --> 00:24:04,158
particularly easy or particularly
exploit across the board so let's go

257
00:24:04,159 --> 00:24:09,070
have a look at the soap webservice in a
bit more detail I should warn and only

258
00:24:09,070 --> 00:24:16,830
the nervous disposition we're going to
see a lot of XML slides so we will have

259
00:24:16,830 --> 00:24:26,178
the WSUS traffic we need to project so
we can see the normal and says he's

260
00:24:26,179 --> 00:24:33,889
using HTTPS then the CAC your proxy that
has given the machine to stall that

261
00:24:33,889 --> 00:24:40,248
supposed to normally you install and use
the store which is what I uses but

262
00:24:40,249 --> 00:24:47,169
machines don't honestly it's probably
easier to do it with with our guests not

263
00:24:47,169 --> 00:24:52,749
to worry about that that doesn't spend a
proxy settings sometimes you want to

264
00:24:52,749 --> 00:24:55,799
restart the Windows Update Service to
get it to process things they normally

265
00:24:55,799 --> 00:25:01,668
not so that the remaining interested in
is this the end point which is a client

266
00:25:01,669 --> 00:25:07,249
access one here so this is where most of
the interesting sup atoms and web

267
00:25:07,249 --> 00:25:10,970
service is actually don't come into them
on msn

268
00:25:10,970 --> 00:25:16,230
what's party documented I'll show you
what's interesting shortly but there is

269
00:25:16,230 --> 00:25:22,139
some useful stuff they're so what's
gonna happen in a sequence of cycles

270
00:25:22,139 --> 00:25:28,149
cycles that happen when they talk to
them and is largely similar to what

271
00:25:28,149 --> 00:25:36,789
happens with normal if you're not using
WSUS so first of all a bunch of schools

272
00:25:36,789 --> 00:25:39,230
which are used to set up

273
00:25:39,230 --> 00:25:45,970
the connection these new leaders having
won so there's get compared in return

274
00:25:45,970 --> 00:25:50,919
some big data that's get authorization
cookie which goes to a different website

275
00:25:50,919 --> 00:26:00,460
important cool symbols important thing
here is there's no real indication going

276
00:26:00,460 --> 00:26:03,200
on here there's no kind of Windows
credentials going backwards and forwards

277
00:26:03,200 --> 00:26:08,150
nothing like that it's because it's
pretty much an unauthenticated I'm

278
00:26:08,150 --> 00:26:12,179
service anything can talk to it if you
want state so the going gets his

279
00:26:12,179 --> 00:26:17,510
authorization key exchange it for
another too keen on it why but this

280
00:26:17,510 --> 00:26:21,360
ticket is really important to you need
all the subsequent requests you need

281
00:26:21,360 --> 00:26:26,740
that cookie and then computer bridged
itself so essentially says this is the

282
00:26:26,740 --> 00:26:32,299
address I'm running this is my computer
name so on the details and then the

283
00:26:32,299 --> 00:26:36,650
server so say it's a computer details
with a cookie and from then on it knows

284
00:26:36,650 --> 00:26:44,480
what she's talking to so there's nothing
happens just once a nest explains that

285
00:26:44,480 --> 00:26:48,860
happen that often so they're really
interesting stuff is so what happens

286
00:26:48,860 --> 00:26:57,469
when you text updates so first of all
there's a cool to think updates and

287
00:26:57,470 --> 00:27:01,950
without the client sends a list of all
the update IDs that it's got installed

288
00:27:01,950 --> 00:27:11,190
so typical Windows 7 machine I'll be in
a few hundreds update IDs and then the

289
00:27:11,190 --> 00:27:18,220
server responds with what if any weapons
next it does another posting updates but

290
00:27:18,220 --> 00:27:24,020
this time it's looking for hardware
updates essentially it sends a list of

291
00:27:24,020 --> 00:27:27,639
all the hard ground would drive up the
actions and so in the end the same

292
00:27:27,640 --> 00:27:36,750
response as you up to date so that she
does some new joint meeting still so the

293
00:27:36,750 --> 00:27:41,460
survey responses in the server
containing a bit of metadata about the

294
00:27:41,460 --> 00:27:48,630
updates ideas and also its metadata that
lets the PC decide whether it needs two

295
00:27:48,630 --> 00:27:54,740
wins to install the updates updates the
client does what it does another cool

296
00:27:54,740 --> 00:28:01,610
cool to get extended up the info and
with it sends it wants to instill and

297
00:28:01,610 --> 00:28:05,850
the server responds with a whole bunch
more metadata about Western the results

298
00:28:05,850 --> 00:28:09,860
from and how to install them and so on
so we're gonna look a bit more detail in

299
00:28:09,860 --> 00:28:16,570
the actual email now so this is a single
request abbreviated it cuz

300
00:28:16,570 --> 00:28:21,540
hundreds of ideas and then but this is
literally just list of ids of the ideas

301
00:28:21,540 --> 00:28:28,950
that got install the server then
responds with any new update idea is so

302
00:28:28,950 --> 00:28:33,190
there's there's one here as it is not a
good day everybody has 20 days to know

303
00:28:33,190 --> 00:28:42,799
why but metadata and then there's an XML
tag with XML encoded right now I

304
00:28:42,799 --> 00:28:47,559
mentioned before that this is all
documents on a misty am sure that the

305
00:28:47,559 --> 00:28:51,870
contents of this XML tag that's not
documented and that's where the

306
00:28:51,870 --> 00:29:00,750
interesting stuff is so the next slides
back some attack decoded essentially so

307
00:29:00,750 --> 00:29:06,520
this is the date metadata that the
server responds with the same context of

308
00:29:06,520 --> 00:29:13,690
what's going on here is the updates as
well for a two ideas and do it why but

309
00:29:13,690 --> 00:29:15,159
its dependencies

310
00:29:15,159 --> 00:29:18,130
says before you install this update you
must have installed these other ones

311
00:29:18,130 --> 00:29:24,030
fast that he needs prerequisite and then
it's got these applicability rules and

312
00:29:24,030 --> 00:29:28,379
these are checks are becoming can do to
see if it needs to install the update so

313
00:29:28,380 --> 00:29:33,179
you can specify things like don't check
if these things exist can check the

314
00:29:33,179 --> 00:29:40,650
version to these files at da house
registry values and so on and there's

315
00:29:40,650 --> 00:29:45,490
really not as well so you have this
phone this fall but not respond and

316
00:29:45,490 --> 00:29:50,460
someone who can get quite a quite
involved so

317
00:29:50,460 --> 00:29:55,540
the next once the check society which
updates are applicable

318
00:29:55,540 --> 00:29:59,190
then there's a call to get extended info
the list of ideas that he wants to

319
00:29:59,190 --> 00:30:05,400
install the server responds with this
with his response and there's two parts

320
00:30:05,400 --> 00:30:11,080
here so the top we have each other day I
D has more XML inside of an attack that

321
00:30:11,080 --> 00:30:16,610
exploded and its list of files so
there's always a sense he say these

322
00:30:16,610 --> 00:30:25,800
policies downloaded the files you look
at the contents of the attacks so this

323
00:30:25,800 --> 00:30:29,399
is the really important stuff here so
again this is not documented on MSDN

324
00:30:29,400 --> 00:30:38,520
describes how to install it up they were
done they did what he did with it so

325
00:30:38,520 --> 00:30:45,030
what's settled at the top here is the
hand that and the different times about

326
00:30:45,030 --> 00:30:49,470
updates there are different handlers and
they have different types of smell them

327
00:30:49,470 --> 00:30:58,660
so this is a CBS handling we should
think the top levels and then the polls

328
00:30:58,660 --> 00:31:04,620
here to this this place back to the the
farmers in the previous slide hit the

329
00:31:04,620 --> 00:31:09,770
send it says the these particular files
in this particular update and then at

330
00:31:09,770 --> 00:31:15,070
the bottom there's hella specific data
and that's taking place at a bit later

331
00:31:15,070 --> 00:31:26,050
on so what time they handed out there so
we did a beautiful black Windows seven

332
00:31:26,050 --> 00:31:30,470
install a small amount of different
updates and things like that and he's a

333
00:31:30,470 --> 00:31:37,720
different kind of town so there's CBS
was just a couple miles 200 drivers for

334
00:31:37,720 --> 00:31:42,830
all Windows installers and so on the one
that really stood out to us is Kalani

335
00:31:42,830 --> 00:31:46,639
installation that sounds quite
interesting thoughts so we took a closer

336
00:31:46,640 --> 00:31:50,169
look at that

337
00:31:50,169 --> 00:31:59,330
so this is XML this use for component
installation as examples taken from the

338
00:31:59,330 --> 00:32:04,789
Malicious Software Removal Tool so
that's the thing which gets you see that

339
00:32:04,789 --> 00:32:09,129
every now and then when it updates
essentially what it is

340
00:32:09,129 --> 00:32:14,369
come on line installation is is it just
a single exit gets downloaded against

341
00:32:14,369 --> 00:32:18,519
run once and then that's it so things
like the list of rheumatoid it's like a

342
00:32:18,519 --> 00:32:24,460
different forget it gets examiners
against run and that's it but I think

343
00:32:24,460 --> 00:32:29,600
this could really interesting he was
just standing here see ya later this

344
00:32:29,600 --> 00:32:35,158
nation and here there's these attributes
the same programs it says run this

345
00:32:35,159 --> 00:32:39,970
executable you just downloaded the most
important isn't here so it says run this

346
00:32:39,970 --> 00:32:45,779
program so hope by now you thinking
actually this looks this has potential

347
00:32:45,779 --> 00:32:51,840
so what can we do with component command
line its lesson I remember we're talking

348
00:32:51,840 --> 00:32:56,809
about the cases where is also being used
we can settle this matter we can inject

349
00:32:56,809 --> 00:33:00,509
into it and so on

350
00:33:00,509 --> 00:33:04,080
component command line installation we
can download among any marks also

351
00:33:04,080 --> 00:33:09,570
indicates that has to be some articles
and we can provide article online

352
00:33:09,570 --> 00:33:14,820
audience as they can get and also the
other thing you mentioned that it start

353
00:33:14,820 --> 00:33:19,070
is updates get installed a system so
this is really privileged stuff

354
00:33:19,070 --> 00:33:26,249
happening so personal commitment to this
was downloading run command I it's a

355
00:33:26,249 --> 00:33:34,999
simple slogans do whatever you like but
actually it's not actually signs in fact

356
00:33:34,999 --> 00:33:45,259
boasts Windows binaries on a Windows
install on signs why they're not so next

357
00:33:45,259 --> 00:33:55,190
we think and think and that's what we do
is buy movies or so I thought so we we

358
00:33:55,190 --> 00:33:59,269
found with assistant and also has great
intentions years ago they're basically

359
00:33:59,269 --> 00:34:02,750
towards a great day and what's up to
sign them

360
00:34:02,750 --> 00:34:13,179
so he's so normally used to like come on
until use it to cater remember seeing

361
00:34:13,179 --> 00:34:16,360
him under the command the vehicle that
struck a sex act on the local machine

362
00:34:16,360 --> 00:34:21,240
without specifying any potentials and
this run-up to commands from my

363
00:34:21,239 --> 00:34:29,219
so here's the plan we're going to have a
man in the middle

364
00:34:29,219 --> 00:34:33,120
proxy essentially it's going to be stuck
in the traffic decline in the seventh

365
00:34:33,120 --> 00:34:37,759
and this is what we gonna do so the
clintons gonna check for updates its

366
00:34:37,760 --> 00:34:40,580
gonna do a sync update request and will
likely pass that straight through the

367
00:34:40,580 --> 00:34:46,659
setup the server respondents say they
have no updates but with modified of

368
00:34:46,659 --> 00:34:50,379
response and we're going to Jax our own
request for an injector

369
00:34:50,379 --> 00:34:55,790
essentially so the client or say I would
like to install that they don't they

370
00:34:55,790 --> 00:34:59,690
please give me more information they're
not gonna pass through December because

371
00:34:59,690 --> 00:35:04,760
they didn't exist the service going to
talk about so it's gonna make her in

372
00:35:04,760 --> 00:35:09,730
response to that several respondents say
do this c'mon let's listen things don't

373
00:35:09,730 --> 00:35:16,240
downloads from me and going on with
these arguments so that level

374
00:35:16,240 --> 00:35:25,709
download it and hopefully this will work
and this is the XML

375
00:35:25,710 --> 00:35:32,490
from the missions of everyone and then
we used it to be changed it expects that

376
00:35:32,490 --> 00:35:42,509
kiss except with the arguments he wanted
and that's what we have so this this

377
00:35:42,510 --> 00:35:49,400
this probably sounds very simple you
know what they've done this this took a

378
00:35:49,400 --> 00:35:54,360
while to get working that there is very
simple but a long time waiting for that

379
00:35:54,360 --> 00:36:00,820
to happen and getting tweaking right to
document it and someone please pretty

380
00:36:00,820 --> 00:36:01,350
please

381
00:36:01,350 --> 00:36:12,370
when we got to the stage oK so it's time
to time so I'm gonna explain set up so

382
00:36:12,370 --> 00:36:20,259
we have a Windows Server 2012 the end
the Scot WSUS install and setup know

383
00:36:20,260 --> 00:36:29,470
which is the default we've got a Linux
p.m. which is used to do the

384
00:36:29,470 --> 00:36:38,169
modification of the snow and I'm gonna
beat up of Windows 8 p.m. which is going

385
00:36:38,170 --> 00:36:47,060
to be out talking to the person or you
gonna look at is local Presque so

386
00:36:47,060 --> 00:36:52,170
there's no idea here is that we are a
non privileged user access to a machine

387
00:36:52,170 --> 00:37:00,850
to machine and what we gonna do is
modify the processing so we're gonna see

388
00:37:00,850 --> 00:37:05,680
him I mean yes sometimes can be locked
down comment if I put it at all so we

389
00:37:05,680 --> 00:37:18,000
can we're gonna see if we can modify the
settings so see what's a better one just

390
00:37:18,000 --> 00:37:25,430
gonna do nothing changes can check
updates to the WSUS server desktop and

391
00:37:25,430 --> 00:37:32,509
server and it should say there's not any
updates so that's so it's nothing is

392
00:37:32,510 --> 00:37:39,420
going on now we're going to modify the
settings so this is pointing the British

393
00:37:39,420 --> 00:37:46,789
getting to my Linux p.m. it could just
be a local host if we had a good run

394
00:37:46,789 --> 00:37:55,209
an excuse but let's keep it here and it
worked at the same place again hopefully

395
00:37:55,209 --> 00:38:06,448
a long time that's because I forgot to
my pussy right say from the proxy yeah

396
00:38:06,449 --> 00:38:11,479
so this is basically a Python script
about two hundred lines basically just

397
00:38:11,479 --> 00:38:31,980
multiplies the necessary request index
XML and that's right again

398
00:38:31,980 --> 00:38:46,309
so now running as an authority system

399
00:38:46,309 --> 00:38:55,410
TVs Wego that working that was gonna get
so that's a little progress that's just

400
00:38:55,410 --> 00:39:01,348
where there are few problems with this
so we talk about corporate finance is

401
00:39:01,349 --> 00:39:07,339
often picked up by a the evil hacking
tool so using peer sex maybe that's not

402
00:39:07,339 --> 00:39:15,469
the most realistic thing they make a lot
of Chinese accidentally so what else can

403
00:39:15,469 --> 00:39:22,719
we use so as to another system tends to
be home now beaten for a few not

404
00:39:22,719 --> 00:39:25,719
familiar with essentially its display
system information on the desktop

405
00:39:25,719 --> 00:39:29,819
background that actually is is often
used in an enterprise machines to happen

406
00:39:29,819 --> 00:39:36,029
to tell one another so now what you
don't know about me is you can specify a

407
00:39:36,029 --> 00:39:40,259
very difficult thing fields and one
thing you can do is specify at the bar

408
00:39:40,259 --> 00:39:47,199
to execute to produce an output on the
desktop so again we have we can run

409
00:39:47,199 --> 00:39:56,880
codes signs winery and also the things
we can load the conflict party from grab

410
00:39:56,880 --> 00:40:05,099
networks so this is the kind of thing we
want to run unbeaten can specify a share

411
00:40:05,099 --> 00:40:13,039
an unauthenticated hosted on it and I'm
gonna send it to this this this file and

412
00:40:13,039 --> 00:40:19,910
kcrw two-time rights

413
00:40:19,910 --> 00:40:32,868
so I'm going to change modify proxies
slightly so the story now is that we

414
00:40:32,869 --> 00:40:38,359
gonna do it judy network base so we've
got no access to any even his machines

415
00:40:38,359 --> 00:40:46,630
credentials nothing the only thing we
have access to to the pool and spa under

416
00:40:46,630 --> 00:40:53,039
conspired labs and what this does is
using it to do it w pads injections

417
00:40:53,039 --> 00:40:58,819
access and see what happens is machines
will collapse networks as a proxy auto

418
00:40:58,819 --> 00:41:02,500
config rating out there and we can
respond as a yes you need to talk to my

419
00:41:02,500 --> 00:41:17,170
process if I beat up my game again this
time ago and that kind of snow texture

420
00:41:17,170 --> 00:41:25,200
we don't need the show you the idea here
is that all amenities like the beaches

421
00:41:25,200 --> 00:41:30,009
normally what happened is that machinery
periodically check for updates every so

422
00:41:30,010 --> 00:41:34,020
often and then download updates and a
designated time of day

423
00:41:34,020 --> 00:41:38,509
install the updates got time to wait
around to hear that somebody's going to

424
00:41:38,510 --> 00:41:44,500
get a manually but this this will happen
this will happen automatically every if

425
00:41:44,500 --> 00:41:49,440
you were patient enough

426
00:41:49,440 --> 00:41:54,930
right so when I run this before the
update did this didn't work the first

427
00:41:54,930 --> 00:42:03,819
time they did what the second time so we
got this way can just yesterday so we'll

428
00:42:03,819 --> 00:42:09,500
see how it goes

429
00:42:09,500 --> 00:42:22,340
I spent so much of my life waiting for
the updates that but that didn't work I

430
00:42:22,340 --> 00:42:29,290
don't know why it should be something
with my set up again so fingers crossed

431
00:42:29,290 --> 00:42:47,579
this time this is put up here and there
we go again

432
00:42:47,579 --> 00:43:00,180
nothing we just have no business like
that and we can fully compromise so not

433
00:43:00,180 --> 00:43:03,828
to get carried on a system of any
machine on the network that's using

434
00:43:03,829 --> 00:43:10,190
Windows Update or the police or other
without with no I guess that's what

435
00:43:10,190 --> 00:43:18,269
happened so if you depend tests audits
or manage networks to someone like how

436
00:43:18,269 --> 00:43:21,209
can you check this how committee from
renewable

437
00:43:21,209 --> 00:43:27,950
pretty easy to clean this one here W W
some other time has the Euro of the WSUS

438
00:43:27,950 --> 00:43:35,078
server that Eurostar HTTP and HTTPS then
you've got problems any closer to get my

439
00:43:35,079 --> 00:43:41,579
new policy as well so how do you think
this will look ahead what does recommend

440
00:43:41,579 --> 00:43:47,229
using a cell to have died for its so
basically it's just a case of deploying

441
00:43:47,229 --> 00:43:50,269
US and it's doing it and using SSL

442
00:43:50,269 --> 00:43:56,430
skated tax addition they won't be
possible so this is summarized

443
00:43:56,430 --> 00:44:01,788
drivers on Windows Update so we found a
large number of third-party join us

444
00:44:01,789 --> 00:44:08,969
increased attack surface with Windows
machine so that's interesting but the

445
00:44:08,969 --> 00:44:12,660
enterprise which is what we're focused
on it's not so much that she basically

446
00:44:12,660 --> 00:44:19,440
because it's the admin has to approve
the updates so drivers the only gonna

447
00:44:19,440 --> 00:44:23,989
probably approve certain drugs they need
their environments and in terms of

448
00:44:23,989 --> 00:44:29,309
widely applicable taxes and a lot there
so that produced to the unencrypted WSUS

449
00:44:29,309 --> 00:44:37,900
so schön local local network combines
basically because as hell is not a

450
00:44:37,900 --> 00:44:45,209
mighty force so the question now is is
is really a problem see you all at mins

451
00:44:45,209 --> 00:44:51,680
followed a hardening I love my mind's
I'm going out on a limb and say no not

452
00:44:51,680 --> 00:44:54,240
all admins probably follow the
guidelines

453
00:44:54,240 --> 00:45:02,270
and experience that's no reason as well
so does it before then if that's what

454
00:45:02,270 --> 00:45:07,020
you think these guys who can text me
they helped us get this ready in time

455
00:45:07,020 --> 00:45:14,330
thanks to those guys and just before I
think this question starts off with ways

456
00:45:14,330 --> 00:45:18,520
when there's a break so slow in a few
months looking at this we've gotten some

457
00:45:18,520 --> 00:45:26,160
great depth when they want to be honest
we have no idea sorry so that's it and

458
00:45:26,160 --> 00:45:31,379
the white paper so if you if you want to
know more about this a lot more detail

459
00:45:31,380 --> 00:45:34,990
in a white paper we should go to your
own and get that we've got a fully what

460
00:45:34,990 --> 00:45:39,330
example is Dec smell each injection
everything to crash site updates

461
00:45:39,330 --> 00:45:50,549
any questions

462
00:45:50,550 --> 00:46:01,660
thank you very much so so much XML

