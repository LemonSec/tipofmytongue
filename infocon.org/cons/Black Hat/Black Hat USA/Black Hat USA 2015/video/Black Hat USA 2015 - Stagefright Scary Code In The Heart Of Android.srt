1
00:00:00,000 --> 00:00:08,039
today's presentation is stage fright
Gary code in the heart of Android debut

2
00:00:08,039 --> 00:00:12,649
everyone thank you thank you all for
coming I'm most of you probably have

3
00:00:12,650 --> 00:00:17,930
heard plenty about this research already
I just finished the slides literally 10

4
00:00:17,930 --> 00:00:21,698
minutes ago so please bear with me on
that one

5
00:00:21,699 --> 00:00:26,830
there is definitely new information and
it's not exactly public but there's a

6
00:00:26,830 --> 00:00:31,740
lot of stuff to do is is kind of already
been talked a lot about in the media and

7
00:00:31,740 --> 00:00:38,149
such so it out and do it without further
ado let's just jump right in here so

8
00:00:38,149 --> 00:00:42,719
here's a quick agenda to show we're
gonna go through today I have to say

9
00:00:42,719 --> 00:00:47,670
long sort of history of having really
super PAC slide decks so if you get lost

10
00:00:47,670 --> 00:00:50,690
a slide deck will be released you can
always go through as many times as you

11
00:00:50,690 --> 00:00:55,339
like soon and there's actually I think
something like 20 bonus slides that I

12
00:00:55,340 --> 00:01:02,000
couldn't fit into the time so I'll
introduction and Joshua J Drake I go by

13
00:01:02,000 --> 00:01:03,170
Jaytech on the Internet

14
00:01:03,170 --> 00:01:08,070
been doing more research actually down
for sixteen years and that's

15
00:01:08,070 --> 00:01:12,710
professionally I've also done some four
years before that

16
00:01:12,710 --> 00:01:18,689
on PBS is back in the day right now I
work force Imperium as their VP of

17
00:01:18,689 --> 00:01:25,600
platform research next and exploitation
so I was also lead author of the andrew

18
00:01:25,600 --> 00:01:30,048
hacker's handbook which we published
last April believed to have a bookstore

19
00:01:30,049 --> 00:01:34,420
we're doing a book signing tomorrow at
10:30 in the morning with myself in four

20
00:01:34,420 --> 00:01:41,390
of the five other authors and the book
also found in the dry cycle research

21
00:01:41,390 --> 00:01:45,140
group a few years back realizing that
there were a bunch of researchers

22
00:01:45,140 --> 00:01:47,829
looking into Android but they really
weren't communicating amongst each other

23
00:01:47,829 --> 00:01:52,199
very much I thought it was important to
bring us all together previously I was

24
00:01:52,200 --> 00:01:54,000
like you my lads who is now up to

25
00:01:54,000 --> 00:02:00,490
and rabbits Evans Metasploit VeriSign's
I defense lamp so the purpose of this

26
00:02:00,490 --> 00:02:04,189
research that the motivation the driving
factors behind me doing this research

27
00:02:04,189 --> 00:02:09,410
was to number one overall improved
improve overall the state of mobile

28
00:02:09,410 --> 00:02:10,090
security

29
00:02:10,090 --> 00:02:17,610
mobile especially in the Android space
has had a lot of bad iraq has a lot of

30
00:02:17,610 --> 00:02:21,000
people is also got a lot of
complications going on in a lot of

31
00:02:21,000 --> 00:02:21,599
problems

32
00:02:21,599 --> 00:02:25,579
something that you when you start
researching Android you learn this very

33
00:02:25,580 --> 00:02:30,599
quickly and so I wanted to do that in
two ways both by finding and fixing

34
00:02:30,599 --> 00:02:36,060
vulnerabilities so very proactive
approach but also to like kind of give

35
00:02:36,060 --> 00:02:41,180
people a reason to like want to do
better you know nothing really motivates

36
00:02:41,180 --> 00:02:48,739
people in security like a deadline so
good so I also want to increase

37
00:02:48,739 --> 00:02:52,709
visibility into some of them were risky
code Android I don't know how many

38
00:02:52,709 --> 00:02:55,799
people to just buy a show of hands how
many people have ever checked out

39
00:02:55,799 --> 00:02:59,019
AOSP that's pretty good

40
00:02:59,019 --> 00:03:06,980
like maybe third pretty good so that's
like 60 gigs at this point yes that's a

41
00:03:06,980 --> 00:03:11,399
lot of code and I can't imagine anybody
liked reading all the code I don't think

42
00:03:11,400 --> 00:03:12,239
that's possible

43
00:03:12,239 --> 00:03:17,170
not humanly especially not well but I
wanted to highlight some areas an injury

44
00:03:17,170 --> 00:03:23,319
that could use additional attention and
last year I didn't talk here about the

45
00:03:23,319 --> 00:03:29,319
droid army which is my collection of
Android devices and so I wanted to use

46
00:03:29,319 --> 00:03:34,319
that some or do some testing with that
you know when you spend so much time on

47
00:03:34,319 --> 00:03:38,160
a project like that you want to use it
as much as you can so sponsors in this

48
00:03:38,160 --> 00:03:43,160
work a lot of the work was sponsored by
I cube on before I left that company was

49
00:03:43,160 --> 00:03:47,440
now up again and I've joins appearing in
April and they've been continuously

50
00:03:47,440 --> 00:03:51,690
supporting me through this entire
process I want to give special thanks to

51
00:03:51,690 --> 00:03:56,310
a mirror at ahmadi I don't know he's
here is Amir Amir here said he might not

52
00:03:56,310 --> 00:04:08,639
make it very helpful especially in the
MSI and the MMS side of the research so

53
00:04:08,639 --> 00:04:12,750
first of all what is stage fright I'm
sure you guys are aware of stage fright

54
00:04:12,750 --> 00:04:19,548
the phenomenon of gotta get off the
stage right now right so but this is

55
00:04:19,548 --> 00:04:23,849
different you can see here dan kaminsky
you thought it was pretty funny and I

56
00:04:23,850 --> 00:04:27,900
agreed with him from the beginning you
know when I first 5 found this code I

57
00:04:27,900 --> 00:04:34,909
was seriously like who names at that and
why would they need so I it's really

58
00:04:34,910 --> 00:04:39,970
just a multimedia framework library if
it supports a lot of the handling of

59
00:04:39,970 --> 00:04:44,950
video and audio in Android not images
images are handled by some other code

60
00:04:44,950 --> 00:04:51,140
and it provides the playback facilities
for whenever you play back video but it

61
00:04:51,140 --> 00:04:54,430
also does much more like extract
metadata like something else or

62
00:04:54,430 --> 00:04:59,610
dimensions of the video for example or
frame rate it so it's it's used quite a

63
00:04:59,610 --> 00:05:07,100
bit so a brief history of stage fright
so it launched in the Android launched

64
00:05:07,100 --> 00:05:12,900
in you know the 10 days with open core
as their media engine at some point

65
00:05:12,900 --> 00:05:16,789
during 2.0 dev they decided they're
gonna rewrite it from scratch in a new

66
00:05:16,790 --> 00:05:22,280
project called states right so during
under a two-out to actually supported

67
00:05:22,280 --> 00:05:26,619
both engines and ship both engines
although on older devices at that point

68
00:05:26,620 --> 00:05:30,979
they controlled which one was used with
this system property when I looked at

69
00:05:30,979 --> 00:05:34,849
the devices in my droid army that rented
out to all of them ran with stage 4

70
00:05:34,850 --> 00:05:39,760
enabled I think during that time it was
widely recognized that stage fright was

71
00:05:39,760 --> 00:05:43,909
much more optimized and quicker code
more efficient and so everybody was

72
00:05:43,910 --> 00:05:48,620
jumping onto used an Android 23
Gingerbread which was you know quite a

73
00:05:48,620 --> 00:05:55,710
long time ago don't have the date hereof
I think that was 2010 maybe they shipped

74
00:05:55,710 --> 00:05:59,440
with it as the default got rid of open
door entirely could go back and they've

75
00:05:59,440 --> 00:06:05,110
had ever since as the media library to
use so side notice also used by other

76
00:06:05,110 --> 00:06:09,229
people to the Mozilla guys with their
work on Firefox made a fork of this code

77
00:06:09,229 --> 00:06:13,729
input into their browser they ship it on
all versions except for Linux where they

78
00:06:13,729 --> 00:06:18,810
use GStreamer and they started in
seventeen so you know that's quite a

79
00:06:18,810 --> 00:06:23,910
while ago as well so why state highway
look at this I mean besides the name

80
00:06:23,910 --> 00:06:26,070
write the names probably enough

81
00:06:26,070 --> 00:06:32,599
reason to look at it but why else look
at what I found when I did some deeper

82
00:06:32,600 --> 00:06:36,650
research into how the code is exposed
and I'll talk some more about that was

83
00:06:36,650 --> 00:06:40,739
it it's exposed by multiple attacks
workers and I found that one in

84
00:06:40,740 --> 00:06:47,250
particular was very nasty that being a
mess because it required no user action

85
00:06:47,250 --> 00:06:55,150
at all to trigger the code also you know
it's written native code in C++ try to

86
00:06:55,150 --> 00:07:04,640
stop the code C++ so that means it's a
little bit more prone to memory

87
00:07:04,640 --> 00:07:09,580
corruption issues and other assorted
mistakes do happen at that level and

88
00:07:09,580 --> 00:07:14,469
because it's evil forces also a little
bit easier to exploit C++ built in a lot

89
00:07:14,470 --> 00:07:18,440
of different function pointers into the
language they use them quite a lot so

90
00:07:18,440 --> 00:07:23,780
that makes things a little bit easier to
exploit sometimes so also if you look

91
00:07:23,780 --> 00:07:28,580
around for people talking about media on
Android and you'd like gold looking are

92
00:07:28,580 --> 00:07:34,930
read it or are already sore Android bug
tracker or just random sites like some

93
00:07:34,930 --> 00:07:38,820
of the android forums you'll see all
these people complaining about how their

94
00:07:38,820 --> 00:07:44,130
device's battery dies instantly or like
to give rebooting and then if you read

95
00:07:44,130 --> 00:07:48,890
all threads you'll eventually read that
like oh it's all happening because you

96
00:07:48,890 --> 00:07:54,650
have corrupt media on your device so I
was like ok that's pretty bad at have to

97
00:07:54,650 --> 00:07:58,500
look deeper in there for sure and also
recently there were some related

98
00:07:58,500 --> 00:08:04,140
publications about facing this media
code so I'm trying to go through this

99
00:08:04,140 --> 00:08:09,580
quickly there was related work here in
April published by Alexander Blanda is

100
00:08:09,580 --> 00:08:15,789
QA team from Intel they released their
code it's it's it's out there and you

101
00:08:15,790 --> 00:08:18,950
know one of the interesting stats from
from their presentation was David a

102
00:08:18,950 --> 00:08:22,969
positive media stuff and they ended up
with 11.5 terabytes of corrupt media

103
00:08:22,970 --> 00:08:29,350
files that would crash this code they
reported all of that stuff in some form

104
00:08:29,350 --> 00:08:34,570
to the interest security team with who
they say they accepted 7 security issues

105
00:08:34,570 --> 00:08:38,630
but we only I only saw three ever get
fixed and we'll talk about

106
00:08:38,630 --> 00:08:43,830
a little bit later so other than that
there was another paper that was

107
00:08:43,830 --> 00:08:45,640
released at the Asia

108
00:08:45,640 --> 00:08:53,310
Pacific CCS this year and it also talked
about different things on Android but

109
00:08:53,310 --> 00:08:58,880
they had a nice focus area a little bit
on the media stuff and then if you go

110
00:08:58,880 --> 00:08:59,689
way back

111
00:08:59,690 --> 00:09:05,470
industry was focused on open core media
sorry not on state rate but Charlie

112
00:09:05,470 --> 00:09:10,550
Miller's original Android talked it kind
of started Android security research in

113
00:09:10,550 --> 00:09:19,449
the public also was very related
although again not stage fright so again

114
00:09:19,450 --> 00:09:24,730
state friday's big it's not huge huge
big like you know the code base or

115
00:09:24,730 --> 00:09:30,180
something of that nature is certainly a
small part of a wispy but it does

116
00:09:30,180 --> 00:09:35,099
support a wide variety of formats and in
order to focus my research to make

117
00:09:35,100 --> 00:09:39,270
things more efficient and to be more
effective I decided to focus on just one

118
00:09:39,270 --> 00:09:45,250
file format and that was a big for the
rest of this talk when it talks about

119
00:09:45,250 --> 00:09:50,340
file format or any bugs or anything it's
all going to be mp4 focused let's go a

120
00:09:50,340 --> 00:09:54,710
little bit and system architecture
here's an overview of Android's

121
00:09:54,710 --> 00:09:59,820
architecture shows the application
framework being at the top with the

122
00:09:59,820 --> 00:10:02,450
Linux kernel being at the bottom and
you've got kind of everything in the in

123
00:10:02,450 --> 00:10:06,700
the in between the interesting part here
is that they call media server

124
00:10:06,700 --> 00:10:11,670
specifically being here on the Android
system services and they also call out

125
00:10:11,670 --> 00:10:16,770
system server which is a very important
process on Android to Android is very

126
00:10:16,770 --> 00:10:22,260
modular so they've tried very hard to
use privilege separation to you to run

127
00:10:22,260 --> 00:10:26,490
different programs under different UID
used the user IDs with different

128
00:10:26,490 --> 00:10:29,360
privilege levels and then they talk to
each other through inter-process

129
00:10:29,360 --> 00:10:35,130
communication usually binder so they
also use a sand bar singing and they put

130
00:10:35,130 --> 00:10:38,930
quotes around it because I don't know if
I am like fully on board with calling in

131
00:10:38,930 --> 00:10:45,310
a sandbox but it's called sandbox a lot
throughout the documentation such and it

132
00:10:45,310 --> 00:10:49,119
basically relies on the separation
between users so if you have the media

133
00:10:49,120 --> 00:10:50,880
server running his demeanor user

134
00:10:50,880 --> 00:10:55,900
systems ordering system user than they
have some isolation from each other and

135
00:10:55,900 --> 00:10:59,300
also when you install applications on
Android they each get their own user IDs

136
00:10:59,300 --> 00:11:04,689
to be separated that way as well so
lived a trade execution side the media

137
00:11:04,690 --> 00:11:11,210
server component so that it runs in the
background every Android device that

138
00:11:11,210 --> 00:11:11,940
I've ever seen

139
00:11:11,940 --> 00:11:15,190
never seen an Android device without me
to server that's another reason why I

140
00:11:15,190 --> 00:11:19,190
looked into it back when I got the droid
army one of the things I was doing was

141
00:11:19,190 --> 00:11:22,840
looking at all the devices what is
common between all these devices and

142
00:11:22,840 --> 00:11:27,520
media server definitely stuck out as one
of those so it's a native service that

143
00:11:27,520 --> 00:11:31,840
starts from in it so when the kernel
starts up the first thing it does when

144
00:11:31,840 --> 00:11:36,560
it's done initializing is it runs the
process the process will then read this

145
00:11:36,560 --> 00:11:40,260
configuration file and launch all the
services that are set to be launched

146
00:11:40,260 --> 00:11:46,510
their an interesting thing to point out
is that when a program that started by

147
00:11:46,510 --> 00:11:50,569
Anick crashes and it will automatically
restart that saying basically

148
00:11:50,570 --> 00:11:56,290
indefinitely on Android I think I'm some
other systems like Linux Ubuntu or

149
00:11:56,290 --> 00:12:00,810
something if your processes crashing
over and over the starting from it and

150
00:12:00,810 --> 00:12:04,359
it will actually say hey this thing is
messed up you know maybe we don't want

151
00:12:04,360 --> 00:12:09,910
to keep restarting it would still have
an aggressive back off time on it so

152
00:12:09,910 --> 00:12:13,329
let's talk about privileges of this
device I said I mention I mentioned it

153
00:12:13,330 --> 00:12:19,640
runs as the user media this is a Nexus 5
destruction its grip again so you can

154
00:12:19,640 --> 00:12:24,980
see here apart from running is the user
media it also has access to the audio

155
00:12:24,980 --> 00:12:31,730
camera internet key to boot
administration and with the county DRAM

156
00:12:31,730 --> 00:12:37,190
remote procedure call and also add
immediately or in groups so what these

157
00:12:37,190 --> 00:12:42,720
groups on Android like to do is talk to
a lot of different endpoints so

158
00:12:42,720 --> 00:12:45,900
basically they're opening a bunch of
attack surface if you're able to get

159
00:12:45,900 --> 00:12:49,480
into this process you have all this
additional attack surface exposed to you

160
00:12:49,480 --> 00:12:52,770
but you also have all the legitimate
functionality to those groups will give

161
00:12:52,770 --> 00:12:58,939
you access to as well so the audio group
is for example used to limit access to

162
00:12:58,940 --> 00:13:03,089
the devices that the kernel exposes for
dealing with the DSP

163
00:13:03,089 --> 00:13:08,800
so if you want to record audio then you
know media servers able to do that to

164
00:13:08,800 --> 00:13:09,599
take pictures

165
00:13:09,600 --> 00:13:12,249
media server is more likely able to do
that if you want to connect to the

166
00:13:12,249 --> 00:13:18,699
internet can be able to do that so
there's more so I did a survey on the

167
00:13:18,699 --> 00:13:22,449
droid army had 51 devices plugged in at
the time I think I have almost 200

168
00:13:22,449 --> 00:13:25,959
devices at this point but they're not
all plugged in all the time because I

169
00:13:25,959 --> 00:13:32,420
have more time to do some refactoring on
that surveyed 51 to break down here is

170
00:13:32,420 --> 00:13:40,079
by OEM how are you know what I'm trying
to show her there may be something

171
00:13:40,079 --> 00:13:42,359
missing

172
00:13:42,360 --> 00:13:52,860
ok this is the number of groups yea on
each device so Google Nexus devices you

173
00:13:52,860 --> 00:13:58,779
can be right I'm gonna have to take it
on this one look at them later as in the

174
00:13:58,779 --> 00:14:05,300
gradual bear with me so let's look into
more survey results appear look at again

175
00:14:05,300 --> 00:14:08,670
we talked about all these things what
they can do here is commented out and

176
00:14:08,670 --> 00:14:11,920
explained so you can look at it later
and I kind of it

177
00:14:11,920 --> 00:14:16,889
hinted on what you can do with some
buddies and you know the worst of it is

178
00:14:16,889 --> 00:14:20,809
that this plane if you attack this
process successfully you can already

179
00:14:20,809 --> 00:14:24,110
just dream the microphone straight to
your cell like if that's what you want

180
00:14:24,110 --> 00:14:27,999
to do just writes like a little bit of
code read from the DSP send it over the

181
00:14:27,999 --> 00:14:35,089
internet that's it so looking closer at
the droid army if we start to take the

182
00:14:35,089 --> 00:14:40,029
groups and breaking into like unique
number of devices with that group you

183
00:14:40,029 --> 00:14:45,379
end up saying that the most of the
classes you can see here in the count on

184
00:14:45,379 --> 00:14:51,069
the left 51 so all of the devices had
these groups and with this 33 devices

185
00:14:51,069 --> 00:14:55,729
had the band with the counting 33 with
your Mr PC you have 27 devices with the

186
00:14:55,730 --> 00:15:01,040
system group so system that's that's
rough cuts like over half of the devices

187
00:15:01,040 --> 00:15:06,248
I surveyed the system group is very
crucial Groupon on Android to the point

188
00:15:06,249 --> 00:15:10,709
where it's it's basically one level
below so if you have two systems group

189
00:15:10,709 --> 00:15:13,540
you can basically get root really easy

190
00:15:13,540 --> 00:15:18,639
Lee usually but it still would require
another bug a very minor privilege

191
00:15:18,639 --> 00:15:21,889
escalation but even without that
privilege escalation so you don't want

192
00:15:21,889 --> 00:15:26,259
to bother getting root system server
still is the thing that approves

193
00:15:26,259 --> 00:15:30,420
permissions for acts as the thing that
lets you do basically everything on

194
00:15:30,420 --> 00:15:36,360
Android almost there almost everything
goes through system server in some way

195
00:15:36,360 --> 00:15:42,560
especially the things that are important
for security critical decisions when we

196
00:15:42,560 --> 00:15:47,258
go down to the next one we've got
graphics devices with 20 graphics group

197
00:15:47,259 --> 00:15:51,750
with 20 devices now the graphics group
has been used numerous times in the past

198
00:15:51,750 --> 00:15:57,350
to exploit privilege escalation
vulnerability in the Linux kernel so you

199
00:15:57,350 --> 00:16:00,569
don't normally get this group from a nap
you can ask for in this group and a nap

200
00:16:00,569 --> 00:16:04,620
this is basically like not many ways to
get this group of this is one of them

201
00:16:04,620 --> 00:16:09,699
and then sometimes you're given this
group 3d TV show although that's a lot

202
00:16:09,699 --> 00:16:15,219
different attack vectors and this is
what I want to go into the rest of them

203
00:16:15,220 --> 00:16:19,430
but you can see there's a breakdown at
the bottom there there's there's two

204
00:16:19,430 --> 00:16:23,479
that are really weird there's for
devices with the Shell Group the Shell

205
00:16:23,480 --> 00:16:28,810
Group is normally only allowed only
assigned to the adb shell process when

206
00:16:28,810 --> 00:16:35,540
you do a TV show to a device and its
mind blowing to me why this process

207
00:16:35,540 --> 00:16:41,569
would have that access and then the
radio group so if you had to rank all

208
00:16:41,569 --> 00:16:44,800
the groups and all the other users on
Android like you've got colonel and then

209
00:16:44,800 --> 00:16:48,389
you've got route then you've got system
next month's radio cuz radio basically

210
00:16:48,389 --> 00:16:53,279
has access to your file they can send
you know that's a mess that can make

211
00:16:53,279 --> 00:16:58,910
calls it can hide your calls you can you
can do a lot of things so very powerful

212
00:16:58,910 --> 00:17:03,380
position to be in with that group so
let's recap a little bit about this

213
00:17:03,380 --> 00:17:05,770
before in this the the section

214
00:17:05,770 --> 00:17:10,780
they try process its media stuff inside
the media server process which runs

215
00:17:10,780 --> 00:17:14,959
privileged potentially even with system
privileges and it automatically restart

216
00:17:14,959 --> 00:17:20,410
whenever it crashes there's additional
attack surface even compared to having a

217
00:17:20,410 --> 00:17:26,700
TV show to talk about attack surface
itself and when I talk about tax service

218
00:17:26,700 --> 00:17:32,150
investors generally a surface is what I
will call the code that's beneath the

219
00:17:32,150 --> 00:17:35,770
vector of vector as to why you got to
the code right so it kinda at some point

220
00:17:35,770 --> 00:17:40,700
this delivered a free library in this
case that line becomes the attack

221
00:17:40,700 --> 00:17:46,070
surface and everything before it's just
part of the vector so locating the

222
00:17:46,070 --> 00:17:49,030
attack surface and this is how I figured
out where the code was and what was

223
00:17:49,030 --> 00:17:56,750
going on right now i i i just started up
to the video player to play video what

224
00:17:56,750 --> 00:18:01,830
to do about her attached and I looked at
the backtrace to see where things were

225
00:18:01,830 --> 00:18:05,159
were you know what what the functions
where what's what's important here and

226
00:18:05,160 --> 00:18:09,300
you can see here all the different
functions so what when I did I looked

227
00:18:09,300 --> 00:18:13,790
even closer each function and then I
started to see kind of where it was

228
00:18:13,790 --> 00:18:19,430
calling into things here you can see
it's calling set data source on line

229
00:18:19,430 --> 00:18:26,470
2127 so we look at that function and
then we see it's calling this extractor

230
00:18:26,470 --> 00:18:31,240
contracts that ends up calling this
dysfunction in the mpeg4 extractor class

231
00:18:31,240 --> 00:18:35,300
called contracts which then calls read
meditative so simply counting how many

232
00:18:35,300 --> 00:18:40,770
tracks are in this video would would
directly call rate in the stage for the

233
00:18:40,770 --> 00:18:45,810
first time function so the person chunk
function is is the primary attack

234
00:18:45,810 --> 00:18:51,649
surface for the mpeg4 parsing in the lib
stage fright it handles the dispatch for

235
00:18:51,650 --> 00:18:56,230
basically all the first BC codes that
are handled and it is implemented as a

236
00:18:56,230 --> 00:18:59,120
recursive function so whenever she's

237
00:18:59,120 --> 00:19:04,129
and Adam the supposed to have like a
collection of atoms inside of it takes

238
00:19:04,130 --> 00:19:10,870
that data and then calls itself again
with an increased depth joy I did a

239
00:19:10,870 --> 00:19:16,149
little survey of different versions of
Android figure out how many atom types

240
00:19:16,150 --> 00:19:19,850
are supported I came up with eighty on
the lower end and a hundred and forty

241
00:19:19,850 --> 00:19:25,350
under the newest devices so this code
has been continually developed over time

242
00:19:25,350 --> 00:19:31,770
and it has more now than it did before
so now let's talk about him the attack

243
00:19:31,770 --> 00:19:37,150
vectors let's talk about how do you get
into this code as an attacker like you

244
00:19:37,150 --> 00:19:40,920
know the service is great you can tickle
it and play with it but if you can't

245
00:19:40,920 --> 00:19:46,040
actually get there is an attacker it's
pretty worthless so I used this

246
00:19:46,040 --> 00:19:50,740
methodology to enumerate what detectors
were with my goal being how can I get my

247
00:19:50,740 --> 00:19:57,540
media files into this code so you know
one thing I did a lot was I would set

248
00:19:57,540 --> 00:20:02,550
breakpoints into this code and I would
do things like open videos look at the

249
00:20:02,550 --> 00:20:08,340
gallery like attachment to an email like
myself all these things and those are

250
00:20:08,340 --> 00:20:13,379
quickly showing you that coaching hitter
not really really know what else addis

251
00:20:13,380 --> 00:20:17,179
if you do use to parse chunk function as
your break point you'll get a lot of

252
00:20:17,179 --> 00:20:22,720
noise because it does recall chill
forcibly so try to like break more on

253
00:20:22,720 --> 00:20:27,510
like to read metadata function instead
so the problem with this kind of

254
00:20:27,510 --> 00:20:32,410
methodology is that it depends on you
knowing every way possible to do it

255
00:20:32,410 --> 00:20:36,630
anyway why does how do you know that
there's not some weird esoteric way

256
00:20:36,630 --> 00:20:41,990
where you can like you know maybe like
bump phones with somebody and get a

257
00:20:41,990 --> 00:20:47,500
media file owners like a lot of ways
right so you don't know them all and so

258
00:20:47,500 --> 00:20:50,220
that the only way to really figure him
out and it's may change from person to

259
00:20:50,220 --> 00:20:50,800
person and then

260
00:20:50,800 --> 00:20:54,940
steven is to just read through the code
and figure out what's going on so the

261
00:20:54,940 --> 00:20:56,830
idea is to find all calls to function

262
00:20:56,830 --> 00:21:02,399
see if you ask yourself hey attackers
day to reach here if you don't know the

263
00:21:02,400 --> 00:21:06,290
answer then you continue to track
backwards until you find you know that

264
00:21:06,290 --> 00:21:11,240
that place where it's like reading from
the network and then pass it along so

265
00:21:11,240 --> 00:21:15,120
again I mention the modularity and
Android and it does complicate things

266
00:21:15,120 --> 00:21:21,550
during looking at the code is kinda
coming between the the attack vector and

267
00:21:21,550 --> 00:21:28,060
the attack surface in one case I saw
code pass they called in an hour of Java

268
00:21:28,060 --> 00:21:33,389
code back and forth like three or four
times as I don't know what's going on

269
00:21:33,390 --> 00:21:37,260
there but that's what was happening is
also its object oriented code so that

270
00:21:37,260 --> 00:21:40,879
means you have to pay attention to the
members of of classes you have to pay

271
00:21:40,880 --> 00:21:46,650
attention two methods you can't just
it's not as easy to grow up for things

272
00:21:46,650 --> 00:21:56,750
so you have to be mindful of that and
also the lifetimes of some things so I

273
00:21:56,750 --> 00:22:00,620
mentioned also how things are connected
with IPC on Android that's another thing

274
00:22:00,620 --> 00:22:04,080
that can complicate things sometimes
you'll be reading some code to read some

275
00:22:04,080 --> 00:22:07,730
stuff from the network and then it will
just kind of like throw that up in the

276
00:22:07,730 --> 00:22:12,440
air if you will broadcast an intent and
say hey something deal with this and

277
00:22:12,440 --> 00:22:15,650
then something else will pick it up so
you have to be able to figure out what's

278
00:22:15,650 --> 00:22:21,770
gonna pick it up and then continue
ordering from there that the company is

279
00:22:21,770 --> 00:22:25,960
dumped some doctors may be through after
close source a great example being hang

280
00:22:25,960 --> 00:22:31,730
out or Google+ or you know just pick one
of those clothes for school proprietary

281
00:22:31,730 --> 00:22:38,900
apps or even third party ones to weirdos
from the manufacturers who made create

282
00:22:38,900 --> 00:22:43,680
their own so in my opinion this disc
this is still the best possible way to

283
00:22:43,680 --> 00:22:47,260
learn all methods mean you really have
to do a lot of stuff these are the

284
00:22:47,260 --> 00:22:52,290
things that will complicated but at the
same time without consulting the code

285
00:22:52,290 --> 00:22:56,500
you're not going to find conclusively
what the answer to that question is so

286
00:22:56,500 --> 00:23:01,090
the first doctor that I found what I was
doing the research was just using the

287
00:23:01,090 --> 00:23:03,600
video tag additional 50 psychology

288
00:23:03,600 --> 00:23:08,719
Unified School try to be attacked as I
am done East Milton 4.1 or something so

289
00:23:08,720 --> 00:23:13,390
I try to get my cat picture that I just
sent myself an MMS with a link like hey

290
00:23:13,390 --> 00:23:14,510
check this out

291
00:23:14,510 --> 00:23:21,340
boom and it did hit the code so then I
was like I remember back back in 2009

292
00:23:21,340 --> 00:23:26,939
2010 timeframe there was a guy who was
like Thomas can and he was like hey you

293
00:23:26,940 --> 00:23:30,340
know you can make Android download files
automatically was just saying hey and

294
00:23:30,340 --> 00:23:36,000
the files and attachments not an actual
file and then if you do that you can see

295
00:23:36,000 --> 00:23:39,140
the progression here it's a different
link will include

296
00:23:39,140 --> 00:23:43,330
excuse the images it was a different
league in reality but I just used the

297
00:23:43,330 --> 00:23:47,418
same image here you can see the second
picture the different there to top and

298
00:23:47,419 --> 00:23:51,760
then it's just an iframe pointing to you
know like a Python script it spits out

299
00:23:51,760 --> 00:23:56,230
the door saying it's an attachment or
and that's exactly what you see this the

300
00:23:56,230 --> 00:24:00,270
the toast at the bottom to downloading
in the oval that disappears like pretty

301
00:24:00,270 --> 00:24:02,990
much right away so it's kinda hard to
get the screenshot but at the same time

302
00:24:02,990 --> 00:24:08,039
like the download has already happened
if you look to the right of the final

303
00:24:08,039 --> 00:24:14,200
image you see what you would see if you
go home after and then touch to download

304
00:24:14,200 --> 00:24:18,140
think like or if you swipe down from the
top

305
00:24:18,140 --> 00:24:22,450
look at the notification for the
download in touch it now

306
00:24:22,450 --> 00:24:29,710
this attack vector going this attack
vector all the download rapping in the

307
00:24:29,710 --> 00:24:30,450
background

308
00:24:30,450 --> 00:24:37,210
Android has a whole sub system that's
called download manager that's provided

309
00:24:37,210 --> 00:24:39,510
to absent everything else

310
00:24:39,510 --> 00:24:43,879
22 kind of like say hey I want to
download something but I don't want to

311
00:24:43,880 --> 00:24:46,460
do the downloading so why don't you do
that for me and let me know when it's

312
00:24:46,460 --> 00:24:51,090
done so that means to download rapping
in the background even in the browser

313
00:24:51,090 --> 00:24:55,678
there's no prompting so you cannot even
and unfortunately you cannot say hey I

314
00:24:55,679 --> 00:24:58,840
wanna be asked if I want to download
files is just going to download it

315
00:24:58,840 --> 00:25:05,620
whether you like it or not so feature
requests John I'm looking at you you can

316
00:25:05,620 --> 00:25:08,939
like rebroadcast

317
00:25:08,940 --> 00:25:12,390
behavior has been abused in the past
right with Thomas cannons Daily Beast

318
00:25:12,390 --> 00:25:13,799
attack but also on

319
00:25:13,799 --> 00:25:17,700
Safari there was a big deal big big
Press article back in the day about

320
00:25:17,700 --> 00:25:22,470
safari car carpet bombing where somebody
can come to your website you just like

321
00:25:22,470 --> 00:25:25,669
span the hell out of with files and then
you just help us just killed his files

322
00:25:25,669 --> 00:25:29,450
because the DePaul for so far as to just
save everything to the desktop and I

323
00:25:29,450 --> 00:25:32,309
don't know I don't use Safari but does
anybody know if that still is what

324
00:25:32,309 --> 00:25:38,149
happens is still save automatically
today anyway

325
00:25:38,149 --> 00:25:45,119
unrelated so testing shows it processes
media as soon as the dow just finished

326
00:25:45,119 --> 00:25:49,988
in and pretty much all cases there there
are ways to call into that code that you

327
00:25:49,989 --> 00:25:53,980
can tell it not to scan Amelia but when
I looked at any rate code in the places

328
00:25:53,980 --> 00:25:58,350
where they call in there they typically
don't scan it and then when they get the

329
00:25:58,350 --> 00:26:04,428
notification that its finished ago hey
scan it so that's interesting there's a

330
00:26:04,429 --> 00:26:08,029
link here if you want to read more about
the download manager as well and there

331
00:26:08,029 --> 00:26:13,509
is a long section about the stuff in
more depth in the bonus low of the day

332
00:26:13,509 --> 00:26:18,159
care center the media scanner at you at
some point I'm reading the code I'm like

333
00:26:18,159 --> 00:26:20,859
hey what is this thing called media
scanner that they keep calling into

334
00:26:20,859 --> 00:26:24,499
everywhere all over the place it's
called in to buy the download manager

335
00:26:24,499 --> 00:26:27,710
directly if you say so or it's called in
to buy those apps where they're like

336
00:26:27,710 --> 00:26:33,100
well $2 finish let's get it so i i read
all about it it's actually somewhat

337
00:26:33,100 --> 00:26:37,529
documented in the documentation pages
and mostly they document what's called

338
00:26:37,529 --> 00:26:43,029
the media scanner connection and they
also listed media mounted and media

339
00:26:43,029 --> 00:26:48,499
scanner scan file intense in the intent
documentation page so I don't those are

340
00:26:48,499 --> 00:26:53,609
very interesting like I can just send in
10 that will just scan to file or scan

341
00:26:53,609 --> 00:26:58,369
let's say in sdcard for a whole
directory or however you wanna do it

342
00:26:58,369 --> 00:27:01,830
extracting metadata uses live stage
fright so it's fitting that it's getting

343
00:27:01,830 --> 00:27:05,689
this tax service to her new
understanding you know we can go back

344
00:27:05,690 --> 00:27:08,989
and look at more things like ok now we
know the media scanner we know what it

345
00:27:08,989 --> 00:27:11,470
does and we know about these intense

346
00:27:11,470 --> 00:27:15,350
where else are these things being used
and we just continually like learn more

347
00:27:15,350 --> 00:27:21,109
things basically to grow up for it and
then we go grab for them which script so

348
00:27:21,109 --> 00:27:22,530
when we do that we find tons

349
00:27:22,530 --> 00:27:27,129
attack vectors we find a multitude we
find a mass coming over the mobile

350
00:27:27,130 --> 00:27:30,420
network for client-side with your
browser to be mentioned in the damage to

351
00:27:30,420 --> 00:27:34,180
mention but there's also email
attachments I don't when you receive an

352
00:27:34,180 --> 00:27:37,440
attachment on Android and email it
doesn't automatically download but if

353
00:27:37,440 --> 00:27:42,990
you like say hey I want to look at that
going to download and scan so you also

354
00:27:42,990 --> 00:27:45,720
have physically adjacent things right
like I mentioned bumping your phone

355
00:27:45,720 --> 00:27:50,690
somebody also Bluetooth or if you
transfer vCards with anyone else know if

356
00:27:50,690 --> 00:27:53,880
anybody's ever actually used the cards
but they're hanging around somewhere in

357
00:27:53,880 --> 00:27:58,770
there so physical there's also sdcard so
if you put some delicious media on

358
00:27:58,770 --> 00:28:02,750
sdcard and shoving into somebody's
phones sd-card slot it will immediately

359
00:28:02,750 --> 00:28:08,920
mount sdcard and scan all the stuff on
it very convenient for you can use a USB

360
00:28:08,920 --> 00:28:15,070
OTG drive if you have and that's all he
is on the go and show them basically

361
00:28:15,070 --> 00:28:20,689
what it means is it tells the device
like hey why don't you stop being a USB

362
00:28:20,690 --> 00:28:25,550
d device and start being USB host and
I'll give you my USB Drive so does it

363
00:28:25,550 --> 00:28:29,570
work on all devices because of hardware
support but that's also a very

364
00:28:29,570 --> 00:28:35,679
legitimate actor so since Android 4.0
they also have a mode called Pete MTP

365
00:28:35,680 --> 00:28:39,950
PTP that's the media Transfer Protocol
or picture Transfer Protocol those are

366
00:28:39,950 --> 00:28:45,490
created by Microsoft but that's
irrelevant 22 this talk about anything

367
00:28:45,490 --> 00:28:48,800
you upload to a device when you're
connected through these modes will also

368
00:28:48,800 --> 00:28:53,740
be scanned and finally in the gallery
when you open it its candidate or

369
00:28:53,740 --> 00:28:58,500
anytime you on Etsy any sort of
thumbnail or any sort of thing happening

370
00:28:58,500 --> 00:29:03,410
on screen it still is still going to
continually scanner for some reason I

371
00:29:03,410 --> 00:29:06,490
thought if you scan something input into
database then you probably have it

372
00:29:06,490 --> 00:29:11,630
you get there instead of just giving
scared again but it may be faster to run

373
00:29:11,630 --> 00:29:15,580
stage fright code to scan that media and
get the information you need that would

374
00:29:15,580 --> 00:29:20,980
be to actually go and hit the database
so in total I carried over 11 attack

375
00:29:20,980 --> 00:29:26,990
vectors that may vary between devices my
test the device was a Nexus device x5

376
00:29:26,990 --> 00:29:33,020
and all and auditing I did it was too
early on it was pete was no other code

377
00:29:33,020 --> 00:29:38,900
basis whatsoever so ask yourself do you
use any of these to talk to any people

378
00:29:38,900 --> 00:29:44,000
you don't trust or can anybody to talk
to you that you don't trust you and

379
00:29:44,000 --> 00:29:49,170
these whether you talk to them so the
scariest part in this is the media thing

380
00:29:49,170 --> 00:29:51,980
the media picked up on the most
interesting is the most dangerous thing

381
00:29:51,980 --> 00:29:56,240
we're seeing people make kind of drastic
changes like I was notified earlier the

382
00:29:56,240 --> 00:30:01,220
tmobile in germany has actually
disabling MMS on their network

383
00:30:01,220 --> 00:30:05,970
drastic but maybe Warrington maybe they
determined they had a lot of really old

384
00:30:05,970 --> 00:30:10,559
Android devices so it's it's
automatically processed in the hangouts

385
00:30:10,559 --> 00:30:14,590
application and also I further testing
showed that the the messenger

386
00:30:14,590 --> 00:30:19,309
application that everyone missed from
what has become the default is now on

387
00:30:19,309 --> 00:30:25,270
the Play Store that one also triggers
pretty aggressively this code so I can

388
00:30:25,270 --> 00:30:30,490
hang out whenever this message comes in
by the fall or retrieves owners are

389
00:30:30,490 --> 00:30:34,370
saying hello to retrieve so-called
al-adha media and then scanning right

390
00:30:34,370 --> 00:30:37,550
away without you know you shouldn't be
off it doesn't it doesn't even matter

391
00:30:37,550 --> 00:30:41,990
and i'll show that later so explain it
could get you all those privileges we

392
00:30:41,990 --> 00:30:46,960
talked about before it through MMS you
don't even have to like worry about them

393
00:30:46,960 --> 00:30:53,210
touching anything more like the phone
could be in another room where like you

394
00:30:53,210 --> 00:30:57,230
know put us in the slides because I just
kind of thought about last night at dawn

395
00:30:57,230 --> 00:31:03,559
on me again when those things you you
know comes up in conversation or such a

396
00:31:03,559 --> 00:31:07,460
mess is transferred through what's
called you why don't know what they want

397
00:31:07,460 --> 00:31:10,390
to call I don't know what to call it but
its various meant to be a reliable

398
00:31:10,390 --> 00:31:13,740
communications mechanism so basically if
I send you an email

399
00:31:13,740 --> 00:31:16,510
mass and you turn your phone off cos
your phone's blowing up with these nasty

400
00:31:16,510 --> 00:31:20,620
messes sure your phones off that's great
for you turn your phone on this carrier

401
00:31:20,620 --> 00:31:24,000
network held on to all those investors
for you there waiting for you to come

402
00:31:24,000 --> 00:31:28,720
back and get them so you turn your phone
off isn't even really great mitigation

403
00:31:28,720 --> 00:31:34,200
either creating the one thing that's
great

404
00:31:34,200 --> 00:31:39,050
mentioned silent here and the reason I
say that is because the code of all the

405
00:31:39,050 --> 00:31:42,580
vulnerable code is triggered and exploit
triggered before the notification of an

406
00:31:42,580 --> 00:31:48,220
MMS ever hit your device so you couldn't
directly and it probably be a

407
00:31:48,220 --> 00:31:52,760
significant amount of engineering work
to do this but you could develop and

408
00:31:52,760 --> 00:31:56,030
exploit such data payload would clean up
all that mess and stop that from

409
00:31:56,030 --> 00:32:00,730
happening to leave them amassed like all
the things and you won't see anything at

410
00:32:00,730 --> 00:32:04,030
all even when you were looking at your
device and that freaks me out I don't

411
00:32:04,030 --> 00:32:09,830
know about you guys so so the big thing
here is it it's like you need a phone

412
00:32:09,830 --> 00:32:13,720
number to attack somebody this way but
attacked phone number seven digit number

413
00:32:13,720 --> 00:32:18,429
area codes are fairly predictable you
don't really need to enforce all those

414
00:32:18,429 --> 00:32:22,940
and prefixes are actually variable
through web site so at some point you

415
00:32:22,940 --> 00:32:26,290
have to limit that down to a much
smaller number and just hit everyone if

416
00:32:26,290 --> 00:32:32,820
you wanted to know where does it work I
mention the house application somewhere

417
00:32:32,820 --> 00:32:36,780
along the line when introducing out as a
default they did their movie and

418
00:32:36,780 --> 00:32:40,170
original messaging application the one
with the little green square with the

419
00:32:40,170 --> 00:32:47,809
happy face and so I mentioned us know if
you guys have a mess like right now you

420
00:32:47,809 --> 00:32:51,100
should take your phone out and you
should turn off auto retrieve if you

421
00:32:51,100 --> 00:32:55,169
have not already caused it will save you
from the nasty one save you from

422
00:32:55,170 --> 00:32:59,230
everything you can still get spammed
with Ms you still get lured to click it

423
00:32:59,230 --> 00:33:04,470
you can still get her to a link to use
me

424
00:33:04,470 --> 00:33:23,929
still so it's not a silver bullet but it
absolutely makes the nastiest thing it

425
00:33:23,929 --> 00:33:29,539
will hopefully if you have a really old
device which I hope you upgrade it could

426
00:33:29,539 --> 00:33:34,250
prevent you from being the propagator of
the world possibly I mentioned this

427
00:33:34,250 --> 00:33:38,010
before the formal Curtis triggered vary
by early if you will I like to use that

428
00:33:38,010 --> 00:33:42,740
word for some reason it may be a strong
word but aggressive it's similar to the

429
00:33:42,740 --> 00:33:46,650
old days when you would see sort of an
image file did you save on your desktop

430
00:33:46,650 --> 00:33:51,880
and also devotedly triggers in that
things get really ugly from there so you

431
00:33:51,880 --> 00:33:55,659
know for example rotating the screen
every time that activity in an Android

432
00:33:55,659 --> 00:34:03,880
app is redrawn with media showing it
just ends up going so are there any

433
00:34:03,880 --> 00:34:06,590
other vectors I don't know I haven't
looked at everything I can look at

434
00:34:06,590 --> 00:34:10,330
everything I got this question a lot on
Twitter like is what's happened idea i

435
00:34:10,330 --> 00:34:12,179
use whatsapp

436
00:34:12,179 --> 00:34:16,550
facebook Messenger fact no idea i use
facebook Messenger like going on and I

437
00:34:16,550 --> 00:34:21,669
have testimony so in general like he can
go and say if any Android devices

438
00:34:21,668 --> 00:34:24,969
allowing you to view media from anyone
trusted person then it's probably

439
00:34:24,969 --> 00:34:32,020
affected me so you know here some other
ideas if you guys decide to look into

440
00:34:32,020 --> 00:34:36,460
this stuff and you want to learn you you
manage to find another doctor I'd love

441
00:34:36,460 --> 00:34:39,540
to hear about it you know something cool
like that is always fun to learn while

442
00:34:39,540 --> 00:34:46,560
so let's talk about the talk about
finding the bugs that's fine so

443
00:34:46,560 --> 00:34:49,969
basically haven't discovered methodology
to the really dumb and I'm gonna go kind

444
00:34:49,969 --> 00:34:53,560
of trouble fast right now there's
nothing like rocket science right here

445
00:34:53,560 --> 00:34:57,880
you know right off the methodology maybe
a little rocket science he is well

446
00:34:57,880 --> 00:35:01,310
advanced but writing the dumpster is
like you know seriously just five

447
00:35:01,310 --> 00:35:08,560
minutes like five line python script
that's fine let go and well-run should

448
00:35:08,560 --> 00:35:13,070
read the code way for a crash you get a
crash green Dakota near the crash like

449
00:35:13,070 --> 00:35:14,109
its bad code

450
00:35:14,109 --> 00:35:19,589
dude it's gotta be bad right will first
but caused the crash and then like what

451
00:35:19,589 --> 00:35:23,328
else could happen in that code is maybe
something bad there for you just repeat

452
00:35:23,329 --> 00:35:26,589
that into your brain is fried and then
go sleep and try again the next day

453
00:35:26,589 --> 00:35:31,460
maybe the first round with something
like this we did again we focused on it

454
00:35:31,460 --> 00:35:39,180
before it's really build a corpus a big
optimized fancy corpus of test files we

455
00:35:39,180 --> 00:35:44,739
basically had one file called me out i
three GOP is just the cabin you may have

456
00:35:44,739 --> 00:35:49,749
seen in the other pictures it's really
simple video and we just started with

457
00:35:49,749 --> 00:35:54,730
that we ran it for about a week and a
bunch of Android devices and not run

458
00:35:54,730 --> 00:35:57,910
across the whole droid army by any means
but it was like we've we've picked up

459
00:35:57,910 --> 00:36:02,379
you select devices and we've done that
we got 6200 crashes in one week

460
00:36:02,380 --> 00:36:08,049
unfortunately when I looked into these
crashes one-by-one bucketing them into

461
00:36:08,049 --> 00:36:12,059
the like similarity and all that stuff
what about those are about 20 unique

462
00:36:12,059 --> 00:36:15,859
bugs but they were all really really
lame bugs like no point of view

463
00:36:15,859 --> 00:36:18,489
restaurants or like there is an
assertion where they like it just

464
00:36:18,489 --> 00:36:24,319
numbers not one that we'd like to tour
ends up in crash stuff like that however

465
00:36:24,319 --> 00:36:28,220
when I was in the code I started looking
around nearby which I recommend everyone

466
00:36:28,220 --> 00:36:33,269
does that when they're looking at this
announcement their analysis and I

467
00:36:33,269 --> 00:36:37,180
thought about 5 memory corruptions at
that point and this became these two sea

468
00:36:37,180 --> 00:36:41,009
bees 1538 1539 from this year

469
00:36:41,009 --> 00:36:45,099
01538 is actually four different
vulnerabilities but they're all wrapped

470
00:36:45,099 --> 00:36:49,920
into one CD because of similar root
cause and lifetime so on a second-round

471
00:36:49,920 --> 00:36:53,900
I decided to try all American fuzzy lop
I thought that was really cool idea like

472
00:36:53,900 --> 00:36:58,589
coverage based buzzing is really cool in
the way that is implemented is quite

473
00:36:58,589 --> 00:37:06,529
it's quite clever and so this was a kind
of gravitates towards exciting new code

474
00:37:06,529 --> 00:37:15,779
the main goal I think behind grading FL
was to generate a corpus for other

475
00:37:15,779 --> 00:37:20,549
fathers to use that way you optimized
code past not by finding all the files

476
00:37:20,549 --> 00:37:25,049
you can add testing to see which ones
are the best but by creating files that

477
00:37:25,049 --> 00:37:29,349
are actually reach the most you can say
the same methodology is a little

478
00:37:29,349 --> 00:37:35,719
different so I developed a test harness
to run stage fright machine and then I

479
00:37:35,719 --> 00:37:40,489
would periodically like say once a day
ago and I've stopped the buzzer look at

480
00:37:40,489 --> 00:37:41,519
all the results

481
00:37:41,519 --> 00:37:45,848
bucket them I would analyze them and
then I would fix each individual

482
00:37:45,849 --> 00:37:50,599
vulnerability and I catalog as soon as I
found it died restart the father for the

483
00:37:50,599 --> 00:37:54,719
next day so basically every day I was
guaranteed I would never find the same

484
00:37:54,719 --> 00:38:05,299
bug again all the slide in make it for
slide show less selective testing I

485
00:38:05,299 --> 00:38:09,259
think for this one was about a week
maybe two weeks with AFL I was getting

486
00:38:09,259 --> 00:38:15,529
about I think it was like 3200
executions per second testing this code

487
00:38:15,529 --> 00:38:22,190
and so after a week of running FL with a
Skoda said it ran for like six months or

488
00:38:22,190 --> 00:38:29,900
something on the the time based on the
multiplication of speeding course as the

489
00:38:29,900 --> 00:38:37,279
number of issues found in that second
that second phase was something like an

490
00:38:37,279 --> 00:38:42,739
additional sorta like six
vulnerabilities are so then finally got

491
00:38:42,739 --> 00:38:47,880
to report I am calling on gears here all
the CBO numbers broken out with the DMP

492
00:38:47,880 --> 00:38:54,420
for items that were affected and apart
from these also reported a whole slew of

493
00:38:54,420 --> 00:38:58,839
stability fixes my thoughts were fixing
all these no point of reference bugs and

494
00:38:58,839 --> 00:39:03,440
other lame bugs just gonna increase my
fidelity when I run my father so I the

495
00:39:03,440 --> 00:39:06,960
idea is to give everybody those fixes so
they can run their father and have good

496
00:39:06,960 --> 00:39:10,730
facilities well instead of sorting
through million

497
00:39:10,730 --> 00:39:16,590
so let's talk about one of the bugs and
in particular that I thought was kind of

498
00:39:16,590 --> 00:39:21,420
crazy so I don't have time to go into
the full details there's good write-ups

499
00:39:21,420 --> 00:39:24,500
out there already based on media
coverage people look and wrote them up

500
00:39:24,500 --> 00:39:29,880
the patches are already out there and
several forms so it's also the commit

501
00:39:29,880 --> 00:39:34,470
messages that I sent him were very good
and very clear commit messages so it

502
00:39:34,470 --> 00:39:39,399
should be clear what's going on in each
of them so let's look at a few other

503
00:39:39,400 --> 00:39:43,710
labor relations interrelated issues we
have this commit back from July 28th of

504
00:39:43,710 --> 00:39:49,070
2014 which is about a year ago right
before black thank you

505
00:39:49,070 --> 00:39:53,950
is right before black hat last year they
commit the guy committed this is a

506
00:39:53,950 --> 00:39:56,950
sample table check in a Drosophila
during table hockey gettysburg numbers

507
00:39:56,950 --> 00:40:02,060
look a little bit closer at this they're
all really similar school just like 10

508
00:40:02,060 --> 00:40:03,230
basically the same thing

509
00:40:03,230 --> 00:40:08,300
headed code with the pluses on the left
you can see that they're okay well we

510
00:40:08,300 --> 00:40:12,980
had a 64 bit unsigned integer we're
going to multiply the stuff out and if

511
00:40:12,980 --> 00:40:18,540
it's bigger than 32 bit maximum
basically size max then we're gonna say

512
00:40:18,540 --> 00:40:21,940
oh well that's a failure you know how to
range we're not going to let it go down

513
00:40:21,940 --> 00:40:26,350
to this code that follows where it would
actually causing injury flow and

514
00:40:26,350 --> 00:40:30,960
allocate insufficient memory so it looks
good right I thought it looked good I

515
00:40:30,960 --> 00:40:36,990
saw this going ASAP else like all his
sixth hour so embarrassing but

516
00:40:36,990 --> 00:40:43,890
educational so it it it it sort of is a
fix but it's not a fix and here's why so

517
00:40:43,890 --> 00:40:49,890
in see if you multiply to 32 bit numbers
together you get a three to be a result

518
00:40:49,890 --> 00:40:54,279
even if its assigned to a 64 bit number
so there's no way for the computer

519
00:40:54,280 --> 00:40:58,260
compiler doesn't go away you're standing
to 64 bits that must mean you want to 64

520
00:40:58,260 --> 00:41:03,790
bit result it's not just is not that's
mark so the original vulnerability

521
00:41:03,790 --> 00:41:06,940
remained exactly how was just like I
said I thought it was fixed and when I

522
00:41:06,940 --> 00:41:11,119
read the first I was like why is this
coming up I was fixed but in fact it was

523
00:41:11,119 --> 00:41:16,480
not so let's talk a little bit about
exploit ability real quick I know this

524
00:41:16,480 --> 00:41:22,740
is a bit of a hot topic so many of these
are all I don't think tend to be used it

525
00:41:22,740 --> 00:41:23,830
before there

526
00:41:23,830 --> 00:41:30,080
were I think six the result in direct in
a juror problems that lead to memory

527
00:41:30,080 --> 00:41:32,069
corruption and heat

528
00:41:32,070 --> 00:41:35,730
these kind of issues have been proven
exploitable multiple times especially in

529
00:41:35,730 --> 00:41:40,650
C++ code but a nerd medications do come
into play here and we'll get it will

530
00:41:40,650 --> 00:41:41,750
show that a little bit more

531
00:41:41,750 --> 00:41:48,130
a little bit later here so I also as I
know diversity and ecosystem you know

532
00:41:48,130 --> 00:41:51,540
because you're so many devices in
different batch levels like there are

533
00:41:51,540 --> 00:41:55,830
addresses you might need from all of
them to make an exploit that works on

534
00:41:55,830 --> 00:41:59,590
all of them but I don't think that's an
unsolvable problem I have a lot of

535
00:41:59,590 --> 00:42:04,250
firmware on my server I've got a lot of
devices I can test directly so you know

536
00:42:04,250 --> 00:42:09,750
if you build that kind of lab that's not
really a barrier I don't think at least

537
00:42:09,750 --> 00:42:15,540
that part so let's recap media server
just a little bit some other things

538
00:42:15,540 --> 00:42:19,040
helped us and some of the things hurt us
an exploitation responding from a niche

539
00:42:19,040 --> 00:42:27,420
that means when the process restarts it
rejects the process so that it gets a

540
00:42:27,420 --> 00:42:32,370
whole new address lay out its all
randomized again so even if you were to

541
00:42:32,370 --> 00:42:36,690
leak something that say for example
you're able to leak some memory contents

542
00:42:36,690 --> 00:42:42,210
to yourself if that leaking to yourself
cost to process the crash that

543
00:42:42,210 --> 00:42:48,610
information you just received a pretty
much worthless that also means the

544
00:42:48,610 --> 00:42:52,510
desire go elsewhere weaknesses was well
known because they only for don't

545
00:42:52,510 --> 00:42:56,950
exactly that that means all apps have
the same address now pretty much when

546
00:42:56,950 --> 00:43:02,859
they went airborne at least because also
also because it's spawned from an extra

547
00:43:02,860 --> 00:43:06,890
storage you can try your attack over and
over and over and over again

548
00:43:06,890 --> 00:43:10,370
the limit on that is really depending on
your text vector so whatever message you

549
00:43:10,370 --> 00:43:16,430
just go in till you know whenever with
like an sdcard download you want to

550
00:43:16,430 --> 00:43:21,060
insert and remove nasty card how much
time but you probably could do that and

551
00:43:21,060 --> 00:43:27,130
so also because of restarting a you can
use that to your advantage to buy a SLR

552
00:43:27,130 --> 00:43:31,160
through sheer brute force you can just
keep trying until it works

553
00:43:31,160 --> 00:43:35,609
one other thing is to media servers and
multi-threaded process

554
00:43:35,610 --> 00:43:39,460
and what if one of the things I found in
and writing export to exploit here was

555
00:43:39,460 --> 00:43:47,150
that because it's multiple because it's
multithreaded there's some determinism

556
00:43:47,150 --> 00:43:51,460
problems with the heat able to work
around a lot of them but not all of them

557
00:43:51,460 --> 00:43:57,160
so new Android 5.0 they had a new
medication they also had changed to

558
00:43:57,160 --> 00:44:02,720
Gmail so these two blocks of code are
functionally equivalent you can see that

559
00:44:02,720 --> 00:44:07,450
it's like new sample to junk entry you
know and so on and then that's the same

560
00:44:07,450 --> 00:44:11,870
as basically by locking the size of one
thing times the thing in the brackets

561
00:44:11,870 --> 00:44:18,029
the number of elements and so the
Android compiler team in 5.0 decided

562
00:44:18,030 --> 00:44:23,010
they were also going to release her
sorry switch to gcc 5.0 which is great

563
00:44:23,010 --> 00:44:27,150
it's always nice to upgrade your
compiler I think I got this like mortars

564
00:44:27,150 --> 00:44:36,820
and so the mitigation basically what it
does this new mitigation in Dec 5.0 is

565
00:44:36,820 --> 00:44:39,660
when this multiplication happens it
detects whether or not that

566
00:44:39,660 --> 00:44:44,009
multiplication is too big to fit a 32
bit number and if it is it changes the

567
00:44:44,010 --> 00:44:49,740
size of the allocation to the maximum
number so it tries to al-qaida like to

568
00:44:49,740 --> 00:44:54,970
do the 32 that typically does not work
out very well and so that leads to

569
00:44:54,970 --> 00:45:00,740
usually a process crash here let's look
at a mitigation somebody cuz medications

570
00:45:00,740 --> 00:45:04,020
are very important when it comes to
exploitation when you're determining

571
00:45:04,020 --> 00:45:07,250
whether vulnerability exists or not it's
not really that important but when

572
00:45:07,250 --> 00:45:10,630
you're talking about how what is the
actual risk more practical risk

573
00:45:10,630 --> 00:45:15,910
mitigation are important so in this case
and we're talking about domestic factor

574
00:45:15,910 --> 00:45:20,310
in this case it doesn't come into play
at all really unless you're already in

575
00:45:20,310 --> 00:45:26,299
so it's coming the attack is coming from
remote so there's no way to take and

576
00:45:26,300 --> 00:45:32,820
really label that just coming remotely
and it's doing what it's supposed to I

577
00:45:32,820 --> 00:45:36,000
just doing design behaviors not you
trying to cross a boundary to go not

578
00:45:36,000 --> 00:45:41,310
supposed to stack cookies are not in not
all the relevant here do not applicable

579
00:45:41,310 --> 00:45:43,509
because we're not talking about stack
corruption

580
00:45:43,510 --> 00:45:50,050
corruption fortify source again not not
not in play here because it's a

581
00:45:50,050 --> 00:45:54,160
dynamically allocated buffer and fortify
source cannot track dynamically

582
00:45:54,160 --> 00:45:59,690
allocated buffers so far is there but
it's only there from 4.0 and later

583
00:45:59,690 --> 00:46:06,210
unfortunately in what looked a little
bit more so but an ex is there has been

584
00:46:06,210 --> 00:46:10,600
there for a long time but the thing with
an axe is if you're a large week or you

585
00:46:10,600 --> 00:46:14,100
can bypass it in any way and then drop
you can just use the rock to bypass

586
00:46:14,100 --> 00:46:21,170
index it's really not a complicated jump
there so the GCC new mitigation

587
00:46:21,170 --> 00:46:26,600
it only affects some of these
vulnerabilities are basically it all it

588
00:46:26,600 --> 00:46:29,759
will only affect those who are abilities
where the number that's inside the

589
00:46:29,760 --> 00:46:33,540
brackets a simple number at some of
these vulnerabilities actually are like

590
00:46:33,540 --> 00:46:36,840
taking two numbers that you can control
adding them together and those are

591
00:46:36,840 --> 00:46:41,430
inside the brackets so they get a draw
for their what actually occur before the

592
00:46:41,430 --> 00:46:46,509
multiplication with the pipe happened
you can still trigger problem

593
00:46:46,510 --> 00:46:51,180
wrestlers address space layout
randomization it's definitely the

594
00:46:51,180 --> 00:46:54,740
biggest charity the biggest challenge is
basically the only challenge to

595
00:46:54,740 --> 00:47:06,560
exploitation so I managed staff of I
fully I fully partially by Pastor so yes

596
00:47:06,560 --> 00:47:10,799
I fully my past SLR on Ice Cream
Sandwich there was there was not an

597
00:47:10,800 --> 00:47:13,710
issue there because ice cream sandwich
there was an own weakness and

598
00:47:13,710 --> 00:47:20,630
implementation that left both binary
base and the linker mappings excusal

599
00:47:20,630 --> 00:47:26,350
mappings at a predictable address so I
think this is really also possible under

600
00:47:26,350 --> 00:47:31,230
Devices we've been talking a few of my
friends and I and courts in this

601
00:47:31,230 --> 00:47:39,070
industry here about ways we can bypass
SLR even newer devices my biggest

602
00:47:39,070 --> 00:47:45,010
guidance here would be 64 bit devices 64
bit makes a big change it's not really

603
00:47:45,010 --> 00:47:48,360
like something you say like always 64
bit as a mitigation I don't really think

604
00:47:48,360 --> 00:47:54,360
that's what it is but it definitely
makes it so far more effective

605
00:47:54,360 --> 00:48:00,500
ability by release gingerbread yeah you
can explain it there's not really a sore

606
00:48:00,500 --> 00:48:04,870
their ice cream sandwich yeah I mean I
didn't go into freudian put Froyo here

607
00:48:04,870 --> 00:48:07,660
but for you you should put in the same
bucket is ginger brothers not really

608
00:48:07,660 --> 00:48:14,589
anything going on back to an ice cream
sandwich yes proven as weak as hell are

609
00:48:14,590 --> 00:48:21,860
the new devices in theory more to be
found on that right so I think I have

610
00:48:21,860 --> 00:48:24,190
like three slides left or something

611
00:48:24,190 --> 00:48:29,560
how much time do I have two minutes
alright I think the video is like longer

612
00:48:29,560 --> 00:48:37,299
than two min I cannot find I cannot find
a way to get out of the screen is it

613
00:48:37,300 --> 00:48:49,860
like BS or what anybody know a key to
show your desktop OS X Windows ME

614
00:48:49,860 --> 00:48:58,820
I mean I think that works on Windows but
it doesn't work I know it's Mandy that's

615
00:48:58,820 --> 00:49:05,840
what I did windows and commanders saying
but what am I getting here

616
00:49:05,840 --> 00:49:11,540
thank you thank you thank you
bookmarking my own presentation came

617
00:49:11,540 --> 00:49:16,160
this just might actually wrote on his
first try escape over here

618
00:49:16,160 --> 00:49:21,859
yeah there we go right there let's do it
all right now we're gonna have the

619
00:49:21,860 --> 00:49:26,410
problem again cuz I maximize here's a
little video I would do i do I don't

620
00:49:26,410 --> 00:49:29,319
have time to set the Lydian well
although I have the equipment with me

621
00:49:29,320 --> 00:49:45,999
like this

622
00:49:45,999 --> 00:49:56,410
guys hold out

623
00:49:56,410 --> 00:50:09,950
if you guys like his music you should
come see us on Thursday Dec party thank

624
00:50:09,950 --> 00:50:14,890
you gonna do it one more time

625
00:50:14,890 --> 00:50:20,910
just because the screen is off and what
happens when the screens on right maybe

626
00:50:20,910 --> 00:50:21,990
you're looking at your phone

627
00:50:21,990 --> 00:50:27,509
WC and this is just my explode this is
not the ultimate ultimate amazing super

628
00:50:27,510 --> 00:50:39,650
dugout for like five months I don't mind
the typos users you can spot it

629
00:50:39,650 --> 00:50:56,150
there it is

630
00:50:56,150 --> 00:51:06,549
okay thank you have a system where I
just alright let's see if we can get the

631
00:51:06,549 --> 00:51:14,830
slides back now

632
00:51:14,830 --> 00:51:18,940
alright so that was the demo on Ice
Cream Sandwich she worked at first

633
00:51:18,940 --> 00:51:23,300
trying to be full disclosure will you
guys be dry but not every try the first

634
00:51:23,300 --> 00:51:28,460
try so that took a little bit of extra
time to get the first try an average is

635
00:51:28,460 --> 00:51:33,040
like the third try me and that's because
of the heat determinism stuff I

636
00:51:33,040 --> 00:51:39,600
mentioned before about getting these
issues fixed time ago super fast so I

637
00:51:39,600 --> 00:51:43,270
reported all this stuff to Google in
like backers in the middle layer burrito

638
00:51:43,270 --> 00:51:46,670
Mozilla and then like throughout April
in all the way up to June I reported

639
00:51:46,670 --> 00:51:51,550
them to black phone to bug crowd which
was all great request tomorrow everyone

640
00:51:51,550 --> 00:51:56,150
that was basically a giant shit show in
my language but it was terrible

641
00:51:56,150 --> 00:51:59,590
the Muslim guys push to patches into
their code Branch will ever say anything

642
00:51:59,590 --> 00:52:05,080
to me like black guys are great early as
you mind if we should buy her fixes I

643
00:52:05,080 --> 00:52:10,080
was like go for it should minor fixes
just don't mention anything you guys

644
00:52:10,080 --> 00:52:14,880
even like drop some patches like without
let me know what's going on and it was

645
00:52:14,880 --> 00:52:18,850
just a big mess when I reported it was
also there was another guy another team

646
00:52:18,850 --> 00:52:23,140
report is one of the most already knew
about and was going to report to Mozilla

647
00:52:23,140 --> 00:52:27,950
like two days later and so they are
about actually became a public advisory

648
00:52:27,950 --> 00:52:34,460
about stage fright lol I was like that's
great thanks a lot so I i gave every 90

649
00:52:34,460 --> 00:52:38,090
days I was like hey you know what I am
for about a month before Black a because

650
00:52:38,090 --> 00:52:42,680
that's that's good time our policy is
Imperium is 30 days we were very

651
00:52:42,680 --> 00:52:48,520
aggressive but in this case but weaker
system Android ninety days like come on

652
00:52:48,520 --> 00:52:55,140
you guys might be able to go and he did
it so that's good so everyone was great

653
00:52:55,140 --> 00:52:58,810
to work with the Android guys when I
sent to Pakistan and they were like

654
00:52:58,810 --> 00:52:59,630
thank you there

655
00:52:59,630 --> 00:53:04,150
replied thank you thank you for helping
us make it a more secure unlike does so

656
00:53:04,150 --> 00:53:09,980
nice they get all their work to notify
everyone I mentioned was also ship the

657
00:53:09,980 --> 00:53:14,460
fix is in 38 and we created the same
period have said alliance to try to help

658
00:53:14,460 --> 00:53:18,460
improve our disclosure process but also
communication between everyone and we

659
00:53:18,460 --> 00:53:22,770
recognize that people like my phone
they're not getting notified and so

660
00:53:22,770 --> 00:53:24,590
we're like you know what just notify me

661
00:53:24,590 --> 00:53:28,280
we have stuff or whenever we figure
stuff out just to make just keep me in

662
00:53:28,280 --> 00:53:33,710
the loop tried to play we have over 25
carriers manufacturers vendors involved

663
00:53:33,710 --> 00:53:37,400
in it and it's only been going on for
three days now I think or something like

664
00:53:37,400 --> 00:53:37,720
that

665
00:53:37,720 --> 00:53:42,069
three for three or four days to update
deployment is still going on you guys

666
00:53:42,070 --> 00:53:48,610
all know to media coverage in long
stories from days of old and going on

667
00:53:48,610 --> 00:53:52,980
however there's two news late breaking
things that happened this morning they

668
00:53:52,980 --> 00:53:59,040
would just lead security analysis and
that was to both Google and Samsung are

669
00:53:59,040 --> 00:54:02,930
going to a thirty-day patch like very
similar to the way microsoft does their

670
00:54:02,930 --> 00:54:12,950
past Tuesday so that is also heard some
rumors that there may actually be

671
00:54:12,950 --> 00:54:20,500
purchased for stage fright or devices
older than 4 24 depending on who's

672
00:54:20,500 --> 00:54:21,630
supporting them

673
00:54:21,630 --> 00:54:29,360
yeah yeah ok I can say anymore I don't
know I don't know anymore so what am I

674
00:54:29,360 --> 00:54:32,970
trying to start a whole time do it

675
00:54:32,970 --> 00:54:38,709
mi actually out of time or do I have
like the check in 10 minutes

676
00:54:38,710 --> 00:54:46,820
GTFO now so enraged codebase probably
needs more attention this is probably

677
00:54:46,820 --> 00:54:51,080
not the only code thats been written in
you know perhaps a hurry or they may

678
00:54:51,080 --> 00:54:54,830
have issues that are low-hanging fruit
mitigation they're definitely not a

679
00:54:54,830 --> 00:54:56,230
silver bullet

680
00:54:56,230 --> 00:55:00,490
we've seen medications to new or old
wine Thanksgiving introduced and pretty

681
00:55:00,490 --> 00:55:04,299
much every time somebody's bypassed in
some way with some bug now maybe not

682
00:55:04,300 --> 00:55:09,330
everybody but someone eventually you
only need one bug DirectX play or maybe

683
00:55:09,330 --> 00:55:17,779
two or maybe three but anyway so vendors
need to be in the day are thankfully

684
00:55:17,780 --> 00:55:22,850
some of them being more proactive maybe
not so much what they're doing more

685
00:55:22,850 --> 00:55:25,220
aggressive deploying the fixes and
that's awesome if you're going you're

686
00:55:25,220 --> 00:55:26,959
much more about the change that

687
00:55:26,960 --> 00:55:30,500
been going on and and the things that I
don't really want to take entire credit

688
00:55:30,500 --> 00:55:37,040
first during an ecosystem cause I think
that they have been kind of building and

689
00:55:37,040 --> 00:55:42,259
then in talked for a long time on some
of these things but you know hopefully

690
00:55:42,260 --> 00:55:46,310
the seriousness of these issues as kind
of lit a fire under people but if you

691
00:55:46,310 --> 00:55:52,009
will thanks for your time I don't have
any time for questions but like you guys

692
00:55:52,010 --> 00:55:55,950
are all welcome to ask me any question
any time about this or anything else

693
00:55:55,950 --> 00:56:01,419
it's all good I'm not I'm human and I
like to talk to people so hello

