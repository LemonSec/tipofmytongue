1
00:00:00,000 --> 00:00:05,819
<font color="#E5E5E5">all right everybody welcome to processes</font>

2
00:00:02,370 --> 00:00:07,200
<font color="#CCCCCC">no one hunting for token manipulation my</font>

3
00:00:05,819 --> 00:00:09,000
name is<font color="#CCCCCC"> jarred Atkinson and I'm the</font>

4
00:00:07,200 --> 00:00:11,010
adversary detection technical<font color="#E5E5E5"> lead</font><font color="#CCCCCC"> at a</font>

5
00:00:09,000 --> 00:00:13,139
<font color="#E5E5E5">cybersecurity startup called Spectre UPS</font>

6
00:00:11,010 --> 00:00:15,178
<font color="#CCCCCC">I do a lot of development in</font><font color="#E5E5E5"> my spare</font>

7
00:00:13,139 --> 00:00:16,980
time<font color="#CCCCCC"> so a couple</font><font color="#E5E5E5"> things that I'm really</font>

8
00:00:15,179 --> 00:00:19,970
<font color="#E5E5E5">interested in</font><font color="#CCCCCC"> is PowerShell so I'm a</font>

9
00:00:16,980 --> 00:00:22,109
<font color="#E5E5E5">Microsoft MVP for my work in PowerShell</font>

10
00:00:19,970 --> 00:00:23,759
<font color="#E5E5E5">digital forensics I work on a project</font>

11
00:00:22,109 --> 00:00:24,480
<font color="#CCCCCC">called power forensics which allows you</font>

12
00:00:23,760 --> 00:00:27,779
<font color="#E5E5E5">to do</font>

13
00:00:24,480 --> 00:00:29,070
NTFS parsing from within<font color="#E5E5E5"> power show and</font>

14
00:00:27,779 --> 00:00:31,859
a couple other projects that<font color="#E5E5E5"> we work</font>

15
00:00:29,070 --> 00:00:33,750
that we put<font color="#CCCCCC"> together from</font><font color="#E5E5E5"> PowerShell my</font>

16
00:00:31,859 --> 00:00:35,610
background is I got<font color="#E5E5E5"> my start in the US</font>

17
00:00:33,750 --> 00:00:36,750
Air<font color="#CCCCCC"> Force</font><font color="#E5E5E5"> on the hunt team there and</font>

18
00:00:35,610 --> 00:00:37,980
then I worked for<font color="#CCCCCC"> various groups</font>

19
00:00:36,750 --> 00:00:40,260
<font color="#E5E5E5">adaptive threat division</font><font color="#CCCCCC"> before</font>

20
00:00:37,980 --> 00:00:41,218
<font color="#CCCCCC">respector ups and</font><font color="#E5E5E5"> I'll let</font><font color="#CCCCCC"> Robbie</font>

21
00:00:40,260 --> 00:00:43,620
introduce himself

22
00:00:41,219 --> 00:00:46,800
<font color="#E5E5E5">yeah I'm Robbie Winchester I also work</font>

23
00:00:43,620 --> 00:00:48,360
at<font color="#CCCCCC"> Spectre</font><font color="#E5E5E5"> ops</font><font color="#CCCCCC"> I work with</font><font color="#E5E5E5"> Jared for</font>

24
00:00:46,800 --> 00:00:51,538
<font color="#E5E5E5">that the</font><font color="#CCCCCC"> ACE tool we presented</font><font color="#E5E5E5"> it</font>

25
00:00:48,360 --> 00:00:54,269
<font color="#E5E5E5">yesterday at Arsenal also worked on a</font>

26
00:00:51,539 --> 00:00:56,760
dr.<font color="#E5E5E5"> Ives version of ELQ</font><font color="#CCCCCC"> used to be Air</font>

27
00:00:54,270 --> 00:00:58,170
Force as well<font color="#E5E5E5"> on the red side and then</font>

28
00:00:56,760 --> 00:00:59,879
transitioned over<font color="#E5E5E5"> after I got out</font><font color="#CCCCCC"> of the</font>

29
00:00:58,170 --> 00:01:02,309
<font color="#E5E5E5">military to do more of the the hunt</font>

30
00:00:59,879 --> 00:01:04,199
<font color="#E5E5E5">approach which is going to be the focus</font>

31
00:01:02,309 --> 00:01:07,439
of this<font color="#CCCCCC"> conversation and I also used to</font>

32
00:01:04,199 --> 00:01:09,530
<font color="#E5E5E5">work at the adaptive threat</font><font color="#CCCCCC"> division so</font>

33
00:01:07,439 --> 00:01:12,119
what are we going<font color="#E5E5E5"> to talk about today</font>

34
00:01:09,530 --> 00:01:14,790
<font color="#CCCCCC">obviously the title</font><font color="#E5E5E5"> is about detecting</font>

35
00:01:12,119 --> 00:01:15,869
the access token<font color="#CCCCCC"> and manipulation</font><font color="#E5E5E5"> but</font>

36
00:01:14,790 --> 00:01:18,420
<font color="#E5E5E5">first we're</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> go into kind</font><font color="#CCCCCC"> of a</font>

37
00:01:15,869 --> 00:01:20,490
background<font color="#CCCCCC"> of what is hunt it's kind of</font>

38
00:01:18,420 --> 00:01:21,570
a<font color="#E5E5E5"> buzzword a lot of times of different</font>

39
00:01:20,490 --> 00:01:23,490
people mean<font color="#CCCCCC"> different things</font><font color="#E5E5E5"> so we're</font>

40
00:01:21,570 --> 00:01:26,039
gonna identify<font color="#CCCCCC"> first at the</font><font color="#E5E5E5"> beginning</font>

41
00:01:23,490 --> 00:01:27,600
<font color="#CCCCCC">what we consider</font><font color="#E5E5E5"> to be hunt talk about</font>

42
00:01:26,040 --> 00:01:29,250
how adversary tactics techniques and

43
00:01:27,600 --> 00:01:31,619
procedures are an important part of

44
00:01:29,250 --> 00:01:33,530
<font color="#CCCCCC">understanding what hunting</font><font color="#E5E5E5"> is and then</font>

45
00:01:31,619 --> 00:01:36,570
how we do<font color="#E5E5E5"> hypothesis driven hunting</font>

46
00:01:33,530 --> 00:01:39,090
specifically<font color="#E5E5E5"> then doing a case study for</font>

47
00:01:36,570 --> 00:01:40,949
this<font color="#E5E5E5"> of how to use this hypothesis</font>

48
00:01:39,090 --> 00:01:42,479
process to go<font color="#E5E5E5"> through and detect the</font>

49
00:01:40,950 --> 00:01:44,909
access token manipulation in<font color="#E5E5E5"> the</font>

50
00:01:42,479 --> 00:01:47,520
environment so we're gonna start<font color="#E5E5E5"> on our</font>

51
00:01:44,909 --> 00:01:50,189
<font color="#E5E5E5">quest to understand the hunting next</font>

52
00:01:47,520 --> 00:01:51,780
slide so what what<font color="#E5E5E5"> is hunting when we</font>

53
00:01:50,189 --> 00:01:54,000
say hunting we mean you're actively

54
00:01:51,780 --> 00:01:55,740
searching your environment for the

55
00:01:54,000 --> 00:01:57,390
presence<font color="#E5E5E5"> of some malicious activity that</font>

56
00:01:55,740 --> 00:02:00,360
<font color="#CCCCCC">you're current in place defenses have</font>

57
00:01:57,390 --> 00:02:01,740
not detected<font color="#E5E5E5"> the assumed breach</font>

58
00:02:00,360 --> 00:02:03,270
mentality<font color="#E5E5E5"> has kind of become more</font>

59
00:02:01,740 --> 00:02:05,520
<font color="#CCCCCC">popular at mark russinovich has talked</font>

60
00:02:03,270 --> 00:02:07,829
about<font color="#E5E5E5"> it at different</font><font color="#CCCCCC"> conferences</font><font color="#E5E5E5"> among</font>

61
00:02:05,520 --> 00:02:10,378
other<font color="#E5E5E5"> people and so the concept here</font><font color="#CCCCCC"> is</font>

62
00:02:07,829 --> 00:02:11,849
<font color="#CCCCCC">that</font><font color="#E5E5E5"> a security breach is not something</font>

63
00:02:10,378 --> 00:02:13,319
that<font color="#E5E5E5"> may happen is something that will</font>

64
00:02:11,849 --> 00:02:16,879
happen<font color="#CCCCCC"> is</font><font color="#E5E5E5"> just</font><font color="#CCCCCC"> a matter of time</font>

65
00:02:13,319 --> 00:02:19,200
if you're a significant enough target

66
00:02:16,879 --> 00:02:21,030
<font color="#CCCCCC">you're gonna be targeted</font>

67
00:02:19,200 --> 00:02:22,260
<font color="#CCCCCC">it only takes that</font><font color="#E5E5E5"> one chance for</font>

68
00:02:21,030 --> 00:02:25,650
<font color="#CCCCCC">someone to</font><font color="#E5E5E5"> gain that initial code</font>

69
00:02:22,260 --> 00:02:27,719
execution<font color="#CCCCCC"> and so for for some level of</font>

70
00:02:25,650 --> 00:02:29,310
compromise or some type of malicious

71
00:02:27,719 --> 00:02:32,010
activity to occur<font color="#CCCCCC"> in your network is a</font>

72
00:02:29,310 --> 00:02:35,060
very likely<font color="#CCCCCC"> event what we're focusing on</font>

73
00:02:32,010 --> 00:02:37,530
<font color="#E5E5E5">is that post exploitation activity where</font>

74
00:02:35,060 --> 00:02:40,349
<font color="#E5E5E5">after the code execution has occurred</font>

75
00:02:37,530 --> 00:02:41,879
how can we detect the adversary activity

76
00:02:40,349 --> 00:02:43,798
in the environment<font color="#E5E5E5"> most of the</font>

77
00:02:41,879 --> 00:02:45,870
traditional<font color="#CCCCCC"> network defense appliances</font>

78
00:02:43,799 --> 00:02:48,060
or defense appliances such as<font color="#E5E5E5"> like</font>

79
00:02:45,870 --> 00:02:49,439
firewalls<font color="#E5E5E5"> and antivirus they're really</font>

80
00:02:48,060 --> 00:02:51,480
focusing<font color="#E5E5E5"> on stopping that initial</font>

81
00:02:49,439 --> 00:02:53,700
execution and<font color="#E5E5E5"> so we want to look where</font><font color="#CCCCCC"> a</font>

82
00:02:51,480 --> 00:02:56,010
lot<font color="#E5E5E5"> of times there is not effort</font><font color="#CCCCCC"> kind</font><font color="#E5E5E5"> of</font>

83
00:02:53,700 --> 00:02:57,959
inside the<font color="#CCCCCC"> network</font><font color="#E5E5E5"> and look at focus on</font>

84
00:02:56,010 --> 00:02:58,858
that<font color="#E5E5E5"> other half and that's and that's</font>

85
00:02:57,959 --> 00:03:01,919
what we're<font color="#E5E5E5"> going to talk</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> during</font>

86
00:02:58,859 --> 00:03:04,230
<font color="#CCCCCC">this brief so what is a normal</font><font color="#E5E5E5"> Hunt</font>

87
00:03:01,919 --> 00:03:06,930
cycle look like<font color="#E5E5E5"> so kind of the generic</font>

88
00:03:04,230 --> 00:03:08,760
<font color="#E5E5E5">beginning level hunt process a lot of</font>

89
00:03:06,930 --> 00:03:10,500
<font color="#E5E5E5">times</font><font color="#CCCCCC"> that we would see is</font><font color="#E5E5E5"> kind of two</font>

90
00:03:08,760 --> 00:03:12,000
part where you gather data<font color="#E5E5E5"> and then you</font>

91
00:03:10,500 --> 00:03:14,609
hunt<font color="#E5E5E5"> for bad and you're trying to find</font>

92
00:03:12,000 --> 00:03:18,090
that apt in your environment<font color="#CCCCCC"> the problem</font>

93
00:03:14,609 --> 00:03:19,859
with this next<font color="#CCCCCC"> slide</font><font color="#E5E5E5"> is kind of two</font>

94
00:03:18,090 --> 00:03:22,500
<font color="#E5E5E5">parts so when you're gathering data it's</font>

95
00:03:19,859 --> 00:03:25,049
it's not<font color="#CCCCCC"> a normal data is</font><font color="#E5E5E5"> equal and not</font>

96
00:03:22,500 --> 00:03:26,790
all data is really<font color="#E5E5E5"> is useful so what</font>

97
00:03:25,049 --> 00:03:28,079
data<font color="#E5E5E5"> should you be collecting and why</font>

98
00:03:26,790 --> 00:03:31,260
are you collecting<font color="#E5E5E5"> that data is there a</font>

99
00:03:28,079 --> 00:03:33,599
purpose<font color="#E5E5E5"> behind gathering every event log</font>

100
00:03:31,260 --> 00:03:35,519
or every process if you're<font color="#E5E5E5"> not actually</font>

101
00:03:33,599 --> 00:03:37,319
<font color="#E5E5E5">performing any type of analytics on it</font>

102
00:03:35,519 --> 00:03:39,810
are you just bogging down and paying

103
00:03:37,319 --> 00:03:42,780
<font color="#E5E5E5">extra money</font><font color="#CCCCCC"> to a provider</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> know first</font>

104
00:03:39,810 --> 00:03:46,019
say like<font color="#CCCCCC"> Splunk</font><font color="#E5E5E5"> or loading up your your</font>

105
00:03:42,780 --> 00:03:47,639
sim<font color="#CCCCCC"> and so there's a cost there of</font>

106
00:03:46,019 --> 00:03:50,069
gathering the<font color="#E5E5E5"> data and then additionally</font>

107
00:03:47,639 --> 00:03:53,510
when you're<font color="#CCCCCC"> hunting for 'bad</font><font color="#E5E5E5"> it's really</font>

108
00:03:50,069 --> 00:03:56,220
difficult<font color="#CCCCCC"> if you sit down</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> front of</font>

109
00:03:53,510 --> 00:03:58,500
your sim and have a million or a billion

110
00:03:56,220 --> 00:04:01,169
events<font color="#E5E5E5"> and just</font><font color="#CCCCCC"> try and</font><font color="#E5E5E5"> look</font><font color="#CCCCCC"> for</font>

111
00:03:58,500 --> 00:04:02,970
something<font color="#E5E5E5"> without a direction and so a</font>

112
00:04:01,169 --> 00:04:06,810
lot of<font color="#E5E5E5"> times there's a focus that's very</font>

113
00:04:02,970 --> 00:04:08,189
vague or<font color="#E5E5E5"> very broad and</font><font color="#CCCCCC"> so you have to</font>

114
00:04:06,810 --> 00:04:09,959
baseline your activity you have<font color="#CCCCCC"> to know</font>

115
00:04:08,189 --> 00:04:12,750
what's good and this<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> just a</font>

116
00:04:09,959 --> 00:04:14,129
<font color="#E5E5E5">really a</font><font color="#CCCCCC"> nuance problem and</font><font color="#E5E5E5"> without kind</font>

117
00:04:12,750 --> 00:04:16,560
<font color="#E5E5E5">of taking a bite-size approach it can</font>

118
00:04:14,129 --> 00:04:18,570
<font color="#CCCCCC">easily become overwhelming additionally</font>

119
00:04:16,560 --> 00:04:20,339
as you have this data coming in a lot<font color="#CCCCCC"> of</font>

120
00:04:18,570 --> 00:04:22,200
times you're gonna have<font color="#E5E5E5"> more data</font>

121
00:04:20,339 --> 00:04:24,299
<font color="#E5E5E5">flowing in than you have time to look at</font>

122
00:04:22,200 --> 00:04:26,150
<font color="#CCCCCC">it so the amount of</font><font color="#E5E5E5"> data to</font><font color="#CCCCCC"> look</font><font color="#E5E5E5"> at is</font>

123
00:04:24,300 --> 00:04:27,710
growing faster than<font color="#E5E5E5"> you're able</font><font color="#CCCCCC"> to</font>

124
00:04:26,150 --> 00:04:30,229
<font color="#CCCCCC">parse through</font><font color="#E5E5E5"> it so it just kind of</font>

125
00:04:27,710 --> 00:04:33,770
becomes<font color="#CCCCCC"> a big problem so the kind of</font><font color="#E5E5E5"> the</font>

126
00:04:30,229 --> 00:04:35,479
new approach and<font color="#E5E5E5"> what we we</font><font color="#CCCCCC"> prescribed</font>

127
00:04:33,770 --> 00:04:37,190
to<font color="#E5E5E5"> you is the hypothesis driven hunting</font>

128
00:04:35,479 --> 00:04:39,169
so<font color="#E5E5E5"> and rather than just</font><font color="#CCCCCC"> gathering data</font>

129
00:04:37,190 --> 00:04:40,820
<font color="#CCCCCC">and looking</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> something that's bad the</font>

130
00:04:39,169 --> 00:04:43,520
first step is you<font color="#E5E5E5"> create this hunt</font>

131
00:04:40,820 --> 00:04:46,039
hypothesis<font color="#E5E5E5"> which is what you're</font><font color="#CCCCCC"> gonna</font>

132
00:04:43,520 --> 00:04:47,900
<font color="#E5E5E5">specifically look for in the environment</font>

133
00:04:46,039 --> 00:04:49,550
and then<font color="#E5E5E5"> you gather the data in support</font>

134
00:04:47,900 --> 00:04:51,320
<font color="#CCCCCC">of</font><font color="#E5E5E5"> that hypothesis so there's a purpose</font>

135
00:04:49,550 --> 00:04:53,150
<font color="#CCCCCC">behind it you're actually</font><font color="#E5E5E5"> you're</font>

136
00:04:51,320 --> 00:04:54,320
choosing the things that you want so

137
00:04:53,150 --> 00:04:56,179
that<font color="#E5E5E5"> you know you can use them and</font>

138
00:04:54,320 --> 00:04:58,310
they're gonna help you in that<font color="#CCCCCC"> targeted</font>

139
00:04:56,180 --> 00:05:00,110
hunting for bad activity so it's it's

140
00:04:58,310 --> 00:05:02,150
now not<font color="#CCCCCC"> just an</font><font color="#E5E5E5"> open-ended question</font>

141
00:05:00,110 --> 00:05:05,090
you're<font color="#CCCCCC"> trying</font><font color="#E5E5E5"> to solve</font><font color="#CCCCCC"> iterative</font>

142
00:05:02,150 --> 00:05:07,280
problems over time<font color="#E5E5E5"> some of the benefits</font>

143
00:05:05,090 --> 00:05:08,510
<font color="#E5E5E5">of this well first it's focused data</font>

144
00:05:07,280 --> 00:05:11,299
collection so you're<font color="#E5E5E5"> not just having</font>

145
00:05:08,510 --> 00:05:14,150
<font color="#E5E5E5">data come in and getting more and</font><font color="#CCCCCC"> more</font>

146
00:05:11,300 --> 00:05:15,740
events<font color="#E5E5E5"> more and more activity without a</font>

147
00:05:14,150 --> 00:05:18,349
<font color="#E5E5E5">purpose it's also going to give</font><font color="#CCCCCC"> you a</font>

148
00:05:15,740 --> 00:05:19,880
goal so if you have a team<font color="#CCCCCC"> you can tell</font>

149
00:05:18,349 --> 00:05:21,740
them a specific<font color="#CCCCCC"> thing</font><font color="#E5E5E5"> you're you're</font>

150
00:05:19,880 --> 00:05:23,510
<font color="#E5E5E5">looking for and that's gonna let you</font>

151
00:05:21,740 --> 00:05:26,240
have that<font color="#CCCCCC"> focus</font><font color="#E5E5E5"> and not have the</font>

152
00:05:23,510 --> 00:05:28,340
analysis paralysis of this this vague

153
00:05:26,240 --> 00:05:31,970
concept that is a little hard<font color="#E5E5E5"> to</font>

154
00:05:28,340 --> 00:05:33,770
quantify<font color="#E5E5E5"> again also if you're you're</font>

155
00:05:31,970 --> 00:05:35,990
tracking<font color="#E5E5E5"> these if you have a targeted</font>

156
00:05:33,770 --> 00:05:37,580
focus then over time<font color="#E5E5E5"> you can identify</font>

157
00:05:35,990 --> 00:05:39,169
where you've been hunting<font color="#E5E5E5"> what you've</font>

158
00:05:37,580 --> 00:05:40,340
been hunting<font color="#CCCCCC"> for and it's</font><font color="#E5E5E5"> really helpful</font>

159
00:05:39,169 --> 00:05:42,620
<font color="#CCCCCC">for trends and we're gonna talk about</font>

160
00:05:40,340 --> 00:05:45,710
<font color="#E5E5E5">this a little bit later but</font><font color="#CCCCCC"> basically</font>

161
00:05:42,620 --> 00:05:48,260
this hypothesis approach<font color="#E5E5E5"> really helps</font><font color="#CCCCCC"> to</font>

162
00:05:45,710 --> 00:05:50,870
clarify<font color="#E5E5E5"> a lot of things and and make it</font>

163
00:05:48,260 --> 00:05:52,789
<font color="#CCCCCC">a more focused effort that is actually</font>

164
00:05:50,870 --> 00:05:55,820
<font color="#E5E5E5">causing improvement rather than just</font>

165
00:05:52,789 --> 00:05:57,710
starting<font color="#CCCCCC"> to hunt which is</font><font color="#E5E5E5"> just gathering</font>

166
00:05:55,820 --> 00:06:01,280
<font color="#E5E5E5">data and and not necessarily getting a</font>

167
00:05:57,710 --> 00:06:02,919
<font color="#E5E5E5">tangible result</font><font color="#CCCCCC"> so next slide</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> awesome</font>

168
00:06:01,280 --> 00:06:04,729
hopefully everyone agrees

169
00:06:02,919 --> 00:06:06,650
<font color="#CCCCCC">hypothesis-driven hunting sounds like</font>

170
00:06:04,729 --> 00:06:08,870
the way to<font color="#E5E5E5"> go</font><font color="#CCCCCC"> how do you make a</font>

171
00:06:06,650 --> 00:06:10,969
hypothesis and<font color="#E5E5E5"> what should</font><font color="#CCCCCC"> on hypothesis</font>

172
00:06:08,870 --> 00:06:12,740
<font color="#CCCCCC">be this is kind of the problem that we</font>

173
00:06:10,970 --> 00:06:15,260
had that inspired us<font color="#CCCCCC"> to start doing</font>

174
00:06:12,740 --> 00:06:16,940
<font color="#E5E5E5">these briefings there's very vague</font>

175
00:06:15,260 --> 00:06:19,190
guidance<font color="#E5E5E5"> or people will talk about</font><font color="#CCCCCC"> a</font>

176
00:06:16,940 --> 00:06:21,080
hypothesis<font color="#CCCCCC"> driven hunt but not</font><font color="#E5E5E5"> really</font>

177
00:06:19,190 --> 00:06:23,060
<font color="#E5E5E5">what that hypothesis should be how you</font>

178
00:06:21,080 --> 00:06:25,159
should make those and it's kind of all

179
00:06:23,060 --> 00:06:28,010
<font color="#CCCCCC">over the</font><font color="#E5E5E5"> board so we really wanted</font><font color="#CCCCCC"> to</font>

180
00:06:25,159 --> 00:06:30,229
<font color="#E5E5E5">have a process internally where we could</font>

181
00:06:28,010 --> 00:06:32,419
track it<font color="#CCCCCC"> over time</font><font color="#E5E5E5"> have it be</font><font color="#CCCCCC"> iterative</font>

182
00:06:30,229 --> 00:06:34,669
and and work as consultants with clients

183
00:06:32,419 --> 00:06:39,159
<font color="#CCCCCC">to develop</font><font color="#E5E5E5"> their programs so we're gonna</font>

184
00:06:34,669 --> 00:06:41,409
walk<font color="#CCCCCC"> you through our our process</font><font color="#E5E5E5"> here</font>

185
00:06:39,159 --> 00:06:44,139
of how to kind<font color="#CCCCCC"> of do that</font><font color="#E5E5E5"> process in an</font>

186
00:06:41,409 --> 00:06:46,149
iterative<font color="#E5E5E5"> fashion</font><font color="#CCCCCC"> that's gonna really</font>

187
00:06:44,139 --> 00:06:48,189
<font color="#E5E5E5">increase</font><font color="#CCCCCC"> the sophistication ideally of</font>

188
00:06:46,149 --> 00:06:49,330
your program<font color="#CCCCCC"> but</font><font color="#E5E5E5"> before we get into</font><font color="#CCCCCC"> that</font>

189
00:06:48,189 --> 00:06:52,209
<font color="#E5E5E5">we're gonna cover a little bit</font><font color="#CCCCCC"> of</font>

190
00:06:49,330 --> 00:06:53,830
<font color="#CCCCCC">background</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> slide everyone's familiar</font>

191
00:06:52,209 --> 00:06:55,599
with<font color="#E5E5E5"> some type of hacker methodology</font>

192
00:06:53,830 --> 00:06:58,089
<font color="#CCCCCC">lifecycle</font><font color="#E5E5E5"> we're gonna reference mitre</font>

193
00:06:55,599 --> 00:06:59,969
<font color="#E5E5E5">both from the cyber tech lifecycle and</font>

194
00:06:58,089 --> 00:07:03,219
then attack matrix on the<font color="#E5E5E5"> next slide but</font>

195
00:06:59,969 --> 00:07:04,808
in general there's always some type<font color="#CCCCCC"> of</font>

196
00:07:03,219 --> 00:07:07,119
attack<font color="#CCCCCC"> paths that</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> take</font><font color="#CCCCCC"> place</font>

197
00:07:04,809 --> 00:07:10,349
<font color="#CCCCCC">from a recon all the way through kind of</font>

198
00:07:07,119 --> 00:07:12,969
a whatever<font color="#E5E5E5"> your end goal exploitation or</font>

199
00:07:10,349 --> 00:07:15,219
<font color="#CCCCCC">exfiltration of data or achieving effect</font>

200
00:07:12,969 --> 00:07:16,599
<font color="#CCCCCC">so like I said</font><font color="#E5E5E5"> at the beginning</font><font color="#CCCCCC"> we're</font>

201
00:07:15,219 --> 00:07:19,259
gonna really<font color="#E5E5E5"> focus</font><font color="#CCCCCC"> on that kind of post</font>

202
00:07:16,599 --> 00:07:23,830
exploitation<font color="#E5E5E5"> control execute</font><font color="#CCCCCC"> maintain</font>

203
00:07:19,259 --> 00:07:25,449
<font color="#CCCCCC">next slide</font><font color="#E5E5E5"> and for us the best reference</font>

204
00:07:23,830 --> 00:07:27,039
<font color="#E5E5E5">we've found is the</font><font color="#CCCCCC"> miter attack</font>

205
00:07:25,449 --> 00:07:30,039
framework if you haven't ever seen<font color="#CCCCCC"> that</font>

206
00:07:27,039 --> 00:07:32,649
<font color="#E5E5E5">mitre is a United States federal</font>

207
00:07:30,039 --> 00:07:34,779
contractor<font color="#E5E5E5"> that produces a lot</font><font color="#CCCCCC"> of open</font>

208
00:07:32,649 --> 00:07:36,849
information<font color="#E5E5E5"> the attack framework being</font>

209
00:07:34,779 --> 00:07:38,558
kind<font color="#E5E5E5"> of most popular and our personal</font>

210
00:07:36,849 --> 00:07:39,969
favorite<font color="#E5E5E5"> and so it's a huge body of</font>

211
00:07:38,559 --> 00:07:42,249
<font color="#CCCCCC">knowledge</font><font color="#E5E5E5"> that has a lot of different</font>

212
00:07:39,969 --> 00:07:44,289
attacker<font color="#E5E5E5"> attack tactics techniques and</font>

213
00:07:42,249 --> 00:07:45,819
procedures<font color="#CCCCCC"> kind of correlates to the</font>

214
00:07:44,289 --> 00:07:47,139
different<font color="#E5E5E5"> things in the attack cycle but</font>

215
00:07:45,819 --> 00:07:48,819
really has a<font color="#CCCCCC"> lot of</font><font color="#E5E5E5"> that post</font>

216
00:07:47,139 --> 00:07:51,519
exploitation focus<font color="#E5E5E5"> that we're hoping for</font>

217
00:07:48,819 --> 00:07:53,889
<font color="#CCCCCC">and it also addresses</font><font color="#E5E5E5"> both</font><font color="#CCCCCC"> Windows Mac</font>

218
00:07:51,519 --> 00:07:55,209
and<font color="#E5E5E5"> OSX so that's something really</font>

219
00:07:53,889 --> 00:07:57,519
helpful if you've<font color="#E5E5E5"> never seen it slide</font>

220
00:07:55,209 --> 00:07:59,319
<font color="#E5E5E5">this is what</font><font color="#CCCCCC"> it looks like</font><font color="#E5E5E5"> I do not</font>

221
00:07:57,519 --> 00:08:00,909
expect you<font color="#CCCCCC"> to read that</font><font color="#E5E5E5"> this is just</font><font color="#CCCCCC"> the</font>

222
00:07:59,319 --> 00:08:02,919
highlight there's a lot of stuff here

223
00:08:00,909 --> 00:08:03,938
everything on there<font color="#E5E5E5"> is a hyperlink</font><font color="#CCCCCC"> so if</font>

224
00:08:02,919 --> 00:08:07,679
you click it you're gonna get more

225
00:08:03,939 --> 00:08:11,110
<font color="#CCCCCC">information so why is this important</font>

226
00:08:07,679 --> 00:08:12,849
<font color="#E5E5E5">slide so first TTP's or tactics</font>

227
00:08:11,110 --> 00:08:15,279
techniques and procedures<font color="#E5E5E5"> as we said in</font>

228
00:08:12,849 --> 00:08:19,300
<font color="#E5E5E5">the introduction</font><font color="#CCCCCC"> we're</font><font color="#E5E5E5"> both prior</font>

229
00:08:15,279 --> 00:08:21,039
<font color="#CCCCCC">military</font><font color="#E5E5E5"> and so for us TTP's have a very</font>

230
00:08:19,300 --> 00:08:23,379
specific<font color="#E5E5E5"> meaning</font><font color="#CCCCCC"> and so</font><font color="#E5E5E5"> I'm gonna kind</font>

231
00:08:21,039 --> 00:08:24,459
<font color="#CCCCCC">of walk</font><font color="#E5E5E5"> through what what that means and</font>

232
00:08:23,379 --> 00:08:26,589
why that's important<font color="#CCCCCC"> because we often</font>

233
00:08:24,459 --> 00:08:28,869
<font color="#E5E5E5">see it misused and I'm gonna kind of use</font>

234
00:08:26,589 --> 00:08:31,209
an<font color="#E5E5E5"> analogy of taking care of your car to</font>

235
00:08:28,869 --> 00:08:34,029
highlight what this means so<font color="#E5E5E5"> the tactics</font>

236
00:08:31,209 --> 00:08:36,279
<font color="#E5E5E5">are from a United</font><font color="#CCCCCC"> States joint</font>

237
00:08:34,029 --> 00:08:37,688
publication military doctrine<font color="#E5E5E5"> the</font>

238
00:08:36,279 --> 00:08:39,490
employment and ordered arrangement of

239
00:08:37,688 --> 00:08:41,169
forces in relation to<font color="#CCCCCC"> each other</font><font color="#E5E5E5"> so what</font>

240
00:08:39,490 --> 00:08:43,240
does that<font color="#E5E5E5"> mean</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> is a real high</font><font color="#CCCCCC"> level</font>

241
00:08:41,169 --> 00:08:44,860
of general<font color="#CCCCCC"> guidance</font><font color="#E5E5E5"> so when we're</font>

242
00:08:43,240 --> 00:08:45,970
talking<font color="#E5E5E5"> about for example owning a car</font>

243
00:08:44,860 --> 00:08:47,680
there's a lot of different<font color="#E5E5E5"> things you</font>

244
00:08:45,970 --> 00:08:49,420
want<font color="#CCCCCC"> to do as part</font><font color="#E5E5E5"> of that and so</font><font color="#CCCCCC"> like a</font>

245
00:08:47,680 --> 00:08:51,099
high<font color="#E5E5E5"> level thing would be</font><font color="#CCCCCC"> preventive</font>

246
00:08:49,420 --> 00:08:52,599
maintenance<font color="#CCCCCC"> that's that's not telling</font>

247
00:08:51,100 --> 00:08:55,180
<font color="#CCCCCC">you exactly</font><font color="#E5E5E5"> what to do but</font><font color="#CCCCCC"> it's a cat</font>

248
00:08:52,600 --> 00:08:57,490
<font color="#CCCCCC">Gouri of stuff that you want to take</font>

249
00:08:55,180 --> 00:09:00,040
care<font color="#CCCCCC"> of if you want to have a full of</font>

250
00:08:57,490 --> 00:09:01,420
functioning<font color="#CCCCCC"> collar long-term so if you</font>

251
00:09:00,040 --> 00:09:02,709
go<font color="#E5E5E5"> down to</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> next level you have</font>

252
00:09:01,420 --> 00:09:04,689
techniques<font color="#E5E5E5"> and that's the</font>

253
00:09:02,709 --> 00:09:07,149
non-prescriptive ways or methods<font color="#E5E5E5"> used to</font>

254
00:09:04,690 --> 00:09:09,579
perform missions functions or tasks so

255
00:09:07,149 --> 00:09:13,149
for the car analogy if<font color="#CCCCCC"> preventive</font>

256
00:09:09,579 --> 00:09:15,008
maintenance<font color="#E5E5E5"> is the high level changing</font>

257
00:09:13,149 --> 00:09:16,990
<font color="#E5E5E5">your oil would be</font><font color="#CCCCCC"> an example</font><font color="#E5E5E5"> of a</font>

258
00:09:15,009 --> 00:09:17,920
technique so we're not saying how to do

259
00:09:16,990 --> 00:09:19,480
it or what

260
00:09:17,920 --> 00:09:21,550
how frequently any of that type of

261
00:09:19,480 --> 00:09:23,620
<font color="#E5E5E5">information it's just</font><font color="#CCCCCC"> in general for the</font>

262
00:09:21,550 --> 00:09:25,620
<font color="#CCCCCC">majority of cars</font><font color="#E5E5E5"> you would want to</font>

263
00:09:23,620 --> 00:09:28,149
change<font color="#E5E5E5"> the</font><font color="#CCCCCC"> oil</font><font color="#E5E5E5"> and so non-prescriptive</font>

264
00:09:25,620 --> 00:09:30,399
<font color="#E5E5E5">general method of making sure</font><font color="#CCCCCC"> that your</font>

265
00:09:28,149 --> 00:09:31,899
engine<font color="#CCCCCC"> your car</font><font color="#E5E5E5"> is functioning well and</font>

266
00:09:30,399 --> 00:09:34,569
<font color="#E5E5E5">then finally you get into procedures</font>

267
00:09:31,899 --> 00:09:37,389
which are<font color="#E5E5E5"> the actual standard detailed</font>

268
00:09:34,569 --> 00:09:39,219
steps of how to<font color="#CCCCCC"> do</font><font color="#E5E5E5"> something so this is</font>

269
00:09:37,389 --> 00:09:41,019
going<font color="#E5E5E5"> to be in that</font><font color="#CCCCCC"> manufacturer's for</font>

270
00:09:39,220 --> 00:09:42,730
your specific car<font color="#E5E5E5"> you know if you have a</font>

271
00:09:41,019 --> 00:09:44,980
BMW you're going to do<font color="#E5E5E5"> this if you</font><font color="#CCCCCC"> have</font>

272
00:09:42,730 --> 00:09:46,810
a<font color="#E5E5E5"> Toyota you're going to do this</font><font color="#CCCCCC"> what</font>

273
00:09:44,980 --> 00:09:49,529
types of<font color="#E5E5E5"> oil to use what types of filter</font>

274
00:09:46,810 --> 00:09:53,079
it's going to be those detailed steps<font color="#CCCCCC"> so</font>

275
00:09:49,529 --> 00:09:55,000
all<font color="#E5E5E5"> of</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> also applies to what we're</font>

276
00:09:53,079 --> 00:09:56,439
<font color="#E5E5E5">talking about here today and</font><font color="#CCCCCC"> the mitre</font>

277
00:09:55,000 --> 00:09:59,529
attack matrix is a good way<font color="#E5E5E5"> to break</font>

278
00:09:56,440 --> 00:10:01,509
that<font color="#E5E5E5"> down</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> the tactics</font><font color="#CCCCCC"> on that miter</font>

279
00:09:59,529 --> 00:10:03,040
attack matrix are those column headers

280
00:10:01,509 --> 00:10:04,899
so those are kind of those big<font color="#E5E5E5"> buckets</font>

281
00:10:03,040 --> 00:10:07,000
like persistence and credential access

282
00:10:04,899 --> 00:10:09,220
and discovery<font color="#E5E5E5"> the big buckets that are</font>

283
00:10:07,000 --> 00:10:11,769
<font color="#E5E5E5">gonna group things into those categories</font>

284
00:10:09,220 --> 00:10:14,170
<font color="#CCCCCC">it's</font><font color="#E5E5E5"> gonna be really useful for tracking</font>

285
00:10:11,769 --> 00:10:17,079
<font color="#E5E5E5">your focus over</font><font color="#CCCCCC"> time</font><font color="#E5E5E5"> areas where you</font>

286
00:10:14,170 --> 00:10:19,360
have<font color="#CCCCCC"> or do not</font><font color="#E5E5E5"> have coverage</font><font color="#CCCCCC"> those</font>

287
00:10:17,079 --> 00:10:22,060
techniques the non-prescriptive methods

288
00:10:19,360 --> 00:10:25,689
those are gonna be<font color="#E5E5E5"> all of those entries</font>

289
00:10:22,060 --> 00:10:28,000
in the actual column right now<font color="#E5E5E5"> there's</font>

290
00:10:25,689 --> 00:10:29,829
<font color="#E5E5E5">about two hundred</font><font color="#CCCCCC"> and twenty different</font>

291
00:10:28,000 --> 00:10:31,269
<font color="#E5E5E5">techniques that are represented in the</font>

292
00:10:29,829 --> 00:10:35,319
attack matrix and like I said<font color="#CCCCCC"> it's</font>

293
00:10:31,269 --> 00:10:36,130
across both Windows Linux<font color="#E5E5E5"> and</font><font color="#CCCCCC"> Mac OS</font><font color="#E5E5E5"> so</font>

294
00:10:35,319 --> 00:10:37,810
those are going<font color="#E5E5E5"> to be those those</font>

295
00:10:36,130 --> 00:10:39,430
behavioral<font color="#E5E5E5"> it's not going to tell you</font>

296
00:10:37,810 --> 00:10:41,018
how something<font color="#E5E5E5"> is being done</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> it is</font>

297
00:10:39,430 --> 00:10:43,060
<font color="#E5E5E5">going to tell you for</font><font color="#CCCCCC"> example</font><font color="#E5E5E5"> like</font>

298
00:10:41,019 --> 00:10:45,540
credential dumping is a technique that

299
00:10:43,060 --> 00:10:49,540
<font color="#E5E5E5">is</font><font color="#CCCCCC"> used as part of the</font><font color="#E5E5E5"> credential access</font>

300
00:10:45,540 --> 00:10:51,219
tactic<font color="#CCCCCC"> and</font><font color="#E5E5E5"> then finally you</font><font color="#CCCCCC"> have</font>

301
00:10:49,540 --> 00:10:52,509
procedures so now the procedures are

302
00:10:51,220 --> 00:10:55,540
<font color="#CCCCCC">going to be those detailed specific</font>

303
00:10:52,509 --> 00:10:57,220
<font color="#CCCCCC">information with relation to</font><font color="#E5E5E5"> the mitre</font>

304
00:10:55,540 --> 00:10:58,540
attack matrix<font color="#E5E5E5"> if you click on one of</font>

305
00:10:57,220 --> 00:11:00,850
<font color="#E5E5E5">those techniques it's going to pull you</font>

306
00:10:58,540 --> 00:11:02,019
pull up into<font color="#E5E5E5"> something like this and</font>

307
00:11:00,850 --> 00:11:03,910
<font color="#E5E5E5">it's</font><font color="#CCCCCC"> going to have a lot of times</font>

308
00:11:02,019 --> 00:11:04,809
examples<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> where you're gonna be</font>

309
00:11:03,910 --> 00:11:05,819
<font color="#CCCCCC">able</font><font color="#E5E5E5"> to find those like threat</font>

310
00:11:04,809 --> 00:11:07,469
<font color="#E5E5E5">intelligence</font>

311
00:11:05,820 --> 00:11:09,750
feeds<font color="#E5E5E5"> write-ups about technical</font>

312
00:11:07,470 --> 00:11:11,340
write-ups about what's going<font color="#E5E5E5"> on this</font><font color="#CCCCCC"> is</font>

313
00:11:09,750 --> 00:11:13,200
<font color="#CCCCCC">going to be the actual kind</font><font color="#E5E5E5"> of</font>

314
00:11:11,340 --> 00:11:15,060
nitty-gritty what tools were actually

315
00:11:13,200 --> 00:11:17,400
being used what were the command lines

316
00:11:15,060 --> 00:11:21,030
being run<font color="#CCCCCC"> what what were the specific</font>

317
00:11:17,400 --> 00:11:23,819
<font color="#E5E5E5">things that</font><font color="#CCCCCC"> they were</font><font color="#E5E5E5"> doing in order to</font>

318
00:11:21,030 --> 00:11:27,000
<font color="#CCCCCC">achieve the effect</font><font color="#E5E5E5"> on the environment</font><font color="#CCCCCC"> so</font>

319
00:11:23,820 --> 00:11:28,560
<font color="#CCCCCC">slightly so why is this</font><font color="#E5E5E5"> useful</font><font color="#CCCCCC"> well it's</font>

320
00:11:27,000 --> 00:11:30,240
important to understand all these

321
00:11:28,560 --> 00:11:32,609
different concepts because a lot of<font color="#E5E5E5"> the</font>

322
00:11:30,240 --> 00:11:33,960
kind of traditional<font color="#CCCCCC"> focus especially if</font>

323
00:11:32,610 --> 00:11:36,600
threat intelligence has<font color="#E5E5E5"> been more at the</font>

324
00:11:33,960 --> 00:11:38,400
procedure level<font color="#E5E5E5"> on the hashes</font><font color="#CCCCCC"> and</font>

325
00:11:36,600 --> 00:11:40,590
looking for<font color="#CCCCCC"> c2</font><font color="#E5E5E5"> IPS</font><font color="#CCCCCC"> and kind of</font><font color="#E5E5E5"> that</font>

326
00:11:38,400 --> 00:11:42,449
<font color="#E5E5E5">blacklist approach and the problem with</font>

327
00:11:40,590 --> 00:11:44,100
that<font color="#E5E5E5"> as we've experienced is those kind</font>

328
00:11:42,450 --> 00:11:45,720
of<font color="#E5E5E5"> our brittle indicators that are</font>

329
00:11:44,100 --> 00:11:48,300
<font color="#E5E5E5">fairly easy</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> an attacker</font><font color="#CCCCCC"> to change</font>

330
00:11:45,720 --> 00:11:50,040
and if that's<font color="#CCCCCC"> change then you you miss</font>

331
00:11:48,300 --> 00:11:52,920
whatever that next<font color="#E5E5E5"> iteration is and</font>

332
00:11:50,040 --> 00:11:55,110
you're<font color="#E5E5E5"> fighting a</font><font color="#CCCCCC"> losing battle so with</font>

333
00:11:52,920 --> 00:11:57,030
that in<font color="#CCCCCC"> mind we always</font><font color="#E5E5E5"> recommend</font>

334
00:11:55,110 --> 00:11:59,220
<font color="#E5E5E5">focusing on that technique and</font><font color="#CCCCCC"> that more</font>

335
00:11:57,030 --> 00:12:01,890
behavioral<font color="#CCCCCC"> level so you're you're able</font>

336
00:11:59,220 --> 00:12:03,210
to<font color="#E5E5E5"> focus on what is being done and</font><font color="#CCCCCC"> what</font>

337
00:12:01,890 --> 00:12:05,460
is the process<font color="#CCCCCC"> that they're trying</font><font color="#E5E5E5"> to</font>

338
00:12:03,210 --> 00:12:08,790
achieve<font color="#E5E5E5"> rather than how they're</font>

339
00:12:05,460 --> 00:12:10,500
specifically doing<font color="#E5E5E5"> it</font><font color="#CCCCCC"> with that</font><font color="#E5E5E5"> in mind</font>

340
00:12:08,790 --> 00:12:13,560
you can reference<font color="#E5E5E5"> the attack matrix</font>

341
00:12:10,500 --> 00:12:15,740
<font color="#E5E5E5">throughout your hypothesis process and</font>

342
00:12:13,560 --> 00:12:18,180
we're going to<font color="#E5E5E5"> be</font><font color="#CCCCCC"> doing that shortly</font>

343
00:12:15,740 --> 00:12:19,530
additionally in your<font color="#E5E5E5"> environment if you</font>

344
00:12:18,180 --> 00:12:21,359
<font color="#E5E5E5">have some type if you don't have any</font>

345
00:12:19,530 --> 00:12:23,130
type of<font color="#E5E5E5"> model that you're representing</font>

346
00:12:21,360 --> 00:12:24,360
<font color="#E5E5E5">of where you're collecting</font><font color="#CCCCCC"> data where</font>

347
00:12:23,130 --> 00:12:26,730
you<font color="#CCCCCC"> have coverage</font><font color="#E5E5E5"> and where you don't</font>

348
00:12:24,360 --> 00:12:28,110
this<font color="#E5E5E5"> is a really good example</font><font color="#CCCCCC"> of you can</font>

349
00:12:26,730 --> 00:12:30,120
map out where you currently<font color="#E5E5E5"> have</font>

350
00:12:28,110 --> 00:12:32,010
<font color="#E5E5E5">visibility with your standard</font><font color="#CCCCCC"> in place</font>

351
00:12:30,120 --> 00:12:33,780
<font color="#E5E5E5">tool set and then you can focus your</font>

352
00:12:32,010 --> 00:12:35,819
<font color="#E5E5E5">hunt efforts and your additional effort</font>

353
00:12:33,780 --> 00:12:38,640
in those<font color="#E5E5E5"> areas where</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> don't have that</font>

354
00:12:35,820 --> 00:12:40,800
<font color="#E5E5E5">current focus</font><font color="#CCCCCC"> so from a planning and</font>

355
00:12:38,640 --> 00:12:43,020
focusing of resources perspective it's

356
00:12:40,800 --> 00:12:44,280
really<font color="#CCCCCC"> helpful</font><font color="#E5E5E5"> and then additionally</font>

357
00:12:43,020 --> 00:12:46,140
that's going to<font color="#CCCCCC"> identify those areas</font>

358
00:12:44,280 --> 00:12:50,280
<font color="#E5E5E5">where you don't currently have coverage</font>

359
00:12:46,140 --> 00:12:51,569
if say<font color="#CCCCCC"> for example you you realize in</font>

360
00:12:50,280 --> 00:12:53,490
mapping things you<font color="#E5E5E5"> don't have anything</font>

361
00:12:51,570 --> 00:12:55,560
<font color="#E5E5E5">that's actually looking for the abuse</font><font color="#CCCCCC"> of</font>

362
00:12:53,490 --> 00:12:57,060
credential access that's then<font color="#CCCCCC"> maybe an</font>

363
00:12:55,560 --> 00:12:59,040
area<font color="#E5E5E5"> where you'd want</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> focus either a</font>

364
00:12:57,060 --> 00:13:01,949
technology<font color="#CCCCCC"> solution or a</font><font color="#E5E5E5"> personnel</font>

365
00:12:59,040 --> 00:13:05,400
effort to get coverage in<font color="#E5E5E5"> that area so</font>

366
00:13:01,950 --> 00:13:07,620
we've covered the background now<font color="#E5E5E5"> we're</font>

367
00:13:05,400 --> 00:13:09,300
gonna go<font color="#CCCCCC"> on to the</font><font color="#E5E5E5"> fun part</font><font color="#CCCCCC"> get</font><font color="#E5E5E5"> into how</font>

368
00:13:07,620 --> 00:13:11,640
do we<font color="#CCCCCC"> actually what is this process</font><font color="#E5E5E5"> how</font>

369
00:13:09,300 --> 00:13:14,490
are we building the hunt hypothesis in

370
00:13:11,640 --> 00:13:17,970
order to<font color="#E5E5E5"> investigate that so we have a</font>

371
00:13:14,490 --> 00:13:19,649
five steps<font color="#E5E5E5"> five step process</font><font color="#CCCCCC"> we're</font><font color="#E5E5E5"> gonna</font>

372
00:13:17,970 --> 00:13:21,329
walk<font color="#CCCCCC"> through the intention here</font><font color="#E5E5E5"> is</font>

373
00:13:19,649 --> 00:13:24,269
that you you make a very<font color="#E5E5E5"> focused</font>

374
00:13:21,329 --> 00:13:26,670
actionable<font color="#E5E5E5"> hunt hypothesis that you can</font>

375
00:13:24,269 --> 00:13:28,350
investigate<font color="#E5E5E5"> for specific behavior</font>

376
00:13:26,670 --> 00:13:30,959
specific attacker activity in your

377
00:13:28,350 --> 00:13:32,309
<font color="#CCCCCC">environment</font><font color="#E5E5E5"> and we intend that this is</font>

378
00:13:30,959 --> 00:13:34,349
something<font color="#CCCCCC"> that you would be</font><font color="#E5E5E5"> creating</font>

379
00:13:32,309 --> 00:13:37,679
these hypotheses<font color="#CCCCCC"> that would be executed</font>

380
00:13:34,350 --> 00:13:39,839
<font color="#CCCCCC">over a one-week period of time that's</font>

381
00:13:37,679 --> 00:13:43,709
<font color="#CCCCCC">just gonna allow for you to</font><font color="#E5E5E5"> iteratively</font>

382
00:13:39,839 --> 00:13:45,209
<font color="#E5E5E5">be solving these small problems and and</font>

383
00:13:43,709 --> 00:13:47,609
<font color="#CCCCCC">actually</font><font color="#E5E5E5"> having an effect in your</font>

384
00:13:45,209 --> 00:13:49,378
<font color="#CCCCCC">environment</font><font color="#E5E5E5"> a lot of times we have</font>

385
00:13:47,610 --> 00:13:52,230
experience where you'll start<font color="#E5E5E5"> down a</font>

386
00:13:49,379 --> 00:13:54,119
path<font color="#E5E5E5"> and either</font><font color="#CCCCCC"> get too far</font><font color="#E5E5E5"> down a</font>

387
00:13:52,230 --> 00:13:56,249
rabbit hole<font color="#CCCCCC"> of research before</font><font color="#E5E5E5"> trying to</font>

388
00:13:54,119 --> 00:13:59,249
<font color="#E5E5E5">solve a problem</font><font color="#CCCCCC"> and then you are not</font>

389
00:13:56,249 --> 00:14:00,749
<font color="#CCCCCC">actually taking it to completion</font><font color="#E5E5E5"> or it</font>

390
00:13:59,249 --> 00:14:03,029
becomes<font color="#E5E5E5"> an overwhelming problem of</font>

391
00:14:00,749 --> 00:14:04,949
<font color="#E5E5E5">breath and so you're worried about every</font>

392
00:14:03,029 --> 00:14:06,869
<font color="#E5E5E5">aspect of a certain attack and so</font>

393
00:14:04,949 --> 00:14:08,219
nothing<font color="#CCCCCC"> gets accomplished and so we're</font>

394
00:14:06,869 --> 00:14:10,860
trying<font color="#E5E5E5"> to combat that</font><font color="#CCCCCC"> by</font><font color="#E5E5E5"> really focusing</font>

395
00:14:08,220 --> 00:14:12,569
<font color="#CCCCCC">things down and having a set of</font><font color="#E5E5E5"> steps</font>

396
00:14:10,860 --> 00:14:16,649
where you can walk<font color="#CCCCCC"> through and get a</font>

397
00:14:12,569 --> 00:14:18,479
tangible<font color="#E5E5E5"> result so the first part is</font>

398
00:14:16,649 --> 00:14:19,949
identifying the tactic in technique<font color="#E5E5E5"> so</font>

399
00:14:18,480 --> 00:14:21,779
back to the<font color="#CCCCCC"> miter attack matrix the</font>

400
00:14:19,949 --> 00:14:23,998
tactics<font color="#E5E5E5"> are those those broad column</font>

401
00:14:21,779 --> 00:14:27,420
headers<font color="#E5E5E5"> so this is that high-level</font><font color="#CCCCCC"> what</font>

402
00:14:23,999 --> 00:14:29,040
you're gonna look for<font color="#E5E5E5"> the initiating</font>

403
00:14:27,420 --> 00:14:31,559
<font color="#CCCCCC">event kind</font><font color="#E5E5E5"> of the instigation for this</font>

404
00:14:29,040 --> 00:14:34,230
can come<font color="#E5E5E5"> from any any source really it</font>

405
00:14:31,559 --> 00:14:37,230
may be<font color="#E5E5E5"> your CEO is worried about some</font>

406
00:14:34,230 --> 00:14:39,689
type of<font color="#E5E5E5"> attack</font><font color="#CCCCCC"> you are reading threat</font>

407
00:14:37,230 --> 00:14:41,670
intelligence about other other industry

408
00:14:39,689 --> 00:14:43,529
vertical type threats that<font color="#CCCCCC"> are occurring</font>

409
00:14:41,670 --> 00:14:45,120
<font color="#CCCCCC">and you're worried about</font><font color="#E5E5E5"> something</font>

410
00:14:43,529 --> 00:14:46,350
occurring<font color="#E5E5E5"> if you know after say want to</font>

411
00:14:45,120 --> 00:14:48,720
cry you're worried about ransomware

412
00:14:46,350 --> 00:14:51,569
<font color="#E5E5E5">those types of things can drive this but</font>

413
00:14:48,720 --> 00:14:55,230
the focus here<font color="#CCCCCC"> is take that initial idea</font>

414
00:14:51,569 --> 00:14:57,540
and and refine<font color="#CCCCCC"> it down</font><font color="#E5E5E5"> to for this hunt</font>

415
00:14:55,230 --> 00:14:59,100
hypothesis<font color="#CCCCCC"> what is the tactic we want to</font>

416
00:14:57,540 --> 00:15:03,149
look at and then what is the technique

417
00:14:59,100 --> 00:15:05,490
beneath that there's<font color="#E5E5E5"> rarely if ever</font>

418
00:15:03,149 --> 00:15:07,350
<font color="#E5E5E5">gonna only</font><font color="#CCCCCC"> be a single technique</font>

419
00:15:05,490 --> 00:15:10,170
involved in<font color="#E5E5E5"> attack chain inherently</font>

420
00:15:07,350 --> 00:15:11,790
<font color="#E5E5E5">these attacks are are chained together</font>

421
00:15:10,170 --> 00:15:13,649
and it's a series of<font color="#E5E5E5"> different things</font>

422
00:15:11,790 --> 00:15:16,290
occurring<font color="#E5E5E5"> and so we're trying</font><font color="#CCCCCC"> to take</font>

423
00:15:13,649 --> 00:15:18,420
advantage<font color="#CCCCCC"> of that</font><font color="#E5E5E5"> where we don't need to</font>

424
00:15:16,290 --> 00:15:19,949
find<font color="#E5E5E5"> every evidence of activity we just</font>

425
00:15:18,420 --> 00:15:21,540
need to find something<font color="#E5E5E5"> and if we find</font>

426
00:15:19,949 --> 00:15:23,699
<font color="#CCCCCC">something</font><font color="#E5E5E5"> then that</font><font color="#CCCCCC"> can</font><font color="#E5E5E5"> potentially</font>

427
00:15:21,540 --> 00:15:25,829
unravel the whole chain it's it's

428
00:15:23,699 --> 00:15:27,389
changing<font color="#CCCCCC"> that dynamic to</font><font color="#E5E5E5"> instead of the</font>

429
00:15:25,829 --> 00:15:28,979
the<font color="#E5E5E5"> defenders dilemma of always having</font>

430
00:15:27,389 --> 00:15:30,600
to be<font color="#E5E5E5"> right you can switch it to the</font>

431
00:15:28,980 --> 00:15:32,610
attacker dilemma<font color="#E5E5E5"> to where they have to</font>

432
00:15:30,600 --> 00:15:34,110
be<font color="#E5E5E5"> evading all of these really good in</font>

433
00:15:32,610 --> 00:15:36,120
place<font color="#E5E5E5"> defenses</font>

434
00:15:34,110 --> 00:15:37,470
so this point yeah you have a tactic and

435
00:15:36,120 --> 00:15:39,480
technique<font color="#E5E5E5"> and you're gonna be focused on</font>

436
00:15:37,470 --> 00:15:42,089
one specific<font color="#CCCCCC"> thing</font><font color="#E5E5E5"> you're looking</font><font color="#CCCCCC"> for</font>

437
00:15:39,480 --> 00:15:43,709
however for that technique like it's a

438
00:15:42,089 --> 00:15:45,779
<font color="#E5E5E5">non prescriptive Broadway so there's</font>

439
00:15:43,709 --> 00:15:47,910
gonna be<font color="#E5E5E5"> some some nuances and some</font>

440
00:15:45,779 --> 00:15:50,160
tools and specific<font color="#E5E5E5"> things so phase two</font>

441
00:15:47,910 --> 00:15:51,899
is identifying the procedures so these

442
00:15:50,160 --> 00:15:53,459
are that you're<font color="#E5E5E5"> going to use those</font>

443
00:15:51,899 --> 00:15:55,019
threat reports and look at tech

444
00:15:53,459 --> 00:15:56,969
write-ups<font color="#E5E5E5"> and you want to understand</font>

445
00:15:55,019 --> 00:15:59,970
what are<font color="#CCCCCC"> the tools that are</font><font color="#E5E5E5"> being used</font>

446
00:15:56,970 --> 00:16:02,040
<font color="#CCCCCC">how are those tools</font><font color="#E5E5E5"> being</font><font color="#CCCCCC"> used and not</font>

447
00:15:59,970 --> 00:16:03,690
<font color="#CCCCCC">just what are they</font><font color="#E5E5E5"> but from a behavioral</font>

448
00:16:02,040 --> 00:16:07,079
<font color="#E5E5E5">perspective what is the what is the</font>

449
00:16:03,690 --> 00:16:08,699
objective<font color="#CCCCCC"> so for</font><font color="#E5E5E5"> example it would</font><font color="#CCCCCC"> be</font>

450
00:16:07,079 --> 00:16:10,380
<font color="#E5E5E5">worth</font><font color="#CCCCCC"> understanding like Mimi Katz is</font>

451
00:16:08,699 --> 00:16:12,180
being used to<font color="#CCCCCC"> dump credentials but</font><font color="#E5E5E5"> you</font>

452
00:16:10,380 --> 00:16:13,649
need to understand more than just<font color="#E5E5E5"> their</font>

453
00:16:12,180 --> 00:16:17,099
running Mimi<font color="#CCCCCC"> Katz you should understand</font>

454
00:16:13,649 --> 00:16:19,259
how<font color="#E5E5E5"> they're leveraging the back end in</font>

455
00:16:17,100 --> 00:16:21,420
internals<font color="#E5E5E5"> of</font><font color="#CCCCCC"> Windows to do that because</font>

456
00:16:19,259 --> 00:16:24,209
<font color="#E5E5E5">you can recompile or write your own</font>

457
00:16:21,420 --> 00:16:26,639
version<font color="#CCCCCC"> so it's understanding what</font><font color="#E5E5E5"> can</font>

458
00:16:24,209 --> 00:16:28,529
<font color="#E5E5E5">and can't be easily changed across all</font>

459
00:16:26,639 --> 00:16:30,449
of that are there are there similar

460
00:16:28,529 --> 00:16:31,949
behavior similar patterns and<font color="#E5E5E5"> this is</font>

461
00:16:30,449 --> 00:16:34,258
gonna<font color="#E5E5E5"> require research to go through and</font>

462
00:16:31,949 --> 00:16:35,880
understand a lot of<font color="#E5E5E5"> times this is the</font>

463
00:16:34,259 --> 00:16:37,620
the benefit of<font color="#CCCCCC"> the biggest benefit is at</font>

464
00:16:35,880 --> 00:16:40,139
the end of this<font color="#E5E5E5"> you'll have had to spend</font>

465
00:16:37,620 --> 00:16:41,610
that time<font color="#CCCCCC"> and research to identify</font><font color="#E5E5E5"> how</font>

466
00:16:40,139 --> 00:16:43,889
this all works<font color="#CCCCCC"> and you're gonna walk</font>

467
00:16:41,610 --> 00:16:45,600
away with<font color="#E5E5E5"> a really good understanding so</font>

468
00:16:43,889 --> 00:16:46,889
once we have the taxes techniques and

469
00:16:45,600 --> 00:16:49,199
then the procedures<font color="#CCCCCC"> that are</font><font color="#E5E5E5"> used</font><font color="#CCCCCC"> the</font>

470
00:16:46,889 --> 00:16:51,149
<font color="#CCCCCC">next phase is really the bulk</font><font color="#E5E5E5"> of the</font>

471
00:16:49,199 --> 00:16:52,709
effort<font color="#CCCCCC"> and this</font><font color="#E5E5E5"> is where you're</font><font color="#CCCCCC"> gonna</font>

472
00:16:51,149 --> 00:16:55,130
want to<font color="#E5E5E5"> take those tools take that</font>

473
00:16:52,709 --> 00:16:57,508
actual technical<font color="#E5E5E5"> intelligence and</font>

474
00:16:55,130 --> 00:16:59,939
research<font color="#E5E5E5"> it</font><font color="#CCCCCC"> yourself ideally in your own</font>

475
00:16:57,509 --> 00:17:02,209
environment so deploy the malware deploy

476
00:16:59,939 --> 00:17:04,829
the behavior emulate that behavior and

477
00:17:02,209 --> 00:17:07,168
identify<font color="#E5E5E5"> for</font><font color="#CCCCCC"> yourself what those</font>

478
00:17:04,829 --> 00:17:08,668
indicators are<font color="#E5E5E5"> from a behavioral</font>

479
00:17:07,169 --> 00:17:10,530
<font color="#E5E5E5">perspective so we're all again we're not</font>

480
00:17:08,669 --> 00:17:13,530
<font color="#CCCCCC">looking for hashes we're looking for</font><font color="#E5E5E5"> for</font>

481
00:17:10,530 --> 00:17:15,030
things that we<font color="#E5E5E5"> can find that are going</font>

482
00:17:13,530 --> 00:17:17,849
<font color="#E5E5E5">to be difficult to change in</font><font color="#CCCCCC"> order to be</font>

483
00:17:15,030 --> 00:17:18,959
<font color="#CCCCCC">more consistent</font><font color="#E5E5E5"> with the actual process</font>

484
00:17:17,849 --> 00:17:21,178
additionally<font color="#E5E5E5"> where this is really</font>

485
00:17:18,959 --> 00:17:22,650
<font color="#E5E5E5">helpful is you can baseline and set this</font>

486
00:17:21,179 --> 00:17:25,760
for your environment<font color="#CCCCCC"> so we always</font>

487
00:17:22,650 --> 00:17:27,959
<font color="#E5E5E5">recommend using like a gold image type</font>

488
00:17:25,760 --> 00:17:29,129
system<font color="#CCCCCC"> because</font><font color="#E5E5E5"> that's going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> help you</font>

489
00:17:27,959 --> 00:17:30,750
know<font color="#E5E5E5"> what is going to potentially be</font>

490
00:17:29,130 --> 00:17:32,429
<font color="#CCCCCC">high false positives</font><font color="#E5E5E5"> in your</font><font color="#CCCCCC"> environment</font>

491
00:17:30,750 --> 00:17:34,860
<font color="#CCCCCC">and</font><font color="#E5E5E5"> then at the end of this you should</font>

492
00:17:32,429 --> 00:17:36,659
<font color="#CCCCCC">have a POC basically of hey this is the</font>

493
00:17:34,860 --> 00:17:38,969
data that<font color="#E5E5E5"> we</font><font color="#CCCCCC"> need</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> collect in order to</font>

494
00:17:36,659 --> 00:17:40,919
detect<font color="#E5E5E5"> these types of behaviors</font><font color="#CCCCCC"> that we</font>

495
00:17:38,970 --> 00:17:42,179
can then go take to the enterprise<font color="#E5E5E5"> so</font>

496
00:17:40,919 --> 00:17:44,700
you have a very<font color="#E5E5E5"> focused collection</font>

497
00:17:42,179 --> 00:17:47,140
effort<font color="#E5E5E5"> next slide the next</font><font color="#CCCCCC"> step is</font>

498
00:17:44,700 --> 00:17:48,880
identifying the scope<font color="#E5E5E5"> so there's two</font>

499
00:17:47,140 --> 00:17:50,710
<font color="#CCCCCC">Factor's</font><font color="#E5E5E5"> time and the number of data</font>

500
00:17:48,880 --> 00:17:52,950
<font color="#E5E5E5">sources because this may be you know</font>

501
00:17:50,710 --> 00:17:55,720
<font color="#CCCCCC">network subnets</font><font color="#E5E5E5"> rather than just</font>

502
00:17:52,950 --> 00:17:58,000
endpoint hosts<font color="#E5E5E5"> and so we recommend a</font>

503
00:17:55,720 --> 00:17:59,440
week for the time just because<font color="#E5E5E5"> it really</font>

504
00:17:58,000 --> 00:18:01,180
<font color="#CCCCCC">puts a good constraint and the</font>

505
00:17:59,440 --> 00:18:03,310
perspective of we want<font color="#E5E5E5"> to focus our</font>

506
00:18:01,180 --> 00:18:04,480
effort<font color="#E5E5E5"> and the number of data sources</font>

507
00:18:03,310 --> 00:18:06,399
<font color="#CCCCCC">that you can collect is going to be</font>

508
00:18:04,480 --> 00:18:08,020
really dependent upon the your

509
00:18:06,400 --> 00:18:10,060
environment<font color="#E5E5E5"> what the data collection</font>

510
00:18:08,020 --> 00:18:13,300
<font color="#E5E5E5">process and analysis entails and what</font>

511
00:18:10,060 --> 00:18:14,980
<font color="#CCCCCC">your your permissions are</font><font color="#E5E5E5"> and there you</font>

512
00:18:13,300 --> 00:18:17,020
may find that<font color="#E5E5E5"> your scope may be limited</font>

513
00:18:14,980 --> 00:18:20,160
due to<font color="#E5E5E5"> the collection capability you may</font>

514
00:18:17,020 --> 00:18:22,930
have<font color="#CCCCCC"> problems with</font><font color="#E5E5E5"> credentials and so</font>

515
00:18:20,160 --> 00:18:24,490
this is<font color="#CCCCCC"> really leading into</font><font color="#E5E5E5"> kind of the</font>

516
00:18:22,930 --> 00:18:27,700
last point<font color="#E5E5E5"> which is the most important</font>

517
00:18:24,490 --> 00:18:29,770
is documenting everything<font color="#E5E5E5"> up until that</font>

518
00:18:27,700 --> 00:18:31,720
point that you've excluded<font color="#CCCCCC"> so this is</font>

519
00:18:29,770 --> 00:18:33,910
what's gonna<font color="#CCCCCC"> really make</font><font color="#E5E5E5"> this be a cycle</font>

520
00:18:31,720 --> 00:18:35,380
<font color="#E5E5E5">rather than a one-off</font><font color="#CCCCCC"> event what things</font>

521
00:18:33,910 --> 00:18:37,060
are<font color="#CCCCCC"> you not able to do</font><font color="#E5E5E5"> so if you're</font>

522
00:18:35,380 --> 00:18:38,800
<font color="#CCCCCC">looking at an apt report and you're</font>

523
00:18:37,060 --> 00:18:40,389
focusing<font color="#E5E5E5"> on one technique what are the</font>

524
00:18:38,800 --> 00:18:42,430
other techniques<font color="#CCCCCC"> that were included that</font>

525
00:18:40,390 --> 00:18:44,260
you you put to the side

526
00:18:42,430 --> 00:18:47,140
those aren't<font color="#CCCCCC"> forgotten forever those are</font>

527
00:18:44,260 --> 00:18:49,990
<font color="#E5E5E5">just fodder for</font><font color="#CCCCCC"> a next hypothesis and so</font>

528
00:18:47,140 --> 00:18:51,310
you can use this to<font color="#CCCCCC"> identify if you have</font>

529
00:18:49,990 --> 00:18:53,050
technical<font color="#E5E5E5"> limitations</font><font color="#CCCCCC"> that you're</font>

530
00:18:51,310 --> 00:18:54,580
<font color="#CCCCCC">identifying over this process</font><font color="#E5E5E5"> for</font>

531
00:18:53,050 --> 00:18:56,470
collection<font color="#E5E5E5"> that's gonna be really</font><font color="#CCCCCC"> good</font>

532
00:18:54,580 --> 00:18:58,149
to inform<font color="#E5E5E5"> those technology</font><font color="#CCCCCC"> purchases so</font>

533
00:18:56,470 --> 00:19:00,400
when a vendor comes and says you should

534
00:18:58,150 --> 00:19:01,930
buy our<font color="#E5E5E5"> tool you can identify the areas</font>

535
00:19:00,400 --> 00:19:04,060
<font color="#E5E5E5">where you need coverage and and they can</font>

536
00:19:01,930 --> 00:19:06,070
<font color="#CCCCCC">identify then okay</font><font color="#E5E5E5"> you're covering</font>

537
00:19:04,060 --> 00:19:07,919
<font color="#E5E5E5">things that I already have or this is</font>

538
00:19:06,070 --> 00:19:10,840
really<font color="#E5E5E5"> meeting a requirement that</font><font color="#CCCCCC"> I need</font>

539
00:19:07,920 --> 00:19:12,160
<font color="#CCCCCC">and it also can help for if if you're</font>

540
00:19:10,840 --> 00:19:13,870
<font color="#CCCCCC">constantly having</font><font color="#E5E5E5"> things excluded from</font>

541
00:19:12,160 --> 00:19:16,420
the scope<font color="#CCCCCC"> for like</font><font color="#E5E5E5"> production systems</font>

542
00:19:13,870 --> 00:19:18,159
<font color="#E5E5E5">this can help quantify</font><font color="#CCCCCC"> overtime you</font><font color="#E5E5E5"> have</font>

543
00:19:16,420 --> 00:19:20,140
not been able<font color="#E5E5E5"> to look at these all these</font>

544
00:19:18,160 --> 00:19:21,640
types of<font color="#E5E5E5"> things on those production</font>

545
00:19:20,140 --> 00:19:24,460
systems so it can kind<font color="#CCCCCC"> of help for</font>

546
00:19:21,640 --> 00:19:28,360
<font color="#CCCCCC">leadership</font><font color="#E5E5E5"> to understand what the scope</font>

547
00:19:24,460 --> 00:19:29,560
limitations may be impacting so at the

548
00:19:28,360 --> 00:19:31,360
end of this what do we have well you

549
00:19:29,560 --> 00:19:33,970
<font color="#E5E5E5">should have a specific behavior</font><font color="#CCCCCC"> that you</font>

550
00:19:31,360 --> 00:19:35,350
understand<font color="#E5E5E5"> that you're you you know what</font>

551
00:19:33,970 --> 00:19:36,610
the technique is you have a better

552
00:19:35,350 --> 00:19:38,409
<font color="#E5E5E5">understanding</font><font color="#CCCCCC"> because you spent the time</font>

553
00:19:36,610 --> 00:19:40,240
digging<font color="#E5E5E5"> into this one aspect of it and</font>

554
00:19:38,410 --> 00:19:42,220
then the knowledge<font color="#E5E5E5"> of what data you need</font>

555
00:19:40,240 --> 00:19:44,500
to<font color="#E5E5E5"> collect specifically to detect that</font>

556
00:19:42,220 --> 00:19:46,060
activity<font color="#E5E5E5"> and that's</font><font color="#CCCCCC"> really where you</font>

557
00:19:44,500 --> 00:19:48,850
would<font color="#CCCCCC"> then transition over and perform</font>

558
00:19:46,060 --> 00:19:51,220
that<font color="#E5E5E5"> hunt app you've done this</font><font color="#CCCCCC"> next</font>

559
00:19:48,850 --> 00:19:53,020
slide<font color="#E5E5E5"> so what's the benefit</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> this like</font>

560
00:19:51,220 --> 00:19:55,360
I said<font color="#CCCCCC"> at the beginning</font><font color="#E5E5E5"> it really</font>

561
00:19:53,020 --> 00:19:57,430
<font color="#E5E5E5">focuses and at the end you would have a</font>

562
00:19:55,360 --> 00:19:59,399
<font color="#E5E5E5">specific targeted tactic technique and</font>

563
00:19:57,430 --> 00:20:01,200
per set of procedures and

564
00:19:59,399 --> 00:20:04,649
you will be able<font color="#E5E5E5"> to</font><font color="#CCCCCC"> at the end say yes</font>

565
00:20:01,200 --> 00:20:06,509
this<font color="#E5E5E5"> is this was found or was not found</font>

566
00:20:04,649 --> 00:20:08,580
in my environment<font color="#CCCCCC"> you can transfer those</font>

567
00:20:06,509 --> 00:20:10,679
high confidence low false positive

568
00:20:08,580 --> 00:20:12,509
<font color="#E5E5E5">alerts over to your sock and then use</font>

569
00:20:10,679 --> 00:20:14,549
this to<font color="#CCCCCC"> kind</font><font color="#E5E5E5"> of iteratively bring your</font>

570
00:20:12,509 --> 00:20:17,639
entire<font color="#E5E5E5"> detection</font><font color="#CCCCCC"> baseline</font><font color="#E5E5E5"> forward and</font>

571
00:20:14,549 --> 00:20:20,609
the biggest thing that we like is if you

572
00:20:17,639 --> 00:20:22,468
have a you<font color="#CCCCCC"> have this all</font><font color="#E5E5E5"> documented out</font>

573
00:20:20,609 --> 00:20:24,449
and a new attack report comes out<font color="#E5E5E5"> a new</font>

574
00:20:22,469 --> 00:20:26,429
apt if you go and<font color="#E5E5E5"> you match this up</font>

575
00:20:24,450 --> 00:20:28,469
<font color="#E5E5E5">against we're currently looking</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> this</font>

576
00:20:26,429 --> 00:20:30,029
set<font color="#CCCCCC"> of techniques if you can map the</font>

577
00:20:28,469 --> 00:20:31,529
techniques and<font color="#CCCCCC"> these new reports that</font>

578
00:20:30,029 --> 00:20:32,940
<font color="#E5E5E5">come out you're gonna already know areas</font>

579
00:20:31,529 --> 00:20:34,409
where you're either vulnerable<font color="#E5E5E5"> to</font>

580
00:20:32,940 --> 00:20:38,700
missing detection<font color="#CCCCCC"> Zoar where you can</font>

581
00:20:34,409 --> 00:20:40,710
<font color="#E5E5E5">potentially find them</font><font color="#CCCCCC"> slide so with</font><font color="#E5E5E5"> that</font>

582
00:20:38,700 --> 00:20:42,629
that's<font color="#E5E5E5"> the background process</font><font color="#CCCCCC"> Jarrod's</font>

583
00:20:40,710 --> 00:20:44,339
now<font color="#E5E5E5"> going to walk through an actual</font>

584
00:20:42,629 --> 00:20:46,439
<font color="#CCCCCC">implementation</font><font color="#E5E5E5"> of this for detecting</font>

585
00:20:44,339 --> 00:20:49,229
access token manipulation cool<font color="#E5E5E5"> Thank You</font>

586
00:20:46,440 --> 00:20:50,489
Robbie<font color="#CCCCCC"> so we're going</font><font color="#E5E5E5"> to for the case</font>

587
00:20:49,229 --> 00:20:52,979
study we're going to use a notional

588
00:20:50,489 --> 00:20:54,539
company which the situation<font color="#CCCCCC"> that they're</font>

589
00:20:52,979 --> 00:20:57,269
<font color="#E5E5E5">going</font><font color="#CCCCCC"> to be</font><font color="#E5E5E5"> kind of operating under is a</font>

590
00:20:54,539 --> 00:20:58,408
conglomeration of all the different<font color="#E5E5E5"> some</font>

591
00:20:57,269 --> 00:21:01,200
of<font color="#CCCCCC"> the</font><font color="#E5E5E5"> shortcomings that we've seen in</font>

592
00:20:58,409 --> 00:21:03,299
security programs and so<font color="#E5E5E5"> the general</font>

593
00:21:01,200 --> 00:21:06,299
idea to kick off this hypothesis is that

594
00:21:03,299 --> 00:21:07,649
<font color="#E5E5E5">our</font><font color="#CCCCCC"> CISO went to</font><font color="#E5E5E5"> DEFCON</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> black had a</font>

595
00:21:06,299 --> 00:21:10,769
couple<font color="#E5E5E5"> years</font><font color="#CCCCCC"> ago and</font><font color="#E5E5E5"> saw a presentation</font>

596
00:21:07,649 --> 00:21:12,599
<font color="#CCCCCC">about PowerShell</font><font color="#E5E5E5"> Empire right and so he</font>

597
00:21:10,769 --> 00:21:14,700
saw<font color="#E5E5E5"> PowerShell Empire he came back and</font>

598
00:21:12,599 --> 00:21:17,460
he<font color="#CCCCCC"> said hey guys</font><font color="#E5E5E5"> can we detect</font>

599
00:21:14,700 --> 00:21:18,989
PowerShell Empire right and so when he

600
00:21:17,460 --> 00:21:21,149
asked that<font color="#E5E5E5"> question he's really kind of</font>

601
00:21:18,989 --> 00:21:22,710
asking three things<font color="#E5E5E5"> right so it's</font>

602
00:21:21,149 --> 00:21:24,478
there's a couple implicit questions one

603
00:21:22,710 --> 00:21:26,820
is<font color="#E5E5E5"> can we detect PowerShell Empire</font>

604
00:21:24,479 --> 00:21:29,309
whatever that means<font color="#CCCCCC"> can we</font><font color="#E5E5E5"> stop it</font><font color="#CCCCCC"> and</font>

605
00:21:26,820 --> 00:21:32,700
have we are we currently affected by

606
00:21:29,309 --> 00:21:33,690
somebody<font color="#E5E5E5"> using PowerShell</font><font color="#CCCCCC"> Empire to give</font>

607
00:21:32,700 --> 00:21:35,639
you a background<font color="#E5E5E5"> of kind of the</font>

608
00:21:33,690 --> 00:21:37,679
<font color="#E5E5E5">situation of our notional company we</font>

609
00:21:35,639 --> 00:21:39,149
have a very<font color="#E5E5E5"> small security</font><font color="#CCCCCC"> budget right</font>

610
00:21:37,679 --> 00:21:41,309
so that<font color="#E5E5E5"> means we don't</font><font color="#CCCCCC"> have these</font>

611
00:21:39,149 --> 00:21:42,449
expensive tools on the endpoints we

612
00:21:41,309 --> 00:21:44,908
don't have any like agent<font color="#E5E5E5"> based</font>

613
00:21:42,450 --> 00:21:47,190
<font color="#E5E5E5">monitoring we also have poor lateral</font>

614
00:21:44,909 --> 00:21:48,779
<font color="#CCCCCC">Network</font><font color="#E5E5E5"> visibility so we're not able to</font>

615
00:21:47,190 --> 00:21:50,429
<font color="#E5E5E5">see that host-to-host communication</font>

616
00:21:48,779 --> 00:21:53,119
<font color="#E5E5E5">going on we can only see network traffic</font>

617
00:21:50,429 --> 00:21:55,649
<font color="#CCCCCC">as it's exiting the the network and</font>

618
00:21:53,119 --> 00:21:57,449
everybody in the company<font color="#E5E5E5"> is a local</font>

619
00:21:55,649 --> 00:21:59,008
<font color="#CCCCCC">administrator on their own machine right</font>

620
00:21:57,450 --> 00:22:01,320
everybody kind of<font color="#E5E5E5"> I saw some people</font>

621
00:21:59,009 --> 00:22:04,139
<font color="#E5E5E5">giggle but that's a real situation and</font>

622
00:22:01,320 --> 00:22:06,359
lots of<font color="#E5E5E5"> companies so the reality is is</font>

623
00:22:04,139 --> 00:22:08,549
that<font color="#CCCCCC"> this is o--'s he's focusing on</font>

624
00:22:06,359 --> 00:22:11,189
Empire right Empire is just a tool but

625
00:22:08,549 --> 00:22:13,260
<font color="#E5E5E5">what he</font><font color="#CCCCCC"> really wants to know is</font><font color="#E5E5E5"> like can</font>

626
00:22:11,190 --> 00:22:15,390
<font color="#CCCCCC">we detect the capabilities that Empire</font>

627
00:22:13,260 --> 00:22:17,610
employing<font color="#E5E5E5"> right and so</font><font color="#CCCCCC"> we go to</font><font color="#E5E5E5"> the next</font>

628
00:22:15,390 --> 00:22:19,170
<font color="#E5E5E5">slide</font><font color="#CCCCCC"> we're going to kind</font><font color="#E5E5E5"> of break down</font>

629
00:22:17,610 --> 00:22:21,270
<font color="#CCCCCC">the tactics and</font><font color="#E5E5E5"> techniques that</font><font color="#CCCCCC"> are</font>

630
00:22:19,170 --> 00:22:23,310
built into<font color="#E5E5E5"> Empire and so for those that</font>

631
00:22:21,270 --> 00:22:25,710
aren't familiar<font color="#E5E5E5"> Empire is a</font><font color="#CCCCCC"> powershell</font>

632
00:22:23,310 --> 00:22:27,720
remote access toolkit and it employs

633
00:22:25,710 --> 00:22:30,300
pretty much the entire gamut<font color="#E5E5E5"> of attack</font>

634
00:22:27,720 --> 00:22:31,590
techniques and so we've<font color="#E5E5E5"> list that we ran</font>

635
00:22:30,300 --> 00:22:33,180
out of slide space but we generally

636
00:22:31,590 --> 00:22:34,560
<font color="#E5E5E5">listed out some of the tactics and</font>

637
00:22:33,180 --> 00:22:36,090
<font color="#E5E5E5">techniques that it employs and things</font>

638
00:22:34,560 --> 00:22:39,030
like privilege escalation right so

639
00:22:36,090 --> 00:22:41,280
access token manipulation<font color="#CCCCCC"> bypassing user</font>

640
00:22:39,030 --> 00:22:43,860
account control<font color="#CCCCCC"> there's a DLL injection</font>

641
00:22:41,280 --> 00:22:45,180
component to it<font color="#E5E5E5"> it also has a</font><font color="#CCCCCC"> Mimi katz</font>

642
00:22:43,860 --> 00:22:47,550
<font color="#E5E5E5">component so</font><font color="#CCCCCC"> you could do credential</font>

643
00:22:45,180 --> 00:22:49,860
dumping you could pass the hash using

644
00:22:47,550 --> 00:22:52,290
using Empire you can also do things<font color="#E5E5E5"> like</font>

645
00:22:49,860 --> 00:22:54,870
golden<font color="#E5E5E5"> and silver tickets</font><font color="#CCCCCC"> and you can</font>

646
00:22:52,290 --> 00:22:58,350
literally<font color="#E5E5E5"> move via</font><font color="#CCCCCC"> WM IPS exec all those</font>

647
00:22:54,870 --> 00:22:59,580
types of common techniques now as as you

648
00:22:58,350 --> 00:23:01,980
<font color="#E5E5E5">probably assumed from the title of the</font>

649
00:22:59,580 --> 00:23:04,050
<font color="#E5E5E5">talk we're going to just select access</font>

650
00:23:01,980 --> 00:23:05,280
token manipulation as the single

651
00:23:04,050 --> 00:23:08,370
technique<font color="#E5E5E5"> that we're going to look for</font>

652
00:23:05,280 --> 00:23:09,660
because<font color="#CCCCCC"> if we look for all of</font><font color="#E5E5E5"> this we're</font>

653
00:23:08,370 --> 00:23:11,370
<font color="#CCCCCC">just</font><font color="#E5E5E5"> going</font><font color="#CCCCCC"> to be in</font><font color="#E5E5E5"> over our heads right</font>

654
00:23:09,660 --> 00:23:13,290
that's too much<font color="#CCCCCC"> for an individual to</font>

655
00:23:11,370 --> 00:23:15,090
look at at one time to try<font color="#E5E5E5"> to detect and</font>

656
00:23:13,290 --> 00:23:17,639
so we're going to<font color="#CCCCCC"> focus on one thing and</font>

657
00:23:15,090 --> 00:23:19,290
<font color="#E5E5E5">the reason why we focus on it is who</font>

658
00:23:17,640 --> 00:23:22,140
here has done<font color="#E5E5E5"> something like this</font><font color="#CCCCCC"> right</font>

659
00:23:19,290 --> 00:23:23,340
so or seen<font color="#E5E5E5"> this right so the very first</font>

660
00:23:22,140 --> 00:23:25,740
command like everybody's first

661
00:23:23,340 --> 00:23:27,870
meterpreter command is get system right

662
00:23:25,740 --> 00:23:31,110
<font color="#E5E5E5">and what get system does is it's</font><font color="#CCCCCC"> going</font>

663
00:23:27,870 --> 00:23:32,850
to<font color="#E5E5E5"> steal the system token and apply it</font>

664
00:23:31,110 --> 00:23:34,919
to<font color="#E5E5E5"> your current process so that you can</font>

665
00:23:32,850 --> 00:23:38,100
execute as if you're in the<font color="#E5E5E5"> system user</font>

666
00:23:34,920 --> 00:23:40,950
context right<font color="#CCCCCC"> and so that is an example</font>

667
00:23:38,100 --> 00:23:42,389
of access token manipulation<font color="#E5E5E5"> and because</font>

668
00:23:40,950 --> 00:23:44,790
of<font color="#E5E5E5"> that that's something</font><font color="#CCCCCC"> that we decided</font>

669
00:23:42,390 --> 00:23:46,980
<font color="#CCCCCC">that we</font><font color="#E5E5E5"> wanted to focus on all right so</font>

670
00:23:44,790 --> 00:23:48,870
when we<font color="#E5E5E5"> talk about the procedures we</font>

671
00:23:46,980 --> 00:23:50,970
have<font color="#CCCCCC"> this general technique access token</font>

672
00:23:48,870 --> 00:23:54,149
manipulation but<font color="#E5E5E5"> we want to understand</font>

673
00:23:50,970 --> 00:23:55,680
like<font color="#E5E5E5"> how is access token manipulation</font>

674
00:23:54,150 --> 00:23:57,270
actually executed are there different

675
00:23:55,680 --> 00:23:58,710
ways<font color="#E5E5E5"> that an attacker can employ this</font>

676
00:23:57,270 --> 00:24:01,560
technique and so if we go to<font color="#CCCCCC"> the</font><font color="#E5E5E5"> next</font>

677
00:23:58,710 --> 00:24:03,240
<font color="#E5E5E5">slide</font><font color="#CCCCCC"> we want</font><font color="#E5E5E5"> the like a general</font>

678
00:24:01,560 --> 00:24:05,700
understanding<font color="#CCCCCC"> so</font><font color="#E5E5E5"> we can go to that mitre</font>

679
00:24:03,240 --> 00:24:07,560
attack framework and we can query say

680
00:24:05,700 --> 00:24:09,560
like what is it access token

681
00:24:07,560 --> 00:24:12,750
manipulation<font color="#E5E5E5"> and it will say basically</font>

682
00:24:09,560 --> 00:24:14,669
<font color="#CCCCCC">windows uses access tokens</font><font color="#E5E5E5"> to determine</font>

683
00:24:12,750 --> 00:24:16,430
the security context of a process or

684
00:24:14,670 --> 00:24:19,080
thread that's<font color="#E5E5E5"> running on a system</font>

685
00:24:16,430 --> 00:24:20,520
<font color="#CCCCCC">however there is this concept in</font><font color="#E5E5E5"> Windows</font>

686
00:24:19,080 --> 00:24:22,860
called token impersonation or

687
00:24:20,520 --> 00:24:25,650
impersonation in general<font color="#E5E5E5"> that allows a</font>

688
00:24:22,860 --> 00:24:27,070
process to<font color="#E5E5E5"> apply a</font><font color="#CCCCCC"> different</font><font color="#E5E5E5"> user</font>

689
00:24:25,650 --> 00:24:29,440
security context

690
00:24:27,070 --> 00:24:32,080
at the thread<font color="#E5E5E5"> level and so basically a</font>

691
00:24:29,440 --> 00:24:34,540
<font color="#E5E5E5">process can operate as a different user</font>

692
00:24:32,080 --> 00:24:36,159
for certain context and so attackers

693
00:24:34,540 --> 00:24:38,710
have found out<font color="#E5E5E5"> that they can use this</font>

694
00:24:36,160 --> 00:24:40,900
impersonation concept<font color="#E5E5E5"> to basically</font>

695
00:24:38,710 --> 00:24:42,880
operate<font color="#CCCCCC"> as a different user to achieve</font>

696
00:24:40,900 --> 00:24:44,920
some effect that they want so in this

697
00:24:42,880 --> 00:24:47,200
case if I'm a admin user but I want to

698
00:24:44,920 --> 00:24:49,570
do something<font color="#CCCCCC"> on behalf</font><font color="#E5E5E5"> of the system or</font>

699
00:24:47,200 --> 00:24:51,220
like the the<font color="#CCCCCC"> Windows root account then I</font>

700
00:24:49,570 --> 00:24:53,409
would<font color="#E5E5E5"> be able to</font><font color="#CCCCCC"> steal the</font><font color="#E5E5E5"> system token</font>

701
00:24:51,220 --> 00:24:56,020
and<font color="#E5E5E5"> then kind of assume</font><font color="#CCCCCC"> that identity</font>

702
00:24:53,410 --> 00:24:57,400
<font color="#CCCCCC">and so as we're</font><font color="#E5E5E5"> going through</font><font color="#CCCCCC"> we have a</font>

703
00:24:56,020 --> 00:24:58,750
lot of<font color="#E5E5E5"> red teamers that work with us and</font>

704
00:24:57,400 --> 00:25:01,840
<font color="#E5E5E5">so we kind of talk through</font><font color="#CCCCCC"> some</font><font color="#E5E5E5"> of the</font>

705
00:24:58,750 --> 00:25:03,520
different<font color="#E5E5E5"> token techniques or procedures</font>

706
00:25:01,840 --> 00:25:05,800
that<font color="#CCCCCC"> they're using</font><font color="#E5E5E5"> and we kind of broken</font>

707
00:25:03,520 --> 00:25:07,600
<font color="#CCCCCC">into</font><font color="#E5E5E5"> three three groups so there's token</font>

708
00:25:05,800 --> 00:25:10,540
impersonation or theft<font color="#E5E5E5"> this is that get</font>

709
00:25:07,600 --> 00:25:12,310
system token<font color="#CCCCCC"> kind</font><font color="#E5E5E5"> of kind of attack</font>

710
00:25:10,540 --> 00:25:14,740
<font color="#E5E5E5">where you literally just steal a</font>

711
00:25:12,310 --> 00:25:17,200
<font color="#E5E5E5">currently residing access token</font><font color="#CCCCCC"> from a</font>

712
00:25:14,740 --> 00:25:19,300
different<font color="#E5E5E5"> process create a process with</font>

713
00:25:17,200 --> 00:25:21,010
a<font color="#E5E5E5"> token</font><font color="#CCCCCC"> which is you still a token and</font>

714
00:25:19,300 --> 00:25:22,960
then<font color="#E5E5E5"> you create a</font><font color="#CCCCCC"> brand new process with</font>

715
00:25:21,010 --> 00:25:24,460
<font color="#CCCCCC">that token and</font><font color="#E5E5E5"> then make an impersonate</font>

716
00:25:22,960 --> 00:25:25,690
token this<font color="#E5E5E5"> is where the token isn't</font>

717
00:25:24,460 --> 00:25:27,220
<font color="#E5E5E5">readily available to you but you have</font>

718
00:25:25,690 --> 00:25:29,110
<font color="#CCCCCC">something like a</font><font color="#E5E5E5"> username and password</font>

719
00:25:27,220 --> 00:25:31,360
<font color="#CCCCCC">and so you would then go ahead and</font>

720
00:25:29,110 --> 00:25:34,179
create<font color="#E5E5E5"> a token and then go ahead and</font>

721
00:25:31,360 --> 00:25:37,510
<font color="#E5E5E5">steal that and impersonate it so next</font>

722
00:25:34,180 --> 00:25:39,040
<font color="#E5E5E5">slide</font><font color="#CCCCCC"> - to understand how all of this</font>

723
00:25:37,510 --> 00:25:41,140
works and<font color="#E5E5E5"> maybe the type</font><font color="#CCCCCC"> of information</font>

724
00:25:39,040 --> 00:25:42,280
that<font color="#E5E5E5"> we</font><font color="#CCCCCC"> need</font><font color="#E5E5E5"> to gather</font><font color="#CCCCCC"> we really need to</font>

725
00:25:41,140 --> 00:25:45,580
understand how<font color="#E5E5E5"> Windows authentication</font>

726
00:25:42,280 --> 00:25:47,800
works in general<font color="#E5E5E5"> right and so generally</font>

727
00:25:45,580 --> 00:25:49,480
<font color="#CCCCCC">speaking when a user sits at a computer</font>

728
00:25:47,800 --> 00:25:51,490
and authenticates to that to that<font color="#E5E5E5"> system</font>

729
00:25:49,480 --> 00:25:53,680
<font color="#E5E5E5">if it's a Windows operating system it's</font>

730
00:25:51,490 --> 00:25:55,900
going<font color="#E5E5E5"> to instantiate a logon session and</font>

731
00:25:53,680 --> 00:25:58,300
these logon sessions are are managed by

732
00:25:55,900 --> 00:26:00,370
<font color="#CCCCCC">the local security authority or as</font><font color="#E5E5E5"> most</font>

733
00:25:58,300 --> 00:26:03,250
of<font color="#E5E5E5"> us know like the L SAS process right</font>

734
00:26:00,370 --> 00:26:05,139
<font color="#E5E5E5">and so your credentials are going to be</font>

735
00:26:03,250 --> 00:26:06,730
stored in<font color="#E5E5E5"> else a sexy and that's why I</font>

736
00:26:05,140 --> 00:26:09,760
like<font color="#E5E5E5"> Mimi</font><font color="#CCCCCC"> Kats works right it pulls</font>

737
00:26:06,730 --> 00:26:11,320
those credentials from<font color="#CCCCCC"> LS s and those</font>

738
00:26:09,760 --> 00:26:13,000
credentials are used<font color="#E5E5E5"> for single sign-on</font>

739
00:26:11,320 --> 00:26:15,159
so like when you try to<font color="#CCCCCC"> access your</font>

740
00:26:13,000 --> 00:26:16,360
network file shares<font color="#E5E5E5"> it's not going to</font>

741
00:26:15,160 --> 00:26:17,440
prompt you<font color="#E5E5E5"> for your username and</font>

742
00:26:16,360 --> 00:26:19,600
<font color="#CCCCCC">password every time because you've</font>

743
00:26:17,440 --> 00:26:22,210
already stored those inside of<font color="#E5E5E5"> else s</font>

744
00:26:19,600 --> 00:26:24,040
<font color="#E5E5E5">and so when I say credentials just for</font>

745
00:26:22,210 --> 00:26:25,300
clarification<font color="#CCCCCC"> I don't just</font><font color="#E5E5E5"> mean</font><font color="#CCCCCC"> user</font>

746
00:26:24,040 --> 00:26:28,330
<font color="#CCCCCC">name and password I mean things like</font>

747
00:26:25,300 --> 00:26:31,750
<font color="#E5E5E5">ntlm hashes Kerberos tickets</font><font color="#CCCCCC"> plaintext</font>

748
00:26:28,330 --> 00:26:33,580
<font color="#E5E5E5">passwords so on and so forth</font><font color="#CCCCCC"> now every</font>

749
00:26:31,750 --> 00:26:35,680
<font color="#E5E5E5">single every</font><font color="#CCCCCC"> single process</font><font color="#E5E5E5"> and thread</font>

750
00:26:33,580 --> 00:26:37,330
is going to have an access token

751
00:26:35,680 --> 00:26:39,160
associated with it<font color="#E5E5E5"> and that access token</font>

752
00:26:37,330 --> 00:26:40,629
<font color="#E5E5E5">is going to be related</font><font color="#CCCCCC"> to the logon</font>

753
00:26:39,160 --> 00:26:42,520
session right so<font color="#E5E5E5"> I'll</font>

754
00:26:40,630 --> 00:26:44,710
as the<font color="#CCCCCC"> jared user account i create a</font>

755
00:26:42,520 --> 00:26:46,210
<font color="#E5E5E5">logon session for that</font><font color="#CCCCCC"> user and then</font>

756
00:26:44,710 --> 00:26:48,160
there's an access token<font color="#CCCCCC"> which is</font><font color="#E5E5E5"> going</font>

757
00:26:46,210 --> 00:26:51,400
to be<font color="#E5E5E5"> granted</font><font color="#CCCCCC"> to every process that's</font>

758
00:26:48,160 --> 00:26:53,950
spawned from<font color="#E5E5E5"> that logon session</font><font color="#CCCCCC"> and so a</font>

759
00:26:51,400 --> 00:26:55,570
general<font color="#E5E5E5"> kind of flow</font><font color="#CCCCCC"> here is you put in</font>

760
00:26:53,950 --> 00:26:57,760
your credential<font color="#CCCCCC"> a</font><font color="#E5E5E5"> logon session that's</font>

761
00:26:55,570 --> 00:26:59,500
created which has an access token<font color="#CCCCCC"> which</font>

762
00:26:57,760 --> 00:27:01,960
is then given<font color="#CCCCCC"> to threads or processes</font>

763
00:26:59,500 --> 00:27:03,520
that<font color="#E5E5E5"> are created on that logon sessions</font>

764
00:27:01,960 --> 00:27:06,160
behalf next slide

765
00:27:03,520 --> 00:27:07,420
<font color="#CCCCCC">all right so generally speaking when</font>

766
00:27:06,160 --> 00:27:09,190
we're talking<font color="#E5E5E5"> about</font><font color="#CCCCCC"> access token</font>

767
00:27:07,420 --> 00:27:11,470
manipulation<font color="#CCCCCC"> a lot of people kind of</font>

768
00:27:09,190 --> 00:27:13,630
<font color="#E5E5E5">have like</font><font color="#CCCCCC"> a misunderstanding of the</font>

769
00:27:11,470 --> 00:27:15,790
<font color="#E5E5E5">difference between like delegation and</font>

770
00:27:13,630 --> 00:27:18,670
<font color="#E5E5E5">impersonation tokens and network</font><font color="#CCCCCC"> logons</font>

771
00:27:15,790 --> 00:27:20,409
<font color="#E5E5E5">and</font><font color="#CCCCCC"> non network logons and so we see a</font>

772
00:27:18,670 --> 00:27:22,450
lot<font color="#E5E5E5"> of guidance that</font><font color="#CCCCCC"> says</font><font color="#E5E5E5"> things like oh</font>

773
00:27:20,410 --> 00:27:24,190
when<font color="#E5E5E5"> you're if you're an attacker if</font>

774
00:27:22,450 --> 00:27:25,990
you're trying to<font color="#E5E5E5"> impersonate a token</font>

775
00:27:24,190 --> 00:27:28,540
make sure that it's a delegation token

776
00:27:25,990 --> 00:27:30,640
<font color="#CCCCCC">and not an impersonation token and</font><font color="#E5E5E5"> so we</font>

777
00:27:28,540 --> 00:27:32,770
won't<font color="#E5E5E5"> get into that right now but that</font>

778
00:27:30,640 --> 00:27:34,750
that<font color="#CCCCCC"> advice is incorrect the thing that</font>

779
00:27:32,770 --> 00:27:36,639
really matters<font color="#CCCCCC"> is the type of logon</font>

780
00:27:34,750 --> 00:27:39,310
<font color="#E5E5E5">remember the credentials are</font><font color="#CCCCCC"> stored in</font>

781
00:27:36,640 --> 00:27:41,080
the logon session<font color="#CCCCCC"> not</font><font color="#E5E5E5"> in the access</font>

782
00:27:39,310 --> 00:27:42,790
token so the type of access token

783
00:27:41,080 --> 00:27:45,210
doesn't necessarily matter<font color="#E5E5E5"> it's really</font>

784
00:27:42,790 --> 00:27:48,280
how the logon session was created and so

785
00:27:45,210 --> 00:27:50,620
generally<font color="#CCCCCC"> speaking if a logon session is</font>

786
00:27:48,280 --> 00:27:53,830
of a network type<font color="#E5E5E5"> meaning something like</font>

787
00:27:50,620 --> 00:27:56,229
<font color="#CCCCCC">WM I</font><font color="#E5E5E5"> win</font><font color="#CCCCCC"> RM</font><font color="#E5E5E5"> which is</font><font color="#CCCCCC"> powershell remoting</font>

788
00:27:53,830 --> 00:27:59,560
<font color="#CCCCCC">then the the actual credentials</font><font color="#E5E5E5"> are not</font>

789
00:27:56,230 --> 00:28:01,060
<font color="#E5E5E5">passed the remote system and thus those</font>

790
00:27:59,560 --> 00:28:03,010
<font color="#E5E5E5">credentials aren't</font><font color="#CCCCCC"> available for</font>

791
00:28:01,060 --> 00:28:05,830
credential dumping attacks<font color="#E5E5E5"> or access</font>

792
00:28:03,010 --> 00:28:07,870
token like token theft<font color="#E5E5E5"> on</font><font color="#CCCCCC"> the other hand</font>

793
00:28:05,830 --> 00:28:09,730
if you do a<font color="#CCCCCC"> non-network or interactive</font>

794
00:28:07,870 --> 00:28:12,399
<font color="#E5E5E5">logon something like console</font><font color="#CCCCCC"> access so</font>

795
00:28:09,730 --> 00:28:13,810
sitting at the<font color="#E5E5E5"> computer or RDP then</font>

796
00:28:12,400 --> 00:28:15,520
you're<font color="#E5E5E5"> actually passing</font><font color="#CCCCCC"> your credentials</font>

797
00:28:13,810 --> 00:28:17,889
to<font color="#CCCCCC"> the remote system</font><font color="#E5E5E5"> you're passing that</font>

798
00:28:15,520 --> 00:28:19,240
creating a new access token<font color="#CCCCCC"> and thus an</font>

799
00:28:17,890 --> 00:28:21,520
attacker can take advantage<font color="#E5E5E5"> of that</font>

800
00:28:19,240 --> 00:28:24,250
instill that<font color="#E5E5E5"> so the implication</font><font color="#CCCCCC"> here is</font>

801
00:28:21,520 --> 00:28:25,600
<font color="#CCCCCC">that as a as a defender or an admin you</font>

802
00:28:24,250 --> 00:28:28,120
want to make sure<font color="#CCCCCC"> that you're using</font>

803
00:28:25,600 --> 00:28:30,340
<font color="#E5E5E5">those network logon types so type such</font>

804
00:28:28,120 --> 00:28:32,110
<font color="#E5E5E5">logon session type 3 whenever you're</font>

805
00:28:30,340 --> 00:28:35,230
doing remote<font color="#CCCCCC"> administration</font><font color="#E5E5E5"> to be as</font>

806
00:28:32,110 --> 00:28:37,330
<font color="#E5E5E5">secure as possible all right so I've</font>

807
00:28:35,230 --> 00:28:39,610
<font color="#E5E5E5">mentioned access token a few times what</font>

808
00:28:37,330 --> 00:28:41,710
is what<font color="#E5E5E5"> is an access token well an</font>

809
00:28:39,610 --> 00:28:43,540
access token<font color="#CCCCCC"> is a data</font><font color="#E5E5E5"> structure that's</font>

810
00:28:41,710 --> 00:28:45,640
stored in<font color="#E5E5E5"> the in the kernel and it</font>

811
00:28:43,540 --> 00:28:47,680
<font color="#E5E5E5">basically provides or describes the</font>

812
00:28:45,640 --> 00:28:50,410
security context of a process or thread

813
00:28:47,680 --> 00:28:52,300
to which<font color="#CCCCCC"> it's</font><font color="#E5E5E5"> applied the types of</font>

814
00:28:50,410 --> 00:28:54,140
information<font color="#E5E5E5"> that are inside of an access</font>

815
00:28:52,300 --> 00:28:57,200
token are like the user user

816
00:28:54,140 --> 00:28:58,700
security<font color="#CCCCCC"> identifiers or CID the group</font>

817
00:28:57,200 --> 00:29:01,010
said so what groups<font color="#E5E5E5"> does this user</font>

818
00:28:58,700 --> 00:29:02,510
belong to are they a domain admin are

819
00:29:01,010 --> 00:29:03,200
they a local administrator<font color="#CCCCCC"> so on and so</font>

820
00:29:02,510 --> 00:29:05,990
forth

821
00:29:03,200 --> 00:29:07,940
a list of prist of privileges<font color="#E5E5E5"> for the</font>

822
00:29:05,990 --> 00:29:10,130
users and<font color="#CCCCCC"> groups so does this user have</font>

823
00:29:07,940 --> 00:29:11,690
like<font color="#E5E5E5"> se debug privilege do they have the</font>

824
00:29:10,130 --> 00:29:15,140
ability<font color="#E5E5E5"> to shut down the computer</font><font color="#CCCCCC"> can</font>

825
00:29:11,690 --> 00:29:17,270
they can<font color="#CCCCCC"> they perform impersonation</font><font color="#E5E5E5"> the</font>

826
00:29:15,140 --> 00:29:19,160
token integrity<font color="#CCCCCC"> level so a lot</font><font color="#E5E5E5"> of times</font>

827
00:29:17,270 --> 00:29:21,559
attackers will talk about<font color="#E5E5E5"> like bypass</font>

828
00:29:19,160 --> 00:29:23,120
UAC and<font color="#CCCCCC"> you know the</font><font color="#E5E5E5"> the USC prompt</font><font color="#CCCCCC"> that</font>

829
00:29:21,559 --> 00:29:25,428
<font color="#E5E5E5">pops up and</font><font color="#CCCCCC"> says do you want to be an</font>

830
00:29:23,120 --> 00:29:27,678
administrator the integrity<font color="#CCCCCC"> level is</font>

831
00:29:25,429 --> 00:29:29,390
going<font color="#E5E5E5"> to basically dictate whether that</font>

832
00:29:27,679 --> 00:29:31,940
token has the ability to act on the

833
00:29:29,390 --> 00:29:34,580
behalf of an administrator<font color="#CCCCCC"> and in the</font>

834
00:29:31,940 --> 00:29:37,400
impersonation<font color="#CCCCCC"> level and a couple</font><font color="#E5E5E5"> a list</font>

835
00:29:34,580 --> 00:29:39,530
of restricting SIDS so let's say I<font color="#E5E5E5"> have</font>

836
00:29:37,400 --> 00:29:42,110
<font color="#E5E5E5">an it I have an administrator</font><font color="#CCCCCC"> account</font>

837
00:29:39,530 --> 00:29:43,790
<font color="#E5E5E5">but I don't want to provide that that</font>

838
00:29:42,110 --> 00:29:45,709
access to<font color="#E5E5E5"> the full</font><font color="#CCCCCC"> access</font><font color="#E5E5E5"> of that</font>

839
00:29:43,790 --> 00:29:47,600
administrator account to a process you

840
00:29:45,710 --> 00:29:51,470
can<font color="#E5E5E5"> restrict some of its privileges and</font>

841
00:29:47,600 --> 00:29:52,790
capabilities<font color="#E5E5E5"> and then going back</font><font color="#CCCCCC"> to kind</font>

842
00:29:51,470 --> 00:29:55,370
<font color="#CCCCCC">of</font><font color="#E5E5E5"> that delegation versus an</font>

843
00:29:52,790 --> 00:29:57,379
impersonation concept<font color="#CCCCCC"> there's two</font><font color="#E5E5E5"> two</font>

844
00:29:55,370 --> 00:29:59,120
types of<font color="#E5E5E5"> tokens so there's primary</font>

845
00:29:57,380 --> 00:30:01,580
tokens<font color="#E5E5E5"> and those are tokens that</font><font color="#CCCCCC"> are</font>

846
00:29:59,120 --> 00:30:03,439
applied at the process level<font color="#E5E5E5"> and then</font>

847
00:30:01,580 --> 00:30:05,360
there's<font color="#E5E5E5"> so every process is going to</font>

848
00:30:03,440 --> 00:30:07,160
<font color="#E5E5E5">have a primary token and then there's</font>

849
00:30:05,360 --> 00:30:09,668
what they call<font color="#E5E5E5"> impersonation tokens and</font>

850
00:30:07,160 --> 00:30:11,570
these are<font color="#CCCCCC"> tokens that</font><font color="#E5E5E5"> are created via</font>

851
00:30:09,669 --> 00:30:13,190
impersonation that<font color="#E5E5E5"> concept I talked</font>

852
00:30:11,570 --> 00:30:15,110
about<font color="#CCCCCC"> and these are going</font><font color="#E5E5E5"> to be applied</font>

853
00:30:13,190 --> 00:30:18,200
at the thread level<font color="#E5E5E5"> so an impersonation</font>

854
00:30:15,110 --> 00:30:20,178
<font color="#E5E5E5">token only dictates the security context</font>

855
00:30:18,200 --> 00:30:22,970
of an individual thread not an entire

856
00:30:20,179 --> 00:30:24,559
process<font color="#CCCCCC"> and then there's</font><font color="#E5E5E5"> a within kind</font>

857
00:30:22,970 --> 00:30:25,600
of<font color="#E5E5E5"> the subcategory of impersonation</font>

858
00:30:24,559 --> 00:30:28,160
there's these<font color="#E5E5E5"> four</font><font color="#CCCCCC"> different</font>

859
00:30:25,600 --> 00:30:29,870
<font color="#E5E5E5">impersonation levels from</font><font color="#CCCCCC"> the top is</font>

860
00:30:28,160 --> 00:30:31,490
anonymous all the way down<font color="#E5E5E5"> to delegation</font>

861
00:30:29,870 --> 00:30:33,020
and I'll let you kind<font color="#CCCCCC"> of take a look at</font>

862
00:30:31,490 --> 00:30:34,910
that<font color="#E5E5E5"> but generally</font><font color="#CCCCCC"> from the top it's the</font>

863
00:30:33,020 --> 00:30:36,590
most restrictive and the bottom<font color="#E5E5E5"> is the</font>

864
00:30:34,910 --> 00:30:39,200
least<font color="#E5E5E5"> restrictive so delegation would</font>

865
00:30:36,590 --> 00:30:41,809
allow<font color="#E5E5E5"> that access token</font><font color="#CCCCCC"> to pass</font><font color="#E5E5E5"> its</font>

866
00:30:39,200 --> 00:30:44,390
information to<font color="#E5E5E5"> another system</font><font color="#CCCCCC"> next slide</font>

867
00:30:41,809 --> 00:30:46,549
all right so<font color="#E5E5E5"> again</font><font color="#CCCCCC"> just a general</font>

868
00:30:44,390 --> 00:30:48,590
<font color="#E5E5E5">overview every process has</font><font color="#CCCCCC"> a primary</font>

869
00:30:46,549 --> 00:30:51,918
token<font color="#CCCCCC"> and</font><font color="#E5E5E5"> that describes again the</font>

870
00:30:48,590 --> 00:30:54,470
<font color="#E5E5E5">security context of the user</font><font color="#CCCCCC"> by</font><font color="#E5E5E5"> default</font>

871
00:30:51,919 --> 00:30:57,770
threads are going<font color="#CCCCCC"> to inherent inherit</font>

872
00:30:54,470 --> 00:31:00,260
that primary token from the process<font color="#CCCCCC"> but</font>

873
00:30:57,770 --> 00:31:04,040
<font color="#E5E5E5">you can do impersonation which will give</font>

874
00:31:00,260 --> 00:31:07,160
the thread<font color="#E5E5E5"> a completely different user</font>

875
00:31:04,040 --> 00:31:08,000
context<font color="#CCCCCC"> next slide all right so let's</font>

876
00:31:07,160 --> 00:31:09,800
<font color="#E5E5E5">talk</font><font color="#CCCCCC"> about token</font>

877
00:31:08,000 --> 00:31:12,230
impersonation right this is like the

878
00:31:09,800 --> 00:31:13,370
most<font color="#E5E5E5"> common thing that</font><font color="#CCCCCC"> uh that</font><font color="#E5E5E5"> that you</font>

879
00:31:12,230 --> 00:31:15,740
would ever come<font color="#CCCCCC"> across so if you've</font><font color="#E5E5E5"> ever</font>

880
00:31:13,370 --> 00:31:17,360
used meterpreter<font color="#E5E5E5"> or</font><font color="#CCCCCC"> PowerShell Empire</font>

881
00:31:15,740 --> 00:31:19,280
and you've done<font color="#E5E5E5"> like</font><font color="#CCCCCC"> steal token</font><font color="#E5E5E5"> that</font>

882
00:31:17,360 --> 00:31:21,439
type of attack<font color="#E5E5E5"> this is this is what I'm</font>

883
00:31:19,280 --> 00:31:23,990
talking about right<font color="#CCCCCC"> so</font><font color="#E5E5E5"> there's a user</font>

884
00:31:21,440 --> 00:31:26,030
let's say<font color="#CCCCCC"> your</font><font color="#E5E5E5"> runt you</font><font color="#CCCCCC"> you fish into a</font>

885
00:31:23,990 --> 00:31:28,250
system<font color="#E5E5E5"> and</font><font color="#CCCCCC"> you gain access running as</font>

886
00:31:26,030 --> 00:31:30,139
you know<font color="#E5E5E5"> Bob the guy in HR or something</font>

887
00:31:28,250 --> 00:31:32,630
like<font color="#E5E5E5"> that</font><font color="#CCCCCC"> Bob doesn't</font><font color="#E5E5E5"> have a lot of</font>

888
00:31:30,140 --> 00:31:35,150
privilege<font color="#CCCCCC"> but</font><font color="#E5E5E5"> there's probably somebody</font>

889
00:31:32,630 --> 00:31:36,800
<font color="#E5E5E5">you know or like a system account being</font>

890
00:31:35,150 --> 00:31:38,510
run somewhere so like LSS is running

891
00:31:36,800 --> 00:31:40,610
that<font color="#E5E5E5"> system when log on so on and so</font>

892
00:31:38,510 --> 00:31:42,710
forth and<font color="#E5E5E5"> so if I want to become system</font>

893
00:31:40,610 --> 00:31:45,139
<font color="#E5E5E5">all I have to do is impersonate that</font>

894
00:31:42,710 --> 00:31:46,490
access token<font color="#CCCCCC"> apply it to myself and</font><font color="#E5E5E5"> now</font>

895
00:31:45,140 --> 00:31:47,990
everything I do from<font color="#CCCCCC"> that</font><font color="#E5E5E5"> threads</font>

896
00:31:46,490 --> 00:31:50,870
context is<font color="#E5E5E5"> going to be running as</font><font color="#CCCCCC"> a</font>

897
00:31:47,990 --> 00:31:53,450
<font color="#E5E5E5">system account to do this from the API</font>

898
00:31:50,870 --> 00:31:55,040
level<font color="#E5E5E5"> you're going to use get</font><font color="#CCCCCC"> a handle</font>

899
00:31:53,450 --> 00:31:57,710
to<font color="#CCCCCC"> that process</font><font color="#E5E5E5"> using an open process</font>

900
00:31:55,040 --> 00:32:00,470
<font color="#E5E5E5">then you could call duplicate token or</font>

901
00:31:57,710 --> 00:32:02,390
duplicate token<font color="#CCCCCC"> e^x to get a copy of</font>

902
00:32:00,470 --> 00:32:03,890
<font color="#CCCCCC">that actual</font><font color="#E5E5E5"> token itself and then you</font>

903
00:32:02,390 --> 00:32:06,530
could use either impersonate logged on

904
00:32:03,890 --> 00:32:09,440
user or set thread token to apply that

905
00:32:06,530 --> 00:32:10,520
token at<font color="#CCCCCC"> that thread level</font><font color="#E5E5E5"> and so I'm</font>

906
00:32:09,440 --> 00:32:12,590
sure<font color="#CCCCCC"> a lot of</font><font color="#E5E5E5"> people</font><font color="#CCCCCC"> know malware</font>

907
00:32:10,520 --> 00:32:13,940
unicorn she helped me<font color="#E5E5E5"> kind of build some</font>

908
00:32:12,590 --> 00:32:16,699
visualizations<font color="#E5E5E5"> of how this actually</font>

909
00:32:13,940 --> 00:32:18,560
works<font color="#CCCCCC"> and so here we are PowerShell</font><font color="#E5E5E5"> at</font>

910
00:32:16,700 --> 00:32:20,780
<font color="#E5E5E5">exe is basically opening a process</font>

911
00:32:18,560 --> 00:32:22,550
handle to<font color="#E5E5E5"> win log on</font><font color="#CCCCCC"> here and then we're</font>

912
00:32:20,780 --> 00:32:24,470
going<font color="#CCCCCC"> to</font><font color="#E5E5E5"> call duplicate</font><font color="#CCCCCC"> Oken to</font>

913
00:32:22,550 --> 00:32:26,990
duplicate<font color="#CCCCCC"> that system token into</font><font color="#E5E5E5"> our</font>

914
00:32:24,470 --> 00:32:28,460
<font color="#CCCCCC">powershell exe context</font><font color="#E5E5E5"> and notice I'm</font>

915
00:32:26,990 --> 00:32:30,710
running as like John Doe inside a

916
00:32:28,460 --> 00:32:32,990
PowerShell<font color="#E5E5E5"> then I call set</font><font color="#CCCCCC"> threaded</font>

917
00:32:30,710 --> 00:32:34,730
token and<font color="#E5E5E5"> I apply that system token to</font>

918
00:32:32,990 --> 00:32:36,350
my thread<font color="#E5E5E5"> and then that thread starts</font>

919
00:32:34,730 --> 00:32:39,950
running<font color="#CCCCCC"> as system right</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> that's the</font>

920
00:32:36,350 --> 00:32:42,199
general<font color="#E5E5E5"> idea there all right so the</font><font color="#CCCCCC"> next</font>

921
00:32:39,950 --> 00:32:43,700
<font color="#CCCCCC">situation would be</font><font color="#E5E5E5"> create a process</font>

922
00:32:42,200 --> 00:32:45,830
where they token and<font color="#E5E5E5"> so a reason why an</font>

923
00:32:43,700 --> 00:32:48,620
attacker<font color="#E5E5E5"> might want to do this is let's</font>

924
00:32:45,830 --> 00:32:50,379
<font color="#E5E5E5">say let's say that your security program</font>

925
00:32:48,620 --> 00:32:52,699
locks<font color="#E5E5E5"> everything down to where only</font>

926
00:32:50,380 --> 00:32:54,800
<font color="#E5E5E5">Internet Explorer or</font><font color="#CCCCCC"> other web browsers</font>

927
00:32:52,700 --> 00:32:57,140
<font color="#E5E5E5">are allowed to make like port 80 or port</font>

928
00:32:54,800 --> 00:33:01,070
443 traffic<font color="#E5E5E5"> right or communicate with</font>

929
00:32:57,140 --> 00:33:02,750
<font color="#CCCCCC">the web proxy</font><font color="#E5E5E5"> well as an attacker</font><font color="#CCCCCC"> I want</font>

930
00:33:01,070 --> 00:33:04,790
to basically<font color="#E5E5E5"> make</font><font color="#CCCCCC"> sure that</font><font color="#E5E5E5"> I'm living</font>

931
00:33:02,750 --> 00:33:06,380
<font color="#E5E5E5">within one</font><font color="#CCCCCC"> of those browser processes</font>

932
00:33:04,790 --> 00:33:08,540
but they're kind of fickle because<font color="#E5E5E5"> a</font>

933
00:33:06,380 --> 00:33:09,800
user controls<font color="#E5E5E5"> a browser right so at any</font>

934
00:33:08,540 --> 00:33:11,750
<font color="#CCCCCC">time they could just kill that browser</font>

935
00:33:09,800 --> 00:33:13,370
and I'll<font color="#E5E5E5"> lose my access but what I might</font>

936
00:33:11,750 --> 00:33:15,410
want<font color="#CCCCCC"> to do is create a brand new</font>

937
00:33:13,370 --> 00:33:17,479
<font color="#E5E5E5">Internet Explorer process kind of in the</font>

938
00:33:15,410 --> 00:33:19,880
background<font color="#CCCCCC"> move</font><font color="#E5E5E5"> into that so</font><font color="#CCCCCC"> that I get</font>

939
00:33:17,480 --> 00:33:20,870
by the security the<font color="#CCCCCC"> security feature</font><font color="#E5E5E5"> but</font>

940
00:33:19,880 --> 00:33:22,220
also the

941
00:33:20,870 --> 00:33:24,020
<font color="#CCCCCC">user isn't</font><font color="#E5E5E5"> going to just kill this</font>

942
00:33:22,220 --> 00:33:25,790
<font color="#CCCCCC">internet explorer process that</font><font color="#E5E5E5"> I created</font>

943
00:33:24,020 --> 00:33:27,860
and so I could do pretty<font color="#CCCCCC"> much</font><font color="#E5E5E5"> the same</font>

944
00:33:25,790 --> 00:33:30,590
<font color="#CCCCCC">same</font><font color="#E5E5E5"> thing that I did</font><font color="#CCCCCC"> with</font><font color="#E5E5E5"> the previous</font>

945
00:33:27,860 --> 00:33:32,300
<font color="#E5E5E5">attack except after I duplicate my token</font>

946
00:33:30,590 --> 00:33:34,909
I'm going to use<font color="#E5E5E5"> create process with</font>

947
00:33:32,300 --> 00:33:37,610
token<font color="#E5E5E5"> W to create a brand new process</font>

948
00:33:34,910 --> 00:33:39,170
using that token<font color="#CCCCCC"> the caveat here is that</font>

949
00:33:37,610 --> 00:33:41,149
<font color="#E5E5E5">that token is going to be applied at the</font>

950
00:33:39,170 --> 00:33:43,309
process<font color="#CCCCCC"> level not at</font><font color="#E5E5E5"> the thread level</font>

951
00:33:41,150 --> 00:33:45,410
<font color="#E5E5E5">like the previous attack and so we have</font>

952
00:33:43,309 --> 00:33:47,210
<font color="#E5E5E5">another kind</font><font color="#CCCCCC"> of demonstration here</font><font color="#E5E5E5"> so</font>

953
00:33:45,410 --> 00:33:50,360
<font color="#E5E5E5">PowerShell dot exe opens the process to</font>

954
00:33:47,210 --> 00:33:53,530
<font color="#CCCCCC">explorer.exe then it's going</font><font color="#E5E5E5"> to</font>

955
00:33:50,360 --> 00:33:55,790
<font color="#E5E5E5">duplicate that domain admin token and</font>

956
00:33:53,530 --> 00:33:57,649
then we're going<font color="#CCCCCC"> to create a new process</font>

957
00:33:55,790 --> 00:33:59,899
<font color="#CCCCCC">called malicious dot exe whatever you</font>

958
00:33:57,650 --> 00:34:01,940
want to call it and apply that<font color="#E5E5E5"> domain</font>

959
00:33:59,900 --> 00:34:04,580
admin token to it so<font color="#E5E5E5"> now we have a new</font>

960
00:34:01,940 --> 00:34:07,100
<font color="#CCCCCC">process running</font><font color="#E5E5E5"> as domain admin</font><font color="#CCCCCC"> next</font>

961
00:34:04,580 --> 00:34:09,500
<font color="#CCCCCC">slide</font><font color="#E5E5E5"> so another really cool attack is</font>

962
00:34:07,100 --> 00:34:11,480
this make<font color="#CCCCCC"> an impersonate token so up</font>

963
00:34:09,500 --> 00:34:13,460
<font color="#CCCCCC">until now</font><font color="#E5E5E5"> we've only been able to</font>

964
00:34:11,480 --> 00:34:15,110
duplicate or impersonate tokens for

965
00:34:13,460 --> 00:34:16,668
users<font color="#CCCCCC"> that are currently logged on to</font>

966
00:34:15,110 --> 00:34:19,190
<font color="#CCCCCC">the system that we have access to right</font>

967
00:34:16,668 --> 00:34:21,649
<font color="#CCCCCC">in this case there may be a situation</font>

968
00:34:19,190 --> 00:34:24,168
<font color="#E5E5E5">that you come across credentials</font><font color="#CCCCCC"> kind of</font>

969
00:34:21,649 --> 00:34:26,210
in your<font color="#E5E5E5"> attacker</font><font color="#CCCCCC"> life cycle or whatever</font>

970
00:34:24,168 --> 00:34:27,770
that<font color="#E5E5E5"> you that you want to use but</font><font color="#CCCCCC"> you</font>

971
00:34:26,210 --> 00:34:29,540
don't have<font color="#CCCCCC"> that user logged in so you</font>

972
00:34:27,770 --> 00:34:31,610
can't necessarily impersonate that user

973
00:34:29,540 --> 00:34:33,259
<font color="#E5E5E5">let's say you're like combing through</font>

974
00:34:31,610 --> 00:34:35,000
file shares and<font color="#E5E5E5"> you find an admin who's</font>

975
00:34:33,260 --> 00:34:37,580
left their passwords in a<font color="#E5E5E5"> text file</font>

976
00:34:35,000 --> 00:34:39,590
<font color="#E5E5E5">somewhere or a batch script</font><font color="#CCCCCC"> now I have</font>

977
00:34:37,580 --> 00:34:43,069
those credentials<font color="#CCCCCC"> I can use the logon</font>

978
00:34:39,590 --> 00:34:45,620
user function and set the DW logon type

979
00:34:43,070 --> 00:34:48,290
parameter to<font color="#E5E5E5"> logon 30 to</font><font color="#CCCCCC"> logon</font><font color="#E5E5E5"> new</font>

980
00:34:45,620 --> 00:34:50,089
credentials<font color="#E5E5E5"> which is a type 9 logon and</font>

981
00:34:48,290 --> 00:34:52,790
<font color="#E5E5E5">pass those credentials</font><font color="#CCCCCC"> to create</font><font color="#E5E5E5"> a</font>

982
00:34:50,090 --> 00:34:54,679
completely new logon session<font color="#CCCCCC"> has anybody</font>

983
00:34:52,790 --> 00:34:56,989
anybody<font color="#CCCCCC"> familiar with like run a slash</font>

984
00:34:54,679 --> 00:34:58,760
net only<font color="#E5E5E5"> like that that type of being</font>

985
00:34:56,989 --> 00:35:00,229
<font color="#E5E5E5">able to run as a separate user this is</font>

986
00:34:58,760 --> 00:35:03,320
<font color="#CCCCCC">the same functionality</font><font color="#E5E5E5"> that that's</font>

987
00:35:00,230 --> 00:35:05,270
performing at the API level<font color="#E5E5E5"> and so what</font>

988
00:35:03,320 --> 00:35:07,550
this<font color="#E5E5E5"> does is</font><font color="#CCCCCC"> it creates a new logon</font>

989
00:35:05,270 --> 00:35:09,560
session of type new credentials which is

990
00:35:07,550 --> 00:35:11,780
kind of important<font color="#CCCCCC"> and it's going to</font>

991
00:35:09,560 --> 00:35:14,600
create<font color="#E5E5E5"> a token</font><font color="#CCCCCC"> that's kind of a dual</font>

992
00:35:11,780 --> 00:35:16,760
token so locally I'm going to run as<font color="#E5E5E5"> the</font>

993
00:35:14,600 --> 00:35:19,250
original user that I was that<font color="#E5E5E5"> I called</font>

994
00:35:16,760 --> 00:35:21,230
logon user<font color="#E5E5E5"> as but on the network I'm</font>

995
00:35:19,250 --> 00:35:22,940
going to be able<font color="#E5E5E5"> to authenticate</font><font color="#CCCCCC"> using</font>

996
00:35:21,230 --> 00:35:25,460
the<font color="#E5E5E5"> credentials that I pass through the</font>

997
00:35:22,940 --> 00:35:27,200
logon user function right and so if we

998
00:35:25,460 --> 00:35:28,400
go ahead<font color="#CCCCCC"> and go to the next slide this</font>

999
00:35:27,200 --> 00:35:30,049
<font color="#E5E5E5">will hopefully make</font><font color="#CCCCCC"> more sense</font><font color="#E5E5E5"> so I'm</font>

1000
00:35:28,400 --> 00:35:32,120
going<font color="#E5E5E5"> to call logon user and pass this</font>

1001
00:35:30,050 --> 00:35:34,150
domain admin username and password right

1002
00:35:32,120 --> 00:35:36,038
<font color="#E5E5E5">it's going</font><font color="#CCCCCC"> to create a new logon</font>

1003
00:35:34,150 --> 00:35:38,859
potential session<font color="#E5E5E5"> or new credentials</font>

1004
00:35:36,039 --> 00:35:41,440
<font color="#E5E5E5">logon session with a John Doe local user</font>

1005
00:35:38,859 --> 00:35:42,940
and a domain admin<font color="#E5E5E5"> network user and then</font>

1006
00:35:41,440 --> 00:35:45,369
that's going<font color="#E5E5E5"> to be</font><font color="#CCCCCC"> applied to my thread</font>

1007
00:35:42,940 --> 00:35:46,779
<font color="#E5E5E5">and everything if if you just query the</font>

1008
00:35:45,369 --> 00:35:47,980
access token it will appear<font color="#CCCCCC"> to be</font>

1009
00:35:46,779 --> 00:35:49,420
running<font color="#E5E5E5"> as John Doe</font>

1010
00:35:47,980 --> 00:35:50,710
but then when I make my network

1011
00:35:49,420 --> 00:35:52,660
connection I'll be running as domain

1012
00:35:50,710 --> 00:35:54,069
<font color="#E5E5E5">admin so it's it's</font><font color="#CCCCCC"> kind of a little</font>

1013
00:35:52,660 --> 00:35:56,890
<font color="#CCCCCC">still a little</font><font color="#E5E5E5"> more stealthy and than</font>

1014
00:35:54,069 --> 00:35:58,509
<font color="#E5E5E5">just stealing the token next slide</font><font color="#CCCCCC"> all</font>

1015
00:35:56,890 --> 00:36:00,460
<font color="#CCCCCC">right so we've identified</font><font color="#E5E5E5"> some</font>

1016
00:35:58,510 --> 00:36:03,849
procedures<font color="#E5E5E5"> three different procedures</font>

1017
00:36:00,460 --> 00:36:05,079
but in my mind<font color="#CCCCCC"> there's one that kind of</font>

1018
00:36:03,849 --> 00:36:07,299
stands out as being<font color="#CCCCCC"> different</font><font color="#E5E5E5"> than the</font>

1019
00:36:05,079 --> 00:36:10,750
others and so that create a process<font color="#CCCCCC"> with</font>

1020
00:36:07,299 --> 00:36:12,910
token<font color="#CCCCCC"> kind</font><font color="#E5E5E5"> of attack is doing a process</font>

1021
00:36:10,750 --> 00:36:14,680
level<font color="#E5E5E5"> token impersonation right instead</font>

1022
00:36:12,910 --> 00:36:17,200
<font color="#E5E5E5">of that applying the token at the thread</font>

1023
00:36:14,680 --> 00:36:19,598
level<font color="#E5E5E5"> and because of</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> the detection</font>

1024
00:36:17,200 --> 00:36:20,950
<font color="#E5E5E5">will be slightly</font><font color="#CCCCCC"> different and so</font><font color="#E5E5E5"> for</font>

1025
00:36:19,599 --> 00:36:22,839
that reason<font color="#E5E5E5"> we've just decided to put</font>

1026
00:36:20,950 --> 00:36:24,490
<font color="#CCCCCC">that off kind</font><font color="#E5E5E5"> of as an excluded factor</font>

1027
00:36:22,839 --> 00:36:26,529
for now we'll come back to<font color="#E5E5E5"> that maybe</font>

1028
00:36:24,490 --> 00:36:28,089
<font color="#E5E5E5">next week or at some some time later and</font>

1029
00:36:26,529 --> 00:36:29,950
so we're<font color="#E5E5E5"> gonna focus on token</font>

1030
00:36:28,089 --> 00:36:31,808
impersonation or token theft and create

1031
00:36:29,950 --> 00:36:35,169
an impersonate token going forward in

1032
00:36:31,809 --> 00:36:37,450
this hypothesis all right so<font color="#CCCCCC"> our</font>

1033
00:36:35,170 --> 00:36:38,829
collection<font color="#CCCCCC"> requirements at this point we</font>

1034
00:36:37,450 --> 00:36:40,689
<font color="#E5E5E5">want to start</font><font color="#CCCCCC"> determining what type of</font>

1035
00:36:38,829 --> 00:36:42,099
information do we<font color="#E5E5E5"> need like what do we</font>

1036
00:36:40,690 --> 00:36:43,569
need to collect in<font color="#E5E5E5"> order to determine</font>

1037
00:36:42,099 --> 00:36:45,849
<font color="#E5E5E5">that this activity</font><font color="#CCCCCC"> has</font><font color="#E5E5E5"> happened</font><font color="#CCCCCC"> in our</font>

1038
00:36:43,569 --> 00:36:47,680
environment<font color="#E5E5E5"> so there's a few like open</font>

1039
00:36:45,849 --> 00:36:49,960
<font color="#E5E5E5">source tools that perform access token</font>

1040
00:36:47,680 --> 00:36:51,788
<font color="#CCCCCC">manipulations so one is</font><font color="#E5E5E5"> incognito that's</font>

1041
00:36:49,960 --> 00:36:53,130
kind of the<font color="#E5E5E5"> the old standard right and</font>

1042
00:36:51,789 --> 00:36:55,299
that<font color="#E5E5E5"> that's built into meterpreter</font>

1043
00:36:53,130 --> 00:36:56,799
<font color="#E5E5E5">invoke token manipulation is a</font>

1044
00:36:55,299 --> 00:36:58,480
<font color="#E5E5E5">PowerShell implementation that's built</font>

1045
00:36:56,799 --> 00:37:00,940
<font color="#E5E5E5">into power sploit or PowerShell Empire</font>

1046
00:36:58,480 --> 00:37:03,630
and then like a cobalt<font color="#E5E5E5"> strike is an</font>

1047
00:37:00,940 --> 00:37:06,549
example of a a paid product that has

1048
00:37:03,630 --> 00:37:07,900
token manipulation capabilities<font color="#CCCCCC"> and so</font>

1049
00:37:06,549 --> 00:37:09,730
at this<font color="#E5E5E5"> point we want</font><font color="#CCCCCC"> to collect all of</font>

1050
00:37:07,900 --> 00:37:11,289
our relevant data points and the<font color="#CCCCCC"> first</font>

1051
00:37:09,730 --> 00:37:12,789
thing that<font color="#E5E5E5"> comes</font><font color="#CCCCCC"> to mind is we</font><font color="#E5E5E5"> probably</font>

1052
00:37:11,289 --> 00:37:14,289
want to collect the access tokens right

1053
00:37:12,789 --> 00:37:16,180
<font color="#E5E5E5">from every process and every every</font>

1054
00:37:14,289 --> 00:37:17,529
thread and so we'll<font color="#E5E5E5"> start there and kind</font>

1055
00:37:16,180 --> 00:37:20,589
<font color="#CCCCCC">of</font><font color="#E5E5E5"> see what we can do from there</font>

1056
00:37:17,529 --> 00:37:22,329
<font color="#CCCCCC">alright so collecting access tokens you</font>

1057
00:37:20,589 --> 00:37:24,839
do you do your research and you come<font color="#CCCCCC"> up</font>

1058
00:37:22,329 --> 00:37:27,640
with<font color="#E5E5E5"> kind of this this functionality to</font>

1059
00:37:24,839 --> 00:37:29,619
collect them right<font color="#E5E5E5"> and so PowerShell for</font>

1060
00:37:27,640 --> 00:37:31,538
I'm a<font color="#E5E5E5"> PowerShell fanboy PowerShell does</font>

1061
00:37:29,619 --> 00:37:34,270
not have a capability natively to

1062
00:37:31,539 --> 00:37:35,770
<font color="#E5E5E5">collect access tokens and so we had to</font>

1063
00:37:34,270 --> 00:37:38,410
go through<font color="#CCCCCC"> and actually write our own</font>

1064
00:37:35,770 --> 00:37:39,940
script and basically what we do is<font color="#CCCCCC"> we</font>

1065
00:37:38,410 --> 00:37:41,680
iterate through every process<font color="#CCCCCC"> and every</font>

1066
00:37:39,940 --> 00:37:43,750
thread on the machine and call open

1067
00:37:41,680 --> 00:37:45,368
process or open thread<font color="#CCCCCC"> depending</font><font color="#E5E5E5"> on</font>

1068
00:37:43,750 --> 00:37:47,950
whether it's the processor thread<font color="#E5E5E5"> that</font>

1069
00:37:45,369 --> 00:37:50,260
returns a handle to us then we call<font color="#E5E5E5"> open</font>

1070
00:37:47,950 --> 00:37:52,029
or open thread token which gives us a

1071
00:37:50,260 --> 00:37:54,550
handle<font color="#CCCCCC"> to the token</font><font color="#E5E5E5"> and then we could</font>

1072
00:37:52,030 --> 00:37:56,590
call get token<font color="#E5E5E5"> information which allows</font>

1073
00:37:54,550 --> 00:37:58,840
us to query<font color="#E5E5E5"> like who's the user that</font>

1074
00:37:56,590 --> 00:37:59,770
this token belongs to who is what groups

1075
00:37:58,840 --> 00:38:01,210
does it belong<font color="#CCCCCC"> to what are the</font>

1076
00:37:59,770 --> 00:38:03,520
privileges so on and so forth

1077
00:38:01,210 --> 00:38:06,100
and we regain<font color="#CCCCCC"> that context about what's</font>

1078
00:38:03,520 --> 00:38:07,630
happening<font color="#E5E5E5"> next</font><font color="#CCCCCC"> slide</font><font color="#E5E5E5"> and so at the end</font>

1079
00:38:06,100 --> 00:38:09,069
<font color="#E5E5E5">we end up with a</font><font color="#CCCCCC"> powershell script</font>

1080
00:38:07,630 --> 00:38:12,070
called get access token<font color="#CCCCCC"> which is</font>

1081
00:38:09,070 --> 00:38:14,320
<font color="#CCCCCC">available on github</font><font color="#E5E5E5"> and we end up having</font>

1082
00:38:12,070 --> 00:38:16,840
things like<font color="#E5E5E5"> what is the process context</font>

1083
00:38:14,320 --> 00:38:18,490
so this is application<font color="#E5E5E5"> frame host what's</font>

1084
00:38:16,840 --> 00:38:21,730
the<font color="#CCCCCC"> username that this is</font><font color="#E5E5E5"> running as in</font>

1085
00:38:18,490 --> 00:38:24,250
this<font color="#E5E5E5"> case just a tester user</font><font color="#CCCCCC"> the groups</font>

1086
00:38:21,730 --> 00:38:25,540
are here like it's a primary token and

1087
00:38:24,250 --> 00:38:27,100
so on and so forth and you<font color="#E5E5E5"> have all this</font>

1088
00:38:25,540 --> 00:38:29,590
context about<font color="#E5E5E5"> what's happening with that</font>

1089
00:38:27,100 --> 00:38:31,089
<font color="#E5E5E5">token so if we go to</font><font color="#CCCCCC"> the next</font><font color="#E5E5E5"> slide and</font>

1090
00:38:29,590 --> 00:38:33,670
<font color="#CCCCCC">so when we start to</font><font color="#E5E5E5"> look at</font>

1091
00:38:31,090 --> 00:38:35,110
impersonation impersonations<font color="#CCCCCC"> a</font>

1092
00:38:33,670 --> 00:38:36,940
legitimate thing in the Windows

1093
00:38:35,110 --> 00:38:38,620
operating system so we can't<font color="#CCCCCC"> just</font><font color="#E5E5E5"> say oh</font>

1094
00:38:36,940 --> 00:38:40,630
if it's<font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> using an impersonation</font><font color="#CCCCCC"> that</font>

1095
00:38:38,620 --> 00:38:42,759
it's bad we need to kill<font color="#E5E5E5"> it</font><font color="#CCCCCC"> but</font>

1096
00:38:40,630 --> 00:38:45,300
<font color="#E5E5E5">generally</font><font color="#CCCCCC"> speaking impersonation is used</font>

1097
00:38:42,760 --> 00:38:47,490
for very specific reasons<font color="#CCCCCC"> and so that's</font>

1098
00:38:45,300 --> 00:38:50,830
those reasons would be something like

1099
00:38:47,490 --> 00:38:53,589
SVC host which<font color="#CCCCCC"> is a like a service</font>

1100
00:38:50,830 --> 00:38:55,390
hosting process right<font color="#E5E5E5"> which has</font><font color="#CCCCCC"> two</font>

1101
00:38:53,590 --> 00:38:57,400
<font color="#CCCCCC">hosts</font><font color="#E5E5E5"> multiple different services and</font>

1102
00:38:55,390 --> 00:38:59,529
some of those<font color="#E5E5E5"> services may want</font><font color="#CCCCCC"> to run</font>

1103
00:38:57,400 --> 00:39:02,740
as a different user and so in that case

1104
00:38:59,530 --> 00:39:05,800
<font color="#CCCCCC">SB</font><font color="#E5E5E5"> CEOs would use impersonation to allow</font>

1105
00:39:02,740 --> 00:39:08,620
a portion<font color="#E5E5E5"> of</font><font color="#CCCCCC"> its basically memory space</font>

1106
00:39:05,800 --> 00:39:10,210
to be run run as a separate user than

1107
00:39:08,620 --> 00:39:13,480
what it was<font color="#CCCCCC"> initially started as and so</font>

1108
00:39:10,210 --> 00:39:16,060
at the bottom<font color="#E5E5E5"> we see the</font><font color="#CCCCCC"> primary</font><font color="#E5E5E5"> user so</font>

1109
00:39:13,480 --> 00:39:17,050
<font color="#E5E5E5">SVC OS was started as system but it</font>

1110
00:39:16,060 --> 00:39:18,880
later on

1111
00:39:17,050 --> 00:39:21,310
impersonates and one of its threads the

1112
00:39:18,880 --> 00:39:23,050
tester user and so generally<font color="#CCCCCC"> speaking we</font>

1113
00:39:21,310 --> 00:39:25,029
see that we're<font color="#CCCCCC"> going from the system</font>

1114
00:39:23,050 --> 00:39:27,010
mandatory level to the medium mandatory

1115
00:39:25,030 --> 00:39:28,660
level and in this case we're going<font color="#E5E5E5"> from</font>

1116
00:39:27,010 --> 00:39:30,760
like a higher privileged user to a lower

1117
00:39:28,660 --> 00:39:33,910
privileged user which generally<font color="#CCCCCC"> is kind</font>

1118
00:39:30,760 --> 00:39:35,410
of<font color="#E5E5E5"> a safe a safe concept but when</font>

1119
00:39:33,910 --> 00:39:37,330
somebody<font color="#E5E5E5"> runs get system this is what</font>

1120
00:39:35,410 --> 00:39:39,279
this looks<font color="#CCCCCC"> like</font><font color="#E5E5E5"> so the primary user name</font>

1121
00:39:37,330 --> 00:39:41,500
is tester<font color="#E5E5E5"> right</font><font color="#CCCCCC"> so a lower privileged</font>

1122
00:39:39,280 --> 00:39:43,540
user and the impersonated user at<font color="#CCCCCC"> the</font>

1123
00:39:41,500 --> 00:39:45,100
top here is<font color="#E5E5E5"> empty Authority system</font><font color="#CCCCCC"> and</font>

1124
00:39:43,540 --> 00:39:47,440
so this would be<font color="#CCCCCC"> a situation where</font>

1125
00:39:45,100 --> 00:39:49,990
<font color="#E5E5E5">somebody has basically escalated their</font>

1126
00:39:47,440 --> 00:39:51,610
privilege level<font color="#E5E5E5"> based on token</font>

1127
00:39:49,990 --> 00:39:53,350
impersonation<font color="#E5E5E5"> and so we can kind of</font>

1128
00:39:51,610 --> 00:39:54,670
identify that especially when<font color="#E5E5E5"> it's</font>

1129
00:39:53,350 --> 00:39:56,620
running<font color="#E5E5E5"> from something like</font><font color="#CCCCCC"> powershell</font>

1130
00:39:54,670 --> 00:39:58,510
XE which has no there's no reason<font color="#CCCCCC"> why</font>

1131
00:39:56,620 --> 00:40:01,720
<font color="#CCCCCC">powershell should be impersonating</font>

1132
00:39:58,510 --> 00:40:03,280
different users<font color="#CCCCCC"> all right so</font>

1133
00:40:01,720 --> 00:40:05,290
at<font color="#E5E5E5"> Derby con Robbie and I talked about</font>

1134
00:40:03,280 --> 00:40:07,090
<font color="#E5E5E5">detecting golden ticket attacks and so</font>

1135
00:40:05,290 --> 00:40:09,220
one<font color="#CCCCCC"> of the things that we kind</font><font color="#E5E5E5"> of</font>

1136
00:40:07,090 --> 00:40:11,349
<font color="#E5E5E5">stumbled upon is</font><font color="#CCCCCC"> a way to help detect</font>

1137
00:40:09,220 --> 00:40:13,540
<font color="#E5E5E5">that second</font><font color="#CCCCCC"> situation where an attacker</font>

1138
00:40:11,349 --> 00:40:15,550
makes a token and then then impersonates

1139
00:40:13,540 --> 00:40:17,320
it and so one<font color="#CCCCCC"> thing that</font><font color="#E5E5E5"> we would want</font>

1140
00:40:15,550 --> 00:40:19,480
<font color="#CCCCCC">to</font><font color="#E5E5E5"> collect in this case is ticket</font>

1141
00:40:17,320 --> 00:40:21,190
granting ticket so Kerberos ticket

1142
00:40:19,480 --> 00:40:23,230
granting ticket<font color="#CCCCCC"> and so the way that</font><font color="#E5E5E5"> you</font>

1143
00:40:21,190 --> 00:40:26,440
do this is by querying all the LSA

1144
00:40:23,230 --> 00:40:28,210
functions so basically you query the the

1145
00:40:26,440 --> 00:40:30,130
<font color="#E5E5E5">logon sessions and then every logon</font>

1146
00:40:28,210 --> 00:40:31,210
session you query and ask<font color="#E5E5E5"> hey do you</font>

1147
00:40:30,130 --> 00:40:33,160
have a Kerberos ticket granting ticket

1148
00:40:31,210 --> 00:40:37,000
if it does it returns and<font color="#E5E5E5"> then you can</font>

1149
00:40:33,160 --> 00:40:38,830
analyze<font color="#CCCCCC"> it</font><font color="#E5E5E5"> from there all right and then</font>

1150
00:40:37,000 --> 00:40:40,570
you<font color="#CCCCCC"> have a script</font><font color="#E5E5E5"> called get Kerberos</font>

1151
00:40:38,830 --> 00:40:41,770
ticket granting ticket<font color="#E5E5E5"> and generally</font>

1152
00:40:40,570 --> 00:40:43,480
<font color="#CCCCCC">speaking you're going to have at</font><font color="#E5E5E5"> the</font>

1153
00:40:41,770 --> 00:40:45,130
bottom<font color="#E5E5E5"> the information about the logon</font>

1154
00:40:43,480 --> 00:40:46,510
session that that ticket belongs to and

1155
00:40:45,130 --> 00:40:47,680
you're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to at the top the</font>

1156
00:40:46,510 --> 00:40:50,050
information about the ticket itself

1157
00:40:47,680 --> 00:40:52,359
again in<font color="#E5E5E5"> general when I log on to a</font>

1158
00:40:50,050 --> 00:40:55,030
system<font color="#E5E5E5"> I'm going to log on as the</font><font color="#CCCCCC"> jared</font>

1159
00:40:52,359 --> 00:40:56,650
user account and then<font color="#CCCCCC"> i'm going to i'm</font>

1160
00:40:55,030 --> 00:40:57,880
<font color="#CCCCCC">going</font><font color="#E5E5E5"> to request a Kerberos ticket</font>

1161
00:40:56,650 --> 00:41:00,070
granting ticket for my user account

1162
00:40:57,880 --> 00:41:02,230
right like generally speaking I don't

1163
00:41:00,070 --> 00:41:03,460
log in<font color="#CCCCCC"> and</font><font color="#E5E5E5"> then get his Kerberos ticket</font>

1164
00:41:02,230 --> 00:41:05,859
granting ticket<font color="#E5E5E5"> that just doesn't make</font>

1165
00:41:03,460 --> 00:41:09,250
<font color="#CCCCCC">sense</font><font color="#E5E5E5"> and so we kind of compare the</font>

1166
00:41:05,859 --> 00:41:11,490
<font color="#CCCCCC">logon session user to the</font><font color="#E5E5E5"> actual the</font>

1167
00:41:09,250 --> 00:41:14,109
actual ticket user itself so next<font color="#E5E5E5"> slide</font>

1168
00:41:11,490 --> 00:41:16,149
<font color="#E5E5E5">but not an example of a benign ticket</font>

1169
00:41:14,109 --> 00:41:18,009
would<font color="#E5E5E5"> be down</font><font color="#CCCCCC"> here we have a logon</font>

1170
00:41:16,150 --> 00:41:19,930
session for the local admin user<font color="#CCCCCC"> and the</font>

1171
00:41:18,010 --> 00:41:22,750
<font color="#CCCCCC">citadel doc over</font><font color="#E5E5E5"> deist a local domain</font>

1172
00:41:19,930 --> 00:41:24,399
and at the top we have the client of the

1173
00:41:22,750 --> 00:41:26,349
ticket<font color="#E5E5E5"> is local admin and the domain is</font>

1174
00:41:24,400 --> 00:41:29,050
<font color="#E5E5E5">citadel a cover yourself ocol again</font>

1175
00:41:26,349 --> 00:41:30,910
<font color="#E5E5E5">that's what we expect next slide now</font>

1176
00:41:29,050 --> 00:41:32,710
this is evidence of kind<font color="#E5E5E5"> of that make</font>

1177
00:41:30,910 --> 00:41:34,629
token<font color="#E5E5E5"> attack so we see the new</font>

1178
00:41:32,710 --> 00:41:36,369
credentials<font color="#CCCCCC"> logon type at the bottom and</font>

1179
00:41:34,630 --> 00:41:38,530
we see that the user<font color="#E5E5E5"> of the session is</font>

1180
00:41:36,369 --> 00:41:41,320
<font color="#CCCCCC">just this local local user named</font><font color="#E5E5E5"> John</font>

1181
00:41:38,530 --> 00:41:43,630
<font color="#E5E5E5">right</font><font color="#CCCCCC"> but at the top we see</font><font color="#E5E5E5"> that they</font>

1182
00:41:41,320 --> 00:41:45,940
had<font color="#E5E5E5"> John requested a ticket for</font><font color="#CCCCCC"> mmm</font>

1183
00:41:43,630 --> 00:41:48,040
<font color="#CCCCCC">writes</font><font color="#E5E5E5"> underscore a which presumably is</font>

1184
00:41:45,940 --> 00:41:50,290
<font color="#E5E5E5">like an admin account right or some sort</font>

1185
00:41:48,040 --> 00:41:52,420
of<font color="#E5E5E5"> domain admin account at Citadel</font><font color="#CCCCCC"> Dhaka</font>

1186
00:41:50,290 --> 00:41:53,859
<font color="#E5E5E5">various all local and like that John has</font>

1187
00:41:52,420 --> 00:41:55,240
no business<font color="#CCCCCC"> having that ticket in his</font>

1188
00:41:53,859 --> 00:41:57,940
<font color="#E5E5E5">logon session so we're going to</font>

1189
00:41:55,240 --> 00:41:59,890
investigate that<font color="#E5E5E5"> going forward all right</font>

1190
00:41:57,940 --> 00:42:01,300
<font color="#CCCCCC">so from here we would want</font><font color="#E5E5E5"> to we have</font>

1191
00:41:59,890 --> 00:42:03,190
<font color="#E5E5E5">kind of an idea</font><font color="#CCCCCC"> of what we want to</font>

1192
00:42:01,300 --> 00:42:04,930
<font color="#E5E5E5">collect Kerberos ticket Grant Achatz and</font>

1193
00:42:03,190 --> 00:42:06,310
access tokens for processes and threads

1194
00:42:04,930 --> 00:42:08,589
<font color="#E5E5E5">and then we want to go forward and</font>

1195
00:42:06,310 --> 00:42:10,180
identify what<font color="#E5E5E5"> the scope of our kind of</font>

1196
00:42:08,589 --> 00:42:12,310
analysis<font color="#E5E5E5"> or collection will be</font><font color="#CCCCCC"> and so</font>

1197
00:42:10,180 --> 00:42:13,960
again we have<font color="#E5E5E5"> one week that's kind of</font>

1198
00:42:12,310 --> 00:42:15,040
what we're<font color="#CCCCCC"> giving ourselves now you</font>

1199
00:42:13,960 --> 00:42:17,020
could<font color="#CCCCCC"> determine whether that's</font>

1200
00:42:15,040 --> 00:42:18,310
<font color="#CCCCCC">efficient time or maybe too much time</font><font color="#E5E5E5"> we</font>

1201
00:42:17,020 --> 00:42:19,960
have three domains<font color="#E5E5E5"> that we want</font><font color="#CCCCCC"> to</font>

1202
00:42:18,310 --> 00:42:21,430
gather<font color="#E5E5E5"> information from on those three</font>

1203
00:42:19,960 --> 00:42:24,340
domains we have one<font color="#E5E5E5"> Linux server which</font>

1204
00:42:21,430 --> 00:42:26,200
is non domain<font color="#E5E5E5"> join and Linux doesn't do</font>

1205
00:42:24,340 --> 00:42:27,910
authentication in the same way<font color="#CCCCCC"> so we're</font>

1206
00:42:26,200 --> 00:42:29,620
going<font color="#E5E5E5"> to kind</font><font color="#CCCCCC"> of exclude that we have</font>

1207
00:42:27,910 --> 00:42:31,779
<font color="#E5E5E5">nine</font><font color="#CCCCCC"> Windows workstations and two</font>

1208
00:42:29,620 --> 00:42:34,000
<font color="#E5E5E5">Windows servers we have no sensitive</font>

1209
00:42:31,780 --> 00:42:36,220
<font color="#E5E5E5">production system so we're able to query</font>

1210
00:42:34,000 --> 00:42:38,170
all<font color="#CCCCCC"> eleven of those systems and so our</font>

1211
00:42:36,220 --> 00:42:39,640
scope ends up being three domains<font color="#CCCCCC"> eleven</font>

1212
00:42:38,170 --> 00:42:42,490
workstations<font color="#CCCCCC"> next</font><font color="#E5E5E5"> slide</font>

1213
00:42:39,640 --> 00:42:44,890
and then<font color="#CCCCCC"> for excluded factors</font><font color="#E5E5E5"> we're just</font>

1214
00:42:42,490 --> 00:42:46,479
going to<font color="#E5E5E5"> go through</font><font color="#CCCCCC"> that list of</font><font color="#E5E5E5"> tactics</font>

1215
00:42:44,890 --> 00:42:49,120
techniques kind of that we<font color="#E5E5E5"> came</font><font color="#CCCCCC"> up</font><font color="#E5E5E5"> with</font>

1216
00:42:46,480 --> 00:42:51,010
during<font color="#E5E5E5"> phase one</font><font color="#CCCCCC"> of what</font><font color="#E5E5E5"> Empire</font><font color="#CCCCCC"> employs</font>

1217
00:42:49,120 --> 00:42:52,420
<font color="#E5E5E5">kind of put those in the side document</font>

1218
00:42:51,010 --> 00:42:53,890
that we aren't<font color="#E5E5E5"> currently looking at</font>

1219
00:42:52,420 --> 00:42:56,080
<font color="#E5E5E5">those and maybe we want to</font><font color="#CCCCCC"> revisit them</font>

1220
00:42:53,890 --> 00:42:57,609
going<font color="#E5E5E5"> forward</font><font color="#CCCCCC"> and then kind of document</font>

1221
00:42:56,080 --> 00:42:59,440
that<font color="#E5E5E5"> we're not looking</font><font color="#CCCCCC"> at</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> Linux</font>

1222
00:42:57,610 --> 00:43:01,000
server and as you're<font color="#E5E5E5"> going to see one</font><font color="#CCCCCC"> of</font>

1223
00:42:59,440 --> 00:43:02,500
the<font color="#CCCCCC"> system's didn't allow us to query</font>

1224
00:43:01,000 --> 00:43:04,990
information<font color="#E5E5E5"> from it because we couldn't</font>

1225
00:43:02,500 --> 00:43:07,570
escalate to<font color="#E5E5E5"> system it's kind of strange</font>

1226
00:43:04,990 --> 00:43:09,250
<font color="#E5E5E5">in order to query access tokens you have</font>

1227
00:43:07,570 --> 00:43:10,000
<font color="#E5E5E5">and Kerberos ticket you have</font><font color="#CCCCCC"> to become</font>

1228
00:43:09,250 --> 00:43:12,760
system yourself

1229
00:43:10,000 --> 00:43:14,740
and so we're<font color="#E5E5E5"> impersonating to detect</font>

1230
00:43:12,760 --> 00:43:16,990
impersonation which is kind<font color="#CCCCCC"> of a like a</font>

1231
00:43:14,740 --> 00:43:18,339
meta thing I guess<font color="#E5E5E5"> all right so now we</font>

1232
00:43:16,990 --> 00:43:20,830
<font color="#CCCCCC">have a demo</font><font color="#E5E5E5"> we're going</font><font color="#CCCCCC"> to teach</font><font color="#E5E5E5"> you how</font>

1233
00:43:18,340 --> 00:43:21,160
to<font color="#E5E5E5"> be a faceless man</font><font color="#CCCCCC"> I guess and so here</font>

1234
00:43:20,830 --> 00:43:24,220
we go

1235
00:43:21,160 --> 00:43:25,810
<font color="#E5E5E5">so I have a PowerShell prompt and I'm</font>

1236
00:43:24,220 --> 00:43:28,540
going to<font color="#CCCCCC"> establish a</font><font color="#E5E5E5"> PowerShell remoting</font>

1237
00:43:25,810 --> 00:43:30,340
session with this training<font color="#E5E5E5"> lab that we</font>

1238
00:43:28,540 --> 00:43:31,990
have<font color="#CCCCCC"> so we teach a</font><font color="#E5E5E5"> red team class which</font>

1239
00:43:30,340 --> 00:43:33,820
I thought<font color="#E5E5E5"> was like a perfect perfect</font>

1240
00:43:31,990 --> 00:43:35,859
place to<font color="#E5E5E5"> look for these types of attacks</font>

1241
00:43:33,820 --> 00:43:38,380
<font color="#CCCCCC">and so we're</font><font color="#E5E5E5"> going</font><font color="#CCCCCC"> to establish</font><font color="#E5E5E5"> that</font>

1242
00:43:35,860 --> 00:43:39,670
<font color="#E5E5E5">session and we ended up having</font><font color="#CCCCCC"> eleven</font>

1243
00:43:38,380 --> 00:43:42,070
sessions<font color="#E5E5E5"> eleven PowerShell remoting</font>

1244
00:43:39,670 --> 00:43:43,540
sessions and maybe this<font color="#E5E5E5"> isn't how you</font>

1245
00:43:42,070 --> 00:43:45,220
want to<font color="#CCCCCC"> collect the data it just</font><font color="#E5E5E5"> is the</font>

1246
00:43:43,540 --> 00:43:46,540
easiest<font color="#E5E5E5"> for</font><font color="#CCCCCC"> me so you could</font><font color="#E5E5E5"> determine</font>

1247
00:43:45,220 --> 00:43:48,100
<font color="#E5E5E5">what the best</font><font color="#CCCCCC"> way to</font><font color="#E5E5E5"> collect this data</font>

1248
00:43:46,540 --> 00:43:50,320
would be<font color="#E5E5E5"> for you</font>

1249
00:43:48,100 --> 00:43:51,700
<font color="#CCCCCC">all right so PowerShell has</font><font color="#E5E5E5"> a command</font>

1250
00:43:50,320 --> 00:43:53,020
called<font color="#E5E5E5"> invoke command which</font><font color="#CCCCCC"> allows you</font>

1251
00:43:51,700 --> 00:43:55,390
<font color="#E5E5E5">to take a PowerShell</font><font color="#CCCCCC"> remoting session</font>

1252
00:43:53,020 --> 00:43:57,190
<font color="#E5E5E5">and then execute arbitrary code or</font>

1253
00:43:55,390 --> 00:43:58,960
arbitrary scripts<font color="#E5E5E5"> against those sessions</font>

1254
00:43:57,190 --> 00:44:01,360
<font color="#E5E5E5">and so we're going to run this get</font>

1255
00:43:58,960 --> 00:44:03,250
access token<font color="#E5E5E5"> script</font><font color="#CCCCCC"> and we're</font><font color="#E5E5E5"> going to</font>

1256
00:44:01,360 --> 00:44:06,190
<font color="#E5E5E5">store that</font><font color="#CCCCCC"> in a dollar token variable</font>

1257
00:44:03,250 --> 00:44:07,270
<font color="#E5E5E5">and so here you</font><font color="#CCCCCC"> see</font><font color="#E5E5E5"> that one system said</font>

1258
00:44:06,190 --> 00:44:10,120
hey you're not<font color="#E5E5E5"> able to impersonate</font>

1259
00:44:07,270 --> 00:44:12,100
<font color="#CCCCCC">anti-authority system and so we're going</font>

1260
00:44:10,120 --> 00:44:16,270
<font color="#E5E5E5">to get some subset of information from</font>

1261
00:44:12,100 --> 00:44:17,410
<font color="#CCCCCC">that from that system alright</font><font color="#E5E5E5"> and so we</font>

1262
00:44:16,270 --> 00:44:18,820
<font color="#CCCCCC">ended up</font><font color="#E5E5E5"> with six hundred</font><font color="#CCCCCC"> and thirty</font>

1263
00:44:17,410 --> 00:44:20,200
<font color="#E5E5E5">three different tokens that we're</font>

1264
00:44:18,820 --> 00:44:21,880
<font color="#CCCCCC">dealing with</font><font color="#E5E5E5"> right and so we got to</font>

1265
00:44:20,200 --> 00:44:23,649
<font color="#E5E5E5">figure out how we're going to determine</font>

1266
00:44:21,880 --> 00:44:25,330
<font color="#E5E5E5">where</font><font color="#CCCCCC"> the bad tokens are within</font><font color="#E5E5E5"> that</font>

1267
00:44:23,650 --> 00:44:26,320
again we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to do the same thing</font>

1268
00:44:25,330 --> 00:44:27,790
but this<font color="#CCCCCC"> time we're going to collect</font>

1269
00:44:26,320 --> 00:44:29,170
Kerberos ticket granting ticket from

1270
00:44:27,790 --> 00:44:31,840
<font color="#E5E5E5">across those</font><font color="#CCCCCC"> eleven</font>

1271
00:44:29,170 --> 00:44:33,280
and so we have a<font color="#CCCCCC"> gate Kerberos ticket</font>

1272
00:44:31,840 --> 00:44:37,810
granting ticket script that<font color="#CCCCCC"> will run</font>

1273
00:44:33,280 --> 00:44:39,910
<font color="#E5E5E5">against them and that</font><font color="#CCCCCC"> comes</font><font color="#E5E5E5"> back same</font>

1274
00:44:37,810 --> 00:44:42,130
situation with<font color="#E5E5E5"> the system token there</font>

1275
00:44:39,910 --> 00:44:45,040
and so<font color="#E5E5E5"> that one system</font><font color="#CCCCCC"> we don't</font><font color="#E5E5E5"> have all</font>

1276
00:44:42,130 --> 00:44:48,160
<font color="#CCCCCC">that we only have a subset of the</font>

1277
00:44:45,040 --> 00:44:53,170
tickets<font color="#E5E5E5"> and tokens and so we end up</font><font color="#CCCCCC"> with</font>

1278
00:44:48,160 --> 00:44:54,609
<font color="#CCCCCC">76 tickets across</font><font color="#E5E5E5"> 11 systems</font><font color="#CCCCCC"> all right</font>

1279
00:44:53,170 --> 00:44:55,990
so now let's let's take<font color="#CCCCCC"> a look at what a</font>

1280
00:44:54,610 --> 00:44:58,150
token looks like I kind of show this

1281
00:44:55,990 --> 00:45:00,910
already<font color="#E5E5E5"> we have like the token for the</font>

1282
00:44:58,150 --> 00:45:02,980
<font color="#E5E5E5">con host process just kind</font><font color="#CCCCCC"> of as an</font>

1283
00:45:00,910 --> 00:45:06,339
example<font color="#E5E5E5"> it's running as this MS sequel</font>

1284
00:45:02,980 --> 00:45:08,470
<font color="#E5E5E5">FD launcher user and we see that the</font>

1285
00:45:06,340 --> 00:45:10,000
primary<font color="#CCCCCC"> tows this is a</font><font color="#E5E5E5"> primary token so</font>

1286
00:45:08,470 --> 00:45:12,459
we wanted to<font color="#E5E5E5"> expect that field to be any</font>

1287
00:45:10,000 --> 00:45:16,300
different<font color="#E5E5E5"> but how can we start whittling</font>

1288
00:45:12,460 --> 00:45:17,580
down on<font color="#CCCCCC"> these 633 different results</font>

1289
00:45:16,300 --> 00:45:19,900
right that's that's too much information

1290
00:45:17,580 --> 00:45:21,730
<font color="#CCCCCC">imagine if you ran it across thousands</font>

1291
00:45:19,900 --> 00:45:24,480
of computers<font color="#E5E5E5"> and you know if it's just</font>

1292
00:45:21,730 --> 00:45:27,190
<font color="#E5E5E5">going to be an egregious amount and so</font>

1293
00:45:24,480 --> 00:45:29,350
first things first we can exclude all

1294
00:45:27,190 --> 00:45:31,390
primary tokens by definition a primary

1295
00:45:29,350 --> 00:45:33,190
token is not an impersonation token and

1296
00:45:31,390 --> 00:45:34,779
thus<font color="#E5E5E5"> we're not worried about them in the</font>

1297
00:45:33,190 --> 00:45:38,290
context of searching for<font color="#CCCCCC"> token</font>

1298
00:45:34,780 --> 00:45:39,580
impersonation and<font color="#CCCCCC"> so PowerShell has this</font>

1299
00:45:38,290 --> 00:45:41,259
<font color="#E5E5E5">filtering commandlets called where</font>

1300
00:45:39,580 --> 00:45:43,750
object which allows you<font color="#CCCCCC"> to filter</font><font color="#E5E5E5"> out</font>

1301
00:45:41,260 --> 00:45:46,720
<font color="#E5E5E5">different objects based on some you know</font>

1302
00:45:43,750 --> 00:45:48,850
some scripts<font color="#CCCCCC"> so I'm saying where the</font>

1303
00:45:46,720 --> 00:45:52,870
token<font color="#E5E5E5"> type is not token in token primary</font>

1304
00:45:48,850 --> 00:45:56,259
so that reduces it down to 104 so we've

1305
00:45:52,870 --> 00:45:59,170
reduced<font color="#CCCCCC"> by you know</font><font color="#E5E5E5"> 80 or 85 percent or</font>

1306
00:45:56,260 --> 00:46:01,660
so and so now<font color="#CCCCCC"> let's see</font><font color="#E5E5E5"> what</font><font color="#CCCCCC"> else we</font>

1307
00:45:59,170 --> 00:46:04,240
could do so now I want to<font color="#E5E5E5"> look where the</font>

1308
00:46:01,660 --> 00:46:06,460
primary<font color="#E5E5E5"> the user account for</font><font color="#CCCCCC"> the primary</font>

1309
00:46:04,240 --> 00:46:08,229
token is not the same as the user

1310
00:46:06,460 --> 00:46:09,970
account for<font color="#E5E5E5"> the impersonation token</font>

1311
00:46:08,230 --> 00:46:11,410
right<font color="#E5E5E5"> and so there are situations</font><font color="#CCCCCC"> too</font>

1312
00:46:09,970 --> 00:46:12,910
where impersonation is used to

1313
00:46:11,410 --> 00:46:15,040
impersonate<font color="#E5E5E5"> the same user account</font>

1314
00:46:12,910 --> 00:46:17,620
because you<font color="#E5E5E5"> want to either add or</font><font color="#CCCCCC"> remove</font>

1315
00:46:15,040 --> 00:46:19,690
privileges from<font color="#E5E5E5"> that user</font><font color="#CCCCCC"> but in this</font>

1316
00:46:17,620 --> 00:46:21,009
case we go down to 49 so now we<font color="#E5E5E5"> could</font>

1317
00:46:19,690 --> 00:46:24,520
<font color="#E5E5E5">start maybe we could deal with that</font><font color="#CCCCCC"> a</font>

1318
00:46:21,010 --> 00:46:26,980
<font color="#E5E5E5">little bit better sorry for my slow</font>

1319
00:46:24,520 --> 00:46:28,960
typing<font color="#CCCCCC"> here but there's what it</font><font color="#E5E5E5"> is I</font>

1320
00:46:26,980 --> 00:46:30,730
<font color="#E5E5E5">guess and so again we're going to query</font>

1321
00:46:28,960 --> 00:46:33,310
the same exact thing<font color="#CCCCCC"> but this time I</font>

1322
00:46:30,730 --> 00:46:37,090
want to see the actual context<font color="#E5E5E5"> of</font><font color="#CCCCCC"> those</font>

1323
00:46:33,310 --> 00:46:40,390
49 results and so again<font color="#E5E5E5"> looking for non</font>

1324
00:46:37,090 --> 00:46:42,310
<font color="#E5E5E5">non primary tokens where a primary user</font>

1325
00:46:40,390 --> 00:46:43,779
name and user name do not<font color="#E5E5E5"> matter</font>

1326
00:46:42,310 --> 00:46:45,880
and then we're<font color="#CCCCCC"> going to look at what</font>

1327
00:46:43,780 --> 00:46:49,000
process<font color="#CCCCCC"> what</font><font color="#E5E5E5"> process do these tokens</font>

1328
00:46:45,880 --> 00:46:50,740
<font color="#E5E5E5">belong to what is the</font><font color="#CCCCCC"> process ID what is</font>

1329
00:46:49,000 --> 00:46:53,110
the primary user accounts of what was

1330
00:46:50,740 --> 00:46:55,390
what<font color="#E5E5E5"> is that was that</font><font color="#CCCCCC"> process spawned as</font>

1331
00:46:53,110 --> 00:46:57,040
and then what is the user name<font color="#E5E5E5"> so who is</font>

1332
00:46:55,390 --> 00:46:58,390
it impersonating<font color="#CCCCCC"> and then we'll look at</font>

1333
00:46:57,040 --> 00:47:00,279
<font color="#CCCCCC">the</font><font color="#E5E5E5"> computer that it's associated with</font>

1334
00:46:58,390 --> 00:47:02,500
<font color="#E5E5E5">and if you notice and of course this is</font>

1335
00:47:00,280 --> 00:47:04,720
a lab so<font color="#E5E5E5"> your your mileage may</font><font color="#CCCCCC"> vary a</font>

1336
00:47:02,500 --> 00:47:06,430
<font color="#E5E5E5">little bit every</font><font color="#CCCCCC"> single</font><font color="#E5E5E5"> process is going</font>

1337
00:47:04,720 --> 00:47:08,439
to be SVC host which<font color="#CCCCCC"> is kind of</font><font color="#E5E5E5"> what we</font>

1338
00:47:06,430 --> 00:47:11,020
expect<font color="#CCCCCC"> that does not</font><font color="#E5E5E5"> mean that because</font>

1339
00:47:08,440 --> 00:47:13,240
<font color="#CCCCCC">it's SVC host</font><font color="#E5E5E5"> it's good it just means</font>

1340
00:47:11,020 --> 00:47:15,970
that if it's not SVC<font color="#E5E5E5"> host in this case</font>

1341
00:47:13,240 --> 00:47:18,160
we might be<font color="#E5E5E5"> interested in it</font><font color="#CCCCCC"> and what we</font>

1342
00:47:15,970 --> 00:47:20,649
<font color="#E5E5E5">noticed is</font><font color="#CCCCCC"> that there's basically every</font>

1343
00:47:18,160 --> 00:47:22,540
system kind of has one<font color="#E5E5E5"> one process</font>

1344
00:47:20,650 --> 00:47:25,000
that's impersonating<font color="#E5E5E5"> what looks like a</font>

1345
00:47:22,540 --> 00:47:26,830
<font color="#CCCCCC">DA</font><font color="#E5E5E5"> so it's going from system to domain</font>

1346
00:47:25,000 --> 00:47:29,680
admin so we might want<font color="#CCCCCC"> to investigate</font>

1347
00:47:26,830 --> 00:47:31,180
<font color="#E5E5E5">that</font><font color="#CCCCCC"> and so kind</font><font color="#E5E5E5"> of check it out we're</font>

1348
00:47:29,680 --> 00:47:34,540
going<font color="#E5E5E5"> to go ahead and look at this</font>

1349
00:47:31,180 --> 00:47:39,040
<font color="#CCCCCC">particular process here</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> it's on 10.1</font>

1350
00:47:34,540 --> 00:47:41,170
<font color="#CCCCCC">31 52 and it's process ID 920</font><font color="#E5E5E5"> and so</font>

1351
00:47:39,040 --> 00:47:42,430
<font color="#CCCCCC">PowerShell remoting is awesome in my</font>

1352
00:47:41,170 --> 00:47:44,260
<font color="#CCCCCC">opinion because</font><font color="#E5E5E5"> it allows you to get</font>

1353
00:47:42,430 --> 00:47:46,810
kind of like<font color="#E5E5E5"> a remote shell on a system</font>

1354
00:47:44,260 --> 00:47:49,510
and so what we're going<font color="#E5E5E5"> to do is query</font>

1355
00:47:46,810 --> 00:47:51,779
<font color="#E5E5E5">use enter PS session to enter a</font>

1356
00:47:49,510 --> 00:47:57,580
<font color="#CCCCCC">powershell get a PowerShell shell on</font>

1357
00:47:51,780 --> 00:47:58,750
that that<font color="#CCCCCC"> 152 system</font><font color="#E5E5E5"> and so you'll</font><font color="#CCCCCC"> see</font>

1358
00:47:57,580 --> 00:48:00,370
<font color="#E5E5E5">that you'll notice that the prompt is</font>

1359
00:47:58,750 --> 00:48:03,430
<font color="#E5E5E5">going to change to</font><font color="#CCCCCC"> indicate that we are</font>

1360
00:48:00,370 --> 00:48:05,830
now running<font color="#E5E5E5"> on a remote</font><font color="#CCCCCC"> system</font><font color="#E5E5E5"> and then</font>

1361
00:48:03,430 --> 00:48:07,629
we could<font color="#E5E5E5"> query I'm going to just SVC</font>

1362
00:48:05,830 --> 00:48:10,180
host as a hosting process which has a

1363
00:48:07,630 --> 00:48:11,590
lot of<font color="#E5E5E5"> services that belong to</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> and so</font>

1364
00:48:10,180 --> 00:48:14,319
let's let's kind<font color="#CCCCCC"> of check</font><font color="#E5E5E5"> out what</font>

1365
00:48:11,590 --> 00:48:17,650
<font color="#E5E5E5">services there</font><font color="#CCCCCC"> are so</font><font color="#E5E5E5"> we see like I key</font>

1366
00:48:14,320 --> 00:48:21,010
<font color="#E5E5E5">I extension XE or something like that</font>

1367
00:48:17,650 --> 00:48:22,480
IP help service<font color="#E5E5E5"> land man server those</font>

1368
00:48:21,010 --> 00:48:25,090
those<font color="#CCCCCC"> are the types of</font><font color="#E5E5E5"> things that are</font>

1369
00:48:22,480 --> 00:48:27,640
<font color="#E5E5E5">running in within</font><font color="#CCCCCC"> that particular SBC</font>

1370
00:48:25,090 --> 00:48:30,190
host<font color="#E5E5E5"> and that</font><font color="#CCCCCC"> may help</font><font color="#E5E5E5"> us identify if we</font>

1371
00:48:27,640 --> 00:48:32,440
do some research<font color="#CCCCCC"> on</font><font color="#E5E5E5"> those why it's using</font>

1372
00:48:30,190 --> 00:48:33,730
the domain admin account<font color="#CCCCCC"> but because we</font>

1373
00:48:32,440 --> 00:48:35,560
see that<font color="#CCCCCC"> this</font><font color="#E5E5E5"> is kind of a uniform</font>

1374
00:48:33,730 --> 00:48:37,690
pattern across all of<font color="#E5E5E5"> our systems maybe</font>

1375
00:48:35,560 --> 00:48:39,790
we want<font color="#E5E5E5"> to go see and go check and</font><font color="#CCCCCC"> make</font>

1376
00:48:37,690 --> 00:48:41,650
sure that that actual like kind<font color="#E5E5E5"> of</font>

1377
00:48:39,790 --> 00:48:43,930
activity is really<font color="#E5E5E5"> normal across all the</font>

1378
00:48:41,650 --> 00:48:46,000
<font color="#E5E5E5">systems and not coincidental and so</font>

1379
00:48:43,930 --> 00:48:48,879
again we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to do the same thing</font>

1380
00:48:46,000 --> 00:48:51,870
but on<font color="#CCCCCC"> a separate system and we're going</font>

1381
00:48:48,880 --> 00:48:56,110
to<font color="#E5E5E5"> enter</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> session</font><font color="#CCCCCC"> again on session ID</font>

1382
00:48:51,870 --> 00:48:58,029
<font color="#CCCCCC">24 and just verify that that's kind</font><font color="#E5E5E5"> of</font>

1383
00:48:56,110 --> 00:48:59,860
normal activity in real<font color="#E5E5E5"> life outside of</font>

1384
00:48:58,030 --> 00:49:01,540
a<font color="#CCCCCC"> nine-minute demo you would go and like</font>

1385
00:48:59,860 --> 00:49:03,270
<font color="#CCCCCC">actually</font><font color="#E5E5E5"> look up what those services are</font>

1386
00:49:01,540 --> 00:49:04,930
and make<font color="#E5E5E5"> sure that that type of</font>

1387
00:49:03,270 --> 00:49:06,430
impersonation is something that you

1388
00:49:04,930 --> 00:49:11,230
would<font color="#CCCCCC"> expect right</font><font color="#E5E5E5"> that's kind of the</font>

1389
00:49:06,430 --> 00:49:13,509
general idea<font color="#CCCCCC"> so here we're seeing 780 we</font>

1390
00:49:11,230 --> 00:49:15,520
see<font color="#E5E5E5"> that it's the same</font><font color="#CCCCCC"> exact SVC host</font>

1391
00:49:13,510 --> 00:49:17,320
hosting the same exact services<font color="#E5E5E5"> and so</font>

1392
00:49:15,520 --> 00:49:20,560
maybe<font color="#E5E5E5"> this is something</font><font color="#CCCCCC"> that's normal in</font>

1393
00:49:17,320 --> 00:49:23,890
<font color="#E5E5E5">our environment and so we kind of leave</font>

1394
00:49:20,560 --> 00:49:26,290
the access token<font color="#CCCCCC"> from</font><font color="#E5E5E5"> the perspective of</font>

1395
00:49:23,890 --> 00:49:27,640
you<font color="#CCCCCC"> know all of these processes</font><font color="#E5E5E5"> on every</font>

1396
00:49:26,290 --> 00:49:29,650
single<font color="#E5E5E5"> system look</font><font color="#CCCCCC"> like they're kind of</font>

1397
00:49:27,640 --> 00:49:30,759
<font color="#CCCCCC">doing the same thing</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> would want to</font>

1398
00:49:29,650 --> 00:49:32,290
<font color="#E5E5E5">do a little bit more checking but</font>

1399
00:49:30,760 --> 00:49:35,380
generally<font color="#CCCCCC"> speaking I think</font><font color="#E5E5E5"> it's</font>

1400
00:49:32,290 --> 00:49:37,509
relatively<font color="#E5E5E5"> safe to say that there is no</font>

1401
00:49:35,380 --> 00:49:39,580
like malicious<font color="#CCCCCC"> access token</font>

1402
00:49:37,510 --> 00:49:41,800
impersonation occurring here<font color="#E5E5E5"> so let's</font>

1403
00:49:39,580 --> 00:49:46,270
let's<font color="#CCCCCC"> look for the other</font><font color="#E5E5E5"> attack</font>

1404
00:49:41,800 --> 00:49:48,280
technique that we're interested<font color="#E5E5E5"> in</font><font color="#CCCCCC"> all</font>

1405
00:49:46,270 --> 00:49:49,540
right<font color="#E5E5E5"> so let's query those Kerberos</font>

1406
00:49:48,280 --> 00:49:51,390
tickets that we collected remember

1407
00:49:49,540 --> 00:49:54,520
there's I think<font color="#CCCCCC"> there's like 76</font><font color="#E5E5E5"> of them</font>

1408
00:49:51,390 --> 00:49:55,990
<font color="#CCCCCC">and so we could start</font><font color="#E5E5E5"> to look at those</font>

1409
00:49:54,520 --> 00:49:58,300
and see if<font color="#E5E5E5"> there's any evidence of that</font>

1410
00:49:55,990 --> 00:50:00,339
<font color="#E5E5E5">make and impersonate kind of attack</font>

1411
00:49:58,300 --> 00:50:02,920
<font color="#CCCCCC">right so make make token</font><font color="#E5E5E5"> and impersonate</font>

1412
00:50:00,340 --> 00:50:04,090
<font color="#E5E5E5">and so the first thing</font><font color="#CCCCCC"> that we're going</font>

1413
00:50:02,920 --> 00:50:07,120
<font color="#E5E5E5">to do is we're going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> start whittling</font>

1414
00:50:04,090 --> 00:50:08,860
down<font color="#E5E5E5"> on those 76 tickets by looking for</font>

1415
00:50:07,120 --> 00:50:10,690
anything<font color="#E5E5E5"> where the session</font><font color="#CCCCCC"> username does</font>

1416
00:50:08,860 --> 00:50:13,870
<font color="#E5E5E5">not equal the client name right and</font>

1417
00:50:10,690 --> 00:50:15,490
again<font color="#CCCCCC"> I said</font><font color="#E5E5E5"> this was a training lab</font>

1418
00:50:13,870 --> 00:50:17,859
from<font color="#E5E5E5"> a</font><font color="#CCCCCC"> red team class that we taught and</font>

1419
00:50:15,490 --> 00:50:20,680
<font color="#E5E5E5">so this is going to come back and have a</font>

1420
00:50:17,860 --> 00:50:22,300
ton of results that<font color="#CCCCCC"> are evidence of like</font>

1421
00:50:20,680 --> 00:50:24,810
malicious<font color="#CCCCCC"> stuff not necessarily</font>

1422
00:50:22,300 --> 00:50:29,080
specifically<font color="#E5E5E5"> what we're looking for</font><font color="#CCCCCC"> and</font>

1423
00:50:24,810 --> 00:50:30,430
so we saw we whittled down from<font color="#E5E5E5"> 76 to 26</font>

1424
00:50:29,080 --> 00:50:31,990
<font color="#E5E5E5">and now we're going to look at the</font>

1425
00:50:30,430 --> 00:50:35,379
<font color="#E5E5E5">actual context here and we're going to</font>

1426
00:50:31,990 --> 00:50:38,140
<font color="#E5E5E5">look at I think</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> session ID or a</font>

1427
00:50:35,380 --> 00:50:39,910
session logon ID the username of<font color="#E5E5E5"> the</font>

1428
00:50:38,140 --> 00:50:41,470
<font color="#E5E5E5">like who logged in</font><font color="#CCCCCC"> now on</font><font color="#E5E5E5"> the session</font>

1429
00:50:39,910 --> 00:50:45,700
<font color="#E5E5E5">and then some information</font><font color="#CCCCCC"> about the</font>

1430
00:50:41,470 --> 00:50:47,919
ticket<font color="#E5E5E5"> itself and of course the computer</font>

1431
00:50:45,700 --> 00:50:51,040
<font color="#E5E5E5">that that ticket is is on so we can</font>

1432
00:50:47,920 --> 00:50:52,630
investigate further<font color="#CCCCCC"> and</font><font color="#E5E5E5"> so I think in</font>

1433
00:50:51,040 --> 00:50:54,160
<font color="#E5E5E5">going through this every single one of</font>

1434
00:50:52,630 --> 00:50:57,070
these happen<font color="#CCCCCC"> to</font><font color="#E5E5E5"> be malicious kind of in</font>

1435
00:50:54,160 --> 00:50:58,839
their own<font color="#E5E5E5"> right the the ones that we're</font>

1436
00:50:57,070 --> 00:51:01,030
kind of focusing<font color="#E5E5E5"> on are the ones at</font><font color="#CCCCCC"> the</font>

1437
00:50:58,840 --> 00:51:03,540
<font color="#CCCCCC">top the a Robin's da</font><font color="#E5E5E5"> to Matt Nelson da</font>

1438
00:51:01,030 --> 00:51:06,190
<font color="#E5E5E5">but for</font><font color="#CCCCCC"> instance we see that</font><font color="#E5E5E5"> John user</font>

1439
00:51:03,540 --> 00:51:08,560
<font color="#CCCCCC">kind of becoming Mike right there which</font>

1440
00:51:06,190 --> 00:51:10,000
is<font color="#E5E5E5"> pretty</font><font color="#CCCCCC"> suspicious we see John</font><font color="#E5E5E5"> user</font>

1441
00:51:08,560 --> 00:51:12,130
becoming sequel service

1442
00:51:10,000 --> 00:51:16,000
which that's that's extremely strange in

1443
00:51:12,130 --> 00:51:18,370
my opinion<font color="#CCCCCC"> but here we're</font><font color="#E5E5E5"> seeing like</font><font color="#CCCCCC"> it</font>

1444
00:51:16,000 --> 00:51:21,730
<font color="#CCCCCC">Andy</font><font color="#E5E5E5"> Robbins da or a Robbins da becoming</font>

1445
00:51:18,370 --> 00:51:24,069
an<font color="#E5E5E5"> M Nelson da account</font><font color="#CCCCCC"> and maybe doing</font>

1446
00:51:21,730 --> 00:51:27,100
something<font color="#CCCCCC"> strange there and so let's go</font>

1447
00:51:24,070 --> 00:51:28,510
<font color="#CCCCCC">check that out one of our</font><font color="#E5E5E5"> colleagues</font><font color="#CCCCCC"> Lee</font>

1448
00:51:27,100 --> 00:51:31,839
<font color="#CCCCCC">Christianson wrote a script that</font><font color="#E5E5E5"> allows</font>

1449
00:51:28,510 --> 00:51:34,510
<font color="#E5E5E5">you to query query a list of processes</font>

1450
00:51:31,840 --> 00:51:36,760
<font color="#E5E5E5">based on the logon session so given a</font>

1451
00:51:34,510 --> 00:51:39,100
logon session ID you're able to<font color="#E5E5E5"> say what</font>

1452
00:51:36,760 --> 00:51:40,900
processes belong to this logon session

1453
00:51:39,100 --> 00:51:43,390
and so we could go<font color="#CCCCCC"> in and</font><font color="#E5E5E5"> start kind of</font>

1454
00:51:40,900 --> 00:51:46,030
<font color="#E5E5E5">querying specific processes within a</font>

1455
00:51:43,390 --> 00:51:47,799
logon session<font color="#E5E5E5"> to determine what what the</font>

1456
00:51:46,030 --> 00:51:48,850
context of that logon session is and

1457
00:51:47,800 --> 00:51:51,690
that helps us<font color="#CCCCCC"> determine whether</font>

1458
00:51:48,850 --> 00:51:54,339
something malicious<font color="#E5E5E5"> is happening and so</font>

1459
00:51:51,690 --> 00:51:56,560
<font color="#E5E5E5">here I've run that I've made sure that</font>

1460
00:51:54,340 --> 00:51:58,150
that script is available<font color="#CCCCCC"> within my power</font>

1461
00:51:56,560 --> 00:51:59,380
shell remoting session and now we're

1462
00:51:58,150 --> 00:52:01,750
going to go ahead and enter<font color="#E5E5E5"> that session</font>

1463
00:51:59,380 --> 00:52:07,780
<font color="#CCCCCC">and try to investigate some of</font><font color="#E5E5E5"> these</font>

1464
00:52:01,750 --> 00:52:08,950
kind of weird<font color="#E5E5E5"> weird Kerberos tickets all</font>

1465
00:52:07,780 --> 00:52:10,690
right and our prompt is going to change

1466
00:52:08,950 --> 00:52:12,520
indicate we're on that remote system and

1467
00:52:10,690 --> 00:52:15,270
now I could do get logon session

1468
00:52:12,520 --> 00:52:17,710
processes<font color="#CCCCCC"> pass it a logon session ID</font>

1469
00:52:15,270 --> 00:52:19,240
<font color="#CCCCCC">this is some pretty old activity so not</font>

1470
00:52:17,710 --> 00:52:20,350
all<font color="#E5E5E5"> of these are</font><font color="#CCCCCC"> going to have</font><font color="#E5E5E5"> processes</font>

1471
00:52:19,240 --> 00:52:22,180
associated<font color="#E5E5E5"> with them they're kind</font><font color="#CCCCCC"> of</font>

1472
00:52:20,350 --> 00:52:23,170
like dangling<font color="#E5E5E5"> logon sessions and so</font>

1473
00:52:22,180 --> 00:52:24,580
we'll kind<font color="#E5E5E5"> of work through them</font>

1474
00:52:23,170 --> 00:52:29,020
iteratively until we find something

1475
00:52:24,580 --> 00:52:30,910
<font color="#E5E5E5">that's that's</font><font color="#CCCCCC"> interesting for us</font><font color="#E5E5E5"> all</font>

1476
00:52:29,020 --> 00:52:32,650
<font color="#E5E5E5">right so the first one came</font><font color="#CCCCCC"> back but</font>

1477
00:52:30,910 --> 00:52:35,370
there's no processes associated<font color="#E5E5E5"> with</font>

1478
00:52:32,650 --> 00:52:37,480
that logon session second one<font color="#E5E5E5"> same thing</font>

1479
00:52:35,370 --> 00:52:40,930
<font color="#E5E5E5">but the third one I think is where we</font>

1480
00:52:37,480 --> 00:52:43,060
<font color="#E5E5E5">kind of strike gold and anybody</font><font color="#CCCCCC"> that has</font>

1481
00:52:40,930 --> 00:52:45,850
<font color="#CCCCCC">use PowerShell</font><font color="#E5E5E5"> Empire might recognize</font>

1482
00:52:43,060 --> 00:52:48,490
this<font color="#E5E5E5"> this is PowerShell with an encoded</font>

1483
00:52:45,850 --> 00:52:51,279
command<font color="#CCCCCC"> and this is like a base64 blob</font>

1484
00:52:48,490 --> 00:52:53,970
of like code so it could<font color="#E5E5E5"> be</font><font color="#CCCCCC"> shellcode it</font>

1485
00:52:51,280 --> 00:52:57,070
could be anything<font color="#CCCCCC"> and generally</font><font color="#E5E5E5"> speaking</font>

1486
00:52:53,970 --> 00:52:58,600
<font color="#E5E5E5">this</font><font color="#CCCCCC"> is bad right and so</font><font color="#E5E5E5"> you could go</font>

1487
00:52:57,070 --> 00:53:00,610
back and<font color="#CCCCCC"> you can actually like decode</font>

1488
00:52:58,600 --> 00:53:02,770
that<font color="#E5E5E5"> blob you could do it in PowerShell</font>

1489
00:53:00,610 --> 00:53:04,720
you go online to<font color="#E5E5E5"> find some</font><font color="#CCCCCC"> basics for</font>

1490
00:53:02,770 --> 00:53:06,550
<font color="#CCCCCC">decoder or whatever</font><font color="#E5E5E5"> whatever you fancy</font>

1491
00:53:04,720 --> 00:53:08,700
<font color="#E5E5E5">and you can figure out what's going on</font>

1492
00:53:06,550 --> 00:53:12,760
there<font color="#E5E5E5"> turns out that ended up being</font>

1493
00:53:08,700 --> 00:53:14,350
meterpreter payload and so remember we

1494
00:53:12,760 --> 00:53:16,390
<font color="#E5E5E5">were initially focused on PowerShell</font>

1495
00:53:14,350 --> 00:53:18,310
<font color="#E5E5E5">Empire and we eventually came back to</font>

1496
00:53:16,390 --> 00:53:19,629
finding meterpreter which is a different

1497
00:53:18,310 --> 00:53:22,990
<font color="#CCCCCC">implementation of kind of</font><font color="#E5E5E5"> the same</font>

1498
00:53:19,630 --> 00:53:23,800
attack so that that in my mind<font color="#E5E5E5"> kind of</font>

1499
00:53:22,990 --> 00:53:26,319
justifies

1500
00:53:23,800 --> 00:53:28,540
this process a<font color="#E5E5E5"> little bit</font><font color="#CCCCCC"> all right so</font>

1501
00:53:26,320 --> 00:53:30,670
at<font color="#E5E5E5"> this point we've unmasked the the</font>

1502
00:53:28,540 --> 00:53:31,840
masked man I guess after<font color="#CCCCCC"> they if you</font>

1503
00:53:30,670 --> 00:53:34,480
know the context of that picture after

1504
00:53:31,840 --> 00:53:36,040
<font color="#E5E5E5">they killed everybody</font><font color="#CCCCCC"> but that's pretty</font>

1505
00:53:34,480 --> 00:53:38,350
<font color="#E5E5E5">much our presentation</font><font color="#CCCCCC"> we're happy to</font>

1506
00:53:36,040 --> 00:53:41,440
take questions at this<font color="#CCCCCC"> point if anybody</font>

1507
00:53:38,350 --> 00:53:49,000
has has anything for us<font color="#E5E5E5"> so thank you for</font>

1508
00:53:41,440 --> 00:53:50,260
coming<font color="#CCCCCC"> out definitely</font><font color="#E5E5E5"> thank you and if</font>

1509
00:53:49,000 --> 00:53:51,580
you have<font color="#CCCCCC"> a question go</font><font color="#E5E5E5"> ahead and</font><font color="#CCCCCC"> raise</font>

1510
00:53:50,260 --> 00:53:53,470
<font color="#E5E5E5">your</font><font color="#CCCCCC"> hand and they have a microphone</font>

1511
00:53:51,580 --> 00:53:55,480
<font color="#CCCCCC">that they're going</font><font color="#E5E5E5"> to bring</font><font color="#CCCCCC"> around and</font>

1512
00:53:53,470 --> 00:54:00,819
please keep your<font color="#CCCCCC"> question until</font><font color="#E5E5E5"> you get</font>

1513
00:53:55,480 --> 00:54:02,490
the microphone<font color="#E5E5E5"> all</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> yep thank you</font>

1514
00:54:00,820 --> 00:54:06,930
<font color="#E5E5E5">very much</font><font color="#CCCCCC"> thanks</font><font color="#E5E5E5"> guys</font><font color="#CCCCCC"> Thanks</font>

1515
00:54:02,490 --> 00:54:06,930
[Applause]

