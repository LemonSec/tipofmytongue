1
00:00:00,910 --> 00:00:09,200
[Music]

2
00:00:09,200 --> 00:00:12,320
hi welcome everybody to my talk apts go

3
00:00:12,320 --> 00:00:14,639
tell working

4
00:00:14,639 --> 00:00:17,119
first of all usual disclaimer we do a

5
00:00:17,119 --> 00:00:19,279
lot of case work so

6
00:00:19,279 --> 00:00:20,000
the

7
00:00:20,000 --> 00:00:22,400
work that i'm representing here is the

8
00:00:22,400 --> 00:00:24,480
work from many helping hands

9
00:00:24,480 --> 00:00:26,720
incident response consultants

10
00:00:26,720 --> 00:00:29,039
threat intel analysts and malware

11
00:00:29,039 --> 00:00:30,880
reverse engineering is kind of the

12
00:00:30,880 --> 00:00:33,360
collective of all the case work we've

13
00:00:33,360 --> 00:00:37,040
been doing for our customers

14
00:00:37,040 --> 00:00:39,680
a few words about myself bart

15
00:00:39,680 --> 00:00:40,559
based

16
00:00:40,559 --> 00:00:43,520
near near brussels in belgium

17
00:00:43,520 --> 00:00:45,840
um doing incident response for uh for a

18
00:00:45,840 --> 00:00:47,760
living for for mandiant

19
00:00:47,760 --> 00:00:50,719
and um yeah i actually started my career

20
00:00:50,719 --> 00:00:52,320
in um

21
00:00:52,320 --> 00:00:55,680
in the early 2000s so when you had a

22
00:00:55,680 --> 00:00:58,160
computer security problem in the in the

23
00:00:58,160 --> 00:01:00,399
90s in the previous century

24
00:01:00,399 --> 00:01:03,440
typically um the network firewall was

25
00:01:03,440 --> 00:01:05,600
the solution and so that's also where i

26
00:01:05,600 --> 00:01:07,840
started my career deploying network

27
00:01:07,840 --> 00:01:11,280
firewalls and then vpn devices

28
00:01:11,280 --> 00:01:14,080
um but i'm focusing on um digital

29
00:01:14,080 --> 00:01:16,640
forensics and more recently on incident

30
00:01:16,640 --> 00:01:20,560
response since 2005.

31
00:01:20,799 --> 00:01:23,040
first of all to kind of

32
00:01:23,040 --> 00:01:26,320
start with a little bit of controversy

33
00:01:26,320 --> 00:01:27,600
is

34
00:01:27,600 --> 00:01:30,640
when we're talking about vpn compromises

35
00:01:30,640 --> 00:01:33,119
people immediately jump to conclusions

36
00:01:33,119 --> 00:01:34,479
and

37
00:01:34,479 --> 00:01:36,400
would start to associate this with this

38
00:01:36,400 --> 00:01:38,240
global pandemic right where we all

39
00:01:38,240 --> 00:01:41,600
started using vpn appliances for for

40
00:01:41,600 --> 00:01:44,320
teleworking

41
00:01:44,399 --> 00:01:46,640
now we've been tracking this for for a

42
00:01:46,640 --> 00:01:48,079
while now

43
00:01:48,079 --> 00:01:50,720
across multiple vendors and all the cves

44
00:01:50,720 --> 00:01:52,880
that have been affecting these vendors

45
00:01:52,880 --> 00:01:55,600
and when these cves have been

46
00:01:55,600 --> 00:01:57,680
exploited in the wild and so when we

47
00:01:57,680 --> 00:02:00,159
were tracking this over the last two and

48
00:02:00,159 --> 00:02:03,520
a half years we've seen actually no

49
00:02:03,520 --> 00:02:05,040
noticeable

50
00:02:05,040 --> 00:02:08,720
increase or misuse of these cves when we

51
00:02:08,720 --> 00:02:11,280
align this in a timeline that you see on

52
00:02:11,280 --> 00:02:13,440
the on the right hand side

53
00:02:13,440 --> 00:02:15,200
this talk focuses

54
00:02:15,200 --> 00:02:17,360
on the both secure

55
00:02:17,360 --> 00:02:19,840
intrusions we've observed with these

56
00:02:19,840 --> 00:02:21,120
cves

57
00:02:21,120 --> 00:02:22,879
but we also had

58
00:02:22,879 --> 00:02:25,680
previous incidents where affecting

59
00:02:25,680 --> 00:02:28,720
citrix net scalar or cisco devices you

60
00:02:28,720 --> 00:02:31,280
remember also vpn filter even predating

61
00:02:31,280 --> 00:02:33,120
in 2018.

62
00:02:33,120 --> 00:02:37,519
so the bottom line basically is that the

63
00:02:37,519 --> 00:02:41,040
vpn intrusions the vpn device intrusions

64
00:02:41,040 --> 00:02:42,560
provide a

65
00:02:42,560 --> 00:02:44,400
foothold within the environment provide

66
00:02:44,400 --> 00:02:47,680
a pivot point bypassing often

67
00:02:47,680 --> 00:02:48,640
other

68
00:02:48,640 --> 00:02:51,120
technology like network firewalls

69
00:02:51,120 --> 00:02:53,519
and therefore it's an interesting attack

70
00:02:53,519 --> 00:02:55,280
factor and whether we've been all

71
00:02:55,280 --> 00:02:58,080
affected by this global pandemic doesn't

72
00:02:58,080 --> 00:03:01,440
change too much about that

73
00:03:01,440 --> 00:03:03,760
as i've been said as i've said the uh

74
00:03:03,760 --> 00:03:06,319
talk focuses on one particular piece of

75
00:03:06,319 --> 00:03:10,000
technology from um called pulse secure

76
00:03:10,000 --> 00:03:12,400
the pulse secure started its history as

77
00:03:12,400 --> 00:03:14,959
neo theories then moved over

78
00:03:14,959 --> 00:03:17,440
to netscreen and then afterwards to

79
00:03:17,440 --> 00:03:20,640
juniper and more recently um end of last

80
00:03:20,640 --> 00:03:22,400
year has been acquired by a company

81
00:03:22,400 --> 00:03:24,480
called evante

82
00:03:24,480 --> 00:03:25,440
and so

83
00:03:25,440 --> 00:03:27,599
they've changed a little bit uh the

84
00:03:27,599 --> 00:03:29,519
things the market by

85
00:03:29,519 --> 00:03:33,200
not providing um ipsec tunnel based vpns

86
00:03:33,200 --> 00:03:35,680
to two clients but introducing this

87
00:03:35,680 --> 00:03:38,400
concept of ssl vpn right where you

88
00:03:38,400 --> 00:03:40,080
basically have in the case of pulse

89
00:03:40,080 --> 00:03:41,120
secure

90
00:03:41,120 --> 00:03:43,440
a linux based web server that provides

91
00:03:43,440 --> 00:03:46,400
you with a dls session and i can use

92
00:03:46,400 --> 00:03:48,319
that the last session to encrypt data

93
00:03:48,319 --> 00:03:49,920
back and forward including tunneling

94
00:03:49,920 --> 00:03:52,879
packets from your laptop mobile device

95
00:03:52,879 --> 00:03:55,040
or whatever have you

96
00:03:55,040 --> 00:03:57,599
and they have a pretty flexible solution

97
00:03:57,599 --> 00:04:00,720
by them using the vpn device they can

98
00:04:00,720 --> 00:04:03,040
assess the posture of your device the

99
00:04:03,040 --> 00:04:05,360
location of your device which rpdress

100
00:04:05,360 --> 00:04:06,799
you're connecting from

101
00:04:06,799 --> 00:04:09,599
and so it's often integrated with

102
00:04:09,599 --> 00:04:12,319
services like active directory or radio

103
00:04:12,319 --> 00:04:14,959
servers or ldap servers to perform a

104
00:04:14,959 --> 00:04:16,880
secondary authentication right so your

105
00:04:16,880 --> 00:04:19,839
username and typically a token-based

106
00:04:19,839 --> 00:04:23,518
authentication that you that you have

107
00:04:23,600 --> 00:04:26,320
you've been called in to investigate

108
00:04:26,320 --> 00:04:27,919
some of the intrusions that our

109
00:04:27,919 --> 00:04:30,320
customers have been facing with and

110
00:04:30,320 --> 00:04:31,840
obviously

111
00:04:31,840 --> 00:04:34,080
when we do with it with our traditional

112
00:04:34,080 --> 00:04:36,000
incident response we saw things that

113
00:04:36,000 --> 00:04:37,040
were

114
00:04:37,040 --> 00:04:39,360
abnormal in their environment

115
00:04:39,360 --> 00:04:40,840
like

116
00:04:40,840 --> 00:04:43,840
attackers uh leaving traces in the even

117
00:04:43,840 --> 00:04:46,240
logs um and when we were tracing back

118
00:04:46,240 --> 00:04:49,600
these uh traces um in the event logs

119
00:04:49,600 --> 00:04:52,880
we were pointing back to um this led to

120
00:04:52,880 --> 00:04:55,919
the uh discovery of the apdresses that

121
00:04:55,919 --> 00:04:59,040
were behind a vpn appliance or in some

122
00:04:59,040 --> 00:05:00,720
cases

123
00:05:00,720 --> 00:05:03,360
workstation names that were

124
00:05:03,360 --> 00:05:05,600
different than the ones that we've

125
00:05:05,600 --> 00:05:07,919
observed in the environment

126
00:05:07,919 --> 00:05:08,960
and again

127
00:05:08,960 --> 00:05:11,919
tracing back to the vpn devices

128
00:05:11,919 --> 00:05:13,680
sometimes also clearly malicious

129
00:05:13,680 --> 00:05:16,400
activity like dumping elsa's

130
00:05:16,400 --> 00:05:19,280
memory or starting mimikets but then

131
00:05:19,280 --> 00:05:21,759
starting mimikats from a remote desktop

132
00:05:21,759 --> 00:05:25,280
client mapped drive and then using the

133
00:05:25,280 --> 00:05:28,560
executables from their client computer

134
00:05:28,560 --> 00:05:30,639
and therefore leaving as little tracer

135
00:05:30,639 --> 00:05:32,639
as possible in the in the victim

136
00:05:32,639 --> 00:05:34,320
environment

137
00:05:34,320 --> 00:05:36,479
so kind of summarizing

138
00:05:36,479 --> 00:05:39,039
we clearly were dealing with a

139
00:05:39,039 --> 00:05:41,120
an attacker in those environment even

140
00:05:41,120 --> 00:05:44,400
some cases uh trying to exfiltrate data

141
00:05:44,400 --> 00:05:46,080
out of those environments

142
00:05:46,080 --> 00:05:47,919
but couldn't figure really out where

143
00:05:47,919 --> 00:05:50,560
they were coming from i mean obviously

144
00:05:50,560 --> 00:05:52,880
were these the first things that we

145
00:05:52,880 --> 00:05:54,000
thought was

146
00:05:54,000 --> 00:05:56,639
this must have been um

147
00:05:56,639 --> 00:05:59,520
vpn devices the client computers that

148
00:05:59,520 --> 00:06:01,919
actually have been compromised and this

149
00:06:01,919 --> 00:06:03,919
of course would have been our first uh

150
00:06:03,919 --> 00:06:04,880
theory

151
00:06:04,880 --> 00:06:06,400
but it turned out as you will see over

152
00:06:06,400 --> 00:06:08,240
the next slides that the attackers

153
00:06:08,240 --> 00:06:10,000
gained a foothold

154
00:06:10,000 --> 00:06:12,240
not on the client but on the actual

155
00:06:12,240 --> 00:06:15,759
appliance itself that served as a

156
00:06:15,759 --> 00:06:19,199
entry point within those networks

157
00:06:19,199 --> 00:06:21,520
so that's also what we disclosed earlier

158
00:06:21,520 --> 00:06:22,960
uh this year

159
00:06:22,960 --> 00:06:25,680
in march paul secure came out with a

160
00:06:25,680 --> 00:06:28,479
integrity tool as a response on some of

161
00:06:28,479 --> 00:06:31,039
the intrusions observed and this allowed

162
00:06:31,039 --> 00:06:33,280
many customers to

163
00:06:33,280 --> 00:06:37,039
match the files known and expect on the

164
00:06:37,039 --> 00:06:39,440
file system to a

165
00:06:39,440 --> 00:06:41,199
known uh good list

166
00:06:41,199 --> 00:06:42,240
and

167
00:06:42,240 --> 00:06:44,560
this led in some of these cases to the

168
00:06:44,560 --> 00:06:46,080
discovery of

169
00:06:46,080 --> 00:06:48,080
of these modifications on the file

170
00:06:48,080 --> 00:06:50,400
system itself and that's when we were

171
00:06:50,400 --> 00:06:52,319
being being called in and also helping

172
00:06:52,319 --> 00:06:55,520
out customers and also

173
00:06:55,520 --> 00:06:57,759
during those investigations

174
00:06:57,759 --> 00:06:59,599
we've identified a

175
00:06:59,599 --> 00:07:01,599
zero day attack together with the with

176
00:07:01,599 --> 00:07:04,800
the vendor that allowed even more recent

177
00:07:04,800 --> 00:07:07,360
versions of the pulse secure um to allow

178
00:07:07,360 --> 00:07:09,919
that initial attack factor

179
00:07:09,919 --> 00:07:12,400
and that initial foothold on those vbn

180
00:07:12,400 --> 00:07:14,160
appliances therefore allowing the

181
00:07:14,160 --> 00:07:16,560
attacker remotely to execute commands on

182
00:07:16,560 --> 00:07:20,800
these vpn appliances itself

183
00:07:21,039 --> 00:07:23,280
when we first started to report about

184
00:07:23,280 --> 00:07:27,440
this we had some exposure on the 20th of

185
00:07:27,440 --> 00:07:28,639
april

186
00:07:28,639 --> 00:07:30,880
and more and more companies became aware

187
00:07:30,880 --> 00:07:32,319
about this more organization became

188
00:07:32,319 --> 00:07:34,639
aware about this also here in uh in

189
00:07:34,639 --> 00:07:36,720
europe and therefore started to run

190
00:07:36,720 --> 00:07:39,520
these integrity um checker tools on

191
00:07:39,520 --> 00:07:42,880
their own uh secure appliances

192
00:07:42,880 --> 00:07:45,520
and therefore we did a follow-up blog on

193
00:07:45,520 --> 00:07:48,800
the um on may 27 which kind of also

194
00:07:48,800 --> 00:07:51,280
diversified our view right we've

195
00:07:51,280 --> 00:07:54,080
identified additional malware in use

196
00:07:54,080 --> 00:07:55,840
additional four families

197
00:07:55,840 --> 00:07:56,879
um

198
00:07:56,879 --> 00:07:59,120
and uh also additional victims and there

199
00:07:59,120 --> 00:08:01,599
were kind of interesting changes to the

200
00:08:01,599 --> 00:08:02,479
um

201
00:08:02,479 --> 00:08:04,560
to the activity that we've been uh

202
00:08:04,560 --> 00:08:07,120
investigating

203
00:08:08,720 --> 00:08:10,960
kind of giving an overview of the of the

204
00:08:10,960 --> 00:08:13,199
malware we have observed from

205
00:08:13,199 --> 00:08:15,840
the totality of malicious activity again

206
00:08:15,840 --> 00:08:17,919
not all of those are associated to the

207
00:08:17,919 --> 00:08:20,560
same clusters of uh threat activity i

208
00:08:20,560 --> 00:08:22,720
will dive deeper into this

209
00:08:22,720 --> 00:08:24,080
first of all

210
00:08:24,080 --> 00:08:26,080
a lot of web shall activity where the

211
00:08:26,080 --> 00:08:29,520
attackers were modifying the existing uh

212
00:08:29,520 --> 00:08:32,958
pulse secure um cgi scripts

213
00:08:32,958 --> 00:08:34,159
and then adding

214
00:08:34,159 --> 00:08:36,880
routines to them therefore allowing them

215
00:08:36,880 --> 00:08:38,880
to execute commands or upload and

216
00:08:38,880 --> 00:08:41,200
download files in some cases also using

217
00:08:41,200 --> 00:08:43,760
encryption

218
00:08:43,919 --> 00:08:45,200
other than that

219
00:08:45,200 --> 00:08:46,959
and i'll do a deep dive on this

220
00:08:46,959 --> 00:08:48,480
modifying the

221
00:08:48,480 --> 00:08:50,399
upgrade routine so that even if you

222
00:08:50,399 --> 00:08:52,480
would upgrade the appliance itself it

223
00:08:52,480 --> 00:08:55,040
would still have a persistent uh web

224
00:08:55,040 --> 00:08:57,120
shell on that system so

225
00:08:57,120 --> 00:08:59,200
basically you would have a new system

226
00:08:59,200 --> 00:09:02,160
image but then they would you would have

227
00:09:02,160 --> 00:09:05,920
a uh your web shell being transported um

228
00:09:05,920 --> 00:09:08,640
with each and every upgrade that you're

229
00:09:08,640 --> 00:09:11,040
executing

230
00:09:11,040 --> 00:09:12,240
kind of uh

231
00:09:12,240 --> 00:09:13,839
interesting techniques certainly with

232
00:09:13,839 --> 00:09:16,720
vpns multi-factor authentication is

233
00:09:16,720 --> 00:09:18,480
luckily a

234
00:09:18,480 --> 00:09:20,640
very good security measure

235
00:09:20,640 --> 00:09:22,399
but we've seen the attackers

236
00:09:22,399 --> 00:09:24,320
developing malware

237
00:09:24,320 --> 00:09:25,839
and multiple a couple of multiple

238
00:09:25,839 --> 00:09:28,640
variants called uh slow pulse to bypass

239
00:09:28,640 --> 00:09:30,880
those multi-factor authentications or

240
00:09:30,880 --> 00:09:32,080
sometimes

241
00:09:32,080 --> 00:09:33,920
uh collect those credentials with

242
00:09:33,920 --> 00:09:36,480
malware like blood bank or blood mine

243
00:09:36,480 --> 00:09:38,320
and to write them to files which then

244
00:09:38,320 --> 00:09:40,640
afterwards could be collected by uh by

245
00:09:40,640 --> 00:09:43,360
some of the existing web shells

246
00:09:43,360 --> 00:09:46,399
i'll do a deep dive on the anti-forensic

247
00:09:46,399 --> 00:09:49,200
the these the stealthier techniques that

248
00:09:49,200 --> 00:09:51,440
the attackers were using

249
00:09:51,440 --> 00:09:54,080
to stay under the radar not only in the

250
00:09:54,080 --> 00:09:56,560
victim networks but also on the victim

251
00:09:56,560 --> 00:09:59,519
appliances obviously to

252
00:09:59,519 --> 00:10:00,560
remain

253
00:10:00,560 --> 00:10:03,279
and gain that

254
00:10:03,279 --> 00:10:04,800
foothold within those victim

255
00:10:04,800 --> 00:10:07,680
environments for as long as as possible

256
00:10:07,680 --> 00:10:11,120
or in some cases um yeah changing the um

257
00:10:11,120 --> 00:10:13,040
cryptographic libraries like

258
00:10:13,040 --> 00:10:15,920
the openssl libraries um

259
00:10:15,920 --> 00:10:17,440
for

260
00:10:17,440 --> 00:10:20,000
this is a different cluster that we're

261
00:10:20,000 --> 00:10:22,240
tracking

262
00:10:22,240 --> 00:10:24,320
kind of an overview of the two biggest

263
00:10:24,320 --> 00:10:27,279
clusters of activity we've observed

264
00:10:27,279 --> 00:10:28,959
2630

265
00:10:28,959 --> 00:10:30,399
again that was the first cluster of

266
00:10:30,399 --> 00:10:32,959
activity that we've reported on

267
00:10:32,959 --> 00:10:35,200
predominantly focusing on victims

268
00:10:35,200 --> 00:10:36,800
targeting

269
00:10:36,800 --> 00:10:39,839
in the defense industrial base located

270
00:10:39,839 --> 00:10:42,079
in the united states and also the widest

271
00:10:42,079 --> 00:10:45,519
variety of malware

272
00:10:45,519 --> 00:10:47,040
um

273
00:10:47,040 --> 00:10:48,079
now

274
00:10:48,079 --> 00:10:50,000
one of those um

275
00:10:50,000 --> 00:10:52,399
yeah malware as i have explained is kind

276
00:10:52,399 --> 00:10:55,519
of targeting the upgrade routines as i

277
00:10:55,519 --> 00:10:57,839
as i've said before

278
00:10:57,839 --> 00:11:00,399
when you upgrade your appliance

279
00:11:00,399 --> 00:11:02,800
you have a script that is running on the

280
00:11:02,800 --> 00:11:05,680
pulse secure itself to

281
00:11:05,680 --> 00:11:07,600
unpack all the

282
00:11:07,600 --> 00:11:09,600
new files that have been modified by the

283
00:11:09,600 --> 00:11:11,440
vendor

284
00:11:11,440 --> 00:11:13,600
but in this upgrade routine in this

285
00:11:13,600 --> 00:11:14,959
upgrade script

286
00:11:14,959 --> 00:11:16,240
the attackers actually made a

287
00:11:16,240 --> 00:11:18,320
modification so that it would write a

288
00:11:18,320 --> 00:11:20,880
web shell to specific location a

289
00:11:20,880 --> 00:11:23,760
specific cgi file on disk that would

290
00:11:23,760 --> 00:11:25,440
then be remotely accessed by the

291
00:11:25,440 --> 00:11:27,600
attackers and therefore each time they

292
00:11:27,600 --> 00:11:30,640
provided in this case the parameter id

293
00:11:30,640 --> 00:11:33,519
would execute a system command on the

294
00:11:33,519 --> 00:11:35,600
operating system itself which they then

295
00:11:35,600 --> 00:11:38,880
can then use again to deploy or redeploy

296
00:11:38,880 --> 00:11:40,399
their malware

297
00:11:40,399 --> 00:11:43,839
on that target system

298
00:11:44,720 --> 00:11:47,040
as i've mentioned before um another

299
00:11:47,040 --> 00:11:49,680
malware family which i think is had some

300
00:11:49,680 --> 00:11:52,000
pretty novel techniques called slow

301
00:11:52,000 --> 00:11:53,600
pulse

302
00:11:53,600 --> 00:11:56,800
allowing to override the existing

303
00:11:56,800 --> 00:12:00,160
routines on the pulse secure device

304
00:12:00,160 --> 00:12:01,920
and in the case

305
00:12:01,920 --> 00:12:04,880
that as shown over here on the right

306
00:12:04,880 --> 00:12:06,560
in case the attacker

307
00:12:06,560 --> 00:12:08,160
provided a

308
00:12:08,160 --> 00:12:08,959
known

309
00:12:08,959 --> 00:12:11,920
backdoor password in its authentication

310
00:12:11,920 --> 00:12:13,600
it would always be a valid

311
00:12:13,600 --> 00:12:16,079
authentication and therefore

312
00:12:16,079 --> 00:12:18,959
able to bypass any authentications uh

313
00:12:18,959 --> 00:12:20,880
checks that would be performed by the

314
00:12:20,880 --> 00:12:24,160
system or radio server or token based

315
00:12:24,160 --> 00:12:27,920
server that you have in your network

316
00:12:28,480 --> 00:12:30,880
a separate cluster of activity that

317
00:12:30,880 --> 00:12:35,120
we're tracking as 2717

318
00:12:35,120 --> 00:12:36,399
using the same

319
00:12:36,399 --> 00:12:38,720
cve as a zero day to get the initial

320
00:12:38,720 --> 00:12:39,839
foothold

321
00:12:39,839 --> 00:12:43,200
but different victims and um also

322
00:12:43,200 --> 00:12:47,440
victims located within within europe so

323
00:12:47,440 --> 00:12:50,079
this threat actor

324
00:12:50,079 --> 00:12:53,360
cluster of activity that we've observed

325
00:12:53,360 --> 00:12:56,639
was using somewhat distinct differently

326
00:12:56,639 --> 00:12:59,680
malware um the kind of same coding style

327
00:12:59,680 --> 00:13:00,720
so we've

328
00:13:00,720 --> 00:13:02,320
associated that there's some sort of

329
00:13:02,320 --> 00:13:04,399
collaboration between the two um

330
00:13:04,399 --> 00:13:07,120
entities

331
00:13:07,120 --> 00:13:09,519
one of the malware clusters um i'm going

332
00:13:09,519 --> 00:13:11,600
to highlight here is

333
00:13:11,600 --> 00:13:13,360
one of the credential harvesting tools

334
00:13:13,360 --> 00:13:16,160
that they're using called pulse jump and

335
00:13:16,160 --> 00:13:18,320
so basically also again modifying the

336
00:13:18,320 --> 00:13:21,120
existing scripts on the pulse secure

337
00:13:21,120 --> 00:13:23,920
appliance so therefore to write with

338
00:13:23,920 --> 00:13:26,800
each authentication um in a file in the

339
00:13:26,800 --> 00:13:29,360
team b directory um the authentications

340
00:13:29,360 --> 00:13:31,760
that are happening and again exposing

341
00:13:31,760 --> 00:13:34,079
them to the attacker as they can then

342
00:13:34,079 --> 00:13:36,320
collect those files using the existing

343
00:13:36,320 --> 00:13:39,600
web shells on system

344
00:13:41,040 --> 00:13:43,920
now let's talk about the anti-forensics

345
00:13:43,920 --> 00:13:45,360
and

346
00:13:45,360 --> 00:13:47,440
as an internet response company we were

347
00:13:47,440 --> 00:13:49,760
we were faced with this attacker that

348
00:13:49,760 --> 00:13:51,199
really remained

349
00:13:51,199 --> 00:13:53,839
as wanted to remain as stealthy as uh as

350
00:13:53,839 --> 00:13:56,000
possible and so we were using a couple

351
00:13:56,000 --> 00:13:58,959
of techniques like time stomping on the

352
00:13:58,959 --> 00:14:01,440
vpn appliances themselves to kind of

353
00:14:01,440 --> 00:14:04,720
blend in to the um to the time frame of

354
00:14:04,720 --> 00:14:06,959
activity that you would typically see

355
00:14:06,959 --> 00:14:09,199
on those uh systems

356
00:14:09,199 --> 00:14:12,079
um for example when you have a system

357
00:14:12,079 --> 00:14:13,519
upgrade

358
00:14:13,519 --> 00:14:15,760
it would kind of blast

359
00:14:15,760 --> 00:14:17,199
and make a lot of modifications to the

360
00:14:17,199 --> 00:14:19,440
file system itself so obviously if you

361
00:14:19,440 --> 00:14:20,480
have a

362
00:14:20,480 --> 00:14:22,720
web shell on that same system

363
00:14:22,720 --> 00:14:23,920
um

364
00:14:23,920 --> 00:14:26,639
planted by the attacker by misusing um

365
00:14:26,639 --> 00:14:29,519
one of these cves it will fall outside

366
00:14:29,519 --> 00:14:31,199
of those those time frames so the

367
00:14:31,199 --> 00:14:33,360
attackers were well aware and then

368
00:14:33,360 --> 00:14:36,079
um in some cases performed time stopping

369
00:14:36,079 --> 00:14:37,760
so that they would align with system

370
00:14:37,760 --> 00:14:38,800
upgrades

371
00:14:38,800 --> 00:14:40,240
um

372
00:14:40,240 --> 00:14:42,240
in other cases like the exploitation of

373
00:14:42,240 --> 00:14:45,040
the zero day as i've mentioned they were

374
00:14:45,040 --> 00:14:46,959
well aware that in some cases these also

375
00:14:46,959 --> 00:14:49,440
triggered core dumps and so again

376
00:14:49,440 --> 00:14:51,600
removing those files is some of the

377
00:14:51,600 --> 00:14:53,199
techniques that we have

378
00:14:53,199 --> 00:14:55,839
we've investigated

379
00:14:55,839 --> 00:14:58,160
more simple examples suppressing certain

380
00:14:58,160 --> 00:15:01,199
log log entries or simply removing them

381
00:15:01,199 --> 00:15:03,600
by using malware like timblot

382
00:15:03,600 --> 00:15:04,639
or

383
00:15:04,639 --> 00:15:07,440
more advanced techniques like having

384
00:15:07,440 --> 00:15:10,079
binaries on the system itself

385
00:15:10,079 --> 00:15:11,680
in the example over here using clean

386
00:15:11,680 --> 00:15:14,639
pose so therefore patching the

387
00:15:14,639 --> 00:15:17,279
logging processes on the system itself

388
00:15:17,279 --> 00:15:19,600
so that therefore these would

389
00:15:19,600 --> 00:15:22,800
no longer lock to disk uh the um any

390
00:15:22,800 --> 00:15:26,000
activity that is happening

391
00:15:26,000 --> 00:15:28,560
lastly interesting enough we've seen

392
00:15:28,560 --> 00:15:31,120
during those disclosures that the

393
00:15:31,120 --> 00:15:33,199
attackers were quite well aware of

394
00:15:33,199 --> 00:15:35,120
what's what was happening what was being

395
00:15:35,120 --> 00:15:37,040
disclosed and in some cases we've seen

396
00:15:37,040 --> 00:15:40,160
the attackers going back to their victim

397
00:15:40,160 --> 00:15:42,720
environments and deleting the files on

398
00:15:42,720 --> 00:15:44,560
those vpn appliances

399
00:15:44,560 --> 00:15:47,440
that uh so obviously in a effort to

400
00:15:47,440 --> 00:15:50,160
clean up the um any of the malware they

401
00:15:50,160 --> 00:15:53,040
have left behind

402
00:15:53,040 --> 00:15:54,600
doing some

403
00:15:54,600 --> 00:15:56,959
anti-anti-forensics or some would just

404
00:15:56,959 --> 00:15:58,880
call it forensics

405
00:15:58,880 --> 00:16:01,360
um the techniques that we've used at

406
00:16:01,360 --> 00:16:04,079
mandiant is uh obviously using those

407
00:16:04,079 --> 00:16:06,720
integrity checkers for those initial

408
00:16:06,720 --> 00:16:09,199
leads right so if you find a file that

409
00:16:09,199 --> 00:16:10,800
has been modified obviously that's your

410
00:16:10,800 --> 00:16:12,880
first starting point to then do a

411
00:16:12,880 --> 00:16:14,639
further analysis

412
00:16:14,639 --> 00:16:16,639
as i've mentioned the attacker was well

413
00:16:16,639 --> 00:16:18,720
aware about the logging mechanisms

414
00:16:18,720 --> 00:16:20,800
available on the system

415
00:16:20,800 --> 00:16:21,680
and

416
00:16:21,680 --> 00:16:23,519
so therefore looking at different

417
00:16:23,519 --> 00:16:26,480
sources of logging like a seam system or

418
00:16:26,480 --> 00:16:27,600
off box

419
00:16:27,600 --> 00:16:29,120
system that you have like a syslog

420
00:16:29,120 --> 00:16:30,000
server

421
00:16:30,000 --> 00:16:32,000
was really helpful to perform those

422
00:16:32,000 --> 00:16:33,279
analysis

423
00:16:33,279 --> 00:16:35,360
because the attacker could modify the

424
00:16:35,360 --> 00:16:37,920
logs on the box it would be mostly

425
00:16:37,920 --> 00:16:40,240
difficult for them to target the logs

426
00:16:40,240 --> 00:16:43,839
that are stored of the box

427
00:16:43,839 --> 00:16:45,839
using traditional techniques like

428
00:16:45,839 --> 00:16:48,000
timeline analysis helped us to identify

429
00:16:48,000 --> 00:16:49,120
those

430
00:16:49,120 --> 00:16:51,600
malicious files on those systems but as

431
00:16:51,600 --> 00:16:53,440
i've mentioned some cases we were also

432
00:16:53,440 --> 00:16:56,480
faced with timestamping taking place

433
00:16:56,480 --> 00:16:58,000
um

434
00:16:58,000 --> 00:17:00,000
what was interesting is that the both

435
00:17:00,000 --> 00:17:02,399
secure appliances also provided a

436
00:17:02,399 --> 00:17:04,799
mounted uh some of the file systems as

437
00:17:04,799 --> 00:17:07,119
read only right so in an effort to make

438
00:17:07,119 --> 00:17:08,880
it harder to

439
00:17:08,880 --> 00:17:10,720
make any changes we saw that the

440
00:17:10,720 --> 00:17:11,839
attacker

441
00:17:11,839 --> 00:17:13,520
um

442
00:17:13,520 --> 00:17:16,799
re-mounted those partitions in order to

443
00:17:16,799 --> 00:17:18,400
write files to them

444
00:17:18,400 --> 00:17:20,319
but again that also left traces because

445
00:17:20,319 --> 00:17:21,359
you would see

446
00:17:21,359 --> 00:17:22,880
changes to those file systems that you

447
00:17:22,880 --> 00:17:24,880
would normally not not observe and again

448
00:17:24,880 --> 00:17:26,959
that was a pivot point in order to

449
00:17:26,959 --> 00:17:28,960
investigate those changes that happened

450
00:17:28,960 --> 00:17:30,720
around that time

451
00:17:30,720 --> 00:17:32,960
lastly other techniques like

452
00:17:32,960 --> 00:17:35,039
file carving for anything deleted on

453
00:17:35,039 --> 00:17:37,520
disk but that still may be recoverable

454
00:17:37,520 --> 00:17:39,679
or as i've mentioned with the use of

455
00:17:39,679 --> 00:17:42,320
atrium um sometimes we would just have a

456
00:17:42,320 --> 00:17:45,200
web shell with a later version of a

457
00:17:45,200 --> 00:17:47,280
compromised device but actually

458
00:17:47,280 --> 00:17:50,160
performing a rollback to a previous

459
00:17:50,160 --> 00:17:52,720
version would then allow us to recover

460
00:17:52,720 --> 00:17:55,840
the malware that affected an initial

461
00:17:55,840 --> 00:17:58,160
intrusion

462
00:17:58,160 --> 00:17:59,840
so kind of to summarize all of the

463
00:17:59,840 --> 00:18:02,000
different techniques that we've observed

464
00:18:02,000 --> 00:18:04,240
with the uh with the attackers

465
00:18:04,240 --> 00:18:05,679
something we've

466
00:18:05,679 --> 00:18:08,640
i haven't talked about before um

467
00:18:08,640 --> 00:18:10,960
is even before the attackers were

468
00:18:10,960 --> 00:18:13,440
targeting these vpn appliances they were

469
00:18:13,440 --> 00:18:14,880
using

470
00:18:14,880 --> 00:18:15,919
exit

471
00:18:15,919 --> 00:18:19,280
nodes from what looked like to be a

472
00:18:19,280 --> 00:18:22,080
wide compromised

473
00:18:22,080 --> 00:18:23,840
network of

474
00:18:23,840 --> 00:18:26,000
devices that the attackers could use

475
00:18:26,000 --> 00:18:29,039
even sometimes specific for a

476
00:18:29,039 --> 00:18:30,480
specific victim

477
00:18:30,480 --> 00:18:34,559
um and where they were accessing from um

478
00:18:34,559 --> 00:18:35,760
systems

479
00:18:35,760 --> 00:18:38,240
in the same geographical location that

480
00:18:38,240 --> 00:18:40,880
you would expect your vpn client to

481
00:18:40,880 --> 00:18:43,520
locate uh to be located in so that's

482
00:18:43,520 --> 00:18:45,520
also again another

483
00:18:45,520 --> 00:18:46,720
um

484
00:18:46,720 --> 00:18:48,160
demonstration of

485
00:18:48,160 --> 00:18:50,160
being stealthy in the environment and it

486
00:18:50,160 --> 00:18:51,360
would

487
00:18:51,360 --> 00:18:53,440
blend into the normal traffic that you

488
00:18:53,440 --> 00:18:56,320
would observe in your environment

489
00:18:56,320 --> 00:18:58,400
the other things we've talked about yeah

490
00:18:58,400 --> 00:19:01,360
remaining persistent across system

491
00:19:01,360 --> 00:19:04,880
upgrades blending web shells

492
00:19:04,880 --> 00:19:06,960
and then some cases reusing the

493
00:19:06,960 --> 00:19:09,520
credentials of valid administrators in

494
00:19:09,520 --> 00:19:12,080
the environment

495
00:19:12,080 --> 00:19:14,000
in the victim

496
00:19:14,000 --> 00:19:17,440
windows domain as an example

497
00:19:18,640 --> 00:19:20,720
for credential access obviously you have

498
00:19:20,720 --> 00:19:22,960
your vpn appliance authenticating your

499
00:19:22,960 --> 00:19:24,960
users and this also provided the

500
00:19:24,960 --> 00:19:27,039
attackers um

501
00:19:27,039 --> 00:19:28,880
with malware like

502
00:19:28,880 --> 00:19:31,280
slow pulse or

503
00:19:31,280 --> 00:19:33,280
blood mine to collect those credentials

504
00:19:33,280 --> 00:19:35,600
and to reuse those in the environment so

505
00:19:35,600 --> 00:19:37,679
they would no longer need to gather them

506
00:19:37,679 --> 00:19:41,200
within the victim environment itself

507
00:19:41,200 --> 00:19:43,039
or in some cases

508
00:19:43,039 --> 00:19:45,120
when moving laterally we've also seen

509
00:19:45,120 --> 00:19:46,960
the attackers reusing those same

510
00:19:46,960 --> 00:19:48,799
credentials being used

511
00:19:48,799 --> 00:19:50,799
against the cloud environment right if

512
00:19:50,799 --> 00:19:53,039
you have a hybrid network where you have

513
00:19:53,039 --> 00:19:54,320
both a

514
00:19:54,320 --> 00:19:56,160
on-site on-premise

515
00:19:56,160 --> 00:19:58,400
network they could also reuse those same

516
00:19:58,400 --> 00:20:00,880
credentials some cases also multi-factor

517
00:20:00,880 --> 00:20:02,559
authenticated users

518
00:20:02,559 --> 00:20:03,360
um

519
00:20:03,360 --> 00:20:06,400
and target the cloud environment any

520
00:20:06,400 --> 00:20:10,240
resources that you have over there

521
00:20:10,480 --> 00:20:13,039
all right so kind of to summarize i mean

522
00:20:13,039 --> 00:20:15,600
these vpn device appliances is something

523
00:20:15,600 --> 00:20:18,240
that we assess to be

524
00:20:18,240 --> 00:20:20,799
quite impactful to an organization so

525
00:20:20,799 --> 00:20:22,559
so how do you protect yourself how do

526
00:20:22,559 --> 00:20:24,799
you defend yourself against this and if

527
00:20:24,799 --> 00:20:26,799
it would happen how do you

528
00:20:26,799 --> 00:20:29,120
recover from this

529
00:20:29,120 --> 00:20:31,280
so first of all as as

530
00:20:31,280 --> 00:20:33,280
we've shown um

531
00:20:33,280 --> 00:20:34,400
is that

532
00:20:34,400 --> 00:20:38,400
these um vpn appliance compromises

533
00:20:38,400 --> 00:20:41,280
um there's a number of cves associated

534
00:20:41,280 --> 00:20:43,360
to that that allows that initial

535
00:20:43,360 --> 00:20:44,880
foothold within

536
00:20:44,880 --> 00:20:47,919
um onto a vpn appliance so as soon as

537
00:20:47,919 --> 00:20:50,080
there is a patch made available

538
00:20:50,080 --> 00:20:53,280
although that there are zero days

539
00:20:53,280 --> 00:20:56,080
possible as we've shown

540
00:20:56,080 --> 00:20:57,919
it really remains very important to

541
00:20:57,919 --> 00:21:00,480
patch very aggressively now

542
00:21:00,480 --> 00:21:02,159
that may sound to you as security

543
00:21:02,159 --> 00:21:03,520
professionals as

544
00:21:03,520 --> 00:21:05,280
yeah something obvious to do but

545
00:21:05,280 --> 00:21:07,679
certainly in in the case of

546
00:21:07,679 --> 00:21:10,080
these devices being highly used by

547
00:21:10,080 --> 00:21:12,000
teleworkers that's something not as

548
00:21:12,000 --> 00:21:14,080
obvious to many organizations

549
00:21:14,080 --> 00:21:16,400
because obviously batching these devices

550
00:21:16,400 --> 00:21:19,440
would often result in uh in downtime so

551
00:21:19,440 --> 00:21:21,200
it's kind of to be prepared for this

552
00:21:21,200 --> 00:21:23,520
with high available solutions that you

553
00:21:23,520 --> 00:21:26,880
can use to redirect your users

554
00:21:26,880 --> 00:21:29,440
other tips and tricks if possible use a

555
00:21:29,440 --> 00:21:31,200
reverse proxy or web application

556
00:21:31,200 --> 00:21:33,760
firewall certainly if you're using a

557
00:21:33,760 --> 00:21:36,080
sslvbn device but of course that's going

558
00:21:36,080 --> 00:21:37,919
to increase the cost and complexity of

559
00:21:37,919 --> 00:21:39,600
the solution itself

560
00:21:39,600 --> 00:21:42,400
um and mostly also yeah prepare for

561
00:21:42,400 --> 00:21:44,880
something like this right we've seen

562
00:21:44,880 --> 00:21:47,600
organizations that are very

563
00:21:47,600 --> 00:21:49,360
familiar with performing

564
00:21:49,360 --> 00:21:51,280
investigations on windows based or linux

565
00:21:51,280 --> 00:21:53,280
based systems but as soon

566
00:21:53,280 --> 00:21:54,080
um

567
00:21:54,080 --> 00:21:55,840
as you have face are facing something

568
00:21:55,840 --> 00:21:58,320
like a vpn device compromise it was

569
00:21:58,320 --> 00:21:59,520
often the first time that an

570
00:21:59,520 --> 00:22:01,360
organization had to deal with something

571
00:22:01,360 --> 00:22:03,760
like this

572
00:22:04,080 --> 00:22:06,480
as i've mentioned in the specific case

573
00:22:06,480 --> 00:22:08,640
we've talked about here is that the

574
00:22:08,640 --> 00:22:11,039
attackers were very well aware about the

575
00:22:11,039 --> 00:22:12,880
logging possibilities of the systems and

576
00:22:12,880 --> 00:22:13,919
how to

577
00:22:13,919 --> 00:22:16,159
bypass or make it harder to recover

578
00:22:16,159 --> 00:22:19,360
those traces so storing data

579
00:22:19,360 --> 00:22:21,760
off the box itself is quite important

580
00:22:21,760 --> 00:22:22,720
and so

581
00:22:22,720 --> 00:22:25,120
adding that to your equation

582
00:22:25,120 --> 00:22:27,760
that a vpn device compromise can happen

583
00:22:27,760 --> 00:22:29,919
as we've shown over here

584
00:22:29,919 --> 00:22:30,799
and

585
00:22:30,799 --> 00:22:32,320
making sure that your environment is

586
00:22:32,320 --> 00:22:33,440
investigation

587
00:22:33,440 --> 00:22:36,640
friendly to allow those log sources to

588
00:22:36,640 --> 00:22:39,280
be available in case it would happen

589
00:22:39,280 --> 00:22:41,120
and lastly of course if you are faced

590
00:22:41,120 --> 00:22:42,080
with a

591
00:22:42,080 --> 00:22:44,720
vpn appliance compromise

592
00:22:44,720 --> 00:22:47,280
that you think holistically right

593
00:22:47,280 --> 00:22:48,960
you had an attacker that had access to a

594
00:22:48,960 --> 00:22:51,280
vpn appliance for

595
00:22:51,280 --> 00:22:54,559
perhaps a number of weeks perhaps uh

596
00:22:54,559 --> 00:22:55,679
months

597
00:22:55,679 --> 00:22:57,360
what are the accounts that you need to

598
00:22:57,360 --> 00:23:00,240
reset the accounts that are being used

599
00:23:00,240 --> 00:23:02,960
during that time by your users but also

600
00:23:02,960 --> 00:23:05,360
the accounts stored on the vpn appliance

601
00:23:05,360 --> 00:23:07,760
itself it uses to perhaps authenticate

602
00:23:07,760 --> 00:23:10,240
to active directory or a radio server or

603
00:23:10,240 --> 00:23:14,080
a multi-factor authentication server

604
00:23:14,880 --> 00:23:16,400
right so kind of the

605
00:23:16,400 --> 00:23:18,559
yeah bottom line four things that i want

606
00:23:18,559 --> 00:23:20,960
you to remember from this

607
00:23:20,960 --> 00:23:24,559
from this session is um

608
00:23:24,559 --> 00:23:26,880
the vpn appliances itself are are

609
00:23:26,880 --> 00:23:27,919
valuable

610
00:23:27,919 --> 00:23:30,480
pivot points into an environment so be

611
00:23:30,480 --> 00:23:32,880
prepared for uh be prepared for this so

612
00:23:32,880 --> 00:23:35,120
therefore increase your

613
00:23:35,120 --> 00:23:38,559
monitoring for these kind of

614
00:23:38,559 --> 00:23:40,480
hopefully black swan events that would

615
00:23:40,480 --> 00:23:42,480
happen to your organization but if they

616
00:23:42,480 --> 00:23:45,120
do happen have a response plan ready to

617
00:23:45,120 --> 00:23:49,200
uh to um to take this too into account

618
00:23:49,200 --> 00:23:51,440
whether we will see more of this in the

619
00:23:51,440 --> 00:23:52,640
future

620
00:23:52,640 --> 00:23:54,720
we we actually don't know we also have

621
00:23:54,720 --> 00:23:57,120
trends like uh cloud computing

622
00:23:57,120 --> 00:24:00,799
um being uh introduced and um things

623
00:24:00,799 --> 00:24:03,200
like zero trust which make it less

624
00:24:03,200 --> 00:24:07,440
valuable to have these vpn devices into

625
00:24:07,440 --> 00:24:08,720
compromises

626
00:24:08,720 --> 00:24:10,880
for an attacker

627
00:24:10,880 --> 00:24:12,880
but bottom line is that

628
00:24:12,880 --> 00:24:14,880
yeah still if you're using this vpn

629
00:24:14,880 --> 00:24:16,400
technology

630
00:24:16,400 --> 00:24:18,559
certainly be prepared for something like

631
00:24:18,559 --> 00:24:20,000
this and

632
00:24:20,000 --> 00:24:22,320
exercise a incident response and

633
00:24:22,320 --> 00:24:24,879
forensics

634
00:24:25,279 --> 00:24:27,200
forensic analysis before it actually

635
00:24:27,200 --> 00:24:29,840
would happen to your organization

636
00:24:29,840 --> 00:24:31,279
so with this

637
00:24:31,279 --> 00:24:34,159
if you have any questions um happy to

638
00:24:34,159 --> 00:24:36,880
answer them in any of your

639
00:24:36,880 --> 00:24:39,279
so throw them into the chat and i'll

640
00:24:39,279 --> 00:24:42,250
happily respond to them

641
00:24:42,250 --> 00:24:51,869
[Music]

642
00:24:52,400 --> 00:24:54,480
you

