1
00:00:00,910 --> 00:00:09,599
[Music]

2
00:00:09,599 --> 00:00:12,000
all right good afternoon everyone

3
00:00:12,000 --> 00:00:14,799
my name is chris doman i'm the cto and

4
00:00:14,799 --> 00:00:16,960
co-founder of case security

5
00:00:16,960 --> 00:00:19,760
and before that i worked on alienvault's

6
00:00:19,760 --> 00:00:21,119
open threat exchange that you might have

7
00:00:21,119 --> 00:00:23,199
seen before also another portal called

8
00:00:23,199 --> 00:00:25,439
threat crowd but before all that i used

9
00:00:25,439 --> 00:00:27,599
to work in instant response at pwc

10
00:00:27,599 --> 00:00:30,720
working for this guy james

11
00:00:30,720 --> 00:00:33,600
thanks chris i'm this guy james

12
00:00:33,600 --> 00:00:36,239
james campbell ceo and co-founder of kb

13
00:00:36,239 --> 00:00:39,760
security um long-time cyber response and

14
00:00:39,760 --> 00:00:42,480
forensics buff and uh self-confessed

15
00:00:42,480 --> 00:00:45,840
nerd um i previously before cato i used

16
00:00:45,840 --> 00:00:47,760
to run the cyber instant response team

17
00:00:47,760 --> 00:00:50,000
at pvc uk

18
00:00:50,000 --> 00:00:52,000
and before coming over to the uk i used

19
00:00:52,000 --> 00:00:54,320
to run the ir

20
00:00:54,320 --> 00:00:56,480
side of things in australian government

21
00:00:56,480 --> 00:00:59,199
at the australian signals directorate

22
00:00:59,199 --> 00:01:00,559
great so

23
00:01:00,559 --> 00:01:02,239
thanks for joining today so let's get

24
00:01:02,239 --> 00:01:04,879
into it so as per our website here's a

25
00:01:04,879 --> 00:01:07,520
description of our presentation but i

26
00:01:07,520 --> 00:01:08,320
mean

27
00:01:08,320 --> 00:01:09,760
we know people don't like to read the

28
00:01:09,760 --> 00:01:12,320
whole thing so we've been nice here and

29
00:01:12,320 --> 00:01:14,159
i've distilled this down into kind of

30
00:01:14,159 --> 00:01:15,920
some key messages here and some things

31
00:01:15,920 --> 00:01:17,200
that we're going to talk about today on

32
00:01:17,200 --> 00:01:18,400
the agenda

33
00:01:18,400 --> 00:01:20,960
and really it's it's about a story um

34
00:01:20,960 --> 00:01:23,520
and a story about our interactions with

35
00:01:23,520 --> 00:01:26,640
a hacker group known as team tnt um and

36
00:01:26,640 --> 00:01:29,280
a story around uh the compromise of

37
00:01:29,280 --> 00:01:32,000
kubernetes systems particularly in cloud

38
00:01:32,000 --> 00:01:33,439
environments

39
00:01:33,439 --> 00:01:34,240
um

40
00:01:34,240 --> 00:01:36,079
there's also a little bit of a twist

41
00:01:36,079 --> 00:01:38,960
with some weird gifts we've come across

42
00:01:38,960 --> 00:01:40,880
um and just for a bit of laughter as

43
00:01:40,880 --> 00:01:43,040
well which is great um but at the end

44
00:01:43,040 --> 00:01:45,439
we're also gonna make sure that we've

45
00:01:45,439 --> 00:01:47,840
got some key take-homes for you um and

46
00:01:47,840 --> 00:01:50,079
some advice around actually protecting

47
00:01:50,079 --> 00:01:51,600
yourself particularly when it comes to

48
00:01:51,600 --> 00:01:55,439
vulnerable kubernetes platforms

49
00:01:55,439 --> 00:01:57,439
so over to chris to kind of start off

50
00:01:57,439 --> 00:02:00,479
the story uh for kd

51
00:02:00,479 --> 00:02:04,560
yeah so this is how our story begins

52
00:02:04,640 --> 00:02:08,080
so one day i think back in august 2020 i

53
00:02:08,080 --> 00:02:10,720
was looking at our usual field uh feed

54
00:02:10,720 --> 00:02:12,480
of malware coming through every day lots

55
00:02:12,480 --> 00:02:13,760
of stuff in there

56
00:02:13,760 --> 00:02:15,599
and this one gonna caught my eye it's

57
00:02:15,599 --> 00:02:17,280
got a really cool logo on it you can see

58
00:02:17,280 --> 00:02:19,599
there it says team tnt

59
00:02:19,599 --> 00:02:21,520
and at this point i didn't know what

60
00:02:21,520 --> 00:02:22,800
that meant no i hadn't really reported

61
00:02:22,800 --> 00:02:24,640
on them yet but digging in it looked

62
00:02:24,640 --> 00:02:27,440
kind of interesting

63
00:02:29,040 --> 00:02:30,640
so this is what it was doing and this is

64
00:02:30,640 --> 00:02:32,879
what really kind of got us interested so

65
00:02:32,879 --> 00:02:34,560
you can see here what the script is

66
00:02:34,560 --> 00:02:37,040
doing is it's taking the root aws

67
00:02:37,040 --> 00:02:38,959
credentials file and it's sending off to

68
00:02:38,959 --> 00:02:41,040
the attacker server which is that url

69
00:02:41,040 --> 00:02:43,280
ending with the php script

70
00:02:43,280 --> 00:02:45,599
and what that aws credential file can do

71
00:02:45,599 --> 00:02:47,760
is a ton of stuff actually so it

72
00:02:47,760 --> 00:02:49,440
contains your access key as you can see

73
00:02:49,440 --> 00:02:52,160
here it contains your secret key and an

74
00:02:52,160 --> 00:02:54,160
attacker can take this they can sit at

75
00:02:54,160 --> 00:02:56,480
their laptop and if that credential has

76
00:02:56,480 --> 00:02:58,800
access they can go and do things like

77
00:02:58,800 --> 00:03:00,959
download all the files and s3 they can

78
00:03:00,959 --> 00:03:03,519
start and stop ec2 instances so tons of

79
00:03:03,519 --> 00:03:04,959
different things i can potentially do

80
00:03:04,959 --> 00:03:07,360
here and looking at the network peak app

81
00:03:07,360 --> 00:03:08,959
here which is what that script sends

82
00:03:08,959 --> 00:03:11,840
over in red is what they're sent to the

83
00:03:11,840 --> 00:03:13,920
attacker server and then blue is what

84
00:03:13,920 --> 00:03:15,920
the attacker server sends back you can

85
00:03:15,920 --> 00:03:18,400
see in response to that stolen data it

86
00:03:18,400 --> 00:03:20,800
just says thanks

87
00:03:20,800 --> 00:03:22,480
very nice to them

88
00:03:22,480 --> 00:03:24,400
yeah it was very nice of them so i

89
00:03:24,400 --> 00:03:25,360
started looking around the server a

90
00:03:25,360 --> 00:03:26,560
little bit more

91
00:03:26,560 --> 00:03:27,840
i could see here that there are some

92
00:03:27,840 --> 00:03:30,080
more files so there's an open directory

93
00:03:30,080 --> 00:03:31,840
i can see there's this php script which

94
00:03:31,840 --> 00:03:33,920
is stealing those credits there's also a

95
00:03:33,920 --> 00:03:35,360
cube in as well which is still in

96
00:03:35,360 --> 00:03:37,280
kubernetes credentials something to talk

97
00:03:37,280 --> 00:03:39,120
about in a minute and there's some other

98
00:03:39,120 --> 00:03:40,400
open directories too which is

99
00:03:40,400 --> 00:03:43,760
potentially quite interesting

100
00:03:44,080 --> 00:03:46,080
but the next folder i looked at had this

101
00:03:46,080 --> 00:03:47,519
message instead

102
00:03:47,519 --> 00:03:49,680
don't even try a little new view so

103
00:03:49,680 --> 00:03:51,440
clearly these guys can protect their

104
00:03:51,440 --> 00:03:52,720
servers a little bit stop you looking

105
00:03:52,720 --> 00:03:55,040
around

106
00:03:55,200 --> 00:03:58,400
next server had this stop it now quite a

107
00:03:58,400 --> 00:04:00,560
clear directory uh directive on that

108
00:04:00,560 --> 00:04:02,239
folder i think at this point they

109
00:04:02,239 --> 00:04:03,760
definitely don't want you

110
00:04:03,760 --> 00:04:05,760
looking around that's for sure

111
00:04:05,760 --> 00:04:07,360
yeah i don't know like that the research

112
00:04:07,360 --> 00:04:10,720
is poking their serve as much

113
00:04:11,120 --> 00:04:13,120
and then just to kind of set the scene

114
00:04:13,120 --> 00:04:14,560
here this is around one in the morning i

115
00:04:14,560 --> 00:04:15,599
was looking at the server looking at

116
00:04:15,599 --> 00:04:17,600
this malware so i was sitting back in my

117
00:04:17,600 --> 00:04:19,600
chair headphones full blast listening to

118
00:04:19,600 --> 00:04:22,079
music came across this instead says

119
00:04:22,079 --> 00:04:24,320
activate sound that plays anyway access

120
00:04:24,320 --> 00:04:26,639
granted

121
00:04:26,639 --> 00:04:28,960
access denied

122
00:04:28,960 --> 00:04:31,600
access denied

123
00:04:31,600 --> 00:04:34,479
access denied

124
00:04:34,479 --> 00:04:36,160
so i guess a pretty clear message that

125
00:04:36,160 --> 00:04:37,680
they didn't want people looking around

126
00:04:37,680 --> 00:04:38,960
their server

127
00:04:38,960 --> 00:04:40,720
and then finally in the next folder on

128
00:04:40,720 --> 00:04:42,400
this

129
00:04:42,400 --> 00:04:43,520
um

130
00:04:43,520 --> 00:04:44,800
i'm not even sure how to describe this

131
00:04:44,800 --> 00:04:45,840
one james

132
00:04:45,840 --> 00:04:47,440
he's high fiving himself but thank you

133
00:04:47,440 --> 00:04:49,520
for marketing on uh

134
00:04:49,520 --> 00:04:51,360
putting in the box in there we really

135
00:04:51,360 --> 00:04:52,800
appreciate it

136
00:04:52,800 --> 00:04:55,759
we'll meet on this now

137
00:04:55,759 --> 00:04:58,080
we'll move on quickly from this one yeah

138
00:04:58,080 --> 00:04:59,520
move on to that

139
00:04:59,520 --> 00:05:01,759
um so what we did next is what and you

140
00:05:01,759 --> 00:05:03,280
could start to do is we wrote this up in

141
00:05:03,280 --> 00:05:05,039
the blog post so can i get this news out

142
00:05:05,039 --> 00:05:07,280
there

143
00:05:07,680 --> 00:05:09,840
and we wrote this post in it we're

144
00:05:09,840 --> 00:05:11,440
talking about the malware we're talking

145
00:05:11,440 --> 00:05:12,960
about how it does that kind of aws

146
00:05:12,960 --> 00:05:14,639
credit we're talking about earlier you

147
00:05:14,639 --> 00:05:16,240
can see here as well we include a

148
00:05:16,240 --> 00:05:18,160
screenshot of their home page because

149
00:05:18,160 --> 00:05:20,000
these attackers team tnt do actually

150
00:05:20,000 --> 00:05:22,479
have their own official home page and at

151
00:05:22,479 --> 00:05:24,400
this point the home page has a quite

152
00:05:24,400 --> 00:05:26,080
nice advice actually for victims it was

153
00:05:26,080 --> 00:05:27,759
saying things like here are some free

154
00:05:27,759 --> 00:05:29,840
sound boxes to analyze our malware with

155
00:05:29,840 --> 00:05:30,880
here's some other kind of stuff you

156
00:05:30,880 --> 00:05:33,440
should know too

157
00:05:34,000 --> 00:05:35,759
and when we did publish this it got

158
00:05:35,759 --> 00:05:37,120
quite a lot of attention because as we

159
00:05:37,120 --> 00:05:38,560
said before no one else has kind of

160
00:05:38,560 --> 00:05:40,880
covered this aws credit kind of method

161
00:05:40,880 --> 00:05:42,639
particularly when it came to um worms

162
00:05:42,639 --> 00:05:45,440
doing it like this

163
00:05:46,560 --> 00:05:48,560
but then the next day i think after you

164
00:05:48,560 --> 00:05:50,960
posted this we got this somewhat strange

165
00:05:50,960 --> 00:05:54,240
post uh comment on our blog post

166
00:05:54,240 --> 00:05:55,520
yeah this one was interesting one you

167
00:05:55,520 --> 00:05:58,080
don't often get a situation where

168
00:05:58,080 --> 00:06:01,680
hackers actually send you a message um

169
00:06:01,680 --> 00:06:03,360
and in this case we thought we'd share

170
00:06:03,360 --> 00:06:05,280
it because they actually were wondering

171
00:06:05,280 --> 00:06:07,840
whether or not we would um and i'll read

172
00:06:07,840 --> 00:06:09,600
out a little bit for you so they said

173
00:06:09,600 --> 00:06:11,919
you're confusing yourself free your mind

174
00:06:11,919 --> 00:06:14,319
um by the way because of your posting

175
00:06:14,319 --> 00:06:16,400
and a whole bunch of ascii text which

176
00:06:16,400 --> 00:06:18,400
obviously probably means that they were

177
00:06:18,400 --> 00:06:21,280
a bit frustrated by our post um

178
00:06:21,280 --> 00:06:23,440
you know what you are doing here is

179
00:06:23,440 --> 00:06:25,759
advertising at the expense of others now

180
00:06:25,759 --> 00:06:27,440
i'm assuming others means attackers

181
00:06:27,440 --> 00:06:29,199
because we had quite a lot of people

182
00:06:29,199 --> 00:06:30,400
actually thank us for their posts

183
00:06:30,400 --> 00:06:32,479
because help them find some malicious

184
00:06:32,479 --> 00:06:35,199
activity on their kubernetes

185
00:06:35,199 --> 00:06:36,319
environments

186
00:06:36,319 --> 00:06:38,960
um but on a positive note it was really

187
00:06:38,960 --> 00:06:40,400
nice for them to finish some of these

188
00:06:40,400 --> 00:06:43,520
sentences with sorry um so they are

189
00:06:43,520 --> 00:06:45,440
trying to be polite which is nice and of

190
00:06:45,440 --> 00:06:46,880
course they are quite curious whether or

191
00:06:46,880 --> 00:06:48,960
not we would post this comment so we've

192
00:06:48,960 --> 00:06:50,400
done one better we've talked about it at

193
00:06:50,400 --> 00:06:52,639
black hat now they definitely posted

194
00:06:52,639 --> 00:06:55,360
that comment uh considered that

195
00:06:55,360 --> 00:06:56,880
um and then they sign off with best

196
00:06:56,880 --> 00:06:59,360
regards so you know the they're trying

197
00:06:59,360 --> 00:07:01,360
their best to be formal and nice at

198
00:07:01,360 --> 00:07:04,080
least at some point so we had to go away

199
00:07:04,080 --> 00:07:05,360
and think about whether or not we were

200
00:07:05,360 --> 00:07:07,919
actually going to respond to this um

201
00:07:07,919 --> 00:07:09,599
which was which was an interesting

202
00:07:09,599 --> 00:07:11,919
thought

203
00:07:12,319 --> 00:07:13,919
yeah and i was kind of going back and

204
00:07:13,919 --> 00:07:16,000
checking their web server because it had

205
00:07:16,000 --> 00:07:18,800
a new mail on the next time we saw it um

206
00:07:18,800 --> 00:07:20,560
it had this reference to to us on it

207
00:07:20,560 --> 00:07:22,720
actually

208
00:07:22,720 --> 00:07:26,000
yeah quite nice of them

209
00:07:26,240 --> 00:07:28,240
so in response we don't send them an

210
00:07:28,240 --> 00:07:30,720
email saying that um you know trust set

211
00:07:30,720 --> 00:07:32,479
the record clear here and james wrote

212
00:07:32,479 --> 00:07:34,160
wrote this email to them

213
00:07:34,160 --> 00:07:36,000
yeah and i think um one of the points

214
00:07:36,000 --> 00:07:37,520
they pointed out in their own comment

215
00:07:37,520 --> 00:07:39,520
was that they thought we had one

216
00:07:39,520 --> 00:07:41,680
component wrong in our blog um so we

217
00:07:41,680 --> 00:07:44,319
wanted to actually ask them like why was

218
00:07:44,319 --> 00:07:47,120
it wrong and and show them our analysis

219
00:07:47,120 --> 00:07:49,759
um and indeed if it was wrong then uh we

220
00:07:49,759 --> 00:07:51,599
would update the blog and post their

221
00:07:51,599 --> 00:07:53,440
comment if they wanted to so

222
00:07:53,440 --> 00:07:55,919
um so we thought that was only fair um

223
00:07:55,919 --> 00:07:58,000
to go back with our thoughts and so i

224
00:07:58,000 --> 00:07:59,520
said thank you for taking the time to

225
00:07:59,520 --> 00:08:01,440
write to us any comments are greatly

226
00:08:01,440 --> 00:08:03,520
appreciated uh we definitely appreciate

227
00:08:03,520 --> 00:08:05,039
your update on based on the point that

228
00:08:05,039 --> 00:08:06,319
we're trying to make

229
00:08:06,319 --> 00:08:08,800
and so in a very fact-based way we said

230
00:08:08,800 --> 00:08:10,720
here's the way we explain our analysis

231
00:08:10,720 --> 00:08:13,840
here um and we also point out to you uh

232
00:08:13,840 --> 00:08:16,000
some of the other research has been done

233
00:08:16,000 --> 00:08:17,360
they said we'd love to hear your

234
00:08:17,360 --> 00:08:19,599
thoughts and confirm the above

235
00:08:19,599 --> 00:08:21,520
and get your perspective on this

236
00:08:21,520 --> 00:08:24,000
and of course if there's something wrong

237
00:08:24,000 --> 00:08:26,160
i will be happy to go make a correction

238
00:08:26,160 --> 00:08:28,879
and update our blog asap

239
00:08:28,879 --> 00:08:30,560
thanks for reaching out we look forward

240
00:08:30,560 --> 00:08:31,680
to hearing back

241
00:08:31,680 --> 00:08:34,799
um now we didn't get an email back um

242
00:08:34,799 --> 00:08:36,719
but they did make an update at least i

243
00:08:36,719 --> 00:08:39,039
guess on their site didn't make chris

244
00:08:39,039 --> 00:08:40,640
yeah so they changed it straight away

245
00:08:40,640 --> 00:08:42,880
back to this which doesn't mention us

246
00:08:42,880 --> 00:08:44,560
anymore and this says that they're gonna

247
00:08:44,560 --> 00:08:46,000
go to sleep and you won't see their

248
00:08:46,000 --> 00:08:48,480
malware anymore

249
00:08:48,480 --> 00:08:50,080
yeah very very odd and

250
00:08:50,080 --> 00:08:52,160
they were um you know they did kind of

251
00:08:52,160 --> 00:08:53,839
start a trend in that chris of them

252
00:08:53,839 --> 00:08:55,760
talking to other

253
00:08:55,760 --> 00:08:57,440
researchers as well

254
00:08:57,440 --> 00:08:58,720
yeah following on from this a lot of

255
00:08:58,720 --> 00:09:00,560
other people have had contact from them

256
00:09:00,560 --> 00:09:02,160
i think

257
00:09:02,160 --> 00:09:04,080
yeah very peculiar but uh interesting

258
00:09:04,080 --> 00:09:06,640
nonetheless

259
00:09:07,760 --> 00:09:08,880
great so

260
00:09:08,880 --> 00:09:10,640
um we're going to talk a little bit now

261
00:09:10,640 --> 00:09:12,880
about how they do exploitation and

262
00:09:12,880 --> 00:09:14,959
command control etc and kind of get into

263
00:09:14,959 --> 00:09:16,399
some of the tooling

264
00:09:16,399 --> 00:09:19,440
um but before i kick that off um you

265
00:09:19,440 --> 00:09:21,600
know we often

266
00:09:21,600 --> 00:09:23,440
obviously pull together different

267
00:09:23,440 --> 00:09:25,839
scenarios and case studies we run

268
00:09:25,839 --> 00:09:27,760
simulations as well to make sure you

269
00:09:27,760 --> 00:09:28,480
know

270
00:09:28,480 --> 00:09:30,000
we ourselves understand how to do

271
00:09:30,000 --> 00:09:32,240
forensics on compromised environments

272
00:09:32,240 --> 00:09:33,839
and in one particular case we pulled

273
00:09:33,839 --> 00:09:36,160
together a case study around vulnerable

274
00:09:36,160 --> 00:09:37,760
kubernetes environments and this was for

275
00:09:37,760 --> 00:09:39,920
a different conference um if you want to

276
00:09:39,920 --> 00:09:41,200
see uh

277
00:09:41,200 --> 00:09:42,959
this data it's actually online free to

278
00:09:42,959 --> 00:09:44,240
the community if you want to have your

279
00:09:44,240 --> 00:09:46,240
hand at humanities forensics we put a

280
00:09:46,240 --> 00:09:47,680
whole bunch of stuff on github and on

281
00:09:47,680 --> 00:09:49,760
our web page uh please do go check it

282
00:09:49,760 --> 00:09:50,480
out

283
00:09:50,480 --> 00:09:51,600
and um

284
00:09:51,600 --> 00:09:53,920
as part of this you know you you always

285
00:09:53,920 --> 00:09:56,080
wonder like have i set up this

286
00:09:56,080 --> 00:09:58,399
environment in a way where hackers do

287
00:09:58,399 --> 00:10:00,560
actually compromise it and also have

288
00:10:00,560 --> 00:10:03,279
have i simulated the same sort of events

289
00:10:03,279 --> 00:10:05,040
that an attacker would do

290
00:10:05,040 --> 00:10:07,040
um well we've got a pretty good

291
00:10:07,040 --> 00:10:09,360
verification of this because

292
00:10:09,360 --> 00:10:11,760
we stood up this uh kubernetes kind of

293
00:10:11,760 --> 00:10:14,560
case study early in the morning

294
00:10:14,560 --> 00:10:16,000
we spent a few hours running our

295
00:10:16,000 --> 00:10:18,399
simulation so compromising in a way that

296
00:10:18,399 --> 00:10:20,480
a normal attacker would and then we did

297
00:10:20,480 --> 00:10:23,040
a forensic capture of the node um only

298
00:10:23,040 --> 00:10:25,600
to find out that 30 minutes later

299
00:10:25,600 --> 00:10:28,079
team tnt just compromised the exact same

300
00:10:28,079 --> 00:10:28,959
node

301
00:10:28,959 --> 00:10:31,200
um which was kind of annoying because it

302
00:10:31,200 --> 00:10:32,720
polluted our environment that we were

303
00:10:32,720 --> 00:10:34,000
trying to do for a case study and

304
00:10:34,000 --> 00:10:36,320
another conference um

305
00:10:36,320 --> 00:10:39,200
so that was quite a quite a funny one um

306
00:10:39,200 --> 00:10:40,959
but you know case in point they

307
00:10:40,959 --> 00:10:42,720
compromised it in the same way they did

308
00:10:42,720 --> 00:10:44,640
the same thing that our simulation did

309
00:10:44,640 --> 00:10:45,680
as well

310
00:10:45,680 --> 00:10:48,240
so that was great validation for us um

311
00:10:48,240 --> 00:10:50,320
but also raises a really important point

312
00:10:50,320 --> 00:10:52,720
here um we only had this environment

313
00:10:52,720 --> 00:10:54,160
online for a day

314
00:10:54,160 --> 00:10:56,079
um you know and we were keeping an eye

315
00:10:56,079 --> 00:10:58,800
on it of course and then within that day

316
00:10:58,800 --> 00:11:01,519
it got compromised and so you know this

317
00:11:01,519 --> 00:11:03,360
is a really good point to highlight if

318
00:11:03,360 --> 00:11:05,760
you do have kind of misconfigured values

319
00:11:05,760 --> 00:11:06,959
classes out there or vulnerable

320
00:11:06,959 --> 00:11:09,040
kubernetes clusters um and they're

321
00:11:09,040 --> 00:11:11,200
public facing chances are they're

322
00:11:11,200 --> 00:11:13,760
probably already compromised so

323
00:11:13,760 --> 00:11:15,360
just who for thought there that it

324
00:11:15,360 --> 00:11:18,480
literally happens that quickly so

325
00:11:18,480 --> 00:11:20,480
an interesting one nonetheless now if

326
00:11:20,480 --> 00:11:22,560
you do need to go out and analyze your

327
00:11:22,560 --> 00:11:24,320
systems if you're if you're just rushed

328
00:11:24,320 --> 00:11:26,079
out the door because you've seen that

329
00:11:26,079 --> 00:11:28,959
slide i don't blame you but um if you do

330
00:11:28,959 --> 00:11:30,320
need to have a look there are plenty of

331
00:11:30,320 --> 00:11:32,800
log files that kubernetes generates and

332
00:11:32,800 --> 00:11:34,880
docker generates as well which helps you

333
00:11:34,880 --> 00:11:37,839
identify if you've been compromised

334
00:11:37,839 --> 00:11:39,360
but not only that you do need to kind of

335
00:11:39,360 --> 00:11:40,959
dive deep and do a little bit more

336
00:11:40,959 --> 00:11:42,560
forensics so you can truly understand

337
00:11:42,560 --> 00:11:44,880
the risk um and if you do that we

338
00:11:44,880 --> 00:11:46,720
recommend doing that on the kubernetes

339
00:11:46,720 --> 00:11:48,640
node we like to highlight this because

340
00:11:48,640 --> 00:11:50,079
some people just look at the actual

341
00:11:50,079 --> 00:11:52,480
containers themselves um you do need to

342
00:11:52,480 --> 00:11:54,000
look at the node as well it gives you

343
00:11:54,000 --> 00:11:55,839
some extra logging information there's

344
00:11:55,839 --> 00:11:58,320
also kind of file system versioning kind

345
00:11:58,320 --> 00:12:00,079
of foo happening to you which actually

346
00:12:00,079 --> 00:12:02,000
helps you with your analysis and work

347
00:12:02,000 --> 00:12:04,160
out what's going on so

348
00:12:04,160 --> 00:12:06,160
just some food thought there

349
00:12:06,160 --> 00:12:08,880
when it comes to forensic analysis again

350
00:12:08,880 --> 00:12:10,160
loads of stuff on our github page and

351
00:12:10,160 --> 00:12:11,920
stuff you can check out and that will

352
00:12:11,920 --> 00:12:15,440
help with that hopefully um now kind of

353
00:12:15,440 --> 00:12:16,880
moving on from that and it's like what

354
00:12:16,880 --> 00:12:18,639
are you looking for and how do they get

355
00:12:18,639 --> 00:12:21,920
in well again it kind of revolves around

356
00:12:21,920 --> 00:12:25,440
open apis now the actual attackers

357
00:12:25,440 --> 00:12:28,160
you know they say this wasn't a worm um

358
00:12:28,160 --> 00:12:30,240
i'll let everybody on the internet

359
00:12:30,240 --> 00:12:32,160
decide whether or not it's a worm but i

360
00:12:32,160 --> 00:12:33,360
feel like it's a little bit of like a

361
00:12:33,360 --> 00:12:34,560
worm function

362
00:12:34,560 --> 00:12:35,680
um so

363
00:12:35,680 --> 00:12:37,120
essentially what happens the attackers

364
00:12:37,120 --> 00:12:40,399
scan an ip arranged they say open apis

365
00:12:40,399 --> 00:12:43,279
they compromise those machines and then

366
00:12:43,279 --> 00:12:45,040
they do the same thing again so that

367
00:12:45,040 --> 00:12:47,040
that now compromised machine goes again

368
00:12:47,040 --> 00:12:49,680
scans new ip ranges and then compromises

369
00:12:49,680 --> 00:12:52,000
those and so on and so i don't know it

370
00:12:52,000 --> 00:12:54,000
kinda sounds like a wormy function what

371
00:12:54,000 --> 00:12:56,639
do you think chris

372
00:12:56,800 --> 00:12:59,680
yeah kind of

373
00:13:00,079 --> 00:13:02,480
what do we know um

374
00:13:02,480 --> 00:13:03,440
so

375
00:13:03,440 --> 00:13:04,800
you know so it does start with the

376
00:13:04,800 --> 00:13:06,399
kubernetes apis

377
00:13:06,399 --> 00:13:08,160
and what happens is that these are

378
00:13:08,160 --> 00:13:11,120
unauthenticated apis and public facing

379
00:13:11,120 --> 00:13:13,440
you know with no kind of um

380
00:13:13,440 --> 00:13:15,600
allow listing in place and these

381
00:13:15,600 --> 00:13:17,120
attackers are running a number of shell

382
00:13:17,120 --> 00:13:19,680
commands we've distilled just some of it

383
00:13:19,680 --> 00:13:22,000
down here for you on the screen um so

384
00:13:22,000 --> 00:13:23,440
they run a bunch of shell commands

385
00:13:23,440 --> 00:13:25,279
they'll bring down some scripts and and

386
00:13:25,279 --> 00:13:27,839
run some things um one of them is mass

387
00:13:27,839 --> 00:13:30,320
scan so they'll go and do mass scan

388
00:13:30,320 --> 00:13:33,279
across other public ip ranges the one

389
00:13:33,279 --> 00:13:35,360
interesting point here as well is that

390
00:13:35,360 --> 00:13:37,120
they'll also look at your land ranges as

391
00:13:37,120 --> 00:13:39,920
well so your local network ranges so the

392
00:13:39,920 --> 00:13:41,279
chances are if you've got one

393
00:13:41,279 --> 00:13:44,480
compromised kubernetes node uh you

394
00:13:44,480 --> 00:13:47,199
probably have others so uh by that

395
00:13:47,199 --> 00:13:49,600
virtue so um definitely need to go and

396
00:13:49,600 --> 00:13:51,199
have a look at your entire estate at

397
00:13:51,199 --> 00:13:52,800
that point because the chances are

398
00:13:52,800 --> 00:13:54,480
they're probably all configured very

399
00:13:54,480 --> 00:13:58,079
similar or if not the same

400
00:13:58,160 --> 00:14:00,480
and then they do actually pick on docker

401
00:14:00,480 --> 00:14:03,600
apis as well so do keep an eye out for

402
00:14:03,600 --> 00:14:05,839
that in addition to that in addition to

403
00:14:05,839 --> 00:14:08,240
cuban eddies and then one of the cool

404
00:14:08,240 --> 00:14:10,240
things they do do and you know shout out

405
00:14:10,240 --> 00:14:12,160
to them is that um they don't just go

406
00:14:12,160 --> 00:14:15,120
off and scan the entire internet um the

407
00:14:15,120 --> 00:14:17,440
the workers that are compromised will

408
00:14:17,440 --> 00:14:19,519
actually communicate to the attacker's

409
00:14:19,519 --> 00:14:22,160
server um they'll actually get um

410
00:14:22,160 --> 00:14:24,160
whatever the latest ip block range

411
00:14:24,160 --> 00:14:26,000
they're meant to be scanning um just so

412
00:14:26,000 --> 00:14:27,920
there's not a reputation there and it's

413
00:14:27,920 --> 00:14:30,160
a bit more efficient so very smart um

414
00:14:30,160 --> 00:14:32,160
this is actually public as well so they

415
00:14:32,160 --> 00:14:34,560
actually publicly publish how many

416
00:14:34,560 --> 00:14:36,320
infected devices they have at any one

417
00:14:36,320 --> 00:14:38,320
moment they're a little bit weird but

418
00:14:38,320 --> 00:14:40,560
kind of interesting as well um and i

419
00:14:40,560 --> 00:14:44,959
guess i've got a cool logo too press

420
00:14:44,959 --> 00:14:47,040
yeah i like a bit of ascii

421
00:14:47,040 --> 00:14:50,160
um you know so it is quite peculiar that

422
00:14:50,160 --> 00:14:52,720
they they're very public um and very

423
00:14:52,720 --> 00:14:55,920
interesting on that front

424
00:14:56,880 --> 00:14:59,120
so you saw that there was like 6000 odd

425
00:14:59,120 --> 00:15:01,279
compromised systems in that screenshot

426
00:15:01,279 --> 00:15:02,880
yeah there were a lot of people having

427
00:15:02,880 --> 00:15:05,040
problems with this and definitely back

428
00:15:05,040 --> 00:15:06,399
in the day when we first started

429
00:15:06,399 --> 00:15:08,399
noticing this activity there were lots

430
00:15:08,399 --> 00:15:10,480
of chatter on forums and stuff

431
00:15:10,480 --> 00:15:12,320
i think there was a bit of education

432
00:15:12,320 --> 00:15:15,120
needed to you know um to kind of get

433
00:15:15,120 --> 00:15:16,959
some information out there and let

434
00:15:16,959 --> 00:15:18,880
people know how these compromises were

435
00:15:18,880 --> 00:15:20,480
occurring because they didn't all

436
00:15:20,480 --> 00:15:22,079
understand what was going on and they

437
00:15:22,079 --> 00:15:24,480
were like i locked down ssh and all

438
00:15:24,480 --> 00:15:26,000
these things like how are these things

439
00:15:26,000 --> 00:15:28,720
happening um and so again another reason

440
00:15:28,720 --> 00:15:30,639
why we're here to try and help uh you

441
00:15:30,639 --> 00:15:32,160
know raise awareness and get people to

442
00:15:32,160 --> 00:15:34,000
protect themselves this one is a little

443
00:15:34,000 --> 00:15:36,160
bit funny as well uh in you know if you

444
00:15:36,160 --> 00:15:37,600
can say compromise is funny but it's a

445
00:15:37,600 --> 00:15:38,800
little bit funny that the attack

446
00:15:38,800 --> 00:15:40,480
attackers actually set up a user account

447
00:15:40,480 --> 00:15:41,839
in their own names

448
00:15:41,839 --> 00:15:44,240
um so that was the interesting one uh

449
00:15:44,240 --> 00:15:47,839
from a post that we saw at forum yeah

450
00:15:47,839 --> 00:15:50,720
a bit bit cheeky of them

451
00:15:50,720 --> 00:15:52,000
i might know one

452
00:15:52,000 --> 00:15:54,880
yeah yeah exactly uh appreciate you for

453
00:15:54,880 --> 00:15:56,480
the command control side

454
00:15:56,480 --> 00:15:59,600
all right cool uh so how do team tnt

455
00:15:59,600 --> 00:16:01,519
maintain access to these networks after

456
00:16:01,519 --> 00:16:04,240
they compromise them

457
00:16:07,680 --> 00:16:09,759
one of the ways to do it is through

458
00:16:09,759 --> 00:16:12,320
their ise bots so pretty classic stuff

459
00:16:12,320 --> 00:16:15,360
they use the ies tsunami ic bot and it

460
00:16:15,360 --> 00:16:16,720
just works which i guess the reason

461
00:16:16,720 --> 00:16:20,320
they've been using it for so long

462
00:16:20,959 --> 00:16:23,920
i see um like you know

463
00:16:23,920 --> 00:16:25,600
it's old school but it's you know it's

464
00:16:25,600 --> 00:16:27,199
always cool it's cool to still see it

465
00:16:27,199 --> 00:16:28,480
kicking around

466
00:16:28,480 --> 00:16:30,160
more ascii out there as you can see on

467
00:16:30,160 --> 00:16:31,839
there tnt

468
00:16:31,839 --> 00:16:32,560
hub

469
00:16:32,560 --> 00:16:34,880
weight on my heart

470
00:16:34,880 --> 00:16:36,480
so i connected into their server last

471
00:16:36,480 --> 00:16:39,839
week and you can see here um 221 clients

472
00:16:39,839 --> 00:16:43,120
connected in so that's 220 victims and

473
00:16:43,120 --> 00:16:45,759
one attacker as well

474
00:16:45,759 --> 00:16:47,839
um and also you can look on the right

475
00:16:47,839 --> 00:16:50,079
side there has a decompiled um ipa

476
00:16:50,079 --> 00:16:51,920
address as well so that's how they

477
00:16:51,920 --> 00:16:54,000
connect and they can point it directly

478
00:16:54,000 --> 00:16:55,839
there

479
00:16:55,839 --> 00:16:56,959
getting ahead of myself there chris

480
00:16:56,959 --> 00:16:59,439
there you go

481
00:16:59,600 --> 00:17:02,240
also they use weavscope which is a

482
00:17:02,240 --> 00:17:03,680
perfectly legitimate kubernetes

483
00:17:03,680 --> 00:17:05,199
administration tool

484
00:17:05,199 --> 00:17:06,959
and the cool thing about reefscope is

485
00:17:06,959 --> 00:17:08,240
that you've got this beautiful kind of

486
00:17:08,240 --> 00:17:10,880
graphical interface so you can go and

487
00:17:10,880 --> 00:17:13,199
you can click stuff and start and stop

488
00:17:13,199 --> 00:17:15,119
containers and they actually install

489
00:17:15,119 --> 00:17:17,280
this on the host stuff they compromise

490
00:17:17,280 --> 00:17:19,439
them and the other thing they do as well

491
00:17:19,439 --> 00:17:21,839
is they will actually look for open

492
00:17:21,839 --> 00:17:23,359
weave scope installations and just

493
00:17:23,359 --> 00:17:26,958
connect and compromise that way too

494
00:17:28,559 --> 00:17:30,080
there are actually a ton of other back

495
00:17:30,080 --> 00:17:32,240
doors they do as well so i won't go

496
00:17:32,240 --> 00:17:33,919
through all of these because they're

497
00:17:33,919 --> 00:17:35,200
generally the same as other crypto

498
00:17:35,200 --> 00:17:37,280
mining worms the one that i will pull

499
00:17:37,280 --> 00:17:39,280
out here is teammate

500
00:17:39,280 --> 00:17:41,520
and teammate is all like t-mux if you've

501
00:17:41,520 --> 00:17:43,280
ever used that one before so if you're a

502
00:17:43,280 --> 00:17:45,760
linux user you might have used tmux it

503
00:17:45,760 --> 00:17:48,400
means that i can sit on my laptop you're

504
00:17:48,400 --> 00:17:50,720
on your laptop you can kind of both type

505
00:17:50,720 --> 00:17:52,640
and do some screen sharing stuff

506
00:17:52,640 --> 00:17:54,720
and teammate is a bit like tmux but it

507
00:17:54,720 --> 00:17:56,000
can toggle through nuts and do some

508
00:17:56,000 --> 00:17:57,679
other stuff that makes it easier to

509
00:17:57,679 --> 00:18:00,679
deploy

510
00:18:01,840 --> 00:18:06,000
so how the team tmd do privesque

511
00:18:06,880 --> 00:18:08,480
well if you remember right at the

512
00:18:08,480 --> 00:18:09,679
beginning of the talk

513
00:18:09,679 --> 00:18:11,120
we were showing how they were stealing

514
00:18:11,120 --> 00:18:13,600
some aws credential files they still do

515
00:18:13,600 --> 00:18:15,039
that but they're actually a lot more

516
00:18:15,039 --> 00:18:16,480
sophisticated when they're on than they

517
00:18:16,480 --> 00:18:17,679
were back then

518
00:18:17,679 --> 00:18:19,360
so here we can see that they're stealing

519
00:18:19,360 --> 00:18:20,720
at the top of this script the

520
00:18:20,720 --> 00:18:22,799
environment variables the system so

521
00:18:22,799 --> 00:18:25,039
there are passwords there and then just

522
00:18:25,039 --> 00:18:26,720
after that they're selling the docker

523
00:18:26,720 --> 00:18:28,559
environment variables so it's actually

524
00:18:28,559 --> 00:18:30,000
pretty similar to um the other

525
00:18:30,000 --> 00:18:31,440
environment variables but really

526
00:18:31,440 --> 00:18:32,640
important if you are attacking

527
00:18:32,640 --> 00:18:34,880
kubernetes systems and at the bottom of

528
00:18:34,880 --> 00:18:36,160
this script they're still seeing the

529
00:18:36,160 --> 00:18:38,400
root ns credentials files but now they

530
00:18:38,400 --> 00:18:39,760
clean them up a bit they're gripping

531
00:18:39,760 --> 00:18:41,840
them out like having some templating so

532
00:18:41,840 --> 00:18:43,039
getting a little bit more sophisticated

533
00:18:43,039 --> 00:18:45,440
there too

534
00:18:47,120 --> 00:18:48,799
and then this is pretty unique as well

535
00:18:48,799 --> 00:18:51,440
actually so what they do now as of a few

536
00:18:51,440 --> 00:18:53,440
months ago is they'll scrape the ada

537
00:18:53,440 --> 00:18:56,320
best metadata url so hit that magic ip

538
00:18:56,320 --> 00:18:59,200
address there one six nine dot whatever

539
00:18:59,200 --> 00:19:01,440
and what that gives you is things like

540
00:19:01,440 --> 00:19:03,200
what reason you're running in also

541
00:19:03,200 --> 00:19:05,120
things like the secret key and the

542
00:19:05,120 --> 00:19:07,440
access key and some of the other data as

543
00:19:07,440 --> 00:19:09,360
well around your system

544
00:19:09,360 --> 00:19:11,200
and if you can remember the capital one

545
00:19:11,200 --> 00:19:12,960
breach that was actually really a big

546
00:19:12,960 --> 00:19:14,400
part of that too with capital one the

547
00:19:14,400 --> 00:19:16,320
attacker stole the credits from the

548
00:19:16,320 --> 00:19:19,039
metadata url and that laptop pulled down

549
00:19:19,039 --> 00:19:20,559
some really sensitive information from

550
00:19:20,559 --> 00:19:21,840
s3

551
00:19:21,840 --> 00:19:23,679
and then finally at the bottom of this

552
00:19:23,679 --> 00:19:26,400
you'll see another magic ip address and

553
00:19:26,400 --> 00:19:28,480
that is the amazon elastic kubernetes

554
00:19:28,480 --> 00:19:30,559
service ip they're hitting that to also

555
00:19:30,559 --> 00:19:32,720
steal credentials there too so some more

556
00:19:32,720 --> 00:19:34,640
kind of amazon kubernetes specific stuff

557
00:19:34,640 --> 00:19:38,600
they're coming out with now too

558
00:19:39,919 --> 00:19:42,480
and it's not just aws so here we can see

559
00:19:42,480 --> 00:19:44,720
team tnt stealing a ton of credential

560
00:19:44,720 --> 00:19:47,440
files including the gcp so google cloud

561
00:19:47,440 --> 00:19:49,360
credential files there's other stuff

562
00:19:49,360 --> 00:19:52,080
there too like the ssh keys um there's

563
00:19:52,080 --> 00:19:54,080
things like filezilla so tons of stuff

564
00:19:54,080 --> 00:19:56,799
they still know

565
00:19:58,640 --> 00:20:00,720
and uh just in case azure is feeling

566
00:20:00,720 --> 00:20:02,880
left out they now support azure as well

567
00:20:02,880 --> 00:20:05,039
or they're about to so they actually

568
00:20:05,039 --> 00:20:06,320
give a heads up of what's about to

569
00:20:06,320 --> 00:20:08,480
happen often from their official twitter

570
00:20:08,480 --> 00:20:09,919
account

571
00:20:09,919 --> 00:20:11,039
it's really nice let me give them a

572
00:20:11,039 --> 00:20:12,880
heads up again another kind of odd thing

573
00:20:12,880 --> 00:20:15,039
isn't it chris like they're very vocal

574
00:20:15,039 --> 00:20:16,880
um but a nice one to give researchers a

575
00:20:16,880 --> 00:20:18,720
heads up that they're about to target as

576
00:20:18,720 --> 00:20:22,159
years so um it's more like a product

577
00:20:22,159 --> 00:20:23,840
support uh

578
00:20:23,840 --> 00:20:26,640
announcement isn't it yeah very odd

579
00:20:26,640 --> 00:20:29,120
they are a lot more charlie than average

580
00:20:29,120 --> 00:20:30,559
hackers

581
00:20:30,559 --> 00:20:32,320
and um i mean yeah just going through

582
00:20:32,320 --> 00:20:34,000
just a couple of these so here they're

583
00:20:34,000 --> 00:20:35,919
applying some researchers saying that

584
00:20:35,919 --> 00:20:37,120
they're finding it really tough now

585
00:20:37,120 --> 00:20:38,799
because aws is recognizing when they're

586
00:20:38,799 --> 00:20:40,799
stealing those keys really quickly

587
00:20:40,799 --> 00:20:41,679
so

588
00:20:41,679 --> 00:20:45,120
good work from aws there

589
00:20:46,080 --> 00:20:48,080
and then sometimes just weird they have

590
00:20:48,080 --> 00:20:50,000
like a fan club on twitter now as well

591
00:20:50,000 --> 00:20:51,039
so

592
00:20:51,039 --> 00:20:55,679
omg hacker family all that kind of stuff

593
00:20:55,919 --> 00:20:58,559
sad sometimes isn't it

594
00:20:58,559 --> 00:21:00,840
but funny

595
00:21:00,840 --> 00:21:02,559
yeah

596
00:21:02,559 --> 00:21:04,159
and then uh here are a few other ways to

597
00:21:04,159 --> 00:21:07,120
do proves as well

598
00:21:07,600 --> 00:21:09,520
so one kind of smart thing they do is

599
00:21:09,520 --> 00:21:12,240
they use a tool called docker escape off

600
00:21:12,240 --> 00:21:14,640
github

601
00:21:14,640 --> 00:21:16,640
i love the name does what it says on the

602
00:21:16,640 --> 00:21:18,159
gym

603
00:21:18,159 --> 00:21:20,000
yeah it's pretty uh yeah what does it

604
00:21:20,000 --> 00:21:21,600
escape some docker um and they do that

605
00:21:21,600 --> 00:21:23,600
through some sockets so there are some

606
00:21:23,600 --> 00:21:25,360
network sockets and file sockets they

607
00:21:25,360 --> 00:21:27,440
used to break out also in particular

608
00:21:27,440 --> 00:21:28,880
exploits as well

609
00:21:28,880 --> 00:21:30,240
and what they've done there is they've

610
00:21:30,240 --> 00:21:32,159
uploaded it to docker hub so it's just

611
00:21:32,159 --> 00:21:34,159
easier to deploy australia's container

612
00:21:34,159 --> 00:21:35,840
and full credit here to aquaset for

613
00:21:35,840 --> 00:21:38,799
finding this one first

614
00:21:39,919 --> 00:21:41,600
another tool they run is called break

615
00:21:41,600 --> 00:21:43,600
out the box or botb

616
00:21:43,600 --> 00:21:44,960
and you can kind of see from the command

617
00:21:44,960 --> 00:21:46,960
they're running here while it does so it

618
00:21:46,960 --> 00:21:49,760
scrapes uh google cloud credentials some

619
00:21:49,760 --> 00:21:51,760
other metadata too also still some

620
00:21:51,760 --> 00:21:54,879
kubernetes sequence as well

621
00:21:56,000 --> 00:21:58,159
and then we've got payrolties and

622
00:21:58,159 --> 00:21:59,760
pillaries is quite similar to breakout

623
00:21:59,760 --> 00:22:01,919
of the box actually it also has some

624
00:22:01,919 --> 00:22:03,760
kind of cloud and container specific

625
00:22:03,760 --> 00:22:06,158
attacks

626
00:22:07,520 --> 00:22:09,840
and then this is my favorite one um so

627
00:22:09,840 --> 00:22:12,000
if you ever use infection monkey before

628
00:22:12,000 --> 00:22:14,320
infection monkey is kind of like a

629
00:22:14,320 --> 00:22:16,559
friendly aws worm you deploy it in your

630
00:22:16,559 --> 00:22:18,559
account you set up an infection monkey

631
00:22:18,559 --> 00:22:20,400
server and then it tunnels through your

632
00:22:20,400 --> 00:22:22,080
account and it will tell you like what

633
00:22:22,080 --> 00:22:24,159
questions are insecure it kind of works

634
00:22:24,159 --> 00:22:25,679
its way through and gives you a really

635
00:22:25,679 --> 00:22:28,240
nice kind of heads up there but what

636
00:22:28,240 --> 00:22:29,840
team tmt were doing for a little while

637
00:22:29,840 --> 00:22:31,840
and this was spotted by tencent is they

638
00:22:31,840 --> 00:22:32,799
were actually running their own

639
00:22:32,799 --> 00:22:34,720
infection monkey server compromising

640
00:22:34,720 --> 00:22:36,080
other people's networks and then

641
00:22:36,080 --> 00:22:37,919
pointing this back at their server to

642
00:22:37,919 --> 00:22:38,960
get some more information around the

643
00:22:38,960 --> 00:22:40,960
networks that was that was kind of an

644
00:22:40,960 --> 00:22:43,360
odd one

645
00:22:45,280 --> 00:22:46,640
and we've gone through kind of a couple

646
00:22:46,640 --> 00:22:48,240
of the tools that they use but there's

647
00:22:48,240 --> 00:22:50,559
actually so much more if we had time to

648
00:22:50,559 --> 00:22:51,679
go into it

649
00:22:51,679 --> 00:22:54,400
so this is a screenshot of one of the

650
00:22:54,400 --> 00:22:56,000
folders from one of their servers

651
00:22:56,000 --> 00:22:58,799
showing some of their custom tooling and

652
00:22:58,799 --> 00:23:00,000
some of the other things that they're

653
00:23:00,000 --> 00:23:01,919
doing here they're doing things like

654
00:23:01,919 --> 00:23:04,480
cleaning up old logs their ssh brake

655
00:23:04,480 --> 00:23:05,520
forcing

656
00:23:05,520 --> 00:23:07,840
they're exploiting redis systems and

657
00:23:07,840 --> 00:23:10,000
installing some custom drivers as well

658
00:23:10,000 --> 00:23:11,200
there's a ton of different stuff these

659
00:23:11,200 --> 00:23:13,120
guys do actually and at the end of the

660
00:23:13,120 --> 00:23:14,799
talk we include some references so if

661
00:23:14,799 --> 00:23:16,080
you're interested in you know what else

662
00:23:16,080 --> 00:23:19,600
they do there's a lot more to hear

663
00:23:20,840 --> 00:23:23,200
about oh thanks chris i think it goes

664
00:23:23,200 --> 00:23:24,640
without saying you know they're very

665
00:23:24,640 --> 00:23:27,280
vocal there's lots of um information

666
00:23:27,280 --> 00:23:29,679
online uh just be careful if you go

667
00:23:29,679 --> 00:23:31,520
poking around then make sure you know

668
00:23:31,520 --> 00:23:33,200
what you're doing uh don't go just

669
00:23:33,200 --> 00:23:34,720
clicking on stuff because you might end

670
00:23:34,720 --> 00:23:36,880
up being compromised yourself so just

671
00:23:36,880 --> 00:23:39,120
like a be careful at home kids kind of

672
00:23:39,120 --> 00:23:40,240
message

673
00:23:40,240 --> 00:23:42,640
people before people go jump out and

674
00:23:42,640 --> 00:23:43,919
look at those ips and everything and

675
00:23:43,919 --> 00:23:45,600
links we've just put on the uh on the

676
00:23:45,600 --> 00:23:46,559
slides

677
00:23:46,559 --> 00:23:47,440
so

678
00:23:47,440 --> 00:23:49,600
um so nextbit is kind of like you know

679
00:23:49,600 --> 00:23:51,919
why are they doing this right and

680
00:23:51,919 --> 00:23:53,840
um unfortunately the first answer to

681
00:23:53,840 --> 00:23:56,880
that is is not very sexy um

682
00:23:56,880 --> 00:23:59,440
but pretty obvious um the second answer

683
00:23:59,440 --> 00:24:01,360
to that is more around like what could

684
00:24:01,360 --> 00:24:02,240
you do

685
00:24:02,240 --> 00:24:04,480
and that's the scarier one and we wanted

686
00:24:04,480 --> 00:24:06,720
to make sure we kind of touched on that

687
00:24:06,720 --> 00:24:09,520
in our presentation make sure we kind of

688
00:24:09,520 --> 00:24:10,960
get you know some of this information

689
00:24:10,960 --> 00:24:13,760
out there and again uh have people

690
00:24:13,760 --> 00:24:15,039
looking into their kubernetes

691
00:24:15,039 --> 00:24:16,480
configurations and their environments

692
00:24:16,480 --> 00:24:18,640
make sure they protect themselves from

693
00:24:18,640 --> 00:24:20,159
such attacks

694
00:24:20,159 --> 00:24:21,200
and so

695
00:24:21,200 --> 00:24:23,600
the first reason is well they do it for

696
00:24:23,600 --> 00:24:27,279
crypto mining um yeah i know not too

697
00:24:27,279 --> 00:24:30,559
exciting right um and we all know crypto

698
00:24:30,559 --> 00:24:33,840
mining on cpus particularly you know in

699
00:24:33,840 --> 00:24:36,400
containers is probably not the most

700
00:24:36,400 --> 00:24:38,720
efficient option um but they do have

701
00:24:38,720 --> 00:24:40,799
quite a lot of machines say you know

702
00:24:40,799 --> 00:24:43,120
what maybe maybe it is maybe they do get

703
00:24:43,120 --> 00:24:44,880
a little bit of something out of it

704
00:24:44,880 --> 00:24:47,200
um but i think what i'm more concerned

705
00:24:47,200 --> 00:24:49,120
about is what could actually happen and

706
00:24:49,120 --> 00:24:50,880
as you saw before you know they go ahead

707
00:24:50,880 --> 00:24:52,960
and steal credentials whether they be in

708
00:24:52,960 --> 00:24:56,000
aws or gcp and you know azure coming

709
00:24:56,000 --> 00:24:58,720
soon right um and say you know what

710
00:24:58,720 --> 00:25:00,559
could you be doing with that sort of

711
00:25:00,559 --> 00:25:02,640
information which people might not be

712
00:25:02,640 --> 00:25:06,880
seeing or uh is yet to happen

713
00:25:06,960 --> 00:25:08,720
and you know just

714
00:25:08,720 --> 00:25:09,679
and a lot of people kind of think of

715
00:25:09,679 --> 00:25:11,360
that hole it won't happen to me thing

716
00:25:11,360 --> 00:25:13,600
but um i put this one in here because if

717
00:25:13,600 --> 00:25:16,080
you have been compromised by a crypto

718
00:25:16,080 --> 00:25:17,679
mining worm in your kubernetes

719
00:25:17,679 --> 00:25:18,799
environment

720
00:25:18,799 --> 00:25:20,240
and that was the only thing that

721
00:25:20,240 --> 00:25:22,320
happened i would consider that a very

722
00:25:22,320 --> 00:25:24,000
much a shot over the bowels and consider

723
00:25:24,000 --> 00:25:26,000
yourself lucky so make sure you have

724
00:25:26,000 --> 00:25:28,320
gone and actually remediated uh what the

725
00:25:28,320 --> 00:25:30,159
underlying root cause was an issue there

726
00:25:30,159 --> 00:25:31,679
and you've investigated done some

727
00:25:31,679 --> 00:25:33,279
forensics around that

728
00:25:33,279 --> 00:25:34,640
um so

729
00:25:34,640 --> 00:25:36,400
let's kind of talk a little bit more

730
00:25:36,400 --> 00:25:39,279
scary then what could actually happen

731
00:25:39,279 --> 00:25:41,360
well let's start on the kubernetes sides

732
00:25:41,360 --> 00:25:43,279
on the nodes themselves and kind of

733
00:25:43,279 --> 00:25:45,360
risks that it could represent

734
00:25:45,360 --> 00:25:46,799
well one of the ones which seems the

735
00:25:46,799 --> 00:25:49,039
most obvious is data excel so a lot of

736
00:25:49,039 --> 00:25:50,480
these containers have access to

737
00:25:50,480 --> 00:25:52,880
databases with sensitive information or

738
00:25:52,880 --> 00:25:55,279
file shares and so an attacker could

739
00:25:55,279 --> 00:25:57,120
obviously spend a little bit more time

740
00:25:57,120 --> 00:25:58,880
on these containers and actually start

741
00:25:58,880 --> 00:26:01,200
stealing some data

742
00:26:01,200 --> 00:26:03,279
and then that can even lead to ransom to

743
00:26:03,279 --> 00:26:05,200
holding your data to ransom or looking

744
00:26:05,200 --> 00:26:08,720
to disrupt your system say you know they

745
00:26:08,720 --> 00:26:10,159
have to spend a little bit more time to

746
00:26:10,159 --> 00:26:12,159
do this but if they do

747
00:26:12,159 --> 00:26:14,799
um you know it can have a big effect and

748
00:26:14,799 --> 00:26:16,400
the other thing as well is it's quite

749
00:26:16,400 --> 00:26:19,039
hard to spot um a lot of people don't

750
00:26:19,039 --> 00:26:20,640
tend to do investigations when it

751
00:26:20,640 --> 00:26:23,039
involves containers and kubernetes

752
00:26:23,039 --> 00:26:25,360
especially uh find it hard to dive in

753
00:26:25,360 --> 00:26:27,440
deep on the forensic side so that's

754
00:26:27,440 --> 00:26:29,120
something that we do need to start doing

755
00:26:29,120 --> 00:26:31,600
more and more um you know in order to

756
00:26:31,600 --> 00:26:33,600
find uh kind of what the underlying root

757
00:26:33,600 --> 00:26:35,360
causes are and the actual risk that's

758
00:26:35,360 --> 00:26:37,520
happening rather than just crypto mining

759
00:26:37,520 --> 00:26:40,320
running and then blowing it away

760
00:26:40,320 --> 00:26:42,559
the one that's really scary as well is

761
00:26:42,559 --> 00:26:45,039
you know a lot of these containers run

762
00:26:45,039 --> 00:26:46,720
kind of web apps or you know web

763
00:26:46,720 --> 00:26:48,960
services and you know you could inject

764
00:26:48,960 --> 00:26:50,720
some code in there you could be running

765
00:26:50,720 --> 00:26:52,640
drive by downloads you know the world is

766
00:26:52,640 --> 00:26:55,120
your oyster right and you could go ahead

767
00:26:55,120 --> 00:26:58,080
and crop data and you know and therefore

768
00:26:58,080 --> 00:27:00,559
potentially compromise your users so now

769
00:27:00,559 --> 00:27:02,400
you are the third party arrest as a

770
00:27:02,400 --> 00:27:04,400
result of your compromised kubernetes

771
00:27:04,400 --> 00:27:07,760
environment they super fought there

772
00:27:07,760 --> 00:27:09,600
now the more kind of even more scary

773
00:27:09,600 --> 00:27:12,640
side and not to be too scary i guess but

774
00:27:12,640 --> 00:27:14,240
it is scary and it is something that can

775
00:27:14,240 --> 00:27:15,919
happen and may have already happened we

776
00:27:15,919 --> 00:27:19,360
just haven't seen it um is is you know

777
00:27:19,360 --> 00:27:21,039
with those credentials they're stealing

778
00:27:21,039 --> 00:27:23,520
you can potentially use that to spin up

779
00:27:23,520 --> 00:27:26,799
or even destroy resources as well um so

780
00:27:26,799 --> 00:27:29,200
i've definitely seen gpu resources being

781
00:27:29,200 --> 00:27:31,600
spun up used for crypto mining um that's

782
00:27:31,600 --> 00:27:33,120
a little bit more obvious when your

783
00:27:33,120 --> 00:27:35,360
account starts draining um full of

784
00:27:35,360 --> 00:27:38,399
credits but you know when it comes to

785
00:27:38,399 --> 00:27:40,399
destroying resources is also something

786
00:27:40,399 --> 00:27:42,720
to consider as well that can be quite

787
00:27:42,720 --> 00:27:44,080
disruptive

788
00:27:44,080 --> 00:27:45,919
you can also use those credentials to

789
00:27:45,919 --> 00:27:48,240
access other parts of the environment

790
00:27:48,240 --> 00:27:51,120
what happens is that a lot of customers

791
00:27:51,120 --> 00:27:52,720
and people out there are setting up

792
00:27:52,720 --> 00:27:55,440
these environments and aws credentials

793
00:27:55,440 --> 00:27:57,600
and gcp credentials with excess

794
00:27:57,600 --> 00:27:59,679
privileges and part of the reason of

795
00:27:59,679 --> 00:28:01,600
that is because identity and access

796
00:28:01,600 --> 00:28:03,679
management is hard and it's definitely

797
00:28:03,679 --> 00:28:05,039
hard for cloud as well it's very

798
00:28:05,039 --> 00:28:06,559
complicated and there's lots of

799
00:28:06,559 --> 00:28:08,000
solutions out there to kind of help with

800
00:28:08,000 --> 00:28:10,480
that which i'm going to but

801
00:28:10,480 --> 00:28:13,039
um one part of of that is the fact that

802
00:28:13,039 --> 00:28:15,200
the reason why it's hard well because

803
00:28:15,200 --> 00:28:17,679
it's hard is um you know people just

804
00:28:17,679 --> 00:28:19,039
want things to work and so they add

805
00:28:19,039 --> 00:28:21,520
access privileges to those accounts just

806
00:28:21,520 --> 00:28:23,840
to make things work um and that presents

807
00:28:23,840 --> 00:28:25,919
the risk lets people access other parts

808
00:28:25,919 --> 00:28:28,399
of the environment etc and the same goes

809
00:28:28,399 --> 00:28:30,399
with those credits you can even create

810
00:28:30,399 --> 00:28:32,880
accounts and k we actually did a case

811
00:28:32,880 --> 00:28:34,559
study where we proved you could use

812
00:28:34,559 --> 00:28:36,480
those privileges and stuff like that to

813
00:28:36,480 --> 00:28:38,880
create accounts and then you know and

814
00:28:38,880 --> 00:28:41,279
then that can actually lead to console

815
00:28:41,279 --> 00:28:42,960
access which is pretty

816
00:28:42,960 --> 00:28:44,720
pretty crazy right like if you can think

817
00:28:44,720 --> 00:28:47,279
about an attacker creating an account

818
00:28:47,279 --> 00:28:49,360
and then accessing your aws or your

819
00:28:49,360 --> 00:28:52,320
azure or your gcp console you know no

820
00:28:52,320 --> 00:28:54,159
matter what endpoint solution you're

821
00:28:54,159 --> 00:28:55,840
running across your cloud estate you're

822
00:28:55,840 --> 00:28:57,840
not going to spot that and they could go

823
00:28:57,840 --> 00:29:00,000
in and they could disrupt things or hold

824
00:29:00,000 --> 00:29:02,159
that account to ransom you name it like

825
00:29:02,159 --> 00:29:04,320
the world is your oyster as an attacker

826
00:29:04,320 --> 00:29:06,320
at that point um

827
00:29:06,320 --> 00:29:08,880
is this happening we're not sure um has

828
00:29:08,880 --> 00:29:10,559
it happened we're not sure either but

829
00:29:10,559 --> 00:29:12,159
certainly it's probably happened to some

830
00:29:12,159 --> 00:29:13,919
extent it's just that people don't

831
00:29:13,919 --> 00:29:16,080
investigate deep enough to actually see

832
00:29:16,080 --> 00:29:17,200
this happening and that's where you need

833
00:29:17,200 --> 00:29:18,640
to actually do forensics on your human

834
00:29:18,640 --> 00:29:20,399
native environments and you also need to

835
00:29:20,399 --> 00:29:22,159
have a few forensics on your cloud data

836
00:29:22,159 --> 00:29:23,360
as well and actually start piecing

837
00:29:23,360 --> 00:29:25,279
together this part

838
00:29:25,279 --> 00:29:27,039
but something to be aware of and

839
00:29:27,039 --> 00:29:28,720
something that you should look to

840
00:29:28,720 --> 00:29:30,799
protect yourself against

841
00:29:30,799 --> 00:29:32,960
but you know what it sounds very doom

842
00:29:32,960 --> 00:29:35,919
and gloom uh ironically like a lot of

843
00:29:35,919 --> 00:29:37,760
things there's some quite simple ways

844
00:29:37,760 --> 00:29:39,200
you can do to kind of protect yourself

845
00:29:39,200 --> 00:29:41,200
against this and so this is something we

846
00:29:41,200 --> 00:29:43,840
kind of wanted to you know finish up on

847
00:29:43,840 --> 00:29:45,120
just to make sure you had some key

848
00:29:45,120 --> 00:29:47,760
takeaways to go home and make sure that

849
00:29:47,760 --> 00:29:49,840
you're in the right state

850
00:29:49,840 --> 00:29:51,039
and so

851
00:29:51,039 --> 00:29:53,360
it sounds all basic but there are people

852
00:29:53,360 --> 00:29:55,760
not doing this and the first one is

853
00:29:55,760 --> 00:29:57,600
secure your api

854
00:29:57,600 --> 00:29:59,600
and they so that's about setting up

855
00:29:59,600 --> 00:30:01,760
authentication but not just that but

856
00:30:01,760 --> 00:30:03,679
doing things like allow listing and

857
00:30:03,679 --> 00:30:05,679
firewall rule sets just to make sure

858
00:30:05,679 --> 00:30:07,760
that only the machines

859
00:30:07,760 --> 00:30:10,159
and the servers or you know parts of the

860
00:30:10,159 --> 00:30:11,600
network

861
00:30:11,600 --> 00:30:14,080
that are required to talk to your api uh

862
00:30:14,080 --> 00:30:16,080
do and not just the whole entire

863
00:30:16,080 --> 00:30:18,480
internet which is you know not a great

864
00:30:18,480 --> 00:30:19,360
thing

865
00:30:19,360 --> 00:30:21,120
and then the other one as well as you

866
00:30:21,120 --> 00:30:23,039
know we say aws credentials here it's

867
00:30:23,039 --> 00:30:24,240
just some you know it's just because

868
00:30:24,240 --> 00:30:27,200
we've looked at aws a lot um you know

869
00:30:27,200 --> 00:30:29,760
this also reflects on gcp and azure as

870
00:30:29,760 --> 00:30:32,159
well you know make sure your credential

871
00:30:32,159 --> 00:30:35,279
usage is proper and correct um in your

872
00:30:35,279 --> 00:30:37,279
containers a lot of people don't think

873
00:30:37,279 --> 00:30:38,960
this is a problem because containers

874
00:30:38,960 --> 00:30:40,880
spin up and down so therefore you know

875
00:30:40,880 --> 00:30:42,159
the data is going to disappear and it's

876
00:30:42,159 --> 00:30:44,399
not a security risk it absolutely is a

877
00:30:44,399 --> 00:30:46,240
security risk so make sure you're using

878
00:30:46,240 --> 00:30:48,240
credentials in a safe manner in your

879
00:30:48,240 --> 00:30:50,320
containers and where you do have to use

880
00:30:50,320 --> 00:30:52,399
credentials make sure you are assigning

881
00:30:52,399 --> 00:30:54,799
least privilege um and make sure those

882
00:30:54,799 --> 00:30:56,559
privileges are only doing specifically

883
00:30:56,559 --> 00:30:59,200
what you need them to do they don't need

884
00:30:59,200 --> 00:31:01,760
admin access to your entire estate like

885
00:31:01,760 --> 00:31:03,679
why the hell does you need credentials

886
00:31:03,679 --> 00:31:05,760
to the point where you can you know

887
00:31:05,760 --> 00:31:07,440
create an account in the console that's

888
00:31:07,440 --> 00:31:10,080
pretty crazy too so you know spoof

889
00:31:10,080 --> 00:31:12,000
report there

890
00:31:12,000 --> 00:31:14,080
um definitely some pretty obvious ones

891
00:31:14,080 --> 00:31:15,840
around reviewing network traffic so look

892
00:31:15,840 --> 00:31:18,480
for mining pools and mining protocols

893
00:31:18,480 --> 00:31:20,960
this goes for um on-prem as well as

894
00:31:20,960 --> 00:31:22,799
cloud as well so just keep an eye out

895
00:31:22,799 --> 00:31:23,919
for that

896
00:31:23,919 --> 00:31:25,360
yeah this one's a bit of a cheeky

897
00:31:25,360 --> 00:31:27,440
recommendation like obviously if you see

898
00:31:27,440 --> 00:31:29,919
your credentials flying out through http

899
00:31:29,919 --> 00:31:32,880
um that's usually a bad sign um but

900
00:31:32,880 --> 00:31:34,960
that's what happens um

901
00:31:34,960 --> 00:31:35,760
so

902
00:31:35,760 --> 00:31:38,159
you know we put it in there um

903
00:31:38,159 --> 00:31:39,440
you know and then some other ones around

904
00:31:39,440 --> 00:31:41,200
general kind of things that you should

905
00:31:41,200 --> 00:31:42,799
be doing anyway so you're not using

906
00:31:42,799 --> 00:31:44,960
passwords and using key files etc and

907
00:31:44,960 --> 00:31:47,519
locking down your remote access

908
00:31:47,519 --> 00:31:49,200
and then the one that's a bit of a bug

909
00:31:49,200 --> 00:31:50,799
bear for me just because i come across

910
00:31:50,799 --> 00:31:53,440
so many compromises with customers over

911
00:31:53,440 --> 00:31:55,919
you know the last 10 years or so where

912
00:31:55,919 --> 00:31:56,880
people

913
00:31:56,880 --> 00:31:58,799
forget about the developer and test

914
00:31:58,799 --> 00:32:00,960
environments and you know they tend to

915
00:32:00,960 --> 00:32:03,440
have quite good controls over uh the

916
00:32:03,440 --> 00:32:05,279
production environments and they're

917
00:32:05,279 --> 00:32:07,120
quite locked down and a lot of the

918
00:32:07,120 --> 00:32:09,039
assessment tends to happen around

919
00:32:09,039 --> 00:32:10,480
production only

920
00:32:10,480 --> 00:32:11,760
when it comes to fan testing and stuff

921
00:32:11,760 --> 00:32:13,279
like that but they never think about the

922
00:32:13,279 --> 00:32:14,559
developer environments in the test

923
00:32:14,559 --> 00:32:16,880
environments and those are just as

924
00:32:16,880 --> 00:32:18,799
vulnerable if not even more vulnerable

925
00:32:18,799 --> 00:32:20,720
because they tend to have

926
00:32:20,720 --> 00:32:22,720
excess privileges tend to be a bit more

927
00:32:22,720 --> 00:32:25,039
wild west so make sure you're keeping an

928
00:32:25,039 --> 00:32:26,799
eye out for those because those can lead

929
00:32:26,799 --> 00:32:28,720
to potential access to your production

930
00:32:28,720 --> 00:32:31,279
environment as well so and also have a

931
00:32:31,279 --> 00:32:33,760
sense of data and magic

932
00:32:33,760 --> 00:32:35,840
so there's some key kind of takeaways

933
00:32:35,840 --> 00:32:37,679
some of them seem quite basic but if i'm

934
00:32:37,679 --> 00:32:39,440
honest sometimes it only takes basic

935
00:32:39,440 --> 00:32:42,720
things to solve these problems um so

936
00:32:42,720 --> 00:32:44,399
you know it does play in part that there

937
00:32:44,399 --> 00:32:46,480
is complexity to the cloud and so you

938
00:32:46,480 --> 00:32:49,120
need to make the cloud less complex in

939
00:32:49,120 --> 00:32:50,880
order to understand you know to

940
00:32:50,880 --> 00:32:52,799
introduce these basic things

941
00:32:52,799 --> 00:32:53,840
but um

942
00:32:53,840 --> 00:32:55,519
just in wrapping up we do want to kind

943
00:32:55,519 --> 00:32:57,120
of acknowledge some of the

944
00:32:57,120 --> 00:32:58,799
excellent research that's been out there

945
00:32:58,799 --> 00:33:00,399
so ever since

946
00:33:00,399 --> 00:33:02,320
we started doing research on team tmt

947
00:33:02,320 --> 00:33:04,799
there's been loads of great um

948
00:33:04,799 --> 00:33:06,960
kind of blogs and articles and knowledge

949
00:33:06,960 --> 00:33:09,760
sharing so we'll give a shout out here

950
00:33:09,760 --> 00:33:11,600
and you know what uh just because

951
00:33:11,600 --> 00:33:13,360
they've been a good character so far in

952
00:33:13,360 --> 00:33:15,200
communications with us we've given a

953
00:33:15,200 --> 00:33:17,120
shout out to the attackers too down the

954
00:33:17,120 --> 00:33:18,880
bottom

955
00:33:18,880 --> 00:33:20,399
and then i think

956
00:33:20,399 --> 00:33:23,200
that's it we move over to q a

957
00:33:23,200 --> 00:33:25,340
thank you

958
00:33:25,340 --> 00:33:34,949
[Music]

959
00:33:36,960 --> 00:33:39,039
you

