1
00:00:12,639 --> 00:00:16,960
hello everyone

2
00:00:14,400 --> 00:00:16,960
buenas

3
00:00:18,240 --> 00:00:21,599
today we are going to talk about

4
00:00:20,720 --> 00:00:26,160
adversary

5
00:00:21,600 --> 00:00:29,679
emulation and just for eco party

6
00:00:26,160 --> 00:00:32,800
i have chosen a threat actor

7
00:00:29,679 --> 00:00:35,839
that has attacked in the argentinian

8
00:00:32,800 --> 00:00:36,559
market so we will go through the entire

9
00:00:35,840 --> 00:00:38,800
process

10
00:00:36,559 --> 00:00:39,760
in this conversation along with some

11
00:00:38,800 --> 00:00:42,800
live demos

12
00:00:39,760 --> 00:00:44,879
so that you can test yourself against

13
00:00:42,800 --> 00:00:48,000
this particular threat actor

14
00:00:44,879 --> 00:00:50,559
and improve your detective and

15
00:00:48,000 --> 00:00:53,280
preventive controls in your organization

16
00:00:50,559 --> 00:00:54,399
this talk is titled don't get stung by a

17
00:00:53,280 --> 00:00:56,559
honey bee

18
00:00:54,399 --> 00:00:58,160
and that is the name of the threat actor

19
00:00:56,559 --> 00:01:02,160
i am george or chias

20
00:00:58,160 --> 00:01:04,158
jorge ortiz thank you for being here

21
00:01:02,160 --> 00:01:05,438
this a little bit about myself i am

22
00:01:04,159 --> 00:01:08,000
currently the chief

23
00:01:05,438 --> 00:01:09,199
technology officer at scythe we're a

24
00:01:08,000 --> 00:01:12,479
company that makes

25
00:01:09,200 --> 00:01:15,520
adversary emulation platform for

26
00:01:12,479 --> 00:01:16,240
red team and purple teaming i have uh

27
00:01:15,520 --> 00:01:18,798
published

28
00:01:16,240 --> 00:01:20,720
recently a free framework called the

29
00:01:18,799 --> 00:01:22,400
purple team exercise framework

30
00:01:20,720 --> 00:01:24,000
so when you want to do this in your

31
00:01:22,400 --> 00:01:26,400
organization you can

32
00:01:24,000 --> 00:01:28,080
show your senior management this is what

33
00:01:26,400 --> 00:01:28,799
the industry is doing this is how we

34
00:01:28,080 --> 00:01:30,479
should do it

35
00:01:28,799 --> 00:01:32,079
and of course you can modify it but at

36
00:01:30,479 --> 00:01:34,640
least you have a starting point

37
00:01:32,079 --> 00:01:36,399
that's free it's called the p-test i've

38
00:01:34,640 --> 00:01:38,640
also co-created

39
00:01:36,400 --> 00:01:39,920
these c2 matrix the command and control

40
00:01:38,640 --> 00:01:40,880
matrix we're actually going to talk

41
00:01:39,920 --> 00:01:43,040
about that here

42
00:01:40,880 --> 00:01:45,439
because when we emulate adversaries

43
00:01:43,040 --> 00:01:48,960
we're going to use very similar tools

44
00:01:45,439 --> 00:01:51,839
to do and emulate that

45
00:01:48,960 --> 00:01:52,960
adversary behavior prior to joining

46
00:01:51,840 --> 00:01:56,000
scythe i worked at

47
00:01:52,960 --> 00:01:56,960
citigroup for 10 years running the

48
00:01:56,000 --> 00:01:58,960
offensive team

49
00:01:56,960 --> 00:02:00,798
i started as a vulnerability assessment

50
00:01:58,960 --> 00:02:02,880
analyst then i brought in the

51
00:02:00,799 --> 00:02:05,840
penetration testing team

52
00:02:02,880 --> 00:02:06,798
and then from there we built a red team

53
00:02:05,840 --> 00:02:09,840
a red team grew to

54
00:02:06,799 --> 00:02:12,239
12 people by the time i left and

55
00:02:09,840 --> 00:02:13,440
in the last few years we were doing some

56
00:02:12,239 --> 00:02:16,640
purple team

57
00:02:13,440 --> 00:02:17,680
exercises and really saw the value in

58
00:02:16,640 --> 00:02:20,720
that so

59
00:02:17,680 --> 00:02:23,120
um has been a fun time there

60
00:02:20,720 --> 00:02:24,319
i also teach for sans sans is the

61
00:02:23,120 --> 00:02:26,800
industry standard

62
00:02:24,319 --> 00:02:29,119
in information security training i teach

63
00:02:26,800 --> 00:02:30,000
the offensive security curriculum as you

64
00:02:29,120 --> 00:02:32,400
could imagine

65
00:02:30,000 --> 00:02:33,599
security 560. so if you have a g pen

66
00:02:32,400 --> 00:02:36,560
shout out to you

67
00:02:33,599 --> 00:02:37,359
504 if you have a gcih and i'm also the

68
00:02:36,560 --> 00:02:39,760
author of a

69
00:02:37,360 --> 00:02:42,959
two day red team exercise and adversary

70
00:02:39,760 --> 00:02:44,239
emulation course called security 564.

71
00:02:42,959 --> 00:02:45,760
other than that i've done some other

72
00:02:44,239 --> 00:02:47,760
things in the industry such as the

73
00:02:45,760 --> 00:02:50,000
common vulnerability scoring system

74
00:02:47,760 --> 00:02:50,959
was part of the working group and a

75
00:02:50,000 --> 00:02:53,599
voting member

76
00:02:50,959 --> 00:02:54,160
for version 3 and 3.1 the industry

77
00:02:53,599 --> 00:02:56,879
standard

78
00:02:54,160 --> 00:02:59,359
for rating and scoring vulnerabilities

79
00:02:56,879 --> 00:03:01,679
also created a pen test framework

80
00:02:59,360 --> 00:03:04,239
for regulatory use in the global

81
00:03:01,680 --> 00:03:06,560
financial markets association uh see i

82
00:03:04,239 --> 00:03:09,760
worked at the most global financial

83
00:03:06,560 --> 00:03:10,319
and everyone regulated us so we built a

84
00:03:09,760 --> 00:03:12,480
framework

85
00:03:10,319 --> 00:03:13,440
that would meet the requirements of

86
00:03:12,480 --> 00:03:16,238
multiple

87
00:03:13,440 --> 00:03:18,640
red team and threat intel led

88
00:03:16,239 --> 00:03:22,400
penetration testing requirements

89
00:03:18,640 --> 00:03:23,200
i am also a fan of issa i'm an issa

90
00:03:22,400 --> 00:03:25,200
fellow

91
00:03:23,200 --> 00:03:26,958
and part of the national security

92
00:03:25,200 --> 00:03:30,238
institute technologist

93
00:03:26,959 --> 00:03:33,360
fellow way before i got into security

94
00:03:30,239 --> 00:03:34,159
i wrote a book on windows 7 do not buy

95
00:03:33,360 --> 00:03:36,560
the book

96
00:03:34,159 --> 00:03:37,359
and do not use windows 7. it's end of

97
00:03:36,560 --> 00:03:39,760
life

98
00:03:37,360 --> 00:03:40,720
but just so you know i am a published

99
00:03:39,760 --> 00:03:43,518
author

100
00:03:40,720 --> 00:03:44,640
so enough about me what are we going to

101
00:03:43,519 --> 00:03:46,640
talk about today

102
00:03:44,640 --> 00:03:47,679
well we're gonna talk about adversary

103
00:03:46,640 --> 00:03:49,839
emulation

104
00:03:47,680 --> 00:03:50,720
what does that even mean is that a new

105
00:03:49,840 --> 00:03:53,519
buzzword

106
00:03:50,720 --> 00:03:55,760
isn't that just pen testing we'll answer

107
00:03:53,519 --> 00:03:58,000
all those questions for you

108
00:03:55,760 --> 00:03:59,518
and then we're gonna talk about how to

109
00:03:58,000 --> 00:04:01,120
do adversary emulation

110
00:03:59,519 --> 00:04:02,720
and it does start with cyber threat

111
00:04:01,120 --> 00:04:05,200
intelligence and i'm not

112
00:04:02,720 --> 00:04:06,400
talking about that cyber threat

113
00:04:05,200 --> 00:04:09,920
intelligence

114
00:04:06,400 --> 00:04:11,599
of iocs and indicators of compromise and

115
00:04:09,920 --> 00:04:14,480
malicious domains or

116
00:04:11,599 --> 00:04:15,119
malicious files i'm talking about the

117
00:04:14,480 --> 00:04:18,159
top the

118
00:04:15,120 --> 00:04:19,680
ttps the adversary behavior so we're

119
00:04:18,160 --> 00:04:22,639
going to cover that

120
00:04:19,680 --> 00:04:24,240
and then we picked a threat actor that

121
00:04:22,639 --> 00:04:28,560
is likely to attack

122
00:04:24,240 --> 00:04:30,639
uh organizations in argentina

123
00:04:28,560 --> 00:04:32,720
we'll then create an advocacy emulation

124
00:04:30,639 --> 00:04:35,680
plan we'll do that plan

125
00:04:32,720 --> 00:04:37,440
and then we'll talk about defenses right

126
00:04:35,680 --> 00:04:38,240
because it's really bringing everything

127
00:04:37,440 --> 00:04:41,199
together

128
00:04:38,240 --> 00:04:42,000
the intelligence the blue team and the

129
00:04:41,199 --> 00:04:45,199
red teams all

130
00:04:42,000 --> 00:04:45,199
together so

131
00:04:46,400 --> 00:04:52,159
so what are we talking about what is

132
00:04:49,120 --> 00:04:55,440
adversary emulation is this just another

133
00:04:52,160 --> 00:04:57,680
ethical hacking term and the answer is

134
00:04:55,440 --> 00:05:00,320
yes it's a type of ethical hacking

135
00:04:57,680 --> 00:05:01,199
so ethical hacking encompasses a lot of

136
00:05:00,320 --> 00:05:04,240
things

137
00:05:01,199 --> 00:05:07,520
and most organizations mature

138
00:05:04,240 --> 00:05:09,199
something like this they realize that

139
00:05:07,520 --> 00:05:10,400
they need to do some offense and

140
00:05:09,199 --> 00:05:12,080
security some

141
00:05:10,400 --> 00:05:14,479
uh sort of ethical hacking and they

142
00:05:12,080 --> 00:05:16,400
start doing vulnerability scanning

143
00:05:14,479 --> 00:05:17,680
this is where you take your nessus or

144
00:05:16,400 --> 00:05:21,198
your qualis or

145
00:05:17,680 --> 00:05:23,520
you know any of those um scanners

146
00:05:21,199 --> 00:05:26,240
and you point it at a web application or

147
00:05:23,520 --> 00:05:29,919
an ip address or your network range or

148
00:05:26,240 --> 00:05:32,479
internal ips you hit go and it takes

149
00:05:29,919 --> 00:05:34,400
some time then it gives you back this

150
00:05:32,479 --> 00:05:36,320
large report

151
00:05:34,400 --> 00:05:38,000
large report that no one wants to read

152
00:05:36,320 --> 00:05:40,639
but you have to go

153
00:05:38,000 --> 00:05:42,800
through it right and just giving this to

154
00:05:40,639 --> 00:05:45,680
the operational owners the people that

155
00:05:42,800 --> 00:05:47,039
manage the infrastructure or the web app

156
00:05:45,680 --> 00:05:48,560
is not ideal

157
00:05:47,039 --> 00:05:50,800
because they could have technically ran

158
00:05:48,560 --> 00:05:52,639
that scan themselves

159
00:05:50,800 --> 00:05:54,560
so we started doing vulnerability

160
00:05:52,639 --> 00:05:57,600
assessment that's where we take

161
00:05:54,560 --> 00:05:58,720
the output of a vulnerability scan and

162
00:05:57,600 --> 00:06:01,759
use that

163
00:05:58,720 --> 00:06:04,800
to assess the actual vulnerability we

164
00:06:01,759 --> 00:06:06,880
uh calculate the cvss score

165
00:06:04,800 --> 00:06:09,039
using the temporal environmental

166
00:06:06,880 --> 00:06:09,680
variables which is a score you have to

167
00:06:09,039 --> 00:06:13,120
put in

168
00:06:09,680 --> 00:06:15,039
for your environment and you get a list

169
00:06:13,120 --> 00:06:17,120
of prioritized vulnerabilities

170
00:06:15,039 --> 00:06:19,759
that you should patch so now instead of

171
00:06:17,120 --> 00:06:22,800
giving a 600

172
00:06:19,759 --> 00:06:25,520
page report you give a report

173
00:06:22,800 --> 00:06:27,199
that is 30 pages and it just says these

174
00:06:25,520 --> 00:06:29,758
are the critical vulnerabilities you

175
00:06:27,199 --> 00:06:32,240
have to fix

176
00:06:29,759 --> 00:06:33,600
after that and particularly in our

177
00:06:32,240 --> 00:06:35,840
organization

178
00:06:33,600 --> 00:06:36,800
we wanted to actually exploit

179
00:06:35,840 --> 00:06:38,000
vulnerabilities

180
00:06:36,800 --> 00:06:40,160
that's where we started doing

181
00:06:38,000 --> 00:06:41,840
penetration testing so

182
00:06:40,160 --> 00:06:43,600
to differentiate from vulnerability

183
00:06:41,840 --> 00:06:44,479
assessment where you verify a

184
00:06:43,600 --> 00:06:47,199
vulnerability

185
00:06:44,479 --> 00:06:48,000
in a penetration test you are exploiting

186
00:06:47,199 --> 00:06:50,160
that vulnerability

187
00:06:48,000 --> 00:06:51,919
you're actually getting a shell which

188
00:06:50,160 --> 00:06:54,400
was great because now you had

189
00:06:51,919 --> 00:06:56,400
access to a target operating system you

190
00:06:54,400 --> 00:06:57,359
can calculate the business risk a little

191
00:06:56,400 --> 00:07:00,719
better

192
00:06:57,360 --> 00:07:04,240
notice that it's a production database

193
00:07:00,720 --> 00:07:07,120
that has customer information that

194
00:07:04,240 --> 00:07:09,520
is way more eye-opening and way more

195
00:07:07,120 --> 00:07:11,840
valuable for the business so

196
00:07:09,520 --> 00:07:14,159
start doing penetration testing finding

197
00:07:11,840 --> 00:07:16,400
and exploiting vulnerabilities

198
00:07:14,160 --> 00:07:18,479
there's a whole bug bounty that's part

199
00:07:16,400 --> 00:07:19,440
of uh penetration testing where you find

200
00:07:18,479 --> 00:07:21,520
vulnerabilities

201
00:07:19,440 --> 00:07:22,639
you draft them and you report them as

202
00:07:21,520 --> 00:07:24,240
zero days as

203
00:07:22,639 --> 00:07:26,319
vulnerabilities that the vendor doesn't

204
00:07:24,240 --> 00:07:26,880
know and you can get paid for those too

205
00:07:26,319 --> 00:07:29,680
so

206
00:07:26,880 --> 00:07:30,240
um lots of things in pen testing but

207
00:07:29,680 --> 00:07:32,080
then

208
00:07:30,240 --> 00:07:33,840
we started talking about not only

209
00:07:32,080 --> 00:07:35,359
testing technology and these

210
00:07:33,840 --> 00:07:37,919
preventive controls right

211
00:07:35,360 --> 00:07:39,919
vulnerabilities are patched

212
00:07:37,919 --> 00:07:40,960
what about the people what about the

213
00:07:39,919 --> 00:07:44,000
process

214
00:07:40,960 --> 00:07:45,758
what about the security the detective

215
00:07:44,000 --> 00:07:47,120
controls and that's when we started

216
00:07:45,759 --> 00:07:50,240
talking about renting

217
00:07:47,120 --> 00:07:51,759
and this term came from the military and

218
00:07:50,240 --> 00:07:53,280
we started doing some red team

219
00:07:51,759 --> 00:07:55,680
engagements um

220
00:07:53,280 --> 00:07:58,080
mostly zero knowledge where the blue

221
00:07:55,680 --> 00:08:00,080
team the defenders had no idea

222
00:07:58,080 --> 00:08:02,240
what we were doing as opposed to a pen

223
00:08:00,080 --> 00:08:04,639
test where they generally do

224
00:08:02,240 --> 00:08:05,680
and we would do that once a year and it

225
00:08:04,639 --> 00:08:08,720
would end up

226
00:08:05,680 --> 00:08:09,360
in again a report that said how we got

227
00:08:08,720 --> 00:08:12,879
in

228
00:08:09,360 --> 00:08:15,120
and what they need to do to

229
00:08:12,879 --> 00:08:16,000
not let us get in again they would fix

230
00:08:15,120 --> 00:08:18,479
that

231
00:08:16,000 --> 00:08:19,840
but that would happen maybe once a year

232
00:08:18,479 --> 00:08:21,919
so what did we do in

233
00:08:19,840 --> 00:08:24,400
in between that well we had a red team

234
00:08:21,919 --> 00:08:27,198
we were fishing our people all the time

235
00:08:24,400 --> 00:08:28,000
to help them improve but we figured that

236
00:08:27,199 --> 00:08:30,560
if we actually

237
00:08:28,000 --> 00:08:32,080
work and collaborate with the blue team

238
00:08:30,560 --> 00:08:34,000
we can be more efficient

239
00:08:32,080 --> 00:08:35,360
that's where purple team came about we

240
00:08:34,000 --> 00:08:38,640
started doing that

241
00:08:35,360 --> 00:08:39,599
and then as part of these threat

242
00:08:38,640 --> 00:08:41,760
intelligence

243
00:08:39,599 --> 00:08:43,519
led and as the industry started

244
00:08:41,760 --> 00:08:44,959
leveraging threat intelligence better

245
00:08:43,519 --> 00:08:47,120
right number of years ago

246
00:08:44,959 --> 00:08:48,160
we said wait instead of just like

247
00:08:47,120 --> 00:08:50,959
getting in

248
00:08:48,160 --> 00:08:52,240
why don't we understand other

249
00:08:50,959 --> 00:08:56,000
organizations

250
00:08:52,240 --> 00:08:58,800
in our industry that are getting hacked

251
00:08:56,000 --> 00:09:00,720
understand what the adversary did there

252
00:08:58,800 --> 00:09:01,760
and do those same tests against

253
00:09:00,720 --> 00:09:03,600
ourselves

254
00:09:01,760 --> 00:09:04,800
so that when the malicious actors come

255
00:09:03,600 --> 00:09:07,360
against us

256
00:09:04,800 --> 00:09:09,040
we're ready now this ethical hacking

257
00:09:07,360 --> 00:09:12,240
maturity model i just laid out

258
00:09:09,040 --> 00:09:14,399
isn't perfect right this is based on my

259
00:09:12,240 --> 00:09:15,440
experience and experience of people i've

260
00:09:14,399 --> 00:09:16,959
spoken to

261
00:09:15,440 --> 00:09:19,040
you might have done it completely

262
00:09:16,959 --> 00:09:20,719
different you may only do vulnerability

263
00:09:19,040 --> 00:09:22,560
scanning a vulnerability assessment

264
00:09:20,720 --> 00:09:24,080
maybe you do red teaming but not purple

265
00:09:22,560 --> 00:09:24,719
teaming or maybe you do purple teaming

266
00:09:24,080 --> 00:09:27,200
but

267
00:09:24,720 --> 00:09:28,720
maybe you don't do red teaming right so

268
00:09:27,200 --> 00:09:31,920
it all depends

269
00:09:28,720 --> 00:09:35,519
really all of these need to do one

270
00:09:31,920 --> 00:09:37,839
thing and that is bringing business

271
00:09:35,519 --> 00:09:39,040
value and that is what all ethical

272
00:09:37,839 --> 00:09:42,560
hacking is about

273
00:09:39,040 --> 00:09:45,680
is improving the business so let's dive

274
00:09:42,560 --> 00:09:48,319
a little deeper into this the red team

275
00:09:45,680 --> 00:09:50,880
the red team is our red team the

276
00:09:48,320 --> 00:09:53,279
definition of a writing is a practice

277
00:09:50,880 --> 00:09:56,240
of looking at a problem or situation

278
00:09:53,279 --> 00:09:59,360
from the perspective of an adversary

279
00:09:56,240 --> 00:10:00,480
this came from the military back during

280
00:09:59,360 --> 00:10:03,440
the vietnam war

281
00:10:00,480 --> 00:10:05,440
the us didn't do so well in it so they

282
00:10:03,440 --> 00:10:08,079
decided to test themselves

283
00:10:05,440 --> 00:10:09,200
and really be an eat devil's advocate

284
00:10:08,079 --> 00:10:11,519
i've actually read

285
00:10:09,200 --> 00:10:12,720
uh from joe vest's book if you haven't

286
00:10:11,519 --> 00:10:14,959
uh read that books

287
00:10:12,720 --> 00:10:16,480
excellent book on on red team one of the

288
00:10:14,959 --> 00:10:18,239
things there is that

289
00:10:16,480 --> 00:10:20,079
one of the original red teams were

290
00:10:18,240 --> 00:10:20,560
devil's advocates when someone was going

291
00:10:20,079 --> 00:10:23,760
to get

292
00:10:20,560 --> 00:10:26,959
saint hood they would uh

293
00:10:23,760 --> 00:10:29,920
play the devil advocates role and see if

294
00:10:26,959 --> 00:10:30,719
they really deserved it or not now a red

295
00:10:29,920 --> 00:10:33,199
team does that

296
00:10:30,720 --> 00:10:34,320
they test assumptions right they look at

297
00:10:33,200 --> 00:10:36,880
the situation

298
00:10:34,320 --> 00:10:38,399
from an adversary's perspective in the

299
00:10:36,880 --> 00:10:41,360
commercial world

300
00:10:38,399 --> 00:10:42,800
what we're doing as a red team is making

301
00:10:41,360 --> 00:10:46,560
blue team better

302
00:10:42,800 --> 00:10:49,599
we want to improve all our defenses

303
00:10:46,560 --> 00:10:52,079
right so we want to test and measure

304
00:10:49,600 --> 00:10:53,600
our people our processes and our

305
00:10:52,079 --> 00:10:56,560
technology

306
00:10:53,600 --> 00:10:58,079
now the effort here is manual right

307
00:10:56,560 --> 00:11:00,399
anyone's that says they're going to

308
00:10:58,079 --> 00:11:02,800
automate the red team is

309
00:11:00,399 --> 00:11:04,880
probably not being completely honest

310
00:11:02,800 --> 00:11:07,040
because you need people thinking

311
00:11:04,880 --> 00:11:08,560
you need people to understand and to

312
00:11:07,040 --> 00:11:11,680
move and whatnot

313
00:11:08,560 --> 00:11:13,518
but we are creating a number of tools

314
00:11:11,680 --> 00:11:15,359
i'm going to show you the c2 matrix

315
00:11:13,519 --> 00:11:17,920
there's 55

316
00:11:15,360 --> 00:11:18,560
command and control tools there today

317
00:11:17,920 --> 00:11:21,120
and

318
00:11:18,560 --> 00:11:22,239
we are doing some job some good jobs

319
00:11:21,120 --> 00:11:24,720
automating

320
00:11:22,240 --> 00:11:26,399
creating the attack infrastructure as

321
00:11:24,720 --> 00:11:28,800
well as

322
00:11:26,399 --> 00:11:29,600
the ttps the tactics techniques and

323
00:11:28,800 --> 00:11:31,920
procedures

324
00:11:29,600 --> 00:11:34,160
and how to emulate those from an

325
00:11:31,920 --> 00:11:36,399
automation perspective

326
00:11:34,160 --> 00:11:38,240
lastly the frequency the frequency of

327
00:11:36,399 --> 00:11:41,120
red team engagements are really

328
00:11:38,240 --> 00:11:43,120
intelligence led whenever the red team

329
00:11:41,120 --> 00:11:44,959
gets new intelligence that

330
00:11:43,120 --> 00:11:46,720
there's a new exploit out there that

331
00:11:44,959 --> 00:11:48,000
there's a new tool that there's a new

332
00:11:46,720 --> 00:11:50,079
ttp right

333
00:11:48,000 --> 00:11:51,120
maybe here in this conference we hear of

334
00:11:50,079 --> 00:11:53,359
a new technique

335
00:11:51,120 --> 00:11:55,200
that someone has employed we want to

336
00:11:53,360 --> 00:11:56,480
hear about that and we want to test it

337
00:11:55,200 --> 00:11:58,000
against ourselves

338
00:11:56,480 --> 00:12:00,000
and there are some regulations that

339
00:11:58,000 --> 00:12:01,279
require you to test this on a yearly

340
00:12:00,000 --> 00:12:03,920
basis

341
00:12:01,279 --> 00:12:05,600
and the customer is the blue team which

342
00:12:03,920 --> 00:12:07,360
is very different than the customer

343
00:12:05,600 --> 00:12:09,200
of a vulnerability assessment or a

344
00:12:07,360 --> 00:12:11,120
vulnerability scanner or a pen test

345
00:12:09,200 --> 00:12:14,079
which are the operations teams and the

346
00:12:11,120 --> 00:12:16,160
developers in this case the customer

347
00:12:14,079 --> 00:12:19,040
and really what we're trying to do is to

348
00:12:16,160 --> 00:12:22,319
work better with the blue teams

349
00:12:19,040 --> 00:12:24,319
so this leads us to adversary emulation

350
00:12:22,320 --> 00:12:25,519
is there a difference well adversarial

351
00:12:24,320 --> 00:12:28,639
emulation is a

352
00:12:25,519 --> 00:12:30,160
type of red team exercise red team

353
00:12:28,639 --> 00:12:33,120
exercises

354
00:12:30,160 --> 00:12:34,319
can be physical they can be tabletop

355
00:12:33,120 --> 00:12:36,880
they could be a number of different

356
00:12:34,320 --> 00:12:40,639
things they can be fishing related

357
00:12:36,880 --> 00:12:42,639
this is a type and this type relies on

358
00:12:40,639 --> 00:12:45,360
leveraging cyber threat intelligence

359
00:12:42,639 --> 00:12:46,320
to understand an adversary that has the

360
00:12:45,360 --> 00:12:49,440
opportunity

361
00:12:46,320 --> 00:12:51,120
capability and intent to get into your

362
00:12:49,440 --> 00:12:53,360
organization

363
00:12:51,120 --> 00:12:54,800
understand their behavior and how they

364
00:12:53,360 --> 00:12:57,839
do that their tactics

365
00:12:54,800 --> 00:12:59,120
techniques and procedures and then with

366
00:12:57,839 --> 00:13:01,839
that objective

367
00:12:59,120 --> 00:13:02,160
try it against yourself so really you

368
00:13:01,839 --> 00:13:05,200
are

369
00:13:02,160 --> 00:13:06,959
emulating an attack chain right and when

370
00:13:05,200 --> 00:13:08,480
we look at ttps and we're going to look

371
00:13:06,959 --> 00:13:12,000
at some in a bit

372
00:13:08,480 --> 00:13:15,279
those by themselves might not

373
00:13:12,000 --> 00:13:16,000
be worthy of an alert right this typical

374
00:13:15,279 --> 00:13:18,480
one who

375
00:13:16,000 --> 00:13:20,639
am i are you going to alert every time

376
00:13:18,480 --> 00:13:23,519
someone does ymi in your organization

377
00:13:20,639 --> 00:13:25,600
imagine if you have 400 000 users or

378
00:13:23,519 --> 00:13:26,480
even 10 000 users i'm sure you'll get a

379
00:13:25,600 --> 00:13:27,920
whole mi

380
00:13:26,480 --> 00:13:29,519
at least a couple times a day are you

381
00:13:27,920 --> 00:13:30,319
gonna drop what you're doing and go see

382
00:13:29,519 --> 00:13:33,519
what happened

383
00:13:30,320 --> 00:13:35,519
maybe not but if you see a who am i

384
00:13:33,519 --> 00:13:37,200
followed by an ip config followed by

385
00:13:35,519 --> 00:13:40,160
some powershell execution

386
00:13:37,200 --> 00:13:42,079
then maybe that's not someone typing

387
00:13:40,160 --> 00:13:43,839
that out maybe that is some malware

388
00:13:42,079 --> 00:13:46,319
so those attack chains are important

389
00:13:43,839 --> 00:13:49,040
that's part of what adversary emulation

390
00:13:46,320 --> 00:13:50,720
and why advocation is so important and

391
00:13:49,040 --> 00:13:53,599
then we want to understand

392
00:13:50,720 --> 00:13:55,360
if the organization is prepared for a

393
00:13:53,600 --> 00:13:57,279
real attack

394
00:13:55,360 --> 00:13:58,959
the effort like i said is very manual

395
00:13:57,279 --> 00:14:02,000
but the customer is the entire

396
00:13:58,959 --> 00:14:04,479
organization so some

397
00:14:02,000 --> 00:14:05,279
organizations have internal red teams

398
00:14:04,480 --> 00:14:09,120
some of them

399
00:14:05,279 --> 00:14:11,360
don't and both are good so

400
00:14:09,120 --> 00:14:12,320
in an internal red team that's great

401
00:14:11,360 --> 00:14:14,000
that means your

402
00:14:12,320 --> 00:14:15,680
organization really understands the

403
00:14:14,000 --> 00:14:18,240
value here you

404
00:14:15,680 --> 00:14:20,239
repeat a lot of engagements you spend a

405
00:14:18,240 --> 00:14:22,880
lot of time retesting

406
00:14:20,240 --> 00:14:24,880
and you have insider knowledge because

407
00:14:22,880 --> 00:14:27,360
you do these tests over and over

408
00:14:24,880 --> 00:14:28,240
so internal red teams shouldn't really

409
00:14:27,360 --> 00:14:31,440
be seen

410
00:14:28,240 --> 00:14:33,440
as an adversarial to the other

411
00:14:31,440 --> 00:14:35,440
teams the other security teams but more

412
00:14:33,440 --> 00:14:38,079
as a sparring partner

413
00:14:35,440 --> 00:14:39,440
right and i do this i'm sure some of you

414
00:14:38,079 --> 00:14:42,079
like boxing or

415
00:14:39,440 --> 00:14:42,720
ufc mixed martial arts right when you

416
00:14:42,079 --> 00:14:45,120
are

417
00:14:42,720 --> 00:14:46,000
fighting someone or before you have to

418
00:14:45,120 --> 00:14:47,839
go fight

419
00:14:46,000 --> 00:14:50,560
you train and you train with a sparring

420
00:14:47,839 --> 00:14:54,000
partner do you knock each other out

421
00:14:50,560 --> 00:14:56,079
no you hit each other but never to cause

422
00:14:54,000 --> 00:14:57,839
damage and that's what an internal red

423
00:14:56,079 --> 00:14:58,638
team should do for the internal blue

424
00:14:57,839 --> 00:15:01,279
team

425
00:14:58,639 --> 00:15:01,839
now they're external red teams as well

426
00:15:01,279 --> 00:15:04,320
they

427
00:15:01,839 --> 00:15:06,000
also bring value they are offering this

428
00:15:04,320 --> 00:15:09,199
outside perspective

429
00:15:06,000 --> 00:15:11,600
a new perspective that really

430
00:15:09,199 --> 00:15:12,399
emulates an external adversary a lot

431
00:15:11,600 --> 00:15:15,279
better

432
00:15:12,399 --> 00:15:17,360
so you have some nice uh experience

433
00:15:15,279 --> 00:15:19,760
there they bring industry experience

434
00:15:17,360 --> 00:15:20,480
some awesome awesome red team consulting

435
00:15:19,760 --> 00:15:23,040
groups

436
00:15:20,480 --> 00:15:24,160
um like my friends over at grimm have an

437
00:15:23,040 --> 00:15:26,399
awesome red team

438
00:15:24,160 --> 00:15:28,480
uh and they're innovating and doing some

439
00:15:26,399 --> 00:15:30,880
really cool stuff

440
00:15:28,480 --> 00:15:32,560
but they're doing snapshot engagements

441
00:15:30,880 --> 00:15:33,120
right you hire the red team they come

442
00:15:32,560 --> 00:15:35,680
for a

443
00:15:33,120 --> 00:15:36,320
two three month engagement and then they

444
00:15:35,680 --> 00:15:38,079
leave

445
00:15:36,320 --> 00:15:40,560
and you generally shouldn't get the same

446
00:15:38,079 --> 00:15:42,000
red team over and over year over year

447
00:15:40,560 --> 00:15:44,160
because you want that outside

448
00:15:42,000 --> 00:15:47,920
perspective

449
00:15:44,160 --> 00:15:49,839
so why purple purple teams

450
00:15:47,920 --> 00:15:51,519
is really bringing these together and

451
00:15:49,839 --> 00:15:51,920
you can do purple teaming whether you

452
00:15:51,519 --> 00:15:54,320
have an

453
00:15:51,920 --> 00:15:56,079
external red team or an internal red

454
00:15:54,320 --> 00:15:58,079
team it doesn't matter you need someone

455
00:15:56,079 --> 00:16:00,000
to play the role of a right team

456
00:15:58,079 --> 00:16:01,920
and really the difference is that you're

457
00:16:00,000 --> 00:16:05,120
working together

458
00:16:01,920 --> 00:16:08,959
and purple is indeed getting

459
00:16:05,120 --> 00:16:10,000
a lot of visibility it's the new hotness

460
00:16:08,959 --> 00:16:12,319
right

461
00:16:10,000 --> 00:16:13,120
as you can see on the meme there and why

462
00:16:12,320 --> 00:16:16,560
is that and

463
00:16:13,120 --> 00:16:19,360
it's not because it's a new color right

464
00:16:16,560 --> 00:16:20,160
and by the way we are not creative at

465
00:16:19,360 --> 00:16:22,720
all right

466
00:16:20,160 --> 00:16:23,920
we came up with a new term and it's

467
00:16:22,720 --> 00:16:26,959
purple because

468
00:16:23,920 --> 00:16:27,920
red and blue makes purple we should have

469
00:16:26,959 --> 00:16:31,199
been more creative

470
00:16:27,920 --> 00:16:33,680
but the point is it's not sexy because

471
00:16:31,199 --> 00:16:35,519
it's a new term it's because of the

472
00:16:33,680 --> 00:16:37,120
business value that it provides your

473
00:16:35,519 --> 00:16:38,800
organization

474
00:16:37,120 --> 00:16:40,560
you don't have to now wait for that one

475
00:16:38,800 --> 00:16:41,680
year engagement to see how you did or

476
00:16:40,560 --> 00:16:44,079
how you improved

477
00:16:41,680 --> 00:16:45,680
you can now measure yourself more so

478
00:16:44,079 --> 00:16:48,880
what exactly

479
00:16:45,680 --> 00:16:51,519
is a purple team exercise well

480
00:16:48,880 --> 00:16:52,480
purple team is a virtual team right we

481
00:16:51,519 --> 00:16:54,240
take the red team

482
00:16:52,480 --> 00:16:55,680
we take the blue team and they work

483
00:16:54,240 --> 00:16:57,920
together there's a

484
00:16:55,680 --> 00:16:58,959
very limited amount of organizations

485
00:16:57,920 --> 00:17:02,399
that i'm aware of

486
00:16:58,959 --> 00:17:04,639
that have a full on purple team um that

487
00:17:02,399 --> 00:17:06,880
do mostly detection engineering

488
00:17:04,640 --> 00:17:08,720
generally that falls under the blue team

489
00:17:06,880 --> 00:17:11,439
so in this case

490
00:17:08,720 --> 00:17:12,160
it's a virtual team where we work

491
00:17:11,439 --> 00:17:14,640
together

492
00:17:12,160 --> 00:17:15,280
to measure where we stand and improve

493
00:17:14,640 --> 00:17:17,520
that

494
00:17:15,280 --> 00:17:20,079
so it always starts with cyber threat

495
00:17:17,520 --> 00:17:23,760
intelligence it's extremely important

496
00:17:20,079 --> 00:17:26,399
we want to understand a threat actor

497
00:17:23,760 --> 00:17:27,520
that has the capability the intent and

498
00:17:26,400 --> 00:17:30,320
the opportunity

499
00:17:27,520 --> 00:17:32,080
to attack us we want to know as much as

500
00:17:30,320 --> 00:17:35,439
possible about that threat actor

501
00:17:32,080 --> 00:17:39,760
so an example in financial space

502
00:17:35,440 --> 00:17:42,799
the malicious actors don't go and attack

503
00:17:39,760 --> 00:17:45,360
the big banks first

504
00:17:42,799 --> 00:17:46,480
they go after smaller banks right just

505
00:17:45,360 --> 00:17:48,399
as

506
00:17:46,480 --> 00:17:49,520
as it would make sense right you go

507
00:17:48,400 --> 00:17:52,320
after the smaller

508
00:17:49,520 --> 00:17:54,240
organizations see how to get in you

509
00:17:52,320 --> 00:17:54,720
improve and then you move on to bigger

510
00:17:54,240 --> 00:17:57,919
ones

511
00:17:54,720 --> 00:18:01,520
well if we share that information

512
00:17:57,919 --> 00:18:04,960
and we can test ourselves when those

513
00:18:01,520 --> 00:18:07,520
bad guys and bad actors

514
00:18:04,960 --> 00:18:09,120
go after the bigger organizations or the

515
00:18:07,520 --> 00:18:10,400
next organization because we use

516
00:18:09,120 --> 00:18:12,399
cyberethyl intelligence

517
00:18:10,400 --> 00:18:13,520
we might be able to observe them we

518
00:18:12,400 --> 00:18:15,440
might be able to work with law

519
00:18:13,520 --> 00:18:15,918
enforcement we might be able to catch

520
00:18:15,440 --> 00:18:19,200
them

521
00:18:15,919 --> 00:18:21,360
so it's extremely important so cti has

522
00:18:19,200 --> 00:18:24,080
provided this threat actor

523
00:18:21,360 --> 00:18:26,399
they're also going to provide the

524
00:18:24,080 --> 00:18:28,080
tactics techniques and procedures right

525
00:18:26,400 --> 00:18:30,000
cyber threat intelligence can provide

526
00:18:28,080 --> 00:18:32,240
other things they can provide

527
00:18:30,000 --> 00:18:33,039
domain names that are bad and ips that

528
00:18:32,240 --> 00:18:35,520
are bad and

529
00:18:33,039 --> 00:18:36,480
artifacts are bad but really what we

530
00:18:35,520 --> 00:18:39,918
want to focus on

531
00:18:36,480 --> 00:18:41,600
is on the behavior the ttps the tactics

532
00:18:39,919 --> 00:18:43,840
techniques and procedures

533
00:18:41,600 --> 00:18:46,080
provide that to the right the red team

534
00:18:43,840 --> 00:18:46,879
will then create an adversary emulation

535
00:18:46,080 --> 00:18:49,120
plan

536
00:18:46,880 --> 00:18:50,720
this is what we're going to do this is

537
00:18:49,120 --> 00:18:53,360
what we're going to try to do

538
00:18:50,720 --> 00:18:54,559
to get into this organization and then

539
00:18:53,360 --> 00:18:57,039
in your exercise you

540
00:18:54,559 --> 00:18:58,080
table topic what does that mean we

541
00:18:57,039 --> 00:19:00,559
discuss it

542
00:18:58,080 --> 00:19:01,840
amongst the blue team the cti team the

543
00:19:00,559 --> 00:19:04,879
red team and we say

544
00:19:01,840 --> 00:19:07,199
this is one of the ttp's that this

545
00:19:04,880 --> 00:19:07,919
actor does where do you think we have

546
00:19:07,200 --> 00:19:09,280
controls

547
00:19:07,919 --> 00:19:11,280
oh we might have controls on the

548
00:19:09,280 --> 00:19:12,080
endpoint or we use this product on the

549
00:19:11,280 --> 00:19:14,480
network

550
00:19:12,080 --> 00:19:16,000
we do this over here great you think it

551
00:19:14,480 --> 00:19:17,200
will catch this

552
00:19:16,000 --> 00:19:18,880
i don't know if i'll catch you i'll

553
00:19:17,200 --> 00:19:19,679
definitely log it but i don't know if

554
00:19:18,880 --> 00:19:22,480
it'll alert

555
00:19:19,679 --> 00:19:23,360
great now it's the red team's turn tax

556
00:19:22,480 --> 00:19:26,559
do it

557
00:19:23,360 --> 00:19:28,240
emulate it actually execute it just like

558
00:19:26,559 --> 00:19:30,639
a bad guy will

559
00:19:28,240 --> 00:19:32,160
actually execute it don't just do

560
00:19:30,640 --> 00:19:35,600
simulations

561
00:19:32,160 --> 00:19:38,400
actually emulate and see what happens

562
00:19:35,600 --> 00:19:40,240
the blue team will one learn from the

563
00:19:38,400 --> 00:19:41,600
red team see how the malicious actor

564
00:19:40,240 --> 00:19:44,080
would attack

565
00:19:41,600 --> 00:19:44,719
but then the blue team will share their

566
00:19:44,080 --> 00:19:47,918
screen

567
00:19:44,720 --> 00:19:50,960
and show the red team how they

568
00:19:47,919 --> 00:19:53,039
hunt for badness in their network how

569
00:19:50,960 --> 00:19:55,360
they look at their logs what sim they

570
00:19:53,039 --> 00:19:57,440
use what log aggregator they use

571
00:19:55,360 --> 00:19:59,280
what local logging is occurring on the

572
00:19:57,440 --> 00:20:00,320
endpoints and now the red team is

573
00:19:59,280 --> 00:20:01,918
learning

574
00:20:00,320 --> 00:20:04,559
and they will go around and see what

575
00:20:01,919 --> 00:20:08,159
they found if they found the behaviors

576
00:20:04,559 --> 00:20:10,158
of that adversary and if they didn't

577
00:20:08,159 --> 00:20:12,000
can they fix anything can they tune

578
00:20:10,159 --> 00:20:14,960
anything if they can

579
00:20:12,000 --> 00:20:16,720
do it tune it tune it now let's see and

580
00:20:14,960 --> 00:20:18,080
then test it again the red team will do

581
00:20:16,720 --> 00:20:19,679
the same test again

582
00:20:18,080 --> 00:20:21,678
did it fit did you catch it this time

583
00:20:19,679 --> 00:20:23,280
yes awesome or no

584
00:20:21,679 --> 00:20:24,720
this actually requires a little more

585
00:20:23,280 --> 00:20:27,520
changes okay

586
00:20:24,720 --> 00:20:29,760
let's add that to our action plan and

587
00:20:27,520 --> 00:20:33,039
you repeat this for each ttp

588
00:20:29,760 --> 00:20:34,400
or each chain that this adversary is

589
00:20:33,039 --> 00:20:36,640
known to do

590
00:20:34,400 --> 00:20:37,600
and hopefully you're measuring and

591
00:20:36,640 --> 00:20:41,840
improving

592
00:20:37,600 --> 00:20:44,959
people process and technology

593
00:20:41,840 --> 00:20:47,120
so to do this if you've never done this

594
00:20:44,960 --> 00:20:48,480
i suggest using a framework that's

595
00:20:47,120 --> 00:20:50,320
already there

596
00:20:48,480 --> 00:20:52,320
this will help you sell to your senior

597
00:20:50,320 --> 00:20:54,799
management you will be able to say look

598
00:20:52,320 --> 00:20:56,158
this is what the industry is doing this

599
00:20:54,799 --> 00:20:58,320
is what we want to do

600
00:20:56,159 --> 00:20:59,840
and the purple team exercise framework

601
00:20:58,320 --> 00:21:03,200
is a small document it's

602
00:20:59,840 --> 00:21:03,760
20 pages long explains exactly how to go

603
00:21:03,200 --> 00:21:04,960
through this

604
00:21:03,760 --> 00:21:06,879
how to leverage cyber through

605
00:21:04,960 --> 00:21:07,760
intelligence how to prepare for the

606
00:21:06,880 --> 00:21:10,000
exercise

607
00:21:07,760 --> 00:21:10,799
how to execute it and how do lessons

608
00:21:10,000 --> 00:21:12,400
learn

609
00:21:10,799 --> 00:21:14,320
so that's completely free i highly

610
00:21:12,400 --> 00:21:15,440
recommend you download it and just read

611
00:21:14,320 --> 00:21:17,760
through it

612
00:21:15,440 --> 00:21:19,520
there's other frameworks right a lot of

613
00:21:17,760 --> 00:21:21,679
senior managers have learned of the

614
00:21:19,520 --> 00:21:25,200
cyber kill chain this came out in

615
00:21:21,679 --> 00:21:28,960
2011 by lockheed martin and it explains

616
00:21:25,200 --> 00:21:31,440
seven steps that malicious actor does

617
00:21:28,960 --> 00:21:32,240
but there's a number of issues with that

618
00:21:31,440 --> 00:21:33,840
model

619
00:21:32,240 --> 00:21:35,440
it was great that a lot of people

620
00:21:33,840 --> 00:21:37,039
understand it

621
00:21:35,440 --> 00:21:38,559
it had command and control which was

622
00:21:37,039 --> 00:21:41,039
great but then it had

623
00:21:38,559 --> 00:21:43,360
action on objectives and action on

624
00:21:41,039 --> 00:21:44,158
objectives really encompasses a lot of

625
00:21:43,360 --> 00:21:47,360
things

626
00:21:44,159 --> 00:21:50,400
so paul pulls and shout out to him wrote

627
00:21:47,360 --> 00:21:52,479
a paper called unified cyber kill chain

628
00:21:50,400 --> 00:21:53,760
this brought the cyber kill chain with a

629
00:21:52,480 --> 00:21:56,640
number of other ones

630
00:21:53,760 --> 00:21:58,640
to create a three-step process of

631
00:21:56,640 --> 00:22:01,200
gaining an initial foothold

632
00:21:58,640 --> 00:22:02,960
doing network propagation and then doing

633
00:22:01,200 --> 00:22:03,760
action on objectives which is more

634
00:22:02,960 --> 00:22:06,480
realistic

635
00:22:03,760 --> 00:22:08,158
and each of those main steps has a lot

636
00:22:06,480 --> 00:22:10,559
of substance

637
00:22:08,159 --> 00:22:12,000
if you are in the financial space then

638
00:22:10,559 --> 00:22:14,320
there's a ton of regulation

639
00:22:12,000 --> 00:22:16,799
you can look at all of these are public

640
00:22:14,320 --> 00:22:19,360
the bank of england has the sea best

641
00:22:16,799 --> 00:22:21,679
intelligence-led testing framework the

642
00:22:19,360 --> 00:22:23,360
european central bank asked that you go

643
00:22:21,679 --> 00:22:24,559
through a threat intelligence-based

644
00:22:23,360 --> 00:22:27,600
ethical renting

645
00:22:24,559 --> 00:22:29,440
or tiber tiger eu and then there's tiber

646
00:22:27,600 --> 00:22:30,799
for each country

647
00:22:29,440 --> 00:22:33,039
there's a monetary authority of

648
00:22:30,799 --> 00:22:34,400
singapore that has one the hong kong

649
00:22:33,039 --> 00:22:36,320
monetary authority

650
00:22:34,400 --> 00:22:38,080
and then one of the frameworks that i

651
00:22:36,320 --> 00:22:39,760
was an author on is the

652
00:22:38,080 --> 00:22:41,280
framework for the regulatory use of pen

653
00:22:39,760 --> 00:22:42,080
testing in the financial services

654
00:22:41,280 --> 00:22:45,039
industry

655
00:22:42,080 --> 00:22:46,720
casino global organization you have all

656
00:22:45,039 --> 00:22:47,679
of these regulators asking you to do

657
00:22:46,720 --> 00:22:50,159
these right teams

658
00:22:47,679 --> 00:22:51,840
and you can't possibly do six zero

659
00:22:50,159 --> 00:22:55,120
knowledge right team engagement

660
00:22:51,840 --> 00:22:56,080
in a one period it just doesn't make

661
00:22:55,120 --> 00:22:58,719
sense if you're

662
00:22:56,080 --> 00:23:00,000
emulating for three or four months then

663
00:22:58,720 --> 00:23:02,480
you're gonna have multiple

664
00:23:00,000 --> 00:23:04,400
exercises going on at once i highly

665
00:23:02,480 --> 00:23:08,480
don't recommend that

666
00:23:04,400 --> 00:23:11,039
so at the end we have a beautiful

667
00:23:08,480 --> 00:23:12,320
testing framework and that is create as

668
00:23:11,039 --> 00:23:15,440
done by minor

669
00:23:12,320 --> 00:23:18,720
attack an attack stands for adversary

670
00:23:15,440 --> 00:23:21,760
tactics and um adversary

671
00:23:18,720 --> 00:23:23,760
tactics techniques and common knowledge

672
00:23:21,760 --> 00:23:25,919
and more than a common knowledge i would

673
00:23:23,760 --> 00:23:28,799
say it's a common language

674
00:23:25,919 --> 00:23:31,760
it allows us to speak the same language

675
00:23:28,799 --> 00:23:34,960
between cyber threat intelligence

676
00:23:31,760 --> 00:23:37,440
red teams and blue teams so when someone

677
00:23:34,960 --> 00:23:40,400
gets attacked in another organization

678
00:23:37,440 --> 00:23:41,520
we can grab that intelligence map it to

679
00:23:40,400 --> 00:23:44,159
mitre attack

680
00:23:41,520 --> 00:23:46,559
red team can emulate it blue team can

681
00:23:44,159 --> 00:23:48,640
map it to what detections they have

682
00:23:46,559 --> 00:23:50,559
and focus on the areas where they might

683
00:23:48,640 --> 00:23:53,840
have gaps so here's your

684
00:23:50,559 --> 00:23:55,678
miter attack uh framework which we we

685
00:23:53,840 --> 00:23:57,840
love showing

686
00:23:55,679 --> 00:23:59,039
so let's start with cyber threat

687
00:23:57,840 --> 00:24:02,240
intelligence

688
00:23:59,039 --> 00:24:05,200
so when i was asked to do this talk

689
00:24:02,240 --> 00:24:05,840
i wanted to pick a threat actor that was

690
00:24:05,200 --> 00:24:09,520
relevant

691
00:24:05,840 --> 00:24:12,480
to argentina so i went into minor attack

692
00:24:09,520 --> 00:24:12,960
and i looked up argentina there was one

693
00:24:12,480 --> 00:24:16,240
group

694
00:24:12,960 --> 00:24:18,240
this group called honeybee and i read a

695
00:24:16,240 --> 00:24:19,360
little through there i said cool i could

696
00:24:18,240 --> 00:24:22,240
definitely

697
00:24:19,360 --> 00:24:23,520
uh emulate this particular thread actor

698
00:24:22,240 --> 00:24:26,880
as a case study

699
00:24:23,520 --> 00:24:28,400
in in our talk and i looked into it and

700
00:24:26,880 --> 00:24:30,559
started doing my research

701
00:24:28,400 --> 00:24:32,640
started putting together everything and

702
00:24:30,559 --> 00:24:36,399
then of course

703
00:24:32,640 --> 00:24:39,600
um we have a number of sources

704
00:24:36,400 --> 00:24:41,279
so honeybee is a campaign led by an

705
00:24:39,600 --> 00:24:43,600
unknown actor so they didn't

706
00:24:41,279 --> 00:24:46,320
they couldn't attribute this actor to

707
00:24:43,600 --> 00:24:48,240
any location attributions generally hard

708
00:24:46,320 --> 00:24:50,000
and it's okay we actually don't really

709
00:24:48,240 --> 00:24:52,400
care where they're from

710
00:24:50,000 --> 00:24:54,080
at this point we want to know who are

711
00:24:52,400 --> 00:24:56,720
they targeting and in this case they're

712
00:24:54,080 --> 00:24:58,559
targeting humanitarian aid organizations

713
00:24:56,720 --> 00:25:00,080
that have been active in vietnam

714
00:24:58,559 --> 00:25:02,240
singapore argentina

715
00:25:00,080 --> 00:25:03,279
japan indonesia and canada and they've

716
00:25:02,240 --> 00:25:05,600
been active since

717
00:25:03,279 --> 00:25:07,039
august of 2017 and as recently as

718
00:25:05,600 --> 00:25:08,959
february 2018

719
00:25:07,039 --> 00:25:10,240
and then we actually didn't hear more

720
00:25:08,960 --> 00:25:13,360
about them so

721
00:25:10,240 --> 00:25:15,760
mcafee has a great blog post on this

722
00:25:13,360 --> 00:25:16,959
i went through this blog post i also

723
00:25:15,760 --> 00:25:19,440
went through mitre attack

724
00:25:16,960 --> 00:25:21,200
site really creating all of this for

725
00:25:19,440 --> 00:25:23,440
this presentation

726
00:25:21,200 --> 00:25:25,039
and as luck would have it as i was

727
00:25:23,440 --> 00:25:27,760
preparing this talk

728
00:25:25,039 --> 00:25:29,840
i read on the news that net walker

729
00:25:27,760 --> 00:25:30,559
ransomware hits the argentinian

730
00:25:29,840 --> 00:25:33,439
government

731
00:25:30,559 --> 00:25:35,600
demands four million dollars but i've

732
00:25:33,440 --> 00:25:37,919
already done a ransomware talk i did a

733
00:25:35,600 --> 00:25:41,360
ransomware talk at defcon

734
00:25:37,919 --> 00:25:44,080
about evil corp evil corp was the group

735
00:25:41,360 --> 00:25:45,360
that had to garment and caused that

736
00:25:44,080 --> 00:25:48,720
global outage

737
00:25:45,360 --> 00:25:51,918
for a week seven days people couldn't uh

738
00:25:48,720 --> 00:25:54,080
see how their fitness tracking was going

739
00:25:51,919 --> 00:25:56,159
there were boats that couldn't go out

740
00:25:54,080 --> 00:25:57,840
because they didn't have gps and there

741
00:25:56,159 --> 00:26:00,400
were planes that couldn't take off

742
00:25:57,840 --> 00:26:01,199
because they used garmin fly so i did

743
00:26:00,400 --> 00:26:02,799
not talk and

744
00:26:01,200 --> 00:26:04,720
that one was a little different than

745
00:26:02,799 --> 00:26:07,679
netwalker that one was

746
00:26:04,720 --> 00:26:08,480
uh a malware so the group evocorp got

747
00:26:07,679 --> 00:26:10,559
into garmin

748
00:26:08,480 --> 00:26:12,000
they moved laterally and then they drop

749
00:26:10,559 --> 00:26:15,360
the malware called

750
00:26:12,000 --> 00:26:17,600
wasted locker so a lot of this

751
00:26:15,360 --> 00:26:20,639
ransomware is all very similar

752
00:26:17,600 --> 00:26:23,439
um so i decided not

753
00:26:20,640 --> 00:26:25,360
to switch and do netwalker i had already

754
00:26:23,440 --> 00:26:26,720
had the cool talk title of don't get

755
00:26:25,360 --> 00:26:29,840
stung by honeybee

756
00:26:26,720 --> 00:26:30,880
so um i didn't do this but i did see

757
00:26:29,840 --> 00:26:32,639
that recently and

758
00:26:30,880 --> 00:26:34,720
now this might be something that you do

759
00:26:32,640 --> 00:26:37,600
want to look at um my talk

760
00:26:34,720 --> 00:26:39,360
uh from defcon is online and you can see

761
00:26:37,600 --> 00:26:39,840
how to emulate ransomware it's going to

762
00:26:39,360 --> 00:26:42,799
be a

763
00:26:39,840 --> 00:26:44,320
similar intro to here but then of course

764
00:26:42,799 --> 00:26:45,120
the ttps are going to be a little

765
00:26:44,320 --> 00:26:48,158
different

766
00:26:45,120 --> 00:26:48,639
so what do we do well one of the nice

767
00:26:48,159 --> 00:26:52,400
things

768
00:26:48,640 --> 00:26:56,080
is if the threat actor is in

769
00:26:52,400 --> 00:26:59,120
mitre attack then it already has

770
00:26:56,080 --> 00:27:00,480
the attack mapping which is great right

771
00:26:59,120 --> 00:27:01,199
because now we're using cyber threat

772
00:27:00,480 --> 00:27:04,159
intelligence

773
00:27:01,200 --> 00:27:04,720
and we're creating a little map here of

774
00:27:04,159 --> 00:27:06,559
what

775
00:27:04,720 --> 00:27:08,000
this threat actor does so in this case

776
00:27:06,559 --> 00:27:11,200
we have honeybee

777
00:27:08,000 --> 00:27:12,400
and honeybee does execution through

778
00:27:11,200 --> 00:27:14,480
visual basic

779
00:27:12,400 --> 00:27:15,600
and windows command line they create

780
00:27:14,480 --> 00:27:18,320
services

781
00:27:15,600 --> 00:27:20,080
they do register run keys they bypass

782
00:27:18,320 --> 00:27:23,120
user access control

783
00:27:20,080 --> 00:27:24,639
so you can kind of visualize what this

784
00:27:23,120 --> 00:27:26,639
thread actor does it's a

785
00:27:24,640 --> 00:27:28,799
very very useful tool and it's free you

786
00:27:26,640 --> 00:27:32,399
can just click on this link and

787
00:27:28,799 --> 00:27:35,760
visit but when you propose this

788
00:27:32,399 --> 00:27:37,520
you probably can't just propose a

789
00:27:35,760 --> 00:27:39,600
heat map of minor attack and say we're

790
00:27:37,520 --> 00:27:42,720
going to do this you should

791
00:27:39,600 --> 00:27:44,559
kind of organize it in a in a better way

792
00:27:42,720 --> 00:27:46,159
so i've done that for you for this

793
00:27:44,559 --> 00:27:48,639
particular thread actor this is

794
00:27:46,159 --> 00:27:50,720
honeybee and we see here that they do

795
00:27:48,640 --> 00:27:53,360
command and control

796
00:27:50,720 --> 00:27:54,880
through application layer protocol file

797
00:27:53,360 --> 00:27:57,520
transfer protocols

798
00:27:54,880 --> 00:27:59,120
they use ftp for command and control

799
00:27:57,520 --> 00:28:01,840
that's really interesting and

800
00:27:59,120 --> 00:28:04,320
we'll talk about that in a second then

801
00:28:01,840 --> 00:28:06,559
they do execution through visual basic

802
00:28:04,320 --> 00:28:07,918
windows command shell and service

803
00:28:06,559 --> 00:28:10,320
execution

804
00:28:07,919 --> 00:28:11,840
they do defense evasion by modifying the

805
00:28:10,320 --> 00:28:15,439
registry doing process

806
00:28:11,840 --> 00:28:18,080
injection doing code signing

807
00:28:15,440 --> 00:28:20,080
removing files doing file deletion and

808
00:28:18,080 --> 00:28:22,000
obvious skating files

809
00:28:20,080 --> 00:28:23,360
then once they're on the system they do

810
00:28:22,000 --> 00:28:25,360
some discovery like

811
00:28:23,360 --> 00:28:28,399
file and directory discovery process

812
00:28:25,360 --> 00:28:31,520
discovery system information discovery

813
00:28:28,399 --> 00:28:36,000
they do privilege escalation by

814
00:28:31,520 --> 00:28:38,480
bypassing uac and using the absurd dll

815
00:28:36,000 --> 00:28:41,200
to register new dlls

816
00:28:38,480 --> 00:28:42,559
they do uh persistence so they stay on

817
00:28:41,200 --> 00:28:45,039
the target system

818
00:28:42,559 --> 00:28:46,720
by modifying the registry run keys and

819
00:28:45,039 --> 00:28:50,240
creating services

820
00:28:46,720 --> 00:28:53,279
they do collection by archiving uh

821
00:28:50,240 --> 00:28:56,480
collected data staging that data

822
00:28:53,279 --> 00:28:58,000
and then exfiltrating it through ftp

823
00:28:56,480 --> 00:28:58,720
right because that was the command and

824
00:28:58,000 --> 00:29:01,679
control

825
00:28:58,720 --> 00:29:02,799
channel so we've leveraged cyber threat

826
00:29:01,679 --> 00:29:05,039
intelligence here

827
00:29:02,799 --> 00:29:06,000
that we found a miter attack quite

828
00:29:05,039 --> 00:29:08,559
easily

829
00:29:06,000 --> 00:29:10,000
about a threat actor that is active in

830
00:29:08,559 --> 00:29:12,240
your country

831
00:29:10,000 --> 00:29:13,600
and we've created a low profile to kind

832
00:29:12,240 --> 00:29:16,159
of have an idea

833
00:29:13,600 --> 00:29:17,120
of how we would emulate this uh threat

834
00:29:16,159 --> 00:29:19,760
actor

835
00:29:17,120 --> 00:29:20,799
so the next step is planning and

836
00:29:19,760 --> 00:29:24,399
planning

837
00:29:20,799 --> 00:29:26,158
is a lot of what we do in red team

838
00:29:24,399 --> 00:29:28,320
engagements and purple team engagements

839
00:29:26,159 --> 00:29:31,360
and adversary emulations

840
00:29:28,320 --> 00:29:34,639
i have a two-day class

841
00:29:31,360 --> 00:29:35,439
and a fourth of that class 25 of that

842
00:29:34,640 --> 00:29:38,559
class

843
00:29:35,440 --> 00:29:40,000
is planning right and i don't talk

844
00:29:38,559 --> 00:29:41,918
longer about planning because i know

845
00:29:40,000 --> 00:29:44,480
most people are here

846
00:29:41,919 --> 00:29:45,039
not for the planning but for actually

847
00:29:44,480 --> 00:29:48,399
hacking

848
00:29:45,039 --> 00:29:49,440
right so i'm not gonna take too long on

849
00:29:48,399 --> 00:29:52,719
this i only have

850
00:29:49,440 --> 00:29:55,120
one slide but planning is super

851
00:29:52,720 --> 00:29:56,480
important if you talk to any red teamer

852
00:29:55,120 --> 00:29:57,439
you're going to see and they will

853
00:29:56,480 --> 00:29:59,600
probably tell you

854
00:29:57,440 --> 00:30:01,039
that they probably spend more time

855
00:29:59,600 --> 00:30:03,678
planning

856
00:30:01,039 --> 00:30:04,640
than they actually do testing and that

857
00:30:03,679 --> 00:30:06,720
is because

858
00:30:04,640 --> 00:30:08,080
here's where we need to understand the

859
00:30:06,720 --> 00:30:10,720
business value

860
00:30:08,080 --> 00:30:13,520
just like the adversary has goals and

861
00:30:10,720 --> 00:30:15,840
objectives in your target environment

862
00:30:13,520 --> 00:30:17,440
you need to have goals and objectives

863
00:30:15,840 --> 00:30:20,000
and what are those goals

864
00:30:17,440 --> 00:30:22,399
right could be that you want to see if

865
00:30:20,000 --> 00:30:23,440
this malicious actor can get into you

866
00:30:22,399 --> 00:30:25,840
maybe you heard

867
00:30:23,440 --> 00:30:26,880
that they hacked the company across the

868
00:30:25,840 --> 00:30:29,199
street from you

869
00:30:26,880 --> 00:30:31,120
or one of your competitors which you

870
00:30:29,200 --> 00:30:32,399
liked because of your competitor

871
00:30:31,120 --> 00:30:35,120
but you're worried they're going to come

872
00:30:32,399 --> 00:30:37,840
after you next so what are the goals

873
00:30:35,120 --> 00:30:38,799
and objectives document those and focus

874
00:30:37,840 --> 00:30:41,120
around those

875
00:30:38,799 --> 00:30:43,120
the goals and objectives are going to be

876
00:30:41,120 --> 00:30:45,039
your primary focus

877
00:30:43,120 --> 00:30:46,158
you are going to follow some sort of

878
00:30:45,039 --> 00:30:48,879
plan

879
00:30:46,159 --> 00:30:50,000
always with that goal in sight don't

880
00:30:48,880 --> 00:30:52,320
just go off on

881
00:30:50,000 --> 00:30:54,320
tangent because we need to provide

882
00:30:52,320 --> 00:30:56,879
business value

883
00:30:54,320 --> 00:30:59,039
then you need to also decide is this

884
00:30:56,880 --> 00:31:01,279
going to be a red team engagement that's

885
00:30:59,039 --> 00:31:02,879
zero knowledge meaning that the blue

886
00:31:01,279 --> 00:31:04,799
team doesn't know about it

887
00:31:02,880 --> 00:31:06,320
only the chief information security

888
00:31:04,799 --> 00:31:08,720
officer or maybe

889
00:31:06,320 --> 00:31:10,080
the chief technology officer knows but

890
00:31:08,720 --> 00:31:12,799
no one else

891
00:31:10,080 --> 00:31:14,320
or is it going to be a full knowledge

892
00:31:12,799 --> 00:31:16,080
exercise

893
00:31:14,320 --> 00:31:17,678
is the blue team going to be aware of

894
00:31:16,080 --> 00:31:18,399
what we're doing are we going to work

895
00:31:17,679 --> 00:31:19,840
with them

896
00:31:18,399 --> 00:31:21,518
are we going to show them what we're

897
00:31:19,840 --> 00:31:23,840
doing as we go

898
00:31:21,519 --> 00:31:24,799
even though some things will fail that's

899
00:31:23,840 --> 00:31:26,879
good

900
00:31:24,799 --> 00:31:28,639
document the things you've that fail

901
00:31:26,880 --> 00:31:29,120
sometimes red teams don't want to do

902
00:31:28,640 --> 00:31:31,120
this

903
00:31:29,120 --> 00:31:33,120
because they want to show failure they

904
00:31:31,120 --> 00:31:35,760
only want to show what worked

905
00:31:33,120 --> 00:31:36,559
and that's not right right we're in this

906
00:31:35,760 --> 00:31:39,440
together

907
00:31:36,559 --> 00:31:39,840
it's not about beating up and knocking

908
00:31:39,440 --> 00:31:42,960
out

909
00:31:39,840 --> 00:31:46,000
our partner it's about working together

910
00:31:42,960 --> 00:31:48,399
so another thing you want is an

911
00:31:46,000 --> 00:31:50,159
exercise coordinator that's really a

912
00:31:48,399 --> 00:31:52,080
project manager

913
00:31:50,159 --> 00:31:53,600
because you're going to have cyber

914
00:31:52,080 --> 00:31:56,320
threat intelligence coming in

915
00:31:53,600 --> 00:31:57,600
from maybe an internal team or maybe a

916
00:31:56,320 --> 00:32:00,240
vendor

917
00:31:57,600 --> 00:32:01,279
you're also going to have the blue team

918
00:32:00,240 --> 00:32:02,960
to worry about

919
00:32:01,279 --> 00:32:04,480
and communicate to you're going to have

920
00:32:02,960 --> 00:32:05,440
senior management you're going to have

921
00:32:04,480 --> 00:32:07,519
the red team

922
00:32:05,440 --> 00:32:09,519
so whether you're doing a purple team

923
00:32:07,519 --> 00:32:11,440
exercise or a red team engagement

924
00:32:09,519 --> 00:32:13,120
you definitely need an exercise

925
00:32:11,440 --> 00:32:15,360
coordinator and that should not be the

926
00:32:13,120 --> 00:32:19,120
red team i did that for a couple of

927
00:32:15,360 --> 00:32:20,320
engagements and i do not recommend it

928
00:32:19,120 --> 00:32:22,399
another thing you're going to have to

929
00:32:20,320 --> 00:32:25,120
decide is are you going to

930
00:32:22,399 --> 00:32:26,639
work from an assumed breach perspective

931
00:32:25,120 --> 00:32:28,799
or are you going to do a full

932
00:32:26,640 --> 00:32:30,640
end to end kill chain are you going to

933
00:32:28,799 --> 00:32:33,120
start out from the internet

934
00:32:30,640 --> 00:32:34,799
and try to gain initial access or are

935
00:32:33,120 --> 00:32:36,000
you going to start with that initial

936
00:32:34,799 --> 00:32:38,639
foothold

937
00:32:36,000 --> 00:32:40,159
now depending on your goals and

938
00:32:38,640 --> 00:32:43,279
objectives

939
00:32:40,159 --> 00:32:46,799
this decision will be easier to make now

940
00:32:43,279 --> 00:32:50,480
initial access takes time it takes

941
00:32:46,799 --> 00:32:51,360
us a lot of time to figure out who to

942
00:32:50,480 --> 00:32:54,640
fish

943
00:32:51,360 --> 00:32:54,959
create a phishing email create a payload

944
00:32:54,640 --> 00:32:57,360
that

945
00:32:54,960 --> 00:32:59,120
doesn't get caught by antivirus that

946
00:32:57,360 --> 00:33:01,199
goes through all your systems

947
00:32:59,120 --> 00:33:03,840
that you will eventually run and that

948
00:33:01,200 --> 00:33:06,880
will gain us that initial foothold

949
00:33:03,840 --> 00:33:10,158
initial access is one tactic

950
00:33:06,880 --> 00:33:12,559
in mitre attack and

951
00:33:10,159 --> 00:33:14,480
if you are mature enough to understand

952
00:33:12,559 --> 00:33:16,720
this or your organization is

953
00:33:14,480 --> 00:33:17,919
there's always going to be a way in

954
00:33:16,720 --> 00:33:19,679
right

955
00:33:17,919 --> 00:33:21,360
there's infinite ways into your

956
00:33:19,679 --> 00:33:24,320
organization

957
00:33:21,360 --> 00:33:24,959
there's insider threats there's uh

958
00:33:24,320 --> 00:33:26,480
phishing

959
00:33:24,960 --> 00:33:27,840
right someone will always fall for a

960
00:33:26,480 --> 00:33:29,440
phishing email i don't know anyone

961
00:33:27,840 --> 00:33:30,959
that's ran a campaign and gotten zero

962
00:33:29,440 --> 00:33:32,799
percent fishing

963
00:33:30,960 --> 00:33:35,200
um or there's going to be a

964
00:33:32,799 --> 00:33:36,960
vulnerability there might be a zero day

965
00:33:35,200 --> 00:33:38,880
that you don't know about or from the

966
00:33:36,960 --> 00:33:40,399
time microsoft releases a patch to a

967
00:33:38,880 --> 00:33:43,200
time that you actually patch

968
00:33:40,399 --> 00:33:44,080
there's going to be ways so the assumed

969
00:33:43,200 --> 00:33:45,679
breach model

970
00:33:44,080 --> 00:33:47,279
suggests that you know you're going to

971
00:33:45,679 --> 00:33:49,039
get breached so

972
00:33:47,279 --> 00:33:50,960
in order to bring the most business

973
00:33:49,039 --> 00:33:52,320
value why don't we start with that

974
00:33:50,960 --> 00:33:54,880
initial foothold

975
00:33:52,320 --> 00:33:55,760
we forget about initial access and we

976
00:33:54,880 --> 00:33:58,080
focus on

977
00:33:55,760 --> 00:33:59,120
all the other tactics and techniques and

978
00:33:58,080 --> 00:34:02,559
minor attack

979
00:33:59,120 --> 00:34:04,559
there's over 250 of them that are not

980
00:34:02,559 --> 00:34:06,480
related to initial access

981
00:34:04,559 --> 00:34:08,639
why not focus on those because you're

982
00:34:06,480 --> 00:34:11,760
mature and you understand this

983
00:34:08,639 --> 00:34:13,440
then you'll have rules of engagement and

984
00:34:11,760 --> 00:34:16,159
of course there's going to be rules

985
00:34:13,440 --> 00:34:17,520
for example not ransomware when i do

986
00:34:16,159 --> 00:34:20,639
ransomware emulations

987
00:34:17,520 --> 00:34:21,599
i don't encrypt real business data i

988
00:34:20,639 --> 00:34:24,720
don't delete

989
00:34:21,599 --> 00:34:26,480
real business data and i don't stop the

990
00:34:24,719 --> 00:34:29,598
business from working

991
00:34:26,480 --> 00:34:32,240
because i want to prove my point right

992
00:34:29,599 --> 00:34:33,679
i have rules that say get to where i am

993
00:34:32,239 --> 00:34:36,158
and instead of

994
00:34:33,679 --> 00:34:37,200
bringing down the system or encrypting

995
00:34:36,159 --> 00:34:39,599
things

996
00:34:37,199 --> 00:34:41,839
create new files and then encrypt those

997
00:34:39,599 --> 00:34:43,839
because you'll still see the crypto

998
00:34:41,839 --> 00:34:45,520
you'll still see the new files i'll

999
00:34:43,839 --> 00:34:47,359
still download a ransom now

1000
00:34:45,520 --> 00:34:48,960
but i'm not actually going to delete

1001
00:34:47,359 --> 00:34:50,639
your backups and

1002
00:34:48,960 --> 00:34:52,320
make you pay right so there's always

1003
00:34:50,639 --> 00:34:54,399
rules of engagement

1004
00:34:52,320 --> 00:34:55,839
and lastly there is attack

1005
00:34:54,399 --> 00:34:58,319
infrastructure

1006
00:34:55,839 --> 00:34:59,839
and red team attack infrastructure takes

1007
00:34:58,320 --> 00:35:01,760
a while to set up

1008
00:34:59,839 --> 00:35:03,759
we've been doing pretty well at figuring

1009
00:35:01,760 --> 00:35:07,520
out ways to automate this

1010
00:35:03,760 --> 00:35:10,720
but that involves buying domain names

1011
00:35:07,520 --> 00:35:12,960
buying or acquiring tls certificates

1012
00:35:10,720 --> 00:35:15,118
setting up email servers setting up

1013
00:35:12,960 --> 00:35:16,880
phishing websites to steal credentials

1014
00:35:15,119 --> 00:35:20,079
or to host malicious files

1015
00:35:16,880 --> 00:35:22,400
you have to set up uh cloud uh

1016
00:35:20,079 --> 00:35:25,119
machines for your command and control

1017
00:35:22,400 --> 00:35:28,720
servers you need to set up redirectors

1018
00:35:25,119 --> 00:35:31,200
there's a whole talk on this i can spend

1019
00:35:28,720 --> 00:35:32,720
an entire one or two days talking about

1020
00:35:31,200 --> 00:35:33,200
setting up this attack infrastructure

1021
00:35:32,720 --> 00:35:36,160
right

1022
00:35:33,200 --> 00:35:36,640
but we don't have the time for that and

1023
00:35:36,160 --> 00:35:39,598
again

1024
00:35:36,640 --> 00:35:40,240
you don't love planning i get it you can

1025
00:35:39,599 --> 00:35:45,839
uh

1026
00:35:40,240 --> 00:35:45,839
ping me on on the planning steps later

1027
00:35:51,240 --> 00:35:57,359
[Music]

1028
00:35:54,320 --> 00:35:59,359
so one of the things you have to do kind

1029
00:35:57,359 --> 00:36:02,319
of as part of planning

1030
00:35:59,359 --> 00:36:04,240
and preparation but still kind of

1031
00:36:02,320 --> 00:36:05,520
exercise execution this is kind of in

1032
00:36:04,240 --> 00:36:08,000
the middle ground

1033
00:36:05,520 --> 00:36:09,839
is you need to determine what tools you

1034
00:36:08,000 --> 00:36:12,800
are going to use

1035
00:36:09,839 --> 00:36:15,279
and um this is a project that i started

1036
00:36:12,800 --> 00:36:16,480
called the c2 matrix the command and

1037
00:36:15,280 --> 00:36:18,480
control matrix

1038
00:36:16,480 --> 00:36:20,079
it's a google sheet that started out

1039
00:36:18,480 --> 00:36:21,599
just as a spreadsheet

1040
00:36:20,079 --> 00:36:23,760
of various different command and

1041
00:36:21,599 --> 00:36:26,560
controls that were out there

1042
00:36:23,760 --> 00:36:28,960
we released this and i did this with a

1043
00:36:26,560 --> 00:36:32,240
few people with bryson bohr adam

1044
00:36:28,960 --> 00:36:32,720
mash um and it's a community project now

1045
00:36:32,240 --> 00:36:34,078
so

1046
00:36:32,720 --> 00:36:36,560
if you do hear about a new command and

1047
00:36:34,079 --> 00:36:40,079
control just tag us on twitter

1048
00:36:36,560 --> 00:36:40,799
or contribute fully uh open source and

1049
00:36:40,079 --> 00:36:44,000
free

1050
00:36:40,800 --> 00:36:46,079
and it started just with this excel

1051
00:36:44,000 --> 00:36:48,240
site and then i moved it to google

1052
00:36:46,079 --> 00:36:51,440
sheets because it's easier to share

1053
00:36:48,240 --> 00:36:52,879
and it listed all the different command

1054
00:36:51,440 --> 00:36:55,040
and control frameworks

1055
00:36:52,880 --> 00:36:57,760
when we released this back in november

1056
00:36:55,040 --> 00:37:00,240
of 2019 there was 23

1057
00:36:57,760 --> 00:37:01,680
command and control frameworks that we

1058
00:37:00,240 --> 00:37:05,598
knew about

1059
00:37:01,680 --> 00:37:07,598
today right now there's 55

1060
00:37:05,599 --> 00:37:08,640
command and control frameworks out of

1061
00:37:07,599 --> 00:37:12,160
those

1062
00:37:08,640 --> 00:37:15,200
five are commercial and the other 50

1063
00:37:12,160 --> 00:37:18,078
are on github as open source and

1064
00:37:15,200 --> 00:37:19,279
free command and controls so you might

1065
00:37:18,079 --> 00:37:19,839
have heard of some of these you might

1066
00:37:19,280 --> 00:37:21,440
have heard

1067
00:37:19,839 --> 00:37:24,000
i'm sure you've heard of metasploit

1068
00:37:21,440 --> 00:37:26,960
right but things like empire

1069
00:37:24,000 --> 00:37:28,160
covenant right there's a number of of

1070
00:37:26,960 --> 00:37:30,800
famous ones right

1071
00:37:28,160 --> 00:37:32,240
um and then there's new ones and new

1072
00:37:30,800 --> 00:37:36,160
ones are popping up

1073
00:37:32,240 --> 00:37:37,200
all the time so the original reason for

1074
00:37:36,160 --> 00:37:40,799
this was

1075
00:37:37,200 --> 00:37:43,279
that as a red teamer i need to emulate

1076
00:37:40,800 --> 00:37:45,359
a particular adversary and that

1077
00:37:43,280 --> 00:37:48,480
adversary has ttps

1078
00:37:45,359 --> 00:37:50,480
and i need to choose which tool will

1079
00:37:48,480 --> 00:37:53,359
help me emulate that better

1080
00:37:50,480 --> 00:37:53,920
so if you go to the c2matrix.com one of

1081
00:37:53,359 --> 00:37:56,078
the things

1082
00:37:53,920 --> 00:37:57,599
there is a questionnaire where you can

1083
00:37:56,079 --> 00:37:58,400
actually go through various different

1084
00:37:57,599 --> 00:38:01,280
questions

1085
00:37:58,400 --> 00:38:02,079
and it will tell you which c2s match the

1086
00:38:01,280 --> 00:38:05,440
criteria

1087
00:38:02,079 --> 00:38:05,839
that you need to use and then of course

1088
00:38:05,440 --> 00:38:09,040
we've

1089
00:38:05,839 --> 00:38:10,640
expanded the list of capabilities for

1090
00:38:09,040 --> 00:38:12,400
example some command and control

1091
00:38:10,640 --> 00:38:14,560
frameworks that you set up

1092
00:38:12,400 --> 00:38:16,240
and i guess we should tell you how this

1093
00:38:14,560 --> 00:38:16,960
works right you set up a command and

1094
00:38:16,240 --> 00:38:20,240
control

1095
00:38:16,960 --> 00:38:22,480
server somewhere on the internet and

1096
00:38:20,240 --> 00:38:24,000
you get a domain name and a certificate

1097
00:38:22,480 --> 00:38:25,839
and all that fun stuff

1098
00:38:24,000 --> 00:38:29,280
and when you compromise the system

1099
00:38:25,839 --> 00:38:32,480
internally it communicates out to you

1100
00:38:29,280 --> 00:38:34,240
we call that heartbeats or callbacks

1101
00:38:32,480 --> 00:38:36,240
or beacons right there's a number of

1102
00:38:34,240 --> 00:38:37,359
names for it but pretty much that system

1103
00:38:36,240 --> 00:38:39,359
you've compromised

1104
00:38:37,359 --> 00:38:40,720
connects out to the internet through a

1105
00:38:39,359 --> 00:38:42,480
communication protocol

1106
00:38:40,720 --> 00:38:44,000
so you can see on the screenshot there

1107
00:38:42,480 --> 00:38:46,320
in blue the channel

1108
00:38:44,000 --> 00:38:47,599
what is the communication channel used

1109
00:38:46,320 --> 00:38:50,640
there's tcp

1110
00:38:47,599 --> 00:38:54,240
you can see a lot of them use http

1111
00:38:50,640 --> 00:38:55,598
there's http 2 there's http 3 dns dns

1112
00:38:54,240 --> 00:38:58,640
over http

1113
00:38:55,599 --> 00:39:01,839
etc so that's kind of important

1114
00:38:58,640 --> 00:39:05,279
if a particular threat actor uses

1115
00:39:01,839 --> 00:39:08,000
a particular tool there's also agents

1116
00:39:05,280 --> 00:39:08,960
um what operating system are you going

1117
00:39:08,000 --> 00:39:11,040
to deploy

1118
00:39:08,960 --> 00:39:12,079
this particular payload to is it going

1119
00:39:11,040 --> 00:39:13,839
to be on windows

1120
00:39:12,079 --> 00:39:16,320
is it going to be on linux is an ambient

1121
00:39:13,839 --> 00:39:17,440
mac really depends on where you were

1122
00:39:16,320 --> 00:39:19,359
going to deploy

1123
00:39:17,440 --> 00:39:21,599
you might have to choose a c2 based on

1124
00:39:19,359 --> 00:39:24,720
that and then from there

1125
00:39:21,599 --> 00:39:28,160
we realized that installing these c2s

1126
00:39:24,720 --> 00:39:30,720
is not exactly easy so

1127
00:39:28,160 --> 00:39:31,920
to lower the learning curve we have

1128
00:39:30,720 --> 00:39:34,480
released

1129
00:39:31,920 --> 00:39:36,640
a free virtual machine we actually did

1130
00:39:34,480 --> 00:39:39,119
this in collaboration with sans

1131
00:39:36,640 --> 00:39:40,240
and it's called the sans slingshot c2

1132
00:39:39,119 --> 00:39:43,200
matrix

1133
00:39:40,240 --> 00:39:43,919
virtual machine and that has a number of

1134
00:39:43,200 --> 00:39:46,879
c2s

1135
00:39:43,920 --> 00:39:47,359
already installed so all you have to do

1136
00:39:46,880 --> 00:39:50,079
is

1137
00:39:47,359 --> 00:39:51,598
start this virtual machine and start

1138
00:39:50,079 --> 00:39:54,079
using the c2

1139
00:39:51,599 --> 00:39:55,119
now if you don't know how to use that c2

1140
00:39:54,079 --> 00:39:58,400
we came up with

1141
00:39:55,119 --> 00:40:01,920
something else called the how to

1142
00:39:58,400 --> 00:40:04,880
how to dot the c2matrix.com

1143
00:40:01,920 --> 00:40:06,640
allows you to select a particular

1144
00:40:04,880 --> 00:40:09,359
command and control framework

1145
00:40:06,640 --> 00:40:10,640
and it walks you through how to use so

1146
00:40:09,359 --> 00:40:14,480
i'm going to show you this

1147
00:40:10,640 --> 00:40:15,200
tool shortly follow c2 underscore matrix

1148
00:40:14,480 --> 00:40:18,480
on twitter

1149
00:40:15,200 --> 00:40:20,560
for the latest updates so one of the

1150
00:40:18,480 --> 00:40:24,000
things that caught my eye

1151
00:40:20,560 --> 00:40:26,799
on what honeybee did and what makes it

1152
00:40:24,000 --> 00:40:27,359
different than others than other actors

1153
00:40:26,800 --> 00:40:30,560
i

1154
00:40:27,359 --> 00:40:36,640
hadn't really played with uh before is

1155
00:40:30,560 --> 00:40:39,680
a technique from microattack t1548.002

1156
00:40:36,640 --> 00:40:41,598
and that's bypassing user access control

1157
00:40:39,680 --> 00:40:42,879
and user access control is a windows

1158
00:40:41,599 --> 00:40:45,839
security feature

1159
00:40:42,880 --> 00:40:47,599
designed to split admin privileges from

1160
00:40:45,839 --> 00:40:50,400
normal user privileges so

1161
00:40:47,599 --> 00:40:51,280
we all know especially linux users right

1162
00:40:50,400 --> 00:40:53,680
you know

1163
00:40:51,280 --> 00:40:55,520
you should never run as root right you

1164
00:40:53,680 --> 00:40:57,598
run as a normal user

1165
00:40:55,520 --> 00:40:58,560
well in windows it took a long time to

1166
00:40:57,599 --> 00:41:00,560
realize that

1167
00:40:58,560 --> 00:41:02,880
and to this day we still have a lot of

1168
00:41:00,560 --> 00:41:06,078
users that are local admin

1169
00:41:02,880 --> 00:41:08,079
on their windows system that's not good

1170
00:41:06,079 --> 00:41:10,319
so what did windows do to protect you

1171
00:41:08,079 --> 00:41:11,200
from yourself or your end users from

1172
00:41:10,319 --> 00:41:14,560
themselves

1173
00:41:11,200 --> 00:41:15,279
is they implemented this token integrity

1174
00:41:14,560 --> 00:41:17,359
level

1175
00:41:15,280 --> 00:41:18,880
which gives you different restrictions

1176
00:41:17,359 --> 00:41:22,560
and different privileges

1177
00:41:18,880 --> 00:41:25,200
based on how that process is running

1178
00:41:22,560 --> 00:41:26,078
so even if you're a local admin on your

1179
00:41:25,200 --> 00:41:28,960
system

1180
00:41:26,079 --> 00:41:30,800
and you open internet explorer that's

1181
00:41:28,960 --> 00:41:31,920
not realistic no one uses internet

1182
00:41:30,800 --> 00:41:35,839
explorer right

1183
00:41:31,920 --> 00:41:38,079
if you open chrome or firefox

1184
00:41:35,839 --> 00:41:39,200
you don't open that with an a high

1185
00:41:38,079 --> 00:41:42,079
privileged token

1186
00:41:39,200 --> 00:41:42,560
you open that with a medium integrity

1187
00:41:42,079 --> 00:41:45,280
token

1188
00:41:42,560 --> 00:41:45,680
so there's four token types low medium

1189
00:41:45,280 --> 00:41:47,760
high

1190
00:41:45,680 --> 00:41:48,799
and system so even if you're running

1191
00:41:47,760 --> 00:41:51,920
with uac

1192
00:41:48,800 --> 00:41:53,280
you run everything with medium integrity

1193
00:41:51,920 --> 00:41:55,280
now if you want to run something with

1194
00:41:53,280 --> 00:41:56,000
privilege you have to right click it and

1195
00:41:55,280 --> 00:41:58,880
do run as

1196
00:41:56,000 --> 00:42:00,560
admin and if you are a local admin then

1197
00:41:58,880 --> 00:42:01,119
you get the screen that's here on the

1198
00:42:00,560 --> 00:42:03,839
right

1199
00:42:01,119 --> 00:42:05,280
which shows user access control are you

1200
00:42:03,839 --> 00:42:07,520
sure you want to run this

1201
00:42:05,280 --> 00:42:09,040
uh program with this privilege and most

1202
00:42:07,520 --> 00:42:12,720
people just click yes

1203
00:42:09,040 --> 00:42:16,079
right so this is user access control you

1204
00:42:12,720 --> 00:42:18,480
already have a privilege and

1205
00:42:16,079 --> 00:42:20,000
you want to bypass this little message

1206
00:42:18,480 --> 00:42:22,960
right because that message

1207
00:42:20,000 --> 00:42:24,319
will show people that you have access to

1208
00:42:22,960 --> 00:42:26,800
their system right

1209
00:42:24,319 --> 00:42:29,520
so how do we do that there's an awesome

1210
00:42:26,800 --> 00:42:33,040
awesome project called uac

1211
00:42:29,520 --> 00:42:36,400
me like uac me um

1212
00:42:33,040 --> 00:42:40,319
and it has over 60 methods

1213
00:42:36,400 --> 00:42:43,520
documented on how you can bypass

1214
00:42:40,319 --> 00:42:45,520
uac on the right here we have

1215
00:42:43,520 --> 00:42:46,720
a wonderful example shout out to

1216
00:42:45,520 --> 00:42:49,759
james4shaw

1217
00:42:46,720 --> 00:42:51,759
awesome awesome hacker this one

1218
00:42:49,760 --> 00:42:53,680
you can read and you see the type

1219
00:42:51,760 --> 00:42:54,480
there's different types there's dll

1220
00:42:53,680 --> 00:42:57,520
hijacking

1221
00:42:54,480 --> 00:43:00,240
which does dll search order the way that

1222
00:42:57,520 --> 00:43:01,280
windows loads dlls dynamic link

1223
00:43:00,240 --> 00:43:03,759
libraries

1224
00:43:01,280 --> 00:43:04,640
is based on a set of rules it's about

1225
00:43:03,760 --> 00:43:06,800
six rules

1226
00:43:04,640 --> 00:43:08,480
you'll first look into memory to see if

1227
00:43:06,800 --> 00:43:11,200
the dll is already there

1228
00:43:08,480 --> 00:43:12,079
then you'll look into various locations

1229
00:43:11,200 --> 00:43:15,279
such as

1230
00:43:12,079 --> 00:43:16,160
um the the hard-coded location the

1231
00:43:15,280 --> 00:43:19,200
registry

1232
00:43:16,160 --> 00:43:22,399
then into that same folder etc so

1233
00:43:19,200 --> 00:43:25,680
if you can get and write your dll

1234
00:43:22,400 --> 00:43:28,319
earlier then your dll executes before

1235
00:43:25,680 --> 00:43:30,399
the application does and you bypass it

1236
00:43:28,319 --> 00:43:32,960
there's application compatibility

1237
00:43:30,400 --> 00:43:34,560
which is um if you're still running

1238
00:43:32,960 --> 00:43:37,040
windows 2000

1239
00:43:34,560 --> 00:43:38,960
uh type of applications you need them to

1240
00:43:37,040 --> 00:43:41,680
be compatible with windows 10

1241
00:43:38,960 --> 00:43:43,200
that is one of the features built into

1242
00:43:41,680 --> 00:43:45,440
windows that lets you do that

1243
00:43:43,200 --> 00:43:46,799
there's elevated comm interfaces there's

1244
00:43:45,440 --> 00:43:48,880
shell apis

1245
00:43:46,800 --> 00:43:50,800
um and there's the ability to just ask

1246
00:43:48,880 --> 00:43:51,839
right if you just ask to elevate you'll

1247
00:43:50,800 --> 00:43:55,119
get that pop-up

1248
00:43:51,839 --> 00:43:58,160
so on the right here james4shop shows

1249
00:43:55,119 --> 00:44:01,040
uh one example this is example 34 of

1250
00:43:58,160 --> 00:44:03,598
62 i believe and this one only works on

1251
00:44:01,040 --> 00:44:05,599
8.1 on windows 8.1 so if you are

1252
00:44:03,599 --> 00:44:06,880
going against the windows 8.1 you can

1253
00:44:05,599 --> 00:44:10,160
actually see

1254
00:44:06,880 --> 00:44:12,319
and follow this little guy to figure out

1255
00:44:10,160 --> 00:44:15,759
how to get around uac it's a

1256
00:44:12,319 --> 00:44:19,440
pretty cool tool so let's

1257
00:44:15,760 --> 00:44:22,720
do a few demos here um for you

1258
00:44:19,440 --> 00:44:24,720
and um and hopefully uh

1259
00:44:22,720 --> 00:44:27,078
we we nail down everything we talked

1260
00:44:24,720 --> 00:44:29,680
about so first things first

1261
00:44:27,079 --> 00:44:31,440
attack.miter.org one of the best ways

1262
00:44:29,680 --> 00:44:36,640
and what i showed you earlier is

1263
00:44:31,440 --> 00:44:39,359
i just went here and did argentina

1264
00:44:36,640 --> 00:44:40,640
and we give it a second and we see the

1265
00:44:39,359 --> 00:44:43,040
honeybee group

1266
00:44:40,640 --> 00:44:44,960
we click on honeybee and here we see the

1267
00:44:43,040 --> 00:44:47,359
information i gave earlier

1268
00:44:44,960 --> 00:44:48,160
along with all the techniques used as

1269
00:44:47,359 --> 00:44:51,040
you can see

1270
00:44:48,160 --> 00:44:51,359
there's no tactic name here there's also

1271
00:44:51,040 --> 00:44:54,640
no

1272
00:44:51,359 --> 00:44:56,078
order generally when you do emulations

1273
00:44:54,640 --> 00:44:57,839
you're going to set up the command and

1274
00:44:56,079 --> 00:44:59,359
control first that's why command and

1275
00:44:57,839 --> 00:45:01,200
control is one of the first ones

1276
00:44:59,359 --> 00:45:02,960
and we see here the command and controls

1277
00:45:01,200 --> 00:45:05,279
via ftp

1278
00:45:02,960 --> 00:45:06,240
so that's important we go through and we

1279
00:45:05,280 --> 00:45:08,079
see other

1280
00:45:06,240 --> 00:45:09,759
things that they were doing what

1281
00:45:08,079 --> 00:45:11,839
software they used

1282
00:45:09,760 --> 00:45:13,839
um this looks like just living off the

1283
00:45:11,839 --> 00:45:16,319
lan software such as command

1284
00:45:13,839 --> 00:45:16,960
prompt registry key says info and test

1285
00:45:16,319 --> 00:45:18,960
list

1286
00:45:16,960 --> 00:45:20,319
and there's the reference to the mcafee

1287
00:45:18,960 --> 00:45:22,640
article right so

1288
00:45:20,319 --> 00:45:23,759
this is uh pretty straightforward we can

1289
00:45:22,640 --> 00:45:27,440
click over here

1290
00:45:23,760 --> 00:45:30,240
uh attack navigator layer

1291
00:45:27,440 --> 00:45:31,599
and do view and it's gonna take us to

1292
00:45:30,240 --> 00:45:34,879
mitre attack

1293
00:45:31,599 --> 00:45:38,319
this is a dynamic site where it

1294
00:45:34,880 --> 00:45:39,599
shows in blue everything that this

1295
00:45:38,319 --> 00:45:42,079
particular actor

1296
00:45:39,599 --> 00:45:43,119
uh does so you have to scroll it because

1297
00:45:42,079 --> 00:45:46,319
we now have

1298
00:45:43,119 --> 00:45:49,119
sub techniques so um yeah there's

1299
00:45:46,319 --> 00:45:50,800
this is works um and it's wonderful you

1300
00:45:49,119 --> 00:45:54,000
can open up new layers

1301
00:45:50,800 --> 00:45:57,640
um you can select up here selection

1302
00:45:54,000 --> 00:46:00,480
select a different thread actor here's a

1303
00:45:57,640 --> 00:46:01,359
apt-19 we can select that and change it

1304
00:46:00,480 --> 00:46:04,160
to red

1305
00:46:01,359 --> 00:46:04,960
see what other thread actors do um which

1306
00:46:04,160 --> 00:46:07,520
is awesome i

1307
00:46:04,960 --> 00:46:08,720
i really like attack navigator right but

1308
00:46:07,520 --> 00:46:11,599
one of the things about

1309
00:46:08,720 --> 00:46:12,399
honeybee was the command and control

1310
00:46:11,599 --> 00:46:15,040
channel right

1311
00:46:12,400 --> 00:46:15,760
you go over to the right use this final

1312
00:46:15,040 --> 00:46:18,880
transfer

1313
00:46:15,760 --> 00:46:22,400
protocol honeybee uses ftp so that's

1314
00:46:18,880 --> 00:46:23,760
interesting so let's go over to the c2

1315
00:46:22,400 --> 00:46:26,640
matrix

1316
00:46:23,760 --> 00:46:28,880
this is the website of the c2 matrix on

1317
00:46:26,640 --> 00:46:32,078
the top right you have the matrix so

1318
00:46:28,880 --> 00:46:34,079
if you click on that you get this

1319
00:46:32,079 --> 00:46:35,200
excel sheet right and the excel sheet

1320
00:46:34,079 --> 00:46:37,760
has a lot of

1321
00:46:35,200 --> 00:46:38,480
information over here on the left hand

1322
00:46:37,760 --> 00:46:41,440
side

1323
00:46:38,480 --> 00:46:42,319
we have the name of the c2 and you can

1324
00:46:41,440 --> 00:46:46,160
see here

1325
00:46:42,319 --> 00:46:49,359
that it has grown significantly

1326
00:46:46,160 --> 00:46:51,759
to 55 c2s

1327
00:46:49,359 --> 00:46:53,119
the next thing we say is the license you

1328
00:46:51,760 --> 00:46:56,240
can see that some of these

1329
00:46:53,119 --> 00:46:58,319
are free while others are commercial

1330
00:46:56,240 --> 00:47:00,319
we can see the github for the particular

1331
00:46:58,319 --> 00:47:02,960
site as well as

1332
00:47:00,319 --> 00:47:04,000
a website if they own a website and also

1333
00:47:02,960 --> 00:47:07,280
the twitter handle

1334
00:47:04,000 --> 00:47:11,040
so all of this is c2 info then

1335
00:47:07,280 --> 00:47:12,720
we see information about who evaluated

1336
00:47:11,040 --> 00:47:15,040
this particular c2

1337
00:47:12,720 --> 00:47:16,560
so you can see there's some here that

1338
00:47:15,040 --> 00:47:18,800
don't have evaluators

1339
00:47:16,560 --> 00:47:20,319
that means that you can contribute and

1340
00:47:18,800 --> 00:47:22,160
test these out

1341
00:47:20,319 --> 00:47:23,599
you have the date that something was

1342
00:47:22,160 --> 00:47:27,118
evaluated

1343
00:47:23,599 --> 00:47:28,079
and the version so these versions change

1344
00:47:27,119 --> 00:47:29,760
quite a bit

1345
00:47:28,079 --> 00:47:31,440
they might not be the latest version

1346
00:47:29,760 --> 00:47:35,119
this is the latest version

1347
00:47:31,440 --> 00:47:37,440
of what um of what we try

1348
00:47:35,119 --> 00:47:39,040
so um then you can see how we

1349
00:47:37,440 --> 00:47:41,119
implemented it

1350
00:47:39,040 --> 00:47:42,319
some of these are implemented with pip

1351
00:47:41,119 --> 00:47:45,520
some are binaries

1352
00:47:42,319 --> 00:47:46,400
some have docker except then we have the

1353
00:47:45,520 --> 00:47:49,440
how to

1354
00:47:46,400 --> 00:47:52,800
the how-to explains how

1355
00:47:49,440 --> 00:47:56,319
to use each of these various

1356
00:47:52,800 --> 00:47:59,520
um c2s which is pretty cool you can just

1357
00:47:56,319 --> 00:48:01,359
kind of click on uh this and it will

1358
00:47:59,520 --> 00:48:04,400
take you to the how-to site

1359
00:48:01,359 --> 00:48:06,558
where it shows you how to use the c2

1360
00:48:04,400 --> 00:48:08,240
i'll jump into that later it tells you

1361
00:48:06,559 --> 00:48:10,240
which ones are in slingshot this is the

1362
00:48:08,240 --> 00:48:12,160
free vm i'll show you in a little bit

1363
00:48:10,240 --> 00:48:13,520
and which ones are getting added to cali

1364
00:48:12,160 --> 00:48:14,879
so one of the things i've been doing is

1365
00:48:13,520 --> 00:48:17,280
working with the folks from

1366
00:48:14,880 --> 00:48:19,440
offensive security to get some of these

1367
00:48:17,280 --> 00:48:21,760
c2s into cali as well

1368
00:48:19,440 --> 00:48:22,800
then we have the language the code that

1369
00:48:21,760 --> 00:48:25,839
was used

1370
00:48:22,800 --> 00:48:29,680
there's a c2 server and there's a c2

1371
00:48:25,839 --> 00:48:32,319
agent or implant so you can see here

1372
00:48:29,680 --> 00:48:33,440
servers a lot of them on python while a

1373
00:48:32,319 --> 00:48:36,480
lot of the agents

1374
00:48:33,440 --> 00:48:37,359
are power shell like empire uses mostly

1375
00:48:36,480 --> 00:48:39,359
powershell

1376
00:48:37,359 --> 00:48:40,480
but there's a big move in the industry

1377
00:48:39,359 --> 00:48:42,558
the c sharp

1378
00:48:40,480 --> 00:48:45,839
you'll see a lot of that and you'll see

1379
00:48:42,559 --> 00:48:48,800
some that are created with things like c

1380
00:48:45,839 --> 00:48:50,720
um and uh and native code which is

1381
00:48:48,800 --> 00:48:53,280
really interesting

1382
00:48:50,720 --> 00:48:55,118
there's also the ui so if you are

1383
00:48:53,280 --> 00:48:56,559
running a red team engagement

1384
00:48:55,119 --> 00:48:58,960
you probably want multi-user

1385
00:48:56,559 --> 00:49:01,200
capabilities in your c2

1386
00:48:58,960 --> 00:49:02,000
um the ui could be a command line

1387
00:49:01,200 --> 00:49:05,439
interface

1388
00:49:02,000 --> 00:49:07,599
a web interface or a gui i've recently

1389
00:49:05,440 --> 00:49:09,920
added dark mode because covenant now has

1390
00:49:07,599 --> 00:49:11,599
dark mode and some other c2s are

1391
00:49:09,920 --> 00:49:13,839
are moving there apparently this is

1392
00:49:11,599 --> 00:49:17,599
important to some people

1393
00:49:13,839 --> 00:49:20,720
apis so you can do automation implants

1394
00:49:17,599 --> 00:49:23,400
windows linux and mac the communication

1395
00:49:20,720 --> 00:49:24,959
channels and then all of the

1396
00:49:23,400 --> 00:49:27,440
capabilities right

1397
00:49:24,960 --> 00:49:28,000
so for this instance we need to find one

1398
00:49:27,440 --> 00:49:32,079
that does

1399
00:49:28,000 --> 00:49:34,319
ftp so if we go and just look at the ftp

1400
00:49:32,079 --> 00:49:35,599
and what we can do is just filter this

1401
00:49:34,319 --> 00:49:38,160
for yes

1402
00:49:35,599 --> 00:49:39,280
we find that there's actually only one

1403
00:49:38,160 --> 00:49:42,720
c2

1404
00:49:39,280 --> 00:49:45,200
that uses ftp as

1405
00:49:42,720 --> 00:49:47,480
a command and control channel so if we

1406
00:49:45,200 --> 00:49:50,558
find out more information about this

1407
00:49:47,480 --> 00:49:52,559
unfortunately it is a commercial tool so

1408
00:49:50,559 --> 00:49:53,040
we cannot download it but there's a link

1409
00:49:52,559 --> 00:49:54,720
here

1410
00:49:53,040 --> 00:49:56,319
we can click on that and see a little

1411
00:49:54,720 --> 00:49:59,439
bit more info on them

1412
00:49:56,319 --> 00:49:59,920
and check them out if we really have to

1413
00:49:59,440 --> 00:50:03,520
do

1414
00:49:59,920 --> 00:50:06,559
ftp now for most c2s

1415
00:50:03,520 --> 00:50:09,759
i would recommend http

1416
00:50:06,559 --> 00:50:11,440
http and https are probably going to be

1417
00:50:09,760 --> 00:50:14,480
the faster

1418
00:50:11,440 --> 00:50:16,559
c2s and remember what your

1419
00:50:14,480 --> 00:50:17,760
implant does is it connects out to the

1420
00:50:16,559 --> 00:50:20,960
internet after

1421
00:50:17,760 --> 00:50:24,160
a certain amount of time and you have

1422
00:50:20,960 --> 00:50:24,720
a lot of different capabilities here as

1423
00:50:24,160 --> 00:50:27,520
well

1424
00:50:24,720 --> 00:50:28,000
um for what you want to do so one of the

1425
00:50:27,520 --> 00:50:30,240
things

1426
00:50:28,000 --> 00:50:32,880
is having key exchange right you don't

1427
00:50:30,240 --> 00:50:34,000
want everything if you're using http or

1428
00:50:32,880 --> 00:50:36,160
ftp in this

1429
00:50:34,000 --> 00:50:37,520
in this instance right you want some

1430
00:50:36,160 --> 00:50:40,240
security between

1431
00:50:37,520 --> 00:50:41,280
the machines you compromise and your

1432
00:50:40,240 --> 00:50:43,839
server

1433
00:50:41,280 --> 00:50:46,000
their steganography if they're proxy

1434
00:50:43,839 --> 00:50:47,200
aware some organizations have proxies on

1435
00:50:46,000 --> 00:50:49,200
the way out

1436
00:50:47,200 --> 00:50:51,520
if you can do domain fronting that's a

1437
00:50:49,200 --> 00:50:54,480
great way to do redirection

1438
00:50:51,520 --> 00:50:56,240
if you can customize the profile change

1439
00:50:54,480 --> 00:50:58,319
things like the user agent

1440
00:50:56,240 --> 00:50:59,279
and as you go through one of the really

1441
00:50:58,319 --> 00:51:02,720
important things

1442
00:50:59,280 --> 00:51:03,280
is logging as a red teamer and a purple

1443
00:51:02,720 --> 00:51:06,078
team

1444
00:51:03,280 --> 00:51:07,440
you have to log everything that you do

1445
00:51:06,079 --> 00:51:09,520
so that

1446
00:51:07,440 --> 00:51:11,040
you can prove that you did what you did

1447
00:51:09,520 --> 00:51:14,079
and a bad

1448
00:51:11,040 --> 00:51:16,160
uh actor didn't do something else

1449
00:51:14,079 --> 00:51:18,400
so um all that information is here

1450
00:51:16,160 --> 00:51:21,440
there's some information about detection

1451
00:51:18,400 --> 00:51:23,680
etc now what i want to do is show you

1452
00:51:21,440 --> 00:51:27,200
the documentation the documentation

1453
00:51:23,680 --> 00:51:31,440
is a git book and the first thing here

1454
00:51:27,200 --> 00:51:34,640
is the sans slingshot c2 matrix edition

1455
00:51:31,440 --> 00:51:36,000
and this is a virtual machine that you

1456
00:51:34,640 --> 00:51:40,879
can download

1457
00:51:36,000 --> 00:51:42,880
and it will run oh sorry

1458
00:51:40,880 --> 00:51:45,680
there we go this is a virtual machine it

1459
00:51:42,880 --> 00:51:46,559
brings covenant empire 3 faction aquatic

1460
00:51:45,680 --> 00:51:48,480
merlin metaphor

1461
00:51:46,559 --> 00:51:50,160
silent trinity and sliver so it

1462
00:51:48,480 --> 00:51:52,079
definitely gets you started

1463
00:51:50,160 --> 00:51:53,680
it has vector as well which is an

1464
00:51:52,079 --> 00:51:57,280
awesome tool for

1465
00:51:53,680 --> 00:52:00,558
managing uh red team engagements we have

1466
00:51:57,280 --> 00:52:02,240
a lab environment here that we show you

1467
00:52:00,559 --> 00:52:04,720
how we evaluated these

1468
00:52:02,240 --> 00:52:05,439
we had attackers we had a pf sense

1469
00:52:04,720 --> 00:52:08,399
firewall

1470
00:52:05,440 --> 00:52:10,160
we had victims on the other side i

1471
00:52:08,400 --> 00:52:11,440
walked through you can see videos here

1472
00:52:10,160 --> 00:52:13,920
of how this was done

1473
00:52:11,440 --> 00:52:15,839
we ran wireshark we were in sysmon if

1474
00:52:13,920 --> 00:52:18,880
you want to learn how to do all that

1475
00:52:15,839 --> 00:52:21,920
and then for each one of these um

1476
00:52:18,880 --> 00:52:26,000
we show how to deploy

1477
00:52:21,920 --> 00:52:26,559
um and run through these so for instance

1478
00:52:26,000 --> 00:52:29,359
uh

1479
00:52:26,559 --> 00:52:30,800
this is empire we explain how to run

1480
00:52:29,359 --> 00:52:33,839
through empire how to

1481
00:52:30,800 --> 00:52:36,240
emulate a particular threat actor

1482
00:52:33,839 --> 00:52:37,839
how to set everything up etc how to do

1483
00:52:36,240 --> 00:52:41,118
some of the ttps

1484
00:52:37,839 --> 00:52:43,599
for example here discovery get the uac

1485
00:52:41,119 --> 00:52:45,200
level that tells you what level you're

1486
00:52:43,599 --> 00:52:48,079
currently running as

1487
00:52:45,200 --> 00:52:49,839
before you tried to elevate it um i also

1488
00:52:48,079 --> 00:52:53,280
did posh c2

1489
00:52:49,839 --> 00:52:53,920
um emulating cozy bear explaining how to

1490
00:52:53,280 --> 00:52:56,960
do that

1491
00:52:53,920 --> 00:53:01,200
so there's a ton of data here

1492
00:52:56,960 --> 00:53:04,160
on this um site that can show you how to

1493
00:53:01,200 --> 00:53:05,439
do all of these ttps how to emulate them

1494
00:53:04,160 --> 00:53:08,640
and how to test them

1495
00:53:05,440 --> 00:53:10,400
against yourself um just real quick this

1496
00:53:08,640 --> 00:53:13,118
is what the vm looks like

1497
00:53:10,400 --> 00:53:16,319
it's a nice little screenshot there of a

1498
00:53:13,119 --> 00:53:20,240
slingshot linux distribution c2 matrix

1499
00:53:16,319 --> 00:53:23,440
and then everything is in slash up

1500
00:53:20,240 --> 00:53:27,200
and we can see here we have a number

1501
00:53:23,440 --> 00:53:28,720
of uh the c2s already installed and you

1502
00:53:27,200 --> 00:53:32,240
just have to follow

1503
00:53:28,720 --> 00:53:35,439
what it says here on the um

1504
00:53:32,240 --> 00:53:36,799
on the how to so the last thing here i

1505
00:53:35,440 --> 00:53:40,240
want to show you was about

1506
00:53:36,800 --> 00:53:43,280
abusing uac in this case

1507
00:53:40,240 --> 00:53:46,240
uh this uac bypass

1508
00:53:43,280 --> 00:53:47,839
uh it's its own sub technique i believe

1509
00:53:46,240 --> 00:53:52,558
it was zero zero four

1510
00:53:47,839 --> 00:53:55,040
no what number was it was it three

1511
00:53:52,559 --> 00:53:56,000
no you could do it through sudo you can

1512
00:53:55,040 --> 00:53:59,040
do it there we go

1513
00:53:56,000 --> 00:54:01,440
uac bypass and we can see um

1514
00:53:59,040 --> 00:54:03,520
what threat actors have used this this

1515
00:54:01,440 --> 00:54:06,160
one in particular has been used by allah

1516
00:54:03,520 --> 00:54:07,359
and here you see uac me so you this is

1517
00:54:06,160 --> 00:54:11,118
the uac me

1518
00:54:07,359 --> 00:54:13,680
site on github that also walks you

1519
00:54:11,119 --> 00:54:16,079
through how to actually do all that so

1520
00:54:13,680 --> 00:54:17,200
in the interest of time i have to

1521
00:54:16,079 --> 00:54:20,559
continue

1522
00:54:17,200 --> 00:54:24,399
um but lots of stuff there now

1523
00:54:20,559 --> 00:54:26,720
how to not get stung by the honey bee

1524
00:54:24,400 --> 00:54:29,520
well one of the main things i saw here

1525
00:54:26,720 --> 00:54:32,720
is ftp as a c2 channel

1526
00:54:29,520 --> 00:54:35,200
and that's something we rarely see

1527
00:54:32,720 --> 00:54:36,720
you shouldn't allow ftp anywhere in your

1528
00:54:35,200 --> 00:54:37,598
network because it's a clear text

1529
00:54:36,720 --> 00:54:40,720
protocol

1530
00:54:37,599 --> 00:54:43,280
right so if you allow it outbound

1531
00:54:40,720 --> 00:54:44,959
then you have the ability of having c2

1532
00:54:43,280 --> 00:54:47,119
might be something you want to test

1533
00:54:44,960 --> 00:54:48,799
and if you have ftp inbound you should

1534
00:54:47,119 --> 00:54:50,960
probably check that too

1535
00:54:48,799 --> 00:54:52,559
other things you can do is monitor

1536
00:54:50,960 --> 00:54:54,960
egress from your network how does

1537
00:54:52,559 --> 00:54:57,920
traffic go from inside your network out

1538
00:54:54,960 --> 00:54:59,119
for example you might only allow http

1539
00:54:57,920 --> 00:55:01,280
that's great

1540
00:54:59,119 --> 00:55:02,400
but how do you know it's an actual web

1541
00:55:01,280 --> 00:55:05,119
traffic and

1542
00:55:02,400 --> 00:55:06,000
not malicious traffic check for things

1543
00:55:05,119 --> 00:55:09,359
like heartbeat

1544
00:55:06,000 --> 00:55:11,280
if one particular system calls out every

1545
00:55:09,359 --> 00:55:14,640
30 seconds

1546
00:55:11,280 --> 00:55:15,680
then something might be going on also

1547
00:55:14,640 --> 00:55:17,839
think about jitter

1548
00:55:15,680 --> 00:55:19,118
what if it's not every 30 seconds on the

1549
00:55:17,839 --> 00:55:21,440
dot but

1550
00:55:19,119 --> 00:55:24,319
if it's every 20 seconds and then every

1551
00:55:21,440 --> 00:55:27,599
27 seconds and then every 22 seconds

1552
00:55:24,319 --> 00:55:29,839
you might have some jitter also this

1553
00:55:27,599 --> 00:55:31,920
threat actor did a lot of exfiltration

1554
00:55:29,839 --> 00:55:33,680
so look at the amount of data going out

1555
00:55:31,920 --> 00:55:34,480
of your network you can test this pretty

1556
00:55:33,680 --> 00:55:37,440
easily

1557
00:55:34,480 --> 00:55:39,359
upload a gig of traffic to a site on the

1558
00:55:37,440 --> 00:55:41,920
internet don't upload bad

1559
00:55:39,359 --> 00:55:43,279
actual business data but upload it and

1560
00:55:41,920 --> 00:55:46,079
see if anyone noticed

1561
00:55:43,280 --> 00:55:46,640
no one noticed upload 10 gigs no one

1562
00:55:46,079 --> 00:55:50,000
noticed

1563
00:55:46,640 --> 00:55:52,240
upload 100 gigs until someone notices

1564
00:55:50,000 --> 00:55:53,520
obviously do all of this with permission

1565
00:55:52,240 --> 00:55:56,640
and then for the uac

1566
00:55:53,520 --> 00:55:57,920
bypass ensure all users aren't local

1567
00:55:56,640 --> 00:56:00,400
admin right because

1568
00:55:57,920 --> 00:56:00,960
if you already have that user as a local

1569
00:56:00,400 --> 00:56:03,599
admin

1570
00:56:00,960 --> 00:56:04,240
then the uac bypass will be inevitable

1571
00:56:03,599 --> 00:56:06,720
they will

1572
00:56:04,240 --> 00:56:08,479
eventually escalate their privileges and

1573
00:56:06,720 --> 00:56:12,959
no bob in accounting does

1574
00:56:08,480 --> 00:56:15,760
not need local admin privileges

1575
00:56:12,960 --> 00:56:16,960
so um if you like this adversary

1576
00:56:15,760 --> 00:56:18,960
emulation stuff

1577
00:56:16,960 --> 00:56:21,119
then definitely check out threat

1578
00:56:18,960 --> 00:56:22,559
thursday um we post on twitter and

1579
00:56:21,119 --> 00:56:25,599
linkedin it's hashtag

1580
00:56:22,559 --> 00:56:26,720
threat thursday every week we introduce

1581
00:56:25,599 --> 00:56:28,160
an adversary so

1582
00:56:26,720 --> 00:56:30,240
we're gonna have honeybee and there's

1583
00:56:28,160 --> 00:56:33,040
gonna be the link for honeybee um

1584
00:56:30,240 --> 00:56:33,759
last week we did speak up which was a

1585
00:56:33,040 --> 00:56:36,880
mac

1586
00:56:33,760 --> 00:56:38,400
uh os malware that we replicated

1587
00:56:36,880 --> 00:56:40,559
um and we do pretty much what we just

1588
00:56:38,400 --> 00:56:41,520
did here we look at cyber threat

1589
00:56:40,559 --> 00:56:44,960
intelligence

1590
00:56:41,520 --> 00:56:46,799
we map it to mitre attack we give you a

1591
00:56:44,960 --> 00:56:47,599
navigator layer if it wasn't already

1592
00:56:46,799 --> 00:56:49,520
mapped

1593
00:56:47,599 --> 00:56:53,119
then we created an adversary emulation

1594
00:56:49,520 --> 00:56:55,920
plan we share that plan on our github

1595
00:56:53,119 --> 00:56:58,240
we emulate the adversary with the video

1596
00:56:55,920 --> 00:57:00,960
and we talk about how to defend and

1597
00:56:58,240 --> 00:57:02,879
all of this is a weekly thing uh for the

1598
00:57:00,960 --> 00:57:05,920
community for all of you so

1599
00:57:02,880 --> 00:57:08,799
definitely check that out

1600
00:57:05,920 --> 00:57:09,520
lastly i did not do all of this on my

1601
00:57:08,799 --> 00:57:11,839
own

1602
00:57:09,520 --> 00:57:13,599
uh all of this has been years and years

1603
00:57:11,839 --> 00:57:15,200
of experience and working with people

1604
00:57:13,599 --> 00:57:18,000
and giving back to a community

1605
00:57:15,200 --> 00:57:19,520
so i'm not taking credit for most of it

1606
00:57:18,000 --> 00:57:21,920
a lot of it has

1607
00:57:19,520 --> 00:57:23,359
um been out there and what we've done is

1608
00:57:21,920 --> 00:57:25,040
just brought it together in a way that

1609
00:57:23,359 --> 00:57:27,359
we can deliver it in one hour

1610
00:57:25,040 --> 00:57:28,799
or less right but these are programs

1611
00:57:27,359 --> 00:57:29,839
that are being ran in large

1612
00:57:28,799 --> 00:57:31,920
organizations

1613
00:57:29,839 --> 00:57:33,200
here's a whole bunch of references for

1614
00:57:31,920 --> 00:57:36,480
you and

1615
00:57:33,200 --> 00:57:40,480
i think that is it for my time

1616
00:57:36,480 --> 00:57:40,480
i really appreciate yours

1617
00:57:52,839 --> 00:57:55,839
yes

1618
00:58:05,040 --> 00:58:07,119
you

