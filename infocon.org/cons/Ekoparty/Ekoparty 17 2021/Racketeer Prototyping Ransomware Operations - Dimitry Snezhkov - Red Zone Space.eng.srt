1
00:00:01,760 --> 00:00:04,560
hello everybody welcome to my talk

2
00:00:04,560 --> 00:00:06,000
racketeer

3
00:00:06,000 --> 00:00:07,759
prototyping control ransomware

4
00:00:07,759 --> 00:00:09,360
operations

5
00:00:09,360 --> 00:00:11,280
my name is demetrius nashkov i'm a

6
00:00:11,280 --> 00:00:14,480
researcher with ibm x-force

7
00:00:14,480 --> 00:00:17,840
my interest lay in creating tools doing

8
00:00:17,840 --> 00:00:20,320
some offensive and sometimes defensive

9
00:00:20,320 --> 00:00:21,359
research

10
00:00:21,359 --> 00:00:24,800
and also interested in automation

11
00:00:24,800 --> 00:00:26,240
so today we're going to talk about

12
00:00:26,240 --> 00:00:29,519
ransomware um but before we jump into

13
00:00:29,519 --> 00:00:30,960
the technical

14
00:00:30,960 --> 00:00:34,239
discussion of um

15
00:00:34,320 --> 00:00:36,880
actually prototyping life cycle of uh

16
00:00:36,880 --> 00:00:39,040
simulation for ransomware

17
00:00:39,040 --> 00:00:40,879
let's talk about the business case for

18
00:00:40,879 --> 00:00:43,360
ransomware because that is important to

19
00:00:43,360 --> 00:00:46,239
understand the why for creating tools

20
00:00:46,239 --> 00:00:48,559
and for creating uh simulations for

21
00:00:48,559 --> 00:00:50,719
ransomware

22
00:00:50,719 --> 00:00:51,760
well

23
00:00:51,760 --> 00:00:55,120
ransomware is a business model

24
00:00:55,120 --> 00:00:57,680
despite what you may read somewhere on

25
00:00:57,680 --> 00:00:58,879
the internet

26
00:00:58,879 --> 00:01:02,239
it is very efficient it has about 330

27
00:01:02,239 --> 00:01:05,199
year over year growth in 2020 which is

28
00:01:05,199 --> 00:01:06,799
pretty high

29
00:01:06,799 --> 00:01:09,520
the return on capital speed versus other

30
00:01:09,520 --> 00:01:11,040
cyber channels when the intrusion

31
00:01:11,040 --> 00:01:14,080
happens is also very fast

32
00:01:14,080 --> 00:01:17,840
if you are a ransomware enterprise

33
00:01:17,840 --> 00:01:20,000
then you want to run it efficiently you

34
00:01:20,000 --> 00:01:22,400
want to acquire your customers really

35
00:01:22,400 --> 00:01:25,840
fast in your case it would mean

36
00:01:25,840 --> 00:01:28,320
intruding on the box getting uh getting

37
00:01:28,320 --> 00:01:29,920
hold of assets

38
00:01:29,920 --> 00:01:32,159
and making it very cheap to do so and

39
00:01:32,159 --> 00:01:33,200
mass

40
00:01:33,200 --> 00:01:34,159
right

41
00:01:34,159 --> 00:01:35,680
at the same time

42
00:01:35,680 --> 00:01:37,920
you do not want to

43
00:01:37,920 --> 00:01:39,040
keep

44
00:01:39,040 --> 00:01:41,119
a persistence for very long time for the

45
00:01:41,119 --> 00:01:43,119
fear of being discovered and so your

46
00:01:43,119 --> 00:01:44,720
stealth mode

47
00:01:44,720 --> 00:01:46,000
into

48
00:01:46,000 --> 00:01:47,920
monetization for the time that you can

49
00:01:47,920 --> 00:01:50,079
actually make money from

50
00:01:50,079 --> 00:01:52,799
initial purpose uh has to be shortened

51
00:01:52,799 --> 00:01:55,520
ransomware allows you to do that

52
00:01:55,520 --> 00:01:56,719
and also

53
00:01:56,719 --> 00:01:59,759
if you are a developer for ransomware

54
00:01:59,759 --> 00:02:01,680
obviously you want to maximize your

55
00:02:01,680 --> 00:02:04,640
profits so you are providing service to

56
00:02:04,640 --> 00:02:07,040
your customers the ransomware people

57
00:02:07,040 --> 00:02:10,318
right and they're paying you and so you

58
00:02:10,318 --> 00:02:13,280
are incentivized to create features

59
00:02:13,280 --> 00:02:15,120
uh to receive more funding to create

60
00:02:15,120 --> 00:02:16,800
more features it's a never-ending

61
00:02:16,800 --> 00:02:20,879
circles with high quality assurance so

62
00:02:20,879 --> 00:02:23,440
improving your ransomware toolkit is

63
00:02:23,440 --> 00:02:25,520
also a a plus for you if you're a

64
00:02:25,520 --> 00:02:27,120
business

65
00:02:27,120 --> 00:02:29,920
now if you are selling a

66
00:02:29,920 --> 00:02:32,480
a kit to be able to do

67
00:02:32,480 --> 00:02:33,360
uh

68
00:02:33,360 --> 00:02:35,200
you know to extort

69
00:02:35,200 --> 00:02:37,680
companies or persons

70
00:02:37,680 --> 00:02:40,800
your barrier to entry for the tool uh

71
00:02:40,800 --> 00:02:42,640
has to be low anybody should be able to

72
00:02:42,640 --> 00:02:43,840
run it

73
00:02:43,840 --> 00:02:46,800
to get um what they need

74
00:02:46,800 --> 00:02:48,879
strictly speaking from just maintenance

75
00:02:48,879 --> 00:02:50,400
perspective and

76
00:02:50,400 --> 00:02:52,959
you know business perspective

77
00:02:52,959 --> 00:02:54,959
and then also

78
00:02:54,959 --> 00:02:57,680
monetization for your toolkit has to be

79
00:02:57,680 --> 00:03:00,080
fast and for your customers to see a

80
00:03:00,080 --> 00:03:02,720
value in it their money monetization has

81
00:03:02,720 --> 00:03:04,480
to be fast and so

82
00:03:04,480 --> 00:03:07,440
use of technical means to

83
00:03:07,440 --> 00:03:10,080
convert digital to analog for example

84
00:03:10,080 --> 00:03:12,400
from bits to money

85
00:03:12,400 --> 00:03:14,800
um has to sort of play a role for

86
00:03:14,800 --> 00:03:16,319
example with the

87
00:03:16,319 --> 00:03:19,040
use of cryptocurrency it becomes a lot

88
00:03:19,040 --> 00:03:21,920
more frictionless to be able to monetize

89
00:03:21,920 --> 00:03:24,640
uh your toolkit or your intrusion

90
00:03:24,640 --> 00:03:26,959
really really fast

91
00:03:26,959 --> 00:03:28,239
and so

92
00:03:28,239 --> 00:03:31,280
with that comes uh issues

93
00:03:31,280 --> 00:03:32,799
when you have

94
00:03:32,799 --> 00:03:34,959
technical difficulties or you have

95
00:03:34,959 --> 00:03:36,560
operational security concerns for

96
00:03:36,560 --> 00:03:38,400
example attribution

97
00:03:38,400 --> 00:03:40,400
for you or your customers being on the

98
00:03:40,400 --> 00:03:41,519
network

99
00:03:41,519 --> 00:03:43,040
has to be

100
00:03:43,040 --> 00:03:45,360
lowered in order for you to persist for

101
00:03:45,360 --> 00:03:48,319
a while right and so technical means for

102
00:03:48,319 --> 00:03:50,159
ransomware

103
00:03:50,159 --> 00:03:52,640
um in addition to using cryptocurrency

104
00:03:52,640 --> 00:03:54,239
with ransomware kind of

105
00:03:54,239 --> 00:03:56,560
solves that problem to a degree right so

106
00:03:56,560 --> 00:03:58,400
it's both technical and operational

107
00:03:58,400 --> 00:03:59,680
issue

108
00:03:59,680 --> 00:04:02,640
so all these points kind of bring me to

109
00:04:02,640 --> 00:04:04,480
the conclusion i don't know about you

110
00:04:04,480 --> 00:04:06,159
but i myself

111
00:04:06,159 --> 00:04:08,159
think that ransomware is an efficient

112
00:04:08,159 --> 00:04:10,720
economic exit activity

113
00:04:10,720 --> 00:04:13,439
we're a creator of the tool or user of

114
00:04:13,439 --> 00:04:14,640
the tool

115
00:04:14,640 --> 00:04:17,519
is a business and a successful one at

116
00:04:17,519 --> 00:04:19,040
that

117
00:04:19,040 --> 00:04:21,358
and so if we look at

118
00:04:21,358 --> 00:04:24,400
the ransomware as a business

119
00:04:24,400 --> 00:04:27,440
how do we disrupt it as a business

120
00:04:27,440 --> 00:04:30,000
can we iterate better can we create a

121
00:04:30,000 --> 00:04:32,400
better business model to counter it

122
00:04:32,400 --> 00:04:34,080
and if so

123
00:04:34,080 --> 00:04:36,240
what are the key ingredients to compete

124
00:04:36,240 --> 00:04:37,520
in this market

125
00:04:37,520 --> 00:04:39,040
right

126
00:04:39,040 --> 00:04:39,759
so

127
00:04:39,759 --> 00:04:42,080
the life cycle of ransomware has to be

128
00:04:42,080 --> 00:04:44,919
taken into account and that is pretty

129
00:04:44,919 --> 00:04:47,680
self-explanatory right you are dropping

130
00:04:47,680 --> 00:04:50,400
on the box as a malware operator

131
00:04:50,400 --> 00:04:52,000
you're trying to persist on the box

132
00:04:52,000 --> 00:04:54,720
either directly uh playing towards

133
00:04:54,720 --> 00:04:57,520
ransom or maybe waiting a little bit

134
00:04:57,520 --> 00:04:59,440
then there's a breakdown in

135
00:04:59,440 --> 00:05:01,360
communication where you try to extort

136
00:05:01,360 --> 00:05:02,960
maybe you work out the detail with the

137
00:05:02,960 --> 00:05:04,160
customer

138
00:05:04,160 --> 00:05:06,639
uh maybe you know some negotiation

139
00:05:06,639 --> 00:05:08,639
online or flying happens

140
00:05:08,639 --> 00:05:11,280
you receive the money and maybe

141
00:05:11,280 --> 00:05:13,280
if you're a good uh

142
00:05:13,280 --> 00:05:14,960
professional

143
00:05:14,960 --> 00:05:16,639
ransomware person you will just stage

144
00:05:16,639 --> 00:05:17,520
your

145
00:05:17,520 --> 00:05:21,360
ransomware uh basically delete it and uh

146
00:05:21,360 --> 00:05:23,520
decrypt the files that you've encrypted

147
00:05:23,520 --> 00:05:25,919
or the whatever the case may be right so

148
00:05:25,919 --> 00:05:27,039
pretty much

149
00:05:27,039 --> 00:05:28,720
you're being an honest criminal if you

150
00:05:28,720 --> 00:05:30,400
want

151
00:05:30,400 --> 00:05:31,840
and so

152
00:05:31,840 --> 00:05:34,560
that is sort of um the life cycle of

153
00:05:34,560 --> 00:05:36,639
ransomware in a nutshell

154
00:05:36,639 --> 00:05:38,560
so how do companies

155
00:05:38,560 --> 00:05:41,280
prevent that and how do red teams

156
00:05:41,280 --> 00:05:44,240
and purple teams can actually exercise

157
00:05:44,240 --> 00:05:47,360
and train themselves on this uh sort of

158
00:05:47,360 --> 00:05:48,960
mechanism right

159
00:05:48,960 --> 00:05:50,000
because

160
00:05:50,000 --> 00:05:51,759
if you think about it it's not only a

161
00:05:51,759 --> 00:05:55,039
technical issue it involves operational

162
00:05:55,039 --> 00:05:58,160
uh facets potentially it involves legal

163
00:05:58,160 --> 00:06:01,360
processes potentially it involves um

164
00:06:01,360 --> 00:06:03,199
operational security when you do not

165
00:06:03,199 --> 00:06:05,280
want to talk to the customer and unmask

166
00:06:05,280 --> 00:06:06,800
yourself but at the same time you want

167
00:06:06,800 --> 00:06:07,680
to get

168
00:06:07,680 --> 00:06:10,800
monetary rewards and uh

169
00:06:10,800 --> 00:06:13,039
decrypt the files and so

170
00:06:13,039 --> 00:06:15,120
traditionally preventative and detection

171
00:06:15,120 --> 00:06:16,560
controls

172
00:06:16,560 --> 00:06:18,479
work for you

173
00:06:18,479 --> 00:06:20,720
as a company who wants to thwart run

174
00:06:20,720 --> 00:06:23,520
somewhere just like you would for

175
00:06:23,520 --> 00:06:25,520
uh any other intrusion

176
00:06:25,520 --> 00:06:28,160
right you are taking care of the

177
00:06:28,160 --> 00:06:30,240
uh indicators of compromise you try to

178
00:06:30,240 --> 00:06:32,319
figure out where the uh you know where

179
00:06:32,319 --> 00:06:35,840
to hunt uh then you try to eradicate um

180
00:06:35,840 --> 00:06:38,319
and as a tester you want to stay alive

181
00:06:38,319 --> 00:06:39,120
and do

182
00:06:39,120 --> 00:06:40,560
a sensible and successful

183
00:06:40,560 --> 00:06:42,160
post-explanation

184
00:06:42,160 --> 00:06:44,560
post-exploitation right

185
00:06:44,560 --> 00:06:45,520
so

186
00:06:45,520 --> 00:06:47,600
as an organization disaster recovery

187
00:06:47,600 --> 00:06:49,759
drills are important because

188
00:06:49,759 --> 00:06:53,199
what if the attacker is there for

189
00:06:53,199 --> 00:06:54,880
you know not only to encrypt but

190
00:06:54,880 --> 00:06:57,360
basically leave or the agent dies and

191
00:06:57,360 --> 00:07:00,000
the the attacker doesn't have a way to

192
00:07:00,000 --> 00:07:01,360
get back into your environment to

193
00:07:01,360 --> 00:07:03,520
decrypt even though you're willing to

194
00:07:03,520 --> 00:07:05,120
pay

195
00:07:05,120 --> 00:07:07,840
and so instead of response triage has to

196
00:07:07,840 --> 00:07:10,720
be up and up on understanding the threat

197
00:07:10,720 --> 00:07:13,120
and following this threat not only as a

198
00:07:13,120 --> 00:07:15,759
technical means but foreseen and

199
00:07:15,759 --> 00:07:18,319
anticipating things that may happen

200
00:07:18,319 --> 00:07:19,840
if the breakdown of communication

201
00:07:19,840 --> 00:07:22,880
happens or the time to eradicate

202
00:07:22,880 --> 00:07:25,599
things grow exponentially

203
00:07:25,599 --> 00:07:28,000
or perhaps you as an organization may

204
00:07:28,000 --> 00:07:30,080
want to connect with law enforcement

205
00:07:30,080 --> 00:07:32,479
then negotiate some

206
00:07:32,479 --> 00:07:34,720
some help there right so external

207
00:07:34,720 --> 00:07:37,759
negotiation is also a factor here

208
00:07:37,759 --> 00:07:38,720
so

209
00:07:38,720 --> 00:07:40,960
while ransomware is a technical thing it

210
00:07:40,960 --> 00:07:44,080
is also a procedural thing it is also a

211
00:07:44,080 --> 00:07:46,240
policy thing and so

212
00:07:46,240 --> 00:07:48,560
you can't really eradicate it

213
00:07:48,560 --> 00:07:51,280
but the realistic victim goal is to

214
00:07:51,280 --> 00:07:52,400
to speak

215
00:07:52,400 --> 00:07:54,720
in terms of maybe uh you know paraphrase

216
00:07:54,720 --> 00:07:57,199
the storage guys is you need to increase

217
00:07:57,199 --> 00:07:59,280
mean time between failures

218
00:07:59,280 --> 00:08:01,120
right you need to do you you need to

219
00:08:01,120 --> 00:08:04,240
know what to do in certain say is

220
00:08:04,240 --> 00:08:06,160
scenarios you know what you're losing

221
00:08:06,160 --> 00:08:08,319
how much it will cost you and how you

222
00:08:08,319 --> 00:08:10,479
can recover right

223
00:08:10,479 --> 00:08:12,800
so one way of achieving this if we've

224
00:08:12,800 --> 00:08:14,960
determined that it can be eradicated but

225
00:08:14,960 --> 00:08:18,160
it can only played and and kind of

226
00:08:18,160 --> 00:08:19,919
minimized right

227
00:08:19,919 --> 00:08:21,440
first of all as a business you need to

228
00:08:21,440 --> 00:08:24,080
know your assets and data where it is

229
00:08:24,080 --> 00:08:26,720
how it interacts what's important right

230
00:08:26,720 --> 00:08:28,560
that's a hard problem to solve

231
00:08:28,560 --> 00:08:30,160
everybody's trying

232
00:08:30,160 --> 00:08:32,000
but that's something you actually need i

233
00:08:32,000 --> 00:08:34,240
i did not uh tell you something you did

234
00:08:34,240 --> 00:08:35,839
not know

235
00:08:35,839 --> 00:08:38,080
but the other thing is very important

236
00:08:38,080 --> 00:08:41,360
which is checking your process

237
00:08:41,360 --> 00:08:44,399
with real life simulation and feedback

238
00:08:44,399 --> 00:08:46,640
much like you do blue team exercises and

239
00:08:46,640 --> 00:08:48,959
some intrusion and lateral movement the

240
00:08:48,959 --> 00:08:51,120
same thing happens with ransomware right

241
00:08:51,120 --> 00:08:53,120
you absolutely need to get simulation

242
00:08:53,120 --> 00:08:55,839
and the feedback

243
00:08:55,920 --> 00:08:56,880
and so

244
00:08:56,880 --> 00:08:59,839
if we are to to say that we need to do

245
00:08:59,839 --> 00:09:02,000
simulation and feedback

246
00:09:02,000 --> 00:09:04,399
what is a good way of doing that

247
00:09:04,399 --> 00:09:06,880
one way of doing this is to

248
00:09:06,880 --> 00:09:09,680
create a way for technically prototyping

249
00:09:09,680 --> 00:09:12,560
the ransomware without being subject to

250
00:09:12,560 --> 00:09:14,080
the ransomware

251
00:09:14,080 --> 00:09:16,560
right so do it in a safe and sound

252
00:09:16,560 --> 00:09:19,920
manner do it in a controlled manner do

253
00:09:19,920 --> 00:09:22,399
it in such a manner that you uh you're

254
00:09:22,399 --> 00:09:24,320
not operating on live malware but you're

255
00:09:24,320 --> 00:09:27,360
actually simulating its steps right and

256
00:09:27,360 --> 00:09:31,200
the goal here is not to target the tool

257
00:09:31,200 --> 00:09:34,000
the dole the goal here is to refine the

258
00:09:34,000 --> 00:09:37,200
process of your response that you have

259
00:09:37,200 --> 00:09:38,160
right

260
00:09:38,160 --> 00:09:41,440
use the tool as a as a mechanism to

261
00:09:41,440 --> 00:09:42,880
improve process

262
00:09:42,880 --> 00:09:45,760
not only to catch the tool used by a pen

263
00:09:45,760 --> 00:09:48,399
tester a red teamer right

264
00:09:48,399 --> 00:09:49,440
because

265
00:09:49,440 --> 00:09:52,399
in a way you will never be able to uh

266
00:09:52,399 --> 00:09:56,000
mark and signature every single tool

267
00:09:56,000 --> 00:09:58,160
tools change dependencies change what

268
00:09:58,160 --> 00:09:59,920
you are after is behavioral

269
00:09:59,920 --> 00:10:01,519
characteristics

270
00:10:01,519 --> 00:10:03,519
that you can play on and

271
00:10:03,519 --> 00:10:04,399
kind of

272
00:10:04,399 --> 00:10:06,959
you know revise your process

273
00:10:06,959 --> 00:10:08,640
but the implementation of that process

274
00:10:08,640 --> 00:10:11,279
can be done in software right

275
00:10:11,279 --> 00:10:13,440
and depending who you are you can be a

276
00:10:13,440 --> 00:10:15,760
purple team uh trying to execute a

277
00:10:15,760 --> 00:10:18,480
tabletop or instant response

278
00:10:18,480 --> 00:10:21,040
and use ransomware tooling as

279
00:10:21,040 --> 00:10:23,279
uh you know to help you with that maybe

280
00:10:23,279 --> 00:10:25,120
a kickoff

281
00:10:25,120 --> 00:10:27,839
starts with infection or whatever right

282
00:10:27,839 --> 00:10:30,480
if your blue team on the stock side you

283
00:10:30,480 --> 00:10:31,519
want

284
00:10:31,519 --> 00:10:33,839
optics and how ransomware works

285
00:10:33,839 --> 00:10:36,160
not only in technical means but also

286
00:10:36,160 --> 00:10:38,240
what it takes how does it communicate

287
00:10:38,240 --> 00:10:40,160
what is the breakdown of communication

288
00:10:40,160 --> 00:10:42,240
here and there where can you

289
00:10:42,240 --> 00:10:44,480
catch it early right indicators of

290
00:10:44,480 --> 00:10:46,480
compromise

291
00:10:46,480 --> 00:10:47,600
and then

292
00:10:47,600 --> 00:10:49,519
you know for red teams

293
00:10:49,519 --> 00:10:50,959
obviously

294
00:10:50,959 --> 00:10:52,480
um

295
00:10:52,480 --> 00:10:54,560
you can use that as a lot

296
00:10:54,560 --> 00:10:55,760
to to

297
00:10:55,760 --> 00:10:57,920
to answer the last mile objectives and

298
00:10:57,920 --> 00:11:00,640
campaigns for example if you've

299
00:11:00,640 --> 00:11:02,640
accessed the environment you need to be

300
00:11:02,640 --> 00:11:04,160
accessing

301
00:11:04,160 --> 00:11:05,839
can you actually

302
00:11:05,839 --> 00:11:07,680
give an icing on a cake and actually

303
00:11:07,680 --> 00:11:09,440
work with data can you encrypt the data

304
00:11:09,440 --> 00:11:11,680
and then have the customer

305
00:11:11,680 --> 00:11:15,120
either run through the dr recovery or

306
00:11:15,120 --> 00:11:16,800
instant response whatever the case may

307
00:11:16,800 --> 00:11:19,360
be right that is going to be stag your

308
00:11:19,360 --> 00:11:21,680
stake in the ground stating that hey i

309
00:11:21,680 --> 00:11:23,920
was able to access it here's my factual

310
00:11:23,920 --> 00:11:27,040
access i've encrypted the file right

311
00:11:27,040 --> 00:11:29,839
but we're not only working on

312
00:11:29,839 --> 00:11:32,160
encryption here right

313
00:11:32,160 --> 00:11:34,240
the reason why we want it to be a

314
00:11:34,240 --> 00:11:36,880
controlled execution of ransomware

315
00:11:36,880 --> 00:11:38,079
testing

316
00:11:38,079 --> 00:11:40,880
is because we as testers have

317
00:11:40,880 --> 00:11:45,040
um certain requirements and um

318
00:11:45,040 --> 00:11:47,279
contract with the customer right so for

319
00:11:47,279 --> 00:11:49,760
example can we verify that exit was

320
00:11:49,760 --> 00:11:52,000
recovered after we simulated the

321
00:11:52,000 --> 00:11:53,360
ransomware

322
00:11:53,360 --> 00:11:55,279
right we do not want to cause denial of

323
00:11:55,279 --> 00:11:57,680
service even though it's possible

324
00:11:57,680 --> 00:11:59,920
we are not looking forward to that

325
00:11:59,920 --> 00:12:02,959
and as such we have to have ways to

326
00:12:02,959 --> 00:12:04,480
recover

327
00:12:04,480 --> 00:12:07,839
the assets back to their original state

328
00:12:07,839 --> 00:12:10,560
if we have an agent online we can do it

329
00:12:10,560 --> 00:12:13,360
online but what what happens if there's

330
00:12:13,360 --> 00:12:16,000
a breakdown of communication and the y

331
00:12:16,000 --> 00:12:16,880
team

332
00:12:16,880 --> 00:12:19,200
basically does not proxy your request to

333
00:12:19,200 --> 00:12:22,000
the blue team blue team sees it sees the

334
00:12:22,000 --> 00:12:24,240
ransomwaring environment eradicates the

335
00:12:24,240 --> 00:12:25,600
agent

336
00:12:25,600 --> 00:12:28,160
and your

337
00:12:28,160 --> 00:12:30,639
your encrypted files stay encrypted how

338
00:12:30,639 --> 00:12:33,040
do you recover so there's a way or it

339
00:12:33,040 --> 00:12:35,440
has to be a way to think about offline

340
00:12:35,440 --> 00:12:36,839
recovery for

341
00:12:36,839 --> 00:12:39,760
organization the other thing that you as

342
00:12:39,760 --> 00:12:42,240
a tester or you as a simulation tool

343
00:12:42,240 --> 00:12:44,639
writer have to think about

344
00:12:44,639 --> 00:12:47,279
is protecting the data access

345
00:12:47,279 --> 00:12:48,959
with your tool

346
00:12:48,959 --> 00:12:51,680
if a customer gives you or entrusts you

347
00:12:51,680 --> 00:12:54,079
or your tool with credentials

348
00:12:54,079 --> 00:12:57,760
to say go find this host log into it

349
00:12:57,760 --> 00:12:59,920
find a find the file

350
00:12:59,920 --> 00:13:02,800
encrypt it right the way to think about

351
00:13:02,800 --> 00:13:05,440
it is it is customer data we do not want

352
00:13:05,440 --> 00:13:06,399
to

353
00:13:06,399 --> 00:13:08,240
lose it so there's a way to do

354
00:13:08,240 --> 00:13:10,880
protection on customer

355
00:13:10,880 --> 00:13:11,920
access

356
00:13:11,920 --> 00:13:14,240
tokens as well as data itself we need to

357
00:13:14,240 --> 00:13:16,240
think about that

358
00:13:16,240 --> 00:13:17,519
and

359
00:13:17,519 --> 00:13:20,320
with that sla and the protection and

360
00:13:20,320 --> 00:13:23,360
staying within the scope um our main

361
00:13:23,360 --> 00:13:25,279
mandate is to basically do precise

362
00:13:25,279 --> 00:13:26,720
targets

363
00:13:26,720 --> 00:13:29,680
we need to leave customer mostly intact

364
00:13:29,680 --> 00:13:31,600
because testing is the goal not denial

365
00:13:31,600 --> 00:13:34,959
of service and and frankly even if you

366
00:13:34,959 --> 00:13:37,120
are the attacker you want to be clean on

367
00:13:37,120 --> 00:13:40,160
the network right you need to get in do

368
00:13:40,160 --> 00:13:42,160
your thing get out without being

369
00:13:42,160 --> 00:13:43,839
detected right

370
00:13:43,839 --> 00:13:46,399
to the to the best of our

371
00:13:46,399 --> 00:13:48,880
knowledge tools are uh ethically

372
00:13:48,880 --> 00:13:51,120
ambivalent right we do not play black or

373
00:13:51,120 --> 00:13:53,440
white side we're just creating a tool to

374
00:13:53,440 --> 00:13:57,839
deal properly with ransomware but for us

375
00:13:57,839 --> 00:14:00,480
uh precise targets protection of data

376
00:14:00,480 --> 00:14:02,720
access and service level agreements for

377
00:14:02,720 --> 00:14:04,959
access recovery as testers are very

378
00:14:04,959 --> 00:14:06,959
important

379
00:14:06,959 --> 00:14:09,360
and because uh tools can be used in

380
00:14:09,360 --> 00:14:12,160
different ways stealth is a balance

381
00:14:12,160 --> 00:14:14,240
right we can decrease or increase

382
00:14:14,240 --> 00:14:16,880
stealth in a tool depending on on the

383
00:14:16,880 --> 00:14:19,279
maturity model for the customer

384
00:14:19,279 --> 00:14:22,320
because if you are bringing a cannon

385
00:14:22,320 --> 00:14:24,079
into a fist flight obviously you're

386
00:14:24,079 --> 00:14:25,199
gonna win

387
00:14:25,199 --> 00:14:27,360
but if the goal is to refine process for

388
00:14:27,360 --> 00:14:30,959
organizations you're not going to win

389
00:14:30,959 --> 00:14:32,880
because you're not you have not helped

390
00:14:32,880 --> 00:14:34,639
the customer so

391
00:14:34,639 --> 00:14:36,720
stealth is a balance in this specific

392
00:14:36,720 --> 00:14:38,959
tooling

393
00:14:38,959 --> 00:14:40,399
so

394
00:14:40,399 --> 00:14:42,320
we've talked about a

395
00:14:42,320 --> 00:14:44,399
general idea of what we need to do to

396
00:14:44,399 --> 00:14:47,120
simulate things properly

397
00:14:47,120 --> 00:14:48,480
tactically

398
00:14:48,480 --> 00:14:50,320
there are features of the tool that need

399
00:14:50,320 --> 00:14:53,360
to be present in order for us

400
00:14:53,360 --> 00:14:54,560
to

401
00:14:54,560 --> 00:14:56,560
um to kind of you know think about

402
00:14:56,560 --> 00:14:58,880
different scenarios and uh prototype

403
00:14:58,880 --> 00:14:59,920
things

404
00:14:59,920 --> 00:15:01,519
we need to be able to obviously

405
00:15:01,519 --> 00:15:04,320
correctly lock and unlock files

406
00:15:04,320 --> 00:15:05,120
um

407
00:15:05,120 --> 00:15:07,360
encryption and decryption we need to do

408
00:15:07,360 --> 00:15:09,279
lifetime key management what if we lose

409
00:15:09,279 --> 00:15:11,920
a key how do we recover it was the deal

410
00:15:11,920 --> 00:15:13,440
there

411
00:15:13,440 --> 00:15:16,000
we've talked about recovery of assets

412
00:15:16,000 --> 00:15:19,279
real time or potentially offline when

413
00:15:19,279 --> 00:15:21,360
the customer says i've lost your agent

414
00:15:21,360 --> 00:15:22,639
can you

415
00:15:22,639 --> 00:15:24,399
can you recover can you generate me a

416
00:15:24,399 --> 00:15:26,240
key key generator or can i send you a

417
00:15:26,240 --> 00:15:29,120
file for recovery you know so we're

418
00:15:29,120 --> 00:15:30,959
emulating attacker and attacker

419
00:15:30,959 --> 00:15:33,120
basically says okay fine

420
00:15:33,120 --> 00:15:34,720
i'll charge you a thousand dollars for

421
00:15:34,720 --> 00:15:37,759
two files right to simulate that model

422
00:15:37,759 --> 00:15:40,399
as opposed to simulating everything or

423
00:15:40,399 --> 00:15:43,199
nothing is very valuable

424
00:15:43,199 --> 00:15:45,600
and also flexibility in communications

425
00:15:45,600 --> 00:15:47,120
two targets

426
00:15:47,120 --> 00:15:49,199
on the internal network as well as

427
00:15:49,199 --> 00:15:50,959
connectivity to the attacker it said

428
00:15:50,959 --> 00:15:52,399
itself

429
00:15:52,399 --> 00:15:54,959
so if we agree that all these things

430
00:15:54,959 --> 00:15:58,480
should be in the toolkit let's build it

431
00:15:58,480 --> 00:16:00,560
so how do we build it

432
00:16:00,560 --> 00:16:02,480
well first of all let's uh let's solve

433
00:16:02,480 --> 00:16:04,079
for uh the

434
00:16:04,079 --> 00:16:06,800
presence of the agent

435
00:16:06,800 --> 00:16:09,519
let's say it's a windows agent right uh

436
00:16:09,519 --> 00:16:11,839
we want to target windows environment

437
00:16:11,839 --> 00:16:12,880
where

438
00:16:12,880 --> 00:16:14,000
um

439
00:16:14,000 --> 00:16:15,759
i wouldn't say majority of data lives

440
00:16:15,759 --> 00:16:18,320
but uh detectors have easier way

441
00:16:18,320 --> 00:16:20,240
sometimes to target windows environments

442
00:16:20,240 --> 00:16:22,480
because it's also an office network

443
00:16:22,480 --> 00:16:24,399
right and

444
00:16:24,399 --> 00:16:27,360
you know tier one workstations uh are

445
00:16:27,360 --> 00:16:29,920
also a trace and you know organizations

446
00:16:29,920 --> 00:16:31,920
spend a ton of time and money and

447
00:16:31,920 --> 00:16:33,279
thinking about

448
00:16:33,279 --> 00:16:34,959
how they're gonna protect workstations

449
00:16:34,959 --> 00:16:37,120
right before customers before

450
00:16:37,120 --> 00:16:39,759
uh server side gets popped and right the

451
00:16:39,759 --> 00:16:41,839
attacker moves to the server side

452
00:16:41,839 --> 00:16:43,519
but also windows is important because

453
00:16:43,519 --> 00:16:45,759
there are shares to the business data

454
00:16:45,759 --> 00:16:46,800
right

455
00:16:46,800 --> 00:16:49,360
so no longer with ransomware it is a

456
00:16:49,360 --> 00:16:51,519
second or third tier that the attacker

457
00:16:51,519 --> 00:16:52,880
needs to get to

458
00:16:52,880 --> 00:16:54,720
a lot of the important data can be

459
00:16:54,720 --> 00:16:58,320
proxied and uh you know by by mounting a

460
00:16:58,320 --> 00:17:00,720
share on a workstation right

461
00:17:00,720 --> 00:17:03,040
so that's important uh because we've

462
00:17:03,040 --> 00:17:05,439
talked about ransomware monetization

463
00:17:05,439 --> 00:17:08,160
model and tier one is always cheaper

464
00:17:08,160 --> 00:17:09,599
than anything

465
00:17:09,599 --> 00:17:11,760
that needs to go to tier two and tier

466
00:17:11,760 --> 00:17:13,439
three because you need to spend more

467
00:17:13,439 --> 00:17:16,400
time you need to create more noise

468
00:17:16,400 --> 00:17:19,199
and as such you may get detected

469
00:17:19,199 --> 00:17:20,079
so

470
00:17:20,079 --> 00:17:22,480
let's let's review windows um when we

471
00:17:22,480 --> 00:17:24,880
talk about the scenarios where we're

472
00:17:24,880 --> 00:17:27,280
getting uh to files it could be local

473
00:17:27,280 --> 00:17:28,400
files

474
00:17:28,400 --> 00:17:30,480
but also we need the ability to remote

475
00:17:30,480 --> 00:17:32,480
on the internal network right

476
00:17:32,480 --> 00:17:34,400
impersonating users

477
00:17:34,400 --> 00:17:35,919
uh potentially

478
00:17:35,919 --> 00:17:37,919
if we're working in teams the first team

479
00:17:37,919 --> 00:17:40,160
pop the box create you know dump the uh

480
00:17:40,160 --> 00:17:42,480
tokens give you credentials you the

481
00:17:42,480 --> 00:17:44,480
ransomware author plug

482
00:17:44,480 --> 00:17:46,400
credentials in and maybe you can

483
00:17:46,400 --> 00:17:48,000
remote over to

484
00:17:48,000 --> 00:17:49,520
uh several different boxes and you can

485
00:17:49,520 --> 00:17:52,080
target files there right so that allows

486
00:17:52,080 --> 00:17:54,080
you to simulate different teams uh and

487
00:17:54,080 --> 00:17:56,720
how they execute in the wild

488
00:17:56,720 --> 00:17:58,480
and overall just tight control of

489
00:17:58,480 --> 00:18:01,760
execution and

490
00:18:01,760 --> 00:18:04,320
so we are working not only on local

491
00:18:04,320 --> 00:18:06,400
machine we have to have a way to go

492
00:18:06,400 --> 00:18:09,039
beyond that

493
00:18:09,360 --> 00:18:11,360
now from the other thing in technical

494
00:18:11,360 --> 00:18:14,240
features we have to decide how do we

495
00:18:14,240 --> 00:18:16,240
communicate to that uh

496
00:18:16,240 --> 00:18:18,320
you know our presence on the network

497
00:18:18,320 --> 00:18:19,440
well

498
00:18:19,440 --> 00:18:21,919
technically we can do air gap drop where

499
00:18:21,919 --> 00:18:23,840
we basically drop a malware it knows

500
00:18:23,840 --> 00:18:26,480
where it goes you know he knows how to

501
00:18:26,480 --> 00:18:28,320
encrypt the files and knows where to

502
00:18:28,320 --> 00:18:29,440
find them

503
00:18:29,440 --> 00:18:31,760
and it basically you know

504
00:18:31,760 --> 00:18:34,400
has an offline mechanism of

505
00:18:34,400 --> 00:18:36,080
you know sitting and waiting for the

506
00:18:36,080 --> 00:18:38,640
customer to say okay well you know how

507
00:18:38,640 --> 00:18:41,919
do i pay you how do you recover me right

508
00:18:41,919 --> 00:18:44,080
but a lot of times and most of the time

509
00:18:44,080 --> 00:18:46,320
it is also a network-based communication

510
00:18:46,320 --> 00:18:48,559
between the external attacker running

511
00:18:48,559 --> 00:18:50,480
command and control for example and the

512
00:18:50,480 --> 00:18:52,640
agent on the inside

513
00:18:52,640 --> 00:18:54,799
and so if you think about that

514
00:18:54,799 --> 00:18:57,200
there's a notion of a commander that

515
00:18:57,200 --> 00:18:59,919
lives outside and pretty much somehow

516
00:18:59,919 --> 00:19:02,000
communicates to the agent

517
00:19:02,000 --> 00:19:05,360
so with this with this uh you have to

518
00:19:05,360 --> 00:19:07,600
be able to send commands

519
00:19:07,600 --> 00:19:09,600
maybe load policies some kind of

520
00:19:09,600 --> 00:19:14,640
profiles into the agent and have agent

521
00:19:14,640 --> 00:19:16,799
go and

522
00:19:16,799 --> 00:19:19,360
essentially execute on your on your task

523
00:19:19,360 --> 00:19:20,640
right

524
00:19:20,640 --> 00:19:21,440
so

525
00:19:21,440 --> 00:19:24,080
offline asset recovery box or utility

526
00:19:24,080 --> 00:19:25,919
box where you can have a third party

527
00:19:25,919 --> 00:19:29,039
recover keys for you you know you create

528
00:19:29,039 --> 00:19:30,720
economies of scale for example for

529
00:19:30,720 --> 00:19:33,280
enterprise enterprise that works on

530
00:19:33,280 --> 00:19:36,160
several tiers where the executor or the

531
00:19:36,160 --> 00:19:39,520
operator is not the same as the one who

532
00:19:39,520 --> 00:19:41,200
deals with provisioning of keys for

533
00:19:41,200 --> 00:19:42,640
example right

534
00:19:42,640 --> 00:19:44,559
and so there's a notion of commander or

535
00:19:44,559 --> 00:19:46,480
c2 that we probably need to introduce

536
00:19:46,480 --> 00:19:48,240
here

537
00:19:48,240 --> 00:19:50,559
the other tactical feature is that how

538
00:19:50,559 --> 00:19:53,280
do we emulate attacker comms right are

539
00:19:53,280 --> 00:19:55,120
we talking about some protocol that

540
00:19:55,120 --> 00:19:59,039
sends command and gets the data out

541
00:19:59,039 --> 00:20:03,039
right how do we protect that

542
00:20:03,120 --> 00:20:06,320
we talked about application level uh

543
00:20:06,320 --> 00:20:07,600
encryption

544
00:20:07,600 --> 00:20:09,840
uh perhaps we are talking about rest

545
00:20:09,840 --> 00:20:11,919
endpoints maybe a web server here and

546
00:20:11,919 --> 00:20:12,960
there

547
00:20:12,960 --> 00:20:15,600
uh but in the end there has to be some

548
00:20:15,600 --> 00:20:16,880
reliable

549
00:20:16,880 --> 00:20:18,559
communication

550
00:20:18,559 --> 00:20:21,919
but it's not overly exposed right that

551
00:20:21,919 --> 00:20:23,679
you know detection can actually latch on

552
00:20:23,679 --> 00:20:26,720
to it and can signature so we have to

553
00:20:26,720 --> 00:20:30,240
think about those things as well

554
00:20:30,640 --> 00:20:32,240
the other tactical features that we have

555
00:20:32,240 --> 00:20:35,520
to think about as as the

556
00:20:35,520 --> 00:20:38,400
ransomware writer or toolkit writer

557
00:20:38,400 --> 00:20:41,360
and in this case prototype if you are

558
00:20:41,360 --> 00:20:44,080
seeing more ransomware in the wild

559
00:20:44,080 --> 00:20:46,159
is

560
00:20:46,159 --> 00:20:48,400
kind of all this coming together right

561
00:20:48,400 --> 00:20:50,320
there there's a way to lifetime k

562
00:20:50,320 --> 00:20:51,840
management keys

563
00:20:51,840 --> 00:20:54,400
uh to wait the way to policy load

564
00:20:54,400 --> 00:20:56,480
remotely into the agent

565
00:20:56,480 --> 00:20:58,559
uh perhaps uh you know get some feedback

566
00:20:58,559 --> 00:21:00,400
from the agent download indicators of

567
00:21:00,400 --> 00:21:02,480
compromise which we need for

568
00:21:02,480 --> 00:21:04,720
uh the purple teams to help the orgs

569
00:21:04,720 --> 00:21:07,760
right uh timeline creation is very

570
00:21:07,760 --> 00:21:09,679
important so we can actually write our

571
00:21:09,679 --> 00:21:11,840
reports that everybody loves

572
00:21:11,840 --> 00:21:13,440
right all that thing kind of comes

573
00:21:13,440 --> 00:21:17,840
together in this three-tier model there

574
00:21:18,080 --> 00:21:19,120
so

575
00:21:19,120 --> 00:21:21,280
implementation-wise

576
00:21:21,280 --> 00:21:23,600
we are striving for flexible operations

577
00:21:23,600 --> 00:21:26,879
whatever the customer wants

578
00:21:27,200 --> 00:21:28,400
and

579
00:21:28,400 --> 00:21:30,799
you know we also want to make sure that

580
00:21:30,799 --> 00:21:33,039
our agents and rc2 are mutually

581
00:21:33,039 --> 00:21:34,480
authenticated

582
00:21:34,480 --> 00:21:37,600
so no longer can somebody take an agent

583
00:21:37,600 --> 00:21:39,600
and in fact a different company

584
00:21:39,600 --> 00:21:40,320
or

585
00:21:40,320 --> 00:21:42,720
or you would have a rogue command and

586
00:21:42,720 --> 00:21:43,679
control

587
00:21:43,679 --> 00:21:46,400
kind of harvesting beaconing agents for

588
00:21:46,400 --> 00:21:48,640
some reason that they should not be seen

589
00:21:48,640 --> 00:21:50,240
right so there's this protection that we

590
00:21:50,240 --> 00:21:51,440
have to do

591
00:21:51,440 --> 00:21:53,600
um and

592
00:21:53,600 --> 00:21:54,960
also

593
00:21:54,960 --> 00:21:56,720
one thing that is really useful for

594
00:21:56,720 --> 00:21:59,280
operators for us or deploying our

595
00:21:59,280 --> 00:22:02,000
implant or agent remotely to a customer

596
00:22:02,000 --> 00:22:03,919
network is

597
00:22:03,919 --> 00:22:05,600
what happens with what we don't hear

598
00:22:05,600 --> 00:22:08,159
anything from the agent what it does

599
00:22:08,159 --> 00:22:09,039
right

600
00:22:09,039 --> 00:22:11,120
we have to have a way to debug

601
00:22:11,120 --> 00:22:13,440
potentially somehow light debugging in

602
00:22:13,440 --> 00:22:14,799
the field

603
00:22:14,799 --> 00:22:15,840
and so

604
00:22:15,840 --> 00:22:17,280
there are structures that we can

605
00:22:17,280 --> 00:22:19,520
probably do with memory logging that we

606
00:22:19,520 --> 00:22:21,440
can kind of get feedback on what the

607
00:22:21,440 --> 00:22:22,880
agent is doing

608
00:22:22,880 --> 00:22:25,039
and obviously the whole thing with

609
00:22:25,039 --> 00:22:27,200
destaging and cleaning up after we're

610
00:22:27,200 --> 00:22:29,520
done on

611
00:22:29,520 --> 00:22:32,240
on the customer network

612
00:22:32,240 --> 00:22:33,440
and so

613
00:22:33,440 --> 00:22:36,559
this part is this slide is a little busy

614
00:22:36,559 --> 00:22:38,720
it's basically configuration the policy

615
00:22:38,720 --> 00:22:40,559
file for the agent

616
00:22:40,559 --> 00:22:43,440
it's very modular we can marry up

617
00:22:43,440 --> 00:22:45,679
posts to assets to authentication

618
00:22:45,679 --> 00:22:48,640
profiles to master keys to protocols

619
00:22:48,640 --> 00:22:49,840
right and so

620
00:22:49,840 --> 00:22:51,840
we're going to go over over this a

621
00:22:51,840 --> 00:22:53,120
little bit more

622
00:22:53,120 --> 00:22:54,480
uh when we're

623
00:22:54,480 --> 00:22:57,200
when we do a demo but essentially

624
00:22:57,200 --> 00:22:59,360
policy drives everything right policy

625
00:22:59,360 --> 00:23:01,919
drives communication policy drives

626
00:23:01,919 --> 00:23:04,000
interaction with uh agent and what it

627
00:23:04,000 --> 00:23:06,000
does

628
00:23:06,000 --> 00:23:08,000
so with that i want to invite you to

629
00:23:08,000 --> 00:23:10,400
look a little bit deeper into

630
00:23:10,400 --> 00:23:12,799
um into this toolkit that we've created

631
00:23:12,799 --> 00:23:14,480
called racketeer

632
00:23:14,480 --> 00:23:15,600
right

633
00:23:15,600 --> 00:23:19,200
so racketeer uh kind of embodies

634
00:23:19,200 --> 00:23:21,280
the things that we've talked about the

635
00:23:21,280 --> 00:23:22,480
design

636
00:23:22,480 --> 00:23:24,480
things that we care about

637
00:23:24,480 --> 00:23:25,280
uh

638
00:23:25,280 --> 00:23:28,080
protection of customer information

639
00:23:28,080 --> 00:23:31,039
being precise as opposed to being vague

640
00:23:31,039 --> 00:23:33,440
where you go and you know trying to not

641
00:23:33,440 --> 00:23:36,480
run away with with our with our scope

642
00:23:36,480 --> 00:23:39,440
right yet being able to

643
00:23:39,440 --> 00:23:41,760
kind of see what we can do on on the

644
00:23:41,760 --> 00:23:45,840
customer network and simulate it

645
00:23:45,919 --> 00:23:48,799
so here we have um

646
00:23:48,799 --> 00:23:51,279
kind of three major things

647
00:23:51,279 --> 00:23:52,960
there's a fourth component but we're

648
00:23:52,960 --> 00:23:55,200
going to talk about it a little later

649
00:23:55,200 --> 00:23:57,440
the three major things is the attacker

650
00:23:57,440 --> 00:23:59,760
is its command and control

651
00:23:59,760 --> 00:24:02,960
that you know operates on http and https

652
00:24:02,960 --> 00:24:05,440
you know your standard beaconing

653
00:24:05,440 --> 00:24:07,840
setup uh you could probably develop a

654
00:24:07,840 --> 00:24:08,960
dns

655
00:24:08,960 --> 00:24:10,640
hookup which we'll probably do in the

656
00:24:10,640 --> 00:24:12,799
later stage but for now

657
00:24:12,799 --> 00:24:13,919
it is a

658
00:24:13,919 --> 00:24:15,760
http out

659
00:24:15,760 --> 00:24:16,880
and then

660
00:24:16,880 --> 00:24:18,720
on this side

661
00:24:18,720 --> 00:24:21,279
the green part is the domain join

662
00:24:21,279 --> 00:24:22,240
machine

663
00:24:22,240 --> 00:24:24,799
where the agent does not rely a reside

664
00:24:24,799 --> 00:24:27,039
racketeer agent does not reside there

665
00:24:27,039 --> 00:24:28,799
there's also a

666
00:24:28,799 --> 00:24:30,080
blue machine

667
00:24:30,080 --> 00:24:32,400
which is non-domain joined

668
00:24:32,400 --> 00:24:33,840
where we're gonna deploy in our

669
00:24:33,840 --> 00:24:35,440
ransomware

670
00:24:35,440 --> 00:24:37,600
the reason why we've done this is to

671
00:24:37,600 --> 00:24:39,520
first showcase the capability of

672
00:24:39,520 --> 00:24:41,840
cross-domain collaboration and also

673
00:24:41,840 --> 00:24:44,159
non-domain collaboration with uh within

674
00:24:44,159 --> 00:24:45,520
the network

675
00:24:45,520 --> 00:24:47,200
it's because you never know when the

676
00:24:47,200 --> 00:24:49,520
attacker drops right you may be able to

677
00:24:49,520 --> 00:24:52,000
drop your agent on completely relevant

678
00:24:52,000 --> 00:24:54,720
machine that is not even connected to to

679
00:24:54,720 --> 00:24:56,960
the domain and still be able to cross it

680
00:24:56,960 --> 00:24:58,960
and go hunt for

681
00:24:58,960 --> 00:25:01,120
for your assets right

682
00:25:01,120 --> 00:25:02,480
and also

683
00:25:02,480 --> 00:25:04,080
as we talk through operations of

684
00:25:04,080 --> 00:25:06,799
racketeer we're going to see how

685
00:25:06,799 --> 00:25:08,799
we can do

686
00:25:08,799 --> 00:25:10,960
multiple agents for example

687
00:25:10,960 --> 00:25:12,720
you know you can have five agents and

688
00:25:12,720 --> 00:25:15,360
different machines they all beacon back

689
00:25:15,360 --> 00:25:18,240
that creates uh sort of like a profile

690
00:25:18,240 --> 00:25:19,200
of five

691
00:25:19,200 --> 00:25:21,120
agents communicating back to the c2

692
00:25:21,120 --> 00:25:22,720
which may be a lot more

693
00:25:22,720 --> 00:25:24,000
uh

694
00:25:24,000 --> 00:25:26,640
less stealthy and more detectable or you

695
00:25:26,640 --> 00:25:28,400
can have a beach head

696
00:25:28,400 --> 00:25:31,120
um on a no-name machine right and

697
00:25:31,120 --> 00:25:33,279
basically you can go out from there like

698
00:25:33,279 --> 00:25:34,880
fan out from there

699
00:25:34,880 --> 00:25:38,080
so it's useful to emulate both scenarios

700
00:25:38,080 --> 00:25:40,559
or the variation of uh

701
00:25:40,559 --> 00:25:42,640
of their abouts

702
00:25:42,640 --> 00:25:45,520
we've talked about the policies

703
00:25:45,520 --> 00:25:48,320
so a policy is what governs and allows

704
00:25:48,320 --> 00:25:52,080
us to kind of get the um

705
00:25:52,080 --> 00:25:52,960
yet

706
00:25:52,960 --> 00:25:57,279
get the agent uh you know have an agent

707
00:25:57,279 --> 00:25:59,840
follow something that we tell it to do

708
00:25:59,840 --> 00:26:01,760
and even though the server can actually

709
00:26:01,760 --> 00:26:03,679
send commands to it

710
00:26:03,679 --> 00:26:05,919
the best way to do it is to run with the

711
00:26:05,919 --> 00:26:09,279
policy and i'll show you why that is

712
00:26:09,279 --> 00:26:11,919
so just just know that there is a policy

713
00:26:11,919 --> 00:26:14,400
we can go and dive into it a little bit

714
00:26:14,400 --> 00:26:15,440
later

715
00:26:15,440 --> 00:26:18,559
uh but let's start the the server here

716
00:26:18,559 --> 00:26:20,799
so right now we have a server uh listing

717
00:26:20,799 --> 00:26:21,919
on our

718
00:26:21,919 --> 00:26:26,559
um on our on our end point there and we

719
00:26:26,559 --> 00:26:29,120
are deploying forum from a war group

720
00:26:29,120 --> 00:26:31,600
machine we're gonna launch this guy up

721
00:26:31,600 --> 00:26:33,200
right it launches in the memory let's

722
00:26:33,200 --> 00:26:35,360
just go into the process explorer

723
00:26:35,360 --> 00:26:37,440
see that it's running as file connector

724
00:26:37,440 --> 00:26:38,880
that xc

725
00:26:38,880 --> 00:26:41,520
uh which is nice and what it needs to do

726
00:26:41,520 --> 00:26:45,039
is um if it has a policy embedded into

727
00:26:45,039 --> 00:26:45,919
it

728
00:26:45,919 --> 00:26:48,000
we're going to see how that's done

729
00:26:48,000 --> 00:26:50,159
then it can just work on its own if it

730
00:26:50,159 --> 00:26:52,320
knows where it goes for example if like

731
00:26:52,320 --> 00:26:55,200
i said the first team has provided a way

732
00:26:55,200 --> 00:26:57,919
to kind of go around and think and

733
00:26:57,919 --> 00:27:00,400
saying things but most of the time

734
00:27:00,400 --> 00:27:02,880
um you're gonna have some way of beacon

735
00:27:02,880 --> 00:27:04,880
back and the server should be able to

736
00:27:04,880 --> 00:27:08,240
interact with that agent and so

737
00:27:08,240 --> 00:27:10,640
um the way we're gonna activate with

738
00:27:10,640 --> 00:27:12,720
with this agent we're gonna

739
00:27:12,720 --> 00:27:15,360
we're gonna basically

740
00:27:15,360 --> 00:27:19,240
uh say okay

741
00:27:21,360 --> 00:27:23,919
i'm going to activate this agent uh

742
00:27:23,919 --> 00:27:25,600
notice the grid

743
00:27:25,600 --> 00:27:27,440
uh this is the identifier for the agent

744
00:27:27,440 --> 00:27:28,880
you may have more than one

745
00:27:28,880 --> 00:27:30,080
but right now we're working with this

746
00:27:30,080 --> 00:27:31,840
agent and

747
00:27:31,840 --> 00:27:34,240
we're gonna

748
00:27:34,240 --> 00:27:36,720
we're gonna see if it's beginning to us

749
00:27:36,720 --> 00:27:39,120
what it tells us about itself right and

750
00:27:39,120 --> 00:27:39,840
uh

751
00:27:39,840 --> 00:27:41,120
it's gonna take a little bit of time

752
00:27:41,120 --> 00:27:42,720
because we're running on about 15

753
00:27:42,720 --> 00:27:44,640
minutes jitter

754
00:27:44,640 --> 00:27:47,360
that's also done so that

755
00:27:47,360 --> 00:27:48,480
the machine

756
00:27:48,480 --> 00:27:50,799
is not constantly communicating so it's

757
00:27:50,799 --> 00:27:52,240
it's a little bit it's playing a little

758
00:27:52,240 --> 00:27:53,679
bit towards the stealth if you want to

759
00:27:53,679 --> 00:27:56,720
dial it up or or or down so for now we

760
00:27:56,720 --> 00:27:58,320
can see that it's running on dev pc

761
00:27:58,320 --> 00:28:01,039
which is right here the fpc and it's not

762
00:28:01,039 --> 00:28:04,240
an admin um and it's using it's running

763
00:28:04,240 --> 00:28:07,440
as uh user dev right

764
00:28:07,440 --> 00:28:10,559
so right now our goal is to have a very

765
00:28:10,559 --> 00:28:12,799
important share that we have on a

766
00:28:12,799 --> 00:28:15,200
non-domain join machine and we also have

767
00:28:15,200 --> 00:28:17,039
an important share here

768
00:28:17,039 --> 00:28:20,159
on a green machine which is uh a top

769
00:28:20,159 --> 00:28:21,600
domain

770
00:28:21,600 --> 00:28:23,919
and essentially we want to be able to

771
00:28:23,919 --> 00:28:27,279
let's say we are interested in lock-in

772
00:28:27,279 --> 00:28:30,799
uh source code maybe right so we have

773
00:28:30,799 --> 00:28:33,360
some inocus source code that uh

774
00:28:33,360 --> 00:28:35,120
developers put in

775
00:28:35,120 --> 00:28:36,960
and you know we have some executables

776
00:28:36,960 --> 00:28:39,039
that we care about to

777
00:28:39,039 --> 00:28:41,600
uh to lock right so they can pay us

778
00:28:41,600 --> 00:28:43,919
ransom maybe there's a documentation of

779
00:28:43,919 --> 00:28:45,360
some kind uh

780
00:28:45,360 --> 00:28:46,799
you know here it doesn't really matter

781
00:28:46,799 --> 00:28:48,480
what it is but it's just the file right

782
00:28:48,480 --> 00:28:50,960
ransomware will work on the file level

783
00:28:50,960 --> 00:28:54,240
um doesn't really matter what it is

784
00:28:54,240 --> 00:28:55,679
how do we do this

785
00:28:55,679 --> 00:28:57,200
well

786
00:28:57,200 --> 00:28:59,440
through the policy

787
00:28:59,440 --> 00:29:00,799
so

788
00:29:00,799 --> 00:29:02,880
let's uh let's do the policy for let's

789
00:29:02,880 --> 00:29:04,880
do the execution first and then we'll

790
00:29:04,880 --> 00:29:07,039
kind of go through the policy so there's

791
00:29:07,039 --> 00:29:09,520
a notion of master key that unlocks

792
00:29:09,520 --> 00:29:10,559
um

793
00:29:10,559 --> 00:29:12,799
kind of encryption credential encryption

794
00:29:12,799 --> 00:29:14,480
and credentials and all other good stuff

795
00:29:14,480 --> 00:29:16,159
the encryption payloads

796
00:29:16,159 --> 00:29:16,960
so

797
00:29:16,960 --> 00:29:19,919
that's also a protection for a agent to

798
00:29:19,919 --> 00:29:22,240
know if c2 knows about it like if it's a

799
00:29:22,240 --> 00:29:24,240
rogue c2 will not know the password for

800
00:29:24,240 --> 00:29:27,039
the agent so we need to be able to

801
00:29:27,039 --> 00:29:28,480
know

802
00:29:28,480 --> 00:29:30,480
that password i want to send it to the

803
00:29:30,480 --> 00:29:33,679
agent that lives on the blue box

804
00:29:33,679 --> 00:29:35,679
once this happens

805
00:29:35,679 --> 00:29:38,320
um it's going to prime itself with a

806
00:29:38,320 --> 00:29:40,880
messer key and says hey i have a uh i

807
00:29:40,880 --> 00:29:42,559
have a good c2 that needs to be

808
00:29:42,559 --> 00:29:44,080
communicated to me

809
00:29:44,080 --> 00:29:46,000
and while we're at it we're we're

810
00:29:46,000 --> 00:29:47,919
looking at it uh

811
00:29:47,919 --> 00:29:49,600
we're saying that we need some form of

812
00:29:49,600 --> 00:29:51,520
debugging right so maybe we want to see

813
00:29:51,520 --> 00:29:54,880
what the agent is doing but also we want

814
00:29:54,880 --> 00:29:56,559
to be stealthy and all of it has to be

815
00:29:56,559 --> 00:29:58,080
in memory so we're going to create the

816
00:29:58,080 --> 00:30:00,320
long log buffer in memory

817
00:30:00,320 --> 00:30:02,399
we're going to say

818
00:30:02,399 --> 00:30:03,200
uh

819
00:30:03,200 --> 00:30:05,679
debug

820
00:30:07,120 --> 00:30:08,799
debug

821
00:30:08,799 --> 00:30:11,039
which means we're sending debug levels

822
00:30:11,039 --> 00:30:12,880
to to the agent

823
00:30:12,880 --> 00:30:15,360
and perhaps um

824
00:30:15,360 --> 00:30:19,520
uh just make sure making sure that

825
00:30:20,080 --> 00:30:21,520
the agent is still alive we're going to

826
00:30:21,520 --> 00:30:22,720
do another heartbeat this is going to

827
00:30:22,720 --> 00:30:24,640
take about uh maybe

828
00:30:24,640 --> 00:30:27,039
15 seconds or so to do so

829
00:30:27,039 --> 00:30:29,679
um obviously it may be executing other

830
00:30:29,679 --> 00:30:31,520
commands if you've sent them in

831
00:30:31,520 --> 00:30:33,120
succession but essentially it needs to

832
00:30:33,120 --> 00:30:34,720
report and it does

833
00:30:34,720 --> 00:30:38,880
it's still alive um so then we can do uh

834
00:30:38,880 --> 00:30:40,240
policy exec

835
00:30:40,240 --> 00:30:42,399
so policy exactly just what it is just

836
00:30:42,399 --> 00:30:44,480
what it says

837
00:30:44,480 --> 00:30:47,279
um we want to send a policy to to the

838
00:30:47,279 --> 00:30:50,799
box and now it's a good time to see what

839
00:30:50,799 --> 00:30:53,039
that policy looks for uh like an

840
00:30:53,039 --> 00:30:54,640
overview and then we can dive into the

841
00:30:54,640 --> 00:30:57,600
policy itself so the policy basically is

842
00:30:57,600 --> 00:30:59,519
a just json file that is broken down

843
00:30:59,519 --> 00:31:00,720
into section

844
00:31:00,720 --> 00:31:03,120
it talks about how we're communicating

845
00:31:03,120 --> 00:31:04,480
to our c2

846
00:31:04,480 --> 00:31:06,159
where we find it how what is the

847
00:31:06,159 --> 00:31:08,880
protocol how we secure in it

848
00:31:08,880 --> 00:31:11,200
what is what are the rest enterpr

849
00:31:11,200 --> 00:31:13,600
endpoints that the agent should

850
00:31:13,600 --> 00:31:16,720
care about how to connect to

851
00:31:16,720 --> 00:31:19,200
the the dc2 and all good stuff uh

852
00:31:19,200 --> 00:31:21,200
there's a notion of site id which is the

853
00:31:21,200 --> 00:31:22,799
agent

854
00:31:22,799 --> 00:31:24,559
id which

855
00:31:24,559 --> 00:31:27,440
we sort of you know is the identifier

856
00:31:27,440 --> 00:31:29,679
for this for this agent

857
00:31:29,679 --> 00:31:31,360
and there is a hash of a master key

858
00:31:31,360 --> 00:31:34,559
which the agent will check uh to kind of

859
00:31:34,559 --> 00:31:36,960
do one-to-one comparison to whether the

860
00:31:36,960 --> 00:31:39,440
um the c2 knows about it then there is

861
00:31:39,440 --> 00:31:41,440
authentication section it's very

862
00:31:41,440 --> 00:31:43,279
elaborate we can go into details a

863
00:31:43,279 --> 00:31:44,799
little bit later but essentially what it

864
00:31:44,799 --> 00:31:47,039
does it kind of talks about how we're

865
00:31:47,039 --> 00:31:49,120
going to log into different boxes what

866
00:31:49,120 --> 00:31:51,919
users domain and whatever the case may

867
00:31:51,919 --> 00:31:53,679
be we're using

868
00:31:53,679 --> 00:31:56,720
and then uh there's a list of hosts and

869
00:31:56,720 --> 00:31:57,440
uh

870
00:31:57,440 --> 00:32:00,799
and uh assets on those hosts for example

871
00:32:00,799 --> 00:32:03,440
uh we want to go to devpc which we're on

872
00:32:03,440 --> 00:32:05,760
already uh we want to use a specific key

873
00:32:05,760 --> 00:32:08,640
to encrypt things or maybe we can use

874
00:32:08,640 --> 00:32:10,159
profile key

875
00:32:10,159 --> 00:32:12,799
um to give us some you know variance on

876
00:32:12,799 --> 00:32:14,880
detection and whatnot and here's the

877
00:32:14,880 --> 00:32:16,960
file path what we want to do

878
00:32:16,960 --> 00:32:19,279
and we should basically replicate it

879
00:32:19,279 --> 00:32:21,919
across multiple uh hosts that we care

880
00:32:21,919 --> 00:32:24,559
about uh in this case we're also telling

881
00:32:24,559 --> 00:32:26,840
we're also going to the green box

882
00:32:26,840 --> 00:32:28,480
test.int

883
00:32:28,480 --> 00:32:30,240
as a different user

884
00:32:30,240 --> 00:32:32,960
uh call it bob right and uh we're

885
00:32:32,960 --> 00:32:34,320
basically saying

886
00:32:34,320 --> 00:32:36,240
uh go work on two files instead of one

887
00:32:36,240 --> 00:32:38,640
so here's the representation of one file

888
00:32:38,640 --> 00:32:40,559
locally and two files remotely right so

889
00:32:40,559 --> 00:32:43,519
that's the policy that we're sending

890
00:32:43,519 --> 00:32:45,360
let's just do that

891
00:32:45,360 --> 00:32:47,360
and again you know

892
00:32:47,360 --> 00:32:49,678
upon

893
00:32:50,640 --> 00:32:53,279
encryption you can kind of see uh

894
00:32:53,279 --> 00:32:55,279
the encryption is happening and

895
00:32:55,279 --> 00:32:57,120
essentially if we were able to look at

896
00:32:57,120 --> 00:32:58,799
the code before

897
00:32:58,799 --> 00:33:01,440
uh we can kind of see that

898
00:33:01,440 --> 00:33:03,840
this code is no longer available

899
00:33:03,840 --> 00:33:08,000
and it's all encrypted um it's

900
00:33:08,000 --> 00:33:10,320
completely scrambled from here and the

901
00:33:10,320 --> 00:33:13,919
same thing going on in the local file

902
00:33:13,919 --> 00:33:16,000
uh it is

903
00:33:16,000 --> 00:33:19,039
it is exactly you know entropy is very

904
00:33:19,039 --> 00:33:20,720
very very high so that means it's

905
00:33:20,720 --> 00:33:22,880
encrypted right

906
00:33:22,880 --> 00:33:26,960
so at this point the customer is locked

907
00:33:26,960 --> 00:33:28,720
so from the all intents and purposes the

908
00:33:28,720 --> 00:33:30,000
customer is locked

909
00:33:30,000 --> 00:33:32,320
and this is where our life cycle goes

910
00:33:32,320 --> 00:33:35,279
into triage perhaps uh notification to

911
00:33:35,279 --> 00:33:37,440
the help desk if we want to or if we

912
00:33:37,440 --> 00:33:38,559
want to

913
00:33:38,559 --> 00:33:40,880
initiate and kick off disaster recovery

914
00:33:40,880 --> 00:33:43,279
on the important share maybe a restore

915
00:33:43,279 --> 00:33:45,600
maybe a sink off of

916
00:33:45,600 --> 00:33:48,159
some things maybe a restoration from

917
00:33:48,159 --> 00:33:49,519
you know some

918
00:33:49,519 --> 00:33:51,039
some pristine copy or whatever the case

919
00:33:51,039 --> 00:33:53,200
may be right this is why we're doing

920
00:33:53,200 --> 00:33:55,360
this we're not doing this to showcase

921
00:33:55,360 --> 00:33:58,159
the tool or encrypt the files we're

922
00:33:58,159 --> 00:34:02,080
doing this so we can educate the orgs to

923
00:34:02,080 --> 00:34:04,399
minimize the time between failure and to

924
00:34:04,399 --> 00:34:05,919
know exactly what they're doing when

925
00:34:05,919 --> 00:34:07,440
that thing hits

926
00:34:07,440 --> 00:34:09,359
so the reason why we are stressing

927
00:34:09,359 --> 00:34:11,440
lifetime key management

928
00:34:11,440 --> 00:34:12,639
is because

929
00:34:12,639 --> 00:34:14,320
of recovery

930
00:34:14,320 --> 00:34:17,599
back into original state so we've talked

931
00:34:17,599 --> 00:34:19,280
about the policy

932
00:34:19,280 --> 00:34:23,040
that has found the server logged into to

933
00:34:23,040 --> 00:34:26,480
it as bob and stayed as the fpc here

934
00:34:26,480 --> 00:34:29,520
uh but we want to revert the policy so

935
00:34:29,520 --> 00:34:31,520
let's say we have 100 files and 25

936
00:34:31,520 --> 00:34:33,839
different hosts that our customer asked

937
00:34:33,839 --> 00:34:37,440
us to uh to simulate encryption on

938
00:34:37,440 --> 00:34:40,480
to keep track of them is very is sort of

939
00:34:40,480 --> 00:34:42,000
challenging right

940
00:34:42,000 --> 00:34:45,359
so our policy basically

941
00:34:45,359 --> 00:34:48,879
what we want to do is set up encryption

942
00:34:48,879 --> 00:34:51,918
we can just flip a bit and say

943
00:34:51,918 --> 00:34:54,079
i want to decrypt from now i'm going to

944
00:34:54,079 --> 00:34:55,679
use exactly the same policy i've used

945
00:34:55,679 --> 00:34:56,639
before

946
00:34:56,639 --> 00:34:58,800
but instead of encryption i'm going to

947
00:34:58,800 --> 00:35:00,000
decrypt

948
00:35:00,000 --> 00:35:03,119
the same thing again site id master key

949
00:35:03,119 --> 00:35:06,000
uh the same way to get to to this box

950
00:35:06,000 --> 00:35:09,040
the same user to authenticate as before

951
00:35:09,040 --> 00:35:11,680
only in this case i'm going to decrypt

952
00:35:11,680 --> 00:35:14,480
so master key stays the same

953
00:35:14,480 --> 00:35:16,320
everything stays the same but before we

954
00:35:16,320 --> 00:35:17,839
do this

955
00:35:17,839 --> 00:35:18,180
uh

956
00:35:18,180 --> 00:35:19,440
[Music]

957
00:35:19,440 --> 00:35:21,680
let's do let's get a summary of you of

958
00:35:21,680 --> 00:35:24,160
our encryption actions that is very

959
00:35:24,160 --> 00:35:25,440
useful

960
00:35:25,440 --> 00:35:27,520
for blue team collaboration where

961
00:35:27,520 --> 00:35:29,440
they're asking you when did you guys do

962
00:35:29,440 --> 00:35:30,400
it

963
00:35:30,400 --> 00:35:33,040
right what is the hash what is the size

964
00:35:33,040 --> 00:35:34,640
what is the path

965
00:35:34,640 --> 00:35:37,280
uh you know how do we know when that

966
00:35:37,280 --> 00:35:38,880
happened and that's very useful to get

967
00:35:38,880 --> 00:35:41,040
it from the agent as you ran it right so

968
00:35:41,040 --> 00:35:43,760
that's that's a that's a help for iocs

969
00:35:43,760 --> 00:35:44,400
for

970
00:35:44,400 --> 00:35:45,839
a blue team

971
00:35:45,839 --> 00:35:48,640
but uh so but the other thing that uh we

972
00:35:48,640 --> 00:35:50,720
want to do once we set the locks to

973
00:35:50,720 --> 00:35:53,599
debug we can get logs right

974
00:35:53,599 --> 00:35:56,000
and essentially

975
00:35:56,000 --> 00:35:59,200
uh that tells us uh you know what

976
00:35:59,200 --> 00:36:02,480
the agent was doing uh upon interaction

977
00:36:02,480 --> 00:36:04,960
the timestamp what payload it has

978
00:36:04,960 --> 00:36:08,079
received what it has invoked uh and if

979
00:36:08,079 --> 00:36:09,839
something doesn't work we can kind of

980
00:36:09,839 --> 00:36:13,200
troubleshoot remotely to to a degree

981
00:36:13,200 --> 00:36:14,160
so

982
00:36:14,160 --> 00:36:17,200
again but but our paul exec

983
00:36:17,200 --> 00:36:19,759
command

984
00:36:20,640 --> 00:36:23,200
policies

985
00:36:23,200 --> 00:36:25,520
now we want to decrypt

986
00:36:25,520 --> 00:36:28,480
and watch what happens on the other side

987
00:36:28,480 --> 00:36:30,800
essentially once the agent receives the

988
00:36:30,800 --> 00:36:33,920
policy starts executing on that policy

989
00:36:33,920 --> 00:36:36,720
uh within reasonable amount of time

990
00:36:36,720 --> 00:36:39,040
maybe it's 15 seconds maybe it's there's

991
00:36:39,040 --> 00:36:40,560
a jitter between

992
00:36:40,560 --> 00:36:42,720
you know what it gets and when it starts

993
00:36:42,720 --> 00:36:44,640
to execute that right and so it brings

994
00:36:44,640 --> 00:36:46,560
the environment back

995
00:36:46,560 --> 00:36:48,800
to where it was before

996
00:36:48,800 --> 00:36:52,079
uh we can kind of see the code

997
00:36:52,079 --> 00:36:54,480
we can run the executables again so you

998
00:36:54,480 --> 00:36:55,920
know there's a

999
00:36:55,920 --> 00:36:58,720
uh notion that the ransom was paid

1000
00:36:58,720 --> 00:37:01,680
right and uh the attacker basically

1001
00:37:01,680 --> 00:37:02,960
averted the

1002
00:37:02,960 --> 00:37:05,040
um the communication now

1003
00:37:05,040 --> 00:37:07,359
we've talked about the agent

1004
00:37:07,359 --> 00:37:09,520
running right

1005
00:37:09,520 --> 00:37:10,560
and so

1006
00:37:10,560 --> 00:37:12,320
a lot of times when the agent is not

1007
00:37:12,320 --> 00:37:14,480
running obviously if we are in

1008
00:37:14,480 --> 00:37:16,560
encryption uh capability we can't

1009
00:37:16,560 --> 00:37:19,200
decrypt because the agent cannot receive

1010
00:37:19,200 --> 00:37:21,760
its uh uh it's

1011
00:37:21,760 --> 00:37:25,280
it's uh tasks or actions right

1012
00:37:25,280 --> 00:37:28,800
so we potentially have maybe a third box

1013
00:37:28,800 --> 00:37:31,440
that basically deals with

1014
00:37:31,440 --> 00:37:32,800
um

1015
00:37:32,800 --> 00:37:34,480
management of keys

1016
00:37:34,480 --> 00:37:37,200
shielding credentials recovering keys

1017
00:37:37,200 --> 00:37:40,000
offsite and creating all things

1018
00:37:40,000 --> 00:37:41,520
communication to

1019
00:37:41,520 --> 00:37:43,440
uh you know from the uh encryption

1020
00:37:43,440 --> 00:37:46,160
capabilities it talks about it can do

1021
00:37:46,160 --> 00:37:48,400
encryption of passwords for

1022
00:37:48,400 --> 00:37:51,680
uh your asses providing and creating

1023
00:37:51,680 --> 00:37:53,040
site ids

1024
00:37:53,040 --> 00:37:54,640
uh creating

1025
00:37:54,640 --> 00:37:58,160
master keys for which uh the uh the c2n

1026
00:37:58,160 --> 00:38:00,640
agent will communicate with right and so

1027
00:38:00,640 --> 00:38:01,760
all of that

1028
00:38:01,760 --> 00:38:04,640
is sort of uh

1029
00:38:04,640 --> 00:38:06,240
can be done

1030
00:38:06,240 --> 00:38:08,880
with uh with commands you know that that

1031
00:38:08,880 --> 00:38:11,280
we have we can generate the site id then

1032
00:38:11,280 --> 00:38:13,119
we can do a master key

1033
00:38:13,119 --> 00:38:14,320
we can

1034
00:38:14,320 --> 00:38:15,280
lock

1035
00:38:15,280 --> 00:38:18,560
credentials to to specific encryption

1036
00:38:18,560 --> 00:38:22,240
and we can actually off recover the file

1037
00:38:22,240 --> 00:38:24,480
recovery of the file is is basically for

1038
00:38:24,480 --> 00:38:26,560
when uh somebody

1039
00:38:26,560 --> 00:38:28,560
gives you code uh

1040
00:38:28,560 --> 00:38:30,240
you know things that we've seen here

1041
00:38:30,240 --> 00:38:32,480
where the code is full screen where the

1042
00:38:32,480 --> 00:38:35,200
code is uh

1043
00:38:35,200 --> 00:38:38,400
clear tags but if they give you

1044
00:38:38,400 --> 00:38:40,400
uh for example

1045
00:38:40,400 --> 00:38:42,560
encrypted file

1046
00:38:42,560 --> 00:38:46,000
uh you should be able to

1047
00:38:46,000 --> 00:38:48,000
yeah already open you should be able to

1048
00:38:48,000 --> 00:38:50,079
decrypt it offline right on the utility

1049
00:38:50,079 --> 00:38:51,599
box so

1050
00:38:51,599 --> 00:38:53,599
we can sort of uh

1051
00:38:53,599 --> 00:38:55,040
do these things

1052
00:38:55,040 --> 00:38:57,280
uh directly on the box here's a

1053
00:38:57,280 --> 00:38:59,520
encryption key that it takes from the

1054
00:38:59,520 --> 00:39:01,040
you know from the commit from from the

1055
00:39:01,040 --> 00:39:03,200
command line which

1056
00:39:03,200 --> 00:39:05,119
you create prior to encryption and then

1057
00:39:05,119 --> 00:39:07,119
you can encrypt and we can

1058
00:39:07,119 --> 00:39:08,640
basically

1059
00:39:08,640 --> 00:39:09,920
uh you know

1060
00:39:09,920 --> 00:39:11,920
look at the files again but that's

1061
00:39:11,920 --> 00:39:14,160
that's to our discussion how we can do

1062
00:39:14,160 --> 00:39:16,400
offline versus online right so there's a

1063
00:39:16,400 --> 00:39:17,920
utility box

1064
00:39:17,920 --> 00:39:20,240
um that allows you to do that

1065
00:39:20,240 --> 00:39:21,920
but that's not important the important

1066
00:39:21,920 --> 00:39:23,440
part is

1067
00:39:23,440 --> 00:39:25,359
is that we were able to bring the box

1068
00:39:25,359 --> 00:39:27,520
back or the encryption back

1069
00:39:27,520 --> 00:39:29,760
but that's not all right so

1070
00:39:29,760 --> 00:39:32,480
one of the things that we care about is

1071
00:39:32,480 --> 00:39:36,880
to kick off uh exercises right and so

1072
00:39:36,880 --> 00:39:39,599
let's encrypt it

1073
00:39:40,839 --> 00:39:43,440
again let's let's encrypt those things

1074
00:39:43,440 --> 00:39:45,599
again

1075
00:39:45,599 --> 00:39:48,480
and once this is done how do we notify

1076
00:39:48,480 --> 00:39:50,880
the sub that something is happening well

1077
00:39:50,880 --> 00:39:53,359
what if the company gives you a uh you

1078
00:39:53,359 --> 00:39:55,760
know a regular user laptop that you're

1079
00:39:55,760 --> 00:39:58,160
working with right

1080
00:39:58,160 --> 00:39:59,280
well

1081
00:39:59,280 --> 00:40:02,079
what we can do

1082
00:40:03,680 --> 00:40:07,200
we can unhide ourselves

1083
00:40:08,720 --> 00:40:10,400
create our presence

1084
00:40:10,400 --> 00:40:12,319
on that box

1085
00:40:12,319 --> 00:40:14,960
stating that hey

1086
00:40:14,960 --> 00:40:16,319
um

1087
00:40:16,319 --> 00:40:18,800
we are we're here

1088
00:40:18,800 --> 00:40:21,440
uh yeah maybe maybe try to deal with it

1089
00:40:21,440 --> 00:40:23,680
like for example it's it's like in a

1090
00:40:23,680 --> 00:40:26,000
workstation fully right and basically

1091
00:40:26,000 --> 00:40:29,760
gives you this real nice indicator that

1092
00:40:29,760 --> 00:40:31,599
something's going on obviously this will

1093
00:40:31,599 --> 00:40:33,599
trigger somebody to call help desk and

1094
00:40:33,599 --> 00:40:35,040
start

1095
00:40:35,040 --> 00:40:37,760
doing things but the point here is that

1096
00:40:37,760 --> 00:40:40,000
it's not the tool it's the emulation of

1097
00:40:40,000 --> 00:40:42,240
the life cycle right how do we break how

1098
00:40:42,240 --> 00:40:44,319
do we emulate break of

1099
00:40:44,319 --> 00:40:46,960
you know ransomware how do we do t minus

1100
00:40:46,960 --> 00:40:48,640
five hours for

1101
00:40:48,640 --> 00:40:50,800
you know for instance response to work

1102
00:40:50,800 --> 00:40:52,640
how do we kick off disaster recovery how

1103
00:40:52,640 --> 00:40:53,520
do we

1104
00:40:53,520 --> 00:40:55,440
how do we make uh make our presence

1105
00:40:55,440 --> 00:40:56,960
known right and so there are many ways

1106
00:40:56,960 --> 00:40:58,560
of doing that but maybe

1107
00:40:58,560 --> 00:41:01,760
um maybe that's one of them right and

1108
00:41:01,760 --> 00:41:03,760
maybe before the

1109
00:41:03,760 --> 00:41:05,839
you know maybe the legal gets involved

1110
00:41:05,839 --> 00:41:07,119
whatever the case may be but we have

1111
00:41:07,119 --> 00:41:09,040
this capability to do that

1112
00:41:09,040 --> 00:41:11,680
um and last but not least

1113
00:41:11,680 --> 00:41:13,760
uh let's let's actually go

1114
00:41:13,760 --> 00:41:14,960
and

1115
00:41:14,960 --> 00:41:18,000
uh bring bring things back

1116
00:41:18,000 --> 00:41:21,440
policy is decrypt

1117
00:41:21,440 --> 00:41:22,319
well

1118
00:41:22,319 --> 00:41:24,000
you get the idea it will work the same

1119
00:41:24,000 --> 00:41:26,880
way as as it did before uh perhaps we've

1120
00:41:26,880 --> 00:41:29,280
uh created a

1121
00:41:29,280 --> 00:41:31,359
um a way for us to

1122
00:41:31,359 --> 00:41:33,599
to bring the thing back and uh what we

1123
00:41:33,599 --> 00:41:35,440
can do is

1124
00:41:35,440 --> 00:41:36,960
we can actually

1125
00:41:36,960 --> 00:41:39,200
we can do agent

1126
00:41:39,200 --> 00:41:41,119
self

1127
00:41:41,119 --> 00:41:43,680
terminate

1128
00:41:43,680 --> 00:41:45,680
okay and once we

1129
00:41:45,680 --> 00:41:47,119
let's kill that thing i think it's

1130
00:41:47,119 --> 00:41:49,839
easier to

1131
00:41:50,800 --> 00:41:53,520
gonna see

1132
00:41:54,480 --> 00:41:55,920
close our window

1133
00:41:55,920 --> 00:41:57,839
it's

1134
00:41:57,839 --> 00:41:59,200
brought

1135
00:41:59,200 --> 00:42:00,960
things back right so let's just do a

1136
00:42:00,960 --> 00:42:02,560
termination once we we're doing

1137
00:42:02,560 --> 00:42:04,960
termination we're eradicating our agent

1138
00:42:04,960 --> 00:42:07,760
and it's no longer in memory right so

1139
00:42:07,760 --> 00:42:10,319
as red teams or blue team

1140
00:42:10,319 --> 00:42:12,160
users you can you can get all the

1141
00:42:12,160 --> 00:42:13,520
information prior to that but

1142
00:42:13,520 --> 00:42:16,560
essentially um this is what's going to

1143
00:42:16,560 --> 00:42:18,640
happen it's just going to kill itself

1144
00:42:18,640 --> 00:42:21,040
and and this stage and be gone right

1145
00:42:21,040 --> 00:42:23,760
that's how we clean it up after

1146
00:42:23,760 --> 00:42:26,160
um after our

1147
00:42:26,160 --> 00:42:28,800
thing right so it's gone

1148
00:42:28,800 --> 00:42:32,720
so uh and you know obviously deep dive

1149
00:42:32,720 --> 00:42:35,280
into policy uh you know

1150
00:42:35,280 --> 00:42:38,319
it's in the docs uh it can do local

1151
00:42:38,319 --> 00:42:40,560
authentication they can do remote uh

1152
00:42:40,560 --> 00:42:42,400
authentication they can do impersonation

1153
00:42:42,400 --> 00:42:44,400
of a user in local remote machine all

1154
00:42:44,400 --> 00:42:46,079
that good stuff

1155
00:42:46,079 --> 00:42:48,720
one thing to note before we

1156
00:42:48,720 --> 00:42:51,839
switch back is that we deliberately want

1157
00:42:51,839 --> 00:42:54,079
to target specific files so we do not

1158
00:42:54,079 --> 00:42:56,800
follow the links we do not want to

1159
00:42:56,800 --> 00:42:58,800
kind of wreak havoc on just like encrypt

1160
00:42:58,800 --> 00:43:01,040
everything on the c drive uh in the

1161
00:43:01,040 --> 00:43:03,119
future there may be a way to do regular

1162
00:43:03,119 --> 00:43:05,359
expressions uh obviously

1163
00:43:05,359 --> 00:43:08,560
uh but uh that is specifically so we can

1164
00:43:08,560 --> 00:43:10,640
simulate ransomware but not

1165
00:43:10,640 --> 00:43:12,400
so but kind of stay within scope and not

1166
00:43:12,400 --> 00:43:15,040
cause denial of service

1167
00:43:15,040 --> 00:43:17,839
so bring bring things back um i want to

1168
00:43:17,839 --> 00:43:20,720
do two things um defensive summary is

1169
00:43:20,720 --> 00:43:22,720
that

1170
00:43:22,720 --> 00:43:25,359
tools can be changed agents can be uh

1171
00:43:25,359 --> 00:43:27,680
signatured um

1172
00:43:27,680 --> 00:43:28,480
uh

1173
00:43:28,480 --> 00:43:30,640
resources can be signatured

1174
00:43:30,640 --> 00:43:33,280
so the goal of the tool for right now is

1175
00:43:33,280 --> 00:43:35,599
to simulate controlled ransomware life

1176
00:43:35,599 --> 00:43:38,079
cycle the emphasis is uncontrolled and

1177
00:43:38,079 --> 00:43:40,000
the life cycle we have to be controlled

1178
00:43:40,000 --> 00:43:41,680
in the way and deliberate and the way we

1179
00:43:41,680 --> 00:43:44,560
do things and we want to generate go

1180
00:43:44,560 --> 00:43:46,240
through the entire life cycle how it

1181
00:43:46,240 --> 00:43:48,319
works in the wild

1182
00:43:48,319 --> 00:43:50,560
for the rad team we want to last deliver

1183
00:43:50,560 --> 00:43:53,520
less mile monetization to kick off

1184
00:43:53,520 --> 00:43:55,200
you know your objectives

1185
00:43:55,200 --> 00:43:56,160
um

1186
00:43:56,160 --> 00:43:58,560
if the response process does not exist

1187
00:43:58,560 --> 00:44:00,800
we want to showcase that it needs to be

1188
00:44:00,800 --> 00:44:01,599
there

1189
00:44:01,599 --> 00:44:03,599
and if it does exist we want to align

1190
00:44:03,599 --> 00:44:05,440
and refine it

1191
00:44:05,440 --> 00:44:06,839
um

1192
00:44:06,839 --> 00:44:10,400
and uh verify what uh the offensive and

1193
00:44:10,400 --> 00:44:12,240
defensive triages

1194
00:44:12,240 --> 00:44:13,119
uh

1195
00:44:13,119 --> 00:44:15,520
have or say in the policy that actually

1196
00:44:15,520 --> 00:44:18,240
work do you recover within one hour do

1197
00:44:18,240 --> 00:44:20,240
you say you do do you actually do it

1198
00:44:20,240 --> 00:44:23,760
right that type of thing and uh notice

1199
00:44:23,760 --> 00:44:26,079
the defenders as opposed to offensive uh

1200
00:44:26,079 --> 00:44:28,240
players guys is that don't signature the

1201
00:44:28,240 --> 00:44:30,800
two obviously uh you know you're gonna

1202
00:44:30,800 --> 00:44:33,520
have signatures you know uh you're gonna

1203
00:44:33,520 --> 00:44:35,920
have uh yara rules created for it they

1204
00:44:35,920 --> 00:44:36,960
already

1205
00:44:36,960 --> 00:44:38,960
created i can't escape it that's the way

1206
00:44:38,960 --> 00:44:41,200
it is but i want to stress paying

1207
00:44:41,200 --> 00:44:43,040
attention to behaviors

1208
00:44:43,040 --> 00:44:45,520
how do things get encrypted what is the

1209
00:44:45,520 --> 00:44:47,599
behavioral profile what is the

1210
00:44:47,599 --> 00:44:49,760
performance profile how does it what

1211
00:44:49,760 --> 00:44:51,680
system calls it it gets you for

1212
00:44:51,680 --> 00:44:54,079
encryption specifically not which tool

1213
00:44:54,079 --> 00:44:56,880
does it right and the artifacts

1214
00:44:56,880 --> 00:44:58,560
of ransomware may be minimal so pay

1215
00:44:58,560 --> 00:45:00,400
attention to

1216
00:45:00,400 --> 00:45:03,200
what it does behaviorally uh and as you

1217
00:45:03,200 --> 00:45:05,520
know iocs are tied to implementation

1218
00:45:05,520 --> 00:45:07,680
specifically so if racketeer evolves

1219
00:45:07,680 --> 00:45:11,359
iocs may change right so the test agent

1220
00:45:11,359 --> 00:45:13,599
is less stealthy in its weekend on

1221
00:45:13,599 --> 00:45:16,160
purpose we have not encrypted the entire

1222
00:45:16,160 --> 00:45:18,400
executables we have not packed it all

1223
00:45:18,400 --> 00:45:21,040
that good stuff so i want it to be used

1224
00:45:21,040 --> 00:45:24,000
for legitimate purposes not for

1225
00:45:24,000 --> 00:45:25,680
testing something that you're not

1226
00:45:25,680 --> 00:45:28,240
authorized to do but obviously source

1227
00:45:28,240 --> 00:45:30,160
code is out there it's free

1228
00:45:30,160 --> 00:45:32,000
open source you can modify it to your

1229
00:45:32,000 --> 00:45:33,280
needs

1230
00:45:33,280 --> 00:45:35,760
and uh last but not least every time you

1231
00:45:35,760 --> 00:45:37,599
run with ransomware

1232
00:45:37,599 --> 00:45:38,960
uh

1233
00:45:38,960 --> 00:45:40,880
do correlate operational performance and

1234
00:45:40,880 --> 00:45:42,400
security messages because you never know

1235
00:45:42,400 --> 00:45:44,560
which one will alert you on a presence

1236
00:45:44,560 --> 00:45:46,720
on ransomware

1237
00:45:46,720 --> 00:45:48,640
so with that i want to thank everybody

1238
00:45:48,640 --> 00:45:51,359
for coming and seeing in the talk

1239
00:45:51,359 --> 00:45:53,920
and here's the link in the in in the

1240
00:45:53,920 --> 00:45:55,359
description here

1241
00:45:55,359 --> 00:45:58,720
to this tool uh the tool is

1242
00:45:58,720 --> 00:46:01,200
open source you can fork it you can

1243
00:46:01,200 --> 00:46:04,640
create issues uh if or or features if

1244
00:46:04,640 --> 00:46:05,440
you

1245
00:46:05,440 --> 00:46:08,079
uh would like to uh to use it and thank

1246
00:46:08,079 --> 00:46:11,960
you very much for that

