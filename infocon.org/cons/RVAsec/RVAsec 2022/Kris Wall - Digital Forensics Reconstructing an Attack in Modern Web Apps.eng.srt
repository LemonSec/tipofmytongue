1
00:00:15,120 --> 00:00:16,720
everyone i want to thank everybody for

2
00:00:16,720 --> 00:00:19,760
joining me today my name is chris wall

3
00:00:19,760 --> 00:00:20,960
and today we're going to be talking

4
00:00:20,960 --> 00:00:22,320
about

5
00:00:22,320 --> 00:00:25,039
digital forensics and reconstructing an

6
00:00:25,039 --> 00:00:28,080
attack on a modern web application a

7
00:00:28,080 --> 00:00:29,519
little bit about me i am the chief

8
00:00:29,519 --> 00:00:31,679
technology officer and the co-founder of

9
00:00:31,679 --> 00:00:33,920
critical fault a cyber security company

10
00:00:33,920 --> 00:00:35,920
uh based out of oklahoma

11
00:00:35,920 --> 00:00:38,640
i have been in it

12
00:00:38,640 --> 00:00:41,920
for damn near 20 years um it's almost

13
00:00:41,920 --> 00:00:44,320
there recently

14
00:00:44,320 --> 00:00:45,920
i made the switch well not recently

15
00:00:45,920 --> 00:00:47,840
several years ago i made the switch from

16
00:00:47,840 --> 00:00:50,640
doing it working at an msp to switching

17
00:00:50,640 --> 00:00:52,399
over to being a developer for several

18
00:00:52,399 --> 00:00:54,800
years which i realized i'm not a very

19
00:00:54,800 --> 00:00:57,120
good developer i make a lot of mistakes

20
00:00:57,120 --> 00:00:59,039
a lot of common mistakes

21
00:00:59,039 --> 00:01:02,239
and these these mistakes

22
00:01:02,239 --> 00:01:03,680
presented vulnerabilities in the

23
00:01:03,680 --> 00:01:05,519
software that i was writing i had worked

24
00:01:05,519 --> 00:01:07,520
for several um

25
00:01:07,520 --> 00:01:09,360
i worked as a freelance and for several

26
00:01:09,360 --> 00:01:10,880
different projects and i was introducing

27
00:01:10,880 --> 00:01:12,560
vulnerabilities into the software i was

28
00:01:12,560 --> 00:01:15,360
writing so i became obsessed how do i

29
00:01:15,360 --> 00:01:17,600
fix these problems how do i stop having

30
00:01:17,600 --> 00:01:19,520
these vulnerabilities inside my own

31
00:01:19,520 --> 00:01:21,920
software and so as i came up with

32
00:01:21,920 --> 00:01:24,000
solutions and did my research i started

33
00:01:24,000 --> 00:01:25,119
sharing this information with the

34
00:01:25,119 --> 00:01:27,360
community and that actually got me my

35
00:01:27,360 --> 00:01:29,920
first job in security and it's been

36
00:01:29,920 --> 00:01:31,759
history ever since

37
00:01:31,759 --> 00:01:33,759
okay so i have a picture of a kiwi up

38
00:01:33,759 --> 00:01:34,960
here i need

39
00:01:34,960 --> 00:01:37,040
a safe word preferably a fruit does

40
00:01:37,040 --> 00:01:39,280
anybody have a safe word for me

41
00:01:39,280 --> 00:01:41,920
banana we have banana okay so the reason

42
00:01:41,920 --> 00:01:43,280
why i ask for

43
00:01:43,280 --> 00:01:46,159
a fruit safe word is i have a tendency

44
00:01:46,159 --> 00:01:48,079
to talk a little too fast get really

45
00:01:48,079 --> 00:01:49,200
excited

46
00:01:49,200 --> 00:01:53,200
i am pushing forward real quick if

47
00:01:53,200 --> 00:01:55,520
for any reason if i'm talking too fast

48
00:01:55,520 --> 00:01:57,759
or not close enough to the mic or you

49
00:01:57,759 --> 00:01:59,119
just want me to go back and cover it

50
00:01:59,119 --> 00:02:01,759
again please yell out banana

51
00:02:01,759 --> 00:02:02,880
once

52
00:02:02,880 --> 00:02:05,520
just once

53
00:02:05,520 --> 00:02:06,960
all right well we're going to go ahead

54
00:02:06,960 --> 00:02:07,680
and

55
00:02:07,680 --> 00:02:09,520
jump straight on into this

56
00:02:09,520 --> 00:02:10,878
okay so

57
00:02:10,878 --> 00:02:13,440
there's some av problems uh we had to

58
00:02:13,440 --> 00:02:15,760
seriously reduce the resolution so if we

59
00:02:15,760 --> 00:02:17,760
can't read something i'll zoom in or

60
00:02:17,760 --> 00:02:20,080
just yell out banana and i'll tell you

61
00:02:20,080 --> 00:02:21,680
what the screen says but we're actually

62
00:02:21,680 --> 00:02:23,760
going to do a live demo that's why we're

63
00:02:23,760 --> 00:02:25,280
we're running it this way

64
00:02:25,280 --> 00:02:26,959
all right well let's let's do a quick

65
00:02:26,959 --> 00:02:28,640
crash course into digital forensics

66
00:02:28,640 --> 00:02:29,920
there's a couple key pieces of

67
00:02:29,920 --> 00:02:31,519
terminology we need to go ahead and

68
00:02:31,519 --> 00:02:33,120
address and some other pieces of

69
00:02:33,120 --> 00:02:35,519
understanding what is going on

70
00:02:35,519 --> 00:02:37,760
so real quick for those that don't know

71
00:02:37,760 --> 00:02:39,440
about the verizon data breach

72
00:02:39,440 --> 00:02:41,760
investigation report it comes out every

73
00:02:41,760 --> 00:02:43,840
year it is an excellent report that

74
00:02:43,840 --> 00:02:45,200
talks about

75
00:02:45,200 --> 00:02:46,720
with companies that are willing to share

76
00:02:46,720 --> 00:02:48,879
their breaches their incidences the the

77
00:02:48,879 --> 00:02:51,280
attempts to hack their organizations or

78
00:02:51,280 --> 00:02:52,959
just social engineer their way in and

79
00:02:52,959 --> 00:02:55,519
they compile a huge listing of this

80
00:02:55,519 --> 00:02:58,720
information so we can better understand

81
00:02:58,720 --> 00:03:00,720
where the attacks are coming from now

82
00:03:00,720 --> 00:03:02,879
what's very important here is that in

83
00:03:02,879 --> 00:03:05,840
the 22 excuse me 2022 version of this

84
00:03:05,840 --> 00:03:07,519
report that

85
00:03:07,519 --> 00:03:09,280
we saw that

86
00:03:09,280 --> 00:03:12,239
roughly 45 of all attacks were based on

87
00:03:12,239 --> 00:03:14,640
web applications now that can be

88
00:03:14,640 --> 00:03:15,840
trying to hack your way into the web

89
00:03:15,840 --> 00:03:17,360
application that can be trying to use

90
00:03:17,360 --> 00:03:19,280
stolen credentials through a web

91
00:03:19,280 --> 00:03:20,640
application but

92
00:03:20,640 --> 00:03:23,280
the vast majority of all attacks came

93
00:03:23,280 --> 00:03:24,319
through

94
00:03:24,319 --> 00:03:26,000
some sort of web application and so it's

95
00:03:26,000 --> 00:03:27,760
important to talk about well when an

96
00:03:27,760 --> 00:03:29,920
attack actually occurs how do we how do

97
00:03:29,920 --> 00:03:31,519
we get started how do we understand what

98
00:03:31,519 --> 00:03:32,720
was it

99
00:03:32,720 --> 00:03:34,159
what was affected

100
00:03:34,159 --> 00:03:35,920
and so we do know when we're talking

101
00:03:35,920 --> 00:03:39,040
about hacking at the actual act of

102
00:03:39,040 --> 00:03:40,959
connecting to a system and sending

103
00:03:40,959 --> 00:03:43,519
payloads and trying to breach the system

104
00:03:43,519 --> 00:03:46,080
through some sort of technical means the

105
00:03:46,080 --> 00:03:48,239
vast majority of all attacks are against

106
00:03:48,239 --> 00:03:50,319
web applications this is wildly

107
00:03:50,319 --> 00:03:52,159
different than it was five ten years ago

108
00:03:52,159 --> 00:03:54,080
but web applications

109
00:03:54,080 --> 00:03:56,400
i'm convinced is the next frontier of

110
00:03:56,400 --> 00:03:57,840
cyber security it's the place where we

111
00:03:57,840 --> 00:04:00,000
need to be focusing there was an

112
00:04:00,000 --> 00:04:02,000
excellent talk yesterday on

113
00:04:02,000 --> 00:04:04,879
setting up a apsec program that was a

114
00:04:04,879 --> 00:04:06,720
fantastic talk if you haven't seen that

115
00:04:06,720 --> 00:04:08,720
one definitely find david he's here

116
00:04:08,720 --> 00:04:10,400
somewhere and definitely have a

117
00:04:10,400 --> 00:04:12,720
conversation with david

118
00:04:12,720 --> 00:04:14,640
okay a couple quick bits of terminology

119
00:04:14,640 --> 00:04:16,000
so in digital forensics digital

120
00:04:16,000 --> 00:04:18,798
forensics is the formal process of

121
00:04:18,798 --> 00:04:21,600
collecting evidence and storing it in a

122
00:04:21,600 --> 00:04:23,600
formal chain of custody to prove that

123
00:04:23,600 --> 00:04:25,520
that information was appropriately

124
00:04:25,520 --> 00:04:28,720
acquired and not mishandled at any point

125
00:04:28,720 --> 00:04:31,040
oftentimes when we do present in court

126
00:04:31,040 --> 00:04:33,280
we do have to be cross-examined and we

127
00:04:33,280 --> 00:04:36,560
do have to show that the evidence is

128
00:04:36,560 --> 00:04:38,560
correct that it is it is officially

129
00:04:38,560 --> 00:04:40,400
there that it was acquired using

130
00:04:40,400 --> 00:04:43,280
industry best standards that if somebody

131
00:04:43,280 --> 00:04:45,120
else were to do the exact same digital

132
00:04:45,120 --> 00:04:46,720
forensics examination they'd come up

133
00:04:46,720 --> 00:04:48,400
with the same results

134
00:04:48,400 --> 00:04:49,840
there's also what we call the chain of

135
00:04:49,840 --> 00:04:51,919
custody this is very important we need

136
00:04:51,919 --> 00:04:54,000
to prove that the evidence that we're

137
00:04:54,000 --> 00:04:56,639
presenting to court

138
00:04:56,639 --> 00:04:58,240
made it in its full

139
00:04:58,240 --> 00:04:59,520
full entirety

140
00:04:59,520 --> 00:05:00,800
that no

141
00:05:00,800 --> 00:05:02,639
bit of integrity could have been

142
00:05:02,639 --> 00:05:04,080
possibly

143
00:05:04,080 --> 00:05:06,400
misconfigured deleted changed anything

144
00:05:06,400 --> 00:05:09,280
nothing should be modified when it comes

145
00:05:09,280 --> 00:05:11,280
to the chain of custody

146
00:05:11,280 --> 00:05:12,560
in some response i love this slide

147
00:05:12,560 --> 00:05:14,960
they're hiding under their folders

148
00:05:14,960 --> 00:05:17,360
so instant response is different than

149
00:05:17,360 --> 00:05:19,199
digital forensics instant response is

150
00:05:19,199 --> 00:05:21,360
the act of responding to an incident

151
00:05:21,360 --> 00:05:23,600
while it's happening it's mitigating the

152
00:05:23,600 --> 00:05:25,919
active threat so the reason why i bring

153
00:05:25,919 --> 00:05:27,600
incident response in here is there's a

154
00:05:27,600 --> 00:05:29,120
lot of overlap

155
00:05:29,120 --> 00:05:31,600
at least when an incident occurs and

156
00:05:31,600 --> 00:05:32,880
we're going to talk a little bit about

157
00:05:32,880 --> 00:05:34,160
incident response and how incident

158
00:05:34,160 --> 00:05:36,479
response occasionally can

159
00:05:36,479 --> 00:05:39,360
derail later investigative efforts so

160
00:05:39,360 --> 00:05:40,720
that's a important piece that we want to

161
00:05:40,720 --> 00:05:42,240
talk about and then there's expert

162
00:05:42,240 --> 00:05:45,199
witness testimony this is when somebody

163
00:05:45,199 --> 00:05:48,000
like yourself presents in court and

164
00:05:48,000 --> 00:05:49,520
they ask you all kinds of terrible

165
00:05:49,520 --> 00:05:51,039
horrible questions and try to discredit

166
00:05:51,039 --> 00:05:54,160
you as a human and you have to prove

167
00:05:54,160 --> 00:05:57,840
that you are worthy of being in the room

168
00:05:57,840 --> 00:06:00,240
okay so we're going to do a live demo

169
00:06:00,240 --> 00:06:01,440
today

170
00:06:01,440 --> 00:06:03,360
that's why the

171
00:06:03,360 --> 00:06:05,360
audio visual is a little little wonky

172
00:06:05,360 --> 00:06:06,960
just to make sure that it all works but

173
00:06:06,960 --> 00:06:09,840
this is a simplified example

174
00:06:09,840 --> 00:06:11,680
the whole point of talking about modern

175
00:06:11,680 --> 00:06:13,840
web applications is they're not so

176
00:06:13,840 --> 00:06:16,960
simple they they don't exist on a single

177
00:06:16,960 --> 00:06:18,800
system they don't exist in a single

178
00:06:18,800 --> 00:06:20,560
their ecosystem's not shrunk down to a

179
00:06:20,560 --> 00:06:22,000
single piece and so we're going to talk

180
00:06:22,000 --> 00:06:23,120
about

181
00:06:23,120 --> 00:06:24,800
what the modern

182
00:06:24,800 --> 00:06:26,720
web application development pipeline

183
00:06:26,720 --> 00:06:27,840
looks like

184
00:06:27,840 --> 00:06:29,120
now

185
00:06:29,120 --> 00:06:30,639
you probably can't read everything on

186
00:06:30,639 --> 00:06:32,720
this page that's the point

187
00:06:32,720 --> 00:06:35,280
this is i mean we we have a continuous

188
00:06:35,280 --> 00:06:37,680
integration so ci cd going on we have

189
00:06:37,680 --> 00:06:40,160
things being fetched from uh repos we

190
00:06:40,160 --> 00:06:42,880
have a slack uh component that is

191
00:06:42,880 --> 00:06:44,960
pulling in information we have docker we

192
00:06:44,960 --> 00:06:46,240
have all kinds of things happening in

193
00:06:46,240 --> 00:06:47,520
aws

194
00:06:47,520 --> 00:06:50,800
this is one single application example

195
00:06:50,800 --> 00:06:54,000
but a breach an actual attack can occur

196
00:06:54,000 --> 00:06:56,160
anywhere within this

197
00:06:56,160 --> 00:06:58,080
with this framework and just because you

198
00:06:58,080 --> 00:07:00,560
see the output of what would actually

199
00:07:00,560 --> 00:07:02,720
occurred doesn't allow you to see the

200
00:07:02,720 --> 00:07:04,880
inception point the origin of the attack

201
00:07:04,880 --> 00:07:07,120
and oftentimes you have to work your way

202
00:07:07,120 --> 00:07:09,440
backwards you know what went wrong but

203
00:07:09,440 --> 00:07:10,639
you have to work your way backwards to

204
00:07:10,639 --> 00:07:13,520
figure out how did it happen

205
00:07:13,520 --> 00:07:14,560
this is a little bit more of a

206
00:07:14,560 --> 00:07:17,360
simplified view this is more the older

207
00:07:17,360 --> 00:07:19,599
view the the three tier system

208
00:07:19,599 --> 00:07:21,440
where you have the web application

209
00:07:21,440 --> 00:07:23,120
excuse me web servers the application

210
00:07:23,120 --> 00:07:25,039
servers and then the database servers

211
00:07:25,039 --> 00:07:26,479
behind the scenes this is a little bit

212
00:07:26,479 --> 00:07:28,000
more of a traditional view it's easier

213
00:07:28,000 --> 00:07:29,599
to understand but all of this everything

214
00:07:29,599 --> 00:07:31,840
that we see here translates back into

215
00:07:31,840 --> 00:07:33,840
what we see here it's just so many

216
00:07:33,840 --> 00:07:35,680
things are spread to serverless

217
00:07:35,680 --> 00:07:37,840
components or to other sas providers

218
00:07:37,840 --> 00:07:39,120
that may have

219
00:07:39,120 --> 00:07:41,199
may provide some piece of that puzzle

220
00:07:41,199 --> 00:07:43,599
but technically speaking it boils down

221
00:07:43,599 --> 00:07:45,840
to what we typically typically see here

222
00:07:45,840 --> 00:07:46,639
where

223
00:07:46,639 --> 00:07:48,080
you have

224
00:07:48,080 --> 00:07:49,759
web servers you have application logic

225
00:07:49,759 --> 00:07:51,120
servers and then you have database

226
00:07:51,120 --> 00:07:52,080
servers

227
00:07:52,080 --> 00:07:53,440
there's so much more that can happen but

228
00:07:53,440 --> 00:07:56,319
that that's the gist of what occurs and

229
00:07:56,319 --> 00:07:58,560
in modern web applications there's a ton

230
00:07:58,560 --> 00:08:01,120
of different tools that

231
00:08:01,120 --> 00:08:03,520
you're going to be expected to at least

232
00:08:03,520 --> 00:08:05,120
know how to work with them how to

233
00:08:05,120 --> 00:08:06,879
investigate them how to understand what

234
00:08:06,879 --> 00:08:08,080
is there

235
00:08:08,080 --> 00:08:09,680
again we don't have to read every single

236
00:08:09,680 --> 00:08:11,599
piece in here the point is it is

237
00:08:11,599 --> 00:08:14,000
difficult it is difficult to know where

238
00:08:14,000 --> 00:08:15,759
to get started where did the breach

239
00:08:15,759 --> 00:08:18,000
occur did it did it happen in jira and

240
00:08:18,000 --> 00:08:19,599
we have to work our way up to jira so

241
00:08:19,599 --> 00:08:21,360
there's a lot of different pieces

242
00:08:21,360 --> 00:08:23,840
i added this slide just uh just today

243
00:08:23,840 --> 00:08:26,639
after i listened to nick's talk about

244
00:08:26,639 --> 00:08:30,000
doing phishing from sas providers using

245
00:08:30,000 --> 00:08:31,680
disguised

246
00:08:31,680 --> 00:08:33,919
invitations so invitations to projects

247
00:08:33,919 --> 00:08:35,120
invitations

248
00:08:35,120 --> 00:08:36,159
to

249
00:08:36,159 --> 00:08:38,479
the cloud providers and whatnot that's

250
00:08:38,479 --> 00:08:40,479
excellent and when you have attacks

251
00:08:40,479 --> 00:08:43,279
coming from this particular perspective

252
00:08:43,279 --> 00:08:44,480
how do you even figure that out

253
00:08:44,480 --> 00:08:46,240
especially when you spin up a tenant do

254
00:08:46,240 --> 00:08:47,760
whatever the attack is and spin it back

255
00:08:47,760 --> 00:08:50,560
down how is an examiner

256
00:08:50,560 --> 00:08:52,240
able to figure that out figure out that

257
00:08:52,240 --> 00:08:54,880
information i also put um so the one on

258
00:08:54,880 --> 00:08:57,760
the left is uh proxies or vpns or just

259
00:08:57,760 --> 00:08:59,839
anytime server-side requests forward

260
00:08:59,839 --> 00:09:02,320
where you let another system do the

261
00:09:02,320 --> 00:09:04,000
attack for you

262
00:09:04,000 --> 00:09:06,160
so if that if that's the case well how

263
00:09:06,160 --> 00:09:08,720
do you determine where the real origin

264
00:09:08,720 --> 00:09:10,160
of that attack came from and then

265
00:09:10,160 --> 00:09:12,399
finally on the right is databases

266
00:09:12,399 --> 00:09:14,320
oftentimes and we're seeing this more

267
00:09:14,320 --> 00:09:17,200
increasingly that when we do see the

268
00:09:17,200 --> 00:09:18,800
inception point where we do see the

269
00:09:18,800 --> 00:09:21,279
attack actually occurred that generally

270
00:09:21,279 --> 00:09:23,680
people think oh they dropped a file on

271
00:09:23,680 --> 00:09:25,839
the system or they made modifications to

272
00:09:25,839 --> 00:09:28,080
the system but nobody really ever seems

273
00:09:28,080 --> 00:09:30,240
to think about well could they have

274
00:09:30,240 --> 00:09:32,720
dropped a payload in the database could

275
00:09:32,720 --> 00:09:35,040
they be operating and living out of the

276
00:09:35,040 --> 00:09:36,720
database which is a very real thing

277
00:09:36,720 --> 00:09:38,880
especially with stored procedures uh if

278
00:09:38,880 --> 00:09:41,519
you're in the sql ecosystem so there's a

279
00:09:41,519 --> 00:09:44,320
lot of ways to hide your tracks and

280
00:09:44,320 --> 00:09:45,600
unfortunately in the forensic

281
00:09:45,600 --> 00:09:47,440
examination process we have to be able

282
00:09:47,440 --> 00:09:49,600
to look into frankly everything and i

283
00:09:49,600 --> 00:09:51,680
will say the sas part is going to be by

284
00:09:51,680 --> 00:09:54,160
far the hardest

285
00:09:54,160 --> 00:09:55,760
okay so anytime you're doing an

286
00:09:55,760 --> 00:09:58,320
examination there's always some must ask

287
00:09:58,320 --> 00:10:00,160
questions that are always going to be

288
00:10:00,160 --> 00:10:02,959
presented to you the first one is always

289
00:10:02,959 --> 00:10:04,399
how long will this take

290
00:10:04,399 --> 00:10:06,560
it is all that is always what people

291
00:10:06,560 --> 00:10:08,640
want to answer or what you want they

292
00:10:08,640 --> 00:10:10,880
want you to answer that information uh

293
00:10:10,880 --> 00:10:12,399
as quickly as possible how long will

294
00:10:12,399 --> 00:10:14,079
this take i

295
00:10:14,079 --> 00:10:16,079
we did one uh not too long ago where i

296
00:10:16,079 --> 00:10:18,560
had to drive six hours to go pick up a

297
00:10:18,560 --> 00:10:21,519
server pick up the server do the chain

298
00:10:21,519 --> 00:10:24,959
of custody and bring it back and before

299
00:10:24,959 --> 00:10:28,079
i even returned back to our forensic lab

300
00:10:28,079 --> 00:10:29,519
we were already getting questions hey

301
00:10:29,519 --> 00:10:31,680
what did you find

302
00:10:31,680 --> 00:10:33,600
what do you mean i haven't even i

303
00:10:33,600 --> 00:10:35,519
haven't even gotten to the lab to

304
00:10:35,519 --> 00:10:37,760
actually be able to unpack everything

305
00:10:37,760 --> 00:10:38,480
but

306
00:10:38,480 --> 00:10:40,399
this is not this is the norm people want

307
00:10:40,399 --> 00:10:42,480
to know because sometimes whatever the

308
00:10:42,480 --> 00:10:44,160
breach may be may affect business in

309
00:10:44,160 --> 00:10:46,000
this particular case it was ransomware

310
00:10:46,000 --> 00:10:48,240
and this particular satellite office was

311
00:10:48,240 --> 00:10:50,720
cut off from the main office until they

312
00:10:50,720 --> 00:10:52,880
figured out where the ransomware came

313
00:10:52,880 --> 00:10:55,200
from so

314
00:10:55,200 --> 00:10:57,760
i had to get a report out as quickly as

315
00:10:57,760 --> 00:10:59,519
possible but you don't want to rush the

316
00:10:59,519 --> 00:11:02,079
the process and give bad information or

317
00:11:02,079 --> 00:11:04,079
incomplete information but at the same

318
00:11:04,079 --> 00:11:07,040
time the client is down and frankly it

319
00:11:07,040 --> 00:11:09,920
was a hospital so meaning they couldn't

320
00:11:09,920 --> 00:11:12,399
deliver their services to the patients

321
00:11:12,399 --> 00:11:14,480
to the patients actually admitted to the

322
00:11:14,480 --> 00:11:16,560
hospital until we got our information in

323
00:11:16,560 --> 00:11:18,160
there because they couldn't record or do

324
00:11:18,160 --> 00:11:19,839
anything because everybody uses

325
00:11:19,839 --> 00:11:22,240
electronic health records nowadays

326
00:11:22,240 --> 00:11:23,839
the other question always is what

327
00:11:23,839 --> 00:11:24,959
happened

328
00:11:24,959 --> 00:11:26,800
we're going to talk about a lot of the

329
00:11:26,800 --> 00:11:28,320
different ways of getting there what was

330
00:11:28,320 --> 00:11:30,880
affected very important uh frankly the

331
00:11:30,880 --> 00:11:33,040
fbi guys did a great job of explaining

332
00:11:33,040 --> 00:11:35,360
the slide for me just a few minutes ago

333
00:11:35,360 --> 00:11:37,760
um and of course how did it happen and

334
00:11:37,760 --> 00:11:39,600
then this is the question

335
00:11:39,600 --> 00:11:41,040
it's a super dangerous question how do

336
00:11:41,040 --> 00:11:42,720
we prevent this from happening it's not

337
00:11:42,720 --> 00:11:45,040
really the digital

338
00:11:45,040 --> 00:11:46,320
excuse me forensic examiner's

339
00:11:46,320 --> 00:11:48,640
responsibility to provide that

340
00:11:48,640 --> 00:11:50,000
information we're supposed to tell you

341
00:11:50,000 --> 00:11:51,360
what occurred

342
00:11:51,360 --> 00:11:53,360
how did it occur but

343
00:11:53,360 --> 00:11:55,279
oftentimes we get that question well how

344
00:11:55,279 --> 00:11:56,560
do i keep this from happening again so

345
00:11:56,560 --> 00:11:59,040
we do have to give some general best

346
00:11:59,040 --> 00:12:01,920
advice generally it's not uh rolled into

347
00:12:01,920 --> 00:12:04,480
the reports it can be but we can give

348
00:12:04,480 --> 00:12:06,639
industry recommendations for for moving

349
00:12:06,639 --> 00:12:07,680
forward

350
00:12:07,680 --> 00:12:10,240
okay so i did say in some response

351
00:12:10,240 --> 00:12:11,680
digital forensics there is a bit of

352
00:12:11,680 --> 00:12:14,240
overlap unfortunately with incident

353
00:12:14,240 --> 00:12:15,600
response

354
00:12:15,600 --> 00:12:17,600
there's a mad rush to fix whatever the

355
00:12:17,600 --> 00:12:19,839
issue is things are on fire you're

356
00:12:19,839 --> 00:12:22,160
trying to get that situation un under

357
00:12:22,160 --> 00:12:24,480
wraps as fast as possible oftentimes

358
00:12:24,480 --> 00:12:26,240
this can be wiping systems restoring

359
00:12:26,240 --> 00:12:28,000
things from backups taking systems

360
00:12:28,000 --> 00:12:29,040
offline

361
00:12:29,040 --> 00:12:31,920
who knows rebooting systems that's

362
00:12:31,920 --> 00:12:34,880
anytime that as an examiner if i need to

363
00:12:34,880 --> 00:12:35,920
preserve

364
00:12:35,920 --> 00:12:38,399
volatile evidence that's in a cache or

365
00:12:38,399 --> 00:12:40,079
that's in memory

366
00:12:40,079 --> 00:12:41,519
how am i going to get that information

367
00:12:41,519 --> 00:12:43,279
back when the incident response guys ran

368
00:12:43,279 --> 00:12:45,360
by and rebooted everything

369
00:12:45,360 --> 00:12:47,120
how am i going to do that

370
00:12:47,120 --> 00:12:49,680
so unfortunately the instant response

371
00:12:49,680 --> 00:12:52,880
is almost never perfect it never never

372
00:12:52,880 --> 00:12:54,800
goes right

373
00:12:54,800 --> 00:12:56,639
and that's that's just the nature of the

374
00:12:56,639 --> 00:12:58,560
beast so

375
00:12:58,560 --> 00:13:00,320
our job oftentimes is to work with

376
00:13:00,320 --> 00:13:02,800
instant response and provide guidance so

377
00:13:02,800 --> 00:13:05,440
that this information is preserved that

378
00:13:05,440 --> 00:13:07,600
evidence isn't destroyed in the process

379
00:13:07,600 --> 00:13:09,360
it's very important

380
00:13:09,360 --> 00:13:11,040
to have that open dialogue with your

381
00:13:11,040 --> 00:13:12,399
incident responders

382
00:13:12,399 --> 00:13:13,360
so that

383
00:13:13,360 --> 00:13:15,120
i mean i've been an instant responder

384
00:13:15,120 --> 00:13:17,040
i've addressed a lot of different issues

385
00:13:17,040 --> 00:13:18,880
and i have even

386
00:13:18,880 --> 00:13:21,200
you know in the past realized that some

387
00:13:21,200 --> 00:13:22,959
evidence was destroyed in the process

388
00:13:22,959 --> 00:13:24,959
yeah the client's back up and running

389
00:13:24,959 --> 00:13:27,200
and this is this is the case anytime

390
00:13:27,200 --> 00:13:28,800
that we have a case like this this is a

391
00:13:28,800 --> 00:13:30,079
recovery effort you're trying to

392
00:13:30,079 --> 00:13:31,519
understand what exactly happened and

393
00:13:31,519 --> 00:13:33,440
make sense of what logs and

394
00:13:33,440 --> 00:13:35,519
evidence still exists

395
00:13:35,519 --> 00:13:38,079
and again this gets really hard to

396
00:13:38,079 --> 00:13:40,240
figure out what occurred where and where

397
00:13:40,240 --> 00:13:42,720
did it start and you have to suss out

398
00:13:42,720 --> 00:13:45,519
is this traffic is what is occurring on

399
00:13:45,519 --> 00:13:48,560
the network based on the attackers

400
00:13:48,560 --> 00:13:50,160
did the attackers cause the activity

401
00:13:50,160 --> 00:13:51,920
that you're seeing was it incident

402
00:13:51,920 --> 00:13:54,079
response that caused usually they cause

403
00:13:54,079 --> 00:13:57,600
a huge uh amount of activity on a

404
00:13:57,600 --> 00:13:59,440
network on a system on different

405
00:13:59,440 --> 00:14:01,279
locations throughout the network and so

406
00:14:01,279 --> 00:14:02,399
now you have to

407
00:14:02,399 --> 00:14:04,800
separate that out what was it instant

408
00:14:04,800 --> 00:14:06,880
response that ended up making a change

409
00:14:06,880 --> 00:14:08,720
here or was it just regular everyday

410
00:14:08,720 --> 00:14:10,399
user activity we have to strip that

411
00:14:10,399 --> 00:14:12,320
information out to be able to

412
00:14:12,320 --> 00:14:14,079
focus in directly on where the attackers

413
00:14:14,079 --> 00:14:16,720
came in and again there are so many

414
00:14:16,720 --> 00:14:18,399
different places to start especially on

415
00:14:18,399 --> 00:14:20,320
modern web applications

416
00:14:20,320 --> 00:14:22,079
okay so we're actually going to do a

417
00:14:22,079 --> 00:14:23,600
live demo

418
00:14:23,600 --> 00:14:24,560
that's why

419
00:14:24,560 --> 00:14:26,800
again the audio visual setup so we're

420
00:14:26,800 --> 00:14:28,240
going to get started if you guys can't

421
00:14:28,240 --> 00:14:30,480
read this i will zoom in or just read it

422
00:14:30,480 --> 00:14:32,800
out but uh in short so we're going to do

423
00:14:32,800 --> 00:14:34,240
a live demo on

424
00:14:34,240 --> 00:14:37,440
an application server that

425
00:14:37,440 --> 00:14:39,360
a new user has been created

426
00:14:39,360 --> 00:14:41,199
the user's name is bob he's the local

427
00:14:41,199 --> 00:14:43,600
admin what's going on here we need to

428
00:14:43,600 --> 00:14:46,079
figure out why did bob appear what what

429
00:14:46,079 --> 00:14:48,320
is going on and there's some other bits

430
00:14:48,320 --> 00:14:50,480
of information so whoever became aware

431
00:14:50,480 --> 00:14:51,760
of this said oh

432
00:14:51,760 --> 00:14:53,040
that's weird

433
00:14:53,040 --> 00:14:54,720
there's a executable program called

434
00:14:54,720 --> 00:14:56,560
program.exe running

435
00:14:56,560 --> 00:14:59,040
and we have a pid a process identifier

436
00:14:59,040 --> 00:14:59,760
of

437
00:14:59,760 --> 00:15:01,760
9832 okay

438
00:15:01,760 --> 00:15:02,959
what is that

439
00:15:02,959 --> 00:15:04,639
what's going on here

440
00:15:04,639 --> 00:15:05,360
so

441
00:15:05,360 --> 00:15:06,320
generally

442
00:15:06,320 --> 00:15:08,480
old school tool netstat just take a

443
00:15:08,480 --> 00:15:10,560
quick look figure out okay

444
00:15:10,560 --> 00:15:13,120
let's let's find the pid so we have uh

445
00:15:13,120 --> 00:15:15,040
9832 over there

446
00:15:15,040 --> 00:15:17,199
so we have this pid and we're able to

447
00:15:17,199 --> 00:15:19,519
see uh different information

448
00:15:19,519 --> 00:15:23,040
and we can see that 9832 is connected

449
00:15:23,040 --> 00:15:26,079
uh to a ipn.33

450
00:15:26,079 --> 00:15:29,120
on port 7777 so this is this is a good

451
00:15:29,120 --> 00:15:30,880
indicator that something interesting is

452
00:15:30,880 --> 00:15:33,279
going on we also know that uh

453
00:15:33,279 --> 00:15:35,360
netbios and other other common windows

454
00:15:35,360 --> 00:15:37,440
tools are sitting there listening

455
00:15:37,440 --> 00:15:39,199
to different traffic so we already have

456
00:15:39,199 --> 00:15:41,519
some information of maybe how somebody

457
00:15:41,519 --> 00:15:43,759
was beginning the breach efforts

458
00:15:43,759 --> 00:15:45,360
okay so

459
00:15:45,360 --> 00:15:47,839
the person who noticed what was going on

460
00:15:47,839 --> 00:15:50,240
also took the time to just fire up a

461
00:15:50,240 --> 00:15:53,040
process explorer to take a quick look

462
00:15:53,040 --> 00:15:54,639
and uh okay we need to figure out where

463
00:15:54,639 --> 00:15:56,720
is this program.exe so they can open up

464
00:15:56,720 --> 00:15:59,199
the file location uh-oh

465
00:15:59,199 --> 00:16:01,120
it's on the c drive

466
00:16:01,120 --> 00:16:02,959
that's definitely a problem

467
00:16:02,959 --> 00:16:05,120
i'm sure somebody knows why but we're

468
00:16:05,120 --> 00:16:06,639
going to get to that here in a moment

469
00:16:06,639 --> 00:16:07,600
okay

470
00:16:07,600 --> 00:16:09,680
so uh here before we switch to the the

471
00:16:09,680 --> 00:16:11,120
live demo we're going to talk about a

472
00:16:11,120 --> 00:16:14,079
couple common tools this is not a tools

473
00:16:14,079 --> 00:16:15,040
talk

474
00:16:15,040 --> 00:16:17,120
there are tools that we use such as

475
00:16:17,120 --> 00:16:19,040
forensic imaging but i'm not here to

476
00:16:19,040 --> 00:16:20,560
tell you exactly which tool to use

477
00:16:20,560 --> 00:16:22,959
that's for you to decide especially as

478
00:16:22,959 --> 00:16:25,519
you're working you build your own

479
00:16:25,519 --> 00:16:26,959
digital forensics

480
00:16:26,959 --> 00:16:28,800
department or you work with others so

481
00:16:28,800 --> 00:16:30,160
it's important to know

482
00:16:30,160 --> 00:16:32,399
what tools that they used that should be

483
00:16:32,399 --> 00:16:35,519
in the report but again the tool serves

484
00:16:35,519 --> 00:16:36,959
a purpose we're not here to tell you

485
00:16:36,959 --> 00:16:38,720
which one is the best one

486
00:16:38,720 --> 00:16:40,880
so anytime that we are doing an

487
00:16:40,880 --> 00:16:43,360
examination oftentimes the most common

488
00:16:43,360 --> 00:16:44,880
thing that we need to do is to do some

489
00:16:44,880 --> 00:16:46,800
sort of forensic imaging this is the

490
00:16:46,800 --> 00:16:50,000
process where we capture all the data on

491
00:16:50,000 --> 00:16:51,519
a storage device

492
00:16:51,519 --> 00:16:54,720
all of it including unallocated space

493
00:16:54,720 --> 00:16:56,800
very important that we get that space

494
00:16:56,800 --> 00:16:58,639
uh let's think about it if the

495
00:16:58,639 --> 00:17:00,160
attacker's on a system and they're

496
00:17:00,160 --> 00:17:03,440
writing files to disk and then um they

497
00:17:03,440 --> 00:17:04,959
want to clean up their tracks and they

498
00:17:04,959 --> 00:17:06,480
delete their records and then they move

499
00:17:06,480 --> 00:17:08,799
on so at this point if we did an image

500
00:17:08,799 --> 00:17:11,280
and we only imaged every single file on

501
00:17:11,280 --> 00:17:13,039
the system that's still there in the

502
00:17:13,039 --> 00:17:15,280
master file table record or or however

503
00:17:15,280 --> 00:17:16,559
whatever a

504
00:17:16,559 --> 00:17:18,240
file system that you're using if we look

505
00:17:18,240 --> 00:17:21,199
at it that way then we can only see the

506
00:17:21,199 --> 00:17:23,199
files that still exist but what about

507
00:17:23,199 --> 00:17:24,640
the deleted information what about the

508
00:17:24,640 --> 00:17:26,240
information in the slack space or on

509
00:17:26,240 --> 00:17:28,240
allocated space what other information

510
00:17:28,240 --> 00:17:30,240
can we go and find so we do need to do a

511
00:17:30,240 --> 00:17:32,880
full capture of the the storage and

512
00:17:32,880 --> 00:17:34,720
frankly that's a lot of data i mean

513
00:17:34,720 --> 00:17:37,440
we're talking about um

514
00:17:37,440 --> 00:17:41,679
images that are the exact same size as

515
00:17:41,679 --> 00:17:43,760
as the the actual storage device so you

516
00:17:43,760 --> 00:17:47,840
have a 500 gig ssd you have a 500 gig uh

517
00:17:47,840 --> 00:17:49,360
image that comes at it yes there are

518
00:17:49,360 --> 00:17:51,280
compression methods out there

519
00:17:51,280 --> 00:17:54,640
that is that is a bit of a

520
00:17:54,640 --> 00:17:56,799
problem that when you try to argue in

521
00:17:56,799 --> 00:17:59,520
court yes i used a compressed method

522
00:17:59,520 --> 00:18:01,520
you have to prove that it worked and it

523
00:18:01,520 --> 00:18:02,880
worked correctly but still that

524
00:18:02,880 --> 00:18:06,000
compression only works so well

525
00:18:06,000 --> 00:18:06,880
another piece that we're going to be

526
00:18:06,880 --> 00:18:08,640
talking about is the timeline view so

527
00:18:08,640 --> 00:18:10,559
the timeline view pulls from a ton of

528
00:18:10,559 --> 00:18:12,240
different sources

529
00:18:12,240 --> 00:18:14,320
so let's say i get an image and i take

530
00:18:14,320 --> 00:18:16,480
that image and i want to process the

531
00:18:16,480 --> 00:18:18,160
timeline so windows is a pretty easy one

532
00:18:18,160 --> 00:18:19,679
to understand

533
00:18:19,679 --> 00:18:21,120
that there's going to be a lot of

534
00:18:21,120 --> 00:18:22,720
information that's going to be specific

535
00:18:22,720 --> 00:18:25,440
on that system so windows as we know it

536
00:18:25,440 --> 00:18:28,160
has date modified date created last

537
00:18:28,160 --> 00:18:30,080
accessed these information that we can

538
00:18:30,080 --> 00:18:32,320
use to build a timeline to understand

539
00:18:32,320 --> 00:18:34,960
but that's just for files we also have

540
00:18:34,960 --> 00:18:37,120
the event logs we have other any kind of

541
00:18:37,120 --> 00:18:39,360
other operating system logs or

542
00:18:39,360 --> 00:18:40,720
application logs that may be on the

543
00:18:40,720 --> 00:18:43,120
system we also have artifacts this is

544
00:18:43,120 --> 00:18:44,640
for example when you

545
00:18:44,640 --> 00:18:47,440
launch an application from a gui uh that

546
00:18:47,440 --> 00:18:49,200
there's going to be information that

547
00:18:49,200 --> 00:18:50,720
explorer will automatically create

548
00:18:50,720 --> 00:18:51,919
behind the scenes there's going to be

549
00:18:51,919 --> 00:18:53,679
information inside the uh the registry

550
00:18:53,679 --> 00:18:54,960
there's going to be tons of information

551
00:18:54,960 --> 00:18:56,960
all over the place that we can come back

552
00:18:56,960 --> 00:18:59,200
and examine and understand exactly what

553
00:18:59,200 --> 00:19:01,120
happened because all these artifacts are

554
00:19:01,120 --> 00:19:02,799
get created but this isn't the only

555
00:19:02,799 --> 00:19:04,480
place we're going to be looking today it

556
00:19:04,480 --> 00:19:06,320
is you know it's more of a simplified

557
00:19:06,320 --> 00:19:09,280
view but we also need to go look at what

558
00:19:09,280 --> 00:19:11,440
other systems were touched in the

559
00:19:11,440 --> 00:19:13,600
process did they pass through a firewall

560
00:19:13,600 --> 00:19:15,679
was there a proxy involved is the proxy

561
00:19:15,679 --> 00:19:17,039
logging

562
00:19:17,039 --> 00:19:18,880
did they trigger any canary tokens did

563
00:19:18,880 --> 00:19:21,200
we have extra information does the sim

564
00:19:21,200 --> 00:19:22,880
have the answers that we're looking for

565
00:19:22,880 --> 00:19:25,120
these are other places that we go and we

566
00:19:25,120 --> 00:19:27,360
try to find out the information of well

567
00:19:27,360 --> 00:19:28,799
what exactly happened and how did it

568
00:19:28,799 --> 00:19:29,840
happen

569
00:19:29,840 --> 00:19:32,000
hex editor doesn't again i don't care

570
00:19:32,000 --> 00:19:34,160
which one that you guys use but a hex

571
00:19:34,160 --> 00:19:36,320
editor can examine i mean we have a json

572
00:19:36,320 --> 00:19:38,000
file opened here and we're looking at it

573
00:19:38,000 --> 00:19:39,520
through a hex editor view where i can

574
00:19:39,520 --> 00:19:42,240
actually look at the contents i can see

575
00:19:42,240 --> 00:19:43,919
the information that is stored inside

576
00:19:43,919 --> 00:19:45,760
the sectors on the hard drive and be

577
00:19:45,760 --> 00:19:47,360
able to understand exactly what they're

578
00:19:47,360 --> 00:19:48,880
doing and

579
00:19:48,880 --> 00:19:51,280
while extremely rare i have seen plenty

580
00:19:51,280 --> 00:19:53,679
of times where um an

581
00:19:53,679 --> 00:19:55,919
attacker will use some sort of bitwise

582
00:19:55,919 --> 00:19:58,400
operation and will shift the columns or

583
00:19:58,400 --> 00:20:00,400
we'll will make some tiny change to a

584
00:20:00,400 --> 00:20:02,960
header so it's not as obvious what the

585
00:20:02,960 --> 00:20:05,440
file is where or why it's there they

586
00:20:05,440 --> 00:20:07,679
they may even do some sort of bit wise

587
00:20:07,679 --> 00:20:09,520
always uh encryption using just simple

588
00:20:09,520 --> 00:20:11,520
xor that would make it even harder to

589
00:20:11,520 --> 00:20:13,679
understand exactly what we're reading so

590
00:20:13,679 --> 00:20:16,000
hex editor is one of your best friends

591
00:20:16,000 --> 00:20:18,159
and once we have this information we can

592
00:20:18,159 --> 00:20:19,520
come back and process and understand

593
00:20:19,520 --> 00:20:20,960
what's going on

594
00:20:20,960 --> 00:20:24,080
file carving i do like this this is this

595
00:20:24,080 --> 00:20:26,960
is the image that you see here is a

596
00:20:26,960 --> 00:20:29,039
sector map so it basically gives me

597
00:20:29,039 --> 00:20:30,720
excuse me a cluster map a little bit

598
00:20:30,720 --> 00:20:31,679
different but

599
00:20:31,679 --> 00:20:33,679
it is all the storage information that

600
00:20:33,679 --> 00:20:34,640
we see

601
00:20:34,640 --> 00:20:37,120
graphically on a

602
00:20:37,120 --> 00:20:40,640
on an ssd it's 232 gigs for those that

603
00:20:40,640 --> 00:20:42,240
i'm sure it's hard to read up there but

604
00:20:42,240 --> 00:20:43,679
there's a ton of information here even

605
00:20:43,679 --> 00:20:45,280
though this drive is white this drive

606
00:20:45,280 --> 00:20:46,720
was quick white

607
00:20:46,720 --> 00:20:47,919
for those that don't know with a quick

608
00:20:47,919 --> 00:20:49,760
wipe quick wipe uh if we're talking in

609
00:20:49,760 --> 00:20:52,159
the windows ecosystem only wipes the

610
00:20:52,159 --> 00:20:53,679
first three thousand sectors and the

611
00:20:53,679 --> 00:20:55,440
last three thousand sectors all the data

612
00:20:55,440 --> 00:20:57,760
is still there so i can use a file carve

613
00:20:57,760 --> 00:20:59,919
so you'll actually go to the system it

614
00:20:59,919 --> 00:21:02,559
will go to the drive and it looks and it

615
00:21:02,559 --> 00:21:03,360
looks

616
00:21:03,360 --> 00:21:05,760
thank you and it looks blank

617
00:21:05,760 --> 00:21:07,600
looks like nothing is there

618
00:21:07,600 --> 00:21:08,559
thank you

619
00:21:08,559 --> 00:21:09,840
um

620
00:21:09,840 --> 00:21:11,919
so

621
00:21:11,919 --> 00:21:13,440
you won't be able to see it because it's

622
00:21:13,440 --> 00:21:15,520
not in the master file table record if

623
00:21:15,520 --> 00:21:17,520
we're working in the windows ecosystem

624
00:21:17,520 --> 00:21:20,000
but the data is still there we can use

625
00:21:20,000 --> 00:21:22,320
file carving to actually do a sector by

626
00:21:22,320 --> 00:21:25,120
sector scan and figure out based on the

627
00:21:25,120 --> 00:21:27,760
information that's that's there

628
00:21:27,760 --> 00:21:29,440
well maybe the file headers and be able

629
00:21:29,440 --> 00:21:31,760
to understand where the files exist how

630
00:21:31,760 --> 00:21:34,799
many sectors those files are of course

631
00:21:34,799 --> 00:21:36,320
when you talk about fragmentation this

632
00:21:36,320 --> 00:21:38,480
gets even weirder so that's why the

633
00:21:38,480 --> 00:21:39,760
those file table records are so

634
00:21:39,760 --> 00:21:40,720
important

635
00:21:40,720 --> 00:21:42,720
also file carving is a way that we can

636
00:21:42,720 --> 00:21:45,360
use to prove if disks are actually

637
00:21:45,360 --> 00:21:47,520
cleansed so what we saw was a quick wipe

638
00:21:47,520 --> 00:21:49,280
a moment ago this is a full wipe there's

639
00:21:49,280 --> 00:21:51,200
still technically information on there

640
00:21:51,200 --> 00:21:53,679
we still have a couple pieces written to

641
00:21:53,679 --> 00:21:55,360
some of those sectors such as master

642
00:21:55,360 --> 00:21:56,720
file table

643
00:21:56,720 --> 00:21:58,400
a record that you guys can see below

644
00:21:58,400 --> 00:22:01,039
ntfs log files just some basic

645
00:22:01,039 --> 00:22:02,320
information but there's very little

646
00:22:02,320 --> 00:22:03,520
information

647
00:22:03,520 --> 00:22:06,880
inside a fully wiped drive now

648
00:22:06,880 --> 00:22:08,720
there are some very interesting ways to

649
00:22:08,720 --> 00:22:11,039
do recovery processes on a fully wiped

650
00:22:11,039 --> 00:22:12,799
obviously there are systems that do

651
00:22:12,799 --> 00:22:14,559
multiple passes but that's not not what

652
00:22:14,559 --> 00:22:16,240
we're here to talk about today

653
00:22:16,240 --> 00:22:19,280
some of our other more advanced tactics

654
00:22:19,280 --> 00:22:20,720
sometimes we want to go look at page

655
00:22:20,720 --> 00:22:23,120
files swap space memory dumps that's a

656
00:22:23,120 --> 00:22:24,480
it's not on the slide here but memory

657
00:22:24,480 --> 00:22:26,960
dumps are a gold mine we can find so

658
00:22:26,960 --> 00:22:28,720
much but what are the chances that

659
00:22:28,720 --> 00:22:30,240
there's going to be a memory dump at the

660
00:22:30,240 --> 00:22:31,520
same time

661
00:22:31,520 --> 00:22:33,679
that there's an intrusion

662
00:22:33,679 --> 00:22:36,240
it's very low chance but memory dumps

663
00:22:36,240 --> 00:22:38,480
have huge amounts of information that we

664
00:22:38,480 --> 00:22:41,679
can be able to pull from so uh also

665
00:22:41,679 --> 00:22:43,520
instead of uh just pulling from a memory

666
00:22:43,520 --> 00:22:44,880
dump let's say the system is still live

667
00:22:44,880 --> 00:22:46,320
it's still booted it's still lit

668
00:22:46,320 --> 00:22:47,919
listening applications still running

669
00:22:47,919 --> 00:22:49,440
well we may want to do a live capture

670
00:22:49,440 --> 00:22:51,120
and be able to pool

671
00:22:51,120 --> 00:22:52,960
actually do our own memory dump to be

672
00:22:52,960 --> 00:22:54,720
able to pull everything that's there be

673
00:22:54,720 --> 00:22:56,960
able to grab what's in memory

674
00:22:56,960 --> 00:22:59,360
it's very rare but in some cases you can

675
00:22:59,360 --> 00:23:01,520
even take that memory you can

676
00:23:01,520 --> 00:23:04,320
freeze it with liquid nitrogen and take

677
00:23:04,320 --> 00:23:06,720
it away it's a very delicate process but

678
00:23:06,720 --> 00:23:09,280
you can actually capture the information

679
00:23:09,280 --> 00:23:11,200
that's still on the uh the memory sticks

680
00:23:11,200 --> 00:23:12,559
and be able to pull that

681
00:23:12,559 --> 00:23:14,640
we do oftentimes look at slack space and

682
00:23:14,640 --> 00:23:16,480
unallocated space but these are for more

683
00:23:16,480 --> 00:23:18,240
sophisticated attackers they're the ones

684
00:23:18,240 --> 00:23:20,159
that are trying to hide their tracks or

685
00:23:20,159 --> 00:23:23,039
maybe hiding things in the inodes or or

686
00:23:23,039 --> 00:23:25,520
the file ids depending on the system

687
00:23:25,520 --> 00:23:26,880
you can hide information all over the

688
00:23:26,880 --> 00:23:29,919
place and one of the places especially

689
00:23:29,919 --> 00:23:32,480
on windows systems that uh that seem to

690
00:23:32,480 --> 00:23:34,720
always be forgotten is if a full day

691
00:23:34,720 --> 00:23:36,240
passes

692
00:23:36,240 --> 00:23:38,400
or you know it strikes 12 or depending

693
00:23:38,400 --> 00:23:40,000
on whenever you have your

694
00:23:40,000 --> 00:23:41,840
shadow copies configured

695
00:23:41,840 --> 00:23:43,360
oftentimes by default they just run at

696
00:23:43,360 --> 00:23:45,360
night so you can pull information out of

697
00:23:45,360 --> 00:23:48,559
the shadow copies and

698
00:23:48,799 --> 00:23:50,799
fortunately uh most attackers seem to

699
00:23:50,799 --> 00:23:52,799
forget about shadow copies they don't do

700
00:23:52,799 --> 00:23:54,799
anything to try to cleanse uh cleanse

701
00:23:54,799 --> 00:23:56,400
away the shadow copies so you may not

702
00:23:56,400 --> 00:23:58,320
have the evidence directly on the disk

703
00:23:58,320 --> 00:24:00,240
but it's all hiding in the shadow copy

704
00:24:00,240 --> 00:24:02,000
or maybe it's located in the backups and

705
00:24:02,000 --> 00:24:03,600
you have to be able to mount the backups

706
00:24:03,600 --> 00:24:05,360
and be able to have perform a full

707
00:24:05,360 --> 00:24:07,600
exhaustive search of that

708
00:24:07,600 --> 00:24:09,520
and then finally there's the report this

709
00:24:09,520 --> 00:24:11,600
is the part that nobody likes doing

710
00:24:11,600 --> 00:24:13,120
but this is where you have to come back

711
00:24:13,120 --> 00:24:14,240
you have to hit those must answer

712
00:24:14,240 --> 00:24:16,640
questions your report is going to live

713
00:24:16,640 --> 00:24:19,360
beyond you when you turn in the report

714
00:24:19,360 --> 00:24:22,000
to to the client or to uh the company

715
00:24:22,000 --> 00:24:23,520
that you work for when you give them the

716
00:24:23,520 --> 00:24:25,520
report that information

717
00:24:25,520 --> 00:24:27,360
leaves you you aren't going to be there

718
00:24:27,360 --> 00:24:29,200
to defend it it's going to go in front

719
00:24:29,200 --> 00:24:31,600
of boards it might even make its way in

720
00:24:31,600 --> 00:24:34,480
front of law enforcement and i've had

721
00:24:34,480 --> 00:24:36,320
several reports that made into the hands

722
00:24:36,320 --> 00:24:39,600
of the fbi and at this point

723
00:24:39,600 --> 00:24:41,200
you're not there if you made a mistake

724
00:24:41,200 --> 00:24:42,480
in the report it's going to reflect back

725
00:24:42,480 --> 00:24:44,720
on you if you missed something it's

726
00:24:44,720 --> 00:24:46,320
again going to reflect back on you this

727
00:24:46,320 --> 00:24:48,640
is the perfect opportunity for you

728
00:24:48,640 --> 00:24:50,480
to really it's almost like a little

729
00:24:50,480 --> 00:24:52,159
resume you are creating a resume for

730
00:24:52,159 --> 00:24:53,919
yourself every time you generate one of

731
00:24:53,919 --> 00:24:55,679
these reports because you want to be as

732
00:24:55,679 --> 00:24:58,240
accurate as possible and

733
00:24:58,240 --> 00:25:00,080
be able to provide the necessary

734
00:25:00,080 --> 00:25:01,679
guidance to an organization to be able

735
00:25:01,679 --> 00:25:03,200
to recover from that

736
00:25:03,200 --> 00:25:04,480
okay

737
00:25:04,480 --> 00:25:05,520
so

738
00:25:05,520 --> 00:25:06,480
last couple slides and then we're going

739
00:25:06,480 --> 00:25:08,960
to jump into the into the actual

740
00:25:08,960 --> 00:25:12,000
um demonstration so anti-forensics

741
00:25:12,000 --> 00:25:14,559
these are pretty uncommon with exception

742
00:25:14,559 --> 00:25:16,640
of time stamps i do see time stomping

743
00:25:16,640 --> 00:25:19,200
quite often um where an attacker will

744
00:25:19,200 --> 00:25:21,520
change the clock and then perform their

745
00:25:21,520 --> 00:25:23,679
actions and then change it back so it

746
00:25:23,679 --> 00:25:25,039
does get a little confusing especially

747
00:25:25,039 --> 00:25:26,159
when you're trying to build a timeline

748
00:25:26,159 --> 00:25:28,799
to understand exactly what happened so

749
00:25:28,799 --> 00:25:30,960
time stamps probably the most common

750
00:25:30,960 --> 00:25:33,120
stenography this is the act of hiding

751
00:25:33,120 --> 00:25:35,520
information inside of other information

752
00:25:35,520 --> 00:25:37,440
most attackers don't have time to do

753
00:25:37,440 --> 00:25:39,279
something like this but if they do

754
00:25:39,279 --> 00:25:41,120
often times they're using some very

755
00:25:41,120 --> 00:25:42,799
generic ways of doing that they're going

756
00:25:42,799 --> 00:25:44,960
to find a tool that exists

757
00:25:44,960 --> 00:25:46,880
that maybe use for example least

758
00:25:46,880 --> 00:25:50,240
significant bit so if you have a image

759
00:25:50,240 --> 00:25:51,039
and

760
00:25:51,039 --> 00:25:53,200
every pixel let's use a bitmap as an

761
00:25:53,200 --> 00:25:55,360
example every pixel has a byte of

762
00:25:55,360 --> 00:25:57,039
information that is that is configured

763
00:25:57,039 --> 00:25:59,120
for that and in that byte you can change

764
00:25:59,120 --> 00:26:01,200
the least significant bit meaning

765
00:26:01,200 --> 00:26:03,840
instead of 255 for red

766
00:26:03,840 --> 00:26:07,200
you can do 254 for red and at that point

767
00:26:07,200 --> 00:26:09,360
that we know that there's

768
00:26:09,360 --> 00:26:11,919
we can see that that small change and we

769
00:26:11,919 --> 00:26:13,440
can extract that information be able to

770
00:26:13,440 --> 00:26:14,720
have a better understanding of exactly

771
00:26:14,720 --> 00:26:16,880
what they did and unfortunately well

772
00:26:16,880 --> 00:26:18,640
fortunately i should say attackers don't

773
00:26:18,640 --> 00:26:21,200
spend a whole lot of time uh trying to

774
00:26:21,200 --> 00:26:23,200
hide their steps especially using these

775
00:26:23,200 --> 00:26:27,039
anti-forensic processes what we do see

776
00:26:27,039 --> 00:26:29,440
on occasion are encryption on payloads

777
00:26:29,440 --> 00:26:31,279
that's a pretty common piece that

778
00:26:31,279 --> 00:26:32,559
they're trying to hide their

779
00:26:32,559 --> 00:26:34,720
communication they're trying to not

780
00:26:34,720 --> 00:26:38,720
alert whatever xdr av whatever acronym

781
00:26:38,720 --> 00:26:39,679
you want to throw out there they're

782
00:26:39,679 --> 00:26:41,840
trying to fly under the radar and so

783
00:26:41,840 --> 00:26:44,080
encryption does help with that that

784
00:26:44,080 --> 00:26:45,679
process but once it's on the system

785
00:26:45,679 --> 00:26:47,520
unless we're talking about ransomware

786
00:26:47,520 --> 00:26:49,919
very rarely is the actual payloads or

787
00:26:49,919 --> 00:26:52,080
actual tools that get loaded on a system

788
00:26:52,080 --> 00:26:54,159
do they get encrypted

789
00:26:54,159 --> 00:26:56,559
onion routing so tor dark web whatever

790
00:26:56,559 --> 00:26:57,760
you want to call it

791
00:26:57,760 --> 00:27:00,080
that oftentimes we do see we do see

792
00:27:00,080 --> 00:27:01,760
communication going through onion

793
00:27:01,760 --> 00:27:03,440
routing that does make it more difficult

794
00:27:03,440 --> 00:27:05,440
to figure out the origin of the attack

795
00:27:05,440 --> 00:27:06,880
and so it's just a piece that we need to

796
00:27:06,880 --> 00:27:08,320
be aware of

797
00:27:08,320 --> 00:27:10,080
overriding data is an excellent way to

798
00:27:10,080 --> 00:27:11,919
hide your tracks so we talked about

799
00:27:11,919 --> 00:27:13,440
deleting files well

800
00:27:13,440 --> 00:27:15,039
it's actually better instead of deleting

801
00:27:15,039 --> 00:27:17,120
files of just overwrite them put some

802
00:27:17,120 --> 00:27:18,399
other information in there once you're

803
00:27:18,399 --> 00:27:19,760
done with them and then we can't make

804
00:27:19,760 --> 00:27:21,120
sense of what you were doing we can see

805
00:27:21,120 --> 00:27:23,360
the time we can see the file ids we can

806
00:27:23,360 --> 00:27:25,200
see the time stamps we can make sense of

807
00:27:25,200 --> 00:27:27,200
what's going on

808
00:27:27,200 --> 00:27:28,960
on rare occasion we also see program

809
00:27:28,960 --> 00:27:31,360
packers so for example taking executable

810
00:27:31,360 --> 00:27:33,039
and hiding other information within

811
00:27:33,039 --> 00:27:35,919
within that you can package those up

812
00:27:35,919 --> 00:27:37,679
so we do see that sometimes they're

813
00:27:37,679 --> 00:27:39,279
hidden in there and you can do an

814
00:27:39,279 --> 00:27:40,640
examination of

815
00:27:40,640 --> 00:27:41,760
executable and have a better

816
00:27:41,760 --> 00:27:43,360
understanding of what's going on

817
00:27:43,360 --> 00:27:45,760
memory droppers are hard to find very

818
00:27:45,760 --> 00:27:48,000
hard to find for those that are familiar

819
00:27:48,000 --> 00:27:49,840
with what happened with solarwinds there

820
00:27:49,840 --> 00:27:51,520
were memory droppers all over the place

821
00:27:51,520 --> 00:27:53,600
this is how a lot of these attacks

822
00:27:53,600 --> 00:27:54,720
did occur

823
00:27:54,720 --> 00:27:56,159
not the initial attack we're talking

824
00:27:56,159 --> 00:27:57,679
about the subsequent attacks once they

825
00:27:57,679 --> 00:27:59,520
actually had access they used memory

826
00:27:59,520 --> 00:28:01,520
droppers to be able to pull tools into

827
00:28:01,520 --> 00:28:03,440
the environment operate in memory and

828
00:28:03,440 --> 00:28:05,200
then exit and this is why volatile

829
00:28:05,200 --> 00:28:07,760
memory volatile evidence needs to be

830
00:28:07,760 --> 00:28:09,600
preserved as much as possible so if an

831
00:28:09,600 --> 00:28:12,240
instant responder comes by and reboots

832
00:28:12,240 --> 00:28:14,399
it's gone sorry not a whole lot you can

833
00:28:14,399 --> 00:28:17,440
do then uh optification it's kind of

834
00:28:17,440 --> 00:28:19,200
like encryption but it's just taking i

835
00:28:19,200 --> 00:28:21,360
don't know let's take let's take a um

836
00:28:21,360 --> 00:28:22,020
applica

837
00:28:22,020 --> 00:28:23,120
[Music]

838
00:28:23,120 --> 00:28:24,480
aspx

839
00:28:24,480 --> 00:28:25,600
web shell which we're actually going to

840
00:28:25,600 --> 00:28:27,200
look at here in a little bit

841
00:28:27,200 --> 00:28:29,200
so that web shell

842
00:28:29,200 --> 00:28:31,039
you can obstruct it and the whole the

843
00:28:31,039 --> 00:28:32,799
whole point is just to make it harder to

844
00:28:32,799 --> 00:28:34,399
be able to

845
00:28:34,399 --> 00:28:36,640
to understand unpack what exactly

846
00:28:36,640 --> 00:28:38,799
occurred on that system and have a

847
00:28:38,799 --> 00:28:41,039
better understanding of what the payload

848
00:28:41,039 --> 00:28:42,559
is trying to do

849
00:28:42,559 --> 00:28:44,799
and then uh digital signatures uh this

850
00:28:44,799 --> 00:28:46,559
is a pretty common piece we also saw

851
00:28:46,559 --> 00:28:49,120
this in solarwinds where once you have a

852
00:28:49,120 --> 00:28:50,799
payload on a system once you have that

853
00:28:50,799 --> 00:28:52,559
executable that

854
00:28:52,559 --> 00:28:54,480
you want it to fly under the radar and

855
00:28:54,480 --> 00:28:55,679
one of the best ways of doing that

856
00:28:55,679 --> 00:28:57,200
nowadays especially

857
00:28:57,200 --> 00:28:58,399
as we're getting better and better

858
00:28:58,399 --> 00:28:59,840
application

859
00:28:59,840 --> 00:29:02,559
protections is to sign it if you have

860
00:29:02,559 --> 00:29:05,279
access to the internal ca of the

861
00:29:05,279 --> 00:29:06,960
as an attacker if you have access to

862
00:29:06,960 --> 00:29:09,120
internal ca you can use that information

863
00:29:09,120 --> 00:29:12,000
to sign your packages to sign what you

864
00:29:12,000 --> 00:29:13,200
have and be able to hide your

865
00:29:13,200 --> 00:29:14,559
information

866
00:29:14,559 --> 00:29:16,240
okay so we're going to attempt the demo

867
00:29:16,240 --> 00:29:20,760
gods here so give me one sec

868
00:29:26,080 --> 00:29:29,199
and yes that was mr bean

869
00:29:30,880 --> 00:29:34,120
all right

870
00:29:40,320 --> 00:29:41,600
okay

871
00:29:41,600 --> 00:29:42,960
not a big deal

872
00:29:42,960 --> 00:29:45,679
there's a notebook upstairs could you

873
00:29:45,679 --> 00:29:46,640
there's actually two of them can you

874
00:29:46,640 --> 00:29:48,960
grab both of those please

875
00:29:48,960 --> 00:29:51,679
yes yes thank you okay not a big deal i

876
00:29:51,679 --> 00:29:53,440
just have a couple notes for myself

877
00:29:53,440 --> 00:29:55,440
well we we we're doing an examination i

878
00:29:55,440 --> 00:29:56,799
do have a couple spots i wanted us to

879
00:29:56,799 --> 00:29:57,919
look at if we were doing a full

880
00:29:57,919 --> 00:29:59,600
examination this would take us hours to

881
00:29:59,600 --> 00:30:00,559
days

882
00:30:00,559 --> 00:30:01,919
and i really want to get to some of the

883
00:30:01,919 --> 00:30:04,559
hot spots as quickly as possible

884
00:30:04,559 --> 00:30:07,120
all right so we have a tool up here this

885
00:30:07,120 --> 00:30:08,720
is a graphical tool there's a ton of

886
00:30:08,720 --> 00:30:12,159
tools that um that live in the windows

887
00:30:12,159 --> 00:30:14,080
or the linux ecosystems

888
00:30:14,080 --> 00:30:16,159
that oftentimes will use i'm using a

889
00:30:16,159 --> 00:30:17,360
graphical tool

890
00:30:17,360 --> 00:30:18,880
for your benefits so we can have a

891
00:30:18,880 --> 00:30:20,159
better understanding of exactly what's

892
00:30:20,159 --> 00:30:22,880
happening but oftentimes we do use a lot

893
00:30:22,880 --> 00:30:24,960
of more advanced tools i just wanted you

894
00:30:24,960 --> 00:30:26,240
to be able to see this information so

895
00:30:26,240 --> 00:30:27,840
we're going to create a case and we're

896
00:30:27,840 --> 00:30:29,360
going to call it

897
00:30:29,360 --> 00:30:32,080
rva sec it doesn't matter we can provide

898
00:30:32,080 --> 00:30:33,679
other information in here

899
00:30:33,679 --> 00:30:34,720
and

900
00:30:34,720 --> 00:30:36,399
in this particular tool we've created a

901
00:30:36,399 --> 00:30:38,480
case so now what we're going to do is

902
00:30:38,480 --> 00:30:40,320
we're going to add a device

903
00:30:40,320 --> 00:30:42,000
and we already have an image file

904
00:30:42,000 --> 00:30:43,840
remember how we we had the system that

905
00:30:43,840 --> 00:30:46,320
bob has created we're going to go load

906
00:30:46,320 --> 00:30:48,559
that that location

907
00:30:48,559 --> 00:30:49,600
okay

908
00:30:49,600 --> 00:30:51,360
i might want to go back one sec for

909
00:30:51,360 --> 00:30:53,520
those looking at this this is a windows

910
00:30:53,520 --> 00:30:56,480
2016 server that has a piece of software

911
00:30:56,480 --> 00:30:58,720
on it called gfi archiver

912
00:30:58,720 --> 00:31:00,880
gfi archiver has a known vulnerability

913
00:31:00,880 --> 00:31:02,720
on the system right now it's actually

914
00:31:02,720 --> 00:31:04,880
been around since 2018 but the gfi

915
00:31:04,880 --> 00:31:06,880
software was written this year so this

916
00:31:06,880 --> 00:31:09,039
is a known problem uh it has yet to be

917
00:31:09,039 --> 00:31:10,960
patched so if you are using gfir

918
00:31:10,960 --> 00:31:14,720
archiver i'd recommend that you don't

919
00:31:15,760 --> 00:31:18,320
all right so we we have a full disk

920
00:31:18,320 --> 00:31:20,159
image that includes partitioning

921
00:31:20,159 --> 00:31:22,320
information so we do have a boot

922
00:31:22,320 --> 00:31:24,799
partition uh very simple windows does

923
00:31:24,799 --> 00:31:26,159
that for you automatically and then we

924
00:31:26,159 --> 00:31:27,519
have the partition with data so we're

925
00:31:27,519 --> 00:31:28,880
only going to load one of the partitions

926
00:31:28,880 --> 00:31:30,559
i could mount the entire image but i

927
00:31:30,559 --> 00:31:33,039
want to focus on the second partition

928
00:31:33,039 --> 00:31:34,320
with

929
00:31:34,320 --> 00:31:37,519
about 80 gigabytes of information

930
00:31:37,519 --> 00:31:38,720
okay

931
00:31:38,720 --> 00:31:40,399
so now now that we actually have it

932
00:31:40,399 --> 00:31:42,080
loaded we have our

933
00:31:42,080 --> 00:31:44,159
our image loaded into our software we

934
00:31:44,159 --> 00:31:46,480
can start doing some analysis now

935
00:31:46,480 --> 00:31:47,600
oftentimes

936
00:31:47,600 --> 00:31:50,320
we're we run ingestion modules uh so for

937
00:31:50,320 --> 00:31:51,679
those familiar with

938
00:31:51,679 --> 00:31:54,799
sleuthkit or autopsy that they generally

939
00:31:54,799 --> 00:31:56,080
call them uh

940
00:31:56,080 --> 00:31:57,760
ingestion modules and what i mean by

941
00:31:57,760 --> 00:31:59,519
this is that

942
00:31:59,519 --> 00:32:01,440
for example we may want to come through

943
00:32:01,440 --> 00:32:03,600
and index every single file on the

944
00:32:03,600 --> 00:32:06,480
system and be able to understand

945
00:32:06,480 --> 00:32:07,440
where

946
00:32:07,440 --> 00:32:09,360
keywords are so it allows us to do

947
00:32:09,360 --> 00:32:11,120
keyword searches there's a ton of other

948
00:32:11,120 --> 00:32:12,799
tools especially the timeline it does

949
00:32:12,799 --> 00:32:14,480
take a while to be able to produce that

950
00:32:14,480 --> 00:32:18,080
timeline so what we are going to do

951
00:32:18,080 --> 00:32:20,159
we are going to go ahead and run a user

952
00:32:20,159 --> 00:32:21,600
activity which is basically a timeline

953
00:32:21,600 --> 00:32:22,399
view

954
00:32:22,399 --> 00:32:23,679
different tools call it different things

955
00:32:23,679 --> 00:32:25,840
but they are generally

956
00:32:25,840 --> 00:32:28,080
performing the same actions so what we

957
00:32:28,080 --> 00:32:29,519
have here and i knew this was going to

958
00:32:29,519 --> 00:32:30,799
be a problem

959
00:32:30,799 --> 00:32:34,879
on the smaller resolution

960
00:32:35,039 --> 00:32:36,799
is i can't get to the button but that's

961
00:32:36,799 --> 00:32:37,760
okay

962
00:32:37,760 --> 00:32:39,279
so

963
00:32:39,279 --> 00:32:41,120
so um this is going to look for

964
00:32:41,120 --> 00:32:42,559
operating system artifacts internet

965
00:32:42,559 --> 00:32:43,919
artifacts it's going to pull a bunch of

966
00:32:43,919 --> 00:32:45,600
information and these are just common

967
00:32:45,600 --> 00:32:48,000
spots in windows where you would want to

968
00:32:48,000 --> 00:32:50,399
look on a system that you think some

969
00:32:50,399 --> 00:32:52,000
that some sort of crime some sort of

970
00:32:52,000 --> 00:32:53,679
intrusion has occurred that you want to

971
00:32:53,679 --> 00:32:54,880
be able to pull this information it's

972
00:32:54,880 --> 00:32:56,399
going to give a ton more information on

973
00:32:56,399 --> 00:32:58,399
the system so we're not going to

974
00:32:58,399 --> 00:32:59,679
configure anything it's already set to

975
00:32:59,679 --> 00:33:01,039
defaults and what we're going to do is

976
00:33:01,039 --> 00:33:02,240
just a quick scan so we're not going to

977
00:33:02,240 --> 00:33:05,200
do a deep in-depth scan on this

978
00:33:05,200 --> 00:33:08,440
thank you

979
00:33:12,000 --> 00:33:13,440
all right

980
00:33:13,440 --> 00:33:15,679
just takes a moment

981
00:33:15,679 --> 00:33:19,120
perfect okay so these were common spots

982
00:33:19,120 --> 00:33:20,000
now

983
00:33:20,000 --> 00:33:22,240
these are we are looking in common

984
00:33:22,240 --> 00:33:24,720
places for common problems

985
00:33:24,720 --> 00:33:26,240
that we might be able to find so looking

986
00:33:26,240 --> 00:33:27,760
in the recycle bin we're looking at

987
00:33:27,760 --> 00:33:29,760
downloads we're looking at the event log

988
00:33:29,760 --> 00:33:31,760
there's so many other places we could be

989
00:33:31,760 --> 00:33:33,919
looking at but

990
00:33:33,919 --> 00:33:36,240
a quick examination for example that

991
00:33:36,240 --> 00:33:38,080
client uh the hospital that was wanting

992
00:33:38,080 --> 00:33:39,840
to know how long are they going to be

993
00:33:39,840 --> 00:33:41,760
down this is a way that i can start

994
00:33:41,760 --> 00:33:43,679
feeding them information faster they

995
00:33:43,679 --> 00:33:46,000
don't like the answer i don't know we're

996
00:33:46,000 --> 00:33:47,600
investigating so there are ways to

997
00:33:47,600 --> 00:33:49,279
shortcut some of your some of your

998
00:33:49,279 --> 00:33:51,120
pieces

999
00:33:51,120 --> 00:33:54,159
all right so what we have here is a

1000
00:33:54,159 --> 00:33:56,159
timeline of events

1001
00:33:56,159 --> 00:33:58,880
and what we're going to do is

1002
00:33:58,880 --> 00:34:01,440
we have

1003
00:34:01,519 --> 00:34:03,440
some different events here

1004
00:34:03,440 --> 00:34:05,360
and so we have some failed logons we

1005
00:34:05,360 --> 00:34:06,559
have

1006
00:34:06,559 --> 00:34:07,919
login

1007
00:34:07,919 --> 00:34:09,760
using let's take a look at this one now

1008
00:34:09,760 --> 00:34:12,000
this one may be a little hard to read we

1009
00:34:12,000 --> 00:34:14,159
have logins using

1010
00:34:14,159 --> 00:34:16,639
explicit credentials does anybody know

1011
00:34:16,639 --> 00:34:17,839
what we're talking about when we're

1012
00:34:17,839 --> 00:34:21,719
using explicit credentials

1013
00:34:23,280 --> 00:34:25,440
the f word

1014
00:34:25,440 --> 00:34:28,079
no explicit credentials are uh generally

1015
00:34:28,079 --> 00:34:30,480
any time that we have a service with

1016
00:34:30,480 --> 00:34:32,079
credentials set

1017
00:34:32,079 --> 00:34:34,719
that that service needs to run with

1018
00:34:34,719 --> 00:34:36,320
those very explicit credentials you'll

1019
00:34:36,320 --> 00:34:38,000
also see this with scripts you'll see

1020
00:34:38,000 --> 00:34:39,440
this with scheduled tasks again we're in

1021
00:34:39,440 --> 00:34:40,800
the windows ecosystem so you're going to

1022
00:34:40,800 --> 00:34:41,918
see these spots where we're going to

1023
00:34:41,918 --> 00:34:43,040
have

1024
00:34:43,040 --> 00:34:44,480
very specific events that are coming

1025
00:34:44,480 --> 00:34:45,839
through

1026
00:34:45,839 --> 00:34:46,879
all right

1027
00:34:46,879 --> 00:34:51,440
so uh we can also jump to

1028
00:34:52,800 --> 00:34:55,040
give me one moment okay we've got a lot

1029
00:34:55,040 --> 00:34:58,000
of activity going on here okay

1030
00:34:58,000 --> 00:34:59,440
so here we are we're in the timeline

1031
00:34:59,440 --> 00:35:00,240
view

1032
00:35:00,240 --> 00:35:02,800
and what we have is we see that there is

1033
00:35:02,800 --> 00:35:05,119
a couple of weird files getting created

1034
00:35:05,119 --> 00:35:08,800
so we have this reverse.aspx we have

1035
00:35:08,800 --> 00:35:11,599
we have access to the gfi directory uh

1036
00:35:11,599 --> 00:35:14,079
software that is a part of the archive

1037
00:35:14,079 --> 00:35:16,240
service we have you know it looks like

1038
00:35:16,240 --> 00:35:18,160
there's some activity going on in here

1039
00:35:18,160 --> 00:35:19,200
so

1040
00:35:19,200 --> 00:35:21,760
and we have reverse uh aspx we have the

1041
00:35:21,760 --> 00:35:25,119
reverse aspx in the recycle bin ah

1042
00:35:25,119 --> 00:35:27,040
so let's go take a look let's go have a

1043
00:35:27,040 --> 00:35:30,920
look at the recycle bin

1044
00:35:31,280 --> 00:35:34,400
so now what we have here is we have

1045
00:35:34,400 --> 00:35:36,560
the ability to actually examine what's

1046
00:35:36,560 --> 00:35:39,119
inside the image now this does process

1047
00:35:39,119 --> 00:35:41,520
off the mft so if you don't have an mst

1048
00:35:41,520 --> 00:35:43,119
this particular process doesn't work and

1049
00:35:43,119 --> 00:35:44,960
you need to do file carving but since

1050
00:35:44,960 --> 00:35:47,200
the mft is preserved and

1051
00:35:47,200 --> 00:35:48,800
hopefully not too much data is deleted

1052
00:35:48,800 --> 00:35:50,160
we can look at some more of the common

1053
00:35:50,160 --> 00:35:52,480
locations so the mft is still aware of

1054
00:35:52,480 --> 00:35:54,960
deleted items in the recycle bin and it

1055
00:35:54,960 --> 00:35:57,440
includes the file ids so there's two

1056
00:35:57,440 --> 00:35:58,720
different types of file ids here the

1057
00:35:58,720 --> 00:36:00,400
ones that start in i

1058
00:36:00,400 --> 00:36:02,320
will tell you generally where the file

1059
00:36:02,320 --> 00:36:04,720
is the ones that start in r

1060
00:36:04,720 --> 00:36:06,320
will tell you what's inside the file so

1061
00:36:06,320 --> 00:36:08,480
they always end in the same file id so

1062
00:36:08,480 --> 00:36:09,480
2g

1063
00:36:09,480 --> 00:36:12,760
2v48 so there's 2g

1064
00:36:12,760 --> 00:36:14,800
2v48 and we said we have the one that

1065
00:36:14,800 --> 00:36:16,000
starts with an i and one that starts

1066
00:36:16,000 --> 00:36:18,880
with an r so we load the r

1067
00:36:18,880 --> 00:36:20,160
well there's some sort of a file here

1068
00:36:20,160 --> 00:36:22,160
that says you've been pwned so something

1069
00:36:22,160 --> 00:36:23,920
something's going on here so what we can

1070
00:36:23,920 --> 00:36:26,160
do is we can start examining seeing what

1071
00:36:26,160 --> 00:36:28,880
other information is in here

1072
00:36:28,880 --> 00:36:30,720
and we can work our way down so there's

1073
00:36:30,720 --> 00:36:32,240
a couple you've been phones so it looks

1074
00:36:32,240 --> 00:36:34,480
like what they were trying to do is is

1075
00:36:34,480 --> 00:36:36,400
upload some uh some different files just

1076
00:36:36,400 --> 00:36:38,160
to see if it even worked we can see that

1077
00:36:38,160 --> 00:36:41,040
there's an exe here and there's a lot of

1078
00:36:41,040 --> 00:36:42,640
information in here so let's do let's do

1079
00:36:42,640 --> 00:36:44,480
an extraction let's see if we can have a

1080
00:36:44,480 --> 00:36:46,240
better idea of what's going on in here

1081
00:36:46,240 --> 00:36:48,960
now when you find exes or any kind of

1082
00:36:48,960 --> 00:36:51,359
like l file or or or binary file that

1083
00:36:51,359 --> 00:36:52,800
you may want to uh have a better

1084
00:36:52,800 --> 00:36:54,960
understanding a dll understanding what

1085
00:36:54,960 --> 00:36:57,119
exactly they're doing sometimes we do

1086
00:36:57,119 --> 00:36:59,119
have to uh run reverse engineering

1087
00:36:59,119 --> 00:37:01,359
processes that one's a hard one in court

1088
00:37:01,359 --> 00:37:02,880
to be able to tell people exactly what

1089
00:37:02,880 --> 00:37:05,280
you did so much harder but we do see

1090
00:37:05,280 --> 00:37:07,119
that there's some some calls going on in

1091
00:37:07,119 --> 00:37:08,800
here there's some different information

1092
00:37:08,800 --> 00:37:10,880
and there's this weird little one

1093
00:37:10,880 --> 00:37:12,320
for those who can't read what it says it

1094
00:37:12,320 --> 00:37:15,280
says payload so there's an exe on the

1095
00:37:15,280 --> 00:37:17,200
system called that has something that's

1096
00:37:17,200 --> 00:37:18,720
referencing a payload we can see it's

1097
00:37:18,720 --> 00:37:20,720
calling the kernel32.dll

1098
00:37:20,720 --> 00:37:22,000
there's there's some weird things going

1099
00:37:22,000 --> 00:37:23,920
in here and without doing a full like

1100
00:37:23,920 --> 00:37:25,920
launching gear to and being able to do a

1101
00:37:25,920 --> 00:37:27,599
full reverse engineering which we

1102
00:37:27,599 --> 00:37:29,440
definitely do not have time for what we

1103
00:37:29,440 --> 00:37:32,000
can also look at is this one is an 87

1104
00:37:32,000 --> 00:37:33,920
here's the one the corresponding

1105
00:37:33,920 --> 00:37:36,400
file id for 87 and we can extract that

1106
00:37:36,400 --> 00:37:38,320
to make sense of it

1107
00:37:38,320 --> 00:37:42,079
c dot program.exe okay so we're starting

1108
00:37:42,079 --> 00:37:43,200
to be able to piece together what

1109
00:37:43,200 --> 00:37:45,040
exactly is happening here

1110
00:37:45,040 --> 00:37:47,680
okay so we also have these aspx files so

1111
00:37:47,680 --> 00:37:49,359
i want to go down and look at the aspx

1112
00:37:49,359 --> 00:37:50,880
files

1113
00:37:50,880 --> 00:37:52,480
okay well

1114
00:37:52,480 --> 00:37:55,599
that looks like a web shell to me

1115
00:37:55,599 --> 00:37:58,800
if we work our way down

1116
00:37:59,599 --> 00:38:02,160
that one is blank and this i think this

1117
00:38:02,160 --> 00:38:03,839
one's yeah that's our big one all right

1118
00:38:03,839 --> 00:38:04,960
so there's a lot going on in here

1119
00:38:04,960 --> 00:38:06,640
there's even shell code going on in here

1120
00:38:06,640 --> 00:38:08,560
so the shell code

1121
00:38:08,560 --> 00:38:10,400
for those that don't know shell code is

1122
00:38:10,400 --> 00:38:13,200
a fun and handy way of being able to to

1123
00:38:13,200 --> 00:38:14,560
write code

1124
00:38:14,560 --> 00:38:16,800
written in a very specific format that

1125
00:38:16,800 --> 00:38:18,400
computers will will be able to

1126
00:38:18,400 --> 00:38:20,000
understand if you're able to process the

1127
00:38:20,000 --> 00:38:23,680
hex code so that's a very brief

1128
00:38:23,680 --> 00:38:25,280
simplified explanation of what shell

1129
00:38:25,280 --> 00:38:28,240
code is but yes we're seeing a an aspx

1130
00:38:28,240 --> 00:38:30,800
file it's loading the kernel 32 we see

1131
00:38:30,800 --> 00:38:33,040
that there's information going on

1132
00:38:33,040 --> 00:38:34,880
and then it's processing this big shell

1133
00:38:34,880 --> 00:38:36,079
code so that's

1134
00:38:36,079 --> 00:38:39,200
that is definitely concerning so let's

1135
00:38:39,200 --> 00:38:41,040
let's do some other couple pieces we

1136
00:38:41,040 --> 00:38:43,440
know bob is an administrator at least

1137
00:38:43,440 --> 00:38:45,760
bob looks like an administrator but

1138
00:38:45,760 --> 00:38:47,040
sometimes when you're doing your

1139
00:38:47,040 --> 00:38:49,520
examination you don't know that maybe

1140
00:38:49,520 --> 00:38:52,320
the responder didn't identify that and

1141
00:38:52,320 --> 00:38:53,760
there are ways of for us to be able to

1142
00:38:53,760 --> 00:38:55,440
figure that out for be able to actually

1143
00:38:55,440 --> 00:38:57,680
understand what exactly occurred so one

1144
00:38:57,680 --> 00:38:59,440
of those pieces is for us to load the

1145
00:38:59,440 --> 00:39:00,640
registry

1146
00:39:00,640 --> 00:39:02,560
again windows ecosystem

1147
00:39:02,560 --> 00:39:04,320
it's a little easier on linux

1148
00:39:04,320 --> 00:39:06,640
but we can load this up and we can start

1149
00:39:06,640 --> 00:39:08,400
working our way through

1150
00:39:08,400 --> 00:39:10,960
the sam file excuse me the sam registry

1151
00:39:10,960 --> 00:39:12,960
hive

1152
00:39:12,960 --> 00:39:15,280
and inside of that we can we can start

1153
00:39:15,280 --> 00:39:16,960
working our way down

1154
00:39:16,960 --> 00:39:18,640
we've got a couple locations that i do

1155
00:39:18,640 --> 00:39:20,480
want to talk about

1156
00:39:20,480 --> 00:39:21,520
so

1157
00:39:21,520 --> 00:39:22,800
we do have

1158
00:39:22,800 --> 00:39:25,920
accounts we have users and we have some

1159
00:39:25,920 --> 00:39:27,440
users so we have some different

1160
00:39:27,440 --> 00:39:29,359
information we also have the names of

1161
00:39:29,359 --> 00:39:32,079
the users and so we have these weird

1162
00:39:32,079 --> 00:39:33,839
numbers here not letters and numbers

1163
00:39:33,839 --> 00:39:34,640
here

1164
00:39:34,640 --> 00:39:36,960
for those that don't know that's just

1165
00:39:36,960 --> 00:39:38,880
simple hexadecimal and so what we can do

1166
00:39:38,880 --> 00:39:40,560
is we can look at the administrator so

1167
00:39:40,560 --> 00:39:43,359
we can just load up our calculator

1168
00:39:43,359 --> 00:39:45,359
and we will

1169
00:39:45,359 --> 00:39:47,119
make that a little smaller and we're

1170
00:39:47,119 --> 00:39:49,440
going to type in 500.

1171
00:39:49,440 --> 00:39:50,960
okay so 500

1172
00:39:50,960 --> 00:39:52,240
this may be a little hard to read but in

1173
00:39:52,240 --> 00:39:54,880
hex 500 is one f4

1174
00:39:54,880 --> 00:39:58,160
there is one f4 so we know

1175
00:39:58,160 --> 00:39:59,599
the administrator which always has the

1176
00:39:59,599 --> 00:40:03,119
sid of uh well specifically the id

1177
00:40:03,119 --> 00:40:05,440
of 500 and we can see

1178
00:40:05,440 --> 00:40:07,280
that one f4 is right here so what we can

1179
00:40:07,280 --> 00:40:09,760
also do is we can look at bob so bob has

1180
00:40:09,760 --> 00:40:11,280
1002

1181
00:40:11,280 --> 00:40:13,040
so 1002

1182
00:40:13,040 --> 00:40:15,599
we can see that's 3 e a

1183
00:40:15,599 --> 00:40:18,319
so we have 3 e a right there

1184
00:40:18,319 --> 00:40:20,160
we also have a couple others there is

1185
00:40:20,160 --> 00:40:21,839
one here that is sitting that doesn't

1186
00:40:21,839 --> 00:40:22,880
quite

1187
00:40:22,880 --> 00:40:24,960
it's not a default built-in account or

1188
00:40:24,960 --> 00:40:26,880
anything called the gfi directory

1189
00:40:26,880 --> 00:40:28,720
account directory excuse me directory

1190
00:40:28,720 --> 00:40:31,839
admin and we'd see that one has a

1191
00:40:31,839 --> 00:40:33,920
id of a thousand so if we put in a

1192
00:40:33,920 --> 00:40:34,880
thousand

1193
00:40:34,880 --> 00:40:37,040
there's a very simple

1194
00:40:37,040 --> 00:40:38,560
way of uh converting that to hex we see

1195
00:40:38,560 --> 00:40:41,359
three e8 we have three e8 there so we

1196
00:40:41,359 --> 00:40:42,720
know that there's some other information

1197
00:40:42,720 --> 00:40:44,880
we can even see um the flags that are

1198
00:40:44,880 --> 00:40:46,960
set on the account whether that if the

1199
00:40:46,960 --> 00:40:49,200
password needs to be changed whether um

1200
00:40:49,200 --> 00:40:50,640
the password never expires we can see a

1201
00:40:50,640 --> 00:40:53,040
bunch of information like that

1202
00:40:53,040 --> 00:40:54,960
so there's other spots that we can go we

1203
00:40:54,960 --> 00:40:57,040
can go and look in

1204
00:40:57,040 --> 00:40:59,520
let's see

1205
00:40:59,599 --> 00:41:01,680
all right so let's look at built in

1206
00:41:01,680 --> 00:41:04,160
let's look at aliases and let's go down

1207
00:41:04,160 --> 00:41:05,599
to members

1208
00:41:05,599 --> 00:41:07,760
okay so now we have an s id

1209
00:41:07,760 --> 00:41:10,079
here and so this is an sid for a group a

1210
00:41:10,079 --> 00:41:11,599
built in group and we can see that

1211
00:41:11,599 --> 00:41:13,359
there's some accounts that are added to

1212
00:41:13,359 --> 00:41:14,960
this to this group

1213
00:41:14,960 --> 00:41:17,280
we can see 1f4 is in the group

1214
00:41:17,280 --> 00:41:19,520
and we can actually work our way through

1215
00:41:19,520 --> 00:41:20,800
and be able to understand exactly what

1216
00:41:20,800 --> 00:41:23,119
that group is but this is the default

1217
00:41:23,119 --> 00:41:25,520
local admins uh group on the system so

1218
00:41:25,520 --> 00:41:28,000
we have one four is in that uh account

1219
00:41:28,000 --> 00:41:30,400
excuse me in that group we have three e8

1220
00:41:30,400 --> 00:41:32,319
which we confirmed was the gfi directory

1221
00:41:32,319 --> 00:41:35,839
admin and we also have uh 3ea on that

1222
00:41:35,839 --> 00:41:38,319
system uh as well or in that group so

1223
00:41:38,319 --> 00:41:41,040
this is information

1224
00:41:41,040 --> 00:41:42,319
that we know

1225
00:41:42,319 --> 00:41:44,079
is valuable to us so we know we can

1226
00:41:44,079 --> 00:41:45,680
confirm that they're actually a part of

1227
00:41:45,680 --> 00:41:48,000
this so another piece that i do like to

1228
00:41:48,000 --> 00:41:51,760
do we're going to launch that guy again

1229
00:41:51,760 --> 00:41:53,359
and we're going to load

1230
00:41:53,359 --> 00:41:54,319
the

1231
00:41:54,319 --> 00:41:56,160
believe it was yes

1232
00:41:56,160 --> 00:41:58,480
all right

1233
00:41:58,800 --> 00:41:59,839
we're going to work our way down so

1234
00:41:59,839 --> 00:42:01,520
we're running the the

1235
00:42:01,520 --> 00:42:04,160
system hive the uh the

1236
00:42:04,160 --> 00:42:05,520
registry hive we're gonna we're in a

1237
00:42:05,520 --> 00:42:07,599
load up system so when you're when you

1238
00:42:07,599 --> 00:42:09,440
have active system and you are in the

1239
00:42:09,440 --> 00:42:11,040
registry hives you're gonna see current

1240
00:42:11,040 --> 00:42:12,560
control set that's how it will read but

1241
00:42:12,560 --> 00:42:14,720
when the system powers down that it gets

1242
00:42:14,720 --> 00:42:16,960
converted and we'll say control set and

1243
00:42:16,960 --> 00:42:19,119
uh whatever your latest control set will

1244
00:42:19,119 --> 00:42:21,280
be the highest number and so we can walk

1245
00:42:21,280 --> 00:42:22,400
through that we can have a better

1246
00:42:22,400 --> 00:42:23,839
understanding on the control set when we

1247
00:42:23,839 --> 00:42:26,000
jump into surfaces and so the reason why

1248
00:42:26,000 --> 00:42:27,359
i want to jump in here this is one of

1249
00:42:27,359 --> 00:42:28,640
the highlights so as we're doing an

1250
00:42:28,640 --> 00:42:30,720
examination we can see what's going on

1251
00:42:30,720 --> 00:42:32,960
inside the services and i'm trying to

1252
00:42:32,960 --> 00:42:34,800
figure out the key reason

1253
00:42:34,800 --> 00:42:36,960
i'm looking in here is because i saw

1254
00:42:36,960 --> 00:42:39,280
that explicit credentials were used so

1255
00:42:39,280 --> 00:42:40,800
there's a couple different spots i'll

1256
00:42:40,800 --> 00:42:42,720
look i'll look for scripts i'll look for

1257
00:42:42,720 --> 00:42:43,760
scheduled tasks and i'll look for

1258
00:42:43,760 --> 00:42:45,680
services these are places where

1259
00:42:45,680 --> 00:42:47,520
oftentimes

1260
00:42:47,520 --> 00:42:49,520
specific credentials are set

1261
00:42:49,520 --> 00:42:51,040
and what we're talking about here is

1262
00:42:51,040 --> 00:42:53,359
just so people know

1263
00:42:53,359 --> 00:42:54,800
what we're talking about

1264
00:42:54,800 --> 00:42:57,119
is this is my own system and we have the

1265
00:42:57,119 --> 00:42:59,359
log on as and right now we're looking

1266
00:42:59,359 --> 00:43:02,000
for a log on as that is different than

1267
00:43:02,000 --> 00:43:04,079
all the others now this doesn't match

1268
00:43:04,079 --> 00:43:05,839
what we're seeing in our image we're

1269
00:43:05,839 --> 00:43:08,160
looking in here and so we want to have a

1270
00:43:08,160 --> 00:43:09,760
better understanding of what's happening

1271
00:43:09,760 --> 00:43:12,000
and we know that the gfi software is

1272
00:43:12,000 --> 00:43:13,440
here we know the gfi software has a

1273
00:43:13,440 --> 00:43:16,079
vulnerability and so we can jump down

1274
00:43:16,079 --> 00:43:18,800
and we can actually find the

1275
00:43:18,800 --> 00:43:21,200
the service count information

1276
00:43:21,200 --> 00:43:23,359
for the gfi software and here we have it

1277
00:43:23,359 --> 00:43:25,359
we have it right here now this is going

1278
00:43:25,359 --> 00:43:27,599
to be a little hard to read but we have

1279
00:43:27,599 --> 00:43:29,599
the gfi directory services that that

1280
00:43:29,599 --> 00:43:32,319
manages we we can see the username that

1281
00:43:32,319 --> 00:43:34,640
the system that the service is using we

1282
00:43:34,640 --> 00:43:37,119
have gfi directory admin and we have

1283
00:43:37,119 --> 00:43:39,119
this little line right here that says

1284
00:43:39,119 --> 00:43:42,480
see program files gfi gfi directory

1285
00:43:42,480 --> 00:43:44,640
you guys can read but

1286
00:43:44,640 --> 00:43:46,560
we have this information here

1287
00:43:46,560 --> 00:43:48,160
does anybody see

1288
00:43:48,160 --> 00:43:49,920
a problem here

1289
00:43:49,920 --> 00:43:52,000
does anybody have a quick giveaway of

1290
00:43:52,000 --> 00:43:55,200
what may be going on here and

1291
00:43:55,200 --> 00:43:57,280
what exactly the attack one of one part

1292
00:43:57,280 --> 00:43:59,280
of the attack the actual attack chain

1293
00:43:59,280 --> 00:44:01,760
that has occurred

1294
00:44:01,760 --> 00:44:03,359
i'm going to jump to another one and see

1295
00:44:03,359 --> 00:44:06,480
if it gives it away we'll jump to chrome

1296
00:44:06,480 --> 00:44:08,160
here's that image path again does

1297
00:44:08,160 --> 00:44:10,960
anybody notice something different

1298
00:44:10,960 --> 00:44:13,359
it's really hard to see

1299
00:44:13,359 --> 00:44:16,160
this has double quotes

1300
00:44:16,160 --> 00:44:18,079
gfi does not

1301
00:44:18,079 --> 00:44:20,560
gfi does not have double quotes so

1302
00:44:20,560 --> 00:44:22,560
if you're on a windows

1303
00:44:22,560 --> 00:44:24,319
system when does this funny little thing

1304
00:44:24,319 --> 00:44:27,119
that when it tries to call a a

1305
00:44:27,119 --> 00:44:28,880
an executable from some location when

1306
00:44:28,880 --> 00:44:31,200
it's instructed to to run that system

1307
00:44:31,200 --> 00:44:34,240
it's going to try and work its way down

1308
00:44:34,240 --> 00:44:35,920
excuse me if it's not quoted it will try

1309
00:44:35,920 --> 00:44:37,760
to work its way down and try to figure

1310
00:44:37,760 --> 00:44:39,359
out exactly where that is and it will

1311
00:44:39,359 --> 00:44:42,400
have problems anytime it hits a space

1312
00:44:42,400 --> 00:44:45,359
this is where things go haywire and so

1313
00:44:45,359 --> 00:44:48,400
um by by default what the system will do

1314
00:44:48,400 --> 00:44:50,400
is it will try to run

1315
00:44:50,400 --> 00:44:52,079
it will look for the c drive it will

1316
00:44:52,079 --> 00:44:53,359
look for program

1317
00:44:53,359 --> 00:44:54,880
but i won't look for program files

1318
00:44:54,880 --> 00:44:56,720
initially it will look for program so

1319
00:44:56,720 --> 00:44:58,160
we'll look for a folder name program it

1320
00:44:58,160 --> 00:44:59,680
will look for an executable named

1321
00:44:59,680 --> 00:45:02,240
program such as program.exe and it will

1322
00:45:02,240 --> 00:45:04,720
just automatically run it so we know

1323
00:45:04,720 --> 00:45:06,640
that that program.exe

1324
00:45:06,640 --> 00:45:08,560
is was sitting on the c drive we know it

1325
00:45:08,560 --> 00:45:11,599
was deleted and so we know that it's

1326
00:45:11,599 --> 00:45:13,599
very likely what the attack in this

1327
00:45:13,599 --> 00:45:16,079
particular case is is that the attacker

1328
00:45:16,079 --> 00:45:17,760
once they gained further access to the

1329
00:45:17,760 --> 00:45:18,800
system

1330
00:45:18,800 --> 00:45:21,040
was able to uh uh

1331
00:45:21,040 --> 00:45:23,839
be able to modify a service well really

1332
00:45:23,839 --> 00:45:25,200
just find a service that was running

1333
00:45:25,200 --> 00:45:27,920
with unquoted paths and be able to drop

1334
00:45:27,920 --> 00:45:30,400
a program.exe which is a payload on that

1335
00:45:30,400 --> 00:45:32,640
system and just wait for the service

1336
00:45:32,640 --> 00:45:35,280
account to run which would essentially

1337
00:45:35,280 --> 00:45:37,200
once that service actually ran it would

1338
00:45:37,200 --> 00:45:38,560
load with whatever credentials were

1339
00:45:38,560 --> 00:45:41,040
stored it would load uh program.exe

1340
00:45:41,040 --> 00:45:42,960
instead because it was trying to load

1341
00:45:42,960 --> 00:45:44,560
this but we were able to intercept it

1342
00:45:44,560 --> 00:45:46,720
the attacker was able to make this

1343
00:45:46,720 --> 00:45:48,160
happen and we were able to be able to

1344
00:45:48,160 --> 00:45:49,760
figure out

1345
00:45:49,760 --> 00:45:51,119
exactly what they were trying to

1346
00:45:51,119 --> 00:45:53,119
accomplish so this is one spot that we

1347
00:45:53,119 --> 00:45:55,280
can look in so there's a couple other

1348
00:45:55,280 --> 00:45:56,960
pieces and we're running a little short

1349
00:45:56,960 --> 00:45:58,000
on time

1350
00:45:58,000 --> 00:46:01,040
so we are going to jump down

1351
00:46:01,040 --> 00:46:02,640
to

1352
00:46:02,640 --> 00:46:04,640
looks like

1353
00:46:04,640 --> 00:46:08,079
3 45. okay there we go so we have more

1354
00:46:08,079 --> 00:46:10,560
activity going on in here so we have

1355
00:46:10,560 --> 00:46:13,280
inet pub we have some logs it looks like

1356
00:46:13,280 --> 00:46:16,160
they were accessing the logs for iis

1357
00:46:16,160 --> 00:46:17,839
that the different activities occurring

1358
00:46:17,839 --> 00:46:19,040
we also have

1359
00:46:19,040 --> 00:46:21,280
explicit credentials again where people

1360
00:46:21,280 --> 00:46:22,720
are logging in

1361
00:46:22,720 --> 00:46:24,800
there's several places oh we can even

1362
00:46:24,800 --> 00:46:26,720
see what

1363
00:46:26,720 --> 00:46:28,400
what accounts they were using we see

1364
00:46:28,400 --> 00:46:30,640
that the gfi directory admin was logging

1365
00:46:30,640 --> 00:46:32,720
in that's that's a little bit of

1366
00:46:32,720 --> 00:46:35,119
alarming why would that account be doing

1367
00:46:35,119 --> 00:46:36,960
an interactive log on onto a windows

1368
00:46:36,960 --> 00:46:38,319
system there's no reason for that it's a

1369
00:46:38,319 --> 00:46:39,520
service account it shouldn't be doing

1370
00:46:39,520 --> 00:46:41,440
that so this is giving us extra

1371
00:46:41,440 --> 00:46:42,640
information

1372
00:46:42,640 --> 00:46:44,560
and so we can see the logs so let's

1373
00:46:44,560 --> 00:46:46,400
actually jump to the logs

1374
00:46:46,400 --> 00:46:48,319
and we are a little short on time so i

1375
00:46:48,319 --> 00:46:49,920
will make it brief

1376
00:46:49,920 --> 00:46:51,920
we can follow the logs have a better

1377
00:46:51,920 --> 00:46:53,760
understanding again this all provided

1378
00:46:53,760 --> 00:46:55,520
information from the timeline

1379
00:46:55,520 --> 00:46:56,880
again a lot of tools that we haven't

1380
00:46:56,880 --> 00:46:59,119
been able to address today but that's

1381
00:46:59,119 --> 00:46:59,920
okay

1382
00:46:59,920 --> 00:47:02,160
so we have the log files we have a

1383
00:47:02,160 --> 00:47:04,800
virtual directory right here so uh w3

1384
00:47:04,800 --> 00:47:07,359
service one is what we have and so if we

1385
00:47:07,359 --> 00:47:10,079
load this guy up we have two log files

1386
00:47:10,079 --> 00:47:13,119
and that that's fine so the the dates

1387
00:47:13,119 --> 00:47:14,800
i know it's probably pretty hard to read

1388
00:47:14,800 --> 00:47:18,319
but that has uh 2204.07

1389
00:47:18,319 --> 00:47:21,280
so that's april 7th of 2022. we also

1390
00:47:21,280 --> 00:47:23,559
have a log file for

1391
00:47:23,559 --> 00:47:26,800
220408 so the following day so

1392
00:47:26,800 --> 00:47:28,400
let's let's start at the oldest one at

1393
00:47:28,400 --> 00:47:30,319
the oldest piece in the log and we can

1394
00:47:30,319 --> 00:47:32,800
see that there appears to be some extra

1395
00:47:32,800 --> 00:47:34,480
activity here

1396
00:47:34,480 --> 00:47:36,480
what we can do is we can

1397
00:47:36,480 --> 00:47:37,760
right now we're looking at a hex edited

1398
00:47:37,760 --> 00:47:40,000
review let's switch to text view so we

1399
00:47:40,000 --> 00:47:42,559
can have a better understanding of what

1400
00:47:42,559 --> 00:47:45,839
what is exactly in here

1401
00:47:46,079 --> 00:47:48,000
and we'll give that just a moment to

1402
00:47:48,000 --> 00:47:50,000
finish processing these

1403
00:47:50,000 --> 00:47:53,359
logs now we're loading an is log i still

1404
00:47:53,359 --> 00:47:54,800
may be needing to go look at the proxy

1405
00:47:54,800 --> 00:47:56,880
logs i may need to look in the the sim

1406
00:47:56,880 --> 00:47:58,559
so what we have here in here is a ton of

1407
00:47:58,559 --> 00:48:01,040
information we can see all kinds of uh

1408
00:48:01,040 --> 00:48:02,079
uh

1409
00:48:02,079 --> 00:48:04,880
bits in here and what i want to do is so

1410
00:48:04,880 --> 00:48:07,440
we can see there's active connections to

1411
00:48:07,440 --> 00:48:09,440
the archiver software which is part of

1412
00:48:09,440 --> 00:48:11,200
the gfi archiver piece we're going to

1413
00:48:11,200 --> 00:48:12,480
scroll down

1414
00:48:12,480 --> 00:48:14,240
and just here in the middle and we see

1415
00:48:14,240 --> 00:48:16,119
there's connections to the archiver

1416
00:48:16,119 --> 00:48:19,119
introduction.htm default.html

1417
00:48:19,119 --> 00:48:20,720
and we can see where the connections are

1418
00:48:20,720 --> 00:48:22,400
coming from what port they're they're

1419
00:48:22,400 --> 00:48:24,559
talking to and

1420
00:48:24,559 --> 00:48:26,400
we can see the user agent does anybody

1421
00:48:26,400 --> 00:48:28,480
notice anything weird about that user

1422
00:48:28,480 --> 00:48:31,599
agent did anybody recognize that one

1423
00:48:31,599 --> 00:48:34,000
that's a directory busting

1424
00:48:34,000 --> 00:48:36,640
utility so when uh if you have a bad

1425
00:48:36,640 --> 00:48:39,119
attacker who just uses tools configured

1426
00:48:39,119 --> 00:48:40,800
as default that oftentimes you're going

1427
00:48:40,800 --> 00:48:42,319
to get user agents that are going to

1428
00:48:42,319 --> 00:48:43,839
just identify what the tool is that

1429
00:48:43,839 --> 00:48:45,119
they're running in this case it's ferrex

1430
00:48:45,119 --> 00:48:47,760
buster which is a way of busting and

1431
00:48:47,760 --> 00:48:49,839
figuring out different um directories on

1432
00:48:49,839 --> 00:48:52,559
the system so we have a ton of activity

1433
00:48:52,559 --> 00:48:55,599
a ferrex buster all over the place

1434
00:48:55,599 --> 00:48:57,359
and to wrap this up

1435
00:48:57,359 --> 00:48:59,359
let's jump to the very bottom and so we

1436
00:48:59,359 --> 00:49:01,359
have some other information in here we

1437
00:49:01,359 --> 00:49:02,559
can see

1438
00:49:02,559 --> 00:49:04,880
that there's connections going to

1439
00:49:04,880 --> 00:49:06,240
archiver

1440
00:49:06,240 --> 00:49:08,960
telerik web ui web resource and we can

1441
00:49:08,960 --> 00:49:10,720
see that they're post requests a post

1442
00:49:10,720 --> 00:49:13,280
request is when you send data to a web

1443
00:49:13,280 --> 00:49:15,200
server instead of asking for data you're

1444
00:49:15,200 --> 00:49:17,040
sending data so we see these requests

1445
00:49:17,040 --> 00:49:18,480
and we can see the user agent in here

1446
00:49:18,480 --> 00:49:20,160
again is python

1447
00:49:20,160 --> 00:49:22,640
that's weird why is python communicating

1448
00:49:22,640 --> 00:49:24,240
with our web server we can see the

1449
00:49:24,240 --> 00:49:27,040
pwn.txt that we saw earlier we can see

1450
00:49:27,040 --> 00:49:30,000
the reverse.aspx information in here and

1451
00:49:30,000 --> 00:49:31,680
the thing that happened just before that

1452
00:49:31,680 --> 00:49:33,920
is we had a post request from uh to the

1453
00:49:33,920 --> 00:49:36,880
archiver telerik ui web resource and we

1454
00:49:36,880 --> 00:49:38,559
can follow this information back and we

1455
00:49:38,559 --> 00:49:40,960
can see it came from this ip and again

1456
00:49:40,960 --> 00:49:42,319
this is highly simplified it is

1457
00:49:42,319 --> 00:49:44,480
generally not anywhere this easy the

1458
00:49:44,480 --> 00:49:46,319
this ip address could be masked it could

1459
00:49:46,319 --> 00:49:48,480
be proxied who knows we know it ran

1460
00:49:48,480 --> 00:49:49,839
through python

1461
00:49:49,839 --> 00:49:51,680
and we know that it was posted with a

1462
00:49:51,680 --> 00:49:54,000
http status of 200. the very next thing

1463
00:49:54,000 --> 00:49:55,040
that they did

1464
00:49:55,040 --> 00:49:56,319
is they ran

1465
00:49:56,319 --> 00:49:58,000
uh they made a request to this

1466
00:49:58,000 --> 00:50:00,160
reverse.aspx

1467
00:50:00,160 --> 00:50:02,480
sounds to me like they uploaded it right

1468
00:50:02,480 --> 00:50:04,720
here which in fact they did this

1469
00:50:04,720 --> 00:50:07,680
application is vulnerable to a

1470
00:50:07,680 --> 00:50:10,000
arbitrary file upload so essentially

1471
00:50:10,000 --> 00:50:12,559
they uploaded this reversed reverse.axpx

1472
00:50:12,559 --> 00:50:14,640
which is a webshell then they ran the

1473
00:50:14,640 --> 00:50:16,960
webshell by accessing calling on that

1474
00:50:16,960 --> 00:50:18,800
web shell to actually build a process

1475
00:50:18,800 --> 00:50:20,480
and we were able to come in

1476
00:50:20,480 --> 00:50:23,599
and be able to understand that so

1477
00:50:23,599 --> 00:50:25,760
i'm getting the stfu

1478
00:50:25,760 --> 00:50:27,359
flag that's okay so i'm going to step

1479
00:50:27,359 --> 00:50:29,440
away here if you guys have any questions

1480
00:50:29,440 --> 00:50:30,720
please just join me out in the hallway

1481
00:50:30,720 --> 00:50:32,160
here in a moment so and thank you so

1482
00:50:32,160 --> 00:50:34,030
much

1483
00:50:34,030 --> 00:50:39,330
[Applause]

1484
00:50:42,000 --> 00:50:44,079
you

