1
00:00:19,860 --> 00:00:25,740
so I'm Troy voda voda from newman<font color="#E5E5E5"> russia</font>

2
00:00:23,880 --> 00:00:29,460
building and my talk today<font color="#E5E5E5"> is going to</font>

3
00:00:25,740 --> 00:00:33,030
be bros before flows and it's<font color="#E5E5E5"> really</font><font color="#CCCCCC"> a</font>

4
00:00:29,460 --> 00:00:37,950
talk<font color="#CCCCCC"> about network data acquisition in</font>

5
00:00:33,030 --> 00:00:39,750
regards to incentive response so real

6
00:00:37,950 --> 00:00:43,500
quick a<font color="#E5E5E5"> little bit about myself kind of</font>

7
00:00:39,750 --> 00:00:46,710
been in the infosec and IP realm for

8
00:00:43,500 --> 00:00:48,000
about little<font color="#CCCCCC"> bit over</font><font color="#E5E5E5"> 10 years started</font>

9
00:00:46,710 --> 00:00:50,790
off as an intrusion detection<font color="#E5E5E5"> analyst</font>

10
00:00:48,000 --> 00:00:52,860
kind of network and wireless and then

11
00:00:50,790 --> 00:00:58,250
kind<font color="#CCCCCC"> of moved</font><font color="#E5E5E5"> on it little sis add any</font>

12
00:00:52,860 --> 00:01:01,950
kind of stuff various system application

13
00:00:58,250 --> 00:01:03,870
admin deals but then you know as I<font color="#E5E5E5"> kind</font>

14
00:01:01,950 --> 00:01:05,820
of evolved through my career sorry to

15
00:01:03,870 --> 00:01:08,670
get<font color="#CCCCCC"> a little bit more into incident</font>

16
00:01:05,820 --> 00:01:09,898
response today now I actually lead the

17
00:01:08,670 --> 00:01:13,710
offense<font color="#E5E5E5"> franz team at my current</font>

18
00:01:09,899 --> 00:01:16,680
employment and also focused on ioc

19
00:01:13,710 --> 00:01:19,350
hunting campaign analysis a little bit

20
00:01:16,680 --> 00:01:21,060
malware analysis kind<font color="#E5E5E5"> of like multiple</font>

21
00:01:19,350 --> 00:01:25,530
hats kind of thing but mostly and also

22
00:01:21,060 --> 00:01:27,780
the<font color="#E5E5E5"> endpoint and network forensics but</font>

23
00:01:25,530 --> 00:01:30,780
when<font color="#E5E5E5"> i'm not kind of cybering the things</font>

24
00:01:27,780 --> 00:01:32,909
I I do enjoy being outdoors I love the

25
00:01:30,780 --> 00:01:35,310
mountains I love camping and hiking and

26
00:01:32,909 --> 00:01:39,990
Virginia is a beautiful state to be<font color="#E5E5E5"> able</font>

27
00:01:35,310 --> 00:01:42,710
to do that in and I do enjoy home

28
00:01:39,990 --> 00:01:45,929
brewing but<font color="#CCCCCC"> I mostly spend that time</font>

29
00:01:42,710 --> 00:01:48,899
home drinking<font color="#CCCCCC"> especially you know after</font>

30
00:01:45,930 --> 00:01:50,909
having<font color="#CCCCCC"> three kids</font><font color="#E5E5E5"> I really expect have</font>

31
00:01:48,900 --> 00:01:56,549
the time to get into<font color="#E5E5E5"> that but definitely</font>

32
00:01:50,909 --> 00:01:58,080
a craft and I Xavier enjoy a<font color="#E5E5E5"> lot so it</font>

33
00:01:56,549 --> 00:02:00,720
real quick just a level set things what

34
00:01:58,080 --> 00:02:04,289
this talk is not about it's not<font color="#CCCCCC"> it's not</font>

35
00:02:00,720 --> 00:02:07,130
about the facing or bashing<font color="#CCCCCC"> netflow at</font>

36
00:02:04,290 --> 00:02:09,509
all<font color="#CCCCCC"> that</font><font color="#E5E5E5"> flow is a really powerful tool</font>

37
00:02:07,130 --> 00:02:10,709
but also just<font color="#E5E5E5"> to kind of show from this</font>

38
00:02:09,508 --> 00:02:12,238
at response perspective you're going to

39
00:02:10,709 --> 00:02:14,070
hear me<font color="#E5E5E5"> over and over again today talk</font>

40
00:02:12,239 --> 00:02:16,320
about context context context and

41
00:02:14,070 --> 00:02:17,880
context is our friend<font color="#E5E5E5"> and time is our</font>

42
00:02:16,320 --> 00:02:20,549
enemy especially when dealing with

43
00:02:17,880 --> 00:02:22,500
network data acquisition and then over

44
00:02:20,549 --> 00:02:24,239
time as that data is<font color="#E5E5E5"> going to as we go</font>

45
00:02:22,500 --> 00:02:25,880
from the full picture a full packet

46
00:02:24,239 --> 00:02:29,370
capture down to like rudimentary stuff

47
00:02:25,880 --> 00:02:30,989
or the time is going<font color="#E5E5E5"> to be crucial and</font>

48
00:02:29,370 --> 00:02:33,090
be able to<font color="#E5E5E5"> grab that data and be able to</font>

49
00:02:30,989 --> 00:02:38,310
<font color="#E5E5E5">have</font><font color="#CCCCCC"> it or to combat that incident</font>

50
00:02:33,090 --> 00:02:40,650
response also this<font color="#E5E5E5"> is meant to be vendor</font>

51
00:02:38,310 --> 00:02:43,230
agnostic and you know<font color="#E5E5E5"> BIOS may vary for</font>

52
00:02:40,650 --> 00:02:45,060
everybody one size does not fit all so

53
00:02:43,230 --> 00:02:47,220
when I<font color="#E5E5E5"> talk about</font><font color="#CCCCCC"> its hopefully a</font>

54
00:02:45,060 --> 00:02:50,010
general<font color="#E5E5E5"> istic approach at data network</font>

55
00:02:47,220 --> 00:02:51,540
acquisition and not it may<font color="#E5E5E5"> not</font>

56
00:02:50,010 --> 00:02:53,549
necessarily apply to you or your

57
00:02:51,540 --> 00:02:55,500
networks but hopefully you can<font color="#E5E5E5"> bring</font>

58
00:02:53,550 --> 00:02:58,290
some of<font color="#CCCCCC"> this back with you to secure</font>

59
00:02:55,500 --> 00:03:00,870
your corporate networks and also these

60
00:02:58,290 --> 00:03:03,299
are the opinions here are that of<font color="#E5E5E5"> mine</font>

61
00:03:00,870 --> 00:03:06,230
and<font color="#CCCCCC"> not</font><font color="#E5E5E5"> of my employer just kind of have</font>

62
00:03:03,300 --> 00:03:06,230
to throw<font color="#E5E5E5"> that one up there real quick</font>

63
00:03:06,379 --> 00:03:13,440
<font color="#E5E5E5">all right so real</font><font color="#CCCCCC"> quick I said the the</font>

64
00:03:11,610 --> 00:03:15,959
<font color="#E5E5E5">highlight of this is really the show how</font>

65
00:03:13,440 --> 00:03:18,569
do we do incident response with data

66
00:03:15,959 --> 00:03:20,430
network acquisition so we have<font color="#E5E5E5"> I'm</font>

67
00:03:18,569 --> 00:03:22,819
<font color="#E5E5E5">showing the pickerel famous pickerel</font>

68
00:03:20,430 --> 00:03:24,870
phases of your of your<font color="#CCCCCC"> eye are</font>

69
00:03:22,819 --> 00:03:26,310
highlighting identification here because

70
00:03:24,870 --> 00:03:28,800
this<font color="#CCCCCC"> is really the key and</font><font color="#E5E5E5"> I actually</font>

71
00:03:26,310 --> 00:03:32,190
like to show the Lockheed Martin's cyber

72
00:03:28,800 --> 00:03:33,660
kill chain and although that paper hits

73
00:03:32,190 --> 00:03:35,190
on more than just dealing with<font color="#CCCCCC"> things</font>

74
00:03:33,660 --> 00:03:37,340
and it's a response its campaign

75
00:03:35,190 --> 00:03:39,420
tracking adversary tracking and<font color="#E5E5E5"> whatnot</font>

76
00:03:37,340 --> 00:03:41,550
well I like<font color="#E5E5E5"> to highlight out of that</font>

77
00:03:39,420 --> 00:03:43,470
from<font color="#CCCCCC"> that kill chain I kind</font><font color="#E5E5E5"> of visualize</font>

78
00:03:41,550 --> 00:03:46,019
and I try<font color="#CCCCCC"> to</font><font color="#E5E5E5"> help show this to my team</font>

79
00:03:43,470 --> 00:03:47,970
as well that there's<font color="#E5E5E5"> certain things in</font>

80
00:03:46,019 --> 00:03:50,340
that phases of<font color="#CCCCCC"> the kill chain such as</font>

81
00:03:47,970 --> 00:03:52,560
delivery exploitation insulation and

82
00:03:50,340 --> 00:03:54,540
command and<font color="#E5E5E5"> control and how those areas</font>

83
00:03:52,560 --> 00:03:57,050
that essentially what the attacker has

84
00:03:54,540 --> 00:04:01,290
to do to be successful against you on

85
00:03:57,050 --> 00:04:02,640
how are you detecting things evil on

86
00:04:01,290 --> 00:04:04,530
your network as it applies to those

87
00:04:02,640 --> 00:04:06,059
different phases and I highly suggest

88
00:04:04,530 --> 00:04:08,340
that if you're if you're on a team that

89
00:04:06,060 --> 00:04:10,379
you're writing rules um you have these

90
00:04:08,340 --> 00:04:13,409
rules that are<font color="#CCCCCC"> they're written to detect</font>

91
00:04:10,379 --> 00:04:15,899
things that you're tagging them or

92
00:04:13,409 --> 00:04:19,019
categorizing these rules somewhat based

93
00:04:15,900 --> 00:04:21,120
off of<font color="#CCCCCC"> the cyber kill chain phases but a</font>

94
00:04:19,019 --> 00:04:22,500
case in point<font color="#E5E5E5"> you might have a rule in</font>

95
00:04:21,120 --> 00:04:24,539
<font color="#CCCCCC">90s rule that looks for a certain your</font>

96
00:04:22,500 --> 00:04:25,919
eye pattern but that your eye pattern is

97
00:04:24,539 --> 00:04:28,800
specifically written to detect a

98
00:04:25,919 --> 00:04:32,180
delivery phase of an attack but at face

99
00:04:28,800 --> 00:04:34,500
value maybe<font color="#E5E5E5"> to an entry-level analyst or</font>

100
00:04:32,180 --> 00:04:36,360
or somebody else looking at that

101
00:04:34,500 --> 00:04:37,979
signature they might not<font color="#E5E5E5"> know that that</font>

102
00:04:36,360 --> 00:04:39,630
attack is written for delivery phase it

103
00:04:37,979 --> 00:04:41,130
might be written for they might think

104
00:04:39,630 --> 00:04:42,210
<font color="#E5E5E5">its commanding control because it's over</font>

105
00:04:41,130 --> 00:04:44,010
the network so it has<font color="#CCCCCC"> to be</font><font color="#E5E5E5"> command and</font>

106
00:04:42,210 --> 00:04:45,529
<font color="#E5E5E5">control so be able to differentiate</font>

107
00:04:44,010 --> 00:04:47,659
categorize your rule

108
00:04:45,529 --> 00:04:48,799
is highly important especially to help

109
00:04:47,659 --> 00:04:51,049
those<font color="#E5E5E5"> junior level analysts when the</font>

110
00:04:48,799 --> 00:04:52,359
rule does fire I know we probably didn't

111
00:04:51,049 --> 00:04:55,099
do an<font color="#CCCCCC"> in-store</font><font color="#E5E5E5"> response long enough</font>

112
00:04:52,359 --> 00:04:56,539
you've seen other rules that<font color="#E5E5E5"> have fired</font>

113
00:04:55,099 --> 00:04:58,099
at you didn't<font color="#E5E5E5"> right you try and</font>

114
00:04:56,539 --> 00:05:00,079
understand what that rules written for

115
00:04:58,099 --> 00:05:02,329
having that categorization<font color="#CCCCCC"> or where it</font>

116
00:05:00,079 --> 00:05:04,519
falls is how important and it's also

117
00:05:02,329 --> 00:05:06,199
important for escalating that incident

118
00:05:04,519 --> 00:05:08,149
as well so if something fires and<font color="#E5E5E5"> the</font>

119
00:05:06,199 --> 00:05:10,789
delivery phase and the kill chain and

120
00:05:08,149 --> 00:05:12,529
you stop the attack it's<font color="#E5E5E5"> probably less</font>

121
00:05:10,789 --> 00:05:14,839
likely that you have to escalate it to

122
00:05:12,529 --> 00:05:18,139
where's you get a detection on command

123
00:05:14,839 --> 00:05:19,639
and control because then there was some

124
00:05:18,139 --> 00:05:20,839
<font color="#CCCCCC">other action that happened on</font><font color="#E5E5E5"> the</font>

125
00:05:19,639 --> 00:05:22,549
network that<font color="#CCCCCC"> you</font><font color="#E5E5E5"> did not catch them you</font>

126
00:05:20,839 --> 00:05:25,669
have<font color="#CCCCCC"> to go back and</font><font color="#E5E5E5"> find that so I like</font>

127
00:05:22,549 --> 00:05:28,219
<font color="#CCCCCC">the kind of caveat that and show where</font>

128
00:05:25,669 --> 00:05:30,169
there's a crossroads near at least in my

129
00:05:28,219 --> 00:05:32,209
eyes and go<font color="#E5E5E5"> and kind of going through</font>

130
00:05:30,169 --> 00:05:34,339
these phases as<font color="#E5E5E5"> your as a member of</font><font color="#CCCCCC"> the</font>

131
00:05:32,209 --> 00:05:37,009
IR team<font color="#E5E5E5"> hopefully you have more than one</font>

132
00:05:34,339 --> 00:05:39,439
person on your team and as you're going

133
00:05:37,009 --> 00:05:40,759
through one or more members are going

134
00:05:39,439 --> 00:05:42,619
forward<font color="#E5E5E5"> trying to go through these</font>

135
00:05:40,759 --> 00:05:44,719
phases you<font color="#CCCCCC"> maybe have a member or two</font>

136
00:05:42,619 --> 00:05:47,059
that are backwards<font color="#CCCCCC"> pedaling looking back</font>

137
00:05:44,719 --> 00:05:48,409
have I fully identified the scope have I

138
00:05:47,059 --> 00:05:50,059
fully identified everything is there

139
00:05:48,409 --> 00:05:51,169
something on missing so you're

140
00:05:50,059 --> 00:05:54,349
constantly revisiting this

141
00:05:51,169 --> 00:05:57,979
identification phase and then<font color="#CCCCCC"> same thing</font>

142
00:05:54,349 --> 00:05:59,539
<font color="#CCCCCC">for eradication and and recovery and I</font>

143
00:05:57,979 --> 00:06:00,558
know we all been<font color="#CCCCCC"> there especially you've</font>

144
00:05:59,539 --> 00:06:02,599
been doing instant response<font color="#CCCCCC"> too long</font>

145
00:06:00,559 --> 00:06:05,329
enough you've had<font color="#E5E5E5"> that incident where</font>

146
00:06:02,599 --> 00:06:07,429
system was beaconing quickly<font color="#CCCCCC"> taking off</font>

147
00:06:05,329 --> 00:06:09,319
the off the network hard drive<font color="#CCCCCC"> slipped</font>

148
00:06:07,429 --> 00:06:12,279
<font color="#CCCCCC">and reloaded right so there</font><font color="#E5E5E5"> was no look</font>

149
00:06:09,319 --> 00:06:14,419
into how that how that system got comped

150
00:06:12,279 --> 00:06:16,489
whether other systems comped it was just

151
00:06:14,419 --> 00:06:19,159
quick slick reload<font color="#E5E5E5"> or wipe our hands and</font>

152
00:06:16,489 --> 00:06:22,159
move on and that's a symptom i like to

153
00:06:19,159 --> 00:06:23,929
call a premature eradication and so if

154
00:06:22,159 --> 00:06:26,539
you<font color="#E5E5E5"> can at all costs avoid premature</font>

155
00:06:23,929 --> 00:06:28,399
eradication for your I our team and your

156
00:06:26,539 --> 00:06:32,509
<font color="#CCCCCC">I our process that's that's definitely a</font>

157
00:06:28,399 --> 00:06:35,719
<font color="#CCCCCC">good thing to do all right so kind of</font>

158
00:06:32,509 --> 00:06:38,779
<font color="#E5E5E5">going</font><font color="#CCCCCC"> through now the core point</font><font color="#E5E5E5"> of this</font>

159
00:06:35,719 --> 00:06:41,719
presentation is the data network

160
00:06:38,779 --> 00:06:43,219
acquisition from and I call<font color="#E5E5E5"> this kind of</font>

161
00:06:41,719 --> 00:06:45,129
<font color="#E5E5E5">like the stack if you will we're going</font>

162
00:06:43,219 --> 00:06:46,998
<font color="#E5E5E5">to go from the most contextual based</font>

163
00:06:45,129 --> 00:06:49,279
resource which is our full packet

164
00:06:46,999 --> 00:06:50,809
capture and kind of<font color="#E5E5E5"> go down the stack</font>

165
00:06:49,279 --> 00:06:52,849
and<font color="#CCCCCC"> I'm going</font><font color="#E5E5E5"> to talk about things like</font>

166
00:06:50,809 --> 00:06:55,669
obviously full packet capture the bro

167
00:06:52,849 --> 00:06:58,248
IDs a little bit on application proxy

168
00:06:55,669 --> 00:07:01,308
and<font color="#E5E5E5"> gateway logs</font>

169
00:06:58,249 --> 00:07:04,519
<font color="#E5E5E5">I p fix or</font><font color="#CCCCCC"> netflow your slide yes and</font><font color="#E5E5E5"> IP</font>

170
00:07:01,309 --> 00:07:07,789
essence and then<font color="#E5E5E5"> down to the</font><font color="#CCCCCC"> far more so</font>

171
00:07:04,519 --> 00:07:12,859
just<font color="#CCCCCC"> real real general</font><font color="#E5E5E5"> istic network</font>

172
00:07:07,789 --> 00:07:15,589
here we have our our<font color="#E5E5E5"> DMZ may be hosting</font>

173
00:07:12,859 --> 00:07:18,138
a web server that's internet exposed to

174
00:07:15,589 --> 00:07:20,809
allow inbound<font color="#E5E5E5"> 84 43 what have you maybe</font>

175
00:07:18,139 --> 00:07:23,299
an MTA mail server and then say a file

176
00:07:20,809 --> 00:07:25,099
share what not and then inside your

177
00:07:23,299 --> 00:07:26,058
network if you have some segmentation

178
00:07:25,099 --> 00:07:29,299
hopefully you have a little<font color="#E5E5E5"> bit of</font>

179
00:07:26,059 --> 00:07:31,899
segmentation on between your clients and

180
00:07:29,299 --> 00:07:34,068
maybe your server based infrastructure

181
00:07:31,899 --> 00:07:36,379
so what do you do where do you get

182
00:07:34,069 --> 00:07:39,529
<font color="#E5E5E5">started so essentially you want to</font>

183
00:07:36,379 --> 00:07:41,360
identify your critical choke points the

184
00:07:39,529 --> 00:07:43,069
<font color="#CCCCCC">less choke points you have the better</font>

185
00:07:41,360 --> 00:07:44,629
the easier this will be the more

186
00:07:43,069 --> 00:07:47,029
obviously the more complex things get

187
00:07:44,629 --> 00:07:49,249
but if you can find and identify those

188
00:07:47,029 --> 00:07:52,729
choke points then you're going to be

189
00:07:49,249 --> 00:07:54,489
able to obviously key in on what's data

190
00:07:52,729 --> 00:07:56,659
is leaving or coming into your network

191
00:07:54,489 --> 00:07:58,938
so you<font color="#E5E5E5"> probably want</font><font color="#CCCCCC"> to start with your</font>

192
00:07:56,659 --> 00:08:01,039
full packet capture at those critical

193
00:07:58,939 --> 00:08:03,860
choke points and maybe you want to run

194
00:08:01,039 --> 00:08:07,279
bro and parallel to that and then<font color="#E5E5E5"> maybe</font>

195
00:08:03,860 --> 00:08:09,709
bro well you know in between community

196
00:08:07,279 --> 00:08:13,429
comes from your segmentation internally

197
00:08:09,709 --> 00:08:15,439
on your network<font color="#CCCCCC"> and then there's net</font>

198
00:08:13,429 --> 00:08:16,878
flow so net flow is something that if

199
00:08:15,439 --> 00:08:18,229
you have a<font color="#E5E5E5"> corporate environment you're</font>

200
00:08:16,879 --> 00:08:20,269
running any kind<font color="#E5E5E5"> of corporate level</font>

201
00:08:18,229 --> 00:08:21,649
layer 3 switches and routers you

202
00:08:20,269 --> 00:08:24,279
probably already have this technology

203
00:08:21,649 --> 00:08:26,959
you're paying for<font color="#CCCCCC"> it so why</font><font color="#E5E5E5"> not</font><font color="#CCCCCC"> use it</font>

204
00:08:24,279 --> 00:08:29,779
this thinks this technology skills

205
00:08:26,959 --> 00:08:31,429
<font color="#E5E5E5">really well across your network and like</font>

206
00:08:29,779 --> 00:08:34,789
I said you're<font color="#E5E5E5"> probably already paying</font>

207
00:08:31,429 --> 00:08:37,218
for it so<font color="#E5E5E5"> why not</font><font color="#CCCCCC"> use it</font><font color="#E5E5E5"> right and then</font>

208
00:08:34,789 --> 00:08:38,389
your traditional IDs maybe you want to

209
00:08:37,219 --> 00:08:40,129
run that in parallel with some of those

210
00:08:38,389 --> 00:08:44,120
at some of those critical choke points

211
00:08:40,129 --> 00:08:46,850
as<font color="#CCCCCC"> well and then really from innocent</font>

212
00:08:44,120 --> 00:08:48,920
response perspective you you want as

213
00:08:46,850 --> 00:08:50,529
much<font color="#CCCCCC"> sexualize logging as possible so if</font>

214
00:08:48,920 --> 00:08:52,729
you're you're battling an incident and

215
00:08:50,529 --> 00:08:55,819
you have to<font color="#E5E5E5"> log</font><font color="#CCCCCC"> into 15 different</font>

216
00:08:52,730 --> 00:08:57,559
systems to get all<font color="#CCCCCC"> your data that's time</font>

217
00:08:55,819 --> 00:08:59,120
that could be spent well doing other

218
00:08:57,559 --> 00:09:01,189
things trying<font color="#E5E5E5"> to find the</font><font color="#CCCCCC"> ebo the</font>

219
00:08:59,120 --> 00:09:02,689
badness and so the more centralized

220
00:09:01,189 --> 00:09:05,209
things are the easier it's fine the more

221
00:09:02,689 --> 00:09:07,490
things are coming in on the easier it is

222
00:09:05,209 --> 00:09:09,229
<font color="#E5E5E5">to kind of combat that incident so</font>

223
00:09:07,490 --> 00:09:11,000
whether it is one of these<font color="#E5E5E5"> technologies</font>

224
00:09:09,230 --> 00:09:12,860
that<font color="#CCCCCC"> I mentioned</font><font color="#E5E5E5"> or its other</font>

225
00:09:11,000 --> 00:09:15,020
our wall<font color="#E5E5E5"> logs or other logs or endpoint</font>

226
00:09:12,860 --> 00:09:18,170
logs the more centralization that you

227
00:09:15,020 --> 00:09:20,060
can get for this data the better app

228
00:09:18,170 --> 00:09:25,640
that your team is going to have<font color="#E5E5E5"> at being</font>

229
00:09:20,060 --> 00:09:28,099
able to combat pay so<font color="#E5E5E5"> well dive into</font>

230
00:09:25,640 --> 00:09:30,590
full packet capture so what<font color="#E5E5E5"> is full</font>

231
00:09:28,100 --> 00:09:31,760
packet capture it's basically see

232
00:09:30,590 --> 00:09:34,580
everything know everything it goes over

233
00:09:31,760 --> 00:09:36,770
<font color="#E5E5E5">the wire there are some caveats you know</font>

234
00:09:34,580 --> 00:09:38,990
encryption obfuscation techniques are

235
00:09:36,770 --> 00:09:40,670
going to throw us<font color="#E5E5E5"> for some loops there</font>

236
00:09:38,990 --> 00:09:43,310
are<font color="#E5E5E5"> some little caveat with that too</font>

237
00:09:40,670 --> 00:09:44,689
I'll get more into that later on but

238
00:09:43,310 --> 00:09:47,599
essentially everything that traversed

239
00:09:44,690 --> 00:09:49,310
that wire you see it on if you<font color="#E5E5E5"> want to</font>

240
00:09:47,600 --> 00:09:50,960
<font color="#E5E5E5">get started with full packet capture</font>

241
00:09:49,310 --> 00:09:53,030
there's a really<font color="#E5E5E5"> good friend of</font><font color="#CCCCCC"> mine who</font>

242
00:09:50,960 --> 00:09:55,430
wrote a paper may or may not be at this

243
00:09:53,030 --> 00:09:57,110
press this conference today but it's

244
00:09:55,430 --> 00:09:58,430
really<font color="#E5E5E5"> good roll your own kind of kind</font>

245
00:09:57,110 --> 00:10:00,800
of full packet capture using TCP dump

246
00:09:58,430 --> 00:10:03,650
and some basically you just get your<font color="#E5E5E5"> own</font>

247
00:10:00,800 --> 00:10:05,689
hardware and just go then there's also

248
00:10:03,650 --> 00:10:07,160
google has steganography I don't know if

249
00:10:05,690 --> 00:10:09,920
anybody heard of<font color="#E5E5E5"> this I recently learned</font>

250
00:10:07,160 --> 00:10:12,140
about it it's basically written to to

251
00:10:09,920 --> 00:10:14,030
spool data quickly off the<font color="#E5E5E5"> wire not to</font>

252
00:10:12,140 --> 00:10:15,560
disk it's not made to go through<font color="#E5E5E5"> and do</font>

253
00:10:14,030 --> 00:10:17,140
analytics on the<font color="#E5E5E5"> peak apps it doesn't do</font>

254
00:10:15,560 --> 00:10:20,329
stream reassembly or anything like that

255
00:10:17,140 --> 00:10:23,150
but I just need<font color="#CCCCCC"> to do one thing and do</font>

256
00:10:20,330 --> 00:10:25,310
<font color="#CCCCCC">it really well is grab data SPO it to</font>

257
00:10:23,150 --> 00:10:27,020
disk really fast and they're<font color="#CCCCCC"> talking</font>

258
00:10:25,310 --> 00:10:28,819
about<font color="#E5E5E5"> like 10 gig connections and stuff</font>

259
00:10:27,020 --> 00:10:30,970
so really cool stuff<font color="#E5E5E5"> and then in the</font>

260
00:10:28,820 --> 00:10:33,410
commercial marketplace there's obviously

261
00:10:30,970 --> 00:10:35,870
some folks that are doing it<font color="#E5E5E5"> doing it</font>

262
00:10:33,410 --> 00:10:37,670
well I also just<font color="#E5E5E5"> learned of splunk out</font>

263
00:10:35,870 --> 00:10:40,190
for stream that was kind of kind of neat

264
00:10:37,670 --> 00:10:41,569
kind<font color="#E5E5E5"> of looking at how folks are doing</font>

265
00:10:40,190 --> 00:10:43,610
things a little<font color="#CCCCCC"> bit</font><font color="#E5E5E5"> more</font><font color="#CCCCCC"> of the</font>

266
00:10:41,570 --> 00:10:45,080
virtualization or cloud environment so

267
00:10:43,610 --> 00:10:47,960
there's definitely some wins that could

268
00:10:45,080 --> 00:10:53,480
be had there if you can't go<font color="#CCCCCC"> with one of</font>

269
00:10:47,960 --> 00:10:57,170
<font color="#CCCCCC">these other resources all right now bro</font>

270
00:10:53,480 --> 00:10:58,970
who here has heard<font color="#E5E5E5"> of bro that's awesome</font>

271
00:10:57,170 --> 00:11:02,089
that's that's that's awesome that

272
00:10:58,970 --> 00:11:04,430
actually makes<font color="#E5E5E5"> me really happy I</font><font color="#CCCCCC"> sobro</font>

273
00:11:02,089 --> 00:11:07,700
something I've been<font color="#E5E5E5"> using since about</font>

274
00:11:04,430 --> 00:11:11,060
2013 I don't know if anybody knew this

275
00:11:07,700 --> 00:11:14,120
but bros<font color="#E5E5E5"> over 20 years old that that's</font>

276
00:11:11,060 --> 00:11:16,699
that's kind of surprising but it's

277
00:11:14,120 --> 00:11:18,200
definitely it's labeled as an intrusion

278
00:11:16,700 --> 00:11:20,540
detection system but it's much more I

279
00:11:18,200 --> 00:11:22,640
look at<font color="#CCCCCC"> it as</font><font color="#E5E5E5"> like</font><font color="#CCCCCC"> Network forensics I</font>

280
00:11:20,540 --> 00:11:24,110
look at is if you want to do dlp with it

281
00:11:22,640 --> 00:11:24,540
you can do that if you want to do a true

282
00:11:24,110 --> 00:11:26,280
Shinto

283
00:11:24,540 --> 00:11:27,780
that's there it's just<font color="#CCCCCC"> network logging</font>

284
00:11:26,280 --> 00:11:29,130
of all the things<font color="#E5E5E5"> and meta dating all</font>

285
00:11:27,780 --> 00:11:30,839
these all this stuff<font color="#E5E5E5"> and it just</font>

286
00:11:29,130 --> 00:11:32,689
surprised me all the time when<font color="#E5E5E5"> I'm</font>

287
00:11:30,840 --> 00:11:35,010
looking at<font color="#E5E5E5"> that especially dealing with</font>

288
00:11:32,690 --> 00:11:37,110
when I first<font color="#E5E5E5"> started doing intrusion</font>

289
00:11:35,010 --> 00:11:39,180
detection basically having alert fire

290
00:11:37,110 --> 00:11:40,830
and<font color="#E5E5E5"> you have one packet of the result of</font>

291
00:11:39,180 --> 00:11:41,969
what that signature fired on and then

292
00:11:40,830 --> 00:11:43,920
<font color="#E5E5E5">you're trying to understand what the</font>

293
00:11:41,970 --> 00:11:45,420
heck is around that I'm you only have

294
00:11:43,920 --> 00:11:46,920
full packet capture but even<font color="#CCCCCC"> if</font><font color="#E5E5E5"> you do</font>

295
00:11:45,420 --> 00:11:48,589
have full packet capture going through

296
00:11:46,920 --> 00:11:51,660
all<font color="#E5E5E5"> that data it can be time consuming</font>

297
00:11:48,590 --> 00:11:53,580
bro just just if it understands that

298
00:11:51,660 --> 00:11:55,890
application protocol it writes a log to

299
00:11:53,580 --> 00:11:58,890
it it's<font color="#CCCCCC"> fantastic and</font><font color="#E5E5E5"> we will get more</font>

300
00:11:55,890 --> 00:12:02,040
<font color="#CCCCCC">into bro obviously as the presentation</font>

301
00:11:58,890 --> 00:12:04,170
goes on<font color="#E5E5E5"> I was debating on whether I was</font>

302
00:12:02,040 --> 00:12:06,569
going to talk a little bit about proxies

303
00:12:04,170 --> 00:12:08,250
in gateways it's not something<font color="#CCCCCC"> that</font>

304
00:12:06,570 --> 00:12:09,840
scales across your network like I

305
00:12:08,250 --> 00:12:11,220
mentioned earlier in that<font color="#E5E5E5"> slide where I</font>

306
00:12:09,840 --> 00:12:13,890
was showing where your critical choke

307
00:12:11,220 --> 00:12:15,900
points are not but it's definitely value

308
00:12:13,890 --> 00:12:18,270
add resource to have from this<font color="#E5E5E5"> it</font>

309
00:12:15,900 --> 00:12:20,310
responders perspective because it's for

310
00:12:18,270 --> 00:12:22,319
<font color="#E5E5E5">that particular application or proxy</font>

311
00:12:20,310 --> 00:12:23,609
that<font color="#E5E5E5"> it's serving up for that the data</font>

312
00:12:22,320 --> 00:12:25,440
that's<font color="#E5E5E5"> going to be in there is going to</font>

313
00:12:23,610 --> 00:12:28,140
be really really contextually rich I

314
00:12:25,440 --> 00:12:29,580
it's<font color="#E5E5E5"> so you're going to have say we</font>

315
00:12:28,140 --> 00:12:32,790
<font color="#E5E5E5">talked about an HTTP proxy you're going</font>

316
00:12:29,580 --> 00:12:34,620
to have authentic<font color="#CCCCCC"> Asian credit users in</font>

317
00:12:32,790 --> 00:12:35,939
there<font color="#CCCCCC"> maybe host</font><font color="#E5E5E5"> in there that are</font>

318
00:12:34,620 --> 00:12:37,800
authenticating you can do categorization

319
00:12:35,940 --> 00:12:41,100
whether or not that the<font color="#CCCCCC"> websites are</font>

320
00:12:37,800 --> 00:12:43,229
categorized obviously with email you

321
00:12:41,100 --> 00:12:44,880
have anti-spam capabilities with both of

322
00:12:43,230 --> 00:12:50,250
the technologies you<font color="#E5E5E5"> can do a be</font>

323
00:12:44,880 --> 00:12:51,960
scanning things are going more so also

324
00:12:50,250 --> 00:12:54,480
<font color="#CCCCCC">for the inline protection they're really</font>

325
00:12:51,960 --> 00:12:56,370
really good there but they don't scale

326
00:12:54,480 --> 00:12:58,590
very well across right so they're made

327
00:12:56,370 --> 00:13:01,740
this one does smtp this one does<font color="#CCCCCC"> FTP or</font>

328
00:12:58,590 --> 00:13:03,600
this does HTTP they're<font color="#CCCCCC"> really</font><font color="#E5E5E5"> good for</font>

329
00:13:01,740 --> 00:13:05,790
those protocols and obviously if you

330
00:13:03,600 --> 00:13:07,350
have those resources on your network you

331
00:13:05,790 --> 00:13:10,110
should be getting those logs to help you

332
00:13:07,350 --> 00:13:15,960
understand the incident as its existing

333
00:13:10,110 --> 00:13:18,590
on your network so IP fix or otherwise

334
00:13:15,960 --> 00:13:20,760
known as a net flow version 9

335
00:13:18,590 --> 00:13:22,410
essentially like<font color="#CCCCCC"> I</font><font color="#E5E5E5"> mentioned if you have</font>

336
00:13:20,760 --> 00:13:23,880
any layer 3 switches or routers on your

337
00:13:22,410 --> 00:13:25,980
network you<font color="#E5E5E5"> probably already have this</font>

338
00:13:23,880 --> 00:13:27,300
capability<font color="#E5E5E5"> this technology I'm</font>

339
00:13:25,980 --> 00:13:29,580
essentially<font color="#CCCCCC"> it's a two-state system</font>

340
00:13:27,300 --> 00:13:31,890
there's exporters and collectors so all

341
00:13:29,580 --> 00:13:33,480
your layer 3 switches and routers<font color="#E5E5E5"> are</font>

342
00:13:31,890 --> 00:13:35,910
your<font color="#CCCCCC"> ex porters are exporting out the</font>

343
00:13:33,480 --> 00:13:36,720
flows and then your collectors are those

344
00:13:35,910 --> 00:13:38,579
<font color="#E5E5E5">things that are</font>

345
00:13:36,720 --> 00:13:40,050
servers that are collecting that<font color="#E5E5E5"> flow</font>

346
00:13:38,579 --> 00:13:42,540
data and it's a it's a bi-directional

347
00:13:40,050 --> 00:13:45,029
thing so you can<font color="#E5E5E5"> actually get a record</font>

348
00:13:42,540 --> 00:13:47,759
for say the traditional client-server

349
00:13:45,029 --> 00:13:49,589
communication you<font color="#CCCCCC"> have a flow from</font>

350
00:13:47,759 --> 00:13:51,300
client to server and<font color="#E5E5E5"> then another flow</font>

351
00:13:49,589 --> 00:13:53,160
record from server to client and<font color="#E5E5E5"> you can</font>

352
00:13:51,300 --> 00:13:55,050
kind<font color="#E5E5E5"> of understand how data is moving</font>

353
00:13:53,160 --> 00:13:56,969
around in your network and<font color="#E5E5E5"> so you can</font>

354
00:13:55,050 --> 00:14:00,479
baseline things like these clients are

355
00:13:56,970 --> 00:14:02,399
generally surfing the web so there's

356
00:14:00,480 --> 00:14:03,870
very little flow going outbound and<font color="#E5E5E5"> a</font>

357
00:14:02,399 --> 00:14:05,550
lot of flow coming inbound because

358
00:14:03,870 --> 00:14:07,620
they're doing<font color="#E5E5E5"> tiny little get requests</font>

359
00:14:05,550 --> 00:14:10,699
and bringing down payload so you kind of

360
00:14:07,620 --> 00:14:12,990
understand that picture on<font color="#CCCCCC"> your network</font>

361
00:14:10,699 --> 00:14:15,420
a lot of<font color="#CCCCCC"> things</font><font color="#E5E5E5"> that are involved</font>

362
00:14:12,990 --> 00:14:18,660
especially in version 9 essentially

363
00:14:15,420 --> 00:14:20,189
boils down to in my mind anyways source

364
00:14:18,660 --> 00:14:22,379
and destination IP addresses source in

365
00:14:20,189 --> 00:14:25,110
this nation ports the amount<font color="#CCCCCC"> of data</font>

366
00:14:22,379 --> 00:14:26,490
that flowed and you get much more<font color="#CCCCCC"> though</font>

367
00:14:25,110 --> 00:14:28,500
you've<font color="#CCCCCC"> got the autonomous system stuff</font>

368
00:14:26,490 --> 00:14:30,689
that you can put it you can look at<font color="#E5E5E5"> you</font>

369
00:14:28,500 --> 00:14:34,769
can look at layer 3 routing that stuff

370
00:14:30,689 --> 00:14:40,620
is<font color="#E5E5E5"> being collected there's a lot</font><font color="#CCCCCC"> going</font>

371
00:14:34,769 --> 00:14:43,319
on so and then our traditional<font color="#CCCCCC"> IDs</font><font color="#E5E5E5"> and</font>

372
00:14:40,620 --> 00:14:45,990
IPS systems traditionally written to

373
00:14:43,319 --> 00:14:48,750
basically look for a certain pattern or

374
00:14:45,990 --> 00:14:49,709
signature usually<font color="#E5E5E5"> this technology is not</font>

375
00:14:48,750 --> 00:14:52,410
something that's going<font color="#E5E5E5"> to be doing a lot</font>

376
00:14:49,709 --> 00:14:54,329
<font color="#E5E5E5">of logging it's going to be alerting or</font>

377
00:14:52,410 --> 00:14:56,579
logging based off of what<font color="#E5E5E5"> it knows about</font>

378
00:14:54,329 --> 00:14:57,959
<font color="#E5E5E5">so aside from the other technologies</font>

379
00:14:56,579 --> 00:15:00,300
that are basically just collecting all

380
00:14:57,959 --> 00:15:01,949
the things this<font color="#E5E5E5"> is going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> be like</font><font color="#CCCCCC"> I'm</font>

381
00:15:00,300 --> 00:15:04,109
going to log or alert you on something

382
00:15:01,949 --> 00:15:07,889
<font color="#CCCCCC">that you tell me about going</font><font color="#E5E5E5"> forward</font>

383
00:15:04,110 --> 00:15:09,899
nothing really looking back there are

384
00:15:07,889 --> 00:15:12,269
you<font color="#CCCCCC"> know obviously</font><font color="#E5E5E5"> open source solutions</font>

385
00:15:09,899 --> 00:15:13,709
like snort suricata i mentioned<font color="#E5E5E5"> bro in</font>

386
00:15:12,269 --> 00:15:16,860
here<font color="#E5E5E5"> because it's labeled as an</font><font color="#CCCCCC"> ids and</font>

387
00:15:13,709 --> 00:15:18,660
<font color="#E5E5E5">can be</font><font color="#CCCCCC"> used as an ideas security onion</font>

388
00:15:16,860 --> 00:15:22,079
in rock n sm there are more<font color="#E5E5E5"> than just</font>

389
00:15:18,660 --> 00:15:25,170
IDS's<font color="#E5E5E5"> they're like compilations of ids</font>

390
00:15:22,079 --> 00:15:26,849
technology full packet capture logging

391
00:15:25,170 --> 00:15:29,009
elk<font color="#CCCCCC"> stack those</font><font color="#E5E5E5"> kinds of things there's</font>

392
00:15:26,850 --> 00:15:30,899
a lot of things<font color="#CCCCCC"> going on but I just kind</font>

393
00:15:29,009 --> 00:15:34,370
of threw<font color="#CCCCCC"> it into this live as a general</font>

394
00:15:30,899 --> 00:15:36,360
introduction or prevention type space

395
00:15:34,370 --> 00:15:40,589
and I'm not really<font color="#E5E5E5"> going to get into the</font>

396
00:15:36,360 --> 00:15:41,970
commercial space here but the pattern or

397
00:15:40,589 --> 00:15:45,029
at least<font color="#E5E5E5"> with the word technologies</font>

398
00:15:41,970 --> 00:15:46,769
going with future IDS's if you are more

399
00:15:45,029 --> 00:15:48,630
not just statically based but you know

400
00:15:46,769 --> 00:15:49,779
that behavioral stuff so pulling stuff

401
00:15:48,630 --> 00:15:51,819
off<font color="#CCCCCC"> the wire running</font>

402
00:15:49,779 --> 00:15:53,949
<font color="#CCCCCC">VMs those kinds of things I kind of</font>

403
00:15:51,819 --> 00:15:58,899
categories as category that is that as

404
00:15:53,949 --> 00:16:01,870
intrusion detection systems and then

405
00:15:58,899 --> 00:16:04,779
firewalls not going to go too far<font color="#CCCCCC"> into</font>

406
00:16:01,870 --> 00:16:07,089
this and<font color="#E5E5E5"> this is this can go off we</font>

407
00:16:04,779 --> 00:16:07,899
could you<font color="#CCCCCC"> know talk all day about what's</font>

408
00:16:07,089 --> 00:16:09,910
the difference between all these

409
00:16:07,899 --> 00:16:11,170
different types<font color="#CCCCCC"> of firewalls and they're</font>

410
00:16:09,910 --> 00:16:12,969
going to range across all different

411
00:16:11,170 --> 00:16:14,769
depending<font color="#CCCCCC"> on your environment and</font><font color="#E5E5E5"> what</font>

412
00:16:12,970 --> 00:16:16,449
firewalls kind of high waters we use and

413
00:16:14,769 --> 00:16:20,889
obviously the next-generation firewalls

414
00:16:16,449 --> 00:16:22,059
have everything maybe maybe not and but

415
00:16:20,889 --> 00:16:23,980
<font color="#E5E5E5">essentially from from this perspective</font>

416
00:16:22,059 --> 00:16:25,749
where we're going to look at here we

417
00:16:23,980 --> 00:16:27,610
really want to<font color="#E5E5E5"> know what were the IP</font>

418
00:16:25,749 --> 00:16:30,879
addresses that either flow through or

419
00:16:27,610 --> 00:16:33,459
stop on the firewall and maybe the and

420
00:16:30,879 --> 00:16:35,860
obviously the<font color="#E5E5E5"> ports the protocols and</font>

421
00:16:33,459 --> 00:16:42,609
the<font color="#E5E5E5"> ultimate question was it allowed or</font>

422
00:16:35,860 --> 00:16:44,680
was it not allowed and<font color="#CCCCCC"> so what I'd like</font>

423
00:16:42,610 --> 00:16:47,889
<font color="#CCCCCC">to do is actually</font><font color="#E5E5E5"> walk through a real</font>

424
00:16:44,680 --> 00:16:50,378
attack so this is<font color="#CCCCCC"> actually an example of</font>

425
00:16:47,889 --> 00:16:52,749
something that<font color="#E5E5E5"> I was looking at just I</font>

426
00:16:50,379 --> 00:16:55,149
think<font color="#CCCCCC"> the second week in may so this is</font>

427
00:16:52,749 --> 00:16:57,600
kind of fresh ransomware stuff or at

428
00:16:55,149 --> 00:17:00,819
least that you know a<font color="#CCCCCC"> couple weeks old</font>

429
00:16:57,600 --> 00:17:02,470
ransomware example and so the example is

430
00:17:00,819 --> 00:17:05,619
a malicious email comes in<font color="#E5E5E5"> war</font><font color="#CCCCCC"> doch</font>

431
00:17:02,470 --> 00:17:07,630
macro enabled stuff and then afterwards

432
00:17:05,619 --> 00:17:10,030
some DNS<font color="#E5E5E5"> requests and then you see some</font>

433
00:17:07,630 --> 00:17:12,640
get requests and then some<font color="#E5E5E5"> other type</font>

434
00:17:10,030 --> 00:17:14,168
beginning information so we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to</font>

435
00:17:12,640 --> 00:17:16,600
actually look at what that<font color="#E5E5E5"> means from a</font>

436
00:17:14,169 --> 00:17:18,549
full packet capture solution so if you

437
00:17:16,599 --> 00:17:21,280
have full packet capture we're looking

438
00:17:18,549 --> 00:17:23,079
at<font color="#E5E5E5"> the</font><font color="#CCCCCC"> email now I'm</font><font color="#E5E5E5"> trying to protect</font>

439
00:17:21,280 --> 00:17:25,178
some of<font color="#CCCCCC"> the innocent here but</font>

440
00:17:23,079 --> 00:17:27,220
essentially in this is the what what an

441
00:17:25,179 --> 00:17:29,409
SMTP message looks like raw if you ever

442
00:17:27,220 --> 00:17:30,610
looked<font color="#E5E5E5"> at it off the wire there's some</font>

443
00:17:29,409 --> 00:17:32,679
other<font color="#E5E5E5"> information that goes on between</font>

444
00:17:30,610 --> 00:17:34,149
two mtas they're going to do there since

445
00:17:32,679 --> 00:17:35,890
an ack ack and set up their<font color="#E5E5E5"> tcp</font>

446
00:17:34,149 --> 00:17:37,780
connection there do some smtp

447
00:17:35,890 --> 00:17:39,070
negotiation and then one's going to say

448
00:17:37,780 --> 00:17:40,539
i want<font color="#E5E5E5"> to send some data and then the</font>

449
00:17:39,070 --> 00:17:42,789
receivers gonna say<font color="#CCCCCC"> okay send it</font><font color="#E5E5E5"> and</font>

450
00:17:40,539 --> 00:17:44,440
this is the data<font color="#E5E5E5"> that comes so a lot of</font>

451
00:17:42,789 --> 00:17:46,539
people<font color="#E5E5E5"> like look at an email</font><font color="#CCCCCC"> and try to</font>

452
00:17:44,440 --> 00:17:49,000
dissect it say headers and bodies and

453
00:17:46,539 --> 00:17:51,039
bodies and headers but really a raw

454
00:17:49,000 --> 00:17:52,690
email is everything it's the headers and

455
00:17:51,039 --> 00:17:54,549
body there's no difference in a raw

456
00:17:52,690 --> 00:17:56,470
message and its really txt space it's

457
00:17:54,549 --> 00:17:59,679
always was originally meant<font color="#E5E5E5"> to be tech</font>

458
00:17:56,470 --> 00:18:02,230
space um but I'm splitting the view up

459
00:17:59,679 --> 00:18:03,880
here to show the headers in the body but

460
00:18:02,230 --> 00:18:05,470
we see we<font color="#CCCCCC"> can see</font><font color="#E5E5E5"> everything we</font><font color="#CCCCCC"> can see</font>

461
00:18:03,880 --> 00:18:06,820
all the receive hops we see all the

462
00:18:05,470 --> 00:18:08,919
information they're all the<font color="#CCCCCC"> servers</font><font color="#E5E5E5"> it</font>

463
00:18:06,820 --> 00:18:10,960
<font color="#E5E5E5">bounced around the ex mailer and my some</font>

464
00:18:08,919 --> 00:18:13,750
be some information that we could use

465
00:18:10,960 --> 00:18:15,580
<font color="#CCCCCC">later on and then we can see that</font><font color="#E5E5E5"> the</font>

466
00:18:13,750 --> 00:18:18,039
<font color="#E5E5E5">head there's the there is the attachment</font>

467
00:18:15,580 --> 00:18:20,049
name and then the base64 encoding again

468
00:18:18,039 --> 00:18:21,908
if you're not familiar with some of the

469
00:18:20,049 --> 00:18:23,710
encoding techniques basics before is one

470
00:18:21,909 --> 00:18:25,510
of the more popular encoding techniques

471
00:18:23,710 --> 00:18:29,049
to encode stuff that's<font color="#CCCCCC"> not playing text</font>

472
00:18:25,510 --> 00:18:30,158
/ smtp and so<font color="#E5E5E5"> that you see all that</font><font color="#CCCCCC"> you</font>

473
00:18:29,049 --> 00:18:31,770
have the attachment you could pull that

474
00:18:30,159 --> 00:18:34,510
<font color="#CCCCCC">out you can do whatever you want with it</font>

475
00:18:31,770 --> 00:18:36,129
<font color="#CCCCCC">and then moving on we see</font><font color="#E5E5E5"> that the</font>

476
00:18:34,510 --> 00:18:38,620
client got this email and clicked on it

477
00:18:36,130 --> 00:18:41,500
and then we see<font color="#CCCCCC"> that there was a get</font>

478
00:18:38,620 --> 00:18:43,750
request oracle com and then we<font color="#E5E5E5"> kind of</font>

479
00:18:41,500 --> 00:18:45,909
paste together try to you know put

480
00:18:43,750 --> 00:18:48,220
together the the client<font color="#CCCCCC"> request with the</font>

481
00:18:45,909 --> 00:18:49,870
client of the response and we see that

482
00:18:48,220 --> 00:18:54,220
you<font color="#E5E5E5"> know a valid IP address comes back</font>

483
00:18:49,870 --> 00:18:58,570
down and then<font color="#CCCCCC"> we see the same thing for</font>

484
00:18:54,220 --> 00:19:00,850
a somewhat new looking domain<font color="#CCCCCC"> pompeii</font>

485
00:18:58,570 --> 00:19:05,678
<font color="#E5E5E5">batch distribution com with another IP</font>

486
00:19:00,850 --> 00:19:07,840
address and then<font color="#E5E5E5"> shortly following this</font>

487
00:19:05,679 --> 00:19:10,360
activity we see there is also an HTTP

488
00:19:07,840 --> 00:19:13,120
GET request to the<font color="#E5E5E5"> local comm site as</font>

489
00:19:10,360 --> 00:19:14,770
well<font color="#CCCCCC"> i'm not showing</font><font color="#E5E5E5"> it here but we do</font>

490
00:19:13,120 --> 00:19:18,549
see is directly following off of a

491
00:19:14,770 --> 00:19:21,340
successful get request to the oracle com

492
00:19:18,549 --> 00:19:23,649
site we see a request for some HJ peg

493
00:19:21,340 --> 00:19:27,370
and we obviously see a valid<font color="#CCCCCC"> jpg come</font>

494
00:19:23,649 --> 00:19:28,899
down right so not not<font color="#CCCCCC"> really it turns</font>

495
00:19:27,370 --> 00:19:32,830
out that this is an<font color="#CCCCCC"> ex or encoded</font>

496
00:19:28,899 --> 00:19:34,870
<font color="#CCCCCC">Windows executable but we know</font><font color="#E5E5E5"> we can</font>

497
00:19:32,830 --> 00:19:36,460
see that now with full packet capture we

498
00:19:34,870 --> 00:19:38,408
follow the stream as we look we see oh

499
00:19:36,460 --> 00:19:40,149
yeah this is<font color="#E5E5E5"> this is interesting you're</font>

500
00:19:38,409 --> 00:19:41,919
<font color="#E5E5E5">definitely not a JPEG so we can pull</font>

501
00:19:40,149 --> 00:19:44,439
that off go through our decoder

502
00:19:41,919 --> 00:19:45,580
techniques and then say we have a

503
00:19:44,440 --> 00:19:48,309
Windows executable that<font color="#E5E5E5"> we've downloaded</font>

504
00:19:45,580 --> 00:19:51,908
and then<font color="#E5E5E5"> shortly following that we see</font>

505
00:19:48,309 --> 00:19:54,970
this beginning to over UDP 285 dot 93

506
00:19:51,909 --> 00:19:56,350
it's a / 18 which is kind of some kind

507
00:19:54,970 --> 00:19:57,850
<font color="#E5E5E5">of interesting information there's a</font>

508
00:19:56,350 --> 00:19:59,949
little bit of information in the payload

509
00:19:57,850 --> 00:20:01,809
of the UDP packet beginning information

510
00:19:59,950 --> 00:20:04,149
but we see all we know all we we have

511
00:20:01,809 --> 00:20:05,830
<font color="#E5E5E5">the full capture of the entire entire</font>

512
00:20:04,149 --> 00:20:09,639
incident if you will with full packet

513
00:20:05,830 --> 00:20:11,559
capture so now we move on to bro so we

514
00:20:09,639 --> 00:20:14,510
take the same attack and then we look at

515
00:20:11,559 --> 00:20:16,550
what did bro see so bro

516
00:20:14,510 --> 00:20:19,129
as I mentioned<font color="#CCCCCC"> is very application rich</font>

517
00:20:16,550 --> 00:20:20,780
a protocol where it's good if it knows

518
00:20:19,130 --> 00:20:22,640
<font color="#E5E5E5">about that application or protocol it's</font>

519
00:20:20,780 --> 00:20:24,710
going to write a log and in this case it

520
00:20:22,640 --> 00:20:26,240
sees a bunch of<font color="#E5E5E5"> things that happens it's</font>

521
00:20:24,710 --> 00:20:28,760
also an HTTP traffic so there's<font color="#E5E5E5"> going to</font>

522
00:20:26,240 --> 00:20:30,230
be a lot for that they saw some dns and

523
00:20:28,760 --> 00:20:33,350
<font color="#E5E5E5">some smtp traffic so there's going to be</font>

524
00:20:30,230 --> 00:20:35,480
a lot for that the con log is actually a

525
00:20:33,350 --> 00:20:38,179
log that<font color="#E5E5E5"> bro creates based off of any</font>

526
00:20:35,480 --> 00:20:39,860
connection that it sees and there's

527
00:20:38,180 --> 00:20:42,800
<font color="#E5E5E5">going to be a record there and then as</font>

528
00:20:39,860 --> 00:20:44,389
we're going to see going forward it

529
00:20:42,800 --> 00:20:46,280
creates a unique identifier you can

530
00:20:44,390 --> 00:20:47,870
track that unique identify exists

531
00:20:46,280 --> 00:20:50,420
throughout the<font color="#E5E5E5"> other blogs if that</font>

532
00:20:47,870 --> 00:20:52,729
connection had smtp or<font color="#E5E5E5"> ftp or whatever</font>

533
00:20:50,420 --> 00:20:54,020
it had you can track it on through so

534
00:20:52,730 --> 00:20:56,870
they separate the<font color="#CCCCCC"> logs so you can get</font>

535
00:20:54,020 --> 00:20:58,970
<font color="#E5E5E5">that granularity across that metadata if</font>

536
00:20:56,870 --> 00:21:01,010
you will and<font color="#CCCCCC"> then in</font><font color="#E5E5E5"> that connection log</font>

537
00:20:58,970 --> 00:21:02,720
is kind of like that the route where you

538
00:21:01,010 --> 00:21:05,840
go<font color="#E5E5E5"> to then say where do I need</font><font color="#CCCCCC"> to break</font>

539
00:21:02,720 --> 00:21:10,300
off to and then there's the files log

540
00:21:05,840 --> 00:21:13,280
that we're going<font color="#E5E5E5"> to look at as well so I</font>

541
00:21:10,300 --> 00:21:14,870
excuse the verbosity of the logging I

542
00:21:13,280 --> 00:21:16,639
actually trim some of this down but

543
00:21:14,870 --> 00:21:19,010
anybody that uses<font color="#CCCCCC"> Braugher</font><font color="#E5E5E5"> looks that</font>

544
00:21:16,640 --> 00:21:22,220
bro knows that it's extremely verbose or

545
00:21:19,010 --> 00:21:23,930
logging is there's a lot<font color="#CCCCCC"> going on but</font>

546
00:21:22,220 --> 00:21:27,800
essentially what we have here<font color="#CCCCCC"> is the</font>

547
00:21:23,930 --> 00:21:29,300
<font color="#E5E5E5">SMTP log of the of the data that that</font>

548
00:21:27,800 --> 00:21:30,770
message<font color="#CCCCCC"> that I showed you earlier full</font>

549
00:21:29,300 --> 00:21:32,899
packet capture we have that unique

550
00:21:30,770 --> 00:21:35,060
connection ID that I mentioned you<font color="#CCCCCC"> can</font>

551
00:21:32,900 --> 00:21:36,860
see the sender and IPS and I and I<font color="#CCCCCC"> X</font>

552
00:21:35,060 --> 00:21:38,090
those out but there's<font color="#E5E5E5"> there's a couple</font>

553
00:21:36,860 --> 00:21:39,889
email addresses that is actually

554
00:21:38,090 --> 00:21:41,720
recording which is which is<font color="#E5E5E5"> interesting</font>

555
00:21:39,890 --> 00:21:44,180
the first email<font color="#E5E5E5"> address is that smtp</font>

556
00:21:41,720 --> 00:21:45,740
mail from address from<font color="#E5E5E5"> zach in the</font>

557
00:21:44,180 --> 00:21:47,090
<font color="#E5E5E5">andrews presentation earlier you saw</font>

558
00:21:45,740 --> 00:21:48,770
that how they spoof they email and they

559
00:21:47,090 --> 00:21:50,810
went from there's a mail from<font color="#E5E5E5"> and then</font>

560
00:21:48,770 --> 00:21:52,660
there was also a from in the with<font color="#CCCCCC"> it was</font>

561
00:21:50,810 --> 00:21:55,820
considered the 822 message header from

562
00:21:52,660 --> 00:21:57,830
and so bro sees those both and they blog

563
00:21:55,820 --> 00:22:01,370
<font color="#CCCCCC">them both so you can actually</font><font color="#E5E5E5"> look there</font>

564
00:21:57,830 --> 00:22:03,020
the message ID is being saved the

565
00:22:01,370 --> 00:22:05,120
subject which is that<font color="#E5E5E5"> Chester blancher</font>

566
00:22:03,020 --> 00:22:07,280
that's subject what's<font color="#E5E5E5"> really cool is</font>

567
00:22:05,120 --> 00:22:08,659
<font color="#CCCCCC">Bros seeing all those upstream IPS and</font>

568
00:22:07,280 --> 00:22:10,010
it's actually logging them

569
00:22:08,660 --> 00:22:12,290
<font color="#CCCCCC">comma-delimited</font><font color="#E5E5E5"> so that's what all those</font>

570
00:22:10,010 --> 00:22:14,060
IP address as you see it sees the<font color="#E5E5E5"> ex</font>

571
00:22:12,290 --> 00:22:16,639
<font color="#E5E5E5">mailers longing that and then there's</font>

572
00:22:14,060 --> 00:22:19,520
these<font color="#E5E5E5"> f looking unique identifiers</font><font color="#CCCCCC"> error</font>

573
00:22:16,640 --> 00:22:23,150
like the connection<font color="#CCCCCC"> ID ID but the fids</font>

574
00:22:19,520 --> 00:22:26,000
are actually unique identified enta

575
00:22:23,150 --> 00:22:27,910
fires but particularly to file so if bro

576
00:22:26,000 --> 00:22:29,770
sees a file over the wire

577
00:22:27,910 --> 00:22:31,270
it's gonna it's going to log that in the

578
00:22:29,770 --> 00:22:35,200
files log and then you can actually

579
00:22:31,270 --> 00:22:37,030
pivot into and pivot around to just say

580
00:22:35,200 --> 00:22:38,980
show me more about that<font color="#E5E5E5"> particular file</font>

581
00:22:37,030 --> 00:22:41,560
file now the reason why we see to file

582
00:22:38,980 --> 00:22:44,410
IDs there is because<font color="#E5E5E5"> in the SMP message</font>

583
00:22:41,560 --> 00:22:46,360
that we saw the attachment was one line

584
00:22:44,410 --> 00:22:48,370
type or one attachment if you will and

585
00:22:46,360 --> 00:22:51,040
the second file was actually the body

586
00:22:48,370 --> 00:22:53,620
the hello please open this kind of thing

587
00:22:51,040 --> 00:22:55,510
that's a text file and took<font color="#CCCCCC"> two desam TV</font>

588
00:22:53,620 --> 00:22:57,729
protocol and<font color="#CCCCCC"> toubro that's another file</font>

589
00:22:55,510 --> 00:22:59,650
type it's just a text file so<font color="#CCCCCC"> we don't</font>

590
00:22:57,730 --> 00:23:02,590
really<font color="#CCCCCC"> care about</font><font color="#E5E5E5"> the first one but we</font>

591
00:22:59,650 --> 00:23:06,220
do care about the second<font color="#E5E5E5"> one in this</font>

592
00:23:02,590 --> 00:23:08,709
case bro also does magic well you know

593
00:23:06,220 --> 00:23:11,050
it not so much magic magic but it

594
00:23:08,710 --> 00:23:13,210
actually is looking into looking into

595
00:23:11,050 --> 00:23:14,500
the file the<font color="#E5E5E5"> magic of the file and is</font>

596
00:23:13,210 --> 00:23:16,660
matching that<font color="#E5E5E5"> up with a library that it</font>

597
00:23:14,500 --> 00:23:18,880
has and so it doesn't<font color="#E5E5E5"> really matter what</font>

598
00:23:16,660 --> 00:23:21,550
<font color="#E5E5E5">you name the file extension if it's a</font>

599
00:23:18,880 --> 00:23:24,820
dot exe it's going to log it as a as a

600
00:23:21,550 --> 00:23:27,550
the magic of an<font color="#E5E5E5"> exe in this case it logs</font>

601
00:23:24,820 --> 00:23:29,080
it as a as a<font color="#E5E5E5"> Word document in</font><font color="#CCCCCC"> the</font>

602
00:23:27,550 --> 00:23:32,680
correct format that the new xml-based

603
00:23:29,080 --> 00:23:34,449
word format and because i'm<font color="#CCCCCC"> using the</font>

604
00:23:32,680 --> 00:23:36,640
and then there's the attachment name and

605
00:23:34,450 --> 00:23:38,200
because i'm<font color="#CCCCCC"> using the file analyzer and</font>

606
00:23:36,640 --> 00:23:40,080
attaching that<font color="#E5E5E5"> files analyzer and that's</font>

607
00:23:38,200 --> 00:23:43,060
a framework out discuss in a little bit

608
00:23:40,080 --> 00:23:44,470
<font color="#CCCCCC">i'd say when you see a file go ahead and</font>

609
00:23:43,060 --> 00:23:45,730
<font color="#CCCCCC">give me</font><font color="#E5E5E5"> the Ambu five-inch ah one of</font>

610
00:23:44,470 --> 00:23:47,380
that file as well so that's what

611
00:23:45,730 --> 00:23:49,570
actually those two values that are going

612
00:23:47,380 --> 00:23:51,430
there so so we lose a tiny bit of

613
00:23:49,570 --> 00:23:53,080
context we don't have the raw actual

614
00:23:51,430 --> 00:23:57,130
<font color="#CCCCCC">attachment but we</font><font color="#E5E5E5"> have a lot of</font>

615
00:23:53,080 --> 00:23:59,770
information<font color="#CCCCCC"> about</font><font color="#E5E5E5"> that attachment so</font>

616
00:23:57,130 --> 00:24:02,740
<font color="#E5E5E5">that moving on the dns venus is kind of</font>

617
00:23:59,770 --> 00:24:05,650
interesting<font color="#E5E5E5"> because bro attacks UDP</font>

618
00:24:02,740 --> 00:24:07,810
traffic in a unit in a very unique way

619
00:24:05,650 --> 00:24:09,940
some way I<font color="#CCCCCC"> never really saw</font><font color="#E5E5E5"> before until</font>

620
00:24:07,810 --> 00:24:14,320
<font color="#E5E5E5">I started looking at bro because UDP is</font>

621
00:24:09,940 --> 00:24:15,970
a stateless protocol bro tries to<font color="#CCCCCC"> look</font>

622
00:24:14,320 --> 00:24:17,679
for those responses and if they've

623
00:24:15,970 --> 00:24:19,900
seized the response puts that entire

624
00:24:17,680 --> 00:24:22,570
message on one line so in sentence<font color="#CCCCCC"> Bros</font>

625
00:24:19,900 --> 00:24:24,370
actually adding somewhat of a state to a

626
00:24:22,570 --> 00:24:26,560
stateless protocol so it's kind of

627
00:24:24,370 --> 00:24:28,120
interesting<font color="#CCCCCC"> in need in this case it saw</font>

628
00:24:26,560 --> 00:24:30,429
the response their request for depth of

629
00:24:28,120 --> 00:24:31,929
<font color="#CCCCCC">that whirlpool com it said here's your</font>

630
00:24:30,430 --> 00:24:33,820
here's your answers that come back you

631
00:24:31,930 --> 00:24:35,290
see the comma delimited answers and then

632
00:24:33,820 --> 00:24:36,820
you actually see the TTL is that come

633
00:24:35,290 --> 00:24:38,320
back with<font color="#E5E5E5"> that answer now there's other</font>

634
00:24:36,820 --> 00:24:39,810
there's more information i took out of

635
00:24:38,320 --> 00:24:41,189
this<font color="#CCCCCC"> on there is a</font>

636
00:24:39,810 --> 00:24:43,139
<font color="#CCCCCC">her type and you would see would be</font>

637
00:24:41,190 --> 00:24:44,610
afford a look up and there's a couple

638
00:24:43,140 --> 00:24:46,500
other<font color="#CCCCCC"> things</font><font color="#E5E5E5"> that could be but I wanted</font>

639
00:24:44,610 --> 00:24:48,629
to<font color="#E5E5E5"> kind of keep it as slim as possible</font>

640
00:24:46,500 --> 00:24:51,180
and then<font color="#CCCCCC"> we see the Pompeii that</font>

641
00:24:48,630 --> 00:24:52,590
distribution calm and now because this

642
00:24:51,180 --> 00:24:55,440
UDP traffic is a different connection

643
00:24:52,590 --> 00:24:56,879
then what's going to follow of HTTP we

644
00:24:55,440 --> 00:24:59,070
can see<font color="#CCCCCC"> okay here's</font><font color="#E5E5E5"> what the answers</font>

645
00:24:56,880 --> 00:25:01,020
that came back now let's look in<font color="#CCCCCC"> the</font>

646
00:24:59,070 --> 00:25:03,120
common law to see that we see anything

647
00:25:01,020 --> 00:25:05,370
<font color="#E5E5E5">to these two IP addresses</font><font color="#CCCCCC"> and sure</font>

648
00:25:03,120 --> 00:25:11,850
enough we have communication to the two

649
00:25:05,370 --> 00:25:13,199
IP addresses<font color="#CCCCCC"> and then pivoting off the</font>

650
00:25:11,850 --> 00:25:15,090
connection ID now that we found in the

651
00:25:13,200 --> 00:25:18,540
common log we can then<font color="#CCCCCC"> go into an</font>

652
00:25:15,090 --> 00:25:21,270
<font color="#E5E5E5">extremely verbose log source in SD HTTP</font>

653
00:25:18,540 --> 00:25:23,010
log now bro is not good not logging

654
00:25:21,270 --> 00:25:24,660
everything it sees over HTTP there's so

655
00:25:23,010 --> 00:25:27,450
much that goes on but it's trying to

656
00:25:24,660 --> 00:25:29,400
capture as much as as much as it can so

657
00:25:27,450 --> 00:25:34,290
we see the the source<font color="#E5E5E5"> and destination IP</font>

658
00:25:29,400 --> 00:25:37,590
s we see the<font color="#E5E5E5"> host name we see the user</font>

659
00:25:34,290 --> 00:25:39,180
agent we see the actual response HTTP

660
00:25:37,590 --> 00:25:40,980
response so first it was a 301 moved

661
00:25:39,180 --> 00:25:42,990
then it was a 206 partial content and

662
00:25:40,980 --> 00:25:50,610
then again for<font color="#E5E5E5"> another but then as we</font>

663
00:25:42,990 --> 00:25:56,330
look in<font color="#E5E5E5"> here</font><font color="#CCCCCC"> and we have</font><font color="#E5E5E5"> that files ID</font>

664
00:25:50,610 --> 00:26:00,679
we see<font color="#CCCCCC"> that it was</font><font color="#E5E5E5"> recorded over HTTP</font>

665
00:25:56,330 --> 00:26:00,679
but when it tried<font color="#CCCCCC"> to do that</font><font color="#E5E5E5"> magic</font>

666
00:26:02,120 --> 00:26:06,870
analysis on the file<font color="#E5E5E5"> I try to look at</font>

667
00:26:04,260 --> 00:26:11,580
see what what file type that was it came

668
00:26:06,870 --> 00:26:13,350
up empty so so in this case in that<font color="#E5E5E5"> case</font>

669
00:26:11,580 --> 00:26:15,090
we<font color="#E5E5E5"> actually start to lose more context</font>

670
00:26:13,350 --> 00:26:17,070
we<font color="#CCCCCC"> saw it we</font><font color="#E5E5E5"> lost a little bit more so</font>

671
00:26:15,090 --> 00:26:19,290
so bro saw that traffic and

672
00:26:17,070 --> 00:26:20,820
unfortunately it's off<font color="#E5E5E5"> I'll now we did</font>

673
00:26:19,290 --> 00:26:23,190
have the file size you want<font color="#E5E5E5"> to go back</font>

674
00:26:20,820 --> 00:26:26,040
real quick we could see there was 40 411

675
00:26:23,190 --> 00:26:28,620
k of a file that was downloaded but we

676
00:26:26,040 --> 00:26:32,730
just don't know what what type of file

677
00:26:28,620 --> 00:26:37,020
that was and then<font color="#E5E5E5"> finally that this UDP</font>

678
00:26:32,730 --> 00:26:39,180
beaconing essentially it was<font color="#CCCCCC"> a / 18 it</font>

679
00:26:37,020 --> 00:26:41,430
created 32,000 packets because even

680
00:26:39,180 --> 00:26:44,520
though there's only 16,000 something

681
00:26:41,430 --> 00:26:46,590
blocks in / 18 it did this twice so I

682
00:26:44,520 --> 00:26:48,480
think<font color="#E5E5E5"> the first time it started off / /</font>

683
00:26:46,590 --> 00:26:50,970
port 68 92 and then it went to<font color="#E5E5E5"> earth</font>

684
00:26:48,480 --> 00:26:52,980
1691 and then the second efforts were

685
00:26:50,970 --> 00:26:54,960
starting off with port 1690

686
00:26:52,980 --> 00:26:56,910
92 but what's interesting though is I

687
00:26:54,960 --> 00:26:59,370
kind of like I did I trim this<font color="#CCCCCC"> conlogue</font>

688
00:26:56,910 --> 00:27:00,900
down a lot but I wanted<font color="#CCCCCC"> to</font><font color="#E5E5E5"> show this s0</font>

689
00:26:59,370 --> 00:27:07,760
flag does anybody know what that s0

690
00:27:00,900 --> 00:27:10,290
actually is indicating umbro anyway um

691
00:27:07,760 --> 00:27:12,120
it's actually saying that it saw a UDP

692
00:27:10,290 --> 00:27:14,909
packet out but it didn't see your

693
00:27:12,120 --> 00:27:17,729
response back so so it's kind of cool

694
00:27:14,910 --> 00:27:19,919
like that like going back<font color="#CCCCCC"> to that adding</font>

695
00:27:17,730 --> 00:27:27,030
state to a stateless protocol it's a

696
00:27:19,919 --> 00:27:29,370
neat concept so we saw we saw this over

697
00:27:27,030 --> 00:27:30,629
smtp where we got a lot of information

698
00:27:29,370 --> 00:27:32,668
<font color="#E5E5E5">over innocence you pretty much lost</font>

699
00:27:30,630 --> 00:27:34,890
nothing other than the raw attachment

700
00:27:32,669 --> 00:27:36,960
but we got the hashes we get the name

701
00:27:34,890 --> 00:27:37,950
the size<font color="#E5E5E5"> we got a proponent pretty much</font>

702
00:27:36,960 --> 00:27:40,169
everything in the header there's a

703
00:27:37,950 --> 00:27:41,549
<font color="#E5E5E5">little bit stuff that we missed in the</font>

704
00:27:40,169 --> 00:27:44,100
header but for the most part we got a

705
00:27:41,549 --> 00:27:46,110
lot of rich information that we can use

706
00:27:44,100 --> 00:27:49,678
<font color="#E5E5E5">those as indicators going back and the</font>

707
00:27:46,110 --> 00:27:52,559
header the<font color="#CCCCCC"> dns we have everything we</font>

708
00:27:49,679 --> 00:27:53,850
lost<font color="#E5E5E5"> nothing in dns essentially and then</font>

709
00:27:52,559 --> 00:27:56,760
we<font color="#E5E5E5"> lost a little bit as we started going</font>

710
00:27:53,850 --> 00:27:57,928
<font color="#E5E5E5">down HTTP and then in the con la gwee</font>

711
00:27:56,760 --> 00:27:59,070
got everything<font color="#E5E5E5"> but we just don't have</font>

712
00:27:57,929 --> 00:28:04,620
the payload that<font color="#CCCCCC"> was sent in that</font>

713
00:27:59,070 --> 00:28:07,770
beaconing information so look moving on

714
00:28:04,620 --> 00:28:09,659
in kind<font color="#E5E5E5"> of like</font><font color="#CCCCCC"> looking at what what</font>

715
00:28:07,770 --> 00:28:11,370
flow data would show you in this

716
00:28:09,660 --> 00:28:16,850
<font color="#E5E5E5">incident and showing how much context</font>

717
00:28:11,370 --> 00:28:19,439
that we start to lose so so essentially

718
00:28:16,850 --> 00:28:20,699
because we lose all this context a lot

719
00:28:19,440 --> 00:28:22,290
of this stuff is going<font color="#E5E5E5"> to start to blend</font>

720
00:28:20,700 --> 00:28:24,179
in with your corporate network now you

721
00:28:22,290 --> 00:28:26,159
might because you have those those

722
00:28:24,179 --> 00:28:27,540
publicly adjustable IP addresses you

723
00:28:26,160 --> 00:28:30,059
might be able<font color="#E5E5E5"> to key off of those things</font>

724
00:28:27,540 --> 00:28:31,230
in all these<font color="#CCCCCC"> different types</font><font color="#E5E5E5"> of all</font>

725
00:28:30,059 --> 00:28:33,570
these<font color="#E5E5E5"> different type of log sources</font>

726
00:28:31,230 --> 00:28:35,669
venus is<font color="#CCCCCC"> going</font><font color="#E5E5E5"> to be harder to do unless</font>

727
00:28:33,570 --> 00:28:37,740
you're actually you know<font color="#E5E5E5"> from a flow</font>

728
00:28:35,669 --> 00:28:39,960
perspective in a firewall perspective

729
00:28:37,740 --> 00:28:41,250
<font color="#E5E5E5">DNS is going to be just regular DMS</font>

730
00:28:39,960 --> 00:28:42,900
traffic unless we're talking about<font color="#E5E5E5"> dns</font>

731
00:28:41,250 --> 00:28:44,400
<font color="#CCCCCC">tunneling nothing's really going to</font>

732
00:28:42,900 --> 00:28:46,650
stick out here with just general Ford

733
00:28:44,400 --> 00:28:49,500
look upset then that then end up being

734
00:28:46,650 --> 00:28:50,940
HTTP four get requests or whatnot that

735
00:28:49,500 --> 00:28:55,140
traffic is all going to just blend in

736
00:28:50,940 --> 00:28:57,030
with your corporate corporate data so

737
00:28:55,140 --> 00:29:02,520
just real quick and then others probably

738
00:28:57,030 --> 00:29:05,158
<font color="#E5E5E5">tough the to see but essentially that's</font>

739
00:29:02,520 --> 00:29:06,690
the information we<font color="#CCCCCC"> have on the SMTP so</font>

740
00:29:05,159 --> 00:29:09,800
we have one flow record from<font color="#CCCCCC"> the</font>

741
00:29:06,690 --> 00:29:12,210
receiver from the receiving<font color="#E5E5E5"> MTA from the</font>

742
00:29:09,800 --> 00:29:14,370
sending MTA<font color="#CCCCCC"> and then one from the</font>

743
00:29:12,210 --> 00:29:15,870
sending MTA to the receiving MTA and you

744
00:29:14,370 --> 00:29:18,090
can see<font color="#CCCCCC"> that the amount of bytes was</font>

745
00:29:15,870 --> 00:29:20,370
much higher coming from the the sending

746
00:29:18,090 --> 00:29:23,580
mail server to the receiving mail server

747
00:29:20,370 --> 00:29:25,350
but especially that's all we have our

748
00:29:23,580 --> 00:29:30,899
DNS traffic this<font color="#CCCCCC"> is going to just blend</font>

749
00:29:25,350 --> 00:29:31,919
right in and then HTTP essentially the

750
00:29:30,900 --> 00:29:35,220
only thing you're going<font color="#E5E5E5"> to have is those</font>

751
00:29:31,920 --> 00:29:37,260
public IP addresses you're just going to

752
00:29:35,220 --> 00:29:41,400
see yes it went out to port 80 and this

753
00:29:37,260 --> 00:29:42,420
is how many<font color="#E5E5E5"> bytes flowed and then</font>

754
00:29:41,400 --> 00:29:43,350
there's your beginning information now

755
00:29:42,420 --> 00:29:45,000
the beginning information might be

756
00:29:43,350 --> 00:29:46,230
<font color="#E5E5E5">something that you could detect with</font>

757
00:29:45,000 --> 00:29:49,950
flow because you're<font color="#E5E5E5"> going to see these</font>

758
00:29:46,230 --> 00:29:53,670
beacons and up also port over port 6890

759
00:29:49,950 --> 00:29:54,960
<font color="#CCCCCC">too as well</font><font color="#E5E5E5"> as in your firewall on so</font>

760
00:29:53,670 --> 00:29:56,550
there's the kind<font color="#CCCCCC"> of a snippet of what</font>

761
00:29:54,960 --> 00:29:58,140
firewall so instead of<font color="#E5E5E5"> having to flow</font>

762
00:29:56,550 --> 00:30:01,110
records now we just have one<font color="#E5E5E5"> entry that</font>

763
00:29:58,140 --> 00:30:03,960
yes we allowed smtp inbound over 425

764
00:30:01,110 --> 00:30:08,639
that's nice to know and then yes we

765
00:30:03,960 --> 00:30:11,580
allow dns and yes we allow that HTTP

766
00:30:08,640 --> 00:30:13,020
connection to to that IP address but

767
00:30:11,580 --> 00:30:15,210
that beginning information you know

768
00:30:13,020 --> 00:30:18,300
obviously this firewall was<font color="#E5E5E5"> configured</font>

769
00:30:15,210 --> 00:30:20,370
to allow I'll about 60 and 90<font color="#E5E5E5"> to but</font>

770
00:30:18,300 --> 00:30:22,290
<font color="#E5E5E5">that we have all that information but</font><font color="#CCCCCC"> we</font>

771
00:30:20,370 --> 00:30:27,780
lost all that context around that

772
00:30:22,290 --> 00:30:29,460
incident so for the second scenario<font color="#E5E5E5"> I</font>

773
00:30:27,780 --> 00:30:30,930
wasn't going to<font color="#E5E5E5"> go into deep dive in</font>

774
00:30:29,460 --> 00:30:33,540
actual insane by the way does<font color="#E5E5E5"> anybody</font>

775
00:30:30,930 --> 00:30:40,410
know what particular ransomware family

776
00:30:33,540 --> 00:30:44,480
that was no it was server so the server

777
00:30:40,410 --> 00:30:46,500
stuff it's<font color="#E5E5E5"> kind of been the latest round</font>

778
00:30:44,480 --> 00:30:48,060
but but essentially<font color="#E5E5E5"> what i did was i</font>

779
00:30:46,500 --> 00:30:50,160
wanted to take a sample size over an

780
00:30:48,060 --> 00:30:51,570
hour say and again depending on how big

781
00:30:50,160 --> 00:30:53,160
your network is<font color="#E5E5E5"> this might be a small</font>

782
00:30:51,570 --> 00:30:55,860
<font color="#E5E5E5">sample size or it might be a large</font>

783
00:30:53,160 --> 00:30:57,660
<font color="#E5E5E5">sample size but i wanted to take so you</font>

784
00:30:55,860 --> 00:30:59,189
have an hour worth of pcap and then<font color="#CCCCCC"> your</font>

785
00:30:57,660 --> 00:31:00,930
as an instant responder you're told

786
00:30:59,190 --> 00:31:05,300
<font color="#E5E5E5">something suspicious happen in this out</font>

787
00:31:00,930 --> 00:31:08,520
so find it so you have 150 gigs of pecan

788
00:31:05,300 --> 00:31:10,770
that kind of<font color="#E5E5E5"> you know going through my</font>

789
00:31:08,520 --> 00:31:12,900
sample set anyways came down to when i

790
00:31:10,770 --> 00:31:15,300
run those peak apps through bro gives me

791
00:31:12,900 --> 00:31:16,860
about forty eight gigs but we see those

792
00:31:15,300 --> 00:31:19,050
two data sources that are exponentially

793
00:31:16,860 --> 00:31:20,039
greater than<font color="#E5E5E5"> i'm just doing with with</font>

794
00:31:19,050 --> 00:31:23,700
flows

795
00:31:20,039 --> 00:31:25,649
and our firewall logs and fortunately

796
00:31:23,700 --> 00:31:28,979
for us those those two big data sources

797
00:31:25,649 --> 00:31:31,320
do compress pretty well I just<font color="#E5E5E5"> use gzip</font>

798
00:31:28,979 --> 00:31:34,049
compression and we see we have a

799
00:31:31,320 --> 00:31:37,710
six-fold six times efficiency rate if we

800
00:31:34,049 --> 00:31:40,200
can press our full pcap will almost set

801
00:31:37,710 --> 00:31:42,809
it for bro and then as we go go<font color="#E5E5E5"> down</font>

802
00:31:40,200 --> 00:31:44,190
that stack that stuff compresses really

803
00:31:42,809 --> 00:31:53,908
well we can keep this up a really long

804
00:31:44,190 --> 00:31:55,619
time<font color="#E5E5E5"> so and not to kind of go into the</font>

805
00:31:53,909 --> 00:31:57,570
pyramid of<font color="#E5E5E5"> pain from some of the other</font>

806
00:31:55,619 --> 00:31:59,609
examples that were shown but this<font color="#E5E5E5"> is my</font>

807
00:31:57,570 --> 00:32:02,309
land pyramid of pain as far as dealing

808
00:31:59,609 --> 00:32:04,649
with<font color="#E5E5E5"> lots of data and being able to</font>

809
00:32:02,309 --> 00:32:07,229
search that data so we want context

810
00:32:04,649 --> 00:32:09,869
context as our<font color="#E5E5E5"> friend but</font><font color="#CCCCCC"> as we go down</font>

811
00:32:07,229 --> 00:32:11,999
the stack and we try to grab that

812
00:32:09,869 --> 00:32:14,789
context<font color="#E5E5E5"> we obviously see that the</font>

813
00:32:11,999 --> 00:32:17,369
searching is painful and then if we flip

814
00:32:14,789 --> 00:32:20,039
that pyramid over we could see that time

815
00:32:17,369 --> 00:32:22,738
is not our friend it's unless you have

816
00:32:20,039 --> 00:32:25,080
unlimited this space as<font color="#E5E5E5"> we go down in</font>

817
00:32:22,739 --> 00:32:27,299
time we start to lose our data so that

818
00:32:25,080 --> 00:32:30,228
context for its data is going to have to

819
00:32:27,299 --> 00:32:33,330
then start to roll and so with that said

820
00:32:30,229 --> 00:32:35,039
time being if you come into<font color="#E5E5E5"> an incident</font>

821
00:32:33,330 --> 00:32:37,649
30 days after you've<font color="#E5E5E5"> been told about it</font>

822
00:32:35,039 --> 00:32:39,539
<font color="#E5E5E5">you may not necessarily</font><font color="#CCCCCC"> have the full</font>

823
00:32:37,649 --> 00:32:41,008
pcap hopefully you'll be able<font color="#E5E5E5"> to have</font>

824
00:32:39,539 --> 00:32:46,799
something<font color="#E5E5E5"> like bro that can give you</font>

825
00:32:41,009 --> 00:32:48,899
that so some information back<font color="#CCCCCC"> and this</font>

826
00:32:46,799 --> 00:32:51,359
<font color="#E5E5E5">is just a quick little matrix that I put</font>

827
00:32:48,899 --> 00:32:53,279
together really everything in green is

828
00:32:51,359 --> 00:32:55,649
is is a pro for that technology

829
00:32:53,279 --> 00:32:57,119
everything<font color="#CCCCCC"> in red the negative and then</font>

830
00:32:55,649 --> 00:32:59,279
I kind of put<font color="#CCCCCC"> some babies out there</font>

831
00:32:57,119 --> 00:33:00,779
depending on<font color="#E5E5E5"> you know is bro easily</font>

832
00:32:59,279 --> 00:33:02,519
searchable yeah it's easily searchable

833
00:33:00,779 --> 00:33:04,799
in my case it's easily searchable maybe

834
00:33:02,519 --> 00:33:08,190
in a week or two but if you don't<font color="#E5E5E5"> have</font>

835
00:33:04,799 --> 00:33:09,418
<font color="#CCCCCC">something like splunk or using something</font>

836
00:33:08,190 --> 00:33:10,979
like<font color="#CCCCCC"> elastic search or something like</font>

837
00:33:09,419 --> 00:33:13,379
that that's going<font color="#E5E5E5"> to help you maybe you</font>

838
00:33:10,979 --> 00:33:14,549
write your<font color="#E5E5E5"> own custom indexers sometimes</font>

839
00:33:13,379 --> 00:33:16,439
that data is going<font color="#E5E5E5"> to then start to</font>

840
00:33:14,549 --> 00:33:18,658
<font color="#E5E5E5">grunt especially with your HTTP logs</font>

841
00:33:16,440 --> 00:33:21,239
<font color="#CCCCCC">York on logs and your DNS log stuff that</font>

842
00:33:18,659 --> 00:33:22,889
traffic is just going<font color="#E5E5E5"> crazy on your</font>

843
00:33:21,239 --> 00:33:24,509
network those logs are going to get

844
00:33:22,889 --> 00:33:25,918
<font color="#E5E5E5">really big and it's going to be it's</font>

845
00:33:24,509 --> 00:33:27,359
going to be hard to<font color="#E5E5E5"> search over time so</font>

846
00:33:25,919 --> 00:33:28,889
<font color="#E5E5E5">I'll leave that one is that maybe</font>

847
00:33:27,359 --> 00:33:30,960
because there's something<font color="#CCCCCC"> you can do to</font>

848
00:33:28,889 --> 00:33:33,119
help help yourselves with on but

849
00:33:30,960 --> 00:33:34,370
essentially we're looking for going down

850
00:33:33,119 --> 00:33:37,350
<font color="#CCCCCC">these Kyle</font>

851
00:33:34,370 --> 00:33:40,229
application-specific is<font color="#E5E5E5"> well is what is</font>

852
00:33:37,350 --> 00:33:41,490
is a negative here so we want something

853
00:33:40,230 --> 00:33:43,710
<font color="#E5E5E5">that will scale across multiple</font>

854
00:33:41,490 --> 00:33:45,059
applications multiple protocols that we

855
00:33:43,710 --> 00:33:47,279
could put at those critical choke points

856
00:33:45,059 --> 00:33:49,350
and it does<font color="#E5E5E5"> all these things so</font>

857
00:33:47,279 --> 00:33:51,120
obviously that's your negative for those

858
00:33:49,350 --> 00:33:54,029
some of<font color="#E5E5E5"> those specific proxies or those</font>

859
00:33:51,120 --> 00:33:55,439
application proxies specifically and

860
00:33:54,029 --> 00:33:58,140
then we want the context we want that

861
00:33:55,440 --> 00:34:01,710
<font color="#E5E5E5">rich context we lose a lot of that would</font>

862
00:33:58,140 --> 00:34:04,200
flows and with our wall look back

863
00:34:01,710 --> 00:34:06,510
capability again as<font color="#E5E5E5"> I mentioned with</font><font color="#CCCCCC"> the</font>

864
00:34:04,200 --> 00:34:08,220
traditional ids is you have a signature

865
00:34:06,510 --> 00:34:10,109
<font color="#E5E5E5">that you put in and it's only really</font>

866
00:34:08,219 --> 00:34:11,598
efficiently for<font color="#E5E5E5"> going forward you don't</font>

867
00:34:10,109 --> 00:34:15,299
really<font color="#E5E5E5"> have that capability to go back</font>

868
00:34:11,599 --> 00:34:17,399
and so that's really<font color="#E5E5E5"> critical in a lot</font>

869
00:34:15,300 --> 00:34:20,849
of<font color="#E5E5E5"> cases because I don't</font><font color="#CCCCCC"> think most</font>

870
00:34:17,399 --> 00:34:22,379
instant response teams can afford<font color="#E5E5E5"> to not</font>

871
00:34:20,849 --> 00:34:23,820
be able<font color="#E5E5E5"> to look back you got to be able</font>

872
00:34:22,379 --> 00:34:25,290
<font color="#E5E5E5">to look back things are going to come</font>

873
00:34:23,820 --> 00:34:26,520
<font color="#CCCCCC">out and then you need to be able to</font><font color="#E5E5E5"> I</font>

874
00:34:25,290 --> 00:34:28,409
think there<font color="#E5E5E5"> was mentioned earlier that</font>

875
00:34:26,520 --> 00:34:30,389
hashes are a very little value and I

876
00:34:28,409 --> 00:34:32,070
agree with<font color="#CCCCCC"> that moving forward</font><font color="#E5E5E5"> but</font>

877
00:34:30,389 --> 00:34:33,599
hashes are great value for looking back

878
00:34:32,070 --> 00:34:37,700
especially said have I ever<font color="#E5E5E5"> seen this</font>

879
00:34:33,599 --> 00:34:39,869
hash before um those kinds of things so

880
00:34:37,699 --> 00:34:41,158
obviously you want it to<font color="#E5E5E5"> be scalable</font>

881
00:34:39,869 --> 00:34:42,929
across the network I believe you<font color="#E5E5E5"> can</font>

882
00:34:41,159 --> 00:34:44,940
make them float definitely a scalable

883
00:34:42,929 --> 00:34:46,980
across network I believe you can make

884
00:34:44,940 --> 00:34:48,149
bro something that's scalable across the

885
00:34:46,980 --> 00:34:49,619
network but some of the other

886
00:34:48,149 --> 00:34:51,719
technologies will start to<font color="#E5E5E5"> get a little</font>

887
00:34:49,619 --> 00:34:55,800
<font color="#E5E5E5">bit more difficult and then ease of</font>

888
00:34:51,719 --> 00:34:57,240
storage obviously a full<font color="#E5E5E5"> pcap is going</font>

889
00:34:55,800 --> 00:35:03,450
to be your biggest enemy when it comes

890
00:34:57,240 --> 00:35:06,750
to<font color="#E5E5E5"> dis storage so kind of going into bro</font>

891
00:35:03,450 --> 00:35:09,060
itself as<font color="#E5E5E5"> I mentioned it's over 20 years</font>

892
00:35:06,750 --> 00:35:10,380
old it's doing all these great things

893
00:35:09,060 --> 00:35:14,190
right<font color="#E5E5E5"> it's understanding all these</font>

894
00:35:10,380 --> 00:35:15,570
protocols that that you might not<font color="#CCCCCC"> even</font>

895
00:35:14,190 --> 00:35:18,390
know our existing on your network and

896
00:35:15,570 --> 00:35:21,210
<font color="#CCCCCC">then there's all these these frameworks</font>

897
00:35:18,390 --> 00:35:23,940
that actually build and<font color="#E5E5E5"> make up bro the</font>

898
00:35:21,210 --> 00:35:26,790
bros also kind of there's a there's a

899
00:35:23,940 --> 00:35:28,230
script land a bro and then<font color="#E5E5E5"> there's it's</font>

900
00:35:26,790 --> 00:35:30,900
a kind<font color="#E5E5E5"> of built off of these these</font>

901
00:35:28,230 --> 00:35:32,490
events and hooking into these events and

902
00:35:30,900 --> 00:35:41,520
so and then that's how it generates its

903
00:35:32,490 --> 00:35:44,040
long so the built on the actual the

904
00:35:41,520 --> 00:35:45,810
frameworks that bro talks about their

905
00:35:44,040 --> 00:35:47,250
several things going on so there's

906
00:35:45,810 --> 00:35:48,660
there's a file analysis framework

907
00:35:47,250 --> 00:35:50,820
saw that a little bit in the files log

908
00:35:48,660 --> 00:35:52,020
we saw if it sees a file and you

909
00:35:50,820 --> 00:35:54,120
actually<font color="#CCCCCC"> attached it's called a file</font>

910
00:35:52,020 --> 00:35:55,740
analyzer you<font color="#E5E5E5"> attach to and you tell bro</font>

911
00:35:54,120 --> 00:35:57,270
you can be selected you can say just

912
00:35:55,740 --> 00:36:00,330
<font color="#CCCCCC">attached to stuff that you see that</font>

913
00:35:57,270 --> 00:36:01,620
<font color="#E5E5E5">Windows executable or or PDFs or Word</font>

914
00:36:00,330 --> 00:36:04,980
docs or whatever you don't detach<font color="#CCCCCC"> to</font>

915
00:36:01,620 --> 00:36:06,930
<font color="#E5E5E5">although all the file types and within</font>

916
00:36:04,980 --> 00:36:08,490
bro you<font color="#CCCCCC"> can be selectively there or you</font>

917
00:36:06,930 --> 00:36:09,899
could say if<font color="#CCCCCC"> you see a file attached</font>

918
00:36:08,490 --> 00:36:11,819
that analyzer and do all these things

919
00:36:09,900 --> 00:36:13,590
hash it or do this you can actually

920
00:36:11,820 --> 00:36:16,620
<font color="#E5E5E5">extract files to with that with that</font>

921
00:36:13,590 --> 00:36:18,570
files on framework geolocation kind of

922
00:36:16,620 --> 00:36:20,790
self-explanatory you can get geolocation

923
00:36:18,570 --> 00:36:22,680
on yeah<font color="#E5E5E5"> I'm not advocating whether or</font>

924
00:36:20,790 --> 00:36:25,200
not these are good things or they work

925
00:36:22,680 --> 00:36:27,569
very well but you can you can get

926
00:36:25,200 --> 00:36:29,700
geolocation information on publicly

927
00:36:27,570 --> 00:36:31,080
adjustable IP addresses on the info

928
00:36:29,700 --> 00:36:33,470
framework is pretty cool something I

929
00:36:31,080 --> 00:36:35,790
learned<font color="#E5E5E5"> about last year bro has the</font>

930
00:36:33,470 --> 00:36:38,399
capability to actually take data that's

931
00:36:35,790 --> 00:36:40,320
not<font color="#CCCCCC"> Network generator or pcap data and</font>

932
00:36:38,400 --> 00:36:43,080
input it in so<font color="#E5E5E5"> I think the example that</font>

933
00:36:40,320 --> 00:36:45,210
was used at broke on last year was there

934
00:36:43,080 --> 00:36:46,620
was an ssh server and they<font color="#E5E5E5"> wanted</font>

935
00:36:45,210 --> 00:36:48,000
visibility into that as a server over

936
00:36:46,620 --> 00:36:49,980
the network they couldn't see much

937
00:36:48,000 --> 00:36:51,360
information because it<font color="#E5E5E5"> was encrypted but</font>

938
00:36:49,980 --> 00:36:52,620
they had the logs from that ssh server

939
00:36:51,360 --> 00:36:54,750
that they were then taking and then

940
00:36:52,620 --> 00:36:58,230
feeding back into bro and then with the

941
00:36:54,750 --> 00:37:00,090
data thats a brute force<font color="#CCCCCC"> ssh activity</font>

942
00:36:58,230 --> 00:37:01,890
you<font color="#E5E5E5"> can then take that log information</font>

943
00:37:00,090 --> 00:37:03,330
to feed it back in a bro and<font color="#E5E5E5"> then maybe</font>

944
00:37:01,890 --> 00:37:04,350
the IP addresses that is involved<font color="#CCCCCC"> in the</font>

945
00:37:03,330 --> 00:37:06,029
brute forcing that's coming from the

946
00:37:04,350 --> 00:37:07,920
logs are being fed in the bro and then

947
00:37:06,030 --> 00:37:09,630
with bro having that in you can actually

948
00:37:07,920 --> 00:37:11,190
pivot around see what else what other

949
00:37:09,630 --> 00:37:12,420
information or<font color="#CCCCCC"> whether activity on the</font>

950
00:37:11,190 --> 00:37:14,760
network is<font color="#CCCCCC"> that</font><font color="#E5E5E5"> I'd be addressed doing</font>

951
00:37:12,420 --> 00:37:17,250
so I oh that was really cool having that

952
00:37:14,760 --> 00:37:18,510
<font color="#E5E5E5">capability on the Intel framework and if</font>

953
00:37:17,250 --> 00:37:21,690
you<font color="#E5E5E5"> haven't heard of this this is where</font>

954
00:37:18,510 --> 00:37:22,950
you basically take a above data i'll

955
00:37:21,690 --> 00:37:24,660
call it i don't really call it intel

956
00:37:22,950 --> 00:37:27,210
because it's<font color="#CCCCCC"> just data but like IP</font>

957
00:37:24,660 --> 00:37:29,250
addresses or domains or email addresses

958
00:37:27,210 --> 00:37:34,530
<font color="#E5E5E5">and you you put it</font><font color="#CCCCCC"> into this digestible</font>

959
00:37:29,250 --> 00:37:36,150
frame framework or format that bro

960
00:37:34,530 --> 00:37:38,340
understands and then you can send it in

961
00:37:36,150 --> 00:37:40,140
and bro then do things off<font color="#CCCCCC"> of that it</font>

962
00:37:38,340 --> 00:37:42,630
might write to the notice log or or send

963
00:37:40,140 --> 00:37:43,920
an email whenever<font color="#CCCCCC"> it sees activity from</font>

964
00:37:42,630 --> 00:37:45,420
that Intel that you're feeding and most

965
00:37:43,920 --> 00:37:47,190
of<font color="#E5E5E5"> that stuff is meant to be automated</font>

966
00:37:45,420 --> 00:37:49,020
it's not meant to<font color="#CCCCCC"> be something</font><font color="#E5E5E5"> you mean</font>

967
00:37:47,190 --> 00:37:50,570
you have to<font color="#CCCCCC"> jump</font><font color="#E5E5E5"> through</font><font color="#CCCCCC"> I'm logging</font>

968
00:37:49,020 --> 00:37:53,190
framework it's kind of self-explanatory

969
00:37:50,570 --> 00:37:55,020
<font color="#E5E5E5">bros ability you know running logs on</font>

970
00:37:53,190 --> 00:37:59,280
the notice framework<font color="#E5E5E5"> I mentioned that a</font>

971
00:37:55,020 --> 00:38:01,009
little bit that's really is if you want

972
00:37:59,280 --> 00:38:02,060
to do things like you want to

973
00:38:01,010 --> 00:38:05,060
set up an alert but you don't want that

974
00:38:02,060 --> 00:38:06,560
alert to like go to an<font color="#CCCCCC"> email address you</font>

975
00:38:05,060 --> 00:38:08,420
<font color="#CCCCCC">can actually</font><font color="#E5E5E5"> set it to go to</font><font color="#CCCCCC"> a notice</font>

976
00:38:06,560 --> 00:38:11,120
<font color="#E5E5E5">log so you say if that happens if this</font>

977
00:38:08,420 --> 00:38:12,980
happens or XYZ happens then send it to

978
00:38:11,120 --> 00:38:14,620
the notice log and then<font color="#E5E5E5"> maybe just</font><font color="#CCCCCC"> you</font>

979
00:38:12,980 --> 00:38:16,460
want to<font color="#E5E5E5"> send the notice log to your sin</font>

980
00:38:14,620 --> 00:38:19,069
because you have all these interesting

981
00:38:16,460 --> 00:38:19,970
things they might<font color="#E5E5E5"> not be you know evil</font>

982
00:38:19,070 --> 00:38:21,650
but<font color="#E5E5E5"> they're a bunch of interesting</font>

983
00:38:19,970 --> 00:38:23,480
things<font color="#CCCCCC"> that you've decided to</font><font color="#E5E5E5"> attach to</font>

984
00:38:21,650 --> 00:38:24,650
the notes log and just send that notice

985
00:38:23,480 --> 00:38:27,350
log or maybe you just want to<font color="#E5E5E5"> look at</font>

986
00:38:24,650 --> 00:38:30,050
that<font color="#E5E5E5"> notice long the signature framework</font>

987
00:38:27,350 --> 00:38:32,240
it's kind of what I<font color="#E5E5E5"> think what they were</font>

988
00:38:30,050 --> 00:38:34,520
the developers are trying to say if<font color="#CCCCCC"> you</font>

989
00:38:32,240 --> 00:38:35,720
have these traditional snort rules and

990
00:38:34,520 --> 00:38:37,009
they're<font color="#E5E5E5"> looking for this pattern</font>

991
00:38:35,720 --> 00:38:39,169
recognition<font color="#E5E5E5"> where you can use the</font>

992
00:38:37,010 --> 00:38:42,500
signature framework to define these

993
00:38:39,170 --> 00:38:44,060
patterns and they kind<font color="#E5E5E5"> of act as if what</font>

994
00:38:42,500 --> 00:38:52,040
a snort rule would active for those

995
00:38:44,060 --> 00:38:55,190
content type indicators and I'm not a

996
00:38:52,040 --> 00:38:58,310
victim of counterfeiting I promise you

997
00:38:55,190 --> 00:39:00,050
um so and then there's the summary law a

998
00:38:58,310 --> 00:39:00,980
<font color="#E5E5E5">summary framework summary framework</font>

999
00:39:00,050 --> 00:39:02,540
there's a lot of<font color="#E5E5E5"> things you can do is</font>

1000
00:39:00,980 --> 00:39:04,780
statistically with the summary framework

1001
00:39:02,540 --> 00:39:07,430
a lot of cool things going<font color="#E5E5E5"> on</font><font color="#CCCCCC"> before</font>

1002
00:39:04,780 --> 00:39:09,320
<font color="#E5E5E5">just go to bro the broad work site or</font>

1003
00:39:07,430 --> 00:39:11,509
look at some examples on how some folks

1004
00:39:09,320 --> 00:39:15,140
are<font color="#E5E5E5"> doing some stats and things that try</font>

1005
00:39:11,510 --> 00:39:16,430
to do like analytics on the actual

1006
00:39:15,140 --> 00:39:23,690
network that the<font color="#E5E5E5"> data that's on their</font>

1007
00:39:16,430 --> 00:39:25,399
network so so bro<font color="#CCCCCC"> out of the box like</font><font color="#E5E5E5"> I</font>

1008
00:39:23,690 --> 00:39:27,110
said<font color="#E5E5E5"> I mentioned if it sees a connection</font>

1009
00:39:25,400 --> 00:39:28,280
<font color="#E5E5E5">it knows it that logs that connection</font>

1010
00:39:27,110 --> 00:39:31,460
it's going to create this unique

1011
00:39:28,280 --> 00:39:33,320
connection ID and it also creates these

1012
00:39:31,460 --> 00:39:35,780
unique file IDs as well and then there's

1013
00:39:33,320 --> 00:39:38,180
all that metadata in between that is

1014
00:39:35,780 --> 00:39:45,800
used and in particular this is that smtp

1015
00:39:38,180 --> 00:39:46,850
example again one thing with with bro at

1016
00:39:45,800 --> 00:39:48,980
least it was a challenge for me

1017
00:39:46,850 --> 00:39:50,690
traditionally grabbing p caps are

1018
00:39:48,980 --> 00:39:53,180
looking at network data<font color="#CCCCCC"> i was always</font>

1019
00:39:50,690 --> 00:39:55,610
grabbing it with wireshark or<font color="#E5E5E5"> t sharp or</font>

1020
00:39:53,180 --> 00:39:57,049
TCP dump and<font color="#CCCCCC"> i was</font><font color="#E5E5E5"> i</font><font color="#CCCCCC"> just got in my mind</font>

1021
00:39:55,610 --> 00:39:59,240
<font color="#CCCCCC">that my brain just got accustomed to</font>

1022
00:39:57,050 --> 00:40:02,720
looking at this this this traffic

1023
00:39:59,240 --> 00:40:04,339
information as client server or source

1024
00:40:02,720 --> 00:40:06,680
and destination I you know um

1025
00:40:04,340 --> 00:40:08,180
communication and so I got used to

1026
00:40:06,680 --> 00:40:11,029
looking at if I if I see a get request

1027
00:40:08,180 --> 00:40:12,799
and I gotta go look for my my response

1028
00:40:11,030 --> 00:40:14,309
or what that<font color="#E5E5E5"> response code was and I'm</font>

1029
00:40:12,800 --> 00:40:15,809
going back and forth and I was you

1030
00:40:14,309 --> 00:40:18,269
to just going back and forth between

1031
00:40:15,809 --> 00:40:19,469
client server server client or source

1032
00:40:18,269 --> 00:40:21,149
destination tourist destination shorts

1033
00:40:19,469 --> 00:40:23,729
destination my first flirt looking at

1034
00:40:21,150 --> 00:40:25,829
bro I just<font color="#CCCCCC"> see everything on one side</font>

1035
00:40:23,729 --> 00:40:27,209
and<font color="#E5E5E5"> everything then 19 p address on one</font>

1036
00:40:25,829 --> 00:40:29,789
side and<font color="#E5E5E5"> want the IP address</font><font color="#CCCCCC"> on the</font>

1037
00:40:27,209 --> 00:40:32,549
other and<font color="#CCCCCC"> i was</font><font color="#E5E5E5"> like at first I'm like</font>

1038
00:40:29,789 --> 00:40:34,499
are we not seeing the full traffic are

1039
00:40:32,549 --> 00:40:35,939
we just seeing half half of the leg or

1040
00:40:34,499 --> 00:40:37,799
we just seeing outbound traffic and not

1041
00:40:35,939 --> 00:40:40,319
inbound traffic because that that's

1042
00:40:37,799 --> 00:40:42,930
happened before<font color="#E5E5E5"> and I was I</font><font color="#CCCCCC"> just didn't</font>

1043
00:40:40,319 --> 00:40:45,170
<font color="#E5E5E5">really understand what was going on what</font>

1044
00:40:42,930 --> 00:40:47,729
bro does is it communicate calls this

1045
00:40:45,170 --> 00:40:50,519
originator and respond so in that really

1046
00:40:47,729 --> 00:40:53,578
client server or source destination it's

1047
00:40:50,519 --> 00:40:55,968
what system originated the connection

1048
00:40:53,579 --> 00:40:59,160
what system responded to that

1049
00:40:55,969 --> 00:41:00,630
originating request right so so when you

1050
00:40:59,160 --> 00:41:02,999
kind of like look at<font color="#E5E5E5"> it from that</font>

1051
00:41:00,630 --> 00:41:04,979
perspective like okay I understand but

1052
00:41:02,999 --> 00:41:07,529
it<font color="#CCCCCC"> was it was one of those those hurdles</font>

1053
00:41:04,979 --> 00:41:10,519
that I had to face<font color="#E5E5E5"> I was looking</font><font color="#CCCCCC"> at that</font>

1054
00:41:07,529 --> 00:41:17,309
and didn't really quite understand

1055
00:41:10,519 --> 00:41:18,868
exactly what was going on there I was

1056
00:41:17,309 --> 00:41:21,449
like<font color="#E5E5E5"> I mentioned it's very application</font>

1057
00:41:18,869 --> 00:41:22,890
specific application aware if it sees

1058
00:41:21,449 --> 00:41:26,519
that application knows that application

1059
00:41:22,890 --> 00:41:28,019
it's going to log a log for that there's

1060
00:41:26,519 --> 00:41:29,999
going<font color="#E5E5E5"> to be stuff like I know a lot of</font>

1061
00:41:28,019 --> 00:41:31,529
people worked with folks<font color="#CCCCCC"> that</font><font color="#E5E5E5"> says oh</font>

1062
00:41:29,999 --> 00:41:32,729
we're blind to SSL we have this

1063
00:41:31,529 --> 00:41:34,859
<font color="#E5E5E5">substance all traffic and we can't see</font>

1064
00:41:32,729 --> 00:41:36,419
anything well if you look<font color="#E5E5E5"> at your SS o</font>

1065
00:41:34,859 --> 00:41:39,359
log and bro you can see a lot of

1066
00:41:36,420 --> 00:41:40,859
information so a lot of the ssl

1067
00:41:39,359 --> 00:41:43,679
vulnerabilities<font color="#E5E5E5"> I've been</font><font color="#CCCCCC"> coming out the</font>

1068
00:41:40,859 --> 00:41:45,119
last 2014 and on we've<font color="#E5E5E5"> been hearing a</font>

1069
00:41:43,679 --> 00:41:47,670
lot of<font color="#CCCCCC"> different things</font><font color="#E5E5E5"> right there's</font>

1070
00:41:45,119 --> 00:41:49,380
these weak ssl/tls protocols there's

1071
00:41:47,670 --> 00:41:51,569
these weak crypto algorithms that are

1072
00:41:49,380 --> 00:41:53,429
being<font color="#CCCCCC"> used so when somebody in your</font>

1073
00:41:51,569 --> 00:41:54,779
organization says well we<font color="#E5E5E5"> don't use SSL</font>

1074
00:41:53,429 --> 00:41:56,249
three point out you could just<font color="#E5E5E5"> quickly</font>

1075
00:41:54,779 --> 00:41:58,199
go and look at yours and so long and say

1076
00:41:56,249 --> 00:41:59,729
oh yes we do<font color="#E5E5E5"> and here's the 15,000</font>

1077
00:41:58,199 --> 00:42:01,739
clients that are doing ssl three-point

1078
00:41:59,729 --> 00:42:03,959
all right now on our<font color="#CCCCCC"> network and oh yes</font>

1079
00:42:01,739 --> 00:42:05,809
we<font color="#E5E5E5"> don't use those we</font><font color="#CCCCCC"> cryptos because we</font>

1080
00:42:03,959 --> 00:42:08,009
push the<font color="#CCCCCC"> gpo and we disable those wee</font>

1081
00:42:05,809 --> 00:42:10,259
wee crypto algorithms and you say au

1082
00:42:08,009 --> 00:42:11,819
contraire here's this is so long and

1083
00:42:10,259 --> 00:42:13,349
here's all the clients<font color="#E5E5E5"> that are actually</font>

1084
00:42:11,819 --> 00:42:15,479
using those weak crypto algorithms

1085
00:42:13,349 --> 00:42:18,089
because<font color="#E5E5E5"> bros seen that connection and it</font>

1086
00:42:15,479 --> 00:42:20,279
logs it it's logging the what's being

1087
00:42:18,089 --> 00:42:22,709
negotiated is logging the actual<font color="#CCCCCC"> program</font>

1088
00:42:20,279 --> 00:42:26,339
the<font color="#E5E5E5"> crypto that's being used and the</font>

1089
00:42:22,709 --> 00:42:27,839
level of TLS is being used or ssl on the

1090
00:42:26,339 --> 00:42:28,180
other thing<font color="#CCCCCC"> i wanted to mention is sl2</font>

1091
00:42:27,839 --> 00:42:31,599
is

1092
00:42:28,180 --> 00:42:33,819
I think it's TLS one point our or 1.1 I

1093
00:42:31,599 --> 00:42:35,800
can't remember<font color="#E5E5E5"> which RFC it was but</font>

1094
00:42:33,819 --> 00:42:37,839
essentially<font color="#E5E5E5"> a</font><font color="#CCCCCC"> per RFC if you're using</font>

1095
00:42:35,800 --> 00:42:41,559
those protocols the client has to

1096
00:42:37,839 --> 00:42:43,180
specify that that that resource

1097
00:42:41,559 --> 00:42:45,220
indicator that<font color="#CCCCCC"> hostname Resource Center</font>

1098
00:42:43,180 --> 00:42:48,279
care what not but basically if it's

1099
00:42:45,220 --> 00:42:51,129
doing a connection over SSL or TLS<font color="#CCCCCC"> 20 to</font>

1100
00:42:48,280 --> 00:42:53,079
a server it has to specify that a fully

1101
00:42:51,130 --> 00:42:54,400
qualified domain name of that system

1102
00:42:53,079 --> 00:42:56,410
that is talking<font color="#CCCCCC"> to so that's really</font>

1103
00:42:54,400 --> 00:42:58,300
<font color="#E5E5E5">interesting bro knows that and bro logs</font>

1104
00:42:56,410 --> 00:42:59,890
it so you can actually go look and say

1105
00:42:58,300 --> 00:43:01,720
okay here's all my clients are doing as

1106
00:42:59,890 --> 00:43:02,770
a cell or TLS and here's the<font color="#CCCCCC"> server's</font>

1107
00:43:01,720 --> 00:43:04,598
than actual host names that they're

1108
00:43:02,770 --> 00:43:06,609
<font color="#CCCCCC">actually talking to it's putting that</font>

1109
00:43:04,599 --> 00:43:08,170
all together in one nice log also

1110
00:43:06,609 --> 00:43:09,308
certificates seeing the certificates

1111
00:43:08,170 --> 00:43:11,020
that are coming<font color="#E5E5E5"> down so if you want to</font>

1112
00:43:09,309 --> 00:43:12,250
pivot off of that on there's definitely

1113
00:43:11,020 --> 00:43:14,259
a lot of resources<font color="#E5E5E5"> that are going on</font>

1114
00:43:12,250 --> 00:43:16,540
there and bros recording those if you

1115
00:43:14,260 --> 00:43:17,920
attach the<font color="#E5E5E5"> file analyzer it's a go ahead</font>

1116
00:43:16,540 --> 00:43:21,040
<font color="#E5E5E5">and hash those certificates as well you</font>

1117
00:43:17,920 --> 00:43:23,559
<font color="#CCCCCC">can get</font><font color="#E5E5E5"> information off of that and then</font>

1118
00:43:21,040 --> 00:43:24,970
I<font color="#CCCCCC"> also like to mention that</font><font color="#E5E5E5"> it just you</font>

1119
00:43:23,559 --> 00:43:26,650
go and look at your bro logs and all of

1120
00:43:24,970 --> 00:43:28,569
a sudden<font color="#CCCCCC"> you see an IRC blog or you see</font>

1121
00:43:26,650 --> 00:43:31,540
a socks proxy log and you're like okay

1122
00:43:28,569 --> 00:43:33,400
<font color="#CCCCCC">what is that so it's logging the things</font>

1123
00:43:31,540 --> 00:43:36,670
that it knows<font color="#E5E5E5"> about it doesn't matter</font>

1124
00:43:33,400 --> 00:43:38,829
what port is over if it<font color="#CCCCCC"> she's HTTP</font>

1125
00:43:36,670 --> 00:43:40,900
traffic and it's over<font color="#E5E5E5"> port 80 80 or 81</font>

1126
00:43:38,829 --> 00:43:43,180
81 it doesn't really matter it says yeah

1127
00:43:40,900 --> 00:43:45,099
<font color="#CCCCCC">you're HTTP and you're</font><font color="#E5E5E5"> going in the HTTP</font>

1128
00:43:43,180 --> 00:43:52,058
log same thing<font color="#E5E5E5"> for any of the other</font>

1129
00:43:45,099 --> 00:43:53,770
protocol is that that bro knows about so

1130
00:43:52,059 --> 00:43:57,220
some tips and<font color="#E5E5E5"> tricks if</font><font color="#CCCCCC"> you want to</font><font color="#E5E5E5"> get</font>

1131
00:43:53,770 --> 00:44:00,700
started with bro I think the<font color="#CCCCCC"> last</font><font color="#E5E5E5"> dash</font>

1132
00:43:57,220 --> 00:44:02,049
capital<font color="#CCCCCC"> S was invented for bro</font><font color="#E5E5E5"> I I said</font>

1133
00:44:00,700 --> 00:44:03,220
that as a joke but basically if you

1134
00:44:02,049 --> 00:44:05,140
start like if you just at the command

1135
00:44:03,220 --> 00:44:06,669
line you actually just catalogs and

1136
00:44:05,140 --> 00:44:07,750
<font color="#CCCCCC">piping</font><font color="#E5E5E5"> the grab and then you just get</font>

1137
00:44:06,670 --> 00:44:10,210
this blob of stuff and you're like what

1138
00:44:07,750 --> 00:44:12,730
the heck's going on if you do the dash

1139
00:44:10,210 --> 00:44:14,380
capital<font color="#CCCCCC"> s it</font><font color="#E5E5E5"> actually doesn't wrap the</font>

1140
00:44:12,730 --> 00:44:16,420
line and allows you to scroll<font color="#CCCCCC"> back and</font>

1141
00:44:14,380 --> 00:44:18,400
forth really cool and interesting if

1142
00:44:16,420 --> 00:44:20,980
you're at<font color="#E5E5E5"> the command line see if</font>

1143
00:44:18,400 --> 00:44:23,079
utility lightweight unix utility to be

1144
00:44:20,980 --> 00:44:24,970
able<font color="#E5E5E5"> to translate</font><font color="#CCCCCC"> i don't know i forgot</font>

1145
00:44:23,079 --> 00:44:27,490
to<font color="#CCCCCC"> mention earlier but if you saw that</font>

1146
00:44:24,970 --> 00:44:30,129
<font color="#E5E5E5">first value in the bro log was actually</font>

1147
00:44:27,490 --> 00:44:31,450
an epic timestamp so if you're like me

1148
00:44:30,130 --> 00:44:33,730
epic timestamps don't really mean much

1149
00:44:31,450 --> 00:44:35,589
on that<font color="#E5E5E5"> face value unless you can read</font>

1150
00:44:33,730 --> 00:44:38,020
those that'd be<font color="#E5E5E5"> really cool school to</font>

1151
00:44:35,589 --> 00:44:39,790
have but<font color="#E5E5E5"> I don't have it so so you can</font>

1152
00:44:38,020 --> 00:44:40,580
use utilities to kind<font color="#E5E5E5"> of translate the</font>

1153
00:44:39,790 --> 00:44:43,850
epic time<font color="#E5E5E5"> it's</font>

1154
00:44:40,580 --> 00:44:46,100
human readable time there's this concept

1155
00:44:43,850 --> 00:44:48,200
of readable or read redefine double

1156
00:44:46,100 --> 00:44:49,940
variables in the script land that bro

1157
00:44:48,200 --> 00:44:51,410
operates in and you<font color="#E5E5E5"> can actually use</font>

1158
00:44:49,940 --> 00:44:52,520
<font color="#E5E5E5">these at the command line as well so</font>

1159
00:44:51,410 --> 00:44:55,069
these global variables that you're

1160
00:44:52,520 --> 00:44:57,410
defining in your scripts you<font color="#E5E5E5"> basically</font>

1161
00:44:55,070 --> 00:44:59,180
tag them as redefine<font color="#CCCCCC"> iboga variables and</font>

1162
00:44:57,410 --> 00:45:01,640
then you can so one example<font color="#E5E5E5"> I like to</font>

1163
00:44:59,180 --> 00:45:04,520
<font color="#E5E5E5">use is I have a ir script that's based</font>

1164
00:45:01,640 --> 00:45:08,629
off of it<font color="#E5E5E5"> takes in it looks for smtp</font>

1165
00:45:04,520 --> 00:45:11,540
traffic and if the variable matches my

1166
00:45:08,630 --> 00:45:13,520
email domain it pulls<font color="#E5E5E5"> the smtp message</font>

1167
00:45:11,540 --> 00:45:15,590
out<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the pcap and then it pulls the</font>

1168
00:45:13,520 --> 00:45:17,450
attachments out of the pcap as well but

1169
00:45:15,590 --> 00:45:19,730
if you put like at gmail com and you

1170
00:45:17,450 --> 00:45:20,799
have a<font color="#E5E5E5"> lot of time</font><font color="#CCCCCC"> of peak apps then</font>

1171
00:45:19,730 --> 00:45:23,360
that's probably going to be<font color="#E5E5E5"> a bad</font>

1172
00:45:20,800 --> 00:45:25,850
example to use but you can redefine that

1173
00:45:23,360 --> 00:45:27,530
on the command line say i want evil

1174
00:45:25,850 --> 00:45:29,330
doubt you know any email from evil calm

1175
00:45:27,530 --> 00:45:30,440
and I want to look through this hour

1176
00:45:29,330 --> 00:45:32,630
with the peak apps and just pull that

1177
00:45:30,440 --> 00:45:36,950
<font color="#CCCCCC">out that it's</font><font color="#E5E5E5"> very powerful to do that</font>

1178
00:45:32,630 --> 00:45:38,420
as<font color="#E5E5E5"> I</font><font color="#CCCCCC"> mentioned you can</font><font color="#E5E5E5"> run bro on</font><font color="#CCCCCC"> saved</font>

1179
00:45:36,950 --> 00:45:40,399
<font color="#E5E5E5">pcap so you don't have to run it live on</font>

1180
00:45:38,420 --> 00:45:43,430
the wire if you use<font color="#CCCCCC"> the dash our command</font>

1181
00:45:40,400 --> 00:45:45,530
you could<font color="#E5E5E5"> just pass in some P caps and</font>

1182
00:45:43,430 --> 00:45:48,230
run it<font color="#E5E5E5"> that way</font><font color="#CCCCCC"> and then</font><font color="#E5E5E5"> if you're</font>

1183
00:45:45,530 --> 00:45:50,240
writing custom scripts<font color="#E5E5E5"> I highly suggest</font>

1184
00:45:48,230 --> 00:45:52,780
you use this dump events top row script

1185
00:45:50,240 --> 00:45:56,529
it's kind of hidden in this bro

1186
00:45:52,780 --> 00:45:59,690
directory hierarchical structure but

1187
00:45:56,530 --> 00:46:02,570
essentially in there is a caveat to if

1188
00:45:59,690 --> 00:46:04,880
you look at<font color="#CCCCCC"> that script it warns you</font>

1189
00:46:02,570 --> 00:46:07,390
don't run this live because basically

1190
00:46:04,880 --> 00:46:10,520
it's it's going<font color="#E5E5E5"> to put out standard out</font>

1191
00:46:07,390 --> 00:46:12,980
everything that bro scene so like I said

1192
00:46:10,520 --> 00:46:14,360
bro logs a lot of<font color="#E5E5E5"> things but there's a</font>

1193
00:46:12,980 --> 00:46:16,670
lot of stuff especially in that protocol

1194
00:46:14,360 --> 00:46:18,650
like HTTP that it doesn't it's<font color="#CCCCCC"> not going</font>

1195
00:46:16,670 --> 00:46:22,400
to log so if there's some custom header

1196
00:46:18,650 --> 00:46:24,440
that Bros actually on that so<font color="#CCCCCC"> Bros</font>

1197
00:46:22,400 --> 00:46:26,660
logging like user agents and refers and

1198
00:46:24,440 --> 00:46:28,040
all those those common strings but<font color="#E5E5E5"> if</font>

1199
00:46:26,660 --> 00:46:30,259
there's some custom header in there that

1200
00:46:28,040 --> 00:46:32,810
you don't that not necessarily know

1201
00:46:30,260 --> 00:46:35,030
about it's going to feed it in the dump

1202
00:46:32,810 --> 00:46:36,290
events log but you're not necessarily

1203
00:46:35,030 --> 00:46:38,570
going to<font color="#E5E5E5"> see that written</font><font color="#CCCCCC"> out in the</font>

1204
00:46:36,290 --> 00:46:40,610
prologue so there's a<font color="#E5E5E5"> lot of things</font><font color="#CCCCCC"> that</font>

1205
00:46:38,570 --> 00:46:42,290
the bro folks do in script land that

1206
00:46:40,610 --> 00:46:44,420
they<font color="#CCCCCC"> actually have regular expressions</font>

1207
00:46:42,290 --> 00:46:46,430
to kind of say<font color="#E5E5E5"> I want to take this</font>

1208
00:46:44,420 --> 00:46:49,130
regular expression and write it only if

1209
00:46:46,430 --> 00:46:51,500
it matches as<font color="#CCCCCC"> regex and you lose some</font>

1210
00:46:49,130 --> 00:46:53,550
information sometimes so how would

1211
00:46:51,500 --> 00:46:55,770
suggest if you're writing scripts to

1212
00:46:53,550 --> 00:46:58,260
this as a debugging tool to see exactly

1213
00:46:55,770 --> 00:47:00,390
<font color="#E5E5E5">what bro knows about</font><font color="#CCCCCC"> seeds because you</font>

1214
00:46:58,260 --> 00:47:01,710
can enrich<font color="#E5E5E5"> bros data by running your own</font>

1215
00:47:00,390 --> 00:47:06,390
scripts and then pending that data to

1216
00:47:01,710 --> 00:47:08,310
the<font color="#E5E5E5"> log and bro scripting so if you're</font>

1217
00:47:06,390 --> 00:47:10,859
interested<font color="#CCCCCC"> in bro scripting there's this</font>

1218
00:47:08,310 --> 00:47:12,600
cheat sheet it was it was written a long

1219
00:47:10,860 --> 00:47:14,610
time ago it hasn't been updated so some

1220
00:47:12,600 --> 00:47:16,410
of the some of the commands they call

1221
00:47:14,610 --> 00:47:18,540
them<font color="#CCCCCC"> Biff's which is any reference to</font>

1222
00:47:16,410 --> 00:47:21,660
back the future for me as a win and so

1223
00:47:18,540 --> 00:47:22,950
these built-in functions and they're

1224
00:47:21,660 --> 00:47:24,779
<font color="#E5E5E5">really great it's there's a lot of</font>

1225
00:47:22,950 --> 00:47:26,549
powerful built-in functions there some

1226
00:47:24,780 --> 00:47:27,960
of them are deprecated so you'll see

1227
00:47:26,550 --> 00:47:30,210
that when you try to<font color="#E5E5E5"> use those in with</font>

1228
00:47:27,960 --> 00:47:31,470
them bro but this this github cheat

1229
00:47:30,210 --> 00:47:33,360
sheet right there will show you all that

1230
00:47:31,470 --> 00:47:36,299
it also<font color="#E5E5E5"> shows</font><font color="#CCCCCC"> you the syntax temporal</font>

1231
00:47:33,360 --> 00:47:39,300
users in the script land<font color="#E5E5E5"> on and then if</font>

1232
00:47:36,300 --> 00:47:40,770
the 2011 bro workshop they actually have

1233
00:47:39,300 --> 00:47:41,910
a primer where you can actually go

1234
00:47:40,770 --> 00:47:43,530
through they start with a hello world

1235
00:47:41,910 --> 00:47:45,420
and i think they call<font color="#E5E5E5"> it a Barolo world</font>

1236
00:47:43,530 --> 00:47:46,410
or something<font color="#E5E5E5"> like that but you can</font>

1237
00:47:45,420 --> 00:47:48,960
<font color="#CCCCCC">actually go through and you actually</font>

1238
00:47:46,410 --> 00:47:51,120
kind of learn the concept one thing<font color="#CCCCCC"> i</font>

1239
00:47:48,960 --> 00:47:52,860
thought was interesting is the the data

1240
00:47:51,120 --> 00:47:55,020
types there's data types that bro sees

1241
00:47:52,860 --> 00:47:57,330
and calls like an IP address is a data

1242
00:47:55,020 --> 00:47:59,370
type a port is a data time so that's

1243
00:47:57,330 --> 00:48:01,740
kind of interesting from a program<font color="#E5E5E5"> Oh a</font>

1244
00:47:59,370 --> 00:48:03,600
programmer perspective on that you have

1245
00:48:01,740 --> 00:48:05,009
these<font color="#E5E5E5"> things these</font><font color="#CCCCCC"> Network objects that</font>

1246
00:48:03,600 --> 00:48:10,950
are now data types that<font color="#E5E5E5"> I can use in my</font>

1247
00:48:05,010 --> 00:48:13,170
<font color="#E5E5E5">scripts and just really the summary of</font>

1248
00:48:10,950 --> 00:48:16,350
things is that you know context is our

1249
00:48:13,170 --> 00:48:17,760
friend<font color="#E5E5E5"> and time is our enemy one thing I</font>

1250
00:48:16,350 --> 00:48:20,250
didn't mention and<font color="#E5E5E5"> I wanted to mention</font>

1251
00:48:17,760 --> 00:48:22,290
with with<font color="#E5E5E5"> that kill chain analysis was</font>

1252
00:48:20,250 --> 00:48:23,490
that kill chain paper was written to do

1253
00:48:22,290 --> 00:48:25,860
a lot<font color="#CCCCCC"> of things you know campaign</font>

1254
00:48:23,490 --> 00:48:28,649
analysis and adversary tracking and and

1255
00:48:25,860 --> 00:48:29,940
things like that and from my example was

1256
00:48:28,650 --> 00:48:31,950
just that you<font color="#CCCCCC"> know from those delivery</font>

1257
00:48:29,940 --> 00:48:35,340
expo<font color="#E5E5E5"> insulation and community control</font>

1258
00:48:31,950 --> 00:48:36,870
phases that you know be out<font color="#E5E5E5"> that good</font>

1259
00:48:35,340 --> 00:48:38,610
understanding of what your identifying

1260
00:48:36,870 --> 00:48:40,589
but if you're stopping something at that

1261
00:48:38,610 --> 00:48:41,910
delivery phase and you're successful at

1262
00:48:40,590 --> 00:48:43,860
staffing and don't just wipe your hand

1263
00:48:41,910 --> 00:48:45,330
to say I'm done in their paper they

1264
00:48:43,860 --> 00:48:47,370
actually<font color="#E5E5E5"> talk about a full synthesis of</font>

1265
00:48:45,330 --> 00:48:49,140
an attack so run that synthesis through

1266
00:48:47,370 --> 00:48:50,910
synthesize<font color="#CCCCCC"> that attack just like</font><font color="#E5E5E5"> I did</font>

1267
00:48:49,140 --> 00:48:52,799
with this ransomware example and see

1268
00:48:50,910 --> 00:48:55,109
what would your tools have said if that

1269
00:48:52,800 --> 00:48:56,850
<font color="#CCCCCC">attack</font><font color="#E5E5E5"> if that tax successfully got</font>

1270
00:48:55,110 --> 00:48:58,440
through the delivery phase would you

1271
00:48:56,850 --> 00:49:00,240
detect it the installation or the

1272
00:48:58,440 --> 00:49:01,380
exploitation what you detect it would

1273
00:49:00,240 --> 00:49:02,729
you have detected the command<font color="#E5E5E5"> and</font>

1274
00:49:01,380 --> 00:49:04,230
control and then you could take<font color="#E5E5E5"> that</font>

1275
00:49:02,730 --> 00:49:06,780
data and rich it back and then feed it

1276
00:49:04,230 --> 00:49:07,410
back into your detection<font color="#E5E5E5"> mixer so other</font>

1277
00:49:06,780 --> 00:49:10,190
<font color="#E5E5E5">than that</font>

1278
00:49:07,410 --> 00:49:10,190
I'm pretty much done

