1
00:00:00,000 --> 00:00:03,120
[Applause]

2
00:00:03,120 --> 00:00:06,120
foreign

3
00:00:07,379 --> 00:00:10,920
okay good yeah so uh Thanks James for

4
00:00:10,920 --> 00:00:13,139
his great talk and I felt a lot of same

5
00:00:13,139 --> 00:00:16,020
things and he told and um by the way I

6
00:00:16,020 --> 00:00:17,760
didn't see I didn't see it so how many

7
00:00:17,760 --> 00:00:21,539
of you are uh researchers

8
00:00:21,539 --> 00:00:26,720
on the couple so who of you are hackers

9
00:00:26,760 --> 00:00:28,680
so you are researchers actually right

10
00:00:28,680 --> 00:00:30,060
okay

11
00:00:30,060 --> 00:00:31,260
so

12
00:00:31,260 --> 00:00:32,700
uh

13
00:00:32,700 --> 00:00:34,980
short introduction about myself so I'm

14
00:00:34,980 --> 00:00:37,320
nestory high I'm from Finland I work for

15
00:00:37,320 --> 00:00:40,860
CQ works and my nice title is senior

16
00:00:40,860 --> 00:00:42,960
principal security researcher and what

17
00:00:42,960 --> 00:00:44,579
that what does that mean it means that

18
00:00:44,579 --> 00:00:46,620
they pay me for hacking

19
00:00:46,620 --> 00:00:48,780
and that's it so I'm kind of living my

20
00:00:48,780 --> 00:00:50,039
dream

21
00:00:50,039 --> 00:00:52,500
I'm best known Maybe

22
00:00:52,500 --> 00:00:55,739
as a doctor as already so that's my

23
00:00:55,739 --> 00:00:58,440
Twitter handle and I've created a

24
00:00:58,440 --> 00:01:01,140
software called aad internals and that's

25
00:01:01,140 --> 00:01:03,960
pretty much what I've I'm best of none

26
00:01:03,960 --> 00:01:06,720
of maybe and you are free to tweet about

27
00:01:06,720 --> 00:01:08,700
me or follow me on Twitter and take

28
00:01:08,700 --> 00:01:11,479
pictures and and all kind of that

29
00:01:11,479 --> 00:01:14,460
for me this year has been quite

30
00:01:14,460 --> 00:01:16,140
interesting so after Kobe this is my

31
00:01:16,140 --> 00:01:18,659
eighth in-person presentation

32
00:01:18,659 --> 00:01:22,080
and I flew here from Germany from Bonn

33
00:01:22,080 --> 00:01:25,080
and there was a smaller conference

34
00:01:25,080 --> 00:01:28,619
called Cloud I needed Summit and that's

35
00:01:28,619 --> 00:01:29,580
me

36
00:01:29,580 --> 00:01:32,580
there and that was actually quite nice

37
00:01:32,580 --> 00:01:35,100
picture so one of my friends said that's

38
00:01:35,100 --> 00:01:37,680
a very good for memes and then someone

39
00:01:37,680 --> 00:01:39,720
created like a

40
00:01:39,720 --> 00:01:41,460
that kind of thing so now you can use

41
00:01:41,460 --> 00:01:44,600
that a meme so you're welcome

42
00:01:44,820 --> 00:01:49,200
so my content today so this is more like

43
00:01:49,200 --> 00:01:51,119
a from hacker to hacker so I'm gonna

44
00:01:51,119 --> 00:01:53,640
tell you a war story of two of them and

45
00:01:53,640 --> 00:01:56,880
how I how I made like 40 000 US dollars

46
00:01:56,880 --> 00:01:58,860
from them on top of my salary

47
00:01:58,860 --> 00:02:02,460
from my hobby so nice nice uh nice

48
00:02:02,460 --> 00:02:04,619
addition to that so I'm first going to

49
00:02:04,619 --> 00:02:06,719
introduce you a little bit that what is

50
00:02:06,719 --> 00:02:09,300
directly synchronization in Azure ID and

51
00:02:09,300 --> 00:02:11,879
then how to abuse that how they fix that

52
00:02:11,879 --> 00:02:14,879
and how I evade the fix

53
00:02:14,879 --> 00:02:16,920
so that's pretty much the story

54
00:02:16,920 --> 00:02:19,739
uh I'm gonna use

55
00:02:19,739 --> 00:02:22,379
in my demos well actually I decided I'm

56
00:02:22,379 --> 00:02:23,879
not going to do live demos because of

57
00:02:23,879 --> 00:02:26,040
the network it's not that well here so

58
00:02:26,040 --> 00:02:28,500
I'm gonna use a slides but anyways I

59
00:02:28,500 --> 00:02:30,300
have a tool called A8 internals it's an

60
00:02:30,300 --> 00:02:33,300
open source admin hacking toolkit who of

61
00:02:33,300 --> 00:02:35,340
you have ever used that

62
00:02:35,340 --> 00:02:37,620
there's a couple yes and I have a

63
00:02:37,620 --> 00:02:40,260
stickers I can share them with you um

64
00:02:40,260 --> 00:02:43,440
after the talk somewhere here I don't

65
00:02:43,440 --> 00:02:45,599
know and uh it's an open source it's

66
00:02:45,599 --> 00:02:50,519
available in GitHub and it's also

67
00:02:50,519 --> 00:02:54,120
listed by my attack if you know that as

68
00:02:54,120 --> 00:02:56,819
a software and it being used by a group

69
00:02:56,819 --> 00:03:00,239
called apt-29 also known as nobelium so

70
00:03:00,239 --> 00:03:02,580
I'm pretty much I don't know should I be

71
00:03:02,580 --> 00:03:05,840
honored or not maybe

72
00:03:05,879 --> 00:03:09,780
Okay so uh short introduction to

73
00:03:09,780 --> 00:03:12,360
director synchronization what it is what

74
00:03:12,360 --> 00:03:14,159
is it so there are different

75
00:03:14,159 --> 00:03:17,099
authentication options you can use in in

76
00:03:17,099 --> 00:03:20,280
um as already so you can be either Cloud

77
00:03:20,280 --> 00:03:22,440
only so where everything is like in

78
00:03:22,440 --> 00:03:25,739
cloud or you or probably you are like

79
00:03:25,739 --> 00:03:28,620
more like hybrid where you are using

80
00:03:28,620 --> 00:03:30,659
same set of credentials in your on-prem

81
00:03:30,659 --> 00:03:33,480
than in other right and you need to have

82
00:03:33,480 --> 00:03:36,659
a synchronization for that to happen but

83
00:03:36,659 --> 00:03:38,040
you you have different authentication

84
00:03:38,040 --> 00:03:40,260
options but every single option of this

85
00:03:40,260 --> 00:03:43,140
is using directory synchronization and

86
00:03:43,140 --> 00:03:45,798
that is there

87
00:03:47,940 --> 00:03:49,140
and

88
00:03:49,140 --> 00:03:51,360
what it does actually

89
00:03:51,360 --> 00:03:53,879
so the only purpose of that is to keep

90
00:03:53,879 --> 00:03:56,640
your on-prem ad synchronized to that

91
00:03:56,640 --> 00:03:57,840
already

92
00:03:57,840 --> 00:03:59,519
and that's pretty much what it's doing

93
00:03:59,519 --> 00:04:00,720
so

94
00:04:00,720 --> 00:04:02,159
you have users here they are

95
00:04:02,159 --> 00:04:04,080
synchronized here groups are

96
00:04:04,080 --> 00:04:06,420
synchronized and then your devices are

97
00:04:06,420 --> 00:04:07,860
synchronized if you want to you don't

98
00:04:07,860 --> 00:04:10,860
have to but that's usually how it goes

99
00:04:10,860 --> 00:04:12,959
and to be able to do that

100
00:04:12,959 --> 00:04:15,299
that way the connect has service

101
00:04:15,299 --> 00:04:16,858
accounts

102
00:04:16,858 --> 00:04:18,660
three of them actually

103
00:04:18,660 --> 00:04:21,298
so there's a service account in your

104
00:04:21,298 --> 00:04:24,300
on-prem ad that allows you to read users

105
00:04:24,300 --> 00:04:26,220
from there and also if you are using a

106
00:04:26,220 --> 00:04:27,240
thing called password hash

107
00:04:27,240 --> 00:04:29,160
synchronization which kind of

108
00:04:29,160 --> 00:04:30,720
synchronizes your

109
00:04:30,720 --> 00:04:32,220
well not your password or password

110
00:04:32,220 --> 00:04:35,580
hashes from on-prem to as ready

111
00:04:35,580 --> 00:04:37,500
you have

112
00:04:37,500 --> 00:04:39,419
a read only replication secret

113
00:04:39,419 --> 00:04:42,060
synchronization which means that that

114
00:04:42,060 --> 00:04:44,940
like a account can read everybody's

115
00:04:44,940 --> 00:04:47,460
password hashes so that's quite powerful

116
00:04:47,460 --> 00:04:48,780
right

117
00:04:48,780 --> 00:04:51,020
and then in Cloud you have a different

118
00:04:51,020 --> 00:04:54,180
account that is allowed to create users

119
00:04:54,180 --> 00:04:57,300
edit users or delete users which are

120
00:04:57,300 --> 00:05:00,000
synchronized right so that also have

121
00:05:00,000 --> 00:05:03,120
kind of a powerful like permissions

122
00:05:03,120 --> 00:05:04,800
and then we have a

123
00:05:04,800 --> 00:05:07,199
an account that you are running that

124
00:05:07,199 --> 00:05:10,320
service as and it what it can do it only

125
00:05:10,320 --> 00:05:13,020
can a reset password of this account but

126
00:05:13,020 --> 00:05:15,419
nothing else so that's how it goes

127
00:05:15,419 --> 00:05:17,340
and um

128
00:05:17,340 --> 00:05:18,600
yeah

129
00:05:18,600 --> 00:05:20,820
so

130
00:05:20,820 --> 00:05:23,220
it's actually quite easy to get these

131
00:05:23,220 --> 00:05:26,160
accounts so I'm gonna try to show you

132
00:05:26,160 --> 00:05:28,560
only one live demo I have

133
00:05:28,560 --> 00:05:31,940
so let's see how it goes

134
00:05:34,560 --> 00:05:38,580
so here I am so I uploaded my tool here

135
00:05:38,580 --> 00:05:40,979
A8 internals and I'm logged into a

136
00:05:40,979 --> 00:05:43,740
computer that is running the uh aad

137
00:05:43,740 --> 00:05:44,820
connect

138
00:05:44,820 --> 00:05:46,680
and those credentials are stored there

139
00:05:46,680 --> 00:05:48,180
somewhere

140
00:05:48,180 --> 00:05:51,000
in a database and I created a function

141
00:05:51,000 --> 00:05:52,919
that

142
00:05:52,919 --> 00:05:55,560
ones like this and it like Xbox or

143
00:05:55,560 --> 00:05:57,900
passwords now what is good is that you

144
00:05:57,900 --> 00:06:00,960
can get these credentials passwords get

145
00:06:00,960 --> 00:06:02,699
them back home and use them from there

146
00:06:02,699 --> 00:06:05,820
you don't have to be on that server

147
00:06:05,820 --> 00:06:08,220
unless they are protected but what I've

148
00:06:08,220 --> 00:06:10,320
learned or seen that's not really much

149
00:06:10,320 --> 00:06:13,560
case quite often so so usually you can

150
00:06:13,560 --> 00:06:14,880
use those credentials from anywhere

151
00:06:14,880 --> 00:06:17,100
around the world if you get those so you

152
00:06:17,100 --> 00:06:19,860
compromise that computer and you can be

153
00:06:19,860 --> 00:06:23,460
that synchronization if you will

154
00:06:23,460 --> 00:06:25,860
now a little bit more technical

155
00:06:25,860 --> 00:06:28,740
background so how these users or objects

156
00:06:28,740 --> 00:06:30,000
are linked

157
00:06:30,000 --> 00:06:32,220
so uh

158
00:06:32,220 --> 00:06:34,800
there are people or users in in your

159
00:06:34,800 --> 00:06:36,479
on-premity and you synchronize them to

160
00:06:36,479 --> 00:06:38,580
actually you actually create a copy of

161
00:06:38,580 --> 00:06:40,259
that user

162
00:06:40,259 --> 00:06:43,080
and there are some attributes that are

163
00:06:43,080 --> 00:06:44,940
following that user for instance user

164
00:06:44,940 --> 00:06:46,620
principal name comes to user principal

165
00:06:46,620 --> 00:06:49,860
name right and then your on-prem object

166
00:06:49,860 --> 00:06:53,280
guid becomes an immutable ID which is

167
00:06:53,280 --> 00:06:55,139
just just the same object Google but

168
00:06:55,139 --> 00:06:57,300
it's base64 encoded

169
00:06:57,300 --> 00:07:00,120
and then your feet comes on-prem

170
00:07:00,120 --> 00:07:02,759
security identifier and then the object

171
00:07:02,759 --> 00:07:05,880
in cloud has object ID of course so

172
00:07:05,880 --> 00:07:07,500
that's like the identifier in the cloud

173
00:07:07,500 --> 00:07:10,620
but then also if if the user is

174
00:07:10,620 --> 00:07:12,720
synchronized there's a switch or

175
00:07:12,720 --> 00:07:16,860
attribute called bursting enabled true

176
00:07:16,860 --> 00:07:19,319
which means that that user is already is

177
00:07:19,319 --> 00:07:21,180
now synchronized

178
00:07:21,180 --> 00:07:23,039
which means that its source of

179
00:07:23,039 --> 00:07:26,520
authorities on-prem not Cloud there can

180
00:07:26,520 --> 00:07:28,259
be also users that are not synchronized

181
00:07:28,259 --> 00:07:30,660
so they can be Cloud only users and then

182
00:07:30,660 --> 00:07:32,880
mixed like synchronized users but so

183
00:07:32,880 --> 00:07:34,800
that's why this attribute here is

184
00:07:34,800 --> 00:07:37,440
important so that's Cloud knows that

185
00:07:37,440 --> 00:07:39,720
what that actually that has a very

186
00:07:39,720 --> 00:07:42,060
connect account can do

187
00:07:42,060 --> 00:07:45,780
okay so then for appearsing so that was

188
00:07:45,780 --> 00:07:47,840
a very crass course for what already

189
00:07:47,840 --> 00:07:52,860
synchronization uh techniques so

190
00:07:52,860 --> 00:07:56,699
how I usually do my research stuff

191
00:07:56,699 --> 00:08:00,300
so mostly I do men in the middle attacks

192
00:08:00,300 --> 00:08:03,240
so I I use Fiddler here between the

193
00:08:03,240 --> 00:08:04,979
client and Cloud

194
00:08:04,979 --> 00:08:06,740
for instance that has already connect

195
00:08:06,740 --> 00:08:09,240
synchronization is client which is

196
00:08:09,240 --> 00:08:11,340
connecting the cloud and if I put there

197
00:08:11,340 --> 00:08:13,440
in the middle a proxy I can see the

198
00:08:13,440 --> 00:08:16,020
traffic there so that's pretty much my

199
00:08:16,020 --> 00:08:19,020
research method so I take a thing

200
00:08:19,020 --> 00:08:20,699
run something and see what happens

201
00:08:20,699 --> 00:08:23,639
between that and the cloud

202
00:08:23,639 --> 00:08:28,979
and also like James in some cases I take

203
00:08:28,979 --> 00:08:31,379
a client and try to reverse engineer

204
00:08:31,379 --> 00:08:33,839
what it's doing I'm using raw heat up uh

205
00:08:33,839 --> 00:08:35,640
API monitor I don't know if you have

206
00:08:35,640 --> 00:08:36,779
heard about that but that's very

207
00:08:36,779 --> 00:08:38,820
powerful too maybe it's old but works

208
00:08:38,820 --> 00:08:43,940
like a charm dnspy allows you to decrypt

209
00:08:43,940 --> 00:08:47,940
basically.net based binaries to the

210
00:08:47,940 --> 00:08:49,980
Powershell sorry not the Powershell but

211
00:08:49,980 --> 00:08:54,720
the other C sharp or or BB script if

212
00:08:54,720 --> 00:08:56,160
you're using that and then of course key

213
00:08:56,160 --> 00:08:59,459
to Idaho or whatever debugging tool

214
00:08:59,459 --> 00:09:01,440
and every now and then I also need to

215
00:09:01,440 --> 00:09:03,839
read the manuals

216
00:09:03,839 --> 00:09:06,480
so when I was doing this with us already

217
00:09:06,480 --> 00:09:09,720
connect what I found out is this so it's

218
00:09:09,720 --> 00:09:11,160
a little bit small print sorry about

219
00:09:11,160 --> 00:09:14,339
that but at the top we can see that the

220
00:09:14,339 --> 00:09:18,240
protocol was uh soap XML

221
00:09:18,240 --> 00:09:20,399
plus M has been one

222
00:09:20,399 --> 00:09:22,980
which means that it's binary XML

223
00:09:22,980 --> 00:09:27,180
and here is the one of the messages as

224
00:09:27,180 --> 00:09:29,160
already connected by sending and binary

225
00:09:29,160 --> 00:09:32,100
XML means that you replace those like

226
00:09:32,100 --> 00:09:35,279
envelope or header tags with a number

227
00:09:35,279 --> 00:09:37,980
but in order for you to be able to turn

228
00:09:37,980 --> 00:09:40,560
that back from this binary code to plain

229
00:09:40,560 --> 00:09:42,899
text XML it means that you need to know

230
00:09:42,899 --> 00:09:45,600
the dictionary

231
00:09:45,600 --> 00:09:49,440
that what that O2 means

232
00:09:49,440 --> 00:09:51,000
and

233
00:09:51,000 --> 00:09:53,459
there was a blocking

234
00:09:53,459 --> 00:09:56,100
made by some guy I don't remember his

235
00:09:56,100 --> 00:09:58,800
name but but he had a Plugin or add-on

236
00:09:58,800 --> 00:10:02,160
to Fiddler that was able to do that

237
00:10:02,160 --> 00:10:04,380
but that didn't look like a really like

238
00:10:04,380 --> 00:10:05,760
a solved message so there was something

239
00:10:05,760 --> 00:10:09,240
wrong so it didn't work actually

240
00:10:09,240 --> 00:10:11,279
and I

241
00:10:11,279 --> 00:10:14,519
looked at the code he had written where

242
00:10:14,519 --> 00:10:16,440
he built that dictionary

243
00:10:16,440 --> 00:10:19,920
and here is the uh the real standard

244
00:10:19,920 --> 00:10:21,839
what should be in that dictionary Can

245
00:10:21,839 --> 00:10:24,060
you spot the difference

246
00:10:24,060 --> 00:10:26,580
it's there

247
00:10:26,580 --> 00:10:29,100
okay so it was missing one value there

248
00:10:29,100 --> 00:10:31,560
and I made a pull request and he fixed

249
00:10:31,560 --> 00:10:35,040
that and finally I was there as you can

250
00:10:35,040 --> 00:10:37,200
see here it's the difference so here's a

251
00:10:37,200 --> 00:10:39,120
sequence acknowledge and here is a reply

252
00:10:39,120 --> 00:10:41,100
to and the the

253
00:10:41,100 --> 00:10:43,440
the one at the lower is the correct one

254
00:10:43,440 --> 00:10:45,839
so now I was able to really see what's

255
00:10:45,839 --> 00:10:47,339
happening there

256
00:10:47,339 --> 00:10:48,480
so

257
00:10:48,480 --> 00:10:49,800
about that over 80 connect

258
00:10:49,800 --> 00:10:51,540
synchronization so it's using

259
00:10:51,540 --> 00:10:55,079
proprietary soap binary XML it can do

260
00:10:55,079 --> 00:10:56,940
the grotting for objects which means

261
00:10:56,940 --> 00:10:59,279
that it can create read update and

262
00:10:59,279 --> 00:11:00,959
delete these users

263
00:11:00,959 --> 00:11:03,899
which uh it has like a synchronized to

264
00:11:03,899 --> 00:11:04,800
the cloud

265
00:11:04,800 --> 00:11:07,860
and then I noticed that the Target and

266
00:11:07,860 --> 00:11:10,260
up the target of update or delete or

267
00:11:10,260 --> 00:11:12,000
whatever whatever of those Squad things

268
00:11:12,000 --> 00:11:15,600
is either Source anchor which is the

269
00:11:15,600 --> 00:11:16,740
immutable ID

270
00:11:16,740 --> 00:11:19,079
or the cloud anchor which is the object

271
00:11:19,079 --> 00:11:22,140
type underscore and object ID in Azure

272
00:11:22,140 --> 00:11:25,500
ID so it's like user blah blah blah so

273
00:11:25,500 --> 00:11:28,800
you could use either of these to as a

274
00:11:28,800 --> 00:11:30,779
well parameter

275
00:11:30,779 --> 00:11:32,760
when you're changing things so I'm gonna

276
00:11:32,760 --> 00:11:35,100
show a demo about this in

277
00:11:35,100 --> 00:11:37,320
in a couple of minutes

278
00:11:37,320 --> 00:11:38,760
but then the password has

279
00:11:38,760 --> 00:11:40,260
synchronization

280
00:11:40,260 --> 00:11:41,579
so

281
00:11:41,579 --> 00:11:44,160
people well originally when Azure 80 was

282
00:11:44,160 --> 00:11:47,399
introduced with uh with a identity

283
00:11:47,399 --> 00:11:50,040
platform for Opus 365

284
00:11:50,040 --> 00:11:52,920
uh you had to have two set of

285
00:11:52,920 --> 00:11:55,440
credentials so one in on-prem and one in

286
00:11:55,440 --> 00:11:57,420
cloud and that kind of annoyed people

287
00:11:57,420 --> 00:12:00,000
then came a thing called oriented

288
00:12:00,000 --> 00:12:01,980
Federation but that was quite heavy

289
00:12:01,980 --> 00:12:04,320
stuff to do that so then they introduced

290
00:12:04,320 --> 00:12:06,300
the password has synchronization which

291
00:12:06,300 --> 00:12:07,920
means that they are synchronizing your

292
00:12:07,920 --> 00:12:10,320
password hashes from on-prem to go out

293
00:12:10,320 --> 00:12:11,640
and then you can use the same password

294
00:12:11,640 --> 00:12:14,399
and it this happens in maybe like two

295
00:12:14,399 --> 00:12:15,959
minutes or so

296
00:12:15,959 --> 00:12:18,300
and just to make sure that you

297
00:12:18,300 --> 00:12:20,100
understand that those passwords are not

298
00:12:20,100 --> 00:12:22,800
at least impressed but hashes of hashes

299
00:12:22,800 --> 00:12:25,519
so they are using a function called

300
00:12:25,519 --> 00:12:28,920
rfc2898 derive bytes function

301
00:12:28,920 --> 00:12:32,820
which I think or everybody know already

302
00:12:32,820 --> 00:12:37,200
and technically it's sha256 from the MD

303
00:12:37,200 --> 00:12:40,079
original MP4 has and you do and with

304
00:12:40,079 --> 00:12:42,720
sound and you do that thousand times

305
00:12:42,720 --> 00:12:44,579
and so this is what is sent actually to

306
00:12:44,579 --> 00:12:45,839
to the cloud

307
00:12:45,839 --> 00:12:47,579
so there's a string so we have the

308
00:12:47,579 --> 00:12:49,860
version which is always one has function

309
00:12:49,860 --> 00:12:52,560
is always same there's a salt and number

310
00:12:52,560 --> 00:12:55,920
of iterations and then the actual hash

311
00:12:55,920 --> 00:12:57,560
and

312
00:12:57,560 --> 00:12:59,880
actually I'm able to use the same

313
00:12:59,880 --> 00:13:04,260
function to send password hashes so for

314
00:13:04,260 --> 00:13:05,820
instance I was playing around with the

315
00:13:05,820 --> 00:13:07,920
iteration so I can actually because I'm

316
00:13:07,920 --> 00:13:09,600
sending this myself I can say that I

317
00:13:09,600 --> 00:13:12,420
only did one iteration that works fine

318
00:13:12,420 --> 00:13:15,240
so I I was able to make that less secure

319
00:13:15,240 --> 00:13:18,240
also I was able to make it more secure

320
00:13:18,240 --> 00:13:20,880
by introducing more iterations I I did

321
00:13:20,880 --> 00:13:24,300
10 000 but then the other ID didn't like

322
00:13:24,300 --> 00:13:26,579
that anymore because it has to do that

323
00:13:26,579 --> 00:13:29,100
also every every time every someone is

324
00:13:29,100 --> 00:13:30,720
looking in it had to do that like ten

325
00:13:30,720 --> 00:13:32,880
thousand times and it didn't like that

326
00:13:32,880 --> 00:13:34,380
very much

327
00:13:34,380 --> 00:13:35,639
okay

328
00:13:35,639 --> 00:13:37,560
so here's a demo

329
00:13:37,560 --> 00:13:41,579
so I listed users from us ready and we

330
00:13:41,579 --> 00:13:43,560
have the source anchor here right and

331
00:13:43,560 --> 00:13:46,620
the cloud anchor and we choose to use

332
00:13:46,620 --> 00:13:49,740
lean as an example it's that one

333
00:13:49,740 --> 00:13:53,279
and we first run a command so set a 18

334
00:13:53,279 --> 00:13:55,980
a80 into user password use Source anchor

335
00:13:55,980 --> 00:13:58,740
and use password a and that is sent to

336
00:13:58,740 --> 00:14:03,120
cloud and this is how it looks like so

337
00:14:03,120 --> 00:14:06,300
this is the actual soap message sent to

338
00:14:06,300 --> 00:14:07,320
as ready

339
00:14:07,320 --> 00:14:10,200
and what we can see here is the source

340
00:14:10,200 --> 00:14:12,240
anchor right here

341
00:14:12,240 --> 00:14:15,720
so that is the immutable ID but if we go

342
00:14:15,720 --> 00:14:18,300
up a bit we can see that the cloud

343
00:14:18,300 --> 00:14:20,940
anchor is empty but it's but it is there

344
00:14:20,940 --> 00:14:23,040
and at this point I I was trying to

345
00:14:23,040 --> 00:14:25,440
wonder that can I actually use that too

346
00:14:25,440 --> 00:14:27,839
so can I use cloud anchor to reset

347
00:14:27,839 --> 00:14:31,440
passwords and yes I can do that

348
00:14:31,440 --> 00:14:33,660
so the same but now with the cloud

349
00:14:33,660 --> 00:14:36,660
anchor and the message is again same but

350
00:14:36,660 --> 00:14:38,700
now there's a cloud anchor but there's

351
00:14:38,700 --> 00:14:41,880
no Source anchor

352
00:14:41,880 --> 00:14:44,940
and that kind of tells me that I can

353
00:14:44,940 --> 00:14:46,320
actually now use that

354
00:14:46,320 --> 00:14:48,779
and what else can I do with with that uh

355
00:14:48,779 --> 00:14:50,579
Source anchor or call Cloud anchor what

356
00:14:50,579 --> 00:14:52,980
can I do so I can uh change the display

357
00:14:52,980 --> 00:14:56,339
name so it changed to you being hacked

358
00:14:56,339 --> 00:14:59,639
so you can do this if you're able to get

359
00:14:59,639 --> 00:15:00,959
those credentials so you can do this

360
00:15:00,959 --> 00:15:03,660
from home if you want to using my tool

361
00:15:03,660 --> 00:15:06,300
and then you can also like delete users

362
00:15:06,300 --> 00:15:08,940
so it's there only delete it user you

363
00:15:08,940 --> 00:15:11,220
can do that too using the source anchor

364
00:15:11,220 --> 00:15:13,800
or Cloud anchor it doesn't matter

365
00:15:13,800 --> 00:15:17,339
and then it was my first like what if

366
00:15:17,339 --> 00:15:18,360
moment

367
00:15:18,360 --> 00:15:21,180
so I was wondering that okay

368
00:15:21,180 --> 00:15:23,519
the cloud anchor is like this so it's

369
00:15:23,519 --> 00:15:26,160
formed like object type underscore and

370
00:15:26,160 --> 00:15:28,740
then the optic ID net already

371
00:15:28,740 --> 00:15:29,880
and

372
00:15:29,880 --> 00:15:33,300
could I use that to also do same stuff

373
00:15:33,300 --> 00:15:35,459
to Cloud only users with standard

374
00:15:35,459 --> 00:15:37,260
synchronized

375
00:15:37,260 --> 00:15:40,199
and yeah I could do that

376
00:15:40,199 --> 00:15:43,019
so even though the user was not

377
00:15:43,019 --> 00:15:44,940
synchronized I was able to delete those

378
00:15:44,940 --> 00:15:47,519
users I was able to reset the passwords

379
00:15:47,519 --> 00:15:49,560
including Global admins

380
00:15:49,560 --> 00:15:52,320
so there was a clear like a previous

381
00:15:52,320 --> 00:15:55,260
escalation from on-prem admin

382
00:15:55,260 --> 00:15:57,540
of that has already connect box to

383
00:15:57,540 --> 00:15:59,519
Global admin because we were able to

384
00:15:59,519 --> 00:16:01,560
reset passwords right

385
00:16:01,560 --> 00:16:05,339
so now some of the pain I share with

386
00:16:05,339 --> 00:16:06,420
James

387
00:16:06,420 --> 00:16:09,480
so here are my reports to Microsoft so I

388
00:16:09,480 --> 00:16:11,519
tell that you can reset Cloud only

389
00:16:11,519 --> 00:16:14,959
passwords and they say that's not

390
00:16:14,959 --> 00:16:17,100
non-msrc case

391
00:16:17,100 --> 00:16:21,480
and it was this was on uh May 2020.

392
00:16:21,480 --> 00:16:24,300
and then I create another one a year

393
00:16:24,300 --> 00:16:27,180
later well almost a year later

394
00:16:27,180 --> 00:16:29,220
that it also now allows you to delete

395
00:16:29,220 --> 00:16:31,440
those users I found out that that you

396
00:16:31,440 --> 00:16:33,779
can delete all the global armies

397
00:16:33,779 --> 00:16:36,060
so they can log in because they're

398
00:16:36,060 --> 00:16:39,739
deleted right but that was like

399
00:16:39,779 --> 00:16:43,759
this is is intended Behavior

400
00:16:45,240 --> 00:16:49,380
and I was like it it isn't and and it

401
00:16:49,380 --> 00:16:51,420
was very frustrating I I had a lot of

402
00:16:51,420 --> 00:16:53,279
these customers with msrc and actually

403
00:16:53,279 --> 00:16:57,360
finally I I knew a guy from Mystic uh

404
00:16:57,360 --> 00:17:00,060
which is a organization in Microsoft

405
00:17:00,060 --> 00:17:02,399
that is a

406
00:17:02,399 --> 00:17:05,520
doing the threat to research if you will

407
00:17:05,520 --> 00:17:07,980
and they have like published those Noble

408
00:17:07,980 --> 00:17:09,959
email reports lately so that's an

409
00:17:09,959 --> 00:17:11,760
interesting organization there

410
00:17:11,760 --> 00:17:14,699
and I I knew the guide there and I I

411
00:17:14,699 --> 00:17:16,859
told him that that could you please take

412
00:17:16,859 --> 00:17:19,619
a look and and he took a look I don't

413
00:17:19,619 --> 00:17:22,319
know did it help or not but this then

414
00:17:22,319 --> 00:17:25,559
said me that as initi as initially

415
00:17:25,559 --> 00:17:27,839
stated this is an intended behavior

416
00:17:27,839 --> 00:17:30,840
however we did uncover something else

417
00:17:30,840 --> 00:17:34,140
that is uh needs to be fixed

418
00:17:34,140 --> 00:17:37,440
so they never had admitted that

419
00:17:37,440 --> 00:17:40,440
that was a vulnerability but they said

420
00:17:40,440 --> 00:17:41,820
that they found something else

421
00:17:41,820 --> 00:17:45,120
but anyways uh as

422
00:17:45,120 --> 00:17:47,400
uh the last speaker said they are

423
00:17:47,400 --> 00:17:49,260
different like categories and an

424
00:17:49,260 --> 00:17:51,539
importance level and this was uh severe

425
00:17:51,539 --> 00:17:54,539
severity was important and the impact

426
00:17:54,539 --> 00:17:57,539
was elevation privilege in Cloud which

427
00:17:57,539 --> 00:17:58,980
is uh usually very

428
00:17:58,980 --> 00:18:02,220
well paid if you will I think that's the

429
00:18:02,220 --> 00:18:04,260
most well paid currently besides the

430
00:18:04,260 --> 00:18:06,299
highway of course

431
00:18:06,299 --> 00:18:07,260
okay

432
00:18:07,260 --> 00:18:11,880
and uh then after 500 Days of the

433
00:18:11,880 --> 00:18:14,460
initial report it was fixed like a year

434
00:18:14,460 --> 00:18:15,900
ago

435
00:18:15,900 --> 00:18:17,940
and uh

436
00:18:17,940 --> 00:18:20,700
the buck was twenty thousand dollars

437
00:18:20,700 --> 00:18:23,760
for that and it was pretty pretty okay I

438
00:18:23,760 --> 00:18:25,020
like that

439
00:18:25,020 --> 00:18:26,960
but anyways um

440
00:18:26,960 --> 00:18:30,059
what actually we are able to do or we

441
00:18:30,059 --> 00:18:31,860
were able to do it we are not able to do

442
00:18:31,860 --> 00:18:33,840
that anymore but what we what we could

443
00:18:33,840 --> 00:18:37,080
do back then so we were able to you know

444
00:18:37,080 --> 00:18:39,179
reset Cloud only users passwords which

445
00:18:39,179 --> 00:18:41,820
should not be a possible

446
00:18:41,820 --> 00:18:44,760
also we could edit group members

447
00:18:44,760 --> 00:18:47,520
of the groups that will go out so I was

448
00:18:47,520 --> 00:18:50,039
able to add myself to a crowd group that

449
00:18:50,039 --> 00:18:53,160
was uh that have assigned some high

450
00:18:53,160 --> 00:18:54,780
probabilities

451
00:18:54,780 --> 00:18:57,000
I could delete the users and that was

452
00:18:57,000 --> 00:18:58,980
actually quite interesting because

453
00:18:58,980 --> 00:19:01,260
you compromised that other ID connect

454
00:19:01,260 --> 00:19:03,419
server you get the credentials you

455
00:19:03,419 --> 00:19:05,039
delete every Global admins and then you

456
00:19:05,039 --> 00:19:07,140
can call to company at okay you have 20

457
00:19:07,140 --> 00:19:08,280
minutes

458
00:19:08,280 --> 00:19:10,260
to pay me a million or I'll delete them

459
00:19:10,260 --> 00:19:11,820
for good

460
00:19:11,820 --> 00:19:14,820
and yeah but that was okay

461
00:19:14,820 --> 00:19:19,020
so that was by Design

462
00:19:19,020 --> 00:19:21,240
and and

463
00:19:21,240 --> 00:19:23,820
the other ones were actually fixed even

464
00:19:23,820 --> 00:19:25,740
though they didn't fix the thing I

465
00:19:25,740 --> 00:19:29,700
reported but eventually they got fixed

466
00:19:29,700 --> 00:19:32,400
and also what else we could do so

467
00:19:32,400 --> 00:19:34,140
um we could add

468
00:19:34,140 --> 00:19:37,320
like immutable IDs or seats to Cloud all

469
00:19:37,320 --> 00:19:39,059
users which means that you could then

470
00:19:39,059 --> 00:19:42,480
use those users for Golden saml or

471
00:19:42,480 --> 00:19:45,059
silver ticket attacks

472
00:19:45,059 --> 00:19:46,620
uh

473
00:19:46,620 --> 00:19:48,660
so you could log in as them

474
00:19:48,660 --> 00:19:50,520
so you don't need to delete them you

475
00:19:50,520 --> 00:19:52,440
don't need to reset the password you

476
00:19:52,440 --> 00:19:54,660
could log in ask them if you just add

477
00:19:54,660 --> 00:19:56,880
that immutable ID to users and use that

478
00:19:56,880 --> 00:19:59,160
immutable ID in the Google example

479
00:19:59,160 --> 00:19:59,940
tickets

480
00:19:59,940 --> 00:20:01,980
but that's another story

481
00:20:01,980 --> 00:20:05,340
and this was quite interesting so you

482
00:20:05,340 --> 00:20:07,799
can only also add on-premises some

483
00:20:07,799 --> 00:20:11,039
account name to any account and

484
00:20:11,039 --> 00:20:12,720
I don't know if you are familiar with

485
00:20:12,720 --> 00:20:15,419
the term or concept of azerated Zone

486
00:20:15,419 --> 00:20:17,880
devices but anyway it means that you

487
00:20:17,880 --> 00:20:20,880
have what kind of registered this

488
00:20:20,880 --> 00:20:23,400
or turn the device to that already and

489
00:20:23,400 --> 00:20:25,380
then when you log in it automatically

490
00:20:25,380 --> 00:20:28,919
looks also into your local domain

491
00:20:28,919 --> 00:20:31,440
using the username and password

492
00:20:31,440 --> 00:20:34,020
now if you are able to change that

493
00:20:34,020 --> 00:20:36,299
on-premise some account name it is

494
00:20:36,299 --> 00:20:38,039
actually using that name not the one

495
00:20:38,039 --> 00:20:40,980
that user typed when he logged in

496
00:20:40,980 --> 00:20:43,260
so it is using different username to log

497
00:20:43,260 --> 00:20:46,559
in so for instance if you are if well

498
00:20:46,559 --> 00:20:49,440
this is a kind of academic way but

499
00:20:49,440 --> 00:20:52,500
anyways you know a guy who uses the who

500
00:20:52,500 --> 00:20:54,299
is a global admin I'm sorry the domain

501
00:20:54,299 --> 00:20:57,240
admin and he uses same password you

502
00:20:57,240 --> 00:21:00,000
assume that in his like personal account

503
00:21:00,000 --> 00:21:02,220
and then in the domain admin account and

504
00:21:02,220 --> 00:21:04,620
now you are this admin who can reset

505
00:21:04,620 --> 00:21:06,660
that you reset that and then the user

506
00:21:06,660 --> 00:21:08,820
logs in with his computer but now

507
00:21:08,820 --> 00:21:11,520
instead of using his own username he is

508
00:21:11,520 --> 00:21:13,980
using the domain admin username so then

509
00:21:13,980 --> 00:21:16,980
the laptop logs in as a domain admin and

510
00:21:16,980 --> 00:21:19,380
now you can hack the box and view a

511
00:21:19,380 --> 00:21:20,400
domain

512
00:21:20,400 --> 00:21:25,620
but yeah that's also like a by-design so

513
00:21:25,620 --> 00:21:28,140
that that is the it could be used but

514
00:21:28,140 --> 00:21:29,220
they are not going to do anything about

515
00:21:29,220 --> 00:21:31,380
that

516
00:21:31,380 --> 00:21:33,659
yeah and the last one was that you could

517
00:21:33,659 --> 00:21:36,240
create hybrid fake hybrid Zone devices

518
00:21:36,240 --> 00:21:38,640
which allows you in certain cases bypass

519
00:21:38,640 --> 00:21:40,380
conditional access rules which is kind

520
00:21:40,380 --> 00:21:42,360
of a firewall in as already if you will

521
00:21:42,360 --> 00:21:44,880
that you can create rules to block

522
00:21:44,880 --> 00:21:47,700
access or Grant access based on certain

523
00:21:47,700 --> 00:21:49,799
attributes like for instance is the

524
00:21:49,799 --> 00:21:51,600
device hybrid joint

525
00:21:51,600 --> 00:21:54,080
okay

526
00:21:54,080 --> 00:21:58,860
and then to the Peaks

527
00:21:58,860 --> 00:22:01,200
so what is the fix or what was the fix

528
00:22:01,200 --> 00:22:05,700
so they introduced a new setting or a

529
00:22:05,700 --> 00:22:08,580
directory synchronization feature

530
00:22:08,580 --> 00:22:10,980
as they call it which is called block

531
00:22:10,980 --> 00:22:13,860
Cloud object takeover through hard maths

532
00:22:13,860 --> 00:22:17,159
which is always easy to remember

533
00:22:17,159 --> 00:22:19,679
and here at the bottom we see the

534
00:22:19,679 --> 00:22:24,360
command that you need to run to set that

535
00:22:24,360 --> 00:22:28,020
so set Ms all these data sync Feature

536
00:22:28,020 --> 00:22:30,299
Feature block blah blah blah enable true

537
00:22:30,299 --> 00:22:32,580
and then you can use the force so it

538
00:22:32,580 --> 00:22:33,780
doesn't prompt you are you sure about

539
00:22:33,780 --> 00:22:36,260
that or not

540
00:22:37,380 --> 00:22:39,780
and that was the fix okay

541
00:22:39,780 --> 00:22:43,799
and fine it works fine and um

542
00:22:43,799 --> 00:22:46,440
then how to evade this so

543
00:22:46,440 --> 00:22:50,039
I I wasn't this was not my intention to

544
00:22:50,039 --> 00:22:53,400
evade that it was accident actually so

545
00:22:53,400 --> 00:22:56,280
uh little more about background or what

546
00:22:56,280 --> 00:22:59,159
happens when you are running this

547
00:22:59,159 --> 00:23:01,919
Direction synchronization so it runs

548
00:23:01,919 --> 00:23:04,620
automatically every 30 minutes or if you

549
00:23:04,620 --> 00:23:08,280
manually start that so for instance if

550
00:23:08,280 --> 00:23:10,740
if someone is leading from your

551
00:23:10,740 --> 00:23:12,720
organization and you want to disable

552
00:23:12,720 --> 00:23:15,000
that immediately also in Cloud you

553
00:23:15,000 --> 00:23:17,220
disable it in on-prem and then say

554
00:23:17,220 --> 00:23:19,679
manually start the adhesync cycle and it

555
00:23:19,679 --> 00:23:20,419
will

556
00:23:20,419 --> 00:23:22,980
automatically do that but otherwise it's

557
00:23:22,980 --> 00:23:25,020
in every 30 minutes

558
00:23:25,020 --> 00:23:27,600
and there's a

559
00:23:27,600 --> 00:23:30,480
parameter called the Sync features it's

560
00:23:30,480 --> 00:23:31,740
a number right

561
00:23:31,740 --> 00:23:33,659
one seven

562
00:23:33,659 --> 00:23:35,280
two oh eight

563
00:23:35,280 --> 00:23:36,919
and that's quite

564
00:23:36,919 --> 00:23:38,940
self-explicatory like like you know what

565
00:23:38,940 --> 00:23:42,900
that means no me didn't deny them but

566
00:23:42,900 --> 00:23:44,640
uh that synchronous sorry the

567
00:23:44,640 --> 00:23:46,320
configuration is fetched every time you

568
00:23:46,320 --> 00:23:49,559
run the synchronization okay

569
00:23:49,559 --> 00:23:53,039
and if you change the settings in Azure

570
00:23:53,039 --> 00:23:54,659
ID connect server for instance if you

571
00:23:54,659 --> 00:23:57,240
enable password has synchronization

572
00:23:57,240 --> 00:24:00,659
it does this so it sends

573
00:24:00,659 --> 00:24:03,960
the new number of the features back to

574
00:24:03,960 --> 00:24:06,000
the battery so now it's different so

575
00:24:06,000 --> 00:24:07,679
it's 89

576
00:24:07,679 --> 00:24:11,400
and here it was 88 so it's so different

577
00:24:11,400 --> 00:24:13,559
so this is the way how

578
00:24:13,559 --> 00:24:14,539
how

579
00:24:14,539 --> 00:24:17,159
the authority and the authority connect

580
00:24:17,159 --> 00:24:19,559
is talking to each other so what what

581
00:24:19,559 --> 00:24:21,900
what features are enabled so that's

582
00:24:21,900 --> 00:24:25,080
basically how they do that conversation

583
00:24:25,080 --> 00:24:28,620
okay so now I noticed that if you are

584
00:24:28,620 --> 00:24:31,380
enabling enabling this block Cloud

585
00:24:31,380 --> 00:24:33,840
object takeover through hard math

586
00:24:33,840 --> 00:24:38,820
feature the dosing features also changed

587
00:24:38,820 --> 00:24:40,679
so we can see that the number is a

588
00:24:40,679 --> 00:24:43,140
little bit higher now so it's not that

589
00:24:43,140 --> 00:24:44,940
what it was but it is it's totally

590
00:24:44,940 --> 00:24:47,539
something different

591
00:24:48,059 --> 00:24:52,740
so again another what if right

592
00:24:52,740 --> 00:24:55,799
so the synchronization API allows

593
00:24:55,799 --> 00:24:59,539
modifying this this Sync features number

594
00:24:59,539 --> 00:25:03,240
and the fix was in the fix that was

595
00:25:03,240 --> 00:25:05,159
introduced was the command that you need

596
00:25:05,159 --> 00:25:07,320
to run and to run that command you need

597
00:25:07,320 --> 00:25:08,940
to be a global admin

598
00:25:08,940 --> 00:25:11,700
okay but if you do this with the

599
00:25:11,700 --> 00:25:14,100
synchronization API you only need to be

600
00:25:14,100 --> 00:25:15,900
that

601
00:25:15,900 --> 00:25:17,700
account that is doing the

602
00:25:17,700 --> 00:25:19,080
synchronization so you don't need to be

603
00:25:19,080 --> 00:25:20,580
global

604
00:25:20,580 --> 00:25:23,820
so I was wondering that can it be used

605
00:25:23,820 --> 00:25:25,860
to disable that fix

606
00:25:25,860 --> 00:25:29,220
and guess what yes

607
00:25:29,220 --> 00:25:31,679
we could do that so they introduced this

608
00:25:31,679 --> 00:25:36,000
uh fix I think it was uh November 3rd

609
00:25:36,000 --> 00:25:40,919
and in November 5th I I was uh Tweeting

610
00:25:40,919 --> 00:25:45,120
or extensing uh messages in Twitter with

611
00:25:45,120 --> 00:25:47,580
a guy from Microsoft so he was from

612
00:25:47,580 --> 00:25:49,559
product group I'm not going to show his

613
00:25:49,559 --> 00:25:51,720
name because I didn't ask permission but

614
00:25:51,720 --> 00:25:54,480
here here are the tweets so I also found

615
00:25:54,480 --> 00:25:56,279
by the way way to disable that and he

616
00:25:56,279 --> 00:25:58,860
said oh that's bad

617
00:25:58,860 --> 00:26:00,960
and yes it makes the new feature like

618
00:26:00,960 --> 00:26:02,520
unusable

619
00:26:02,520 --> 00:26:06,539
so I reported that to msrc as I'm

620
00:26:06,539 --> 00:26:09,179
telling you there but I'm going to show

621
00:26:09,179 --> 00:26:12,480
you first kind of like how did I found

622
00:26:12,480 --> 00:26:14,700
this out okay

623
00:26:14,700 --> 00:26:15,900
so

624
00:26:15,900 --> 00:26:19,320
uh this is this is a function from

625
00:26:19,320 --> 00:26:20,240
Microsoft

626
00:26:20,240 --> 00:26:23,520
Ms online Powershell packets that you

627
00:26:23,520 --> 00:26:25,620
can do to list those features that they

628
00:26:25,620 --> 00:26:26,640
are

629
00:26:26,640 --> 00:26:28,559
and as you can see there's a lot of

630
00:26:28,559 --> 00:26:30,539
those features and some are on some on

631
00:26:30,539 --> 00:26:34,679
off okay and I was like uh using the

632
00:26:34,679 --> 00:26:36,960
direct to synchronous API I was changing

633
00:26:36,960 --> 00:26:38,100
that number

634
00:26:38,100 --> 00:26:41,100
and then I was here what changed

635
00:26:41,100 --> 00:26:44,100
okay so that way I was able to kind of

636
00:26:44,100 --> 00:26:46,200
reverse engineer that so here are

637
00:26:46,200 --> 00:26:48,480
actually my notes from notepad of course

638
00:26:48,480 --> 00:26:50,039
because that's the best way to keep your

639
00:26:50,039 --> 00:26:52,860
notes and here you can see that what the

640
00:26:52,860 --> 00:26:54,240
bits means

641
00:26:54,240 --> 00:26:56,760
so I was able to figure out most of

642
00:26:56,760 --> 00:26:58,919
those some of those I had to actually

643
00:26:58,919 --> 00:27:03,059
reverse engineering the or use the DS pi

644
00:27:03,059 --> 00:27:05,840
to see the actual source code of that

645
00:27:05,840 --> 00:27:08,400
synchronization agent to find some of

646
00:27:08,400 --> 00:27:10,980
those and the rest of was just like

647
00:27:10,980 --> 00:27:13,440
switching the bit on or off and see what

648
00:27:13,440 --> 00:27:14,940
happens

649
00:27:14,940 --> 00:27:18,059
in here so that was how I was able to

650
00:27:18,059 --> 00:27:19,740
figure out how it works

651
00:27:19,740 --> 00:27:22,320
and what those values means and also I

652
00:27:22,320 --> 00:27:25,440
was able to find out that the that as a

653
00:27:25,440 --> 00:27:27,600
global admin using that Microsoft

654
00:27:27,600 --> 00:27:29,880
command you were not able to change all

655
00:27:29,880 --> 00:27:32,400
of those settings but with this API you

656
00:27:32,400 --> 00:27:34,500
were able to change everything even

657
00:27:34,500 --> 00:27:37,140
those that you are not supposed to do I

658
00:27:37,140 --> 00:27:39,900
don't know like here are things that I

659
00:27:39,900 --> 00:27:42,740
haven't like even tried that

660
00:27:42,740 --> 00:27:45,120
what does this means enable Cloud

661
00:27:45,120 --> 00:27:48,120
password sorry quote Cloud password

662
00:27:48,120 --> 00:27:50,039
policy for password sync views I don't

663
00:27:50,039 --> 00:27:51,539
know what that means

664
00:27:51,539 --> 00:27:54,179
uh or what that means you'll be a

665
00:27:54,179 --> 00:27:56,460
duplicate European resiliency I don't

666
00:27:56,460 --> 00:27:58,620
know but I I would assume that that

667
00:27:58,620 --> 00:28:00,539
might break something so I I didn't even

668
00:28:00,539 --> 00:28:02,340
try that

669
00:28:02,340 --> 00:28:05,220
but anyways these were my

670
00:28:05,220 --> 00:28:06,840
my like

671
00:28:06,840 --> 00:28:09,059
notes about that and then I implemented

672
00:28:09,059 --> 00:28:11,120
this stuff in in Azure ID

673
00:28:11,120 --> 00:28:15,120
or my A8 internals

674
00:28:15,120 --> 00:28:19,500
okay so summary of this stuff so the

675
00:28:19,500 --> 00:28:21,419
original vulnerability was the privilege

676
00:28:21,419 --> 00:28:24,120
escalation from the directive

677
00:28:24,120 --> 00:28:26,340
synchronous accounts role to Global

678
00:28:26,340 --> 00:28:27,659
admin role

679
00:28:27,659 --> 00:28:31,740
and tip for working with Microsoft isnet

680
00:28:31,740 --> 00:28:33,840
be persistent if you think something is

681
00:28:33,840 --> 00:28:34,740
wrong

682
00:28:34,740 --> 00:28:37,140
and it might be

683
00:28:37,140 --> 00:28:39,120
I think change means that don't be a

684
00:28:39,120 --> 00:28:40,020
dick

685
00:28:40,020 --> 00:28:43,200
I think that was your worst but mine so

686
00:28:43,200 --> 00:28:46,799
that helps and also uh especially this

687
00:28:46,799 --> 00:28:48,900
stuff well you are the real hacker so

688
00:28:48,900 --> 00:28:50,520
I'm just finding like this business

689
00:28:50,520 --> 00:28:52,919
looking errors and and especially in

690
00:28:52,919 --> 00:28:55,200
Cloud they're in World there can be like

691
00:28:55,200 --> 00:28:57,000
five people who knows about this you are

692
00:28:57,000 --> 00:28:59,460
the one so it's it would be a quite

693
00:28:59,460 --> 00:29:01,140
interesting challenge if those trials

694
00:29:01,140 --> 00:29:03,600
who are looking your Buckle report are

695
00:29:03,600 --> 00:29:06,480
one of them they usually are not so you

696
00:29:06,480 --> 00:29:08,279
might need to explain things differently

697
00:29:08,279 --> 00:29:10,320
and you can always contact me if you

698
00:29:10,320 --> 00:29:12,360
want help with that because I'm in in

699
00:29:12,360 --> 00:29:15,539
good terms with msrc and I can you know

700
00:29:15,539 --> 00:29:18,419
change the report for instance it was on

701
00:29:18,419 --> 00:29:20,580
February there was one guy from India

702
00:29:20,580 --> 00:29:22,500
who was uh

703
00:29:22,500 --> 00:29:25,500
ranting in Twitter if you will that msrc

704
00:29:25,500 --> 00:29:28,260
was bad guy They didn't accept my report

705
00:29:28,260 --> 00:29:31,260
and I sent a message that we can have a

706
00:29:31,260 --> 00:29:32,039
look

707
00:29:32,039 --> 00:29:35,220
and we actually split his his report to

708
00:29:35,220 --> 00:29:38,820
three cases one is now fixed uh two or

709
00:29:38,820 --> 00:29:41,700
two is fixed and one has fixed coming at

710
00:29:41,700 --> 00:29:42,659
some point

711
00:29:42,659 --> 00:29:46,020
uh but uh one of those things was there

712
00:29:46,020 --> 00:29:48,360
was an API that you could use to list

713
00:29:48,360 --> 00:29:51,000
people from the organization who who

714
00:29:51,000 --> 00:29:53,940
created certain things

715
00:29:53,940 --> 00:29:58,080
and msrc said that that yeah that's an

716
00:29:58,080 --> 00:30:00,960
issue but that's not severe issue enough

717
00:30:00,960 --> 00:30:02,340
so you are not going to get pounding

718
00:30:02,340 --> 00:30:05,279
we're gonna fix that but nobody for you

719
00:30:05,279 --> 00:30:07,980
and and based on the documentation those

720
00:30:07,980 --> 00:30:10,380
people were actually Global admins or

721
00:30:10,380 --> 00:30:12,240
user admins so they were admin accounts

722
00:30:12,240 --> 00:30:14,700
and I I argued them that this is

723
00:30:14,700 --> 00:30:16,620
actually quite severe to me

724
00:30:16,620 --> 00:30:19,679
so they were then that oh that's correct

725
00:30:19,679 --> 00:30:21,899
that's what our documentation says so he

726
00:30:21,899 --> 00:30:24,179
was actually about it seven and a half

727
00:30:24,179 --> 00:30:26,820
thousand uh US Dollars Bounty and he was

728
00:30:26,820 --> 00:30:28,620
quite happy about that

729
00:30:28,620 --> 00:30:31,080
so yeah I can help you with those kind

730
00:30:31,080 --> 00:30:32,220
of things

731
00:30:32,220 --> 00:30:34,260
and then the fix what that was provided

732
00:30:34,260 --> 00:30:37,020
it's a new feed so which you can enable

733
00:30:37,020 --> 00:30:39,779
and then I was able to you know evade

734
00:30:39,779 --> 00:30:41,820
that using the different protocol

735
00:30:41,820 --> 00:30:44,100
so that's also a tip that those

736
00:30:44,100 --> 00:30:47,159
proprietary protocols they are sometimes

737
00:30:47,159 --> 00:30:50,340
bypassing the security boundaries in a

738
00:30:50,340 --> 00:30:52,860
way that they didn't thought about

739
00:30:52,860 --> 00:30:55,380
so you can also try to those to do

740
00:30:55,380 --> 00:30:56,820
things

741
00:30:56,820 --> 00:30:59,100
Okay so

742
00:30:59,100 --> 00:31:01,320
yeah I think I'm a little ahead of my

743
00:31:01,320 --> 00:31:04,050
time so thank you for having me

744
00:31:04,050 --> 00:31:09,379
[Applause]

