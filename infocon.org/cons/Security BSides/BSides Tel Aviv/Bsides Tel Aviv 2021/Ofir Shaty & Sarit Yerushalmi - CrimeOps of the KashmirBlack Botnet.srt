1
00:00:00,000 --> 00:00:03,600
and now we have a really dynamic and

2
00:00:03,600 --> 00:00:07,040
sweet duo of speakers who have

3
00:00:07,040 --> 00:00:09,200
never presented at b-sides tel aviv

4
00:00:09,200 --> 00:00:10,080
before

5
00:00:10,080 --> 00:00:12,719
but they have presented at b-sides san

6
00:00:12,719 --> 00:00:14,240
antonio texas

7
00:00:14,240 --> 00:00:17,279
and besides munich in germany and i'd

8
00:00:17,279 --> 00:00:18,640
like to tell you a little bit about our

9
00:00:18,640 --> 00:00:19,760
next speakers

10
00:00:19,760 --> 00:00:21,600
i would like to invite them to join me

11
00:00:21,600 --> 00:00:23,439
on the stage sarit and

12
00:00:23,439 --> 00:00:24,960
fear please join me on the stage let's

13
00:00:24,960 --> 00:00:28,000
give them a warm welcome

14
00:00:28,000 --> 00:00:31,039
and please join me here yes and uh

15
00:00:31,039 --> 00:00:33,760
as they get ready they bring up their

16
00:00:33,760 --> 00:00:35,600
courage give them all the love for first

17
00:00:35,600 --> 00:00:37,120
time besides tel aviv speakers we're

18
00:00:37,120 --> 00:00:38,079
going to bring them

19
00:00:38,079 --> 00:00:40,879
the chaser shots as is the tradition

20
00:00:40,879 --> 00:00:41,440
they each

21
00:00:41,440 --> 00:00:43,680
chose a beverage of their liking i want

22
00:00:43,680 --> 00:00:44,640
to tell you that

23
00:00:44,640 --> 00:00:47,440
sarit and ophir have some comments

24
00:00:47,440 --> 00:00:48,879
cheers

25
00:00:48,879 --> 00:00:52,000
they have something in common so

26
00:00:52,000 --> 00:00:54,960
ophir likes to take road trips on

27
00:00:54,960 --> 00:00:56,160
motorcycles

28
00:00:56,160 --> 00:00:59,199
and sarit likes to travel which is a

29
00:00:59,199 --> 00:01:00,719
shame because we didn't get a lot of

30
00:01:00,719 --> 00:01:02,160
travel the past year

31
00:01:02,160 --> 00:01:04,159
but right now they're going to take us

32
00:01:04,159 --> 00:01:05,360
on a journey

33
00:01:05,360 --> 00:01:08,400
into the world of the cashmere black

34
00:01:08,400 --> 00:01:13,840
botnet the stage is yours thank you

35
00:01:14,400 --> 00:01:16,720
hi everyone good morning i hope you

36
00:01:16,720 --> 00:01:19,040
enjoyed your coffee break

37
00:01:19,040 --> 00:01:22,240
so we hear about buttons all the time

38
00:01:22,240 --> 00:01:25,119
and in this session we'll we will take

39
00:01:25,119 --> 00:01:26,320
you down the rabbit hole

40
00:01:26,320 --> 00:01:29,360
into our important investigation we'll

41
00:01:29,360 --> 00:01:31,280
show you what we learned

42
00:01:31,280 --> 00:01:32,960
and we'll give you a few tips for your

43
00:01:32,960 --> 00:01:34,720
next botnet in

44
00:01:34,720 --> 00:01:37,600
investigation i will start by talking

45
00:01:37,600 --> 00:01:39,360
about the cashmere black botnet

46
00:01:39,360 --> 00:01:41,600
describe its entities and if it will

47
00:01:41,600 --> 00:01:43,360
continue and describe the operation

48
00:01:43,360 --> 00:01:46,159
and the devops behind it but before we

49
00:01:46,159 --> 00:01:47,840
start

50
00:01:47,840 --> 00:01:49,840
let me introduce myself and it doesn't

51
00:01:49,840 --> 00:01:51,600
work

52
00:01:51,600 --> 00:01:54,479
okay my name is sarit and i'm a security

53
00:01:54,479 --> 00:01:56,399
researcher at imperva for the last 10

54
00:01:56,399 --> 00:01:57,520
years

55
00:01:57,520 --> 00:02:00,560
i mainly focus on application security

56
00:02:00,560 --> 00:02:02,560
and i develop algorithms to detect and

57
00:02:02,560 --> 00:02:03,360
protect

58
00:02:03,360 --> 00:02:06,719
against attacks i'm off here and i'm

59
00:02:06,719 --> 00:02:08,800
also security researcher at imperva for

60
00:02:08,800 --> 00:02:10,080
the last five years

61
00:02:10,080 --> 00:02:12,480
and focus mainly in database and web

62
00:02:12,480 --> 00:02:14,160
application security

63
00:02:14,160 --> 00:02:17,520
and we are both very excited to be here

64
00:02:17,520 --> 00:02:21,520
indeed so

65
00:02:21,520 --> 00:02:23,440
before we dive into the bits and bytes

66
00:02:23,440 --> 00:02:24,720
of our research

67
00:02:24,720 --> 00:02:26,560
let me introduce you with the kashmir

68
00:02:26,560 --> 00:02:29,360
black botnet

69
00:02:31,280 --> 00:02:37,200
okay it doesn't work oh

70
00:02:37,200 --> 00:02:40,160
again sorry

71
00:02:41,200 --> 00:02:44,800
i don't know what happened is that all

72
00:02:44,800 --> 00:02:51,840
right that clicker doesn't work

73
00:02:55,200 --> 00:02:59,440
yeah okay i hope it will work now

74
00:02:59,440 --> 00:03:03,599
so it all started on november 2018

75
00:03:03,599 --> 00:03:06,159
and last uh seven months which is

76
00:03:06,159 --> 00:03:08,319
basically a research period of time

77
00:03:08,319 --> 00:03:10,400
we discover a bot net that infects

78
00:03:10,400 --> 00:03:12,720
popular cms platforms

79
00:03:12,720 --> 00:03:16,640
such as and it doesn't work again

80
00:03:16,640 --> 00:03:19,920
my first time sorry for that oh okay so

81
00:03:19,920 --> 00:03:22,560
it mainly affects popular cms platforms

82
00:03:22,560 --> 00:03:23,920
such as wordpress

83
00:03:23,920 --> 00:03:26,799
drupal magento in more than 60 different

84
00:03:26,799 --> 00:03:28,640
countries around the world

85
00:03:28,640 --> 00:03:30,319
it performs the millions of attacks per

86
00:03:30,319 --> 00:03:32,720
day on average and we calculated

87
00:03:32,720 --> 00:03:34,159
that there were hundreds of thousands of

88
00:03:34,159 --> 00:03:36,000
boats out there participating in the

89
00:03:36,000 --> 00:03:37,680
botnet operation

90
00:03:37,680 --> 00:03:39,760
those bots utilize dozens of

91
00:03:39,760 --> 00:03:41,040
non-vulnerabilities

92
00:03:41,040 --> 00:03:42,959
such as remote code execution file

93
00:03:42,959 --> 00:03:45,519
upload and many more

94
00:03:45,519 --> 00:03:48,000
this session is a journey into the

95
00:03:48,000 --> 00:03:49,200
botnet core

96
00:03:49,200 --> 00:03:51,760
from the attacker point of view so let's

97
00:03:51,760 --> 00:03:53,680
start

98
00:03:53,680 --> 00:03:56,080
security research investigation can

99
00:03:56,080 --> 00:03:57,680
sometimes be like a crime scene

100
00:03:57,680 --> 00:03:59,040
investigation

101
00:03:59,040 --> 00:04:01,280
but our crime scene is spread all over

102
00:04:01,280 --> 00:04:02,239
the network

103
00:04:02,239 --> 00:04:04,560
with nobody in place so we need to

104
00:04:04,560 --> 00:04:05,599
collect the clues

105
00:04:05,599 --> 00:04:07,920
and fingerprints to construct the

106
00:04:07,920 --> 00:04:11,679
picture of the virtual crime

107
00:04:12,000 --> 00:04:15,120
a recent study in imperva we saw

108
00:04:15,120 --> 00:04:17,199
nine million attack attempts exploiting

109
00:04:17,199 --> 00:04:19,839
php unit remote code execution

110
00:04:19,839 --> 00:04:22,880
and we were wondering why is this cv so

111
00:04:22,880 --> 00:04:24,960
popular among attackers

112
00:04:24,960 --> 00:04:27,520
to understand this hype we started to

113
00:04:27,520 --> 00:04:28,080
analyze

114
00:04:28,080 --> 00:04:30,639
data from our data lake we saw different

115
00:04:30,639 --> 00:04:32,880
ips using the same payload

116
00:04:32,880 --> 00:04:34,880
over and over again attacking different

117
00:04:34,880 --> 00:04:36,080
customers

118
00:04:36,080 --> 00:04:39,360
which remind us abutment behavior

119
00:04:39,360 --> 00:04:41,680
so we decided to download the payload

120
00:04:41,680 --> 00:04:43,199
and dive in

121
00:04:43,199 --> 00:04:45,040
and we basically started the mapping

122
00:04:45,040 --> 00:04:46,240
step

123
00:04:46,240 --> 00:04:48,560
we started the button it is updating uh

124
00:04:48,560 --> 00:04:49,759
we we ana

125
00:04:49,759 --> 00:04:52,479
we analyzed the code and revealed all

126
00:04:52,479 --> 00:04:54,080
the entities of the botnet and later

127
00:04:54,080 --> 00:04:56,560
we'll talk about it in further detail

128
00:04:56,560 --> 00:04:58,479
the next the next step we took was

129
00:04:58,479 --> 00:04:59,759
infiltrate

130
00:04:59,759 --> 00:05:01,360
we saw that a botnet is updating on a

131
00:05:01,360 --> 00:05:02,960
regular basis

132
00:05:02,960 --> 00:05:05,440
so we decided to act like a bot and

133
00:05:05,440 --> 00:05:08,400
gather these updates for later analysis

134
00:05:08,400 --> 00:05:12,080
and finally we played a victim

135
00:05:12,080 --> 00:05:15,360
we wanted to understand the post

136
00:05:15,360 --> 00:05:18,400
exploitation stage

137
00:05:18,479 --> 00:05:20,800
now let's review all those entities that

138
00:05:20,800 --> 00:05:24,080
play a role in this massive operation

139
00:05:24,080 --> 00:05:26,240
so the kashmir black botnet entities can

140
00:05:26,240 --> 00:05:27,600
be split into three

141
00:05:27,600 --> 00:05:30,639
groups the first one is the

142
00:05:30,639 --> 00:05:32,639
kashmir black infra the botnet

143
00:05:32,639 --> 00:05:33,919
infrastructure

144
00:05:33,919 --> 00:05:36,840
the third party services and the botnet

145
00:05:36,840 --> 00:05:39,440
actors under the botnet infrastructure

146
00:05:39,440 --> 00:05:40,560
we have the cnc

147
00:05:40,560 --> 00:05:43,520
and repositories and b under the third

148
00:05:43,520 --> 00:05:44,560
party services

149
00:05:44,560 --> 00:05:47,199
we have github basement dropbox that the

150
00:05:47,199 --> 00:05:48,160
attacker used

151
00:05:48,160 --> 00:05:52,320
in order to secure the cnc

152
00:05:52,320 --> 00:05:54,080
hide this traffic behind legit cloud

153
00:05:54,080 --> 00:05:56,400
services and

154
00:05:56,400 --> 00:05:59,280
to um

155
00:05:59,520 --> 00:06:01,759
um okay let's move on and under

156
00:06:01,759 --> 00:06:03,039
department actors

157
00:06:03,039 --> 00:06:05,600
we have uh the victim and two types of

158
00:06:05,600 --> 00:06:06,080
bots

159
00:06:06,080 --> 00:06:09,199
and later i will elaborate on that

160
00:06:09,199 --> 00:06:13,039
so here is the command and control

161
00:06:13,039 --> 00:06:16,639
this is the um the entity is responsible

162
00:06:16,639 --> 00:06:19,039
for the entire operation

163
00:06:19,039 --> 00:06:21,440
it is located in indonesia and has three

164
00:06:21,440 --> 00:06:22,720
main roles

165
00:06:22,720 --> 00:06:24,960
it supplies attack instructions to bots

166
00:06:24,960 --> 00:06:27,440
it receives attack reports from bots

167
00:06:27,440 --> 00:06:30,240
and it supplies the infection script to

168
00:06:30,240 --> 00:06:32,400
infect the victim server

169
00:06:32,400 --> 00:06:34,319
and here is a snapshot of the infection

170
00:06:34,319 --> 00:06:35,440
script

171
00:06:35,440 --> 00:06:37,039
we can see that attacker defines a

172
00:06:37,039 --> 00:06:39,039
parameter that represents

173
00:06:39,039 --> 00:06:42,000
a quantum task

174
00:06:42,720 --> 00:06:44,720
and this task is scheduled to run every

175
00:06:44,720 --> 00:06:47,680
three minutes and it's written in python

176
00:06:47,680 --> 00:06:50,000
now we can see some imports and the

177
00:06:50,000 --> 00:06:52,639
attacker was using basic stephon coding

178
00:06:52,639 --> 00:06:55,680
to obfuscate its malicious payload now

179
00:06:55,680 --> 00:06:57,759
the output of this task will be sent to

180
00:06:57,759 --> 00:06:58,800
devenal

181
00:06:58,800 --> 00:07:02,080
so no history will be saved

182
00:07:02,080 --> 00:07:04,319
in the next code block we can see that

183
00:07:04,319 --> 00:07:06,160
the attacker redefines the victim

184
00:07:06,160 --> 00:07:07,599
current up tasks

185
00:07:07,599 --> 00:07:09,840
and as part of this redefinition he

186
00:07:09,840 --> 00:07:11,199
validates to remove

187
00:07:11,199 --> 00:07:14,800
all main notifications now one thing to

188
00:07:14,800 --> 00:07:16,720
note here is that attack the attacker

189
00:07:16,720 --> 00:07:18,319
was using the combination

190
00:07:18,319 --> 00:07:20,479
of pell and python which are both

191
00:07:20,479 --> 00:07:22,560
installed out of the box in many linux

192
00:07:22,560 --> 00:07:23,759
systems

193
00:07:23,759 --> 00:07:27,199
so this is probably uh will um

194
00:07:27,199 --> 00:07:29,039
increase the probability of a successful

195
00:07:29,039 --> 00:07:31,120
infection

196
00:07:31,120 --> 00:07:34,639
now let's move to the repositories

197
00:07:34,639 --> 00:07:36,560
the first one repository a as you can

198
00:07:36,560 --> 00:07:37,680
see is a printer

199
00:07:37,680 --> 00:07:39,599
component shopping site which was

200
00:07:39,599 --> 00:07:41,599
attacked by the attacker and was used to

201
00:07:41,599 --> 00:07:43,599
store the communication script file

202
00:07:43,599 --> 00:07:46,720
between the bots and the cnc

203
00:07:46,720 --> 00:07:50,479
now another entity is repository b

204
00:07:50,479 --> 00:07:53,199
which is an educational institute that

205
00:07:53,199 --> 00:07:55,440
was used to store the bundles of export

206
00:07:55,440 --> 00:07:57,360
and payloads

207
00:07:57,360 --> 00:07:59,440
we can see an example of the exploit

208
00:07:59,440 --> 00:08:02,000
payload bundles

209
00:08:02,000 --> 00:08:05,280
actually the attacker files the

210
00:08:05,280 --> 00:08:07,599
the hackers file are located under the

211
00:08:07,599 --> 00:08:08,400
css

212
00:08:08,400 --> 00:08:11,520
directory among other css files used by

213
00:08:11,520 --> 00:08:13,680
this innocent web server

214
00:08:13,680 --> 00:08:15,280
and they are actually start with the

215
00:08:15,280 --> 00:08:17,199
in-memory prefix

216
00:08:17,199 --> 00:08:19,599
and it looks out there css but they

217
00:08:19,599 --> 00:08:20,800
actually zip files

218
00:08:20,800 --> 00:08:23,840
hidden with the css extension

219
00:08:23,840 --> 00:08:26,319
now here is also the modification date

220
00:08:26,319 --> 00:08:27,440
and

221
00:08:27,440 --> 00:08:30,639
one great thing in this botnet is that

222
00:08:30,639 --> 00:08:32,559
the infrastructure is just like plug and

223
00:08:32,559 --> 00:08:35,200
play the attacker can decide to add

224
00:08:35,200 --> 00:08:38,080
new exploit payload bundle just put it

225
00:08:38,080 --> 00:08:38,559
here

226
00:08:38,559 --> 00:08:41,599
under the css directory and that's it

227
00:08:41,599 --> 00:08:43,679
no infrastructure changes are required

228
00:08:43,679 --> 00:08:46,480
just put it and use it whenever you want

229
00:08:46,480 --> 00:08:48,560
now another thing i want to add is that

230
00:08:48,560 --> 00:08:49,760
every file here

231
00:08:49,760 --> 00:08:52,640
represents an exploit the target a

232
00:08:52,640 --> 00:08:55,839
specific vulnerability

233
00:08:56,560 --> 00:08:58,959
now here is a partial list of cves that

234
00:08:58,959 --> 00:09:00,160
this botnet uses

235
00:09:00,160 --> 00:09:03,200
as part of the infection among them we

236
00:09:03,200 --> 00:09:05,120
can see remote code execution

237
00:09:05,120 --> 00:09:08,080
file upload remote file include and many

238
00:09:08,080 --> 00:09:09,360
more

239
00:09:09,360 --> 00:09:12,160
this vulnerability this cves targets

240
00:09:12,160 --> 00:09:14,000
different widgets plugins and

241
00:09:14,000 --> 00:09:18,160
themes and there are even a decade-old

242
00:09:18,160 --> 00:09:22,000
cv from 2011 that is botnet uses in the

243
00:09:22,000 --> 00:09:24,480
in the infection process now the

244
00:09:24,480 --> 00:09:26,560
conclusion here is that

245
00:09:26,560 --> 00:09:28,720
it's not necessary to use an exotic

246
00:09:28,720 --> 00:09:29,760
exploit

247
00:09:29,760 --> 00:09:33,360
in order to expand the botnet

248
00:09:33,920 --> 00:09:35,519
now let's talk about the third party

249
00:09:35,519 --> 00:09:36,959
services

250
00:09:36,959 --> 00:09:38,880
the first one is github which the

251
00:09:38,880 --> 00:09:40,959
attacker was used as a repository to

252
00:09:40,959 --> 00:09:42,640
store his files

253
00:09:42,640 --> 00:09:45,120
when we checked his repository we sell

254
00:09:45,120 --> 00:09:46,800
cryptominers and

255
00:09:46,800 --> 00:09:49,519
php web shells and we can say that by

256
00:09:49,519 --> 00:09:50,480
using github

257
00:09:50,480 --> 00:09:52,399
the attacker was achieving a layer

258
00:09:52,399 --> 00:09:53,760
flexibility

259
00:09:53,760 --> 00:09:56,640
as he can just upload another file here

260
00:09:56,640 --> 00:09:58,160
and add a crypto another

261
00:09:58,160 --> 00:10:00,720
web shell whatever and just use it no

262
00:10:00,720 --> 00:10:03,279
changes to the infrastructure

263
00:10:03,279 --> 00:10:06,320
another entity is spacebin which

264
00:10:06,320 --> 00:10:08,560
is a website that allows anonymous user

265
00:10:08,560 --> 00:10:10,320
to share a plain text

266
00:10:10,320 --> 00:10:12,959
through public posts called pastes

267
00:10:12,959 --> 00:10:15,120
endospace was used by the attacker

268
00:10:15,120 --> 00:10:18,240
as part of the infection and again

269
00:10:18,240 --> 00:10:19,440
the attacker achieved a layer of

270
00:10:19,440 --> 00:10:21,760
flexibility it can as it can just add

271
00:10:21,760 --> 00:10:22,880
another paste

272
00:10:22,880 --> 00:10:25,200
with commands or a web shell or whatever

273
00:10:25,200 --> 00:10:26,880
and use it in the infection

274
00:10:26,880 --> 00:10:29,760
no changes to the infrastructure now

275
00:10:29,760 --> 00:10:32,320
about dropbox or fuel talk later in the

276
00:10:32,320 --> 00:10:33,920
presentation

277
00:10:33,920 --> 00:10:36,959
it was due to secure the cnc it was used

278
00:10:36,959 --> 00:10:39,120
in the upward process and to hide the

279
00:10:39,120 --> 00:10:42,560
traffic behind legit cloud services

280
00:10:42,560 --> 00:10:44,480
now let's talk about the two types of

281
00:10:44,480 --> 00:10:46,079
bots we saw

282
00:10:46,079 --> 00:10:49,519
the first one the spreading bot asap

283
00:10:49,519 --> 00:10:51,360
but it constantly communicated with the

284
00:10:51,360 --> 00:10:54,079
cnc to receive attack instructions

285
00:10:54,079 --> 00:10:56,320
those are comments from the cnc telling

286
00:10:56,320 --> 00:10:57,760
him who to attack

287
00:10:57,760 --> 00:11:01,040
and how and the bot was used to infect

288
00:11:01,040 --> 00:11:02,720
the victim server

289
00:11:02,720 --> 00:11:05,760
and in order to expand the botnet

290
00:11:05,760 --> 00:11:08,560
now a victim site that was infected by a

291
00:11:08,560 --> 00:11:09,519
spreading bot

292
00:11:09,519 --> 00:11:12,560
can become one of two a spreading bot or

293
00:11:12,560 --> 00:11:14,880
a pending bot so let's talk about the

294
00:11:14,880 --> 00:11:16,000
bending bot

295
00:11:16,000 --> 00:11:18,399
now a pending bot as i said just now

296
00:11:18,399 --> 00:11:20,079
it's a victim site

297
00:11:20,079 --> 00:11:22,720
that was infected by a spreading bot and

298
00:11:22,720 --> 00:11:23,920
as a result

299
00:11:23,920 --> 00:11:26,959
is under the control of the cnc waiting

300
00:11:26,959 --> 00:11:28,720
for the cnc to approach

301
00:11:28,720 --> 00:11:30,959
and change its purpose and actually this

302
00:11:30,959 --> 00:11:33,519
is why we named it pending bot

303
00:11:33,519 --> 00:11:35,040
and i will talk about the purpose in a

304
00:11:35,040 --> 00:11:37,360
bit now i just want to add that the

305
00:11:37,360 --> 00:11:38,880
difference between these two

306
00:11:38,880 --> 00:11:41,600
is that the pending bot does not

307
00:11:41,600 --> 00:11:42,959
initiate communication

308
00:11:42,959 --> 00:11:45,760
with the cnc

309
00:11:46,399 --> 00:11:48,399
now let's talk about the button scope

310
00:11:48,399 --> 00:11:49,920
the infiltrate step

311
00:11:49,920 --> 00:11:51,440
so the best way to learn for an

312
00:11:51,440 --> 00:11:53,920
organization is to be part of it

313
00:11:53,920 --> 00:11:56,160
same for learning about botnet and

314
00:11:56,160 --> 00:11:57,440
operation

315
00:11:57,440 --> 00:12:00,240
we call it the infiltrate step so after

316
00:12:00,240 --> 00:12:01,920
we got familiar with all the entities of

317
00:12:01,920 --> 00:12:02,639
the botnet

318
00:12:02,639 --> 00:12:04,800
we wanted to understand the scope of the

319
00:12:04,800 --> 00:12:05,839
botnet

320
00:12:05,839 --> 00:12:08,639
the victims the targets the attacks and

321
00:12:08,639 --> 00:12:09,120
the

322
00:12:09,120 --> 00:12:12,000
evolution and in order to unders to

323
00:12:12,000 --> 00:12:13,600
answer all those questions

324
00:12:13,600 --> 00:12:16,000
we had to take a more active approach to

325
00:12:16,000 --> 00:12:18,959
the investigation

326
00:12:20,160 --> 00:12:22,079
we landed communication particle between

327
00:12:22,079 --> 00:12:24,079
the bots and the cnc

328
00:12:24,079 --> 00:12:27,120
and we mimicked it and we actually had

329
00:12:27,120 --> 00:12:29,040
constant communication

330
00:12:29,040 --> 00:12:31,440
with the cnc to receive all those attack

331
00:12:31,440 --> 00:12:32,320
instructions

332
00:12:32,320 --> 00:12:35,360
we gathered them all together and saved

333
00:12:35,360 --> 00:12:36,079
them

334
00:12:36,079 --> 00:12:39,519
and for later analysis now

335
00:12:39,519 --> 00:12:42,560
here is an example of a request from

336
00:12:42,560 --> 00:12:45,920
a spreading bot to the botnet to the cnc

337
00:12:45,920 --> 00:12:46,560
story

338
00:12:46,560 --> 00:12:49,279
asking to get attack instructions and we

339
00:12:49,279 --> 00:12:51,120
can see a special header

340
00:12:51,120 --> 00:12:54,000
user agent either ghost 8 that without

341
00:12:54,000 --> 00:12:54,639
it

342
00:12:54,639 --> 00:12:57,680
the cnc will not return anything back

343
00:12:57,680 --> 00:13:00,320
and we can say this is some kind of

344
00:13:00,320 --> 00:13:01,680
security

345
00:13:01,680 --> 00:13:04,880
mechanism used by the attacker to avoid

346
00:13:04,880 --> 00:13:08,320
unauthorized access someone will get its

347
00:13:08,320 --> 00:13:11,279
attack instructions now although this is

348
00:13:11,279 --> 00:13:13,200
not a sophisticated

349
00:13:13,200 --> 00:13:15,519
security mechanism it is a basic one to

350
00:13:15,519 --> 00:13:18,240
secure the cnc

351
00:13:18,240 --> 00:13:20,880
now as a response to the request we just

352
00:13:20,880 --> 00:13:21,839
saw

353
00:13:21,839 --> 00:13:24,079
the spreading bot will get attack

354
00:13:24,079 --> 00:13:27,120
instructions in json format

355
00:13:27,120 --> 00:13:30,079
the first parameter the script contains

356
00:13:30,079 --> 00:13:31,440
the list of commands

357
00:13:31,440 --> 00:13:33,600
that will be executed by the spreading

358
00:13:33,600 --> 00:13:34,639
bot

359
00:13:34,639 --> 00:13:37,040
first it will run the call command to

360
00:13:37,040 --> 00:13:40,000
download the exploit payload bundle

361
00:13:40,000 --> 00:13:43,680
sorry again you're helping me okay

362
00:13:43,680 --> 00:13:45,279
so first of all to align the kill

363
00:13:45,279 --> 00:13:46,959
command to download the exploit payload

364
00:13:46,959 --> 00:13:47,760
bundle

365
00:13:47,760 --> 00:13:50,240
which is located under the css directory

366
00:13:50,240 --> 00:13:51,120
the one i just

367
00:13:51,120 --> 00:13:53,920
talked about in repository b it will

368
00:13:53,920 --> 00:13:55,199
unzip the file

369
00:13:55,199 --> 00:13:57,680
as we said it it's not a css file it's

370
00:13:57,680 --> 00:13:59,040
actually a zip file

371
00:13:59,040 --> 00:14:02,079
and see that password

372
00:14:02,079 --> 00:14:06,160
adelia putri which is remember this name

373
00:14:06,160 --> 00:14:07,680
of you will talk about it later in the

374
00:14:07,680 --> 00:14:09,199
presentation

375
00:14:09,199 --> 00:14:11,680
it will remove the the file and run a

376
00:14:11,680 --> 00:14:13,279
python script

377
00:14:13,279 --> 00:14:15,680
the next parameter the payload contains

378
00:14:15,680 --> 00:14:17,120
the list of victim sites

379
00:14:17,120 --> 00:14:19,040
that will be attacked by the spreading

380
00:14:19,040 --> 00:14:20,399
bot

381
00:14:20,399 --> 00:14:22,720
and the last parameter contains the ip

382
00:14:22,720 --> 00:14:24,399
or the hostname that holds all those

383
00:14:24,399 --> 00:14:26,800
sites

384
00:14:28,839 --> 00:14:30,399
now

385
00:14:30,399 --> 00:14:33,600
so as i said now just just now we

386
00:14:33,600 --> 00:14:35,199
impersonated a spreading about in the

387
00:14:35,199 --> 00:14:37,360
botnet and had constant communication

388
00:14:37,360 --> 00:14:39,120
with this with the cnc to receive attack

389
00:14:39,120 --> 00:14:40,160
instructions

390
00:14:40,160 --> 00:14:42,839
we asked to get them those every three

391
00:14:42,839 --> 00:14:45,519
minutes now we gather all these attack

392
00:14:45,519 --> 00:14:46,399
instructions

393
00:14:46,399 --> 00:14:48,880
and we use showdown api in order to

394
00:14:48,880 --> 00:14:50,560
extract the organization

395
00:14:50,560 --> 00:14:53,680
the asn the country the vulnerabilities

396
00:14:53,680 --> 00:14:55,040
the open ports and the install

397
00:14:55,040 --> 00:14:56,160
components

398
00:14:56,160 --> 00:14:58,320
we took all this data and inserted it

399
00:14:58,320 --> 00:14:59,440
into a database

400
00:14:59,440 --> 00:15:01,920
for later analysis so let's see what we

401
00:15:01,920 --> 00:15:03,920
learned

402
00:15:03,920 --> 00:15:06,959
so the first step first question we were

403
00:15:06,959 --> 00:15:07,680
curious about

404
00:15:07,680 --> 00:15:12,320
was about the target origin country

405
00:15:12,320 --> 00:15:14,399
we wanted to understand if the botnet

406
00:15:14,399 --> 00:15:16,000
has targeted

407
00:15:16,000 --> 00:15:18,160
a specific country and here's the

408
00:15:18,160 --> 00:15:20,399
distribution of the targets divided by

409
00:15:20,399 --> 00:15:21,680
country

410
00:15:21,680 --> 00:15:23,920
we can i think it's it's a bit hard to

411
00:15:23,920 --> 00:15:25,440
see but

412
00:15:25,440 --> 00:15:27,440
there are 60 different countries that is

413
00:15:27,440 --> 00:15:29,120
botnet targets

414
00:15:29,120 --> 00:15:31,040
and it appears that the majority of the

415
00:15:31,040 --> 00:15:33,040
countries are located in the us

416
00:15:33,040 --> 00:15:36,880
this is actually the blue part and

417
00:15:36,880 --> 00:15:39,440
after we gave it a thought we we come to

418
00:15:39,440 --> 00:15:40,560
the to the

419
00:15:40,560 --> 00:15:43,199
conclusion that actually many servers

420
00:15:43,199 --> 00:15:43,680
are

421
00:15:43,680 --> 00:15:48,240
i are um are hosted by cloud providers

422
00:15:48,240 --> 00:15:51,839
so we can say that the region of the

423
00:15:51,839 --> 00:15:54,240
target doesn't necessarily reflect on

424
00:15:54,240 --> 00:15:57,360
the origin of the victim

425
00:15:57,360 --> 00:15:59,360
now another question we were curious

426
00:15:59,360 --> 00:16:01,120
about was

427
00:16:01,120 --> 00:16:04,240
how the attacker finds its targets so

428
00:16:04,240 --> 00:16:05,600
we believe that the attacker had some

429
00:16:05,600 --> 00:16:07,759
sort of scanners that scans for

430
00:16:07,759 --> 00:16:10,000
potential vulnerable targets

431
00:16:10,000 --> 00:16:12,240
and he was probably using showdown or

432
00:16:12,240 --> 00:16:14,240
some similar service like binaryage or

433
00:16:14,240 --> 00:16:15,600
something like that

434
00:16:15,600 --> 00:16:18,240
to search for some open ports and

435
00:16:18,240 --> 00:16:19,600
vulnerabilities

436
00:16:19,600 --> 00:16:22,000
and then once he has those potential

437
00:16:22,000 --> 00:16:23,199
vulnerable targets

438
00:16:23,199 --> 00:16:26,320
you may use cms web scanners

439
00:16:26,320 --> 00:16:29,680
like cms map or wp scan

440
00:16:29,680 --> 00:16:32,480
to check for specific vulnerabilities

441
00:16:32,480 --> 00:16:33,440
and once

442
00:16:33,440 --> 00:16:36,959
you found a potential vulnerable target

443
00:16:36,959 --> 00:16:38,000
that he may

444
00:16:38,000 --> 00:16:40,800
attack we believe that it was initiated

445
00:16:40,800 --> 00:16:41,680
inside a queue

446
00:16:41,680 --> 00:16:44,800
in the cnc for future infection

447
00:16:44,800 --> 00:16:47,920
now when a spreading bot will ask from

448
00:16:47,920 --> 00:16:50,480
the cnc to get attack instructions

449
00:16:50,480 --> 00:16:53,360
we believe that this target will be

450
00:16:53,360 --> 00:16:56,480
taken from this queue

451
00:16:56,560 --> 00:17:00,240
now let's talk about the button purposes

452
00:17:00,240 --> 00:17:02,560
in order to understand the purpose of

453
00:17:02,560 --> 00:17:04,000
the block out of the botnet we

454
00:17:04,000 --> 00:17:06,400
had to become a victim ourself we

455
00:17:06,400 --> 00:17:08,319
curated the same as honeypot

456
00:17:08,319 --> 00:17:11,199
and attacked it with our spreading block

457
00:17:11,199 --> 00:17:13,119
from the infiltration step

458
00:17:13,119 --> 00:17:15,359
then we reported back to the cnc of a

459
00:17:15,359 --> 00:17:16,959
successful infection

460
00:17:16,959 --> 00:17:20,000
and by that our honeypot became

461
00:17:20,000 --> 00:17:22,880
part of the kashmir black botnet waiting

462
00:17:22,880 --> 00:17:24,959
for the cnc to approach and change its

463
00:17:24,959 --> 00:17:26,720
purpose

464
00:17:26,720 --> 00:17:29,520
now we saw five purposes for the botnet

465
00:17:29,520 --> 00:17:30,559
about the first two

466
00:17:30,559 --> 00:17:32,559
we already discussed those are the

467
00:17:32,559 --> 00:17:34,480
pending and the spreading bot

468
00:17:34,480 --> 00:17:37,200
so let's talk about the others now as

469
00:17:37,200 --> 00:17:39,280
exciting purpose we observed

470
00:17:39,280 --> 00:17:41,679
was a crypto minute it mines monero

471
00:17:41,679 --> 00:17:43,200
coins

472
00:17:43,200 --> 00:17:46,320
and while we analyze the code we got

473
00:17:46,320 --> 00:17:48,559
access to the hacker's payment address

474
00:17:48,559 --> 00:17:50,240
and we could see the balance in real

475
00:17:50,240 --> 00:17:52,400
time

476
00:17:52,400 --> 00:17:55,039
the next purpose was we observed was a

477
00:17:55,039 --> 00:17:57,520
result of our cms honeypot

478
00:17:57,520 --> 00:18:01,600
which was converted into a clickbait bot

479
00:18:01,600 --> 00:18:04,799
and once we logged into the um

480
00:18:04,799 --> 00:18:07,840
to the honeypot we were redirected to

481
00:18:07,840 --> 00:18:10,799
one of many clickbait sites

482
00:18:10,799 --> 00:18:14,320
and the last purpose was defacement

483
00:18:14,320 --> 00:18:16,799
and once we saw the defacement signature

484
00:18:16,799 --> 00:18:19,679
we revealed the hacker behind the botnet

485
00:18:19,679 --> 00:18:22,160
we saw that he is part of the indonesian

486
00:18:22,160 --> 00:18:24,960
hacker crew phantom ghost

487
00:18:24,960 --> 00:18:27,520
and while searching the web we even saw

488
00:18:27,520 --> 00:18:28,320
some

489
00:18:28,320 --> 00:18:31,840
facebook page and many interesting stuff

490
00:18:31,840 --> 00:18:34,880
but we even saw a site that sells the

491
00:18:34,880 --> 00:18:38,480
phantom ghost crew t-shirts

492
00:18:39,840 --> 00:18:41,840
now that we are familiar with all the

493
00:18:41,840 --> 00:18:42,960
entities

494
00:18:42,960 --> 00:18:45,120
of we will continue and show you and

495
00:18:45,120 --> 00:18:46,640
show you the entire operation

496
00:18:46,640 --> 00:18:50,940
in life thank you sorry

497
00:18:50,940 --> 00:18:55,760
[Applause]

498
00:18:55,760 --> 00:18:59,919
i hope you got my back with the clicks

499
00:18:59,919 --> 00:19:04,240
hi everyone so how this botnet works

500
00:19:04,240 --> 00:19:08,080
it all starts when i bought exploits php

501
00:19:08,080 --> 00:19:10,240
unit remote code execution

502
00:19:10,240 --> 00:19:12,720
it causes the victim server to download

503
00:19:12,720 --> 00:19:13,919
the infection script

504
00:19:13,919 --> 00:19:17,280
from the cnc and execute it

505
00:19:17,280 --> 00:19:19,840
now the victim server will approach

506
00:19:19,840 --> 00:19:21,120
repository a

507
00:19:21,120 --> 00:19:23,679
every three minutes to download a fresh

508
00:19:23,679 --> 00:19:26,480
communication script

509
00:19:26,480 --> 00:19:29,039
in this stage we can say that the victim

510
00:19:29,039 --> 00:19:30,080
server

511
00:19:30,080 --> 00:19:34,240
is part of the kashmir black botnet

512
00:19:34,799 --> 00:19:38,000
now the victim server will the new the

513
00:19:38,000 --> 00:19:40,320
newly infected bot will approach the cnc

514
00:19:40,320 --> 00:19:42,400
will communicate with it to fetch attack

515
00:19:42,400 --> 00:19:43,520
instructions

516
00:19:43,520 --> 00:19:45,919
describing who to attack and which

517
00:19:45,919 --> 00:19:48,080
bundle to use

518
00:19:48,080 --> 00:19:50,960
it will address repository b to download

519
00:19:50,960 --> 00:19:52,080
the

520
00:19:52,080 --> 00:19:55,520
bundle and github and pastebin

521
00:19:55,520 --> 00:19:59,918
to download additional payloads

522
00:20:00,880 --> 00:20:03,840
github and pastebin

523
00:20:04,480 --> 00:20:06,720
so now now the they're both ready to

524
00:20:06,720 --> 00:20:08,640
attack the victim server

525
00:20:08,640 --> 00:20:12,320
and on successful attack it will become

526
00:20:12,320 --> 00:20:15,919
part of the botnet as a last step in the

527
00:20:15,919 --> 00:20:16,799
process

528
00:20:16,799 --> 00:20:21,280
the bot will report back to the cnc

529
00:20:21,280 --> 00:20:23,840
now that we are familiar with operation

530
00:20:23,840 --> 00:20:24,720
let's move on

531
00:20:24,720 --> 00:20:27,360
and describe the stages of the botnet

532
00:20:27,360 --> 00:20:28,320
throughout the

533
00:20:28,320 --> 00:20:31,679
research period and and

534
00:20:31,679 --> 00:20:35,120
that's it so when we first met cashmere

535
00:20:35,120 --> 00:20:35,440
black

536
00:20:35,440 --> 00:20:40,559
it had only 10 exploits and two payloads

537
00:20:40,559 --> 00:20:43,600
pending and spreading it concentrated

538
00:20:43,600 --> 00:20:47,200
only on the growth and

539
00:20:47,200 --> 00:20:49,200
then infrastructure changes started to

540
00:20:49,200 --> 00:20:51,280
emerge to make the botnet more

541
00:20:51,280 --> 00:20:55,120
stable and scalable and the last stage

542
00:20:55,120 --> 00:20:58,240
was the expansion actually this is a an

543
00:20:58,240 --> 00:21:01,679
ongoing stage that

544
00:21:01,679 --> 00:21:04,960
we saw over the entire research period

545
00:21:04,960 --> 00:21:06,720
the attacker adds new exploits and

546
00:21:06,720 --> 00:21:09,200
payloads so i'm going to dive in into

547
00:21:09,200 --> 00:21:10,960
each one of the stages

548
00:21:10,960 --> 00:21:14,400
starting with the growth

549
00:21:14,799 --> 00:21:17,919
so when we fur cashmere black actually

550
00:21:17,919 --> 00:21:18,240
has

551
00:21:18,240 --> 00:21:20,880
an exponential growth i'm going to

552
00:21:20,880 --> 00:21:24,159
explain how we came to this conclusion

553
00:21:24,159 --> 00:21:28,559
we found in our traffic 285 bots

554
00:21:28,559 --> 00:21:32,080
attacking our customers but this is only

555
00:21:32,080 --> 00:21:34,080
a portion of the bots in the botnet

556
00:21:34,080 --> 00:21:35,919
since we see only traffic of our

557
00:21:35,919 --> 00:21:37,679
customers

558
00:21:37,679 --> 00:21:40,720
so for this example i'm going to use 300

559
00:21:40,720 --> 00:21:41,440
bots

560
00:21:41,440 --> 00:21:44,960
for simplicity every bot

561
00:21:44,960 --> 00:21:48,159
attacks every three minutes so

562
00:21:48,159 --> 00:21:53,120
per day it will attack 480 targets

563
00:21:53,120 --> 00:21:57,240
our 300 bots together will attack

564
00:21:57,240 --> 00:22:00,720
140 thousands victims

565
00:22:00,720 --> 00:22:04,799
per day let's say that

566
00:22:04,799 --> 00:22:07,679
only half percent of the attacks are

567
00:22:07,679 --> 00:22:09,520
finished with successful infection

568
00:22:09,520 --> 00:22:13,200
it means that tomorrow will have 1 000

569
00:22:13,200 --> 00:22:14,240
new bots

570
00:22:14,240 --> 00:22:18,799
in addition to our current new 300 bucks

571
00:22:18,799 --> 00:22:22,559
so by day number seven we will have

572
00:22:22,559 --> 00:22:25,679
almost half million bots

573
00:22:25,679 --> 00:22:27,280
but the reality is a little bit

574
00:22:27,280 --> 00:22:29,840
different because we know that we have

575
00:22:29,840 --> 00:22:33,840
limited numbers of a potential

576
00:22:33,840 --> 00:22:36,480
of vulnerable targets so the exponential

577
00:22:36,480 --> 00:22:37,120
growth

578
00:22:37,120 --> 00:22:41,840
will stop at some point

579
00:22:42,640 --> 00:22:45,440
now let's move on from the growth to the

580
00:22:45,440 --> 00:22:48,400
stability stage

581
00:22:51,039 --> 00:22:52,960
i'm going to describe the botnet

582
00:22:52,960 --> 00:22:54,799
evolution over the research period

583
00:22:54,799 --> 00:22:57,520
and the devops strategy that enable it

584
00:22:57,520 --> 00:23:00,320
to carry out its crimes

585
00:23:00,320 --> 00:23:03,039
when we so remember that the botnet had

586
00:23:03,039 --> 00:23:04,400
only one repository

587
00:23:04,400 --> 00:23:08,080
a and b once the botnet size increased

588
00:23:08,080 --> 00:23:11,120
so did the load on the repositories and

589
00:23:11,120 --> 00:23:12,880
since the repositories were actually

590
00:23:12,880 --> 00:23:14,880
legitimate sites they couldn't be

591
00:23:14,880 --> 00:23:15,840
considered as

592
00:23:15,840 --> 00:23:18,799
reliable and permanent entities the

593
00:23:18,799 --> 00:23:19,520
attacker

594
00:23:19,520 --> 00:23:22,880
had to take action three changes

595
00:23:22,880 --> 00:23:25,200
were implemented in the botnet in order

596
00:23:25,200 --> 00:23:27,440
to

597
00:23:27,760 --> 00:23:30,960
fix that so adding new entity

598
00:23:30,960 --> 00:23:34,000
repository a load balancer expand

599
00:23:34,000 --> 00:23:35,039
repository

600
00:23:35,039 --> 00:23:38,720
a and expand repository b

601
00:23:38,720 --> 00:23:40,400
there were three main reasons behind

602
00:23:40,400 --> 00:23:42,000
these changes

603
00:23:42,000 --> 00:23:45,840
first to make the botnet more dynamic

604
00:23:45,840 --> 00:23:47,039
and scalable

605
00:23:47,039 --> 00:23:50,080
add redundancy and load balancing

606
00:23:50,080 --> 00:23:52,559
the following diagram shows the old

607
00:23:52,559 --> 00:23:54,880
infrastructure against the new one

608
00:23:54,880 --> 00:23:57,520
while in the old infrastructure every

609
00:23:57,520 --> 00:23:58,080
bot

610
00:23:58,080 --> 00:24:01,279
will address directly repository a

611
00:24:01,279 --> 00:24:05,200
in the new one every bot will address

612
00:24:05,200 --> 00:24:07,520
the load balancer to get one of many

613
00:24:07,520 --> 00:24:10,320
repositories

614
00:24:10,720 --> 00:24:12,720
to integrate this change into the bondet

615
00:24:12,720 --> 00:24:13,760
operation

616
00:24:13,760 --> 00:24:16,240
that an additional change in the bot

617
00:24:16,240 --> 00:24:18,080
that was required i'm going to describe

618
00:24:18,080 --> 00:24:20,080
it when i will describe the upgrade

619
00:24:20,080 --> 00:24:22,720
process of the botnet

620
00:24:22,720 --> 00:24:27,360
now let's talk about internal changes

621
00:24:27,360 --> 00:24:30,159
that were made in order to secure the

622
00:24:30,159 --> 00:24:33,360
botnet and the cnc operation

623
00:24:33,360 --> 00:24:36,799
so the cnc is the most important

624
00:24:36,799 --> 00:24:38,880
component in the entire operation

625
00:24:38,880 --> 00:24:41,440
securing it is critical

626
00:24:41,440 --> 00:24:43,120
let me take you back a little bit to the

627
00:24:43,120 --> 00:24:45,520
steps where we infiltrated the botnet

628
00:24:45,520 --> 00:24:48,000
and played the victim we created a

629
00:24:48,000 --> 00:24:49,200
honeypot

630
00:24:49,200 --> 00:24:53,440
attacked it with our spreading bot and

631
00:24:53,440 --> 00:24:56,720
reported back to the cnc we think that

632
00:24:56,720 --> 00:24:58,159
the attacker goes suspicious

633
00:24:58,159 --> 00:25:00,880
as he performed two internal changes in

634
00:25:00,880 --> 00:25:02,000
order to avoid

635
00:25:02,000 --> 00:25:05,200
interfering with the botnet around two

636
00:25:05,200 --> 00:25:06,400
days after we

637
00:25:06,400 --> 00:25:09,600
interact with the botnet the changes

638
00:25:09,600 --> 00:25:10,799
were a

639
00:25:10,799 --> 00:25:14,240
reporting address was changed and

640
00:25:14,240 --> 00:25:18,640
i bought ip tracking mechanism was added

641
00:25:18,960 --> 00:25:22,240
the first change is related to the

642
00:25:22,240 --> 00:25:25,120
reporting address

643
00:25:26,000 --> 00:25:28,880
it helps with managing bots and versions

644
00:25:28,880 --> 00:25:30,960
but that report to the new address

645
00:25:30,960 --> 00:25:34,720
is a new bot the second change

646
00:25:34,720 --> 00:25:36,720
is within the botnet's communication

647
00:25:36,720 --> 00:25:39,120
script

648
00:25:40,400 --> 00:25:42,799
a simple architectural change adds the

649
00:25:42,799 --> 00:25:43,840
bot's ip

650
00:25:43,840 --> 00:25:45,919
and country while it communicates with

651
00:25:45,919 --> 00:25:48,559
the cnc

652
00:25:49,120 --> 00:25:52,720
it helps the cnc to monitor and trace

653
00:25:52,720 --> 00:25:55,600
each bot in the botnet there were two

654
00:25:55,600 --> 00:25:57,600
main reasons behind this change

655
00:25:57,600 --> 00:26:00,640
to secure the botnet operation and

656
00:26:00,640 --> 00:26:04,640
to manage the a upgrade process

657
00:26:04,640 --> 00:26:07,919
so let's see how it comes to work

658
00:26:07,919 --> 00:26:11,120
the uh the changes that we described

659
00:26:11,120 --> 00:26:12,880
created the situation where

660
00:26:12,880 --> 00:26:15,039
some bots were using the new

661
00:26:15,039 --> 00:26:16,080
infrastructure

662
00:26:16,080 --> 00:26:18,720
while others are only aware of the old

663
00:26:18,720 --> 00:26:20,640
one

664
00:26:20,640 --> 00:26:22,880
this diagram described the upgrade

665
00:26:22,880 --> 00:26:24,400
process

666
00:26:24,400 --> 00:26:26,320
when an old bot communicates with the

667
00:26:26,320 --> 00:26:29,440
cnc without the ip tracking header

668
00:26:29,440 --> 00:26:33,279
the cnc returns sends back attack

669
00:26:33,279 --> 00:26:34,080
instruction

670
00:26:34,080 --> 00:26:36,240
that instruct the bot to download the

671
00:26:36,240 --> 00:26:38,000
upgrade script

672
00:26:38,000 --> 00:26:41,120
from repository b once the

673
00:26:41,120 --> 00:26:44,000
bot executes the upgrade script it turns

674
00:26:44,000 --> 00:26:45,440
into a new bot

675
00:26:45,440 --> 00:26:47,440
that is now aware of the new

676
00:26:47,440 --> 00:26:49,039
infrastructure

677
00:26:49,039 --> 00:26:51,520
the newly affected the newly the new bot

678
00:26:51,520 --> 00:26:52,159
will a

679
00:26:52,159 --> 00:26:55,679
address load repository a load balancer

680
00:26:55,679 --> 00:26:57,840
to get in return one of many

681
00:26:57,840 --> 00:27:00,480
repositories

682
00:27:00,480 --> 00:27:02,960
actually the accurate script changes the

683
00:27:02,960 --> 00:27:05,200
contact job that sarit mentioned earlier

684
00:27:05,200 --> 00:27:06,159
in the infectant

685
00:27:06,159 --> 00:27:09,279
infection stage now

686
00:27:09,279 --> 00:27:12,559
let's talk about migrating

687
00:27:12,559 --> 00:27:15,600
the migrating the cnc

688
00:27:15,600 --> 00:27:18,559
to a cloud disturbance so there are

689
00:27:18,559 --> 00:27:20,240
fundamental problems in the botnet

690
00:27:20,240 --> 00:27:21,120
architecture

691
00:27:21,120 --> 00:27:23,120
since the bots are communicating

692
00:27:23,120 --> 00:27:24,559
directly with the

693
00:27:24,559 --> 00:27:28,320
cnc and entities their ip is exposed

694
00:27:28,320 --> 00:27:31,760
and security controls may block them

695
00:27:31,760 --> 00:27:33,760
an interesting infrastructure change has

696
00:27:33,760 --> 00:27:36,559
evolved to solve this problem

697
00:27:36,559 --> 00:27:40,559
integrating drawbacks into the operation

698
00:27:40,559 --> 00:27:44,640
now instead of communicating with the

699
00:27:44,640 --> 00:27:47,440
cnc and the entities the bots are now

700
00:27:47,440 --> 00:27:48,399
communicating

701
00:27:48,399 --> 00:27:51,440
only with dropbox now

702
00:27:51,440 --> 00:27:53,520
dropbox api is being used to fetch

703
00:27:53,520 --> 00:27:54,799
attack instructions

704
00:27:54,799 --> 00:27:58,559
and to upload reports from bots

705
00:27:58,559 --> 00:28:00,799
this is a big step towards camouflaging

706
00:28:00,799 --> 00:28:02,080
the botnet traffic

707
00:28:02,080 --> 00:28:05,360
securing the cnc and most importantly

708
00:28:05,360 --> 00:28:07,840
making it difficult to trace back to the

709
00:28:07,840 --> 00:28:11,199
hacker behind operation

710
00:28:12,000 --> 00:28:13,919
when we discovered this change we were

711
00:28:13,919 --> 00:28:16,640
very excited since we had authorization

712
00:28:16,640 --> 00:28:17,120
key

713
00:28:17,120 --> 00:28:21,039
of the dropbox account of the attacker

714
00:28:21,520 --> 00:28:23,760
we thought to ourselves it will be very

715
00:28:23,760 --> 00:28:26,480
interesting to

716
00:28:26,480 --> 00:28:29,760
check what's going on so we start with

717
00:28:29,760 --> 00:28:31,039
fetching all the files

718
00:28:31,039 --> 00:28:34,159
and mapping the the structure of the

719
00:28:34,159 --> 00:28:35,279
account

720
00:28:35,279 --> 00:28:37,919
the root directory that we found was

721
00:28:37,919 --> 00:28:39,520
adelia p

722
00:28:39,520 --> 00:28:42,080
we think that the name adelia has some

723
00:28:42,080 --> 00:28:44,080
significant for the attacker because

724
00:28:44,080 --> 00:28:46,399
we saw it in several places during our

725
00:28:46,399 --> 00:28:47,919
analysis

726
00:28:47,919 --> 00:28:51,279
we saw it in password as sarit mentioned

727
00:28:51,279 --> 00:28:52,159
earlier

728
00:28:52,159 --> 00:28:54,960
and we saw it used in urls inside the

729
00:28:54,960 --> 00:28:56,799
cnc

730
00:28:56,799 --> 00:29:00,000
actually the full name is adelia putri

731
00:29:00,000 --> 00:29:03,760
putri stands for princess in indonesia

732
00:29:03,760 --> 00:29:06,080
we think that maybe adelia is the name

733
00:29:06,080 --> 00:29:07,679
of the attacker or maybe

734
00:29:07,679 --> 00:29:11,279
it is somewhat that he scales for

735
00:29:11,520 --> 00:29:14,000
next under the root directory we have

736
00:29:14,000 --> 00:29:15,760
the payload directory

737
00:29:15,760 --> 00:29:19,760
which used to store

738
00:29:19,760 --> 00:29:22,480
attack instructions actually we found

739
00:29:22,480 --> 00:29:25,120
400 thousands of attack instructions

740
00:29:25,120 --> 00:29:29,200
in place next we have the loot directory

741
00:29:29,200 --> 00:29:33,360
which includes only one subdirectory

742
00:29:33,360 --> 00:29:36,640
no sequel no sequel is one of the

743
00:29:36,640 --> 00:29:37,279
bundles

744
00:29:37,279 --> 00:29:40,080
that used by the attacker to attack no

745
00:29:40,080 --> 00:29:41,279
sql databases

746
00:29:41,279 --> 00:29:44,559
with no sql injection

747
00:29:44,799 --> 00:29:48,480
sorry i need two clicks

748
00:29:48,480 --> 00:29:51,600
yeah and inside

749
00:29:51,600 --> 00:29:55,120
we found only one report

750
00:29:55,120 --> 00:29:58,080
so putting it all together the loot

751
00:29:58,080 --> 00:29:59,039
directory

752
00:29:59,039 --> 00:30:03,279
meant to store reports from bots

753
00:30:03,279 --> 00:30:06,640
divided by subdirectories for each

754
00:30:06,640 --> 00:30:09,840
exploit bundle

755
00:30:09,840 --> 00:30:13,440
so why do we have only one report so

756
00:30:13,440 --> 00:30:15,279
probably the attacker was in the middle

757
00:30:15,279 --> 00:30:17,520
of transition maybe in the development

758
00:30:17,520 --> 00:30:18,320
stage or

759
00:30:18,320 --> 00:30:21,200
in the testing phase but this is another

760
00:30:21,200 --> 00:30:22,399
piece of the puzzle

761
00:30:22,399 --> 00:30:24,480
that helps us to see into the attacker's

762
00:30:24,480 --> 00:30:28,720
world and understand its operation

763
00:30:30,320 --> 00:30:33,279
now by that we close the stability stage

764
00:30:33,279 --> 00:30:36,559
and we move to the expansion as i said

765
00:30:36,559 --> 00:30:37,279
before

766
00:30:37,279 --> 00:30:39,600
the expansion stage is an ongoing

767
00:30:39,600 --> 00:30:41,039
process

768
00:30:41,039 --> 00:30:43,520
the attacker adds new exploits on a

769
00:30:43,520 --> 00:30:45,520
regular basis

770
00:30:45,520 --> 00:30:49,919
and so the exploits actually were

771
00:30:49,919 --> 00:30:51,520
extended from 10

772
00:30:51,520 --> 00:30:54,640
to 17. we

773
00:30:54,640 --> 00:30:57,120
fetched all the files all the bundles

774
00:30:57,120 --> 00:30:59,279
and we tried to map them to the affected

775
00:30:59,279 --> 00:31:01,760
platform

776
00:31:02,840 --> 00:31:05,760
um we found that

777
00:31:05,760 --> 00:31:08,480
most of the vulnerabilities are in

778
00:31:08,480 --> 00:31:10,960
generic plugins and components

779
00:31:10,960 --> 00:31:14,799
and most of them are in cms platforms we

780
00:31:14,799 --> 00:31:16,159
see that

781
00:31:16,159 --> 00:31:19,279
more than 80 percent are affecting cms

782
00:31:19,279 --> 00:31:20,640
platforms

783
00:31:20,640 --> 00:31:24,640
so the vulnerabilities are compatible to

784
00:31:24,640 --> 00:31:26,559
multiple cms platforms

785
00:31:26,559 --> 00:31:29,760
and actually we found a 13 different cms

786
00:31:29,760 --> 00:31:30,640
platforms

787
00:31:30,640 --> 00:31:34,000
in this diagram we see that the

788
00:31:34,000 --> 00:31:36,480
percentage shows the distribution of

789
00:31:36,480 --> 00:31:37,840
vulnerabilities

790
00:31:37,840 --> 00:31:41,840
for each cms platform

791
00:31:43,360 --> 00:31:46,000
and that's it let's let's move on to

792
00:31:46,000 --> 00:31:46,720
some

793
00:31:46,720 --> 00:31:50,399
important key features so

794
00:31:50,399 --> 00:31:52,480
botnet development is similar to

795
00:31:52,480 --> 00:31:54,640
application development process

796
00:31:54,640 --> 00:31:57,600
we need to take into consideration some

797
00:31:57,600 --> 00:31:59,279
important key features in order to

798
00:31:59,279 --> 00:32:00,000
create a stable

799
00:32:00,000 --> 00:32:04,799
botnet that is here that is here to stay

800
00:32:05,600 --> 00:32:08,640
those are stability

801
00:32:08,640 --> 00:32:11,760
flexibility and cicd

802
00:32:11,760 --> 00:32:14,640
in order to create a stable botnet we

803
00:32:14,640 --> 00:32:16,320
need to take into consideration load

804
00:32:16,320 --> 00:32:18,159
balancing and redundancy

805
00:32:18,159 --> 00:32:21,440
enabling scalability while growing

806
00:32:21,440 --> 00:32:24,480
but this is not enough the separation of

807
00:32:24,480 --> 00:32:24,799
the

808
00:32:24,799 --> 00:32:27,679
exploits from the infrastructure enables

809
00:32:27,679 --> 00:32:29,279
maximum flexibility

810
00:32:29,279 --> 00:32:32,240
as the attacker can add new exploits

811
00:32:32,240 --> 00:32:33,919
anytime

812
00:32:33,919 --> 00:32:36,960
together those two key features are the

813
00:32:36,960 --> 00:32:37,600
basis

814
00:32:37,600 --> 00:32:40,640
of the expansion and growth

815
00:32:40,640 --> 00:32:43,200
on the other side we have the cicd

816
00:32:43,200 --> 00:32:43,919
branch

817
00:32:43,919 --> 00:32:46,240
which includes version control and

818
00:32:46,240 --> 00:32:47,840
deployment cycles

819
00:32:47,840 --> 00:32:51,120
we call it automation behind every

820
00:32:51,120 --> 00:32:52,320
massive operation

821
00:32:52,320 --> 00:32:54,559
we must have an automatic process to

822
00:32:54,559 --> 00:32:56,159
support it

823
00:32:56,159 --> 00:32:58,720
expansion and growth cannot exist

824
00:32:58,720 --> 00:33:02,720
without a solid cicd process

825
00:33:04,960 --> 00:33:07,760
now let's talk about the insider point

826
00:33:07,760 --> 00:33:10,080
of view

827
00:33:10,080 --> 00:33:13,200
as a security company we have data of

828
00:33:13,200 --> 00:33:15,600
hundreds of thousands of customers

829
00:33:15,600 --> 00:33:19,200
where we can see attacks in the wild

830
00:33:19,200 --> 00:33:22,480
but it is not good enough since

831
00:33:22,480 --> 00:33:26,480
our data is biased by our customers

832
00:33:26,480 --> 00:33:29,039
so here are a couple of advantages we

833
00:33:29,039 --> 00:33:32,960
got from the insider point of view

834
00:33:32,960 --> 00:33:35,840
as an insider we could see the big

835
00:33:35,840 --> 00:33:36,399
picture

836
00:33:36,399 --> 00:33:38,320
and not just a small portion of the

837
00:33:38,320 --> 00:33:39,919
infection

838
00:33:39,919 --> 00:33:42,240
we witnessed the botnet evolution from

839
00:33:42,240 --> 00:33:44,480
the first row

840
00:33:44,480 --> 00:33:47,440
we saw new new exploits and repositories

841
00:33:47,440 --> 00:33:49,360
added in real time

842
00:33:49,360 --> 00:33:52,240
and by analyzing the code changes we

843
00:33:52,240 --> 00:33:54,720
concluded what motivated the attacker

844
00:33:54,720 --> 00:33:58,000
to perform such changes we had

845
00:33:58,000 --> 00:34:00,720
a unique foothold into the operation

846
00:34:00,720 --> 00:34:01,760
that enabled us

847
00:34:01,760 --> 00:34:03,919
to analyze the victims from the attack

848
00:34:03,919 --> 00:34:05,039
instructions

849
00:34:05,039 --> 00:34:08,800
extracting countries domains platforms

850
00:34:08,800 --> 00:34:13,359
etc etc the inside intelligence

851
00:34:13,359 --> 00:34:15,839
led us to the educated assumption that

852
00:34:15,839 --> 00:34:17,199
there is kind of an

853
00:34:17,199 --> 00:34:19,839
automated mechanism that searches for

854
00:34:19,839 --> 00:34:21,520
potential vulnerable targets

855
00:34:21,520 --> 00:34:24,560
and initiate them inside in queue in a

856
00:34:24,560 --> 00:34:27,040
cnc

857
00:34:27,119 --> 00:34:29,918
by analyzing the exploit distribution we

858
00:34:29,918 --> 00:34:30,800
concluded

859
00:34:30,800 --> 00:34:34,000
what types of exploits are being used

860
00:34:34,000 --> 00:34:35,520
what is the frequency that they are

861
00:34:35,520 --> 00:34:38,000
being used and which are more common

862
00:34:38,000 --> 00:34:40,000
than others

863
00:34:40,000 --> 00:34:42,399
all of this information is accessible

864
00:34:42,399 --> 00:34:44,719
only from the insider point of view

865
00:34:44,719 --> 00:34:47,440
and it is critical in order to

866
00:34:47,440 --> 00:34:48,000
understand

867
00:34:48,000 --> 00:34:50,239
the scope of the botnet and the

868
00:34:50,239 --> 00:34:52,000
challenges and motivations

869
00:34:52,000 --> 00:34:54,719
of the attacker

870
00:34:55,679 --> 00:34:59,359
now let's have some conclusion about

871
00:34:59,359 --> 00:35:00,880
botnet development

872
00:35:00,880 --> 00:35:03,760
so in a botnet development the attacker

873
00:35:03,760 --> 00:35:05,520
wearing multiple heads

874
00:35:05,520 --> 00:35:08,720
the attacker is the devops

875
00:35:08,720 --> 00:35:12,560
the architect and

876
00:35:12,560 --> 00:35:16,160
the developer using

877
00:35:16,160 --> 00:35:18,960
of third party services is critical part

878
00:35:18,960 --> 00:35:20,320
of the infrastructure

879
00:35:20,320 --> 00:35:23,520
and it is not necessary to use exotic

880
00:35:23,520 --> 00:35:27,119
exploits in order to expand

881
00:35:28,000 --> 00:35:31,839
now let's sum up sum everything up

882
00:35:31,839 --> 00:35:33,920
so you're probably wondering at this

883
00:35:33,920 --> 00:35:36,160
stage what is the current state of the

884
00:35:36,160 --> 00:35:38,320
kashmir black botnet

885
00:35:38,320 --> 00:35:40,000
when we decided that our research has

886
00:35:40,000 --> 00:35:42,240
come to an end we collected

887
00:35:42,240 --> 00:35:45,520
ip's host names hosting services

888
00:35:45,520 --> 00:35:48,400
and every possible piece of information

889
00:35:48,400 --> 00:35:49,599
from bots

890
00:35:49,599 --> 00:35:53,280
repositories cnc and entities

891
00:35:53,280 --> 00:35:56,320
and we notified the

892
00:35:56,320 --> 00:36:00,079
owners of the servers and the

893
00:36:00,079 --> 00:36:03,119
third part the cloud providers about the

894
00:36:03,119 --> 00:36:04,640
malicious activity

895
00:36:04,640 --> 00:36:07,680
and today the kashmir black botnet is

896
00:36:07,680 --> 00:36:08,960
dead

897
00:36:08,960 --> 00:36:11,280
at least as we know it we search our

898
00:36:11,280 --> 00:36:13,680
data lake and we couldn't find any trace

899
00:36:13,680 --> 00:36:16,480
of new infection

900
00:36:19,760 --> 00:36:23,040
sorry so

901
00:36:23,040 --> 00:36:25,520
what we learned from botnet

902
00:36:25,520 --> 00:36:26,880
investigation

903
00:36:26,880 --> 00:36:30,160
about potential investigation first

904
00:36:30,160 --> 00:36:32,800
we need data collection is essential

905
00:36:32,800 --> 00:36:33,440
part

906
00:36:33,440 --> 00:36:36,960
of the investigation of the research and

907
00:36:36,960 --> 00:36:40,000
we need to search for repeating

908
00:36:40,000 --> 00:36:42,320
patterns in order to find our next

909
00:36:42,320 --> 00:36:45,040
potential botnet

910
00:36:45,040 --> 00:36:47,760
we need to then it's time to get our

911
00:36:47,760 --> 00:36:48,640
hands dirty

912
00:36:48,640 --> 00:36:51,920
and analyze the code it can help us

913
00:36:51,920 --> 00:36:56,320
with a mapping all the entities

914
00:36:56,320 --> 00:36:59,520
then we should start monitor

915
00:36:59,520 --> 00:37:04,079
everything collect all the data

916
00:37:04,079 --> 00:37:09,040
and enrich it with a third party

917
00:37:09,040 --> 00:37:12,400
services like schoden and bruce total to

918
00:37:12,400 --> 00:37:17,440
extract the ip and the countries etc

919
00:37:18,480 --> 00:37:21,680
we want to then it's time to analyze all

920
00:37:21,680 --> 00:37:22,480
the data

921
00:37:22,480 --> 00:37:26,480
and uh search and try to understand

922
00:37:26,480 --> 00:37:28,560
if there is some correlation between the

923
00:37:28,560 --> 00:37:29,599
victims

924
00:37:29,599 --> 00:37:32,960
and who is the attacker we can use

925
00:37:32,960 --> 00:37:34,000
honeypots

926
00:37:34,000 --> 00:37:36,000
in order to understand better the

927
00:37:36,000 --> 00:37:38,880
motivation of the attacker

928
00:37:38,880 --> 00:37:42,640
now for the important part i want to

929
00:37:42,640 --> 00:37:46,320
uh for the important part i want to give

930
00:37:46,320 --> 00:37:48,640
you some couple of tips

931
00:37:48,640 --> 00:37:52,000
for your next botnet investigation so

932
00:37:52,000 --> 00:37:56,720
first document every step in the process

933
00:37:56,720 --> 00:38:00,560
take screenshots and save the dates

934
00:38:00,560 --> 00:38:04,079
to construct a timeline save

935
00:38:04,079 --> 00:38:07,119
everything just everything you don't

936
00:38:07,119 --> 00:38:07,599
know

937
00:38:07,599 --> 00:38:09,520
when the data will not be available for

938
00:38:09,520 --> 00:38:11,680
you

939
00:38:11,920 --> 00:38:14,400
thank you very much for listening to our

940
00:38:14,400 --> 00:38:18,820
talk about customerblack.net

941
00:38:18,820 --> 00:38:20,000
[Music]

942
00:38:20,000 --> 00:38:23,200
feel free to ask any question

943
00:38:23,200 --> 00:38:26,640
and yes

944
00:38:26,640 --> 00:38:47,839
go ahead is

945
00:38:55,920 --> 00:38:58,000
so regarding the identity of the

946
00:38:58,000 --> 00:39:00,560
attackers we don't really know

947
00:39:00,560 --> 00:39:04,960
who they relate for and but we did found

948
00:39:04,960 --> 00:39:07,920
that they related to the phantom ghost

949
00:39:07,920 --> 00:39:08,800
crew

950
00:39:08,800 --> 00:39:11,920
we couldn't find any they are indonesian

951
00:39:11,920 --> 00:39:15,440
but we couldn't find any uh if they are

952
00:39:15,440 --> 00:39:17,359
walking as part of the government or

953
00:39:17,359 --> 00:39:19,040
something like this

954
00:39:19,040 --> 00:39:22,720
and for the for your first question and

955
00:39:22,720 --> 00:39:25,760
so i don't i i

956
00:39:25,760 --> 00:39:43,839
what do you mean by technology so

957
00:39:44,079 --> 00:39:46,800
um actually i don't really know to

958
00:39:46,800 --> 00:39:47,920
answer this question

959
00:39:47,920 --> 00:39:51,200
i believe that a lot but the the the

960
00:39:51,200 --> 00:39:53,359
things that have been used there the

961
00:39:53,359 --> 00:39:54,800
architecture is

962
00:39:54,800 --> 00:39:57,520
a load balancing and stuff like this are

963
00:39:57,520 --> 00:39:59,119
exist in everywhere

964
00:39:59,119 --> 00:40:01,920
we're using it in the industry so we

965
00:40:01,920 --> 00:40:02,320
just

966
00:40:02,320 --> 00:40:04,640
wanted to show how the attackers need to

967
00:40:04,640 --> 00:40:05,760
use this technology

968
00:40:05,760 --> 00:40:08,960
as well in this architecture to solve

969
00:40:08,960 --> 00:40:11,839
same problems

970
00:40:14,960 --> 00:40:18,079
any other questions okay ah sorry you

971
00:40:18,079 --> 00:40:20,720
didn't see you

972
00:40:22,960 --> 00:40:25,839
wow

973
00:40:34,960 --> 00:40:37,440
it's very hard to hear you yeah do you

974
00:40:37,440 --> 00:40:40,960
have a microphone or something

975
00:40:50,640 --> 00:40:53,760
no i really don't hear him if that i can

976
00:40:53,760 --> 00:40:56,000
what

977
00:40:59,280 --> 00:41:00,960
oh if the attacker patched the

978
00:41:00,960 --> 00:41:02,920
vulnerability after he took

979
00:41:02,920 --> 00:41:04,839
[Music]

980
00:41:04,839 --> 00:41:06,420
ah

981
00:41:06,420 --> 00:41:09,900
[Laughter]

982
00:41:09,900 --> 00:41:13,179
[Applause]

983
00:41:18,560 --> 00:41:20,400
uh i don't think that he patched the

984
00:41:20,400 --> 00:41:22,319
vulnerability you just use it

985
00:41:22,319 --> 00:41:25,520
and oh oh sorry um

986
00:41:25,520 --> 00:41:28,400
the nice person here asked if the

987
00:41:28,400 --> 00:41:30,240
attacker patched the vulnerability that

988
00:41:30,240 --> 00:41:33,119
it was just using

989
00:41:33,119 --> 00:41:35,520
of the server that is just uh took

990
00:41:35,520 --> 00:41:37,119
control over

991
00:41:37,119 --> 00:41:39,839
so we didn't see any evidence for that

992
00:41:39,839 --> 00:41:41,280
we were just using it

993
00:41:41,280 --> 00:41:44,800
and let's like we said it was you it was

994
00:41:44,800 --> 00:41:48,400
um he or she we don't actually know but

995
00:41:48,400 --> 00:41:53,040
the attacker was using the php

996
00:41:53,040 --> 00:41:56,640
php unit cve which

997
00:41:56,640 --> 00:41:59,839
was used as a first initial step into

998
00:41:59,839 --> 00:42:03,359
the server and we even saw that the

999
00:42:03,359 --> 00:42:05,760
the service was indeed vulnerable like

1000
00:42:05,760 --> 00:42:07,119
we uh

1001
00:42:07,119 --> 00:42:09,280
find some of them the repositories that

1002
00:42:09,280 --> 00:42:11,599
we was uploading the

1003
00:42:11,599 --> 00:42:14,839
bundles of excellent payloads were still

1004
00:42:14,839 --> 00:42:16,079
vulnerable

1005
00:42:16,079 --> 00:42:19,599
yeah in in one case in our honeypot

1006
00:42:19,599 --> 00:42:22,640
we we saw that actually he didn't patch

1007
00:42:22,640 --> 00:42:24,240
the vulnerability

1008
00:42:24,240 --> 00:42:26,400
he took control over the server and he

1009
00:42:26,400 --> 00:42:27,520
replaced

1010
00:42:27,520 --> 00:42:30,800
all the php a code in

1011
00:42:30,800 --> 00:42:34,160
obfuscated code by his own

1012
00:42:34,160 --> 00:42:37,760
we analyzed some of it but so for your

1013
00:42:37,760 --> 00:42:39,200
question he did not test the

1014
00:42:39,200 --> 00:42:42,078
vulnerabilities yeah

1015
00:42:42,839 --> 00:42:45,839
yes

1016
00:42:46,000 --> 00:42:48,160
we don't know we don't know it's one

1017
00:42:48,160 --> 00:42:50,800
person actually we think there is a

1018
00:42:50,800 --> 00:42:59,839
crew of people

1019
00:43:00,640 --> 00:43:12,560
i agree with you yeah

1020
00:43:12,560 --> 00:43:20,799
okay thank you very much for listening

