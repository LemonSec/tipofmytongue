1
00:00:00,240 --> 00:00:02,240
uh as he's getting micked up i will give

2
00:00:02,240 --> 00:00:03,520
you some clues

3
00:00:03,520 --> 00:00:06,879
about his identity he is a return

4
00:00:06,879 --> 00:00:10,240
speaker to the b sites tel aviv stage

5
00:00:10,240 --> 00:00:13,679
he is one of our most popular speakers

6
00:00:13,679 --> 00:00:14,320
and

7
00:00:14,320 --> 00:00:17,039
i expect this to be a fascinating talk

8
00:00:17,039 --> 00:00:17,600
and

9
00:00:17,600 --> 00:00:19,600
he's got a few hobbies in fact this

10
00:00:19,600 --> 00:00:21,039
morning he went

11
00:00:21,039 --> 00:00:24,160
for a run i'm talking not about a run

12
00:00:24,160 --> 00:00:25,680
command i'm talking about a run on the

13
00:00:25,680 --> 00:00:26,240
beach

14
00:00:26,240 --> 00:00:28,000
yes which is quite surprising with this

15
00:00:28,000 --> 00:00:30,160
weather and

16
00:00:30,160 --> 00:00:31,599
what else i can tell you about this

17
00:00:31,599 --> 00:00:34,000
mysterious speaker that i'm sure you

18
00:00:34,000 --> 00:00:36,559
many of you already know i'm talking of

19
00:00:36,559 --> 00:00:37,360
course

20
00:00:37,360 --> 00:00:41,120
about gal butansky so galbitansky

21
00:00:41,120 --> 00:00:42,559
is going to be ready to come you can

22
00:00:42,559 --> 00:00:44,800
come from here it's okay okay so please

23
00:00:44,800 --> 00:00:45,600
give a

24
00:00:45,600 --> 00:00:49,280
warm welcome to galvitansky

25
00:00:49,360 --> 00:00:51,760
running all the way from the other side

26
00:00:51,760 --> 00:00:53,120
of the stage

27
00:00:53,120 --> 00:00:55,760
and gal is gonna talk to us about some

28
00:00:55,760 --> 00:00:57,199
really really cool stuff

29
00:00:57,199 --> 00:00:59,039
we're going to learn about leveraging

30
00:00:59,039 --> 00:01:01,199
passive fingerprinting

31
00:01:01,199 --> 00:01:04,319
for link scanners evasion what are link

32
00:01:04,319 --> 00:01:05,680
scanners

33
00:01:05,680 --> 00:01:09,200
salute kampai what are link scanners and

34
00:01:09,200 --> 00:01:10,400
how do you evade

35
00:01:10,400 --> 00:01:13,520
their detection all that and more by

36
00:01:13,520 --> 00:01:16,080
galbitansky give it up to gal

37
00:01:16,080 --> 00:01:18,399
yay

38
00:01:20,320 --> 00:01:23,680
so yeah it's working so

39
00:01:23,680 --> 00:01:26,400
hello everyone good evening and welcome

40
00:01:26,400 --> 00:01:27,600
to my talk

41
00:01:27,600 --> 00:01:30,320
my goal today here is that that everyone

42
00:01:30,320 --> 00:01:32,000
in this room will know

43
00:01:32,000 --> 00:01:34,159
what what link scanners are and how we

44
00:01:34,159 --> 00:01:35,360
can use this

45
00:01:35,360 --> 00:01:37,280
fingerprinting concept in order to evade

46
00:01:37,280 --> 00:01:39,439
it

47
00:01:39,600 --> 00:01:43,520
so first and foremost

48
00:01:43,520 --> 00:01:45,759
this is my all of my social media

49
00:01:45,759 --> 00:01:46,640
accounts i'll

50
00:01:46,640 --> 00:01:48,560
greatly appreciate if someone will send

51
00:01:48,560 --> 00:01:50,240
me pictures of this talk because my

52
00:01:50,240 --> 00:01:52,000
polish grandma is driving me nuts

53
00:01:52,000 --> 00:01:54,479
so bonus points to anyone was assisting

54
00:01:54,479 --> 00:01:55,360
with this

55
00:01:55,360 --> 00:02:00,079
kind of area okay a bit about myself

56
00:02:00,079 --> 00:02:03,600
um yeah so there will be a lot of

57
00:02:03,600 --> 00:02:06,159
cheap powerpoint animations in this talk

58
00:02:06,159 --> 00:02:06,640
that

59
00:02:06,640 --> 00:02:09,038
i am a powerpoint animation evangelist

60
00:02:09,038 --> 00:02:10,239
but i'm also

61
00:02:10,239 --> 00:02:13,520
uh really into all kinds of

62
00:02:13,520 --> 00:02:15,760
malware evasion techniques i did mostly

63
00:02:15,760 --> 00:02:17,680
this stuff for about four years

64
00:02:17,680 --> 00:02:19,599
but from there i kind of proceeded into

65
00:02:19,599 --> 00:02:23,360
doing more web related stuff at akamai

66
00:02:23,360 --> 00:02:27,280
namely bots mainly

67
00:02:28,160 --> 00:02:30,080
i'm currently sharing my home office

68
00:02:30,080 --> 00:02:32,080
with all of those feline beasts that's

69
00:02:32,080 --> 00:02:32,720
chewbacca

70
00:02:32,720 --> 00:02:34,160
sitting there on my shoulders actually

71
00:02:34,160 --> 00:02:37,280
doing the research you are seeing today

72
00:02:37,280 --> 00:02:41,280
fun fact and also i really like b-sides

73
00:02:41,280 --> 00:02:42,400
as karen said

74
00:02:42,400 --> 00:02:43,920
it was the first place who gave me a

75
00:02:43,920 --> 00:02:45,519
chance to speak here today

76
00:02:45,519 --> 00:02:48,080
here's like live footage from the like

77
00:02:48,080 --> 00:02:49,200
turkish hamam

78
00:02:49,200 --> 00:02:51,760
we had for the first b sides with inbar

79
00:02:51,760 --> 00:02:53,920
even next me on stage

80
00:02:53,920 --> 00:02:57,599
it was you can't even imagine

81
00:02:57,599 --> 00:03:01,440
how we we got like so much further

82
00:03:01,440 --> 00:03:04,720
okay so what is fingerprinting let's

83
00:03:04,720 --> 00:03:08,400
start with speaking about fingerprinting

84
00:03:08,800 --> 00:03:10,959
not even in the context of any like

85
00:03:10,959 --> 00:03:12,239
technical stuff but

86
00:03:12,239 --> 00:03:14,560
just like fingerprinting 101 we want to

87
00:03:14,560 --> 00:03:16,159
positively identify an

88
00:03:16,159 --> 00:03:18,959
object by collecting properties we can

89
00:03:18,959 --> 00:03:19,920
do it actively

90
00:03:19,920 --> 00:03:22,159
like asking questions like hey what's

91
00:03:22,159 --> 00:03:23,200
your name or

92
00:03:23,200 --> 00:03:25,519
can you show me an id this will allow me

93
00:03:25,519 --> 00:03:26,799
to identify this object

94
00:03:26,799 --> 00:03:29,360
right but we can also do it in a passive

95
00:03:29,360 --> 00:03:29,840
way

96
00:03:29,840 --> 00:03:32,879
i can for example eavesdrop and overhear

97
00:03:32,879 --> 00:03:33,920
maybe

98
00:03:33,920 --> 00:03:35,519
those two girls speaking with each other

99
00:03:35,519 --> 00:03:37,280
and then overhear the name

100
00:03:37,280 --> 00:03:39,599
of one of them and by that i might be

101
00:03:39,599 --> 00:03:40,720
able to identify

102
00:03:40,720 --> 00:03:44,159
one of them but we are not here

103
00:03:44,159 --> 00:03:47,519
doing csi or even csi cyber oh

104
00:03:47,519 --> 00:03:50,799
god forbid we're speaking about

105
00:03:50,799 --> 00:03:53,680
technical stuff so let's proceed and see

106
00:03:53,680 --> 00:03:54,879
how this concept

107
00:03:54,879 --> 00:03:58,239
takes part in the world of web

108
00:03:58,239 --> 00:04:00,640
so i guess that most of us already

109
00:04:00,640 --> 00:04:01,519
written

110
00:04:01,519 --> 00:04:03,280
at least like a couple of python lines

111
00:04:03,280 --> 00:04:04,959
which uh

112
00:04:04,959 --> 00:04:07,680
perform a http request fetching

113
00:04:07,680 --> 00:04:09,040
resources from the web

114
00:04:09,040 --> 00:04:10,799
and you know that client's

115
00:04:10,799 --> 00:04:13,120
implementation varies

116
00:04:13,120 --> 00:04:15,599
you know every one of us can write

117
00:04:15,599 --> 00:04:16,720
different codes

118
00:04:16,720 --> 00:04:18,079
different languages different

119
00:04:18,079 --> 00:04:20,320
implementations different errors

120
00:04:20,320 --> 00:04:23,680
maybe it just varies

121
00:04:23,680 --> 00:04:25,919
and also the infrastructure level you

122
00:04:25,919 --> 00:04:27,759
have different os device

123
00:04:27,759 --> 00:04:29,919
operation systems you have different

124
00:04:29,919 --> 00:04:31,520
network devices

125
00:04:31,520 --> 00:04:33,440
all of those might have all kinds of

126
00:04:33,440 --> 00:04:36,400
impact on the fingerprint that you have

127
00:04:36,400 --> 00:04:38,800
we'll see examples like much later in

128
00:04:38,800 --> 00:04:41,040
this talk

129
00:04:41,040 --> 00:04:43,440
do remember that some of those are by

130
00:04:43,440 --> 00:04:46,080
design for example user agent

131
00:04:46,080 --> 00:04:48,320
user agent allows the server to serve

132
00:04:48,320 --> 00:04:50,080
you with content which might

133
00:04:50,080 --> 00:04:52,560
be better suited to your device like if

134
00:04:52,560 --> 00:04:55,199
it's a mobile device of some kind

135
00:04:55,199 --> 00:04:57,280
so it might allow you to do this kind of

136
00:04:57,280 --> 00:04:59,120
stuff but

137
00:04:59,120 --> 00:05:00,960
and some of them are not very those are

138
00:05:00,960 --> 00:05:02,800
side channels for example different

139
00:05:02,800 --> 00:05:03,680
browsers

140
00:05:03,680 --> 00:05:06,720
return different errors or they pass

141
00:05:06,720 --> 00:05:09,759
different stuff a bit differently they

142
00:05:09,759 --> 00:05:10,400
have

143
00:05:10,400 --> 00:05:13,199
different implementations for specific

144
00:05:13,199 --> 00:05:14,880
functionality

145
00:05:14,880 --> 00:05:19,600
not going exactly by the rfc sometimes

146
00:05:19,600 --> 00:05:22,240
it does happen

147
00:05:22,720 --> 00:05:25,600
it is nothing new it is being used it is

148
00:05:25,600 --> 00:05:28,000
being used in the product i worked on

149
00:05:28,000 --> 00:05:31,120
in the area of the anti-bot industry um

150
00:05:31,120 --> 00:05:34,160
trying to detect bots by the fingerprint

151
00:05:34,160 --> 00:05:35,680
for example you know stuff like

152
00:05:35,680 --> 00:05:38,560
recaptcha and this area

153
00:05:38,560 --> 00:05:41,039
they use exactly those tactics we're

154
00:05:41,039 --> 00:05:43,120
going to hear today

155
00:05:43,120 --> 00:05:45,759
and also in this like web fingerprinting

156
00:05:45,759 --> 00:05:47,440
technological

157
00:05:47,440 --> 00:05:48,880
kind of concept you also have passive

158
00:05:48,880 --> 00:05:50,720
and active fingerprinting passive

159
00:05:50,720 --> 00:05:52,400
meaning that you only

160
00:05:52,400 --> 00:05:54,400
take the incoming traffic and sniff it

161
00:05:54,400 --> 00:05:55,919
and pass it and do whatever you want

162
00:05:55,919 --> 00:05:58,400
without actually altering the normal

163
00:05:58,400 --> 00:05:59,680
flow of you know

164
00:05:59,680 --> 00:06:01,840
network communication and active well

165
00:06:01,840 --> 00:06:04,240
you might ask the the

166
00:06:04,240 --> 00:06:07,199
server or sorry the client um can you

167
00:06:07,199 --> 00:06:08,960
execute this javascript for me

168
00:06:08,960 --> 00:06:11,520
or you might try and check which ports

169
00:06:11,520 --> 00:06:12,319
are open

170
00:06:12,319 --> 00:06:15,600
on the ip that is you know associated

171
00:06:15,600 --> 00:06:18,000
with the client

172
00:06:18,000 --> 00:06:20,479
okay and if you want to see a bit more

173
00:06:20,479 --> 00:06:22,240
about this tactics i really recommend

174
00:06:22,240 --> 00:06:24,240
this website am i unique

175
00:06:24,240 --> 00:06:26,080
it will show you a lot of those tactics

176
00:06:26,080 --> 00:06:28,000
you can scan this qr code there will be

177
00:06:28,000 --> 00:06:30,479
some qr codes throughout this talk so

178
00:06:30,479 --> 00:06:35,840
feel free to do so am i unique

179
00:06:40,160 --> 00:06:42,639
okay fingerprinting we know it's

180
00:06:42,639 --> 00:06:43,600
fingerprinting

181
00:06:43,600 --> 00:06:45,120
we have some idea about web

182
00:06:45,120 --> 00:06:47,360
fingerprinting but what are

183
00:06:47,360 --> 00:06:49,759
those link scanners or let's begin maybe

184
00:06:49,759 --> 00:06:51,039
with why

185
00:06:51,039 --> 00:06:53,599
why we need those link scanners there's

186
00:06:53,599 --> 00:06:55,680
an actual email i received from the not

187
00:06:55,680 --> 00:06:56,639
so

188
00:06:56,639 --> 00:06:59,599
legit domain with the link there below

189
00:06:59,599 --> 00:07:01,599
something something with a tlt of

190
00:07:01,599 --> 00:07:04,880
xyz that's why we need link scanners

191
00:07:04,880 --> 00:07:09,440
because links can be dangerous dangerous

192
00:07:09,440 --> 00:07:11,759
so we need to check them before the user

193
00:07:11,759 --> 00:07:13,520
accesses those links

194
00:07:13,520 --> 00:07:15,680
hopefully and then alert and block and

195
00:07:15,680 --> 00:07:17,840
if if no one actually clicked the link

196
00:07:17,840 --> 00:07:18,800
and went to this

197
00:07:18,800 --> 00:07:21,440
you know malicious website we win as

198
00:07:21,440 --> 00:07:23,120
simple as that

199
00:07:23,120 --> 00:07:26,319
no one actually accessed this phishing

200
00:07:26,319 --> 00:07:27,360
content or

201
00:07:27,360 --> 00:07:30,240
downloaded the malicious binary so good

202
00:07:30,240 --> 00:07:32,560
for us

203
00:07:33,599 --> 00:07:36,639
but where we can find those and it is

204
00:07:36,639 --> 00:07:38,240
kind of surprising but

205
00:07:38,240 --> 00:07:40,479
a lot of different products have this

206
00:07:40,479 --> 00:07:41,759
kind of component

207
00:07:41,759 --> 00:07:44,639
which fetches data from a url not only

208
00:07:44,639 --> 00:07:45,919
link scanners but

209
00:07:45,919 --> 00:07:47,759
there are a couple of those for example

210
00:07:47,759 --> 00:07:49,759
virustotal there's a url scanning

211
00:07:49,759 --> 00:07:50,400
capability

212
00:07:50,400 --> 00:07:53,440
in virustotal there's also urlscan.io

213
00:07:53,440 --> 00:07:55,520
which is amazing and highly recommended

214
00:07:55,520 --> 00:07:58,560
it is from like in my opinion

215
00:07:58,560 --> 00:08:00,879
there are also email security products

216
00:08:00,879 --> 00:08:02,400
you have incoming emails

217
00:08:02,400 --> 00:08:05,280
incoming emails have urls sometimes like

218
00:08:05,280 --> 00:08:06,319
in my case

219
00:08:06,319 --> 00:08:09,759
um g suite office 365 all

220
00:08:09,759 --> 00:08:11,919
have this kind of component scanning

221
00:08:11,919 --> 00:08:13,919
incoming emails for links and then

222
00:08:13,919 --> 00:08:16,639
tries to grab something which is behind

223
00:08:16,639 --> 00:08:19,039
this link

224
00:08:19,039 --> 00:08:21,840
sandbox solutions also surprisingly

225
00:08:21,840 --> 00:08:22,720
enough

226
00:08:22,720 --> 00:08:24,720
you can scan a file and submit it from a

227
00:08:24,720 --> 00:08:27,280
url which means there's a client

228
00:08:27,280 --> 00:08:30,400
downloading this file into the machine

229
00:08:30,400 --> 00:08:33,039
somehow auto magically like some people

230
00:08:33,039 --> 00:08:34,479
like saying even

231
00:08:34,479 --> 00:08:36,880
instant messaging platforms sometimes

232
00:08:36,880 --> 00:08:38,880
have a similar component

233
00:08:38,880 --> 00:08:42,000
for doing this kind of stuff if someone

234
00:08:42,000 --> 00:08:43,919
which you don't know sends you a message

235
00:08:43,919 --> 00:08:47,040
with a suspicious link it might

236
00:08:47,040 --> 00:08:49,680
get scanned

237
00:08:50,720 --> 00:08:53,839
but you know it is all very nice and

238
00:08:53,839 --> 00:08:54,720
fancy but

239
00:08:54,720 --> 00:08:56,080
what's actually taking place behind the

240
00:08:56,080 --> 00:08:58,880
scenes so those content html content

241
00:08:58,880 --> 00:09:00,160
binary content

242
00:09:00,160 --> 00:09:02,320
and we want to fetch this content

243
00:09:02,320 --> 00:09:04,160
somehow how you fetch it

244
00:09:04,160 --> 00:09:06,080
usually http request we're going to

245
00:09:06,080 --> 00:09:07,279
speak today here

246
00:09:07,279 --> 00:09:10,480
about http requests mostly and how we do

247
00:09:10,480 --> 00:09:14,160
we do that well you guessed it

248
00:09:14,160 --> 00:09:17,680
the answer is always python

249
00:09:17,680 --> 00:09:20,880
something like this i am not familiar

250
00:09:20,880 --> 00:09:22,000
with the actual implementation

251
00:09:22,000 --> 00:09:23,760
of some of the clients for checking the

252
00:09:23,760 --> 00:09:25,600
security of links but

253
00:09:25,600 --> 00:09:28,000
this implementation might be actual

254
00:09:28,000 --> 00:09:28,880
stuff which

255
00:09:28,880 --> 00:09:31,279
actually goes there behind the scenes

256
00:09:31,279 --> 00:09:33,279
that's the best code in their opinion

257
00:09:33,279 --> 00:09:35,440
they don't have security in their mind

258
00:09:35,440 --> 00:09:38,880
too much as we're about to see

259
00:09:40,000 --> 00:09:42,800
so we know what's fingerprinting we know

260
00:09:42,800 --> 00:09:44,240
what's web fingerprinting

261
00:09:44,240 --> 00:09:46,240
we know what link scanners are and why

262
00:09:46,240 --> 00:09:47,360
we have them

263
00:09:47,360 --> 00:09:49,040
but how we can leverage this

264
00:09:49,040 --> 00:09:51,279
fingerprinting stuff to evade

265
00:09:51,279 --> 00:09:53,519
link scanners because that's our goal

266
00:09:53,519 --> 00:09:55,200
here today before trying to fix

267
00:09:55,200 --> 00:09:58,560
things later in the talk

268
00:09:58,560 --> 00:10:02,399
so i had a what if moment

269
00:10:02,399 --> 00:10:05,040
link scanners are web clients just like

270
00:10:05,040 --> 00:10:05,680
bots

271
00:10:05,680 --> 00:10:07,839
just like browsers just like anything

272
00:10:07,839 --> 00:10:08,720
which fetches

273
00:10:08,720 --> 00:10:12,240
content from the web and web clients are

274
00:10:12,240 --> 00:10:13,920
fingerprintable

275
00:10:13,920 --> 00:10:16,839
because i know that from my day-to-day

276
00:10:16,839 --> 00:10:18,800
job as i said

277
00:10:18,800 --> 00:10:20,720
implementation varies on many different

278
00:10:20,720 --> 00:10:23,200
levels

279
00:10:23,440 --> 00:10:26,000
so let's say i can identify those

280
00:10:26,000 --> 00:10:27,360
specific

281
00:10:27,360 --> 00:10:29,760
clients and i can tell oh this client

282
00:10:29,760 --> 00:10:30,880
that's not a victim

283
00:10:30,880 --> 00:10:33,440
that's not a phishing victim that this

284
00:10:33,440 --> 00:10:34,399
guy or girl

285
00:10:34,399 --> 00:10:36,399
doesn't try to download my malicious

286
00:10:36,399 --> 00:10:37,920
file and execute it

287
00:10:37,920 --> 00:10:40,480
that's an actual like i don't know varus

288
00:10:40,480 --> 00:10:41,519
total trying to

289
00:10:41,519 --> 00:10:44,560
scan my website so

290
00:10:44,560 --> 00:10:47,440
this will allow me to identify this

291
00:10:47,440 --> 00:10:49,600
specific client and send back a very

292
00:10:49,600 --> 00:10:53,040
like different response um graphically a

293
00:10:53,040 --> 00:10:55,120
bit of like a simplification

294
00:10:55,120 --> 00:10:58,839
server client request

295
00:10:58,839 --> 00:11:00,800
fingerprinting and then i make my

296
00:11:00,800 --> 00:11:02,480
decision whether or not i want to send a

297
00:11:02,480 --> 00:11:04,720
benign or a malicious response

298
00:11:04,720 --> 00:11:07,600
as simple as that

299
00:11:09,279 --> 00:11:12,480
now for the fun part let's go layer by

300
00:11:12,480 --> 00:11:13,360
layer

301
00:11:13,360 --> 00:11:17,600
and try to understand where

302
00:11:17,600 --> 00:11:20,959
the vendors did something wrong see some

303
00:11:20,959 --> 00:11:24,800
very fundamental flaws which

304
00:11:24,800 --> 00:11:26,959
were across all the vendors i've checked

305
00:11:26,959 --> 00:11:30,079
and some nice examples

306
00:11:30,079 --> 00:11:32,160
we'll start from the like top from

307
00:11:32,160 --> 00:11:34,320
application level and go as deep as even

308
00:11:34,320 --> 00:11:36,880
link layer

309
00:11:38,160 --> 00:11:40,880
so application layer my favorite http

310
00:11:40,880 --> 00:11:41,600
everything is

311
00:11:41,600 --> 00:11:45,360
so easy nice and dandy and

312
00:11:45,360 --> 00:11:47,600
here comes the thing which annoyed me

313
00:11:47,600 --> 00:11:48,399
the most

314
00:11:48,399 --> 00:11:50,480
i've inspected 15 different vendors in

315
00:11:50,480 --> 00:11:51,680
my research

316
00:11:51,680 --> 00:11:54,480
and the thing which most of them did

317
00:11:54,480 --> 00:11:54,959
wrong

318
00:11:54,959 --> 00:11:58,959
and really wrong was obsolete user agent

319
00:11:58,959 --> 00:12:00,800
you're all running your machine you have

320
00:12:00,800 --> 00:12:02,160
a browser

321
00:12:02,160 --> 00:12:03,920
if you're living in 21st century and

322
00:12:03,920 --> 00:12:05,680
it's usually kind of up to date maybe

323
00:12:05,680 --> 00:12:07,360
you didn't update it i know a couple of

324
00:12:07,360 --> 00:12:08,399
months maybe

325
00:12:08,399 --> 00:12:10,959
half a year but what we've seen in our

326
00:12:10,959 --> 00:12:12,160
research is

327
00:12:12,160 --> 00:12:13,839
prehistoric chrome and when i'm speaking

328
00:12:13,839 --> 00:12:15,360
prehistoric i'm

329
00:12:15,360 --> 00:12:17,360
speaking about chrome 50 something which

330
00:12:17,360 --> 00:12:19,120
is over five years old

331
00:12:19,120 --> 00:12:21,760
or even incredible stuff like inter

332
00:12:21,760 --> 00:12:22,480
explorer

333
00:12:22,480 --> 00:12:25,839
eight or even inter explorer six i think

334
00:12:25,839 --> 00:12:27,279
that today in the crowd

335
00:12:27,279 --> 00:12:29,839
we have people who are younger than

336
00:12:29,839 --> 00:12:31,600
internet explorer six

337
00:12:31,600 --> 00:12:35,360
and i'm kind of joking but i'm not

338
00:12:37,120 --> 00:12:38,959
it is like even either explorer 8 is

339
00:12:38,959 --> 00:12:40,320
over a decade old

340
00:12:40,320 --> 00:12:43,279
just like to give you some reference and

341
00:12:43,279 --> 00:12:45,200
my all-time favorite

342
00:12:45,200 --> 00:12:49,120
virus total i don't know how many of you

343
00:12:49,120 --> 00:12:51,040
ever checked it but when you scan a

344
00:12:51,040 --> 00:12:52,800
website with virustotal there's a user

345
00:12:52,800 --> 00:12:53,680
agent

346
00:12:53,680 --> 00:12:57,120
but that is the user agent that you get

347
00:12:57,120 --> 00:12:59,920
yes the word varus total is part of the

348
00:12:59,920 --> 00:13:01,040
user agent

349
00:13:01,040 --> 00:13:04,160
and yeah by the way that's i think one

350
00:13:04,160 --> 00:13:05,440
of my favorite animations in this

351
00:13:05,440 --> 00:13:07,279
presentation

352
00:13:07,279 --> 00:13:10,399
it is inexcusable to scan a website

353
00:13:10,399 --> 00:13:12,160
and check if it is a malicious or not

354
00:13:12,160 --> 00:13:14,000
when you're saying to the website

355
00:13:14,000 --> 00:13:16,320
oh yeah i want to check if you have any

356
00:13:16,320 --> 00:13:18,320
malicious content no

357
00:13:18,320 --> 00:13:20,240
they're aware of that by the way at

358
00:13:20,240 --> 00:13:23,519
least for a couple of years

359
00:13:27,360 --> 00:13:30,959
some other header anomalies now

360
00:13:32,399 --> 00:13:35,839
squid proxy is a proxy solution

361
00:13:35,839 --> 00:13:39,839
for almost any proxy related stuff you

362
00:13:39,839 --> 00:13:40,959
do

363
00:13:40,959 --> 00:13:44,079
everyone uses it but it ha it i think by

364
00:13:44,079 --> 00:13:47,360
default adds a via header

365
00:13:47,360 --> 00:13:49,360
this header was added by a sandbox

366
00:13:49,360 --> 00:13:51,120
solution i've tested

367
00:13:51,120 --> 00:13:53,199
it was fixed by the way but not only

368
00:13:53,199 --> 00:13:55,120
that it included this via header

369
00:13:55,120 --> 00:13:57,680
which included i know squeeze proxy

370
00:13:57,680 --> 00:13:59,120
which might be suspicious but not

371
00:13:59,120 --> 00:14:00,000
necessarily

372
00:14:00,000 --> 00:14:02,880
associated with a security product it

373
00:14:02,880 --> 00:14:05,279
included the entire path of the machine

374
00:14:05,279 --> 00:14:07,199
within the lab like sandbox machine

375
00:14:07,199 --> 00:14:09,199
number one and

376
00:14:09,199 --> 00:14:12,720
like sub lab number three or i know what

377
00:14:12,720 --> 00:14:14,320
but

378
00:14:14,320 --> 00:14:16,160
it disclosed the entire topology of the

379
00:14:16,160 --> 00:14:17,920
lab in this header

380
00:14:17,920 --> 00:14:23,040
again ridiculous but it is what it is

381
00:14:23,040 --> 00:14:25,120
also another one of my favorites one of

382
00:14:25,120 --> 00:14:26,240
the largest

383
00:14:26,240 --> 00:14:28,720
email security vendors had this referral

384
00:14:28,720 --> 00:14:29,839
header

385
00:14:29,839 --> 00:14:32,240
kind of trying to explain it they

386
00:14:32,240 --> 00:14:34,079
synthetically added this header which

387
00:14:34,079 --> 00:14:36,320
means to the website you browse into

388
00:14:36,320 --> 00:14:39,199
that somehow you've found exactly the

389
00:14:39,199 --> 00:14:39,839
name

390
00:14:39,839 --> 00:14:43,920
of the link somehow magically in google

391
00:14:43,920 --> 00:14:46,639
i know how

392
00:14:46,880 --> 00:14:49,839
and from google after searching for

393
00:14:49,839 --> 00:14:51,839
exactly this url

394
00:14:51,839 --> 00:14:54,320
you reach to the potentially malicious

395
00:14:54,320 --> 00:14:55,360
website

396
00:14:55,360 --> 00:14:58,800
no one actually ever looks for http uh

397
00:14:58,800 --> 00:15:01,600
whatever it doesn't happen moreover if

398
00:15:01,600 --> 00:15:02,480
you're clicking

399
00:15:02,480 --> 00:15:04,639
on an outlook link like in the desktop

400
00:15:04,639 --> 00:15:05,600
version of outlook

401
00:15:05,600 --> 00:15:08,480
there's no referral header at all so

402
00:15:08,480 --> 00:15:10,720
even the presence of this header is

403
00:15:10,720 --> 00:15:12,880
a telltale of something fishy is going

404
00:15:12,880 --> 00:15:15,120
here

405
00:15:15,279 --> 00:15:18,639
it was fixed as well by the way

406
00:15:20,000 --> 00:15:23,040
let's go a bit deeper

407
00:15:23,760 --> 00:15:25,199
so if we've been so far in the

408
00:15:25,199 --> 00:15:26,880
application layer

409
00:15:26,880 --> 00:15:28,720
we'll go a bit deeper now to transport

410
00:15:28,720 --> 00:15:31,759
internet and link layers

411
00:15:32,320 --> 00:15:34,720
all of them are a bit more technical i

412
00:15:34,720 --> 00:15:37,839
won't dive too deeply into them but

413
00:15:37,839 --> 00:15:41,839
let's give it a go

414
00:15:42,160 --> 00:15:45,600
so there's an entity called

415
00:15:45,600 --> 00:15:48,639
as or asn autonomous system

416
00:15:48,639 --> 00:15:52,320
number it is it has something to do with

417
00:15:52,320 --> 00:15:54,000
a protocol called bgp

418
00:15:54,000 --> 00:15:55,839
their large entities reside within these

419
00:15:55,839 --> 00:15:58,320
protocols like isps or

420
00:15:58,320 --> 00:16:01,600
enterprises for example

421
00:16:01,600 --> 00:16:03,440
but what if those enterprises are

422
00:16:03,440 --> 00:16:04,800
security companies like i don't know

423
00:16:04,800 --> 00:16:05,839
kaspersky

424
00:16:05,839 --> 00:16:09,540
palo alto akamai i know

425
00:16:09,540 --> 00:16:10,880
[Music]

426
00:16:10,880 --> 00:16:14,160
almost every large enterprise have an as

427
00:16:14,160 --> 00:16:17,199
for its own so let's say that

428
00:16:17,199 --> 00:16:19,040
the ip range which is associated with

429
00:16:19,040 --> 00:16:20,560
this entity

430
00:16:20,560 --> 00:16:24,959
is the one scanning my server

431
00:16:24,959 --> 00:16:28,480
it is just like again a very distinct

432
00:16:28,480 --> 00:16:30,399
telltale that

433
00:16:30,399 --> 00:16:33,759
i should never respond maliciously

434
00:16:33,759 --> 00:16:36,639
you know why should i as someone who's

435
00:16:36,639 --> 00:16:37,600
trying to run

436
00:16:37,600 --> 00:16:41,759
a successful phishing or trying to

437
00:16:41,759 --> 00:16:44,880
kind of spread malware send

438
00:16:44,880 --> 00:16:47,440
for free my content to the security

439
00:16:47,440 --> 00:16:48,240
vendor when

440
00:16:48,240 --> 00:16:51,199
it is very simple to know like this is

441
00:16:51,199 --> 00:16:53,440
to distinguish this association with the

442
00:16:53,440 --> 00:16:57,040
security vendor also there are

443
00:16:57,040 --> 00:17:00,639
many security like sorry cloud providers

444
00:17:00,639 --> 00:17:02,399
every cloud provider actually has their

445
00:17:02,399 --> 00:17:04,720
own aes google

446
00:17:04,720 --> 00:17:07,439
azure like microsoft aws amazon and

447
00:17:07,439 --> 00:17:08,559
digitalocean

448
00:17:08,559 --> 00:17:11,760
you name it all of those are also again

449
00:17:11,760 --> 00:17:14,640
a very good indicator for someone who's

450
00:17:14,640 --> 00:17:15,199
running

451
00:17:15,199 --> 00:17:17,520
some machines in the cloud our victims

452
00:17:17,520 --> 00:17:19,599
are almost never

453
00:17:19,599 --> 00:17:21,839
you know how many of you are using a

454
00:17:21,839 --> 00:17:23,839
cloud machine as their day-to-day

455
00:17:23,839 --> 00:17:28,799
daily driver machine i guess that's none

456
00:17:30,400 --> 00:17:32,000
which means for an attacker if it is a

457
00:17:32,000 --> 00:17:33,679
cloud machine don't

458
00:17:33,679 --> 00:17:36,240
attack it

459
00:17:36,720 --> 00:17:40,400
next some examples you see this

460
00:17:40,400 --> 00:17:41,919
this is what you'll see when you're

461
00:17:41,919 --> 00:17:46,400
hovering on top of an office 365 link

462
00:17:46,400 --> 00:17:48,960
by the way it is all mangled i've

463
00:17:48,960 --> 00:17:50,480
switched a lot of stuff so don't try to

464
00:17:50,480 --> 00:17:52,240
copy paste it and type it manually

465
00:17:52,240 --> 00:17:55,840
you only waste some time and

466
00:17:55,840 --> 00:17:58,000
just before you click it of course that

467
00:17:58,000 --> 00:17:58,960
microsoft

468
00:17:58,960 --> 00:18:00,160
will check whether or not it is

469
00:18:00,160 --> 00:18:03,120
malicious right but how

470
00:18:03,120 --> 00:18:05,200
it will send an http request from this

471
00:18:05,200 --> 00:18:07,360
ip which surprisingly enough resides

472
00:18:07,360 --> 00:18:10,799
within microsoft address space

473
00:18:10,799 --> 00:18:14,000
so yeah it kind of i

474
00:18:14,000 --> 00:18:15,760
don't have a lot of motivation to send

475
00:18:15,760 --> 00:18:17,760
malicious content back to microsoft

476
00:18:17,760 --> 00:18:20,640
i know that my victim won't browse me

477
00:18:20,640 --> 00:18:23,600
through microsoft

478
00:18:24,559 --> 00:18:26,960
and by the way they also had this user

479
00:18:26,960 --> 00:18:29,440
agent chrome 79 is

480
00:18:29,440 --> 00:18:32,400
not that old but it is about a year and

481
00:18:32,400 --> 00:18:34,240
a half old

482
00:18:34,240 --> 00:18:37,360
today we're chrome 91 since may so

483
00:18:37,360 --> 00:18:39,919
they might need to update it and also an

484
00:18:39,919 --> 00:18:41,039
interesting idea

485
00:18:41,039 --> 00:18:43,600
so they have windows as part of the user

486
00:18:43,600 --> 00:18:44,480
agent

487
00:18:44,480 --> 00:18:47,360
what if the target is an apple user if i

488
00:18:47,360 --> 00:18:49,200
have some intelligence about

489
00:18:49,200 --> 00:18:51,200
you know this organization i know they

490
00:18:51,200 --> 00:18:52,640
have a lot of macs

491
00:18:52,640 --> 00:18:56,320
so i expect the request to come from

492
00:18:56,320 --> 00:18:58,320
something which with a mac user agent

493
00:18:58,320 --> 00:18:59,760
not a windows user agent

494
00:18:59,760 --> 00:19:01,760
i will never respond maliciously to this

495
00:19:01,760 --> 00:19:04,720
user agent right

496
00:19:05,600 --> 00:19:08,720
and another tricky one dns ptr record

497
00:19:08,720 --> 00:19:11,440
we all know dns mostly the a record

498
00:19:11,440 --> 00:19:13,039
which is the one which

499
00:19:13,039 --> 00:19:15,039
returns to you when you're doing a dns

500
00:19:15,039 --> 00:19:16,160
query like

501
00:19:16,160 --> 00:19:19,280
what's the ip address of google.com

502
00:19:19,280 --> 00:19:21,679
ptr code is the opposite of it it's what

503
00:19:21,679 --> 00:19:22,960
you get when you're

504
00:19:22,960 --> 00:19:26,160
doing the reverse dns query

505
00:19:26,160 --> 00:19:29,120
again with this nice animation let's say

506
00:19:29,120 --> 00:19:30,799
you get a request from

507
00:19:30,799 --> 00:19:33,919
the ip elite

508
00:19:33,919 --> 00:19:36,799
you send a query which might be as

509
00:19:36,799 --> 00:19:38,640
simple as ns lookup

510
00:19:38,640 --> 00:19:40,320
trying to figure out what's behind this

511
00:19:40,320 --> 00:19:42,960
ip surprisingly enough

512
00:19:42,960 --> 00:19:45,039
you get the corporate's home page or a

513
00:19:45,039 --> 00:19:46,480
scanner

514
00:19:46,480 --> 00:19:50,840
kind of url it actually happened to me

515
00:19:50,840 --> 00:19:53,679
twice and then you can decide how you

516
00:19:53,679 --> 00:19:55,120
want to respond but

517
00:19:55,120 --> 00:19:57,039
it allows you to identify again

518
00:19:57,039 --> 00:19:58,400
association of an ip

519
00:19:58,400 --> 00:20:01,039
with a security product really easily

520
00:20:01,039 --> 00:20:04,480
all you need to do is ns lookup

521
00:20:05,440 --> 00:20:07,679
that's by the way one of the cases i had

522
00:20:07,679 --> 00:20:08,480
it

523
00:20:08,480 --> 00:20:11,200
it is a bit redacted but it was actually

524
00:20:11,200 --> 00:20:11,760
i think

525
00:20:11,760 --> 00:20:15,200
partially fixed even but when you see it

526
00:20:15,200 --> 00:20:18,720
you have a web page with like the sole

527
00:20:18,720 --> 00:20:20,000
purpose of checking whether

528
00:20:20,000 --> 00:20:23,039
or not a url is safe or not and they're

529
00:20:23,039 --> 00:20:24,480
probably checking it from the same

530
00:20:24,480 --> 00:20:26,640
machine running both the ui

531
00:20:26,640 --> 00:20:29,280
and the actual module running you know

532
00:20:29,280 --> 00:20:31,760
the link scanning activity

533
00:20:31,760 --> 00:20:34,159
so easily detectable when you run this

534
00:20:34,159 --> 00:20:35,200
ns lookup thing

535
00:20:35,200 --> 00:20:37,840
you'll get the url of this web page like

536
00:20:37,840 --> 00:20:39,120
come on

537
00:20:39,120 --> 00:20:40,400
and they don't think it is a product

538
00:20:40,400 --> 00:20:42,320
it's a problem by the way i worked

539
00:20:42,320 --> 00:20:43,760
really hard to convince them it is a

540
00:20:43,760 --> 00:20:45,360
problem

541
00:20:45,360 --> 00:20:47,840
another nice case so yeah i had a

542
00:20:47,840 --> 00:20:49,280
request from this ip

543
00:20:49,280 --> 00:20:52,960
with this user agent remember osx 10.6

544
00:20:52,960 --> 00:20:56,320
we'll go back to it in a sec so it is

545
00:20:56,320 --> 00:20:57,039
trivial to

546
00:20:57,039 --> 00:21:01,280
find that this ap is associated with the

547
00:21:01,280 --> 00:21:04,799
four as4444 four four point five times

548
00:21:04,799 --> 00:21:06,159
four

549
00:21:06,159 --> 00:21:08,720
but also if you do this ns lookup trick

550
00:21:08,720 --> 00:21:10,480
you will see it is associated with

551
00:21:10,480 --> 00:21:12,440
something which ends with

552
00:21:12,440 --> 00:21:13,760
mailcontrol.com

553
00:21:13,760 --> 00:21:15,760
what's the main control well it sounds a

554
00:21:15,760 --> 00:21:18,320
bit like a male security thingy

555
00:21:18,320 --> 00:21:20,880
i did google and it is associated with

556
00:21:20,880 --> 00:21:22,559
websense which was merged into

557
00:21:22,559 --> 00:21:23,440
forcepoint

558
00:21:23,440 --> 00:21:26,559
etc so again

559
00:21:26,559 --> 00:21:29,679
this ptr record discloses the fact

560
00:21:29,679 --> 00:21:32,159
that this ap is something you don't want

561
00:21:32,159 --> 00:21:33,520
to respond to

562
00:21:33,520 --> 00:21:35,679
more even you can maybe scan the entire

563
00:21:35,679 --> 00:21:37,919
ip address space in this area

564
00:21:37,919 --> 00:21:40,720
and find more mail control systems just

565
00:21:40,720 --> 00:21:42,320
like you know doing brute force

566
00:21:42,320 --> 00:21:44,720
dns queries or something and remember

567
00:21:44,720 --> 00:21:46,240
this 10.6

568
00:21:46,240 --> 00:21:50,400
so mac os x 10.6 is also a decade old os

569
00:21:50,400 --> 00:21:53,840
who's running a decade old apple os

570
00:21:53,840 --> 00:21:57,520
osx on their devices no one

571
00:21:57,520 --> 00:22:00,080
it makes absolutely no sense again

572
00:22:00,080 --> 00:22:01,440
inexcusable

573
00:22:01,440 --> 00:22:04,000
do some i don't know devops stuff it is

574
00:22:04,000 --> 00:22:04,559
a couple of

575
00:22:04,559 --> 00:22:07,840
python lines to automatic automatically

576
00:22:07,840 --> 00:22:08,480
update

577
00:22:08,480 --> 00:22:09,760
this stuff to something which is at

578
00:22:09,760 --> 00:22:13,840
least reasonable to some extent

579
00:22:15,440 --> 00:22:17,120
but it is all is it all purely

580
00:22:17,120 --> 00:22:19,760
theoretical

581
00:22:20,720 --> 00:22:23,280
and here's the answer i promised cheap

582
00:22:23,280 --> 00:22:25,200
animations

583
00:22:25,200 --> 00:22:27,760
this is taken from a real phishing kit

584
00:22:27,760 --> 00:22:30,080
and the first few lines is get host by

585
00:22:30,080 --> 00:22:32,240
address it's php which sucks but

586
00:22:32,240 --> 00:22:34,720
we can kind of understand it it will

587
00:22:34,720 --> 00:22:35,840
actually do something which is

588
00:22:35,840 --> 00:22:38,159
equivalent to ns lookup and we'll check

589
00:22:38,159 --> 00:22:40,400
for stuff in a blocked

590
00:22:40,400 --> 00:22:42,960
words list like sukuri.net which is a

591
00:22:42,960 --> 00:22:43,679
brazilian

592
00:22:43,679 --> 00:22:47,760
firm doing mostly url related stuff

593
00:22:47,760 --> 00:22:49,520
that's exactly what i suggested to do

594
00:22:49,520 --> 00:22:51,039
the dspdr method

595
00:22:51,039 --> 00:22:55,280
also you have similar checks for

596
00:22:55,280 --> 00:22:58,720
some ranges of ips and some user agents

597
00:22:58,720 --> 00:23:01,120
all can be found in a gist which is

598
00:23:01,120 --> 00:23:02,720
available in the url

599
00:23:02,720 --> 00:23:05,679
in this qr code again you can check it

600
00:23:05,679 --> 00:23:06,960
out on your own

601
00:23:06,960 --> 00:23:09,840
very simple surprisingly enough i saw it

602
00:23:09,840 --> 00:23:11,039
only on fishing kits

603
00:23:11,039 --> 00:23:13,840
with very little similar stuff in the

604
00:23:13,840 --> 00:23:18,000
world of trojans and banking throats etc

605
00:23:19,360 --> 00:23:22,559
let's go even deeper now

606
00:23:22,559 --> 00:23:26,080
tcp link clear maybe a bit of ip

607
00:23:26,080 --> 00:23:28,400
protocols which are much more oriented

608
00:23:28,400 --> 00:23:30,559
in transmitting data between two clients

609
00:23:30,559 --> 00:23:32,640
efficiently reliably trying to maximize

610
00:23:32,640 --> 00:23:33,600
the number of

611
00:23:33,600 --> 00:23:36,080
bytes you can transmit without losing

612
00:23:36,080 --> 00:23:37,760
any

613
00:23:37,760 --> 00:23:40,240
it is tricky it is complex i won't dive

614
00:23:40,240 --> 00:23:41,120
into tcp

615
00:23:41,120 --> 00:23:44,320
too deep now but you need to

616
00:23:44,320 --> 00:23:47,440
have some understanding of the protocol

617
00:23:47,440 --> 00:23:50,799
and some of its flags at least and

618
00:23:50,799 --> 00:23:53,840
the number one reason to use this type

619
00:23:53,840 --> 00:23:55,120
of fingerprinting

620
00:23:55,120 --> 00:23:57,279
is os detection because if i know that i

621
00:23:57,279 --> 00:23:59,360
have a user agent of let's say windows

622
00:23:59,360 --> 00:24:02,840
but the tcp fingerprint is more like

623
00:24:02,840 --> 00:24:05,760
seemingly associated with

624
00:24:05,760 --> 00:24:09,600
let's say apple related os it is fishy

625
00:24:09,600 --> 00:24:13,039
so ttl between wind windows and the

626
00:24:13,039 --> 00:24:14,640
other two operation systems

627
00:24:14,640 --> 00:24:16,960
is different that's kind of well known

628
00:24:16,960 --> 00:24:18,960
is even ip not tcp

629
00:24:18,960 --> 00:24:21,919
but also window size for example it is

630
00:24:21,919 --> 00:24:23,919
very similar and even identical in most

631
00:24:23,919 --> 00:24:24,880
cases between

632
00:24:24,880 --> 00:24:27,840
modern windows devices and apple devices

633
00:24:27,840 --> 00:24:28,159
but

634
00:24:28,159 --> 00:24:32,640
in linux it is all over the place

635
00:24:32,640 --> 00:24:35,200
so it allows you to have some kind of

636
00:24:35,200 --> 00:24:36,480
understanding what's the operation

637
00:24:36,480 --> 00:24:38,000
system

638
00:24:38,000 --> 00:24:40,400
really easily or not that easily as well

639
00:24:40,400 --> 00:24:43,120
about the css

640
00:24:43,440 --> 00:24:46,080
also you have other stuff like mss which

641
00:24:46,080 --> 00:24:47,039
is

642
00:24:47,039 --> 00:24:48,799
if you add 40 bytes it is the same as

643
00:24:48,799 --> 00:24:50,240
mtu

644
00:24:50,240 --> 00:24:52,480
a size which should prevent

645
00:24:52,480 --> 00:24:54,799
fragmentation

646
00:24:54,799 --> 00:24:58,880
um i have 45 minutes for my talk right

647
00:24:58,880 --> 00:25:00,720
yeah

648
00:25:00,720 --> 00:25:05,360
just making sure so mss and mtu

649
00:25:05,360 --> 00:25:07,039
it is something which should prevent

650
00:25:07,039 --> 00:25:10,000
segmentation sorry fragmentation

651
00:25:10,000 --> 00:25:12,720
in packets sent within your network

652
00:25:12,720 --> 00:25:14,080
different different

653
00:25:14,080 --> 00:25:17,200
mediums have different limitations all

654
00:25:17,200 --> 00:25:18,480
kinds of clever engineers

655
00:25:18,480 --> 00:25:21,600
try to optimize the size of packets and

656
00:25:21,600 --> 00:25:22,559
you have this

657
00:25:22,559 --> 00:25:24,960
value

658
00:25:25,679 --> 00:25:27,120
it is different between different

659
00:25:27,120 --> 00:25:29,120
mediums maybe

660
00:25:29,120 --> 00:25:31,120
you're going to see some value which is

661
00:25:31,120 --> 00:25:32,799
a an outlier

662
00:25:32,799 --> 00:25:35,919
associated with vpns or some

663
00:25:35,919 --> 00:25:37,919
cloud vendors have a very distinctive

664
00:25:37,919 --> 00:25:40,400
mss

665
00:25:40,480 --> 00:25:43,200
this should be very interesting and this

666
00:25:43,200 --> 00:25:44,400
might allow you to

667
00:25:44,400 --> 00:25:47,200
identify something which is wrong with

668
00:25:47,200 --> 00:25:48,240
the client

669
00:25:48,240 --> 00:25:50,240
maybe this will allow to identify it as

670
00:25:50,240 --> 00:25:52,559
a bot

671
00:25:53,360 --> 00:25:56,400
and this is why tcp stuff is not that

672
00:25:56,400 --> 00:25:57,520
simple that's me

673
00:25:57,520 --> 00:26:00,080
sniffing wire shark of me sending random

674
00:26:00,080 --> 00:26:02,159
packets over the wire

675
00:26:02,159 --> 00:26:04,000
it is a nightmare to go through all of

676
00:26:04,000 --> 00:26:06,080
those fields and try to identify

677
00:26:06,080 --> 00:26:09,279
what's exactly happening there

678
00:26:09,279 --> 00:26:11,279
but this is why we have this incredible

679
00:26:11,279 --> 00:26:12,960
thing called poff

680
00:26:12,960 --> 00:26:16,240
again open source tool available in this

681
00:26:16,240 --> 00:26:19,600
link in the qr code it has tons of

682
00:26:19,600 --> 00:26:21,840
different signatures for tcp related

683
00:26:21,840 --> 00:26:24,400
stuff like windows sizes and mss and

684
00:26:24,400 --> 00:26:24,720
much

685
00:26:24,720 --> 00:26:26,799
more flags which i won't even get into

686
00:26:26,799 --> 00:26:28,000
today

687
00:26:28,000 --> 00:26:30,799
it is so easy to use very nice piece of

688
00:26:30,799 --> 00:26:31,600
code

689
00:26:31,600 --> 00:26:33,760
even it has like very very exotic stuff

690
00:26:33,760 --> 00:26:36,080
like did you know that google had

691
00:26:36,080 --> 00:26:40,080
a very specific mss value of 1470

692
00:26:40,080 --> 00:26:42,080
maybe there was a phd candidate or

693
00:26:42,080 --> 00:26:43,520
something doing

694
00:26:43,520 --> 00:26:47,039
research for google optimizing by 0.7

695
00:26:47,039 --> 00:26:51,760
by 0.7 you know

696
00:26:51,760 --> 00:26:53,919
like the efficiency of their network by

697
00:26:53,919 --> 00:26:55,120
manipulating this

698
00:26:55,120 --> 00:26:57,760
value but it is a very very strong hint

699
00:26:57,760 --> 00:26:58,480
that you're

700
00:26:58,480 --> 00:27:00,400
actually facing a google related machine

701
00:27:00,400 --> 00:27:01,679
right now

702
00:27:01,679 --> 00:27:04,480
very interesting

703
00:27:05,600 --> 00:27:08,320
and you can by the way test all of it

704
00:27:08,320 --> 00:27:08,720
with

705
00:27:08,720 --> 00:27:11,200
psdf square passive security tools

706
00:27:11,200 --> 00:27:12,480
fingerprinting framework

707
00:27:12,480 --> 00:27:14,080
an open source tool like i wrote for

708
00:27:14,080 --> 00:27:16,960
this purpose again available in this

709
00:27:16,960 --> 00:27:20,000
link it is fully dockerized really easy

710
00:27:20,000 --> 00:27:20,880
to use

711
00:27:20,880 --> 00:27:23,840
it's just like a fancy hdp server i

712
00:27:23,840 --> 00:27:24,960
customized a bit

713
00:27:24,960 --> 00:27:26,720
it includes fingerprinting for all of

714
00:27:26,720 --> 00:27:28,320
the different layers i've mentioned so

715
00:27:28,320 --> 00:27:29,679
far

716
00:27:29,679 --> 00:27:33,200
and also it is easily extendable

717
00:27:33,200 --> 00:27:35,440
lots of configuration files available in

718
00:27:35,440 --> 00:27:37,120
the ml

719
00:27:37,120 --> 00:27:41,760
i really enjoyed working on it okay

720
00:27:41,760 --> 00:27:45,039
so we've spoke about

721
00:27:45,039 --> 00:27:47,679
fingerprinting web fingerprinting and

722
00:27:47,679 --> 00:27:50,399
we've even spoke about

723
00:27:50,399 --> 00:27:52,320
you know what's link scanners and how we

724
00:27:52,320 --> 00:27:53,919
can circumvent them

725
00:27:53,919 --> 00:27:59,440
using fingerprints but what's next

726
00:27:59,600 --> 00:28:01,279
i don't know how many of you are

727
00:28:01,279 --> 00:28:02,880
familiar with this

728
00:28:02,880 --> 00:28:05,919
lovely video of steve balmer

729
00:28:05,919 --> 00:28:08,799
but in that spirit i'll just let go

730
00:28:08,799 --> 00:28:09,600
protocols

731
00:28:09,600 --> 00:28:13,039
protocols protocols protocols protocols

732
00:28:13,039 --> 00:28:16,399
protocols because that's the future of

733
00:28:16,399 --> 00:28:18,559
this area of research

734
00:28:18,559 --> 00:28:21,120
know your protocols and you'll have much

735
00:28:21,120 --> 00:28:22,240
more knowledge

736
00:28:22,240 --> 00:28:24,000
i've actually inspected 15 different

737
00:28:24,000 --> 00:28:25,679
vendors as i mentioned

738
00:28:25,679 --> 00:28:28,559
in my research and i wasn't like

739
00:28:28,559 --> 00:28:30,480
required to go that far

740
00:28:30,480 --> 00:28:32,720
because i was able to evade detection

741
00:28:32,720 --> 00:28:34,559
from any of them

742
00:28:34,559 --> 00:28:38,159
but they might catch up one day

743
00:28:38,159 --> 00:28:42,480
so go and learn new protocols and

744
00:28:42,480 --> 00:28:44,159
see whether or not there's an

745
00:28:44,159 --> 00:28:46,799
opportunity in this area

746
00:28:46,799 --> 00:28:48,480
there are a lot of existing papers by

747
00:28:48,480 --> 00:28:50,240
akamai in this area

748
00:28:50,240 --> 00:28:52,880
i highly recommend going through them

749
00:28:52,880 --> 00:28:54,799
there's a nice research from 2017 by

750
00:28:54,799 --> 00:28:56,559
electricity and ori segal about one

751
00:28:56,559 --> 00:28:57,440
protocol

752
00:28:57,440 --> 00:29:00,080
there's also a really nice page called

753
00:29:00,080 --> 00:29:01,840
the cypher stunting

754
00:29:01,840 --> 00:29:04,960
i highly recommend reading it's two

755
00:29:04,960 --> 00:29:07,279
those are areas which should be explored

756
00:29:07,279 --> 00:29:08,559
if you want to improve

757
00:29:08,559 --> 00:29:10,880
your knowledge and about protocols which

758
00:29:10,880 --> 00:29:12,399
might be usable

759
00:29:12,399 --> 00:29:14,159
and the funny thing is that actors are

760
00:29:14,159 --> 00:29:15,760
actually more aware of those protocols

761
00:29:15,760 --> 00:29:17,120
than security vendors

762
00:29:17,120 --> 00:29:19,840
if i need to fingerprint today an actor

763
00:29:19,840 --> 00:29:20,640
which is

764
00:29:20,640 --> 00:29:23,120
writing a bot it will be actually more

765
00:29:23,120 --> 00:29:24,240
difficult to me

766
00:29:24,240 --> 00:29:27,200
to fingerprint him than to fingerprint a

767
00:29:27,200 --> 00:29:28,480
security vendor

768
00:29:28,480 --> 00:29:30,399
writing something which should fetch

769
00:29:30,399 --> 00:29:32,159
http

770
00:29:32,159 --> 00:29:35,200
content over http

771
00:29:35,679 --> 00:29:38,320
actors are way ahead of security vendors

772
00:29:38,320 --> 00:29:41,840
in that regard

773
00:29:42,240 --> 00:29:45,440
or maybe we should go active but we've

774
00:29:45,440 --> 00:29:46,880
said it is noisy

775
00:29:46,880 --> 00:29:50,880
right so

776
00:29:50,880 --> 00:29:53,840
what about semi-active or maybe we

777
00:29:53,840 --> 00:29:56,399
should call it active by proxy

778
00:29:56,399 --> 00:29:59,679
or semi-passive what if i have a

779
00:29:59,679 --> 00:30:01,360
subscription for showdown

780
00:30:01,360 --> 00:30:05,520
for example and i proxy my request

781
00:30:05,520 --> 00:30:08,320
to check whether or not this client is

782
00:30:08,320 --> 00:30:09,600
kind of suspicious or not

783
00:30:09,600 --> 00:30:11,360
via showdown or any other equivalent

784
00:30:11,360 --> 00:30:13,520
service i am not sending any direct

785
00:30:13,520 --> 00:30:14,640
request to show the

786
00:30:14,640 --> 00:30:16,640
to sorry to the client and just querying

787
00:30:16,640 --> 00:30:17,919
showden's offline

788
00:30:17,919 --> 00:30:20,159
existing database which should be kind

789
00:30:20,159 --> 00:30:21,360
of accurate

790
00:30:21,360 --> 00:30:22,880
and might be interesting for example i

791
00:30:22,880 --> 00:30:25,120
might see parameters or

792
00:30:25,120 --> 00:30:27,360
open ports which are not typical to

793
00:30:27,360 --> 00:30:28,480
windows machine

794
00:30:28,480 --> 00:30:31,440
which this client tries to look like and

795
00:30:31,440 --> 00:30:32,159
i won't be

796
00:30:32,159 --> 00:30:35,120
active in an active way i'll just be

797
00:30:35,120 --> 00:30:37,440
active by proxy showdown will be active

798
00:30:37,440 --> 00:30:40,080
but not me

799
00:30:42,159 --> 00:30:45,210
so so far we've been

800
00:30:45,210 --> 00:30:46,640
[Music]

801
00:30:46,640 --> 00:30:49,679
a bit kind of pessimistic but how we can

802
00:30:49,679 --> 00:30:50,640
get better

803
00:30:50,640 --> 00:30:52,320
we're trying to fix stuff not only to

804
00:30:52,320 --> 00:30:54,799
break stuff right

805
00:30:54,799 --> 00:30:56,399
sadly most of the stuff you've seen here

806
00:30:56,399 --> 00:30:58,880
today will allow you to detect

807
00:30:58,880 --> 00:31:01,919
any tool scanning urls i've reported it

808
00:31:01,919 --> 00:31:02,320
to

809
00:31:02,320 --> 00:31:04,320
so many vendors most of them fixed at

810
00:31:04,320 --> 00:31:06,159
least some of the stuff

811
00:31:06,159 --> 00:31:08,080
one of them actually had some legal

812
00:31:08,080 --> 00:31:09,279
threats against me

813
00:31:09,279 --> 00:31:13,600
which is a funny thing but yeah

814
00:31:13,600 --> 00:31:15,600
but how we can make this stuff better

815
00:31:15,600 --> 00:31:17,600
let's try to be actionable

816
00:31:17,600 --> 00:31:20,320
first learn your fingerprint run my tool

817
00:31:20,320 --> 00:31:21,600
inspect it

818
00:31:21,600 --> 00:31:25,919
and try to understand your fingerprint

819
00:31:25,919 --> 00:31:28,320
or your footprint whether you're a

820
00:31:28,320 --> 00:31:29,919
vendor or a blue team

821
00:31:29,919 --> 00:31:31,440
know your limitations know how you can

822
00:31:31,440 --> 00:31:34,159
be spotted

823
00:31:34,159 --> 00:31:37,519
and more importantly even manage your

824
00:31:37,519 --> 00:31:38,880
kind of footprint by trying to

825
00:31:38,880 --> 00:31:40,799
understand the level of effort for

826
00:31:40,799 --> 00:31:43,200
a red teamer to detect you or for blue

827
00:31:43,200 --> 00:31:44,880
team to fix this issue

828
00:31:44,880 --> 00:31:48,159
for example free fixes

829
00:31:48,159 --> 00:31:50,559
you're a blue team you should never have

830
00:31:50,559 --> 00:31:52,159
a user agent which is

831
00:31:52,159 --> 00:31:54,720
over a couple of months old of the link

832
00:31:54,720 --> 00:31:56,320
scanning components in your

833
00:31:56,320 --> 00:31:58,720
system any of your systems any of your

834
00:31:58,720 --> 00:31:59,440
modules

835
00:31:59,440 --> 00:32:01,360
it should look like a human not like a

836
00:32:01,360 --> 00:32:03,200
security product i think it is

837
00:32:03,200 --> 00:32:06,720
given but as it turns out it is not

838
00:32:06,720 --> 00:32:08,559
on the other hand some stuff are more

839
00:32:08,559 --> 00:32:10,320
expensive like

840
00:32:10,320 --> 00:32:12,480
going through proxies all day long so

841
00:32:12,480 --> 00:32:14,320
yeah i kind of it kind of sucks that

842
00:32:14,320 --> 00:32:16,240
microsoft scans you from their own ip

843
00:32:16,240 --> 00:32:16,960
range

844
00:32:16,960 --> 00:32:19,279
but is it actually feasible from the

845
00:32:19,279 --> 00:32:20,880
financial point of your technical point

846
00:32:20,880 --> 00:32:21,519
of view

847
00:32:21,519 --> 00:32:23,760
to exit from residential proxies all day

848
00:32:23,760 --> 00:32:24,640
long

849
00:32:24,640 --> 00:32:27,600
they need a data plan maybe which is

850
00:32:27,600 --> 00:32:28,320
huge

851
00:32:28,320 --> 00:32:30,720
and they might be forced into reusing

852
00:32:30,720 --> 00:32:31,840
proxies which is

853
00:32:31,840 --> 00:32:34,000
very interesting maybe it can lead to

854
00:32:34,000 --> 00:32:35,919
them being detected

855
00:32:35,919 --> 00:32:39,200
so it is not that easy to

856
00:32:39,200 --> 00:32:43,600
exit from different proxies

857
00:32:43,600 --> 00:32:46,000
and also there's this area of bad

858
00:32:46,000 --> 00:32:47,039
practices

859
00:32:47,039 --> 00:32:48,720
you should never disclose the internal

860
00:32:48,720 --> 00:32:50,159
structure of your lab

861
00:32:50,159 --> 00:32:53,200
by misconfiguring headers

862
00:32:53,200 --> 00:32:55,440
inspect if you've even like inspected

863
00:32:55,440 --> 00:32:58,080
the outgoing http request once

864
00:32:58,080 --> 00:33:01,519
this would never have happened

865
00:33:01,519 --> 00:33:03,120
just like you know your tools manager

866
00:33:03,120 --> 00:33:06,000
stuff it makes no sense

867
00:33:06,000 --> 00:33:08,720
to just like you know forget about it

868
00:33:08,720 --> 00:33:10,559
and yeah let's have a ptr record

869
00:33:10,559 --> 00:33:13,600
which associates our link scanner

870
00:33:13,600 --> 00:33:16,240
ip with the home page of the company

871
00:33:16,240 --> 00:33:16,880
which was

872
00:33:16,880 --> 00:33:19,200
in some cases the the homepage was so

873
00:33:19,200 --> 00:33:20,000
obsolete

874
00:33:20,000 --> 00:33:22,240
that it never existed like for the last

875
00:33:22,240 --> 00:33:23,200
five years

876
00:33:23,200 --> 00:33:26,559
i was able to find a wayback machine but

877
00:33:26,559 --> 00:33:28,080
it was so absolutely that there was no

878
00:33:28,080 --> 00:33:29,840
homepage it referred to

879
00:33:29,840 --> 00:33:31,760
it was just like a ptr record that they

880
00:33:31,760 --> 00:33:33,200
might have forgot about

881
00:33:33,200 --> 00:33:37,360
years ago that's negligence

882
00:33:37,360 --> 00:33:40,320
on the other hand understand that tcp is

883
00:33:40,320 --> 00:33:41,440
is a challenge

884
00:33:41,440 --> 00:33:44,720
and not everyone knows how to operate

885
00:33:44,720 --> 00:33:46,480
pof and to do all this correlation

886
00:33:46,480 --> 00:33:48,480
shenanigans um

887
00:33:48,480 --> 00:33:50,000
you've seen phishing kids fishing it's

888
00:33:50,000 --> 00:33:52,159
don't use it they don't need to

889
00:33:52,159 --> 00:33:54,480
but it is also possible that they simply

890
00:33:54,480 --> 00:33:56,640
can't you have script kitty and

891
00:33:56,640 --> 00:33:58,480
knowledgeable people

892
00:33:58,480 --> 00:34:00,720
you're trying to at least be better than

893
00:34:00,720 --> 00:34:01,519
some

894
00:34:01,519 --> 00:34:03,679
so maybe try to balance between the

895
00:34:03,679 --> 00:34:04,640
stuff you can

896
00:34:04,640 --> 00:34:07,840
and should fix like user agents for

897
00:34:07,840 --> 00:34:08,560
example

898
00:34:08,560 --> 00:34:09,839
and other stuff which are much more

899
00:34:09,839 --> 00:34:11,679
tricky

900
00:34:11,679 --> 00:34:15,440
to conclude and this is a picture of my

901
00:34:15,440 --> 00:34:16,320
cat again

902
00:34:16,320 --> 00:34:17,839
just to grab your attention in case you

903
00:34:17,839 --> 00:34:20,639
fell asleep we know fingerprints are

904
00:34:20,639 --> 00:34:22,480
we know what web fingerprints are we

905
00:34:22,480 --> 00:34:23,839
know what link scanners are

906
00:34:23,839 --> 00:34:26,879
we know how we can evade them now

907
00:34:26,879 --> 00:34:30,719
we also know how you can face palm when

908
00:34:30,719 --> 00:34:32,719
you see all the different fails

909
00:34:32,719 --> 00:34:35,839
of vendors and

910
00:34:35,839 --> 00:34:37,520
we've seen some potential stuff for the

911
00:34:37,520 --> 00:34:39,280
next big thing in this area

912
00:34:39,280 --> 00:34:43,280
and also we try to fix some stuff

913
00:34:43,359 --> 00:34:45,599
and i don't think we have time for

914
00:34:45,599 --> 00:34:46,839
questions or do we have

915
00:34:46,839 --> 00:34:50,000
or i don't know no

916
00:34:50,000 --> 00:34:53,760
yes no okay no

