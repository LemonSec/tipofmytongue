1
00:00:00,290 --> 00:00:03,220
[Music]

2
00:00:03,220 --> 00:00:03,740
[Applause]

3
00:00:03,740 --> 00:00:09,880
[Music]

4
00:00:09,880 --> 00:00:11,679
[Applause]

5
00:00:11,679 --> 00:00:14,719
okay so uh thank you all for choosing

6
00:00:14,719 --> 00:00:17,919
the spend sorry

7
00:00:20,080 --> 00:00:21,359
sorry

8
00:00:21,359 --> 00:00:22,960
thank you all for choosing to spend the

9
00:00:22,960 --> 00:00:24,960
next 10 minutes with me my name is

10
00:00:24,960 --> 00:00:28,240
ronnie my day job is not in cyber i'm a

11
00:00:28,240 --> 00:00:30,960
faculty member here uh but today i'd

12
00:00:30,960 --> 00:00:32,558
like to share with you some of the fun

13
00:00:32,558 --> 00:00:35,040
that i had a few years ago with a

14
00:00:35,040 --> 00:00:36,960
homemade cipher

15
00:00:36,960 --> 00:00:39,280
so my talk is going to be on the lighter

16
00:00:39,280 --> 00:00:40,719
side we've seen

17
00:00:40,719 --> 00:00:43,360
we've heard the guys from cyber reason

18
00:00:43,360 --> 00:00:44,960
dealing with a very sophisticated

19
00:00:44,960 --> 00:00:48,760
attacker and shira also described a very

20
00:00:48,760 --> 00:00:51,920
sophisticated attack by nso

21
00:00:51,920 --> 00:00:54,079
i'm going to deal with a less

22
00:00:54,079 --> 00:00:56,960
sophisticated defender

23
00:00:56,960 --> 00:01:00,239
and and we're going to talk about

24
00:01:00,239 --> 00:01:02,879
going to talk about uh streaming apps so

25
00:01:02,879 --> 00:01:04,159
who here

26
00:01:04,159 --> 00:01:07,439
uh uses this music streaming app to to

27
00:01:07,439 --> 00:01:08,400
hear

28
00:01:08,400 --> 00:01:10,960
which one

29
00:01:10,960 --> 00:01:13,360
okay so yes spotify

30
00:01:13,360 --> 00:01:15,920
and uh there are a few more so

31
00:01:15,920 --> 00:01:18,320
they here are the six most popular

32
00:01:18,320 --> 00:01:20,640
streaming apps in israel

33
00:01:20,640 --> 00:01:23,040
but how many of these were available

34
00:01:23,040 --> 00:01:27,840
here uh say 10 years ago

35
00:01:28,799 --> 00:01:31,119
that's right none

36
00:01:31,119 --> 00:01:33,119
wait a minute what do you mean not

37
00:01:33,119 --> 00:01:35,119
available here

38
00:01:35,119 --> 00:01:38,159
we all know how to bypass geographical

39
00:01:38,159 --> 00:01:41,600
limits that's we have vpns and whatnot

40
00:01:41,600 --> 00:01:43,920
but again you and i are not the average

41
00:01:43,920 --> 00:01:45,840
joe or jane so

42
00:01:45,840 --> 00:01:50,399
officially there was no options

43
00:01:51,600 --> 00:01:55,439
okay so time for a quick history lesson

44
00:01:55,439 --> 00:01:58,240
about the history of streaming

45
00:01:58,240 --> 00:02:01,840
so uh wait no sorry karen this is way

46
00:02:01,840 --> 00:02:03,040
too

47
00:02:03,040 --> 00:02:05,600
early we said 10 years ago not 50 years

48
00:02:05,600 --> 00:02:07,360
ago

49
00:02:07,360 --> 00:02:09,199
and what was all this fm we said

50
00:02:09,199 --> 00:02:12,560
streaming apps so

51
00:02:12,560 --> 00:02:13,680
the first

52
00:02:13,680 --> 00:02:15,920
music streaming apps in israel were

53
00:02:15,920 --> 00:02:18,480
launched by mobile carriers

54
00:02:18,480 --> 00:02:20,640
so uh these companies

55
00:02:20,640 --> 00:02:24,239
they often try to provide added value

56
00:02:24,239 --> 00:02:26,560
for their stockholders or for their

57
00:02:26,560 --> 00:02:27,840
customers

58
00:02:27,840 --> 00:02:30,480
and it made little sense to continue

59
00:02:30,480 --> 00:02:31,840
offering

60
00:02:31,840 --> 00:02:34,720
uh ringtones for uh

61
00:02:34,720 --> 00:02:35,519
for

62
00:02:35,519 --> 00:02:38,160
for sale once people discovered the

63
00:02:38,160 --> 00:02:40,000
internet

64
00:02:40,000 --> 00:02:43,120
so first was telephone later came celcom

65
00:02:43,120 --> 00:02:44,400
and partner

66
00:02:44,400 --> 00:02:46,480
and they all had basically the same

67
00:02:46,480 --> 00:02:47,840
business model

68
00:02:47,840 --> 00:02:49,840
now you pay 10 to

69
00:02:49,840 --> 00:02:53,280
20 shekels a month for unlimited access

70
00:02:53,280 --> 00:02:55,599
now the main selling point of these

71
00:02:55,599 --> 00:02:56,959
services

72
00:02:56,959 --> 00:02:59,840
was that streamed music did not was not

73
00:02:59,840 --> 00:03:02,959
counted towards your data plan which was

74
00:03:02,959 --> 00:03:06,400
uh used to be very tiny back then

75
00:03:06,400 --> 00:03:08,800
i2 had a subscription to one of this

76
00:03:08,800 --> 00:03:10,159
service

77
00:03:10,159 --> 00:03:11,200
um

78
00:03:11,200 --> 00:03:14,879
don't worry i got it for free

79
00:03:14,879 --> 00:03:18,640
but then came big data plans and big

80
00:03:18,640 --> 00:03:21,760
global players from two slides ago and

81
00:03:21,760 --> 00:03:25,200
we all know how this ended

82
00:03:26,159 --> 00:03:29,200
so on a side note i hear israel is quite

83
00:03:29,200 --> 00:03:31,920
big with technology would you consider

84
00:03:31,920 --> 00:03:36,480
israel a music streaming state actor

85
00:03:36,480 --> 00:03:39,119
what do you say

86
00:03:40,959 --> 00:03:44,760
yes so actually

87
00:03:46,400 --> 00:03:48,640
that's a real thing

88
00:03:48,640 --> 00:03:51,920
but really we all know the mantra there

89
00:03:51,920 --> 00:03:56,400
ain't no such thing as a free lunch well

90
00:03:56,400 --> 00:03:58,959
we all had a free lunch right so the

91
00:03:58,959 --> 00:04:01,360
exception to this is when vcs are

92
00:04:01,360 --> 00:04:03,760
involved or in syria's case the

93
00:04:03,760 --> 00:04:05,519
government

94
00:04:05,519 --> 00:04:07,599
so in this case there were only two

95
00:04:07,599 --> 00:04:10,640
catches one is that this was

96
00:04:10,640 --> 00:04:12,480
all songs were in hebrew

97
00:04:12,480 --> 00:04:16,000
and the second catch uh it's dead jim

98
00:04:16,000 --> 00:04:18,238
anyway we digress back to our streaming

99
00:04:18,238 --> 00:04:20,478
app

100
00:04:20,720 --> 00:04:21,519
so

101
00:04:21,519 --> 00:04:24,160
offline music that means it's not just

102
00:04:24,160 --> 00:04:26,400
pure streaming

103
00:04:26,400 --> 00:04:29,040
why can't we just download the the

104
00:04:29,040 --> 00:04:32,080
entire catalog

105
00:04:32,080 --> 00:04:34,000
oh dr m

106
00:04:34,000 --> 00:04:37,280
let me point out that bypassing drm per

107
00:04:37,280 --> 00:04:40,639
se is legal in israel or at least that's

108
00:04:40,639 --> 00:04:42,240
what my

109
00:04:42,240 --> 00:04:45,280
non-lawyer friend told me oh was that my

110
00:04:45,280 --> 00:04:47,040
non-friend lawyer

111
00:04:47,040 --> 00:04:49,120
never mind

112
00:04:49,120 --> 00:04:51,600
let's just have a quick look at what we

113
00:04:51,600 --> 00:04:52,639
have

114
00:04:52,639 --> 00:04:55,840
so here's an sqlite database

115
00:04:55,840 --> 00:04:58,639
with metadata about the songs and here's

116
00:04:58,639 --> 00:05:00,880
a bunch of high entropy

117
00:05:00,880 --> 00:05:03,759
files each approximately four megabytes

118
00:05:03,759 --> 00:05:04,800
in size

119
00:05:04,800 --> 00:05:09,520
and bearing the em3 file extension

120
00:05:09,520 --> 00:05:11,360
what could that be

121
00:05:11,360 --> 00:05:13,120
naturally these files were not on the

122
00:05:13,120 --> 00:05:15,919
user accessible part of the sd card but

123
00:05:15,919 --> 00:05:19,359
what's user accessible

124
00:05:20,000 --> 00:05:22,479
so we have the apk

125
00:05:22,479 --> 00:05:24,880
should we just pull out the binary and

126
00:05:24,880 --> 00:05:27,440
reverse engineer the algorithm

127
00:05:27,440 --> 00:05:31,520
let's ask for an expert opinion

128
00:05:31,520 --> 00:05:34,320
actually why even bother with assembly

129
00:05:34,320 --> 00:05:35,360
code

130
00:05:35,360 --> 00:05:38,560
when we have the java decompiler right

131
00:05:38,560 --> 00:05:40,560
so we should pull out

132
00:05:40,560 --> 00:05:43,280
wait what

133
00:05:43,840 --> 00:05:44,919
have i

134
00:05:44,919 --> 00:05:47,039
absent-mindedly signed away my basic

135
00:05:47,039 --> 00:05:50,240
human right to reverse engineer

136
00:05:50,240 --> 00:05:51,199
oh well

137
00:05:51,199 --> 00:05:54,160
i'll guess we have to go out go get it

138
00:05:54,160 --> 00:05:55,680
without the

139
00:05:55,680 --> 00:05:57,440
source

140
00:05:57,440 --> 00:05:59,759
so high entropy

141
00:05:59,759 --> 00:06:02,560
cipher text is no surprise

142
00:06:02,560 --> 00:06:03,680
but this

143
00:06:03,680 --> 00:06:06,000
is the entropy of the supposed plain

144
00:06:06,000 --> 00:06:07,039
text

145
00:06:07,039 --> 00:06:09,280
so we don't have a lot to work with

146
00:06:09,280 --> 00:06:11,039
anyway let's just have a look at the

147
00:06:11,039 --> 00:06:13,360
data

148
00:06:14,000 --> 00:06:15,600
at the first glass

149
00:06:15,600 --> 00:06:18,479
this doesn't look too promising

150
00:06:18,479 --> 00:06:20,800
but after comparing with a few more

151
00:06:20,800 --> 00:06:23,680
ciphertexts this is quite revealing

152
00:06:23,680 --> 00:06:26,880
and here's a plausible explanation

153
00:06:26,880 --> 00:06:29,520
it seems all files start with the common

154
00:06:29,520 --> 00:06:31,520
id3 tag

155
00:06:31,520 --> 00:06:33,039
moreover

156
00:06:33,039 --> 00:06:35,280
everything is encrypted with the very

157
00:06:35,280 --> 00:06:36,720
same key

158
00:06:36,720 --> 00:06:40,560
and this makes a really good point

159
00:06:40,560 --> 00:06:43,360
maybe i should start a campaign

160
00:06:43,360 --> 00:06:45,759
reduce your entropy footprint

161
00:06:45,759 --> 00:06:49,360
let your drm vendor know that you care

162
00:06:49,360 --> 00:06:50,639
but really

163
00:06:50,639 --> 00:06:53,919
let's just say that we somehow managed

164
00:06:53,919 --> 00:06:55,680
to acquire

165
00:06:55,680 --> 00:06:59,840
one matching plain text to a cipher text

166
00:06:59,840 --> 00:07:02,160
assuming that key is really

167
00:07:02,160 --> 00:07:04,560
used over again it means we can just

168
00:07:04,560 --> 00:07:06,960
extract the key and use it to decrypt

169
00:07:06,960 --> 00:07:08,479
all other files

170
00:07:08,479 --> 00:07:10,720
we just need to figure out what exactly

171
00:07:10,720 --> 00:07:13,759
plus means in this context whether it's

172
00:07:13,759 --> 00:07:17,199
xor or byte edition or word edition or

173
00:07:17,199 --> 00:07:19,680
whatnot

174
00:07:19,759 --> 00:07:22,000
and this doesn't work

175
00:07:22,000 --> 00:07:24,960
uh these were a frighten a frustrating

176
00:07:24,960 --> 00:07:26,639
couple of hours

177
00:07:26,639 --> 00:07:29,840
so let's take a step back and

178
00:07:29,840 --> 00:07:33,840
take a second look at what we have

179
00:07:34,240 --> 00:07:37,280
based on the id3 tag header

180
00:07:37,280 --> 00:07:40,160
we have nine known bytes

181
00:07:40,160 --> 00:07:43,440
five of which are supposedly zeros

182
00:07:43,440 --> 00:07:45,039
and indeed if you look at the cipher

183
00:07:45,039 --> 00:07:49,280
around these bytes it seems a bit weird

184
00:07:49,280 --> 00:07:51,360
and also there's something wrong with

185
00:07:51,360 --> 00:07:53,759
the byte alignment since we don't expect

186
00:07:53,759 --> 00:07:55,440
the 10th

187
00:07:55,440 --> 00:07:58,479
the length field the one in purple to be

188
00:07:58,479 --> 00:08:00,720
all zeros

189
00:08:00,720 --> 00:08:03,120
you could uh have uh more interesting

190
00:08:03,120 --> 00:08:05,280
phenomena here if you look at the most

191
00:08:05,280 --> 00:08:08,080
significant bit of each byte then it

192
00:08:08,080 --> 00:08:09,840
starts as zero

193
00:08:09,840 --> 00:08:12,319
for something like two lines and then

194
00:08:12,319 --> 00:08:14,479
switches to one so

195
00:08:14,479 --> 00:08:16,240
i'm sure i've seen this kind of

196
00:08:16,240 --> 00:08:20,000
behaviors somewhere before

197
00:08:20,720 --> 00:08:25,440
so pardon my french but uh who are you

198
00:08:25,440 --> 00:08:27,840
this necklace gentleman is blaze the

199
00:08:27,840 --> 00:08:29,840
visionaire inventor of the autokey

200
00:08:29,840 --> 00:08:31,120
cipher

201
00:08:31,120 --> 00:08:33,360
a funny story visioner his name is

202
00:08:33,360 --> 00:08:36,320
mostly associated with an earlier

203
00:08:36,320 --> 00:08:38,719
much weaker cipher

204
00:08:38,719 --> 00:08:41,599
invented by someone else

205
00:08:41,599 --> 00:08:45,360
so what is this auto key cipher

206
00:08:45,360 --> 00:08:48,399
autokey means we're using the previous

207
00:08:48,399 --> 00:08:51,279
psychic test characters as part of the

208
00:08:51,279 --> 00:08:53,040
encryption process

209
00:08:53,040 --> 00:08:55,680
so kind of like cbc mode

210
00:08:55,680 --> 00:08:59,120
but there's no block cipher involved

211
00:08:59,120 --> 00:09:01,600
i suspect this is because ciphertext

212
00:09:01,600 --> 00:09:03,839
because block ciphers did not exist in

213
00:09:03,839 --> 00:09:06,000
the 16th century

214
00:09:06,000 --> 00:09:08,560
instead the round operation is simply

215
00:09:08,560 --> 00:09:11,519
addition or xor of the key

216
00:09:11,519 --> 00:09:13,760
with uh the block

217
00:09:13,760 --> 00:09:16,800
so in order to decrypt a plaintext block

218
00:09:16,800 --> 00:09:19,200
we just need two consecutive cipher

219
00:09:19,200 --> 00:09:21,920
blocks and the key block and obviously

220
00:09:21,920 --> 00:09:23,680
for the first one you have a special

221
00:09:23,680 --> 00:09:26,240
case you need something else

222
00:09:26,240 --> 00:09:28,399
our streaming app

223
00:09:28,399 --> 00:09:32,560
uses 16 bit blocks so that is exactly

224
00:09:32,560 --> 00:09:33,839
two bytes

225
00:09:33,839 --> 00:09:37,600
not too sophisticated and as you can see

226
00:09:37,600 --> 00:09:38,720
this

227
00:09:38,720 --> 00:09:40,720
is trivial to implement

228
00:09:40,720 --> 00:09:42,720
and the whole secret is basically four

229
00:09:42,720 --> 00:09:46,399
bytes two for the key and two for the iv

230
00:09:46,399 --> 00:09:48,880
all of which happen to be uh decimal

231
00:09:48,880 --> 00:09:51,600
digits so two one one eight i don't know

232
00:09:51,600 --> 00:09:53,920
if this has any meaning but

233
00:09:53,920 --> 00:09:55,519
maybe

234
00:09:55,519 --> 00:09:57,920
right so we have our code and we can run

235
00:09:57,920 --> 00:10:00,560
decrypt our encrypted music file

236
00:10:00,560 --> 00:10:01,920
and uh

237
00:10:01,920 --> 00:10:03,519
play it

238
00:10:03,519 --> 00:10:05,120
uh

239
00:10:05,120 --> 00:10:06,160
do you

240
00:10:06,160 --> 00:10:10,240
have an appetite for destruction

241
00:10:15,760 --> 00:10:16,959
yes

242
00:10:16,959 --> 00:10:18,880
so ladies and gentlemen thank you all

243
00:10:18,880 --> 00:10:20,000
for coming

244
00:10:20,000 --> 00:10:22,320
i'll be around if you want to chat

245
00:10:22,320 --> 00:10:24,200
thanks

246
00:10:24,200 --> 00:10:28,670
[Music]

247
00:10:28,670 --> 00:10:31,860
[Applause]

248
00:10:32,880 --> 00:10:34,959
you

