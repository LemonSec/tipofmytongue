1
00:00:00,000 --> 00:00:01,740
a lot of times being on the defensive

2
00:00:01,740 --> 00:00:03,600
side costs you a lot of money and

3
00:00:03,600 --> 00:00:05,279
actually it turns out that there's a lot

4
00:00:05,279 --> 00:00:07,890
that you can do using open source stuff

5
00:00:07,890 --> 00:00:09,870
not everything has to be super expensive

6
00:00:09,870 --> 00:00:11,849
and this is what the alone will be

7
00:00:11,849 --> 00:00:13,650
telling us about so you're on

8
00:00:13,650 --> 00:00:16,590
all right thank you very much I'm very

9
00:00:16,590 --> 00:00:18,390
excited to be here this is the second

10
00:00:18,390 --> 00:00:20,430
time I've been here besides on stage

11
00:00:20,430 --> 00:00:22,970
presenting and welcome to my talk

12
00:00:22,970 --> 00:00:25,289
low-hanging blue fruit hacking and

13
00:00:25,289 --> 00:00:27,150
defending yourself using open source

14
00:00:27,150 --> 00:00:30,869
tools now I always forget to introduce

15
00:00:30,869 --> 00:00:33,690
myself so luckily PowerShell allows us

16
00:00:33,690 --> 00:00:36,059
to invoke credentials here are mine my

17
00:00:36,059 --> 00:00:38,579
name is Yvonne King I have two degrees

18
00:00:38,579 --> 00:00:40,320
in computer science and for over a

19
00:00:40,320 --> 00:00:43,649
decade now I have been defender at the

20
00:00:43,649 --> 00:00:48,180
Central Bank of Israel and also as of

21
00:00:48,180 --> 00:00:50,070
last year have an honorable mention that

22
00:00:50,070 --> 00:00:52,289
the sands holiday hacks test challenge

23
00:00:52,289 --> 00:00:55,460
CTF which I was very proud to get and

24
00:00:55,460 --> 00:00:57,750
you can also find me on twitter at

25
00:00:57,750 --> 00:01:02,059
samurai now as the question for you all

26
00:01:02,059 --> 00:01:04,309
which one of you here in the audience

27
00:01:04,309 --> 00:01:06,840
considers themselves hackers raise your

28
00:01:06,840 --> 00:01:12,560
hand come on

29
00:01:12,560 --> 00:01:16,380
ok sure most of you do not consider

30
00:01:16,380 --> 00:01:20,060
yourselves hackers remember that answer

31
00:01:20,060 --> 00:01:22,740
no info state conferences they like to

32
00:01:22,740 --> 00:01:26,000
talk about the latest of attacks that

33
00:01:26,000 --> 00:01:30,540
sexy hacking techniques and this talk is

34
00:01:30,540 --> 00:01:33,950
not one of those talks you can go now

35
00:01:33,950 --> 00:01:36,390
what I'm going to talk about is actually

36
00:01:36,390 --> 00:01:39,540
give some tips and tricks about how to

37
00:01:39,540 --> 00:01:41,670
monitor how to catch the low-hanging

38
00:01:41,670 --> 00:01:44,430
fruit they're really silly simple stuff

39
00:01:44,430 --> 00:01:48,149
and you know why because it's still

40
00:01:48,149 --> 00:01:51,479
there and we need to raise the bar for

41
00:01:51,479 --> 00:01:55,829
the attackers but I like to start with a

42
00:01:55,829 --> 00:02:00,420
story in 2016 my boss it got the

43
00:02:00,420 --> 00:02:02,189
authorization the permission the budget

44
00:02:02,189 --> 00:02:06,360
to send me on a pilgrimage no sorry not

45
00:02:06,360 --> 00:02:08,910
not to Mecca but rather the mecca of

46
00:02:08,910 --> 00:02:12,629
hackers sans course at black cats later

47
00:02:12,629 --> 00:02:13,640
on Def Con

48
00:02:13,640 --> 00:02:15,800
it took me about two months of

49
00:02:15,800 --> 00:02:18,050
bureaucracy to get everything sorted out

50
00:02:18,050 --> 00:02:19,940
by the time I was finished with the

51
00:02:19,940 --> 00:02:20,720
bureaucracy

52
00:02:20,720 --> 00:02:24,590
I was I was done by the week before my

53
00:02:24,590 --> 00:02:28,190
flight I suddenly get an email from HR

54
00:02:28,190 --> 00:02:31,400
they said the duty turbulence political

55
00:02:31,400 --> 00:02:34,310
tension the state of Turkey all flights

56
00:02:34,310 --> 00:02:36,560
from the Bank of Israel to Europe and

57
00:02:36,560 --> 00:02:40,310
the US were canceled five minutes later

58
00:02:40,310 --> 00:02:42,230
I get an email from my boss he says did

59
00:02:42,230 --> 00:02:44,270
you see that a letter from HR I said yes

60
00:02:44,270 --> 00:02:46,130
what do you think he said I did all I

61
00:02:46,130 --> 00:02:49,190
missed its to have months of bureaucracy

62
00:02:49,190 --> 00:02:53,450
I think you should talk to HR I said so

63
00:02:53,450 --> 00:02:55,610
I decided to dismiss the elevator and

64
00:02:55,610 --> 00:02:58,370
just run seven flights of steps up to HR

65
00:02:58,370 --> 00:03:00,320
I barred you to the door totally

66
00:03:00,320 --> 00:03:02,540
breathless and the woman there she was

67
00:03:02,540 --> 00:03:04,190
on the phone she gave me a weird look I

68
00:03:04,190 --> 00:03:05,989
tried to explain myself oh he's kind of

69
00:03:05,989 --> 00:03:08,150
hard after around seven flights of steps

70
00:03:08,150 --> 00:03:11,510
and then she's done giggling she gave me

71
00:03:11,510 --> 00:03:13,670
another weird look and she said your

72
00:03:13,670 --> 00:03:17,290
boss is telling you to do silly stuff

73
00:03:17,290 --> 00:03:19,430
it's at that point I realized I was

74
00:03:19,430 --> 00:03:22,549
being punished apparently a team member

75
00:03:22,549 --> 00:03:25,100
by the order of my boss sent a spoofed

76
00:03:25,100 --> 00:03:27,290
email from HR from that person to me

77
00:03:27,290 --> 00:03:31,390
saying that my flight was canceled so

78
00:03:33,370 --> 00:03:36,019
week later I did flight to blackhat I

79
00:03:36,019 --> 00:03:38,269
took a fan's course later on it was a

80
00:03:38,269 --> 00:03:39,890
Def Con I had a blast

81
00:03:39,890 --> 00:03:43,549
but whoever gotten into conversation

82
00:03:43,549 --> 00:03:47,420
with I asked them what I tell them what

83
00:03:47,420 --> 00:03:49,130
my boss did to me and asked for their

84
00:03:49,130 --> 00:03:51,260
advice what would they have done in my

85
00:03:51,260 --> 00:03:55,190
place I even got an answer from Chora

86
00:03:55,190 --> 00:03:57,530
Donna the head technical assistant to

87
00:03:57,530 --> 00:03:59,720
the mr. robot series he told me what he

88
00:03:59,720 --> 00:04:02,540
did to an in consider to work a worker

89
00:04:02,540 --> 00:04:06,410
in a former workplace but none of the

90
00:04:06,410 --> 00:04:09,200
answers were good enough for me I wanted

91
00:04:09,200 --> 00:04:13,519
to go on an entire big fishing targeted

92
00:04:13,519 --> 00:04:15,739
campaign against my boss I love him to

93
00:04:15,739 --> 00:04:18,970
death but he deserved some retaliation

94
00:04:18,970 --> 00:04:21,380
the only problem is I had no idea how to

95
00:04:21,380 --> 00:04:24,400
do it so I started researching

96
00:04:24,400 --> 00:04:26,420
researching SM

97
00:04:26,420 --> 00:04:29,540
P headers house both emails the from the

98
00:04:29,540 --> 00:04:31,310
to the recipient all those different

99
00:04:31,310 --> 00:04:33,200
headers how to spoof an email eventually

100
00:04:33,200 --> 00:04:35,480
I managed to spoof an email from his

101
00:04:35,480 --> 00:04:39,110
boss to myself to my mailbox something

102
00:04:39,110 --> 00:04:41,450
about the latest Gartner convention and

103
00:04:41,450 --> 00:04:45,350
insights from it so that was good but I

104
00:04:45,350 --> 00:04:48,140
needed a weapon I need to weaponize that

105
00:04:48,140 --> 00:04:51,050
email so I decided to go for office

106
00:04:51,050 --> 00:04:52,790
which is one of the best weapons there

107
00:04:52,790 --> 00:04:56,360
are and apparently one of the format's

108
00:04:56,360 --> 00:04:58,160
that you can say the word document is

109
00:04:58,160 --> 00:05:02,960
the 2003 XML format and in it those

110
00:05:02,960 --> 00:05:07,340
macros are saved as a binary blob that's

111
00:05:07,340 --> 00:05:12,920
encoded as base64 the tag the XML tag

112
00:05:12,920 --> 00:05:15,230
for that is called a data doc and soap

113
00:05:15,230 --> 00:05:17,330
and the even the beginning of that

114
00:05:17,330 --> 00:05:20,180
encoded binary blob if you decode the

115
00:05:20,180 --> 00:05:21,710
basics before the beginning it starts

116
00:05:21,710 --> 00:05:22,820
with active mind

117
00:05:22,820 --> 00:05:25,820
so I encoded the malicious macro sent it

118
00:05:25,820 --> 00:05:28,850
to myself but our emailing filtering

119
00:05:28,850 --> 00:05:30,050
system blocked it

120
00:05:30,050 --> 00:05:34,220
I was stuck then awhile later for some

121
00:05:34,220 --> 00:05:36,590
reason God knows why I decided to look

122
00:05:36,590 --> 00:05:39,950
at that binary code at that base64

123
00:05:39,950 --> 00:05:42,500
encoded string and re-encoded a second

124
00:05:42,500 --> 00:05:47,300
time and sent it first of all the macro

125
00:05:47,300 --> 00:05:50,240
worked the document opened and second of

126
00:05:50,240 --> 00:05:52,490
all when I sent it to myself it bypassed

127
00:05:52,490 --> 00:05:55,160
the filtering system so apparently the

128
00:05:55,160 --> 00:05:56,540
filtering system was looking for the

129
00:05:56,540 --> 00:05:59,450
regular base 64 encoded decodes to

130
00:05:59,450 --> 00:06:03,110
active mine but now it was looking at a

131
00:06:03,110 --> 00:06:05,030
different string and didn't recognize it

132
00:06:05,030 --> 00:06:07,130
I haven't tried the same trick a few

133
00:06:07,130 --> 00:06:09,170
days ago just to upload something to

134
00:06:09,170 --> 00:06:12,430
virustotal I created a VBA reverse shell

135
00:06:12,430 --> 00:06:16,220
meterpreter the basic of basics and did

136
00:06:16,220 --> 00:06:18,500
this thing and the count dropped from

137
00:06:18,500 --> 00:06:22,520
like 50 to less than 14 different

138
00:06:22,520 --> 00:06:24,290
engines that actually recognize it this

139
00:06:24,290 --> 00:06:27,350
simple chair next thing I had to bypass

140
00:06:27,350 --> 00:06:30,650
the email sandbox but by passing a

141
00:06:30,650 --> 00:06:33,200
sandbox is not too hard if you realize

142
00:06:33,200 --> 00:06:35,540
what its weaknesses and that is human

143
00:06:35,540 --> 00:06:37,700
interaction so instead of the regular

144
00:06:37,700 --> 00:06:39,410
otta open

145
00:06:39,410 --> 00:06:41,960
macro which runs just when you open the

146
00:06:41,960 --> 00:06:43,910
document I change it to a different

147
00:06:43,910 --> 00:06:46,160
macro which runs when you scroll down to

148
00:06:46,160 --> 00:06:48,290
the next page which I was sure that my

149
00:06:48,290 --> 00:06:52,550
boss would do so I managed to get

150
00:06:52,550 --> 00:06:56,870
everything to my mailbox oh yes

151
00:06:56,870 --> 00:06:59,900
everything was set to go so it was the

152
00:06:59,900 --> 00:07:02,420
first day afternoon I sent the email to

153
00:07:02,420 --> 00:07:03,590
my boss and it was waiting for a

154
00:07:03,590 --> 00:07:05,810
reaction when he comes to my office he

155
00:07:05,810 --> 00:07:08,060
said listen this is Thursday afternoon

156
00:07:08,060 --> 00:07:10,190
nothing good will come out of this go

157
00:07:10,190 --> 00:07:13,480
home now I know I am because in Israel

158
00:07:13,480 --> 00:07:16,640
we walk we work Sunday to Thursday

159
00:07:16,640 --> 00:07:19,820
Friday and Sunday is the weekend and he

160
00:07:19,820 --> 00:07:22,100
was about to go home but as he was

161
00:07:22,100 --> 00:07:24,230
trying to close his computer he saw an

162
00:07:24,230 --> 00:07:27,110
email from his boss something about the

163
00:07:27,110 --> 00:07:29,180
latest Gartner conventions and insights

164
00:07:29,180 --> 00:07:31,370
from it and my boss oh he dislikes

165
00:07:31,370 --> 00:07:34,310
Gartner so he had to open that email and

166
00:07:34,310 --> 00:07:36,800
see what his boss wanted and it was a

167
00:07:36,800 --> 00:07:40,100
office document so he looked at it even

168
00:07:40,100 --> 00:07:42,740
and they moved content because some of

169
00:07:42,740 --> 00:07:44,990
the graphs there weren't drawn visually

170
00:07:44,990 --> 00:07:48,050
well enough and of course the document

171
00:07:48,050 --> 00:07:50,240
was boring just regular stuff you'd find

172
00:07:50,240 --> 00:07:52,040
on Gartner and not no insights

173
00:07:52,040 --> 00:07:55,000
whatsoever so we close the document and

174
00:07:55,000 --> 00:08:00,170
then he saw this on his desktop and a

175
00:08:00,170 --> 00:08:02,810
few seconds later all the documents and

176
00:08:02,810 --> 00:08:04,850
pictures he had on his desktop changed

177
00:08:04,850 --> 00:08:09,410
the dot script my boss's heart missed a

178
00:08:09,410 --> 00:08:12,860
few beats that MANET he called me up on

179
00:08:12,860 --> 00:08:15,920
my extension says okay listen are you in

180
00:08:15,920 --> 00:08:16,460
the office

181
00:08:16,460 --> 00:08:17,960
I said yes you're calling me in my

182
00:08:17,960 --> 00:08:21,260
extension can you come to my room please

183
00:08:21,260 --> 00:08:23,920
so I walk in in a straight poker face

184
00:08:23,920 --> 00:08:26,720
yes what's going on and yank his chain

185
00:08:26,720 --> 00:08:29,330
for a few minutes before divulging that

186
00:08:29,330 --> 00:08:31,820
it was all me and he didn't just unleash

187
00:08:31,820 --> 00:08:33,770
ransom rare before the weekend on the

188
00:08:33,770 --> 00:08:37,460
entire organization but that got me

189
00:08:37,460 --> 00:08:41,360
thinking about how I myself can possibly

190
00:08:41,360 --> 00:08:43,909
try and hack my organization to make it

191
00:08:43,909 --> 00:08:45,950
better to go to the next stage of

192
00:08:45,950 --> 00:08:49,339
defending it so here are a few tips and

193
00:08:49,339 --> 00:08:50,930
tricks I found along the way the first

194
00:08:50,930 --> 00:08:53,030
one is overriding edr products

195
00:08:53,030 --> 00:08:56,540
now who's everyone's favorite cats some

196
00:08:56,540 --> 00:08:59,120
would say that's dude others would say

197
00:08:59,120 --> 00:09:02,840
this guy but this is a security

198
00:09:02,840 --> 00:09:04,070
conference so we're probably all

199
00:09:04,070 --> 00:09:06,280
thinking the same thing right

200
00:09:06,280 --> 00:09:09,440
Benjamin del Pease famous mini cats tool

201
00:09:09,440 --> 00:09:11,690
that allows us to dump user credentials

202
00:09:11,690 --> 00:09:13,580
for memories well I was messing around

203
00:09:13,580 --> 00:09:15,440
mini cats and I kept getting caught by

204
00:09:15,440 --> 00:09:18,920
the AV so tried various variants I found

205
00:09:18,920 --> 00:09:22,790
let's call it a variant cheeky mutts so

206
00:09:22,790 --> 00:09:24,320
I was messing around with a Kiki Mott

207
00:09:24,320 --> 00:09:26,930
sample and I kept getting caught by the

208
00:09:26,930 --> 00:09:32,270
EDR product but I wanted to bypass the

209
00:09:32,270 --> 00:09:35,350
EDR product the parolee problem is

210
00:09:35,350 --> 00:09:38,360
damage em on a blue team are not a pen

211
00:09:38,360 --> 00:09:40,490
tester I don't know how to invade such

212
00:09:40,490 --> 00:09:43,240
products but I had a sneaking suspicion

213
00:09:43,240 --> 00:09:45,200
certain files were looked upon more

214
00:09:45,200 --> 00:09:47,660
favorably than others whitelist advice

215
00:09:47,660 --> 00:09:50,210
let's say files with certificates from

216
00:09:50,210 --> 00:09:52,820
known vendors so enter our tool of

217
00:09:52,820 --> 00:09:55,430
choice sick thief six leaves is a Python

218
00:09:55,430 --> 00:09:57,920
script that takes file with a

219
00:09:57,920 --> 00:09:59,750
certificate in it and just rips the

220
00:09:59,750 --> 00:10:02,120
certificate apart and embeds it into a

221
00:10:02,120 --> 00:10:04,790
different file so I took my key key much

222
00:10:04,790 --> 00:10:06,830
sample and I took process Explorer from

223
00:10:06,830 --> 00:10:07,610
sysinternals

224
00:10:07,610 --> 00:10:09,680
which has a Microsoft certificate and I

225
00:10:09,680 --> 00:10:12,080
just got an Thoth signed kiki Mott

226
00:10:12,080 --> 00:10:15,290
sample I'm sure what you're thinking

227
00:10:15,290 --> 00:10:17,510
right now and you're right this

228
00:10:17,510 --> 00:10:20,300
certificate is totally invalid it has

229
00:10:20,300 --> 00:10:21,740
nothing to do with the file it's

230
00:10:21,740 --> 00:10:24,830
embedded in it's just there but guess

231
00:10:24,830 --> 00:10:27,340
what when I tried that trick it

232
00:10:27,340 --> 00:10:29,810
completely bypassed the EDR product and

233
00:10:29,810 --> 00:10:31,280
I was early and I was allowed to run me

234
00:10:31,280 --> 00:10:34,310
me cats so I told that to the EDR

235
00:10:34,310 --> 00:10:36,830
company they were surprised they asked

236
00:10:36,830 --> 00:10:39,530
for my toad sign Kiki Mott sample I gave

237
00:10:39,530 --> 00:10:41,480
it to them and two weeks later I got an

238
00:10:41,480 --> 00:10:43,850
updated version of the product and now

239
00:10:43,850 --> 00:10:46,880
the same trick doesn't work anymore so I

240
00:10:46,880 --> 00:10:48,410
have just raised the bar for the

241
00:10:48,410 --> 00:10:52,130
attackers this next section I like to

242
00:10:52,130 --> 00:10:54,530
call them piss exact in my pool

243
00:10:54,530 --> 00:10:57,710
everybody's familiar with PS x''k it's a

244
00:10:57,710 --> 00:11:00,620
tool that's used by sister demons and

245
00:11:00,620 --> 00:11:02,660
attackers alike who like to live off the

246
00:11:02,660 --> 00:11:06,610
land it allows us to do remote commands

247
00:11:06,610 --> 00:11:09,430
remote host and it does it by sending a

248
00:11:09,430 --> 00:11:12,070
file to the remote admin share which is

249
00:11:12,070 --> 00:11:14,980
C Windows and also it creates a service

250
00:11:14,980 --> 00:11:17,500
with the same name and then through RPC

251
00:11:17,500 --> 00:11:20,170
named pipes you can send it commands to

252
00:11:20,170 --> 00:11:22,839
the remote host and also get the output

253
00:11:22,839 --> 00:11:26,709
from those commands so that's on the red

254
00:11:26,709 --> 00:11:27,279
side

255
00:11:27,279 --> 00:11:30,730
but how can you monitor the use of PS X

256
00:11:30,730 --> 00:11:32,829
like a new organization because it's OK

257
00:11:32,829 --> 00:11:34,600
for me the SIS admins and is using it

258
00:11:34,600 --> 00:11:37,560
possibly but if a secretary in HR is

259
00:11:37,560 --> 00:11:39,870
something's fishy here

260
00:11:39,870 --> 00:11:42,880
it's not too hard because you can look

261
00:11:42,880 --> 00:11:44,740
at the system event log and windows

262
00:11:44,740 --> 00:11:47,950
which is 70 45 a service was installed

263
00:11:47,950 --> 00:11:52,360
on the system now an attacker can change

264
00:11:52,360 --> 00:11:55,180
the name of the file he also can change

265
00:11:55,180 --> 00:11:57,160
the name of the service that is being

266
00:11:57,160 --> 00:11:58,720
run but are two things that he probably

267
00:11:58,720 --> 00:12:02,079
can't change using PSX echo the fact

268
00:12:02,079 --> 00:12:05,589
that a file will be created in the admin

269
00:12:05,589 --> 00:12:08,110
route in C windows and the fact that

270
00:12:08,110 --> 00:12:10,420
it's going to be a service as well so

271
00:12:10,420 --> 00:12:13,329
even if I have a totes legit pea SEC SEC

272
00:12:13,329 --> 00:12:15,699
I can still find it and according to my

273
00:12:15,699 --> 00:12:17,350
personal small experience

274
00:12:17,350 --> 00:12:20,050
not too many services are run from the C

275
00:12:20,050 --> 00:12:23,019
windows folder so once you clear out

276
00:12:23,019 --> 00:12:25,089
some regular organizational noise you

277
00:12:25,089 --> 00:12:27,339
get a pretty good noise signal to noise

278
00:12:27,339 --> 00:12:29,800
ratio to catch some potential candidates

279
00:12:29,800 --> 00:12:35,740
for P acetic password spraying pestering

280
00:12:35,740 --> 00:12:36,880
is something that we hear a lot in the

281
00:12:36,880 --> 00:12:39,190
news for the past year or two and it

282
00:12:39,190 --> 00:12:41,800
sounds very elaborate but it's actually

283
00:12:41,800 --> 00:12:44,079
pretty simple technique a lot of

284
00:12:44,079 --> 00:12:46,209
companies have been have fallen prey to

285
00:12:46,209 --> 00:12:49,540
it Citrix would be one of them but all

286
00:12:49,540 --> 00:12:51,130
you have to do really is take a list of

287
00:12:51,130 --> 00:12:53,170
users and the list of passwords are just

288
00:12:53,170 --> 00:12:55,660
one password and you enumerate all those

289
00:12:55,660 --> 00:12:58,149
users with that password or the list of

290
00:12:58,149 --> 00:13:00,459
passwords and see if everyone is using a

291
00:13:00,459 --> 00:13:04,899
weak password so on the red side if you

292
00:13:04,899 --> 00:13:06,130
want to try it out there are many tools

293
00:13:06,130 --> 00:13:08,320
to do a password spraying my personal

294
00:13:08,320 --> 00:13:11,199
favorite is Bo Bella deaf hack

295
00:13:11,199 --> 00:13:12,730
he's from Black Hills information

296
00:13:12,730 --> 00:13:15,490
security and his tool invoke domain

297
00:13:15,490 --> 00:13:17,990
password spray it's a PowerShell script

298
00:13:17,990 --> 00:13:20,540
very easy to use you just given a single

299
00:13:20,540 --> 00:13:23,120
password and then iterates over all the

300
00:13:23,120 --> 00:13:24,920
users in the organization for that

301
00:13:24,920 --> 00:13:27,320
password or I can give it a list of

302
00:13:27,320 --> 00:13:28,880
users and the list of passwords now

303
00:13:28,880 --> 00:13:30,649
don't worry it's not going to lock any

304
00:13:30,649 --> 00:13:32,450
of the users because it's only gonna try

305
00:13:32,450 --> 00:13:36,380
each password on each user no more than

306
00:13:36,380 --> 00:13:38,029
two or three or four or five times

307
00:13:38,029 --> 00:13:39,709
depending on the code you can always

308
00:13:39,709 --> 00:13:41,870
change that so we won't lock any of the

309
00:13:41,870 --> 00:13:46,459
users now let's say an attacker has

310
00:13:46,459 --> 00:13:47,540
compromised the machine in the

311
00:13:47,540 --> 00:13:49,910
organization and is currently activating

312
00:13:49,910 --> 00:13:51,110
a password spree

313
00:13:51,110 --> 00:13:53,209
how can you monitor catch them in the

314
00:13:53,209 --> 00:13:56,330
act that's not too hard as well because

315
00:13:56,330 --> 00:13:58,580
we have the security log event ID

316
00:13:58,580 --> 00:14:02,660
46:25 an account failed to log on now if

317
00:14:02,660 --> 00:14:05,029
you correlate those events into your

318
00:14:05,029 --> 00:14:07,220
same product and you try to catch let's

319
00:14:07,220 --> 00:14:09,589
say more than ten of those events in

320
00:14:09,589 --> 00:14:11,660
less than 5 min appeared or 1 minute

321
00:14:11,660 --> 00:14:14,570
period and it's not Monday in the rest

322
00:14:14,570 --> 00:14:16,760
of the world or Sunday in Israel where

323
00:14:16,760 --> 00:14:18,230
everybody's coming back from their

324
00:14:18,230 --> 00:14:20,990
vacation and holidays or the weekend and

325
00:14:20,990 --> 00:14:22,940
can't remember their passwords hmm you

326
00:14:22,940 --> 00:14:25,510
might be dealing with a password spray

327
00:14:25,510 --> 00:14:29,329
you can also log on different types so

328
00:14:29,329 --> 00:14:31,370
you have the interactive type which is

329
00:14:31,370 --> 00:14:33,200
number two or network which is number

330
00:14:33,200 --> 00:14:35,870
three or RDP which is number ten gives

331
00:14:35,870 --> 00:14:38,440
you more information

332
00:14:39,100 --> 00:14:42,170
so this passwords video exercise got me

333
00:14:42,170 --> 00:14:45,880
thinking by my own sort of password

334
00:14:45,880 --> 00:14:48,290
organizational behavior in Maryland

335
00:14:48,290 --> 00:14:50,870
organization how many people were using

336
00:14:50,870 --> 00:14:53,270
weak passwords I was here I wanted to

337
00:14:53,270 --> 00:14:55,610
find that out now if you're a hacker one

338
00:14:55,610 --> 00:14:57,709
of the Holy Grails that you're after is

339
00:14:57,709 --> 00:15:00,350
this file entity s doc did this is the

340
00:15:00,350 --> 00:15:02,750
database file which holds all the users

341
00:15:02,750 --> 00:15:05,270
password hashes and it's located on the

342
00:15:05,270 --> 00:15:08,329
DC on the domain controller but if

343
00:15:08,329 --> 00:15:09,800
you're a defender you already have the

344
00:15:09,800 --> 00:15:11,390
keys to the kingdom it's no problem you

345
00:15:11,390 --> 00:15:13,910
can get to that DC and there's even a

346
00:15:13,910 --> 00:15:16,279
built-in utility in Windows called NTDs

347
00:15:16,279 --> 00:15:18,140
util which allows you to take a backup

348
00:15:18,140 --> 00:15:20,870
of that file including with the system

349
00:15:20,870 --> 00:15:23,839
hive in the registry the Sam and you can

350
00:15:23,839 --> 00:15:26,959
copy it let's say to see temp our next

351
00:15:26,959 --> 00:15:30,580
tool of choice is one of the

352
00:15:30,580 --> 00:15:32,650
in packet library files it's a Python

353
00:15:32,650 --> 00:15:35,260
script called secrets dump and give us

354
00:15:35,260 --> 00:15:38,830
that directory and it outputs a file

355
00:15:38,830 --> 00:15:41,230
with all the names of the users and all

356
00:15:41,230 --> 00:15:43,180
in it and all their hashes of their

357
00:15:43,180 --> 00:15:46,450
passwords the next thing I did was use a

358
00:15:46,450 --> 00:15:48,580
tool of choice I'm sure some of you are

359
00:15:48,580 --> 00:15:50,980
familiar with it it's called Excel

360
00:15:50,980 --> 00:15:53,080
spreadsheets so I started taking those

361
00:15:53,080 --> 00:15:56,770
hashes and grouping them together to

362
00:15:56,770 --> 00:15:59,140
users getting creating clusters and you

363
00:15:59,140 --> 00:16:00,310
know most of the classes were not

364
00:16:00,310 --> 00:16:02,080
clusters at all there were a cluster of

365
00:16:02,080 --> 00:16:03,910
one meaning one user with a unique

366
00:16:03,910 --> 00:16:06,490
password not necessarily strong not

367
00:16:06,490 --> 00:16:09,280
necessarily weak but unique but then

368
00:16:09,280 --> 00:16:10,810
there were other clusters bigger

369
00:16:10,810 --> 00:16:15,160
clusters that had 18 or 60 or 88 users

370
00:16:15,160 --> 00:16:18,280
all sharing the same password now listen

371
00:16:18,280 --> 00:16:21,430
closely because this might be happening

372
00:16:21,430 --> 00:16:23,290
in your organization as we speak I

373
00:16:23,290 --> 00:16:25,210
checked those users out and you know

374
00:16:25,210 --> 00:16:27,430
what all those users were applicative

375
00:16:27,430 --> 00:16:29,560
users and infrastructure users not human

376
00:16:29,560 --> 00:16:32,080
users users used by commercial products

377
00:16:32,080 --> 00:16:33,640
to access the domain through at this

378
00:16:33,640 --> 00:16:35,620
databases on behalf of the regular users

379
00:16:35,620 --> 00:16:39,040
and that's only an entire story because

380
00:16:39,040 --> 00:16:41,200
I realized that whenever the cysts

381
00:16:41,200 --> 00:16:43,360
admins were tasked with the task of

382
00:16:43,360 --> 00:16:45,550
creating a new user they created a new

383
00:16:45,550 --> 00:16:47,290
user and there's so many passwords they

384
00:16:47,290 --> 00:16:48,790
can remember in their minds they just

385
00:16:48,790 --> 00:16:51,130
use the same password over and over

386
00:16:51,130 --> 00:16:54,810
again and guess what one of those users

387
00:16:54,810 --> 00:16:58,030
was a domain admin account so if someone

388
00:16:58,030 --> 00:17:00,100
compromised that password it just had a

389
00:17:00,100 --> 00:17:04,119
password of a domain admin so will not

390
00:17:04,119 --> 00:17:06,490
share password with my friends so a

391
00:17:06,490 --> 00:17:09,670
solution would negate the need for the

392
00:17:09,670 --> 00:17:12,220
Syst admins to generate strong passwords

393
00:17:12,220 --> 00:17:16,329
and remember remember them so it needs

394
00:17:16,329 --> 00:17:20,410
to be something hmm a machine a computer

395
00:17:20,410 --> 00:17:23,410
maybe a password vault of some kind

396
00:17:23,410 --> 00:17:25,480
something that can generate strong

397
00:17:25,480 --> 00:17:27,819
passwords and save them for secure

398
00:17:27,819 --> 00:17:30,250
viewing later so that humans don't have

399
00:17:30,250 --> 00:17:37,600
to a while later I was looking at a pen

400
00:17:37,600 --> 00:17:39,010
test report done to us by an external

401
00:17:39,010 --> 00:17:40,530
pen testing company

402
00:17:40,530 --> 00:17:42,840
and I was reading through the pages and

403
00:17:42,840 --> 00:17:46,230
one of the pages was talking about weak

404
00:17:46,230 --> 00:17:50,100
users and a list of users that had a

405
00:17:50,100 --> 00:17:52,920
weak password not that me thinking I was

406
00:17:52,920 --> 00:17:56,250
pretty curious because how many people I

407
00:17:56,250 --> 00:17:57,870
mean how did the pen test to know how

408
00:17:57,870 --> 00:17:59,820
many people had weak passwords

409
00:17:59,820 --> 00:18:04,320
luckily the report had a screenshot of a

410
00:18:04,320 --> 00:18:06,870
logo of a name of a tool I looked it up

411
00:18:06,870 --> 00:18:08,220
it was free

412
00:18:08,220 --> 00:18:10,470
now due to Euler reasons I can't divulge

413
00:18:10,470 --> 00:18:14,670
the name but I wanted to know not just

414
00:18:14,670 --> 00:18:16,860
who has a weak password I want to know

415
00:18:16,860 --> 00:18:19,140
how weak is weak how many were using

416
00:18:19,140 --> 00:18:21,210
password or capital a strong guy one two

417
00:18:21,210 --> 00:18:22,560
three four five or one two three four

418
00:18:22,560 --> 00:18:24,960
five exclaiming should mark I knew the

419
00:18:24,960 --> 00:18:27,420
tool knew it just didn't divulge that

420
00:18:27,420 --> 00:18:32,130
information so I had to enhance the

421
00:18:32,130 --> 00:18:35,850
tools capabilities but Dhananjay mama

422
00:18:35,850 --> 00:18:39,840
blue team another verse engineer but I

423
00:18:39,840 --> 00:18:41,730
did know one thing I know that certain

424
00:18:41,730 --> 00:18:44,460
programs are in dotnet is c-sharp if

425
00:18:44,460 --> 00:18:46,170
they were compiled in debug mode

426
00:18:46,170 --> 00:18:47,730
compiled with all the symbols and the

427
00:18:47,730 --> 00:18:49,470
source code inside it could be

428
00:18:49,470 --> 00:18:51,720
decompiled so enter a tool of choice

429
00:18:51,720 --> 00:18:52,920
whoops

430
00:18:52,920 --> 00:18:56,760
il spy il spy as a tool that allows you

431
00:18:56,760 --> 00:19:00,060
to do just that if the file is compiled

432
00:19:00,060 --> 00:19:01,620
that way you can just throw it into the

433
00:19:01,620 --> 00:19:04,530
tool and it will output an entire C

434
00:19:04,530 --> 00:19:06,630
sharp project which you can load into

435
00:19:06,630 --> 00:19:10,320
Visual Studio which I did it took me

436
00:19:10,320 --> 00:19:12,300
about two days to compile in and get the

437
00:19:12,300 --> 00:19:14,580
code running again because I'll smile is

438
00:19:14,580 --> 00:19:18,120
not perfect it had some over references

439
00:19:18,120 --> 00:19:20,490
and it will act a few references which I

440
00:19:20,490 --> 00:19:23,310
had to put eventually got the thing to

441
00:19:23,310 --> 00:19:26,790
run but I realized that this tool is not

442
00:19:26,790 --> 00:19:28,590
so much a hacking tool it's more of an

443
00:19:28,590 --> 00:19:30,510
assessment tool because you have to run

444
00:19:30,510 --> 00:19:32,550
it with domain admin credentials on the

445
00:19:32,550 --> 00:19:35,940
actual domain controller but apparently

446
00:19:35,940 --> 00:19:38,180
I couldn't debug the code live

447
00:19:38,180 --> 00:19:41,430
dynamically because the sis admins they

448
00:19:41,430 --> 00:19:43,050
don't like it when you try to install a

449
00:19:43,050 --> 00:19:44,640
Visual Studio IDE on their domain

450
00:19:44,640 --> 00:19:47,670
controller so I did go a different route

451
00:19:47,670 --> 00:19:51,000
and go for a code review and a static

452
00:19:51,000 --> 00:19:51,990
analysis

453
00:19:51,990 --> 00:19:54,660
so took me some more time when we go

454
00:19:54,660 --> 00:19:56,370
over the various functions trying to

455
00:19:56,370 --> 00:19:58,590
understand the workflow of the of the

456
00:19:58,590 --> 00:20:02,240
tool but eventually I got to the actual

457
00:20:02,240 --> 00:20:05,610
function the actual class in it the

458
00:20:05,610 --> 00:20:08,160
actual function that took a weak

459
00:20:08,160 --> 00:20:10,320
password from a pre-configured password

460
00:20:10,320 --> 00:20:14,370
list hashed it and then compared it

461
00:20:14,370 --> 00:20:17,370
against all the hashes of the users on

462
00:20:17,370 --> 00:20:20,310
the domain controller so all I had to do

463
00:20:20,310 --> 00:20:24,480
was add one line of code not just true

464
00:20:24,480 --> 00:20:26,880
or false at the user had a weak password

465
00:20:26,880 --> 00:20:31,260
but what the password actually was so

466
00:20:31,260 --> 00:20:34,020
now the report came in with a list of

467
00:20:34,020 --> 00:20:36,360
users and all their list of weak

468
00:20:36,360 --> 00:20:38,520
passwords for any weak password found

469
00:20:38,520 --> 00:20:42,930
and I have curated a password list from

470
00:20:42,930 --> 00:20:45,360
various sources and then refined it

471
00:20:45,360 --> 00:20:49,140
so what I did was just take those

472
00:20:49,140 --> 00:20:51,240
passwords let's say password and then

473
00:20:51,240 --> 00:20:53,040
add a password one password - password

474
00:20:53,040 --> 00:20:57,360
10 so I could see not just who had a

475
00:20:57,360 --> 00:20:59,400
weak password but who was running around

476
00:20:59,400 --> 00:21:02,100
with the same schema of the password

477
00:21:02,100 --> 00:21:04,520
something was just comparing hashes

478
00:21:04,520 --> 00:21:09,780
would not have told me I have a lot more

479
00:21:09,780 --> 00:21:12,030
time than I thought so I'm gonna give an

480
00:21:12,030 --> 00:21:15,050
out give up another story one of the

481
00:21:15,050 --> 00:21:17,900
extremely weak passwords that I had

482
00:21:17,900 --> 00:21:20,370
found out one of the users was a user

483
00:21:20,370 --> 00:21:25,260
from IT someone who always claimed to be

484
00:21:25,260 --> 00:21:28,620
security aware security conscious and he

485
00:21:28,620 --> 00:21:31,260
always went into meetings talking about

486
00:21:31,260 --> 00:21:33,600
how do we need security even took a

487
00:21:33,600 --> 00:21:35,370
seaso course to understand security

488
00:21:35,370 --> 00:21:38,700
better and he had an extremely weak

489
00:21:38,700 --> 00:21:43,520
password that had to make him think of

490
00:21:43,520 --> 00:21:46,560
that password he needed to change it how

491
00:21:46,560 --> 00:21:50,370
could I sort of prank Ashley tell them

492
00:21:50,370 --> 00:21:53,960
that he needs to change his password so

493
00:21:53,960 --> 00:21:56,820
my organization does a Outlook Web

494
00:21:56,820 --> 00:22:00,300
Access internally so I logged in as him

495
00:22:00,300 --> 00:22:03,750
and there's an ability to change the

496
00:22:03,750 --> 00:22:05,350
icon of the picture of

497
00:22:05,350 --> 00:22:09,399
profile to something else so I changed

498
00:22:09,399 --> 00:22:12,100
it to uh are you familiar with the

499
00:22:12,100 --> 00:22:15,940
statue the thinking man well there's a

500
00:22:15,940 --> 00:22:17,590
meme out there it's probably a famous

501
00:22:17,590 --> 00:22:21,429
meme of the face Bowman and that's what

502
00:22:21,429 --> 00:22:25,570
I did my apparently it was too white he

503
00:22:25,570 --> 00:22:28,380
didn't even notice so when did a week

504
00:22:28,380 --> 00:22:31,419
heard nothing so I decided to schedule

505
00:22:31,419 --> 00:22:34,740
an appointment with my boss to see so

506
00:22:34,740 --> 00:22:38,200
every day for a week talking about

507
00:22:38,200 --> 00:22:41,649
password policies with him being the

508
00:22:41,649 --> 00:22:47,019
organizer nothing happened because he

509
00:22:47,019 --> 00:22:49,149
was so busy with other projects every

510
00:22:49,149 --> 00:22:50,980
time they got a pop-up of a meeting he

511
00:22:50,980 --> 00:22:53,500
just canceled it a week later he talked

512
00:22:53,500 --> 00:22:55,210
to my boss and asked him what was it but

513
00:22:55,210 --> 00:22:57,039
I know some meeting with you for the

514
00:22:57,039 --> 00:22:58,929
past week and my boss was none the wiser

515
00:22:58,929 --> 00:23:00,490
so he said I don't know so the guy just

516
00:23:00,490 --> 00:23:03,419
shrugged his shoulders and left I

517
00:23:03,419 --> 00:23:06,909
started to escalate so I decided to go

518
00:23:06,909 --> 00:23:08,620
back to the profile picture apparently

519
00:23:08,620 --> 00:23:13,179
it was it it wasn't colorful enough so I

520
00:23:13,179 --> 00:23:16,649
decided to change it to a picture of

521
00:23:16,649 --> 00:23:21,330
Disney's Pumbaa from The Lion King

522
00:23:21,330 --> 00:23:24,669
that's big that's colorful that God is

523
00:23:24,669 --> 00:23:27,519
attention so he realized he was being

524
00:23:27,519 --> 00:23:30,909
hacked by someone from IT the first

525
00:23:30,909 --> 00:23:32,850
thing he did he changed his password

526
00:23:32,850 --> 00:23:36,009
when I ran the report again I couldn't

527
00:23:36,009 --> 00:23:38,950
find it anymore the only problem is

528
00:23:38,950 --> 00:23:43,200
which I didn't think of is the fact that

529
00:23:43,200 --> 00:23:45,519
he still thought he was being hacked

530
00:23:45,519 --> 00:23:48,490
even a week later because apparently

531
00:23:48,490 --> 00:23:50,980
some people were communicating with him

532
00:23:50,980 --> 00:23:52,899
through email when you get the profile

533
00:23:52,899 --> 00:23:55,299
picture of someone it stays in your

534
00:23:55,299 --> 00:23:58,690
cache so everybody kept on getting puma

535
00:23:58,690 --> 00:24:00,759
pictures of him every time they send him

536
00:24:00,759 --> 00:24:03,460
an email even though i'm the server that

537
00:24:03,460 --> 00:24:05,370
picture didn't exist anymore

538
00:24:05,370 --> 00:24:08,409
so after that they told me are you out

539
00:24:08,409 --> 00:24:11,169
the truth I know I have no idea who's

540
00:24:11,169 --> 00:24:17,260
hacking you it's not me also found out

541
00:24:17,260 --> 00:24:19,570
that 25 percent of my users

542
00:24:19,570 --> 00:24:23,019
popular password shall we say and out of

543
00:24:23,019 --> 00:24:27,519
that 43% were human and 57% were

544
00:24:27,519 --> 00:24:30,039
applicative and that's something that

545
00:24:30,039 --> 00:24:33,100
knowing getting that visibility is an

546
00:24:33,100 --> 00:24:35,590
agent of change now we can do something

547
00:24:35,590 --> 00:24:37,600
about it now then we know that the

548
00:24:37,600 --> 00:24:42,519
problem exists so to conclude when I

549
00:24:42,519 --> 00:24:45,220
start this talk I asked you which one of

550
00:24:45,220 --> 00:24:46,269
you out there consider themselves

551
00:24:46,269 --> 00:24:49,179
hackers most of you did not raise your

552
00:24:49,179 --> 00:24:52,840
hand but the question is what is a

553
00:24:52,840 --> 00:24:56,139
hacker and it's a good question and go

554
00:24:56,139 --> 00:24:57,759
ahead and give you my personal

555
00:24:57,759 --> 00:25:01,090
interpretation a bit you see being a

556
00:25:01,090 --> 00:25:04,739
hacker is not a skill set it's a mindset

557
00:25:04,739 --> 00:25:08,349
so if you have a curious nature if you

558
00:25:08,349 --> 00:25:11,049
like to know how things work if you

559
00:25:11,049 --> 00:25:13,629
question Authority if you want to know

560
00:25:13,629 --> 00:25:16,330
what lies in those gray areas between

561
00:25:16,330 --> 00:25:19,239
how a system is supposed to work and how

562
00:25:19,239 --> 00:25:23,019
a system actually works then you might

563
00:25:23,019 --> 00:25:25,149
be much more of a hacker than you've

564
00:25:25,149 --> 00:25:26,679
previously thought of yourselves

565
00:25:26,679 --> 00:25:31,119
because today I know I am thank you very

566
00:25:31,119 --> 00:25:31,650
much

567
00:25:31,650 --> 00:25:35,839
[Applause]

