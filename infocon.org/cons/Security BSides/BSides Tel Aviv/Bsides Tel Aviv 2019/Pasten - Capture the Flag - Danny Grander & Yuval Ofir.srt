1
00:00:00,319 --> 00:00:03,570
hello everyone and and thank you all for

2
00:00:03,570 --> 00:00:04,700
coming

3
00:00:04,700 --> 00:00:10,099
I'm mad Danny I do security at sneak and

4
00:00:10,099 --> 00:00:16,320
this is evolve I'm from clarity cool and

5
00:00:16,320 --> 00:00:19,410
we both of us are from a team called

6
00:00:19,410 --> 00:00:22,560
past N and we are a much bigger team

7
00:00:22,560 --> 00:00:25,949
than the two of us and today we're here

8
00:00:25,949 --> 00:00:29,550
to tell you some stories about how we we

9
00:00:29,550 --> 00:00:31,890
started like about our journey in the in

10
00:00:31,890 --> 00:00:34,440
the CTF world and share some fun

11
00:00:34,440 --> 00:00:36,860
challenges that we encountered and

12
00:00:36,860 --> 00:00:40,500
hopefully encourage you if Gaea didn't

13
00:00:40,500 --> 00:00:42,300
do that enough encourage you to play the

14
00:00:42,300 --> 00:00:47,789
CTF and next time so let's start yes

15
00:00:47,789 --> 00:00:50,129
most of you are familiar with what the

16
00:00:50,129 --> 00:00:52,649
CTF and the different types of CTF there

17
00:00:52,649 --> 00:00:55,050
are but still kind of doing some quick

18
00:00:55,050 --> 00:00:58,020
intro on on and what it is so CTF is a

19
00:00:58,020 --> 00:01:00,109
security competition capture the flag

20
00:01:00,109 --> 00:01:03,000
there are basically two types of

21
00:01:03,000 --> 00:01:05,519
competitions one is the Jeopardy style

22
00:01:05,519 --> 00:01:07,950
the other one is a tag defense so a

23
00:01:07,950 --> 00:01:12,630
jeopardy style CTF is when you have all

24
00:01:12,630 --> 00:01:15,330
the teams have a same set of challenges

25
00:01:15,330 --> 00:01:18,229
and so it challenges the kind of like

26
00:01:18,229 --> 00:01:21,000
something you need to solve and when you

27
00:01:21,000 --> 00:01:23,070
do you get a point so you submit the

28
00:01:23,070 --> 00:01:25,590
flag from the challenge to to the to the

29
00:01:25,590 --> 00:01:28,020
portal to the organiser system and you

30
00:01:28,020 --> 00:01:30,630
get at points so you compete against the

31
00:01:30,630 --> 00:01:33,810
team by by who solves more challenges

32
00:01:33,810 --> 00:01:36,390
there is no direct like door no other

33
00:01:36,390 --> 00:01:40,829
interaction between the teams and yeah

34
00:01:40,829 --> 00:01:42,659
important thing is that you have six

35
00:01:42,659 --> 00:01:44,430
different categories in the challenges

36
00:01:44,430 --> 00:01:46,320
so you would have crypto challenges you

37
00:01:46,320 --> 00:01:47,850
would have phone which is like

38
00:01:47,850 --> 00:01:49,649
exploitation finding new vulnerabilities

39
00:01:49,649 --> 00:01:51,030
and exploiting them you would have

40
00:01:51,030 --> 00:01:53,850
various engineering challenges and web

41
00:01:53,850 --> 00:01:55,799
and miscellaneous just like weird

42
00:01:55,799 --> 00:01:57,960
challenges like hardware and things like

43
00:01:57,960 --> 00:02:02,670
that and the attack defense CTF and has

44
00:02:02,670 --> 00:02:05,729
limited number of groups because the

45
00:02:05,729 --> 00:02:08,038
thing is that the teams compete one

46
00:02:08,038 --> 00:02:09,628
against the other each team would have

47
00:02:09,628 --> 00:02:11,620
some source answer

48
00:02:11,620 --> 00:02:14,080
services that they operate and you would

49
00:02:14,080 --> 00:02:16,269
need to protect those services against

50
00:02:16,269 --> 00:02:17,890
attack coming from the other teams and

51
00:02:17,890 --> 00:02:21,010
in the same time attack the services of

52
00:02:21,010 --> 00:02:23,440
other teams so that's why in this type

53
00:02:23,440 --> 00:02:25,540
of CTF you would have a limited number

54
00:02:25,540 --> 00:02:31,569
of teams and playing so now let us share

55
00:02:31,569 --> 00:02:33,220
some stories from the city elves and how

56
00:02:33,220 --> 00:02:36,849
how we started this journey right so

57
00:02:36,849 --> 00:02:39,190
we're going to talk about three CTF

58
00:02:39,190 --> 00:02:42,069
which are our favorites here are the

59
00:02:42,069 --> 00:02:45,489
logos the first one is a CCC CTF the

60
00:02:45,489 --> 00:02:46,930
second one is Google CTF and the last

61
00:02:46,930 --> 00:02:50,290
one is don't have enough time so I'll

62
00:02:50,290 --> 00:02:55,470
tell you the story behind our first CTF

63
00:02:55,470 --> 00:02:59,980
the few rules about the CCC CTF it's

64
00:02:59,980 --> 00:03:06,780
jeopardy style CTF it's its own site and

65
00:03:06,780 --> 00:03:09,670
but you can also play it remotely

66
00:03:09,670 --> 00:03:11,620
the our group that are that are not

67
00:03:11,620 --> 00:03:14,829
doing it from the CCC serve sorry I I

68
00:03:14,829 --> 00:03:16,630
haven't explained about the SEC I don't

69
00:03:16,630 --> 00:03:18,940
know if everyone is familiar with CC is

70
00:03:18,940 --> 00:03:22,530
a conference going for like the 35 years

71
00:03:22,530 --> 00:03:25,690
in the world in Germany there are like

72
00:03:25,690 --> 00:03:27,849
15 thousand attendees and it's growing

73
00:03:27,849 --> 00:03:31,329
issue and one event that that happens as

74
00:03:31,329 --> 00:03:33,250
part of this conference is the CCC CTF

75
00:03:33,250 --> 00:03:36,780
speak up okay

76
00:03:36,780 --> 00:03:40,599
there are no prizes and it takes 48

77
00:03:40,599 --> 00:03:44,650
hours from the first day at 8 p.m. to

78
00:03:44,650 --> 00:03:47,200
the last day at 8 p.m. the only thing we

79
00:03:47,200 --> 00:03:49,540
knew when we started the CCC CTF was

80
00:03:49,540 --> 00:03:53,280
that the flags looks something like that

81
00:03:53,430 --> 00:03:57,099
we were four friends like five or six

82
00:03:57,099 --> 00:03:59,859
years ago we took vacation days from

83
00:03:59,859 --> 00:04:02,380
work to participate the CCC conference

84
00:04:02,380 --> 00:04:06,430
not even the CCC CTF and we saw their

85
00:04:06,430 --> 00:04:09,489
ads for for the CTF and we decided to

86
00:04:09,489 --> 00:04:11,230
sign up and see if we can handle a

87
00:04:11,230 --> 00:04:15,220
challenge or maybe two when the CTF

88
00:04:15,220 --> 00:04:20,668
began we decided to take one challenge

89
00:04:20,668 --> 00:04:24,719
and to start with so we just choose the

90
00:04:24,719 --> 00:04:28,229
hardest challenge that wasn't on the on

91
00:04:28,229 --> 00:04:31,469
the CTF we had only two laptops so we

92
00:04:31,469 --> 00:04:33,150
couldn't do much more than one or two

93
00:04:33,150 --> 00:04:35,879
challenges a single thing yesterday but

94
00:04:35,879 --> 00:04:37,710
we started we started from the hardest

95
00:04:37,710 --> 00:04:39,919
one

96
00:04:40,280 --> 00:04:43,199
long story short three a.m. of that

97
00:04:43,199 --> 00:04:46,289
night we managed to be the first team to

98
00:04:46,289 --> 00:04:50,189
solve that 500 points challenge we

99
00:04:50,189 --> 00:04:53,039
didn't know if it was good or bad so we

100
00:04:53,039 --> 00:04:53,879
just went to sleep

101
00:04:53,879 --> 00:04:57,360
it's a we said okay it was fun but when

102
00:04:57,360 --> 00:04:59,639
we woke up we looked at the scoreboard

103
00:04:59,639 --> 00:05:01,650
and we saw that we're still the only

104
00:05:01,650 --> 00:05:06,090
team to solve that challenge so we

105
00:05:06,090 --> 00:05:07,770
decided okay maybe we have a chance

106
00:05:07,770 --> 00:05:11,279
we'll take another one an easier one so

107
00:05:11,279 --> 00:05:13,710
we took a challenge which we're going to

108
00:05:13,710 --> 00:05:18,029
give a short walk through called pi x ik

109
00:05:18,029 --> 00:05:22,500
cool so pi x ik was in the category

110
00:05:22,500 --> 00:05:24,569
called sandbox which typically means

111
00:05:24,569 --> 00:05:26,639
means escaping out of the sandbox and

112
00:05:26,639 --> 00:05:29,219
and the difficulty was easy so that's

113
00:05:29,219 --> 00:05:31,770
after that hard one we we struggled with

114
00:05:31,770 --> 00:05:35,669
we chose a denied an easy one so we

115
00:05:35,669 --> 00:05:37,520
would get an IP address where we would

116
00:05:37,520 --> 00:05:40,259
go and see something like that this

117
00:05:40,259 --> 00:05:41,879
would be the interface there is an edit

118
00:05:41,879 --> 00:05:44,900
box where we could write Python code and

119
00:05:44,900 --> 00:05:47,940
we could the press is exact and it would

120
00:05:47,940 --> 00:05:50,009
evaluate the pyrin code so we knew we

121
00:05:50,009 --> 00:05:53,250
need to run some some Python code that

122
00:05:53,250 --> 00:05:57,479
would read a flag file and they actually

123
00:05:57,479 --> 00:05:59,250
provided us with the app with the with

124
00:05:59,250 --> 00:06:00,689
the Python script itself so the

125
00:06:00,689 --> 00:06:02,430
application itself was available to us

126
00:06:02,430 --> 00:06:04,770
and then that's where we could see that

127
00:06:04,770 --> 00:06:07,650
they would blacklist all sorts of nasty

128
00:06:07,650 --> 00:06:10,439
things we could use and in part of our

129
00:06:10,439 --> 00:06:13,169
exploit so not anything you could

130
00:06:13,169 --> 00:06:15,779
anything interesting in Python you could

131
00:06:15,779 --> 00:06:17,639
think of you you could you wouldn't be

132
00:06:17,639 --> 00:06:20,039
able to do and they also have this white

133
00:06:20,039 --> 00:06:21,779
list so basically would be limited to

134
00:06:21,779 --> 00:06:24,990
very specific set of characters and that

135
00:06:24,990 --> 00:06:27,180
would work when we when we played with

136
00:06:27,180 --> 00:06:29,370
it basically nothing worked except for

137
00:06:29,370 --> 00:06:31,639
some basic really basic

138
00:06:31,639 --> 00:06:34,909
and calculations any ideas what we can

139
00:06:34,909 --> 00:06:41,360
do here well I hope I heard the answer

140
00:06:41,360 --> 00:06:43,939
but the answer is Python encoding so

141
00:06:43,939 --> 00:06:46,520
apparently you can start a Python script

142
00:06:46,520 --> 00:06:50,150
with the following line and hashtag

143
00:06:50,150 --> 00:06:51,889
coding and then choose one of the

144
00:06:51,889 --> 00:06:53,240
following game coatings and then you can

145
00:06:53,240 --> 00:06:55,819
just encode your full Python script in

146
00:06:55,819 --> 00:06:57,979
one of those companies so in this case

147
00:06:57,979 --> 00:07:00,680
we could just use the raw Unicode escape

148
00:07:00,680 --> 00:07:04,370
and taking this simple line of Python

149
00:07:04,370 --> 00:07:07,610
code and that is opening a flag file and

150
00:07:07,610 --> 00:07:09,319
just reading it bringing and printing it

151
00:07:09,319 --> 00:07:12,650
to the screen and this would be encoding

152
00:07:12,650 --> 00:07:16,029
into this Unicode the escaped string and

153
00:07:16,029 --> 00:07:18,560
when we ran it we would get the flag so

154
00:07:18,560 --> 00:07:20,449
indeed was a nice and easy an easy

155
00:07:20,449 --> 00:07:26,389
challenge and and a really fun one ok

156
00:07:26,389 --> 00:07:29,479
another challenge we solved the same CTF

157
00:07:29,479 --> 00:07:34,250
was Big Data it was considered harder

158
00:07:34,250 --> 00:07:36,349
and the category is foam once again we

159
00:07:36,349 --> 00:07:39,979
need to execute code on the server when

160
00:07:39,979 --> 00:07:42,110
we got a challenge the first thing we

161
00:07:42,110 --> 00:07:44,990
saw was that meaningful description just

162
00:07:44,990 --> 00:07:49,639
big data and the file the charge is that

163
00:07:49,639 --> 00:07:51,860
file containing the binary that the

164
00:07:51,860 --> 00:07:54,529
server runs and an IP address and hosted

165
00:07:54,529 --> 00:07:59,990
that the server runs that binary on so

166
00:07:59,990 --> 00:08:03,050
we took the binary we started to reverse

167
00:08:03,050 --> 00:08:06,110
engineering and ingenuity and understand

168
00:08:06,110 --> 00:08:10,339
what he does and we found a stack buffer

169
00:08:10,339 --> 00:08:13,909
overflow just like in the textbook they

170
00:08:13,909 --> 00:08:17,419
have a buffer with the limited size that

171
00:08:17,419 --> 00:08:20,479
is the size and they received the length

172
00:08:20,479 --> 00:08:23,180
of the of the buffer from the user from

173
00:08:23,180 --> 00:08:25,689
us and then they just read data

174
00:08:25,689 --> 00:08:28,129
according to the buffer rank that we

175
00:08:28,129 --> 00:08:28,779
sent

176
00:08:28,779 --> 00:08:32,539
sounds really easy to to exploit for

177
00:08:32,539 --> 00:08:36,078
everyone that they experience with with

178
00:08:36,078 --> 00:08:38,719
a stack buffer overflow well he knows

179
00:08:38,719 --> 00:08:42,559
what to do and in order to trigger that

180
00:08:42,559 --> 00:08:44,450
vulnerability all we need to do

181
00:08:44,450 --> 00:08:47,930
just sent some data that will be bigger

182
00:08:47,930 --> 00:08:52,850
than that buffer and it worked look

183
00:08:52,850 --> 00:08:54,980
locally on our machine when we tested it

184
00:08:54,980 --> 00:08:57,740
but we couldn't make it work on their

185
00:08:57,740 --> 00:09:00,889
server the reason that we couldn't make

186
00:09:00,889 --> 00:09:03,920
it work was that we couldn't make the

187
00:09:03,920 --> 00:09:07,839
received call the receive right here

188
00:09:07,839 --> 00:09:12,790
that we see to return more than 100 elf

189
00:09:12,790 --> 00:09:17,660
1,500 bytes of data and the reason that

190
00:09:17,660 --> 00:09:19,459
that we couldn't make it happen is

191
00:09:19,459 --> 00:09:24,010
because there was a really long network

192
00:09:24,010 --> 00:09:31,300
between us and and the server and the

193
00:09:31,300 --> 00:09:33,920
mechanism that our data was carried on

194
00:09:33,920 --> 00:09:37,730
was TCP TCP stream base is a stream

195
00:09:37,730 --> 00:09:41,360
based protocol meaning that you don't

196
00:09:41,360 --> 00:09:44,060
get to choose which data is being sent

197
00:09:44,060 --> 00:09:47,389
in in each chunk you just send data and

198
00:09:47,389 --> 00:09:49,640
the receiver would read it however it

199
00:09:49,640 --> 00:09:53,060
once and the segmentation is handled by

200
00:09:53,060 --> 00:09:55,850
the TCP stack so if you sent a big chunk

201
00:09:55,850 --> 00:09:59,149
chunk of data and there was no network

202
00:09:59,149 --> 00:10:01,519
between you and the receiver then you

203
00:10:01,519 --> 00:10:03,560
will receive everything in one in one

204
00:10:03,560 --> 00:10:06,529
receive but if some network segment is

205
00:10:06,529 --> 00:10:08,959
segmented this buffer into smaller

206
00:10:08,959 --> 00:10:12,589
chunks then the the TCP stack is allowed

207
00:10:12,589 --> 00:10:18,010
to give you only smaller chunks one one

208
00:10:18,010 --> 00:10:20,480
another thing to understand about TCP is

209
00:10:20,480 --> 00:10:24,230
that is a reliable protocol so it must

210
00:10:24,230 --> 00:10:27,199
handle retransmission and key buffers

211
00:10:27,199 --> 00:10:29,420
for handling of out of orders packets

212
00:10:29,420 --> 00:10:33,260
and we will show that in a minute and we

213
00:10:33,260 --> 00:10:36,829
wanted to make sure that we wanted to to

214
00:10:36,829 --> 00:10:39,470
send some special messages that will

215
00:10:39,470 --> 00:10:41,810
make the TCP stack buffer all the data

216
00:10:41,810 --> 00:10:46,010
for us and return it in one chunk so

217
00:10:46,010 --> 00:10:48,980
whenever you send a big message this is

218
00:10:48,980 --> 00:10:51,769
our big message that the TCP stack will

219
00:10:51,769 --> 00:10:54,170
segment it into one two three four five

220
00:10:54,170 --> 00:10:55,699
chunks and send them in that specific

221
00:10:55,699 --> 00:10:58,270
order but what we wanted to do

222
00:10:58,270 --> 00:11:03,080
was we wanted to to split the message

223
00:11:03,080 --> 00:11:05,360
into those five pieces but send the

224
00:11:05,360 --> 00:11:08,060
second message then the three four five

225
00:11:08,060 --> 00:11:10,790
message and only then we'll send the

226
00:11:10,790 --> 00:11:14,540
last message and the receiver side will

227
00:11:14,540 --> 00:11:16,250
understand that here is the complete

228
00:11:16,250 --> 00:11:18,470
chunk now I will forward it to the

229
00:11:18,470 --> 00:11:20,150
application to be processed and by this

230
00:11:20,150 --> 00:11:28,340
the receive will be in one big chunk we

231
00:11:28,340 --> 00:11:31,730
try to implement it we in order to do

232
00:11:31,730 --> 00:11:34,280
that we had to implement our own basic

233
00:11:34,280 --> 00:11:36,860
TCP stack and we did it for over two

234
00:11:36,860 --> 00:11:40,700
hours it was late in the CTF and we

235
00:11:40,700 --> 00:11:42,170
hadn't heard that we haven't had much

236
00:11:42,170 --> 00:11:43,520
sleep that night

237
00:11:43,520 --> 00:11:47,080
we haven't almost any sleep at night so

238
00:11:47,080 --> 00:11:51,320
we just couldn't make it work any ideas

239
00:11:51,320 --> 00:11:54,100
of what to do

240
00:11:54,100 --> 00:11:57,170
jumbo frames is a nice idea but it was

241
00:11:57,170 --> 00:12:00,320
internet between us and the server so we

242
00:12:00,320 --> 00:12:04,640
drove the jungle friends so remember the

243
00:12:04,640 --> 00:12:08,060
the previous challenge the pie exact

244
00:12:08,060 --> 00:12:10,940
challenge we thought that maybe they

245
00:12:10,940 --> 00:12:12,890
host the challenges on the same that

246
00:12:12,890 --> 00:12:15,110
data center or maybe even on the same

247
00:12:15,110 --> 00:12:18,890
server so we thought maybe we would just

248
00:12:18,890 --> 00:12:20,810
run our exploit code through that

249
00:12:20,810 --> 00:12:24,080
interface so exactly just like running

250
00:12:24,080 --> 00:12:26,600
there our recording here we put our

251
00:12:26,600 --> 00:12:31,870
exploit code in here and it worked

252
00:12:38,840 --> 00:12:43,170
cool so this was wasn't intent intended

253
00:12:43,170 --> 00:12:45,810
of course but but still we believe it

254
00:12:45,810 --> 00:12:47,670
was according to the rules so that was

255
00:12:47,670 --> 00:12:48,090
fine

256
00:12:48,090 --> 00:12:49,890
and by the way like this is that year we

257
00:12:49,890 --> 00:12:52,260
came in on the fifth place this is the

258
00:12:52,260 --> 00:12:54,450
first time we play the city yeah and and

259
00:12:54,450 --> 00:12:56,490
the nice thing about it is that this is

260
00:12:56,490 --> 00:12:58,710
the first challenge we solved we are the

261
00:12:58,710 --> 00:13:02,340
the baby blue chart here each step in

262
00:13:02,340 --> 00:13:04,620
this graph is is a salt challenge so

263
00:13:04,620 --> 00:13:06,540
first challenge we solved was the

264
00:13:06,540 --> 00:13:08,550
hardest one and then we went to sleep

265
00:13:08,550 --> 00:13:12,420
like no other team did that okay then we

266
00:13:12,420 --> 00:13:14,550
woke up and we sin like hey this is nice

267
00:13:14,550 --> 00:13:16,920
we're still kind of bleeding in the top

268
00:13:16,920 --> 00:13:21,120
ten or something and then we had some

269
00:13:21,120 --> 00:13:23,610
friends join us on site but also in Tel

270
00:13:23,610 --> 00:13:26,550
Aviv and and then we're actually we're

271
00:13:26,550 --> 00:13:28,350
playing until the end of the competition

272
00:13:28,350 --> 00:13:31,760
and making it to the to the fifth place

273
00:13:31,760 --> 00:13:34,140
so a you later

274
00:13:34,140 --> 00:13:37,310
and we really got excited about all this

275
00:13:37,310 --> 00:13:40,860
CTF thing and and came back with more

276
00:13:40,860 --> 00:13:44,640
people we were 15 friends on site and

277
00:13:44,640 --> 00:13:48,600
five more home we had actually reserved

278
00:13:48,600 --> 00:13:50,010
the table which is the thing you can do

279
00:13:50,010 --> 00:13:51,960
in the CCC conference before that we

280
00:13:51,960 --> 00:13:55,360
were just kind of homeless and and

281
00:13:55,360 --> 00:13:58,060
and just grab some some some table there

282
00:13:58,060 --> 00:14:00,579
and we had a VPN and a VoIP so we can

283
00:14:00,579 --> 00:14:02,649
actually call our friends and and like

284
00:14:02,649 --> 00:14:05,560
we had real infrastructure and we use

285
00:14:05,560 --> 00:14:07,390
slack which is today very obvious but

286
00:14:07,390 --> 00:14:09,730
back then most CTF teams had their own

287
00:14:09,730 --> 00:14:11,820
custom kind of knowledge sharing and

288
00:14:11,820 --> 00:14:15,459
challenge solving systems that they that

289
00:14:15,459 --> 00:14:18,459
they used but select was the laziest

290
00:14:18,459 --> 00:14:19,959
thing we could do it and it worked

291
00:14:19,959 --> 00:14:24,040
really well for us now this time we also

292
00:14:24,040 --> 00:14:27,279
have some some AWS machines that we

293
00:14:27,279 --> 00:14:28,930
could use for creep the challenges and

294
00:14:28,930 --> 00:14:31,959
some and some other things and of course

295
00:14:31,959 --> 00:14:34,029
most importantly we actually got some

296
00:14:34,029 --> 00:14:35,800
food and beers which says this is

297
00:14:35,800 --> 00:14:38,260
something that we really didn't have

298
00:14:38,260 --> 00:14:40,720
last time last year and so this is a

299
00:14:40,720 --> 00:14:42,850
photo with all the food and the beer and

300
00:14:42,850 --> 00:14:46,779
an egg what voice got matter yeah this

301
00:14:46,779 --> 00:14:48,100
is the club matter but also had our own

302
00:14:48,100 --> 00:14:50,140
beers there and this is a phone like a

303
00:14:50,140 --> 00:14:53,279
real boy between us and their Tel Aviv

304
00:14:53,279 --> 00:14:59,250
bass so that year we we came in second

305
00:14:59,250 --> 00:15:03,130
and with quite a big gap I believe like

306
00:15:03,130 --> 00:15:06,279
there was it was a single challenge a

307
00:15:06,279 --> 00:15:09,100
really fun one but that would make the

308
00:15:09,100 --> 00:15:11,920
whole difference and then third year a

309
00:15:11,920 --> 00:15:14,440
year later we came back and this time we

310
00:15:14,440 --> 00:15:19,779
actually won the first place and and so

311
00:15:19,779 --> 00:15:22,690
so these are some photos of celebration

312
00:15:22,690 --> 00:15:27,310
but then the ego after we kept the first

313
00:15:27,310 --> 00:15:29,019
place as well and then another year

314
00:15:29,019 --> 00:15:32,860
later we so we will want the first first

315
00:15:32,860 --> 00:15:36,040
place three years in a row this is a the

316
00:15:36,040 --> 00:15:40,209
CTF floor from year 2017 and this is our

317
00:15:40,209 --> 00:15:44,199
team here in the front so from that year

318
00:15:44,199 --> 00:15:48,459
from 2017 a really a fun fun challenge

319
00:15:48,459 --> 00:15:52,390
which was they gave it a difficulty

320
00:15:52,390 --> 00:15:54,339
medium but I think they regretted it

321
00:15:54,339 --> 00:15:57,420
because it was kind of super hard and

322
00:15:57,420 --> 00:15:59,700
and it was really interesting so that's

323
00:15:59,700 --> 00:16:03,300
why we will share some some of this and

324
00:16:03,300 --> 00:16:06,780
now so we got like many of the web

325
00:16:06,780 --> 00:16:08,880
challenges you just get an IP address so

326
00:16:08,880 --> 00:16:12,090
we received this this IP address where

327
00:16:12,090 --> 00:16:14,160
we would go to it and it will see the

328
00:16:14,160 --> 00:16:16,440
secure file extraction service and you

329
00:16:16,440 --> 00:16:19,620
can provide it so you can provide it a

330
00:16:19,620 --> 00:16:22,800
URL pointing to a zip file and it would

331
00:16:22,800 --> 00:16:26,070
extract it for you and let you download

332
00:16:26,070 --> 00:16:28,650
the files from the zip file nothing

333
00:16:28,650 --> 00:16:31,220
fancy but there is some things that

334
00:16:31,220 --> 00:16:34,590
happened here first we've seen that it

335
00:16:34,590 --> 00:16:36,900
extracts all the files in a flat in a

336
00:16:36,900 --> 00:16:38,490
root directory so if you have some

337
00:16:38,490 --> 00:16:41,130
folders in it or some some kind of like

338
00:16:41,130 --> 00:16:43,410
folder structure it just ignores it and

339
00:16:43,410 --> 00:16:45,150
all the files fall into a single

340
00:16:45,150 --> 00:16:47,700
directory it supports multiple formats

341
00:16:47,700 --> 00:16:50,520
like seven zip zip tar and and probably

342
00:16:50,520 --> 00:16:53,430
others and it deletes all the folders

343
00:16:53,430 --> 00:16:55,440
and all the symbolic links and that you

344
00:16:55,440 --> 00:16:57,690
had inside the zip so we just again

345
00:16:57,690 --> 00:16:59,760
flattens all the files out but just the

346
00:16:59,760 --> 00:17:02,550
files and there is some limitation they

347
00:17:02,550 --> 00:17:05,220
do they have like they limit you not

348
00:17:05,220 --> 00:17:07,020
more than five files in a zip archive

349
00:17:07,020 --> 00:17:10,230
and not more than ten K of data so you

350
00:17:10,230 --> 00:17:12,480
can I cannot deny of like do an engine

351
00:17:12,480 --> 00:17:15,839
out of service so first thing we do is

352
00:17:15,839 --> 00:17:17,670
create a symbolic link inside a zip

353
00:17:17,670 --> 00:17:22,280
archive and that would point to a root

354
00:17:22,280 --> 00:17:26,670
folder and what we get back is a warning

355
00:17:26,670 --> 00:17:28,290
from the system saying that we have

356
00:17:28,290 --> 00:17:30,540
detected sound folders from in the

357
00:17:30,540 --> 00:17:32,040
leaders and folders from your archive

358
00:17:32,040 --> 00:17:34,410
and they use some cyber-enabled

359
00:17:34,410 --> 00:17:36,900
filtering system so this would be a link

360
00:17:36,900 --> 00:17:38,280
so when we click on the link of the

361
00:17:38,280 --> 00:17:40,380
cyber-enabled filtering system we would

362
00:17:40,380 --> 00:17:43,160
have this code this is a PHP code

363
00:17:43,160 --> 00:17:46,530
basically showing us that they traverse

364
00:17:46,530 --> 00:17:48,540
through all the files in the zip archive

365
00:17:48,540 --> 00:17:52,440
and delete and the anything that is not

366
00:17:52,440 --> 00:17:54,390
a file basically a folder or a symbolic

367
00:17:54,390 --> 00:17:58,770
link any ideas how we can bypass the

368
00:17:58,770 --> 00:18:02,720
cyber-enabled filtering system

369
00:18:04,369 --> 00:18:12,809
louder so the the answer is around this

370
00:18:12,809 --> 00:18:15,080
function the globe function this is like

371
00:18:15,080 --> 00:18:17,940
like a listing final function but it's

372
00:18:17,940 --> 00:18:21,389
it doesn't take into account and hidden

373
00:18:21,389 --> 00:18:23,779
files so anything that starts with a dot

374
00:18:23,779 --> 00:18:26,129
wouldn't be captured by the blob

375
00:18:26,129 --> 00:18:28,769
function meaning that all we need to do

376
00:18:28,769 --> 00:18:31,289
is create that same link to symbolic

377
00:18:31,289 --> 00:18:33,419
links to the root folder but this time

378
00:18:33,419 --> 00:18:35,969
we can just use a dot in the beginning

379
00:18:35,969 --> 00:18:40,499
and voila we actually get now to list

380
00:18:40,499 --> 00:18:44,159
the root folder and we can just travel

381
00:18:44,159 --> 00:18:46,679
in the filesystem and find some stuff so

382
00:18:46,679 --> 00:18:48,719
the first thing we find is in the folder

383
00:18:48,719 --> 00:18:52,019
of a home folder and as a script called

384
00:18:52,019 --> 00:18:55,679
create backup of my super secret flag so

385
00:18:55,679 --> 00:18:57,269
this is a script that all it does is

386
00:18:57,269 --> 00:18:59,580
reads the flag from the standard in

387
00:18:59,580 --> 00:19:03,269
input and writes it into the into this

388
00:19:03,269 --> 00:19:05,519
nice QL database so the flag is not here

389
00:19:05,519 --> 00:19:07,619
we hoped that we will find this flag

390
00:19:07,619 --> 00:19:10,109
many of the challenges and in this stage

391
00:19:10,109 --> 00:19:11,969
you can you cannot find the secret file

392
00:19:11,969 --> 00:19:14,399
you find the flag and you submit it to

393
00:19:14,399 --> 00:19:16,919
the system not in this case we actually

394
00:19:16,919 --> 00:19:20,759
see that they just read the the flag

395
00:19:20,759 --> 00:19:24,719
from from the standard input somewhere

396
00:19:24,719 --> 00:19:28,259
here yeah from here and just send it in

397
00:19:28,259 --> 00:19:30,749
a save it into the MySQL database so

398
00:19:30,749 --> 00:19:33,359
this is sort of a hint to us that the

399
00:19:33,359 --> 00:19:34,979
flag is stored in a MySQL database

400
00:19:34,979 --> 00:19:38,129
running as an on the same on the same

401
00:19:38,129 --> 00:19:43,440
machine so we think so what do we know

402
00:19:43,440 --> 00:19:45,450
we we look at the OE and we find another

403
00:19:45,450 --> 00:19:48,149
file index.php this is the core like the

404
00:19:48,149 --> 00:19:51,570
functionality of the actual challenge so

405
00:19:51,570 --> 00:19:53,969
it does all sort of checks on the URL

406
00:19:53,969 --> 00:19:56,609
basically blocking you from from

407
00:19:56,609 --> 00:19:59,309
accessing localhost and some weird other

408
00:19:59,309 --> 00:20:02,580
with things it gets the content of the

409
00:20:02,580 --> 00:20:04,830
file using lip curl so this is a PHP

410
00:20:04,830 --> 00:20:07,320
code but it uses lip curl to download

411
00:20:07,320 --> 00:20:11,129
the file we provided the URL it saves it

412
00:20:11,129 --> 00:20:11,690
to this

413
00:20:11,690 --> 00:20:14,690
it checks saved archive is valid and if

414
00:20:14,690 --> 00:20:16,940
it's like has less than five files and

415
00:20:16,940 --> 00:20:20,690
10k extracted and then we have seen it

416
00:20:20,690 --> 00:20:22,940
deletes all everything that is not a

417
00:20:22,940 --> 00:20:28,220
file so so we know that we control the

418
00:20:28,220 --> 00:20:31,399
URL we need to access MySQL server that

419
00:20:31,399 --> 00:20:35,509
runs on that same machine and and but

420
00:20:35,509 --> 00:20:37,159
but we see that they block us from

421
00:20:37,159 --> 00:20:38,629
connecting to localhost

422
00:20:38,629 --> 00:20:41,029
so basically what we want is somehow to

423
00:20:41,029 --> 00:20:42,919
connect to local hosts run some SQL

424
00:20:42,919 --> 00:20:45,549
query and then get the flag

425
00:20:45,549 --> 00:20:50,919
so we after a lot of tinkering we

426
00:20:50,919 --> 00:20:54,830
realize this thing we realize that the

427
00:20:54,830 --> 00:20:57,529
library the curl the lip curl library

428
00:20:57,529 --> 00:21:01,399
treats URLs differently than all the PHP

429
00:21:01,399 --> 00:21:03,289
runtime but also all the other runtimes

430
00:21:03,289 --> 00:21:04,970
so basically if you take this

431
00:21:04,970 --> 00:21:07,850
weird-lookin URL and provide it to lip

432
00:21:07,850 --> 00:21:11,570
curl lip curl will take this part but if

433
00:21:11,570 --> 00:21:15,860
you use the URL parsing of any of those

434
00:21:15,860 --> 00:21:17,990
runtimes you would it they would see

435
00:21:17,990 --> 00:21:20,779
google so that's how we could bypass the

436
00:21:20,779 --> 00:21:22,490
first check that prevented us from

437
00:21:22,490 --> 00:21:24,500
connecting to localhost which is like

438
00:21:24,500 --> 00:21:27,169
the actual database so they think we

439
00:21:27,169 --> 00:21:28,970
connect to Google but in reality we

440
00:21:28,970 --> 00:21:31,789
actually go to a local host so again

441
00:21:31,789 --> 00:21:33,080
this is like we're exploiting a

442
00:21:33,080 --> 00:21:35,450
server-side request forgery

443
00:21:35,450 --> 00:21:37,909
vulnerability because they fetch the the

444
00:21:37,909 --> 00:21:42,350
URL we provide and so yeah so this in

445
00:21:42,350 --> 00:21:46,580
this example we use this URL so PHP see

446
00:21:46,580 --> 00:21:49,519
is google.com curls is localhost so

447
00:21:49,519 --> 00:21:52,909
that's good now as some of you might

448
00:21:52,909 --> 00:21:55,460
know lip curl supports much more than

449
00:21:55,460 --> 00:21:58,309
HTTP protocol they support all those

450
00:21:58,309 --> 00:22:00,980
product protocols including a protocol

451
00:22:00,980 --> 00:22:04,519
named gopher so gopher is an interesting

452
00:22:04,519 --> 00:22:09,470
one if you use this URL basically a

453
00:22:09,470 --> 00:22:12,529
provide lip curl with this URL

454
00:22:12,529 --> 00:22:14,779
what it do it will connect to localhost

455
00:22:14,779 --> 00:22:19,129
to port 3306 and will send open a TCP

456
00:22:19,129 --> 00:22:20,060
connection and will

457
00:22:20,060 --> 00:22:22,880
sent this data that everything that is

458
00:22:22,880 --> 00:22:26,330
after the underscore and the underlined

459
00:22:26,330 --> 00:22:29,930
would to the to the server so basically

460
00:22:29,930 --> 00:22:33,530
they give us a way to connect to a MySQL

461
00:22:33,530 --> 00:22:37,790
server and send and send up one packet

462
00:22:37,790 --> 00:22:38,780
to that server

463
00:22:38,780 --> 00:22:42,440
and and and so what we need to do now is

464
00:22:42,440 --> 00:22:44,690
to construct that single packet we can

465
00:22:44,690 --> 00:22:46,790
send and we just looked at the MySQL

466
00:22:46,790 --> 00:22:49,700
protocol and constructed this thing

467
00:22:49,700 --> 00:22:51,590
basically this is the first packet you

468
00:22:51,590 --> 00:22:54,370
send to MySQL and which does the

469
00:22:54,370 --> 00:22:57,530
authentication and then we can send the

470
00:22:57,530 --> 00:23:00,080
SQL query so this would be result in

471
00:23:00,080 --> 00:23:01,820
something like that what you see here is

472
00:23:01,820 --> 00:23:04,880
a gopher and this is the localhost the

473
00:23:04,880 --> 00:23:06,830
MySQL and instance we are connecting

474
00:23:06,830 --> 00:23:09,410
this is the port and this is all this

475
00:23:09,410 --> 00:23:13,670
would include a valid and MySQL protocol

476
00:23:13,670 --> 00:23:16,580
that would open a connection do the

477
00:23:16,580 --> 00:23:18,500
needed authentication with the with the

478
00:23:18,500 --> 00:23:21,170
username and then all this part is an

479
00:23:21,170 --> 00:23:25,430
SQL statement that fetches the flag so

480
00:23:25,430 --> 00:23:28,220
the tricky part here is that this thing

481
00:23:28,220 --> 00:23:31,040
when we when we take this and provide it

482
00:23:31,040 --> 00:23:35,240
to our service and the service expects

483
00:23:35,240 --> 00:23:38,300
to get a zip file not and not a string

484
00:23:38,300 --> 00:23:41,330
of with a flag so because the next step

485
00:23:41,330 --> 00:23:43,280
that would happen is that the zip file

486
00:23:43,280 --> 00:23:46,310
needs to be extracted so we had to

487
00:23:46,310 --> 00:23:49,490
encode in into the SQL statement the

488
00:23:49,490 --> 00:23:51,470
actual format of a valid zip file what

489
00:23:51,470 --> 00:23:53,660
you would see here is that pkzip like

490
00:23:53,660 --> 00:23:55,340
it's it's it's an actual zip file and

491
00:23:55,340 --> 00:23:59,390
somewhere here would be this flag ok

492
00:23:59,390 --> 00:24:01,400
here we can see inside we would we would

493
00:24:01,400 --> 00:24:05,210
build a zip file and place a flag inside

494
00:24:05,210 --> 00:24:09,170
that zip file so now when we do this

495
00:24:09,170 --> 00:24:12,050
when we provide all this here what we

496
00:24:12,050 --> 00:24:14,780
get is this is a file is a valid file

497
00:24:14,780 --> 00:24:17,270
that one extract that contains a valid

498
00:24:17,270 --> 00:24:19,790
and when it's a valid zip and extract it

499
00:24:19,790 --> 00:24:22,130
contains a file named give me a flag

500
00:24:22,130 --> 00:24:24,440
that's how we called it and when when we

501
00:24:24,440 --> 00:24:27,350
open the flag we would get this this

502
00:24:27,350 --> 00:24:29,000
nice string and that's the flag we would

503
00:24:29,000 --> 00:24:30,320
submit to the

504
00:24:30,320 --> 00:24:35,060
and the system and get some point so in

505
00:24:35,060 --> 00:24:43,880
summary really also like a lot of credit

506
00:24:43,880 --> 00:24:46,160
for for the crazy people that created

507
00:24:46,160 --> 00:24:48,920
this challenge because it's it had so

508
00:24:48,920 --> 00:24:51,080
many things in it it had like you know

509
00:24:51,080 --> 00:24:53,600
the the symbolic link trick that we've

510
00:24:53,600 --> 00:24:54,620
seen with the dot

511
00:24:54,620 --> 00:24:58,040
it had the inconsistency between the

512
00:24:58,040 --> 00:25:00,890
different URL parsers it had the

513
00:25:00,890 --> 00:25:03,290
necessary for our ability that you know

514
00:25:03,290 --> 00:25:06,320
we need to exploit it you need to do

515
00:25:06,320 --> 00:25:09,560
this and there is this funky thing with

516
00:25:09,560 --> 00:25:14,210
the SQL so this was yeah this was the

517
00:25:14,210 --> 00:25:18,520
last the 2017 I think and again this is

518
00:25:18,520 --> 00:25:20,990
when we actually won the first place

519
00:25:20,990 --> 00:25:26,900
again yeah and this time we're moving to

520
00:25:26,900 --> 00:25:31,460
Google City yeah so Google City F once

521
00:25:31,460 --> 00:25:35,030
again jeopardy style it has today it has

522
00:25:35,030 --> 00:25:37,640
two stages the first one is qualifiers

523
00:25:37,640 --> 00:25:40,220
which are totally remote the top ten

524
00:25:40,220 --> 00:25:43,640
qualified teams will go to an on-site

525
00:25:43,640 --> 00:25:47,090
CTF where you are allowed to to get

526
00:25:47,090 --> 00:25:50,300
assistance from home and for the first

527
00:25:50,300 --> 00:25:53,900
time in our experience with CTFs we get

528
00:25:53,900 --> 00:25:57,770
money when we were today we know that is

529
00:25:57,770 --> 00:26:00,800
considered its level it's a complexities

530
00:26:00,800 --> 00:26:03,490
is a pretty high Google are really

531
00:26:03,490 --> 00:26:08,000
really good engineers and they invest a

532
00:26:08,000 --> 00:26:11,180
lot of time on those challenges and we

533
00:26:11,180 --> 00:26:13,000
want to tell her to talk to you about

534
00:26:13,000 --> 00:26:16,490
the challenge called slot machine this

535
00:26:16,490 --> 00:26:18,770
time from a category called how go or

536
00:26:18,770 --> 00:26:22,670
reversing and it's an actual challenge

537
00:26:22,670 --> 00:26:24,610
that it's a challenge that is

538
00:26:24,610 --> 00:26:28,679
actually based on on on a real story of

539
00:26:28,679 --> 00:26:31,620
Russian hackers that file found

540
00:26:31,620 --> 00:26:34,330
basically a random episode around the

541
00:26:34,330 --> 00:26:37,240
vulnerability in in one of the slot

542
00:26:37,240 --> 00:26:42,340
machines in in Vegas and in the casinos

543
00:26:42,340 --> 00:26:44,950
and basically use that crypto

544
00:26:44,950 --> 00:26:49,390
vulnerability to to to win the and to

545
00:26:49,390 --> 00:26:52,590
win some real money so Google and

546
00:26:52,590 --> 00:26:55,360
created a challenge based on this story

547
00:26:55,360 --> 00:26:57,220
we didn't know that back at a time but

548
00:26:57,220 --> 00:27:00,789
the challenge because this was an CTF

549
00:27:00,789 --> 00:27:03,100
final so this was actually on site so

550
00:27:03,100 --> 00:27:06,370
all the ten teams the ten finalists were

551
00:27:06,370 --> 00:27:09,760
on site in London and that's why it was

552
00:27:09,760 --> 00:27:12,399
possible to provide each and every team

553
00:27:12,399 --> 00:27:14,769
with with an actual hardware so they

554
00:27:14,769 --> 00:27:19,809
gave us this little toy toy slot machine

555
00:27:19,809 --> 00:27:23,289
and the first thing we did is open it up

556
00:27:23,289 --> 00:27:25,899
and we found this chip and this was an

557
00:27:25,899 --> 00:27:28,649
atmel atmega chip a micro controller and

558
00:27:28,649 --> 00:27:32,080
that's where they also provided us with

559
00:27:32,080 --> 00:27:35,529
some basic equipment to read the food

560
00:27:35,529 --> 00:27:39,429
firmer from the chip so we did that and

561
00:27:39,429 --> 00:27:42,100
and then we got to the actual River so

562
00:27:42,100 --> 00:27:43,570
that's where the reverse engineering

563
00:27:43,570 --> 00:27:47,679
part started and and basically after

564
00:27:47,679 --> 00:27:50,350
some reverse engineering the two kind of

565
00:27:50,350 --> 00:27:53,080
interesting thing that we found was this

566
00:27:53,080 --> 00:27:58,330
two secret kind of key combinations so

567
00:27:58,330 --> 00:28:01,840
if you if you would on this screen let

568
00:28:01,840 --> 00:28:03,970
me show you on this balance if you would

569
00:28:03,970 --> 00:28:06,789
press the secret combination you would

570
00:28:06,789 --> 00:28:09,760
get to two secret screens first is that

571
00:28:09,760 --> 00:28:11,740
debug screen so we will see it later

572
00:28:11,740 --> 00:28:14,260
what it allows us to do but the other

573
00:28:14,260 --> 00:28:16,960
one is is flag and screen which would

574
00:28:16,960 --> 00:28:18,549
provide us with the first flag so when

575
00:28:18,549 --> 00:28:21,880
we would press this combination we would

576
00:28:21,880 --> 00:28:23,919
actually get the first flag it's

577
00:28:23,919 --> 00:28:26,200
important to say that and while they

578
00:28:26,200 --> 00:28:28,630
provided us with the with a toy slot

579
00:28:28,630 --> 00:28:32,320
machine the actual attacks would be run

580
00:28:32,320 --> 00:28:33,730
against the center

581
00:28:33,730 --> 00:28:36,620
slot machine so every team would need to

582
00:28:36,620 --> 00:28:38,210
do the reverse engineering to understand

583
00:28:38,210 --> 00:28:39,320
the process to understand the

584
00:28:39,320 --> 00:28:40,730
vulnerability but then they would need

585
00:28:40,730 --> 00:28:44,000
to go to an actual central slot machine

586
00:28:44,000 --> 00:28:47,570
and execute the attack so so this would

587
00:28:47,570 --> 00:28:52,010
helped us get the first flag and on the

588
00:28:52,010 --> 00:28:56,060
second flag let you go talk about so on

589
00:28:56,060 --> 00:28:59,360
the second flag when we entered the

590
00:28:59,360 --> 00:29:01,850
second code we get to this screen which

591
00:29:01,850 --> 00:29:05,810
is the developer menu enter Delta we try

592
00:29:05,810 --> 00:29:10,280
to reverse engineer what he does and we

593
00:29:10,280 --> 00:29:14,690
came into a PRNG mechanism PRNG is

594
00:29:14,690 --> 00:29:16,760
absolutely random number generator I

595
00:29:16,760 --> 00:29:19,130
hope you're sitting down there are no

596
00:29:19,130 --> 00:29:23,230
random numbers on cheap microcontrollers

597
00:29:23,230 --> 00:29:29,860
they are actually generated using some

598
00:29:29,860 --> 00:29:33,710
short typically 32 bits random number

599
00:29:33,710 --> 00:29:35,630
that will be generated on the boot time

600
00:29:35,630 --> 00:29:39,650
and since then they will they will

601
00:29:39,650 --> 00:29:43,190
advance the random state using some

602
00:29:43,190 --> 00:29:47,630
simple formula such as this so we were

603
00:29:47,630 --> 00:29:51,730
reverse engineer that that formula and

604
00:29:51,730 --> 00:29:55,130
we came into conclusion that here this

605
00:29:55,130 --> 00:29:58,160
is the mechanism that that handles the

606
00:29:58,160 --> 00:30:00,700
random number generator for that machine

607
00:30:00,700 --> 00:30:03,620
it's really simple simulator this is the

608
00:30:03,620 --> 00:30:05,000
random number generator whenever

609
00:30:05,000 --> 00:30:07,910
whenever you call the run function it

610
00:30:07,910 --> 00:30:11,210
will just advance the random number

611
00:30:11,210 --> 00:30:13,490
generator in state and it will return

612
00:30:13,490 --> 00:30:17,120
some part of that state for the machine

613
00:30:17,120 --> 00:30:21,560
to choose which symbols to display to

614
00:30:21,560 --> 00:30:24,320
draw and on the screen it uses that code

615
00:30:24,320 --> 00:30:27,260
it says okay if it's above some value

616
00:30:27,260 --> 00:30:30,050
it's a seven otherwise it's it's a long

617
00:30:30,050 --> 00:30:31,640
if it's Bob of some other value it's

618
00:30:31,640 --> 00:30:35,390
lemon or otherwise it's a bar those are

619
00:30:35,390 --> 00:30:38,270
the three symbol that this machine drew

620
00:30:38,270 --> 00:30:41,960
on the screen what we wanted to do any

621
00:30:41,960 --> 00:30:46,040
idea how to exploit that

622
00:30:46,040 --> 00:30:51,200
okay we wanted to play the slot machine

623
00:30:51,200 --> 00:30:55,770
five times why five times because within

624
00:30:55,770 --> 00:31:00,240
five times if we will write down what

625
00:31:00,240 --> 00:31:02,700
science we got on the screen we will be

626
00:31:02,700 --> 00:31:06,450
able to understand where we are in that

627
00:31:06,450 --> 00:31:08,520
random number generator State and we

628
00:31:08,520 --> 00:31:11,280
will be able to recover that state and

629
00:31:11,280 --> 00:31:14,549
whenever we recover that state were able

630
00:31:14,549 --> 00:31:17,850
to understand not only where we are but

631
00:31:17,850 --> 00:31:22,410
we are able to to expect the next values

632
00:31:22,410 --> 00:31:24,169
that would return from that state

633
00:31:24,169 --> 00:31:28,470
actually if you remember the screen that

634
00:31:28,470 --> 00:31:33,870
screen then the enter Delta is basically

635
00:31:33,870 --> 00:31:37,169
the Machine asking us how many advances

636
00:31:37,169 --> 00:31:41,580
of the pure energy state you would like

637
00:31:41,580 --> 00:31:44,070
to do and we could say okay instead of

638
00:31:44,070 --> 00:31:47,190
like pulling the lever 100 times we

639
00:31:47,190 --> 00:31:49,440
could just write down 100 and it will

640
00:31:49,440 --> 00:31:53,040
advance that state for us so our plan

641
00:31:53,040 --> 00:31:57,299
was to understand our current state

642
00:31:57,299 --> 00:31:59,100
based on playing the machine for like

643
00:31:59,100 --> 00:32:02,309
five times and now and now when we have

644
00:32:02,309 --> 00:32:03,960
the stage we can calculate the distance

645
00:32:03,960 --> 00:32:06,630
between our current state and where we

646
00:32:06,630 --> 00:32:10,140
want to be to advance it right to the

647
00:32:10,140 --> 00:32:12,600
point where we would expect that three

648
00:32:12,600 --> 00:32:17,100
times this the seven symbol will we'll

649
00:32:17,100 --> 00:32:22,290
get out of the random and on the next

650
00:32:22,290 --> 00:32:24,240
pull of the lever we will just win the

651
00:32:24,240 --> 00:32:30,210
slot machine yeah you can press and it

652
00:32:30,210 --> 00:32:38,160
should play yeah yeah yeah it work so

653
00:32:38,160 --> 00:32:40,380
basically yeah that's where that's after

654
00:32:40,380 --> 00:32:42,330
you would enter the Delta and we

655
00:32:42,330 --> 00:32:44,429
basically jumped to the place where it's

656
00:32:44,429 --> 00:32:47,429
beta the next play would give you seven

657
00:32:47,429 --> 00:32:48,929
seven seven so that's that's the

658
00:32:48,929 --> 00:32:51,450
solution and then the flag and then the

659
00:32:51,450 --> 00:32:51,860
flag

660
00:32:51,860 --> 00:32:55,030
[Applause]

661
00:32:57,029 --> 00:33:01,299
cool so so so that's our Google City of

662
00:33:01,299 --> 00:33:03,460
history we actually the first time

663
00:33:03,460 --> 00:33:05,139
Google started doing the city of Zoar

664
00:33:05,139 --> 00:33:08,409
2016 so that's where we won the first

665
00:33:08,409 --> 00:33:10,929
place and then a year after then we took

666
00:33:10,929 --> 00:33:13,450
the third place and another Israeli team

667
00:33:13,450 --> 00:33:15,909
and took the second one so five BC is an

668
00:33:15,909 --> 00:33:18,190
awesome Israeli team that gives us

669
00:33:18,190 --> 00:33:21,519
always gives us a good fight and and

670
00:33:21,519 --> 00:33:25,529
this year we just this night we had the

671
00:33:25,529 --> 00:33:28,480
qualifiers so anyone here played the

672
00:33:28,480 --> 00:33:32,619
Google CTF qualifiers okay some hands

673
00:33:32,619 --> 00:33:35,440
here cool so it is this morning 3 a.m.

674
00:33:35,440 --> 00:33:37,840
this morning and qualifiers ended so we

675
00:33:37,840 --> 00:33:39,940
actually took the first place in the

676
00:33:39,940 --> 00:33:42,309
qualifiers all of the 10 teams I believe

677
00:33:42,309 --> 00:33:44,230
right this is the 10th 10 teams would go

678
00:33:44,230 --> 00:33:48,850
to the finals and yeah there's also

679
00:33:48,850 --> 00:33:52,359
another Israeli team down there so

680
00:33:52,359 --> 00:33:54,879
actually and we thought that we would

681
00:33:54,879 --> 00:33:57,309
finish here but we have some time so

682
00:33:57,309 --> 00:34:00,279
I'll skip we have some hidden slides at

683
00:34:00,279 --> 00:34:02,799
the end of the door of the deck so I

684
00:34:02,799 --> 00:34:04,299
think we have some time to talk about

685
00:34:04,299 --> 00:34:08,020
DEFCON CTF as well so and then I'll go

686
00:34:08,020 --> 00:34:11,559
back to the to the final slide so since

687
00:34:11,559 --> 00:34:16,059
we won since we want the CCC CTF and we

688
00:34:16,059 --> 00:34:18,489
automatically got qualified to have to

689
00:34:18,489 --> 00:34:21,369
play in the DEFCON CTF which is the

690
00:34:21,369 --> 00:34:25,980
biggest attack defense type CTF it's

691
00:34:25,980 --> 00:34:28,389
it's different it's completely different

692
00:34:28,389 --> 00:34:30,429
from what we experienced before it's as

693
00:34:30,429 --> 00:34:32,199
I said it's a type defence it's on site

694
00:34:32,199 --> 00:34:36,219
on in Vegas during the DEFCON conference

695
00:34:36,219 --> 00:34:38,770
it runs three days so basically it while

696
00:34:38,770 --> 00:34:40,359
the transferee does it's it's it's only

697
00:34:40,359 --> 00:34:43,418
a day time so starts in the morning and

698
00:34:43,418 --> 00:34:44,230
then

699
00:34:44,230 --> 00:34:46,270
and and in the evening for three days in

700
00:34:46,270 --> 00:34:51,310
a row it has 15 teams no prices and and

701
00:34:51,310 --> 00:34:55,480
the level is is super super high so the

702
00:34:55,480 --> 00:34:58,420
idea with the attack-defence CTF is that

703
00:34:58,420 --> 00:35:02,230
all the 15 teams have their own services

704
00:35:02,230 --> 00:35:03,850
if they start in the same state

705
00:35:03,850 --> 00:35:06,640
everybody has the same services and to

706
00:35:06,640 --> 00:35:09,430
operate and then all you need to do is

707
00:35:09,430 --> 00:35:12,010
to reverse-engineer those services find

708
00:35:12,010 --> 00:35:15,970
vulnerabilities attack the other teams

709
00:35:15,970 --> 00:35:18,010
with the viability as you found and at

710
00:35:18,010 --> 00:35:20,470
the same time protect your services from

711
00:35:20,470 --> 00:35:23,320
being attacked while all this happens

712
00:35:23,320 --> 00:35:25,510
everybody could see everyone's and

713
00:35:25,510 --> 00:35:27,970
network traffic so you could steal

714
00:35:27,970 --> 00:35:29,260
vulnerabilities you could see if

715
00:35:29,260 --> 00:35:31,750
somebody attacks you and you know still

716
00:35:31,750 --> 00:35:35,230
vulnerability so and then patch it or

717
00:35:35,230 --> 00:35:36,550
for example if you find a vulnerability

718
00:35:36,550 --> 00:35:38,470
you have a dilemma whether you go and

719
00:35:38,470 --> 00:35:40,270
attack with it or you first patch

720
00:35:40,270 --> 00:35:42,820
yourself or do both so it's it's it's

721
00:35:42,820 --> 00:35:45,970
like a completely different challenge

722
00:35:45,970 --> 00:35:48,550
and and there is some really different

723
00:35:48,550 --> 00:35:51,070
skills that are needed beyond the

724
00:35:51,070 --> 00:35:55,109
finding and exploiting a vulnerability

725
00:35:55,530 --> 00:36:00,490
so so yeah that I mentioned you oh and

726
00:36:00,490 --> 00:36:02,140
one important thing is that when you

727
00:36:02,140 --> 00:36:03,850
protect your service so for example you

728
00:36:03,850 --> 00:36:06,940
can you know you can add some protection

729
00:36:06,940 --> 00:36:08,560
mechanism to your service but the idea

730
00:36:08,560 --> 00:36:10,810
is if it becomes too slow you start

731
00:36:10,810 --> 00:36:13,030
losing points so you cannot just go and

732
00:36:13,030 --> 00:36:16,300
implement all the possible buffer

733
00:36:16,300 --> 00:36:18,250
overflow protection in your code and

734
00:36:18,250 --> 00:36:21,160
then and just around the service because

735
00:36:21,160 --> 00:36:23,470
it just becomes slow they dope the the

736
00:36:23,470 --> 00:36:26,920
the organizers constantly ping in your

737
00:36:26,920 --> 00:36:29,320
service to make sure it functions so you

738
00:36:29,320 --> 00:36:31,359
like in the real world you need to find

739
00:36:31,359 --> 00:36:32,800
the balance between protecting your

740
00:36:32,800 --> 00:36:36,040
service and keeping it functional so

741
00:36:36,040 --> 00:36:37,960
this is how it looks like in the actual

742
00:36:37,960 --> 00:36:40,210
ctrl

743
00:36:40,210 --> 00:36:43,180
this is this is our table here I think

744
00:36:43,180 --> 00:36:44,800
they are they limit the number of

745
00:36:44,800 --> 00:36:47,910
players on the actual tables to eight

746
00:36:47,910 --> 00:36:53,619
and they really have some nice

747
00:36:53,619 --> 00:36:57,070
visualization when one team managed to

748
00:36:57,070 --> 00:36:59,530
exploit a vulnerability for the first

749
00:36:59,530 --> 00:37:02,460
time so they have this first blood

750
00:37:02,460 --> 00:37:05,619
visuals running all over this the the

751
00:37:05,619 --> 00:37:10,270
screens there and yeah and that the

752
00:37:10,270 --> 00:37:12,089
first time we came there was I think

753
00:37:12,089 --> 00:37:16,000
2016 and that's where the FIR also the

754
00:37:16,000 --> 00:37:18,040
first time when they ran what's called

755
00:37:18,040 --> 00:37:19,750
the cyber Grand Challenge which is a

756
00:37:19,750 --> 00:37:22,080
different type of CTF ran between

757
00:37:22,080 --> 00:37:24,880
machines computers only no humans

758
00:37:24,880 --> 00:37:27,010
involved the humans are involved only in

759
00:37:27,010 --> 00:37:29,859
building those machines and so this is

760
00:37:29,859 --> 00:37:33,220
also a type defence CTF so so each

761
00:37:33,220 --> 00:37:36,940
machine needs to try to attack other

762
00:37:36,940 --> 00:37:40,000
services and protect the service from

763
00:37:40,000 --> 00:37:43,330
from the attacks of other teams and it

764
00:37:43,330 --> 00:37:45,550
runs for several hours if there were

765
00:37:45,550 --> 00:37:47,950
eight teams and the price was two

766
00:37:47,950 --> 00:37:49,480
million dollars so this is a serious

767
00:37:49,480 --> 00:37:53,560
serious price so this is how it looks

768
00:37:53,560 --> 00:37:56,260
like it is this is beggars day they know

769
00:37:56,260 --> 00:38:00,250
how to put a show and what you see here

770
00:38:00,250 --> 00:38:01,930
on the screen also is like the actual

771
00:38:01,930 --> 00:38:05,170
visualizations of the attacks so pretty

772
00:38:05,170 --> 00:38:07,570
cool like it you could actually see how

773
00:38:07,570 --> 00:38:09,460
each machine would try to find the

774
00:38:09,460 --> 00:38:11,440
vulnerability and and to touch against

775
00:38:11,440 --> 00:38:14,109
it or to exploit it so all the machines

776
00:38:14,109 --> 00:38:16,390
are here they look like those super

777
00:38:16,390 --> 00:38:18,160
computers which are they are and did

778
00:38:18,160 --> 00:38:21,490
super-strong and all the arena here all

779
00:38:21,490 --> 00:38:24,339
this area is fully air-gapped the only

780
00:38:24,339 --> 00:38:26,530
thing that goes inside is electricity

781
00:38:26,530 --> 00:38:30,089
and water cooling that's all and then

782
00:38:30,089 --> 00:38:33,839
the operation computer inside the arena

783
00:38:33,839 --> 00:38:36,550
produces logs that they burn into a DVD

784
00:38:36,550 --> 00:38:38,650
and there is like this robotic arm that

785
00:38:38,650 --> 00:38:42,289
passes the DVD into to the common

786
00:38:42,289 --> 00:38:44,660
taters they take the DVD they put it in

787
00:38:44,660 --> 00:38:46,489
their computer and kind of show and

788
00:38:46,489 --> 00:38:48,469
analyze what's going on inside the arena

789
00:38:48,469 --> 00:38:53,539
and so so the interesting thing is that

790
00:38:53,539 --> 00:38:55,849
this CTF was held one day before our

791
00:38:55,849 --> 00:38:59,239
like the big DEFCON CTF and the winner

792
00:38:59,239 --> 00:39:01,249
of this competition like the comedy

793
00:39:01,249 --> 00:39:02,509
machine that would win this competition

794
00:39:02,509 --> 00:39:04,519
would also compete against the human

795
00:39:04,519 --> 00:39:09,439
teams so so so the machine that this is

796
00:39:09,439 --> 00:39:12,709
the mini the winning machine mayhem from

797
00:39:12,709 --> 00:39:16,009
a company named for all secure and and

798
00:39:16,009 --> 00:39:19,009
so in the actual DEFCON CTF again

799
00:39:19,009 --> 00:39:20,779
reminding you first time there is a

800
00:39:20,779 --> 00:39:23,900
machine competing against humans and so

801
00:39:23,900 --> 00:39:26,239
they lost they was they were in the last

802
00:39:26,239 --> 00:39:29,299
place but there were some challenges

803
00:39:29,299 --> 00:39:33,140
that they did like best really outplayed

804
00:39:33,140 --> 00:39:35,479
all the human teams including in

805
00:39:35,479 --> 00:39:37,130
fetching vulnerabilities but also

806
00:39:37,130 --> 00:39:39,049
exploiting so there is like some really

807
00:39:39,049 --> 00:39:40,959
really crazy and awesome things to see

808
00:39:40,959 --> 00:39:45,650
in there and so that's yeah that's the

809
00:39:45,650 --> 00:39:51,259
cyber Grand Challenge and I'll jump back

810
00:39:51,259 --> 00:39:55,039
to the slides and I believe we actually

811
00:39:55,039 --> 00:40:00,589
have some some time for questions so

812
00:40:00,589 --> 00:40:04,659
finally and yeah CTFs are awesome and

813
00:40:04,659 --> 00:40:07,519
this this desert this became very

814
00:40:07,519 --> 00:40:10,459
popular every every conference now now

815
00:40:10,459 --> 00:40:12,529
has them and you don't have to be

816
00:40:12,529 --> 00:40:14,539
actually on site to play those are now

817
00:40:14,539 --> 00:40:17,179
everywhere in and you know like google

818
00:40:17,179 --> 00:40:20,359
CTF and many others actually you just

819
00:40:20,359 --> 00:40:24,589
can join and play from your home really

820
00:40:24,589 --> 00:40:27,199
an amazing place in an amazing community

821
00:40:27,199 --> 00:40:30,669
to to to engage with and learn from so

822
00:40:30,669 --> 00:40:34,039
really if you haven't had ever played a

823
00:40:34,039 --> 00:40:36,559
CTF or solve the single channel a

824
00:40:36,559 --> 00:40:38,749
challenge really really encourage you to

825
00:40:38,749 --> 00:40:43,429
do so yeah and we basically started our

826
00:40:43,429 --> 00:40:44,150
journey

827
00:40:44,150 --> 00:40:46,640
mistake like we didn't plan to become a

828
00:40:46,640 --> 00:40:50,599
real CTF fair team but we really found

829
00:40:50,599 --> 00:40:53,029
out that how amazing it is and and how

830
00:40:53,029 --> 00:40:56,569
fun it is so really would encourage you

831
00:40:56,569 --> 00:41:00,529
all to do the same and really it this is

832
00:41:00,529 --> 00:41:02,390
the time to thank our amazing team we're

833
00:41:02,390 --> 00:41:05,779
the two of us are here but behind us is

834
00:41:05,779 --> 00:41:09,260
an amazing team that and it played with

835
00:41:09,260 --> 00:41:10,309
us all this time

836
00:41:10,309 --> 00:41:13,480
so thank you

837
00:41:16,390 --> 00:41:20,349
to the CTF organisers creating a CTF is

838
00:41:20,349 --> 00:41:22,599
a tough tough tough job it's much harder

839
00:41:22,599 --> 00:41:25,930
than solving challenges and and really

840
00:41:25,930 --> 00:41:28,510
they put a lot of time into intuition

841
00:41:28,510 --> 00:41:30,730
every challenge and into creating the

842
00:41:30,730 --> 00:41:32,980
idea implementing it and then testing it

843
00:41:32,980 --> 00:41:34,930
and they making sure that you don't find

844
00:41:34,930 --> 00:41:38,890
any ways around it so usually the teams

845
00:41:38,890 --> 00:41:40,599
that are competing there are also the

846
00:41:40,599 --> 00:41:43,809
ones creating those challenges so these

847
00:41:43,809 --> 00:41:47,260
are really top-notch security experts of

848
00:41:47,260 --> 00:41:49,539
the world and doing that in all the

849
00:41:49,539 --> 00:41:53,019
cities out there so big thanks to them

850
00:41:53,019 --> 00:41:56,529
and and also to all the teams that are

851
00:41:56,529 --> 00:41:59,019
competing and special shout out to 5dc

852
00:41:59,019 --> 00:42:00,670
that is really the other israeli team

853
00:42:00,670 --> 00:42:04,599
that we met all the time in in the city

854
00:42:04,599 --> 00:42:06,339
Ebsen probably there are many others

855
00:42:06,339 --> 00:42:12,150
that we just don't know so thank you all

856
00:42:15,059 --> 00:42:18,069
we have we have some time for questions

857
00:42:18,069 --> 00:42:19,720
actually quite a lot of time eight

858
00:42:19,720 --> 00:42:25,029
minutes some day so the question is when

859
00:42:25,029 --> 00:42:27,460
are we organizing our own yep yeah

860
00:42:27,460 --> 00:42:28,000
someday

861
00:42:28,000 --> 00:42:30,880
we just we know it's hard we know it

862
00:42:30,880 --> 00:42:34,450
takes a lot of time and we do play now

863
00:42:34,450 --> 00:42:38,289
for like for fun and but definitely on

864
00:42:38,289 --> 00:42:42,539
the horizon to to create our own sphere

865
00:42:52,060 --> 00:42:58,340
yeah good question so the question is

866
00:42:58,340 --> 00:43:00,890
since we got the access to the to the

867
00:43:00,890 --> 00:43:03,590
file system of the of the challenge we

868
00:43:03,590 --> 00:43:05,780
could just go to the bar

869
00:43:05,780 --> 00:43:07,910
something director of mice QL and just

870
00:43:07,910 --> 00:43:10,190
download special stories of the my skill

871
00:43:10,190 --> 00:43:12,560
and the answer is that the the service

872
00:43:12,560 --> 00:43:15,200
run says it's an Apache service and in

873
00:43:15,200 --> 00:43:18,440
France with the permissions of web or

874
00:43:18,440 --> 00:43:19,940
web booth or something like that

875
00:43:19,940 --> 00:43:22,670
and it's not the permissions like we

876
00:43:22,670 --> 00:43:25,280
were in route to access those files this

877
00:43:25,280 --> 00:43:26,900
is actually the first thing we tried

878
00:43:26,900 --> 00:43:29,270
with oh we went to those folders and try

879
00:43:29,270 --> 00:43:32,710
to take the files and

880
00:43:33,960 --> 00:43:37,019
[Music]

881
00:43:42,890 --> 00:43:45,890
No

882
00:43:48,930 --> 00:43:51,150
last question otherwise we'll have to

883
00:43:51,150 --> 00:44:05,190
drink so we're we're all in this area

884
00:44:05,190 --> 00:44:09,120
like we were doing research in our in

885
00:44:09,120 --> 00:44:11,130
our work in our background that's what

886
00:44:11,130 --> 00:44:14,550
we do but I think we never we never we

887
00:44:14,550 --> 00:44:16,800
never played the sit here before 2013

888
00:44:16,800 --> 00:44:18,240
and there is a lot of things we learn

889
00:44:18,240 --> 00:44:21,480
while playing CTF so yeah one more thing

890
00:44:21,480 --> 00:44:23,100
to understand it the city of Zoar for

891
00:44:23,100 --> 00:44:25,740
every one you have challenges for every

892
00:44:25,740 --> 00:44:28,140
level that you're in so from beginners

893
00:44:28,140 --> 00:44:33,420
to to the most advanced researchers yeah

894
00:44:33,420 --> 00:44:36,180
so so we did learn some things about how

895
00:44:36,180 --> 00:44:39,620
to play the CTF games for example and

896
00:44:39,620 --> 00:44:43,520
it's we had we had some challenge where

897
00:44:43,520 --> 00:44:46,170
we actually didn't have that wanted but

898
00:44:46,170 --> 00:44:47,940
didn't have the time to show where it

899
00:44:47,940 --> 00:44:50,940
was a simple web challenge with some

900
00:44:50,940 --> 00:44:53,220
cross-site scripting but we didn't find

901
00:44:53,220 --> 00:44:54,660
the cross-site scripting vulnerability

902
00:44:54,660 --> 00:44:56,340
and there was some operational problem

903
00:44:56,340 --> 00:44:58,080
with the challenge it wasn't running at

904
00:44:58,080 --> 00:45:00,780
some point so by mistake we we took over

905
00:45:00,780 --> 00:45:02,370
the whole server like we found a

906
00:45:02,370 --> 00:45:04,200
different ability that they didn't want

907
00:45:04,200 --> 00:45:08,100
to us to find and now we understand that

908
00:45:08,100 --> 00:45:11,010
we like now we have some better gut

909
00:45:11,010 --> 00:45:12,990
feeling of where this shouldn't happen

910
00:45:12,990 --> 00:45:15,690
because when x challenge is in the web

911
00:45:15,690 --> 00:45:18,870
category and it's like you know marked

912
00:45:18,870 --> 00:45:22,350
easy and and we just can solve it

913
00:45:22,350 --> 00:45:24,390
probably there is something basic we're

914
00:45:24,390 --> 00:45:26,250
missing and not some crazy

915
00:45:26,250 --> 00:45:28,050
vulnerabilities so so the fun thing

916
00:45:28,050 --> 00:45:29,370
about this crazy vulnerability we did

917
00:45:29,370 --> 00:45:31,500
find that wasn't intended is that the

918
00:45:31,500 --> 00:45:33,330
next year they actually turned it in

919
00:45:33,330 --> 00:45:36,180
turned it into a real challenge Howard

920
00:45:36,180 --> 00:45:38,760
won and so that when we got the score

921
00:45:38,760 --> 00:45:40,890
for free because we already knew it but

922
00:45:40,890 --> 00:45:42,570
but that's the kind of thing will you

923
00:45:42,570 --> 00:45:44,010
learn when you play CTF you kind of

924
00:45:44,010 --> 00:45:46,230
learn this like the mindset and the

925
00:45:46,230 --> 00:45:48,360
things you should do and you shouldn't

926
00:45:48,360 --> 00:45:49,849
do

927
00:45:49,849 --> 00:45:52,190
and while playing so that's that's a

928
00:45:52,190 --> 00:45:56,079
skill kind of like the muscle we develop

929
00:45:59,199 --> 00:46:02,329
preferences the very either works well

930
00:46:02,329 --> 00:46:05,680
in Windows but everything else is not

931
00:46:05,680 --> 00:46:08,599
yeah it really depends really like yeah

932
00:46:08,599 --> 00:46:12,019
we have a like we're quite a diverse

933
00:46:12,019 --> 00:46:14,660
group of people were around 25 people

934
00:46:14,660 --> 00:46:17,119
everybody has their own preference and

935
00:46:17,119 --> 00:46:25,940
machine yeah what makes a bad challenge

936
00:46:25,940 --> 00:46:28,369
Wow

937
00:46:28,369 --> 00:46:35,630
I would say the guy is listening I would

938
00:46:35,630 --> 00:46:38,299
say that when you have to guess more

939
00:46:38,299 --> 00:46:42,049
than to get the information out of the

940
00:46:42,049 --> 00:46:44,420
of the server out of the challenge then

941
00:46:44,420 --> 00:46:46,459
it's really frustrating because it's

942
00:46:46,459 --> 00:46:48,680
really easy to not get it right and

943
00:46:48,680 --> 00:46:51,469
there are channel they go yeah yeah

944
00:46:51,469 --> 00:46:53,599
basically when yeah basically when that

945
00:46:53,599 --> 00:46:56,299
when you're not measured by your skill

946
00:46:56,299 --> 00:47:00,009
but more by your guessing capabilities

947
00:47:00,009 --> 00:47:03,430
all right so

