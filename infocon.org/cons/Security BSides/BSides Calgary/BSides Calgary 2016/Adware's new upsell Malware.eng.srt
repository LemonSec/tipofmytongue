1
00:00:03,530 --> 00:00:07,310
alright so we're running just a couple

2
00:00:05,660 --> 00:00:10,099
minutes behind here but like to

3
00:00:07,310 --> 00:00:11,780
introduce you to Ross Gib and Veronica

4
00:00:10,099 --> 00:00:16,550
Valero's will be talking about AdWords

5
00:00:11,780 --> 00:00:20,840
new upsell malware thanks d welcome

6
00:00:16,550 --> 00:00:22,700
everyone thanks for coming it feels to

7
00:00:20,840 --> 00:00:26,480
me like we're in the home stretch which

8
00:00:22,700 --> 00:00:28,939
feels good one thing about these kind of

9
00:00:26,480 --> 00:00:30,230
things is when it runs as smoothly it's

10
00:00:28,940 --> 00:00:32,509
because a lot of volunteers and hard

11
00:00:30,230 --> 00:00:40,429
work leading up so thanks to everyone

12
00:00:32,509 --> 00:00:42,109
that for their contributions ok we're

13
00:00:40,429 --> 00:00:44,929
going to tell you a bit of a kind of a

14
00:00:42,109 --> 00:00:48,050
story about a piece of malware we

15
00:00:44,929 --> 00:00:50,210
discovered as well as how it kind of

16
00:00:48,050 --> 00:00:54,649
fits into an ecosystem of existing

17
00:00:50,210 --> 00:00:58,219
adware and malware it's about changing

18
00:00:54,649 --> 00:01:00,760
dns settings on infected machines we had

19
00:00:58,219 --> 00:01:03,679
a classification issue at the beginning

20
00:01:00,760 --> 00:01:06,649
and once we had a classified and we had

21
00:01:03,679 --> 00:01:08,630
his capabilities we we kind of a

22
00:01:06,650 --> 00:01:11,060
investigate its infrastructure and what

23
00:01:08,630 --> 00:01:13,490
it was actually trying to do as far as

24
00:01:11,060 --> 00:01:16,640
monetization goes and we'll kind of wrap

25
00:01:13,490 --> 00:01:18,949
up some thoughts at the end just

26
00:01:16,640 --> 00:01:22,549
introduce myself briefly I work on the

27
00:01:18,950 --> 00:01:25,880
research and efficacy team at Cisco on

28
00:01:22,549 --> 00:01:29,479
its first Cisco's some of their endpoint

29
00:01:25,880 --> 00:01:32,270
products so the if you're at the last

30
00:01:29,479 --> 00:01:34,630
talk the the products that Dave stalking

31
00:01:32,270 --> 00:01:38,649
is talking about is one of those

32
00:01:34,630 --> 00:01:40,609
Veronica actually work on the team that

33
00:01:38,649 --> 00:01:43,789
looks into it when the product falls

34
00:01:40,609 --> 00:01:46,250
down so we're kind of aware that the

35
00:01:43,789 --> 00:01:48,710
product doesn't catch everything so we

36
00:01:46,250 --> 00:01:52,070
do the legwork after the fact to improve

37
00:01:48,710 --> 00:01:54,139
it and see where we miss things um I

38
00:01:52,070 --> 00:01:55,908
love closure there's unfortunately no

39
00:01:54,140 --> 00:01:56,869
closure in this talk but if anyone's

40
00:01:55,909 --> 00:01:59,210
doing anything interesting the closure

41
00:01:56,869 --> 00:02:02,420
I'd love to talk about it and CTFs when

42
00:01:59,210 --> 00:02:03,678
I have time so actually Veronica is

43
00:02:02,420 --> 00:02:05,240
going to get us started so it's my

44
00:02:03,679 --> 00:02:07,640
pleasure to introduce of Veronica

45
00:02:05,240 --> 00:02:13,210
valorous she is at the Prague cisco

46
00:02:07,640 --> 00:02:13,210
office and she'll start us thank you

47
00:02:13,780 --> 00:02:19,920
okay so

48
00:02:16,080 --> 00:02:22,980
ah it's really nice to hear I come from

49
00:02:19,920 --> 00:02:26,790
bronx czech republic so I'm still

50
00:02:22,980 --> 00:02:29,489
adjusting my brain to time zones I am a

51
00:02:26,790 --> 00:02:33,209
manual researcher I work for cisco

52
00:02:29,490 --> 00:02:36,210
cognitive Stradella tix basically my day

53
00:02:33,210 --> 00:02:38,850
today is analyzing the door traffic from

54
00:02:36,210 --> 00:02:42,090
the behavioral point of view like I

55
00:02:38,850 --> 00:02:46,530
should look at proxy locks mostly out

56
00:02:42,090 --> 00:02:49,220
all day untie the point which with which

57
00:02:46,530 --> 00:02:51,690
things are mulling which know I have

58
00:02:49,220 --> 00:02:54,540
some background in machine learning and

59
00:02:51,690 --> 00:03:03,209
I'll a Piton wardriving lock picking and

60
00:02:54,540 --> 00:03:05,640
I also I'm a soccer player so so okay so

61
00:03:03,209 --> 00:03:07,950
let's talk about dns change and how we

62
00:03:05,640 --> 00:03:09,809
discover it and i'm going to talk

63
00:03:07,950 --> 00:03:13,170
briefly about what our product does

64
00:03:09,810 --> 00:03:16,200
because that's all product discover the

65
00:03:13,170 --> 00:03:19,140
exchanger so cognitive is red analytics

66
00:03:16,200 --> 00:03:22,230
is a kind of layered machine learning

67
00:03:19,140 --> 00:03:25,940
cloud-based solution for detection and

68
00:03:22,230 --> 00:03:29,940
that sounds pretty nice but in reality

69
00:03:25,940 --> 00:03:31,500
this is what we do basically we work on

70
00:03:29,940 --> 00:03:34,769
the after phase of the attacks that

71
00:03:31,500 --> 00:03:38,700
means that our input or the input of our

72
00:03:34,769 --> 00:03:43,170
system is a web request HTTP HTTPS and

73
00:03:38,700 --> 00:03:45,000
it means that if we see the traffic you

74
00:03:43,170 --> 00:03:46,859
are already bridge everything you have

75
00:03:45,000 --> 00:03:48,570
in place already fail that's why I'm

76
00:03:46,860 --> 00:03:51,170
seeing the traffic of the walnuts or the

77
00:03:48,570 --> 00:03:53,609
mal world right so it's good fun and

78
00:03:51,170 --> 00:03:57,329
every layer of machine learning what it

79
00:03:53,610 --> 00:03:59,670
does is to discard tons of traffic that

80
00:03:57,330 --> 00:04:02,160
is normal because we get more than two

81
00:03:59,670 --> 00:04:05,280
million requests per day and that's not

82
00:04:02,160 --> 00:04:08,850
humanly possible to look at even if I I

83
00:04:05,280 --> 00:04:10,950
try to do that it's not possible so our

84
00:04:08,850 --> 00:04:13,380
product what it does is just every liar

85
00:04:10,950 --> 00:04:15,810
discards everything that looks normal

86
00:04:13,380 --> 00:04:17,640
and looks for things that are malicious

87
00:04:15,810 --> 00:04:20,130
and then it's just keeping the most

88
00:04:17,640 --> 00:04:23,000
malicious more malicious and what I

89
00:04:20,130 --> 00:04:25,820
actually do is to I'm on the on the

90
00:04:23,000 --> 00:04:27,980
end of the only chain and I'm kind of

91
00:04:25,820 --> 00:04:31,400
evaluating the staff and saying okay

92
00:04:27,980 --> 00:04:34,760
this works or not and some in last

93
00:04:31,400 --> 00:04:38,390
December we develop it and deployed a

94
00:04:34,760 --> 00:04:40,130
new classifier is called multi instant

95
00:04:38,390 --> 00:04:42,740
learning classifier I'm not going to

96
00:04:40,130 --> 00:04:45,880
talk about it and the research was led

97
00:04:42,740 --> 00:04:48,350
by one colleague of mine karl bartos and

98
00:04:45,880 --> 00:04:53,810
he wrote a blog about that you can check

99
00:04:48,350 --> 00:04:55,580
the basic concepts behind that and so

100
00:04:53,810 --> 00:04:57,830
what I did is like okay it's been

101
00:04:55,580 --> 00:05:01,609
running for some weeks let's take a look

102
00:04:57,830 --> 00:05:03,830
at it and see what it does so analyzing

103
00:05:01,610 --> 00:05:07,370
one domain at a time is kind of

104
00:05:03,830 --> 00:05:11,870
impossible mostly if you're looking at

105
00:05:07,370 --> 00:05:14,390
lot of traffic so I focus on behaviors

106
00:05:11,870 --> 00:05:17,120
so I just took all the stuff that this

107
00:05:14,390 --> 00:05:20,450
new classifier was was discovering

108
00:05:17,120 --> 00:05:22,160
that's the orange stuff and then I group

109
00:05:20,450 --> 00:05:24,580
the rest of the behavior in like

110
00:05:22,160 --> 00:05:27,830
coherent groups like okay all the yellow

111
00:05:24,580 --> 00:05:31,789
stuff I don't know what it is but it

112
00:05:27,830 --> 00:05:34,039
looks the same so I just put put it in a

113
00:05:31,790 --> 00:05:37,160
category f unknown then I pick another

114
00:05:34,040 --> 00:05:40,490
group of behavior and then I look one

115
00:05:37,160 --> 00:05:44,810
behavior at a time then so that's what I

116
00:05:40,490 --> 00:05:47,090
did and the first behavior the yellow

117
00:05:44,810 --> 00:05:52,880
one looks like this hopefully you can

118
00:05:47,090 --> 00:05:55,849
you can see that so it was a long string

119
00:05:52,880 --> 00:05:57,979
of long URL it was interesting because

120
00:05:55,850 --> 00:06:00,190
it has like three parameters two of them

121
00:05:57,979 --> 00:06:02,780
were sending in coded data which

122
00:06:00,190 --> 00:06:05,780
initially might seem like very 64 but it

123
00:06:02,780 --> 00:06:07,729
wasn't and it wasn't only that

124
00:06:05,780 --> 00:06:10,549
suspicious but the same communication

125
00:06:07,729 --> 00:06:14,120
was going to several different domains

126
00:06:10,550 --> 00:06:17,870
to some my piece that were kind of okay

127
00:06:14,120 --> 00:06:19,910
not very trusted so it was enough to to

128
00:06:17,870 --> 00:06:22,340
keep looking into it and say like okay

129
00:06:19,910 --> 00:06:27,500
what is what it is that doesn't look

130
00:06:22,340 --> 00:06:30,530
like normal so my process of analyzing I

131
00:06:27,500 --> 00:06:32,570
cannot spend days or weeks analyzing

132
00:06:30,530 --> 00:06:36,630
stuff because there is too much so what

133
00:06:32,570 --> 00:06:38,550
I do is like a first fast category

134
00:06:36,630 --> 00:06:41,909
tune of the thread so I got a little

135
00:06:38,550 --> 00:06:44,010
traffic and then I get domains I peace

136
00:06:41,910 --> 00:06:47,250
or whatever I you see that I can get

137
00:06:44,010 --> 00:06:49,530
then I get tied to get hashes and then

138
00:06:47,250 --> 00:06:51,870
try to get signatures and signatures if

139
00:06:49,530 --> 00:06:55,380
they are there it means that antivirus

140
00:06:51,870 --> 00:06:57,440
vendors already see see this thread and

141
00:06:55,380 --> 00:07:01,920
then they just put a name on it and

142
00:06:57,440 --> 00:07:03,390
luckily it's going to be correct so from

143
00:07:01,920 --> 00:07:07,160
signatures but you can get dislike

144
00:07:03,390 --> 00:07:09,870
potential threats and petition threats

145
00:07:07,160 --> 00:07:12,060
allow us to configure the behavior or

146
00:07:09,870 --> 00:07:14,820
expand it or at least have an idea of

147
00:07:12,060 --> 00:07:19,080
the risk of this what we are seeing in

148
00:07:14,820 --> 00:07:23,219
the network so after doing that this is

149
00:07:19,080 --> 00:07:25,140
what we got and this is usually a very

150
00:07:23,220 --> 00:07:26,880
nice picture when you are trying to

151
00:07:25,140 --> 00:07:29,280
categorize a threat coming from the

152
00:07:26,880 --> 00:07:32,969
network because antivirus vendors never

153
00:07:29,280 --> 00:07:35,369
ever ever get a single signature for

154
00:07:32,970 --> 00:07:39,330
something it's like you always all the

155
00:07:35,370 --> 00:07:40,920
time has to lead has a war with 10 or 20

156
00:07:39,330 --> 00:07:45,359
different signatures and you don't know

157
00:07:40,920 --> 00:07:48,060
what it is so it's a problem because I i

158
00:07:45,360 --> 00:07:50,580
can't spend much time on it and I really

159
00:07:48,060 --> 00:07:54,930
want to know what it is but I cannot use

160
00:07:50,580 --> 00:07:57,270
this knowledge like this so I don't know

161
00:07:54,930 --> 00:07:59,880
which thread it is but at least i know

162
00:07:57,270 --> 00:08:02,219
someone some some of these from my

163
00:07:59,880 --> 00:08:05,130
experience so I can kind of crossover

164
00:08:02,220 --> 00:08:07,770
and that usually works most of the time

165
00:08:05,130 --> 00:08:10,590
so I know it's not optimizer pro I know

166
00:08:07,770 --> 00:08:13,609
it's not multiply I know is I don't know

167
00:08:10,590 --> 00:08:16,409
Mickey I don't know what it is ah so

168
00:08:13,610 --> 00:08:19,170
after doing these we get some signatures

169
00:08:16,410 --> 00:08:21,450
and say like okay what is there

170
00:08:19,170 --> 00:08:23,790
something written about these that we

171
00:08:21,450 --> 00:08:27,450
can we can kind of have some lead and

172
00:08:23,790 --> 00:08:32,219
there was some nice log on the summer

173
00:08:27,450 --> 00:08:35,669
just one month after we we start looking

174
00:08:32,219 --> 00:08:37,770
at this sorry 1mon before and they

175
00:08:35,669 --> 00:08:40,079
explained about George on dinama and

176
00:08:37,770 --> 00:08:43,978
that was coming some dns change of

177
00:08:40,080 --> 00:08:46,520
functionalities so so far so good we say

178
00:08:43,979 --> 00:08:49,270
okay this looks like the exchanges on

179
00:08:46,520 --> 00:08:52,160
signatures kind of match at the behavior

180
00:08:49,270 --> 00:08:54,650
but then we started tracking this and

181
00:08:52,160 --> 00:08:58,219
this is what we saw this is kind of the

182
00:08:54,650 --> 00:09:04,459
amount of users I'm between december and

183
00:08:58,220 --> 00:09:06,770
generate we saw a huge spike then we we

184
00:09:04,460 --> 00:09:08,900
started worrying because our system

185
00:09:06,770 --> 00:09:10,810
generated alert and you don't want to

186
00:09:08,900 --> 00:09:14,090
generate others that are not accurate

187
00:09:10,810 --> 00:09:16,849
also we need to put a risk on the

188
00:09:14,090 --> 00:09:18,920
detection and I cannot say to the

189
00:09:16,850 --> 00:09:22,730
customers yeah this is super malware and

190
00:09:18,920 --> 00:09:25,550
a sad one right and we have some AdWords

191
00:09:22,730 --> 00:09:29,060
signatures like PA so we were wondering

192
00:09:25,550 --> 00:09:30,680
like okay is this real malwa or is

193
00:09:29,060 --> 00:09:34,219
something else and that's the point

194
00:09:30,680 --> 00:09:37,790
where we decided to kind of look more on

195
00:09:34,220 --> 00:09:44,320
it and ross is going to explain how he

196
00:09:37,790 --> 00:09:47,839
did it right so what came to my desk was

197
00:09:44,320 --> 00:09:50,870
basically some suspected binaries and

198
00:09:47,840 --> 00:09:54,590
light and the URL patterns that that the

199
00:09:50,870 --> 00:09:56,420
CTA product was detecting so what I'm

200
00:09:54,590 --> 00:09:58,640
going to do for this part is just to

201
00:09:56,420 --> 00:10:02,240
take you kind of threw a workflow of how

202
00:09:58,640 --> 00:10:04,970
I work through this so and it's going to

203
00:10:02,240 --> 00:10:07,910
demonstrate our loud use of sandbox and

204
00:10:04,970 --> 00:10:09,710
kind of where sandbox can let you down

205
00:10:07,910 --> 00:10:12,500
in some ways and where to pick up when

206
00:10:09,710 --> 00:10:14,780
it does so what we're looking at here is

207
00:10:12,500 --> 00:10:18,110
a portion of a sandbox report on the

208
00:10:14,780 --> 00:10:19,910
left here you can see registry keys this

209
00:10:18,110 --> 00:10:21,770
is a process that changed it and this is

210
00:10:19,910 --> 00:10:23,360
what changed so when I looked at the

211
00:10:21,770 --> 00:10:26,390
sandbox report the first thing that

212
00:10:23,360 --> 00:10:29,300
stuck out to me is that a process called

213
00:10:26,390 --> 00:10:31,699
to exe was changing the name server the

214
00:10:29,300 --> 00:10:34,240
system so this is the the location the

215
00:10:31,700 --> 00:10:36,520
registry where the name servers is saved

216
00:10:34,240 --> 00:10:39,020
so right away it was very suspicious

217
00:10:36,520 --> 00:10:41,750
okay so now we're looking at the process

218
00:10:39,020 --> 00:10:45,620
so this is the processes that executed

219
00:10:41,750 --> 00:10:47,690
at runtime so I found to exe is the one

220
00:10:45,620 --> 00:10:49,970
I'm looking for a couple things right

221
00:10:47,690 --> 00:10:52,880
away to notice is the parent so its

222
00:10:49,970 --> 00:10:54,710
parent process ideas 1992 which is the

223
00:10:52,880 --> 00:10:57,320
process just immediately above the

224
00:10:54,710 --> 00:10:59,270
process immediately above its name came

225
00:10:57,320 --> 00:11:00,620
from an automation service so

226
00:10:59,270 --> 00:11:03,829
we have a lot of automation services

227
00:11:00,620 --> 00:11:07,430
that submit samples so that name is not

228
00:11:03,830 --> 00:11:11,270
necessarily attacker chosen but the two

229
00:11:07,430 --> 00:11:12,859
dot exe actually is and here's where the

230
00:11:11,270 --> 00:11:15,290
file existed on disk when it was

231
00:11:12,860 --> 00:11:20,270
executed and it's a its command line

232
00:11:15,290 --> 00:11:24,260
arguments so what I really want is the

233
00:11:20,270 --> 00:11:25,699
two dot exe binary so that again this is

234
00:11:24,260 --> 00:11:27,290
just the disk location where it was and

235
00:11:25,700 --> 00:11:30,800
and this is just showing us that it was

236
00:11:27,290 --> 00:11:36,439
the same process that who's executed it

237
00:11:30,800 --> 00:11:38,750
also created it on disk so knowing this

238
00:11:36,440 --> 00:11:41,330
there's kind of like two big ways that

239
00:11:38,750 --> 00:11:43,910
to dot exe got anything on the system it

240
00:11:41,330 --> 00:11:46,970
was either contained within the original

241
00:11:43,910 --> 00:11:49,699
sample that was submitted or it was

242
00:11:46,970 --> 00:11:51,410
downloaded by the original sample and we

243
00:11:49,700 --> 00:11:53,270
can see also from the sandbox report

244
00:11:51,410 --> 00:11:55,100
that there was a network traffic on the

245
00:11:53,270 --> 00:11:58,340
system when the sample executed and this

246
00:11:55,100 --> 00:12:02,330
is in the the order in which the network

247
00:11:58,340 --> 00:12:04,420
traffic happened so where the sandbox

248
00:12:02,330 --> 00:12:07,130
kind of fell over a little bit is that

249
00:12:04,420 --> 00:12:11,689
too dot exe was deleted at some point

250
00:12:07,130 --> 00:12:14,000
and at the end of a sandbox run we look

251
00:12:11,690 --> 00:12:15,500
on the disk for changes so files that

252
00:12:14,000 --> 00:12:18,320
still exists on disk are usually easy to

253
00:12:15,500 --> 00:12:21,800
pick up ones that were deleted we have a

254
00:12:18,320 --> 00:12:23,300
forensics module that tries to recover

255
00:12:21,800 --> 00:12:25,339
them and in this case it wasn't

256
00:12:23,300 --> 00:12:27,079
available so it doesn't always work but

257
00:12:25,340 --> 00:12:29,590
we have the original executable and we

258
00:12:27,080 --> 00:12:31,490
have the pcap so we have a really good

259
00:12:29,590 --> 00:12:32,660
we're going to be able to get to two da

260
00:12:31,490 --> 00:12:39,080
txt it's just gonna take a little bit of

261
00:12:32,660 --> 00:12:44,209
work so we have the original submitted

262
00:12:39,080 --> 00:12:45,860
sample and it's a it's a windows PE

263
00:12:44,210 --> 00:12:48,470
executable and usually the first thing

264
00:12:45,860 --> 00:12:50,720
you want to do is take a look at the PE

265
00:12:48,470 --> 00:12:52,310
header and structures and CN look for

266
00:12:50,720 --> 00:12:55,400
anomalies that's a that's like a typical

267
00:12:52,310 --> 00:12:57,680
like first step analysis what we're

268
00:12:55,400 --> 00:13:00,650
looking at here in the top image is the

269
00:12:57,680 --> 00:13:02,359
sections of the PE these look real the

270
00:13:00,650 --> 00:13:05,300
names look really normal the only thing

271
00:13:02,360 --> 00:13:07,640
abnormal here is the resources the

272
00:13:05,300 --> 00:13:09,140
resources is enormous this column right

273
00:13:07,640 --> 00:13:12,370
here is telling us the physical size on

274
00:13:09,140 --> 00:13:15,279
disk so right away we know that there's

275
00:13:12,370 --> 00:13:17,500
this binary has resources and resources

276
00:13:15,279 --> 00:13:20,910
are depends on the binary but it can be

277
00:13:17,500 --> 00:13:23,950
stuff like icons images that the

278
00:13:20,910 --> 00:13:26,589
executable needs at runtime so in this

279
00:13:23,950 --> 00:13:28,750
case we I can jump right to the resource

280
00:13:26,589 --> 00:13:30,730
section in the PE and we can see some

281
00:13:28,750 --> 00:13:33,040
familiar strings so anyone who's a

282
00:13:30,730 --> 00:13:36,279
Python developer will probably recognize

283
00:13:33,040 --> 00:13:39,310
Python 27 DLL it's part of the basic

284
00:13:36,279 --> 00:13:43,420
Python install and then a Python script

285
00:13:39,310 --> 00:13:45,699
is the second resource name so I'd

286
00:13:43,420 --> 00:13:48,640
actually seen this before it's this is a

287
00:13:45,700 --> 00:13:51,460
binary that's output by PI to exe if

288
00:13:48,640 --> 00:13:53,650
anyone's ever wanted to create a windows

289
00:13:51,460 --> 00:13:55,450
program executable from a binary from a

290
00:13:53,650 --> 00:13:56,920
Python application that they had and you

291
00:13:55,450 --> 00:13:59,200
can actually see if you're familiar with

292
00:13:56,920 --> 00:14:01,300
what p files look like in hex there's

293
00:13:59,200 --> 00:14:05,110
actually the Python 27 here actually

294
00:14:01,300 --> 00:14:08,290
follows immediately so what we have here

295
00:14:05,110 --> 00:14:11,050
is a Windows executable that has Python

296
00:14:08,290 --> 00:14:13,270
like regular Python dll in the resource

297
00:14:11,050 --> 00:14:15,520
along with a Python script and at

298
00:14:13,270 --> 00:14:19,029
runtime it loads loads of DLL feeds a

299
00:14:15,520 --> 00:14:20,860
Python script in and executes so it's

300
00:14:19,029 --> 00:14:23,830
actually pretty straightforward to get

301
00:14:20,860 --> 00:14:27,160
the Python script back this is what it

302
00:14:23,830 --> 00:14:30,160
looked like and we see sort of classic

303
00:14:27,160 --> 00:14:32,439
malware obfuscation so I've cut a lot of

304
00:14:30,160 --> 00:14:35,650
this this this data string was enormous

305
00:14:32,440 --> 00:14:38,980
there's a really short key there's some

306
00:14:35,650 --> 00:14:42,339
basic base64 decoding a very basic for

307
00:14:38,980 --> 00:14:45,660
loop some more base 464 some

308
00:14:42,339 --> 00:14:48,970
decompression so a very very simple

309
00:14:45,660 --> 00:14:51,699
deification loop and then it uses the

310
00:14:48,970 --> 00:14:54,730
marshal libraries which are a part of

311
00:14:51,700 --> 00:14:56,890
python and these libraries are there

312
00:14:54,730 --> 00:14:59,650
similar to shelve and pickle they

313
00:14:56,890 --> 00:15:02,920
actually ho they're used for serializing

314
00:14:59,650 --> 00:15:06,790
and passing around the actual python by

315
00:15:02,920 --> 00:15:08,949
code they're seldom used but in this

316
00:15:06,790 --> 00:15:12,849
case it's a it's a nice way to load your

317
00:15:08,950 --> 00:15:14,080
malware sort of dynamically the marshal

318
00:15:12,850 --> 00:15:16,690
objects are really is really easy to

319
00:15:14,080 --> 00:15:18,310
dump out the py sees that make up the

320
00:15:16,690 --> 00:15:21,339
Python application so we you know we

321
00:15:18,310 --> 00:15:23,589
dumped those two discs and i'm not i'm

322
00:15:21,339 --> 00:15:25,670
not showing all the files there's

323
00:15:23,589 --> 00:15:29,480
actually 75 of these so it's a full

324
00:15:25,670 --> 00:15:32,839
blown python application so now we've

325
00:15:29,480 --> 00:15:37,610
gone from a single PE executable to a 75

326
00:15:32,840 --> 00:15:39,980
file python application which is not

327
00:15:37,610 --> 00:15:41,120
really a lot of fun because we're facing

328
00:15:39,980 --> 00:15:42,490
the prospect of sifting through all

329
00:15:41,120 --> 00:15:45,590
these files and they're in Python

330
00:15:42,490 --> 00:15:47,330
bytecode form so first thing we want to

331
00:15:45,590 --> 00:15:49,730
do is get them out of python by code

332
00:15:47,330 --> 00:15:52,310
form and I hadn't I hadn't done this I

333
00:15:49,730 --> 00:15:55,190
think since I was a student so I went

334
00:15:52,310 --> 00:15:58,630
looking on the internet for a for a

335
00:15:55,190 --> 00:16:00,620
decompiler the reason I have this open

336
00:15:58,630 --> 00:16:01,760
Jack Daniel talked about kind of

337
00:16:00,620 --> 00:16:03,740
standing on the shoulders John Johnny

338
00:16:01,760 --> 00:16:06,380
 is on the faculty at the University

339
00:16:03,740 --> 00:16:08,900
of Calgary and was a professor of mine

340
00:16:06,380 --> 00:16:10,850
so this tool is not his but it was based

341
00:16:08,900 --> 00:16:12,680
on some of his graduate work so when I

342
00:16:10,850 --> 00:16:14,960
see that I'm like oh I mean I'm in good

343
00:16:12,680 --> 00:16:17,030
hands unfortunately couldn't actually

344
00:16:14,960 --> 00:16:20,450
get this thing to work for some stupid

345
00:16:17,030 --> 00:16:24,980
dependency so I just went to the the

346
00:16:20,450 --> 00:16:27,410
easy oops the easy Python decompiler but

347
00:16:24,980 --> 00:16:28,640
thankfully we're still based on that

348
00:16:27,410 --> 00:16:31,160
that the tool i couldnt get to work

349
00:16:28,640 --> 00:16:34,100
we're still based on that so i'm still

350
00:16:31,160 --> 00:16:36,860
standing on John shoulders so so this

351
00:16:34,100 --> 00:16:39,770
this is super easy this this takes in a

352
00:16:36,860 --> 00:16:44,080
directory and takes the pyc files and

353
00:16:39,770 --> 00:16:47,540
spits out Python so now we have 75

354
00:16:44,080 --> 00:16:49,610
Python natural source files and there

355
00:16:47,540 --> 00:16:52,160
was no obfuscation of the programmer

356
00:16:49,610 --> 00:16:54,550
defined symbols so the symbol names you

357
00:16:52,160 --> 00:16:56,810
see here in one of the files these are

358
00:16:54,550 --> 00:17:00,709
what the program are defined what the

359
00:16:56,810 --> 00:17:06,500
program are defined the mask okay so we

360
00:17:00,710 --> 00:17:08,930
are looking for the to exe still and you

361
00:17:06,500 --> 00:17:10,550
see the 75 files now that you have the

362
00:17:08,930 --> 00:17:15,800
Python source you want to start looking

363
00:17:10,550 --> 00:17:17,810
for high entropy data or domains or

364
00:17:15,800 --> 00:17:19,099
network communication code and it

365
00:17:17,810 --> 00:17:22,220
actually fell out pretty quickly because

366
00:17:19,099 --> 00:17:25,069
if you notice the first a network

367
00:17:22,220 --> 00:17:26,540
request from the sandbox report if you

368
00:17:25,069 --> 00:17:29,300
just grep for this in the Python source

369
00:17:26,540 --> 00:17:30,350
it brought you to this list here so if

370
00:17:29,300 --> 00:17:33,260
you're familiar Python this is a

371
00:17:30,350 --> 00:17:34,820
defining a list so now you can see okay

372
00:17:33,260 --> 00:17:35,960
well they're probably using this domain

373
00:17:34,820 --> 00:17:37,428
in some manner and

374
00:17:35,960 --> 00:17:38,899
you have a Python variable now it's just

375
00:17:37,429 --> 00:17:42,649
a matter of going backwards through the

376
00:17:38,899 --> 00:17:45,320
Python code to see where it's used how

377
00:17:42,649 --> 00:17:48,309
is the request generated how is the

378
00:17:45,320 --> 00:17:51,678
response decoded and move on from there

379
00:17:48,309 --> 00:17:55,520
so there was actually two layers of that

380
00:17:51,679 --> 00:17:57,049
so I just wanted to quickly just kind of

381
00:17:55,520 --> 00:18:00,139
go over the whole process so the

382
00:17:57,049 --> 00:18:01,039
original samples here the MAL were

383
00:18:00,140 --> 00:18:04,010
actually turned out to be something

384
00:18:01,039 --> 00:18:09,500
known called Mamba it's probably named

385
00:18:04,010 --> 00:18:12,289
from this variable right here and so the

386
00:18:09,500 --> 00:18:16,340
first HTTP post to neutral sky down info

387
00:18:12,289 --> 00:18:19,220
brought us back a second Python

388
00:18:16,340 --> 00:18:21,139
application actually an entire probably

389
00:18:19,220 --> 00:18:23,659
75 file python application that was

390
00:18:21,140 --> 00:18:26,840
different from the first one so that was

391
00:18:23,659 --> 00:18:29,570
stage to stage two was then executed

392
00:18:26,840 --> 00:18:33,529
stage two then made an HTTP GET request

393
00:18:29,570 --> 00:18:37,100
to the next domain in the sandbox

394
00:18:33,529 --> 00:18:41,240
network logs and that actually finally

395
00:18:37,100 --> 00:18:44,178
downloaded the two dot exe xq ball road

396
00:18:41,240 --> 00:18:46,399
disk and executed it so this it's a

397
00:18:44,179 --> 00:18:47,510
little bit small but this is the second

398
00:18:46,399 --> 00:18:50,029
stage I'm just showing you that there

399
00:18:47,510 --> 00:18:54,890
was a there was another entire Python

400
00:18:50,029 --> 00:18:57,440
application to go through ok so we

401
00:18:54,890 --> 00:18:59,750
succeeded in getting to to exe so what

402
00:18:57,440 --> 00:19:01,700
did it turn out to be that was the code

403
00:18:59,750 --> 00:19:06,529
that was actually responsible for the

404
00:19:01,700 --> 00:19:08,450
for the DNS changing so it was entirely

405
00:19:06,529 --> 00:19:10,399
in that binary it was a C++ so the the

406
00:19:08,450 --> 00:19:14,690
analysis got quite a bit different after

407
00:19:10,399 --> 00:19:17,299
that it maintains the CNC communication

408
00:19:14,690 --> 00:19:21,049
to update itself and report information

409
00:19:17,299 --> 00:19:23,418
about the about the system that its

410
00:19:21,049 --> 00:19:24,950
installed in and it also contains

411
00:19:23,419 --> 00:19:26,330
backdoor functionality so if it gets a

412
00:19:24,950 --> 00:19:29,480
certain command will actually open up a

413
00:19:26,330 --> 00:19:32,299
port and listen and execute commands it

414
00:19:29,480 --> 00:19:34,909
has a file I'm it's in quotation marks

415
00:19:32,299 --> 00:19:36,940
to file this persistence method I'm

416
00:19:34,909 --> 00:19:40,640
going to show you on the next slide and

417
00:19:36,940 --> 00:19:42,309
the URL ops of obfuscation so the URL

418
00:19:40,640 --> 00:19:44,270
that Vanessa showed at the beginning

419
00:19:42,309 --> 00:19:49,460
sorry Veronica showed at the beginning

420
00:19:44,270 --> 00:19:49,799
is was built by this binary so now we

421
00:19:49,460 --> 00:19:51,989
have

422
00:19:49,799 --> 00:19:53,450
too so we've got what the product

423
00:19:51,989 --> 00:19:56,580
detected originally we found that

424
00:19:53,450 --> 00:20:01,320
executable and we found who's changing

425
00:19:56,580 --> 00:20:03,809
the dns settings so to discuss the the

426
00:20:01,320 --> 00:20:07,980
file in this nature of the malware this

427
00:20:03,809 --> 00:20:09,509
is a way to do file this persistence so

428
00:20:07,980 --> 00:20:11,639
what we're looking at here is a typical

429
00:20:09,509 --> 00:20:16,320
window scheduled task that gets created

430
00:20:11,639 --> 00:20:18,389
and in the run rather than calling an

431
00:20:16,320 --> 00:20:19,860
exe that it's either written to disk or

432
00:20:18,389 --> 00:20:23,519
some kind of script it's actually using

433
00:20:19,860 --> 00:20:25,738
powershell so the dave stock before this

434
00:20:23,519 --> 00:20:27,330
kind of talked about this it's using the

435
00:20:25,739 --> 00:20:30,149
encoded command so it's actually just

436
00:20:27,330 --> 00:20:32,549
passing a powershell script on the

437
00:20:30,149 --> 00:20:36,018
command line through a scheduled task so

438
00:20:32,549 --> 00:20:39,029
the way that this persists is to dot exe

439
00:20:36,019 --> 00:20:40,830
changes the dns settings but doesn't

440
00:20:39,029 --> 00:20:42,659
save itself anywhere on disk so when the

441
00:20:40,830 --> 00:20:44,939
machine gets rebooted to exe doesn't

442
00:20:42,659 --> 00:20:47,309
execute anymore however it also

443
00:20:44,940 --> 00:20:49,619
prioritize eated it created itself a

444
00:20:47,309 --> 00:20:52,320
scheduled task with a PowerShell script

445
00:20:49,619 --> 00:20:53,820
and the PowerShell script just starts up

446
00:20:52,320 --> 00:20:56,340
reaches out to command and control to

447
00:20:53,820 --> 00:20:58,769
download basically updated copies of 2

448
00:20:56,340 --> 00:21:02,209
dot exe so that's it's a persistence

449
00:20:58,769 --> 00:21:04,379
mechanism I call it sort of filus

450
00:21:02,210 --> 00:21:06,299
malware because it's not writing a

451
00:21:04,379 --> 00:21:08,730
script file or an executable file to

452
00:21:06,299 --> 00:21:10,619
disk but it is writing a scheduled task

453
00:21:08,730 --> 00:21:15,029
which if you know how those are created

454
00:21:10,619 --> 00:21:17,850
in Windows it's actually a file so that

455
00:21:15,029 --> 00:21:19,409
that's in contrast with some other file

456
00:21:17,850 --> 00:21:20,879
list malware so this is a different

457
00:21:19,409 --> 00:21:24,749
sample but I want to show this to

458
00:21:20,879 --> 00:21:28,168
contrast in a run key to run you can

459
00:21:24,749 --> 00:21:31,649
actually specify JavaScript rather than

460
00:21:28,169 --> 00:21:33,539
a file on disk so in this case this

461
00:21:31,649 --> 00:21:36,928
malware is creating the run key in the

462
00:21:33,539 --> 00:21:39,450
normal place in current version run but

463
00:21:36,929 --> 00:21:41,190
it's using a JavaScript file you can see

464
00:21:39,450 --> 00:21:42,539
the W script here so windows actually

465
00:21:41,190 --> 00:21:45,450
when it boots it'll read this and

466
00:21:42,539 --> 00:21:48,389
execute it I feel like this is a little

467
00:21:45,450 --> 00:21:49,559
bit more effective method because you

468
00:21:48,389 --> 00:21:51,689
are changing a file and that the

469
00:21:49,559 --> 00:21:53,549
registry hives are obviously on disk but

470
00:21:51,690 --> 00:21:55,350
they already exist so you're not it's

471
00:21:53,549 --> 00:21:57,600
not something net new on the system so I

472
00:21:55,350 --> 00:22:02,039
think I feel like this is a bit better

473
00:21:57,600 --> 00:22:02,830
phallus on mechanism okay and then back

474
00:22:02,039 --> 00:22:04,899
to the office

475
00:22:02,830 --> 00:22:07,570
gated URL parameters so how we all got

476
00:22:04,899 --> 00:22:12,428
started in the CTA data that Veronica

477
00:22:07,570 --> 00:22:14,559
mentioned these were encoded it looks

478
00:22:12,429 --> 00:22:17,559
like base64 and it actually it's a

479
00:22:14,559 --> 00:22:21,399
variant of base64 it's just typical they

480
00:22:17,559 --> 00:22:24,820
they messed and customized the base64

481
00:22:21,399 --> 00:22:27,070
encoding in the c++ binary so there's

482
00:22:24,820 --> 00:22:28,510
not a lot of glamour in reversing this

483
00:22:27,070 --> 00:22:31,539
it's just sort of like slogging through

484
00:22:28,510 --> 00:22:32,919
a bunch of assembly and then once I did

485
00:22:31,539 --> 00:22:35,200
that and had a Python script that was

486
00:22:32,919 --> 00:22:36,010
usable we could decode the encoded

487
00:22:35,200 --> 00:22:37,330
parameters because we're really

488
00:22:36,010 --> 00:22:39,370
interested in what we can tell a

489
00:22:37,330 --> 00:22:42,250
customer is what's being Exel traded or

490
00:22:39,370 --> 00:22:44,649
potentially being excellent rated so

491
00:22:42,250 --> 00:22:47,950
what we're actually seeing is just

492
00:22:44,649 --> 00:22:50,260
system information so this is this is a

493
00:22:47,950 --> 00:22:53,350
hardware ID generated uniquely for them

494
00:22:50,260 --> 00:22:55,720
for the infected system an officer OS ID

495
00:22:53,350 --> 00:22:57,158
for what version of OS and stuff so it's

496
00:22:55,720 --> 00:22:58,659
it's checking in with its command and

497
00:22:57,159 --> 00:23:00,460
control telling it what what it's

498
00:22:58,659 --> 00:23:05,080
infected so we didn't we didn't see any

499
00:23:00,460 --> 00:23:06,970
user names and passwords okay so we

500
00:23:05,080 --> 00:23:08,289
needed to classify this we knew even

501
00:23:06,970 --> 00:23:10,360
from the sandbox that it was changing

502
00:23:08,289 --> 00:23:12,010
the dns settings so it was bad at the

503
00:23:10,360 --> 00:23:15,340
beginning and for these reasons and more

504
00:23:12,010 --> 00:23:18,610
it's it's now we're so it installed with

505
00:23:15,340 --> 00:23:20,289
no user interaction all that all that

506
00:23:18,610 --> 00:23:23,469
office keishon layers and whatnot that's

507
00:23:20,289 --> 00:23:26,649
all typical of malware shady domains and

508
00:23:23,470 --> 00:23:30,730
I didn't I didn't show this but it also

509
00:23:26,649 --> 00:23:32,110
installs a root certificate so that it

510
00:23:30,730 --> 00:23:35,080
can actually do its monetization which

511
00:23:32,110 --> 00:23:36,250
I'm going to show you ok so why did it

512
00:23:35,080 --> 00:23:39,100
go to all this trouble why did it change

513
00:23:36,250 --> 00:23:40,750
your dns settings so it's advertising

514
00:23:39,100 --> 00:23:44,019
naturally right how do you make money on

515
00:23:40,750 --> 00:23:47,260
the internet you advertise so once your

516
00:23:44,019 --> 00:23:50,080
dns settings are changed to the ROK's

517
00:23:47,260 --> 00:23:53,470
the malicious dns server most of your

518
00:23:50,080 --> 00:23:55,720
DNS requests that go to that server are

519
00:23:53,470 --> 00:23:57,909
served back to you correctly so when you

520
00:23:55,720 --> 00:24:00,159
go to look up google com you actually

521
00:23:57,909 --> 00:24:02,350
get an IP address of google.com but

522
00:24:00,159 --> 00:24:05,980
there's a subset of domains most of them

523
00:24:02,350 --> 00:24:07,059
owned by google advertising the portion

524
00:24:05,980 --> 00:24:09,639
of google that deals with advertising

525
00:24:07,059 --> 00:24:11,830
where it does want to alter them so in

526
00:24:09,639 --> 00:24:13,419
those cases the request goes to your

527
00:24:11,830 --> 00:24:16,510
malicious name server

528
00:24:13,420 --> 00:24:18,250
you one of the examples is google google

529
00:24:16,510 --> 00:24:20,260
analytics so when you ask for google

530
00:24:18,250 --> 00:24:22,240
analytics you get an IP address that is

531
00:24:20,260 --> 00:24:24,940
not google analytics it's also attacker

532
00:24:22,240 --> 00:24:26,890
controlled so next you send a get

533
00:24:24,940 --> 00:24:28,420
request to Google Analytics what you

534
00:24:26,890 --> 00:24:30,610
think is google analytics it's

535
00:24:28,420 --> 00:24:32,740
intercepted by the malicious Google

536
00:24:30,610 --> 00:24:34,030
Analytics server who actually proxies

537
00:24:32,740 --> 00:24:35,740
your request to the real one because

538
00:24:34,030 --> 00:24:37,899
they want to return you the real google

539
00:24:35,740 --> 00:24:39,760
analytics data it's just they inject

540
00:24:37,900 --> 00:24:42,190
some JavaScript on the way back so they

541
00:24:39,760 --> 00:24:44,680
have a table list of domains a target

542
00:24:42,190 --> 00:24:46,510
and they have a list of resources that

543
00:24:44,680 --> 00:24:47,680
they know that they can inject into and

544
00:24:46,510 --> 00:24:49,840
there they're basically trying to

545
00:24:47,680 --> 00:24:52,630
replace advertisements that Google's

546
00:24:49,840 --> 00:24:54,250
trying to serve to you with their own so

547
00:24:52,630 --> 00:24:55,750
we can take a quick look this is

548
00:24:54,250 --> 00:24:58,330
actually what they're trying to inject

549
00:24:55,750 --> 00:24:59,710
so when it goes out to Google Analytics

550
00:24:58,330 --> 00:25:01,689
the response comes back to the malicious

551
00:24:59,710 --> 00:25:05,260
server before they send it to you they

552
00:25:01,690 --> 00:25:09,160
inject this which is like a very simple

553
00:25:05,260 --> 00:25:10,780
bit of JavaScript that is just basically

554
00:25:09,160 --> 00:25:13,900
loading another piece of JavaScript from

555
00:25:10,780 --> 00:25:15,310
another server so that that JavaScript

556
00:25:13,900 --> 00:25:18,580
and we're not going to go much deeper

557
00:25:15,310 --> 00:25:22,120
into this where we want to stop is the

558
00:25:18,580 --> 00:25:25,500
what looks like affiliates are all at

559
00:25:22,120 --> 00:25:28,179
the domain called DNS unlocker com so

560
00:25:25,500 --> 00:25:30,580
then it's like well let's check out

561
00:25:28,180 --> 00:25:32,100
what's going on in DNS unlocker com so

562
00:25:30,580 --> 00:25:34,149
this is what the website looks like

563
00:25:32,100 --> 00:25:36,459
don't if you're playing at home just

564
00:25:34,150 --> 00:25:39,610
don't go here because it's it's a it's

565
00:25:36,460 --> 00:25:41,350
an adware and it's sort of market itself

566
00:25:39,610 --> 00:25:44,620
as an adware and you can see that

567
00:25:41,350 --> 00:25:46,300
there's uninstall instructions they've

568
00:25:44,620 --> 00:25:49,479
got like graphics and images it kind of

569
00:25:46,300 --> 00:25:51,790
looks somewhat legitimate but it's doing

570
00:25:49,480 --> 00:25:54,790
the same thing as the malware we just

571
00:25:51,790 --> 00:25:56,620
looked at so now we had a case where we

572
00:25:54,790 --> 00:25:58,840
went back to the sample store and we

573
00:25:56,620 --> 00:26:01,239
could find all these samples that were

574
00:25:58,840 --> 00:26:03,189
installing a version of adware that was

575
00:26:01,240 --> 00:26:05,200
doing the exact same thing changing your

576
00:26:03,190 --> 00:26:06,970
DNS setting using the same DNS

577
00:26:05,200 --> 00:26:09,310
infrastructure the same malicious DNS

578
00:26:06,970 --> 00:26:12,490
servers as the malware we were looking

579
00:26:09,310 --> 00:26:15,669
at but this one was adware in that it

580
00:26:12,490 --> 00:26:19,570
hadn't or uninstall instructions if you

581
00:26:15,670 --> 00:26:21,040
got installed if you got if the adword

582
00:26:19,570 --> 00:26:25,330
version got installed you had actually

583
00:26:21,040 --> 00:26:26,440
an uninstaller so now we have basically

584
00:26:25,330 --> 00:26:28,870
what we're

585
00:26:26,440 --> 00:26:30,879
sort of observing is an adware that has

586
00:26:28,870 --> 00:26:32,889
to kind of business models an adware

587
00:26:30,879 --> 00:26:34,719
side and then a malware side where in

588
00:26:32,889 --> 00:26:37,000
one case it hides in the other case it

589
00:26:34,720 --> 00:26:38,740
doesn't so just to compare those two so

590
00:26:37,000 --> 00:26:41,169
the version you get from DNS unlocker

591
00:26:38,740 --> 00:26:44,019
com you can't actually download anything

592
00:26:41,169 --> 00:26:47,490
from there it gets the DNS and locker

593
00:26:44,019 --> 00:26:49,750
combo ssion gets installed when you

594
00:26:47,490 --> 00:26:52,659
through other software bundles and

595
00:26:49,750 --> 00:26:55,600
whatnot so but they provide you with a

596
00:26:52,659 --> 00:26:57,220
nice license dot RTF which says somehow

597
00:26:55,600 --> 00:26:58,719
you've agreed to have this software on

598
00:26:57,220 --> 00:26:59,799
your machine so with the malware we

599
00:26:58,720 --> 00:27:01,960
looked at we didn't see any of that

600
00:26:59,799 --> 00:27:03,129
there was no the only thing written to

601
00:27:01,960 --> 00:27:05,080
disk at the end of the day was that a

602
00:27:03,129 --> 00:27:07,990
scheduled task and then the the

603
00:27:05,080 --> 00:27:10,779
certificate that was installed they both

604
00:27:07,990 --> 00:27:12,850
dunno ask installs in the case of the ad

605
00:27:10,779 --> 00:27:15,429
where the adware version it usually is

606
00:27:12,850 --> 00:27:18,610
bundled with something dns changer was

607
00:27:15,429 --> 00:27:22,450
just getting installed i was like in it

608
00:27:18,610 --> 00:27:24,370
maybe an attachment they both did DNS

609
00:27:22,450 --> 00:27:26,080
hijacking they both installed a root

610
00:27:24,370 --> 00:27:29,768
certificates so that when you were going

611
00:27:26,080 --> 00:27:32,139
to an HTTPS protected website it would

612
00:27:29,769 --> 00:27:33,639
you and getting certificate warnings so

613
00:27:32,139 --> 00:27:34,840
the DNS unlocker though did two

614
00:27:33,639 --> 00:27:36,158
different things it provided an

615
00:27:34,840 --> 00:27:39,658
installer which on the versions i

616
00:27:36,159 --> 00:27:41,500
attempted it actually worked and it also

617
00:27:39,659 --> 00:27:43,509
it didn't do any kind of hidden

618
00:27:41,500 --> 00:27:46,600
installation so the binaries that came

619
00:27:43,509 --> 00:27:48,220
with the dns unlocker com version they

620
00:27:46,600 --> 00:27:50,259
were just in program files whereas the

621
00:27:48,220 --> 00:27:52,720
DNS changer like I was showing you just

622
00:27:50,259 --> 00:27:55,899
had the scheduled task so a much

623
00:27:52,720 --> 00:27:58,450
different means and attempt to hide from

624
00:27:55,899 --> 00:28:00,580
the user so I'm going to pass it back to

625
00:27:58,450 --> 00:28:06,370
Veronica who is going to take us through

626
00:28:00,580 --> 00:28:09,330
the infrastructure ok so once we map all

627
00:28:06,370 --> 00:28:12,639
these activity the next step was like ok

628
00:28:09,330 --> 00:28:17,908
let's analyze what these guys pull out

629
00:28:12,639 --> 00:28:20,500
and let's take a look at it so we

630
00:28:17,909 --> 00:28:23,529
enumerated all the servers they have and

631
00:28:20,500 --> 00:28:26,259
then we start classifying them by type

632
00:28:23,529 --> 00:28:29,169
of functionalities so we could divide

633
00:28:26,259 --> 00:28:31,269
them in three functional groups and the

634
00:28:29,169 --> 00:28:35,080
first one is like the common and control

635
00:28:31,269 --> 00:28:37,619
servers and all the three groups do not

636
00:28:35,080 --> 00:28:39,470
overlap each other they are like quite

637
00:28:37,619 --> 00:28:41,090
separated so

638
00:28:39,470 --> 00:28:43,850
come on control servers only act as

639
00:28:41,090 --> 00:28:46,070
command control servers and so on so the

640
00:28:43,850 --> 00:28:50,049
common control servers were only three

641
00:28:46,070 --> 00:28:53,629
of them which is quite small I would say

642
00:28:50,049 --> 00:28:57,020
the main purpose were to basically

643
00:28:53,630 --> 00:28:59,390
control the bots provides and domains

644
00:28:57,020 --> 00:29:01,460
new domains to contact updates to the

645
00:28:59,390 --> 00:29:04,760
world and also collect all information

646
00:29:01,460 --> 00:29:07,220
that the deans changer was standing

647
00:29:04,760 --> 00:29:10,879
outside like all these statistics about

648
00:29:07,220 --> 00:29:13,880
operating systems and others and

649
00:29:10,880 --> 00:29:16,400
although all the servers were located in

650
00:29:13,880 --> 00:29:18,860
Netherlands and what was the in stranger

651
00:29:16,400 --> 00:29:22,299
was not contacting directly a piece so

652
00:29:18,860 --> 00:29:25,908
this eyepiece were hiding behind some

653
00:29:22,299 --> 00:29:28,789
domains infrastructure and we we

654
00:29:25,909 --> 00:29:31,429
collected more like something like 136

655
00:29:28,789 --> 00:29:35,330
domains that the what was communicating

656
00:29:31,429 --> 00:29:38,539
with all of them registered through some

657
00:29:35,330 --> 00:29:41,539
privacy register so we didn't have much

658
00:29:38,539 --> 00:29:44,710
information from them and then we have

659
00:29:41,539 --> 00:29:47,120
it dns nameservers that's what about

660
00:29:44,710 --> 00:29:49,940
executors on the system it will replace

661
00:29:47,120 --> 00:29:54,469
your normal name servers for a pool of

662
00:29:49,940 --> 00:29:58,280
these ones and they were from from five

663
00:29:54,470 --> 00:30:02,500
to eight of these servers and the

664
00:29:58,280 --> 00:30:05,658
purpose of these name servers is just to

665
00:30:02,500 --> 00:30:08,870
choose which which sites to intercept

666
00:30:05,659 --> 00:30:11,570
and which site to let go so if you're

667
00:30:08,870 --> 00:30:13,820
looking for your machine is asking for

668
00:30:11,570 --> 00:30:16,220
gold come they will respond with the

669
00:30:13,820 --> 00:30:18,559
normal IP if you are asking for Yahoo

670
00:30:16,220 --> 00:30:20,750
they will do the same if you ask for

671
00:30:18,559 --> 00:30:24,918
will analytics they will respond with

672
00:30:20,750 --> 00:30:26,870
the militias IP right and the these

673
00:30:24,919 --> 00:30:29,090
servers are located in two different

674
00:30:26,870 --> 00:30:31,370
countries some wipe some servers are

675
00:30:29,090 --> 00:30:35,510
located in Netherlands and others are

676
00:30:31,370 --> 00:30:39,350
located in Israel and we kind of wanted

677
00:30:35,510 --> 00:30:42,320
to target the target site I mean they

678
00:30:39,350 --> 00:30:46,309
are modifying or or intercepting when

679
00:30:42,320 --> 00:30:49,580
analytics and what else so it is quite

680
00:30:46,309 --> 00:30:51,370
hard to do because we had to do some

681
00:30:49,580 --> 00:30:53,320
kind of manual query student names

682
00:30:51,370 --> 00:30:57,459
hours to see what they were responding

683
00:30:53,320 --> 00:31:02,919
or not and we found at least nine target

684
00:30:57,460 --> 00:31:06,010
sites and most of them almost seven to

685
00:31:02,920 --> 00:31:08,110
eight were all Google servers services

686
00:31:06,010 --> 00:31:10,540
like well analytics will tag manager

687
00:31:08,110 --> 00:31:12,850
another type of advertising them

688
00:31:10,540 --> 00:31:16,379
probably because if the if the deans

689
00:31:12,850 --> 00:31:20,370
changer adult I scenic DD is not so huge

690
00:31:16,380 --> 00:31:23,800
prolly goal will not notice it's a

691
00:31:20,370 --> 00:31:26,139
couple of hundreds of users doing this

692
00:31:23,800 --> 00:31:28,928
right and then we have another different

693
00:31:26,140 --> 00:31:33,309
group of servers those are the injection

694
00:31:28,929 --> 00:31:35,290
servers and the functionality is to

695
00:31:33,309 --> 00:31:39,879
actually provide and check the dressers

696
00:31:35,290 --> 00:31:42,550
so when the host infected calls ask for

697
00:31:39,880 --> 00:31:45,040
will analytics they will respond with a

698
00:31:42,550 --> 00:31:46,659
malicious IP and that malicious IP

699
00:31:45,040 --> 00:31:50,170
speaks from this poll of each section

700
00:31:46,660 --> 00:31:55,570
servers and they were also around seven

701
00:31:50,170 --> 00:31:58,750
of these these servers and we also try

702
00:31:55,570 --> 00:32:01,450
to kind of enumerate how many unique

703
00:31:58,750 --> 00:32:04,809
resources they were injecting to back to

704
00:32:01,450 --> 00:32:08,740
the users and we only from four of them

705
00:32:04,809 --> 00:32:11,170
and all of them were very similar to

706
00:32:08,740 --> 00:32:13,960
each other and mostly all of them

707
00:32:11,170 --> 00:32:15,940
related to advertising but that doesn't

708
00:32:13,960 --> 00:32:17,679
mean that this is not going to change

709
00:32:15,940 --> 00:32:20,920
once they have all this infrastructure

710
00:32:17,679 --> 00:32:23,380
they can inject every chaves that they

711
00:32:20,920 --> 00:32:29,320
want right and all of these servers were

712
00:32:23,380 --> 00:32:31,179
also located in Israel so we wanted also

713
00:32:29,320 --> 00:32:32,710
to look at the domains because it tells

714
00:32:31,179 --> 00:32:34,510
a lot about the intention of the

715
00:32:32,710 --> 00:32:38,860
attacker when you look at infrastructure

716
00:32:34,510 --> 00:32:40,480
and how it was set up over time if it's

717
00:32:38,860 --> 00:32:43,449
somebody that really thought this

718
00:32:40,480 --> 00:32:47,550
through sometimes these activities

719
00:32:43,450 --> 00:32:53,559
spread over years or at least months and

720
00:32:47,550 --> 00:32:55,540
this was very very fast so the fields

721
00:32:53,559 --> 00:32:59,440
domains that we saw were registering in

722
00:32:55,540 --> 00:33:01,090
September and the first activity we

723
00:32:59,440 --> 00:33:02,759
start seeing our audience changer

724
00:33:01,090 --> 00:33:07,289
looking back it was a

725
00:33:02,759 --> 00:33:09,899
November which is not so long after the

726
00:33:07,289 --> 00:33:12,299
demise of our register and so the main

727
00:33:09,899 --> 00:33:16,559
activity registration activity of the

728
00:33:12,299 --> 00:33:19,199
maze were in in December and after

729
00:33:16,559 --> 00:33:21,989
January there were no more domains we

730
00:33:19,199 --> 00:33:24,239
interested and we don't know that this

731
00:33:21,989 --> 00:33:27,239
is because they should got on

732
00:33:24,239 --> 00:33:30,389
infrastructure they wanted or maybe they

733
00:33:27,239 --> 00:33:37,079
started getting attention or something

734
00:33:30,389 --> 00:33:41,299
else and the yellow point is where we

735
00:33:37,079 --> 00:33:44,789
saw the spike and on the infected users

736
00:33:41,299 --> 00:33:48,449
so we took all the three different C&C

737
00:33:44,789 --> 00:33:50,759
servers and we we try to see the

738
00:33:48,449 --> 00:33:52,889
activity and how many domains were

739
00:33:50,759 --> 00:33:57,269
related to each other to each of them

740
00:33:52,889 --> 00:34:01,198
and during the first month of activity

741
00:33:57,269 --> 00:34:03,809
it was just one IP and then they started

742
00:34:01,199 --> 00:34:06,479
getting more users oh yes and then we

743
00:34:03,809 --> 00:34:09,980
they switch to new to two new servers

744
00:34:06,479 --> 00:34:14,460
and there is choose one that is kind of

745
00:34:09,980 --> 00:34:17,460
getting on the heavy load and it's not

746
00:34:14,460 --> 00:34:19,319
that huge of a man you are let's say

747
00:34:17,460 --> 00:34:21,149
it's quite small compared to other

748
00:34:19,319 --> 00:34:24,569
bonnets but it's quite interesting that

749
00:34:21,149 --> 00:34:28,918
they can manage all these users which is

750
00:34:24,569 --> 00:34:33,049
one IV and and when I he was kind of

751
00:34:28,918 --> 00:34:35,638
inactive for some point some time so

752
00:34:33,049 --> 00:34:38,849
another thing we did when what's

753
00:34:35,639 --> 00:34:42,210
interesting is that rose told us that

754
00:34:38,849 --> 00:34:44,579
how he break the encoding of the URL so

755
00:34:42,210 --> 00:34:46,139
we took like four months of traffic and

756
00:34:44,579 --> 00:34:48,259
then we they call it all the URLs and

757
00:34:46,139 --> 00:34:50,669
say like okay what is going on what they

758
00:34:48,259 --> 00:34:54,059
didn't change is sending out is there

759
00:34:50,668 --> 00:34:56,549
something interesting in there and well

760
00:34:54,059 --> 00:34:58,799
there are a lot of parameters that the

761
00:34:56,549 --> 00:35:01,680
body's sending out that we cannot share

762
00:34:58,799 --> 00:35:05,279
because it was some information from the

763
00:35:01,680 --> 00:35:08,609
users but what's interesting that for

764
00:35:05,279 --> 00:35:11,339
kind of likely wanted to be hard work

765
00:35:08,609 --> 00:35:13,049
they were doing some checks for analysis

766
00:35:11,339 --> 00:35:13,810
tools on the system not only checking

767
00:35:13,049 --> 00:35:16,420
the X

768
00:35:13,810 --> 00:35:18,730
sense of these tools but also sending

769
00:35:16,420 --> 00:35:20,410
the information out the commoner

770
00:35:18,730 --> 00:35:24,600
controls right and they were checking

771
00:35:20,410 --> 00:35:27,580
for being more components many of them

772
00:35:24,600 --> 00:35:30,160
they were also checking for virtual box

773
00:35:27,580 --> 00:35:35,980
fiddler and also for white shark that

774
00:35:30,160 --> 00:35:38,980
was quite surprising and then we wanted

775
00:35:35,980 --> 00:35:40,930
to see the how the operating system of

776
00:35:38,980 --> 00:35:45,370
the infections were like the distributor

777
00:35:40,930 --> 00:35:48,129
who who it was and so windows 7 seems to

778
00:35:45,370 --> 00:35:51,580
be the most infected platform along with

779
00:35:48,130 --> 00:35:55,090
Windows 10 and that's good news is not

780
00:35:51,580 --> 00:35:59,830
XP anymore so we're good right we are

781
00:35:55,090 --> 00:36:03,100
evolving so then we started trying to

782
00:35:59,830 --> 00:36:05,319
say okay we know this what it did what

783
00:36:03,100 --> 00:36:08,350
this does how the users are actually

784
00:36:05,320 --> 00:36:10,780
getting infected right because it's

785
00:36:08,350 --> 00:36:12,670
something that we can this is there

786
00:36:10,780 --> 00:36:15,730
something we can do to stop this it's

787
00:36:12,670 --> 00:36:18,370
like I don't know ransomware things

788
00:36:15,730 --> 00:36:20,980
spread through fishing or spam emails

789
00:36:18,370 --> 00:36:24,819
okay what is the delivery method of the

790
00:36:20,980 --> 00:36:27,310
exchange and in most of the cases that

791
00:36:24,820 --> 00:36:31,000
we have served almost all the cases it

792
00:36:27,310 --> 00:36:35,740
was through software bundles most of the

793
00:36:31,000 --> 00:36:37,930
common ad where I was was not if you go

794
00:36:35,740 --> 00:36:41,020
for any of these it's plenty of

795
00:36:37,930 --> 00:36:43,120
write-ups and internet so system healers

796
00:36:41,020 --> 00:36:46,900
one systemcare other multiplayer

797
00:36:43,120 --> 00:36:51,400
optimizer pro and tons of other

798
00:36:46,900 --> 00:36:53,910
injectors different families and the one

799
00:36:51,400 --> 00:36:57,610
interesting thing about this is that

800
00:36:53,910 --> 00:37:01,330
most of these AdWords are in the systems

801
00:36:57,610 --> 00:37:04,170
for months or I don't want to say years

802
00:37:01,330 --> 00:37:06,910
but really for months people should

803
00:37:04,170 --> 00:37:10,720
develop some kind of tolerance for a

804
00:37:06,910 --> 00:37:12,609
door that you getting infected with

805
00:37:10,720 --> 00:37:15,399
other thing will you will start seeing

806
00:37:12,610 --> 00:37:17,740
most likely pop-ups with advertising and

807
00:37:15,400 --> 00:37:19,600
you're shrinking your your screen to

808
00:37:17,740 --> 00:37:21,850
work in this where the advertising is

809
00:37:19,600 --> 00:37:24,828
not there and you are not remediating

810
00:37:21,850 --> 00:37:27,529
that nobody's

811
00:37:24,829 --> 00:37:30,559
so it's like the other is there and

812
00:37:27,529 --> 00:37:32,900
piling over and you have tons of eating

813
00:37:30,559 --> 00:37:35,709
the same machine and nobody cares about

814
00:37:32,900 --> 00:37:38,150
that and suddenly we have a case where

815
00:37:35,709 --> 00:37:40,368
customers were stunned worry know this

816
00:37:38,150 --> 00:37:42,589
because okay this ad work can actually

817
00:37:40,369 --> 00:37:45,739
deliver some malware and I don't want

818
00:37:42,589 --> 00:37:52,599
malwa I know my words well but i didn't

819
00:37:45,739 --> 00:37:55,869
know other was not right so in the end

820
00:37:52,599 --> 00:37:58,430
yeah antivirus window categorizations

821
00:37:55,869 --> 00:38:01,039
they are they are doing good job

822
00:37:58,430 --> 00:38:04,910
detecting but it shouldn't be like the

823
00:38:01,039 --> 00:38:07,489
final truth you should kind of assess

824
00:38:04,910 --> 00:38:11,390
the real risk every time you get a third

825
00:38:07,489 --> 00:38:12,920
by yourself like okay you just need to

826
00:38:11,390 --> 00:38:17,390
gather all the information available and

827
00:38:12,920 --> 00:38:22,819
take your own decision also other are

828
00:38:17,390 --> 00:38:25,549
still infections it is we want to want

829
00:38:22,819 --> 00:38:27,769
to have users that are not infected at

830
00:38:25,549 --> 00:38:31,309
least four months like can you keep it

831
00:38:27,769 --> 00:38:35,479
like this and it's very it's very

832
00:38:31,309 --> 00:38:38,989
difficult and for us like every every

833
00:38:35,479 --> 00:38:41,749
infection or even if it's teeny is like

834
00:38:38,989 --> 00:38:43,219
it's like an open door right and you

835
00:38:41,749 --> 00:38:47,049
don't want to have that in your system

836
00:38:43,219 --> 00:38:49,549
and so the best way is like to kill the

837
00:38:47,049 --> 00:38:52,430
threat escalation chain in beginning

838
00:38:49,549 --> 00:38:57,079
like remedy ate whatever Edie's remedy

839
00:38:52,430 --> 00:39:00,649
ate your system like us up and then most

840
00:38:57,079 --> 00:39:02,630
of the time insulin response team shows

841
00:39:00,650 --> 00:39:03,859
remediate and then move on and then the

842
00:39:02,630 --> 00:39:06,229
next Monday come again to the same

843
00:39:03,859 --> 00:39:10,459
computer their immediate again and they

844
00:39:06,229 --> 00:39:13,279
go on and this is educating users is

845
00:39:10,459 --> 00:39:16,098
really hard but I think they are the

846
00:39:13,279 --> 00:39:19,190
ones clicking on the software bundles

847
00:39:16,099 --> 00:39:22,819
they are the ones accepting the licenses

848
00:39:19,190 --> 00:39:25,130
so they are the ones that should help us

849
00:39:22,819 --> 00:39:29,449
prevent all these massive infections and

850
00:39:25,130 --> 00:39:32,539
then yeah malicious actors will always

851
00:39:29,449 --> 00:39:33,590
seek get in revenue and more and more

852
00:39:32,539 --> 00:39:37,490
revenue and

853
00:39:33,590 --> 00:39:40,400
the days they will use whatever means

854
00:39:37,490 --> 00:39:42,379
they they can write even if it's ad were

855
00:39:40,400 --> 00:39:45,410
installing your system and they will pay

856
00:39:42,380 --> 00:39:49,490
for getting access to your system so we

857
00:39:45,410 --> 00:39:52,790
prepare and lastly this is not the first

858
00:39:49,490 --> 00:39:55,450
time we we see this type of thought so

859
00:39:52,790 --> 00:39:58,550
Ross is going to tell briefly about this

860
00:39:55,450 --> 00:40:01,939
yes so this is this press just a bit of

861
00:39:58,550 --> 00:40:04,940
leg of an afterword so once I came up

862
00:40:01,940 --> 00:40:07,700
for air after sort of finishing analysis

863
00:40:04,940 --> 00:40:09,680
and writing the report it feel it felt

864
00:40:07,700 --> 00:40:11,960
like I'd heard this story before and if

865
00:40:09,680 --> 00:40:15,980
anyone remembers the there was an old

866
00:40:11,960 --> 00:40:19,340
DNS changer it was in 2007 it was

867
00:40:15,980 --> 00:40:21,110
operated by some like a similar kind of

868
00:40:19,340 --> 00:40:24,590
setup where was a quazy legitimate

869
00:40:21,110 --> 00:40:26,840
Estonian company and it did the same

870
00:40:24,590 --> 00:40:28,280
thing it changed your DNS settings they

871
00:40:26,840 --> 00:40:31,160
were doing a drive-by download kind of

872
00:40:28,280 --> 00:40:33,830
install and what I what why really

873
00:40:31,160 --> 00:40:35,600
remembered was the FBI operation I've

874
00:40:33,830 --> 00:40:37,460
forgotten that the name was operation

875
00:40:35,600 --> 00:40:39,980
goes click which is sounds really

876
00:40:37,460 --> 00:40:42,380
impressive and that was the one where

877
00:40:39,980 --> 00:40:44,510
the FBI raided the servers oversees the

878
00:40:42,380 --> 00:40:48,320
DNS servers and then actually operated

879
00:40:44,510 --> 00:40:51,080
them for about eight or nine months so

880
00:40:48,320 --> 00:40:54,230
that people infected with DNS changer at

881
00:40:51,080 --> 00:40:57,319
that time would not lose internet

882
00:40:54,230 --> 00:41:02,660
connectivity and they also worked with

883
00:40:57,320 --> 00:41:04,610
some ISPs to also continue the DNS after

884
00:41:02,660 --> 00:41:07,759
the FBI actually stopped running the

885
00:41:04,610 --> 00:41:09,650
servers the the part of the story that

886
00:41:07,760 --> 00:41:10,850
i'd forgotten and there's a working

887
00:41:09,650 --> 00:41:13,430
group what there's like a working group

888
00:41:10,850 --> 00:41:15,200
about this their website is still up all

889
00:41:13,430 --> 00:41:17,660
the materials still there there was a

890
00:41:15,200 --> 00:41:19,669
number of indictments in estonia it took

891
00:41:17,660 --> 00:41:23,029
international the wheels of justice move

892
00:41:19,670 --> 00:41:26,000
slowly they were eventually extradited

893
00:41:23,030 --> 00:41:28,070
actually the united states and one of

894
00:41:26,000 --> 00:41:29,600
them pled guilty i'm not sure the status

895
00:41:28,070 --> 00:41:32,950
of the other cases but he was actually

896
00:41:29,600 --> 00:41:35,569
just sentenced to seven years in federal

897
00:41:32,950 --> 00:41:39,919
American prison in a court in New York

898
00:41:35,570 --> 00:41:42,740
on Tuesday like three days ago so this

899
00:41:39,920 --> 00:41:44,560
whole thing is is sort of coming back

900
00:41:42,740 --> 00:41:46,839
around in a bit of a circle

901
00:41:44,560 --> 00:41:48,940
um there's a so then I started thinking

902
00:41:46,840 --> 00:41:51,550
about well there's there's an old one

903
00:41:48,940 --> 00:41:54,700
that had a specially named FBI operation

904
00:41:51,550 --> 00:41:57,250
and a new one that is admittedly smaller

905
00:41:54,700 --> 00:41:59,169
but if I was the person running the new

906
00:41:57,250 --> 00:42:02,170
one I would be worried about seven years

907
00:41:59,170 --> 00:42:03,310
in US federal prison there's a couple

908
00:42:02,170 --> 00:42:06,280
diff there's a couple difference though

909
00:42:03,310 --> 00:42:08,110
is though they're both altering dns

910
00:42:06,280 --> 00:42:09,540
change dns settings and root

911
00:42:08,110 --> 00:42:12,820
certificates and they're both

912
00:42:09,540 --> 00:42:14,410
monetization schemes he's advertising

913
00:42:12,820 --> 00:42:17,680
they're doing the same kind of thing

914
00:42:14,410 --> 00:42:18,790
which was just changing changing web

915
00:42:17,680 --> 00:42:20,290
requests putting in their own

916
00:42:18,790 --> 00:42:23,560
advertising and getting paid for those

917
00:42:20,290 --> 00:42:25,150
advertisements what what the old DNS

918
00:42:23,560 --> 00:42:27,040
changer did it did two things wrong in

919
00:42:25,150 --> 00:42:29,320
my opinion one is that it was extremely

920
00:42:27,040 --> 00:42:31,960
aggressive at spreading it was setting

921
00:42:29,320 --> 00:42:34,570
up it would advertise his fake DHCP in

922
00:42:31,960 --> 00:42:37,600
the network in order to advertise the

923
00:42:34,570 --> 00:42:39,100
poison dns settings to attempt to get

924
00:42:37,600 --> 00:42:40,870
other systems to use the jhino settings

925
00:42:39,100 --> 00:42:43,299
and probably the final nail in the

926
00:42:40,870 --> 00:42:46,509
coffin was it was redirecting gov like

927
00:42:43,300 --> 00:42:49,060
American government websites like IRS

928
00:42:46,510 --> 00:42:52,480
gov ascending RS gov't like a tax

929
00:42:49,060 --> 00:42:55,150
preparation service so maybe the new

930
00:42:52,480 --> 00:42:58,030
maybe the new author sort of learned how

931
00:42:55,150 --> 00:42:59,950
to stay enough under the radar that you

932
00:42:58,030 --> 00:43:03,280
know the US federal government won't

933
00:42:59,950 --> 00:43:06,299
come knocking so thanks for everyone's

934
00:43:03,280 --> 00:43:06,300
attention that's it

935
00:43:08,900 --> 00:43:27,660
and we'll we'll take any questions if

936
00:43:11,280 --> 00:43:30,870
there are knee-high good so the ad

937
00:43:27,660 --> 00:43:34,890
blocker will only about you to see it

938
00:43:30,870 --> 00:43:37,049
thank you you will you will not see the

939
00:43:34,890 --> 00:43:39,750
advertising is being ejected but you are

940
00:43:37,050 --> 00:43:41,490
still infected right so I think that in

941
00:43:39,750 --> 00:43:44,070
that case is kind of negative because at

942
00:43:41,490 --> 00:43:45,720
least you're not you're going you're not

943
00:43:44,070 --> 00:43:48,200
going to notice that the infected and

944
00:43:45,720 --> 00:43:48,200
you can tell me

