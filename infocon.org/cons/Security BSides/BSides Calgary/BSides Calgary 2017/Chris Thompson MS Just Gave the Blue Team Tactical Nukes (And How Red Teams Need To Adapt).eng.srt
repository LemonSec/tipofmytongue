1
00:00:02,740 --> 00:00:10,890
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> you can probably kill the lights</font>

2
00:00:06,700 --> 00:00:14,160
whoever's leaning on<font color="#CCCCCC"> that light switch</font>

3
00:00:10,890 --> 00:00:19,720
<font color="#CCCCCC">you guys</font><font color="#E5E5E5"> hear me okay all</font><font color="#CCCCCC"> right</font>

4
00:00:14,160 --> 00:00:22,390
<font color="#E5E5E5">all</font><font color="#CCCCCC"> right so this this talks</font><font color="#E5E5E5"> called</font>

5
00:00:19,720 --> 00:00:24,939
Microsoft<font color="#CCCCCC"> just gave the blue team's</font>

6
00:00:22,390 --> 00:00:29,619
tactical<font color="#CCCCCC"> newts and how red</font><font color="#E5E5E5"> teams need to</font>

7
00:00:24,940 --> 00:00:33,120
adapt so<font color="#E5E5E5"> I'm Chris Thompson I'm the red</font>

8
00:00:29,619 --> 00:00:35,769
teaming<font color="#E5E5E5"> or ops lead at IBM x-force red</font>

9
00:00:33,120 --> 00:00:38,199
<font color="#E5E5E5">my job involves conducting red team</font>

10
00:00:35,770 --> 00:00:40,930
operations against<font color="#E5E5E5"> really large banks</font>

11
00:00:38,200 --> 00:00:46,290
<font color="#E5E5E5">and defense contractors</font><font color="#CCCCCC"> and more mature</font>

12
00:00:40,930 --> 00:00:50,730
targets<font color="#E5E5E5"> I actually graduated from state</font>

13
00:00:46,290 --> 00:00:53,649
about<font color="#CCCCCC"> a dozen years ago and I I teach</font>

14
00:00:50,730 --> 00:00:57,489
<font color="#E5E5E5">the network and mobile</font><font color="#CCCCCC"> pen testing class</font>

15
00:00:53,649 --> 00:00:59,500
at night here<font color="#CCCCCC"> I</font><font color="#E5E5E5"> probably hold the you</font>

16
00:00:57,489 --> 00:01:01,180
know probably some<font color="#CCCCCC"> unofficial record for</font>

17
00:00:59,500 --> 00:01:04,629
the most f-bombs<font color="#CCCCCC"> dropped by an</font>

18
00:01:01,180 --> 00:01:06,930
instructor<font color="#E5E5E5"> here but but we do have a lot</font>

19
00:01:04,629 --> 00:01:10,119
<font color="#CCCCCC">of fun in the class</font>

20
00:01:06,930 --> 00:01:12,729
my main goal from teaching at night<font color="#CCCCCC"> at</font>

21
00:01:10,119 --> 00:01:17,170
<font color="#CCCCCC">say is just</font><font color="#E5E5E5"> to help to grow</font><font color="#CCCCCC"> calgary's</font>

22
00:01:12,729 --> 00:01:19,360
local technical<font color="#E5E5E5"> security community</font><font color="#CCCCCC"> so if</font>

23
00:01:17,170 --> 00:01:21,700
that's<font color="#E5E5E5"> if you're kind</font><font color="#CCCCCC"> of offensive</font>

24
00:01:19,360 --> 00:01:25,479
<font color="#E5E5E5">minded or defensive minded please come</font>

25
00:01:21,700 --> 00:01:27,490
on<font color="#E5E5E5"> out we meet every month</font><font color="#CCCCCC"> second</font>

26
00:01:25,479 --> 00:01:29,979
<font color="#E5E5E5">Thursday ish of the month at the bank</font>

27
00:01:27,490 --> 00:01:31,720
<font color="#E5E5E5">and Baron</font><font color="#CCCCCC"> down in the</font><font color="#E5E5E5"> basement</font><font color="#CCCCCC"> most of</font>

28
00:01:29,979 --> 00:01:36,520
the time<font color="#E5E5E5"> but check our Twitter feed for</font>

29
00:01:31,720 --> 00:01:39,369
the right right info so why this talk<font color="#E5E5E5"> on</font>

30
00:01:36,520 --> 00:01:43,509
Microsoft advanced threat analytics<font color="#E5E5E5"> and</font>

31
00:01:39,369 --> 00:01:46,299
threat threat protection<font color="#CCCCCC"> you know Andrew</font>

32
00:01:43,509 --> 00:01:49,869
had that<font color="#E5E5E5"> quadrant up about different</font>

33
00:01:46,299 --> 00:01:51,729
research<font color="#CCCCCC"> you know why why people are</font>

34
00:01:49,869 --> 00:01:54,159
<font color="#E5E5E5">driven by different research his</font>

35
00:01:51,729 --> 00:01:56,829
quadrant kind of lacked the beer driven

36
00:01:54,159 --> 00:01:58,630
research<font color="#CCCCCC"> I was just kind</font><font color="#E5E5E5"> of saw</font><font color="#CCCCCC"> that</font>

37
00:01:56,829 --> 00:02:00,729
something<font color="#CCCCCC"> was coming</font><font color="#E5E5E5"> out from Microsoft</font>

38
00:01:58,630 --> 00:02:04,089
and I thought nobody<font color="#E5E5E5"> was taking a look</font>

39
00:02:00,729 --> 00:02:06,700
<font color="#E5E5E5">at it</font><font color="#CCCCCC"> so I wanted to</font><font color="#E5E5E5"> spend</font><font color="#CCCCCC"> some time on</font>

40
00:02:04,090 --> 00:02:10,360
<font color="#E5E5E5">it I've come up against some</font><font color="#CCCCCC"> really good</font>

41
00:02:06,700 --> 00:02:12,489
<font color="#CCCCCC">distraction</font><font color="#E5E5E5"> when I've</font><font color="#CCCCCC"> been testing some</font>

42
00:02:10,360 --> 00:02:14,409
large fortune<font color="#E5E5E5"> 50 s lately I've come up</font>

43
00:02:12,489 --> 00:02:16,090
some really<font color="#CCCCCC"> good against some really</font>

44
00:02:14,409 --> 00:02:18,190
<font color="#E5E5E5">good detection strategies</font>

45
00:02:16,090 --> 00:02:20,590
they've got tools like sis<font color="#E5E5E5"> Mon and</font>

46
00:02:18,190 --> 00:02:23,440
<font color="#CCCCCC">AppLocker and II met in place</font>

47
00:02:20,590 --> 00:02:25,450
they've got event lock forwarding they

48
00:02:23,440 --> 00:02:28,840
were using products<font color="#CCCCCC"> like</font><font color="#E5E5E5"> CrowdStrike and</font>

49
00:02:25,450 --> 00:02:31,239
silence<font color="#E5E5E5"> for host behavior analytics and</font>

50
00:02:28,840 --> 00:02:34,390
tools<font color="#E5E5E5"> like</font><font color="#CCCCCC"> rapid7 and user insights for</font>

51
00:02:31,240 --> 00:02:36,180
domain<font color="#E5E5E5"> behavior analytics so when I saw</font>

52
00:02:34,390 --> 00:02:40,029
that<font color="#E5E5E5"> Microsoft is coming out with both</font>

53
00:02:36,180 --> 00:02:41,440
host and domain based analytic tools and

54
00:02:40,030 --> 00:02:42,760
that<font color="#E5E5E5"> advanced threat protection was</font>

55
00:02:41,440 --> 00:02:45,459
going to be built directly in the

56
00:02:42,760 --> 00:02:47,980
Windows 10<font color="#CCCCCC"> I knew this was an</font><font color="#E5E5E5"> area that</font>

57
00:02:45,459 --> 00:02:49,900
<font color="#E5E5E5">needed some more focus especially when</font>

58
00:02:47,980 --> 00:02:53,170
these products<font color="#E5E5E5"> are further integrated</font>

59
00:02:49,900 --> 00:02:55,209
<font color="#E5E5E5">this fall</font><font color="#CCCCCC"> like we</font><font color="#E5E5E5"> just saw with this</font>

60
00:02:53,170 --> 00:02:58,839
<font color="#CCCCCC">Tuesday's fall creator update in Windows</font>

61
00:02:55,209 --> 00:03:01,239
10 so I gave the<font color="#CCCCCC"> original version of</font>

62
00:02:58,840 --> 00:03:04,510
this talk at<font color="#E5E5E5"> Def Con which was the first</font>

63
00:03:01,239 --> 00:03:10,120
<font color="#E5E5E5">talk on evading and bypassing ATP and</font>

64
00:03:04,510 --> 00:03:12,910
was<font color="#E5E5E5"> only the second on</font><font color="#CCCCCC"> ata Nicole Nikhil</font>

65
00:03:10,120 --> 00:03:16,239
sorry<font color="#E5E5E5"> had just</font><font color="#CCCCCC"> presented on</font><font color="#E5E5E5"> ata two days</font>

66
00:03:12,910 --> 00:03:18,430
<font color="#E5E5E5">before my DEFCON talk so there was a bit</font>

67
00:03:16,239 --> 00:03:19,720
of similarities in<font color="#CCCCCC"> a research but we we</font>

68
00:03:18,430 --> 00:03:21,370
also found quite<font color="#E5E5E5"> a lot of different</font>

69
00:03:19,720 --> 00:03:22,920
things<font color="#CCCCCC"> so</font><font color="#E5E5E5"> that was great to get some</font>

70
00:03:21,370 --> 00:03:26,200
<font color="#CCCCCC">different perspectives on the product</font>

71
00:03:22,920 --> 00:03:28,149
<font color="#CCCCCC">and because we're so early</font><font color="#E5E5E5"> in the</font>

72
00:03:26,200 --> 00:03:30,609
history<font color="#CCCCCC"> of</font><font color="#E5E5E5"> these products I've withheld</font>

73
00:03:28,150 --> 00:03:33,790
a few<font color="#E5E5E5"> techniques</font><font color="#CCCCCC"> that I'm presenting</font>

74
00:03:30,610 --> 00:03:37,989
<font color="#E5E5E5">later at blackhat Europe</font><font color="#CCCCCC"> in a month</font>

75
00:03:33,790 --> 00:03:44,109
<font color="#CCCCCC">Phish so check my Twitter feed</font><font color="#E5E5E5"> and I'll</font>

76
00:03:37,989 --> 00:03:46,690
put a few more<font color="#E5E5E5"> out there</font><font color="#CCCCCC"> so to kind of</font>

77
00:03:44,110 --> 00:03:49,120
set<font color="#E5E5E5"> the</font><font color="#CCCCCC"> stage when</font><font color="#E5E5E5"> I developed our TTP</font>

78
00:03:46,690 --> 00:03:53,079
or<font color="#E5E5E5"> tactics techniques and procedures for</font>

79
00:03:49,120 --> 00:03:56,200
<font color="#E5E5E5">the IBM x-force Red Team</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> put a really</font>

80
00:03:53,079 --> 00:03:58,540
distinct emphasis<font color="#E5E5E5"> between host and</font>

81
00:03:56,200 --> 00:04:00,880
internal recon<font color="#E5E5E5"> so those are very</font>

82
00:03:58,540 --> 00:04:02,858
<font color="#E5E5E5">distinct phases and you'll see why when</font>

83
00:04:00,880 --> 00:04:06,790
we start to deal with products like<font color="#E5E5E5"> ATP</font>

84
00:04:02,859 --> 00:04:09,040
and<font color="#E5E5E5"> ata in a minute and really to</font><font color="#CCCCCC"> become</font>

85
00:04:06,790 --> 00:04:11,140
better red teamers and operate against

86
00:04:09,040 --> 00:04:13,870
more mature blue<font color="#E5E5E5"> teams we need to gain</font><font color="#CCCCCC"> a</font>

87
00:04:11,140 --> 00:04:15,940
solid<font color="#CCCCCC"> understanding of what indicators</font>

88
00:04:13,870 --> 00:04:18,430
<font color="#E5E5E5">are compromised</font><font color="#CCCCCC"> our</font><font color="#E5E5E5"> tools and techniques</font>

89
00:04:15,940 --> 00:04:20,079
are leading by leaving behind<font color="#E5E5E5"> you know</font>

90
00:04:18,430 --> 00:04:22,720
what commands might be caught by

91
00:04:20,079 --> 00:04:24,340
different script logging what's<font color="#CCCCCC"> Flag</font>

92
00:04:22,720 --> 00:04:26,020
double by<font color="#E5E5E5"> sis Mon and and more</font>

93
00:04:24,340 --> 00:04:28,929
<font color="#E5E5E5">importantly how we can learn to</font><font color="#CCCCCC"> use</font>

94
00:04:26,020 --> 00:04:33,039
techniques<font color="#E5E5E5"> that</font><font color="#CCCCCC"> can avoid</font><font color="#E5E5E5"> user behavior</font>

95
00:04:28,930 --> 00:04:35,380
<font color="#E5E5E5">analytics so my lab set</font><font color="#CCCCCC"> up real quick</font>

96
00:04:33,039 --> 00:04:39,430
<font color="#CCCCCC">it's not</font><font color="#E5E5E5"> running on an old compact</font><font color="#CCCCCC"> force</font>

97
00:04:35,380 --> 00:04:42,759
<font color="#CCCCCC">area it's running a</font><font color="#E5E5E5"> couple dozen boxes</font>

98
00:04:39,430 --> 00:04:44,740
<font color="#CCCCCC">sabirah from alberta is actually giving</font>

99
00:04:42,759 --> 00:04:47,979
me<font color="#E5E5E5"> all</font><font color="#CCCCCC"> that space so if anyone from</font>

100
00:04:44,740 --> 00:04:49,810
<font color="#E5E5E5">there is here thanks a lot</font><font color="#CCCCCC"> I tried to</font>

101
00:04:47,979 --> 00:04:51,520
run the commands against his you<font color="#E5E5E5"> know</font>

102
00:04:49,810 --> 00:04:54,150
<font color="#E5E5E5">multiple different forests and domains</font>

103
00:04:51,520 --> 00:04:56,560
and hosts just to verify the accuracy

104
00:04:54,150 --> 00:04:58,020
but that being<font color="#E5E5E5"> said</font><font color="#CCCCCC"> it is a test</font>

105
00:04:56,560 --> 00:05:00,660
environment so it's hard<font color="#E5E5E5"> to replicate</font>

106
00:04:58,020 --> 00:05:02,409
<font color="#CCCCCC">real-world corporate domain traffic</font>

107
00:05:00,660 --> 00:05:05,470
<font color="#E5E5E5">especially when we're bringing</font><font color="#CCCCCC"> in</font>

108
00:05:02,410 --> 00:05:08,380
behavior analytics because you know

109
00:05:05,470 --> 00:05:10,479
we're we can simulate<font color="#E5E5E5"> regular user</font>

110
00:05:08,380 --> 00:05:12,580
behavior as much as we want a lab but it

111
00:05:10,479 --> 00:05:16,630
might different<font color="#CCCCCC"> obviously from what's in</font>

112
00:05:12,580 --> 00:05:19,840
<font color="#E5E5E5">in the real world so to give an overview</font>

113
00:05:16,630 --> 00:05:22,360
of ATP<font color="#E5E5E5"> this was the original dashboard</font>

114
00:05:19,840 --> 00:05:25,109
<font color="#CCCCCC">no you can see</font><font color="#E5E5E5"> alerts on</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> left</font><font color="#CCCCCC"> talks</font>

115
00:05:22,360 --> 00:05:27,729
<font color="#E5E5E5">about the status of different machines</font>

116
00:05:25,110 --> 00:05:29,530
<font color="#CCCCCC">it's active on more</font><font color="#E5E5E5"> than two million</font>

117
00:05:27,729 --> 00:05:31,479
devices<font color="#E5E5E5"> right now they get almost a</font>

118
00:05:29,530 --> 00:05:35,289
billion security events a<font color="#CCCCCC"> day that they</font>

119
00:05:31,479 --> 00:05:40,719
go through<font color="#E5E5E5"> this is the cloud dashboard</font>

120
00:05:35,289 --> 00:05:46,389
<font color="#CCCCCC">of ATP that</font><font color="#E5E5E5"> everything reports into an</font>

121
00:05:40,720 --> 00:05:50,560
ATP<font color="#E5E5E5"> provides</font><font color="#CCCCCC"> host behavior sensors</font>

122
00:05:46,389 --> 00:05:52,030
similar to products like<font color="#E5E5E5"> CrowdStrike</font><font color="#CCCCCC"> the</font>

123
00:05:50,560 --> 00:05:54,310
difference<font color="#CCCCCC"> that is that these sensors</font>

124
00:05:52,030 --> 00:06:01,210
<font color="#CCCCCC">are built and embedded directly into</font>

125
00:05:54,310 --> 00:06:03,490
Windows<font color="#CCCCCC"> 10 Pro and enterprise</font><font color="#E5E5E5"> and the</font>

126
00:06:01,210 --> 00:06:06,250
second release came out<font color="#CCCCCC"> 1703 in the</font>

127
00:06:03,490 --> 00:06:08,800
spring and released<font color="#E5E5E5"> three was just</font>

128
00:06:06,250 --> 00:06:13,270
bundled<font color="#E5E5E5"> with two days ago</font><font color="#CCCCCC"> as fall update</font>

129
00:06:08,800 --> 00:06:16,479
or Windows 10<font color="#E5E5E5"> 1709</font><font color="#CCCCCC"> these sensors</font><font color="#E5E5E5"> collect</font>

130
00:06:13,270 --> 00:06:19,990
and process behavior signals from<font color="#E5E5E5"> the</font>

131
00:06:16,479 --> 00:06:22,270
box for<font color="#CCCCCC"> example they</font><font color="#E5E5E5"> process the</font>

132
00:06:19,990 --> 00:06:24,220
registry file and network communications

133
00:06:22,270 --> 00:06:26,500
and they send all<font color="#CCCCCC"> this sensor</font><font color="#E5E5E5"> data or</font>

134
00:06:24,220 --> 00:06:32,650
telemetry data to the<font color="#E5E5E5"> cloud for further</font>

135
00:06:26,500 --> 00:06:34,419
processing<font color="#CCCCCC"> you know sometimes these</font>

136
00:06:32,650 --> 00:06:36,008
alerts<font color="#E5E5E5"> can happen is as soon as five</font>

137
00:06:34,419 --> 00:06:37,479
<font color="#E5E5E5">minutes sometimes because they're</font>

138
00:06:36,009 --> 00:06:40,750
chugging all the data in<font color="#E5E5E5"> the cloud it</font>

139
00:06:37,479 --> 00:06:42,430
might take a few<font color="#E5E5E5"> hours</font><font color="#CCCCCC"> attackers could</font>

140
00:06:40,750 --> 00:06:42,729
use<font color="#E5E5E5"> that to their</font><font color="#CCCCCC"> advantage if they're</font>

141
00:06:42,430 --> 00:06:44,710
going

142
00:06:42,729 --> 00:06:46,419
quick<font color="#E5E5E5"> smash and grab but because we're</font>

143
00:06:44,710 --> 00:06:48,460
talking<font color="#E5E5E5"> about more mature target so that</font>

144
00:06:46,419 --> 00:06:50,969
<font color="#E5E5E5">it's</font><font color="#CCCCCC"> going</font><font color="#E5E5E5"> to be hard to do that type of</font>

145
00:06:48,460 --> 00:06:53,520
smash<font color="#CCCCCC"> and grab we got to go low and</font><font color="#E5E5E5"> slow</font>

146
00:06:50,969 --> 00:07:02,650
<font color="#CCCCCC">and we need to go with a</font><font color="#E5E5E5"> more mature</font>

147
00:06:53,520 --> 00:07:04,089
<font color="#E5E5E5">methodology</font><font color="#CCCCCC"> so this is the you</font><font color="#E5E5E5"> know if</font>

148
00:07:02,650 --> 00:07:07,659
you're investigating alert there's

149
00:07:04,089 --> 00:07:09,969
<font color="#CCCCCC">PowerShell</font><font color="#E5E5E5"> Empire being launched we can</font>

150
00:07:07,659 --> 00:07:11,020
see that even<font color="#E5E5E5"> though it was a encrypted</font>

151
00:07:09,969 --> 00:07:15,039
or<font color="#CCCCCC"> uh uh</font><font color="#E5E5E5"> skated</font>

152
00:07:11,020 --> 00:07:17,080
sorry payload it<font color="#E5E5E5"> D office gates it on</font>

153
00:07:15,039 --> 00:07:19,599
the fly<font color="#E5E5E5"> and shows exactly how</font><font color="#CCCCCC"> it was</font>

154
00:07:17,080 --> 00:07:21,430
launched<font color="#E5E5E5"> if there's lateral movement</font>

155
00:07:19,599 --> 00:07:23,649
from<font color="#E5E5E5"> that box it talks about</font><font color="#CCCCCC"> where it</font>

156
00:07:21,430 --> 00:07:25,330
moved to and what processes or

157
00:07:23,649 --> 00:07:29,740
techniques were used to perform lateral

158
00:07:25,330 --> 00:07:31,240
movement<font color="#E5E5E5"> as a blue team you can see you</font>

159
00:07:29,740 --> 00:07:35,199
know the hash associated with that

160
00:07:31,240 --> 00:07:37,300
initial payload and you can see it hit

161
00:07:35,199 --> 00:07:38,860
<font color="#E5E5E5">two machines</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> got the option to</font>

162
00:07:37,300 --> 00:07:41,259
quarantine<font color="#E5E5E5"> those machines and then</font>

163
00:07:38,860 --> 00:07:45,339
you'll see that<font color="#E5E5E5"> pop up if you were one</font>

164
00:07:41,259 --> 00:07:49,089
of<font color="#E5E5E5"> the infected users released three</font>

165
00:07:45,339 --> 00:07:51,759
that again<font color="#CCCCCC"> just came out on Tuesday it</font>

166
00:07:49,089 --> 00:07:55,629
was<font color="#E5E5E5"> expanded to</font><font color="#CCCCCC"> include</font><font color="#E5E5E5"> Windows Defender</font>

167
00:07:51,759 --> 00:07:59,729
antivirus<font color="#E5E5E5"> the new advanced threat</font>

168
00:07:55,629 --> 00:08:02,349
protection or ATP<font color="#CCCCCC"> it also came</font><font color="#E5E5E5"> out as</font>

169
00:07:59,729 --> 00:08:05,370
Windows<font color="#E5E5E5"> Defender exploit guard so if</font>

170
00:08:02,349 --> 00:08:08,080
anyone's used<font color="#CCCCCC"> Amit this is the new Amit</font>

171
00:08:05,370 --> 00:08:10,449
<font color="#CCCCCC">it's now Windows Defender</font><font color="#E5E5E5"> application</font>

172
00:08:08,080 --> 00:08:13,539
guard device guard<font color="#E5E5E5"> firewall and</font>

173
00:08:10,449 --> 00:08:18,249
credential guard<font color="#CCCCCC"> the third version</font><font color="#E5E5E5"> that</font>

174
00:08:13,539 --> 00:08:20,259
<font color="#CCCCCC">just came out also</font><font color="#E5E5E5"> provided expanded</font>

175
00:08:18,249 --> 00:08:23,889
support<font color="#E5E5E5"> for</font><font color="#CCCCCC"> operating systems so some</font>

176
00:08:20,259 --> 00:08:27,430
initial<font color="#E5E5E5"> support for 2012 and 2016</font>

177
00:08:23,889 --> 00:08:31,839
I'm sorry 2012 r2 and 2016<font color="#E5E5E5"> and</font><font color="#CCCCCC"> a bit of</font>

178
00:08:27,430 --> 00:08:36,549
<font color="#E5E5E5">Linux support as well</font><font color="#CCCCCC"> and and</font><font color="#E5E5E5"> really</font><font color="#CCCCCC"> the</font>

179
00:08:31,839 --> 00:08:38,588
focus<font color="#CCCCCC"> of this released 3 was</font><font color="#E5E5E5"> to</font>

180
00:08:36,549 --> 00:08:40,870
consolidate<font color="#E5E5E5"> the entire Windows 10</font>

181
00:08:38,589 --> 00:08:43,149
security stack into a single pane of

182
00:08:40,870 --> 00:08:45,250
<font color="#CCCCCC">glass</font><font color="#E5E5E5"> you if you have some</font><font color="#CCCCCC"> binoculars up</font>

183
00:08:43,149 --> 00:08:47,709
<font color="#E5E5E5">there you can see that</font><font color="#CCCCCC"> we have device</font>

184
00:08:45,250 --> 00:08:50,139
guard firewall cred guard<font color="#E5E5E5"> all those</font>

185
00:08:47,709 --> 00:08:52,569
<font color="#E5E5E5">technologies I talked</font><font color="#CCCCCC"> about reporting in</font>

186
00:08:50,139 --> 00:08:54,670
for all the<font color="#E5E5E5"> devices we</font><font color="#CCCCCC"> see by OS we see</font>

187
00:08:52,569 --> 00:08:55,880
which ones<font color="#E5E5E5"> are missing patches</font><font color="#CCCCCC"> we see</font>

188
00:08:54,670 --> 00:08:57,530
you know

189
00:08:55,880 --> 00:08:59,150
and exploits being launched or certain

190
00:08:57,530 --> 00:09:03,140
payloads being caught up in the top-left

191
00:08:59,150 --> 00:09:05,300
<font color="#CCCCCC">corner and now in release for Microsoft</font>

192
00:09:03,140 --> 00:09:06,530
bought<font color="#E5E5E5"> a company</font><font color="#CCCCCC"> called hexa date and a</font>

193
00:09:05,300 --> 00:09:09,079
lot of hexa<font color="#CCCCCC"> Deitz</font>

194
00:09:06,530 --> 00:09:12,410
IP was around auto or mediating some of

195
00:09:09,080 --> 00:09:14,720
these<font color="#E5E5E5"> things so if an initial</font><font color="#CCCCCC"> infection</font>

196
00:09:12,410 --> 00:09:16,730
is is found<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> gonna automatically</font>

197
00:09:14,720 --> 00:09:18,920
<font color="#E5E5E5">analyze you know all the files and</font>

198
00:09:16,730 --> 00:09:21,230
processes and<font color="#CCCCCC"> services and drivers on</font>

199
00:09:18,920 --> 00:09:23,839
that infected device<font color="#CCCCCC"> it's then going</font><font color="#E5E5E5"> to</font>

200
00:09:21,230 --> 00:09:25,940
<font color="#E5E5E5">look for certain</font><font color="#CCCCCC"> i/o</font><font color="#E5E5E5"> sees it's going to</font>

201
00:09:23,840 --> 00:09:28,490
look<font color="#E5E5E5"> at different</font><font color="#CCCCCC"> end points across the</font>

202
00:09:25,940 --> 00:09:30,230
network<font color="#E5E5E5"> that might have had the similar</font>

203
00:09:28,490 --> 00:09:32,780
IOC<font color="#CCCCCC"> s and then it's</font><font color="#E5E5E5"> going to auto</font>

204
00:09:30,230 --> 00:09:35,750
quarantine or mediate them so it<font color="#E5E5E5"> might</font>

205
00:09:32,780 --> 00:09:38,110
use<font color="#E5E5E5"> windows firewall to block</font><font color="#CCCCCC"> command</font>

206
00:09:35,750 --> 00:09:42,860
and control traffic<font color="#E5E5E5"> to the attackers box</font>

207
00:09:38,110 --> 00:09:44,480
<font color="#CCCCCC">it might you know remove a file if</font>

208
00:09:42,860 --> 00:09:46,250
there's more<font color="#CCCCCC"> Advanced Options that</font><font color="#E5E5E5"> need</font>

209
00:09:44,480 --> 00:09:50,270
to<font color="#CCCCCC"> be</font><font color="#E5E5E5"> taken it'll wait for the operators</font>

210
00:09:46,250 --> 00:09:51,830
approval<font color="#CCCCCC"> but you know pretty interesting</font>

211
00:09:50,270 --> 00:09:55,550
stuff<font color="#E5E5E5"> that's coming out the pipe from</font>

212
00:09:51,830 --> 00:09:56,750
<font color="#E5E5E5">from Microsoft so far from automating</font>

213
00:09:55,550 --> 00:09:58,880
defenders out<font color="#E5E5E5"> of a job I think</font>

214
00:09:56,750 --> 00:10:00,710
<font color="#E5E5E5">especially for smaller shops this type</font>

215
00:09:58,880 --> 00:10:02,990
<font color="#CCCCCC">of product will really help them to</font>

216
00:10:00,710 --> 00:10:05,270
augment their in-house capabilities and

217
00:10:02,990 --> 00:10:08,270
allow them to<font color="#E5E5E5"> free up some time to</font>

218
00:10:05,270 --> 00:10:13,310
really start<font color="#E5E5E5"> to</font><font color="#CCCCCC"> focus</font><font color="#E5E5E5"> on more advanced</font>

219
00:10:08,270 --> 00:10:17,569
threat hunting so if we<font color="#CCCCCC"> actually</font><font color="#E5E5E5"> look at</font>

220
00:10:13,310 --> 00:10:20,680
advanced threat protection<font color="#CCCCCC"> in play you</font>

221
00:10:17,570 --> 00:10:24,440
know here's launching a novice gated

222
00:10:20,680 --> 00:10:26,900
<font color="#E5E5E5">PowerShell</font><font color="#CCCCCC"> band it's caught</font>

223
00:10:24,440 --> 00:10:29,930
here's launching a much more<font color="#E5E5E5"> heavily</font>

224
00:10:26,900 --> 00:10:31,730
obfuscated<font color="#E5E5E5"> command still caught this is</font>

225
00:10:29,930 --> 00:10:33,920
you know when we talk about PowerShell

226
00:10:31,730 --> 00:10:37,100
<font color="#CCCCCC">Empire a lot of cobalt</font><font color="#E5E5E5"> strike payloads</font><font color="#CCCCCC"> a</font>

227
00:10:33,920 --> 00:10:39,770
lot<font color="#E5E5E5"> of them are based in PowerShell so</font>

228
00:10:37,100 --> 00:10:41,870
when you take things like the obfuscated

229
00:10:39,770 --> 00:10:43,400
<font color="#E5E5E5">Empire project and whatnot this is still</font>

230
00:10:41,870 --> 00:10:45,430
gonna catch them<font color="#E5E5E5"> and we'll see</font><font color="#CCCCCC"> why in a</font>

231
00:10:43,400 --> 00:10:47,990
minute

232
00:10:45,430 --> 00:10:50,870
<font color="#CCCCCC">so with PowerShell Microsoft gave us</font>

233
00:10:47,990 --> 00:10:53,420
this<font color="#CCCCCC"> amazing framework</font><font color="#E5E5E5"> attackers have</font>

234
00:10:50,870 --> 00:10:55,610
been favoring using PowerShell the

235
00:10:53,420 --> 00:10:59,120
executable<font color="#CCCCCC"> powershell the core or the</font>

236
00:10:55,610 --> 00:11:00,860
<font color="#E5E5E5">windows management</font><font color="#CCCCCC"> framework for several</font>

237
00:10:59,120 --> 00:11:02,870
years<font color="#CCCCCC"> because it's so flexible and</font>

238
00:11:00,860 --> 00:11:05,300
<font color="#E5E5E5">because it's so easy to use</font><font color="#CCCCCC"> we've seen</font>

239
00:11:02,870 --> 00:11:08,330
<font color="#E5E5E5">some awesome tools as attackers come out</font>

240
00:11:05,300 --> 00:11:09,170
you know frameworks like<font color="#CCCCCC"> empire</font><font color="#E5E5E5"> tools</font>

241
00:11:08,330 --> 00:11:11,829
like<font color="#CCCCCC"> powerup</font>

242
00:11:09,170 --> 00:11:14,510
<font color="#CCCCCC">unmanage powershell powersploit nishang</font>

243
00:11:11,829 --> 00:11:16,550
power view user hunter and bloodhound

244
00:11:14,510 --> 00:11:19,670
<font color="#E5E5E5">and all of these you know</font><font color="#CCCCCC"> a lot of these</font>

245
00:11:16,550 --> 00:11:22,849
are deeply<font color="#E5E5E5"> connected</font><font color="#CCCCCC"> with with</font>

246
00:11:19,670 --> 00:11:24,529
<font color="#CCCCCC">powershell</font><font color="#E5E5E5"> but now that</font><font color="#CCCCCC"> microsoft you</font>

247
00:11:22,850 --> 00:11:26,300
know got us all developing tools<font color="#E5E5E5"> and</font>

248
00:11:24,529 --> 00:11:28,579
attack frameworks on top of<font color="#CCCCCC"> powershell</font>

249
00:11:26,300 --> 00:11:30,469
they started to implement<font color="#E5E5E5"> heavy logging</font>

250
00:11:28,579 --> 00:11:32,630
and heavy<font color="#E5E5E5"> d obfuscation technologies</font>

251
00:11:30,470 --> 00:11:34,220
into<font color="#CCCCCC"> powershell</font><font color="#E5E5E5"> so they're trying to</font>

252
00:11:32,630 --> 00:11:40,850
take those shiny new tools that<font color="#E5E5E5"> we've</font>

253
00:11:34,220 --> 00:11:43,730
all come<font color="#CCCCCC"> to rely on away so if if you're</font>

254
00:11:40,850 --> 00:11:46,310
<font color="#E5E5E5">not familiar with with all the new</font>

255
00:11:43,730 --> 00:11:49,160
improvements<font color="#E5E5E5"> around</font><font color="#CCCCCC"> windows management</font>

256
00:11:46,310 --> 00:11:51,170
<font color="#E5E5E5">framework</font><font color="#CCCCCC"> 5</font><font color="#E5E5E5"> here's some are so you know</font>

257
00:11:49,160 --> 00:11:53,360
we're<font color="#E5E5E5"> doing</font><font color="#CCCCCC"> powershell script prop</font>

258
00:11:51,170 --> 00:11:55,010
logging<font color="#E5E5E5"> trans transaction and</font>

259
00:11:53,360 --> 00:11:56,269
transcription logging it's looking for

260
00:11:55,010 --> 00:11:59,569
<font color="#E5E5E5">suspicious strings</font>

261
00:11:56,269 --> 00:12:03,170
<font color="#CCCCCC">it's enforcing a constrain language</font><font color="#E5E5E5"> low</font>

262
00:11:59,570 --> 00:12:06,139
mode<font color="#E5E5E5"> it's got the anti-malware scanning</font>

263
00:12:03,170 --> 00:12:08,630
interface which<font color="#CCCCCC"> can put all the office</font>

264
00:12:06,139 --> 00:12:10,730
gated PowerShell commands through to the

265
00:12:08,630 --> 00:12:14,660
antivirus engine and check those for

266
00:12:10,730 --> 00:12:16,250
malicious signatures<font color="#CCCCCC"> but you know I</font>

267
00:12:14,660 --> 00:12:17,779
<font color="#E5E5E5">won't spend too much time on</font><font color="#CCCCCC"> these but</font>

268
00:12:16,250 --> 00:12:19,339
if you are you know<font color="#CCCCCC"> an</font><font color="#E5E5E5"> offense or</font>

269
00:12:17,779 --> 00:12:22,279
defense you really should be<font color="#CCCCCC"> familiar</font>

270
00:12:19,339 --> 00:12:24,620
with<font color="#E5E5E5"> these especially as they're</font>

271
00:12:22,279 --> 00:12:30,470
becoming more core to the<font color="#CCCCCC"> the security</font>

272
00:12:24,620 --> 00:12:35,029
<font color="#CCCCCC">stack</font><font color="#E5E5E5"> and because PowerShell are sorry</font>

273
00:12:30,470 --> 00:12:36,949
Windows 10 and<font color="#CCCCCC"> 80 P</font><font color="#E5E5E5"> are enforcing</font>

274
00:12:35,029 --> 00:12:39,019
<font color="#E5E5E5">Windows management framework</font><font color="#CCCCCC"> 5</font>

275
00:12:36,949 --> 00:12:40,339
you can't even downgrade to<font color="#CCCCCC"> PowerShell</font>

276
00:12:39,019 --> 00:12:41,990
version<font color="#E5E5E5"> 2 anymore because they've</font>

277
00:12:40,339 --> 00:12:44,029
removed it all together in the latest

278
00:12:41,990 --> 00:12:46,010
creators update so<font color="#E5E5E5"> that was a free</font><font color="#CCCCCC"> bic</font>

279
00:12:44,029 --> 00:12:48,140
technique to downgrade<font color="#E5E5E5"> to to get around</font>

280
00:12:46,010 --> 00:12:49,550
all those new technologies<font color="#CCCCCC"> I just talked</font>

281
00:12:48,140 --> 00:12:51,470
about<font color="#E5E5E5"> Oh we'll just</font><font color="#CCCCCC"> go back to an</font>

282
00:12:49,550 --> 00:12:52,699
<font color="#E5E5E5">earlier version of PowerShell get around</font>

283
00:12:51,470 --> 00:12:53,810
all that you can't do<font color="#E5E5E5"> that anymore</font>

284
00:12:52,699 --> 00:12:55,490
<font color="#E5E5E5">because</font><font color="#CCCCCC"> they've removed support</font>

285
00:12:53,810 --> 00:12:59,390
<font color="#CCCCCC">PowerShell version 2</font><font color="#E5E5E5"> in the latest</font>

286
00:12:55,490 --> 00:13:01,519
<font color="#E5E5E5">update</font><font color="#CCCCCC"> so common techniques that</font><font color="#E5E5E5"> also</font>

287
00:12:59,390 --> 00:13:04,910
leverage like<font color="#CCCCCC"> w</font><font color="#E5E5E5"> script shell or also</font>

288
00:13:01,519 --> 00:13:06,260
caught you can't use not not<font color="#CCCCCC"> powershell</font>

289
00:13:04,910 --> 00:13:10,189
<font color="#CCCCCC">and just call the windows management</font>

290
00:13:06,260 --> 00:13:13,970
<font color="#E5E5E5">framework directly because you know it's</font>

291
00:13:10,190 --> 00:13:17,959
all<font color="#E5E5E5"> forced to use the</font><font color="#CCCCCC"> the version</font><font color="#E5E5E5"> 5</font>

292
00:13:13,970 --> 00:13:19,610
which<font color="#CCCCCC"> has</font><font color="#E5E5E5"> all those technologies so you</font>

293
00:13:17,959 --> 00:13:21,410
know we we start to see<font color="#E5E5E5"> that attackers</font>

294
00:13:19,610 --> 00:13:23,000
common techniques are being<font color="#CCCCCC"> caught</font>

295
00:13:21,410 --> 00:13:26,480
across<font color="#E5E5E5"> the board</font>

296
00:13:23,000 --> 00:13:30,170
you know<font color="#E5E5E5"> and it's pretty good</font><font color="#CCCCCC"> at</font>

297
00:13:26,480 --> 00:13:31,670
detecting<font color="#E5E5E5"> a lot of these</font><font color="#CCCCCC"> signed binaries</font>

298
00:13:30,170 --> 00:13:33,979
that<font color="#CCCCCC"> are used to launch malware</font>

299
00:13:31,670 --> 00:13:36,079
executables<font color="#CCCCCC"> it's pretty</font><font color="#E5E5E5"> good at</font>

300
00:13:33,980 --> 00:13:37,370
<font color="#CCCCCC">detecting abnormal behavior that you</font>

301
00:13:36,080 --> 00:13:39,410
know maybe you're connecting out to a

302
00:13:37,370 --> 00:13:44,020
newly registered domain or to a tour

303
00:13:39,410 --> 00:13:46,370
<font color="#E5E5E5">service</font><font color="#CCCCCC"> and so a lot of the initial</font>

304
00:13:44,020 --> 00:13:50,030
execution or attack vectors that that

305
00:13:46,370 --> 00:13:51,890
we're<font color="#E5E5E5"> performing are getting caught but</font>

306
00:13:50,030 --> 00:13:55,430
you<font color="#CCCCCC"> know there</font><font color="#E5E5E5"> are some options for</font>

307
00:13:51,890 --> 00:13:57,920
<font color="#E5E5E5">gaining initial foothold</font><font color="#CCCCCC"> we can use</font>

308
00:13:55,430 --> 00:13:59,810
obvious gated Java or VB script payloads

309
00:13:57,920 --> 00:14:03,640
that<font color="#E5E5E5"> don't have kernel32 API</font>

310
00:13:59,810 --> 00:14:07,339
declarations so just like cactus torch

311
00:14:03,640 --> 00:14:11,930
<font color="#CCCCCC">we can use signed execs to load</font><font color="#E5E5E5"> cobalt</font>

312
00:14:07,340 --> 00:14:14,450
<font color="#CCCCCC">stages payloads or we can you know</font>

313
00:14:11,930 --> 00:14:17,540
continue<font color="#E5E5E5"> with either encrypted or</font>

314
00:14:14,450 --> 00:14:19,400
obfuscated<font color="#E5E5E5"> techniques that are used</font><font color="#CCCCCC"> by</font>

315
00:14:17,540 --> 00:14:25,579
<font color="#CCCCCC">veil or shelter to get</font><font color="#E5E5E5"> around some of</font>

316
00:14:19,400 --> 00:14:27,920
<font color="#E5E5E5">these but the the challenge doesn't stop</font>

317
00:14:25,580 --> 00:14:29,870
about on getting on the<font color="#CCCCCC"> box initially</font>

318
00:14:27,920 --> 00:14:31,400
that's<font color="#E5E5E5"> the easy part we can all you know</font>

319
00:14:29,870 --> 00:14:33,200
<font color="#E5E5E5">fish somebody and get on the</font><font color="#CCCCCC"> box</font>

320
00:14:31,400 --> 00:14:35,680
initially and maybe that payloads caught

321
00:14:33,200 --> 00:14:37,910
maybe it's not maybe we've used some

322
00:14:35,680 --> 00:14:41,150
crazy technique that<font color="#CCCCCC"> just came off a</font>

323
00:14:37,910 --> 00:14:43,010
<font color="#CCCCCC">twitter that morning</font><font color="#E5E5E5"> and an ATP hasn't</font>

324
00:14:41,150 --> 00:14:44,990
been<font color="#CCCCCC"> updated yet the challenge is</font><font color="#E5E5E5"> not</font>

325
00:14:43,010 --> 00:14:47,870
getting<font color="#E5E5E5"> on</font><font color="#CCCCCC"> the box initially the</font>

326
00:14:44,990 --> 00:14:49,400
challenge is<font color="#E5E5E5"> the commands and tools that</font>

327
00:14:47,870 --> 00:14:52,850
<font color="#E5E5E5">you need</font><font color="#CCCCCC"> to run</font><font color="#E5E5E5"> after you get on the box</font>

328
00:14:49,400 --> 00:14:54,530
<font color="#CCCCCC">so how do you perform new process</font>

329
00:14:52,850 --> 00:14:58,280
creation<font color="#E5E5E5"> without getting caught how do</font>

330
00:14:54,530 --> 00:14:59,930
you check<font color="#E5E5E5"> for privilege escalation how</font>

331
00:14:58,280 --> 00:15:01,699
you check<font color="#CCCCCC"> for vulnerabilities on the</font><font color="#E5E5E5"> box</font>

332
00:14:59,930 --> 00:15:06,079
to<font color="#E5E5E5"> actually escalate your privileges on</font>

333
00:15:01,700 --> 00:15:08,780
the<font color="#E5E5E5"> box and take</font><font color="#CCCCCC"> over it how do you</font><font color="#E5E5E5"> get</font>

334
00:15:06,080 --> 00:15:10,790
around<font color="#CCCCCC"> preventive controls like UAC and</font>

335
00:15:08,780 --> 00:15:12,470
<font color="#CCCCCC">AppLocker</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> emit</font><font color="#E5E5E5"> against</font><font color="#CCCCCC"> drain</font>

336
00:15:10,790 --> 00:15:14,660
language mode and<font color="#E5E5E5"> PowerShell logging</font>

337
00:15:12,470 --> 00:15:18,040
when it's all going<font color="#CCCCCC"> through</font><font color="#E5E5E5"> the</font>

338
00:15:14,660 --> 00:15:22,640
PowerShell<font color="#CCCCCC"> and or sorry the ATP</font><font color="#E5E5E5"> sensor</font>

339
00:15:18,040 --> 00:15:25,250
so you know as an attacker<font color="#E5E5E5"> some of these</font>

340
00:15:22,640 --> 00:15:27,020
commands might look familiar to you for

341
00:15:25,250 --> 00:15:28,010
doing<font color="#CCCCCC"> hosts recon so understanding</font>

342
00:15:27,020 --> 00:15:30,430
what's on the box

343
00:15:28,010 --> 00:15:32,750
understanding what antivirus is in place

344
00:15:30,430 --> 00:15:35,540
<font color="#CCCCCC">seeing</font><font color="#E5E5E5"> what programs might be vulnerable</font>

345
00:15:32,750 --> 00:15:36,610
<font color="#E5E5E5">on the</font><font color="#CCCCCC"> box who the users are more info</font>

346
00:15:35,540 --> 00:15:39,370
<font color="#E5E5E5">well the system</font>

347
00:15:36,610 --> 00:15:45,550
but<font color="#E5E5E5"> these are all pretty much caught if</font>

348
00:15:39,370 --> 00:15:49,000
run in the same time<font color="#CCCCCC"> period so instead</font>

349
00:15:45,550 --> 00:15:50,680
of you<font color="#E5E5E5"> know using these typical commands</font>

350
00:15:49,000 --> 00:15:54,790
we<font color="#E5E5E5"> need to move towards different</font>

351
00:15:50,680 --> 00:15:57,579
opportunities like using<font color="#CCCCCC"> WMI so we can</font>

352
00:15:54,790 --> 00:16:02,290
we<font color="#E5E5E5"> can get around</font><font color="#CCCCCC"> detection by just</font>

353
00:15:57,579 --> 00:16:04,989
using<font color="#CCCCCC"> WMI</font><font color="#E5E5E5"> either through the</font><font color="#CCCCCC"> wi command</font>

354
00:16:02,290 --> 00:16:06,699
<font color="#CCCCCC">line</font><font color="#E5E5E5"> W</font><font color="#CCCCCC"> Mik</font><font color="#E5E5E5"> or calling the W my schema</font>

355
00:16:04,990 --> 00:16:09,970
directly

356
00:16:06,700 --> 00:16:13,540
I spoke to Microsoft<font color="#CCCCCC"> and they're looking</font>

357
00:16:09,970 --> 00:16:16,570
to really improve<font color="#CCCCCC"> W</font><font color="#E5E5E5"> my detection in the</font>

358
00:16:13,540 --> 00:16:18,490
<font color="#E5E5E5">upcoming spring release apparently</font>

359
00:16:16,570 --> 00:16:19,899
they've put some detection<font color="#E5E5E5"> into just</font>

360
00:16:18,490 --> 00:16:24,820
<font color="#E5E5E5">Tuesday's update but I</font><font color="#CCCCCC"> haven't</font><font color="#E5E5E5"> had a</font>

361
00:16:19,899 --> 00:16:27,519
chance<font color="#CCCCCC"> to</font><font color="#E5E5E5"> test it out yet</font><font color="#CCCCCC"> also not</font>

362
00:16:24,820 --> 00:16:29,410
<font color="#CCCCCC">detected is if we kind</font><font color="#E5E5E5"> of go back</font><font color="#CCCCCC"> to</font>

363
00:16:27,519 --> 00:16:31,209
<font color="#E5E5E5">living off the land and using</font><font color="#CCCCCC"> host</font><font color="#E5E5E5"> only</font>

364
00:16:29,410 --> 00:16:33,640
<font color="#E5E5E5">information</font><font color="#CCCCCC"> gathering techniques</font><font color="#E5E5E5"> that</font>

365
00:16:31,209 --> 00:16:37,149
directly call window<font color="#CCCCCC"> AP windows api is</font>

366
00:16:33,640 --> 00:16:42,160
through raw sockets like meterpreter<font color="#E5E5E5"> has</font>

367
00:16:37,149 --> 00:16:43,690
got the<font color="#CCCCCC"> railgun</font><font color="#E5E5E5"> post module but before</font>

368
00:16:42,160 --> 00:16:46,660
you<font color="#CCCCCC"> use those</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> want</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> make sure</font><font color="#E5E5E5"> that</font>

369
00:16:43,690 --> 00:16:49,690
those<font color="#CCCCCC"> Metasploit modules are only</font><font color="#E5E5E5"> using</font>

370
00:16:46,660 --> 00:16:51,610
local<font color="#CCCCCC"> api calls when you use stuff like</font>

371
00:16:49,690 --> 00:16:54,630
local<font color="#E5E5E5"> min search that's going across the</font>

372
00:16:51,610 --> 00:16:59,260
<font color="#CCCCCC">network and that that could be flagged</font>

373
00:16:54,630 --> 00:17:00,699
<font color="#CCCCCC">they also use a lot of non</font><font color="#E5E5E5"> host only</font><font color="#CCCCCC"> API</font>

374
00:16:59,260 --> 00:17:03,040
<font color="#E5E5E5">is in those scripts so you want to</font>

375
00:17:00,699 --> 00:17:06,809
review<font color="#E5E5E5"> them first Kobalt strike has a</font>

376
00:17:03,040 --> 00:17:09,339
number<font color="#E5E5E5"> of modules</font><font color="#CCCCCC"> that are also API only</font>

377
00:17:06,809 --> 00:17:12,069
<font color="#CCCCCC">and we also want to make sure that again</font>

378
00:17:09,339 --> 00:17:13,809
we're sticking to focusing on host recon

379
00:17:12,069 --> 00:17:19,178
and not going<font color="#E5E5E5"> out against the network</font>

380
00:17:13,809 --> 00:17:21,970
because we might get<font color="#CCCCCC"> caught by ata so if</font>

381
00:17:19,179 --> 00:17:24,160
we look<font color="#CCCCCC"> more at</font><font color="#E5E5E5"> common any virus or</font>

382
00:17:21,970 --> 00:17:29,500
bypass techniques a lot of these<font color="#E5E5E5"> won't</font>

383
00:17:24,160 --> 00:17:31,750
work<font color="#E5E5E5"> as</font><font color="#CCCCCC"> an in menu might be</font><font color="#E5E5E5"> able to read</font>

384
00:17:29,500 --> 00:17:34,540
modify<font color="#CCCCCC"> the registry but that</font><font color="#E5E5E5"> won't take</font>

385
00:17:31,750 --> 00:17:37,419
effect<font color="#E5E5E5"> until their next reboot you could</font>

386
00:17:34,540 --> 00:17:40,720
also modify<font color="#CCCCCC"> file permissions maybe but</font>

387
00:17:37,419 --> 00:17:43,210
it's super<font color="#CCCCCC"> noisy and easy to</font><font color="#E5E5E5"> detect</font><font color="#CCCCCC"> and</font>

388
00:17:40,720 --> 00:17:44,830
unlike other next-gen AV products like

389
00:17:43,210 --> 00:17:46,300
CrowdStrike you can't just<font color="#CCCCCC"> uninstall</font>

390
00:17:44,830 --> 00:17:49,350
them from an elevated<font color="#E5E5E5"> command line</font>

391
00:17:46,300 --> 00:17:53,178
<font color="#E5E5E5">because</font><font color="#CCCCCC"> it actually</font><font color="#E5E5E5"> requires a signed</font>

392
00:17:49,350 --> 00:17:55,740
off-boarding script<font color="#E5E5E5"> you uninstall ATP</font>

393
00:17:53,179 --> 00:17:58,169
<font color="#CCCCCC">and the reason you can't stop</font><font color="#E5E5E5"> these</font>

394
00:17:55,740 --> 00:18:01,440
<font color="#CCCCCC">evenness system is is</font><font color="#E5E5E5"> do to protect</font>

395
00:17:58,169 --> 00:18:05,429
process light or ppl it's a mechanism

396
00:18:01,440 --> 00:18:07,049
<font color="#E5E5E5">that was introduced in Windows 8.1 that</font>

397
00:18:05,429 --> 00:18:08,490
transfers many of the<font color="#E5E5E5"> security</font>

398
00:18:07,049 --> 00:18:11,250
restrictions<font color="#E5E5E5"> applied to the</font><font color="#CCCCCC"> system</font>

399
00:18:08,490 --> 00:18:12,980
process<font color="#E5E5E5"> to user mode processes but it</font>

400
00:18:11,250 --> 00:18:17,490
hasn't<font color="#CCCCCC"> been</font><font color="#E5E5E5"> widely implemented until</font>

401
00:18:12,980 --> 00:18:20,190
<font color="#E5E5E5">just now</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> binary is signed by a</font>

402
00:18:17,490 --> 00:18:23,399
Windows cert<font color="#E5E5E5"> with the windows ppl</font>

403
00:18:20,190 --> 00:18:26,970
verification cert<font color="#E5E5E5"> the extended key use</font>

404
00:18:23,399 --> 00:18:29,668
property there<font color="#CCCCCC"> and after the</font><font color="#E5E5E5"> process is</font>

405
00:18:26,970 --> 00:18:32,250
launched<font color="#CCCCCC"> as protected Windows uses code</font>

406
00:18:29,669 --> 00:18:34,860
integrity to only allow trusted<font color="#E5E5E5"> signed</font>

407
00:18:32,250 --> 00:18:37,429
Microsoft code to load<font color="#E5E5E5"> into that</font>

408
00:18:34,860 --> 00:18:41,699
protected process

409
00:18:37,429 --> 00:18:44,870
17:03 or Windows 10<font color="#E5E5E5"> 1703 also added the</font>

410
00:18:41,700 --> 00:18:48,090
binary signature policy<font color="#E5E5E5"> which helps</font>

411
00:18:44,870 --> 00:18:51,029
mitigate some process injection

412
00:18:48,090 --> 00:18:54,178
techniques as well if you want to know

413
00:18:51,029 --> 00:18:56,610
more<font color="#E5E5E5"> about ppl</font><font color="#CCCCCC"> Alex ion ask you has</font>

414
00:18:54,179 --> 00:18:58,919
extend extensively covered ppl and<font color="#E5E5E5"> older</font>

415
00:18:56,610 --> 00:19:05,240
blog posts of his but until now again we

416
00:18:58,919 --> 00:19:05,240
haven't<font color="#E5E5E5"> seen PBL's widely implemented so</font>

417
00:19:05,360 --> 00:19:12,959
<font color="#CCCCCC">james Forshaw had a from project</font><font color="#E5E5E5"> zero</font>

418
00:19:09,990 --> 00:19:16,950
came out with a ppl bypass specifically

419
00:19:12,960 --> 00:19:20,279
for<font color="#E5E5E5"> Windows</font><font color="#CCCCCC"> Defender ppl and you could</font>

420
00:19:16,950 --> 00:19:24,000
basically modify the trusted installer

421
00:19:20,279 --> 00:19:26,340
path<font color="#E5E5E5"> to say when I</font><font color="#CCCCCC"> launch trusted</font>

422
00:19:24,000 --> 00:19:28,320
installer<font color="#E5E5E5"> I'm stopping Windows Defender</font>

423
00:19:26,340 --> 00:19:30,959
and deleting Windows Defender service

424
00:19:28,320 --> 00:19:35,070
<font color="#E5E5E5">and then I</font><font color="#CCCCCC"> started and so that was a</font>

425
00:19:30,960 --> 00:19:41,039
<font color="#E5E5E5">great bypass</font><font color="#CCCCCC"> it doesn't work in since</font>

426
00:19:35,070 --> 00:19:43,678
the spring<font color="#E5E5E5"> release for ATP because ATP</font>

427
00:19:41,039 --> 00:19:45,330
now runs<font color="#E5E5E5"> at the windows ppl level</font>

428
00:19:43,679 --> 00:19:47,370
instead of<font color="#CCCCCC"> anti-malware</font><font color="#E5E5E5"> ppl which</font>

429
00:19:45,330 --> 00:19:49,678
<font color="#E5E5E5">defender does and the process is</font>

430
00:19:47,370 --> 00:19:51,709
configured as not stoppable which is key

431
00:19:49,679 --> 00:19:55,860
which<font color="#CCCCCC"> we'll show you</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> a minute and</font>

432
00:19:51,710 --> 00:19:57,570
<font color="#CCCCCC">when you try</font><font color="#E5E5E5"> to modify that you are</font>

433
00:19:55,860 --> 00:20:00,959
getting flagged by ATP<font color="#E5E5E5"> as we see at the</font>

434
00:19:57,570 --> 00:20:02,399
bottom<font color="#E5E5E5"> there</font><font color="#CCCCCC"> so the ATP sensor</font>

435
00:20:00,960 --> 00:20:04,320
communicates using<font color="#E5E5E5"> the</font>

436
00:20:02,400 --> 00:20:05,670
<font color="#E5E5E5">windows telemetry service the the same</font>

437
00:20:04,320 --> 00:20:07,770
thing that<font color="#E5E5E5"> everyone is complaining about</font>

438
00:20:05,670 --> 00:20:09,810
on the<font color="#CCCCCC"> internet</font><font color="#E5E5E5"> you know three years</font><font color="#CCCCCC"> ago</font>

439
00:20:07,770 --> 00:20:11,610
when Windows 10 came out how there's so

440
00:20:09,810 --> 00:20:14,190
<font color="#E5E5E5">much telemetry data being sent well this</font>

441
00:20:11,610 --> 00:20:18,240
is how they're implementing it<font color="#CCCCCC"> telemetry</font>

442
00:20:14,190 --> 00:20:20,970
uses the<font color="#CCCCCC"> when HTTP services</font><font color="#E5E5E5"> and that in</font>

443
00:20:18,240 --> 00:20:25,560
API is independent<font color="#E5E5E5"> of your proxy browser</font>

444
00:20:20,970 --> 00:20:29,040
settings but however it will follow<font color="#E5E5E5"> a</font>

445
00:20:25,560 --> 00:20:33,120
proxy settings within<font color="#CCCCCC"> the user registry</font>

446
00:20:29,040 --> 00:20:36,780
<font color="#CCCCCC">that any user can add things to so we</font>

447
00:20:33,120 --> 00:20:39,629
can simply just<font color="#E5E5E5"> add a registry key that</font>

448
00:20:36,780 --> 00:20:42,030
says use my<font color="#CCCCCC"> sync Holling proxy script</font>

449
00:20:39,630 --> 00:20:45,420
<font color="#CCCCCC">and what that script says is anything</font>

450
00:20:42,030 --> 00:20:48,210
that<font color="#CCCCCC"> is going to the Microsoft domains</font>

451
00:20:45,420 --> 00:20:50,340
<font color="#CCCCCC">they're 480p</font><font color="#E5E5E5"> put them sinkhole them all</font>

452
00:20:48,210 --> 00:20:51,600
to the local box<font color="#E5E5E5"> otherwise return them</font>

453
00:20:50,340 --> 00:20:56,570
directly<font color="#E5E5E5"> to the internet so</font><font color="#CCCCCC"> you're not</font>

454
00:20:51,600 --> 00:20:59,010
impacting regular traffic<font color="#E5E5E5"> now this</font>

455
00:20:56,570 --> 00:21:01,110
technique<font color="#CCCCCC"> apparently might have been</font>

456
00:20:59,010 --> 00:21:03,810
fixed<font color="#E5E5E5"> just now</font><font color="#CCCCCC"> I haven't</font><font color="#E5E5E5"> had a chance</font><font color="#CCCCCC"> to</font>

457
00:21:01,110 --> 00:21:05,760
properly<font color="#CCCCCC"> test it yet I do have</font><font color="#E5E5E5"> another</font>

458
00:21:03,810 --> 00:21:07,530
unprivileged technique but I'm saving<font color="#CCCCCC"> it</font>

459
00:21:05,760 --> 00:21:12,150
<font color="#E5E5E5">for</font><font color="#CCCCCC"> your blackhat once</font><font color="#E5E5E5"> I've had more</font>

460
00:21:07,530 --> 00:21:13,680
time to disclose it to<font color="#CCCCCC"> Microsoft but</font>

461
00:21:12,150 --> 00:21:16,470
<font color="#E5E5E5">when we talk about privileged techniques</font>

462
00:21:13,680 --> 00:21:20,100
this<font color="#E5E5E5"> is one of</font><font color="#CCCCCC"> my favorite quotes</font>

463
00:21:16,470 --> 00:21:21,510
recently from from<font color="#E5E5E5"> Matt</font><font color="#CCCCCC"> Graber and it</font>

464
00:21:20,100 --> 00:21:23,490
can<font color="#E5E5E5"> apply to a lot</font><font color="#CCCCCC"> of different</font>

465
00:21:21,510 --> 00:21:25,800
technologies along the<font color="#E5E5E5"> kill</font><font color="#CCCCCC"> or a lot of</font>

466
00:21:23,490 --> 00:21:27,690
<font color="#E5E5E5">activities along the kill chain</font><font color="#CCCCCC"> a lot of</font>

467
00:21:25,800 --> 00:21:29,070
bypass techniques rely on having

468
00:21:27,690 --> 00:21:31,500
privileges on<font color="#CCCCCC"> the box</font>

469
00:21:29,070 --> 00:21:33,240
and while defenders<font color="#E5E5E5"> can do their</font><font color="#CCCCCC"> best to</font>

470
00:21:31,500 --> 00:21:35,820
<font color="#CCCCCC">reduce the number</font><font color="#E5E5E5"> of users with local</font>

471
00:21:33,240 --> 00:21:37,500
admin and<font color="#E5E5E5"> harden their box it's</font>

472
00:21:35,820 --> 00:21:39,780
<font color="#E5E5E5">inevitable</font><font color="#CCCCCC"> that some point in the future</font>

473
00:21:37,500 --> 00:21:41,610
<font color="#E5E5E5">an attacker is gonna fish one of your</font>

474
00:21:39,780 --> 00:21:44,760
<font color="#E5E5E5">users with an exploit or technique that</font>

475
00:21:41,610 --> 00:21:47,159
your org<font color="#CCCCCC"> didn't patch in time or maybe</font>

476
00:21:44,760 --> 00:21:50,250
some configuration abuse to become local

477
00:21:47,160 --> 00:21:51,960
<font color="#E5E5E5">admin once they get on the</font><font color="#CCCCCC"> box it's</font>

478
00:21:50,250 --> 00:21:54,450
extremely important that defenders

479
00:21:51,960 --> 00:21:56,400
implement redundant detection controls

480
00:21:54,450 --> 00:21:59,030
on a box so<font color="#CCCCCC"> that if an attacker does</font>

481
00:21:56,400 --> 00:22:01,320
manage to initially<font color="#CCCCCC"> get</font><font color="#E5E5E5"> on that box</font><font color="#CCCCCC"> as</font>

482
00:21:59,030 --> 00:22:05,550
local admin or quickly<font color="#E5E5E5"> upgrade their</font>

483
00:22:01,320 --> 00:22:07,169
privileges<font color="#CCCCCC"> and disable a TP your crowd</font>

484
00:22:05,550 --> 00:22:09,899
straight for example you also have

485
00:22:07,170 --> 00:22:13,140
redundant logging controls in place<font color="#E5E5E5"> that</font>

486
00:22:09,900 --> 00:22:15,160
use things like sis Mon and<font color="#CCCCCC"> WMI logging</font>

487
00:22:13,140 --> 00:22:16,960
and are sending<font color="#CCCCCC"> those all through</font>

488
00:22:15,160 --> 00:22:18,880
<font color="#E5E5E5">his event forwarding and with</font><font color="#CCCCCC"> windows</font>

489
00:22:16,960 --> 00:22:21,340
event forwarding<font color="#E5E5E5"> it's all free you</font><font color="#CCCCCC"> can</font>

490
00:22:18,880 --> 00:22:23,380
pick<font color="#E5E5E5"> it up</font><font color="#CCCCCC"> on a network share that's</font>

491
00:22:21,340 --> 00:22:26,110
protected and<font color="#E5E5E5"> analyze</font><font color="#CCCCCC"> that data</font><font color="#E5E5E5"> in your</font>

492
00:22:23,380 --> 00:22:28,570
sim<font color="#CCCCCC"> so you really want to</font><font color="#E5E5E5"> make</font><font color="#CCCCCC"> sure you</font>

493
00:22:26,110 --> 00:22:30,969
have these these redundant<font color="#E5E5E5"> logging in</font>

494
00:22:28,570 --> 00:22:32,710
place in<font color="#E5E5E5"> case somebody has privileges on</font>

495
00:22:30,970 --> 00:22:35,970
<font color="#CCCCCC">the</font><font color="#E5E5E5"> box but with that said</font><font color="#CCCCCC"> here's some</font>

496
00:22:32,710 --> 00:22:42,490
<font color="#E5E5E5">privileged techniques for disabling</font><font color="#CCCCCC"> a TP</font>

497
00:22:35,970 --> 00:22:46,990
so even though<font color="#E5E5E5"> a TP was a ppl in release</font>

498
00:22:42,490 --> 00:22:48,850
<font color="#E5E5E5">to the diagonal entry service was</font><font color="#CCCCCC"> not so</font>

499
00:22:46,990 --> 00:22:53,710
you could just<font color="#E5E5E5"> stop it</font>

500
00:22:48,850 --> 00:22:56,980
in<font color="#CCCCCC"> tuesday's release they did apply a</font>

501
00:22:53,710 --> 00:22:58,900
ppl not only to<font color="#E5E5E5"> diag track but to</font>

502
00:22:56,980 --> 00:23:04,180
<font color="#E5E5E5">Windows Firewall in another couple of</font>

503
00:22:58,900 --> 00:23:06,430
other services<font color="#CCCCCC"> but they didn't flag them</font>

504
00:23:04,180 --> 00:23:08,920
as not stoppable so<font color="#E5E5E5"> we can still kill</font>

505
00:23:06,430 --> 00:23:13,030
the<font color="#E5E5E5"> telemetry service by using James's</font>

506
00:23:08,920 --> 00:23:17,380
technique to both<font color="#E5E5E5"> stop</font><font color="#CCCCCC"> direct track but</font>

507
00:23:13,030 --> 00:23:19,000
more importantly to stop the<font color="#E5E5E5"> service</font>

508
00:23:17,380 --> 00:23:20,680
from ever running<font color="#E5E5E5"> again so we</font><font color="#CCCCCC"> can stop</font>

509
00:23:19,000 --> 00:23:22,960
it but<font color="#E5E5E5"> ATP is</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> start it right back</font>

510
00:23:20,680 --> 00:23:26,020
up<font color="#CCCCCC"> in five minutes so importantly we</font>

511
00:23:22,960 --> 00:23:27,730
need<font color="#E5E5E5"> to change</font><font color="#CCCCCC"> the executable to diet</font>

512
00:23:26,020 --> 00:23:29,980
track<font color="#E5E5E5"> to just some</font><font color="#CCCCCC"> blah</font>

513
00:23:27,730 --> 00:23:31,780
so that way when ATP goes to start

514
00:23:29,980 --> 00:23:33,820
<font color="#E5E5E5">dyeing</font><font color="#CCCCCC"> track</font><font color="#E5E5E5"> so it can send out all its</font>

515
00:23:31,780 --> 00:23:38,940
alerts to<font color="#CCCCCC"> the</font><font color="#E5E5E5"> Internet we just say now</font>

516
00:23:33,820 --> 00:23:38,939
the diet<font color="#E5E5E5"> tracks we've we've killed it</font>

517
00:23:40,080 --> 00:23:46,090
<font color="#CCCCCC">another</font><font color="#E5E5E5"> favorite technique the</font><font color="#CCCCCC"> line this</font>

518
00:23:43,180 --> 00:23:49,680
is script<font color="#E5E5E5"> I wrote basically similar</font><font color="#CCCCCC"> to</font>

519
00:23:46,090 --> 00:23:52,750
the the proxy<font color="#E5E5E5"> settings we take all the</font>

520
00:23:49,680 --> 00:23:56,050
destination URLs<font color="#E5E5E5"> for Microsoft we search</font>

521
00:23:52,750 --> 00:23:57,790
the IPS<font color="#E5E5E5"> and then we add a block on the</font>

522
00:23:56,050 --> 00:24:00,580
<font color="#E5E5E5">Windows Firewall</font><font color="#CCCCCC"> so we're actually using</font>

523
00:23:57,790 --> 00:24:03,310
Windows Firewall<font color="#E5E5E5"> Microsoft's product to</font>

524
00:24:00,580 --> 00:24:05,290
block Microsoft's other product<font color="#E5E5E5"> you know</font>

525
00:24:03,310 --> 00:24:10,990
and and this technique works really well

526
00:24:05,290 --> 00:24:12,460
<font color="#E5E5E5">to also block win RM</font><font color="#CCCCCC"> sis mons alerts</font>

527
00:24:10,990 --> 00:24:15,370
being sent by windows event forwarding

528
00:24:12,460 --> 00:24:17,980
scum you can use the same technique

529
00:24:15,370 --> 00:24:19,449
about<font color="#E5E5E5"> against other cloud-based next-gen</font>

530
00:24:17,980 --> 00:24:23,110
antivirus like CrowdStrike

531
00:24:19,450 --> 00:24:26,320
where if you know their destination IPS

532
00:24:23,110 --> 00:24:27,820
you<font color="#E5E5E5"> can block them and and system on or</font>

533
00:24:26,320 --> 00:24:28,960
sorry windows event forwarding is even

534
00:24:27,820 --> 00:24:30,700
easier<font color="#CCCCCC"> because instead of</font>

535
00:24:28,960 --> 00:24:33,700
having to know the destination<font color="#CCCCCC"> advance</font>

536
00:24:30,700 --> 00:24:36,370
<font color="#E5E5E5">you just set the the process the origin</font>

537
00:24:33,700 --> 00:24:38,919
originating process<font color="#E5E5E5"> the reason</font><font color="#CCCCCC"> I didn't</font>

538
00:24:36,370 --> 00:24:42,370
set the originating<font color="#CCCCCC"> process is ATP or</font>

539
00:24:38,919 --> 00:24:43,840
<font color="#CCCCCC">its its various executables is because</font>

540
00:24:42,370 --> 00:24:46,750
Microsoft keeps putting out new

541
00:24:43,840 --> 00:24:49,299
redundant methods in<font color="#E5E5E5"> place like release</font>

542
00:24:46,750 --> 00:24:51,429
<font color="#CCCCCC">three I just found a new</font><font color="#E5E5E5"> dll called Mir</font>

543
00:24:49,299 --> 00:24:53,168
which looks<font color="#E5E5E5"> to do some other background</font>

544
00:24:51,429 --> 00:24:55,240
<font color="#E5E5E5">communications so instead</font><font color="#CCCCCC"> of trying to</font>

545
00:24:53,169 --> 00:24:57,309
play cat and mouse<font color="#CCCCCC"> and keep blocking all</font>

546
00:24:55,240 --> 00:25:03,820
those different new ATP processes I'm

547
00:24:57,309 --> 00:25:06,580
just blocking the destination<font color="#CCCCCC"> James</font><font color="#E5E5E5"> also</font>

548
00:25:03,820 --> 00:25:09,370
<font color="#CCCCCC">put out an awesome technique to become</font>

549
00:25:06,580 --> 00:25:11,590
trusted<font color="#E5E5E5"> installer itself you know if you</font>

550
00:25:09,370 --> 00:25:15,850
had a<font color="#CCCCCC"> Metasploit shell and you became</font>

551
00:25:11,590 --> 00:25:17,470
system you could take over<font color="#E5E5E5"> trusted</font>

552
00:25:15,850 --> 00:25:20,799
installer but I think that whole process

553
00:25:17,470 --> 00:25:22,990
<font color="#CCCCCC">is a lot noisier than this this is</font>

554
00:25:20,799 --> 00:25:27,270
<font color="#CCCCCC">basically</font><font color="#E5E5E5"> just saying debug the</font>

555
00:25:22,990 --> 00:25:29,559
privilege<font color="#E5E5E5"> and start a new process as</font>

556
00:25:27,270 --> 00:25:33,158
trusted installer and once we trusted

557
00:25:29,559 --> 00:25:35,830
installer<font color="#E5E5E5"> as we can find here we've</font>

558
00:25:33,159 --> 00:25:40,390
added ourselves to that privilege<font color="#E5E5E5"> we can</font>

559
00:25:35,830 --> 00:25:42,850
just rename<font color="#E5E5E5"> ATP executables</font><font color="#CCCCCC"> that aren't</font>

560
00:25:40,390 --> 00:25:45,760
currently in use<font color="#CCCCCC"> so one of those</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> the</font>

561
00:25:42,850 --> 00:25:47,100
<font color="#E5E5E5">sense CNC proxy which uses dog track to</font>

562
00:25:45,760 --> 00:25:49,299
communicate out to the internet and

563
00:25:47,100 --> 00:25:52,090
because it's<font color="#E5E5E5"> only called every five</font>

564
00:25:49,299 --> 00:25:55,090
minutes<font color="#CCCCCC"> it's not</font><font color="#E5E5E5"> currently in use a week</font>

565
00:25:52,090 --> 00:25:57,789
we<font color="#E5E5E5"> can modify the the executable we can</font>

566
00:25:55,090 --> 00:26:00,340
just say well we'll rename it to<font color="#E5E5E5"> blah</font>

567
00:25:57,789 --> 00:26:02,320
<font color="#CCCCCC">and that way the next</font><font color="#E5E5E5"> time ATP goes to</font>

568
00:26:00,340 --> 00:26:04,149
communicate out and send an alert it

569
00:26:02,320 --> 00:26:07,110
can't launch that process and<font color="#E5E5E5"> can't</font>

570
00:26:04,149 --> 00:26:07,110
connect out to the<font color="#CCCCCC"> Internet</font>

571
00:26:07,360 --> 00:26:14,320
another thing we<font color="#E5E5E5"> can do</font><font color="#CCCCCC"> I found in there</font>

572
00:26:11,799 --> 00:26:17,590
is not very<font color="#CCCCCC"> well-documented ppl removal</font>

573
00:26:14,320 --> 00:26:20,799
function<font color="#E5E5E5"> in me me cats which allowed you</font>

574
00:26:17,590 --> 00:26:22,629
to remove ppl protection<font color="#CCCCCC"> it was</font>

575
00:26:20,799 --> 00:26:25,260
<font color="#E5E5E5">originally intended so you could inject</font>

576
00:26:22,630 --> 00:26:29,440
into<font color="#E5E5E5"> L</font><font color="#CCCCCC"> SAS and steal all the credentials</font>

577
00:26:25,260 --> 00:26:32,710
<font color="#E5E5E5">but it uses a kernel mode driver to</font>

578
00:26:29,440 --> 00:26:38,080
target<font color="#E5E5E5"> down those PBL's so we do have to</font>

579
00:26:32,710 --> 00:26:42,430
launch a run<font color="#E5E5E5"> at kernel mode driver</font><font color="#CCCCCC"> but</font>

580
00:26:38,080 --> 00:26:45,699
because sense is listed as not stoppable

581
00:26:42,430 --> 00:26:47,680
we can first remove the ppl protection

582
00:26:45,700 --> 00:26:51,280
and then we can you know basically do a

583
00:26:47,680 --> 00:26:54,100
kill -<font color="#CCCCCC"> 9</font><font color="#E5E5E5"> or at a skill and and just kill</font>

584
00:26:51,280 --> 00:26:55,629
the process outright<font color="#CCCCCC"> and</font><font color="#E5E5E5"> for that point</font>

585
00:26:54,100 --> 00:26:58,740
on we can disable the<font color="#CCCCCC"> service or what</font>

586
00:26:55,630 --> 00:27:02,620
else we want to do to it

587
00:26:58,740 --> 00:27:04,090
so out<font color="#CCCCCC"> of all those</font><font color="#E5E5E5"> different</font><font color="#CCCCCC"> kind of</font>

588
00:27:02,620 --> 00:27:07,090
<font color="#E5E5E5">techniques I think Windows Firewall is</font>

589
00:27:04,090 --> 00:27:09,309
<font color="#E5E5E5">the easiest best approach</font><font color="#CCCCCC"> it's very fast</font>

590
00:27:07,090 --> 00:27:12,100
it doesn't<font color="#E5E5E5"> require escalating the system</font>

591
00:27:09,309 --> 00:27:14,040
to become<font color="#E5E5E5"> trusted installer it doesn't</font>

592
00:27:12,100 --> 00:27:18,490
require some<font color="#CCCCCC"> Mimi Katz</font><font color="#E5E5E5"> kernel-mode</font>

593
00:27:14,040 --> 00:27:20,110
module<font color="#CCCCCC"> and once we've blocked</font><font color="#E5E5E5"> ATP and</font>

594
00:27:18,490 --> 00:27:22,059
event log forwarding<font color="#E5E5E5"> and system on and</font>

595
00:27:20,110 --> 00:27:24,129
<font color="#E5E5E5">scam or whatever is running on that box</font>

596
00:27:22,059 --> 00:27:27,940
<font color="#E5E5E5">we can do whatever we want to the box</font>

597
00:27:24,130 --> 00:27:31,240
and and the blue<font color="#CCCCCC"> team's</font><font color="#E5E5E5"> not going to be</font>

598
00:27:27,940 --> 00:27:33,100
none the<font color="#E5E5E5"> wiser</font><font color="#CCCCCC"> the problem with using</font>

599
00:27:31,240 --> 00:27:34,929
Windows Firewall and<font color="#CCCCCC"> why you might want</font>

600
00:27:33,100 --> 00:27:36,909
to use those<font color="#E5E5E5"> other techniques is because</font>

601
00:27:34,929 --> 00:27:39,250
when organizations have<font color="#E5E5E5"> implemented</font>

602
00:27:36,910 --> 00:27:43,690
other<font color="#E5E5E5"> third-party firewall products like</font>

603
00:27:39,250 --> 00:27:46,240
say<font color="#E5E5E5"> McAfee hips</font><font color="#CCCCCC"> it takes the place over</font>

604
00:27:43,690 --> 00:27:49,240
<font color="#E5E5E5">windows firewall rules and you can set</font>

605
00:27:46,240 --> 00:27:51,970
you know passwords to protect McAfee

606
00:27:49,240 --> 00:27:53,290
hips<font color="#CCCCCC"> and by the</font><font color="#E5E5E5"> time you've removed all</font>

607
00:27:51,970 --> 00:27:54,820
<font color="#E5E5E5">that from McAfee hips you've created</font>

608
00:27:53,290 --> 00:27:56,559
enough noise and alerts gone out you've

609
00:27:54,820 --> 00:27:58,889
<font color="#CCCCCC">been caught so</font><font color="#E5E5E5"> you might want</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> look at</font>

610
00:27:56,559 --> 00:28:01,480
some<font color="#E5E5E5"> of these other</font><font color="#CCCCCC"> techniques instead</font>

611
00:27:58,890 --> 00:28:06,610
but you know we're<font color="#E5E5E5"> not worried about</font>

612
00:28:01,480 --> 00:28:08,440
creating noise on the the box itself

613
00:28:06,610 --> 00:28:10,570
we're more worried about<font color="#E5E5E5"> alerts going</font>

614
00:28:08,440 --> 00:28:14,050
out to the<font color="#CCCCCC"> internet</font><font color="#E5E5E5"> or ATP flagging</font>

615
00:28:10,570 --> 00:28:16,600
network traffic so now we can actually

616
00:28:14,050 --> 00:28:18,520
you<font color="#CCCCCC"> know we're at the point</font><font color="#E5E5E5"> where we</font>

617
00:28:16,600 --> 00:28:20,439
have<font color="#E5E5E5"> control we have an initial foothold</font>

618
00:28:18,520 --> 00:28:22,540
in the organization we can<font color="#E5E5E5"> run whatever</font>

619
00:28:20,440 --> 00:28:25,330
we want against the box<font color="#E5E5E5"> we can run</font>

620
00:28:22,540 --> 00:28:27,340
whatever<font color="#E5E5E5"> we want from the box</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> need to</font>

621
00:28:25,330 --> 00:28:30,309
start<font color="#CCCCCC"> looking at</font><font color="#E5E5E5"> being stealthy against</font>

622
00:28:27,340 --> 00:28:31,928
or stealthy for what we're running<font color="#CCCCCC"> from</font>

623
00:28:30,309 --> 00:28:34,690
<font color="#E5E5E5">the box against the rest of the internal</font>

624
00:28:31,929 --> 00:28:37,050
network<font color="#CCCCCC"> so Microsoft put out a</font><font color="#E5E5E5"> product</font>

625
00:28:34,690 --> 00:28:40,660
called advanced threat analytics

626
00:28:37,050 --> 00:28:42,760
<font color="#CCCCCC">captures traffic</font><font color="#E5E5E5"> to domain controllers</font>

627
00:28:40,660 --> 00:28:47,650
<font color="#CCCCCC">it runs as a service on the domain</font>

628
00:28:42,760 --> 00:28:49,420
<font color="#E5E5E5">controller</font><font color="#CCCCCC"> and basically</font><font color="#E5E5E5"> it's intended</font>

629
00:28:47,650 --> 00:28:52,900
to to catch a lot<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the techniques</font><font color="#CCCCCC"> that</font>

630
00:28:49,420 --> 00:28:55,600
<font color="#CCCCCC">you see there I won't go into detail on</font>

631
00:28:52,900 --> 00:28:57,400
that slide but basically<font color="#CCCCCC"> it's</font>

632
00:28:55,600 --> 00:29:00,699
the current version<font color="#CCCCCC"> runs in</font><font color="#E5E5E5"> your</font>

633
00:28:57,400 --> 00:29:02,799
organization<font color="#CCCCCC"> the future</font><font color="#E5E5E5"> version which</font>

634
00:29:00,700 --> 00:29:03,910
they just announced<font color="#CCCCCC"> and I don't have</font>

635
00:29:02,799 --> 00:29:07,720
<font color="#E5E5E5">access to it yet</font>

636
00:29:03,910 --> 00:29:10,750
because it's in a beta trial is they've

637
00:29:07,720 --> 00:29:13,270
actually<font color="#E5E5E5"> taken a TA and moved it to</font><font color="#CCCCCC"> a</font>

638
00:29:10,750 --> 00:29:18,010
<font color="#E5E5E5">zero and now they're</font><font color="#CCCCCC"> calling it as or a</font>

639
00:29:13,270 --> 00:29:21,010
<font color="#CCCCCC">TP not it not a t I don't know why they</font>

640
00:29:18,010 --> 00:29:25,900
<font color="#E5E5E5">chose that naming convention but it will</font>

641
00:29:21,010 --> 00:29:29,020
be living in<font color="#E5E5E5"> the cloud and on-premise a</font>

642
00:29:25,900 --> 00:29:34,500
<font color="#E5E5E5">screenshot for the people in the first</font>

643
00:29:29,020 --> 00:29:37,000
row<font color="#CCCCCC"> basically you have the console you</font>

644
00:29:34,500 --> 00:29:39,549
you start<font color="#E5E5E5"> to see alerts so if somebody</font>

645
00:29:37,000 --> 00:29:40,120
created a new account that had<font color="#CCCCCC"> two admin</font>

646
00:29:39,549 --> 00:29:42,460
rights

647
00:29:40,120 --> 00:29:43,870
somebody tried passed the hash if

648
00:29:42,460 --> 00:29:47,919
somebody tried to<font color="#E5E5E5"> create a golden ticket</font>

649
00:29:43,870 --> 00:29:50,049
<font color="#E5E5E5">or modify a sensitive group</font><font color="#CCCCCC"> all of</font>

650
00:29:47,919 --> 00:29:53,740
<font color="#CCCCCC">that's you know gonna be flagged by it</font>

651
00:29:50,049 --> 00:30:05,320
by a TA<font color="#CCCCCC"> might seen a little alert</font><font color="#E5E5E5"> pop-up</font>

652
00:29:53,740 --> 00:30:07,539
<font color="#E5E5E5">if you're the administrator of the</font>

653
00:30:05,320 --> 00:30:10,059
attack and dive deeper into details so

654
00:30:07,539 --> 00:30:12,850
you<font color="#E5E5E5"> can see the</font><font color="#CCCCCC"> history of the user the</font>

655
00:30:10,059 --> 00:30:16,500
<font color="#CCCCCC">time where they moved against what</font>

656
00:30:12,850 --> 00:30:23,168
<font color="#E5E5E5">resource is by what domain controller</font>

657
00:30:16,500 --> 00:30:28,840
<font color="#CCCCCC">pretty detailed in order</font><font color="#E5E5E5"> to do this some</font>

658
00:30:23,169 --> 00:30:31,000
<font color="#CCCCCC">of it is based</font><font color="#E5E5E5"> on just reg acts like hey</font>

659
00:30:28,840 --> 00:30:33,250
we expected to see<font color="#E5E5E5"> stronger encryption</font>

660
00:30:31,000 --> 00:30:36,000
<font color="#CCCCCC">and use and we didn't so we're gonna</font>

661
00:30:33,250 --> 00:30:39,280
flag<font color="#CCCCCC"> it but some</font><font color="#E5E5E5"> of ata is based on</font>

662
00:30:36,000 --> 00:30:41,980
learning behavior so it needs to<font color="#E5E5E5"> know</font>

663
00:30:39,280 --> 00:30:45,090
<font color="#E5E5E5">that Bob</font><font color="#CCCCCC"> and accounting shouldn't be</font>

664
00:30:41,980 --> 00:30:47,320
connected to these<font color="#E5E5E5"> DevOps servers and</font>

665
00:30:45,090 --> 00:30:49,059
over the last six months<font color="#E5E5E5"> Bob never</font>

666
00:30:47,320 --> 00:30:51,189
connected to them and now<font color="#E5E5E5"> he is we're</font>

667
00:30:49,059 --> 00:30:54,000
gonna set off an alert based on some

668
00:30:51,190 --> 00:30:57,760
<font color="#E5E5E5">other you know machine</font><font color="#CCCCCC"> learning as well</font>

669
00:30:54,000 --> 00:30:59,650
<font color="#CCCCCC">so whenever possible when you are on an</font>

670
00:30:57,760 --> 00:31:01,210
<font color="#CCCCCC">internal network</font><font color="#E5E5E5"> and you want to be</font>

671
00:30:59,650 --> 00:31:04,900
moving<font color="#E5E5E5"> laterally around the network you</font>

672
00:31:01,210 --> 00:31:06,400
<font color="#CCCCCC">want to be leveraging RDP history and</font>

673
00:31:04,900 --> 00:31:09,020
PowerShell command<font color="#CCCCCC"> history and whatnot</font>

674
00:31:06,400 --> 00:31:10,640
so<font color="#CCCCCC"> you can simulate</font>

675
00:31:09,020 --> 00:31:12,410
<font color="#E5E5E5">you know</font><font color="#CCCCCC"> legit traffic as much as</font>

676
00:31:10,640 --> 00:31:16,280
<font color="#CCCCCC">possible</font><font color="#E5E5E5"> and avoid these user behavior</font>

677
00:31:12,410 --> 00:31:17,900
alerts<font color="#CCCCCC"> so now that</font><font color="#E5E5E5"> we're at the</font><font color="#CCCCCC"> point we</font>

678
00:31:16,280 --> 00:31:19,550
<font color="#E5E5E5">can run those commands</font><font color="#CCCCCC"> without getting</font>

679
00:31:17,900 --> 00:31:21,410
flagged let's look at the next

680
00:31:19,550 --> 00:31:23,950
<font color="#CCCCCC">activity's an attacker</font><font color="#E5E5E5"> would perform so</font>

681
00:31:21,410 --> 00:31:27,050
that's you know identifying

682
00:31:23,950 --> 00:31:30,020
<font color="#E5E5E5">infrastructure interest doing some</font>

683
00:31:27,050 --> 00:31:32,450
Active Directory recon<font color="#CCCCCC"> trying to find</font>

684
00:31:30,020 --> 00:31:34,340
password vaults<font color="#E5E5E5"> and sensitive sequel</font>

685
00:31:32,450 --> 00:31:38,390
servers<font color="#E5E5E5"> and file shares and and</font>

686
00:31:34,340 --> 00:31:40,129
<font color="#E5E5E5">different intellectual property</font><font color="#CCCCCC"> you're</font>

687
00:31:38,390 --> 00:31:43,310
trying to<font color="#E5E5E5"> avoid</font><font color="#CCCCCC"> IPS</font><font color="#E5E5E5"> and whatnot</font>

688
00:31:40,130 --> 00:31:44,840
<font color="#CCCCCC">so often</font><font color="#E5E5E5"> when you</font><font color="#CCCCCC"> get on the internal</font>

689
00:31:43,310 --> 00:31:48,530
network<font color="#E5E5E5"> you're you're trying to do some</font>

690
00:31:44,840 --> 00:31:50,659
<font color="#E5E5E5">DNS queries to find out you know where</font>

691
00:31:48,530 --> 00:31:52,820
the DNS servers are what can they tell

692
00:31:50,660 --> 00:31:56,060
us<font color="#E5E5E5"> about the layout</font><font color="#CCCCCC"> of Active Directory</font>

693
00:31:52,820 --> 00:31:59,720
we're more sensitive boxes are a lot of

694
00:31:56,060 --> 00:32:03,440
<font color="#CCCCCC">that's</font><font color="#E5E5E5"> gonna get caught if you're using</font>

695
00:31:59,720 --> 00:32:07,430
brute force<font color="#CCCCCC"> tools like like fierce or a</font>

696
00:32:03,440 --> 00:32:09,740
lot of nslookup queries<font color="#CCCCCC"> singh goes when</font>

697
00:32:07,430 --> 00:32:12,950
you try to<font color="#E5E5E5"> use a command like net user</font>

698
00:32:09,740 --> 00:32:14,960
slash domain<font color="#E5E5E5"> it's gonna see that you're</font>

699
00:32:12,950 --> 00:32:16,850
you're not<font color="#CCCCCC"> blending in with active</font>

700
00:32:14,960 --> 00:32:19,850
regular<font color="#CCCCCC"> Active Directory traffic very</font>

701
00:32:16,850 --> 00:32:22,219
<font color="#E5E5E5">well and you're doing using</font><font color="#CCCCCC"> Samer and</font>

702
00:32:19,850 --> 00:32:26,179
doing some reconnaissance against<font color="#E5E5E5"> held</font>

703
00:32:22,220 --> 00:32:28,010
up<font color="#E5E5E5"> and and the reason that gets flagged</font>

704
00:32:26,180 --> 00:32:30,530
is because you're<font color="#CCCCCC"> looking for so</font><font color="#E5E5E5"> many</font>

705
00:32:28,010 --> 00:32:32,330
random<font color="#E5E5E5"> account properties like the full</font>

706
00:32:30,530 --> 00:32:35,389
<font color="#E5E5E5">account properties which which no user</font>

707
00:32:32,330 --> 00:32:38,179
should<font color="#E5E5E5"> be doing so we need to look at a</font>

708
00:32:35,390 --> 00:32:39,770
<font color="#E5E5E5">lot stealthier techniques to get around</font>

709
00:32:38,180 --> 00:32:43,820
that

710
00:32:39,770 --> 00:32:47,530
so not detected is if we initially use

711
00:32:43,820 --> 00:32:50,270
PowerShell to<font color="#E5E5E5"> grab a list of computers</font>

712
00:32:47,530 --> 00:32:55,280
<font color="#CCCCCC">which is pretty normal traffic</font><font color="#E5E5E5"> on the on</font>

713
00:32:50,270 --> 00:32:56,990
the domain and then remove any domain

714
00:32:55,280 --> 00:33:07,879
controllers<font color="#E5E5E5"> from that list</font>

715
00:32:56,990 --> 00:33:10,010
oh sorry<font color="#CCCCCC"> step ahead so you know grabbing</font>

716
00:33:07,880 --> 00:33:12,530
<font color="#E5E5E5">the the different group members grabbing</font>

717
00:33:10,010 --> 00:33:16,370
the the different infrastructure all<font color="#CCCCCC"> of</font>

718
00:33:12,530 --> 00:33:18,590
this is<font color="#E5E5E5"> pretty regular traffic also not</font>

719
00:33:16,370 --> 00:33:21,469
detecting and this is my<font color="#E5E5E5"> morph a more</font>

720
00:33:18,590 --> 00:33:22,610
preferred technique<font color="#E5E5E5"> is</font><font color="#CCCCCC"> enumerated all</font>

721
00:33:21,470 --> 00:33:24,980
this against

722
00:33:22,610 --> 00:33:27,020
local<font color="#E5E5E5"> W my</font><font color="#CCCCCC"> namespace so believe it</font><font color="#E5E5E5"> or</font>

723
00:33:24,980 --> 00:33:29,360
not<font color="#E5E5E5"> on the windows box that we got a</font>

724
00:33:27,020 --> 00:33:31,790
foothold on all of this information<font color="#E5E5E5"> or</font>

725
00:33:29,360 --> 00:33:34,010
most of it<font color="#CCCCCC"> it's copy that is stored in</font>

726
00:33:31,790 --> 00:33:36,770
the local<font color="#E5E5E5"> W my local</font><font color="#CCCCCC"> namespace so we can</font>

727
00:33:34,010 --> 00:33:39,710
query<font color="#E5E5E5"> all the group memberships who the</font>

728
00:33:36,770 --> 00:33:42,440
domain admins are who the you know

729
00:33:39,710 --> 00:33:44,090
sequel<font color="#E5E5E5"> mins are all that directly</font>

730
00:33:42,440 --> 00:33:46,040
against the Windows<font color="#CCCCCC"> 10 computer and none</font>

731
00:33:44,090 --> 00:33:47,510
of<font color="#CCCCCC"> that</font><font color="#E5E5E5"> traffic</font><font color="#CCCCCC"> actually goes out on the</font>

732
00:33:46,040 --> 00:33:54,020
local<font color="#CCCCCC"> network so there's no chance for a</font>

733
00:33:47,510 --> 00:33:58,850
<font color="#CCCCCC">TP</font><font color="#E5E5E5"> 2 or sorry</font><font color="#CCCCCC"> ata to catch it you know</font>

734
00:33:54,020 --> 00:34:00,860
and we can<font color="#CCCCCC"> even since a TP 1.8 they add</font>

735
00:33:58,850 --> 00:34:05,299
a different Active Directory user roles

736
00:34:00,860 --> 00:34:08,089
for<font color="#CCCCCC"> ATA admins</font><font color="#E5E5E5"> so we can even query for</font>

737
00:34:05,299 --> 00:34:11,270
the existence<font color="#E5E5E5"> of this group against the</font>

738
00:34:08,090 --> 00:34:13,010
<font color="#E5E5E5">local box and know if a TAS and use in</font>

739
00:34:11,270 --> 00:34:14,869
the environment or<font color="#CCCCCC"> not</font><font color="#E5E5E5"> so that's pretty</font>

740
00:34:13,010 --> 00:34:21,290
handy<font color="#CCCCCC"> before we start</font><font color="#E5E5E5"> sending</font><font color="#CCCCCC"> traffic</font>

741
00:34:14,869 --> 00:34:23,720
around the network<font color="#E5E5E5"> so if we use the</font>

742
00:34:21,290 --> 00:34:28,399
default<font color="#E5E5E5"> user hunter or bloodhound</font>

743
00:34:23,719 --> 00:34:30,230
scripts<font color="#CCCCCC"> and we we query all the servers</font>

744
00:34:28,399 --> 00:34:32,418
on the the<font color="#E5E5E5"> network and we try to find</font>

745
00:34:30,230 --> 00:34:34,010
<font color="#E5E5E5">out who's got a session on</font><font color="#CCCCCC"> that file</font>

746
00:34:32,418 --> 00:34:37,310
server or<font color="#E5E5E5"> that terminal server</font><font color="#CCCCCC"> or that</font>

747
00:34:34,010 --> 00:34:40,369
workstation<font color="#CCCCCC"> and we use that</font><font color="#E5E5E5"> to plot out</font>

748
00:34:37,310 --> 00:34:44,570
an attack path by default that's<font color="#E5E5E5"> going</font>

749
00:34:40,369 --> 00:34:46,850
to get caught<font color="#CCCCCC"> you know it's a super</font>

750
00:34:44,570 --> 00:34:48,260
<font color="#E5E5E5">valuable technique</font><font color="#CCCCCC"> and a lot of</font>

751
00:34:46,850 --> 00:34:50,810
attackers<font color="#E5E5E5"> are using it right now because</font>

752
00:34:48,260 --> 00:34:52,970
it<font color="#CCCCCC"> takes the guessing game out of</font><font color="#E5E5E5"> trying</font>

753
00:34:50,810 --> 00:34:55,129
to know what box to attack next<font color="#E5E5E5"> or what</font>

754
00:34:52,969 --> 00:34:57,529
workstation or what user I<font color="#E5E5E5"> have to go</font>

755
00:34:55,129 --> 00:35:01,910
after to get the privileges I need to

756
00:34:57,530 --> 00:35:03,350
<font color="#E5E5E5">get to my target so</font><font color="#CCCCCC"> by default options a</font>

757
00:35:01,910 --> 00:35:11,990
<font color="#E5E5E5">lot of that's going to get flagged right</font>

758
00:35:03,350 --> 00:35:13,880
now<font color="#CCCCCC"> same with you know using</font><font color="#E5E5E5"> tools like</font>

759
00:35:11,990 --> 00:35:18,618
<font color="#E5E5E5">user hunter and net</font><font color="#CCCCCC"> sesh that's gonna</font>

760
00:35:13,880 --> 00:35:22,369
get flagged as well<font color="#CCCCCC"> but we can get</font>

761
00:35:18,619 --> 00:35:24,740
around being<font color="#E5E5E5"> flagged if we just remove</font>

762
00:35:22,369 --> 00:35:28,340
the domain controllers from<font color="#E5E5E5"> the list of</font>

763
00:35:24,740 --> 00:35:30,618
hosts<font color="#E5E5E5"> that we're careering so if we feed</font>

764
00:35:28,340 --> 00:35:33,920
it a<font color="#E5E5E5"> host file that we've we've removed</font>

765
00:35:30,619 --> 00:35:36,260
all the the domain controllers out of we

766
00:35:33,920 --> 00:35:38,510
can gather all<font color="#CCCCCC"> of that information</font><font color="#E5E5E5"> about</font>

767
00:35:36,260 --> 00:35:41,450
every other box on the network but just

768
00:35:38,510 --> 00:35:43,460
not the<font color="#CCCCCC"> DC's and because it's not shut</font>

769
00:35:41,450 --> 00:35:45,049
no traffic's hitting the<font color="#E5E5E5"> DC's to find</font>

770
00:35:43,460 --> 00:35:49,100
out who's logged<font color="#CCCCCC"> into</font><font color="#E5E5E5"> that box you as a</font>

771
00:35:45,050 --> 00:35:52,820
session<font color="#CCCCCC"> ATP or ata can't flag on it</font>

772
00:35:49,100 --> 00:35:56,060
<font color="#E5E5E5">because it never sees that traffic</font><font color="#CCCCCC"> and</font>

773
00:35:52,820 --> 00:35:58,910
<font color="#CCCCCC">then just earlier</font><font color="#E5E5E5"> this month</font><font color="#CCCCCC"> the</font>

774
00:35:56,060 --> 00:36:01,640
Bloodhound guys<font color="#E5E5E5"> actually just added a</font>

775
00:35:58,910 --> 00:36:03,799
flag<font color="#CCCCCC"> and that</font><font color="#E5E5E5"> says exclude DC so that</font>

776
00:36:01,640 --> 00:36:05,270
that takes makes my technique a<font color="#E5E5E5"> lot</font>

777
00:36:03,800 --> 00:36:11,450
easier<font color="#E5E5E5"> because they just added it right</font>

778
00:36:05,270 --> 00:36:13,610
into bloodhound<font color="#CCCCCC"> so now that we've found</font>

779
00:36:11,450 --> 00:36:16,430
out where our<font color="#E5E5E5"> target users are where our</font>

780
00:36:13,610 --> 00:36:19,010
<font color="#E5E5E5">target boxes are who we need to go after</font>

781
00:36:16,430 --> 00:36:21,859
<font color="#E5E5E5">to get the prints that we need we</font><font color="#CCCCCC"> can</font>

782
00:36:19,010 --> 00:36:25,490
start to look at lateral movement<font color="#E5E5E5"> we can</font>

783
00:36:21,860 --> 00:36:28,820
leverage all that information<font color="#E5E5E5"> so hey is</font>

784
00:36:25,490 --> 00:36:33,049
pretty<font color="#E5E5E5"> decent at detecting PS</font><font color="#CCCCCC"> exacting</font>

785
00:36:28,820 --> 00:36:35,210
<font color="#CCCCCC">wi exact against the DC itself and it</font>

786
00:36:33,050 --> 00:36:37,790
may detect different lateral movement

787
00:36:35,210 --> 00:36:40,010
techniques<font color="#E5E5E5"> just based on abnormal user</font>

788
00:36:37,790 --> 00:36:42,410
behavior<font color="#CCCCCC"> so again that's when we want to</font>

789
00:36:40,010 --> 00:36:45,130
try to<font color="#E5E5E5"> replicate normal traffic as much</font>

790
00:36:42,410 --> 00:36:45,129
as<font color="#CCCCCC"> possible</font>

791
00:36:46,060 --> 00:36:51,740
SBN her service<font color="#E5E5E5"> principle named</font>

792
00:36:48,410 --> 00:36:54,770
enumeration and<font color="#E5E5E5"> kerb roasting is not</font>

793
00:36:51,740 --> 00:36:57,560
<font color="#E5E5E5">Kerberos ting is not detected</font><font color="#CCCCCC"> it blends</font>

794
00:36:54,770 --> 00:36:59,150
<font color="#CCCCCC">in with regular traffic - well</font><font color="#E5E5E5"> they</font>

795
00:36:57,560 --> 00:37:00,940
<font color="#CCCCCC">maybe they'll they'll improve</font><font color="#E5E5E5"> this in</font>

796
00:36:59,150 --> 00:37:04,040
the<font color="#E5E5E5"> next release but right now I can say</font>

797
00:37:00,940 --> 00:37:06,410
<font color="#E5E5E5">tell me where all your your s</font><font color="#CCCCCC"> be ends</font>

798
00:37:04,040 --> 00:37:10,120
for<font color="#E5E5E5"> your sequel servers are and then</font>

799
00:37:06,410 --> 00:37:15,640
give<font color="#E5E5E5"> me the SPN ticket or the Kerberos</font>

800
00:37:10,120 --> 00:37:15,640
ticket for<font color="#CCCCCC"> that service once I have it</font>

801
00:37:15,970 --> 00:37:24,740
you know<font color="#E5E5E5"> my team has 16 GT GT X 1080</font>

802
00:37:21,670 --> 00:37:26,840
<font color="#E5E5E5">GPUs that</font><font color="#CCCCCC"> we can crack that that</font>

803
00:37:24,740 --> 00:37:29,720
Kerberos ticket with it within<font color="#E5E5E5"> a couple</font>

804
00:37:26,840 --> 00:37:32,510
<font color="#CCCCCC">of</font><font color="#E5E5E5"> minutes</font><font color="#CCCCCC"> so we can get the credentials</font>

805
00:37:29,720 --> 00:37:34,669
<font color="#E5E5E5">for any SPN service account across the</font>

806
00:37:32,510 --> 00:37:36,770
network and crack them within<font color="#E5E5E5"> a couple</font>

807
00:37:34,670 --> 00:37:39,590
of<font color="#E5E5E5"> minutes</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> now we have those</font>

808
00:37:36,770 --> 00:37:41,120
privileged accounts<font color="#E5E5E5"> that we wanted and</font>

809
00:37:39,590 --> 00:37:43,310
we<font color="#E5E5E5"> even know</font><font color="#CCCCCC"> where they're used</font><font color="#E5E5E5"> so if I</font>

810
00:37:41,120 --> 00:37:45,380
have sequel<font color="#CCCCCC"> admins</font><font color="#E5E5E5"> and they're logged</font>

811
00:37:43,310 --> 00:37:47,210
<font color="#E5E5E5">into sequel servers I now know I'm safe</font>

812
00:37:45,380 --> 00:37:48,740
to log<font color="#E5E5E5"> into any sequel server because</font>

813
00:37:47,210 --> 00:37:51,350
I've<font color="#CCCCCC"> a</font><font color="#E5E5E5"> TAS</font><font color="#CCCCCC"> gonna know that</font><font color="#E5E5E5"> that's</font>

814
00:37:48,740 --> 00:37:54,560
regular<font color="#CCCCCC"> traffic</font>

815
00:37:51,350 --> 00:37:57,080
and I can also avoid any authentication

816
00:37:54,560 --> 00:37:59,509
events to the domain controller<font color="#E5E5E5"> at all</font>

817
00:37:57,080 --> 00:38:02,680
by just generating a silver ticket with

818
00:37:59,510 --> 00:38:06,560
that service<font color="#CCCCCC"> account that I just</font><font color="#E5E5E5"> created</font>

819
00:38:02,680 --> 00:38:07,850
<font color="#CCCCCC">and so you know I</font><font color="#E5E5E5"> won't go into detail</font>

820
00:38:06,560 --> 00:38:12,230
<font color="#CCCCCC">and silver tickets</font><font color="#E5E5E5"> because we don't have</font>

821
00:38:07,850 --> 00:38:14,509
<font color="#E5E5E5">too much time</font><font color="#CCCCCC"> but you know</font><font color="#E5E5E5"> this prevents</font>

822
00:38:12,230 --> 00:38:16,220
<font color="#E5E5E5">us from having any authentication event</font>

823
00:38:14,510 --> 00:38:18,440
against the domain controller<font color="#E5E5E5"> this is</font>

824
00:38:16,220 --> 00:38:22,339
strictly against the<font color="#E5E5E5"> local sequel box or</font>

825
00:38:18,440 --> 00:38:27,650
<font color="#CCCCCC">a local IAS box</font><font color="#E5E5E5"> and all of those logs</font>

826
00:38:22,340 --> 00:38:32,510
are strictly on that box<font color="#CCCCCC"> also not</font>

827
00:38:27,650 --> 00:38:36,560
detected<font color="#CCCCCC"> is</font><font color="#E5E5E5"> abusing</font><font color="#CCCCCC"> 80 object access</font>

828
00:38:32,510 --> 00:38:38,960
<font color="#E5E5E5">control entries so with the bloodhound</font>

829
00:38:36,560 --> 00:38:41,720
1.3 attack path update we can enumerate

830
00:38:38,960 --> 00:38:44,450
<font color="#E5E5E5">80 object access control entry entries</font>

831
00:38:41,720 --> 00:38:47,209
and visualize those attack paths with

832
00:38:44,450 --> 00:38:50,589
<font color="#CCCCCC">bloodhound so not just the sessions that</font>

833
00:38:47,210 --> 00:38:53,420
<font color="#CCCCCC">are on the box but now we're enumerated</font>

834
00:38:50,590 --> 00:38:56,510
<font color="#E5E5E5">some random user through 20 different</font>

835
00:38:53,420 --> 00:38:58,580
delegated control groups<font color="#E5E5E5"> has access to</font>

836
00:38:56,510 --> 00:39:00,320
this box and instead<font color="#CCCCCC"> of having</font><font color="#E5E5E5"> a huge</font>

837
00:38:58,580 --> 00:39:04,580
guessing game we can now visualize<font color="#E5E5E5"> that</font>

838
00:39:00,320 --> 00:39:07,190
in a<font color="#E5E5E5"> couple of minutes</font><font color="#CCCCCC"> so we</font><font color="#E5E5E5"> can say you</font>

839
00:39:04,580 --> 00:39:11,270
know invoke bloodhound<font color="#CCCCCC"> give me all</font><font color="#E5E5E5"> the</font>

840
00:39:07,190 --> 00:39:14,660
vehicles and bloodhound well that will

841
00:39:11,270 --> 00:39:16,840
tell<font color="#E5E5E5"> me that Abbie Abbie Edward is a</font>

842
00:39:14,660 --> 00:39:20,629
member of the help desk who has

843
00:39:16,840 --> 00:39:23,270
<font color="#E5E5E5">delegated rights to the sequel box and</font>

844
00:39:20,630 --> 00:39:25,820
they can reset the password<font color="#E5E5E5"> of web</font>

845
00:39:23,270 --> 00:39:27,740
service<font color="#E5E5E5"> who is then</font><font color="#CCCCCC"> added men to</font><font color="#E5E5E5"> Apple</font>

846
00:39:25,820 --> 00:39:30,200
<font color="#E5E5E5">one my target and I can get all that</font>

847
00:39:27,740 --> 00:39:31,850
<font color="#CCCCCC">information</font><font color="#E5E5E5"> in a couple of minutes where</font>

848
00:39:30,200 --> 00:39:33,919
if<font color="#E5E5E5"> you were trying to figure</font><font color="#CCCCCC"> out this</font>

849
00:39:31,850 --> 00:39:35,750
<font color="#CCCCCC">information before</font><font color="#E5E5E5"> as an attacker this</font>

850
00:39:33,920 --> 00:39:37,400
would take like days or weeks<font color="#E5E5E5"> of</font>

851
00:39:35,750 --> 00:39:38,930
guessing and creating a crapload<font color="#CCCCCC"> of</font>

852
00:39:37,400 --> 00:39:42,410
noise on the internal<font color="#CCCCCC"> network</font><font color="#E5E5E5"> and this</font>

853
00:39:38,930 --> 00:39:44,240
is this<font color="#CCCCCC"> is minutes now so we can abuse</font>

854
00:39:42,410 --> 00:39:47,270
<font color="#E5E5E5">those permissions and out ourselves</font>

855
00:39:44,240 --> 00:39:48,890
<font color="#CCCCCC">you</font><font color="#E5E5E5"> know to the sequel admin group and</font>

856
00:39:47,270 --> 00:39:51,110
now once we're in the<font color="#E5E5E5"> sequel of</font><font color="#CCCCCC"> Ming</font>

857
00:39:48,890 --> 00:39:53,299
<font color="#CCCCCC">Group we can</font><font color="#E5E5E5"> temporarily reset the</font>

858
00:39:51,110 --> 00:39:56,330
password of<font color="#E5E5E5"> the web service and then log</font>

859
00:39:53,300 --> 00:40:00,140
<font color="#E5E5E5">into the app and again we can avoid</font><font color="#CCCCCC"> a TA</font>

860
00:39:56,330 --> 00:40:01,940
alerts<font color="#CCCCCC"> because that web service</font><font color="#E5E5E5"> is</font>

861
00:40:00,140 --> 00:40:03,558
supposed<font color="#E5E5E5"> to be a be allowed</font><font color="#CCCCCC"> to log into</font>

862
00:40:01,940 --> 00:40:08,359
<font color="#E5E5E5">Apple one</font>

863
00:40:03,559 --> 00:40:10,309
now in you know<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> Forest</font><font color="#E5E5E5"> Active</font>

864
00:40:08,359 --> 00:40:14,328
Directory forest 2012 versions you<font color="#CCCCCC"> can</font>

865
00:40:10,309 --> 00:40:16,789
set protected groups<font color="#E5E5E5"> but nobody does but</font>

866
00:40:14,329 --> 00:40:19,400
if sequel admins was was flagged as a

867
00:40:16,789 --> 00:40:22,130
protected group<font color="#CCCCCC"> ata would flag on that</font>

868
00:40:19,400 --> 00:40:27,729
<font color="#E5E5E5">because you've modified a sensitive</font>

869
00:40:22,130 --> 00:40:32,479
group<font color="#E5E5E5"> but but nobody has that in place</font>

870
00:40:27,729 --> 00:40:34,910
<font color="#CCCCCC">and Rohan Andy and will from the Spector</font>

871
00:40:32,479 --> 00:40:37,729
<font color="#E5E5E5">ops crew recently covered how to reset</font>

872
00:40:34,910 --> 00:40:41,649
that<font color="#CCCCCC"> users password back to their old</font>

873
00:40:37,729 --> 00:40:44,868
password<font color="#CCCCCC"> based on their password history</font>

874
00:40:41,650 --> 00:40:46,910
<font color="#E5E5E5">so you know if we</font><font color="#CCCCCC"> perform this attack it</font>

875
00:40:44,869 --> 00:40:48,469
at<font color="#CCCCCC"> midnight and by</font><font color="#E5E5E5"> 8:00 a.m.</font>

876
00:40:46,910 --> 00:40:50,420
we've sent their password back to

877
00:40:48,469 --> 00:40:52,339
<font color="#CCCCCC">whatever</font><font color="#E5E5E5"> it was before nobody's the</font>

878
00:40:50,420 --> 00:40:54,769
wiser that that we<font color="#E5E5E5"> actually</font><font color="#CCCCCC"> perform</font><font color="#E5E5E5"> this</font>

879
00:40:52,339 --> 00:40:58,749
attack<font color="#CCCCCC"> I check that link</font><font color="#E5E5E5"> if you want to</font>

880
00:40:54,769 --> 00:41:02,328
know more<font color="#CCCCCC"> about their research so</font>

881
00:40:58,749 --> 00:41:06,379
passing the that the ticket or over

882
00:41:02,329 --> 00:41:09,439
passing the hash<font color="#E5E5E5"> that's caught</font><font color="#CCCCCC"> you'll</font>

883
00:41:06,380 --> 00:41:12,739
see that you know we're passing just the

884
00:41:09,439 --> 00:41:15,769
ntlm value but if we go down we look

885
00:41:12,739 --> 00:41:18,289
that we look and<font color="#E5E5E5"> see that that no way no</font>

886
00:41:15,769 --> 00:41:19,729
AES keys are<font color="#E5E5E5"> being passed and that's how</font>

887
00:41:18,289 --> 00:41:23,630
<font color="#CCCCCC">it's flagging on that</font><font color="#E5E5E5"> because it's</font>

888
00:41:19,729 --> 00:41:26,899
expecting<font color="#E5E5E5"> AES keys to accompany the ntlm</font>

889
00:41:23,630 --> 00:41:28,939
hash<font color="#E5E5E5"> so we can get around</font><font color="#CCCCCC"> that and</font><font color="#E5E5E5"> not</font>

890
00:41:26,900 --> 00:41:31,579
be flagged for passing the ticket over

891
00:41:28,939 --> 00:41:34,160
passing the hash<font color="#E5E5E5"> to move laterally</font>

892
00:41:31,579 --> 00:41:36,259
<font color="#CCCCCC">around the organisation by simply just</font>

893
00:41:34,160 --> 00:41:39,920
including the AES key along<font color="#E5E5E5"> with</font><font color="#CCCCCC"> the</font>

894
00:41:36,259 --> 00:41:43,959
ntlm hash and<font color="#E5E5E5"> I found it was</font><font color="#CCCCCC"> really hard</font>

895
00:41:39,920 --> 00:41:46,400
to<font color="#E5E5E5"> find out how to get the AES 128 key</font>

896
00:41:43,959 --> 00:41:48,379
<font color="#CCCCCC">so I I found</font><font color="#E5E5E5"> out that you could just put</font>

897
00:41:46,400 --> 00:41:51,410
<font color="#CCCCCC">all zeros in there and it would still</font>

898
00:41:48,380 --> 00:41:55,429
<font color="#E5E5E5">not flag on it so as long as something</font>

899
00:41:51,410 --> 00:41:59,719
is in that setting you're you're fine

900
00:41:55,429 --> 00:42:03,709
and<font color="#E5E5E5"> a</font><font color="#CCCCCC"> TA won't flag you also not</font>

901
00:41:59,719 --> 00:42:06,229
<font color="#CCCCCC">detected Nick Hale covers covered in his</font>

902
00:42:03,709 --> 00:42:09,469
<font color="#E5E5E5">talk a lot of movement around sequel and</font>

903
00:42:06,229 --> 00:42:12,410
it makes sense<font color="#E5E5E5"> because just like silver</font>

904
00:42:09,469 --> 00:42:14,719
tickets are the<font color="#E5E5E5"> authentication against</font>

905
00:42:12,410 --> 00:42:17,118
sequel is to the local sequel server

906
00:42:14,719 --> 00:42:18,769
it's not via Active Directory<font color="#E5E5E5"> especially</font>

907
00:42:17,119 --> 00:42:21,440
those accounts aren't<font color="#E5E5E5"> tied to Active</font>

908
00:42:18,769 --> 00:42:23,450
Directory they're all sequel off so you

909
00:42:21,440 --> 00:42:26,119
can<font color="#E5E5E5"> target</font><font color="#CCCCCC"> essay accounts and</font><font color="#E5E5E5"> compromise</font>

910
00:42:23,450 --> 00:42:27,410
sequel boxes and then use<font color="#CCCCCC"> that and use</font>

911
00:42:26,119 --> 00:42:28,940
any trust relationships between

912
00:42:27,410 --> 00:42:30,799
different<font color="#E5E5E5"> sequel servers to move around</font>

913
00:42:28,940 --> 00:42:35,049
<font color="#E5E5E5">the network and never be seen</font><font color="#CCCCCC"> by a TA</font>

914
00:42:30,799 --> 00:42:35,049
and never create<font color="#E5E5E5"> an authentication event</font>

915
00:42:35,770 --> 00:42:41,299
[Music]

916
00:42:37,749 --> 00:42:43,999
<font color="#CCCCCC">it's also a TAS not very good at look</font><font color="#E5E5E5"> at</font>

917
00:42:41,299 --> 00:42:46,099
monitoring between different child

918
00:42:43,999 --> 00:42:47,930
domains and especially child<font color="#CCCCCC"> forests has</font>

919
00:42:46,099 --> 00:42:50,150
no visibility<font color="#E5E5E5"> between</font><font color="#CCCCCC"> forest so you have</font>

920
00:42:47,930 --> 00:42:52,160
multiple forests trusted<font color="#E5E5E5"> forests in your</font>

921
00:42:50,150 --> 00:42:54,859
<font color="#E5E5E5">organization you're gonna need an</font><font color="#CCCCCC"> ata</font>

922
00:42:52,160 --> 00:42:58,279
instance in both forests and I believe

923
00:42:54,859 --> 00:43:02,240
in both your major subdomains<font color="#CCCCCC"> for it</font><font color="#E5E5E5"> to</font>

924
00:42:58,279 --> 00:43:03,890
detect<font color="#E5E5E5"> accurately but I won't repeat</font>

925
00:43:02,240 --> 00:43:09,038
<font color="#CCCCCC">Nick Hills research in that area but you</font>

926
00:43:03,890 --> 00:43:11,450
should check out<font color="#E5E5E5"> his link for that so</font>

927
00:43:09,039 --> 00:43:14,089
once you have<font color="#E5E5E5"> access</font><font color="#CCCCCC"> to these privileged</font>

928
00:43:11,450 --> 00:43:16,220
users it's now time to<font color="#CCCCCC"> move towards</font>

929
00:43:14,089 --> 00:43:19,038
achieving the primary goals of our<font color="#E5E5E5"> red</font>

930
00:43:16,220 --> 00:43:21,589
team engagement so these may include

931
00:43:19,039 --> 00:43:23,720
dominance over<font color="#E5E5E5"> the network and you may</font>

932
00:43:21,589 --> 00:43:27,019
or<font color="#CCCCCC"> may not need to become a domain</font>

933
00:43:23,720 --> 00:43:31,249
administrator<font color="#CCCCCC"> I was just testing a huge</font>

934
00:43:27,019 --> 00:43:32,058
<font color="#CCCCCC">bank</font><font color="#E5E5E5"> last about two weeks ago and we got</font>

935
00:43:31,249 --> 00:43:36,828
on the<font color="#E5E5E5"> box</font>

936
00:43:32,059 --> 00:43:40,579
Kerberos<font color="#E5E5E5"> stood</font><font color="#CCCCCC"> got service account</font><font color="#E5E5E5"> was</font>

937
00:43:36,829 --> 00:43:43,519
able to<font color="#E5E5E5"> gain access to their</font><font color="#CCCCCC"> SVN via the</font>

938
00:43:40,579 --> 00:43:45,319
<font color="#E5E5E5">service account</font><font color="#CCCCCC"> so their whole code repo</font>

939
00:43:43,519 --> 00:43:47,508
<font color="#CCCCCC">and demonstrated that we could</font><font color="#E5E5E5"> gain</font>

940
00:43:45,319 --> 00:43:53,029
access to this all the<font color="#CCCCCC"> bank's</font><font color="#E5E5E5"> trading</font>

941
00:43:47,509 --> 00:43:54,650
algorithms all<font color="#E5E5E5"> without ever doing you</font>

942
00:43:53,029 --> 00:43:56,269
know any<font color="#E5E5E5"> lateral movement</font><font color="#CCCCCC"> or remote code</font>

943
00:43:54,650 --> 00:43:59,150
execution all of it was just be a

944
00:43:56,269 --> 00:44:00,589
Kerberos<font color="#E5E5E5"> thing so you might not need to</font>

945
00:43:59,150 --> 00:44:03,950
get domain admin to achieve your

946
00:44:00,589 --> 00:44:06,650
objectives right<font color="#CCCCCC"> but it</font><font color="#E5E5E5"> certainly helps</font>

947
00:44:03,950 --> 00:44:08,629
but it<font color="#E5E5E5"> comes with its own</font><font color="#CCCCCC"> challenges you</font>

948
00:44:06,650 --> 00:44:10,160
know<font color="#E5E5E5"> your other other objectives might</font>

949
00:44:08,630 --> 00:44:12,170
be gaining<font color="#E5E5E5"> access to that sense of</font>

950
00:44:10,160 --> 00:44:14,598
<font color="#CCCCCC">information or code</font><font color="#E5E5E5"> repos like I talked</font>

951
00:44:12,170 --> 00:44:19,150
<font color="#CCCCCC">about or</font><font color="#E5E5E5"> just you</font><font color="#CCCCCC"> know specific</font>

952
00:44:14,599 --> 00:44:24,799
financial<font color="#E5E5E5"> data or sensitive file shares</font>

953
00:44:19,150 --> 00:44:29,180
so DC sync is a common technique<font color="#CCCCCC"> to grab</font>

954
00:44:24,799 --> 00:44:30,950
<font color="#E5E5E5">80 the Active Directory database which</font>

955
00:44:29,180 --> 00:44:32,720
effectively<font color="#E5E5E5"> you're just saying hey</font>

956
00:44:30,950 --> 00:44:35,299
<font color="#E5E5E5">I'm a domain controller send me a copy</font>

957
00:44:32,720 --> 00:44:36,799
of the Active<font color="#E5E5E5"> Directory database and the</font>

958
00:44:35,300 --> 00:44:40,849
other<font color="#E5E5E5"> domain controller says here you go</font>

959
00:44:36,800 --> 00:44:42,650
<font color="#E5E5E5">we're obviously a TA could flag that</font>

960
00:44:40,849 --> 00:44:44,119
pretty easily<font color="#E5E5E5"> as suspicious because my</font>

961
00:44:42,650 --> 00:44:46,880
workstation<font color="#E5E5E5"> is not a domain controller</font>

962
00:44:44,119 --> 00:44:50,329
<font color="#CCCCCC">why am i doing that request right</font><font color="#E5E5E5"> so</font>

963
00:44:46,880 --> 00:44:52,930
it's<font color="#E5E5E5"> pretty easy to flag DC sync so even</font>

964
00:44:50,329 --> 00:44:55,130
though it<font color="#E5E5E5"> was the fastest you know and</font>

965
00:44:52,930 --> 00:44:58,000
easiest technique to use<font color="#E5E5E5"> in the past I</font>

966
00:44:55,130 --> 00:45:01,070
wouldn't recommend it anymore

967
00:44:58,000 --> 00:45:03,680
partially detected<font color="#E5E5E5"> in the loss it wasn't</font>

968
00:45:01,070 --> 00:45:09,470
detected all in<font color="#CCCCCC"> 1.7 and 1.8</font><font color="#E5E5E5"> it partially</font>

969
00:45:03,680 --> 00:45:11,180
detected it<font color="#CCCCCC"> when we used the WMI Shadow</font>

970
00:45:09,470 --> 00:45:13,848
<font color="#CCCCCC">Copy so we're basically just</font><font color="#E5E5E5"> doing a</font>

971
00:45:11,180 --> 00:45:17,470
<font color="#E5E5E5">shadow copy like a backup event</font><font color="#CCCCCC"> on the</font>

972
00:45:13,849 --> 00:45:20,420
domain controller<font color="#CCCCCC"> to dump the</font><font color="#E5E5E5"> NTDs</font><font color="#CCCCCC"> bit</font>

973
00:45:17,470 --> 00:45:22,520
<font color="#CCCCCC">and we can do</font><font color="#E5E5E5"> that without</font><font color="#CCCCCC"> having to</font>

974
00:45:20,420 --> 00:45:26,089
call<font color="#CCCCCC"> the Shadow Copy admin direct</font>

975
00:45:22,520 --> 00:45:28,430
executable directly by using<font color="#CCCCCC"> WMI but</font>

976
00:45:26,089 --> 00:45:31,460
this is now flagged as a low<font color="#E5E5E5"> severity</font>

977
00:45:28,430 --> 00:45:33,828
event in<font color="#CCCCCC"> ata not because we got a copy</font>

978
00:45:31,460 --> 00:45:36,920
<font color="#E5E5E5">of the</font><font color="#CCCCCC"> act directory database but</font>

979
00:45:33,829 --> 00:45:40,190
because an attempt was<font color="#E5E5E5"> made</font><font color="#CCCCCC"> to connect</font>

980
00:45:36,920 --> 00:45:43,460
via<font color="#CCCCCC"> WMI to the Active Directory Mercer</font>

981
00:45:40,190 --> 00:45:46,130
to the domain controller so you know if

982
00:45:43,460 --> 00:45:47,540
you saw this<font color="#E5E5E5"> you you might this is a low</font>

983
00:45:46,130 --> 00:45:50,540
severity event you might<font color="#E5E5E5"> just ignore it</font>

984
00:45:47,540 --> 00:45:52,160
<font color="#CCCCCC">where in reality we got a full</font><font color="#E5E5E5"> copy of</font>

985
00:45:50,540 --> 00:45:54,440
<font color="#E5E5E5">the Active Directory database with all</font>

986
00:45:52,160 --> 00:45:59,328
<font color="#CCCCCC">the admittances or and all the user</font>

987
00:45:54,440 --> 00:46:05,569
creds<font color="#E5E5E5"> and everything like that</font><font color="#CCCCCC"> not</font>

988
00:45:59,329 --> 00:46:08,869
detecting another<font color="#E5E5E5"> technique if we</font>

989
00:46:05,569 --> 00:46:11,390
execute<font color="#CCCCCC"> Mimi cats directly</font><font color="#E5E5E5"> or remotely</font>

990
00:46:08,869 --> 00:46:13,970
<font color="#E5E5E5">on on a domain</font><font color="#CCCCCC"> controller in memory via</font>

991
00:46:11,390 --> 00:46:17,930
<font color="#E5E5E5">win</font><font color="#CCCCCC"> RM or PS remoting that's not</font>

992
00:46:13,970 --> 00:46:19,609
detected<font color="#CCCCCC"> well you might</font><font color="#E5E5E5"> be able to</font>

993
00:46:17,930 --> 00:46:21,740
<font color="#E5E5E5">reproduce it user behavior</font><font color="#CCCCCC"> Analects</font>

994
00:46:19,609 --> 00:46:29,450
might spot it but<font color="#CCCCCC"> I couldn't reproduce</font>

995
00:46:21,740 --> 00:46:32,270
that as a blue<font color="#CCCCCC"> Timur this is pretty easy</font>

996
00:46:29,450 --> 00:46:36,439
to<font color="#E5E5E5"> detect if you're running sis Mon on</font>

997
00:46:32,270 --> 00:46:39,319
the domain controller as well<font color="#CCCCCC"> as as</font>

998
00:46:36,440 --> 00:46:41,569
hardening<font color="#E5E5E5"> who can</font><font color="#CCCCCC"> actually remotely</font><font color="#E5E5E5"> log</font>

999
00:46:39,319 --> 00:46:43,910
<font color="#E5E5E5">into the box over win</font><font color="#CCCCCC"> RM or PS remoting</font>

1000
00:46:41,569 --> 00:46:45,620
<font color="#CCCCCC">you can just block that attack path all</font>

1001
00:46:43,910 --> 00:46:48,830
together

1002
00:46:45,620 --> 00:46:53,509
same goes with raw disk access so if we

1003
00:46:48,830 --> 00:46:56,000
just directly<font color="#E5E5E5"> connect to the raw disk to</font>

1004
00:46:53,510 --> 00:46:58,430
copy the<font color="#E5E5E5"> NTDs study date and system file</font>

1005
00:46:56,000 --> 00:47:00,440
<font color="#E5E5E5">without starting any services or</font>

1006
00:46:58,430 --> 00:47:04,250
processes<font color="#E5E5E5"> or injecting into anything or</font>

1007
00:47:00,440 --> 00:47:08,540
elevating the system<font color="#CCCCCC"> that's not detected</font>

1008
00:47:04,250 --> 00:47:11,660
either<font color="#E5E5E5"> but again</font><font color="#CCCCCC"> you can</font><font color="#E5E5E5"> detect that</font>

1009
00:47:08,540 --> 00:47:19,430
else s injection<font color="#CCCCCC"> arad this access with</font>

1010
00:47:11,660 --> 00:47:21,529
system<font color="#E5E5E5"> on</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> like past the hash golden</font>

1011
00:47:19,430 --> 00:47:25,250
tickets are going<font color="#CCCCCC"> to be detected because</font>

1012
00:47:21,530 --> 00:47:31,460
<font color="#CCCCCC">we're only</font><font color="#E5E5E5"> supplying the rc4 not the AES</font>

1013
00:47:25,250 --> 00:47:33,590
<font color="#E5E5E5">so if we supply the AES key</font><font color="#CCCCCC"> we're able</font>

1014
00:47:31,460 --> 00:47:41,000
to grab a golden ticket<font color="#CCCCCC"> it's not flagged</font>

1015
00:47:33,590 --> 00:47:44,840
by<font color="#E5E5E5"> ata</font><font color="#CCCCCC"> so some takeaways we're doing for</font>

1016
00:47:41,000 --> 00:47:48,110
time<font color="#CCCCCC"> oh</font><font color="#E5E5E5"> pretty much up so you can grab</font>

1017
00:47:44,840 --> 00:47:49,880
these<font color="#E5E5E5"> slides</font><font color="#CCCCCC"> they're on the internet</font><font color="#E5E5E5"> but</font>

1018
00:47:48,110 --> 00:47:52,280
really what you want to do from<font color="#E5E5E5"> a blue</font>

1019
00:47:49,880 --> 00:47:55,160
teaming perspective is implement<font color="#E5E5E5"> that</font>

1020
00:47:52,280 --> 00:47:57,760
second line<font color="#CCCCCC"> of defense</font><font color="#E5E5E5"> don't just rely</font>

1021
00:47:55,160 --> 00:48:00,529
on that<font color="#E5E5E5"> shiny tool that some sales guy</font>

1022
00:47:57,760 --> 00:48:02,750
<font color="#E5E5E5">pushed down your throat to to be that</font>

1023
00:48:00,530 --> 00:48:05,270
you know<font color="#CCCCCC"> Silver Bullet you want to put</font>

1024
00:48:02,750 --> 00:48:07,910
in a lot of<font color="#CCCCCC"> these</font><font color="#E5E5E5"> backup detection</font>

1025
00:48:05,270 --> 00:48:11,690
methods you know CrowdStrike<font color="#CCCCCC"> and ATP and</font>

1026
00:48:07,910 --> 00:48:13,490
all that are good products<font color="#E5E5E5"> but there's</font>

1027
00:48:11,690 --> 00:48:15,860
always<font color="#CCCCCC"> going to</font><font color="#E5E5E5"> be a way</font><font color="#CCCCCC"> around them</font>

1028
00:48:13,490 --> 00:48:17,149
<font color="#CCCCCC">because people like me</font><font color="#E5E5E5"> are motivated to</font>

1029
00:48:15,860 --> 00:48:18,590
<font color="#E5E5E5">get around them and whether the</font>

1030
00:48:17,150 --> 00:48:20,390
techniques public or not people are

1031
00:48:18,590 --> 00:48:23,540
<font color="#E5E5E5">still</font><font color="#CCCCCC"> gonna be motivated so you want to</font>

1032
00:48:20,390 --> 00:48:25,160
make sure that you're forcing the

1033
00:48:23,540 --> 00:48:28,640
attacker to<font color="#E5E5E5"> create as much noise as</font>

1034
00:48:25,160 --> 00:48:33,350
<font color="#CCCCCC">possible so you</font><font color="#E5E5E5"> can grab those events</font>

1035
00:48:28,640 --> 00:48:36,080
somewhere and flag on them you really

1036
00:48:33,350 --> 00:48:37,940
<font color="#E5E5E5">want to integrate</font><font color="#CCCCCC"> I know you know in the</font>

1037
00:48:36,080 --> 00:48:39,920
past a lot<font color="#E5E5E5"> of it</font><font color="#CCCCCC"> men's or like our on</font>

1038
00:48:37,940 --> 00:48:41,660
<font color="#E5E5E5">Windows</font><font color="#CCCCCC"> 7 and now we're</font><font color="#E5E5E5"> on Service Pack</font>

1039
00:48:39,920 --> 00:48:44,510
<font color="#CCCCCC">one we're gonna skip Windows a</font><font color="#E5E5E5"> we'll</font>

1040
00:48:41,660 --> 00:48:46,700
skip 8.1<font color="#E5E5E5"> yeah I will probably skip</font>

1041
00:48:44,510 --> 00:48:48,740
<font color="#E5E5E5">Windows 10 until you know we have to</font>

1042
00:48:46,700 --> 00:48:51,109
move<font color="#CCCCCC"> Windows</font><font color="#E5E5E5"> 7 over just because it's</font>

1043
00:48:48,740 --> 00:48:54,589
under life<font color="#CCCCCC"> I highly</font><font color="#E5E5E5"> recommend you</font><font color="#CCCCCC"> look</font>

1044
00:48:51,110 --> 00:48:56,420
at how<font color="#CCCCCC"> your what's it called foresting</font>

1045
00:48:54,590 --> 00:48:57,330
<font color="#E5E5E5">green something</font><font color="#CCCCCC"> I don't know how you're</font>

1046
00:48:56,420 --> 00:49:01,580
ever

1047
00:48:57,330 --> 00:49:04,920
ever evergreening there you go

1048
00:49:01,580 --> 00:49:06,870
<font color="#CCCCCC">environmentally-conscious</font><font color="#E5E5E5"> term yeah so</font>

1049
00:49:04,920 --> 00:49:09,240
however<font color="#E5E5E5"> you're getting rid of those</font>

1050
00:49:06,870 --> 00:49:10,859
<font color="#E5E5E5">windows</font><font color="#CCCCCC"> seven boxes and moving</font><font color="#E5E5E5"> to</font>

1051
00:49:09,240 --> 00:49:12,810
Windows<font color="#CCCCCC"> 10</font><font color="#E5E5E5"> you instead want to look at</font>

1052
00:49:10,860 --> 00:49:16,560
your your release cycle a lot<font color="#E5E5E5"> better and</font>

1053
00:49:12,810 --> 00:49:19,620
say<font color="#CCCCCC"> ok</font><font color="#E5E5E5"> there is a security benefit to</font>

1054
00:49:16,560 --> 00:49:21,900
moving to you know release<font color="#CCCCCC"> 3 that just</font>

1055
00:49:19,620 --> 00:49:23,790
came out<font color="#E5E5E5"> not</font><font color="#CCCCCC"> just a</font><font color="#E5E5E5"> hey</font><font color="#CCCCCC"> we'll plan</font><font color="#E5E5E5"> for</font>

1056
00:49:21,900 --> 00:49:25,740
it in<font color="#CCCCCC"> 3 years from</font><font color="#E5E5E5"> now you know</font>

1057
00:49:23,790 --> 00:49:27,240
Microsoft's got this new release cycle

1058
00:49:25,740 --> 00:49:28,680
that you should really investigate

1059
00:49:27,240 --> 00:49:30,089
<font color="#CCCCCC">sometime</font><font color="#E5E5E5"> into and see that some of the</font>

1060
00:49:28,680 --> 00:49:34,200
<font color="#E5E5E5">security benefits</font><font color="#CCCCCC"> from doing that</font><font color="#E5E5E5"> as</font>

1061
00:49:30,090 --> 00:49:36,060
well from a red teaming perspective<font color="#CCCCCC"> we</font>

1062
00:49:34,200 --> 00:49:39,540
really<font color="#CCCCCC"> got</font><font color="#E5E5E5"> a return</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> living</font><font color="#CCCCCC"> off the</font>

1063
00:49:36,060 --> 00:49:42,120
land<font color="#CCCCCC"> and only leveraging these awesome</font>

1064
00:49:39,540 --> 00:49:43,830
<font color="#E5E5E5">PowerShell tools</font><font color="#CCCCCC"> after we're confident</font>

1065
00:49:42,120 --> 00:49:45,509
we can run them against the box and<font color="#E5E5E5"> not</font>

1066
00:49:43,830 --> 00:49:48,240
get<font color="#E5E5E5"> caught by PowerShell logging in all</font>

1067
00:49:45,510 --> 00:49:51,480
<font color="#E5E5E5">that crap so we want to make</font><font color="#CCCCCC"> sure we're</font>

1068
00:49:48,240 --> 00:49:53,930
disabling ATP<font color="#E5E5E5"> and event log forwarding</font>

1069
00:49:51,480 --> 00:49:57,300
before we start to use<font color="#E5E5E5"> those fancy tools</font>

1070
00:49:53,930 --> 00:49:59,700
<font color="#CCCCCC">we really want</font><font color="#E5E5E5"> to review</font><font color="#CCCCCC"> RDP in session</font>

1071
00:49:57,300 --> 00:50:03,090
history<font color="#E5E5E5"> and</font><font color="#CCCCCC"> whatnot so we can emulate</font>

1072
00:49:59,700 --> 00:50:05,040
<font color="#E5E5E5">real traffic and real users connecting</font>

1073
00:50:03,090 --> 00:50:06,210
to a certain<font color="#E5E5E5"> box as much as</font><font color="#CCCCCC"> possible so</font>

1074
00:50:05,040 --> 00:50:10,100
it's not flagging somebody from

1075
00:50:06,210 --> 00:50:10,100
marketing connecting to the<font color="#E5E5E5"> dev ops box</font>

1076
00:50:10,250 --> 00:50:15,210
<font color="#E5E5E5">we want to focus on a lot of</font><font color="#CCCCCC"> information</font>

1077
00:50:13,080 --> 00:50:17,310
gathering<font color="#CCCCCC"> techniques and lateral</font>

1078
00:50:15,210 --> 00:50:18,930
movement techniques that<font color="#E5E5E5"> don't connect</font>

1079
00:50:17,310 --> 00:50:20,310
communicate<font color="#E5E5E5"> with the domain controller</font>

1080
00:50:18,930 --> 00:50:23,430
and<font color="#E5E5E5"> don't authenticate</font><font color="#CCCCCC"> to the domain</font>

1081
00:50:20,310 --> 00:50:25,920
controller so looking at the local<font color="#CCCCCC"> WMI</font>

1082
00:50:23,430 --> 00:50:27,600
namespace queries looking at Kerberos

1083
00:50:25,920 --> 00:50:31,560
<font color="#CCCCCC">sting</font><font color="#E5E5E5"> and SPNs and creating silver</font>

1084
00:50:27,600 --> 00:50:34,259
tickets and and evading or<font color="#E5E5E5"> avoiding any</font>

1085
00:50:31,560 --> 00:50:38,240
authentication events<font color="#CCCCCC"> due to me</font><font color="#E5E5E5"> to the</font>

1086
00:50:34,260 --> 00:50:38,240
domain controller whenever possible<font color="#CCCCCC"> so</font>

1087
00:50:39,950 --> 00:50:44,879
<font color="#CCCCCC">big</font><font color="#E5E5E5"> thanks to all those Turner hashes</font>

1088
00:50:43,230 --> 00:50:47,430
<font color="#E5E5E5">take a picture of</font><font color="#CCCCCC"> that and follow those</font>

1089
00:50:44,880 --> 00:50:49,530
<font color="#E5E5E5">people they're amazing they really</font>

1090
00:50:47,430 --> 00:50:51,629
<font color="#CCCCCC">helped me along with</font><font color="#E5E5E5"> my research</font><font color="#CCCCCC"> this</font>

1091
00:50:49,530 --> 00:50:55,140
<font color="#E5E5E5">was actually the</font><font color="#CCCCCC"> first formal research</font>

1092
00:50:51,630 --> 00:50:57,240
project that<font color="#CCCCCC"> I did and at times I</font>

1093
00:50:55,140 --> 00:50:59,910
definitely regretted it because<font color="#E5E5E5"> it was</font>

1094
00:50:57,240 --> 00:51:01,709
so much<font color="#E5E5E5"> work</font><font color="#CCCCCC"> but at the same time it was</font>

1095
00:50:59,910 --> 00:51:04,259
super interesting<font color="#CCCCCC"> because it forced me</font>

1096
00:51:01,710 --> 00:51:06,830
to learn a lot<font color="#CCCCCC"> of techniques and you</font>

1097
00:51:04,260 --> 00:51:09,450
know the<font color="#E5E5E5"> amount of side paths I went on</font>

1098
00:51:06,830 --> 00:51:10,799
and new<font color="#E5E5E5"> techniques I</font><font color="#CCCCCC"> learned just</font><font color="#E5E5E5"> by</font>

1099
00:51:09,450 --> 00:51:13,910
picking<font color="#E5E5E5"> a product</font>

1100
00:51:10,799 --> 00:51:16,949
trying to attack<font color="#CCCCCC"> it was was awesome so</font>

1101
00:51:13,910 --> 00:51:19,199
even if you just<font color="#CCCCCC"> start doing</font><font color="#E5E5E5"> research</font>

1102
00:51:16,949 --> 00:51:21,569
against some random new security product

1103
00:51:19,199 --> 00:51:23,130
that's out there<font color="#E5E5E5"> with no goal and doing</font>

1104
00:51:21,569 --> 00:51:24,509
a talk or putting a paper out<font color="#CCCCCC"> and just</font>

1105
00:51:23,130 --> 00:51:26,999
<font color="#E5E5E5">do</font><font color="#CCCCCC"> it for your own benefit I highly</font>

1106
00:51:24,509 --> 00:51:32,749
recommend it so thanks everyone for your

1107
00:51:26,999 --> 00:51:32,749
<font color="#E5E5E5">time</font><font color="#CCCCCC"> and come</font><font color="#E5E5E5"> on out to</font><font color="#CCCCCC"> Cal sec</font>

