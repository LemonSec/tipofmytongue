1
00:00:00,000 --> 00:00:02,960
is we're going to be adrian you're good

2
00:00:02,960 --> 00:00:06,160
ladies and gentlemen matt sure

3
00:00:07,759 --> 00:00:09,760
thank you everybody uh it's great to be

4
00:00:09,760 --> 00:00:11,440
here i've never taken a speaking

5
00:00:11,440 --> 00:00:13,360
engagement for granted

6
00:00:13,360 --> 00:00:15,759
but this is nice to be back here in

7
00:00:15,759 --> 00:00:17,440
person in real life again

8
00:00:17,440 --> 00:00:20,160
i really like this uh my talk here is

9
00:00:20,160 --> 00:00:22,080
called let me your irs which as you

10
00:00:22,080 --> 00:00:23,920
might guess is about incident response

11
00:00:23,920 --> 00:00:24,240
so

12
00:00:24,240 --> 00:00:25,519
hopefully we're not tired of hearing

13
00:00:25,519 --> 00:00:27,840
about that uh given the previous talk

14
00:00:27,840 --> 00:00:29,039
if you want to follow me on twitter

15
00:00:29,039 --> 00:00:31,920
please do i'm at c3rkah

16
00:00:31,920 --> 00:00:34,079
i'm getting really close to 1000

17
00:00:34,079 --> 00:00:36,399
followers help me out please

18
00:00:36,399 --> 00:00:38,239
follow me if you would uh you can also

19
00:00:38,239 --> 00:00:39,840
hit me up on linkedin

20
00:00:39,840 --> 00:00:42,879
and i don't have this branded slide deck

21
00:00:42,879 --> 00:00:44,480
but i've got previous slide decks of

22
00:00:44,480 --> 00:00:45,600
this very same talk

23
00:00:45,600 --> 00:00:48,719
out on slideshare so

24
00:00:48,719 --> 00:00:50,399
real quick introduction my name is matt

25
00:00:50,399 --> 00:00:52,399
sheer

26
00:00:52,399 --> 00:00:55,680
i work for a big well-known organization

27
00:00:55,680 --> 00:00:58,320
as an infosec engineer performing dfir

28
00:00:58,320 --> 00:00:58,879
on a

29
00:00:58,879 --> 00:01:02,320
c-cert i'm also a podcast host for the

30
00:01:02,320 --> 00:01:04,000
all-new threat reel podcast

31
00:01:04,000 --> 00:01:06,560
a little behind on the current episode

32
00:01:06,560 --> 00:01:07,600
but i'll get it

33
00:01:07,600 --> 00:01:08,880
out there soon if you want to give us a

34
00:01:08,880 --> 00:01:12,000
listen so just some quick things about

35
00:01:12,000 --> 00:01:14,159
me uh volunteer i'm here up from the

36
00:01:14,159 --> 00:01:16,320
cincinnati area but i'm from about 70

37
00:01:16,320 --> 00:01:18,320
miles south of here originally so this

38
00:01:18,320 --> 00:01:18,880
is uh

39
00:01:18,880 --> 00:01:20,640
as close as i can get to a triumph at

40
00:01:20,640 --> 00:01:22,240
homecoming um

41
00:01:22,240 --> 00:01:24,400
and uh down in cincinnati i run a

42
00:01:24,400 --> 00:01:26,000
monthly infosec meetup group

43
00:01:26,000 --> 00:01:29,040
called the simpa security sig

44
00:01:29,040 --> 00:01:31,280
and i'm also a hacking is not a crime

45
00:01:31,280 --> 00:01:32,159
advocate

46
00:01:32,159 --> 00:01:34,799
and i'm a technical mentor for wamsa

47
00:01:34,799 --> 00:01:38,079
which is the women's security alliance

48
00:01:38,079 --> 00:01:40,640
a quick disclaimer i do have a day job

49
00:01:40,640 --> 00:01:42,560
but opinions expressed are based solely

50
00:01:42,560 --> 00:01:44,799
on my own independent security research

51
00:01:44,799 --> 00:01:46,479
and don't express the reflective user

52
00:01:46,479 --> 00:01:48,880
opinions of my employer

53
00:01:48,880 --> 00:01:51,200
um some objectives today are to show

54
00:01:51,200 --> 00:01:54,640
live demo reenactments from real attacks

55
00:01:54,640 --> 00:01:56,719
explain how these attacks worked how and

56
00:01:56,719 --> 00:01:59,200
why they defeated our security solutions

57
00:01:59,200 --> 00:02:00,799
and then show incident responses to

58
00:02:00,799 --> 00:02:02,799
these attacks and i'm going to demo

59
00:02:02,799 --> 00:02:04,640
investigation tools and techniques

60
00:02:04,640 --> 00:02:06,640
along the way and discuss lessons

61
00:02:06,640 --> 00:02:09,360
learned and key takeaways

62
00:02:09,360 --> 00:02:10,878
and just make sure everybody's on the

63
00:02:10,878 --> 00:02:12,560
same page you probably already know this

64
00:02:12,560 --> 00:02:12,879
but

65
00:02:12,879 --> 00:02:15,360
ioc is indicator of compromise sometimes

66
00:02:15,360 --> 00:02:17,120
people call it ioc

67
00:02:17,120 --> 00:02:19,840
ir is incident response and dfir is

68
00:02:19,840 --> 00:02:22,560
digital forensics and incident response

69
00:02:22,560 --> 00:02:24,239
just some other disclaimers that these

70
00:02:24,239 --> 00:02:26,560
demos are all based on 100 percent true

71
00:02:26,560 --> 00:02:27,440
stories

72
00:02:27,440 --> 00:02:28,959
i worked really hard to beautifully

73
00:02:28,959 --> 00:02:30,800
recreate the actual attacks but the

74
00:02:30,800 --> 00:02:33,120
details have been altered

75
00:02:33,120 --> 00:02:35,200
and then these investigations are sped

76
00:02:35,200 --> 00:02:37,360
up considerably in the amount of time

77
00:02:37,360 --> 00:02:40,319
uh for this presentation and uh just

78
00:02:40,319 --> 00:02:41,120
sort of a reminder

79
00:02:41,120 --> 00:02:43,120
folks i should only use these techniques

80
00:02:43,120 --> 00:02:45,519
on a dedicated uh sandbox

81
00:02:45,519 --> 00:02:47,680
and uh there's some great resources out

82
00:02:47,680 --> 00:02:49,360
there sans sift workstation was

83
00:02:49,360 --> 00:02:50,800
mentioned earlier

84
00:02:50,800 --> 00:02:53,360
remnucks as well they have some great

85
00:02:53,360 --> 00:02:53,840
tools

86
00:02:53,840 --> 00:02:57,519
within those in my case i'm going to

87
00:02:57,519 --> 00:02:59,599
have to pretend i'm using a sandbox

88
00:02:59,599 --> 00:03:01,840
because i've built the demo environment

89
00:03:01,840 --> 00:03:03,920
on my local machine here

90
00:03:03,920 --> 00:03:05,920
so my first scenario i am calling the

91
00:03:05,920 --> 00:03:07,920
mystery attachment

92
00:03:07,920 --> 00:03:10,239
and this was really from a news headline

93
00:03:10,239 --> 00:03:12,720
that trustwave researchers

94
00:03:12,720 --> 00:03:14,640
found a mousebam campaign targeting

95
00:03:14,640 --> 00:03:16,560
banks at the time i was working for

96
00:03:16,560 --> 00:03:19,120
first financial bank in cincinnati what

97
00:03:19,120 --> 00:03:21,040
was unique about this is they were using

98
00:03:21,040 --> 00:03:22,640
microsoft publisher

99
00:03:22,640 --> 00:03:25,920
to launch their attacks and it's very

100
00:03:25,920 --> 00:03:27,120
common to see other

101
00:03:27,120 --> 00:03:29,360
you know microsoft office documents like

102
00:03:29,360 --> 00:03:31,040
word

103
00:03:31,040 --> 00:03:33,920
you excel pdfs things like that uh very

104
00:03:33,920 --> 00:03:35,120
rare to see something

105
00:03:35,120 --> 00:03:37,280
leveraging microsoft publisher uh it's

106
00:03:37,280 --> 00:03:39,920
not one of the more popular applications

107
00:03:39,920 --> 00:03:42,640
but it was uh the flawed emurat which is

108
00:03:42,640 --> 00:03:44,239
part of the curse.net

109
00:03:44,239 --> 00:03:46,159
and uh there's a link there to the

110
00:03:46,159 --> 00:03:47,599
original trustwave

111
00:03:47,599 --> 00:03:50,480
blog that detailed this but the

112
00:03:50,480 --> 00:03:51,360
following week

113
00:03:51,360 --> 00:03:53,280
i had somebody that was a frantic

114
00:03:53,280 --> 00:03:55,760
visitor running up to my desk

115
00:03:55,760 --> 00:03:57,840
and they were all worked up and

116
00:03:57,840 --> 00:03:59,120
basically telling me that one of the

117
00:03:59,120 --> 00:04:01,840
vips had opened up an attachment

118
00:04:01,840 --> 00:04:03,200
and it was a microsoft publisher

119
00:04:03,200 --> 00:04:05,040
attachment or at least they tried to

120
00:04:05,040 --> 00:04:06,799
open it and then they realized

121
00:04:06,799 --> 00:04:10,400
uh oops i messed up so they reached out

122
00:04:10,400 --> 00:04:13,519
and this particular person i want to say

123
00:04:13,519 --> 00:04:14,959
probably about half a year later became

124
00:04:14,959 --> 00:04:15,680
my boss

125
00:04:15,680 --> 00:04:17,358
and then about a year after that became

126
00:04:17,358 --> 00:04:19,199
my reason for leaving that's another

127
00:04:19,199 --> 00:04:19,839
story

128
00:04:19,839 --> 00:04:24,000
buy me a beer and we'll talk about that

129
00:04:24,000 --> 00:04:26,240
so anyway i'm sitting there thinking

130
00:04:26,240 --> 00:04:27,680
okay no problem you'll get me the

131
00:04:27,680 --> 00:04:29,199
attachment i'll dig into it because they

132
00:04:29,199 --> 00:04:30,080
stand there

133
00:04:30,080 --> 00:04:31,840
and they're just talking and they're

134
00:04:31,840 --> 00:04:33,600
just all worked up now all of a sudden

135
00:04:33,600 --> 00:04:35,040
i'm starting to get anxious i'm starting

136
00:04:35,040 --> 00:04:36,479
to get worked up i'm like all right man

137
00:04:36,479 --> 00:04:37,199
i'm gonna

138
00:04:37,199 --> 00:04:39,440
do my best to turn the attachment uh we

139
00:04:39,440 --> 00:04:40,639
don't actually have

140
00:04:40,639 --> 00:04:42,320
it where i'm working at the time good

141
00:04:42,320 --> 00:04:43,919
mobile forensics tools

142
00:04:43,919 --> 00:04:46,160
of any sort i'm probably not the best

143
00:04:46,160 --> 00:04:47,759
guy to do this but i'm the

144
00:04:47,759 --> 00:04:50,000
most capable person within the

145
00:04:50,000 --> 00:04:53,680
organization to try to take a stab at it

146
00:04:53,680 --> 00:04:55,680
so the investigation we're going to open

147
00:04:55,680 --> 00:04:58,720
up the file in our pretend sandbox

148
00:04:58,720 --> 00:05:00,240
and then we're going to talk about

149
00:05:00,240 --> 00:05:02,639
detonation research attempts

150
00:05:02,639 --> 00:05:04,080
just failures to understand anything

151
00:05:04,080 --> 00:05:06,639
about it i'll do a quick strings demo

152
00:05:06,639 --> 00:05:08,800
and then we'll just show sort of hashing

153
00:05:08,800 --> 00:05:11,280
the file and doing online research

154
00:05:11,280 --> 00:05:14,240
and then finally we'll look at exit data

155
00:05:14,240 --> 00:05:16,080
while i was pondering my next steps

156
00:05:16,080 --> 00:05:17,759
so let's go ahead and do those things

157
00:05:17,759 --> 00:05:19,280
and let me see if i can

158
00:05:19,280 --> 00:05:22,800
switch over here to files

159
00:05:22,800 --> 00:05:24,479
so again this would be opening up the

160
00:05:24,479 --> 00:05:26,560
file in my pretend sandbox

161
00:05:26,560 --> 00:05:27,919
i don't actually have microsoft

162
00:05:27,919 --> 00:05:30,320
publisher here so we're just going to

163
00:05:30,320 --> 00:05:34,719
use libreoffice draw

164
00:05:35,840 --> 00:05:38,000
and like a lot of typical things that

165
00:05:38,000 --> 00:05:40,320
are going to lead to infection

166
00:05:40,320 --> 00:05:42,800
it'll start off with a line let me see

167
00:05:42,800 --> 00:05:46,400
if i make that a little bit bigger

168
00:05:47,280 --> 00:05:49,840
just sort of a quick blurb at the top

169
00:05:49,840 --> 00:05:51,280
basically saying hey

170
00:05:51,280 --> 00:05:54,160
enable macros here's how you do it

171
00:05:54,160 --> 00:05:54,560
because

172
00:05:54,560 --> 00:05:57,680
a lot of these malware samples that

173
00:05:57,680 --> 00:05:58,240
depend

174
00:05:58,240 --> 00:06:01,360
on macros most of those things are

175
00:06:01,360 --> 00:06:03,840
disabled by default and security

176
00:06:03,840 --> 00:06:05,759
so it's just a very vague looking

177
00:06:05,759 --> 00:06:07,759
document there wasn't really anything

178
00:06:07,759 --> 00:06:11,759
in here as i'm looking at in the sandbox

179
00:06:11,759 --> 00:06:14,880
so let's go ahead and you know just

180
00:06:14,880 --> 00:06:17,120
take a look at strings i like to run

181
00:06:17,120 --> 00:06:18,400
strings on

182
00:06:18,400 --> 00:06:21,039
files when i don't know exactly what i'm

183
00:06:21,039 --> 00:06:21,919
looking at

184
00:06:21,919 --> 00:06:25,280
just to see if i can find uh something

185
00:06:25,280 --> 00:06:27,680
interesting in them let me open up a new

186
00:06:27,680 --> 00:06:30,160
terminal window

187
00:06:30,160 --> 00:06:33,360
and let me make this bigger so it's

188
00:06:33,360 --> 00:06:36,400
hopefully a little easier to see um

189
00:06:36,400 --> 00:06:39,680
so we will go ahead and just do a shaw

190
00:06:39,680 --> 00:06:41,199
256 sum

191
00:06:41,199 --> 00:06:42,880
now it's important to note that it

192
00:06:42,880 --> 00:06:44,319
really just kind of depends

193
00:06:44,319 --> 00:06:47,680
on uh oops i forgot the word sum

194
00:06:47,680 --> 00:06:49,919
it kind of depends on what tools you

195
00:06:49,919 --> 00:06:51,360
have in your environment and just

196
00:06:51,360 --> 00:06:52,880
knowing what they support what the

197
00:06:52,880 --> 00:06:54,960
limitations might be

198
00:06:54,960 --> 00:06:56,479
there are some organizations that use

199
00:06:56,479 --> 00:06:58,880
tools and usually for the purpose of

200
00:06:58,880 --> 00:07:02,160
just doing a quick analysis sha or md5

201
00:07:02,160 --> 00:07:04,720
is fine um you know obviously that can

202
00:07:04,720 --> 00:07:06,080
be defeated in a real

203
00:07:06,080 --> 00:07:08,400
situation with uh you know collisions

204
00:07:08,400 --> 00:07:09,360
and so forth

205
00:07:09,360 --> 00:07:12,400
but for our purposes today um and what i

206
00:07:12,400 --> 00:07:13,919
had available at the time we had

207
00:07:13,919 --> 00:07:16,000
everything had shaw 256 so

208
00:07:16,000 --> 00:07:17,199
i just went with that since it was a

209
00:07:17,199 --> 00:07:19,199
little more accurate but you could do a

210
00:07:19,199 --> 00:07:19,840
md5

211
00:07:19,840 --> 00:07:22,479
some and get the same results so anyway

212
00:07:22,479 --> 00:07:24,319
i went ahead and

213
00:07:24,319 --> 00:07:27,599
you know had that and i just did some

214
00:07:27,599 --> 00:07:28,160
quick

215
00:07:28,160 --> 00:07:29,840
searching online just to see what i

216
00:07:29,840 --> 00:07:31,680
could find on that

217
00:07:31,680 --> 00:07:33,840
and so you know i just searched now i

218
00:07:33,840 --> 00:07:35,599
didn't upload anything

219
00:07:35,599 --> 00:07:37,120
i'm always very careful not to just

220
00:07:37,120 --> 00:07:39,039
upload things to virustotal but if you

221
00:07:39,039 --> 00:07:39,680
have

222
00:07:39,680 --> 00:07:41,759
a hash value you can absolutely search

223
00:07:41,759 --> 00:07:44,240
for it and there's no harm in that

224
00:07:44,240 --> 00:07:46,240
but you know to my surprise there just

225
00:07:46,240 --> 00:07:48,319
really weren't any matches out there

226
00:07:48,319 --> 00:07:50,080
and i'm thinking well if this is a now

227
00:07:50,080 --> 00:07:51,680
published

228
00:07:51,680 --> 00:07:54,560
threat then usually you can find a some

229
00:07:54,560 --> 00:07:56,240
value

230
00:07:56,240 --> 00:07:57,520
you know when you search on a virus

231
00:07:57,520 --> 00:07:59,039
total or something like that if it's

232
00:07:59,039 --> 00:08:01,120
just generic plain jane scent now if it

233
00:08:01,120 --> 00:08:01,599
was

234
00:08:01,599 --> 00:08:03,599
something modified or targeted then

235
00:08:03,599 --> 00:08:05,440
maybe your hash values aren't going to

236
00:08:05,440 --> 00:08:06,080
match

237
00:08:06,080 --> 00:08:07,840
um chatty malware scan has a lot of the

238
00:08:07,840 --> 00:08:09,599
same scanners um but

239
00:08:09,599 --> 00:08:12,960
uh maybe a few different and hashnot

240
00:08:12,960 --> 00:08:14,800
found was the search result

241
00:08:14,800 --> 00:08:17,120
on there and these tools i'm showing you

242
00:08:17,120 --> 00:08:18,639
absolutely support md5

243
00:08:18,639 --> 00:08:21,039
shaw 256 so it doesn't really matter

244
00:08:21,039 --> 00:08:22,240
which hashing algorithm

245
00:08:22,240 --> 00:08:24,960
algorithm you use you know even search

246
00:08:24,960 --> 00:08:26,800
on hybrid analysis to see did somebody

247
00:08:26,800 --> 00:08:28,240
just upload this thing

248
00:08:28,240 --> 00:08:31,280
uh to that and you can see no results

249
00:08:31,280 --> 00:08:34,240
were what i got so i got desperate and i

250
00:08:34,240 --> 00:08:35,039
just started

251
00:08:35,039 --> 00:08:37,360
throwing the stuff on google hash values

252
00:08:37,360 --> 00:08:39,360
and sometimes you find things

253
00:08:39,360 --> 00:08:40,880
sometimes you don't in this case i

254
00:08:40,880 --> 00:08:42,880
didn't so now it's really got me

255
00:08:42,880 --> 00:08:43,360
thinking

256
00:08:43,360 --> 00:08:45,360
like what is this was this thing you

257
00:08:45,360 --> 00:08:47,120
know somehow re-encoded

258
00:08:47,120 --> 00:08:50,000
uh you know was it you know specifically

259
00:08:50,000 --> 00:08:52,240
modified to target our organization

260
00:08:52,240 --> 00:08:54,399
and a specific user particularly

261
00:08:54,399 --> 00:08:56,160
somebody that's considered a vip that

262
00:08:56,160 --> 00:08:56,560
might

263
00:08:56,560 --> 00:08:58,240
have access to all sorts of sensitive

264
00:08:58,240 --> 00:09:00,000
information um

265
00:09:00,000 --> 00:09:02,560
so about this time our own sandbox

266
00:09:02,560 --> 00:09:03,839
analysis completed

267
00:09:03,839 --> 00:09:07,120
and i'm looking at it and i can't find

268
00:09:07,120 --> 00:09:08,720
anything bad

269
00:09:08,720 --> 00:09:11,040
nothing i throw at this is telling me

270
00:09:11,040 --> 00:09:12,080
that this is anything

271
00:09:12,080 --> 00:09:14,560
bad uh even the interactive sandbox i'm

272
00:09:14,560 --> 00:09:15,600
trying to get the

273
00:09:15,600 --> 00:09:17,440
macro prompt and i'm not that familiar

274
00:09:17,440 --> 00:09:19,200
with publisher but i couldn't figure it

275
00:09:19,200 --> 00:09:20,240
out

276
00:09:20,240 --> 00:09:21,760
so at this point i'm really scratching

277
00:09:21,760 --> 00:09:23,440
my head and

278
00:09:23,440 --> 00:09:25,040
some of the thoughts i had are you know

279
00:09:25,040 --> 00:09:26,720
what do we do about this

280
00:09:26,720 --> 00:09:29,120
um you know do we say well this was

281
00:09:29,120 --> 00:09:30,160
tried to open up on an

282
00:09:30,160 --> 00:09:32,399
iphone changes that you have malware

283
00:09:32,399 --> 00:09:33,920
written in microsoft publisher

284
00:09:33,920 --> 00:09:36,000
that can infect an iphone probably

285
00:09:36,000 --> 00:09:37,120
reasonably slim

286
00:09:37,120 --> 00:09:39,440
but still my risk tolerance is pretty

287
00:09:39,440 --> 00:09:40,959
low for that sort of thing

288
00:09:40,959 --> 00:09:42,720
so i'm thinking that's not really a good

289
00:09:42,720 --> 00:09:44,000
option

290
00:09:44,000 --> 00:09:45,839
the other thing is well maybe we just do

291
00:09:45,839 --> 00:09:47,680
a security wipe on the device and maybe

292
00:09:47,680 --> 00:09:49,200
that would be sufficient give us a

293
00:09:49,200 --> 00:09:50,560
little more peace of mind

294
00:09:50,560 --> 00:09:52,160
i still wasn't comfortable with that

295
00:09:52,160 --> 00:09:53,760
option either

296
00:09:53,760 --> 00:09:56,800
so if i'm looking in this user was not

297
00:09:56,800 --> 00:09:57,440
due for

298
00:09:57,440 --> 00:09:59,760
a device refresh but it was getting kind

299
00:09:59,760 --> 00:10:01,600
of close i think we were maybe inside of

300
00:10:01,600 --> 00:10:02,000
six

301
00:10:02,000 --> 00:10:05,440
months so i'm contemplating well maybe i

302
00:10:05,440 --> 00:10:06,000
should

303
00:10:06,000 --> 00:10:08,320
um just we should just confiscate the

304
00:10:08,320 --> 00:10:09,040
device

305
00:10:09,040 --> 00:10:11,839
shut it down get them a new one um and

306
00:10:11,839 --> 00:10:12,880
all these thoughts are running through

307
00:10:12,880 --> 00:10:13,680
my head

308
00:10:13,680 --> 00:10:16,320
and i should add that you know all of

309
00:10:16,320 --> 00:10:18,000
the stuff i'm digging into

310
00:10:18,000 --> 00:10:20,160
that i'm looking at i still can't make

311
00:10:20,160 --> 00:10:21,040
heads or tails

312
00:10:21,040 --> 00:10:22,959
sense of what's going on so that's why

313
00:10:22,959 --> 00:10:24,240
i'm at this place

314
00:10:24,240 --> 00:10:25,920
where i'm trying to figure out what do i

315
00:10:25,920 --> 00:10:28,480
recommend we do in this situation

316
00:10:28,480 --> 00:10:32,160
um so i finally had the idea that uh

317
00:10:32,160 --> 00:10:34,320
you know this is the dumbest thing ever

318
00:10:34,320 --> 00:10:36,320
but why didn't i look at the exif data

319
00:10:36,320 --> 00:10:37,200
for this

320
00:10:37,200 --> 00:10:39,200
uh now in windows it's pretty easy you

321
00:10:39,200 --> 00:10:40,720
right click on the file you go into the

322
00:10:40,720 --> 00:10:42,560
properties from your you know windows

323
00:10:42,560 --> 00:10:45,040
sandbox and you look at that

324
00:10:45,040 --> 00:10:46,640
you know properties to see what you can

325
00:10:46,640 --> 00:10:48,079
find in there see if there's anything

326
00:10:48,079 --> 00:10:48,880
useful

327
00:10:48,880 --> 00:10:52,240
uh in linux the pearl exif tool is

328
00:10:52,240 --> 00:10:52,959
really good

329
00:10:52,959 --> 00:10:55,680
at this kind of stuff so i went ahead

330
00:10:55,680 --> 00:10:58,000
and

331
00:10:58,720 --> 00:11:01,360
ran the exif tool on it and just to kind

332
00:11:01,360 --> 00:11:02,880
of note some things here

333
00:11:02,880 --> 00:11:06,000
um you know the file name directory all

334
00:11:06,000 --> 00:11:07,600
that sort of stuff but the file type the

335
00:11:07,600 --> 00:11:09,040
file extension and the mime

336
00:11:09,040 --> 00:11:11,120
type were particularly interesting

337
00:11:11,120 --> 00:11:12,640
because i haven't ever seen really

338
00:11:12,640 --> 00:11:15,279
fpx that i can remember so i did

339
00:11:15,279 --> 00:11:16,959
research and found out yeah that

340
00:11:16,959 --> 00:11:18,480
genuinely is

341
00:11:18,480 --> 00:11:21,440
um what a microsoft publisher look file

342
00:11:21,440 --> 00:11:23,200
looks like

343
00:11:23,200 --> 00:11:25,279
within the exif data and tells me it's

344
00:11:25,279 --> 00:11:26,880
microsoft publisher and i've got a

345
00:11:26,880 --> 00:11:27,680
version

346
00:11:27,680 --> 00:11:29,440
now there was an author in here and it

347
00:11:29,440 --> 00:11:31,839
didn't exactly say test fish but it was

348
00:11:31,839 --> 00:11:32,320
uh

349
00:11:32,320 --> 00:11:35,200
pretty darn close because what it was uh

350
00:11:35,200 --> 00:11:37,040
was our test fishing vendor

351
00:11:37,040 --> 00:11:39,920
and it led to that facepalm moment when

352
00:11:39,920 --> 00:11:41,519
you realized the email attachment you

353
00:11:41,519 --> 00:11:43,360
just spent three hours looking at

354
00:11:43,360 --> 00:11:44,959
actually came from your test fishing

355
00:11:44,959 --> 00:11:47,200
vendor

356
00:11:47,200 --> 00:11:48,800
we'll talk about what went wrong here

357
00:11:48,800 --> 00:11:50,399
but i didn't take that at face value

358
00:11:50,399 --> 00:11:52,240
because that stuff could be spoofed

359
00:11:52,240 --> 00:11:54,000
and actually i talked to a co-worker

360
00:11:54,000 --> 00:11:56,160
friend and we sort of debated on

361
00:11:56,160 --> 00:11:58,240
you know hey i wonder if so a threat

362
00:11:58,240 --> 00:12:00,639
actor has used a test fishing vendor and

363
00:12:00,639 --> 00:12:03,839
embedded that into uh exif data or

364
00:12:03,839 --> 00:12:05,360
metadata to try to fool

365
00:12:05,360 --> 00:12:07,920
people and lo and behold that actually

366
00:12:07,920 --> 00:12:09,760
did happen we actually did read about

367
00:12:09,760 --> 00:12:11,279
somebody doing that

368
00:12:11,279 --> 00:12:13,839
um not that long after we just sort of

369
00:12:13,839 --> 00:12:15,200
talked about it

370
00:12:15,200 --> 00:12:16,959
but i didn't trust what i saw so i went

371
00:12:16,959 --> 00:12:19,120
back and i looked at the email headers

372
00:12:19,120 --> 00:12:21,279
and uh they looked normal although what

373
00:12:21,279 --> 00:12:22,320
i read was

374
00:12:22,320 --> 00:12:24,320
yes this really did come from your test

375
00:12:24,320 --> 00:12:26,079
fishing vendor's ip address

376
00:12:26,079 --> 00:12:29,519
you're a so what went wrong

377
00:12:29,519 --> 00:12:31,600
is i really got caught up in the moment

378
00:12:31,600 --> 00:12:34,320
by subconsciously letting somebody else

379
00:12:34,320 --> 00:12:36,880
influence my investigation and their

380
00:12:36,880 --> 00:12:38,959
anxiety and bad assumptions wore

381
00:12:38,959 --> 00:12:41,120
off on me they swore this thing matches

382
00:12:41,120 --> 00:12:43,600
all the iocs from this flawed amy rat

383
00:12:43,600 --> 00:12:46,000
you know and that nikers botnet you know

384
00:12:46,000 --> 00:12:47,680
and they talk so much about the

385
00:12:47,680 --> 00:12:49,360
attachment and so passionately about it

386
00:12:49,360 --> 00:12:51,279
that i sort of forgot my own processes

387
00:12:51,279 --> 00:12:52,639
and procedures

388
00:12:52,639 --> 00:12:54,160
which normally when i look at anything

389
00:12:54,160 --> 00:12:55,680
email related i always start with the

390
00:12:55,680 --> 00:12:57,040
message headers

391
00:12:57,040 --> 00:12:59,200
to know where it came from in fact at

392
00:12:59,200 --> 00:13:00,399
besides cleveland

393
00:13:00,399 --> 00:13:02,720
i gave one of many places i gave a talk

394
00:13:02,720 --> 00:13:04,240
called fishing forensics is it just

395
00:13:04,240 --> 00:13:06,160
suspicious or is it malicious

396
00:13:06,160 --> 00:13:07,920
and i always start with the headers the

397
00:13:07,920 --> 00:13:10,240
one time i don't it really came back to

398
00:13:10,240 --> 00:13:12,639
bite me

399
00:13:12,639 --> 00:13:14,880
so the road to redemption here since i

400
00:13:14,880 --> 00:13:16,560
verified it did come from our test

401
00:13:16,560 --> 00:13:17,519
fishing vendor

402
00:13:17,519 --> 00:13:19,680
um you know it was just a painful lesson

403
00:13:19,680 --> 00:13:21,279
just to stick to my standard

404
00:13:21,279 --> 00:13:23,600
investigative processes and procedures

405
00:13:23,600 --> 00:13:26,160
and not deviate from that uh if i had

406
00:13:26,160 --> 00:13:28,160
started my investigation by inspecting

407
00:13:28,160 --> 00:13:29,760
the message headers first i could have

408
00:13:29,760 --> 00:13:31,440
just closed this out in minutes instead

409
00:13:31,440 --> 00:13:31,920
of

410
00:13:31,920 --> 00:13:34,000
spending you know a few hours looking at

411
00:13:34,000 --> 00:13:35,279
this and

412
00:13:35,279 --> 00:13:38,079
because it was you know essentially a

413
00:13:38,079 --> 00:13:39,760
situation we were comfortable with we

414
00:13:39,760 --> 00:13:40,480
didn't require

415
00:13:40,480 --> 00:13:44,160
any further technical actions on that

416
00:13:44,160 --> 00:13:46,639
my second scenario here is called

417
00:13:46,639 --> 00:13:47,760
security scanner

418
00:13:47,760 --> 00:13:50,959
evasion and

419
00:13:50,959 --> 00:13:52,560
what happened here is we had identical

420
00:13:52,560 --> 00:13:54,959
fishing males start hitting inboxes and

421
00:13:54,959 --> 00:13:56,800
we're getting wide scale reports to the

422
00:13:56,800 --> 00:13:58,079
security team

423
00:13:58,079 --> 00:14:00,399
of fishing this phishing message coming

424
00:14:00,399 --> 00:14:01,680
through

425
00:14:01,680 --> 00:14:04,240
and the page link in our security tools

426
00:14:04,240 --> 00:14:05,040
that we use

427
00:14:05,040 --> 00:14:07,440
it looked like it was down so you know

428
00:14:07,440 --> 00:14:09,760
it sort of becomes ways is the site

429
00:14:09,760 --> 00:14:12,000
down if the site's no longer internet

430
00:14:12,000 --> 00:14:12,880
accessible

431
00:14:12,880 --> 00:14:14,160
you know maybe we don't really have to

432
00:14:14,160 --> 00:14:16,079
spend a whole lot of time worrying about

433
00:14:16,079 --> 00:14:18,639
this but this is really about finding

434
00:14:18,639 --> 00:14:19,839
out what happened

435
00:14:19,839 --> 00:14:22,480
and getting to the bottom of that so

436
00:14:22,480 --> 00:14:23,600
we're going to do is we're going to look

437
00:14:23,600 --> 00:14:25,680
at the email message source code

438
00:14:25,680 --> 00:14:27,680
we're going to note any hyperlinks and

439
00:14:27,680 --> 00:14:28,880
then we're going to check the landing

440
00:14:28,880 --> 00:14:30,000
page with our

441
00:14:30,000 --> 00:14:32,560
and off to do a pretend uh security

442
00:14:32,560 --> 00:14:34,320
scanner here

443
00:14:34,320 --> 00:14:37,440
since i don't really have one

444
00:14:37,440 --> 00:14:38,880
we'll look at the landing page source

445
00:14:38,880 --> 00:14:40,320
code and then we'll open the fishing

446
00:14:40,320 --> 00:14:42,160
page in a sandbox

447
00:14:42,160 --> 00:14:44,560
just to see what it looked like so let's

448
00:14:44,560 --> 00:14:46,720
go ahead and do those things

449
00:14:46,720 --> 00:14:50,240
let me go ahead and open up the email

450
00:14:50,240 --> 00:14:50,880
here

451
00:14:50,880 --> 00:14:58,160
and clear this out

452
00:14:58,160 --> 00:15:01,040
and i'll make this bit bigger so it's

453
00:15:01,040 --> 00:15:02,079
maybe people can see

454
00:15:02,079 --> 00:15:04,480
some of it at least uh now the top line

455
00:15:04,480 --> 00:15:05,680
you're not going to see this i

456
00:15:05,680 --> 00:15:08,079
you know this is a demo so i made some

457
00:15:08,079 --> 00:15:08,720
of the stuff

458
00:15:08,720 --> 00:15:12,240
up but i've got uh from evil.scammer

459
00:15:12,240 --> 00:15:15,680
promise we are legit.com and a subject

460
00:15:15,680 --> 00:15:16,160
of

461
00:15:16,160 --> 00:15:19,279
this link is totally safe

462
00:15:19,279 --> 00:15:21,320
and it's to phishing target which is

463
00:15:21,320 --> 00:15:23,320
unwitting.victim

464
00:15:23,320 --> 00:15:26,320
randomtarget.org and this is

465
00:15:26,320 --> 00:15:27,839
pretty representative of some bad

466
00:15:27,839 --> 00:15:29,600
fishing emails that still

467
00:15:29,600 --> 00:15:31,839
fools people uh saying hello fishing

468
00:15:31,839 --> 00:15:33,440
target we have a really important

469
00:15:33,440 --> 00:15:34,480
message for you

470
00:15:34,480 --> 00:15:36,959
to retrieve your message click here and

471
00:15:36,959 --> 00:15:38,399
that's not real subtle

472
00:15:38,399 --> 00:15:41,279
uh regards spoof sender but what's

473
00:15:41,279 --> 00:15:43,279
surprising is these over-the-top things

474
00:15:43,279 --> 00:15:43,600
they

475
00:15:43,600 --> 00:15:46,000
still sometimes work so let's go ahead

476
00:15:46,000 --> 00:15:47,360
and just take a look at the message

477
00:15:47,360 --> 00:15:50,320
source code here

478
00:15:51,120 --> 00:15:53,199
and we'll take a look at that hyperlink

479
00:15:53,199 --> 00:15:55,279
i don't actually like to

480
00:15:55,279 --> 00:15:58,480
mouse over and on hyperlinks

481
00:15:58,480 --> 00:16:00,959
uh just because i don't always trust

482
00:16:00,959 --> 00:16:02,240
that things aren't going to execute

483
00:16:02,240 --> 00:16:04,320
javascript

484
00:16:04,320 --> 00:16:07,440
on mouseover you know on hover type of

485
00:16:07,440 --> 00:16:08,160
things

486
00:16:08,160 --> 00:16:11,360
uh and execute something um so i tend to

487
00:16:11,360 --> 00:16:12,480
be a little cautious

488
00:16:12,480 --> 00:16:15,040
but if i open up the message source code

489
00:16:15,040 --> 00:16:15,519
and

490
00:16:15,519 --> 00:16:19,600
i look for and it's not going to come up

491
00:16:19,600 --> 00:16:21,680
here why not

492
00:16:21,680 --> 00:16:24,480
so i'm gonna do a find and oh it's down

493
00:16:24,480 --> 00:16:26,399
here in the lower that's why

494
00:16:26,399 --> 00:16:29,519
and i'm just gonna look for http and so

495
00:16:29,519 --> 00:16:32,480
sure enough here's our click here link

496
00:16:32,480 --> 00:16:34,480
and we see where this is actually

497
00:16:34,480 --> 00:16:37,199
going and so here's where i'm going to

498
00:16:37,199 --> 00:16:37,920
emulate

499
00:16:37,920 --> 00:16:39,839
looking at this in a security scanner

500
00:16:39,839 --> 00:16:42,720
tool just to do some quick analysis on

501
00:16:42,720 --> 00:16:44,959
that

502
00:16:45,199 --> 00:16:46,800
go ahead and put that address into the

503
00:16:46,800 --> 00:16:48,480
browser that i copied out of the source

504
00:16:48,480 --> 00:16:49,120
code

505
00:16:49,120 --> 00:16:51,199
and what we get here is a very generic

506
00:16:51,199 --> 00:16:52,720
404 page

507
00:16:52,720 --> 00:16:54,800
this looks like hey this thing is no

508
00:16:54,800 --> 00:16:55,759
longer

509
00:16:55,759 --> 00:16:57,759
there it looks like the page is taken

510
00:16:57,759 --> 00:16:59,120
down so

511
00:16:59,120 --> 00:17:00,560
maybe this is something we don't need to

512
00:17:00,560 --> 00:17:02,480
worry about too much

513
00:17:02,480 --> 00:17:05,520
but maybe it is so we have the link but

514
00:17:05,520 --> 00:17:07,199
let's go ahead and pull down the source

515
00:17:07,199 --> 00:17:08,400
code for the file

516
00:17:08,400 --> 00:17:10,160
and there's a number of ways you can do

517
00:17:10,160 --> 00:17:12,640
that uh some of the tools that uh

518
00:17:12,640 --> 00:17:16,160
you know i like to use are curl and

519
00:17:16,160 --> 00:17:18,880
we'll go ahead and paste that in here

520
00:17:18,880 --> 00:17:20,640
and then i'm going to output that to a

521
00:17:20,640 --> 00:17:22,880
file

522
00:17:22,880 --> 00:17:26,720
and i'll just call it unknown dot txt

523
00:17:26,720 --> 00:17:32,960
or i'm sorry htm html and then

524
00:17:32,960 --> 00:17:35,520
um another tool i can use is wget i can

525
00:17:35,520 --> 00:17:37,679
also w get that same address

526
00:17:37,679 --> 00:17:39,360
and it'll go ahead and pull down the

527
00:17:39,360 --> 00:17:41,840
source code for that file

528
00:17:41,840 --> 00:17:45,120
so now if i do an lsl and

529
00:17:45,120 --> 00:17:48,400
uh look for html files

530
00:17:48,400 --> 00:17:52,000
oops did i mess something up

531
00:17:52,700 --> 00:17:55,039
[Music]

532
00:17:55,039 --> 00:17:57,360
ah okay hold on let me just see what i

533
00:17:57,360 --> 00:18:01,760
got here

534
00:18:01,760 --> 00:18:04,559
oh yeah okay

535
00:18:10,640 --> 00:18:15,360
all right now

536
00:18:15,360 --> 00:18:17,919
all right so what we have here and since

537
00:18:17,919 --> 00:18:18,720
this is a

538
00:18:18,720 --> 00:18:21,360
localized demo uh you might notice that

539
00:18:21,360 --> 00:18:22,160
one has

540
00:18:22,160 --> 00:18:25,679
a a different date

541
00:18:25,679 --> 00:18:28,400
time stamp from today in real life these

542
00:18:28,400 --> 00:18:28,880
would

543
00:18:28,880 --> 00:18:30,480
be pretty close to matching when you

544
00:18:30,480 --> 00:18:32,160
executed the commands this is just

545
00:18:32,160 --> 00:18:34,000
simply an artifact of me retrieving the

546
00:18:34,000 --> 00:18:36,720
file off of the local file system

547
00:18:36,720 --> 00:18:39,520
but you notice the bite sizes match and

548
00:18:39,520 --> 00:18:41,360
we can also prove that forensically

549
00:18:41,360 --> 00:18:44,639
these are really the same

550
00:18:45,200 --> 00:18:48,559
same values so if i get the shaw 256

551
00:18:48,559 --> 00:18:49,200
value

552
00:18:49,200 --> 00:18:51,919
we have a exact match so it doesn't

553
00:18:51,919 --> 00:18:53,200
matter if you use curl

554
00:18:53,200 --> 00:18:55,200
w get or something else we know

555
00:18:55,200 --> 00:18:57,280
forensically this is the same file

556
00:18:57,280 --> 00:18:59,840
so this is something we can look at we

557
00:18:59,840 --> 00:19:00,799
can clear that

558
00:19:00,799 --> 00:19:11,840
and we'll pull this up in a text editor

559
00:19:14,320 --> 00:19:16,720
make this bigger so it's somewhat more

560
00:19:16,720 --> 00:19:19,200
readable

561
00:19:20,160 --> 00:19:22,400
in this case what we have is basically a

562
00:19:22,400 --> 00:19:24,799
javascript file and what you'll notice

563
00:19:24,799 --> 00:19:25,360
is

564
00:19:25,360 --> 00:19:26,880
really in the first line of the actual

565
00:19:26,880 --> 00:19:29,120
script it's looking at the user agent

566
00:19:29,120 --> 00:19:32,160
it's looking for chrome in there

567
00:19:32,160 --> 00:19:35,039
or the next stanza goes to edge

568
00:19:35,039 --> 00:19:36,720
microsoft edge

569
00:19:36,720 --> 00:19:41,039
firefox msie opera safari

570
00:19:41,039 --> 00:19:42,640
what's interesting though is at the very

571
00:19:42,640 --> 00:19:45,200
end uh is basically a final else

572
00:19:45,200 --> 00:19:48,320
statement and if it doesn't match one of

573
00:19:48,320 --> 00:19:49,840
these things what it's doing is it's

574
00:19:49,840 --> 00:19:52,240
sending it to the fake 404 page

575
00:19:52,240 --> 00:19:54,880
so this is meant to defeat security

576
00:19:54,880 --> 00:19:55,600
tools

577
00:19:55,600 --> 00:19:57,360
because unless they're submitting like a

578
00:19:57,360 --> 00:19:59,120
real browser

579
00:19:59,120 --> 00:20:02,159
user agent string to the server

580
00:20:02,159 --> 00:20:04,960
it's basically purposely directing that

581
00:20:04,960 --> 00:20:05,600
traffic

582
00:20:05,600 --> 00:20:08,799
to a different page

583
00:20:08,799 --> 00:20:11,200
and so this also tells me that this page

584
00:20:11,200 --> 00:20:13,200
is very much alive and well

585
00:20:13,200 --> 00:20:16,559
and sure enough if we want to take a

586
00:20:16,559 --> 00:20:17,280
look at that

587
00:20:17,280 --> 00:20:20,799
in our pretend sandbox what we see

588
00:20:20,799 --> 00:20:23,919
is a you know basically a fake microsoft

589
00:20:23,919 --> 00:20:24,480
office

590
00:20:24,480 --> 00:20:29,280
365 i guess now microsoft 365 login page

591
00:20:29,280 --> 00:20:31,600
and so this helps the threat actors

592
00:20:31,600 --> 00:20:33,120
ensure that real traffic

593
00:20:33,120 --> 00:20:35,440
real browsers real users are the ones

594
00:20:35,440 --> 00:20:37,760
getting to this page as much as they can

595
00:20:37,760 --> 00:20:40,960
so kind of sneaky really and also pretty

596
00:20:40,960 --> 00:20:45,840
intelligent to avoid getting caught

597
00:20:45,840 --> 00:20:48,000
so just some thoughts on that is we

598
00:20:48,000 --> 00:20:50,240
talked about how the evasion code works

599
00:20:50,240 --> 00:20:52,320
uh using the browser user agent string

600
00:20:52,320 --> 00:20:53,919
based redirection

601
00:20:53,919 --> 00:20:55,600
uh in this case i got really lucky

602
00:20:55,600 --> 00:20:57,440
because it was done in javascript

603
00:20:57,440 --> 00:20:59,200
now if this had been done in a server

604
00:20:59,200 --> 00:21:01,280
side language you know

605
00:21:01,280 --> 00:21:04,080
like anything from asp to ruby you know

606
00:21:04,080 --> 00:21:04,720
php

607
00:21:04,720 --> 00:21:07,360
python you name it um i never would have

608
00:21:07,360 --> 00:21:08,640
been able to pull the code

609
00:21:08,640 --> 00:21:09,919
i would have been able to tell the

610
00:21:09,919 --> 00:21:11,840
redirect was happening but

611
00:21:11,840 --> 00:21:13,760
i wouldn't necessarily know why so in

612
00:21:13,760 --> 00:21:14,960
this case i got really

613
00:21:14,960 --> 00:21:18,400
lucky some other notes about this

614
00:21:18,400 --> 00:21:20,559
is think about this if the threat actors

615
00:21:20,559 --> 00:21:21,600
had a

616
00:21:21,600 --> 00:21:23,600
specific browser exploit that only

617
00:21:23,600 --> 00:21:25,440
worked against just firefox as an

618
00:21:25,440 --> 00:21:26,720
example

619
00:21:26,720 --> 00:21:30,000
they could target through round robin

620
00:21:30,000 --> 00:21:32,480
checking to see if firefox users are

621
00:21:32,480 --> 00:21:33,679
visiting the site

622
00:21:33,679 --> 00:21:35,600
uh basically dump them off at the

623
00:21:35,600 --> 00:21:36,799
malware page

624
00:21:36,799 --> 00:21:39,360
and then send them over to the real page

625
00:21:39,360 --> 00:21:41,679
after the code is executed

626
00:21:41,679 --> 00:21:43,120
and they can make a very targeted

627
00:21:43,120 --> 00:21:45,039
approach with that and

628
00:21:45,039 --> 00:21:46,720
digging a little further if they know

629
00:21:46,720 --> 00:21:49,039
only specific versions of firefox are

630
00:21:49,039 --> 00:21:49,919
vulnerable

631
00:21:49,919 --> 00:21:52,320
they could absolutely check for those

632
00:21:52,320 --> 00:21:54,400
specific vulnerable versions

633
00:21:54,400 --> 00:21:55,760
this makes this kind of thing really

634
00:21:55,760 --> 00:21:58,320
hard to detect and find

635
00:21:58,320 --> 00:22:00,159
because if you don't get it right then

636
00:22:00,159 --> 00:22:02,240
you're basically being sent off to

637
00:22:02,240 --> 00:22:04,720
somewhere else in this case you know

638
00:22:04,720 --> 00:22:06,000
we're able to figure it out

639
00:22:06,000 --> 00:22:08,159
a little bit of luck there and honestly

640
00:22:08,159 --> 00:22:09,200
i've seen

641
00:22:09,200 --> 00:22:10,880
there's a lot of ways you can redirect

642
00:22:10,880 --> 00:22:12,480
browser traffic but i

643
00:22:12,480 --> 00:22:14,240
think i may have seen that sort of an

644
00:22:14,240 --> 00:22:16,080
action before

645
00:22:16,080 --> 00:22:18,640
so anyway the remediation plan in this

646
00:22:18,640 --> 00:22:20,320
case was we determined the actual

647
00:22:20,320 --> 00:22:21,840
phishing landing page

648
00:22:21,840 --> 00:22:23,360
and we blocked it through web content

649
00:22:23,360 --> 00:22:25,919
filtering then we worked with our secure

650
00:22:25,919 --> 00:22:27,120
email gateway vendor

651
00:22:27,120 --> 00:22:30,000
to block the active phishing campaign

652
00:22:30,000 --> 00:22:31,360
and that was uh you know

653
00:22:31,360 --> 00:22:33,440
just an example of security scanner

654
00:22:33,440 --> 00:22:36,320
evasion that i've seen in the wild

655
00:22:36,320 --> 00:22:38,240
the third scenario i call the rabbit

656
00:22:38,240 --> 00:22:39,440
hole

657
00:22:39,440 --> 00:22:41,039
and the premise of this is that i

658
00:22:41,039 --> 00:22:42,720
received a request from a user to

659
00:22:42,720 --> 00:22:43,600
investigate an

660
00:22:43,600 --> 00:22:46,320
email message to determine if it was

661
00:22:46,320 --> 00:22:47,679
legitimate or not

662
00:22:47,679 --> 00:22:49,679
and so the email looked fishy at first

663
00:22:49,679 --> 00:22:52,320
glance but was it suspicious or was it

664
00:22:52,320 --> 00:22:52,799
just

665
00:22:52,799 --> 00:22:55,360
or was that actually malicious so that's

666
00:22:55,360 --> 00:22:57,440
the question i'm trying to answer here

667
00:22:57,440 --> 00:22:59,120
i can tell from the message headers that

668
00:22:59,120 --> 00:23:01,360
the source ip address was a mismatch for

669
00:23:01,360 --> 00:23:02,960
the sender's domain

670
00:23:02,960 --> 00:23:05,919
so right there's a quick red flag the

671
00:23:05,919 --> 00:23:07,280
email message source code was

672
00:23:07,280 --> 00:23:09,039
particularly interesting

673
00:23:09,039 --> 00:23:10,880
in particular we'll take a look at this

674
00:23:10,880 --> 00:23:12,480
but what you'll see is the link text

675
00:23:12,480 --> 00:23:14,320
doesn't match where the actual hyperlink

676
00:23:14,320 --> 00:23:15,360
goes

677
00:23:15,360 --> 00:23:16,720
and then the malicious thread actors

678
00:23:16,720 --> 00:23:18,640
objective appears to be credential

679
00:23:18,640 --> 00:23:20,640
harvesting for the purposes of account

680
00:23:20,640 --> 00:23:21,600
takeover

681
00:23:21,600 --> 00:23:23,120
so let's take a look at some of that

682
00:23:23,120 --> 00:23:27,840
i'll open up the example message here

683
00:23:33,520 --> 00:23:35,919
and the top line the from is paypal

684
00:23:35,919 --> 00:23:36,559
support

685
00:23:36,559 --> 00:23:39,880
but the address is ppsupport at

686
00:23:39,880 --> 00:23:41,279
pwndashserver.org

687
00:23:41,279 --> 00:23:43,279
so we know that's not a paypal domain

688
00:23:43,279 --> 00:23:45,200
certainly

689
00:23:45,200 --> 00:23:48,240
the subject is paypal account change

690
00:23:48,240 --> 00:23:50,320
confirmation now if i have a paypal

691
00:23:50,320 --> 00:23:51,440
account

692
00:23:51,440 --> 00:23:53,520
particularly if i'm an average user and

693
00:23:53,520 --> 00:23:55,120
i see something like this going well i

694
00:23:55,120 --> 00:23:56,880
didn't make any changes to my account

695
00:23:56,880 --> 00:23:58,480
what's going on here like that's going

696
00:23:58,480 --> 00:24:00,080
to be an attention getter

697
00:24:00,080 --> 00:24:02,240
and so the way the bait works in this

698
00:24:02,240 --> 00:24:04,320
type of a phishing email is you know we

699
00:24:04,320 --> 00:24:05,919
received a request update your bank

700
00:24:05,919 --> 00:24:06,960
account on file

701
00:24:06,960 --> 00:24:08,640
this process will complete in the next

702
00:24:08,640 --> 00:24:10,880
four hours if you didn't request these

703
00:24:10,880 --> 00:24:12,240
changes to your account

704
00:24:12,240 --> 00:24:13,840
please log in and reject the pending

705
00:24:13,840 --> 00:24:16,000
activity now this is going to create a

706
00:24:16,000 --> 00:24:17,600
sense of urgency in the average user

707
00:24:17,600 --> 00:24:19,200
thinking oh man not only did i not make

708
00:24:19,200 --> 00:24:20,080
the change

709
00:24:20,080 --> 00:24:21,919
i've only got four hours to make sure

710
00:24:21,919 --> 00:24:24,320
that this doesn't really happen

711
00:24:24,320 --> 00:24:27,279
and basically prevent you so i think i'm

712
00:24:27,279 --> 00:24:28,880
being proactive and preventing getting

713
00:24:28,880 --> 00:24:29,840
scammed

714
00:24:29,840 --> 00:24:32,159
the reality is we see a paypal link and

715
00:24:32,159 --> 00:24:34,320
of course this is a real paypal login

716
00:24:34,320 --> 00:24:35,200
link so

717
00:24:35,200 --> 00:24:36,960
it looks legit just looking at the

718
00:24:36,960 --> 00:24:38,559
message but of course

719
00:24:38,559 --> 00:24:41,120
if we look at the message headers we're

720
00:24:41,120 --> 00:24:42,960
going to find out pretty quick

721
00:24:42,960 --> 00:24:46,320
that that's maybe not the case let me go

722
00:24:46,320 --> 00:24:48,960
into the message source for this one

723
00:24:48,960 --> 00:24:52,320
and make this a bit bigger

724
00:24:52,960 --> 00:24:56,000
and i'm going to search for http

725
00:24:56,000 --> 00:24:59,200
and so here what we have at the end is

726
00:24:59,200 --> 00:25:01,520
you know the link we see in the raw in

727
00:25:01,520 --> 00:25:02,720
the email itself

728
00:25:02,720 --> 00:25:04,559
you know we've got a legit paypal

729
00:25:04,559 --> 00:25:06,799
address but the

730
00:25:06,799 --> 00:25:11,039
reference is going to um a site in

731
00:25:11,039 --> 00:25:14,240
be domain which is a belgium

732
00:25:14,240 --> 00:25:17,600
domain and definitely enough

733
00:25:17,600 --> 00:25:19,760
you know parameters after that would

734
00:25:19,760 --> 00:25:21,520
tell anybody this is definitely not a

735
00:25:21,520 --> 00:25:23,360
real paypal account

736
00:25:23,360 --> 00:25:24,799
so what happens when we look at this in

737
00:25:24,799 --> 00:25:26,720
our sandbox to see what this thing looks

738
00:25:26,720 --> 00:25:27,360
like

739
00:25:27,360 --> 00:25:29,840
i'll go and paste it in here certainly

740
00:25:29,840 --> 00:25:32,720
looks like a paypal login right

741
00:25:32,720 --> 00:25:34,880
nothing nothing too crazy there but of

742
00:25:34,880 --> 00:25:36,640
course we already know

743
00:25:36,640 --> 00:25:38,559
just from our analysis up to this point

744
00:25:38,559 --> 00:25:39,840
there's no way this is going to be a

745
00:25:39,840 --> 00:25:41,279
legit paypal

746
00:25:41,279 --> 00:25:43,840
account so using the same technique we

747
00:25:43,840 --> 00:25:44,880
did before

748
00:25:44,880 --> 00:25:48,960
let's go ahead and get the

749
00:25:49,200 --> 00:25:50,480
origin web file and see if we can

750
00:25:50,480 --> 00:25:52,720
understand what's going on here

751
00:25:52,720 --> 00:25:54,320
so i'm going to output this to something

752
00:25:54,320 --> 00:25:57,200
called first page

753
00:25:57,200 --> 00:26:00,080
that html

754
00:26:00,720 --> 00:26:02,240
we have it and let's go and take a look

755
00:26:02,240 --> 00:26:11,840
at that

756
00:26:12,240 --> 00:26:15,840
i'm trying to make this bigger here

757
00:26:19,279 --> 00:26:22,799
yeah well hopefully i'll try to

758
00:26:22,799 --> 00:26:24,640
explain it as best i can what's going on

759
00:26:24,640 --> 00:26:27,200
here so what we notice is a very small

760
00:26:27,200 --> 00:26:27,679
page

761
00:26:27,679 --> 00:26:29,120
like not something we would expect to

762
00:26:29,120 --> 00:26:31,039
see when we're visiting a website

763
00:26:31,039 --> 00:26:33,200
uh but what's interesting here up at the

764
00:26:33,200 --> 00:26:35,360
top is we have an http

765
00:26:35,360 --> 00:26:38,559
meta refresh and content equals zero

766
00:26:38,559 --> 00:26:40,080
means zero seconds it's going to

767
00:26:40,080 --> 00:26:42,480
instantaneously redirect

768
00:26:42,480 --> 00:26:45,360
browser traffic to a different web

769
00:26:45,360 --> 00:26:46,320
address

770
00:26:46,320 --> 00:26:48,559
not only is it a different web address

771
00:26:48,559 --> 00:26:49,760
dot d e

772
00:26:49,760 --> 00:26:53,520
now we're going from belgium to a german

773
00:26:53,520 --> 00:26:56,559
domain so this is definitely looking

774
00:26:56,559 --> 00:26:59,120
sketchy and it's very interesting that

775
00:26:59,120 --> 00:27:00,960
uh you know they chose to

776
00:27:00,960 --> 00:27:03,440
have a stub page before the actual

777
00:27:03,440 --> 00:27:05,039
landing page

778
00:27:05,039 --> 00:27:08,000
and in my investigation i found there

779
00:27:08,000 --> 00:27:08,799
actually

780
00:27:08,799 --> 00:27:10,880
several different domains where they had

781
00:27:10,880 --> 00:27:12,559
that initial page

782
00:27:12,559 --> 00:27:14,960
in case they got taken down that some of

783
00:27:14,960 --> 00:27:16,799
their

784
00:27:16,799 --> 00:27:19,279
you know phishing messages would still

785
00:27:19,279 --> 00:27:20,960
kind of get through

786
00:27:20,960 --> 00:27:22,880
so let's understand what's going on here

787
00:27:22,880 --> 00:27:25,120
and determine is this really where we're

788
00:27:25,120 --> 00:27:25,840
going

789
00:27:25,840 --> 00:27:27,440
and we're going to do you know really

790
00:27:27,440 --> 00:27:30,080
what we did before

791
00:27:30,080 --> 00:27:32,399
which is look at the source code to

792
00:27:32,399 --> 00:27:34,159
understand where this one's going

793
00:27:34,159 --> 00:27:36,080
and again we know it's now traversing

794
00:27:36,080 --> 00:27:39,199
into another country

795
00:27:42,320 --> 00:27:44,320
all right so i got my second destination

796
00:27:44,320 --> 00:27:45,919
here and then we'll

797
00:27:45,919 --> 00:27:51,360
go ahead and output that to second page

798
00:27:51,360 --> 00:27:53,918
html

799
00:27:55,039 --> 00:27:58,559
oops and then we will go ahead

800
00:27:58,559 --> 00:28:02,640
and open that up in g edit

801
00:28:02,640 --> 00:28:05,600
so i can show it

802
00:28:12,320 --> 00:28:14,480
and so what's interesting here is we

803
00:28:14,480 --> 00:28:16,000
have a page title log into your

804
00:28:16,000 --> 00:28:18,080
paypal account but again very short page

805
00:28:18,080 --> 00:28:20,080
not what we would expect to see

806
00:28:20,080 --> 00:28:21,840
if we were actually where this traffic

807
00:28:21,840 --> 00:28:23,919
is going and what we see

808
00:28:23,919 --> 00:28:27,279
here is we have an iframe and

809
00:28:27,279 --> 00:28:29,600
in that iframe is the source going to

810
00:28:29,600 --> 00:28:31,039
yet another

811
00:28:31,039 --> 00:28:34,159
page and this one's nl so now we've gone

812
00:28:34,159 --> 00:28:35,840
from belgium to germany

813
00:28:35,840 --> 00:28:39,760
to the netherlands and

814
00:28:39,760 --> 00:28:41,840
it's really a seamless iframe when you

815
00:28:41,840 --> 00:28:43,039
look at the top you got

816
00:28:43,039 --> 00:28:45,840
no margin no padding everything is kind

817
00:28:45,840 --> 00:28:46,399
of hidden

818
00:28:46,399 --> 00:28:48,320
so this is really very much a seamless

819
00:28:48,320 --> 00:28:50,559
iframe somebody visiting this page

820
00:28:50,559 --> 00:28:52,399
they're getting served up another page

821
00:28:52,399 --> 00:28:54,799
than the one they're actually visiting

822
00:28:54,799 --> 00:28:56,720
so again it's another sneaky technique

823
00:28:56,720 --> 00:28:58,320
that the threat actors are using

824
00:28:58,320 --> 00:29:01,360
to you know hide where their actual

825
00:29:01,360 --> 00:29:03,679
landing page is and then also just to

826
00:29:03,679 --> 00:29:04,880
make it harder to

827
00:29:04,880 --> 00:29:08,000
to stop and detect where it's going uh

828
00:29:08,000 --> 00:29:11,440
if we blocked this secondary page alone

829
00:29:11,440 --> 00:29:13,600
uh the sec or the secondary domain alone

830
00:29:13,600 --> 00:29:15,039
we still wouldn't have

831
00:29:15,039 --> 00:29:16,960
uh everything if they were using

832
00:29:16,960 --> 00:29:18,640
multiple domains to do this sort of

833
00:29:18,640 --> 00:29:20,080
thing in one sort of

834
00:29:20,080 --> 00:29:23,440
landing page of truth so now that we

835
00:29:23,440 --> 00:29:24,000
know

836
00:29:24,000 --> 00:29:26,640
that the page is going yet somewhere

837
00:29:26,640 --> 00:29:27,279
else

838
00:29:27,279 --> 00:29:28,640
let's take a look at this third

839
00:29:28,640 --> 00:29:31,440
destination and see what's going on here

840
00:29:31,440 --> 00:29:33,760
and we'll just again kind of go back and

841
00:29:33,760 --> 00:29:34,799
get the

842
00:29:34,799 --> 00:29:37,039
source for that pretty much the same way

843
00:29:37,039 --> 00:29:39,760
we have been doing

844
00:29:39,760 --> 00:29:43,440
i will curl that address

845
00:29:44,720 --> 00:29:48,399
i'll put that to third page

846
00:29:52,840 --> 00:29:54,159
html

847
00:29:54,159 --> 00:29:56,799
and what do we get uh a bunch of goblin

848
00:29:56,799 --> 00:29:57,679


849
00:29:57,679 --> 00:30:00,720
um very strange and what we can tell and

850
00:30:00,720 --> 00:30:02,320
now i purposely

851
00:30:02,320 --> 00:30:03,840
put in white space here to make this

852
00:30:03,840 --> 00:30:05,679
more readable if you will and i know

853
00:30:05,679 --> 00:30:07,200
some of you are probably thinking that's

854
00:30:07,200 --> 00:30:08,240
readable

855
00:30:08,240 --> 00:30:11,200
not really but the white space you may

856
00:30:11,200 --> 00:30:12,480
not see in real life

857
00:30:12,480 --> 00:30:14,159
in real life they will just ram this

858
00:30:14,159 --> 00:30:15,760
stuff together it makes it a lot harder

859
00:30:15,760 --> 00:30:16,960
to read

860
00:30:16,960 --> 00:30:18,399
but the reason i put the white space in

861
00:30:18,399 --> 00:30:19,919
so you can see very clearly this is

862
00:30:19,919 --> 00:30:21,200
javascript

863
00:30:21,200 --> 00:30:23,120
you can see it's writing out an unescape

864
00:30:23,120 --> 00:30:25,039
sequence and then i'm just going to take

865
00:30:25,039 --> 00:30:26,960
an educated guess here that this

866
00:30:26,960 --> 00:30:30,000
df parenthesis is some sort of a

867
00:30:30,000 --> 00:30:31,279
function

868
00:30:31,279 --> 00:30:33,520
and i'm guessing on that and in the

869
00:30:33,520 --> 00:30:35,600
olden days what we would have to do

870
00:30:35,600 --> 00:30:37,440
is we would have to basically unescape

871
00:30:37,440 --> 00:30:39,279
that sequence above

872
00:30:39,279 --> 00:30:41,200
and then feed try feeding this function

873
00:30:41,200 --> 00:30:43,760
into it to basically interpret what we

874
00:30:43,760 --> 00:30:45,120
have

875
00:30:45,120 --> 00:30:48,000
fortunately now with modern browsers we

876
00:30:48,000 --> 00:30:50,240
have really good browser developer tools

877
00:30:50,240 --> 00:30:51,279
built in

878
00:30:51,279 --> 00:30:53,039
and the important thing to remember is

879
00:30:53,039 --> 00:30:54,640
no matter how heavily obfuscated

880
00:30:54,640 --> 00:30:56,640
something is when a browser is visiting

881
00:30:56,640 --> 00:30:57,200
it

882
00:30:57,200 --> 00:30:59,120
it has to be something that can be

883
00:30:59,120 --> 00:31:01,519
decoded for the browser to actually

884
00:31:01,519 --> 00:31:02,080
render

885
00:31:02,080 --> 00:31:03,760
otherwise we would you know threat

886
00:31:03,760 --> 00:31:06,480
actors would just be wasting their time

887
00:31:06,480 --> 00:31:08,159
so let's go ahead and do that i'm going

888
00:31:08,159 --> 00:31:10,640
to go ahead and

889
00:31:10,640 --> 00:31:19,120
fire up our developer tools

890
00:31:19,120 --> 00:31:21,279
make sure i'm set up where i want yeah

891
00:31:21,279 --> 00:31:23,039
that looks good

892
00:31:23,039 --> 00:31:24,880
all right so what i'm going to do is i'm

893
00:31:24,880 --> 00:31:26,399
going to put in the

894
00:31:26,399 --> 00:31:29,360
address from our you know third landing

895
00:31:29,360 --> 00:31:29,760
page

896
00:31:29,760 --> 00:31:31,440
not the address that was in here because

897
00:31:31,440 --> 00:31:33,600
remember this third page is hidden in an

898
00:31:33,600 --> 00:31:37,039
iframe a seamless iframe

899
00:31:37,039 --> 00:31:39,440
now if i come back into our developer

900
00:31:39,440 --> 00:31:41,279
tools

901
00:31:41,279 --> 00:31:44,880
i should be able to see some stuff

902
00:31:45,200 --> 00:31:48,240
you know it makes this bigger um and

903
00:31:48,240 --> 00:31:49,919
you know with the screen it's still

904
00:31:49,919 --> 00:31:51,360
going to be kind of a bit of an eye

905
00:31:51,360 --> 00:31:53,760
chart so

906
00:31:53,760 --> 00:31:55,360
unfortunately there's not much we can do

907
00:31:55,360 --> 00:31:57,039
about that in the demo

908
00:31:57,039 --> 00:31:59,519
but if i click on the ellipses here for

909
00:31:59,519 --> 00:32:00,399
the body

910
00:32:00,399 --> 00:32:02,399
because we really have very little html

911
00:32:02,399 --> 00:32:03,600
to actually look at

912
00:32:03,600 --> 00:32:05,760
but if i click on the ellipses and i go

913
00:32:05,760 --> 00:32:07,120
into edit

914
00:32:07,120 --> 00:32:11,440
as html now i got some stuff i can read

915
00:32:11,440 --> 00:32:15,440
um although you know again here's our

916
00:32:15,440 --> 00:32:18,480
our basic obfuscated code

917
00:32:18,480 --> 00:32:21,760
but if i keep going now i get into

918
00:32:21,760 --> 00:32:24,880
uh the real html and some of the things

919
00:32:24,880 --> 00:32:27,200
to look at in the source

920
00:32:27,200 --> 00:32:30,080
are if i

921
00:32:30,240 --> 00:32:33,120
look at this so i may not understand

922
00:32:33,120 --> 00:32:34,480
what this blob

923
00:32:34,480 --> 00:32:37,279
is right here right now but looking at

924
00:32:37,279 --> 00:32:38,159
the

925
00:32:38,159 --> 00:32:42,000
um stuff that we have the

926
00:32:42,000 --> 00:32:45,279
mime type up at the top data image jpeg

927
00:32:45,279 --> 00:32:48,240
base64 is a very good clue that this is

928
00:32:48,240 --> 00:32:49,919
a base64

929
00:32:49,919 --> 00:32:53,519
encoded jpeg image file and again if we

930
00:32:53,519 --> 00:32:55,440
sort of look through the page

931
00:32:55,440 --> 00:32:58,720
we'll see more html stuff we get to a

932
00:32:58,720 --> 00:33:00,480
point where

933
00:33:00,480 --> 00:33:03,679
we will oh

934
00:33:03,679 --> 00:33:05,279
and you know what that was the second

935
00:33:05,279 --> 00:33:08,399
thing my apologies um

936
00:33:08,399 --> 00:33:11,918
there's actually um

937
00:33:14,640 --> 00:33:25,840
another thing i'm not seeing here

938
00:33:27,919 --> 00:33:30,320
yeah i still caution the wind it comes

939
00:33:30,320 --> 00:33:31,919
back to bite me sometimes

940
00:33:31,919 --> 00:33:34,159
um but yeah what's really cool here is

941
00:33:34,159 --> 00:33:34,960
you can actually see

942
00:33:34,960 --> 00:33:38,640
then the decoded um escape sequence

943
00:33:38,640 --> 00:33:41,840
uh you can see you know

944
00:33:41,840 --> 00:33:45,200
well not in here all right this is

945
00:33:45,200 --> 00:33:48,720
making me look really bad

946
00:33:49,440 --> 00:33:52,960
ah here we go okay this is what i was

947
00:33:52,960 --> 00:33:54,480
looking for

948
00:33:54,480 --> 00:33:56,080
all right so here's all our encoded

949
00:33:56,080 --> 00:33:58,159
stuff

950
00:33:58,159 --> 00:34:01,200
we looked at the one for the image but

951
00:34:01,200 --> 00:34:02,720
what's interesting is there's actually

952
00:34:02,720 --> 00:34:04,559
more encoded stuff

953
00:34:04,559 --> 00:34:06,559
here so there's a something called you

954
00:34:06,559 --> 00:34:08,079
know shortcut icon

955
00:34:08,079 --> 00:34:11,040
uh the mime type here is data image and

956
00:34:11,040 --> 00:34:11,440
it's

957
00:34:11,440 --> 00:34:14,719
uh you know x icon base64

958
00:34:14,719 --> 00:34:17,040
so it makes me think this might be like

959
00:34:17,040 --> 00:34:18,000
a fav icon

960
00:34:18,000 --> 00:34:21,599
sort of thing and

961
00:34:21,599 --> 00:34:23,520
you know it definitely you know proves

962
00:34:23,520 --> 00:34:24,960
itself out here

963
00:34:24,960 --> 00:34:27,520
um so some of the things to try to

964
00:34:27,520 --> 00:34:28,320
understand

965
00:34:28,320 --> 00:34:30,239
you know what really are the is this

966
00:34:30,239 --> 00:34:31,679
encoded content

967
00:34:31,679 --> 00:34:33,839
uh we've figured out a much easier

968
00:34:33,839 --> 00:34:35,040
shortcut than

969
00:34:35,040 --> 00:34:37,359
basically unescaping that function uh

970
00:34:37,359 --> 00:34:40,000
just by using the browser tools

971
00:34:40,000 --> 00:34:43,440
but we you know want to

972
00:34:43,440 --> 00:34:44,879
look at these images and understand

973
00:34:44,879 --> 00:34:46,560
what's going on and again browser tools

974
00:34:46,560 --> 00:34:48,239
can really help us if we switch over to

975
00:34:48,239 --> 00:34:50,320
the network tab here in chrome

976
00:34:50,320 --> 00:34:53,520
um and then we look at uh you know all

977
00:34:53,520 --> 00:34:57,280
you know we've got our file stuff here

978
00:34:57,280 --> 00:35:00,079
if i switch over to img tab here at the

979
00:35:00,079 --> 00:35:00,640
top

980
00:35:00,640 --> 00:35:03,119
here's our one image and if i click on

981
00:35:03,119 --> 00:35:04,240
that

982
00:35:04,240 --> 00:35:06,560
you know again we get that same base64

983
00:35:06,560 --> 00:35:07,760
blob that we saw

984
00:35:07,760 --> 00:35:10,400
looking at the source what's really cool

985
00:35:10,400 --> 00:35:12,079
is you click over here on

986
00:35:12,079 --> 00:35:15,359
preview tab if i can move this out of my

987
00:35:15,359 --> 00:35:18,640
way here i might just have to

988
00:35:18,880 --> 00:35:21,119
adjust my zoom and sure enough here's

989
00:35:21,119 --> 00:35:22,800
paypal right if you remember

990
00:35:22,800 --> 00:35:24,800
when we go back to the landing page

991
00:35:24,800 --> 00:35:26,079
there's that image file

992
00:35:26,079 --> 00:35:28,160
it's right there uh and it's sort of

993
00:35:28,160 --> 00:35:29,599
interesting to me that they

994
00:35:29,599 --> 00:35:32,560
encoded that inside of there but if you

995
00:35:32,560 --> 00:35:34,400
remember there was also something else

996
00:35:34,400 --> 00:35:35,760
that was part of that

997
00:35:35,760 --> 00:35:39,119
there was another base64 encoded file

998
00:35:39,119 --> 00:35:40,640
it doesn't show up here in the images

999
00:35:40,640 --> 00:35:43,200
tab so if we go back to

1000
00:35:43,200 --> 00:35:46,560
the elements we can actually grab

1001
00:35:46,560 --> 00:35:51,920
and copy that back here again

1002
00:35:55,920 --> 00:35:57,359
it takes a while to scroll through this

1003
00:35:57,359 --> 00:36:00,799
so bear with me folks

1004
00:36:03,200 --> 00:36:05,200
all right so here's our data image and

1005
00:36:05,200 --> 00:36:06,480
again i'm going to make an educated

1006
00:36:06,480 --> 00:36:08,480
guess here that this is like a

1007
00:36:08,480 --> 00:36:11,040
fave icon sort of thing so i'm just

1008
00:36:11,040 --> 00:36:12,960
going to go ahead and copy this whole

1009
00:36:12,960 --> 00:36:16,000
blob of stuff

1010
00:36:24,960 --> 00:36:27,200
and paste it into you know really any

1011
00:36:27,200 --> 00:36:30,399
text editor you want

1012
00:36:30,960 --> 00:36:35,480
and we'll just call it um

1013
00:36:35,480 --> 00:36:40,240
unknown.txt and save that out

1014
00:36:40,240 --> 00:36:42,560
so now that we've saved out the base64

1015
00:36:42,560 --> 00:36:44,160
version of the file we can actually go

1016
00:36:44,160 --> 00:36:46,240
ahead and decode that

1017
00:36:46,240 --> 00:36:51,279
so if i run b64

1018
00:36:52,160 --> 00:36:55,200
and then do a dash i to just ignore any

1019
00:36:55,200 --> 00:36:58,520
warnings it doesn't like um and i go to

1020
00:36:58,520 --> 00:37:00,160
unknown.txt

1021
00:37:00,160 --> 00:37:02,000
and i'm just going to go ahead and

1022
00:37:02,000 --> 00:37:09,839
redirect that to favicon.ico

1023
00:37:12,240 --> 00:37:14,720
and now if i pop in here um i can take a

1024
00:37:14,720 --> 00:37:16,480
look in my folder

1025
00:37:16,480 --> 00:37:20,560
and see that i have favicon.ico

1026
00:37:20,560 --> 00:37:23,599
if i blow this up because

1027
00:37:23,599 --> 00:37:27,280
icons are very tiny you can see

1028
00:37:27,280 --> 00:37:30,160
you know sort of a a favorite icon that

1029
00:37:30,160 --> 00:37:31,119
would look like

1030
00:37:31,119 --> 00:37:32,560
you know something for paypal

1031
00:37:32,560 --> 00:37:34,640
potentially and this is going to be

1032
00:37:34,640 --> 00:37:36,000
really microscopic

1033
00:37:36,000 --> 00:37:38,000
but if you look at the top of the the

1034
00:37:38,000 --> 00:37:39,040
tab window

1035
00:37:39,040 --> 00:37:41,359
there is that matching fave icon very

1036
00:37:41,359 --> 00:37:42,320
small

1037
00:37:42,320 --> 00:37:44,800
but it's there and so that's how we can

1038
00:37:44,800 --> 00:37:45,599
use the

1039
00:37:45,599 --> 00:37:48,560
automated developer tools to decode

1040
00:37:48,560 --> 00:37:49,680
images for us

1041
00:37:49,680 --> 00:37:51,040
and there's also how we can do it by

1042
00:37:51,040 --> 00:37:52,880
hand so either message

1043
00:37:52,880 --> 00:37:56,480
method works perfectly fine

1044
00:37:56,640 --> 00:37:58,800
and so the encoded content in this case

1045
00:37:58,800 --> 00:38:00,320
they use javascript

1046
00:38:00,320 --> 00:38:02,560
encoding to avoid analysis and detection

1047
00:38:02,560 --> 00:38:04,400
we've looked at that demo

1048
00:38:04,400 --> 00:38:06,400
we've decoded it using the browser

1049
00:38:06,400 --> 00:38:07,680
developer tools

1050
00:38:07,680 --> 00:38:09,680
and then we did it by hand and just a

1051
00:38:09,680 --> 00:38:11,040
quick note about the encoded

1052
00:38:11,040 --> 00:38:13,359
content whether the threat actors use

1053
00:38:13,359 --> 00:38:15,119
encoded elements to avoid analysis and

1054
00:38:15,119 --> 00:38:16,010
detection

1055
00:38:16,010 --> 00:38:17,200
[Music]

1056
00:38:17,200 --> 00:38:18,880
or just they want to keep the site as a

1057
00:38:18,880 --> 00:38:21,760
single page file uh they also use base64

1058
00:38:21,760 --> 00:38:22,880
encoded elements

1059
00:38:22,880 --> 00:38:25,760
within their javascript encoded page so

1060
00:38:25,760 --> 00:38:27,119
we're talking about

1061
00:38:27,119 --> 00:38:29,760
encoding embedded inside of encoding uh

1062
00:38:29,760 --> 00:38:30,240
makes it

1063
00:38:30,240 --> 00:38:32,880
a little bit tricky to unravel that uh

1064
00:38:32,880 --> 00:38:33,280
and

1065
00:38:33,280 --> 00:38:34,720
you know again those are the things that

1066
00:38:34,720 --> 00:38:36,480
threat actors will do to

1067
00:38:36,480 --> 00:38:37,920
hide their tracks and keep from getting

1068
00:38:37,920 --> 00:38:39,839
blocked and stopped

1069
00:38:39,839 --> 00:38:41,920
so their mediation plan and we determine

1070
00:38:41,920 --> 00:38:43,839
the final fishing landing page

1071
00:38:43,839 --> 00:38:45,520
uh through all our code analysis and

1072
00:38:45,520 --> 00:38:47,200
then we blocked that through

1073
00:38:47,200 --> 00:38:49,599
content filtering we also went ahead and

1074
00:38:49,599 --> 00:38:51,040
blocked the intermediary since they've

1075
00:38:51,040 --> 00:38:53,040
been clearly been compromised

1076
00:38:53,040 --> 00:38:54,960
we didn't want to leave access to those

1077
00:38:54,960 --> 00:38:56,560
especially if the threat actors still

1078
00:38:56,560 --> 00:38:58,079
seemingly had control of it

1079
00:38:58,079 --> 00:38:59,760
we knew that they could potentially go

1080
00:38:59,760 --> 00:39:02,480
back and try to do that again

1081
00:39:02,480 --> 00:39:04,160
and then we went ahead and reported the

1082
00:39:04,160 --> 00:39:06,240
compromise websites to the domain owners

1083
00:39:06,240 --> 00:39:07,520
and hosting companies

1084
00:39:07,520 --> 00:39:09,760
through their whois contact records uh

1085
00:39:09,760 --> 00:39:11,680
that's a lot harder now than it was then

1086
00:39:11,680 --> 00:39:13,520
because of the privacy laws

1087
00:39:13,520 --> 00:39:16,000
have uh basically anonymized that stuff

1088
00:39:16,000 --> 00:39:17,920
so in those cases you kind of pray that

1089
00:39:17,920 --> 00:39:18,640
the

1090
00:39:18,640 --> 00:39:20,160
they have that set up correctly in the

1091
00:39:20,160 --> 00:39:22,640
back end that their abuse address really

1092
00:39:22,640 --> 00:39:23,920
does resolve somewhere

1093
00:39:23,920 --> 00:39:26,000
and that somebody really is looking at

1094
00:39:26,000 --> 00:39:27,599
that and uh

1095
00:39:27,599 --> 00:39:30,800
and you know taking action on it um but

1096
00:39:30,800 --> 00:39:31,359
uh

1097
00:39:31,359 --> 00:39:33,760
that's it for my demos i did want to say

1098
00:39:33,760 --> 00:39:35,280
thank you so much everybody for

1099
00:39:35,280 --> 00:39:37,760
coming into the talk uh as you see me

1100
00:39:37,760 --> 00:39:39,359
here at b-sides come up and

1101
00:39:39,359 --> 00:39:41,040
and chat it up i'm wearing the green

1102
00:39:41,040 --> 00:39:43,200
armband so i gladly take hugs or

1103
00:39:43,200 --> 00:39:43,839
whatever

1104
00:39:43,839 --> 00:39:46,720
um but uh you know as you see me hey

1105
00:39:46,720 --> 00:39:47,920
share your own dfir

1106
00:39:47,920 --> 00:39:50,960
stories and friends romans b-sides

1107
00:39:50,960 --> 00:39:52,240
attendees

1108
00:39:52,240 --> 00:39:57,839
lend me your irs

1109
00:39:59,119 --> 00:40:01,040
i'll take quick questions if anybody has

1110
00:40:01,040 --> 00:40:02,880
any if not i'll be here all day

1111
00:40:02,880 --> 00:40:06,079
so you can always hit me up afterwards

1112
00:40:06,079 --> 00:40:10,640
anyone any questions for matt

1113
00:40:10,640 --> 00:40:12,720
all right i don't see any hands so yeah

1114
00:40:12,720 --> 00:40:16,160
feel free to hit me up afterwards thanks

1115
00:40:17,400 --> 00:40:20,400
everybody

