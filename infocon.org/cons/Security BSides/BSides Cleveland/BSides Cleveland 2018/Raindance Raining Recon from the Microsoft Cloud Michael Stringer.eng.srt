1
00:00:02,149 --> 00:00:07,799
hi<font color="#E5E5E5"> everybody my name is Mike stringer</font>

2
00:00:05,060 --> 00:00:10,280
<font color="#E5E5E5">today</font><font color="#CCCCCC"> uh doing a talk on rain</font><font color="#E5E5E5"> dance</font>

3
00:00:07,799 --> 00:00:13,259
<font color="#E5E5E5">raining recon from the Microsoft cloud</font>

4
00:00:10,280 --> 00:00:15,000
<font color="#CCCCCC">this is a small tool that I wrote for</font>

5
00:00:13,259 --> 00:00:17,670
<font color="#E5E5E5">digging information and reconnaissance</font>

6
00:00:15,000 --> 00:00:20,820
out of the Microsoft<font color="#CCCCCC"> Office 365 cloud</font>

7
00:00:17,670 --> 00:00:24,449
and a couple of the api's and stuff that

8
00:00:20,820 --> 00:00:26,400
<font color="#E5E5E5">you</font><font color="#CCCCCC"> know communicate with that just a</font>

9
00:00:24,449 --> 00:00:28,470
<font color="#E5E5E5">little bit about me</font><font color="#CCCCCC"> I'm a research</font>

10
00:00:26,400 --> 00:00:31,679
analyst with RSM previously with secure

11
00:00:28,470 --> 00:00:34,980
<font color="#CCCCCC">state I do penetration testing a lot of</font>

12
00:00:31,679 --> 00:00:39,390
research into malware<font color="#CCCCCC"> just a lot</font><font color="#E5E5E5"> of cool</font>

13
00:00:34,980 --> 00:00:41,339
<font color="#E5E5E5">stuff that I get to do every</font><font color="#CCCCCC"> day</font><font color="#E5E5E5"> before</font>

14
00:00:39,390 --> 00:00:43,579
<font color="#CCCCCC">doing Red Team</font><font color="#E5E5E5"> stuff though a lot of my</font>

15
00:00:41,340 --> 00:00:45,210
background was<font color="#CCCCCC"> in blue teaming</font><font color="#E5E5E5"> and</font>

16
00:00:43,579 --> 00:00:48,270
administration stuff and part of that

17
00:00:45,210 --> 00:00:50,700
was<font color="#CCCCCC"> I got to work with office</font><font color="#E5E5E5"> 365 and</font>

18
00:00:48,270 --> 00:00:51,870
PowerShell which I still to this<font color="#E5E5E5"> day do</font>

19
00:00:50,700 --> 00:00:55,219
not<font color="#E5E5E5"> have a very</font><font color="#CCCCCC"> good</font><font color="#E5E5E5"> working</font>

20
00:00:51,870 --> 00:01:00,780
<font color="#CCCCCC">relationship with</font><font color="#E5E5E5"> but for</font><font color="#CCCCCC"> the purpose of</font>

21
00:00:55,219 --> 00:01:02,489
this I<font color="#E5E5E5"> found it</font><font color="#CCCCCC"> extremely useful also</font>

22
00:01:00,780 --> 00:01:04,530
have a<font color="#E5E5E5"> background in computer</font><font color="#CCCCCC"> forensics</font>

23
00:01:02,489 --> 00:01:05,700
and<font color="#E5E5E5"> even though this entire talk is</font>

24
00:01:04,530 --> 00:01:08,790
pretty<font color="#E5E5E5"> much going to be all in</font>

25
00:01:05,700 --> 00:01:10,920
PowerShell<font color="#CCCCCC"> my favorite languages</font><font color="#E5E5E5"> Python</font>

26
00:01:08,790 --> 00:01:14,040
and I do do some<font color="#CCCCCC"> open</font><font color="#E5E5E5"> source</font>

27
00:01:10,920 --> 00:01:17,520
contributions<font color="#E5E5E5"> out there with RSM and</font><font color="#CCCCCC"> a</font>

28
00:01:14,040 --> 00:01:19,560
couple<font color="#E5E5E5"> of other projects out there also</font>

29
00:01:17,520 --> 00:01:21,298
wrote a book<font color="#CCCCCC"> for beginner hackers that</font>

30
00:01:19,560 --> 00:01:23,189
anybody that wants to get<font color="#E5E5E5"> into ethical</font>

31
00:01:21,299 --> 00:01:24,240
hacking that doesn't really know where

32
00:01:23,189 --> 00:01:26,220
<font color="#CCCCCC">to</font><font color="#E5E5E5"> start</font>

33
00:01:24,240 --> 00:01:29,880
it's out<font color="#E5E5E5"> there</font><font color="#CCCCCC"> on Amazon and</font><font color="#E5E5E5"> other</font>

34
00:01:26,220 --> 00:01:34,650
places<font color="#E5E5E5"> so if you're interested let me</font>

35
00:01:29,880 --> 00:01:37,259
know so cool things<font color="#CCCCCC"> that I get to share</font>

36
00:01:34,650 --> 00:01:39,119
about this is office<font color="#CCCCCC"> 365 has</font><font color="#E5E5E5"> some pretty</font>

37
00:01:37,259 --> 00:01:41,430
unique features built<font color="#E5E5E5"> into it for</font>

38
00:01:39,119 --> 00:01:44,100
communicating with<font color="#CCCCCC"> the cloud through</font>

39
00:01:41,430 --> 00:01:46,470
<font color="#E5E5E5">PowerShell the.net framework and other</font>

40
00:01:44,100 --> 00:01:48,270
things<font color="#CCCCCC"> like that so like I</font><font color="#E5E5E5"> was</font><font color="#CCCCCC"> saying</font><font color="#E5E5E5"> I</font>

41
00:01:46,470 --> 00:01:52,560
<font color="#CCCCCC">was a administrator many years ago</font>

42
00:01:48,270 --> 00:01:54,479
<font color="#E5E5E5">before this and originally my whole</font>

43
00:01:52,560 --> 00:01:56,280
intents and purposes of working with

44
00:01:54,479 --> 00:01:58,979
PowerShell was just to make<font color="#E5E5E5"> things work</font>

45
00:01:56,280 --> 00:02:00,930
but having shifted<font color="#E5E5E5"> my focus from a blue</font>

46
00:01:58,979 --> 00:02:05,009
team<font color="#CCCCCC"> perspective to attack and</font>

47
00:02:00,930 --> 00:02:06,420
penetration<font color="#E5E5E5"> testing I you know I sort of</font>

48
00:02:05,009 --> 00:02:10,509
saw this in a whole new light of how

49
00:02:06,420 --> 00:02:13,510
usable this was for attack purposes

50
00:02:10,508 --> 00:02:14,980
so there's a<font color="#E5E5E5"> ton of useful</font><font color="#CCCCCC"> things</font><font color="#E5E5E5"> that</font>

51
00:02:13,510 --> 00:02:18,220
you can do as an attacker with office

52
00:02:14,980 --> 00:02:20,170
365<font color="#CCCCCC"> that most attackers aren't familiar</font>

53
00:02:18,220 --> 00:02:22,060
with because office 365 is extremely

54
00:02:20,170 --> 00:02:24,129
expensive<font color="#CCCCCC"> not many people can</font><font color="#E5E5E5"> afford to</font>

55
00:02:22,060 --> 00:02:26,500
<font color="#E5E5E5">get a license for it</font><font color="#CCCCCC"> and they don't</font><font color="#E5E5E5"> have</font>

56
00:02:24,129 --> 00:02:29,500
many working development environments to

57
00:02:26,500 --> 00:02:31,030
work with this<font color="#E5E5E5"> so a lot of what you're</font>

58
00:02:29,500 --> 00:02:33,040
going<font color="#CCCCCC"> to see is going to be obfuscated</font>

59
00:02:31,030 --> 00:02:35,620
stuff that I did on<font color="#E5E5E5"> the</font><font color="#CCCCCC"> fly</font><font color="#E5E5E5"> while</font>

60
00:02:33,040 --> 00:02:37,540
working<font color="#E5E5E5"> with this tool and so I can't</font>

61
00:02:35,620 --> 00:02:38,739
show<font color="#CCCCCC"> you any of</font><font color="#E5E5E5"> the actual details but I</font>

62
00:02:37,540 --> 00:02:40,599
can<font color="#CCCCCC"> describe a lot of the information</font>

63
00:02:38,739 --> 00:02:43,989
<font color="#CCCCCC">that</font><font color="#E5E5E5"> we're able to pull out of office</font>

64
00:02:40,599 --> 00:02:47,670
365<font color="#E5E5E5"> using PowerShell</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> built-in tools</font>

65
00:02:43,989 --> 00:02:51,819
so<font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> and the rest api have</font>

66
00:02:47,670 --> 00:02:53,319
interesting features<font color="#E5E5E5"> that in the best or</font>

67
00:02:51,819 --> 00:02:54,488
worst case<font color="#E5E5E5"> scenario depending on which</font>

68
00:02:53,319 --> 00:02:56,470
side of the fence<font color="#E5E5E5"> are coming from you</font>

69
00:02:54,489 --> 00:02:58,450
<font color="#CCCCCC">can grab a lot of critical data off of</font>

70
00:02:56,470 --> 00:03:00,730
the domain without<font color="#E5E5E5"> ever compromising it</font>

71
00:02:58,450 --> 00:03:01,869
and without ever having<font color="#E5E5E5"> to breach the</font>

72
00:03:00,730 --> 00:03:03,819
perimeter

73
00:03:01,870 --> 00:03:06,640
additionally so for the forensics<font color="#E5E5E5"> guys</font>

74
00:03:03,819 --> 00:03:07,629
that are in the crowd<font color="#CCCCCC"> there's also a lot</font>

75
00:03:06,640 --> 00:03:09,488
of<font color="#E5E5E5"> things</font><font color="#CCCCCC"> that you can pull out to</font>

76
00:03:07,629 --> 00:03:11,260
<font color="#E5E5E5">detect when an attack</font><font color="#CCCCCC"> is happening</font>

77
00:03:09,489 --> 00:03:14,530
because<font color="#E5E5E5"> there's</font><font color="#CCCCCC"> not a</font><font color="#E5E5E5"> lot of logging</font>

78
00:03:11,260 --> 00:03:18,790
built<font color="#E5E5E5"> into</font><font color="#CCCCCC"> office 365 there's not a</font>

79
00:03:14,530 --> 00:03:21,880
whole<font color="#CCCCCC"> lot that</font><font color="#E5E5E5"> you can actually do</font><font color="#CCCCCC"> - it</font>

80
00:03:18,790 --> 00:03:24,310
doesn't actively detect when somebody is

81
00:03:21,880 --> 00:03:26,500
<font color="#E5E5E5">using these things but you can dig into</font>

82
00:03:24,310 --> 00:03:34,569
it and<font color="#E5E5E5"> it might</font><font color="#CCCCCC"> be helpful for you if</font>

83
00:03:26,500 --> 00:03:36,430
you're<font color="#E5E5E5"> coming in post incident so a few</font>

84
00:03:34,569 --> 00:03:38,230
differences between<font color="#CCCCCC"> exchange and office</font>

85
00:03:36,430 --> 00:03:40,180
365 historically everything has been

86
00:03:38,230 --> 00:03:43,238
<font color="#E5E5E5">on-premises on server specifically</font>

87
00:03:40,180 --> 00:03:44,739
<font color="#E5E5E5">exchange on-premises so the specific</font>

88
00:03:43,239 --> 00:03:46,599
things with<font color="#CCCCCC"> exchange is</font><font color="#E5E5E5"> that everything</font>

89
00:03:44,739 --> 00:03:50,370
is<font color="#E5E5E5"> local</font><font color="#CCCCCC"> to the network</font><font color="#E5E5E5"> you can only</font>

90
00:03:46,599 --> 00:03:53,349
<font color="#CCCCCC">access it through SMTP</font><font color="#E5E5E5"> local domain and</font>

91
00:03:50,370 --> 00:03:56,410
it only<font color="#E5E5E5"> really provides access to email</font>

92
00:03:53,349 --> 00:03:58,030
<font color="#CCCCCC">and a couple of other</font><font color="#E5E5E5"> things usually you</font>

93
00:03:56,410 --> 00:03:59,650
<font color="#E5E5E5">have</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> have it specifically configured</font>

94
00:03:58,030 --> 00:04:02,290
for your<font color="#E5E5E5"> laptop when you're working in a</font>

95
00:03:59,650 --> 00:04:03,549
corporate<font color="#E5E5E5"> environment and local</font>

96
00:04:02,290 --> 00:04:05,620
management<font color="#E5E5E5"> is possible through</font>

97
00:04:03,549 --> 00:04:08,199
PowerShell but<font color="#E5E5E5"> that's still only</font>

98
00:04:05,620 --> 00:04:11,769
possible through the<font color="#E5E5E5"> local network none</font>

99
00:04:08,199 --> 00:04:13,870
<font color="#E5E5E5">of that is</font><font color="#CCCCCC"> true with office 365 you can</font>

100
00:04:11,769 --> 00:04:15,940
<font color="#E5E5E5">access all of that stuff from anywhere</font>

101
00:04:13,870 --> 00:04:17,709
in<font color="#E5E5E5"> the</font><font color="#CCCCCC"> world</font><font color="#E5E5E5"> as long</font><font color="#CCCCCC"> as there's no you</font>

102
00:04:15,940 --> 00:04:19,238
<font color="#E5E5E5">know specific access controls</font>

103
00:04:17,709 --> 00:04:22,390
surrounding that<font color="#CCCCCC"> and by</font><font color="#E5E5E5"> default there</font>

104
00:04:19,238 --> 00:04:24,310
are<font color="#E5E5E5"> none so there's no need</font><font color="#CCCCCC"> to log</font><font color="#E5E5E5"> in to</font>

105
00:04:22,390 --> 00:04:25,930
<font color="#E5E5E5">the local domain you don't have to know</font>

106
00:04:24,310 --> 00:04:27,910
anything about<font color="#E5E5E5"> it all you</font><font color="#CCCCCC"> have to have</font>

107
00:04:25,930 --> 00:04:31,180
are legitimate user credentials in order

108
00:04:27,910 --> 00:04:33,520
<font color="#CCCCCC">to talk with the cloud on top</font><font color="#E5E5E5"> of that a</font>

109
00:04:31,180 --> 00:04:36,460
<font color="#E5E5E5">lot</font><font color="#CCCCCC"> of the features</font><font color="#E5E5E5"> that come</font><font color="#CCCCCC"> with the</font>

110
00:04:33,520 --> 00:04:38,950
cloud are sharepoint onedrive access

111
00:04:36,460 --> 00:04:41,680
delve all sorts of other<font color="#E5E5E5"> features that</font>

112
00:04:38,950 --> 00:04:44,500
<font color="#CCCCCC">are built into</font><font color="#E5E5E5"> it for usability and user</font>

113
00:04:41,680 --> 00:04:46,180
friendliness<font color="#E5E5E5"> and all of that is</font>

114
00:04:44,500 --> 00:04:47,800
configurable from anywhere<font color="#E5E5E5"> you don't</font>

115
00:04:46,180 --> 00:04:51,160
<font color="#E5E5E5">really have to</font><font color="#CCCCCC"> have a lot of knowledge</font>

116
00:04:47,800 --> 00:04:55,900
<font color="#E5E5E5">to communicate with these</font><font color="#CCCCCC"> services you</font>

117
00:04:51,160 --> 00:04:57,639
<font color="#E5E5E5">just</font><font color="#CCCCCC"> log in</font><font color="#E5E5E5"> and go and this is also the</font>

118
00:04:55,900 --> 00:04:59,530
same for<font color="#CCCCCC"> powershell and the.net</font>

119
00:04:57,639 --> 00:05:01,510
<font color="#E5E5E5">framework you</font><font color="#CCCCCC"> can actually communicate</font>

120
00:04:59,530 --> 00:05:03,760
with all of these<font color="#E5E5E5"> things</font><font color="#CCCCCC"> remotely from</font>

121
00:05:01,510 --> 00:05:05,800
<font color="#E5E5E5">anywhere and by default without user</font>

122
00:05:03,760 --> 00:05:09,580
access controls<font color="#E5E5E5"> there's nothing stopping</font>

123
00:05:05,800 --> 00:05:11,680
an attacker from<font color="#E5E5E5"> doing the same thing</font><font color="#CCCCCC"> if</font>

124
00:05:09,580 --> 00:05:18,810
they<font color="#CCCCCC"> manage to get access</font><font color="#E5E5E5"> to that as</font>

125
00:05:11,680 --> 00:05:21,430
well so when I was<font color="#CCCCCC"> a powershell at</font>

126
00:05:18,810 --> 00:05:24,220
administrator and managing office 365

127
00:05:21,430 --> 00:05:26,979
<font color="#E5E5E5">part of my task was managing users</font>

128
00:05:24,220 --> 00:05:30,120
<font color="#E5E5E5">mailing groups</font><font color="#CCCCCC"> managing sharepoint sites</font>

129
00:05:26,979 --> 00:05:32,680
<font color="#CCCCCC">and you know other things like that and</font>

130
00:05:30,120 --> 00:05:35,440
that was that<font color="#E5E5E5"> was my background before I</font>

131
00:05:32,680 --> 00:05:36,940
came to secure<font color="#CCCCCC"> State once I started</font>

132
00:05:35,440 --> 00:05:38,620
<font color="#CCCCCC">working</font><font color="#E5E5E5"> there</font><font color="#CCCCCC"> I've</font><font color="#E5E5E5"> got to be</font><font color="#CCCCCC"> around a</font>

133
00:05:36,940 --> 00:05:39,880
<font color="#E5E5E5">lot of really smart</font><font color="#CCCCCC"> dudes that were you</font>

134
00:05:38,620 --> 00:05:40,300
know breaking<font color="#E5E5E5"> into stuff and hacking</font>

135
00:05:39,880 --> 00:05:41,770


136
00:05:40,300 --> 00:05:43,270
<font color="#E5E5E5">I thought it was like</font><font color="#CCCCCC"> the coolest</font><font color="#E5E5E5"> thing</font>

137
00:05:41,770 --> 00:05:46,180
in the<font color="#CCCCCC"> world but</font><font color="#E5E5E5"> I didn't</font><font color="#CCCCCC"> really get to</font>

138
00:05:43,270 --> 00:05:47,890
<font color="#E5E5E5">put my hands on it</font><font color="#CCCCCC"> until</font><font color="#E5E5E5"> recently and</font>

139
00:05:46,180 --> 00:05:51,430
one of my colleagues<font color="#E5E5E5"> was on a</font>

140
00:05:47,890 --> 00:05:53,320
<font color="#E5E5E5">penetration test external</font><font color="#CCCCCC"> phishing was</font>

141
00:05:51,430 --> 00:05:55,539
in scope at the time and he managed to

142
00:05:53,320 --> 00:05:57,820
get<font color="#E5E5E5"> user credentials by sending a fish</font>

143
00:05:55,539 --> 00:05:59,830
there was no VPN there were no you<font color="#E5E5E5"> know</font>

144
00:05:57,820 --> 00:06:02,200
external user portals for him to log

145
00:05:59,830 --> 00:06:03,849
<font color="#E5E5E5">into all he had was email for the user</font>

146
00:06:02,200 --> 00:06:06,880
and<font color="#CCCCCC"> that was configured through office</font>

147
00:06:03,850 --> 00:06:08,289
<font color="#CCCCCC">365 and he was stuck</font><font color="#E5E5E5"> like man</font><font color="#CCCCCC"> what what</font>

148
00:06:06,880 --> 00:06:10,180
can<font color="#E5E5E5"> I do with this like there's nothing</font>

149
00:06:08,289 --> 00:06:11,710
<font color="#E5E5E5">that we</font><font color="#CCCCCC"> can do and I was</font><font color="#E5E5E5"> just kind of</font>

150
00:06:10,180 --> 00:06:13,870
shoulder<font color="#E5E5E5"> surfing</font><font color="#CCCCCC"> him and watching him do</font>

151
00:06:11,710 --> 00:06:15,849
this and I<font color="#E5E5E5"> was like well what have you</font>

152
00:06:13,870 --> 00:06:17,530
had some<font color="#E5E5E5"> more usernames like could would</font>

153
00:06:15,850 --> 00:06:20,500
that help you<font color="#E5E5E5"> he's like yeah that well</font>

154
00:06:17,530 --> 00:06:22,359
that'd be<font color="#E5E5E5"> great duh but I can't get that</font>

155
00:06:20,500 --> 00:06:23,710
<font color="#E5E5E5">I've gotten</font><font color="#CCCCCC"> everything</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> can from</font>

156
00:06:22,360 --> 00:06:25,750
open source intelligence<font color="#E5E5E5"> gathering</font>

157
00:06:23,710 --> 00:06:29,080
<font color="#E5E5E5">there's no way for me</font><font color="#CCCCCC"> to get</font><font color="#E5E5E5"> any more</font>

158
00:06:25,750 --> 00:06:30,010
users I'm not on the domain well let<font color="#E5E5E5"> me</font>

159
00:06:29,080 --> 00:06:31,810
show you something we could do that<font color="#E5E5E5"> with</font>

160
00:06:30,010 --> 00:06:34,150
PowerShell so I threw down<font color="#E5E5E5"> a few</font>

161
00:06:31,810 --> 00:06:35,740
commands into PowerShell<font color="#E5E5E5"> and he used the</font>

162
00:06:34,150 --> 00:06:37,198
credentials to<font color="#CCCCCC"> login</font><font color="#E5E5E5"> and like okay</font>

163
00:06:35,740 --> 00:06:39,499
here's one<font color="#E5E5E5"> more</font>

164
00:06:37,199 --> 00:06:41,909
instantaneously the<font color="#E5E5E5"> domain spits out</font>

165
00:06:39,499 --> 00:06:45,330
hundreds literally hundreds<font color="#E5E5E5"> of usernames</font>

166
00:06:41,909 --> 00:06:47,610
complete with their<font color="#CCCCCC"> office</font><font color="#E5E5E5"> building that</font>

167
00:06:45,330 --> 00:06:50,430
<font color="#E5E5E5">they were working in their phone numbers</font>

168
00:06:47,610 --> 00:06:54,180
everything<font color="#CCCCCC"> that he needed to</font><font color="#E5E5E5"> continue on</font>

169
00:06:50,430 --> 00:06:58,289
and do more internal<font color="#CCCCCC"> fishing</font><font color="#E5E5E5"> and keep</font>

170
00:06:54,180 --> 00:07:01,409
going<font color="#E5E5E5"> with</font><font color="#CCCCCC"> the attack so I walked away</font>

171
00:06:58,289 --> 00:07:02,818
from this<font color="#E5E5E5"> thinking to myself man it</font>

172
00:07:01,409 --> 00:07:04,770
would be<font color="#CCCCCC"> really awesome if we</font><font color="#E5E5E5"> had a tool</font>

173
00:07:02,819 --> 00:07:06,330
that could go and do<font color="#E5E5E5"> this stuff for</font><font color="#CCCCCC"> us</font>

174
00:07:04,770 --> 00:07:08,520
and we didn't have<font color="#E5E5E5"> to memorize all</font><font color="#CCCCCC"> these</font>

175
00:07:06,330 --> 00:07:10,529
PowerShell commands<font color="#E5E5E5"> but it didn't exist</font>

176
00:07:08,520 --> 00:07:13,139
<font color="#E5E5E5">at the time</font><font color="#CCCCCC"> and I didn't really have any</font>

177
00:07:10,529 --> 00:07:14,639
prior coding experience<font color="#CCCCCC"> but I</font><font color="#E5E5E5"> decided</font>

178
00:07:13,139 --> 00:07:19,770
I'd give<font color="#E5E5E5"> it a shot</font>

179
00:07:14,639 --> 00:07:21,479
so this is what this<font color="#E5E5E5"> was born out</font><font color="#CCCCCC"> of so</font>

180
00:07:19,770 --> 00:07:23,400
these are the<font color="#CCCCCC"> details</font><font color="#E5E5E5"> for logging into</font>

181
00:07:21,479 --> 00:07:25,438
the cloud<font color="#E5E5E5"> Microsoft</font><font color="#CCCCCC"> makes</font><font color="#E5E5E5"> it extremely</font>

182
00:07:23,400 --> 00:07:27,388
easy<font color="#E5E5E5"> for us you can</font><font color="#CCCCCC"> just run a quick</font>

183
00:07:25,439 --> 00:07:29,669
command connect to Microsoft<font color="#CCCCCC"> services</font>

184
00:07:27,389 --> 00:07:31,259
throw in<font color="#E5E5E5"> your credentials</font><font color="#CCCCCC"> and there you</font>

185
00:07:29,669 --> 00:07:34,169
go you're connected<font color="#CCCCCC"> and you have</font><font color="#E5E5E5"> access</font>

186
00:07:31,259 --> 00:07:35,789
to<font color="#E5E5E5"> all</font><font color="#CCCCCC"> of these</font><font color="#E5E5E5"> commands in</font><font color="#CCCCCC"> PowerShell</font>

187
00:07:34,169 --> 00:07:37,770
<font color="#CCCCCC">and you can also do this with</font><font color="#E5E5E5"> c-sharp</font>

188
00:07:35,789 --> 00:07:41,969
<font color="#E5E5E5">and a couple of other api's that are</font>

189
00:07:37,770 --> 00:07:44,250
built into<font color="#E5E5E5"> Windows and</font><font color="#CCCCCC"> exchange in</font>

190
00:07:41,969 --> 00:07:46,469
office 365 have always<font color="#E5E5E5"> provided this</font>

191
00:07:44,250 --> 00:07:48,089
access<font color="#E5E5E5"> this extensibility and the</font>

192
00:07:46,469 --> 00:07:50,389
ability to script<font color="#E5E5E5"> things out to make</font>

193
00:07:48,089 --> 00:07:52,979
things really<font color="#E5E5E5"> easy for administrators</font><font color="#CCCCCC"> it</font>

194
00:07:50,389 --> 00:07:54,990
allows you<font color="#E5E5E5"> to automate distributing</font>

195
00:07:52,979 --> 00:07:57,000
licenses subscriptions to different

196
00:07:54,990 --> 00:08:01,889
services like<font color="#CCCCCC"> you know SharePoint access</font>

197
00:07:57,000 --> 00:08:03,930
and you know local office programs<font color="#CCCCCC"> all</font>

198
00:08:01,889 --> 00:08:06,000
sorts of stuff<font color="#CCCCCC"> like that</font><font color="#E5E5E5"> so it's really</font>

199
00:08:03,930 --> 00:08:07,610
great<font color="#CCCCCC"> for administrators</font><font color="#E5E5E5"> and it makes it</font>

200
00:08:06,000 --> 00:08:10,909
<font color="#E5E5E5">very</font><font color="#CCCCCC"> easy for</font><font color="#E5E5E5"> them</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> do their jobs</font>

201
00:08:07,610 --> 00:08:14,069
<font color="#E5E5E5">there's just one problem with the model</font>

202
00:08:10,909 --> 00:08:17,250
<font color="#CCCCCC">is it anybody can do it anyone can</font>

203
00:08:14,069 --> 00:08:19,349
<font color="#CCCCCC">access these same</font><font color="#E5E5E5"> features all they have</font>

204
00:08:17,250 --> 00:08:21,750
to have our<font color="#E5E5E5"> credentials</font><font color="#CCCCCC"> it's not to say</font>

205
00:08:19,349 --> 00:08:25,979
<font color="#E5E5E5">that just an ordinary user is able to</font>

206
00:08:21,750 --> 00:08:29,460
<font color="#E5E5E5">like take away somebody's rights to file</font>

207
00:08:25,979 --> 00:08:31,740
shares or change<font color="#E5E5E5"> their password on the</font>

208
00:08:29,460 --> 00:08:33,870
fly because they want to it's<font color="#E5E5E5"> not quite</font>

209
00:08:31,740 --> 00:08:35,490
like<font color="#CCCCCC"> that but you can access all the</font>

210
00:08:33,870 --> 00:08:37,769
information<font color="#CCCCCC"> that</font><font color="#E5E5E5"> is built on to the</font>

211
00:08:35,490 --> 00:08:41,339
domain that's been shared with the<font color="#E5E5E5"> cloud</font>

212
00:08:37,769 --> 00:08:45,029
tenant and because by<font color="#CCCCCC"> default all users</font>

213
00:08:41,339 --> 00:08:46,769
have<font color="#E5E5E5"> PowerShell access if you don't lock</font>

214
00:08:45,029 --> 00:08:48,540
<font color="#E5E5E5">that down as an administrator that means</font>

215
00:08:46,769 --> 00:08:50,880
that all an attacker has to<font color="#CCCCCC"> do is have</font>

216
00:08:48,540 --> 00:08:53,280
<font color="#E5E5E5">one set of credentials and I ended up</font>

217
00:08:50,880 --> 00:08:56,280
myself<font color="#E5E5E5"> when I saw all the information</font>

218
00:08:53,280 --> 00:08:58,079
that<font color="#CCCCCC"> I could pull out</font><font color="#E5E5E5"> of it Oh</font><font color="#CCCCCC"> God</font>

219
00:08:56,280 --> 00:09:02,850
Microsoft what were you thinking why did

220
00:08:58,080 --> 00:09:05,130
you do this so if you have<font color="#CCCCCC"> a situation</font>

221
00:09:02,850 --> 00:09:07,740
<font color="#CCCCCC">as an attacker where you're able to get</font>

222
00:09:05,130 --> 00:09:10,110
legitimate credentials<font color="#E5E5E5"> to a</font><font color="#CCCCCC"> users email</font>

223
00:09:07,740 --> 00:09:13,290
<font color="#E5E5E5">and you find out that that's built into</font>

224
00:09:10,110 --> 00:09:14,910
<font color="#E5E5E5">exchange</font><font color="#CCCCCC"> online in office 365 and you</font>

225
00:09:13,290 --> 00:09:16,860
don't really<font color="#E5E5E5"> have anywhere else to</font><font color="#CCCCCC"> go or</font>

226
00:09:14,910 --> 00:09:23,150
<font color="#CCCCCC">you</font><font color="#E5E5E5"> just want to know more about</font><font color="#CCCCCC"> the</font>

227
00:09:16,860 --> 00:09:26,090
internal domain<font color="#CCCCCC"> you can go further</font><font color="#E5E5E5"> so</font>

228
00:09:23,150 --> 00:09:27,990
the first thing<font color="#CCCCCC"> that you</font><font color="#E5E5E5"> can ask</font>

229
00:09:26,090 --> 00:09:30,300
Microsoft can you tell me more about

230
00:09:27,990 --> 00:09:31,940
this company<font color="#CCCCCC"> that I'm targeting</font><font color="#E5E5E5"> says</font>

231
00:09:30,300 --> 00:09:36,359
sure<font color="#E5E5E5"> here you go</font>

232
00:09:31,940 --> 00:09:39,720
sign<font color="#CCCCCC"> in to</font><font color="#E5E5E5"> office 365</font><font color="#CCCCCC"> and I run a</font><font color="#E5E5E5"> little</font>

233
00:09:36,360 --> 00:09:43,350
command called get<font color="#E5E5E5"> MS</font><font color="#CCCCCC"> old om Sol domain</font>

234
00:09:39,720 --> 00:09:45,540
and it spits out a list of<font color="#E5E5E5"> the domains</font>

235
00:09:43,350 --> 00:09:49,170
<font color="#E5E5E5">that are attached to the tenant and by</font>

236
00:09:45,540 --> 00:09:51,540
<font color="#E5E5E5">default there's the my domain dot on</font>

237
00:09:49,170 --> 00:09:54,030
Microsoft<font color="#CCCCCC"> comm</font><font color="#E5E5E5"> and you can also attach</font>

238
00:09:51,540 --> 00:09:56,449
any other domain<font color="#E5E5E5"> like my company</font><font color="#CCCCCC"> comm or</font>

239
00:09:54,030 --> 00:09:59,579
my company alternate<font color="#E5E5E5"> com</font>

240
00:09:56,450 --> 00:10:02,520
so all<font color="#E5E5E5"> of these</font><font color="#CCCCCC"> are legitimate domains</font>

241
00:09:59,580 --> 00:10:04,890
that<font color="#E5E5E5"> you now know if you didn't before</font>

242
00:10:02,520 --> 00:10:08,480
<font color="#E5E5E5">that are attached to this</font><font color="#CCCCCC"> organization</font>

243
00:10:04,890 --> 00:10:11,370
that<font color="#CCCCCC"> you're targeting there's another</font>

244
00:10:08,480 --> 00:10:13,860
useful feature in<font color="#E5E5E5"> this is that you can</font>

245
00:10:11,370 --> 00:10:16,530
see that<font color="#E5E5E5"> this domain in particular is</font>

246
00:10:13,860 --> 00:10:19,140
federated what's interesting about

247
00:10:16,530 --> 00:10:20,880
federated domains is that<font color="#E5E5E5"> Federation</font>

248
00:10:19,140 --> 00:10:23,670
usually comes<font color="#E5E5E5"> with shared</font><font color="#CCCCCC"> access</font>

249
00:10:20,880 --> 00:10:28,439
controls<font color="#CCCCCC"> and that means</font><font color="#E5E5E5"> that you also</font>

250
00:10:23,670 --> 00:10:32,310
have shared credentials so if<font color="#CCCCCC"> one I'm</font><font color="#E5E5E5"> if</font>

251
00:10:28,440 --> 00:10:34,740
this is any indication it's that you now

252
00:10:32,310 --> 00:10:37,290
<font color="#E5E5E5">have not only the users</font><font color="#CCCCCC"> email but also</font>

253
00:10:34,740 --> 00:10:39,450
their local domain control<font color="#E5E5E5"> credentials</font>

254
00:10:37,290 --> 00:10:41,250
<font color="#E5E5E5">if you were able to get</font><font color="#CCCCCC"> onto</font><font color="#E5E5E5"> the network</font>

255
00:10:39,450 --> 00:10:43,140
<font color="#CCCCCC">you could use these</font><font color="#E5E5E5"> credentials to get</font>

256
00:10:41,250 --> 00:10:46,590
<font color="#CCCCCC">onto the domain so this</font><font color="#E5E5E5"> is useful</font>

257
00:10:43,140 --> 00:10:48,360
<font color="#CCCCCC">information to know</font><font color="#E5E5E5"> you can also use get</font>

258
00:10:46,590 --> 00:10:51,600
<font color="#E5E5E5">em Sol subscription and you can see a</font>

259
00:10:48,360 --> 00:10:54,240
list of all of<font color="#E5E5E5"> the subscribed services</font>

260
00:10:51,600 --> 00:10:56,580
or programs<font color="#CCCCCC"> that</font><font color="#E5E5E5"> are built</font><font color="#CCCCCC"> into</font><font color="#E5E5E5"> office</font>

261
00:10:54,240 --> 00:10:58,710
<font color="#CCCCCC">365 that that user has permissions to</font>

262
00:10:56,580 --> 00:11:01,860
use so this<font color="#E5E5E5"> can include SharePoint</font>

263
00:10:58,710 --> 00:11:05,080
access<font color="#E5E5E5"> office programs like the local</font>

264
00:11:01,860 --> 00:11:09,430
you know<font color="#E5E5E5"> Word Excel PowerPoint</font>

265
00:11:05,080 --> 00:11:15,040
<font color="#CCCCCC">delve Azure Active Directory</font><font color="#E5E5E5"> access and</font>

266
00:11:09,430 --> 00:11:16,540
even<font color="#E5E5E5"> more than</font><font color="#CCCCCC"> that so now</font><font color="#E5E5E5"> I have a new</font>

267
00:11:15,040 --> 00:11:17,860
list of domains to go and do some<font color="#E5E5E5"> more</font>

268
00:11:16,540 --> 00:11:19,449
<font color="#E5E5E5">research on if I didn't have those</font>

269
00:11:17,860 --> 00:11:21,010
<font color="#CCCCCC">before and I also know</font><font color="#E5E5E5"> what the users</font>

270
00:11:19,450 --> 00:11:22,330
are<font color="#CCCCCC"> running</font><font color="#E5E5E5"> on their local machine</font><font color="#CCCCCC"> and</font>

271
00:11:21,010 --> 00:11:24,120
also<font color="#E5E5E5"> what they have access</font><font color="#CCCCCC"> to in the</font>

272
00:11:22,330 --> 00:11:26,490
<font color="#E5E5E5">cloud that's really cool to know</font>

273
00:11:24,120 --> 00:11:28,780
<font color="#E5E5E5">wondering what else I</font><font color="#CCCCCC"> can find out</font>

274
00:11:26,490 --> 00:11:32,460
hey Microsoft did you tell<font color="#E5E5E5"> us</font><font color="#CCCCCC"> about this</font>

275
00:11:28,780 --> 00:11:35,770
company's information<font color="#CCCCCC"> sure</font><font color="#E5E5E5"> here you</font><font color="#CCCCCC"> go</font>

276
00:11:32,460 --> 00:11:37,510
if I run<font color="#CCCCCC"> get</font><font color="#E5E5E5"> em Sol company</font><font color="#CCCCCC"> information</font>

277
00:11:35,770 --> 00:11:38,710
it'll tell me<font color="#E5E5E5"> the</font><font color="#CCCCCC"> displayed name</font><font color="#E5E5E5"> that</font>

278
00:11:37,510 --> 00:11:41,260
they have configured their street

279
00:11:38,710 --> 00:11:42,070
address<font color="#CCCCCC"> city</font><font color="#E5E5E5"> state postal code telephone</font>

280
00:11:41,260 --> 00:11:44,439
number

281
00:11:42,070 --> 00:11:46,240
there's also technical notification

282
00:11:44,440 --> 00:11:47,770
emails which<font color="#E5E5E5"> I thought was</font><font color="#CCCCCC"> really</font>

283
00:11:46,240 --> 00:11:49,360
interesting<font color="#E5E5E5"> that's a configured email</font>

284
00:11:47,770 --> 00:11:52,090
address for somebody who's<font color="#E5E5E5"> supposedly a</font>

285
00:11:49,360 --> 00:11:53,890
technical expert<font color="#CCCCCC"> that</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> know you can</font>

286
00:11:52,090 --> 00:11:55,270
contact<font color="#E5E5E5"> that company for for</font><font color="#CCCCCC"> anything</font>

287
00:11:53,890 --> 00:11:57,130
that you might<font color="#CCCCCC"> have an issue with</font><font color="#E5E5E5"> I'm</font>

288
00:11:55,270 --> 00:11:59,140
willing<font color="#CCCCCC"> to</font><font color="#E5E5E5"> bet that that's probably</font><font color="#CCCCCC"> hits</font>

289
00:11:57,130 --> 00:12:03,490
domain admin<font color="#E5E5E5"> I don't know that for sure</font>

290
00:11:59,140 --> 00:12:05,650
but<font color="#CCCCCC"> I that's</font><font color="#E5E5E5"> a reasonable assumption you</font>

291
00:12:03,490 --> 00:12:08,110
also can<font color="#E5E5E5"> see what users by default are</font>

292
00:12:05,650 --> 00:12:10,120
permitted<font color="#CCCCCC"> to use through</font><font color="#E5E5E5"> the user</font>

293
00:12:08,110 --> 00:12:11,710
permission<font color="#E5E5E5"> to ex-something</font>

294
00:12:10,120 --> 00:12:13,630
and if it's set to<font color="#E5E5E5"> true then you know</font>

295
00:12:11,710 --> 00:12:16,390
that<font color="#E5E5E5"> users have</font><font color="#CCCCCC"> access to do this</font><font color="#E5E5E5"> so</font>

296
00:12:13,630 --> 00:12:18,070
here users<font color="#E5E5E5"> have access</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> create groups</font>

297
00:12:16,390 --> 00:12:20,140
which are mailing groups they<font color="#E5E5E5"> have</font>

298
00:12:18,070 --> 00:12:23,050
access<font color="#CCCCCC"> to create</font><font color="#E5E5E5"> line of business apps</font>

299
00:12:20,140 --> 00:12:24,730
which<font color="#E5E5E5"> that's interesting I wonder if I</font>

300
00:12:23,050 --> 00:12:26,170
<font color="#CCCCCC">could create a malicious app and just</font>

301
00:12:24,730 --> 00:12:27,850
throw<font color="#E5E5E5"> it up in the cloud if I have the</font>

302
00:12:26,170 --> 00:12:30,280
<font color="#E5E5E5">permission to do that if I can</font>

303
00:12:27,850 --> 00:12:34,210
<font color="#CCCCCC">distribute that</font><font color="#E5E5E5"> to people that might</font><font color="#CCCCCC"> be</font>

304
00:12:30,280 --> 00:12:36,610
a useful<font color="#E5E5E5"> attack you can also read other</font>

305
00:12:34,210 --> 00:12:39,580
users which is<font color="#CCCCCC"> also</font><font color="#E5E5E5"> really important</font><font color="#CCCCCC"> for</font>

306
00:12:36,610 --> 00:12:44,020
this particular<font color="#E5E5E5"> vector of gathering</font>

307
00:12:39,580 --> 00:12:45,430
<font color="#E5E5E5">information</font><font color="#CCCCCC"> oh and you can also see one</font>

308
00:12:44,020 --> 00:12:47,850
more<font color="#E5E5E5"> thing</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> I will call</font><font color="#CCCCCC"> out here</font><font color="#E5E5E5"> is</font>

309
00:12:45,430 --> 00:12:50,290
the last time that<font color="#CCCCCC"> der</font><font color="#E5E5E5"> sync happened so</font>

310
00:12:47,850 --> 00:12:52,930
directory synchronization order sync for

311
00:12:50,290 --> 00:12:54,730
short is a feature in hybridized

312
00:12:52,930 --> 00:12:57,130
<font color="#E5E5E5">environments where you have a</font>

313
00:12:54,730 --> 00:12:59,470
<font color="#E5E5E5">on-premises exchange server or similar</font>

314
00:12:57,130 --> 00:13:02,530
and you have a cloud environment<font color="#CCCCCC"> and you</font>

315
00:12:59,470 --> 00:13:05,050
want<font color="#E5E5E5"> all that shared access to exist</font>

316
00:13:02,530 --> 00:13:07,150
between the users on the domain and up

317
00:13:05,050 --> 00:13:08,800
in the cloud der sync allows<font color="#E5E5E5"> that to</font>

318
00:13:07,150 --> 00:13:10,810
happen<font color="#CCCCCC"> seamlessly and automatically</font>

319
00:13:08,800 --> 00:13:12,400
which<font color="#E5E5E5"> also comes with shared credentials</font>

320
00:13:10,810 --> 00:13:14,709
<font color="#E5E5E5">so if you have credentials for somebody</font>

321
00:13:12,400 --> 00:13:16,360
in the cloud in this case it<font color="#CCCCCC"> is not</font>

322
00:13:14,709 --> 00:13:17,489
enabled<font color="#CCCCCC"> on</font><font color="#E5E5E5"> this domain that I</font><font color="#CCCCCC"> tested</font>

323
00:13:16,360 --> 00:13:19,620
here but

324
00:13:17,490 --> 00:13:21,779
if it was true then I would know any

325
00:13:19,620 --> 00:13:23,910
cloud<font color="#E5E5E5"> credentials that I have are just</font>

326
00:13:21,779 --> 00:13:30,450
<font color="#CCCCCC">as</font><font color="#E5E5E5"> good as domain credentials</font><font color="#CCCCCC"> they</font><font color="#E5E5E5"> are</font>

327
00:13:23,910 --> 00:13:31,980
one<font color="#E5E5E5"> in the same so I want to ask</font>

328
00:13:30,450 --> 00:13:33,980
Microsoft another question<font color="#E5E5E5"> can I have</font>

329
00:13:31,980 --> 00:13:38,490
your entire domain user list

330
00:13:33,980 --> 00:13:40,920
no problem homie I got you if I run get

331
00:13:38,490 --> 00:13:42,420
em Sol user<font color="#E5E5E5"> and I truncated it here on</font>

332
00:13:40,920 --> 00:13:43,949
purpose<font color="#CCCCCC"> because this command takes a</font>

333
00:13:42,420 --> 00:13:45,719
really<font color="#E5E5E5"> long</font><font color="#CCCCCC"> time to run</font><font color="#E5E5E5"> if there's</font>

334
00:13:43,950 --> 00:13:49,440
thousands<font color="#CCCCCC"> of users</font><font color="#E5E5E5"> in this case it was</font>

335
00:13:45,720 --> 00:13:51,000
like<font color="#CCCCCC"> in the tens</font><font color="#E5E5E5"> of thousands so I tried</font>

336
00:13:49,440 --> 00:13:54,029
<font color="#E5E5E5">to let</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> run for about an hour and got</font>

337
00:13:51,000 --> 00:13:56,700
<font color="#E5E5E5">nowhere but you can pull out</font><font color="#CCCCCC"> the entire</font>

338
00:13:54,029 --> 00:13:58,080
domain<font color="#E5E5E5"> user list and just what you see</font>

339
00:13:56,700 --> 00:14:00,839
here<font color="#CCCCCC"> that</font><font color="#E5E5E5"> user principal name that's</font>

340
00:13:58,080 --> 00:14:03,089
what they<font color="#E5E5E5"> login with but it's not the</font>

341
00:14:00,839 --> 00:14:06,180
only<font color="#E5E5E5"> information it comes with all</font><font color="#CCCCCC"> of</font>

342
00:14:03,089 --> 00:14:07,589
this here still truncated<font color="#E5E5E5"> there's a lot</font>

343
00:14:06,180 --> 00:14:10,560
<font color="#E5E5E5">more information that</font><font color="#CCCCCC"> goes along</font><font color="#E5E5E5"> with</font>

344
00:14:07,589 --> 00:14:12,209
<font color="#CCCCCC">this but just off the top of my</font><font color="#E5E5E5"> head you</font>

345
00:14:10,560 --> 00:14:14,880
can see<font color="#E5E5E5"> the last time the password was</font>

346
00:14:12,209 --> 00:14:16,260
<font color="#CCCCCC">changed which is blank</font><font color="#E5E5E5"> and I'll explain</font>

347
00:14:14,880 --> 00:14:18,570
<font color="#E5E5E5">that</font><font color="#CCCCCC"> later</font>

348
00:14:16,260 --> 00:14:21,899
there's the licenses<font color="#E5E5E5"> of that user has</font>

349
00:14:18,570 --> 00:14:23,700
<font color="#CCCCCC">theirs they're Microsoft Live ID which</font>

350
00:14:21,899 --> 00:14:26,579
<font color="#CCCCCC">is their</font><font color="#E5E5E5"> personal email if they have</font>

351
00:14:23,700 --> 00:14:31,649
that configured<font color="#CCCCCC"> whether the password is</font>

352
00:14:26,579 --> 00:14:32,729
set to never expire<font color="#CCCCCC"> and just all sorts</font>

353
00:14:31,649 --> 00:14:35,700
<font color="#CCCCCC">of other information</font>

354
00:14:32,730 --> 00:14:38,940
there's where<font color="#E5E5E5"> they live what their</font>

355
00:14:35,700 --> 00:14:41,160
office is what the room number<font color="#CCCCCC"> is what</font>

356
00:14:38,940 --> 00:14:43,680
their desk phone is or extension this<font color="#E5E5E5"> is</font>

357
00:14:41,160 --> 00:14:45,870
a ton of information<font color="#E5E5E5"> that you can</font><font color="#CCCCCC"> use to</font>

358
00:14:43,680 --> 00:14:49,050
continue<font color="#E5E5E5"> an attack</font><font color="#CCCCCC"> that once you</font><font color="#E5E5E5"> know</font>

359
00:14:45,870 --> 00:14:51,060
what you know about<font color="#CCCCCC"> this user</font><font color="#E5E5E5"> you can</font>

360
00:14:49,050 --> 00:14:53,189
find this out<font color="#E5E5E5"> about any user in the</font>

361
00:14:51,060 --> 00:14:55,439
domain so<font color="#CCCCCC"> if you want to target specific</font>

362
00:14:53,190 --> 00:14:57,120
people<font color="#E5E5E5"> in the domain you can</font><font color="#CCCCCC"> use the</font>

363
00:14:55,440 --> 00:14:59,520
<font color="#E5E5E5">information that PowerShell gives you</font>

364
00:14:57,120 --> 00:15:02,070
<font color="#E5E5E5">because it's automatically divulged in</font>

365
00:14:59,520 --> 00:15:04,589
office 365 whatever the user volunteers

366
00:15:02,070 --> 00:15:08,870
up to the cloud is available to you as

367
00:15:04,589 --> 00:15:08,870
the attacker once you have this<font color="#CCCCCC"> access</font>

368
00:15:10,070 --> 00:15:15,829
so Microsoft how about all the targets

369
00:15:13,800 --> 00:15:20,099
mailing groups can I have that

370
00:15:15,829 --> 00:15:22,229
<font color="#E5E5E5">absolutely if I get em Sol group it will</font>

371
00:15:20,100 --> 00:15:23,760
pull out the list of<font color="#E5E5E5"> mail</font><font color="#CCCCCC"> and security</font>

372
00:15:22,230 --> 00:15:27,570
distribution groups that<font color="#E5E5E5"> exist</font><font color="#CCCCCC"> within</font>

373
00:15:23,760 --> 00:15:30,490
the cloud and<font color="#E5E5E5"> that tells me</font>

374
00:15:27,570 --> 00:15:32,020
just it's usually<font color="#E5E5E5"> broken down into</font>

375
00:15:30,490 --> 00:15:33,940
departments<font color="#E5E5E5"> right you have your IT</font>

376
00:15:32,020 --> 00:15:36,430
department you have<font color="#E5E5E5"> your security desk</font>

377
00:15:33,940 --> 00:15:37,780
you have<font color="#E5E5E5"> your accountants you have you</font>

378
00:15:36,430 --> 00:15:40,270
know administrative assistants

379
00:15:37,780 --> 00:15:41,890
executives<font color="#E5E5E5"> companies are very polite</font>

380
00:15:40,270 --> 00:15:43,870
<font color="#CCCCCC">about breaking</font><font color="#E5E5E5"> that down for you so you</font>

381
00:15:41,890 --> 00:15:46,090
know if you know what their distribution

382
00:15:43,870 --> 00:15:47,620
lists are you can say okay I<font color="#CCCCCC"> just want</font>

383
00:15:46,090 --> 00:15:49,210
to go<font color="#E5E5E5"> straight for the CEO if I just</font>

384
00:15:47,620 --> 00:15:52,300
send<font color="#E5E5E5"> out a fish to the executives</font><font color="#CCCCCC"> that</font>

385
00:15:49,210 --> 00:15:55,600
that'll be fine<font color="#E5E5E5"> and if it divulge is</font>

386
00:15:52,300 --> 00:15:57,670
that<font color="#CCCCCC"> okay I'm gonna use it</font><font color="#E5E5E5"> you can</font>

387
00:15:55,600 --> 00:16:00,100
specifically break down who is within<font color="#E5E5E5"> a</font>

388
00:15:57,670 --> 00:16:02,890
group by<font color="#CCCCCC"> using get em</font><font color="#E5E5E5"> Sol group member</font>

389
00:16:00,100 --> 00:16:05,650
<font color="#CCCCCC">and that's referencing the object ID for</font>

390
00:16:02,890 --> 00:16:07,660
that<font color="#E5E5E5"> group which this this command will</font>

391
00:16:05,650 --> 00:16:09,910
drop out a list of them it was way too

392
00:16:07,660 --> 00:16:12,490
long<font color="#CCCCCC"> to put</font><font color="#E5E5E5"> on the slide but trust</font><font color="#CCCCCC"> me</font>

393
00:16:09,910 --> 00:16:14,199
it's there<font color="#CCCCCC"> and once you reference that</font>

394
00:16:12,490 --> 00:16:19,170
<font color="#CCCCCC">it'll spit out the list</font><font color="#E5E5E5"> of all the users</font>

395
00:16:14,200 --> 00:16:19,170
<font color="#CCCCCC">that are attached to that</font><font color="#E5E5E5"> mailing group</font>

396
00:16:20,400 --> 00:16:26,650
so how<font color="#CCCCCC"> about all of the security roles I</font>

397
00:16:24,100 --> 00:16:28,690
want to know not only<font color="#E5E5E5"> what user groups</font>

398
00:16:26,650 --> 00:16:30,910
there<font color="#CCCCCC"> are for mail distribution I also</font>

399
00:16:28,690 --> 00:16:34,540
want to know what permissions users have

400
00:16:30,910 --> 00:16:39,370
within the cloud yep Microsoft will give

401
00:16:34,540 --> 00:16:40,750
me that -<font color="#E5E5E5"> mmm</font><font color="#CCCCCC"> Sol</font><font color="#E5E5E5"> role specifically</font>

402
00:16:39,370 --> 00:16:43,540
<font color="#E5E5E5">lists out all</font><font color="#CCCCCC"> the roles that</font><font color="#E5E5E5"> are</font>

403
00:16:40,750 --> 00:16:45,190
configured within<font color="#E5E5E5"> office 365</font><font color="#CCCCCC"> by</font><font color="#E5E5E5"> default</font>

404
00:16:43,540 --> 00:16:48,579
these are pretty<font color="#E5E5E5"> much</font><font color="#CCCCCC"> the only</font><font color="#E5E5E5"> ones that</font>

405
00:16:45,190 --> 00:16:49,260
you're<font color="#CCCCCC"> going to</font><font color="#E5E5E5"> see here except wait a</font>

406
00:16:48,580 --> 00:16:51,520
second

407
00:16:49,260 --> 00:16:52,540
this one in particular company

408
00:16:51,520 --> 00:16:55,150
administrator catches my attention

409
00:16:52,540 --> 00:16:58,839
because<font color="#CCCCCC"> it says a</font><font color="#E5E5E5"> company administrator</font>

410
00:16:55,150 --> 00:17:01,329
<font color="#E5E5E5">role has full access that sounds pretty</font>

411
00:16:58,840 --> 00:17:05,800
good I want that<font color="#E5E5E5"> full access sounds</font>

412
00:17:01,330 --> 00:17:07,930
pretty good<font color="#CCCCCC"> so Microsoft</font><font color="#E5E5E5"> can you tell me</font>

413
00:17:05,800 --> 00:17:09,609
who is in the company<font color="#E5E5E5"> administrator role</font>

414
00:17:07,930 --> 00:17:12,720
I want to know exactly<font color="#CCCCCC"> who it is I need</font>

415
00:17:09,609 --> 00:17:17,879
<font color="#CCCCCC">to poem to own everyone in the company</font>

416
00:17:12,720 --> 00:17:20,470
<font color="#CCCCCC">okay I give</font><font color="#E5E5E5"> you that</font><font color="#CCCCCC"> -</font><font color="#E5E5E5"> sure no problem</font>

417
00:17:17,880 --> 00:17:24,360
specifically referencing<font color="#E5E5E5"> em Sol role</font>

418
00:17:20,470 --> 00:17:28,329
member and the object ID for<font color="#E5E5E5"> that role</font>

419
00:17:24,359 --> 00:17:31,090
just<font color="#E5E5E5"> lists out all of the users and all</font>

420
00:17:28,329 --> 00:17:34,210
of the all<font color="#CCCCCC"> of their emails</font><font color="#E5E5E5"> and all that</font>

421
00:17:31,090 --> 00:17:36,669
same<font color="#CCCCCC"> information that</font><font color="#E5E5E5"> was specified when</font>

422
00:17:34,210 --> 00:17:38,530
I<font color="#CCCCCC"> drop</font><font color="#E5E5E5"> the list of users so now</font><font color="#CCCCCC"> I not</font>

423
00:17:36,670 --> 00:17:39,640
only know all the users<font color="#CCCCCC"> and all their</font>

424
00:17:38,530 --> 00:17:41,950
information<font color="#E5E5E5"> and</font>

425
00:17:39,640 --> 00:17:43,780
<font color="#E5E5E5">who to fish and how to fish them and who</font>

426
00:17:41,950 --> 00:17:47,020
works<font color="#E5E5E5"> next to each other and what desk</font>

427
00:17:43,780 --> 00:17:50,680
they're at and you<font color="#CCCCCC"> know who goes over to</font>

428
00:17:47,020 --> 00:17:52,930
the bar on<font color="#CCCCCC"> Friday night I also know</font>

429
00:17:50,680 --> 00:17:55,030
specifically who the administrators<font color="#E5E5E5"> are</font>

430
00:17:52,930 --> 00:17:57,130
that I can target<font color="#CCCCCC"> in order to get as far</font>

431
00:17:55,030 --> 00:18:01,210
into<font color="#CCCCCC"> the domain</font><font color="#E5E5E5"> as possible through the</font>

432
00:17:57,130 --> 00:18:03,580
cloud<font color="#CCCCCC"> and</font><font color="#E5E5E5"> the beauty</font><font color="#CCCCCC"> of this is</font><font color="#E5E5E5"> that it</font>

433
00:18:01,210 --> 00:18:05,170
gives<font color="#CCCCCC"> you so much granular information</font>

434
00:18:03,580 --> 00:18:07,210
with PowerShell you can you can pull<font color="#CCCCCC"> out</font>

435
00:18:05,170 --> 00:18:10,270
anything you want down to specifics if I

436
00:18:07,210 --> 00:18:12,340
wanted<font color="#E5E5E5"> to know exactly when users last</font>

437
00:18:10,270 --> 00:18:15,670
<font color="#E5E5E5">reset their password I could do that</font>

438
00:18:12,340 --> 00:18:18,159
<font color="#E5E5E5">here as well so just I know</font><font color="#CCCCCC"> it's really</font>

439
00:18:15,670 --> 00:18:19,150
<font color="#E5E5E5">small to read but basically what I'm</font>

440
00:18:18,160 --> 00:18:21,220
doing<font color="#CCCCCC"> here in</font><font color="#E5E5E5"> this command is I'm</font>

441
00:18:19,150 --> 00:18:22,780
<font color="#E5E5E5">listing out</font><font color="#CCCCCC"> a group of users and I'm</font>

442
00:18:21,220 --> 00:18:24,250
printing<font color="#E5E5E5"> out their display name</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> the</font>

443
00:18:22,780 --> 00:18:27,160
<font color="#E5E5E5">last time that</font><font color="#CCCCCC"> their password was</font>

444
00:18:24,250 --> 00:18:30,910
changed<font color="#CCCCCC"> and you can see a lot of these</font>

445
00:18:27,160 --> 00:18:32,800
were blank<font color="#E5E5E5"> by default you aren't</font>

446
00:18:30,910 --> 00:18:34,810
<font color="#E5E5E5">required to change your password so a</font>

447
00:18:32,800 --> 00:18:36,909
blank entry means it's never<font color="#E5E5E5"> been</font>

448
00:18:34,810 --> 00:18:39,129
changed<font color="#CCCCCC"> evidently in this domain</font>

449
00:18:36,910 --> 00:18:41,710
<font color="#E5E5E5">password cycling wasn't very important</font>

450
00:18:39,130 --> 00:18:44,020
but<font color="#CCCCCC"> I do want to you know give props to</font>

451
00:18:41,710 --> 00:18:53,110
<font color="#CCCCCC">this person</font><font color="#E5E5E5"> because at least they tried</font>

452
00:18:44,020 --> 00:18:55,690
in<font color="#E5E5E5"> December 2014</font><font color="#CCCCCC"> good job so another</font>

453
00:18:53,110 --> 00:18:58,780
really<font color="#CCCCCC"> awesome feature of all of this is</font>

454
00:18:55,690 --> 00:19:00,940
that you also get access to<font color="#E5E5E5"> exchange</font>

455
00:18:58,780 --> 00:19:03,340
mail and<font color="#E5E5E5"> this is something that's more</font>

456
00:19:00,940 --> 00:19:05,320
proof<font color="#E5E5E5"> of concept for me just because it</font>

457
00:19:03,340 --> 00:19:06,850
<font color="#E5E5E5">takes you really deep into PowerShell</font>

458
00:19:05,320 --> 00:19:09,100
but something that<font color="#E5E5E5"> I've been working on</font>

459
00:19:06,850 --> 00:19:10,840
is<font color="#CCCCCC"> that you can actually run a whole</font>

460
00:19:09,100 --> 00:19:13,419
bunch of<font color="#E5E5E5"> commands</font><font color="#CCCCCC"> that give you access</font>

461
00:19:10,840 --> 00:19:16,330
to<font color="#E5E5E5"> a</font><font color="#CCCCCC"> user's inbox</font><font color="#E5E5E5"> so you can</font>

462
00:19:13,420 --> 00:19:19,030
specifically<font color="#E5E5E5"> drop into a user's inbox</font>

463
00:19:16,330 --> 00:19:20,860
pull it out as a<font color="#CCCCCC"> powershell object</font><font color="#E5E5E5"> again</font>

464
00:19:19,030 --> 00:19:24,460
<font color="#E5E5E5">same as with dotnet framework you could</font>

465
00:19:20,860 --> 00:19:28,600
do this with<font color="#CCCCCC"> c-sharp you</font><font color="#E5E5E5"> can rip out you</font>

466
00:19:24,460 --> 00:19:30,790
can set up<font color="#CCCCCC"> a session and then log into</font>

467
00:19:28,600 --> 00:19:32,530
<font color="#E5E5E5">it and suddenly</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> get</font><font color="#CCCCCC"> access to</font><font color="#E5E5E5"> all the</font>

468
00:19:30,790 --> 00:19:34,600
<font color="#E5E5E5">commands that</font><font color="#CCCCCC"> are available</font><font color="#E5E5E5"> on</font><font color="#CCCCCC"> that</font>

469
00:19:32,530 --> 00:19:39,670
exchange<font color="#E5E5E5"> server that's just what this is</font>

470
00:19:34,600 --> 00:19:41,469
indicating<font color="#CCCCCC"> here so I can drop out a list</font>

471
00:19:39,670 --> 00:19:43,420
of mailboxes<font color="#CCCCCC"> that I have</font><font color="#E5E5E5"> access to</font><font color="#CCCCCC"> with</font>

472
00:19:41,470 --> 00:19:45,910
the get mailbox command<font color="#CCCCCC"> lit</font><font color="#E5E5E5"> and that</font>

473
00:19:43,420 --> 00:19:47,440
<font color="#CCCCCC">drops out the list of</font><font color="#E5E5E5"> all</font><font color="#CCCCCC"> the mailboxes</font>

474
00:19:45,910 --> 00:19:49,320
<font color="#CCCCCC">that are available</font><font color="#E5E5E5"> within that exchange</font>

475
00:19:47,440 --> 00:19:53,860
tenant

476
00:19:49,320 --> 00:19:57,520
so there is a<font color="#E5E5E5"> ton of useful features</font><font color="#CCCCCC"> in</font>

477
00:19:53,860 --> 00:20:01,090
<font color="#E5E5E5">this because I can I can either jump</font>

478
00:19:57,520 --> 00:20:04,000
into a<font color="#E5E5E5"> specific users mailbox</font><font color="#CCCCCC"> or if I</font>

479
00:20:01,090 --> 00:20:06,639
had enough<font color="#E5E5E5"> time I could just go into</font>

480
00:20:04,000 --> 00:20:07,360
every<font color="#CCCCCC"> single mailbox</font><font color="#E5E5E5"> and then search</font>

481
00:20:06,640 --> 00:20:11,550
mailbox

482
00:20:07,360 --> 00:20:14,260
<font color="#E5E5E5">for a query in the body for password and</font>

483
00:20:11,550 --> 00:20:16,960
suddenly PowerShell is going to drop out

484
00:20:14,260 --> 00:20:19,660
an entire list<font color="#E5E5E5"> of all the emails that</font>

485
00:20:16,960 --> 00:20:20,980
contain password in the body<font color="#E5E5E5"> and I can</font>

486
00:20:19,660 --> 00:20:23,590
even<font color="#E5E5E5"> go a little bit further into</font>

487
00:20:20,980 --> 00:20:28,750
PowerShell to<font color="#CCCCCC"> give it the one line where</font>

488
00:20:23,590 --> 00:20:30,129
I see that<font color="#E5E5E5"> appear so now</font><font color="#CCCCCC"> Microsoft is</font>

489
00:20:28,750 --> 00:20:33,090
<font color="#E5E5E5">basically telling me if I have</font>

490
00:20:30,130 --> 00:20:35,380
administrative<font color="#E5E5E5"> access so say I get that</font>

491
00:20:33,090 --> 00:20:37,419
<font color="#E5E5E5">global administrator the company admin</font>

492
00:20:35,380 --> 00:20:39,550
<font color="#E5E5E5">he has the permission to impersonate</font>

493
00:20:37,420 --> 00:20:42,130
everybody's inbox and he can just go

494
00:20:39,550 --> 00:20:44,800
into it<font color="#CCCCCC"> and dive in whenever</font><font color="#E5E5E5"> he pleases</font>

495
00:20:42,130 --> 00:20:46,750
<font color="#CCCCCC">he can rep</font><font color="#E5E5E5"> out all of the information</font>

496
00:20:44,800 --> 00:20:48,220
<font color="#CCCCCC">that people have</font><font color="#E5E5E5"> saved in their inbox I</font>

497
00:20:46,750 --> 00:20:50,170
can go searching for<font color="#E5E5E5"> passwords or</font>

498
00:20:48,220 --> 00:20:52,300
<font color="#E5E5E5">credentials or whatever search query I</font>

499
00:20:50,170 --> 00:20:55,390
decide<font color="#CCCCCC"> to throw</font><font color="#E5E5E5"> it and it will throw</font>

500
00:20:52,300 --> 00:20:57,100
<font color="#CCCCCC">that back at me without complaint and</font>

501
00:20:55,390 --> 00:20:58,870
there's a lot<font color="#E5E5E5"> of other things that you</font>

502
00:20:57,100 --> 00:21:00,580
can connect<font color="#CCCCCC"> to besides exchange like</font>

503
00:20:58,870 --> 00:21:03,370
this is<font color="#E5E5E5"> only just the tip of the iceberg</font>

504
00:21:00,580 --> 00:21:06,850
you<font color="#E5E5E5"> can jump into there the chat tenant</font>

505
00:21:03,370 --> 00:21:08,649
for<font color="#E5E5E5"> Skype or Lync whatever it is</font><font color="#CCCCCC"> you can</font>

506
00:21:06,850 --> 00:21:10,780
<font color="#E5E5E5">jump into the logs file shares for</font>

507
00:21:08,650 --> 00:21:12,550
SharePoint and onedrive<font color="#CCCCCC"> business</font>

508
00:21:10,780 --> 00:21:14,350
<font color="#E5E5E5">analytics and data with power bi</font>

509
00:21:12,550 --> 00:21:16,000
although I haven't<font color="#CCCCCC"> personally dived into</font>

510
00:21:14,350 --> 00:21:18,280
that too much<font color="#E5E5E5"> I've heard that that's a</font>

511
00:21:16,000 --> 00:21:21,190
<font color="#CCCCCC">useful thing developer documentation</font>

512
00:21:18,280 --> 00:21:24,310
<font color="#E5E5E5">within and all the security and</font>

513
00:21:21,190 --> 00:21:27,370
<font color="#E5E5E5">compliance tools that build the rule</font>

514
00:21:24,310 --> 00:21:30,669
sets and<font color="#E5E5E5"> other security features for</font>

515
00:21:27,370 --> 00:21:33,370
office 365<font color="#CCCCCC"> that I wouldn't essentially</font>

516
00:21:30,670 --> 00:21:39,790
have control<font color="#CCCCCC"> over as the company</font>

517
00:21:33,370 --> 00:21:41,919
administrator so as an<font color="#E5E5E5"> example</font>

518
00:21:39,790 --> 00:21:45,370
besides<font color="#E5E5E5"> exchange you can</font><font color="#CCCCCC"> also log into</font>

519
00:21:41,920 --> 00:21:48,280
SharePoint<font color="#CCCCCC"> if I wanted</font><font color="#E5E5E5"> to see what was</font>

520
00:21:45,370 --> 00:21:50,649
available<font color="#E5E5E5"> to me in a target SharePoint</font><font color="#CCCCCC"> I</font>

521
00:21:48,280 --> 00:21:54,070
could use the connect to SPO<font color="#E5E5E5"> services</font>

522
00:21:50,650 --> 00:21:55,720
give it the URL<font color="#E5E5E5"> and pops up a login</font><font color="#CCCCCC"> box</font>

523
00:21:54,070 --> 00:21:57,879
you drop in your<font color="#E5E5E5"> credentials and</font>

524
00:21:55,720 --> 00:22:02,180
<font color="#E5E5E5">whatever access you</font><font color="#CCCCCC"> have is what you can</font>

525
00:21:57,880 --> 00:22:04,020
get access<font color="#E5E5E5"> to by default most</font>

526
00:22:02,180 --> 00:22:05,490
administrators<font color="#CCCCCC"> are not going to</font>

527
00:22:04,020 --> 00:22:07,050
specifically say<font color="#CCCCCC"> what users can</font><font color="#E5E5E5"> and</font>

528
00:22:05,490 --> 00:22:09,300
cannot<font color="#E5E5E5"> access certain websites and I've</font>

529
00:22:07,050 --> 00:22:13,440
<font color="#E5E5E5">actually seen this in practice</font><font color="#CCCCCC"> where you</font>

530
00:22:09,300 --> 00:22:18,090
can drop in as a user who<font color="#E5E5E5"> was if I'm not</font>

531
00:22:13,440 --> 00:22:19,890
mistaken<font color="#E5E5E5"> a attorney and he had access</font><font color="#CCCCCC"> to</font>

532
00:22:18,090 --> 00:22:22,080
<font color="#E5E5E5">all the developer documentation and</font>

533
00:22:19,890 --> 00:22:24,570
procedures<font color="#CCCCCC"> that the devs</font><font color="#E5E5E5"> in that company</font>

534
00:22:22,080 --> 00:22:26,189
had dropped into<font color="#E5E5E5"> SharePoint and that</font>

535
00:22:24,570 --> 00:22:27,770
also<font color="#E5E5E5"> gave</font><font color="#CCCCCC"> me access to all their</font>

536
00:22:26,190 --> 00:22:30,120
credentials<font color="#E5E5E5"> that</font><font color="#CCCCCC"> they had left behind</font>

537
00:22:27,770 --> 00:22:32,810
<font color="#CCCCCC">just</font><font color="#E5E5E5"> like hey if you want to log</font><font color="#CCCCCC"> into</font>

538
00:22:30,120 --> 00:22:35,520
this box with SSH these are the creds

539
00:22:32,810 --> 00:22:38,159
why a lawyer should<font color="#CCCCCC"> have access</font><font color="#E5E5E5"> to that</font>

540
00:22:35,520 --> 00:22:40,379
I have no idea<font color="#E5E5E5"> it's but by</font><font color="#CCCCCC"> default</font>

541
00:22:38,160 --> 00:22:41,880
<font color="#E5E5E5">Microsoft and SharePoint does not</font>

542
00:22:40,380 --> 00:22:43,290
discriminate<font color="#E5E5E5"> you can have access to</font>

543
00:22:41,880 --> 00:22:47,730
whatever you want if your admin says

544
00:22:43,290 --> 00:22:49,080
doesn't say no so better<font color="#E5E5E5"> to ask for</font>

545
00:22:47,730 --> 00:22:51,300
<font color="#CCCCCC">forgiveness and for permission I can</font>

546
00:22:49,080 --> 00:22:53,280
<font color="#E5E5E5">just go and</font><font color="#CCCCCC"> head</font><font color="#E5E5E5"> and dig</font><font color="#CCCCCC"> into</font><font color="#E5E5E5"> that so I</font>

547
00:22:51,300 --> 00:22:56,100
can show<font color="#CCCCCC"> whatever sites that I have</font>

548
00:22:53,280 --> 00:22:57,930
access<font color="#CCCCCC"> to with get SPO site and there's</font>

549
00:22:56,100 --> 00:22:59,820
specific<font color="#E5E5E5"> syntax with that that I wasn't</font>

550
00:22:57,930 --> 00:23:02,990
<font color="#E5E5E5">going</font><font color="#CCCCCC"> to drop into because it was</font>

551
00:22:59,820 --> 00:23:05,730
<font color="#E5E5E5">already too small to</font><font color="#CCCCCC"> show on this</font><font color="#E5E5E5"> slide</font>

552
00:23:02,990 --> 00:23:07,440
<font color="#CCCCCC">but</font><font color="#E5E5E5"> you could list out all</font><font color="#CCCCCC"> of the</font>

553
00:23:05,730 --> 00:23:08,820
SharePoint<font color="#CCCCCC"> sites that exists even the</font>

554
00:23:07,440 --> 00:23:10,560
ones<font color="#E5E5E5"> that are hidden from</font><font color="#CCCCCC"> view</font>

555
00:23:08,820 --> 00:23:12,689
<font color="#CCCCCC">I'm sure you've logged into a SharePoint</font>

556
00:23:10,560 --> 00:23:15,720
site<font color="#E5E5E5"> any of you red teamers that have</font>

557
00:23:12,690 --> 00:23:17,370
tried<font color="#CCCCCC"> to attack office</font><font color="#E5E5E5"> 365 services or</font>

558
00:23:15,720 --> 00:23:19,830
tried to<font color="#E5E5E5"> dig through it have probably</font>

559
00:23:17,370 --> 00:23:21,899
<font color="#E5E5E5">looked at</font><font color="#CCCCCC"> sharepoint</font><font color="#E5E5E5"> and it is a really</font>

560
00:23:19,830 --> 00:23:23,520
<font color="#E5E5E5">gross</font><font color="#CCCCCC"> webpage that doesn't have the link</font>

561
00:23:21,900 --> 00:23:25,680
to<font color="#CCCCCC"> everything well if you want the link</font>

562
00:23:23,520 --> 00:23:27,240
<font color="#E5E5E5">to everything this is</font><font color="#CCCCCC"> how you do it</font><font color="#E5E5E5"> you</font>

563
00:23:25,680 --> 00:23:29,220
can<font color="#CCCCCC"> just drop out all the sites that</font>

564
00:23:27,240 --> 00:23:31,020
<font color="#CCCCCC">that user has access to</font><font color="#E5E5E5"> and you can play</font>

565
00:23:29,220 --> 00:23:33,120
<font color="#CCCCCC">with</font><font color="#E5E5E5"> it as you like whatever access that</font>

566
00:23:31,020 --> 00:23:35,490
user has<font color="#E5E5E5"> you can do up to and including</font>

567
00:23:33,120 --> 00:23:37,439
<font color="#CCCCCC">write access where you can drop in</font>

568
00:23:35,490 --> 00:23:40,500
malicious payloads<font color="#E5E5E5"> and then share that</font>

569
00:23:37,440 --> 00:23:42,570
<font color="#CCCCCC">with other users you</font><font color="#E5E5E5"> can</font><font color="#CCCCCC"> actually set up</font>

570
00:23:40,500 --> 00:23:43,980
sharing links with other users say hey

571
00:23:42,570 --> 00:23:46,379
this<font color="#E5E5E5"> is a really useful thing</font><font color="#CCCCCC"> that I</font>

572
00:23:43,980 --> 00:23:49,470
thought you<font color="#CCCCCC"> might like and just drop a</font>

573
00:23:46,380 --> 00:23:52,650
malicious document that has a<font color="#E5E5E5"> DBA</font>

574
00:23:49,470 --> 00:23:57,660
payload in it<font color="#E5E5E5"> for an</font><font color="#CCCCCC"> example you can</font>

575
00:23:52,650 --> 00:23:59,070
<font color="#CCCCCC">also get a list oh sorry</font><font color="#E5E5E5"> go back you can</font>

576
00:23:57,660 --> 00:24:00,570
also get<font color="#E5E5E5"> a list of specifically who the</font>

577
00:23:59,070 --> 00:24:02,310
SharePoint<font color="#CCCCCC"> users are which are a little</font>

578
00:24:00,570 --> 00:24:03,330
<font color="#E5E5E5">bit different</font><font color="#CCCCCC"> than the exchange</font><font color="#E5E5E5"> users</font>

579
00:24:02,310 --> 00:24:05,760
for the most part it's<font color="#CCCCCC"> going to be the</font>

580
00:24:03,330 --> 00:24:07,350
same but in some environments where the

581
00:24:05,760 --> 00:24:09,420
admins like to get really fancy<font color="#CCCCCC"> and</font>

582
00:24:07,350 --> 00:24:11,639
complex they can set up specific users

583
00:24:09,420 --> 00:24:14,419
for logging<font color="#CCCCCC"> into SharePoint which does</font>

584
00:24:11,640 --> 00:24:16,129
help<font color="#CCCCCC"> to lock things</font><font color="#E5E5E5"> down if you want to</font>

585
00:24:14,419 --> 00:24:18,019
it worked that<font color="#E5E5E5"> way</font><font color="#CCCCCC"> set up specific</font>

586
00:24:16,129 --> 00:24:20,269
groups<font color="#E5E5E5"> for who is able to access</font>

587
00:24:18,019 --> 00:24:25,669
<font color="#CCCCCC">SharePoint</font><font color="#E5E5E5"> separate from who your groups</font>

588
00:24:20,269 --> 00:24:28,669
are in exchange<font color="#E5E5E5"> so there is a additional</font>

589
00:24:25,669 --> 00:24:29,600
feature<font color="#E5E5E5"> that I am</font><font color="#CCCCCC"> still continuing to do</font>

590
00:24:28,669 --> 00:24:31,369
a little<font color="#E5E5E5"> bit of research on</font><font color="#CCCCCC"> that</font>

591
00:24:29,600 --> 00:24:34,939
<font color="#E5E5E5">specifically within the</font><font color="#CCCCCC"> web</font><font color="#E5E5E5"> services API</font>

592
00:24:31,369 --> 00:24:37,759
that's built<font color="#E5E5E5"> into Windows when you ever</font>

593
00:24:34,940 --> 00:24:39,739
<font color="#E5E5E5">whenever you install office you're also</font>

594
00:24:37,759 --> 00:24:43,340
installing these<font color="#CCCCCC"> api's for it to access</font>

595
00:24:39,739 --> 00:24:45,619
<font color="#E5E5E5">these over the web so although</font>

596
00:24:43,340 --> 00:24:48,289
<font color="#E5E5E5">unconfirmed</font><font color="#CCCCCC"> there are strong rumors and</font>

597
00:24:45,619 --> 00:24:49,820
hints<font color="#E5E5E5"> that are pointing to significant</font>

598
00:24:48,289 --> 00:24:53,509
<font color="#CCCCCC">vulnerabilities within</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> Web API</font>

599
00:24:49,820 --> 00:24:55,309
<font color="#CCCCCC">services that allow you to bypass</font>

600
00:24:53,509 --> 00:24:58,009
certain authentication requirements

601
00:24:55,309 --> 00:25:00,379
<font color="#E5E5E5">because it is a legacy API and it's not</font>

602
00:24:58,009 --> 00:25:02,659
being kept up with with the same amount

603
00:25:00,379 --> 00:25:05,178
of scrutiny<font color="#CCCCCC"> that all of the current</font>

604
00:25:02,659 --> 00:25:10,970
accesses with<font color="#E5E5E5"> PowerShell are being built</font>

605
00:25:05,179 --> 00:25:13,279
with so<font color="#CCCCCC"> just some</font><font color="#E5E5E5"> of the advantages</font><font color="#CCCCCC"> of</font>

606
00:25:10,970 --> 00:25:15,739
using<font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> for this purpose on a</font>

607
00:25:13,279 --> 00:25:18,440
pen test is<font color="#E5E5E5"> that when you're doing</font>

608
00:25:15,739 --> 00:25:20,179
<font color="#E5E5E5">office when you're doing OSINT gathering</font>

609
00:25:18,440 --> 00:25:22,220
<font color="#E5E5E5">you're not guaranteed</font><font color="#CCCCCC"> that what you're</font>

610
00:25:20,179 --> 00:25:24,559
<font color="#CCCCCC">polling is going to be accurate yes you</font>

611
00:25:22,220 --> 00:25:26,659
can use tools like<font color="#CCCCCC"> Foca and the</font>

612
00:25:24,559 --> 00:25:28,249
harvester to<font color="#E5E5E5"> pull out emails but you're</font>

613
00:25:26,659 --> 00:25:30,859
not<font color="#CCCCCC"> guaranteed to get everything if</font>

614
00:25:28,249 --> 00:25:33,619
<font color="#E5E5E5">you're fancy</font><font color="#CCCCCC"> and have ways</font><font color="#E5E5E5"> to pull out</font>

615
00:25:30,859 --> 00:25:35,480
information<font color="#E5E5E5"> out of social media that's</font>

616
00:25:33,619 --> 00:25:38,209
good too but you're still not guaranteed

617
00:25:35,480 --> 00:25:39,799
<font color="#CCCCCC">that the information specifically</font><font color="#E5E5E5"> the</font>

618
00:25:38,210 --> 00:25:41,600
<font color="#E5E5E5">user names that you're pulling out of</font>

619
00:25:39,799 --> 00:25:44,149
<font color="#E5E5E5">that is going to be a hundred percent</font>

620
00:25:41,600 --> 00:25:46,158
<font color="#CCCCCC">accurate</font><font color="#E5E5E5"> this is because this is pulling</font>

621
00:25:44,149 --> 00:25:49,129
it straight<font color="#CCCCCC"> out</font><font color="#E5E5E5"> of the domain and if it</font>

622
00:25:46,159 --> 00:25:50,840
is federated again those credentials<font color="#E5E5E5"> and</font>

623
00:25:49,129 --> 00:25:53,168
<font color="#CCCCCC">user names are just</font><font color="#E5E5E5"> as good on the</font>

624
00:25:50,840 --> 00:25:55,908
<font color="#E5E5E5">domain as they are in the cloud</font>

625
00:25:53,169 --> 00:25:58,869
<font color="#E5E5E5">secondary is that there's no need</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> be</font>

626
00:25:55,909 --> 00:26:01,549
quiet<font color="#E5E5E5"> about this because you're using</font>

627
00:25:58,869 --> 00:26:03,918
<font color="#E5E5E5">PowerShell as it was intended for by</font>

628
00:26:01,549 --> 00:26:05,809
administrators and users by default

629
00:26:03,919 --> 00:26:07,669
everybody has access to this and there's

630
00:26:05,809 --> 00:26:11,539
really not a whole<font color="#E5E5E5"> lot</font><font color="#CCCCCC"> of logging that</font>

631
00:26:07,669 --> 00:26:13,609
exists by default to tell somebody<font color="#E5E5E5"> hey</font>

632
00:26:11,539 --> 00:26:15,919
someone<font color="#E5E5E5"> just logged it</font><font color="#CCCCCC"> in to office 365</font>

633
00:26:13,609 --> 00:26:18,769
<font color="#E5E5E5">with PowerShell</font><font color="#CCCCCC"> dump the</font><font color="#E5E5E5"> entire domain</font>

634
00:26:15,919 --> 00:26:21,350
user<font color="#E5E5E5"> listens looking for the admins it</font>

635
00:26:18,769 --> 00:26:22,820
doesn't tell you that<font color="#CCCCCC"> I would think that</font>

636
00:26:21,350 --> 00:26:24,439
that<font color="#CCCCCC"> would</font><font color="#E5E5E5"> be something that the admin</font>

637
00:26:22,820 --> 00:26:27,759
would want to<font color="#CCCCCC"> know but as it stands</font>

638
00:26:24,440 --> 00:26:27,759
right<font color="#CCCCCC"> now there's no way to know</font>

639
00:26:42,650 --> 00:26:48,620
<font color="#E5E5E5">okay really</font>

640
00:27:17,030 --> 00:27:21,870
and and that<font color="#CCCCCC"> that is something that is</font>

641
00:27:20,490 --> 00:27:23,550
<font color="#E5E5E5">something that we were actually that I</font>

642
00:27:21,870 --> 00:27:25,229
was going<font color="#E5E5E5"> to touch on absolutely you're</font>

643
00:27:23,550 --> 00:27:27,510
right<font color="#E5E5E5"> multi-factor authentication is an</font>

644
00:27:25,230 --> 00:27:29,010
important part of this<font color="#E5E5E5"> thank</font><font color="#CCCCCC"> you and if</font>

645
00:27:27,510 --> 00:27:30,960
you want<font color="#CCCCCC"> to talk about it later you know</font>

646
00:27:29,010 --> 00:27:34,100
after<font color="#CCCCCC"> the talk we could</font><font color="#E5E5E5"> absolutely I'd</font>

647
00:27:30,960 --> 00:27:37,560
<font color="#CCCCCC">love to have a conversation about it</font>

648
00:27:34,100 --> 00:27:38,969
<font color="#CCCCCC">it's is like he was saying</font><font color="#E5E5E5"> that there</font>

649
00:27:37,560 --> 00:27:40,919
are certain<font color="#E5E5E5"> hardening things that are</font>

650
00:27:38,970 --> 00:27:42,900
<font color="#E5E5E5">built into office</font><font color="#CCCCCC"> 365 that</font><font color="#E5E5E5"> you are</font>

651
00:27:40,920 --> 00:27:44,400
supposed<font color="#CCCCCC"> to do there</font><font color="#E5E5E5"> are things</font><font color="#CCCCCC"> that you</font>

652
00:27:42,900 --> 00:27:46,170
can do to<font color="#E5E5E5"> prevent these things and I'll</font>

653
00:27:44,400 --> 00:27:48,720
go<font color="#CCCCCC"> into</font><font color="#E5E5E5"> more details about it</font><font color="#CCCCCC"> I did</font><font color="#E5E5E5"> not</font>

654
00:27:46,170 --> 00:27:50,100
know about the additional logging the

655
00:27:48,720 --> 00:27:52,260
documentation<font color="#CCCCCC"> that I had</font><font color="#E5E5E5"> pulled out</font>

656
00:27:50,100 --> 00:28:11,129
<font color="#CCCCCC">about it did not describe any express</font>

657
00:27:52,260 --> 00:28:12,450
logging<font color="#E5E5E5"> okay yeah I would I would</font>

658
00:28:11,130 --> 00:28:14,310
definitely love<font color="#CCCCCC"> to start</font><font color="#E5E5E5"> looking into</font>

659
00:28:12,450 --> 00:28:16,080
<font color="#E5E5E5">that so if you wouldn't mind like</font>

660
00:28:14,310 --> 00:28:20,190
talking after this is over<font color="#CCCCCC"> I would</font><font color="#E5E5E5"> love</font>

661
00:28:16,080 --> 00:28:22,080
to talk<font color="#CCCCCC"> about it so I guess what I'm</font>

662
00:28:20,190 --> 00:28:25,050
<font color="#CCCCCC">saying here about lugs being minimal is</font>

663
00:28:22,080 --> 00:28:26,790
not necessarily<font color="#E5E5E5"> true so I apologize</font><font color="#CCCCCC"> for</font>

664
00:28:25,050 --> 00:28:28,050
<font color="#E5E5E5">that</font><font color="#CCCCCC"> I'm gonna have to you know do a</font>

665
00:28:26,790 --> 00:28:32,090
little<font color="#E5E5E5"> bit more research into it but</font>

666
00:28:28,050 --> 00:28:34,800
thank<font color="#E5E5E5"> you very much sir</font><font color="#CCCCCC"> I all the same</font>

667
00:28:32,090 --> 00:28:36,330
and at least wall I was conducting my

668
00:28:34,800 --> 00:28:39,899
assessments in these<font color="#E5E5E5"> environments when I</font>

669
00:28:36,330 --> 00:28:40,740
was<font color="#E5E5E5"> doing office 365 enumeration</font>

670
00:28:39,900 --> 00:28:43,170
basically

671
00:28:40,740 --> 00:28:45,000
<font color="#CCCCCC">I wasn't</font><font color="#E5E5E5"> getting any alerts from the</font>

672
00:28:43,170 --> 00:28:47,040
<font color="#E5E5E5">client who was you</font><font color="#CCCCCC"> know supposed to be</font>

673
00:28:45,000 --> 00:28:49,590
communicating<font color="#CCCCCC"> with us and</font><font color="#E5E5E5"> letting us</font>

674
00:28:47,040 --> 00:28:51,120
know<font color="#E5E5E5"> if they ever caught us on some</font>

675
00:28:49,590 --> 00:28:53,129
things they did but specifically with

676
00:28:51,120 --> 00:28:56,580
office 365 they didn't notice anything

677
00:28:53,130 --> 00:28:58,290
<font color="#CCCCCC">so if it's</font><font color="#E5E5E5"> not something</font><font color="#CCCCCC"> that's being</font>

678
00:28:56,580 --> 00:29:04,409
explicitly watched may not necessarily

679
00:28:58,290 --> 00:29:06,389
get<font color="#E5E5E5"> caught so in short with all this</font>

680
00:29:04,410 --> 00:29:08,780
reconnaissance<font color="#CCCCCC"> the more you know</font><font color="#E5E5E5"> the</font>

681
00:29:06,390 --> 00:29:08,780
more you<font color="#CCCCCC"> pone</font>

682
00:29:10,160 --> 00:29:15,929
so here's<font color="#E5E5E5"> where I get into the actual</font>

683
00:29:13,050 --> 00:29:17,580
<font color="#CCCCCC">tool that I built</font><font color="#E5E5E5"> and like I said</font><font color="#CCCCCC"> this</font>

684
00:29:15,929 --> 00:29:19,410
is one of<font color="#E5E5E5"> my first open source</font>

685
00:29:17,580 --> 00:29:22,590
contribution projects that I'm doing

686
00:29:19,410 --> 00:29:24,809
solo<font color="#E5E5E5"> I'm really proud of it but it's</font>

687
00:29:22,590 --> 00:29:25,590
also<font color="#CCCCCC"> in its infancy</font><font color="#E5E5E5"> still under active</font>

688
00:29:24,809 --> 00:29:28,500
<font color="#CCCCCC">development</font>

689
00:29:25,590 --> 00:29:31,320
<font color="#CCCCCC">I really appreciate if anybody who has a</font>

690
00:29:28,500 --> 00:29:33,420
background in PowerShell<font color="#CCCCCC"> or specifically</font>

691
00:29:31,320 --> 00:29:34,830
<font color="#E5E5E5">office 365 administration that would</font>

692
00:29:33,420 --> 00:29:37,980
<font color="#E5E5E5">love to contribute to this that would</font><font color="#CCCCCC"> be</font>

693
00:29:34,830 --> 00:29:40,080
absolutely<font color="#CCCCCC"> awesome</font><font color="#E5E5E5"> but in any</font><font color="#CCCCCC"> case the</font>

694
00:29:37,980 --> 00:29:42,809
<font color="#E5E5E5">purpose of this tool</font><font color="#CCCCCC"> I'm calling rain</font>

695
00:29:40,080 --> 00:29:44,790
<font color="#CCCCCC">dance</font><font color="#E5E5E5"> is to automate</font><font color="#CCCCCC"> all of</font><font color="#E5E5E5"> that boring</font>

696
00:29:42,809 --> 00:29:46,440
<font color="#E5E5E5">stuff there's a lot of PowerShell</font>

697
00:29:44,790 --> 00:29:51,059
<font color="#E5E5E5">commands that you would have</font><font color="#CCCCCC"> to memorize</font>

698
00:29:46,440 --> 00:29:53,670
and<font color="#E5E5E5"> use in perfect tandem in order to do</font>

699
00:29:51,059 --> 00:29:55,290
<font color="#CCCCCC">all of this in a way</font><font color="#E5E5E5"> that was logical</font>

700
00:29:53,670 --> 00:29:59,100
<font color="#E5E5E5">and pull the</font><font color="#CCCCCC"> information out to</font><font color="#E5E5E5"> make it</font>

701
00:29:55,290 --> 00:30:00,870
useful<font color="#E5E5E5"> to</font><font color="#CCCCCC"> you because once you run those</font>

702
00:29:59,100 --> 00:30:03,870
<font color="#E5E5E5">commands they take a really</font><font color="#CCCCCC"> long time</font>

703
00:30:00,870 --> 00:30:06,330
and it<font color="#CCCCCC"> doesn't exactly</font><font color="#E5E5E5"> save all</font><font color="#CCCCCC"> of that</font>

704
00:30:03,870 --> 00:30:09,389
for you to use it later<font color="#CCCCCC"> so in order to</font>

705
00:30:06,330 --> 00:30:11,850
<font color="#E5E5E5">make that easier</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> set up rain dance so</font>

706
00:30:09,390 --> 00:30:13,410
<font color="#CCCCCC">that once</font><font color="#E5E5E5"> you run your commands to pull</font>

707
00:30:11,850 --> 00:30:15,629
all that information down from the cloud

708
00:30:13,410 --> 00:30:17,580
it'll store it in local<font color="#E5E5E5"> variables that</font>

709
00:30:15,630 --> 00:30:19,559
you<font color="#CCCCCC"> can use and do what you want with</font>

710
00:30:17,580 --> 00:30:21,840
and then at the<font color="#CCCCCC"> very end you can dump</font>

711
00:30:19,559 --> 00:30:25,520
everything<font color="#E5E5E5"> out to CSV</font><font color="#CCCCCC"> or txt files in</font>

712
00:30:21,840 --> 00:30:28,919
order to store it and<font color="#E5E5E5"> use</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> later</font><font color="#CCCCCC"> so</font>

713
00:30:25,520 --> 00:30:31,050
<font color="#CCCCCC">the essential features are that it eases</font>

714
00:30:28,920 --> 00:30:34,350
<font color="#E5E5E5">the process of logging</font><font color="#CCCCCC"> into</font><font color="#E5E5E5"> office</font><font color="#CCCCCC"> 365</font>

715
00:30:31,050 --> 00:30:36,570
through PowerShell it can use a simple

716
00:30:34,350 --> 00:30:38,100
<font color="#E5E5E5">git command to either get specific</font>

717
00:30:36,570 --> 00:30:39,780
information<font color="#E5E5E5"> like the users or the</font>

718
00:30:38,100 --> 00:30:44,040
<font color="#E5E5E5">security roles and other things like</font>

719
00:30:39,780 --> 00:30:46,800
that<font color="#E5E5E5"> or show stuff that you've already</font>

720
00:30:44,040 --> 00:30:48,300
gotten so if you want it to be<font color="#E5E5E5"> extremely</font>

721
00:30:46,800 --> 00:30:50,730
<font color="#E5E5E5">easy for</font><font color="#CCCCCC"> yourself you could</font><font color="#E5E5E5"> just run</font>

722
00:30:48,300 --> 00:30:52,350
<font color="#E5E5E5">rain - get all and it will pull all that</font>

723
00:30:50,730 --> 00:30:54,150
information down and store it in local

724
00:30:52,350 --> 00:30:55,649
variables for you to use and

725
00:30:54,150 --> 00:30:59,520
you can reference all those with<font color="#E5E5E5"> Rainn</font>

726
00:30:55,650 --> 00:31:01,920
show and then specify show<font color="#CCCCCC"> be users or</font>

727
00:30:59,520 --> 00:31:03,930
show me<font color="#E5E5E5"> global administrators and it</font>

728
00:31:01,920 --> 00:31:06,150
will do that<font color="#CCCCCC"> very politely and</font><font color="#E5E5E5"> drop it</font>

729
00:31:03,930 --> 00:31:08,220
all out to the<font color="#E5E5E5"> screen</font><font color="#CCCCCC"> for you</font><font color="#E5E5E5"> to use and</font>

730
00:31:06,150 --> 00:31:09,900
once you're done<font color="#E5E5E5"> with your assessment or</font>

731
00:31:08,220 --> 00:31:11,520
if you<font color="#E5E5E5"> just want</font><font color="#CCCCCC"> to put it all into</font><font color="#E5E5E5"> a</font>

732
00:31:09,900 --> 00:31:14,850
file that makes it convenient<font color="#E5E5E5"> to read</font>

733
00:31:11,520 --> 00:31:16,800
you<font color="#E5E5E5"> can just run the rain - gut dump</font>

734
00:31:14,850 --> 00:31:20,370
command and<font color="#CCCCCC"> that will drop</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> into a CSV</font>

735
00:31:16,800 --> 00:31:22,590
folder or excuse me<font color="#E5E5E5"> a directory full of</font>

736
00:31:20,370 --> 00:31:25,739
CSV folders for<font color="#E5E5E5"> you to reference those</font>

737
00:31:22,590 --> 00:31:27,179
separately for<font color="#E5E5E5"> the time being this tool</font>

738
00:31:25,740 --> 00:31:28,830
is only<font color="#CCCCCC"> available for</font><font color="#E5E5E5"> Windows just</font>

739
00:31:27,180 --> 00:31:30,510
<font color="#CCCCCC">because of the dependencies that are</font>

740
00:31:28,830 --> 00:31:32,220
built<font color="#E5E5E5"> into</font><font color="#CCCCCC"> PowerShell but I'm told that</font>

741
00:31:30,510 --> 00:31:34,020
Microsoft is<font color="#E5E5E5"> building in a whole bunch</font>

742
00:31:32,220 --> 00:31:36,180
<font color="#E5E5E5">of additional</font><font color="#CCCCCC"> features and making</font><font color="#E5E5E5"> all of</font>

743
00:31:34,020 --> 00:31:39,240
<font color="#E5E5E5">these</font><font color="#CCCCCC"> modules that this tool relies on</font>

744
00:31:36,180 --> 00:31:40,800
<font color="#E5E5E5">for Linux so eventually this</font><font color="#CCCCCC"> is supposed</font>

745
00:31:39,240 --> 00:31:42,240
<font color="#E5E5E5">to become</font><font color="#CCCCCC"> Linux compatible which would</font>

746
00:31:40,800 --> 00:31:44,760
be extremely<font color="#CCCCCC"> awesome I would</font><font color="#E5E5E5"> love if</font>

747
00:31:42,240 --> 00:31:46,410
Microsoft<font color="#E5E5E5"> would make that easier for me</font>

748
00:31:44,760 --> 00:31:50,629
<font color="#CCCCCC">to do and I wouldn't have to run</font><font color="#E5E5E5"> Windows</font>

749
00:31:46,410 --> 00:31:50,630
in order to pull this<font color="#E5E5E5"> out</font><font color="#CCCCCC"> of the cloud</font>

750
00:31:51,290 --> 00:31:56,490
so here's just<font color="#E5E5E5"> a couple of quick</font>

751
00:31:53,610 --> 00:31:58,550
examples of the syntax<font color="#E5E5E5"> this all uses the</font>

752
00:31:56,490 --> 00:32:00,690
same parameters within<font color="#E5E5E5"> PowerShell so</font>

753
00:31:58,550 --> 00:32:02,520
like I<font color="#E5E5E5"> mentioned</font><font color="#CCCCCC"> before</font><font color="#E5E5E5"> when you're</font>

754
00:32:00,690 --> 00:32:05,520
<font color="#E5E5E5">getting all</font><font color="#CCCCCC"> of this information it</font><font color="#E5E5E5"> takes</font>

755
00:32:02,520 --> 00:32:07,170
a really long<font color="#CCCCCC"> time to</font><font color="#E5E5E5"> use it</font><font color="#CCCCCC"> does appear</font>

756
00:32:05,520 --> 00:32:09,510
as<font color="#E5E5E5"> though the script hangs sometimes</font>

757
00:32:07,170 --> 00:32:11,040
it's not it's just<font color="#E5E5E5"> taking a long time</font><font color="#CCCCCC"> to</font>

758
00:32:09,510 --> 00:32:12,930
pull that information<font color="#E5E5E5"> down because it's</font>

759
00:32:11,040 --> 00:32:14,879
really<font color="#CCCCCC"> dense</font><font color="#E5E5E5"> and you're limited</font><font color="#CCCCCC"> by your</font>

760
00:32:12,930 --> 00:32:16,950
<font color="#E5E5E5">network connection</font><font color="#CCCCCC"> but at the</font><font color="#E5E5E5"> very</font><font color="#CCCCCC"> least</font>

761
00:32:14,880 --> 00:32:19,110
it's<font color="#E5E5E5"> easy that it pulls all this</font>

762
00:32:16,950 --> 00:32:20,610
information<font color="#E5E5E5"> down and once it's done</font>

763
00:32:19,110 --> 00:32:22,979
collecting everything<font color="#E5E5E5"> it'll let you know</font>

764
00:32:20,610 --> 00:32:24,840
<font color="#E5E5E5">and you</font><font color="#CCCCCC"> can drop it</font><font color="#E5E5E5"> out instantaneously</font>

765
00:32:22,980 --> 00:32:28,200
<font color="#E5E5E5">it only takes a</font><font color="#CCCCCC"> couple of seconds at</font>

766
00:32:24,840 --> 00:32:30,330
most<font color="#CCCCCC"> so you only have</font><font color="#E5E5E5"> to go up to the</font>

767
00:32:28,200 --> 00:32:32,280
cloud<font color="#CCCCCC"> login pull</font><font color="#E5E5E5"> it down one time and</font>

768
00:32:30,330 --> 00:32:34,679
then from<font color="#CCCCCC"> that</font><font color="#E5E5E5"> point on you</font><font color="#CCCCCC"> can just</font>

769
00:32:32,280 --> 00:32:36,750
print it<font color="#E5E5E5"> out to the screen</font><font color="#CCCCCC"> everything is</font>

770
00:32:34,680 --> 00:32:38,820
all in<font color="#E5E5E5"> PowerShell objects at this point</font>

771
00:32:36,750 --> 00:32:40,980
so each user<font color="#E5E5E5"> that's an object</font><font color="#CCCCCC"> you can</font>

772
00:32:38,820 --> 00:32:43,260
<font color="#E5E5E5">pull out</font><font color="#CCCCCC"> that user</font><font color="#E5E5E5"> you can dive into the</font>

773
00:32:40,980 --> 00:32:44,970
information<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> available to you</font><font color="#CCCCCC"> yet</font>

774
00:32:43,260 --> 00:32:46,800
you get<font color="#CCCCCC"> access to</font><font color="#E5E5E5"> all of</font><font color="#CCCCCC"> that and you</font>

775
00:32:44,970 --> 00:32:48,300
<font color="#E5E5E5">don't have to log be logged in at this</font>

776
00:32:46,800 --> 00:32:53,149
point so even<font color="#CCCCCC"> if you lose credentials</font>

777
00:32:48,300 --> 00:32:55,500
<font color="#E5E5E5">you still have all this</font><font color="#CCCCCC"> information and</font>

778
00:32:53,150 --> 00:32:58,650
like I was saying before<font color="#E5E5E5"> just an example</font>

779
00:32:55,500 --> 00:33:00,260
<font color="#E5E5E5">of the CSV output and I'm sorry that I</font>

780
00:32:58,650 --> 00:33:03,780
had<font color="#CCCCCC"> to fuzz so much of this</font><font color="#E5E5E5"> stuff out</font>

781
00:33:00,260 --> 00:33:07,379
<font color="#CCCCCC">but you have at the very</font><font color="#E5E5E5"> least a</font>

782
00:33:03,780 --> 00:33:07,800
guaranteed<font color="#E5E5E5"> username email address and</font>

783
00:33:07,380 --> 00:33:09,030
then

784
00:33:07,800 --> 00:33:11,010
anything else<font color="#E5E5E5"> that the user has</font>

785
00:33:09,030 --> 00:33:13,560
volunteered<font color="#E5E5E5"> up to the cloud and that</font>

786
00:33:11,010 --> 00:33:17,600
<font color="#E5E5E5">will all be saved in a convenient format</font>

787
00:33:13,560 --> 00:33:17,600
for you to do more<font color="#E5E5E5"> analysis on later</font><font color="#CCCCCC"> so</font>

788
00:33:19,580 --> 00:33:25,830
<font color="#CCCCCC">I'm sure that some of the red-blue team</font>

789
00:33:23,060 --> 00:33:28,590
among us are wondering<font color="#E5E5E5"> how do we stop</font>

790
00:33:25,830 --> 00:33:30,120
this and like the gentleman was alluding

791
00:33:28,590 --> 00:33:32,179
to<font color="#CCCCCC"> earlier multi-factor authentication</font>

792
00:33:30,120 --> 00:33:35,459
is extremely important<font color="#CCCCCC"> for this</font>

793
00:33:32,180 --> 00:33:37,200
<font color="#CCCCCC">PowerShell</font><font color="#E5E5E5"> is able to</font><font color="#CCCCCC"> login with</font>

794
00:33:35,460 --> 00:33:38,340
multi-factor authentication but it

795
00:33:37,200 --> 00:33:40,800
doesn't really matter<font color="#E5E5E5"> because an</font>

796
00:33:38,340 --> 00:33:42,449
attacker is<font color="#CCCCCC"> not likely to get that it's</font>

797
00:33:40,800 --> 00:33:45,270
<font color="#CCCCCC">extremely</font><font color="#E5E5E5"> difficult for an attacker to</font>

798
00:33:42,450 --> 00:33:47,450
<font color="#E5E5E5">be</font><font color="#CCCCCC"> able</font><font color="#E5E5E5"> to get ahold of that second</font>

799
00:33:45,270 --> 00:33:50,670
<font color="#E5E5E5">factor anyway and you can do it two ways</font>

800
00:33:47,450 --> 00:33:54,480
<font color="#E5E5E5">typically it's the temporal changing</font>

801
00:33:50,670 --> 00:33:57,180
code<font color="#E5E5E5"> but you can also use</font><font color="#CCCCCC"> 509 a DFS</font>

802
00:33:54,480 --> 00:33:59,790
certificates which I also recommend

803
00:33:57,180 --> 00:34:01,890
having<font color="#E5E5E5"> both of</font><font color="#CCCCCC"> them reason are because</font>

804
00:33:59,790 --> 00:34:04,620
like I was alluding<font color="#CCCCCC"> to earlier there are</font>

805
00:34:01,890 --> 00:34:07,800
rumors the legacy<font color="#CCCCCC"> api's</font><font color="#E5E5E5"> that are built</font>

806
00:34:04,620 --> 00:34:09,719
<font color="#E5E5E5">into office</font><font color="#CCCCCC"> 365 and Microsoft Exchange</font>

807
00:34:07,800 --> 00:34:14,009
<font color="#E5E5E5">specifically the web services and</font>

808
00:34:09,719 --> 00:34:15,989
<font color="#CCCCCC">Exchange API might allow attackers</font><font color="#E5E5E5"> to</font>

809
00:34:14,010 --> 00:34:18,480
bypass two-factor authentication in

810
00:34:15,989 --> 00:34:21,899
specific<font color="#CCCCCC"> circumstances where federated</font>

811
00:34:18,480 --> 00:34:23,460
SSO is not properly configured this is

812
00:34:21,900 --> 00:34:25,050
not something that<font color="#E5E5E5"> I have completely</font>

813
00:34:23,460 --> 00:34:27,870
<font color="#E5E5E5">confirmed yet it's something that has to</font>

814
00:34:25,050 --> 00:34:29,280
<font color="#CCCCCC">be</font><font color="#E5E5E5"> dug into but if it does exist you can</font>

815
00:34:27,870 --> 00:34:31,020
be absolutely<font color="#E5E5E5"> sure that I'm going</font><font color="#CCCCCC"> to</font>

816
00:34:29,280 --> 00:34:34,590
incorporate it<font color="#CCCCCC"> into this tool because</font>

817
00:34:31,020 --> 00:34:36,150
that would be really cool the other

818
00:34:34,590 --> 00:34:38,340
<font color="#E5E5E5">thing that you can do</font><font color="#CCCCCC"> as a defender is</font>

819
00:34:36,150 --> 00:34:42,240
to disable PowerShell access to<font color="#CCCCCC"> office</font>

820
00:34:38,340 --> 00:34:44,550
365 exchange for the<font color="#E5E5E5"> end user because on</font>

821
00:34:42,239 --> 00:34:46,639
average<font color="#E5E5E5"> most send users are not going</font><font color="#CCCCCC"> to</font>

822
00:34:44,550 --> 00:34:50,730
use PowerShell they really<font color="#E5E5E5"> don't need it</font>

823
00:34:46,639 --> 00:34:52,129
<font color="#CCCCCC">and it's</font><font color="#E5E5E5"> just good</font><font color="#CCCCCC"> practice</font><font color="#E5E5E5"> in keeping</font>

824
00:34:50,730 --> 00:34:54,570
<font color="#CCCCCC">with the principle</font><font color="#E5E5E5"> of least privilege</font>

825
00:34:52,130 --> 00:34:56,700
<font color="#CCCCCC">it's just not something that</font><font color="#E5E5E5"> everybody</font>

826
00:34:54,570 --> 00:34:59,070
has<font color="#CCCCCC"> to</font><font color="#E5E5E5"> have access to PowerShell is</font>

827
00:34:56,699 --> 00:35:01,379
extremely powerful despite my misgivings

828
00:34:59,070 --> 00:35:03,390
with it it's I have<font color="#E5E5E5"> to acknowledge that</font>

829
00:35:01,380 --> 00:35:07,770
<font color="#E5E5E5">it allows you to do a lot of different</font>

830
00:35:03,390 --> 00:35:10,560
<font color="#CCCCCC">things secondary</font><font color="#E5E5E5"> is to disable the</font>

831
00:35:07,770 --> 00:35:13,050
office graph<font color="#E5E5E5"> and</font><font color="#CCCCCC"> REST</font><font color="#E5E5E5"> API if you're not</font>

832
00:35:10,560 --> 00:35:14,759
using it<font color="#CCCCCC"> if you're not a developer</font>

833
00:35:13,050 --> 00:35:16,650
that's working with<font color="#CCCCCC"> exchange in office</font>

834
00:35:14,760 --> 00:35:19,650
<font color="#CCCCCC">365 you definitely</font><font color="#E5E5E5"> don't need that</font>

835
00:35:16,650 --> 00:35:21,390
<font color="#CCCCCC">either</font><font color="#E5E5E5"> and that is another area</font><font color="#CCCCCC"> where</font>

836
00:35:19,650 --> 00:35:26,789
there's the<font color="#E5E5E5"> potential for that</font><font color="#CCCCCC"> to factor</font>

837
00:35:21,390 --> 00:35:28,500
I pass<font color="#E5E5E5"> so thanks</font><font color="#CCCCCC"> to Microsoft I truly</font>

838
00:35:26,789 --> 00:35:31,349
believe that<font color="#E5E5E5"> feature abuse is still</font>

839
00:35:28,500 --> 00:35:32,970
alive<font color="#CCCCCC"> and</font><font color="#E5E5E5"> well there's anything that</font><font color="#CCCCCC"> I</font>

840
00:35:31,349 --> 00:35:35,369
like everybody<font color="#E5E5E5"> to take away from this</font>

841
00:35:32,970 --> 00:35:37,558
talk<font color="#E5E5E5"> is</font><font color="#CCCCCC"> that these features are not</font>

842
00:35:35,369 --> 00:35:39,930
likely to<font color="#E5E5E5"> go away and keep in</font><font color="#CCCCCC"> mind that</font>

843
00:35:37,559 --> 00:35:42,390
my research into this is still<font color="#E5E5E5"> only</font>

844
00:35:39,930 --> 00:35:44,759
scratching the<font color="#CCCCCC"> surface this goes way</font>

845
00:35:42,390 --> 00:35:47,308
deeper<font color="#E5E5E5"> I haven't even touched the</font><font color="#CCCCCC"> api's</font>

846
00:35:44,760 --> 00:35:48,630
<font color="#E5E5E5">really</font><font color="#CCCCCC"> there's a</font><font color="#E5E5E5"> lot of other things</font>

847
00:35:47,309 --> 00:35:50,430
that<font color="#CCCCCC"> you can play with in the.net</font>

848
00:35:48,630 --> 00:35:53,339
framework that give you access to all<font color="#E5E5E5"> of</font>

849
00:35:50,430 --> 00:35:54,660
<font color="#E5E5E5">these items</font><font color="#CCCCCC"> and many many other</font>

850
00:35:53,339 --> 00:35:56,549
<font color="#E5E5E5">potential things that might lead to</font>

851
00:35:54,660 --> 00:35:58,799
<font color="#CCCCCC">other vulnerabilities later on down</font><font color="#E5E5E5"> the</font>

852
00:35:56,549 --> 00:36:01,500
<font color="#CCCCCC">road it seems like every now and then a</font>

853
00:35:58,799 --> 00:36:03,809
new vulnerability wants every one or two

854
00:36:01,500 --> 00:36:06,299
<font color="#CCCCCC">years oh it's the worst ulnar ability</font>

855
00:36:03,809 --> 00:36:07,140
that's ever come<font color="#CCCCCC"> out for office 365 this</font>

856
00:36:06,299 --> 00:36:10,470
is terrible

857
00:36:07,140 --> 00:36:11,910
Microsoft should be so ashamed<font color="#CCCCCC"> it's I</font>

858
00:36:10,470 --> 00:36:14,279
<font color="#E5E5E5">mean</font><font color="#CCCCCC"> it's just</font><font color="#E5E5E5"> part of the development</font>

859
00:36:11,910 --> 00:36:16,348
<font color="#CCCCCC">lifecycle you find a bug you</font><font color="#E5E5E5"> fix it and</font>

860
00:36:14,279 --> 00:36:18,119
you<font color="#E5E5E5"> move on with</font><font color="#CCCCCC"> your life but there's</font>

861
00:36:16,349 --> 00:36:21,210
probably<font color="#E5E5E5"> other</font><font color="#CCCCCC"> things wrong with this</font>

862
00:36:18,119 --> 00:36:24,119
model<font color="#E5E5E5"> that are there in the code we</font><font color="#CCCCCC"> just</font>

863
00:36:21,210 --> 00:36:25,589
have to go in there and find it so for

864
00:36:24,119 --> 00:36:27,450
the<font color="#CCCCCC"> penetration testers and red teamers</font>

865
00:36:25,589 --> 00:36:31,200
in this room<font color="#CCCCCC"> I advise you</font><font color="#E5E5E5"> not to ignore</font>

866
00:36:27,450 --> 00:36:32,700
<font color="#CCCCCC">the cloud as a potential in</font><font color="#E5E5E5"> it has a lot</font>

867
00:36:31,200 --> 00:36:34,049
of<font color="#CCCCCC"> information available to you and</font>

868
00:36:32,700 --> 00:36:37,019
because you can log<font color="#CCCCCC"> into</font><font color="#E5E5E5"> it from</font>

869
00:36:34,049 --> 00:36:39,299
<font color="#E5E5E5">anywhere it's not locked down by white</font>

870
00:36:37,019 --> 00:36:41,308
<font color="#E5E5E5">listing for example by default</font><font color="#CCCCCC"> so</font>

871
00:36:39,299 --> 00:36:44,220
there's a good<font color="#E5E5E5"> chance that you may be</font>

872
00:36:41,309 --> 00:36:45,960
able to<font color="#CCCCCC"> use that</font><font color="#E5E5E5"> as your</font><font color="#CCCCCC"> road in and for</font>

873
00:36:44,220 --> 00:36:48,359
administrators<font color="#E5E5E5"> don't ignore the cloud</font>

874
00:36:45,960 --> 00:36:50,279
because that that<font color="#E5E5E5"> is</font><font color="#CCCCCC"> exactly what an</font>

875
00:36:48,359 --> 00:36:52,288
attacker<font color="#E5E5E5"> should be looking at it's</font>

876
00:36:50,279 --> 00:36:53,789
available<font color="#E5E5E5"> anywhere they can log</font><font color="#CCCCCC"> into</font><font color="#E5E5E5"> it</font>

877
00:36:52,289 --> 00:36:56,640
from<font color="#E5E5E5"> anywhere</font><font color="#CCCCCC"> it's something</font><font color="#E5E5E5"> that should</font>

878
00:36:53,789 --> 00:36:58,920
<font color="#CCCCCC">be locked</font><font color="#E5E5E5"> down by</font><font color="#CCCCCC"> white listing</font><font color="#E5E5E5"> 5:09</font>

879
00:36:56,640 --> 00:37:00,660
certificates<font color="#CCCCCC"> two-factor authentication</font>

880
00:36:58,920 --> 00:37:02,400
for sure I believe<font color="#E5E5E5"> that that's</font>

881
00:37:00,660 --> 00:37:05,069
<font color="#CCCCCC">absolutely a must</font><font color="#E5E5E5"> these days because</font>

882
00:37:02,400 --> 00:37:12,089
<font color="#CCCCCC">user credentials have</font><font color="#E5E5E5"> been by and large</font>

883
00:37:05,069 --> 00:37:14,579
not reliable or strong so if you would

884
00:37:12,089 --> 00:37:16,558
like<font color="#E5E5E5"> to jump into this and get</font>

885
00:37:14,579 --> 00:37:18,390
<font color="#E5E5E5">interested in this tool that</font><font color="#CCCCCC"> I've</font>

886
00:37:16,559 --> 00:37:23,279
created<font color="#E5E5E5"> it's available up on my github</font>

887
00:37:18,390 --> 00:37:26,009
<font color="#E5E5E5">true - demon slash</font><font color="#CCCCCC"> Raindance feel</font><font color="#E5E5E5"> free</font>

888
00:37:23,279 --> 00:37:29,069
to throw<font color="#E5E5E5"> me any issues or pull requests</font>

889
00:37:26,009 --> 00:37:32,009
<font color="#E5E5E5">I thoroughly enjoy getting feedback and</font>

890
00:37:29,069 --> 00:37:33,569
grilled on my code<font color="#E5E5E5"> so</font><font color="#CCCCCC"> if you have</font>

891
00:37:32,009 --> 00:37:34,950
<font color="#CCCCCC">anything that you would like</font><font color="#E5E5E5"> to add to</font>

892
00:37:33,569 --> 00:37:36,359
<font color="#CCCCCC">it</font><font color="#E5E5E5"> or if there's any</font>

893
00:37:34,950 --> 00:37:38,098
that you have a problem<font color="#E5E5E5"> with any bugs</font>

894
00:37:36,359 --> 00:37:40,980
<font color="#E5E5E5">you run into and I promise it will</font>

895
00:37:38,099 --> 00:37:42,869
probably be bugs<font color="#CCCCCC"> please let me</font><font color="#E5E5E5"> know I'm</font>

896
00:37:40,980 --> 00:37:44,430
going<font color="#E5E5E5"> to continue working on this long</font>

897
00:37:42,869 --> 00:37:45,930
into the<font color="#CCCCCC"> future and if you'd like</font><font color="#E5E5E5"> to get</font>

898
00:37:44,430 --> 00:37:48,660
in<font color="#CCCCCC"> touch with</font><font color="#E5E5E5"> me directly you</font><font color="#CCCCCC"> can</font>

899
00:37:45,930 --> 00:37:52,770
contact<font color="#E5E5E5"> me on</font><font color="#CCCCCC"> my github or at my email</font>

900
00:37:48,660 --> 00:38:03,810
address down here does anybody have<font color="#E5E5E5"> any</font>

901
00:37:52,770 --> 00:38:06,540
questions<font color="#CCCCCC"> yes</font><font color="#E5E5E5"> so the question was is can</font>

902
00:38:03,810 --> 00:38:09,359
you dump the<font color="#CCCCCC"> CSVs into kingfisher format</font>

903
00:38:06,540 --> 00:38:11,369
<font color="#E5E5E5">currently I</font><font color="#CCCCCC"> don't have a specific</font><font color="#E5E5E5"> format</font>

904
00:38:09,359 --> 00:38:13,650
set<font color="#E5E5E5"> up for it but like I said everything</font>

905
00:38:11,369 --> 00:38:15,990
<font color="#E5E5E5">is in a PowerShell object so you do</font><font color="#CCCCCC"> have</font>

906
00:38:13,650 --> 00:38:18,030
access<font color="#E5E5E5"> to specifically</font><font color="#CCCCCC"> user names</font><font color="#E5E5E5"> first</font>

907
00:38:15,990 --> 00:38:19,979
<font color="#E5E5E5">name last name and those are easily</font>

908
00:38:18,030 --> 00:38:23,190
referenced in the<font color="#CCCCCC"> objects so if you did</font>

909
00:38:19,980 --> 00:38:25,280
<font color="#E5E5E5">want to do that there's a PowerShell</font><font color="#CCCCCC"> is</font>

910
00:38:23,190 --> 00:38:27,810
pretty<font color="#CCCCCC"> well-documented so you could</font><font color="#E5E5E5"> just</font>

911
00:38:25,280 --> 00:38:31,290
specify the objects<font color="#CCCCCC"> that you want</font><font color="#E5E5E5"> in</font>

912
00:38:27,810 --> 00:38:33,210
this<font color="#E5E5E5"> case it's documented in the in the</font>

913
00:38:31,290 --> 00:38:35,670
code<font color="#E5E5E5"> itself so you can pull</font><font color="#CCCCCC"> out the</font>

914
00:38:33,210 --> 00:38:38,010
<font color="#E5E5E5">object all the user objects and then</font>

915
00:38:35,670 --> 00:38:41,400
list out first name last<font color="#E5E5E5"> name email</font>

916
00:38:38,010 --> 00:38:52,380
<font color="#CCCCCC">address</font><font color="#E5E5E5"> and you can go on and move</font>

917
00:38:41,400 --> 00:38:54,060
forward yeah sure no I was not<font color="#E5E5E5"> able to</font>

918
00:38:52,380 --> 00:38:56,490
<font color="#E5E5E5">dump the hash table</font><font color="#CCCCCC"> I'm not even sure</font>

919
00:38:54,060 --> 00:38:59,849
<font color="#CCCCCC">that that's</font><font color="#E5E5E5"> necessarily possible reason</font>

920
00:38:56,490 --> 00:39:02,189
is<font color="#CCCCCC"> because in the</font><font color="#E5E5E5"> case of in the</font><font color="#CCCCCC"> case</font><font color="#E5E5E5"> of</font>

921
00:38:59,849 --> 00:39:03,930
a federal technically those<font color="#CCCCCC"> hashes still</font>

922
00:39:02,190 --> 00:39:06,060
live<font color="#CCCCCC"> on</font><font color="#E5E5E5"> the domain controller or at</font>

923
00:39:03,930 --> 00:39:07,470
least they should but I'm not<font color="#CCCCCC"> positive</font>

924
00:39:06,060 --> 00:39:09,569
in<font color="#CCCCCC"> that that's definitely something</font><font color="#E5E5E5"> that</font>

925
00:39:07,470 --> 00:39:11,459
<font color="#E5E5E5">could</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> looked into</font><font color="#CCCCCC"> but as far as</font><font color="#E5E5E5"> I</font>

926
00:39:09,569 --> 00:39:15,859
know there's<font color="#E5E5E5"> not a way to dump a hash</font>

927
00:39:11,460 --> 00:39:15,859
table<font color="#E5E5E5"> for the user passwords</font>

928
00:39:24,590 --> 00:39:30,619
so that is<font color="#E5E5E5"> mostly</font><font color="#CCCCCC"> just the</font><font color="#E5E5E5"> it is just</font>

929
00:39:29,000 --> 00:39:33,080
the ones that<font color="#CCCCCC"> you have</font><font color="#E5E5E5"> access</font><font color="#CCCCCC"> to so the</font>

930
00:39:30,619 --> 00:39:36,890
question was is when you access through

931
00:39:33,080 --> 00:39:41,109
<font color="#E5E5E5">PowerShell as a specific user do you</font>

932
00:39:36,890 --> 00:39:45,080
have access<font color="#E5E5E5"> to other</font><font color="#CCCCCC"> objects or other</font>

933
00:39:41,109 --> 00:39:47,330
<font color="#CCCCCC">tenants</font><font color="#E5E5E5"> as that user it does depend on</font>

934
00:39:45,080 --> 00:39:49,759
access controls generally there aren't

935
00:39:47,330 --> 00:39:51,170
any by default<font color="#CCCCCC"> but there's only what</font>

936
00:39:49,760 --> 00:39:52,760
<font color="#CCCCCC">you're licensed for is what you're</font>

937
00:39:51,170 --> 00:39:56,840
allowed<font color="#CCCCCC"> to access</font><font color="#E5E5E5"> so if the user only</font>

938
00:39:52,760 --> 00:40:00,260
<font color="#CCCCCC">has access to exchange and</font><font color="#E5E5E5"> their office</font>

939
00:39:56,840 --> 00:40:01,849
365 you know Word Excel so on<font color="#E5E5E5"> you're not</font>

940
00:40:00,260 --> 00:40:03,980
<font color="#E5E5E5">allowed to touch delve or you're not</font>

941
00:40:01,849 --> 00:40:08,660
<font color="#CCCCCC">allowed to</font><font color="#E5E5E5"> touch SharePoint sites</font><font color="#CCCCCC"> those</font>

942
00:40:03,980 --> 00:40:12,440
are still separated by<font color="#E5E5E5"> those are still</font>

943
00:40:08,660 --> 00:40:14,509
separated<font color="#CCCCCC"> by one the users permissions</font>

944
00:40:12,440 --> 00:40:21,550
to those sites and objects<font color="#E5E5E5"> and to</font>

945
00:40:14,510 --> 00:40:21,550
whether they're licensed for them yeah

946
00:40:25,030 --> 00:40:28,900
sorry I'm<font color="#E5E5E5"> having</font><font color="#CCCCCC"> trouble hearing</font><font color="#E5E5E5"> you</font>

947
00:40:41,750 --> 00:40:46,580
the<font color="#E5E5E5"> easiest thing to do okay so the</font>

948
00:40:44,090 --> 00:40:48,260
<font color="#CCCCCC">question was is I as of regular user I</font>

949
00:40:46,580 --> 00:40:51,710
was able<font color="#E5E5E5"> to dump out all</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the user</font>

950
00:40:48,260 --> 00:40:53,359
names from the<font color="#E5E5E5"> domain</font><font color="#CCCCCC"> and is there any</font>

951
00:40:51,710 --> 00:40:55,040
way to<font color="#CCCCCC"> mitigate that</font><font color="#E5E5E5"> so that users</font>

952
00:40:53,359 --> 00:40:56,840
specifically are not allowed<font color="#E5E5E5"> to do that</font>

953
00:40:55,040 --> 00:40:58,849
<font color="#E5E5E5">I'm not sure if you can specifically</font>

954
00:40:56,840 --> 00:41:00,260
restrict<font color="#E5E5E5"> users from certain PowerShell</font>

955
00:40:58,849 --> 00:41:02,720
commands but you can at the very<font color="#E5E5E5"> least</font>

956
00:41:00,260 --> 00:41:05,090
stop users from accessing<font color="#CCCCCC"> PowerShell</font>

957
00:41:02,720 --> 00:41:19,549
<font color="#E5E5E5">altogether</font><font color="#CCCCCC"> you can stop</font><font color="#E5E5E5"> that access</font>

958
00:41:05,090 --> 00:41:21,530
within<font color="#E5E5E5"> office 365</font><font color="#CCCCCC"> I have to presume so</font>

959
00:41:19,550 --> 00:41:23,770
because if it for any<font color="#CCCCCC"> reason it fails it</font>

960
00:41:21,530 --> 00:41:26,320
<font color="#E5E5E5">always threw me errors about Federation</font>

961
00:41:23,770 --> 00:41:30,050
<font color="#E5E5E5">metadata mismatches and stuff like that</font>

962
00:41:26,320 --> 00:41:31,760
<font color="#E5E5E5">it's I said still cursory research but</font>

963
00:41:30,050 --> 00:41:42,430
it might all the indications point to

964
00:41:31,760 --> 00:41:42,430
yes I'm<font color="#E5E5E5"> sorry could you say</font><font color="#CCCCCC"> that again</font>

965
00:41:44,260 --> 00:41:50,500
<font color="#E5E5E5">yeah in this case</font><font color="#CCCCCC"> it wasn't he was</font>

966
00:41:48,589 --> 00:41:52,339
saying that he didn't<font color="#E5E5E5"> think that</font>

967
00:41:50,500 --> 00:41:55,430
passwords were<font color="#E5E5E5"> changed if they were</font>

968
00:41:52,339 --> 00:41:57,320
federated<font color="#E5E5E5"> in this case a lot of the</font>

969
00:41:55,430 --> 00:41:59,270
users<font color="#CCCCCC"> that</font><font color="#E5E5E5"> you were seeing here weren't</font>

970
00:41:57,320 --> 00:42:01,400
even on the<font color="#E5E5E5"> local domain I know that</font>

971
00:41:59,270 --> 00:42:03,050
because<font color="#E5E5E5"> I know</font><font color="#CCCCCC"> what this domain was and</font>

972
00:42:01,400 --> 00:42:05,240
I'm<font color="#E5E5E5"> sorry I can't tell you more about it</font>

973
00:42:03,050 --> 00:42:07,099
<font color="#E5E5E5">but the environment was specifically is</font>

974
00:42:05,240 --> 00:42:08,899
<font color="#CCCCCC">that there's on domain users and then</font>

975
00:42:07,099 --> 00:42:12,109
<font color="#CCCCCC">when there were thousands</font><font color="#E5E5E5"> and thousands</font>

976
00:42:08,900 --> 00:42:13,910
and thousands<font color="#E5E5E5"> of not non domain users so</font>

977
00:42:12,109 --> 00:42:17,119
there was a<font color="#E5E5E5"> specific separation there</font>

978
00:42:13,910 --> 00:42:19,848
but ordinarily what you will see<font color="#E5E5E5"> in</font>

979
00:42:17,119 --> 00:42:22,280
production<font color="#CCCCCC"> environments is that all</font>

980
00:42:19,849 --> 00:42:24,650
users<font color="#E5E5E5"> on the domain will also be</font>

981
00:42:22,280 --> 00:42:40,010
federated to office<font color="#CCCCCC"> 365</font><font color="#E5E5E5"> and those</font>

982
00:42:24,650 --> 00:42:42,200
<font color="#E5E5E5">credentials do get shared that is an</font>

983
00:42:40,010 --> 00:42:45,650
interesting<font color="#E5E5E5"> question</font><font color="#CCCCCC"> so the question was</font>

984
00:42:42,200 --> 00:42:48,049
if I send an<font color="#CCCCCC"> email as another</font><font color="#E5E5E5"> user does</font>

985
00:42:45,650 --> 00:42:49,880
that create<font color="#E5E5E5"> a log I am</font><font color="#CCCCCC"> not sure because</font>

986
00:42:48,050 --> 00:42:51,589
I didn't actually have access<font color="#E5E5E5"> to</font><font color="#CCCCCC"> the</font>

987
00:42:49,880 --> 00:42:53,740
administrative<font color="#CCCCCC"> interface of this</font><font color="#E5E5E5"> domain</font>

988
00:42:51,589 --> 00:42:55,240
so I could not<font color="#E5E5E5"> confirm that</font>

989
00:42:53,740 --> 00:42:56,439
and that's the<font color="#E5E5E5"> struggle with this</font>

990
00:42:55,240 --> 00:42:58,540
research is<font color="#CCCCCC"> that it's extremely</font>

991
00:42:56,440 --> 00:43:00,850
<font color="#E5E5E5">expensive and I cannot afford an</font>

992
00:42:58,540 --> 00:43:02,380
enterprise edition of<font color="#E5E5E5"> office 365 because</font>

993
00:43:00,850 --> 00:43:04,420
I just<font color="#E5E5E5"> don't have a thousand dollars</font>

994
00:43:02,380 --> 00:43:05,800
<font color="#CCCCCC">lying around that would be really</font>

995
00:43:04,420 --> 00:43:08,130
awesome if somebody wanted<font color="#E5E5E5"> to give me</font>

996
00:43:05,800 --> 00:43:11,269
that but I<font color="#CCCCCC"> doubt that's going</font><font color="#E5E5E5"> to happen</font>

997
00:43:08,130 --> 00:43:11,269
[Music]

998
00:43:15,830 --> 00:43:42,430
[Music]

999
00:43:18,450 --> 00:43:46,419
sorry<font color="#CCCCCC"> okay</font>

1000
00:43:42,430 --> 00:43:48,700
so the question is is if essentially

1001
00:43:46,420 --> 00:43:49,960
what you're<font color="#CCCCCC"> saying is if I were</font><font color="#E5E5E5"> to play</font>

1002
00:43:48,700 --> 00:43:52,720
with the way that<font color="#E5E5E5"> the email</font><font color="#CCCCCC"> was</font>

1003
00:43:49,960 --> 00:43:54,490
generated or you know other<font color="#E5E5E5"> if I were to</font>

1004
00:43:52,720 --> 00:43:56,740
use obscure commands would that generate

1005
00:43:54,490 --> 00:43:58,479
less obvious<font color="#E5E5E5"> logs so that the</font>

1006
00:43:56,740 --> 00:44:00,819
administrator wouldn't be able<font color="#E5E5E5"> to pick</font>

1007
00:43:58,480 --> 00:44:06,070
up<font color="#E5E5E5"> on that is that essentially what</font>

1008
00:44:00,820 --> 00:44:08,800
you're<font color="#E5E5E5"> saying importing an email object</font>

1009
00:44:06,070 --> 00:44:10,570
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> yeah I'm not entirely sure I wasn't</font>

1010
00:44:08,800 --> 00:44:12,280
<font color="#CCCCCC">able to see any of the logs that I was</font>

1011
00:44:10,570 --> 00:44:14,920
generating as I was doing<font color="#CCCCCC"> this</font>

1012
00:44:12,280 --> 00:44:16,690
specifically<font color="#CCCCCC"> a lot of my experience</font>

1013
00:44:14,920 --> 00:44:18,730
about the logs being generated is based

1014
00:44:16,690 --> 00:44:20,260
on my experience<font color="#CCCCCC"> as an office 365</font>

1015
00:44:18,730 --> 00:44:23,410
administrator previously where I

1016
00:44:20,260 --> 00:44:25,420
compared me referencing all the users

1017
00:44:23,410 --> 00:44:28,270
<font color="#CCCCCC">and I didn't see that</font><font color="#E5E5E5"> happening in the</font>

1018
00:44:25,420 --> 00:44:33,220
logs<font color="#E5E5E5"> granted that information is a year</font>

1019
00:44:28,270 --> 00:44:37,090
old now<font color="#CCCCCC"> and may no longer be</font><font color="#E5E5E5"> relevant in</font>

1020
00:44:33,220 --> 00:44:38,680
which case I would really<font color="#E5E5E5"> suggest if you</font>

1021
00:44:37,090 --> 00:44:40,750
if you do<font color="#E5E5E5"> have a tenant</font><font color="#CCCCCC"> I would be</font>

1022
00:44:38,680 --> 00:44:42,970
extremely<font color="#E5E5E5"> thankful if you were to let me</font>

1023
00:44:40,750 --> 00:44:45,970
<font color="#E5E5E5">know what these commands do generate in</font>

1024
00:44:42,970 --> 00:44:47,709
the logs<font color="#CCCCCC"> that would go really far</font><font color="#E5E5E5"> into</font>

1025
00:44:45,970 --> 00:44:49,689
you know pointing me in the direction of

1026
00:44:47,710 --> 00:44:52,090
<font color="#E5E5E5">where I can</font><font color="#CCCCCC"> go and what other commands</font>

1027
00:44:49,690 --> 00:44:54,510
we<font color="#CCCCCC"> can run in order to</font><font color="#E5E5E5"> avoid generating</font>

1028
00:44:52,090 --> 00:44:54,510
those logs

1029
00:44:55,369 --> 00:45:06,829
I don't know that<font color="#E5E5E5"> yeah unfortunately</font><font color="#CCCCCC"> I</font>

1030
00:45:04,880 --> 00:45:11,509
don't<font color="#E5E5E5"> know that the organization didn't</font>

1031
00:45:06,829 --> 00:45:13,339
actually<font color="#E5E5E5"> they didn't admit to seeing any</font>

1032
00:45:11,509 --> 00:45:15,799
of<font color="#E5E5E5"> this traffic that was being generated</font>

1033
00:45:13,339 --> 00:45:18,308
when I did this<font color="#CCCCCC"> originally</font><font color="#E5E5E5"> so there's no</font>

1034
00:45:15,799 --> 00:45:21,680
way<font color="#CCCCCC"> for me to know what the</font><font color="#E5E5E5"> logs said or</font>

1035
00:45:18,309 --> 00:45:24,640
what they were able<font color="#E5E5E5"> to see or if they</font>

1036
00:45:21,680 --> 00:45:24,640
had<font color="#E5E5E5"> overlooked</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> somehow</font>

1037
00:45:27,070 --> 00:45:30,189
[Music]

1038
00:45:32,230 --> 00:45:51,859
<font color="#CCCCCC">okay</font><font color="#E5E5E5"> okay okay thank you so he just</font>

1039
00:45:49,430 --> 00:45:54,558
mentioned<font color="#E5E5E5"> that a lot</font><font color="#CCCCCC"> of logs in office</font>

1040
00:45:51,859 --> 00:45:57,170
365<font color="#CCCCCC"> are turned off by default which</font>

1041
00:45:54,559 --> 00:45:59,150
that's really interesting<font color="#CCCCCC"> this so</font>

1042
00:45:57,170 --> 00:46:00,499
there's it is reasonable assumption<font color="#CCCCCC"> to</font>

1043
00:45:59,150 --> 00:46:03,109
make<font color="#CCCCCC"> that there are a lot of logs</font>

1044
00:46:00,499 --> 00:46:04,640
available in office<font color="#CCCCCC"> 365 Microsoft</font><font color="#E5E5E5"> has</font>

1045
00:46:03,109 --> 00:46:07,130
been<font color="#E5E5E5"> building a lot of this for a long</font>

1046
00:46:04,640 --> 00:46:09,440
<font color="#CCCCCC">time</font><font color="#E5E5E5"> so all</font><font color="#CCCCCC"> of this stuff</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> probably</font>

1047
00:46:07,130 --> 00:46:11,329
generating logs<font color="#E5E5E5"> somewhere it's just in</font>

1048
00:46:09,440 --> 00:46:14,089
my<font color="#CCCCCC"> experience after</font><font color="#E5E5E5"> using these</font>

1049
00:46:11,329 --> 00:46:16,700
techniques<font color="#E5E5E5"> is that nobody notices</font><font color="#CCCCCC"> so I</font>

1050
00:46:14,089 --> 00:46:19,339
did<font color="#E5E5E5"> want to you know make that caveat is</font>

1051
00:46:16,700 --> 00:46:22,098
that<font color="#E5E5E5"> you might be generating an absolute</font>

1052
00:46:19,339 --> 00:46:25,640
ton<font color="#E5E5E5"> of traffic for all I know is</font><font color="#CCCCCC"> just</font>

1053
00:46:22,099 --> 00:46:27,950
that I haven't<font color="#E5E5E5"> seen anybody</font><font color="#CCCCCC"> put a sit or</font>

1054
00:46:25,640 --> 00:46:37,339
catch me or call<font color="#E5E5E5"> me out on it yeah go</font>

1055
00:46:27,950 --> 00:46:41,259
<font color="#E5E5E5">ahead yep</font><font color="#CCCCCC"> if you have to run a job in</font>

1056
00:46:37,339 --> 00:46:41,259
order<font color="#CCCCCC"> to turn</font><font color="#E5E5E5"> on logs for every user</font>

1057
00:46:52,480 --> 00:46:59,770
that's that's insane<font color="#E5E5E5"> okay so for anybody</font>

1058
00:46:56,990 --> 00:46:59,770
<font color="#E5E5E5">that didn't hear that</font>

1059
00:47:00,040 --> 00:47:05,570
apparently in order to turn on logs

1060
00:47:02,320 --> 00:47:09,230
<font color="#E5E5E5">specifically you have</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> actually you</font>

1061
00:47:05,570 --> 00:47:11,450
have to turn<font color="#E5E5E5"> on what logs are printed</font>

1062
00:47:09,230 --> 00:47:13,970
out for each and every user so you would

1063
00:47:11,450 --> 00:47:16,250
have<font color="#CCCCCC"> to go</font><font color="#E5E5E5"> into office 365</font><font color="#CCCCCC"> and go to</font>

1064
00:47:13,970 --> 00:47:19,098
user<font color="#CCCCCC"> one turn on the logs go to user to</font>

1065
00:47:16,250 --> 00:47:32,390
turn<font color="#CCCCCC"> them</font><font color="#E5E5E5"> off which that's baffling to</font>

1066
00:47:19,099 --> 00:47:35,410
me<font color="#E5E5E5"> but thank you unfortunately that's</font>

1067
00:47:32,390 --> 00:47:38,690
specific<font color="#E5E5E5"> okay so the question</font><font color="#CCCCCC"> was is the</font>

1068
00:47:35,410 --> 00:47:41,420
illusions that<font color="#E5E5E5"> I made about EWS and the</font>

1069
00:47:38,690 --> 00:47:44,900
API<font color="#E5E5E5"> is potentially being able to bypass</font>

1070
00:47:41,420 --> 00:47:47,510
multi-factor<font color="#E5E5E5"> often like I said before</font>

1071
00:47:44,900 --> 00:47:49,609
that's not confirmed<font color="#CCCCCC"> I don't know that</font>

1072
00:47:47,510 --> 00:47:52,760
for<font color="#E5E5E5"> sure</font><font color="#CCCCCC"> and I didn't have</font><font color="#E5E5E5"> enough time</font>

1073
00:47:49,609 --> 00:47:55,190
to dig into the<font color="#CCCCCC"> research for that</font><font color="#E5E5E5"> it's</font>

1074
00:47:52,760 --> 00:47:56,720
just based on rumors of<font color="#E5E5E5"> other security</font>

1075
00:47:55,190 --> 00:48:00,800
researchers<font color="#E5E5E5"> that</font><font color="#CCCCCC"> have been</font><font color="#E5E5E5"> talking about</font>

1076
00:47:56,720 --> 00:48:03,080
it and had proof of concept examples how

1077
00:48:00,800 --> 00:48:05,630
they were able<font color="#CCCCCC"> to</font><font color="#E5E5E5"> just throw</font><font color="#CCCCCC"> in an API</font>

1078
00:48:03,080 --> 00:48:08,839
key and just access<font color="#CCCCCC"> it through</font><font color="#E5E5E5"> the</font>

1079
00:48:05,630 --> 00:48:11,240
specifically<font color="#E5E5E5"> the</font><font color="#CCCCCC"> Web Services API</font><font color="#E5E5E5"> which</font>

1080
00:48:08,839 --> 00:48:13,520
is built into office<font color="#E5E5E5"> but I didn't</font>

1081
00:48:11,240 --> 00:48:15,618
actually see<font color="#E5E5E5"> it happen in</font><font color="#CCCCCC"> practice or</font>

1082
00:48:13,520 --> 00:48:17,599
production<font color="#E5E5E5"> so I don't know that that</font>

1083
00:48:15,619 --> 00:48:19,880
still works or if it ever worked there's

1084
00:48:17,599 --> 00:48:30,160
a lot of people<font color="#E5E5E5"> talking</font><font color="#CCCCCC"> about it but I</font>

1085
00:48:19,880 --> 00:48:32,990
have not<font color="#E5E5E5"> seen that</font><font color="#CCCCCC"> myself</font><font color="#E5E5E5"> all right well</font>

1086
00:48:30,160 --> 00:48:35,118
thanks for<font color="#E5E5E5"> watching</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> hope that you guys</font>

1087
00:48:32,990 --> 00:48:36,740
enjoyed the talk and if you want to

1088
00:48:35,119 --> 00:48:39,680
<font color="#CCCCCC">contribute to the tool I</font><font color="#E5E5E5"> would really</font>

1089
00:48:36,740 --> 00:48:42,009
<font color="#CCCCCC">appreciate it so go</font><font color="#E5E5E5"> out there</font><font color="#CCCCCC"> and make</font>

1090
00:48:39,680 --> 00:48:42,009
it<font color="#E5E5E5"> rain</font>

