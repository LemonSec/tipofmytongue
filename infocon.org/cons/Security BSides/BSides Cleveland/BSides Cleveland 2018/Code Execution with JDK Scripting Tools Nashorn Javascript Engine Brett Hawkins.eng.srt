1
00:00:00,510 --> 00:00:03,599
[Music]

2
00:00:05,870 --> 00:00:12,570
<font color="#E5E5E5">all right well welcome</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> my talk</font><font color="#CCCCCC"> code</font>

3
00:00:10,469 --> 00:00:14,610
execution with<font color="#E5E5E5"> JDK scripting tools and</font>

4
00:00:12,570 --> 00:00:17,520
the<font color="#E5E5E5"> nation JavaScript engine</font>

5
00:00:14,610 --> 00:00:18,029
I'm<font color="#E5E5E5"> Brett Hawkins just showing hands</font>

6
00:00:17,520 --> 00:00:20,698
real<font color="#CCCCCC"> quick</font>

7
00:00:18,029 --> 00:00:22,619
who here<font color="#CCCCCC"> is primarily on the offense</font>

8
00:00:20,699 --> 00:00:23,840
whether<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> pen testing</font><font color="#E5E5E5"> red teaming</font>

9
00:00:22,619 --> 00:00:26,939
except to raise your<font color="#E5E5E5"> hands</font>

10
00:00:23,840 --> 00:00:30,000
okay how about defenders<font color="#E5E5E5"> whether it's</font>

11
00:00:26,939 --> 00:00:31,259
<font color="#CCCCCC">secured engineering sock forensics</font><font color="#E5E5E5"> and</font>

12
00:00:30,000 --> 00:00:31,740
how<font color="#E5E5E5"> about purple</font><font color="#CCCCCC"> teamers a little bit of</font>

13
00:00:31,260 --> 00:00:33,930
both

14
00:00:31,740 --> 00:00:37,949
<font color="#E5E5E5">all right so this talk should actually</font>

15
00:00:33,930 --> 00:00:42,629
be good<font color="#CCCCCC"> for everybody so let's get</font>

16
00:00:37,950 --> 00:00:43,860
<font color="#CCCCCC">started so just a disclaimer those</font>

17
00:00:42,629 --> 00:00:45,960
researchers<font color="#CCCCCC"> are</font><font color="#E5E5E5"> done in my</font><font color="#CCCCCC"> own personal</font>

18
00:00:43,860 --> 00:00:49,730
time<font color="#E5E5E5"> no way fill away with my employer</font>

19
00:00:45,960 --> 00:00:52,620
<font color="#CCCCCC">all views and opinions are my own a</font>

20
00:00:49,730 --> 00:00:54,989
little<font color="#E5E5E5"> bit about me as I</font><font color="#CCCCCC"> said my name is</font>

21
00:00:52,620 --> 00:00:59,339
<font color="#E5E5E5">Brett born</font><font color="#CCCCCC"> and raised here</font><font color="#E5E5E5"> in Northeast</font>

22
00:00:54,989 --> 00:01:01,530
Ohio<font color="#E5E5E5"> go Cavs been an</font><font color="#CCCCCC"> InfoSec for about</font>

23
00:00:59,340 --> 00:01:03,920
seven years<font color="#E5E5E5"> and the private sector</font>

24
00:01:01,530 --> 00:01:06,060
worked<font color="#E5E5E5"> across from different industries</font>

25
00:01:03,920 --> 00:01:08,250
<font color="#CCCCCC">did my undergrad here in Northeast Ohio</font>

26
00:01:06,060 --> 00:01:11,010
as<font color="#CCCCCC"> well at University Akron</font>

27
00:01:08,250 --> 00:01:12,810
I did some post grad work at<font color="#CCCCCC"> sands as</font>

28
00:01:11,010 --> 00:01:17,540
well and then I have some certs from

29
00:01:12,810 --> 00:01:19,549
<font color="#CCCCCC">Sam's</font><font color="#E5E5E5"> offensive security in my free time</font>

30
00:01:17,540 --> 00:01:25,830
<font color="#CCCCCC">enjoy doing security research</font>

31
00:01:19,549 --> 00:01:27,210
<font color="#CCCCCC">programming sports video games so just</font>

32
00:01:25,830 --> 00:01:29,189
an outline of how<font color="#CCCCCC"> I</font><font color="#E5E5E5"> kind of this</font><font color="#CCCCCC"> toxin</font>

33
00:01:27,210 --> 00:01:32,309
<font color="#E5E5E5">ago</font><font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> gonna give a</font><font color="#CCCCCC"> high-level</font><font color="#E5E5E5"> overview</font>

34
00:01:29,189 --> 00:01:34,020
of<font color="#CCCCCC"> the Java demo development kit</font><font color="#E5E5E5"> very</font>

35
00:01:32,310 --> 00:01:35,130
high<font color="#CCCCCC"> level not going to go deep dive</font>

36
00:01:34,020 --> 00:01:36,899
into<font color="#E5E5E5"> the development kit just give you a</font>

37
00:01:35,130 --> 00:01:39,539
background<font color="#E5E5E5"> I'm</font><font color="#CCCCCC"> going to talk</font><font color="#E5E5E5"> about some</font>

38
00:01:36,900 --> 00:01:40,829
<font color="#CCCCCC">JDK scripting tools that I found</font><font color="#E5E5E5"> then</font>

39
00:01:39,540 --> 00:01:42,659
I'm gonna go through just<font color="#E5E5E5"> a high level</font>

40
00:01:40,829 --> 00:01:44,398
<font color="#CCCCCC">of the nature and JavaScript engine</font>

41
00:01:42,659 --> 00:01:46,470
again just kind<font color="#CCCCCC"> of a high-level</font><font color="#E5E5E5"> give you</font>

42
00:01:44,399 --> 00:01:49,170
a<font color="#CCCCCC"> background then I'm gonna go through</font>

43
00:01:46,470 --> 00:01:51,079
actual<font color="#E5E5E5"> actual practical usage and</font>

44
00:01:49,170 --> 00:01:53,430
examples from<font color="#E5E5E5"> an offensive standpoint</font>

45
00:01:51,079 --> 00:01:55,020
<font color="#E5E5E5">after that I'm going to show you the</font>

46
00:01:53,430 --> 00:01:57,479
defensive side and some detective and

47
00:01:55,020 --> 00:01:59,250
<font color="#CCCCCC">preventative controls that you can use</font>

48
00:01:57,479 --> 00:02:02,130
to try<font color="#E5E5E5"> to detect and</font><font color="#CCCCCC"> prevent these</font><font color="#E5E5E5"> of</font>

49
00:01:59,250 --> 00:02:04,350
these tools and then I'm gonna have some

50
00:02:02,130 --> 00:02:08,250
demos after that and then I'll take any

51
00:02:04,350 --> 00:02:12,090
questions<font color="#CCCCCC"> you guys have all right</font>

52
00:02:08,250 --> 00:02:14,310
so Java development kit what is it right

53
00:02:12,090 --> 00:02:17,160
it's a<font color="#E5E5E5"> fully featured software</font>

54
00:02:14,310 --> 00:02:19,709
development kit for<font color="#CCCCCC"> Java includes the</font>

55
00:02:17,160 --> 00:02:21,239
<font color="#E5E5E5">Java Runtime environment as well</font><font color="#CCCCCC"> you can</font>

56
00:02:19,709 --> 00:02:22,890
pretty much compare<font color="#CCCCCC"> it it's trying to</font>

57
00:02:21,239 --> 00:02:24,900
feel okay what can<font color="#E5E5E5"> I compare</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> to you</font>

58
00:02:22,890 --> 00:02:27,179
can kind<font color="#CCCCCC"> of compare it</font><font color="#E5E5E5"> to the the window</font>

59
00:02:24,900 --> 00:02:29,250
<font color="#E5E5E5">the dinette framework SDK for developing</font>

60
00:02:27,180 --> 00:02:32,519
<font color="#CCCCCC">net applications well you can</font><font color="#E5E5E5"> kind of</font>

61
00:02:29,250 --> 00:02:35,160
compare<font color="#E5E5E5"> it to so what's the</font><font color="#CCCCCC"> difference</font>

62
00:02:32,519 --> 00:02:37,049
<font color="#E5E5E5">between the Java development</font><font color="#CCCCCC"> kit</font><font color="#E5E5E5"> and the</font>

63
00:02:35,160 --> 00:02:39,090
<font color="#CCCCCC">Java runtime environment right so Java</font>

64
00:02:37,049 --> 00:02:41,879
development kit is typically used if you

65
00:02:39,090 --> 00:02:43,530
do<font color="#E5E5E5"> Java programming</font><font color="#CCCCCC"> also if you have</font>

66
00:02:41,879 --> 00:02:45,780
something<font color="#CCCCCC"> like</font><font color="#E5E5E5"> a java web application</font>

67
00:02:43,530 --> 00:02:48,120
<font color="#E5E5E5">running on a server it might need to</font>

68
00:02:45,780 --> 00:02:50,910
<font color="#E5E5E5">have the java to milk it installed the</font>

69
00:02:48,120 --> 00:02:52,680
<font color="#E5E5E5">java runtime</font><font color="#CCCCCC"> environment</font><font color="#E5E5E5"> it's just a</font>

70
00:02:50,910 --> 00:02:54,720
<font color="#E5E5E5">virtual machine where</font><font color="#CCCCCC"> java programs run</font>

71
00:02:52,680 --> 00:02:57,269
on<font color="#E5E5E5"> could be browser plug-ins for like</font>

72
00:02:54,720 --> 00:02:58,859
<font color="#CCCCCC">java applets</font><font color="#E5E5E5"> this is used only if you</font>

73
00:02:57,269 --> 00:03:02,069
need<font color="#CCCCCC"> to be able to just run Java</font>

74
00:02:58,860 --> 00:03:04,230
programs<font color="#CCCCCC"> or in a browser your</font><font color="#E5E5E5"> regular</font>

75
00:03:02,069 --> 00:03:06,328
users<font color="#E5E5E5"> just need the Java</font><font color="#CCCCCC"> Runtime</font>

76
00:03:04,230 --> 00:03:08,010
environment<font color="#CCCCCC"> Bob from accounting does not</font>

77
00:03:06,329 --> 00:03:09,959
need the Java<font color="#E5E5E5"> development kit</font><font color="#CCCCCC"> installed</font>

78
00:03:08,010 --> 00:03:15,269
on his<font color="#E5E5E5"> machine he needs the Java</font><font color="#CCCCCC"> runtime</font>

79
00:03:09,959 --> 00:03:18,540
<font color="#CCCCCC">environment if you look at the kind of</font>

80
00:03:15,269 --> 00:03:22,290
the<font color="#E5E5E5"> JDK version history starting</font><font color="#CCCCCC"> with in</font>

81
00:03:18,540 --> 00:03:22,888
1995 the<font color="#E5E5E5"> JDK beta</font><font color="#CCCCCC"> and I got this from</font>

82
00:03:22,290 --> 00:03:26,670
Wikipedia

83
00:03:22,889 --> 00:03:29,519
<font color="#E5E5E5">so since early 1995 all the way to 2018</font>

84
00:03:26,670 --> 00:03:32,819
right so Java<font color="#E5E5E5"> 10 released and think like</font>

85
00:03:29,519 --> 00:03:34,019
March of this year<font color="#E5E5E5"> so this kind of lays</font>

86
00:03:32,819 --> 00:03:36,660
out the version history what we're<font color="#E5E5E5"> going</font>

87
00:03:34,019 --> 00:03:38,849
<font color="#CCCCCC">to be focusing on as far as JDK versions</font>

88
00:03:36,660 --> 00:03:40,620
with these these<font color="#E5E5E5"> tools and the nature</font>

89
00:03:38,849 --> 00:03:43,230
<font color="#E5E5E5">and JavaScript engine is gonna be</font>

90
00:03:40,620 --> 00:03:44,910
starting<font color="#E5E5E5"> with Java 6 Java 6 is when</font>

91
00:03:43,230 --> 00:03:46,679
you'll see one<font color="#E5E5E5"> of the tools</font><font color="#CCCCCC"> when</font><font color="#E5E5E5"> it was</font>

92
00:03:44,910 --> 00:03:49,889
introduced<font color="#E5E5E5"> and then the nation</font>

93
00:03:46,680 --> 00:03:52,139
<font color="#E5E5E5">JavaScript engine is when it was</font>

94
00:03:49,889 --> 00:03:53,340
introduced here with a Java 8<font color="#CCCCCC"> so that's</font>

95
00:03:52,139 --> 00:04:00,060
kind of where we're gonna focus you know

96
00:03:53,340 --> 00:04:01,739
nothing before<font color="#CCCCCC"> Java 6 all right so again</font>

97
00:04:00,060 --> 00:04:03,720
<font color="#E5E5E5">there's just</font><font color="#CCCCCC"> a high-level overview the</font>

98
00:04:01,739 --> 00:04:05,099
the Java<font color="#CCCCCC"> development kit</font><font color="#E5E5E5"> I was going to</font>

99
00:04:03,720 --> 00:04:06,720
go in super in-depth<font color="#E5E5E5"> just to give you a</font>

100
00:04:05,099 --> 00:04:10,470
background<font color="#E5E5E5"> so now let's</font><font color="#CCCCCC"> look</font><font color="#E5E5E5"> at these</font>

101
00:04:06,720 --> 00:04:12,180
scripting tools that I found so how did

102
00:04:10,470 --> 00:04:14,310
I<font color="#E5E5E5"> find these tools what process</font><font color="#CCCCCC"> did I</font>

103
00:04:12,180 --> 00:04:16,858
used to find these tools<font color="#E5E5E5"> I was looking</font>

104
00:04:14,310 --> 00:04:18,478
for<font color="#CCCCCC"> sign binaries by Oracle that were</font>

105
00:04:16,858 --> 00:04:20,219
installed<font color="#CCCCCC"> with Java</font><font color="#E5E5E5"> either the Java</font>

106
00:04:18,478 --> 00:04:22,500
<font color="#CCCCCC">runtime environment or the</font><font color="#E5E5E5"> Java</font>

107
00:04:20,219 --> 00:04:25,210
<font color="#CCCCCC">development kit that contained at least</font>

108
00:04:22,500 --> 00:04:27,639
<font color="#E5E5E5">one of three criteria I was looking for</font>

109
00:04:25,210 --> 00:04:30,370
I wanted something that I could<font color="#E5E5E5"> use as a</font>

110
00:04:27,639 --> 00:04:32,740
file downloader<font color="#CCCCCC"> I want</font><font color="#E5E5E5"> something that I</font>

111
00:04:30,370 --> 00:04:34,740
could execute system commands with and I

112
00:04:32,740 --> 00:04:36,849
wanted something<font color="#E5E5E5"> that could execute</font>

113
00:04:34,740 --> 00:04:39,160
<font color="#E5E5E5">interpreted code either locally or</font>

114
00:04:36,849 --> 00:04:41,349
remotely<font color="#E5E5E5"> so that</font><font color="#CCCCCC"> was like</font><font color="#E5E5E5"> the three</font>

115
00:04:39,160 --> 00:04:43,240
<font color="#E5E5E5">things I was looking for</font><font color="#CCCCCC"> I didn't have</font>

116
00:04:41,349 --> 00:04:45,969
some crazy script<font color="#E5E5E5"> that I was running</font><font color="#CCCCCC"> to</font>

117
00:04:43,240 --> 00:04:48,699
try<font color="#E5E5E5"> to like identify the the binaries</font>

118
00:04:45,970 --> 00:04:51,009
and stuff<font color="#E5E5E5"> the process I literally did in</font>

119
00:04:48,699 --> 00:04:53,889
the Oracle<font color="#E5E5E5"> binaries are installed I went</font>

120
00:04:51,009 --> 00:04:55,660
one by one<font color="#CCCCCC"> I looked at them I googled</font>

121
00:04:53,889 --> 00:04:57,940
them and I looked them up on<font color="#E5E5E5"> Oracle's</font>

122
00:04:55,660 --> 00:05:00,699
documentation that<font color="#E5E5E5"> was my process okay</font>

123
00:04:57,940 --> 00:05:03,340
<font color="#E5E5E5">so I would literally</font><font color="#CCCCCC"> look</font><font color="#E5E5E5"> at the</font>

124
00:05:00,699 --> 00:05:05,770
documentation for<font color="#CCCCCC"> each</font><font color="#E5E5E5"> of the binaries</font>

125
00:05:03,340 --> 00:05:08,590
and<font color="#E5E5E5"> soph they met at least one of my</font>

126
00:05:05,770 --> 00:05:10,680
three criteria<font color="#E5E5E5"> and I found two of them</font>

127
00:05:08,590 --> 00:05:17,198
that did and<font color="#E5E5E5"> then that's doesn't to be</font>

128
00:05:10,680 --> 00:05:20,500
going<font color="#E5E5E5"> over today first one J run script</font>

129
00:05:17,199 --> 00:05:22,030
<font color="#CCCCCC">this</font><font color="#E5E5E5"> is awesome</font><font color="#CCCCCC"> so it's a command-line</font>

130
00:05:20,500 --> 00:05:28,150
scripting shell<font color="#E5E5E5"> it's installed the Java</font>

131
00:05:22,030 --> 00:05:30,580
<font color="#CCCCCC">develop</font><font color="#E5E5E5"> Windows Linux Mac OS you can</font><font color="#CCCCCC"> use</font>

132
00:05:28,150 --> 00:05:32,440
it to execute code interpreted by

133
00:05:30,580 --> 00:05:34,659
<font color="#CCCCCC">supported JavaScript engines now it was</font>

134
00:05:32,440 --> 00:05:36,610
in starting<font color="#E5E5E5"> with Java</font><font color="#CCCCCC"> six I told you</font>

135
00:05:34,659 --> 00:05:38,800
from<font color="#E5E5E5"> a version history standpoint we're</font>

136
00:05:36,610 --> 00:05:39,909
going to focus starting with Java<font color="#CCCCCC"> six so</font>

137
00:05:38,800 --> 00:05:43,659
it was<font color="#E5E5E5"> installed the Java development</font>

138
00:05:39,909 --> 00:05:44,830
<font color="#CCCCCC">kits starting with six and right here</font>

139
00:05:43,659 --> 00:05:46,630
you'll<font color="#CCCCCC"> see a</font><font color="#E5E5E5"> snippet this is from</font>

140
00:05:44,830 --> 00:05:48,758
Oracle's documentation it says that it

141
00:05:46,630 --> 00:05:50,560
is unsupported<font color="#CCCCCC"> and experimental in</font>

142
00:05:48,759 --> 00:05:52,990
nature and should<font color="#E5E5E5"> be used that in</font><font color="#CCCCCC"> mind</font>

143
00:05:50,560 --> 00:05:55,210
<font color="#E5E5E5">it's been saying this</font><font color="#CCCCCC"> since Java six</font>

144
00:05:52,990 --> 00:05:57,219
<font color="#E5E5E5">Java</font><font color="#CCCCCC"> ten that</font><font color="#E5E5E5"> was released in March it</font>

145
00:05:55,210 --> 00:05:59,680
<font color="#E5E5E5">is still listed as experimental and</font>

146
00:05:57,219 --> 00:06:01,449
unsupported so I don't I don't know they

147
00:05:59,680 --> 00:06:03,400
keep<font color="#E5E5E5"> they're keeping it around which is</font>

148
00:06:01,449 --> 00:06:05,740
which<font color="#CCCCCC"> is fine</font><font color="#E5E5E5"> with me</font>

149
00:06:03,400 --> 00:06:10,659
so yeah that that's that's<font color="#E5E5E5"> kind of high</font>

150
00:06:05,740 --> 00:06:11,380
level<font color="#CCCCCC"> what</font><font color="#E5E5E5"> Jai run script is so I found</font>

151
00:06:10,659 --> 00:06:14,289
I<font color="#CCCCCC"> found this</font>

152
00:06:11,380 --> 00:06:16,479
you know<font color="#CCCCCC"> core documentation and and I</font>

153
00:06:14,289 --> 00:06:19,210
was I was<font color="#CCCCCC"> looking through</font><font color="#E5E5E5"> and one of</font>

154
00:06:16,479 --> 00:06:20,680
these<font color="#E5E5E5"> switches caught my attention and</font>

155
00:06:19,210 --> 00:06:24,370
<font color="#CCCCCC">that's the one highlighted</font><font color="#E5E5E5"> here</font>

156
00:06:20,680 --> 00:06:27,070
so the -<font color="#CCCCCC"> II</font><font color="#E5E5E5"> switch so evaluate a given</font>

157
00:06:24,370 --> 00:06:29,139
script<font color="#CCCCCC"> I was like okay</font><font color="#E5E5E5"> so does that mean</font>

158
00:06:27,070 --> 00:06:30,880
<font color="#CCCCCC">I can like pass it code in line and</font><font color="#E5E5E5"> it</font>

159
00:06:29,139 --> 00:06:32,949
<font color="#E5E5E5">will execute it for me are there some</font>

160
00:06:30,880 --> 00:06:34,930
<font color="#E5E5E5">sort of like functions I can pass or</font>

161
00:06:32,949 --> 00:06:37,270
<font color="#E5E5E5">perform some sort of like native</font>

162
00:06:34,930 --> 00:06:38,420
functionality<font color="#CCCCCC"> right and and that was</font>

163
00:06:37,270 --> 00:06:43,030
<font color="#E5E5E5">exactly the case</font>

164
00:06:38,420 --> 00:06:46,430
so when I did a<font color="#E5E5E5"> little</font><font color="#CCCCCC"> more research</font>

165
00:06:43,030 --> 00:06:49,309
<font color="#CCCCCC">with the - East which there are actually</font>

166
00:06:46,430 --> 00:06:52,130
global functions that are<font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> be</font>

167
00:06:49,310 --> 00:06:54,110
<font color="#E5E5E5">interpreted</font><font color="#CCCCCC"> with this - East which so</font>

168
00:06:52,130 --> 00:06:55,400
like I<font color="#CCCCCC"> said</font><font color="#E5E5E5"> before I was looking for</font>

169
00:06:54,110 --> 00:06:59,090
something<font color="#E5E5E5"> that</font><font color="#CCCCCC"> could execute system</font>

170
00:06:55,400 --> 00:07:02,289
commands<font color="#E5E5E5"> execute code it executes</font>

171
00:06:59,090 --> 00:07:05,210
<font color="#CCCCCC">interpreter code locally remotely or a</font>

172
00:07:02,290 --> 00:07:07,100
file<font color="#E5E5E5"> downloaded right so out of those</font>

173
00:07:05,210 --> 00:07:09,229
functions<font color="#CCCCCC"> I found these for that</font><font color="#E5E5E5"> set</font><font color="#CCCCCC"> of</font>

174
00:07:07,100 --> 00:07:12,950
satisfied all those criteria<font color="#CCCCCC"> so the</font>

175
00:07:09,230 --> 00:07:15,860
first one here was a cat function<font color="#E5E5E5"> so it</font>

176
00:07:12,950 --> 00:07:17,719
simply can read a content of<font color="#E5E5E5"> a file but</font>

177
00:07:15,860 --> 00:07:20,000
what I really liked<font color="#E5E5E5"> was the fact that it</font>

178
00:07:17,720 --> 00:07:22,880
said URL so<font color="#E5E5E5"> that means I could use it as</font>

179
00:07:20,000 --> 00:07:24,950
a file downloader same thing with the

180
00:07:22,880 --> 00:07:27,860
copy function right so<font color="#CCCCCC"> it can copy a</font>

181
00:07:24,950 --> 00:07:29,810
file URL or stream to<font color="#E5E5E5"> another file or</font>

182
00:07:27,860 --> 00:07:32,060
<font color="#E5E5E5">stream so URL was a</font><font color="#CCCCCC"> keyword</font><font color="#E5E5E5"> so I was</font>

183
00:07:29,810 --> 00:07:34,100
like<font color="#E5E5E5"> okay I think I can use cat and I</font>

184
00:07:32,060 --> 00:07:36,050
can use copy as a<font color="#CCCCCC"> Bo's as a file</font>

185
00:07:34,100 --> 00:07:38,510
downloader<font color="#E5E5E5"> the next one's pretty</font>

186
00:07:36,050 --> 00:07:41,060
<font color="#CCCCCC">self-explanatory</font><font color="#E5E5E5"> exact right so I can</font>

187
00:07:38,510 --> 00:07:43,730
simply give it a system<font color="#E5E5E5"> command whether</font>

188
00:07:41,060 --> 00:07:45,740
it's on Linux<font color="#E5E5E5"> or whether it's on Windows</font>

189
00:07:43,730 --> 00:07:49,010
and<font color="#E5E5E5"> it'll execute that as a child</font>

190
00:07:45,740 --> 00:07:51,710
process<font color="#E5E5E5"> the fourth one</font><font color="#CCCCCC"> is my favorite</font>

191
00:07:49,010 --> 00:07:53,450
one<font color="#CCCCCC"> this one loads and evaluates</font>

192
00:07:51,710 --> 00:07:56,479
<font color="#CCCCCC">javascript code from a stream file or</font>

193
00:07:53,450 --> 00:07:58,670
<font color="#CCCCCC">key word URL so what that means is I can</font>

194
00:07:56,480 --> 00:08:01,390
<font color="#CCCCCC">pass it a URL with a JavaScript file</font><font color="#E5E5E5"> and</font>

195
00:07:58,670 --> 00:08:05,210
it's<font color="#E5E5E5"> going to remotely run that script</font>

196
00:08:01,390 --> 00:08:07,880
<font color="#E5E5E5">dropping it to disk so</font><font color="#CCCCCC"> again these are</font>

197
00:08:05,210 --> 00:08:11,210
the<font color="#E5E5E5"> global functions that really piqued</font>

198
00:08:07,880 --> 00:08:12,350
my interest once I found<font color="#E5E5E5"> that</font><font color="#CCCCCC"> oh</font><font color="#E5E5E5"> that -</font>

199
00:08:11,210 --> 00:08:13,239
<font color="#CCCCCC">he</font><font color="#E5E5E5"> switched that's that's pretty</font>

200
00:08:12,350 --> 00:08:16,700
interesting

201
00:08:13,240 --> 00:08:19,610
<font color="#E5E5E5">so that was the first tool the second</font>

202
00:08:16,700 --> 00:08:20,680
one I<font color="#E5E5E5"> found is JJ s JJ s stands for</font><font color="#CCCCCC"> java</font>

203
00:08:19,610 --> 00:08:23,960
<font color="#CCCCCC">javascript</font>

204
00:08:20,680 --> 00:08:25,820
<font color="#CCCCCC">clever</font><font color="#E5E5E5"> I know so it's just another</font>

205
00:08:23,960 --> 00:08:28,849
<font color="#CCCCCC">command-line scripting</font><font color="#E5E5E5"> shell install</font>

206
00:08:25,820 --> 00:08:32,809
with the<font color="#E5E5E5"> JDK on you know Windows Linux</font>

207
00:08:28,850 --> 00:08:37,700
<font color="#E5E5E5">and</font><font color="#CCCCCC"> Mac OS so this</font><font color="#E5E5E5"> this was installed</font>

208
00:08:32,809 --> 00:08:40,369
<font color="#E5E5E5">with starting</font><font color="#CCCCCC"> with the java 8 and it was</font>

209
00:08:37,700 --> 00:08:41,720
<font color="#E5E5E5">installed it came</font><font color="#CCCCCC"> about the same time as</font>

210
00:08:40,370 --> 00:08:43,820
the nation<font color="#E5E5E5"> when javascript engine did</font>

211
00:08:41,720 --> 00:08:46,430
and again if you<font color="#E5E5E5"> look at work was</font>

212
00:08:43,820 --> 00:08:48,740
documentation this is a snippet<font color="#E5E5E5"> from it</font>

213
00:08:46,430 --> 00:08:50,390
it says you know<font color="#E5E5E5"> JJ s runs the</font><font color="#CCCCCC"> nature</font>

214
00:08:48,740 --> 00:08:51,680
<font color="#CCCCCC">and command line script shell right</font>

215
00:08:50,390 --> 00:08:53,660
below it you still see

216
00:08:51,680 --> 00:08:56,180
<font color="#CCCCCC">script says experimental so I don't I</font>

217
00:08:53,660 --> 00:08:58,010
don't know<font color="#E5E5E5"> if Oracle's plan is</font>

218
00:08:56,180 --> 00:09:00,349
eventually to do away with<font color="#E5E5E5"> J run script</font>

219
00:08:58,010 --> 00:09:02,120
<font color="#E5E5E5">and just</font><font color="#CCCCCC"> use JJ s I don't know why</font>

220
00:09:00,350 --> 00:09:06,110
they're keeping J run script around<font color="#E5E5E5"> as</font>

221
00:09:02,120 --> 00:09:09,260
well<font color="#CCCCCC"> but so that's kind of what JJ</font><font color="#E5E5E5"> s is</font>

222
00:09:06,110 --> 00:09:11,089
it as a<font color="#CCCCCC"> high-level</font><font color="#E5E5E5"> so if you look at the</font>

223
00:09:09,260 --> 00:09:13,459
<font color="#E5E5E5">syntax I was looking at syntax I was</font>

224
00:09:11,089 --> 00:09:15,470
looking at documentation online<font color="#CCCCCC"> I didn't</font>

225
00:09:13,459 --> 00:09:16,910
see anything honestly interesting so

226
00:09:15,470 --> 00:09:19,250
when<font color="#E5E5E5"> I when I looked at this the three</font>

227
00:09:16,910 --> 00:09:23,089
criteria<font color="#CCCCCC"> I could not use it as a file</font>

228
00:09:19,250 --> 00:09:24,709
downloader<font color="#E5E5E5"> I could not</font><font color="#CCCCCC"> use it to</font><font color="#E5E5E5"> execute</font>

229
00:09:23,089 --> 00:09:27,260
system commands like<font color="#E5E5E5"> I could with J run</font>

230
00:09:24,709 --> 00:09:29,270
script<font color="#CCCCCC"> want the</font><font color="#E5E5E5"> only thing I could do</font>

231
00:09:27,260 --> 00:09:31,700
with<font color="#CCCCCC"> it is I</font><font color="#E5E5E5"> could execute interpret</font>

232
00:09:29,270 --> 00:09:32,870
code locally<font color="#CCCCCC"> so you can pass it and</font>

233
00:09:31,700 --> 00:09:35,029
you'll see in these<font color="#CCCCCC"> examples on the show</font>

234
00:09:32,870 --> 00:09:37,010
you can pass it local path to a

235
00:09:35,029 --> 00:09:38,950
<font color="#E5E5E5">JavaScript file that's written in like</font>

236
00:09:37,010 --> 00:09:41,540
nature or in JavaScript again I'm<font color="#CCCCCC"> like</font>

237
00:09:38,950 --> 00:09:42,920
<font color="#E5E5E5">but the only function I really thought</font>

238
00:09:41,540 --> 00:09:44,959
was good<font color="#E5E5E5"> was the fact that you can</font>

239
00:09:42,920 --> 00:09:47,089
execute interpret code locally<font color="#E5E5E5"> with this</font>

240
00:09:44,959 --> 00:09:50,149
<font color="#E5E5E5">so I was kind of disappointed</font><font color="#CCCCCC"> that but</font>

241
00:09:47,089 --> 00:09:52,720
at<font color="#E5E5E5"> least we still</font><font color="#CCCCCC"> have</font><font color="#E5E5E5"> J run script from</font>

242
00:09:50,149 --> 00:09:55,730
<font color="#E5E5E5">a file location standpoint on Windows</font>

243
00:09:52,720 --> 00:09:57,890
<font color="#CCCCCC">gets installed in the Java directory and</font>

244
00:09:55,730 --> 00:09:59,390
program files or x86 depending on which

245
00:09:57,890 --> 00:10:02,330
architecture you're installing it

246
00:09:59,390 --> 00:10:04,220
there's<font color="#CCCCCC"> 32-bit 64-bit</font><font color="#E5E5E5"> so it ago java--</font>

247
00:10:02,330 --> 00:10:07,010
<font color="#CCCCCC">jdk and</font><font color="#E5E5E5"> then the version and then the</font>

248
00:10:04,220 --> 00:10:08,930
bin directory<font color="#CCCCCC"> on linux</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> mac</font><font color="#E5E5E5"> OS it</font>

249
00:10:07,010 --> 00:10:13,400
gets<font color="#CCCCCC"> its</font><font color="#E5E5E5"> in user they're both in user</font>

250
00:10:08,930 --> 00:10:14,959
<font color="#E5E5E5">bin a little note for Windows you</font><font color="#CCCCCC"> can</font><font color="#E5E5E5"> up</font>

251
00:10:13,400 --> 00:10:17,660
<font color="#E5E5E5">repent in this string</font><font color="#CCCCCC"> what you're</font><font color="#E5E5E5"> going</font>

252
00:10:14,959 --> 00:10:19,790
to<font color="#E5E5E5"> see in my examples before running J</font>

253
00:10:17,660 --> 00:10:23,569
run script<font color="#CCCCCC"> so that way you</font><font color="#E5E5E5"> don't have to</font>

254
00:10:19,790 --> 00:10:25,360
specify<font color="#E5E5E5"> the</font><font color="#CCCCCC"> full path of the where the</font>

255
00:10:23,570 --> 00:10:27,350
<font color="#E5E5E5">JDK is that especially</font><font color="#CCCCCC"> if you</font><font color="#E5E5E5"> don't know</font>

256
00:10:25,360 --> 00:10:29,450
<font color="#CCCCCC">like</font><font color="#E5E5E5"> if you're</font><font color="#CCCCCC"> on an assessment you're</font>

257
00:10:27,350 --> 00:10:31,459
not going to know what version JDK

258
00:10:29,450 --> 00:10:32,810
they're running you can just<font color="#E5E5E5"> pretend</font>

259
00:10:31,459 --> 00:10:36,920
<font color="#CCCCCC">this string so it doesn't</font><font color="#E5E5E5"> matter what</font>

260
00:10:32,810 --> 00:10:38,869
JDK they're running it'll find it so we

261
00:10:36,920 --> 00:10:40,610
went<font color="#CCCCCC"> over kind of</font><font color="#E5E5E5"> a high level</font><font color="#CCCCCC"> the Java</font>

262
00:10:38,870 --> 00:10:43,430
<font color="#CCCCCC">development kit</font><font color="#E5E5E5"> went</font><font color="#CCCCCC"> over these</font>

263
00:10:40,610 --> 00:10:47,060
scripting tools<font color="#CCCCCC"> now let's talk about the</font>

264
00:10:43,430 --> 00:10:48,380
nation<font color="#E5E5E5"> JavaScript engine so simply it's</font>

265
00:10:47,060 --> 00:10:51,829
it's a it's a code engine that can

266
00:10:48,380 --> 00:10:56,779
<font color="#E5E5E5">interpret code</font><font color="#CCCCCC"> it was introduced with</font>

267
00:10:51,829 --> 00:10:59,839
Java 8<font color="#E5E5E5"> previously they used the Mozilla</font>

268
00:10:56,779 --> 00:11:01,490
<font color="#CCCCCC">Rhino JavaScript engine what</font><font color="#E5E5E5"> what is</font>

269
00:10:59,839 --> 00:11:03,650
awesome about the nation<font color="#CCCCCC"> when JavaScript</font>

270
00:11:01,490 --> 00:11:05,990
engine is that

271
00:11:03,650 --> 00:11:07,670
it can execute an interpreter<font color="#CCCCCC"> Abba code</font>

272
00:11:05,990 --> 00:11:10,370
<font color="#E5E5E5">so as soon as they</font><font color="#CCCCCC"> introduce this nation</font>

273
00:11:07,670 --> 00:11:12,110
<font color="#CCCCCC">or a</font><font color="#E5E5E5"> JavaScript engine</font><font color="#CCCCCC"> you can now have</font>

274
00:11:10,370 --> 00:11:14,090
it interpret and execute Java code that

275
00:11:12,110 --> 00:11:17,330
<font color="#E5E5E5">was that was the big piece with it so</font>

276
00:11:14,090 --> 00:11:18,500
whenever they they released jjs with the

277
00:11:17,330 --> 00:11:20,510
nation<font color="#CCCCCC"> when</font><font color="#E5E5E5"> JavaScript engine that's</font>

278
00:11:18,500 --> 00:11:23,180
kind of the<font color="#E5E5E5"> intended use but</font><font color="#CCCCCC"> J run</font>

279
00:11:20,510 --> 00:11:26,840
script can also execute<font color="#CCCCCC"> this code as</font>

280
00:11:23,180 --> 00:11:29,089
well so I'm a scripting syntax<font color="#E5E5E5"> I could</font>

281
00:11:26,840 --> 00:11:30,620
put a bunch<font color="#CCCCCC"> of slides up here about</font><font color="#E5E5E5"> this</font>

282
00:11:29,090 --> 00:11:32,720
is how you declare<font color="#E5E5E5"> a variable this</font><font color="#CCCCCC"> is</font>

283
00:11:30,620 --> 00:11:34,370
how you<font color="#E5E5E5"> know whatever but this resource</font>

284
00:11:32,720 --> 00:11:37,310
right here and I'm gonna share the

285
00:11:34,370 --> 00:11:39,380
slides on Twitter<font color="#E5E5E5"> as well throughout the</font>

286
00:11:37,310 --> 00:11:41,329
<font color="#E5E5E5">slides but this this</font><font color="#CCCCCC"> slide this link</font>

287
00:11:39,380 --> 00:11:44,480
right<font color="#E5E5E5"> here</font><font color="#CCCCCC"> a great</font><font color="#E5E5E5"> resource as far as</font>

288
00:11:41,330 --> 00:11:46,730
the scripting syntax<font color="#CCCCCC"> justice Oh show a</font>

289
00:11:44,480 --> 00:11:50,290
simple program you know this is a simple

290
00:11:46,730 --> 00:11:53,810
<font color="#CCCCCC">addition program so creating an array</font>

291
00:11:50,290 --> 00:11:56,329
<font color="#E5E5E5">you have</font><font color="#CCCCCC"> a variable here</font><font color="#E5E5E5"> sum equals zero</font>

292
00:11:53,810 --> 00:11:58,910
<font color="#E5E5E5">you're you're iterating through the list</font>

293
00:11:56,330 --> 00:12:00,620
of the numbers in the array<font color="#E5E5E5"> adding them</font>

294
00:11:58,910 --> 00:12:03,110
and<font color="#E5E5E5"> printing them that's a basic program</font>

295
00:12:00,620 --> 00:12:04,880
<font color="#E5E5E5">but it's very it looks like JavaScript</font>

296
00:12:03,110 --> 00:12:06,560
it's just the fact that the<font color="#CCCCCC"> the big</font>

297
00:12:04,880 --> 00:12:10,430
piece again is that<font color="#E5E5E5"> you can extend the</font>

298
00:12:06,560 --> 00:12:11,569
<font color="#E5E5E5">java language which I'm gonna show so</font>

299
00:12:10,430 --> 00:12:14,540
explain the<font color="#CCCCCC"> java</font><font color="#E5E5E5"> programming language</font>

300
00:12:11,570 --> 00:12:17,210
<font color="#CCCCCC">this a link</font><font color="#E5E5E5"> right</font><font color="#CCCCCC"> here is a great great</font>

301
00:12:14,540 --> 00:12:19,839
resource<font color="#CCCCCC"> I have a simple</font><font color="#E5E5E5"> example that I</font>

302
00:12:17,210 --> 00:12:23,630
made right<font color="#CCCCCC"> here so in this example you</font>

303
00:12:19,840 --> 00:12:26,810
<font color="#CCCCCC">are</font><font color="#E5E5E5"> initializing a process</font><font color="#CCCCCC"> named</font>

304
00:12:23,630 --> 00:12:28,189
variable called calc<font color="#E5E5E5"> C and then what</font>

305
00:12:26,810 --> 00:12:31,040
you're doing<font color="#CCCCCC"> is</font><font color="#E5E5E5"> you're creating</font><font color="#CCCCCC"> this</font>

306
00:12:28,190 --> 00:12:33,470
runtime<font color="#CCCCCC"> java class variable and that is</font>

307
00:12:31,040 --> 00:12:35,959
referencing<font color="#E5E5E5"> the runtime object in java</font>

308
00:12:33,470 --> 00:12:36,500
<font color="#E5E5E5">so it has access to the you know java</font>

309
00:12:35,960 --> 00:12:39,170
api

310
00:12:36,500 --> 00:12:41,270
after that we have<font color="#E5E5E5"> access to</font><font color="#CCCCCC"> all the</font>

311
00:12:39,170 --> 00:12:44,209
methods that<font color="#E5E5E5"> there is in the runtime</font>

312
00:12:41,270 --> 00:12:46,610
object so we're calling<font color="#E5E5E5"> the get runtime</font>

313
00:12:44,210 --> 00:12:48,590
that<font color="#CCCCCC"> exec and then the</font><font color="#E5E5E5"> process name so</font>

314
00:12:46,610 --> 00:12:51,350
all this thing does right here<font color="#E5E5E5"> is it</font>

315
00:12:48,590 --> 00:12:53,120
<font color="#E5E5E5">just executes calc on windows they just</font>

316
00:12:51,350 --> 00:12:56,030
that's all it does this<font color="#E5E5E5"> is just a very</font>

317
00:12:53,120 --> 00:12:58,640
<font color="#CCCCCC">simple</font><font color="#E5E5E5"> example</font><font color="#CCCCCC"> but the fact of the</font>

318
00:12:56,030 --> 00:13:00,439
<font color="#CCCCCC">matter is that</font><font color="#E5E5E5"> with nation JavaScript</font><font color="#CCCCCC"> I</font>

319
00:12:58,640 --> 00:13:02,180
mean the sky's the limit<font color="#CCCCCC"> since</font><font color="#E5E5E5"> you can</font>

320
00:13:00,440 --> 00:13:03,650
use<font color="#E5E5E5"> Java right so you're going</font><font color="#CCCCCC"> to see</font>

321
00:13:02,180 --> 00:13:06,709
some<font color="#CCCCCC"> examples where</font><font color="#E5E5E5"> I show kind of some</font>

322
00:13:03,650 --> 00:13:08,470
reverse shells<font color="#CCCCCC"> in nature in JavaScript</font>

323
00:13:06,710 --> 00:13:11,390
you could you could<font color="#E5E5E5"> definitely write</font>

324
00:13:08,470 --> 00:13:13,190
your own custom<font color="#CCCCCC"> nation javascript agent</font>

325
00:13:11,390 --> 00:13:15,920
if you have like a custom rat

326
00:13:13,190 --> 00:13:18,440
for example like Dave Kennedy's<font color="#CCCCCC"> Trevor</font>

327
00:13:15,920 --> 00:13:19,849
<font color="#CCCCCC">see</font><font color="#E5E5E5"> - I'm actually working on a nation</font>

328
00:13:18,440 --> 00:13:22,100
JavaScript agent right now<font color="#E5E5E5"> for that</font>

329
00:13:19,850 --> 00:13:24,590
<font color="#E5E5E5">right so it's the fact</font><font color="#CCCCCC"> that you can</font><font color="#E5E5E5"> use</font>

330
00:13:22,100 --> 00:13:28,610
<font color="#E5E5E5">Java and makes this very you know</font>

331
00:13:24,590 --> 00:13:29,900
extensible so we talked about Java

332
00:13:28,610 --> 00:13:31,640
development kit as a high at a high

333
00:13:29,900 --> 00:13:33,380
level<font color="#CCCCCC"> went</font><font color="#E5E5E5"> through the scripting tools</font>

334
00:13:31,640 --> 00:13:36,140
<font color="#E5E5E5">and we went through</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> nature</font><font color="#CCCCCC"> and</font>

335
00:13:33,380 --> 00:13:37,670
JavaScript<font color="#E5E5E5"> now let's take a look at some</font>

336
00:13:36,140 --> 00:13:43,100
practical<font color="#CCCCCC"> uses in examples for the</font>

337
00:13:37,670 --> 00:13:45,319
offense<font color="#E5E5E5"> so I talked</font><font color="#CCCCCC"> about file</font>

338
00:13:43,100 --> 00:13:47,420
downloaded right so there's the cat

339
00:13:45,320 --> 00:13:51,200
function<font color="#E5E5E5"> and there's the copy function</font>

340
00:13:47,420 --> 00:13:52,689
right so<font color="#CCCCCC"> I have a screen shot here</font><font color="#E5E5E5"> and a</font>

341
00:13:51,200 --> 00:13:55,250
link as well<font color="#E5E5E5"> so you can copy and</font><font color="#CCCCCC"> paste</font>

342
00:13:52,690 --> 00:13:58,610
<font color="#CCCCCC">so here's some</font><font color="#E5E5E5"> examples</font><font color="#CCCCCC"> of actually</font>

343
00:13:55,250 --> 00:14:02,330
using<font color="#CCCCCC"> that</font><font color="#E5E5E5"> so so for Windows</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> can see</font>

344
00:13:58,610 --> 00:14:04,100
here<font color="#E5E5E5"> using cat and copy</font><font color="#CCCCCC"> to you know copy</font>

345
00:14:02,330 --> 00:14:05,840
a file<font color="#E5E5E5"> what's nice though is you can</font>

346
00:14:04,100 --> 00:14:07,790
<font color="#E5E5E5">copy a file either from web server or</font>

347
00:14:05,840 --> 00:14:09,260
<font color="#E5E5E5">you can copy it</font><font color="#CCCCCC"> from a file share as</font>

348
00:14:07,790 --> 00:14:10,849
well so the functionality works if

349
00:14:09,260 --> 00:14:14,500
you're hosting a file in a file share as

350
00:14:10,850 --> 00:14:16,820
well<font color="#CCCCCC"> Linux and Mac ah same thing I just</font>

351
00:14:14,500 --> 00:14:18,890
<font color="#E5E5E5">changed the kind of where you're writing</font>

352
00:14:16,820 --> 00:14:21,620
<font color="#E5E5E5">the file to right you know temp file dot</font>

353
00:14:18,890 --> 00:14:23,720
txt<font color="#CCCCCC"> so it's pretty</font><font color="#E5E5E5"> straightforward but</font>

354
00:14:21,620 --> 00:14:25,580
<font color="#E5E5E5">again it works really well and you're</font>

355
00:14:23,720 --> 00:14:28,130
<font color="#E5E5E5">gonna see</font><font color="#CCCCCC"> to later</font><font color="#E5E5E5"> from</font><font color="#CCCCCC"> a defensive</font>

356
00:14:25,580 --> 00:14:29,420
standpoint<font color="#CCCCCC"> you might be wondering well</font>

357
00:14:28,130 --> 00:14:30,890
what does the user<font color="#E5E5E5"> agent string look</font>

358
00:14:29,420 --> 00:14:32,479
like so I want to<font color="#E5E5E5"> build roles off of</font>

359
00:14:30,890 --> 00:14:33,890
that<font color="#E5E5E5"> I'll show you exactly what the user</font>

360
00:14:32,480 --> 00:14:35,900
agent<font color="#E5E5E5"> string looks like as well whenever</font>

361
00:14:33,890 --> 00:14:37,160
you are<font color="#CCCCCC"> using</font><font color="#E5E5E5"> these cat or copy</font>

362
00:14:35,900 --> 00:14:42,650
functions to<font color="#CCCCCC"> be used as a file</font>

363
00:14:37,160 --> 00:14:44,719
downloader execute system commands<font color="#E5E5E5"> very</font>

364
00:14:42,650 --> 00:14:46,850
<font color="#E5E5E5">straightforward like I said it</font><font color="#CCCCCC"> just</font>

365
00:14:44,720 --> 00:14:49,450
starts a child process<font color="#E5E5E5"> whatever you pass</font>

366
00:14:46,850 --> 00:14:53,150
in there<font color="#E5E5E5"> so for</font><font color="#CCCCCC"> Windows</font><font color="#E5E5E5"> here I'm just</font>

367
00:14:49,450 --> 00:14:57,440
<font color="#E5E5E5">executing the</font><font color="#CCCCCC"> durka man</font><font color="#E5E5E5"> cmd.exe slash</font>

368
00:14:53,150 --> 00:14:59,319
cedar for<font color="#E5E5E5"> Linux and Mac OS</font><font color="#CCCCCC"> and just</font>

369
00:14:57,440 --> 00:15:02,330
executing<font color="#E5E5E5"> the LS command and bash</font><font color="#CCCCCC"> so</font>

370
00:14:59,320 --> 00:15:04,610
pretty straightforward<font color="#E5E5E5"> for this the only</font>

371
00:15:02,330 --> 00:15:07,490
the<font color="#CCCCCC"> reason I like this is because it</font><font color="#E5E5E5"> can</font>

372
00:15:04,610 --> 00:15:08,720
kind of throw off the<font color="#E5E5E5"> parent process</font><font color="#CCCCCC"> ID</font>

373
00:15:07,490 --> 00:15:12,980
relationships a little<font color="#E5E5E5"> bit if there's</font>

374
00:15:08,720 --> 00:15:15,040
some signatures built for very various

375
00:15:12,980 --> 00:15:18,590
parent process<font color="#CCCCCC"> ID relationships with</font>

376
00:15:15,040 --> 00:15:20,579
some various security<font color="#E5E5E5"> controls</font>

377
00:15:18,590 --> 00:15:22,770
loading running local scripts<font color="#E5E5E5"> like I</font>

378
00:15:20,580 --> 00:15:24,420
said this was the<font color="#E5E5E5"> only functionality of</font>

379
00:15:22,770 --> 00:15:26,760
jjs that I really liked<font color="#E5E5E5"> and the</font><font color="#CCCCCC"> three</font>

380
00:15:24,420 --> 00:15:29,610
<font color="#CCCCCC">Chi</font><font color="#E5E5E5"> three</font><font color="#CCCCCC"> criteria</font><font color="#E5E5E5"> that I had so you</font>

381
00:15:26,760 --> 00:15:31,950
simply just<font color="#CCCCCC"> pass it the path to whatever</font>

382
00:15:29,610 --> 00:15:35,040
script you're trying to<font color="#E5E5E5"> run I think</font><font color="#CCCCCC"> it's</font>

383
00:15:31,950 --> 00:15:37,800
in<font color="#CCCCCC"> jjs you could also instead of</font><font color="#E5E5E5"> just</font>

384
00:15:35,040 --> 00:15:40,079
<font color="#CCCCCC">giving it the path</font><font color="#E5E5E5"> you can pass it on -</font>

385
00:15:37,800 --> 00:15:41,939
f and then the script<font color="#CCCCCC"> and does the does</font>

386
00:15:40,080 --> 00:15:46,550
<font color="#E5E5E5">the same thing I think</font><font color="#CCCCCC"> it's with JJ s as</font>

387
00:15:41,940 --> 00:15:48,690
well whoops

388
00:15:46,550 --> 00:15:50,219
and my<font color="#CCCCCC"> favorite functionality like</font><font color="#E5E5E5"> I</font>

389
00:15:48,690 --> 00:15:52,170
said is<font color="#E5E5E5"> the fact</font><font color="#CCCCCC"> that you can load and</font>

390
00:15:50,220 --> 00:15:54,210
run remote scripts<font color="#E5E5E5"> so you can do it from</font>

391
00:15:52,170 --> 00:15:57,870
<font color="#E5E5E5">web server</font><font color="#CCCCCC"> or you can do it from a file</font>

392
00:15:54,210 --> 00:16:00,120
share<font color="#E5E5E5"> so this load function you can see</font>

393
00:15:57,870 --> 00:16:03,510
I'm calling the load function giving it

394
00:16:00,120 --> 00:16:06,210
a<font color="#E5E5E5"> URL or a UNC path to a file share and</font>

395
00:16:03,510 --> 00:16:08,010
<font color="#E5E5E5">it's going to remotely load and execute</font>

396
00:16:06,210 --> 00:16:09,600
<font color="#CCCCCC">that script in memory without</font><font color="#E5E5E5"> dropping</font>

397
00:16:08,010 --> 00:16:12,150
<font color="#CCCCCC">it to disk</font><font color="#E5E5E5"> you're going to see an</font>

398
00:16:09,600 --> 00:16:14,340
<font color="#E5E5E5">example</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> this in the demo and also</font>

399
00:16:12,150 --> 00:16:16,530
<font color="#CCCCCC">from a defensive</font><font color="#E5E5E5"> standpoint</font><font color="#CCCCCC"> same thing</font>

400
00:16:14,340 --> 00:16:18,000
with the cat and<font color="#E5E5E5"> copy functions the user</font>

401
00:16:16,530 --> 00:16:19,949
agents<font color="#CCCCCC"> there's</font><font color="#E5E5E5"> a certain user agent</font>

402
00:16:18,000 --> 00:16:22,110
string that<font color="#E5E5E5"> it uses whenever it's doing</font>

403
00:16:19,950 --> 00:16:27,300
this again you can build detection

404
00:16:22,110 --> 00:16:29,670
alerts<font color="#E5E5E5"> off of that as well here's a</font>

405
00:16:27,300 --> 00:16:33,270
one-liner reverse shell you're gonna see

406
00:16:29,670 --> 00:16:36,060
this in the<font color="#E5E5E5"> demo as</font><font color="#CCCCCC"> well</font><font color="#E5E5E5"> so Chris Chris</font>

407
00:16:33,270 --> 00:16:37,980
<font color="#E5E5E5">Rojas is the original</font><font color="#CCCCCC"> he's the one that</font>

408
00:16:36,060 --> 00:16:39,270
<font color="#E5E5E5">created this this code for the nation</font>

409
00:16:37,980 --> 00:16:42,900
<font color="#E5E5E5">weren't</font><font color="#CCCCCC"> JavaScript</font><font color="#E5E5E5"> reverse shell</font>

410
00:16:39,270 --> 00:16:45,630
I<font color="#CCCCCC"> have his link right there I copied his</font>

411
00:16:42,900 --> 00:16:46,920
code and I<font color="#E5E5E5"> have a version of it for bash</font>

412
00:16:45,630 --> 00:16:49,110
as well because you<font color="#E5E5E5"> have to change it a</font>

413
00:16:46,920 --> 00:16:51,930
little<font color="#E5E5E5"> bit for for bash</font><font color="#CCCCCC"> so in this</font>

414
00:16:49,110 --> 00:16:53,730
example I'm running a one-liner<font color="#E5E5E5"> the</font>

415
00:16:51,930 --> 00:16:56,040
one-liner<font color="#CCCCCC"> reverse shell and then I'm</font>

416
00:16:53,730 --> 00:17:00,570
catching the<font color="#E5E5E5"> shell on the other end on</font>

417
00:16:56,040 --> 00:17:03,089
my my attack box<font color="#E5E5E5"> in</font><font color="#CCCCCC"> Metasploit so what</font>

418
00:17:00,570 --> 00:17:05,550
this is<font color="#E5E5E5"> doing you're passing it the the</font>

419
00:17:03,090 --> 00:17:08,579
host<font color="#E5E5E5"> for the attack box and the port</font>

420
00:17:05,550 --> 00:17:10,139
<font color="#E5E5E5">that's listening pass it the CMD that</font>

421
00:17:08,579 --> 00:17:12,419
<font color="#CCCCCC">exe process because that's</font><font color="#E5E5E5"> we're going</font>

422
00:17:10,140 --> 00:17:14,580
to pass across<font color="#E5E5E5"> the wire and then you</font>

423
00:17:12,420 --> 00:17:16,410
also<font color="#CCCCCC"> see I kind of I talked</font><font color="#E5E5E5"> about nation</font>

424
00:17:14,579 --> 00:17:18,179
<font color="#E5E5E5">or JavaScript you</font><font color="#CCCCCC"> can access</font><font color="#E5E5E5"> Java</font>

425
00:17:16,410 --> 00:17:21,630
so you're seeing we're using the<font color="#CCCCCC"> java</font>

426
00:17:18,180 --> 00:17:24,900
net<font color="#E5E5E5"> dot socket object we are using the</font>

427
00:17:21,630 --> 00:17:27,209
<font color="#CCCCCC">java laying that thread object so</font><font color="#E5E5E5"> the</font>

428
00:17:24,900 --> 00:17:28,620
this<font color="#CCCCCC"> is why nation</font><font color="#E5E5E5"> when javascript is</font>

429
00:17:27,209 --> 00:17:29,960
such a big deal is<font color="#CCCCCC"> because</font><font color="#E5E5E5"> you can use</font>

430
00:17:28,620 --> 00:17:31,219
<font color="#CCCCCC">Java and</font>

431
00:17:29,960 --> 00:17:32,480
gives you that extensibility for

432
00:17:31,220 --> 00:17:38,570
something like this<font color="#E5E5E5"> with like a reverse</font>

433
00:17:32,480 --> 00:17:42,380
shell in addition to the reverse shell

434
00:17:38,570 --> 00:17:44,510
<font color="#CCCCCC">you can also do a base64 encoded command</font>

435
00:17:42,380 --> 00:17:46,460
like a<font color="#E5E5E5"> base64 encoded one-liner so</font>

436
00:17:44,510 --> 00:17:49,179
similar<font color="#E5E5E5"> to how</font><font color="#CCCCCC"> PowerShell right has the</font>

437
00:17:46,460 --> 00:17:51,320
<font color="#CCCCCC">dash NC and all the other variants right</font>

438
00:17:49,179 --> 00:17:55,070
<font color="#CCCCCC">so what you can do is you can</font><font color="#E5E5E5"> take your</font>

439
00:17:51,320 --> 00:17:57,830
<font color="#CCCCCC">JavaScript file simply just base64</font>

440
00:17:55,070 --> 00:18:00,830
encode it<font color="#CCCCCC"> in that</font><font color="#E5E5E5"> string</font><font color="#CCCCCC"> you put that</font>

441
00:17:57,830 --> 00:18:02,210
<font color="#E5E5E5">string right</font><font color="#CCCCCC"> in here and then run it</font><font color="#E5E5E5"> and</font>

442
00:18:00,830 --> 00:18:04,220
it'll interpret it<font color="#E5E5E5"> and you're going</font><font color="#CCCCCC"> to</font>

443
00:18:02,210 --> 00:18:07,340
see an<font color="#E5E5E5"> example of this as well again</font>

444
00:18:04,220 --> 00:18:09,049
this this code<font color="#CCCCCC"> it was</font><font color="#E5E5E5"> originally created</font>

445
00:18:07,340 --> 00:18:14,658
by<font color="#E5E5E5"> Chris</font><font color="#CCCCCC"> fro HOF so I had that</font><font color="#E5E5E5"> reference</font>

446
00:18:09,049 --> 00:18:15,620
there and I just<font color="#E5E5E5"> copied his code so I've</font>

447
00:18:14,659 --> 00:18:17,450
gone through<font color="#E5E5E5"> some of the</font><font color="#CCCCCC"> uses and</font>

448
00:18:15,620 --> 00:18:18,739
<font color="#E5E5E5">examples from offensive standpoint what</font>

449
00:18:17,450 --> 00:18:20,419
what are<font color="#E5E5E5"> the advantages and</font>

450
00:18:18,740 --> 00:18:22,600
<font color="#CCCCCC">disadvantages for the offense with this</font>

451
00:18:20,419 --> 00:18:24,919
so let's<font color="#CCCCCC"> go through</font><font color="#E5E5E5"> the advantages first</font>

452
00:18:22,600 --> 00:18:26,689
<font color="#E5E5E5">there's no</font><font color="#CCCCCC"> native logging for</font><font color="#E5E5E5"> the usage</font>

453
00:18:24,919 --> 00:18:28,610
of<font color="#E5E5E5"> these tools or</font><font color="#CCCCCC"> the nation or in</font>

454
00:18:26,690 --> 00:18:31,309
<font color="#E5E5E5">JavaScript engine what I mean by native</font>

455
00:18:28,610 --> 00:18:32,870
logging<font color="#E5E5E5"> PowerShell right with</font><font color="#CCCCCC"> PowerShell</font>

456
00:18:31,309 --> 00:18:35,779
version<font color="#E5E5E5"> 5 they have the script block</font>

457
00:18:32,870 --> 00:18:37,309
logging<font color="#CCCCCC"> there's nothing like</font><font color="#E5E5E5"> that for</font>

458
00:18:35,779 --> 00:18:38,299
the<font color="#E5E5E5"> usage</font><font color="#CCCCCC"> of these tools or the engine</font>

459
00:18:37,309 --> 00:18:40,490
right now

460
00:18:38,299 --> 00:18:41,750
another advantage it can<font color="#E5E5E5"> assist in the</font>

461
00:18:40,490 --> 00:18:44,779
evasion<font color="#E5E5E5"> of some host-based security</font>

462
00:18:41,750 --> 00:18:46,630
controls that that rely on or factor in

463
00:18:44,779 --> 00:18:50,390
the parent<font color="#CCCCCC"> process ID relationships</font>

464
00:18:46,630 --> 00:18:51,559
<font color="#CCCCCC">since</font><font color="#E5E5E5"> you're now running J runs JJ s it</font>

465
00:18:50,390 --> 00:18:52,700
could throw it off a<font color="#CCCCCC"> little</font><font color="#E5E5E5"> bit for</font>

466
00:18:51,559 --> 00:18:55,960
those signatures<font color="#E5E5E5"> that may be in place</font>

467
00:18:52,700 --> 00:18:58,309
<font color="#E5E5E5">for some</font><font color="#CCCCCC"> of those controls</font><font color="#E5E5E5"> another</font>

468
00:18:55,960 --> 00:18:59,480
<font color="#E5E5E5">advantage obviously</font><font color="#CCCCCC"> on offense we don't</font>

469
00:18:58,309 --> 00:19:01,340
want to drop anything<font color="#E5E5E5"> to disk if we</font>

470
00:18:59,480 --> 00:19:02,480
don't have to and<font color="#E5E5E5"> you don't need to</font>

471
00:19:01,340 --> 00:19:04,789
<font color="#CCCCCC">write you don't</font><font color="#E5E5E5"> need to</font><font color="#CCCCCC"> drop anything</font>

472
00:19:02,480 --> 00:19:08,299
disk<font color="#E5E5E5"> especially with that especially</font>

473
00:19:04,789 --> 00:19:09,770
<font color="#CCCCCC">with</font><font color="#E5E5E5"> that load function</font><font color="#CCCCCC"> then also</font><font color="#E5E5E5"> the</font>

474
00:19:08,299 --> 00:19:11,179
scripting tools<font color="#CCCCCC"> our Sun binaries by</font>

475
00:19:09,770 --> 00:19:13,820
Oracle you're not running an unsigned

476
00:19:11,179 --> 00:19:17,120
binary these are sign legit binaries by

477
00:19:13,820 --> 00:19:19,939
<font color="#CCCCCC">Oracle similar to Casey Smith subsea on</font>

478
00:19:17,120 --> 00:19:21,799
Twitter<font color="#CCCCCC"> how he's been talking</font><font color="#E5E5E5"> about</font>

479
00:19:19,940 --> 00:19:23,360
these native dotnet framework tools that

480
00:19:21,799 --> 00:19:25,639
are signed by Microsoft<font color="#E5E5E5"> that you can use</font>

481
00:19:23,360 --> 00:19:27,439
same concept from an offensive

482
00:19:25,640 --> 00:19:30,200
standpoint<font color="#E5E5E5"> we want</font><font color="#CCCCCC"> to live off the land</font>

483
00:19:27,440 --> 00:19:33,649
as much<font color="#E5E5E5"> as possible</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> want to use the</font>

484
00:19:30,200 --> 00:19:36,110
legit tools to do what we want<font color="#CCCCCC"> and</font>

485
00:19:33,649 --> 00:19:38,449
another advantage<font color="#E5E5E5"> is that it's supported</font>

486
00:19:36,110 --> 00:19:39,669
on multiple<font color="#CCCCCC"> platforms so</font><font color="#E5E5E5"> Windows</font><font color="#CCCCCC"> Linux</font>

487
00:19:38,450 --> 00:19:42,400
<font color="#E5E5E5">Mac</font><font color="#CCCCCC"> OS</font>

488
00:19:39,670 --> 00:19:44,440
<font color="#CCCCCC">all those</font><font color="#E5E5E5"> disadvantage from an offensive</font>

489
00:19:42,400 --> 00:19:45,910
<font color="#E5E5E5">standpoint it requires a Java</font>

490
00:19:44,440 --> 00:19:47,260
development kit to be installed<font color="#CCCCCC"> in the</font>

491
00:19:45,910 --> 00:19:48,940
<font color="#E5E5E5">target system so it's not like</font>

492
00:19:47,260 --> 00:19:51,310
<font color="#E5E5E5">PowerShell where it's installed on</font>

493
00:19:48,940 --> 00:19:53,230
everything right it has<font color="#E5E5E5"> to be installed</font>

494
00:19:51,310 --> 00:19:55,840
<font color="#E5E5E5">on the system</font><font color="#CCCCCC"> so that's the one</font>

495
00:19:53,230 --> 00:20:01,870
<font color="#CCCCCC">disadvantage</font><font color="#E5E5E5"> especially</font><font color="#CCCCCC"> I'm a living</font><font color="#E5E5E5"> off</font>

496
00:19:55,840 --> 00:20:04,629
the land standpoint so talked<font color="#CCCCCC"> about kind</font>

497
00:20:01,870 --> 00:20:06,429
<font color="#E5E5E5">of the offensive view of it right let's</font>

498
00:20:04,630 --> 00:20:08,140
go<font color="#E5E5E5"> it let's go through it from from a</font>

499
00:20:06,430 --> 00:20:10,150
defensive<font color="#E5E5E5"> standpoint</font><font color="#CCCCCC"> we're going to talk</font>

500
00:20:08,140 --> 00:20:13,540
about<font color="#E5E5E5"> some detective and some preventive</font>

501
00:20:10,150 --> 00:20:15,090
controls so what we're<font color="#E5E5E5"> going to talk</font>

502
00:20:13,540 --> 00:20:17,500
<font color="#CCCCCC">about</font><font color="#E5E5E5"> from a detection standpoint is</font>

503
00:20:15,090 --> 00:20:19,389
full command line logging some user

504
00:20:17,500 --> 00:20:21,160
agent string monitoring process

505
00:20:19,390 --> 00:20:23,170
monitoring<font color="#E5E5E5"> and then from a prevention</font>

506
00:20:21,160 --> 00:20:24,880
<font color="#E5E5E5">standpoint</font><font color="#CCCCCC"> go through application</font>

507
00:20:23,170 --> 00:20:26,620
whitelisting<font color="#CCCCCC"> and then simply</font>

508
00:20:24,880 --> 00:20:28,090
uninstalling it now for the<font color="#CCCCCC"> the host</font>

509
00:20:26,620 --> 00:20:31,090
<font color="#E5E5E5">based controls I'm just gonna focus on</font>

510
00:20:28,090 --> 00:20:32,439
<font color="#E5E5E5">Windows</font><font color="#CCCCCC"> I'm sure</font><font color="#E5E5E5"> they're</font><font color="#CCCCCC"> unlike Mac or</font>

511
00:20:31,090 --> 00:20:34,330
Linux there<font color="#E5E5E5"> are some things you could do</font>

512
00:20:32,440 --> 00:20:36,820
but for<font color="#E5E5E5"> like the the host based stuff</font>

513
00:20:34,330 --> 00:20:43,030
I'm gonna<font color="#E5E5E5"> focus on Windows that was a</font>

514
00:20:36,820 --> 00:20:44,919
great game that's great oh yeah I wish I

515
00:20:43,030 --> 00:20:46,810
wish that<font color="#E5E5E5"> happen again this year but</font>

516
00:20:44,920 --> 00:20:50,740
hopefully<font color="#E5E5E5"> hopefully it'll happen next</font>

517
00:20:46,810 --> 00:20:52,899
year LeBron please stay<font color="#CCCCCC"> alright so from</font>

518
00:20:50,740 --> 00:20:55,510
a detection standpoint<font color="#E5E5E5"> full command</font><font color="#CCCCCC"> line</font>

519
00:20:52,900 --> 00:20:57,190
logging system on<font color="#E5E5E5"> it's great so what I</font>

520
00:20:55,510 --> 00:21:00,190
have here<font color="#E5E5E5"> I just</font><font color="#CCCCCC"> had a default</font><font color="#E5E5E5"> install</font>

521
00:20:57,190 --> 00:21:02,020
system on and you can see you can see

522
00:21:00,190 --> 00:21:05,080
here<font color="#E5E5E5"> there's my full command line that</font>

523
00:21:02,020 --> 00:21:07,180
<font color="#CCCCCC">I'm running</font><font color="#E5E5E5"> the load function right so</font>

524
00:21:05,080 --> 00:21:09,879
<font color="#CCCCCC">there's a</font><font color="#E5E5E5"> process create there's exactly</font>

525
00:21:07,180 --> 00:21:11,710
<font color="#E5E5E5">what I'm executing</font><font color="#CCCCCC"> everything's right</font>

526
00:21:09,880 --> 00:21:13,690
<font color="#CCCCCC">there</font><font color="#E5E5E5"> quick command left full command</font>

527
00:21:11,710 --> 00:21:15,160
line logging is<font color="#CCCCCC"> one thing but if you're</font>

528
00:21:13,690 --> 00:21:17,050
gonna log and not get it sent anywhere

529
00:21:15,160 --> 00:21:19,420
it's<font color="#E5E5E5"> pointless right so in</font><font color="#CCCCCC"> addition to</font>

530
00:21:17,050 --> 00:21:20,710
<font color="#E5E5E5">doing full command line logging you need</font>

531
00:21:19,420 --> 00:21:22,810
to make sure<font color="#CCCCCC"> that gets sent</font><font color="#E5E5E5"> to your sim</font>

532
00:21:20,710 --> 00:21:24,640
you make sure<font color="#E5E5E5"> that alerts</font><font color="#CCCCCC"> get</font><font color="#E5E5E5"> put on</font><font color="#CCCCCC"> it</font>

533
00:21:22,810 --> 00:21:26,290
as well<font color="#E5E5E5"> so</font><font color="#CCCCCC"> that's just something to keep</font>

534
00:21:24,640 --> 00:21:27,730
<font color="#E5E5E5">in</font><font color="#CCCCCC"> mind that</font><font color="#E5E5E5"> if you're gonna log make</font>

535
00:21:26,290 --> 00:21:31,560
sure it actually<font color="#E5E5E5"> gets sent somewhere and</font>

536
00:21:27,730 --> 00:21:31,560
that's you can<font color="#CCCCCC"> put alerts off of it</font>

537
00:21:32,190 --> 00:21:36,700
another piece for<font color="#E5E5E5"> detection so this is</font>

538
00:21:34,720 --> 00:21:38,200
network based security<font color="#E5E5E5"> control user</font>

539
00:21:36,700 --> 00:21:41,680
agent string monitoring so I mentioned

540
00:21:38,200 --> 00:21:43,840
<font color="#CCCCCC">that</font><font color="#E5E5E5"> the cat the cat function the copy</font>

541
00:21:41,680 --> 00:21:45,100
<font color="#E5E5E5">function and the load function all have</font>

542
00:21:43,840 --> 00:21:47,110
a user<font color="#E5E5E5"> agent string that they use</font>

543
00:21:45,100 --> 00:21:49,389
whenever<font color="#E5E5E5"> they're performing that remote</font>

544
00:21:47,110 --> 00:21:51,040
activity so what the user agent<font color="#E5E5E5"> string</font>

545
00:21:49,390 --> 00:21:53,590
looks<font color="#E5E5E5"> like it will have it highlighted</font>

546
00:21:51,040 --> 00:21:56,678
<font color="#E5E5E5">here it'll it'll be Java and</font>

547
00:21:53,590 --> 00:22:00,250
<font color="#E5E5E5">then</font><font color="#CCCCCC"> / and</font><font color="#E5E5E5"> then whatever</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> is so</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> the</font>

548
00:21:56,679 --> 00:22:03,279
<font color="#E5E5E5">machine I was testing this on it had JDK</font>

549
00:22:00,250 --> 00:22:06,250
<font color="#CCCCCC">9.04</font><font color="#E5E5E5"> so the user agent string when I was</font>

550
00:22:03,279 --> 00:22:10,090
<font color="#CCCCCC">using those those utilities was Java</font>

551
00:22:06,250 --> 00:22:11,679
<font color="#E5E5E5">slash and then 90.4 so you could</font>

552
00:22:10,090 --> 00:22:14,230
<font color="#E5E5E5">implement rules for this like in your</font>

553
00:22:11,679 --> 00:22:17,110
proxy<font color="#E5E5E5"> to detect this user agent string</font>

554
00:22:14,230 --> 00:22:20,529
similar to you know<font color="#CCCCCC"> cert utils gotten a</font>

555
00:22:17,110 --> 00:22:22,510
lot<font color="#CCCCCC"> of attention lately from</font><font color="#E5E5E5"> something</font>

556
00:22:20,529 --> 00:22:24,549
Casey Smith<font color="#E5E5E5"> found as well</font><font color="#CCCCCC"> cert you till</font>

557
00:22:22,510 --> 00:22:27,100
uses a<font color="#E5E5E5"> specific user agent string that</font>

558
00:22:24,549 --> 00:22:29,230
you can easily key off of<font color="#E5E5E5"> same concept</font>

559
00:22:27,100 --> 00:22:33,399
here<font color="#E5E5E5"> you can key off</font><font color="#CCCCCC"> of the user</font><font color="#E5E5E5"> agent</font>

560
00:22:29,230 --> 00:22:35,289
string that's<font color="#E5E5E5"> being used another piece</font>

561
00:22:33,399 --> 00:22:37,570
for detective detective control is

562
00:22:35,289 --> 00:22:39,730
process monitoring<font color="#E5E5E5"> so if you have some</font>

563
00:22:37,570 --> 00:22:41,559
<font color="#E5E5E5">sort of agent on the box that you can do</font>

564
00:22:39,730 --> 00:22:45,159
a process<font color="#E5E5E5"> monitoring for malicious</font>

565
00:22:41,559 --> 00:22:48,250
<font color="#E5E5E5">processes you can look for a process as</font>

566
00:22:45,159 --> 00:22:49,570
a contains a run script or<font color="#CCCCCC"> jjs keep in</font>

567
00:22:48,250 --> 00:22:52,000
mind though that<font color="#E5E5E5"> if the attacker has</font>

568
00:22:49,570 --> 00:22:54,399
privileges on<font color="#CCCCCC"> the machine</font><font color="#E5E5E5"> to rename</font>

569
00:22:52,000 --> 00:22:56,559
those executables<font color="#CCCCCC"> that he could</font>

570
00:22:54,399 --> 00:22:57,879
obviously rename them and use them<font color="#E5E5E5"> you</font>

571
00:22:56,559 --> 00:23:00,158
know<font color="#E5E5E5"> with a different name so just keep</font>

572
00:22:57,880 --> 00:23:02,679
that<font color="#E5E5E5"> in</font><font color="#CCCCCC"> mind here's an example I'm just</font>

573
00:23:00,159 --> 00:23:04,390
<font color="#E5E5E5">using PowerShell to</font><font color="#CCCCCC"> filter on</font><font color="#E5E5E5"> J run</font>

574
00:23:02,679 --> 00:23:07,000
script and then I'm outputting<font color="#CCCCCC"> the</font>

575
00:23:04,390 --> 00:23:08,679
process ID and then<font color="#E5E5E5"> the full command</font>

576
00:23:07,000 --> 00:23:10,510
line full command line is key<font color="#E5E5E5"> whenever</font>

577
00:23:08,679 --> 00:23:12,309
you're doing process monitoring<font color="#E5E5E5"> you</font>

578
00:23:10,510 --> 00:23:13,750
don't just want the the process name you

579
00:23:12,309 --> 00:23:15,908
want it the full command line to see

580
00:23:13,750 --> 00:23:18,610
exactly<font color="#E5E5E5"> what it's doing</font><font color="#CCCCCC"> so you can see</font>

581
00:23:15,909 --> 00:23:23,950
here the load function<font color="#E5E5E5"> is being</font><font color="#CCCCCC"> called</font>

582
00:23:18,610 --> 00:23:25,959
and I am<font color="#E5E5E5"> filtering on that from a</font>

583
00:23:23,950 --> 00:23:27,309
<font color="#E5E5E5">prevention standpoint application</font>

584
00:23:25,960 --> 00:23:29,350
whitelisting again has gotten a lot of

585
00:23:27,309 --> 00:23:30,668
<font color="#CCCCCC">attention lately especially with a lot</font>

586
00:23:29,350 --> 00:23:32,260
of the<font color="#E5E5E5"> research with some of the native</font>

587
00:23:30,669 --> 00:23:35,200
microsoft binaries you can use to

588
00:23:32,260 --> 00:23:37,570
execute<font color="#E5E5E5"> c-sharp code</font><font color="#CCCCCC"> same thing with</font>

589
00:23:35,200 --> 00:23:40,510
this so implement a robust application

590
00:23:37,570 --> 00:23:44,020
whitelisting policy including the

591
00:23:40,510 --> 00:23:46,510
blocking<font color="#E5E5E5"> of j run script and</font><font color="#CCCCCC"> jjs so like</font>

592
00:23:44,020 --> 00:23:49,720
with a blocker for example this is a

593
00:23:46,510 --> 00:23:51,669
snippet<font color="#E5E5E5"> from from</font><font color="#CCCCCC"> microsoft</font><font color="#E5E5E5"> and with app</font>

594
00:23:49,720 --> 00:23:55,419
<font color="#E5E5E5">Locker has some default executable rules</font>

595
00:23:51,669 --> 00:23:57,760
<font color="#E5E5E5">one of those is allow all users</font><font color="#CCCCCC"> to run</font>

596
00:23:55,419 --> 00:23:58,630
executed executable files in the Program

597
00:23:57,760 --> 00:24:01,210
Files folder

598
00:23:58,630 --> 00:24:03,010
the problem is J run script and<font color="#E5E5E5"> JJ s are</font>

599
00:24:01,210 --> 00:24:04,960
in the Program Files<font color="#E5E5E5"> folder so if you're</font>

600
00:24:03,010 --> 00:24:06,129
<font color="#CCCCCC">doing it using the default rules</font><font color="#E5E5E5"> these</font>

601
00:24:04,960 --> 00:24:08,289
<font color="#E5E5E5">are going to get passed it</font>

602
00:24:06,130 --> 00:24:10,470
so you need to make<font color="#CCCCCC"> sure you do</font>

603
00:24:08,289 --> 00:24:12,910
something<font color="#E5E5E5"> beyond just the default rules</font>

604
00:24:10,470 --> 00:24:14,289
you know I'm not<font color="#E5E5E5"> sure from a</font><font color="#CCCCCC"> Mac</font>

605
00:24:12,910 --> 00:24:17,230
standpoint I<font color="#CCCCCC"> don't know there's</font><font color="#E5E5E5"> any</font>

606
00:24:14,289 --> 00:24:18,309
experts on on<font color="#E5E5E5"> Mac as far as application</font>

607
00:24:17,230 --> 00:24:20,049
whitelisting but I'm sure there's

608
00:24:18,309 --> 00:24:22,120
<font color="#E5E5E5">something similar</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> you could you</font>

609
00:24:20,049 --> 00:24:27,389
<font color="#E5E5E5">could do on Macs if your users are</font><font color="#CCCCCC"> using</font>

610
00:24:22,120 --> 00:24:29,709
<font color="#CCCCCC">Macs</font><font color="#E5E5E5"> and then simply uninstall</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> I mean</font>

611
00:24:27,390 --> 00:24:30,700
like I said<font color="#E5E5E5"> Bob from accounting does not</font>

612
00:24:29,710 --> 00:24:34,299
need<font color="#E5E5E5"> the Java development kit installed</font>

613
00:24:30,700 --> 00:24:37,030
<font color="#CCCCCC">so if you have the</font><font color="#E5E5E5"> capability to survey</font>

614
00:24:34,299 --> 00:24:38,590
the software inventory<font color="#E5E5E5"> in</font><font color="#CCCCCC"> your</font>

615
00:24:37,030 --> 00:24:40,899
enterprise<font color="#CCCCCC"> I would highly recommend</font>

616
00:24:38,590 --> 00:24:42,129
<font color="#CCCCCC">taking a look</font><font color="#E5E5E5"> at how</font><font color="#CCCCCC"> many</font><font color="#E5E5E5"> machines have</font>

617
00:24:40,900 --> 00:24:44,140
the Java<font color="#E5E5E5"> development kit</font><font color="#CCCCCC"> installed</font>

618
00:24:42,130 --> 00:24:46,659
<font color="#E5E5E5">particularly the version is well like I</font>

619
00:24:44,140 --> 00:24:50,200
said<font color="#CCCCCC"> you the attacker can start</font>

620
00:24:46,659 --> 00:24:53,830
<font color="#E5E5E5">utilizing the theNational</font><font color="#CCCCCC"> JavaScript</font>

621
00:24:50,200 --> 00:24:55,150
engine starting with JDK 8<font color="#E5E5E5"> but I would</font>

622
00:24:53,830 --> 00:24:56,789
start I would<font color="#E5E5E5"> take a look at that and</font>

623
00:24:55,150 --> 00:25:03,539
<font color="#CCCCCC">just uninstall</font><font color="#E5E5E5"> it where it's not needed</font>

624
00:24:56,789 --> 00:25:05,970
<font color="#E5E5E5">so listen to Yoda so I've gone</font><font color="#CCCCCC"> through</font>

625
00:25:03,539 --> 00:25:08,760
the Java<font color="#E5E5E5"> development kit at a high level</font>

626
00:25:05,970 --> 00:25:10,870
<font color="#E5E5E5">went through the</font><font color="#CCCCCC"> JDK scripting tools</font>

627
00:25:08,760 --> 00:25:13,059
<font color="#CCCCCC">went</font><font color="#E5E5E5"> through the nature and JavaScript</font>

628
00:25:10,870 --> 00:25:15,668
engine<font color="#E5E5E5"> went through some offensive use</font>

629
00:25:13,059 --> 00:25:17,678
cases<font color="#CCCCCC"> some detective irrelevant controls</font>

630
00:25:15,669 --> 00:25:20,200
<font color="#E5E5E5">now I'm going to demo some of this right</font>

631
00:25:17,679 --> 00:25:23,220
so I pre recorded some demos to<font color="#CCCCCC"> show you</font>

632
00:25:20,200 --> 00:25:23,220
guys<font color="#E5E5E5"> and talk through it</font>

633
00:25:31,320 --> 00:25:37,179
<font color="#E5E5E5">all right so this first</font><font color="#CCCCCC"> one is</font><font color="#E5E5E5"> going</font><font color="#CCCCCC"> to</font>

634
00:25:34,900 --> 00:25:39,670
be on<font color="#E5E5E5"> Mac so it's going to be a reverse</font>

635
00:25:37,180 --> 00:25:42,400
<font color="#CCCCCC">shell it's going to send the</font><font color="#E5E5E5"> bash</font>

636
00:25:39,670 --> 00:25:48,010
process<font color="#CCCCCC"> interactive bash process</font><font color="#E5E5E5"> across</font>

637
00:25:42,400 --> 00:25:49,000
<font color="#E5E5E5">the wire to my my attacking box so</font>

638
00:25:48,010 --> 00:25:50,950
here's my listener

639
00:25:49,000 --> 00:25:52,690
it says<font color="#E5E5E5"> Windows but just</font><font color="#CCCCCC"> ignore it</font><font color="#E5E5E5"> it's</font>

640
00:25:50,950 --> 00:25:54,250
just<font color="#E5E5E5"> a generic listener it'll catch</font>

641
00:25:52,690 --> 00:25:56,590
<font color="#E5E5E5">whatever shall I send to</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> and</font>

642
00:25:54,250 --> 00:25:59,290
<font color="#E5E5E5">Metasploit you could also use net cap</font>

643
00:25:56,590 --> 00:26:01,240
but with<font color="#CCCCCC"> Metasploit</font><font color="#E5E5E5"> you can it can catch</font>

644
00:25:59,290 --> 00:26:03,040
and manage multiple<font color="#E5E5E5"> sessions with</font>

645
00:26:01,240 --> 00:26:10,060
something like this so<font color="#CCCCCC"> I used Metis boy</font>

646
00:26:03,040 --> 00:26:13,920
<font color="#E5E5E5">from this instance</font><font color="#CCCCCC"> alright</font><font color="#E5E5E5"> so here's the</font>

647
00:26:10,060 --> 00:26:16,960
one-liner<font color="#CCCCCC"> composite</font><font color="#E5E5E5"> so like I saw in the</font>

648
00:26:13,920 --> 00:26:18,970
PowerPoint<font color="#E5E5E5"> slides</font><font color="#CCCCCC"> here's the</font><font color="#E5E5E5"> host that</font>

649
00:26:16,960 --> 00:26:21,610
I'm sending<font color="#CCCCCC"> the shell - there's the port</font>

650
00:26:18,970 --> 00:26:23,710
so what's different about the bash

651
00:26:21,610 --> 00:26:26,199
milliner compared to the the<font color="#CCCCCC"> Windows</font><font color="#E5E5E5"> one</font>

652
00:26:23,710 --> 00:26:28,240
instead<font color="#E5E5E5"> of setting the cmd.exe process</font>

653
00:26:26,200 --> 00:26:30,220
we're sending the bin bash process<font color="#E5E5E5"> and</font>

654
00:26:28,240 --> 00:26:31,810
the other<font color="#E5E5E5"> difference is I'm adding</font><font color="#CCCCCC"> an</font>

655
00:26:30,220 --> 00:26:34,510
argument here to send an interactive

656
00:26:31,810 --> 00:26:38,080
shell as<font color="#CCCCCC"> well it's not a tty</font><font color="#E5E5E5"> but it's an</font>

657
00:26:34,510 --> 00:26:42,520
<font color="#E5E5E5">interactive show so we're gonna run this</font>

658
00:26:38,080 --> 00:26:43,449
one-liner so here<font color="#E5E5E5"> I'm highlighting kind</font>

659
00:26:42,520 --> 00:26:45,850
of<font color="#CCCCCC"> the what I</font><font color="#E5E5E5"> just talked through</font>

660
00:26:43,450 --> 00:26:47,860
account with the the bash<font color="#CCCCCC"> process so</font><font color="#E5E5E5"> I</font>

661
00:26:45,850 --> 00:26:52,510
can<font color="#CCCCCC"> see the one-liner</font><font color="#E5E5E5"> boom there's our</font>

662
00:26:47,860 --> 00:26:57,310
shell and we can<font color="#E5E5E5"> interact with it</font><font color="#CCCCCC"> yep</font>

663
00:26:52,510 --> 00:26:59,950
that's right<font color="#E5E5E5"> shell your shell dance I'm</font>

664
00:26:57,310 --> 00:27:02,080
not<font color="#CCCCCC"> doing my shell</font><font color="#E5E5E5"> dance right now so</font>

665
00:26:59,950 --> 00:27:05,560
yeah<font color="#E5E5E5"> interact with it and that's all</font>

666
00:27:02,080 --> 00:27:09,520
there<font color="#CCCCCC"> is to it so the second example</font>

667
00:27:05,560 --> 00:27:10,899
<font color="#E5E5E5">with Mac it's gonna be a again it's</font>

668
00:27:09,520 --> 00:27:12,820
gonna<font color="#E5E5E5"> be reversed shell however this</font>

669
00:27:10,900 --> 00:27:14,050
time it's going to<font color="#E5E5E5"> be the basic C 4</font>

670
00:27:12,820 --> 00:27:18,490
encoded<font color="#CCCCCC"> one we talked about in the</font>

671
00:27:14,050 --> 00:27:20,200
slides so<font color="#CCCCCC"> again ignore the ignore the</font>

672
00:27:18,490 --> 00:27:22,960
listener<font color="#CCCCCC"> all right</font><font color="#E5E5E5"> something pause it</font>

673
00:27:20,200 --> 00:27:25,870
<font color="#CCCCCC">here so you're gonna see here</font><font color="#E5E5E5"> we're</font>

674
00:27:22,960 --> 00:27:27,520
<font color="#CCCCCC">using the the eval function and then I'm</font>

675
00:27:25,870 --> 00:27:30,399
<font color="#E5E5E5">gonna highlight the blob here this blob</font>

676
00:27:27,520 --> 00:27:32,879
is gonna be our<font color="#E5E5E5"> our code that does the</font>

677
00:27:30,400 --> 00:27:32,880
reverse<font color="#E5E5E5"> shell</font>

678
00:27:33,020 --> 00:27:37,500
and after after this<font color="#E5E5E5"> I'm gonna actually</font>

679
00:27:35,820 --> 00:27:39,840
<font color="#E5E5E5">decode this you can see exactly what</font><font color="#CCCCCC"> it</font>

680
00:27:37,500 --> 00:27:41,720
is we're gonna<font color="#E5E5E5"> run</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> boom</font>

681
00:27:39,840 --> 00:27:44,990
there's your<font color="#E5E5E5"> shell do your shell dance</font>

682
00:27:41,720 --> 00:27:49,670
again you can interact<font color="#CCCCCC"> with the shell</font>

683
00:27:44,990 --> 00:27:52,550
<font color="#E5E5E5">right so then we're going to go back and</font>

684
00:27:49,670 --> 00:27:54,630
I'm<font color="#E5E5E5"> gonna show you kind of how</font><font color="#CCCCCC"> to</font>

685
00:27:52,550 --> 00:27:56,190
reverse this<font color="#E5E5E5"> a little bit so you</font><font color="#CCCCCC"> can see</font>

686
00:27:54,630 --> 00:27:58,890
<font color="#E5E5E5">exactly what's doing so we're gonna take</font>

687
00:27:56,190 --> 00:27:59,750
this<font color="#CCCCCC"> this string basics foreign code</font>

688
00:27:58,890 --> 00:28:02,280
string

689
00:27:59,750 --> 00:28:03,690
we're gonna base<font color="#E5E5E5"> we're encoded we're</font>

690
00:28:02,280 --> 00:28:08,580
going to decode<font color="#E5E5E5"> it and write it</font><font color="#CCCCCC"> to a</font>

691
00:28:03,690 --> 00:28:11,490
file real quick and then we're<font color="#CCCCCC"> going to</font>

692
00:28:08,580 --> 00:28:13,980
take a<font color="#E5E5E5"> look at the file so as you can</font>

693
00:28:11,490 --> 00:28:16,440
see<font color="#E5E5E5"> easily reversible there's the host</font>

694
00:28:13,980 --> 00:28:20,190
I'm<font color="#CCCCCC"> sending the shell to poor</font><font color="#E5E5E5"> bash</font>

695
00:28:16,440 --> 00:28:21,510
process<font color="#E5E5E5"> interactive shell so from an</font>

696
00:28:20,190 --> 00:28:22,800
offensive standpoint if you you have

697
00:28:21,510 --> 00:28:24,750
your whatever<font color="#E5E5E5"> your javascript</font><font color="#CCCCCC"> code is</font>

698
00:28:22,800 --> 00:28:27,930
just basically for encode it put it in

699
00:28:24,750 --> 00:28:29,310
<font color="#E5E5E5">that command and</font><font color="#CCCCCC"> it will</font><font color="#E5E5E5"> run it from a</font>

700
00:28:27,930 --> 00:28:30,840
defensive standpoint you<font color="#E5E5E5"> can see how it</font>

701
00:28:29,310 --> 00:28:32,850
easy it<font color="#E5E5E5"> is to reverse that if you see it</font>

702
00:28:30,840 --> 00:28:33,929
<font color="#E5E5E5">like in system on if you see the full</font>

703
00:28:32,850 --> 00:28:40,560
command line log you see that getting

704
00:28:33,930 --> 00:28:45,540
<font color="#E5E5E5">ran</font><font color="#CCCCCC"> it's it's easy to reverse right</font><font color="#E5E5E5"> now</font>

705
00:28:40,560 --> 00:28:46,889
let's switch<font color="#CCCCCC"> to</font><font color="#E5E5E5"> Windows so kind of</font>

706
00:28:45,540 --> 00:28:49,500
playing<font color="#E5E5E5"> with the the one-liner theme</font>

707
00:28:46,890 --> 00:28:51,420
here I thought<font color="#E5E5E5"> I'd show the the</font><font color="#CCCCCC"> Windows</font>

708
00:28:49,500 --> 00:28:53,640
<font color="#CCCCCC">one liner in action as well so it's</font>

709
00:28:51,420 --> 00:28:57,180
<font color="#E5E5E5">gonna be the exact same code</font><font color="#CCCCCC"> as the the</font>

710
00:28:53,640 --> 00:28:59,520
the Mac one except for<font color="#CCCCCC"> December's gonna</font>

711
00:28:57,180 --> 00:29:01,110
<font color="#E5E5E5">be</font><font color="#CCCCCC"> sending</font><font color="#E5E5E5"> the cmd.exe process we don't</font>

712
00:28:59,520 --> 00:29:02,220
<font color="#E5E5E5">need any arguments like we did</font><font color="#CCCCCC"> I didn't</font>

713
00:29:01,110 --> 00:29:05,760
<font color="#E5E5E5">have any arguments like we did with the</font>

714
00:29:02,220 --> 00:29:09,300
the bash<font color="#CCCCCC"> process and</font><font color="#E5E5E5"> again you can see</font>

715
00:29:05,760 --> 00:29:11,940
<font color="#E5E5E5">it's accessing the various Java objects</font>

716
00:29:09,300 --> 00:29:14,159
so java.net<font color="#CCCCCC"> that socket alright it's</font>

717
00:29:11,940 --> 00:29:17,790
accessing<font color="#E5E5E5"> all of</font><font color="#CCCCCC"> those which nation</font>

718
00:29:14,160 --> 00:29:23,310
<font color="#CCCCCC">JavaScript makes that possible</font><font color="#E5E5E5"> so run</font>

719
00:29:17,790 --> 00:29:25,500
that the message boom shell so you can

720
00:29:23,310 --> 00:29:30,540
you see<font color="#E5E5E5"> here we're</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> be H Potter</font><font color="#CCCCCC"> I</font>

721
00:29:25,500 --> 00:29:34,070
think on Hogwarts<font color="#E5E5E5"> Network yes we are on</font>

722
00:29:30,540 --> 00:29:34,070
Harry's machine there

723
00:29:34,480 --> 00:29:40,400
hopefully there's some Harry Potter fans

724
00:29:36,380 --> 00:29:43,160
that actually<font color="#E5E5E5"> got that joke all right</font>

725
00:29:40,400 --> 00:29:45,950
next<font color="#E5E5E5"> one this was my favorite one this</font>

726
00:29:43,160 --> 00:29:49,310
is the remote loading function so I'm

727
00:29:45,950 --> 00:29:51,560
hosting a JavaScript file remotely<font color="#E5E5E5"> I'm</font>

728
00:29:49,310 --> 00:29:54,379
<font color="#CCCCCC">gonna show</font><font color="#E5E5E5"> you the the Apache log here</font>

729
00:29:51,560 --> 00:29:56,480
what it looks like<font color="#CCCCCC"> so let's</font><font color="#E5E5E5"> start this</font>

730
00:29:54,380 --> 00:30:01,100
example here I have<font color="#CCCCCC"> my listener up</font><font color="#E5E5E5"> the</font>

731
00:29:56,480 --> 00:30:02,390
Metasploit<font color="#CCCCCC"> patchy log alright so what I</font>

732
00:30:01,100 --> 00:30:04,370
talked<font color="#CCCCCC"> about before kind</font><font color="#E5E5E5"> of that</font>

733
00:30:02,390 --> 00:30:07,160
<font color="#E5E5E5">straight you can prepend</font><font color="#CCCCCC"> J run script</font>

734
00:30:04,370 --> 00:30:09,139
you don't know the version<font color="#CCCCCC"> doing that</font><font color="#E5E5E5"> J</font>

735
00:30:07,160 --> 00:30:10,790
run script<font color="#E5E5E5"> load function and then</font>

736
00:30:09,140 --> 00:30:14,180
passing<font color="#E5E5E5"> it the URL to where I'm hosting</font>

737
00:30:10,790 --> 00:30:16,370
that<font color="#E5E5E5"> javascript file so we're gonna run</font>

738
00:30:14,180 --> 00:30:21,020
that again<font color="#E5E5E5"> does it</font><font color="#CCCCCC"> without dropping</font>

739
00:30:16,370 --> 00:30:23,479
anything<font color="#E5E5E5"> to disk it's</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> run that so</font>

740
00:30:21,020 --> 00:30:27,139
there's the there's the Apache log entry

741
00:30:23,480 --> 00:30:28,790
<font color="#E5E5E5">so you can see it's fetching</font><font color="#CCCCCC"> rev CMD j s</font>

742
00:30:27,140 --> 00:30:30,440
there's a user<font color="#E5E5E5"> agent string that I</font>

743
00:30:28,790 --> 00:30:33,409
talked about<font color="#E5E5E5"> that you can key off of</font>

744
00:30:30,440 --> 00:30:36,350
Java<font color="#E5E5E5"> slash 90.4 so it fetches the</font>

745
00:30:33,410 --> 00:30:40,130
<font color="#CCCCCC">JavaScript file and then runs it now you</font>

746
00:30:36,350 --> 00:30:43,419
see<font color="#CCCCCC"> our shell came in so again we keep</font>

747
00:30:40,130 --> 00:30:49,820
getting<font color="#E5E5E5"> on Harry's machine here so I</font>

748
00:30:43,420 --> 00:30:51,920
think<font color="#E5E5E5"> you keep us off of</font><font color="#CCCCCC"> it alright</font><font color="#E5E5E5"> this</font>

749
00:30:49,820 --> 00:30:53,210
<font color="#CCCCCC">next</font><font color="#E5E5E5"> example just one more example</font><font color="#CCCCCC"> from</font>

750
00:30:51,920 --> 00:30:55,870
an offensive standpoint<font color="#E5E5E5"> and I'm going to</font>

751
00:30:53,210 --> 00:30:59,540
show you<font color="#CCCCCC"> something quick with sis Mon</font>

752
00:30:55,870 --> 00:31:01,669
oops so this example<font color="#E5E5E5"> here we're gonna</font>

753
00:30:59,540 --> 00:31:03,230
<font color="#E5E5E5">use the copy function</font><font color="#CCCCCC"> to download the</font>

754
00:31:01,670 --> 00:31:09,320
<font color="#CCCCCC">JavaScript</font><font color="#E5E5E5"> file</font><font color="#CCCCCC"> then we're going</font><font color="#E5E5E5"> to use</font>

755
00:31:03,230 --> 00:31:11,240
<font color="#E5E5E5">JJ s to run it since its local now now</font>

756
00:31:09,320 --> 00:31:14,389
obviously<font color="#CCCCCC"> all these</font><font color="#E5E5E5"> examples I'm doing</font>

757
00:31:11,240 --> 00:31:15,650
this from CMD<font color="#E5E5E5"> you know guys doing</font>

758
00:31:14,390 --> 00:31:17,060
<font color="#E5E5E5">offense obvious when you do is for real</font>

759
00:31:15,650 --> 00:31:18,770
you're not going to be doing<font color="#CCCCCC"> is from CMD</font>

760
00:31:17,060 --> 00:31:20,240
it's gonna be<font color="#E5E5E5"> whether you're sending in</font>

761
00:31:18,770 --> 00:31:21,560
like a<font color="#E5E5E5"> malicious document or something</font>

762
00:31:20,240 --> 00:31:23,300
like<font color="#E5E5E5"> that and it's executed from there</font>

763
00:31:21,560 --> 00:31:25,120
right so<font color="#CCCCCC"> this</font><font color="#E5E5E5"> is again just</font><font color="#CCCCCC"> for the</font>

764
00:31:23,300 --> 00:31:27,230
<font color="#E5E5E5">example</font>

765
00:31:25,120 --> 00:31:28,518
so you have<font color="#E5E5E5"> our listener up and then</font>

766
00:31:27,230 --> 00:31:29,600
we're at Apache log so<font color="#E5E5E5"> you can see what</font>

767
00:31:28,519 --> 00:31:34,340
<font color="#E5E5E5">that</font><font color="#CCCCCC"> looks like as well with the copy</font>

768
00:31:29,600 --> 00:31:36,620
function so you can<font color="#E5E5E5"> see here doing the</font>

769
00:31:34,340 --> 00:31:42,379
copy function<font color="#CCCCCC"> I'm copying the remote</font>

770
00:31:36,620 --> 00:31:49,789
file to see temp<font color="#CCCCCC"> read CMD Jas so let's</font>

771
00:31:42,380 --> 00:31:53,659
<font color="#E5E5E5">run that again</font><font color="#CCCCCC"> run that</font><font color="#E5E5E5"> you can see the</font>

772
00:31:49,789 --> 00:32:01,639
Apache log hit<font color="#E5E5E5"> rev CMD</font><font color="#CCCCCC"> Jas there's the</font>

773
00:31:53,659 --> 00:32:03,320
<font color="#E5E5E5">user-agent string so we can see here</font>

774
00:32:01,639 --> 00:32:05,990
that<font color="#CCCCCC"> the</font><font color="#E5E5E5"> is proving that</font><font color="#CCCCCC"> the file</font><font color="#E5E5E5"> was</font>

775
00:32:03,320 --> 00:32:07,519
<font color="#E5E5E5">downloaded and</font><font color="#CCCCCC"> now the file is</font>

776
00:32:05,990 --> 00:32:09,200
<font color="#CCCCCC">downloaded we're gonna use jjs to</font>

777
00:32:07,519 --> 00:32:11,690
execute it to give us the<font color="#CCCCCC"> reverse shell</font>

778
00:32:09,200 --> 00:32:12,889
again just<font color="#E5E5E5"> past this is the only</font>

779
00:32:11,690 --> 00:32:17,710
functionality that<font color="#E5E5E5"> I thought was good</font>

780
00:32:12,889 --> 00:32:17,709
with<font color="#CCCCCC"> jjs passing the javascript file</font><font color="#E5E5E5"> and</font>

781
00:32:17,919 --> 00:32:28,279
<font color="#CCCCCC">there's</font><font color="#E5E5E5"> our shell again see up again and</font>

782
00:32:23,600 --> 00:32:29,658
proven we're on<font color="#E5E5E5"> Harry's machine here all</font>

783
00:32:28,279 --> 00:32:31,100
<font color="#CCCCCC">right so just</font><font color="#E5E5E5"> went</font><font color="#CCCCCC"> through some</font>

784
00:32:29,659 --> 00:32:33,409
offensive demos here<font color="#E5E5E5"> I'm going to show</font>

785
00:32:31,100 --> 00:32:35,289
<font color="#E5E5E5">you something really quick</font><font color="#CCCCCC"> so all</font><font color="#E5E5E5"> that</font>

786
00:32:33,409 --> 00:32:40,570
activity<font color="#E5E5E5"> we just took on Harry's machine</font>

787
00:32:35,289 --> 00:32:43,010
let's see<font color="#CCCCCC"> how noisy</font><font color="#E5E5E5"> me were there so</font>

788
00:32:40,570 --> 00:32:45,850
have system on running a default install

789
00:32:43,010 --> 00:32:48,649
<font color="#E5E5E5">so you can see here well you can see</font>

790
00:32:45,850 --> 00:32:51,620
there's that<font color="#E5E5E5"> one-liner for</font><font color="#CCCCCC"> the remote</font>

791
00:32:48,649 --> 00:32:53,120
load that I that I performed<font color="#E5E5E5"> so it's all</font>

792
00:32:51,620 --> 00:32:56,299
over<font color="#CCCCCC"> here in system on the parent</font>

793
00:32:53,120 --> 00:32:58,729
<font color="#CCCCCC">process ID so it</font><font color="#E5E5E5"> came from cmd.exe again</font>

794
00:32:56,299 --> 00:33:06,408
<font color="#E5E5E5">need to get this sent to the the sim to</font>

795
00:32:58,730 --> 00:33:08,389
build some alerts off of it<font color="#E5E5E5"> so we and</font>

796
00:33:06,409 --> 00:33:09,919
then we're gonna look at a<font color="#E5E5E5"> couple other</font>

797
00:33:08,389 --> 00:33:13,129
commands that<font color="#E5E5E5"> it saw so now we're going</font>

798
00:33:09,919 --> 00:33:21,049
<font color="#E5E5E5">to search</font><font color="#CCCCCC"> for jjs let's see if it's what</font>

799
00:33:13,130 --> 00:33:23,720
<font color="#CCCCCC">jjs looks</font><font color="#E5E5E5"> like okay so you can see here</font>

800
00:33:21,049 --> 00:33:26,450
<font color="#E5E5E5">okay there's s executing the</font><font color="#CCCCCC"> JavaScript</font>

801
00:33:23,720 --> 00:33:28,519
file so<font color="#CCCCCC"> it</font><font color="#E5E5E5"> got that let's see if it</font>

802
00:33:26,450 --> 00:33:31,420
caught the the the file download before

803
00:33:28,519 --> 00:33:39,650
<font color="#E5E5E5">that make sure that got logged</font>

804
00:33:31,420 --> 00:33:41,360
mr. J run<font color="#CCCCCC"> script' there's the the copy</font>

805
00:33:39,650 --> 00:33:43,850
function so you<font color="#E5E5E5"> can see exactly</font><font color="#CCCCCC"> what we</font>

806
00:33:41,360 --> 00:33:47,419
typed out<font color="#E5E5E5"> so we copied the the remote</font>

807
00:33:43,850 --> 00:34:03,139
file and saved it in<font color="#CCCCCC"> c TM</font><font color="#E5E5E5"> so got that as</font>

808
00:33:47,420 --> 00:34:06,860
<font color="#E5E5E5">well</font><font color="#CCCCCC"> all right so that's</font><font color="#E5E5E5"> all I have</font><font color="#CCCCCC"> for</font>

809
00:34:03,140 --> 00:34:08,270
my presentation<font color="#CCCCCC"> my</font><font color="#E5E5E5"> twitter is up there</font>

810
00:34:06,860 --> 00:34:10,730
and also<font color="#CCCCCC"> I recently just started</font><font color="#E5E5E5"> a blog</font>

811
00:34:08,270 --> 00:34:13,100
<font color="#CCCCCC">I have a blog post</font><font color="#E5E5E5"> on this very topic on</font>

812
00:34:10,730 --> 00:34:16,159
there as well<font color="#CCCCCC"> I'll share</font><font color="#E5E5E5"> my slides on</font>

813
00:34:13,100 --> 00:34:19,810
Twitter<font color="#E5E5E5"> early next week as well</font><font color="#CCCCCC"> with</font>

814
00:34:16,159 --> 00:34:29,870
that I'll leave time<font color="#CCCCCC"> for any</font><font color="#E5E5E5"> questions</font>

815
00:34:19,810 --> 00:34:32,179
<font color="#E5E5E5">yeah so the question</font><font color="#CCCCCC"> was</font><font color="#E5E5E5"> if</font><font color="#CCCCCC"> JJ</font><font color="#E5E5E5"> s if you</font>

816
00:34:29,870 --> 00:34:34,540
can rather<font color="#E5E5E5"> than pass at a local file if</font>

817
00:34:32,179 --> 00:34:36,500
you<font color="#E5E5E5"> can use a UNC path like a file share</font>

818
00:34:34,540 --> 00:34:39,860
<font color="#CCCCCC">that is something actually I did not</font>

819
00:34:36,500 --> 00:34:42,530
test out the JIT with JJ<font color="#E5E5E5"> s I think</font><font color="#CCCCCC"> it</font>

820
00:34:39,860 --> 00:34:44,389
<font color="#E5E5E5">should be</font><font color="#CCCCCC"> able to but I have</font><font color="#E5E5E5"> to have to</font>

821
00:34:42,530 --> 00:34:46,310
test<font color="#E5E5E5"> it out but rather than yeah for JD</font>

822
00:34:44,389 --> 00:35:02,810
s<font color="#E5E5E5"> the local file you should be able to</font>

823
00:34:46,310 --> 00:35:07,720
give<font color="#E5E5E5"> it a UNC path so right where the</font>

824
00:35:02,810 --> 00:35:07,720
sorry would fall<font color="#E5E5E5"> install</font><font color="#CCCCCC"> okay yeah</font>

825
00:35:12,349 --> 00:35:18,900
so so the<font color="#CCCCCC"> question was in my</font><font color="#E5E5E5"> example</font><font color="#CCCCCC"> is</font>

826
00:35:16,410 --> 00:35:20,879
I'm I'm<font color="#CCCCCC"> using the default location</font>

827
00:35:18,900 --> 00:35:23,250
install for Java so the question was

828
00:35:20,880 --> 00:35:24,329
whether if changing the directory<font color="#E5E5E5"> the</font>

829
00:35:23,250 --> 00:35:26,400
install would kind of<font color="#E5E5E5"> throw it off a</font>

830
00:35:24,329 --> 00:35:27,930
little bit

831
00:35:26,400 --> 00:35:29,280
attackers gonna figure it out<font color="#CCCCCC"> really</font>

832
00:35:27,930 --> 00:35:30,720
anyway so I mean<font color="#E5E5E5"> just changing the</font>

833
00:35:29,280 --> 00:35:35,039
directory really wouldn't<font color="#E5E5E5"> wouldn't do</font>

834
00:35:30,720 --> 00:35:43,020
<font color="#E5E5E5">much but but yeah so does that</font><font color="#CCCCCC"> answer</font>

835
00:35:35,039 --> 00:35:48,270
your question<font color="#CCCCCC"> a little bit</font><font color="#E5E5E5"> okay I'm not</font>

836
00:35:43,020 --> 00:35:48,509
<font color="#E5E5E5">very familiar with that okay got it got</font>

837
00:35:48,270 --> 00:35:54,089
<font color="#CCCCCC">it</font>

838
00:35:48,510 --> 00:35:55,410
so<font color="#CCCCCC"> the question was</font><font color="#E5E5E5"> with Java sandboxing</font>

839
00:35:54,089 --> 00:35:56,849
how<font color="#CCCCCC"> key defended against some</font><font color="#E5E5E5"> of that</font>

840
00:35:55,410 --> 00:35:58,799
unfortunately I'm not<font color="#E5E5E5"> very familiar with</font>

841
00:35:56,849 --> 00:36:01,740
the<font color="#CCCCCC"> Java sandboxing so I can't really</font>

842
00:35:58,799 --> 00:36:09,900
<font color="#CCCCCC">answer that question</font><font color="#E5E5E5"> maybe maybe maybe</font>

843
00:36:01,740 --> 00:36:11,160
part<font color="#CCCCCC"> to next year yeah good question the</font>

844
00:36:09,900 --> 00:36:12,390
question<font color="#E5E5E5"> was did I have to modify any</font>

845
00:36:11,160 --> 00:36:16,618
default<font color="#E5E5E5"> settings get this work</font>

846
00:36:12,390 --> 00:36:19,190
<font color="#CCCCCC">no</font><font color="#E5E5E5"> just default install and then that's</font>

847
00:36:16,619 --> 00:36:19,190
all<font color="#E5E5E5"> there was to it</font>

848
00:36:20,119 --> 00:36:28,289
any other questions<font color="#E5E5E5"> all right well thank</font>

849
00:36:26,039 --> 00:36:30,680
<font color="#E5E5E5">you very much for</font><font color="#CCCCCC"> attending and</font><font color="#E5E5E5"> we go</font>

850
00:36:28,289 --> 00:36:30,680
get some lunch

