1
00:00:00,420 --> 00:00:02,598
foreign

2
00:00:24,240 --> 00:00:27,779
hello I am Carissa and this is my

3
00:00:27,779 --> 00:00:29,820
colleague tosin and we are going to be

4
00:00:29,820 --> 00:00:33,540
presenting on kql and Azure ad workbooks

5
00:00:33,540 --> 00:00:36,540
for the blue team and so I'm assuming

6
00:00:36,540 --> 00:00:37,800
that all of you guys are part of a blue

7
00:00:37,800 --> 00:00:39,719
team but even if you're not you might

8
00:00:39,719 --> 00:00:42,719
like this session so also if you guys

9
00:00:42,719 --> 00:00:44,940
get hungry since it's noon feel free to

10
00:00:44,940 --> 00:00:46,320
go get something to eat and come back

11
00:00:46,320 --> 00:00:48,600
happy to do that

12
00:00:48,600 --> 00:00:49,800
um also everything that we're going to

13
00:00:49,800 --> 00:00:51,660
present today all of the resources

14
00:00:51,660 --> 00:00:53,160
everything we're going to give you a

15
00:00:53,160 --> 00:00:55,140
GitHub repo and everything will be in

16
00:00:55,140 --> 00:00:56,940
there so if you missed something don't

17
00:00:56,940 --> 00:00:57,899
worry

18
00:00:57,899 --> 00:01:00,539
all right let's get started so I am

19
00:01:00,539 --> 00:01:03,000
Carissa copeltman's and I am a product

20
00:01:03,000 --> 00:01:05,400
manager for Microsoft I've been with

21
00:01:05,400 --> 00:01:07,920
Microsoft about seven years and I've

22
00:01:07,920 --> 00:01:09,299
been in the identity space for about

23
00:01:09,299 --> 00:01:12,060
three years and as you know identity has

24
00:01:12,060 --> 00:01:14,700
become very important especially when it

25
00:01:14,700 --> 00:01:18,900
comes to cyber attacks it is always the

26
00:01:18,900 --> 00:01:22,259
focus of Bad actors so hand in hand with

27
00:01:22,259 --> 00:01:25,080
security and that's why we're here today

28
00:01:25,080 --> 00:01:26,700
I'm going to introduce toson but he's

29
00:01:26,700 --> 00:01:28,320
going to speak here in a little bit

30
00:01:28,320 --> 00:01:30,119
um tosin is my colleague he's also with

31
00:01:30,119 --> 00:01:32,579
Microsoft and we work on a team together

32
00:01:32,579 --> 00:01:34,799
it's called get to production

33
00:01:34,799 --> 00:01:37,020
um and that basically means that we sit

34
00:01:37,020 --> 00:01:39,659
in engineering but we closely work with

35
00:01:39,659 --> 00:01:42,240
a lot of our Enterprise customers and we

36
00:01:42,240 --> 00:01:44,100
help them deploy Azure active directory

37
00:01:44,100 --> 00:01:46,200
and we try to keep them as secure and

38
00:01:46,200 --> 00:01:48,780
safe as possible

39
00:01:48,780 --> 00:01:50,340
all right so today's session our

40
00:01:50,340 --> 00:01:52,979
learning objective is really to share

41
00:01:52,979 --> 00:01:54,720
some threat hunting techniques and give

42
00:01:54,720 --> 00:01:56,579
you guys some extra tools that maybe you

43
00:01:56,579 --> 00:01:59,640
haven't used before maybe a raise of

44
00:01:59,640 --> 00:02:03,240
hands has anybody does anybody use kql

45
00:02:03,240 --> 00:02:05,399
today

46
00:02:05,399 --> 00:02:08,580
fabulous okay so I don't know what level

47
00:02:08,580 --> 00:02:10,378
everyone is at but we're gonna just

48
00:02:10,378 --> 00:02:13,440
assume you guys have heard of it before

49
00:02:13,440 --> 00:02:15,480
um but I have provided a lot of extra

50
00:02:15,480 --> 00:02:18,360
resources if you are a very new beginner

51
00:02:18,360 --> 00:02:19,860
but at least today you'll get to see

52
00:02:19,860 --> 00:02:21,360
like what you can do with it and then

53
00:02:21,360 --> 00:02:23,760
you can go and either become more

54
00:02:23,760 --> 00:02:26,040
advanced or just you know get the lay of

55
00:02:26,040 --> 00:02:27,959
the land

56
00:02:27,959 --> 00:02:29,459
so we're gonna just walk through a quick

57
00:02:29,459 --> 00:02:32,819
overview of what workbooks are

58
00:02:32,819 --> 00:02:34,739
um some business cases that can really

59
00:02:34,739 --> 00:02:36,360
put it into perspective on how the blue

60
00:02:36,360 --> 00:02:39,060
team can use it and then we are going to

61
00:02:39,060 --> 00:02:41,340
dive into some threat hunting with kql

62
00:02:41,340 --> 00:02:42,900
and some tips and tricks that you can

63
00:02:42,900 --> 00:02:45,060
learn and then I have a last section

64
00:02:45,060 --> 00:02:46,739
which is really just an ask from you

65
00:02:46,739 --> 00:02:48,239
guys because

66
00:02:48,239 --> 00:02:51,440
um we would love your contribution

67
00:02:51,540 --> 00:02:54,300
all right so I'm assuming that probably

68
00:02:54,300 --> 00:02:57,420
everybody has heard the term zero trust

69
00:02:57,420 --> 00:02:59,819
and and actually maybe even seen this

70
00:02:59,819 --> 00:03:01,620
slide before but this is this is

71
00:03:01,620 --> 00:03:02,760
something we show a lot in our

72
00:03:02,760 --> 00:03:04,019
presentations

73
00:03:04,019 --> 00:03:05,640
um at Microsoft but it is very it's

74
00:03:05,640 --> 00:03:07,560
supposed to be very product agnostic

75
00:03:07,560 --> 00:03:09,900
basically every company needs to

76
00:03:09,900 --> 00:03:11,879
consider these pillars when they're

77
00:03:11,879 --> 00:03:14,239
considering um securing their entire

78
00:03:14,239 --> 00:03:16,500
environment so that includes identities

79
00:03:16,500 --> 00:03:19,739
it includes data applications their

80
00:03:19,739 --> 00:03:22,620
infrastructure and their Network so they

81
00:03:22,620 --> 00:03:24,720
have to consider oh and endpoints so

82
00:03:24,720 --> 00:03:26,040
they have to consider all of those

83
00:03:26,040 --> 00:03:28,140
things and then across the bottom here

84
00:03:28,140 --> 00:03:29,879
is the visibility and analytics where

85
00:03:29,879 --> 00:03:33,060
we're really diving in today so there's

86
00:03:33,060 --> 00:03:34,860
tons of tools to use and we know this

87
00:03:34,860 --> 00:03:37,680
but in terms of visibility and analytics

88
00:03:37,680 --> 00:03:39,480
we're going to show you what we can

89
00:03:39,480 --> 00:03:43,200
offer inside Azure active directory

90
00:03:43,200 --> 00:03:47,179
all right I'm gonna pass off to toast

91
00:03:51,480 --> 00:03:52,980
thank you everyone

92
00:03:52,980 --> 00:03:55,920
um like she said my name is tosin I also

93
00:03:55,920 --> 00:03:58,560
work on the GCB team and she really just

94
00:03:58,560 --> 00:04:00,120
introduced most of what I was about to

95
00:04:00,120 --> 00:04:01,920
kind of lead up with so I'll just repeat

96
00:04:01,920 --> 00:04:03,060
it again

97
00:04:03,060 --> 00:04:04,860
um we work on a team that interacts with

98
00:04:04,860 --> 00:04:07,319
customers the my main job is to help

99
00:04:07,319 --> 00:04:10,439
deploy Azure 80 features and then to do

100
00:04:10,439 --> 00:04:12,000
this one of the things I do is sit down

101
00:04:12,000 --> 00:04:14,159
and understand like use cases so what

102
00:04:14,159 --> 00:04:15,659
exactly are you trying to solve what

103
00:04:15,659 --> 00:04:18,298
problems do you have how can the

104
00:04:18,298 --> 00:04:20,519
products we build help in your

105
00:04:20,519 --> 00:04:22,259
productivity and increase um The

106
00:04:22,259 --> 00:04:24,060
Experience you have using Azure media as

107
00:04:24,060 --> 00:04:26,699
a feature right but we're mainly on the

108
00:04:26,699 --> 00:04:29,419
identity side of things so users devices

109
00:04:29,419 --> 00:04:32,160
locations policies that's where we sit

110
00:04:32,160 --> 00:04:34,860
that's where um our mate is but then

111
00:04:34,860 --> 00:04:37,080
there's this in-between part where it's

112
00:04:37,080 --> 00:04:38,820
like where identity but then we're also

113
00:04:38,820 --> 00:04:40,620
working with security and so you would

114
00:04:40,620 --> 00:04:42,060
have a bunch of security questions that

115
00:04:42,060 --> 00:04:44,100
come our way and this is where workbooks

116
00:04:44,100 --> 00:04:46,380
actually fall in right so one of the

117
00:04:46,380 --> 00:04:49,020
questions I get a lot is there's so many

118
00:04:49,020 --> 00:04:51,600
portals now we have so any data sources

119
00:04:51,600 --> 00:04:54,360
we have so many reports but then do I

120
00:04:54,360 --> 00:04:56,340
need to go into every single one or is

121
00:04:56,340 --> 00:04:58,020
there like a way I can put together this

122
00:04:58,020 --> 00:05:01,139
unified Visual and get insights on the

123
00:05:01,139 --> 00:05:03,840
data I have and that's where workbooks

124
00:05:03,840 --> 00:05:06,000
come in so generally the way I explain

125
00:05:06,000 --> 00:05:08,400
workbooks is think about this like a

126
00:05:08,400 --> 00:05:10,680
collection of all your data sources and

127
00:05:10,680 --> 00:05:13,199
one reports that gives you all that data

128
00:05:13,199 --> 00:05:15,539
and so whether it's coming from the logs

129
00:05:15,539 --> 00:05:17,759
you've captured whether it's coming from

130
00:05:17,759 --> 00:05:20,340
your custom endpoints for some external

131
00:05:20,340 --> 00:05:22,440
sources or

132
00:05:22,440 --> 00:05:23,100
um

133
00:05:23,100 --> 00:05:25,979
even just your Azure ad graph and graph

134
00:05:25,979 --> 00:05:28,560
resources the workbook is your way of

135
00:05:28,560 --> 00:05:31,280
presenting that

136
00:05:31,500 --> 00:05:32,759
now

137
00:05:32,759 --> 00:05:33,600
um

138
00:05:33,600 --> 00:05:35,759
with Azure 80 you have some things right

139
00:05:35,759 --> 00:05:38,580
so uh with Azure ad you you get your

140
00:05:38,580 --> 00:05:40,320
overview you get your logs so you get

141
00:05:40,320 --> 00:05:43,080
the sign-in logs you get the audit logs

142
00:05:43,080 --> 00:05:45,479
um we have conditional access we have

143
00:05:45,479 --> 00:05:47,520
identity scores and the way I explain

144
00:05:47,520 --> 00:05:49,740
identity scores is think about it like a

145
00:05:49,740 --> 00:05:52,199
benchmark if you follow all the best

146
00:05:52,199 --> 00:05:56,039
practices you can get 100 for example if

147
00:05:56,039 --> 00:05:58,940
you do some of it you might be on 80 60

148
00:05:58,940 --> 00:06:01,319
and that way you got to see what the

149
00:06:01,319 --> 00:06:02,880
difference is and you can actually feel

150
00:06:02,880 --> 00:06:04,860
those the differentials and follow

151
00:06:04,860 --> 00:06:07,940
recommendations to get up to our part

152
00:06:07,940 --> 00:06:10,080
excuse me

153
00:06:10,080 --> 00:06:12,600
but then if you go beyond just doing the

154
00:06:12,600 --> 00:06:15,060
the basics you get into what the middle

155
00:06:15,060 --> 00:06:16,860
part there which I call the advanced

156
00:06:16,860 --> 00:06:19,080
capabilities where then you can start to

157
00:06:19,080 --> 00:06:20,940
take some of these logs and then start

158
00:06:20,940 --> 00:06:22,500
to send them out to external resources

159
00:06:22,500 --> 00:06:24,180
right so

160
00:06:24,180 --> 00:06:26,699
um if you process your data in Azure ad

161
00:06:26,699 --> 00:06:29,039
you might be using log analytics but

162
00:06:29,039 --> 00:06:30,360
then I have customers who say yeah

163
00:06:30,360 --> 00:06:32,400
that's nice but then we do everything in

164
00:06:32,400 --> 00:06:34,380
Splunk and so it's like yeah you can

165
00:06:34,380 --> 00:06:36,000
actually take that data as well send it

166
00:06:36,000 --> 00:06:39,360
to Splunk and you'll be fine as well and

167
00:06:39,360 --> 00:06:41,580
then the next one or the next iteration

168
00:06:41,580 --> 00:06:43,620
to that is how do you take away the

169
00:06:43,620 --> 00:06:45,240
manual interaction right so how do you

170
00:06:45,240 --> 00:06:47,280
introduce some automation to things and

171
00:06:47,280 --> 00:06:48,900
that's where you go into using your

172
00:06:48,900 --> 00:06:51,660
logic apps and then um

173
00:06:51,660 --> 00:06:54,000
that experience gets even better than um

174
00:06:54,000 --> 00:06:56,780
it is right now

175
00:06:57,599 --> 00:06:58,800
now

176
00:06:58,800 --> 00:07:01,560
um getting data in the first one is

177
00:07:01,560 --> 00:07:04,460
excuse me my

178
00:07:04,680 --> 00:07:06,479
book yeah so getting there okay that's

179
00:07:06,479 --> 00:07:08,699
better getting data in the first one is

180
00:07:08,699 --> 00:07:10,319
log analytics right so how do you get

181
00:07:10,319 --> 00:07:11,520
the data to even show up in the

182
00:07:11,520 --> 00:07:14,340
workbooks the first one is setting up

183
00:07:14,340 --> 00:07:16,280
your workspace so if you go into

184
00:07:16,280 --> 00:07:19,020
diagnostic settings well by before I

185
00:07:19,020 --> 00:07:20,340
even say that is anyone familiar with

186
00:07:20,340 --> 00:07:22,319
the Azure ID portal here

187
00:07:22,319 --> 00:07:24,900
great all right good so under monitoring

188
00:07:24,900 --> 00:07:26,880
you have um a bunch of things you would

189
00:07:26,880 --> 00:07:28,740
have local genetics you would have the

190
00:07:28,740 --> 00:07:30,840
workspace and then diagnostic settings

191
00:07:30,840 --> 00:07:33,479
if you go in there to the left you have

192
00:07:33,479 --> 00:07:35,340
all the logs that are being captured

193
00:07:35,340 --> 00:07:37,860
right and then you can send them in so

194
00:07:37,860 --> 00:07:39,180
you at this point You're Building

195
00:07:39,180 --> 00:07:41,280
reports based off those logs have been

196
00:07:41,280 --> 00:07:42,539
captured

197
00:07:42,539 --> 00:07:44,879
so for the top one is when you want to

198
00:07:44,879 --> 00:07:47,520
do this using the Azure ID workbook and

199
00:07:47,520 --> 00:07:49,139
then like I said it's not just Microsoft

200
00:07:49,139 --> 00:07:50,819
Centric so if you're sending elsewhere

201
00:07:50,819 --> 00:07:52,379
you want to go and also make sure you're

202
00:07:52,379 --> 00:07:54,539
streaming to event Hub and we'll talk

203
00:07:54,539 --> 00:07:56,639
about why that's important later on

204
00:07:56,639 --> 00:07:58,979
but so much about workbooks what do they

205
00:07:58,979 --> 00:08:01,199
look like uh you have them in here this

206
00:08:01,199 --> 00:08:04,080
is what the overview page looks like

207
00:08:04,080 --> 00:08:06,060
um on the top part that you have new

208
00:08:06,060 --> 00:08:08,099
which just indicates that you don't have

209
00:08:08,099 --> 00:08:09,960
to use some of this pre-canned workbooks

210
00:08:09,960 --> 00:08:11,879
we've made you can actually go treat

211
00:08:11,879 --> 00:08:13,740
this like a canvas start a fresh build

212
00:08:13,740 --> 00:08:15,000
everything you want

213
00:08:15,000 --> 00:08:17,460
but then also in here based off feedback

214
00:08:17,460 --> 00:08:19,379
we've gotten based off situations that

215
00:08:19,379 --> 00:08:21,599
have happened in the past we have some

216
00:08:21,599 --> 00:08:23,699
default reports that we advise customers

217
00:08:23,699 --> 00:08:25,259
to go look into if you want to get

218
00:08:25,259 --> 00:08:27,060
started go check this once it would show

219
00:08:27,060 --> 00:08:28,379
you simple things that we think are

220
00:08:28,379 --> 00:08:31,080
important for customers to see and then

221
00:08:31,080 --> 00:08:32,760
you can start to make customizations on

222
00:08:32,760 --> 00:08:34,200
those as you please

223
00:08:34,200 --> 00:08:36,599
now you don't have to worry about the

224
00:08:36,599 --> 00:08:39,000
changes you make here

225
00:08:39,000 --> 00:08:40,860
um effects in the global repository

226
00:08:40,860 --> 00:08:42,360
that's not that's not the way it works

227
00:08:42,360 --> 00:08:43,919
you could make your customizations in

228
00:08:43,919 --> 00:08:45,959
here for your scenarios and it just

229
00:08:45,959 --> 00:08:48,600
saves a different version for you

230
00:08:48,600 --> 00:08:50,820
um contributions are welcome in here and

231
00:08:50,820 --> 00:08:52,440
Carissa will talk about that in a bit

232
00:08:52,440 --> 00:08:54,480
but then this is what you would see

233
00:08:54,480 --> 00:08:58,160
today if you went into the puzzle

234
00:08:58,920 --> 00:09:00,839
so

235
00:09:00,839 --> 00:09:02,940
um business cases right so how do you

236
00:09:02,940 --> 00:09:04,380
even get started or why do you want to

237
00:09:04,380 --> 00:09:05,640
use this

238
00:09:05,640 --> 00:09:07,140
um if you're a security folks you're

239
00:09:07,140 --> 00:09:08,760
probably thinking well you want to

240
00:09:08,760 --> 00:09:10,500
identify threats you want to do it

241
00:09:10,500 --> 00:09:14,760
faster some things I've heard is well we

242
00:09:14,760 --> 00:09:16,560
know how to pull this data but then we

243
00:09:16,560 --> 00:09:18,120
don't have a means of showing it to

244
00:09:18,120 --> 00:09:20,459
people who are not super technical right

245
00:09:20,459 --> 00:09:22,320
we need some visualizations that we

246
00:09:22,320 --> 00:09:24,540
could use workbooks coming really add in

247
00:09:24,540 --> 00:09:25,399
here

248
00:09:25,399 --> 00:09:28,320
we also want to do well we know what we

249
00:09:28,320 --> 00:09:30,420
want to be able to show what is normal

250
00:09:30,420 --> 00:09:32,880
and what's abnormal really quickly right

251
00:09:32,880 --> 00:09:34,620
so with the trend graph you see what the

252
00:09:34,620 --> 00:09:37,019
Baseline is and one day you see a spike

253
00:09:37,019 --> 00:09:39,360
it rings the bell in everyone's head you

254
00:09:39,360 --> 00:09:40,680
understand what exactly you're looking

255
00:09:40,680 --> 00:09:43,920
for and from there you just um go on so

256
00:09:43,920 --> 00:09:45,959
these are some common use cases and I'll

257
00:09:45,959 --> 00:09:48,480
just briefly show some reports that we

258
00:09:48,480 --> 00:09:51,779
have that address a few of those

259
00:09:51,779 --> 00:09:56,339
so really quickly what happens when

260
00:09:56,339 --> 00:09:58,560
um you're having multiple changes to a

261
00:09:58,560 --> 00:10:00,120
service principle an application right

262
00:10:00,120 --> 00:10:03,000
uh if you have more certificates being

263
00:10:03,000 --> 00:10:04,079
being

264
00:10:04,079 --> 00:10:06,600
um updated if you have passwords being

265
00:10:06,600 --> 00:10:08,519
changed just modifications like that

266
00:10:08,519 --> 00:10:11,160
right you want it to ring a bell right

267
00:10:11,160 --> 00:10:12,779
you want an alarm you want someone to

268
00:10:12,779 --> 00:10:14,040
actually pay attention to this go

269
00:10:14,040 --> 00:10:15,540
investigate make sure this is done

270
00:10:15,540 --> 00:10:17,700
correctly and there's a report in there

271
00:10:17,700 --> 00:10:20,160
that is pre-cad that you can actually

272
00:10:20,160 --> 00:10:21,899
get started with

273
00:10:21,899 --> 00:10:24,320
that's one example there

274
00:10:24,320 --> 00:10:26,880
another example is what if you have

275
00:10:26,880 --> 00:10:28,620
service principles and I think life's

276
00:10:28,620 --> 00:10:30,240
quickly but what if you have service

277
00:10:30,240 --> 00:10:32,700
principles for instance and then

278
00:10:32,700 --> 00:10:34,980
um someday you start to see new

279
00:10:34,980 --> 00:10:37,260
permissions being added to them uh the

280
00:10:37,260 --> 00:10:39,180
common ones we call out the customers

281
00:10:39,180 --> 00:10:40,980
would be the read and write permissions

282
00:10:40,980 --> 00:10:42,600
because those are the most powerful ones

283
00:10:42,600 --> 00:10:45,540
but then sometimes read all alone is

284
00:10:45,540 --> 00:10:49,260
worrying a Troublesome right and if you

285
00:10:49,260 --> 00:10:51,000
um have so I just have some examples in

286
00:10:51,000 --> 00:10:53,040
here so things around Microsoft graph

287
00:10:53,040 --> 00:10:54,720
things around

288
00:10:54,720 --> 00:10:55,440
um

289
00:10:55,440 --> 00:10:57,540
exchange with another example right

290
00:10:57,540 --> 00:10:58,920
where you want to pay attention to that

291
00:10:58,920 --> 00:11:00,300
right so you won't be able to go in

292
00:11:00,300 --> 00:11:02,760
there in this example I have a seven day

293
00:11:02,760 --> 00:11:06,720
range you can go as far as your data

294
00:11:06,720 --> 00:11:09,899
um login mechanism goes we advise to get

295
00:11:09,899 --> 00:11:12,360
richer reports that you store data for a

296
00:11:12,360 --> 00:11:14,519
little longer and then you start to see

297
00:11:14,519 --> 00:11:17,100
well who made that change so you have

298
00:11:17,100 --> 00:11:20,640
the initiating user or apps name there

299
00:11:20,640 --> 00:11:22,800
so you can actually verify you have a

300
00:11:22,800 --> 00:11:24,000
little explanation of what that

301
00:11:24,000 --> 00:11:26,160
permission does and then you get to see

302
00:11:26,160 --> 00:11:28,920
the rules that were added

303
00:11:28,920 --> 00:11:32,040
okay similarly what if

304
00:11:32,040 --> 00:11:33,300
um a service experience boiler

305
00:11:33,300 --> 00:11:35,820
application gets added to a role or a

306
00:11:35,820 --> 00:11:38,519
group uh one day you wake up and

307
00:11:38,519 --> 00:11:41,160
somebody is now a global admin or

308
00:11:41,160 --> 00:11:44,279
somebody is now a company admin you want

309
00:11:44,279 --> 00:11:45,660
to be able to catch that real quick

310
00:11:45,660 --> 00:11:47,579
because that might be a sign that

311
00:11:47,579 --> 00:11:50,339
something has gone wrong and again same

312
00:11:50,339 --> 00:11:52,440
logic in this case I use 60 days just to

313
00:11:52,440 --> 00:11:54,480
show what that range is and then you can

314
00:11:54,480 --> 00:11:56,820
see what the operation is as well as who

315
00:11:56,820 --> 00:11:59,160
did that

316
00:11:59,160 --> 00:12:01,800
um so let's move a little bit away from

317
00:12:01,800 --> 00:12:03,720
that and let's think about like Risk in

318
00:12:03,720 --> 00:12:06,120
this sense so risk events risky users

319
00:12:06,120 --> 00:12:09,300
what you're looking here at here is a

320
00:12:09,300 --> 00:12:12,060
map that shows you your risk detections

321
00:12:12,060 --> 00:12:15,120
right so what's a quick way to see where

322
00:12:15,120 --> 00:12:16,920
risky events are going on or where risky

323
00:12:16,920 --> 00:12:20,339
users um are this report would show you

324
00:12:20,339 --> 00:12:23,040
that right now and the bigger circles

325
00:12:23,040 --> 00:12:25,800
just mean you have a higher counts while

326
00:12:25,800 --> 00:12:27,600
the colors would indicate whether it's a

327
00:12:27,600 --> 00:12:29,940
high risk event medium risk events or

328
00:12:29,940 --> 00:12:31,620
low risk um

329
00:12:31,620 --> 00:12:35,100
event as well as well as a breakdown on

330
00:12:35,100 --> 00:12:37,680
the therefore the time frame

331
00:12:37,680 --> 00:12:40,079
now we talked about what's normal and

332
00:12:40,079 --> 00:12:42,839
then uh finding anomalies right so the

333
00:12:42,839 --> 00:12:44,519
first thing that stands out to you

334
00:12:44,519 --> 00:12:46,200
looking at this report is the spike

335
00:12:46,200 --> 00:12:49,200
right so February 6 you have a big spike

336
00:12:49,200 --> 00:12:52,860
and um it just kind of flattens out

337
00:12:52,860 --> 00:12:54,360
that brings a bell to me because I'm

338
00:12:54,360 --> 00:12:55,740
like I wonder what happened that day

339
00:12:55,740 --> 00:12:56,639
that's something I want to go

340
00:12:56,639 --> 00:12:59,519
investigate but then also we've gone

341
00:12:59,519 --> 00:13:01,500
further ahead to even break down what we

342
00:13:01,500 --> 00:13:03,300
think these risky events are by types

343
00:13:03,300 --> 00:13:05,579
and so you start to see a large portion

344
00:13:05,579 --> 00:13:07,500
of that is a new country so toasting

345
00:13:07,500 --> 00:13:10,440
usually would sign in from the US and

346
00:13:10,440 --> 00:13:11,279
then

347
00:13:11,279 --> 00:13:13,139
all of a sudden it was inside from

348
00:13:13,139 --> 00:13:14,519
France like

349
00:13:14,519 --> 00:13:16,800
well it's something uh going on that my

350
00:13:16,800 --> 00:13:18,060
risk score probably goes up and it's

351
00:13:18,060 --> 00:13:20,220
something to pay attention to or

352
00:13:20,220 --> 00:13:24,120
Microsoft has gone ahead and um

353
00:13:24,120 --> 00:13:26,160
identified some IP addresses as

354
00:13:26,160 --> 00:13:28,019
malicious and then you start to see

355
00:13:28,019 --> 00:13:29,519
login attempts from those in your

356
00:13:29,519 --> 00:13:31,320
tenants so you want to pay attention to

357
00:13:31,320 --> 00:13:33,720
like very simple indications that there

358
00:13:33,720 --> 00:13:35,579
might be trouble

359
00:13:35,579 --> 00:13:37,680
moving really quickly

360
00:13:37,680 --> 00:13:39,779
what about in situations where you

361
00:13:39,779 --> 00:13:43,019
collaborate right so you have your

362
00:13:43,019 --> 00:13:45,060
um tenants speaking with users from

363
00:13:45,060 --> 00:13:47,459
another tenant a lot of times you do

364
00:13:47,459 --> 00:13:48,420
that because you trust the other

365
00:13:48,420 --> 00:13:50,399
organization but then do you want to

366
00:13:50,399 --> 00:13:52,260
know how many attempts are going in both

367
00:13:52,260 --> 00:13:53,940
ways so from you to them from them to

368
00:13:53,940 --> 00:13:55,740
you do you want to have a good idea of

369
00:13:55,740 --> 00:13:58,139
like what applications are being used on

370
00:13:58,139 --> 00:14:00,120
the other end and then do you want to

371
00:14:00,120 --> 00:14:01,620
know which of your users are doing that

372
00:14:01,620 --> 00:14:03,540
interaction as well

373
00:14:03,540 --> 00:14:05,279
um reports like this would do the same

374
00:14:05,279 --> 00:14:07,440
thing right so you can go in go by time

375
00:14:07,440 --> 00:14:09,839
frame you could look up users and you

376
00:14:09,839 --> 00:14:11,760
can look up specific applications if

377
00:14:11,760 --> 00:14:14,279
you're worried about those

378
00:14:14,279 --> 00:14:15,899
right

379
00:14:15,899 --> 00:14:19,500
and then um the last one from the

380
00:14:19,500 --> 00:14:21,000
pre-can reports would be this one right

381
00:14:21,000 --> 00:14:23,100
so what about the gaps what are the

382
00:14:23,100 --> 00:14:24,660
obvious gaps that you might be missing

383
00:14:24,660 --> 00:14:27,120
in your environment right now do you

384
00:14:27,120 --> 00:14:28,079
have

385
00:14:28,079 --> 00:14:30,300
um applications that don't have any

386
00:14:30,300 --> 00:14:32,160
policies around them again we're from

387
00:14:32,160 --> 00:14:33,839
Identity right so I talk conditional

388
00:14:33,839 --> 00:14:36,300
access I talk guidance protection and so

389
00:14:36,300 --> 00:14:39,120
it's like um you have this high impact

390
00:14:39,120 --> 00:14:40,980
application but then there's no policy

391
00:14:40,980 --> 00:14:42,660
guiding it for some reason you won't be

392
00:14:42,660 --> 00:14:44,519
able to catch that real quick now that

393
00:14:44,519 --> 00:14:46,620
might have been missed but then your

394
00:14:46,620 --> 00:14:48,360
workbook shows you and it's something

395
00:14:48,360 --> 00:14:49,680
you can actually go back and try to

396
00:14:49,680 --> 00:14:52,380
remediate real quickly another one is do

397
00:14:52,380 --> 00:14:54,360
you have locations where you have no

398
00:14:54,360 --> 00:14:57,420
conditional access policy blocking

399
00:14:57,420 --> 00:14:59,579
and that's what you see on the map to

400
00:14:59,579 --> 00:15:02,940
the left as well so

401
00:15:02,940 --> 00:15:05,699
this one really obvious Legacy

402
00:15:05,699 --> 00:15:08,220
authentication we talk about this quite

403
00:15:08,220 --> 00:15:10,500
a bit because most of what we do at this

404
00:15:10,500 --> 00:15:12,899
point we're preaching MFA make sure

405
00:15:12,899 --> 00:15:14,940
that's at least that's the basic at this

406
00:15:14,940 --> 00:15:16,320
point right so that's the Baseline we

407
00:15:16,320 --> 00:15:18,600
require most applications to have MFA if

408
00:15:18,600 --> 00:15:20,760
they can the only reason why you

409
00:15:20,760 --> 00:15:21,899
probably would not be able to prompt

410
00:15:21,899 --> 00:15:25,320
that now would be a legacy auth and as

411
00:15:25,320 --> 00:15:27,480
much as we're trying to phase that out

412
00:15:27,480 --> 00:15:29,579
is actually a deprecation in October I

413
00:15:29,579 --> 00:15:31,800
believe for legacy Earth but for now we

414
00:15:31,800 --> 00:15:34,079
give away for admins to identify that

415
00:15:34,079 --> 00:15:36,660
really quickly so just run the reports

416
00:15:36,660 --> 00:15:38,339
you can see interactive sign-ins and

417
00:15:38,339 --> 00:15:40,440
non-interactive sign-ins and then you

418
00:15:40,440 --> 00:15:42,420
can start to look at which ones which

419
00:15:42,420 --> 00:15:44,940
applications people are still signed

420
00:15:44,940 --> 00:15:46,920
into using Legacy Earth and then you

421
00:15:46,920 --> 00:15:48,120
could gradually start to cut that down

422
00:15:48,120 --> 00:15:49,920
or even use this right so which users

423
00:15:49,920 --> 00:15:51,300
are still using it and then you

424
00:15:51,300 --> 00:15:54,540
gradually take those down so

425
00:15:54,540 --> 00:15:57,480
um this is well these are like a couple

426
00:15:57,480 --> 00:15:59,699
of reports that we have right like I

427
00:15:59,699 --> 00:16:01,199
said you have a bunch of them in there

428
00:16:01,199 --> 00:16:03,360
multiple categories you can go in and

429
00:16:03,360 --> 00:16:05,699
play with the idea is this is the

430
00:16:05,699 --> 00:16:07,380
visualization right so what's running

431
00:16:07,380 --> 00:16:09,600
behind this is kql right so that's how

432
00:16:09,600 --> 00:16:11,579
this is all built and that's what I'm

433
00:16:11,579 --> 00:16:13,320
curious I'll spend some time now showing

434
00:16:13,320 --> 00:16:14,699
you some of the code and some of the

435
00:16:14,699 --> 00:16:16,860
ways to manipulate that so you can take

436
00:16:16,860 --> 00:16:19,560
what we've built as the starter packages

437
00:16:19,560 --> 00:16:22,440
and then start to make changes and come

438
00:16:22,440 --> 00:16:23,880
up with creative ways that actually

439
00:16:23,880 --> 00:16:27,300
solve your own issues and hopefully you

440
00:16:27,300 --> 00:16:29,279
can also come contribute to the

441
00:16:29,279 --> 00:16:31,019
community and we get this quite even

442
00:16:31,019 --> 00:16:33,779
bigger and bigger so at this point I'll

443
00:16:33,779 --> 00:16:36,600
hand over to Carissa and she'll uh get

444
00:16:36,600 --> 00:16:40,279
into the code thank you

445
00:16:40,560 --> 00:16:42,480
all right are you guys ready for now

446
00:16:42,480 --> 00:16:44,579
like seeing the nitty-gritty

447
00:16:44,579 --> 00:16:46,320
all right so

448
00:16:46,320 --> 00:16:49,079
I'm gonna go in

449
00:16:49,079 --> 00:16:50,699
basically everything that was in this

450
00:16:50,699 --> 00:16:52,920
workbook is

451
00:16:52,920 --> 00:16:55,560
um built on kql that looks similar to

452
00:16:55,560 --> 00:16:58,620
this right and it is a very small screen

453
00:16:58,620 --> 00:17:00,120
so I'm gonna try to

454
00:17:00,120 --> 00:17:02,279
zoom in if I can

455
00:17:02,279 --> 00:17:04,559
there we go I don't know if that helps

456
00:17:04,559 --> 00:17:07,439
can you guys see it in the back okay

457
00:17:07,439 --> 00:17:09,959
um perfect so I'm gonna I have slides

458
00:17:09,959 --> 00:17:11,939
that are gonna really go through

459
00:17:11,939 --> 00:17:15,119
um the code but I'm gonna highlight

460
00:17:15,119 --> 00:17:16,799
something else before we go get into

461
00:17:16,799 --> 00:17:19,079
that so as I mentioned you know

462
00:17:19,079 --> 00:17:21,480
everything is built on this kql and in

463
00:17:21,480 --> 00:17:24,419
log analytics no matter what you put in

464
00:17:24,419 --> 00:17:27,240
here you can create a new alert based on

465
00:17:27,240 --> 00:17:29,460
this right on that on that code very

466
00:17:29,460 --> 00:17:31,440
easily and it's basically just this

467
00:17:31,440 --> 00:17:33,240
button here new alert

468
00:17:33,240 --> 00:17:36,299
so the idea is is that in this situation

469
00:17:36,299 --> 00:17:39,059
we were saying okay how can we know that

470
00:17:39,059 --> 00:17:41,940
our administrators are possible like

471
00:17:41,940 --> 00:17:43,740
going through MFA are there any

472
00:17:43,740 --> 00:17:46,320
administrators that are failing MFA and

473
00:17:46,320 --> 00:17:47,820
that's something we want to alert on we

474
00:17:47,820 --> 00:17:48,539
want

475
00:17:48,539 --> 00:17:50,520
um our security team to investigate

476
00:17:50,520 --> 00:17:53,100
these things immediately so in this

477
00:17:53,100 --> 00:17:54,840
instance this that's what that code is

478
00:17:54,840 --> 00:17:55,919
doing

479
00:17:55,919 --> 00:17:58,500
um I will walk it through when we go

480
00:17:58,500 --> 00:18:00,059
into the other slide that's a little bit

481
00:18:00,059 --> 00:18:02,280
more clear but you can see the results

482
00:18:02,280 --> 00:18:04,500
that like the global administrator had

483
00:18:04,500 --> 00:18:09,539
what 330 failed attempts in 24 hours to

484
00:18:09,539 --> 00:18:11,220
me that would be concerning

485
00:18:11,220 --> 00:18:13,679
especially if I knew that in my

486
00:18:13,679 --> 00:18:15,960
environment I only had you know seven

487
00:18:15,960 --> 00:18:18,059
Global administrators however you know

488
00:18:18,059 --> 00:18:19,380
there could be cases where these

489
00:18:19,380 --> 00:18:22,140
companies are huge right so this is

490
00:18:22,140 --> 00:18:23,760
something that you need to cater towards

491
00:18:23,760 --> 00:18:25,140
your environment it can't be something

492
00:18:25,140 --> 00:18:27,539
that is um all the same so I'm actually

493
00:18:27,539 --> 00:18:29,460
gonna go

494
00:18:29,460 --> 00:18:31,080
um into the portal just because I like

495
00:18:31,080 --> 00:18:34,200
to so one second

496
00:18:34,200 --> 00:18:37,500
makes it much easier for me to show you

497
00:18:37,500 --> 00:18:40,039
all right

498
00:18:46,440 --> 00:18:50,820
oh yeah you're not I'm not sharing it

499
00:18:50,820 --> 00:18:53,820
darn it okay

500
00:18:53,820 --> 00:18:55,140
I don't want to change it I'll go back

501
00:18:55,140 --> 00:18:58,220
I'll go back

502
00:18:59,059 --> 00:19:02,240
oh okay

503
00:19:03,600 --> 00:19:06,360
I gotta yeah I can't see my arrow so I

504
00:19:06,360 --> 00:19:07,860
have to

505
00:19:07,860 --> 00:19:10,459
there we go

506
00:19:16,500 --> 00:19:18,539
okay I'm back

507
00:19:18,539 --> 00:19:21,200
all right

508
00:19:21,299 --> 00:19:25,080
let me make this bigger so I can see

509
00:19:25,080 --> 00:19:28,080
okay so I luckily I took screenshots

510
00:19:28,080 --> 00:19:29,400
because then I wouldn't be able to

511
00:19:29,400 --> 00:19:31,320
explain to you so this is of just abuse

512
00:19:31,320 --> 00:19:35,160
of the of the actual kql I had just

513
00:19:35,160 --> 00:19:37,620
clicked the button new alert and then it

514
00:19:37,620 --> 00:19:39,539
brings up this page and so what this

515
00:19:39,539 --> 00:19:42,240
page is going to allow me to do is to

516
00:19:42,240 --> 00:19:44,340
really specify the type of alerts I want

517
00:19:44,340 --> 00:19:47,100
to set up so you have this kql which is

518
00:19:47,100 --> 00:19:49,799
finding um it's identifying where any

519
00:19:49,799 --> 00:19:52,580
Global administrator is hitting um MFA

520
00:19:52,580 --> 00:19:56,400
and failing having a result of fail and

521
00:19:56,400 --> 00:19:58,200
then counting it

522
00:19:58,200 --> 00:20:00,179
so there's a few different ways I can

523
00:20:00,179 --> 00:20:02,280
aggregate my the count of the

524
00:20:02,280 --> 00:20:05,100
information that I want to track and you

525
00:20:05,100 --> 00:20:06,960
know in this sense I can also I can look

526
00:20:06,960 --> 00:20:08,460
at the table of rows or I can look at

527
00:20:08,460 --> 00:20:09,900
the count

528
00:20:09,900 --> 00:20:11,580
um but I'm deciding that I want to just

529
00:20:11,580 --> 00:20:13,799
see how many rows of information or how

530
00:20:13,799 --> 00:20:16,260
many fails I have every five minutes

531
00:20:16,260 --> 00:20:19,320
that's my aggregation granularity and

532
00:20:19,320 --> 00:20:20,520
then

533
00:20:20,520 --> 00:20:24,020
go on to the next slide

534
00:20:24,360 --> 00:20:27,900
I also can decide my alert logic and

535
00:20:27,900 --> 00:20:30,240
this is going to say okay it's greater

536
00:20:30,240 --> 00:20:31,500
than say

537
00:20:31,500 --> 00:20:34,559
20 like if I have 20 failed mfas in five

538
00:20:34,559 --> 00:20:36,299
minutes I should be very concerned or

539
00:20:36,299 --> 00:20:38,220
maybe someone will like want to see it

540
00:20:38,220 --> 00:20:40,200
if it's three or four you can decide

541
00:20:40,200 --> 00:20:41,580
that you can set up your security

542
00:20:41,580 --> 00:20:44,600
policies that way

543
00:20:44,940 --> 00:20:46,919
it also will tell you how much like

544
00:20:46,919 --> 00:20:49,740
alerts how much this is going to cost

545
00:20:49,740 --> 00:20:50,460
um

546
00:20:50,460 --> 00:20:52,919
which is it's not really pertaining you

547
00:20:52,919 --> 00:20:54,539
know in a to everyone but if you're

548
00:20:54,539 --> 00:20:56,340
using Azure active directory and you if

549
00:20:56,340 --> 00:20:58,559
you have customers that are using Office

550
00:20:58,559 --> 00:21:02,159
365 they already have Azure ad so in

551
00:21:02,159 --> 00:21:03,360
this sense this is something that you

552
00:21:03,360 --> 00:21:04,860
can do really specifically for your

553
00:21:04,860 --> 00:21:07,380
Office 365 if nothing else I mean you

554
00:21:07,380 --> 00:21:09,059
can bring all your Enterprise apps into

555
00:21:09,059 --> 00:21:11,700
this but just know that if you have

556
00:21:11,700 --> 00:21:14,100
somebody who has Office 365 in their

557
00:21:14,100 --> 00:21:15,659
environment these are tools that you can

558
00:21:15,659 --> 00:21:18,559
help to keep them safe

559
00:21:19,320 --> 00:21:21,059
all right so I did an aggregation

560
00:21:21,059 --> 00:21:23,520
granularity of five minutes and then the

561
00:21:23,520 --> 00:21:25,559
frequency of evaluation has to be that

562
00:21:25,559 --> 00:21:28,200
or less than or sorry that or greater

563
00:21:28,200 --> 00:21:30,360
than and so in this sense I'm just

564
00:21:30,360 --> 00:21:32,520
saying that I want to check oops I want

565
00:21:32,520 --> 00:21:34,679
to check the the count every five

566
00:21:34,679 --> 00:21:36,480
minutes and then send an alert if it's

567
00:21:36,480 --> 00:21:38,220
over 20.

568
00:21:38,220 --> 00:21:40,320
and then I can also name this alert Rule

569
00:21:40,320 --> 00:21:43,140
and I can change the severity

570
00:21:43,140 --> 00:21:45,299
which is great and then here is where

571
00:21:45,299 --> 00:21:46,980
we're going to go into the kql of

572
00:21:46,980 --> 00:21:49,020
actually what's being said

573
00:21:49,020 --> 00:21:51,360
so in in this sense I just you know I'm

574
00:21:51,360 --> 00:21:53,460
calling this as administrators fail MFA

575
00:21:53,460 --> 00:21:57,360
code and this is where

576
00:21:57,360 --> 00:21:59,400
um you may have you know a lot of you

577
00:21:59,400 --> 00:22:01,500
have already used kql and so you may

578
00:22:01,500 --> 00:22:03,720
know this already but I kind of want to

579
00:22:03,720 --> 00:22:05,400
just tell you like the main things that

580
00:22:05,400 --> 00:22:07,679
have helped me to create these workbooks

581
00:22:07,679 --> 00:22:09,780
that has helped me to become better at

582
00:22:09,780 --> 00:22:13,440
this and also like do some cool stuff so

583
00:22:13,440 --> 00:22:16,440
I always use the let function the where

584
00:22:16,440 --> 00:22:19,080
function the MV expand so that's why I

585
00:22:19,080 --> 00:22:21,179
like this query because it shows you a

586
00:22:21,179 --> 00:22:24,299
lot of those for example

587
00:22:24,299 --> 00:22:26,220
the identity information is where we're

588
00:22:26,220 --> 00:22:28,200
going to see the role information so

589
00:22:28,200 --> 00:22:29,520
we're going to be combining two

590
00:22:29,520 --> 00:22:31,320
different data sets entirely we're

591
00:22:31,320 --> 00:22:32,880
getting log information from Identity

592
00:22:32,880 --> 00:22:34,799
info and then we're also getting log

593
00:22:34,799 --> 00:22:37,440
information from sign in logs and

594
00:22:37,440 --> 00:22:40,039
actually I like there's a third from aad

595
00:22:40,039 --> 00:22:42,120
non-interactive user sign-in so those

596
00:22:42,120 --> 00:22:43,500
are going to be our service principal

597
00:22:43,500 --> 00:22:44,940
sign-ins

598
00:22:44,940 --> 00:22:47,039
all right so we start up here and we're

599
00:22:47,039 --> 00:22:48,360
really just saying like we're going to

600
00:22:48,360 --> 00:22:50,280
create kind of this variable this table

601
00:22:50,280 --> 00:22:52,020
that's going to be terrible table name

602
00:22:52,020 --> 00:22:54,299
String so that whatever we create later

603
00:22:54,299 --> 00:22:56,159
on it can be applied

604
00:22:56,159 --> 00:22:59,220
um to the to whatever table we put we we

605
00:22:59,220 --> 00:23:01,799
have created and this is going to be

606
00:23:01,799 --> 00:23:04,679
later on in the query and it's basically

607
00:23:04,679 --> 00:23:05,820
going to say okay we're going to have

608
00:23:05,820 --> 00:23:08,159
identity information where and this

609
00:23:08,159 --> 00:23:11,580
assigned roles part is is a column in in

610
00:23:11,580 --> 00:23:14,640
the in the log data and we we're only

611
00:23:14,640 --> 00:23:16,320
going to look and we only care about

612
00:23:16,320 --> 00:23:18,600
that contains admin so there's many many

613
00:23:18,600 --> 00:23:20,460
roles right there's many roles that you

614
00:23:20,460 --> 00:23:21,960
can be but we care about the

615
00:23:21,960 --> 00:23:23,880
administrator roles

616
00:23:23,880 --> 00:23:26,220
and in in the mvx band has a couple

617
00:23:26,220 --> 00:23:27,659
different things that I think are super

618
00:23:27,659 --> 00:23:28,799
useful

619
00:23:28,799 --> 00:23:31,140
so when you're creating new columns

620
00:23:31,140 --> 00:23:33,419
sometimes you need to change the data a

621
00:23:33,419 --> 00:23:34,559
little bit

622
00:23:34,559 --> 00:23:35,880
um also there's also going to be times

623
00:23:35,880 --> 00:23:39,360
where maybe the the data is also in a

624
00:23:39,360 --> 00:23:40,440
dynamic

625
00:23:40,440 --> 00:23:43,140
um like Json format and that's a way for

626
00:23:43,140 --> 00:23:45,240
us to save our customers money because

627
00:23:45,240 --> 00:23:48,059
we you know having all this data you

628
00:23:48,059 --> 00:23:49,440
know we can't create a separate column

629
00:23:49,440 --> 00:23:51,000
that takes up more space so we sometimes

630
00:23:51,000 --> 00:23:54,120
we put it all into one in Json format

631
00:23:54,120 --> 00:23:56,039
and so you might need to parse it out

632
00:23:56,039 --> 00:23:57,659
but I'm going to show you that later but

633
00:23:57,659 --> 00:24:00,059
in this instance of MB expand we're

634
00:24:00,059 --> 00:24:02,039
looking at assigned roles and then we're

635
00:24:02,039 --> 00:24:03,720
we're taking and we're going to make new

636
00:24:03,720 --> 00:24:05,760
columns out of it we're going to extend

637
00:24:05,760 --> 00:24:07,559
the roles to

638
00:24:07,559 --> 00:24:08,159
um

639
00:24:08,159 --> 00:24:10,679
we're gonna make a column called roles

640
00:24:10,679 --> 00:24:13,260
and that's going to contain the string

641
00:24:13,260 --> 00:24:15,120
version of assigned roles and then we're

642
00:24:15,120 --> 00:24:17,159
going to also take the account UPN and

643
00:24:17,159 --> 00:24:19,200
we're going to lowercase it and this is

644
00:24:19,200 --> 00:24:20,880
the reason that we have to do this line

645
00:24:20,880 --> 00:24:22,799
is because we are planning to merge and

646
00:24:22,799 --> 00:24:25,620
to unite and do a join

647
00:24:25,620 --> 00:24:27,779
so in this sense we say okay where the

648
00:24:27,779 --> 00:24:30,419
roles contain admin and then we're just

649
00:24:30,419 --> 00:24:32,340
looking at distinct like I don't want to

650
00:24:32,340 --> 00:24:33,600
know

651
00:24:33,600 --> 00:24:35,460
um every single one I just want to know

652
00:24:35,460 --> 00:24:37,740
the distinct roles in account UPN so

653
00:24:37,740 --> 00:24:39,419
that I'm tracking

654
00:24:39,419 --> 00:24:41,159
um I'm not counting double counting

655
00:24:41,159 --> 00:24:43,740
right and then we're doing a join and if

656
00:24:43,740 --> 00:24:45,299
you guys are familiar with SQL at all

657
00:24:45,299 --> 00:24:47,520
this is going to seem very familiar a

658
00:24:47,520 --> 00:24:50,779
lot of the times it's um it's like kql

659
00:24:50,779 --> 00:24:53,880
is very similar to SQL but there's these

660
00:24:53,880 --> 00:24:56,100
slight nuances so inside our

661
00:24:56,100 --> 00:24:57,480
documentation and I'll share this with

662
00:24:57,480 --> 00:25:00,779
you they have a lot of SQL to keyquel I

663
00:25:00,779 --> 00:25:03,179
could call it equals not that uh SQL to

664
00:25:03,179 --> 00:25:04,820
kql

665
00:25:04,820 --> 00:25:08,580
translation and also I think there's uh

666
00:25:08,580 --> 00:25:10,500
kql to

667
00:25:10,500 --> 00:25:12,840
there's a few other languages that it

668
00:25:12,840 --> 00:25:14,159
can be that it can we have it

669
00:25:14,159 --> 00:25:16,380
transferred to as well as well as like

670
00:25:16,380 --> 00:25:18,600
how you use it in Splunk so I'll

671
00:25:18,600 --> 00:25:21,620
definitely link to those

672
00:25:22,860 --> 00:25:24,120
all right

673
00:25:24,120 --> 00:25:25,740
um okay so in this instance now we're

674
00:25:25,740 --> 00:25:29,220
doing a join and we're bringing in where

675
00:25:29,220 --> 00:25:31,140
the result description this is where

676
00:25:31,140 --> 00:25:32,340
we're deciding what type of

677
00:25:32,340 --> 00:25:34,320
authentication method what type of MFA

678
00:25:34,320 --> 00:25:36,360
did they do so we're only going to care

679
00:25:36,360 --> 00:25:39,779
about MFA second factor multi-factor and

680
00:25:39,779 --> 00:25:41,880
then we're looking at these result types

681
00:25:41,880 --> 00:25:44,159
and these result types we know and I

682
00:25:44,159 --> 00:25:45,539
know but you guys don't if you're not

683
00:25:45,539 --> 00:25:47,100
familiar with these logs that these are

684
00:25:47,100 --> 00:25:48,779
all failed attempts

685
00:25:48,779 --> 00:25:50,460
so we're just listing the different

686
00:25:50,460 --> 00:25:52,559
types of results

687
00:25:52,559 --> 00:25:54,240
and then we're doing a join and then

688
00:25:54,240 --> 00:25:56,340
we're going to create a couple new

689
00:25:56,340 --> 00:25:58,799
columns again and in the bottom part

690
00:25:58,799 --> 00:26:01,200
we're kind of referring back up to this

691
00:26:01,200 --> 00:26:03,299
add Funk to the table and we're saying

692
00:26:03,299 --> 00:26:05,340
okay we want to do this for sign in logs

693
00:26:05,340 --> 00:26:07,559
and we're also going to do it for Azure

694
00:26:07,559 --> 00:26:10,980
ad non-interactive sign-in logs and once

695
00:26:10,980 --> 00:26:12,539
we join those and bring those together

696
00:26:12,539 --> 00:26:14,640
we're able to have this great column

697
00:26:14,640 --> 00:26:17,279
that is going to combine this sign in

698
00:26:17,279 --> 00:26:20,100
information with the role information

699
00:26:20,100 --> 00:26:22,260
and then we're going to summarize it and

700
00:26:22,260 --> 00:26:24,120
we're summarizing at the end like every

701
00:26:24,120 --> 00:26:26,400
query in order to have this result needs

702
00:26:26,400 --> 00:26:28,200
some type of scalar function like

703
00:26:28,200 --> 00:26:30,840
summarize and you'll use summarize all

704
00:26:30,840 --> 00:26:33,779
of the time uh so definitely like

705
00:26:33,779 --> 00:26:35,640
project and summarize are also very very

706
00:26:35,640 --> 00:26:38,520
common to use so project can also be a

707
00:26:38,520 --> 00:26:40,740
function and it can kind of serve as

708
00:26:40,740 --> 00:26:43,620
summarize sometimes but it's also a way

709
00:26:43,620 --> 00:26:45,720
to break down your query and like say I

710
00:26:45,720 --> 00:26:47,760
only want I have all of these all this

711
00:26:47,760 --> 00:26:49,559
data but I'm only going to focus on like

712
00:26:49,559 --> 00:26:51,960
five to six roles that's what the

713
00:26:51,960 --> 00:26:54,059
project can do it can take away some

714
00:26:54,059 --> 00:26:57,659
stuff which makes the kql lighter and

715
00:26:57,659 --> 00:27:00,480
it's going to process faster

716
00:27:00,480 --> 00:27:03,000
and okay so we're summarizing the count

717
00:27:03,000 --> 00:27:05,640
of failed attempts attempts by rolls and

718
00:27:05,640 --> 00:27:07,679
then we are going to do um an order by

719
00:27:07,679 --> 00:27:10,799
which is very similar so this is exactly

720
00:27:10,799 --> 00:27:13,200
you know an example it's just one

721
00:27:13,200 --> 00:27:15,000
example of things you can do to set an

722
00:27:15,000 --> 00:27:17,400
alert for and then you know in terms of

723
00:27:17,400 --> 00:27:19,320
automation like what uh Tolson was

724
00:27:19,320 --> 00:27:21,960
talking about you could say okay set an

725
00:27:21,960 --> 00:27:24,000
alert and also send this to servicenow

726
00:27:24,000 --> 00:27:26,520
create a ticket have somebody look into

727
00:27:26,520 --> 00:27:28,919
it these are the idea like we want you

728
00:27:28,919 --> 00:27:30,059
to

729
00:27:30,059 --> 00:27:32,880
um be able to start to find and track

730
00:27:32,880 --> 00:27:34,260
these things and we know not everything

731
00:27:34,260 --> 00:27:36,539
is going to be an actual attack but it

732
00:27:36,539 --> 00:27:37,860
could be something that needs additional

733
00:27:37,860 --> 00:27:40,260
investigation and if we can automate

734
00:27:40,260 --> 00:27:42,480
some of this that's the dream right we

735
00:27:42,480 --> 00:27:45,059
don't want to have to do this manually

736
00:27:45,059 --> 00:27:47,100
all right

737
00:27:47,100 --> 00:27:49,440
are any of you falling asleep not yet

738
00:27:49,440 --> 00:27:52,860
okay okay that's fine or I mean if

739
00:27:52,860 --> 00:27:54,299
you're hungry like I said go get food

740
00:27:54,299 --> 00:27:56,039
all right so we're going to get into

741
00:27:56,039 --> 00:27:58,860
some tips and tricks and this is just to

742
00:27:58,860 --> 00:28:00,059
help you

743
00:28:00,059 --> 00:28:01,860
not bang your head against the table

744
00:28:01,860 --> 00:28:03,659
like I did numerous times when I was

745
00:28:03,659 --> 00:28:06,539
learning and I'm assuming that all of

746
00:28:06,539 --> 00:28:09,120
you guys are way smarter than me and you

747
00:28:09,120 --> 00:28:11,220
probably already know

748
00:28:11,220 --> 00:28:13,200
um way more advanced coding than this

749
00:28:13,200 --> 00:28:15,179
but I'm gonna but then I'm going to

750
00:28:15,179 --> 00:28:17,820
decide that that's okay I'm gonna still

751
00:28:17,820 --> 00:28:19,679
explain it and if you if you get nothing

752
00:28:19,679 --> 00:28:21,720
out of it I'm sorry but I hope you get

753
00:28:21,720 --> 00:28:23,940
something out of it

754
00:28:23,940 --> 00:28:26,520
so laying out a workbook or laying out

755
00:28:26,520 --> 00:28:28,799
something that I know well let me I

756
00:28:28,799 --> 00:28:30,480
should ask do you guys ever have to

757
00:28:30,480 --> 00:28:32,399
create reports to show your leadership

758
00:28:32,399 --> 00:28:33,960
at all on the stuff that you're doing

759
00:28:33,960 --> 00:28:36,720
and protecting your environment from

760
00:28:36,720 --> 00:28:40,320
okay good that makes me happy so then

761
00:28:40,320 --> 00:28:42,659
this could become useful to you

762
00:28:42,659 --> 00:28:45,720
um we want these these visualizations to

763
00:28:45,720 --> 00:28:47,820
be not necessarily easy for you to

764
00:28:47,820 --> 00:28:49,559
understand but easy for your manager and

765
00:28:49,559 --> 00:28:51,000
your leadership to understand and to

766
00:28:51,000 --> 00:28:51,899
explain

767
00:28:51,899 --> 00:28:54,480
so when I lay out a workbook I am not

768
00:28:54,480 --> 00:28:56,640
trying to go crazy and create the newest

769
00:28:56,640 --> 00:29:00,179
coolest workbook I don't care and

770
00:29:00,179 --> 00:29:02,880
actually mine are sometimes very very

771
00:29:02,880 --> 00:29:05,220
basic is not the word I like to use but

772
00:29:05,220 --> 00:29:06,779
that's what it is

773
00:29:06,779 --> 00:29:08,820
um okay so in terms of how I like to lay

774
00:29:08,820 --> 00:29:10,799
it out I'm always going to put a donut

775
00:29:10,799 --> 00:29:12,419
chart and I'm going to put a timeline

776
00:29:12,419 --> 00:29:14,580
chart and I'm going to show this

777
00:29:14,580 --> 00:29:16,740
information side by side

778
00:29:16,740 --> 00:29:18,120
and I'm going to do that for every

779
00:29:18,120 --> 00:29:19,559
single way that I'm going to break out

780
00:29:19,559 --> 00:29:23,100
this data and in the end if I have and

781
00:29:23,100 --> 00:29:24,960
the reason I do this is because there

782
00:29:24,960 --> 00:29:27,059
are you know 29

783
00:29:27,059 --> 00:29:29,820
workbooks alone that we have in our

784
00:29:29,820 --> 00:29:31,260
Arsenal and that's just the stuff that

785
00:29:31,260 --> 00:29:33,659
is like templated so if I am constantly

786
00:29:33,659 --> 00:29:35,279
seeing different visualizations and

787
00:29:35,279 --> 00:29:37,500
different ways to look at things my eye

788
00:29:37,500 --> 00:29:39,659
isn't going to catch anomalies as

789
00:29:39,659 --> 00:29:41,580
quickly but if I'm used to the way that

790
00:29:41,580 --> 00:29:43,020
I'm looking at data I'm going to

791
00:29:43,020 --> 00:29:44,520
probably catch things that look a little

792
00:29:44,520 --> 00:29:45,779
weird

793
00:29:45,779 --> 00:29:47,940
all right so here's an example of laying

794
00:29:47,940 --> 00:29:49,679
out the workbook but as one of my

795
00:29:49,679 --> 00:29:51,899
customers said to me he's like uh I

796
00:29:51,899 --> 00:29:54,360
don't want to see the same data like I

797
00:29:54,360 --> 00:29:56,640
don't want to see it as counts in both

798
00:29:56,640 --> 00:29:58,559
of them I want to see percentages over

799
00:29:58,559 --> 00:30:00,659
here in the donut chart and one amazing

800
00:30:00,659 --> 00:30:02,520
thing about workbooks it's not actually

801
00:30:02,520 --> 00:30:03,960
amazing but it's just the way that it

802
00:30:03,960 --> 00:30:04,740
works

803
00:30:04,740 --> 00:30:07,740
is that if you try to just like how you

804
00:30:07,740 --> 00:30:09,659
would think to do it go into like chart

805
00:30:09,659 --> 00:30:12,299
settings and change it to percentage it

806
00:30:12,299 --> 00:30:15,299
doesn't work it's going to be like 2 908

807
00:30:15,299 --> 00:30:17,640
percent so it it doesn't actually

808
00:30:17,640 --> 00:30:19,980
calculate the percentage for you so that

809
00:30:19,980 --> 00:30:21,840
is where you guys have to actually

810
00:30:21,840 --> 00:30:24,840
create it in the in the query itself so

811
00:30:24,840 --> 00:30:25,620
that's what I'm going to show you how to

812
00:30:25,620 --> 00:30:28,080
do so how do we convert all of this

813
00:30:28,080 --> 00:30:29,940
information to percentages that are

814
00:30:29,940 --> 00:30:31,860
actually useful

815
00:30:31,860 --> 00:30:34,260
all right this looks way harder than it

816
00:30:34,260 --> 00:30:35,460
is

817
00:30:35,460 --> 00:30:39,659
it's a lot of words yeah so the the

818
00:30:39,659 --> 00:30:41,580
query itself is in the black and blue

819
00:30:41,580 --> 00:30:44,279
and red and then I tried to put in the

820
00:30:44,279 --> 00:30:46,380
in the green I tried to put in the

821
00:30:46,380 --> 00:30:48,840
explanation of each line just to try to

822
00:30:48,840 --> 00:30:50,279
make it a little bit more

823
00:30:50,279 --> 00:30:51,659
um consumable

824
00:30:51,659 --> 00:30:52,860
so

825
00:30:52,860 --> 00:30:55,980
in my in my mind it's a good idea to

826
00:30:55,980 --> 00:30:57,600
always start thinking of like what is

827
00:30:57,600 --> 00:30:59,880
your base query in your workbook because

828
00:30:59,880 --> 00:31:01,860
your workbook most likely is going to

829
00:31:01,860 --> 00:31:03,720
have a query that's pretty consistent

830
00:31:03,720 --> 00:31:06,000
throughout the workbook and so this is

831
00:31:06,000 --> 00:31:08,399
my base query that I built out for when

832
00:31:08,399 --> 00:31:11,700
I was building a authentication method

833
00:31:11,700 --> 00:31:13,440
analysis workbook because we were trying

834
00:31:13,440 --> 00:31:15,000
to figure out who's getting over

835
00:31:15,000 --> 00:31:17,760
prompted in their environment and so

836
00:31:17,760 --> 00:31:19,440
okay this is my base query that's pretty

837
00:31:19,440 --> 00:31:20,700
much going to be consistent through all

838
00:31:20,700 --> 00:31:22,320
my visuals

839
00:31:22,320 --> 00:31:24,240
let's start at the beginning

840
00:31:24,240 --> 00:31:26,399
because it might be helpful all right

841
00:31:26,399 --> 00:31:29,100
sign in logs this is going to be sign-in

842
00:31:29,100 --> 00:31:31,200
logs like is so much information in

843
00:31:31,200 --> 00:31:32,279
there

844
00:31:32,279 --> 00:31:34,019
um and people can say yes I can just

845
00:31:34,019 --> 00:31:35,880
look at the raw data I don't know if

846
00:31:35,880 --> 00:31:37,080
they can actually look at the raw data

847
00:31:37,080 --> 00:31:39,299
and get too much out of it so this is a

848
00:31:39,299 --> 00:31:41,039
way to like really parse it out make

849
00:31:41,039 --> 00:31:43,140
make something of it and this is just

850
00:31:43,140 --> 00:31:45,179
one option so we're going to do an MV

851
00:31:45,179 --> 00:31:48,299
expand right away because the a lot of

852
00:31:48,299 --> 00:31:50,340
the important data are in these Dynamic

853
00:31:50,340 --> 00:31:53,519
columns or they're Dynamic columns that

854
00:31:53,519 --> 00:31:55,980
have also been made into Strings which

855
00:31:55,980 --> 00:31:57,659
make them even more complicated to pull

856
00:31:57,659 --> 00:31:58,320
out

857
00:31:58,320 --> 00:31:59,820
so

858
00:31:59,820 --> 00:32:01,620
in this instance I really want to pull

859
00:32:01,620 --> 00:32:03,059
out information from authentication

860
00:32:03,059 --> 00:32:04,860
details because like I told you I'm

861
00:32:04,860 --> 00:32:06,179
building this workbook that is for

862
00:32:06,179 --> 00:32:07,559
authentication methods so I need

863
00:32:07,559 --> 00:32:10,799
something out of there and if I had

864
00:32:10,799 --> 00:32:13,679
access to my portal I could show you

865
00:32:13,679 --> 00:32:15,539
what that data looked like just trust me

866
00:32:15,539 --> 00:32:18,539
it's in Json okay

867
00:32:18,539 --> 00:32:20,039
um and all right so we're going to

868
00:32:20,039 --> 00:32:21,360
expand that field out and I'm going to

869
00:32:21,360 --> 00:32:23,460
call it parse fields and I'm going to do

870
00:32:23,460 --> 00:32:25,559
a parse underscore Json this parse

871
00:32:25,559 --> 00:32:27,240
underscore Json can also be parse

872
00:32:27,240 --> 00:32:30,360
underscore CSV so depending on you know

873
00:32:30,360 --> 00:32:32,820
how the format of that column is you

874
00:32:32,820 --> 00:32:34,799
know you have options to parse it out so

875
00:32:34,799 --> 00:32:36,419
I'm parsing out the authentication

876
00:32:36,419 --> 00:32:37,980
details column

877
00:32:37,980 --> 00:32:39,720
and then I'm going to make a new column

878
00:32:39,720 --> 00:32:41,100
because I'm going to take that data that

879
00:32:41,100 --> 00:32:42,960
I just grabbed and I'm going to create

880
00:32:42,960 --> 00:32:45,720
the authentication method column but I

881
00:32:45,720 --> 00:32:48,240
still have to call call back to the

882
00:32:48,240 --> 00:32:50,760
parsed information and the way and then

883
00:32:50,760 --> 00:32:53,159
I do a parse Fields dot authentication

884
00:32:53,159 --> 00:32:54,299
method

885
00:32:54,299 --> 00:32:57,779
that means inside the Json format in a

886
00:32:57,779 --> 00:33:01,019
key value pair the authentication method

887
00:33:01,019 --> 00:33:02,600
was the

888
00:33:02,600 --> 00:33:05,880
value no the label and then I'm going to

889
00:33:05,880 --> 00:33:08,159
pull out each of those values so that's

890
00:33:08,159 --> 00:33:09,659
all that's doing

891
00:33:09,659 --> 00:33:11,580
then it tells me it doesn't like that

892
00:33:11,580 --> 00:33:13,320
the way that it is and I need to make it

893
00:33:13,320 --> 00:33:14,940
into a string as well

894
00:33:14,940 --> 00:33:17,399
and so you don't always have to do this

895
00:33:17,399 --> 00:33:19,740
step and you may not have to do any of

896
00:33:19,740 --> 00:33:21,360
these steps but just depending on the

897
00:33:21,360 --> 00:33:23,220
column and the way it's put together in

898
00:33:23,220 --> 00:33:25,320
this instance I did an auth method and I

899
00:33:25,320 --> 00:33:28,559
put it back into a string and um I

900
00:33:28,559 --> 00:33:29,760
pulled that information to make it a

901
00:33:29,760 --> 00:33:32,159
string and I gave it a new label

902
00:33:32,159 --> 00:33:34,679
all right then I basically did the same

903
00:33:34,679 --> 00:33:36,840
thing for device detail because I wanted

904
00:33:36,840 --> 00:33:39,720
to put in you know information about not

905
00:33:39,720 --> 00:33:41,220
just authentication method I want to see

906
00:33:41,220 --> 00:33:43,500
authentication method by the devices

907
00:33:43,500 --> 00:33:45,960
that I have I want to see it by the

908
00:33:45,960 --> 00:33:48,120
operating system that it's coming from I

909
00:33:48,120 --> 00:33:50,640
want to see it by user by application I

910
00:33:50,640 --> 00:33:53,159
want it broken down in every which way

911
00:33:53,159 --> 00:33:55,919
and so in this sense I'm like building

912
00:33:55,919 --> 00:33:57,179
all of these columns because I'm

913
00:33:57,179 --> 00:33:59,340
preparing my base query

914
00:33:59,340 --> 00:34:01,440
so I'm doing the same thing I just

915
00:34:01,440 --> 00:34:02,580
explained to you but for different

916
00:34:02,580 --> 00:34:06,120
columns and I here I'm all these extend

917
00:34:06,120 --> 00:34:07,860
is basically saying give me this new

918
00:34:07,860 --> 00:34:09,300
column

919
00:34:09,300 --> 00:34:10,500
all right

920
00:34:10,500 --> 00:34:14,099
so then we get into the where Clauses

921
00:34:14,099 --> 00:34:16,199
like the where statements and this is

922
00:34:16,199 --> 00:34:18,599
where I'm going to put in my barriers of

923
00:34:18,599 --> 00:34:20,699
the type of data I want and in this

924
00:34:20,699 --> 00:34:22,739
instance I'm going to say I don't want

925
00:34:22,739 --> 00:34:25,918
to count previously previously satisfied

926
00:34:25,918 --> 00:34:28,379
okay so I say where off method does not

927
00:34:28,379 --> 00:34:30,239
equal previously satisfied or it doesn't

928
00:34:30,239 --> 00:34:31,679
equal blank I want all that information

929
00:34:31,679 --> 00:34:34,440
out of my data set and I'm gonna this is

930
00:34:34,440 --> 00:34:36,359
going to be consistent throughout my

931
00:34:36,359 --> 00:34:38,879
whole entire workbook so it's important

932
00:34:38,879 --> 00:34:41,219
that I know what each step is doing

933
00:34:41,219 --> 00:34:44,879
and that when I also like send this data

934
00:34:44,879 --> 00:34:46,500
to someone or if I explain this data to

935
00:34:46,500 --> 00:34:48,540
someone I let them know the data that I

936
00:34:48,540 --> 00:34:51,060
took out and like how I'm calculating it

937
00:34:51,060 --> 00:34:52,020
because otherwise they're gonna be

938
00:34:52,020 --> 00:34:54,480
they're going to be expecting to see a

939
00:34:54,480 --> 00:34:56,159
lot more sign-ins and I just removed

940
00:34:56,159 --> 00:34:57,540
every single one that was previously

941
00:34:57,540 --> 00:35:01,160
satisfied which is probably 90 of the

942
00:35:01,160 --> 00:35:03,839
authentication sign ins

943
00:35:03,839 --> 00:35:05,880
oh all right

944
00:35:05,880 --> 00:35:08,339
so now we go in and we're doing okay

945
00:35:08,339 --> 00:35:11,220
where our username is we take out some

946
00:35:11,220 --> 00:35:13,140
users that we don't care about and then

947
00:35:13,140 --> 00:35:16,320
we set some filters so everything from

948
00:35:16,320 --> 00:35:19,800
here this where authmet in authmed or

949
00:35:19,800 --> 00:35:22,500
asterisk all of these things here these

950
00:35:22,500 --> 00:35:24,540
one one two three four five

951
00:35:24,540 --> 00:35:27,119
six I can't count but you know five or

952
00:35:27,119 --> 00:35:30,660
six in there that all pertains to the

953
00:35:30,660 --> 00:35:32,520
parameters that I set at the beginning

954
00:35:32,520 --> 00:35:34,800
of the workbook which are filters

955
00:35:34,800 --> 00:35:37,020
so when I first started building out

956
00:35:37,020 --> 00:35:38,940
these workbooks I had no idea what that

957
00:35:38,940 --> 00:35:41,579
code meant or like what it pertained to

958
00:35:41,579 --> 00:35:43,800
but it's all relating back to a

959
00:35:43,800 --> 00:35:46,320
perimeter so if I set a perimeter

960
00:35:46,320 --> 00:35:48,119
um set a filter up in my workbook to say

961
00:35:48,119 --> 00:35:51,240
hey I want to be able to filter by this

962
00:35:51,240 --> 00:35:53,940
username the only way that the visual

963
00:35:53,940 --> 00:35:57,420
has any idea to listen to that filter is

964
00:35:57,420 --> 00:36:00,540
by putting it in in your query

965
00:36:00,540 --> 00:36:02,460
all right so that's what all those are

966
00:36:02,460 --> 00:36:05,700
and then I did another new column for

967
00:36:05,700 --> 00:36:08,099
status because someone decided after I'd

968
00:36:08,099 --> 00:36:09,660
kind of built out this query that they

969
00:36:09,660 --> 00:36:11,760
also wanted to see failures or successes

970
00:36:11,760 --> 00:36:13,560
and so that's why it's at the bottom

971
00:36:13,560 --> 00:36:15,960
because I added it later

972
00:36:15,960 --> 00:36:19,260
in this instance it doesn't impact my

973
00:36:19,260 --> 00:36:20,820
data

974
00:36:20,820 --> 00:36:22,740
um in a negative way like but you do

975
00:36:22,740 --> 00:36:24,359
sometimes need to be cautious of the

976
00:36:24,359 --> 00:36:26,760
order uh in this instant incident it

977
00:36:26,760 --> 00:36:28,560
didn't matter but do know that sometimes

978
00:36:28,560 --> 00:36:30,480
in kql it does matter of what order

979
00:36:30,480 --> 00:36:34,200
you're putting these um lines

980
00:36:34,200 --> 00:36:35,339
all right

981
00:36:35,339 --> 00:36:38,099
now we have

982
00:36:38,099 --> 00:36:39,720
that's the last one okay now at the end

983
00:36:39,720 --> 00:36:41,280
we're doing our summary so we're saying

984
00:36:41,280 --> 00:36:42,540
we're going to summarize the count by

985
00:36:42,540 --> 00:36:44,040
auth Method all right great we used to

986
00:36:44,040 --> 00:36:45,960
have the summary but we still don't have

987
00:36:45,960 --> 00:36:48,359
percentage so great that we have this

988
00:36:48,359 --> 00:36:49,859
base query now what do we do to get it

989
00:36:49,859 --> 00:36:51,480
to be a percentage

990
00:36:51,480 --> 00:36:53,040
all right so this is where you're going

991
00:36:53,040 --> 00:36:54,660
to create a new variable

992
00:36:54,660 --> 00:36:56,520
and it's going to be called Hey base

993
00:36:56,520 --> 00:36:59,220
query that sounds easy and we're going

994
00:36:59,220 --> 00:37:01,380
to materialize it and it creates

995
00:37:01,380 --> 00:37:03,000
basically the materialized function

996
00:37:03,000 --> 00:37:06,000
creates a sub query that other queries

997
00:37:06,000 --> 00:37:08,820
can reference later so that's what that

998
00:37:08,820 --> 00:37:11,040
is all that that that's doing and it's

999
00:37:11,040 --> 00:37:13,020
materializing the base query that I just

1000
00:37:13,020 --> 00:37:15,000
walked you through so this should all

1001
00:37:15,000 --> 00:37:16,859
look familiar the only thing that's

1002
00:37:16,859 --> 00:37:18,359
different here is I took out the

1003
00:37:18,359 --> 00:37:19,380
summarize

1004
00:37:19,380 --> 00:37:21,839
because we're not going to summarize it

1005
00:37:21,839 --> 00:37:24,799
like we did on discount

1006
00:37:25,079 --> 00:37:27,240
and if you guys want to ask questions

1007
00:37:27,240 --> 00:37:29,040
like during this if I'm going too fast

1008
00:37:29,040 --> 00:37:30,480
just you know raise your hand and

1009
00:37:30,480 --> 00:37:33,240
toasten will catch it because I can go

1010
00:37:33,240 --> 00:37:34,980
over anything in more detail it's

1011
00:37:34,980 --> 00:37:37,619
totally your guys's discretion all right

1012
00:37:37,619 --> 00:37:38,820
so

1013
00:37:38,820 --> 00:37:40,140
I'm going to close that Loop of

1014
00:37:40,140 --> 00:37:41,940
materialize and then I'm going to create

1015
00:37:41,940 --> 00:37:45,599
the total count variable and I have to

1016
00:37:45,599 --> 00:37:47,760
do a two scalar function here because

1017
00:37:47,760 --> 00:37:50,160
it's going to return a constant value

1018
00:37:50,160 --> 00:37:52,440
and this is super important for when I'm

1019
00:37:52,440 --> 00:37:54,720
calculating percentages because if it's

1020
00:37:54,720 --> 00:37:56,280
not going to be a constant value there's

1021
00:37:56,280 --> 00:37:58,200
going to be slight differences in the

1022
00:37:58,200 --> 00:38:00,960
number depending on when I ran it so you

1023
00:38:00,960 --> 00:38:03,180
got to think about that as well

1024
00:38:03,180 --> 00:38:05,820
all right so then we're saying the total

1025
00:38:05,820 --> 00:38:07,740
count is that all right great just the

1026
00:38:07,740 --> 00:38:10,140
base query count that's all it is and

1027
00:38:10,140 --> 00:38:11,880
then we're we're going to reference base

1028
00:38:11,880 --> 00:38:13,320
query because remember I told you the

1029
00:38:13,320 --> 00:38:14,460
reason we're building this up here is

1030
00:38:14,460 --> 00:38:15,780
because we want to reference it later

1031
00:38:15,780 --> 00:38:17,760
and so we're going to reference base

1032
00:38:17,760 --> 00:38:19,260
query and then we're going to do our

1033
00:38:19,260 --> 00:38:21,900
summarize of the auth methods and we're

1034
00:38:21,900 --> 00:38:23,940
going to in this instance take it times

1035
00:38:23,940 --> 00:38:26,040
100 and divided by the total count by

1036
00:38:26,040 --> 00:38:28,260
auth Method this is actually going to

1037
00:38:28,260 --> 00:38:30,060
aggregate the count and divide by total

1038
00:38:30,060 --> 00:38:33,599
count that fixed count method and that's

1039
00:38:33,599 --> 00:38:34,740
actually going to give us correct

1040
00:38:34,740 --> 00:38:36,300
percentages

1041
00:38:36,300 --> 00:38:38,760
truth be told there's been times where I

1042
00:38:38,760 --> 00:38:40,680
haven't had to take it times 100 or

1043
00:38:40,680 --> 00:38:43,380
maybe had to do slightly different so do

1044
00:38:43,380 --> 00:38:45,000
look at the numbers see if it actually

1045
00:38:45,000 --> 00:38:46,619
makes sense

1046
00:38:46,619 --> 00:38:48,060
um because sometimes it can be a little

1047
00:38:48,060 --> 00:38:50,520
wonky but normally it's just like basic

1048
00:38:50,520 --> 00:38:52,079
math take a look does that make sense

1049
00:38:52,079 --> 00:38:53,520
okay maybe tweak it a little bit but

1050
00:38:53,520 --> 00:38:57,920
it's overall it's a percentage function

1051
00:38:58,079 --> 00:39:01,140
all right so that's that tip

1052
00:39:01,140 --> 00:39:03,000
I have 16 more minutes to tell you more

1053
00:39:03,000 --> 00:39:04,680
tips or you can ask questions does

1054
00:39:04,680 --> 00:39:07,619
anybody have a question okay no

1055
00:39:07,619 --> 00:39:11,000
okay yes

1056
00:39:16,020 --> 00:39:18,320
yes

1057
00:39:19,680 --> 00:39:22,460
well

1058
00:39:22,460 --> 00:39:25,320
exactly so if you spend End Mill you

1059
00:39:25,320 --> 00:39:27,599
know like n dollars a year a lot of

1060
00:39:27,599 --> 00:39:28,980
millions of dollars you probably get

1061
00:39:28,980 --> 00:39:31,740
someone like toast in her eye to help

1062
00:39:31,740 --> 00:39:34,920
you and to do workshops and to sit with

1063
00:39:34,920 --> 00:39:36,900
your identity and security team and say

1064
00:39:36,900 --> 00:39:40,200
let me walk you through all of these but

1065
00:39:40,200 --> 00:39:42,000
as we mentioned before like there's a

1066
00:39:42,000 --> 00:39:43,740
ton of already these templates that are

1067
00:39:43,740 --> 00:39:45,660
built that are that we give them and

1068
00:39:45,660 --> 00:39:47,400
that's what this is for those templates

1069
00:39:47,400 --> 00:39:49,260
are to say yeah we get this is probably

1070
00:39:49,260 --> 00:39:51,119
not everybody's

1071
00:39:51,119 --> 00:39:53,760
um you know Jam to do kql so we're going

1072
00:39:53,760 --> 00:39:55,320
to do it for you and hopefully they're

1073
00:39:55,320 --> 00:39:56,820
useful but a lot of times they need to

1074
00:39:56,820 --> 00:39:58,140
be customized

1075
00:39:58,140 --> 00:40:01,380
so getting people to care about kql is

1076
00:40:01,380 --> 00:40:02,760
kind of like maybe what they used to do

1077
00:40:02,760 --> 00:40:04,619
about Powershell like yes care about it

1078
00:40:04,619 --> 00:40:06,240
and now everybody knows it right and

1079
00:40:06,240 --> 00:40:07,920
we're assuming that maybe eventually

1080
00:40:07,920 --> 00:40:10,260
well I don't either uh you know but

1081
00:40:10,260 --> 00:40:11,760
someone on the team I know does and I

1082
00:40:11,760 --> 00:40:13,200
can always go ask that person so that's

1083
00:40:13,200 --> 00:40:14,520
what we're getting that's why that's why

1084
00:40:14,520 --> 00:40:16,140
we're even here to like let you know

1085
00:40:16,140 --> 00:40:17,520
it's available

1086
00:40:17,520 --> 00:40:19,560
yeah

1087
00:40:19,560 --> 00:40:21,599
sure

1088
00:40:21,599 --> 00:40:24,260
yep

1089
00:40:41,640 --> 00:40:45,660
so I can basically do whatever is in the

1090
00:40:45,660 --> 00:40:48,960
logs and so in this instance there's

1091
00:40:48,960 --> 00:40:51,300
nothing calling out hey this is a flag

1092
00:40:51,300 --> 00:40:54,420
or something like that but we have a

1093
00:40:54,420 --> 00:40:56,400
different data set that's it's all based

1094
00:40:56,400 --> 00:40:59,460
on risk and risk detections and so in

1095
00:40:59,460 --> 00:41:01,800
that one yes I could because the data

1096
00:41:01,800 --> 00:41:03,960
actually in the logs is calling out high

1097
00:41:03,960 --> 00:41:06,119
risk versus low risk so I could tag

1098
00:41:06,119 --> 00:41:07,020
those

1099
00:41:07,020 --> 00:41:09,000
but in this one I'm basically creating

1100
00:41:09,000 --> 00:41:12,960
alert and the best I can do is create

1101
00:41:12,960 --> 00:41:14,339
um create the data set that actually

1102
00:41:14,339 --> 00:41:17,400
could be a scenario that seems

1103
00:41:17,400 --> 00:41:20,040
risky right or seems like something's

1104
00:41:20,040 --> 00:41:22,079
not right and then I'm gonna have to

1105
00:41:22,079 --> 00:41:23,460
investigate it

1106
00:41:23,460 --> 00:41:26,359
oh but go ahead

1107
00:41:32,700 --> 00:41:34,800
right we look at like the collective

1108
00:41:34,800 --> 00:41:36,060
data and they say yeah this looks

1109
00:41:36,060 --> 00:41:38,359
suspicious

1110
00:41:40,200 --> 00:41:44,220
um well this is not a problem yeah

1111
00:41:52,440 --> 00:41:54,720
yep

1112
00:41:54,720 --> 00:41:57,060
every like as long as whatever you learn

1113
00:41:57,060 --> 00:41:59,460
to do with kql you can it can be as

1114
00:41:59,460 --> 00:42:01,260
customized as you wish

1115
00:42:01,260 --> 00:42:04,319
like you can as long as you can pull the

1116
00:42:04,319 --> 00:42:08,420
data in there it's up to you

1117
00:42:15,540 --> 00:42:17,339
you know what that would be what I'm

1118
00:42:17,339 --> 00:42:19,079
going to ask you at the end is the

1119
00:42:19,079 --> 00:42:21,060
community contribution tell us what you

1120
00:42:21,060 --> 00:42:23,400
want to have tell us what you need or

1121
00:42:23,400 --> 00:42:25,079
you know if you want to take a stab at

1122
00:42:25,079 --> 00:42:26,460
creating it in a different language and

1123
00:42:26,460 --> 00:42:28,440
you want us to try to translate it into

1124
00:42:28,440 --> 00:42:30,599
kql so it's also like we're up for

1125
00:42:30,599 --> 00:42:32,280
anything so anything that can help

1126
00:42:32,280 --> 00:42:34,440
analysts because I've learned that in at

1127
00:42:34,440 --> 00:42:37,020
Sans uh I took a course and I remember I

1128
00:42:37,020 --> 00:42:38,099
think this is the only thing I actually

1129
00:42:38,099 --> 00:42:40,380
remembered was that the most important

1130
00:42:40,380 --> 00:42:42,720
time and the most valuable thing is your

1131
00:42:42,720 --> 00:42:46,980
analyst time right so yep

1132
00:42:46,980 --> 00:42:49,200
I know you can Define like high-risk

1133
00:42:49,200 --> 00:42:50,520
activity yeah

1134
00:42:50,520 --> 00:42:54,359
you can Harvest login you can you find

1135
00:42:54,359 --> 00:42:56,280
those high risks

1136
00:42:56,280 --> 00:42:59,880
can I define those servers you can you

1137
00:42:59,880 --> 00:43:01,560
can Define them in the sense that you

1138
00:43:01,560 --> 00:43:03,420
can set alerts on what you define as

1139
00:43:03,420 --> 00:43:04,859
high risk but in terms of what's

1140
00:43:04,859 --> 00:43:07,319
actually labeled in the sign in logs

1141
00:43:07,319 --> 00:43:09,240
that is determined by Machine learning

1142
00:43:09,240 --> 00:43:11,640
and the stuff that Microsoft has

1143
00:43:11,640 --> 00:43:12,960
gathered right from billions and

1144
00:43:12,960 --> 00:43:14,460
billions of logins like this is what we

1145
00:43:14,460 --> 00:43:15,480
think

1146
00:43:15,480 --> 00:43:17,339
unfortunately some you know some people

1147
00:43:17,339 --> 00:43:19,440
have much you know stricter guidelines

1148
00:43:19,440 --> 00:43:21,480
and so there our medium risk might be

1149
00:43:21,480 --> 00:43:23,700
your high risk and that those are the

1150
00:43:23,700 --> 00:43:25,260
things that I think

1151
00:43:25,260 --> 00:43:27,420
um we constantly get feedback from our

1152
00:43:27,420 --> 00:43:28,980
customers about that and we're trying to

1153
00:43:28,980 --> 00:43:31,319
also make that something that can be

1154
00:43:31,319 --> 00:43:33,660
more customizable

1155
00:43:33,660 --> 00:43:35,280
um but it's right now it's just set by

1156
00:43:35,280 --> 00:43:38,000
how Microsoft

1157
00:43:38,460 --> 00:43:40,740
you'd probably need to create an alert

1158
00:43:40,740 --> 00:43:43,319
and say and and mark it as a high alert

1159
00:43:43,319 --> 00:43:46,200
Market is high risk

1160
00:43:46,200 --> 00:43:47,880
yep

1161
00:43:47,880 --> 00:43:49,980
or technically you wouldn't have to

1162
00:43:49,980 --> 00:43:51,119
start from scratch you could take a

1163
00:43:51,119 --> 00:43:52,859
query that's already built in and then

1164
00:43:52,859 --> 00:43:55,619
just make small changes and and set it

1165
00:43:55,619 --> 00:43:57,180
as an alert so that's also like you

1166
00:43:57,180 --> 00:43:58,740
don't you never really like honestly

1167
00:43:58,740 --> 00:44:01,260
even I don't necessarily start from

1168
00:44:01,260 --> 00:44:02,520
scratch sometimes I just take a piece

1169
00:44:02,520 --> 00:44:03,599
that I know I'm going to need and build

1170
00:44:03,599 --> 00:44:06,140
on it yeah

1171
00:44:11,240 --> 00:44:14,460
like threat protection or is it like

1172
00:44:14,460 --> 00:44:16,319
threat analytics or something is that

1173
00:44:16,319 --> 00:44:17,940
what you're saying

1174
00:44:17,940 --> 00:44:20,400
okay I don't know UV I don't know I just

1175
00:44:20,400 --> 00:44:21,540
I don't know

1176
00:44:21,540 --> 00:44:24,680
okay yes

1177
00:44:25,020 --> 00:44:26,819
okay

1178
00:44:26,819 --> 00:44:29,579
yep I think it's it

1179
00:44:29,579 --> 00:44:33,500
is it Sentinel or ATP okay yeah

1180
00:44:35,220 --> 00:44:37,980
to pull Sentinel Sentinel data here

1181
00:44:37,980 --> 00:44:41,359
or the uba data

1182
00:44:43,040 --> 00:44:44,880
no I know I'm just trying to think

1183
00:44:44,880 --> 00:44:46,740
because normally what we would say is

1184
00:44:46,740 --> 00:44:48,240
like this is the intermediate step

1185
00:44:48,240 --> 00:44:50,280
before you would get your data in

1186
00:44:50,280 --> 00:44:51,660
Sentinel

1187
00:44:51,660 --> 00:44:53,579
so a lot of times we're pulling this

1188
00:44:53,579 --> 00:44:55,980
data into Sentinel or into a seam

1189
00:44:55,980 --> 00:44:58,440
solution where you can also do the uba

1190
00:44:58,440 --> 00:44:59,819
stuff

1191
00:44:59,819 --> 00:45:01,980
yes

1192
00:45:01,980 --> 00:45:04,099
yes

1193
00:45:18,359 --> 00:45:21,500
yep yes

1194
00:45:24,599 --> 00:45:26,579
exactly like we are definitely not

1195
00:45:26,579 --> 00:45:28,619
trying to take place of a steam solution

1196
00:45:28,619 --> 00:45:31,560
here it's really just

1197
00:45:31,560 --> 00:45:33,420
quick analysis because I do feel like

1198
00:45:33,420 --> 00:45:34,859
there's sometimes separation of Duties

1199
00:45:34,859 --> 00:45:37,380
right people who completely have

1200
00:45:37,380 --> 00:45:39,000
are you know trying to do these attack

1201
00:45:39,000 --> 00:45:40,500
you know like attack threats and

1202
00:45:40,500 --> 00:45:42,480
Analysis versus who has access to the

1203
00:45:42,480 --> 00:45:45,300
same solution who so it's a way to kind

1204
00:45:45,300 --> 00:45:47,400
of do some quick and dirty work in the

1205
00:45:47,400 --> 00:45:48,060
middle

1206
00:45:48,060 --> 00:45:49,859
yeah

1207
00:45:49,859 --> 00:45:52,859
uh okay yes any other questions before

1208
00:45:52,859 --> 00:45:55,400
question yeah

1209
00:45:55,400 --> 00:45:58,380
I guess any other workbooks some of the

1210
00:45:58,380 --> 00:46:01,520
two will be more for like

1211
00:46:01,520 --> 00:46:06,780
that so it if you as a blue team do not

1212
00:46:06,780 --> 00:46:09,119
need to automate anything sure

1213
00:46:09,119 --> 00:46:11,579
yeah but I think what we're trying to

1214
00:46:11,579 --> 00:46:14,880
say is that if you are a blue team and

1215
00:46:14,880 --> 00:46:17,280
you're you are looking for anomalies

1216
00:46:17,280 --> 00:46:20,040
you're looking for ways to do uh

1217
00:46:20,040 --> 00:46:22,440
queering lots of log data because do you

1218
00:46:22,440 --> 00:46:25,260
guys look at log data as blue team

1219
00:46:25,260 --> 00:46:27,420
yeah so then this is a way to like query

1220
00:46:27,420 --> 00:46:29,579
that log data and and make sense of it

1221
00:46:29,579 --> 00:46:32,220
in an easier way

1222
00:46:32,220 --> 00:46:33,900
and also you don't you wouldn't even

1223
00:46:33,900 --> 00:46:35,880
have to do this in workbook so

1224
00:46:35,880 --> 00:46:37,859
there's also something and I don't know

1225
00:46:37,859 --> 00:46:39,540
what the like

1226
00:46:39,540 --> 00:46:41,160
I forget always the name of it but it's

1227
00:46:41,160 --> 00:46:43,260
called custom Explorer where you're

1228
00:46:43,260 --> 00:46:45,960
bringing in where it's just more of a

1229
00:46:45,960 --> 00:46:48,359
platform to do huge queries it's not

1230
00:46:48,359 --> 00:46:49,500
trying to do all the beautiful

1231
00:46:49,500 --> 00:46:51,960
visualizations for you which may be more

1232
00:46:51,960 --> 00:46:54,240
in your in your neighborhood of what you

1233
00:46:54,240 --> 00:46:57,540
would like to see maybe yeah

1234
00:46:57,540 --> 00:46:59,520
anybody else okay

1235
00:46:59,520 --> 00:47:00,780
all right

1236
00:47:00,780 --> 00:47:02,099
how much time

1237
00:47:02,099 --> 00:47:04,140
okay eight minutes well I'm gonna keep

1238
00:47:04,140 --> 00:47:05,280
on going but if you have questions just

1239
00:47:05,280 --> 00:47:06,540
raise your hand

1240
00:47:06,540 --> 00:47:10,099
all right so we covered that already

1241
00:47:10,260 --> 00:47:12,060
all right the other cool thing that I

1242
00:47:12,060 --> 00:47:13,680
like to point out and that was very

1243
00:47:13,680 --> 00:47:15,420
tricky for me was making these graphs

1244
00:47:15,420 --> 00:47:18,540
interactive so I may want to like this

1245
00:47:18,540 --> 00:47:20,040
looks great and all but I may want to

1246
00:47:20,040 --> 00:47:22,319
like click into authenticator app and

1247
00:47:22,319 --> 00:47:24,000
see the data move right that's usually

1248
00:47:24,000 --> 00:47:25,859
what probably right away someone is

1249
00:47:25,859 --> 00:47:28,079
going to do is like try to like punch on

1250
00:47:28,079 --> 00:47:29,700
the on the you know on the donut chart

1251
00:47:29,700 --> 00:47:31,380
and see things move and so they expect

1252
00:47:31,380 --> 00:47:32,520
that

1253
00:47:32,520 --> 00:47:34,020
so the way that you create these

1254
00:47:34,020 --> 00:47:37,440
interactive graphs is um for example you

1255
00:47:37,440 --> 00:47:39,780
just open up your advanced settings in

1256
00:47:39,780 --> 00:47:41,940
in the workbook and every single

1257
00:47:41,940 --> 00:47:43,500
visualization that you're creating every

1258
00:47:43,500 --> 00:47:45,480
single query that you're creating is

1259
00:47:45,480 --> 00:47:47,819
going to have these options above it

1260
00:47:47,819 --> 00:47:50,160
and you're going to say when certain

1261
00:47:50,160 --> 00:47:53,099
items are selected on this graph I want

1262
00:47:53,099 --> 00:47:54,660
to pull out some parameters that's

1263
00:47:54,660 --> 00:47:57,359
basically what this is doing and so in

1264
00:47:57,359 --> 00:47:59,099
this sense I'm going to say I'm going to

1265
00:47:59,099 --> 00:48:00,660
export parameters and I'm going to call

1266
00:48:00,660 --> 00:48:02,460
it selected auth method I made that name

1267
00:48:02,460 --> 00:48:04,980
up I just put it in there that's that's

1268
00:48:04,980 --> 00:48:07,740
my name for it however the this default

1269
00:48:07,740 --> 00:48:10,200
series that's important that's saying

1270
00:48:10,200 --> 00:48:13,800
that if if it's not going to be

1271
00:48:13,800 --> 00:48:15,240
um clicked on what do you want me to

1272
00:48:15,240 --> 00:48:16,920
show and I want you to show all of the

1273
00:48:16,920 --> 00:48:18,420
data that's basically what this is

1274
00:48:18,420 --> 00:48:19,440
saying

1275
00:48:19,440 --> 00:48:22,380
so if I want the pie chart and the or

1276
00:48:22,380 --> 00:48:24,839
the donut chart and the line graph to be

1277
00:48:24,839 --> 00:48:26,640
interactive this is what I have to do to

1278
00:48:26,640 --> 00:48:27,839
the pie chart

1279
00:48:27,839 --> 00:48:30,780
and then I have to add kql to this

1280
00:48:30,780 --> 00:48:31,920
interactive

1281
00:48:31,920 --> 00:48:33,839
um to the to the graph that is going to

1282
00:48:33,839 --> 00:48:35,640
show the results based on what I

1283
00:48:35,640 --> 00:48:37,440
selected and what you're going to put

1284
00:48:37,440 --> 00:48:38,880
what you're going to add the query that

1285
00:48:38,880 --> 00:48:41,160
you're going to add is this new mbx band

1286
00:48:41,160 --> 00:48:43,740
which is is building out it's going to

1287
00:48:43,740 --> 00:48:45,540
do some parsing for you so I'm doing a

1288
00:48:45,540 --> 00:48:47,700
parse method I'm parsing the Json and

1289
00:48:47,700 --> 00:48:49,500
I'm putting it all into a string in one

1290
00:48:49,500 --> 00:48:50,220
line

1291
00:48:50,220 --> 00:48:53,220
and this is if you remember is is this

1292
00:48:53,220 --> 00:48:55,500
uh parameter name I made up

1293
00:48:55,500 --> 00:48:57,660
so it's basically creating this column

1294
00:48:57,660 --> 00:49:00,480
for me and then I'm going to call it the

1295
00:49:00,480 --> 00:49:02,040
parse I'm going to call it selected auth

1296
00:49:02,040 --> 00:49:03,660
method that column and it's basically

1297
00:49:03,660 --> 00:49:05,160
going to take this information that I

1298
00:49:05,160 --> 00:49:07,920
put into the parsed method variable and

1299
00:49:07,920 --> 00:49:10,260
pull out just the series information the

1300
00:49:10,260 --> 00:49:13,800
series is the the values and labels that

1301
00:49:13,800 --> 00:49:15,599
I that I want

1302
00:49:15,599 --> 00:49:18,660
and this where selected me uh selected

1303
00:49:18,660 --> 00:49:21,180
auth method is all it's either going to

1304
00:49:21,180 --> 00:49:22,859
be that or it's going to be whatever I

1305
00:49:22,859 --> 00:49:25,500
selected so in the end this code I

1306
00:49:25,500 --> 00:49:29,040
insert it into my base query that we've

1307
00:49:29,040 --> 00:49:30,660
all went through

1308
00:49:30,660 --> 00:49:33,839
and then now when I select on say

1309
00:49:33,839 --> 00:49:36,300
authenticator app this is going to show

1310
00:49:36,300 --> 00:49:37,500
up

1311
00:49:37,500 --> 00:49:40,520
um that's really small

1312
00:49:42,000 --> 00:49:43,260
yeah

1313
00:49:43,260 --> 00:49:45,240
then that's going to show up just with

1314
00:49:45,240 --> 00:49:48,420
the auth method information and

1315
00:49:48,420 --> 00:49:50,099
just so you can see what actually

1316
00:49:50,099 --> 00:49:53,040
happened when I entered that kql it it

1317
00:49:53,040 --> 00:49:55,260
built this column right it built the

1318
00:49:55,260 --> 00:49:56,940
selected auth method column and added it

1319
00:49:56,940 --> 00:49:59,339
to the data set and so whenever I select

1320
00:49:59,339 --> 00:50:01,680
something this gets adjusted in this in

1321
00:50:01,680 --> 00:50:04,079
this example I selected the mobile app

1322
00:50:04,079 --> 00:50:05,839
notification

1323
00:50:05,839 --> 00:50:09,839
value and so now it it only shows that

1324
00:50:09,839 --> 00:50:13,040
information and counts it out

1325
00:50:13,800 --> 00:50:15,720
they're clapping I hope you guys do that

1326
00:50:15,720 --> 00:50:18,140
for us

1327
00:50:19,319 --> 00:50:21,660
all right last thing

1328
00:50:21,660 --> 00:50:22,800
um because I feel like we kind of did

1329
00:50:22,800 --> 00:50:24,180
questions throughout the thing so I

1330
00:50:24,180 --> 00:50:25,680
don't

1331
00:50:25,680 --> 00:50:27,200
huh

1332
00:50:27,200 --> 00:50:29,640
for questions

1333
00:50:29,640 --> 00:50:31,380
well I'm just letting you guys oh okay

1334
00:50:31,380 --> 00:50:34,579
yeah yes

1335
00:50:34,859 --> 00:50:36,119
sorry

1336
00:50:36,119 --> 00:50:37,440
oh I think he was just telling me I had

1337
00:50:37,440 --> 00:50:40,760
five minutes I think yeah

1338
00:50:43,200 --> 00:50:45,180
yeah

1339
00:50:45,180 --> 00:50:48,000
yes now let me see oh you guys can see

1340
00:50:48,000 --> 00:50:51,180
my dashboard what how did it do not do

1341
00:50:51,180 --> 00:50:52,740
that before

1342
00:50:52,740 --> 00:50:54,119
oh I could have been doing this the

1343
00:50:54,119 --> 00:50:57,180
whole time okay anyways

1344
00:50:57,180 --> 00:50:59,400
all right so I'm going to show you what

1345
00:50:59,400 --> 00:51:00,839
I just talked about really quick in

1346
00:51:00,839 --> 00:51:03,480
these last few minutes

1347
00:51:03,480 --> 00:51:05,280
what

1348
00:51:05,280 --> 00:51:07,380
all right so basically I'm in the Azure

1349
00:51:07,380 --> 00:51:09,180
active directory portal are you familiar

1350
00:51:09,180 --> 00:51:11,220
with the portal at all the the Azure

1351
00:51:11,220 --> 00:51:14,839
actor directory portal what whatsoever

1352
00:51:16,380 --> 00:51:19,740
okay so I am in this monitoring section

1353
00:51:19,740 --> 00:51:21,660
here I'm scared to click on anything

1354
00:51:21,660 --> 00:51:23,940
because it might take time to load

1355
00:51:23,940 --> 00:51:26,339
but let me go

1356
00:51:26,339 --> 00:51:28,079
oh maybe not

1357
00:51:28,079 --> 00:51:29,940
this is how the workbooks look like when

1358
00:51:29,940 --> 00:51:32,940
I'm editing them just FYI um so like I'm

1359
00:51:32,940 --> 00:51:35,220
editing the query here I can also bring

1360
00:51:35,220 --> 00:51:37,200
it into log analytics which is better

1361
00:51:37,200 --> 00:51:39,359
but I'm going to just quick go to the

1362
00:51:39,359 --> 00:51:41,339
workbooks blade and see if it is

1363
00:51:41,339 --> 00:51:43,980
friendly with me today

1364
00:51:43,980 --> 00:51:45,240
yep

1365
00:51:45,240 --> 00:51:46,200
yeah

1366
00:51:46,200 --> 00:51:48,618
oops

1367
00:51:49,440 --> 00:51:52,020
what no

1368
00:51:52,020 --> 00:51:54,559
yeah

1369
00:51:58,140 --> 00:52:01,700
if it doesn't load up I will share it

1370
00:52:06,660 --> 00:52:09,359
all right this is what all these purple

1371
00:52:09,359 --> 00:52:11,700
ones are what we have created as

1372
00:52:11,700 --> 00:52:15,660
templates and so I get a lot of um a lot

1373
00:52:15,660 --> 00:52:17,579
of my kql from ones that are already

1374
00:52:17,579 --> 00:52:20,220
pre-made and then customize it and these

1375
00:52:20,220 --> 00:52:21,660
ones that are saying recently modified

1376
00:52:21,660 --> 00:52:24,119
in terms of my team this is the ones

1377
00:52:24,119 --> 00:52:25,980
that we've created like I have a b-sides

1378
00:52:25,980 --> 00:52:27,720
charm one so I've created it and saved

1379
00:52:27,720 --> 00:52:29,579
it and then it shows up to me because I

1380
00:52:29,579 --> 00:52:31,319
have access to this specific Azure

1381
00:52:31,319 --> 00:52:32,819
subscription

1382
00:52:32,819 --> 00:52:34,680
so not everybody's going in your company

1383
00:52:34,680 --> 00:52:36,240
is going to have access to this I have

1384
00:52:36,240 --> 00:52:38,819
to be able to have access to use this

1385
00:52:38,819 --> 00:52:40,500
Azure subscription

1386
00:52:40,500 --> 00:52:41,880
is that kind of what you wanted to see

1387
00:52:41,880 --> 00:52:44,339
or okay perfect

1388
00:52:44,339 --> 00:52:46,920
all right are there any other questions

1389
00:52:46,920 --> 00:52:48,839
like I guess oh this is where I can show

1390
00:52:48,839 --> 00:52:50,220
you what the data looks like before you

1391
00:52:50,220 --> 00:52:51,480
parse it out this is really what I

1392
00:52:51,480 --> 00:52:53,160
wanted to show you

1393
00:52:53,160 --> 00:52:55,740
so this is how authentication details is

1394
00:52:55,740 --> 00:52:58,020
all put into one column and it's in Json

1395
00:52:58,020 --> 00:53:00,540
but it's also then in Brackets which

1396
00:53:00,540 --> 00:53:02,940
requires an extra step to pull it out

1397
00:53:02,940 --> 00:53:05,040
and to parse it

1398
00:53:05,040 --> 00:53:07,440
it is annoying and you know honestly

1399
00:53:07,440 --> 00:53:09,240
like even when I explain it it sounds

1400
00:53:09,240 --> 00:53:12,180
silly but that's what it is and I think

1401
00:53:12,180 --> 00:53:14,040
they must put it into a string to also

1402
00:53:14,040 --> 00:53:15,420
just save

1403
00:53:15,420 --> 00:53:18,359
space and time I don't know but

1404
00:53:18,359 --> 00:53:20,040
anyways there's a lot of information

1405
00:53:20,040 --> 00:53:22,319
there that you wouldn't know unless you

1406
00:53:22,319 --> 00:53:23,880
go and look at it and pull it out so a

1407
00:53:23,880 --> 00:53:25,380
lot of good stuff are in those Dynamic

1408
00:53:25,380 --> 00:53:26,880
fields

1409
00:53:26,880 --> 00:53:28,079
okay

1410
00:53:28,079 --> 00:53:30,240
like a minute and 50 seconds left so any

1411
00:53:30,240 --> 00:53:31,500
other questions

1412
00:53:31,500 --> 00:53:34,339
um I will oh yes

1413
00:53:44,940 --> 00:53:46,920
uh

1414
00:53:46,920 --> 00:53:49,619
awesome Azure data Explorer is the word

1415
00:53:49,619 --> 00:53:51,480
I was looking for for custom Explorer so

1416
00:53:51,480 --> 00:53:52,740
thank you because Custer Explorer is

1417
00:53:52,740 --> 00:53:54,420
like internal Azure data Explorer is

1418
00:53:54,420 --> 00:53:55,500
what it is

1419
00:53:55,500 --> 00:53:57,480
um for you guys the other thing which is

1420
00:53:57,480 --> 00:53:59,579
really cool and I will put this in our

1421
00:53:59,579 --> 00:54:01,880
resources but if you go to

1422
00:54:01,880 --> 00:54:05,280
aka.msladen La demos

1423
00:54:05,280 --> 00:54:06,480
what

1424
00:54:06,480 --> 00:54:08,760
oh la demo

1425
00:54:08,760 --> 00:54:11,579
Longo just kidding just want to

1426
00:54:11,579 --> 00:54:13,079
um you can just play around it's like

1427
00:54:13,079 --> 00:54:14,940
it's basically a portal and Azure ad

1428
00:54:14,940 --> 00:54:16,380
space for you just to play around and

1429
00:54:16,380 --> 00:54:18,119
experiment with it's it's not attached

1430
00:54:18,119 --> 00:54:19,500
to any subscription or anything it's

1431
00:54:19,500 --> 00:54:21,180
just a demo environment so you guys can

1432
00:54:21,180 --> 00:54:22,559
play around

1433
00:54:22,559 --> 00:54:24,119
um with all of these different types of

1434
00:54:24,119 --> 00:54:27,119
logs they'll just be same sample data so

1435
00:54:27,119 --> 00:54:29,460
yeah now you guys can clap where as I'm

1436
00:54:29,460 --> 00:54:30,960
just kidding yay

1437
00:54:30,960 --> 00:54:33,480
we finished

1438
00:54:33,480 --> 00:54:36,119
with four seconds

1439
00:54:36,119 --> 00:54:38,640
oh yeah he just remembered I guess we're

1440
00:54:38,640 --> 00:54:40,740
not done last thing

1441
00:54:40,740 --> 00:54:43,799
if you guys want and if you can your

1442
00:54:43,799 --> 00:54:45,960
contribution would like really help to

1443
00:54:45,960 --> 00:54:47,520
the community it's just like an open

1444
00:54:47,520 --> 00:54:50,520
source community and it I I know I'm

1445
00:54:50,520 --> 00:54:51,960
showing you slides in this way but

1446
00:54:51,960 --> 00:54:55,619
you'll get over it very quickly so um

1447
00:54:55,619 --> 00:54:57,540
the Azure ID workbooks GitHub is

1448
00:54:57,540 --> 00:54:59,280
something anybody can join and then you

1449
00:54:59,280 --> 00:55:01,859
can submit your ideas you can create

1450
00:55:01,859 --> 00:55:03,480
your own workbook and submit it and it

1451
00:55:03,480 --> 00:55:04,920
could be even turned into one of the

1452
00:55:04,920 --> 00:55:07,740
templates you can provide feedback and

1453
00:55:07,740 --> 00:55:09,420
like say hey this is wrong or this is

1454
00:55:09,420 --> 00:55:11,099
way outdated like you guys need to

1455
00:55:11,099 --> 00:55:12,720
update this or you can also share your

1456
00:55:12,720 --> 00:55:14,040
tips and tricks like what you just said

1457
00:55:14,040 --> 00:55:14,819
like

1458
00:55:14,819 --> 00:55:17,280
I mean you obviously know kql very well

1459
00:55:17,280 --> 00:55:19,980
so please like tell us all those tips

1460
00:55:19,980 --> 00:55:21,420
and tricks and then

1461
00:55:21,420 --> 00:55:24,660
um in this AKA dot msk kql blue team

1462
00:55:24,660 --> 00:55:26,160
that's going to take you to the

1463
00:55:26,160 --> 00:55:27,720
repository where we're going to put

1464
00:55:27,720 --> 00:55:30,240
these slides we're also putting a ton of

1465
00:55:30,240 --> 00:55:31,500
resources that are really good we're

1466
00:55:31,500 --> 00:55:33,599
gonna We also recommend a few different

1467
00:55:33,599 --> 00:55:35,819
um kql tutorials that are done in

1468
00:55:35,819 --> 00:55:37,980
pluralsight so it'll be a lot of stuff

1469
00:55:37,980 --> 00:55:40,319
there for you and yeah

1470
00:55:40,319 --> 00:55:42,059
thank you thank you thank you for coming

1471
00:55:42,059 --> 00:55:43,920
to our little session and have a rest of

1472
00:55:43,920 --> 00:55:47,480
a great rest of your besides

1473
00:55:47,940 --> 00:55:50,240
foreign

1474
00:55:50,790 --> 00:55:53,940
[Applause]

