1
00:00:00,949 --> 00:00:08,220
<font color="#CCCCCC">we're</font><font color="#E5E5E5"> good</font><font color="#CCCCCC"> in the back thumbs-up cool</font><font color="#E5E5E5"> so</font>

2
00:00:06,330 --> 00:00:09,960
this<font color="#E5E5E5"> is detecting the elusive</font><font color="#CCCCCC"> Active</font>

3
00:00:08,220 --> 00:00:14,700
<font color="#CCCCCC">Directory</font><font color="#E5E5E5"> threat hunting and I am</font><font color="#CCCCCC"> Sean</font>

4
00:00:09,960 --> 00:00:16,710
<font color="#E5E5E5">Metcalfe at the founder Trimark security</font>

5
00:00:14,700 --> 00:00:17,849
company<font color="#E5E5E5"> a Microsoft Certified Master</font><font color="#CCCCCC"> in</font>

6
00:00:16,710 --> 00:00:19,740
Active Directory there's about a hundred

7
00:00:17,850 --> 00:00:21,810
<font color="#CCCCCC">in the world</font><font color="#E5E5E5"> I'm also a Microsoft MVP</font>

8
00:00:19,740 --> 00:00:23,250
<font color="#E5E5E5">I've spoken about Active Directory</font>

9
00:00:21,810 --> 00:00:25,470
attack and defense at a number<font color="#CCCCCC"> of</font>

10
00:00:23,250 --> 00:00:27,359
conferences and I'm security consultant

11
00:00:25,470 --> 00:00:29,279
researcher and as we just<font color="#CCCCCC"> found</font><font color="#E5E5E5"> out I</font>

12
00:00:27,359 --> 00:00:31,050
run<font color="#E5E5E5"> 80 security</font><font color="#CCCCCC"> org where I post a lot</font>

13
00:00:29,279 --> 00:00:35,070
<font color="#CCCCCC">of interesting security</font><font color="#E5E5E5"> information</font>

14
00:00:31,050 --> 00:00:36,390
<font color="#E5E5E5">about the Microsoft platform so what are</font>

15
00:00:35,070 --> 00:00:37,770
we going to<font color="#E5E5E5"> talk about so I call this</font>

16
00:00:36,390 --> 00:00:39,140
Active Directory threat hunting threat

17
00:00:37,770 --> 00:00:42,510
hunting has a lot of<font color="#E5E5E5"> different</font>

18
00:00:39,140 --> 00:00:45,480
<font color="#E5E5E5">connotations or ideas behind it but I</font>

19
00:00:42,510 --> 00:00:49,500
like to boil<font color="#CCCCCC"> that down to what really</font><font color="#E5E5E5"> do</font>

20
00:00:45,480 --> 00:00:52,288
we care<font color="#E5E5E5"> about we</font><font color="#CCCCCC"> used</font><font color="#E5E5E5"> to log the events</font>

21
00:00:49,500 --> 00:00:54,780
that will<font color="#CCCCCC"> actually detect unusual</font><font color="#E5E5E5"> or</font>

22
00:00:52,289 --> 00:00:57,059
malicious<font color="#E5E5E5"> or anomalous activity and flow</font>

23
00:00:54,780 --> 00:00:59,760
that<font color="#E5E5E5"> into our send tool whatever that</font>

24
00:00:57,059 --> 00:01:01,949
may be<font color="#CCCCCC"> and</font><font color="#E5E5E5"> then configure some sort of</font>

25
00:00:59,760 --> 00:01:03,030
<font color="#E5E5E5">alerting on that system</font><font color="#CCCCCC"> so that</font><font color="#E5E5E5"> we can</font>

26
00:01:01,949 --> 00:01:04,768
get the data<font color="#E5E5E5"> we</font><font color="#CCCCCC"> need to</font><font color="#E5E5E5"> figure out</font>

27
00:01:03,030 --> 00:01:06,689
<font color="#E5E5E5">what's going on so working backwards</font>

28
00:01:04,769 --> 00:01:10,229
from<font color="#E5E5E5"> that whether some of</font><font color="#CCCCCC"> the data</font>

29
00:01:06,689 --> 00:01:12,360
sources that we<font color="#CCCCCC"> actually need so we need</font>

30
00:01:10,229 --> 00:01:13,409
some<font color="#E5E5E5"> PowerShell logs to figure out</font>

31
00:01:12,360 --> 00:01:14,760
what's going<font color="#CCCCCC"> on with PowerShell cuz a</font>

32
00:01:13,409 --> 00:01:16,590
lot of attackers<font color="#E5E5E5"> are</font><font color="#CCCCCC"> doing PowerShell</font>

33
00:01:14,760 --> 00:01:17,970
<font color="#CCCCCC">they're obfuscating PowerShell so how do</font>

34
00:01:16,590 --> 00:01:20,670
we figure out<font color="#E5E5E5"> when they're doing that</font>

35
00:01:17,970 --> 00:01:21,780
<font color="#E5E5E5">and how do we look at</font><font color="#CCCCCC"> attacker activity</font>

36
00:01:20,670 --> 00:01:23,400
in Active Directory how are they moving

37
00:01:21,780 --> 00:01:24,630
around<font color="#E5E5E5"> how do we get information about</font>

38
00:01:23,400 --> 00:01:28,619
<font color="#E5E5E5">what they're doing</font><font color="#CCCCCC"> on Windows</font><font color="#E5E5E5"> systems</font>

39
00:01:24,630 --> 00:01:30,390
and how can<font color="#E5E5E5"> we detect a common attack</font>

40
00:01:28,619 --> 00:01:32,280
method called Kerberos<font color="#CCCCCC"> thing this</font><font color="#E5E5E5"> is</font>

41
00:01:30,390 --> 00:01:33,479
what we're going<font color="#CCCCCC"> to get</font><font color="#E5E5E5"> into so I'm</font>

42
00:01:32,280 --> 00:01:35,159
pretty<font color="#E5E5E5"> sure everyone's familiar with</font>

43
00:01:33,479 --> 00:01:36,750
something<font color="#E5E5E5"> like this right any sock</font>

44
00:01:35,159 --> 00:01:40,320
<font color="#CCCCCC">analysts</font><font color="#E5E5E5"> here any people that look at</font>

45
00:01:36,750 --> 00:01:41,610
these screens so<font color="#E5E5E5"> Han sorry so I'm sure</font>

46
00:01:40,320 --> 00:01:42,960
<font color="#CCCCCC">that when you get</font><font color="#E5E5E5"> in the morning and you</font>

47
00:01:41,610 --> 00:01:45,720
<font color="#E5E5E5">look at the screen you might as well be</font>

48
00:01:42,960 --> 00:01:48,809
looking<font color="#E5E5E5"> at this right</font><font color="#CCCCCC"> Where's</font><font color="#E5E5E5"> Wally</font><font color="#CCCCCC"> the</font>

49
00:01:45,720 --> 00:01:50,429
European version of Where's Waldo<font color="#E5E5E5"> this</font>

50
00:01:48,810 --> 00:01:52,799
is one<font color="#CCCCCC"> of the toughest wiley pictures</font>

51
00:01:50,430 --> 00:01:56,399
that<font color="#CCCCCC"> i've seen i thought this was</font><font color="#E5E5E5"> a good</font>

52
00:01:52,799 --> 00:01:59,040
<font color="#E5E5E5">metaphor we're looking at the event</font>

53
00:01:56,399 --> 00:02:00,840
<font color="#E5E5E5">alert data that our sim is flooding us</font>

54
00:01:59,040 --> 00:02:02,719
with<font color="#E5E5E5"> and we might as</font><font color="#CCCCCC"> well</font><font color="#E5E5E5"> be</font><font color="#CCCCCC"> looking at</font>

55
00:02:00,840 --> 00:02:05,549
this trying to<font color="#E5E5E5"> figure out where</font><font color="#CCCCCC"> Olly</font><font color="#E5E5E5"> is</font>

56
00:02:02,719 --> 00:02:10,199
how do we<font color="#E5E5E5"> detect the attacker among all</font>

57
00:02:05,549 --> 00:02:13,530
of the noise how do<font color="#E5E5E5"> we dig into this</font>

58
00:02:10,199 --> 00:02:16,799
well we need some pointers<font color="#CCCCCC"> we need to</font>

59
00:02:13,530 --> 00:02:24,420
help<font color="#E5E5E5"> so we need to go from this to</font><font color="#CCCCCC"> this</font>

60
00:02:16,800 --> 00:02:25,800
<font color="#CCCCCC">and ultimately ideally to this it's a</font>

61
00:02:24,420 --> 00:02:30,630
bit of a cheat<font color="#CCCCCC"> I think it's</font><font color="#E5E5E5"> just his</font>

62
00:02:25,800 --> 00:02:32,400
<font color="#E5E5E5">head right so we need to get to this</font>

63
00:02:30,630 --> 00:02:34,290
point<font color="#E5E5E5"> where</font><font color="#CCCCCC"> we can see exactly where the</font>

64
00:02:32,400 --> 00:02:35,910
<font color="#E5E5E5">attacker activity is or at least</font>

65
00:02:34,290 --> 00:02:37,470
something<font color="#E5E5E5"> that's completely unusual or</font>

66
00:02:35,910 --> 00:02:39,750
anomalous<font color="#E5E5E5"> in our environment so how do</font>

67
00:02:37,470 --> 00:02:41,100
we figure that<font color="#CCCCCC"> out oh</font><font color="#E5E5E5"> we've got to make</font>

68
00:02:39,750 --> 00:02:43,290
<font color="#E5E5E5">sure we're getting the</font><font color="#CCCCCC"> right data</font><font color="#E5E5E5"> like</font>

69
00:02:41,100 --> 00:02:45,750
<font color="#E5E5E5">it said PowerShell system security</font>

70
00:02:43,290 --> 00:02:48,390
events<font color="#CCCCCC"> there's specific</font><font color="#E5E5E5"> events that we</font>

71
00:02:45,750 --> 00:02:50,760
event IDs that we need is this logging

72
00:02:48,390 --> 00:02:54,208
data<font color="#E5E5E5"> properly flowing from our systems</font>

73
00:02:50,760 --> 00:02:57,769
into our<font color="#CCCCCC"> sim tool</font><font color="#E5E5E5"> and are we seeing</font>

74
00:02:54,209 --> 00:03:00,600
these events<font color="#E5E5E5"> so we have our sim tool</font>

75
00:02:57,769 --> 00:03:02,850
collecting it<font color="#E5E5E5"> is some sort of agent or</font>

76
00:03:00,600 --> 00:03:04,829
<font color="#E5E5E5">whatever that's sending it to there but</font>

77
00:03:02,850 --> 00:03:07,440
how do we<font color="#CCCCCC"> know if</font><font color="#E5E5E5"> those events stop</font>

78
00:03:04,830 --> 00:03:09,660
flowing from sources<font color="#E5E5E5"> how do we know when</font>

79
00:03:07,440 --> 00:03:12,150
those<font color="#E5E5E5"> events are no longer</font><font color="#CCCCCC"> coming from</font>

80
00:03:09,660 --> 00:03:13,560
systems that we expect them to and how

81
00:03:12,150 --> 00:03:15,750
do we correlate this<font color="#E5E5E5"> to</font><font color="#CCCCCC"> something that</font>

82
00:03:13,560 --> 00:03:17,610
is useful<font color="#E5E5E5"> how do we get the events that</font>

83
00:03:15,750 --> 00:03:20,130
we really need<font color="#E5E5E5"> to see or the alerts that</font>

84
00:03:17,610 --> 00:03:21,420
<font color="#E5E5E5">we need to see it all starts with what</font>

85
00:03:20,130 --> 00:03:23,609
is normal<font color="#CCCCCC"> right</font>

86
00:03:21,420 --> 00:03:26,429
have we<font color="#CCCCCC"> baselined our environment</font><font color="#E5E5E5"> do we</font>

87
00:03:23,610 --> 00:03:28,890
know what we would<font color="#CCCCCC"> expect</font><font color="#E5E5E5"> to see if we</font>

88
00:03:26,430 --> 00:03:31,680
have set up a<font color="#CCCCCC"> swung query and we get a</font>

89
00:03:28,890 --> 00:03:34,309
ton of data or results<font color="#CCCCCC"> in it how do we</font>

90
00:03:31,680 --> 00:03:37,230
filter<font color="#CCCCCC"> that down to what really matters</font>

91
00:03:34,310 --> 00:03:39,630
<font color="#E5E5E5">because we need to figure</font><font color="#CCCCCC"> this part out</font>

92
00:03:37,230 --> 00:03:41,670
<font color="#E5E5E5">in order</font><font color="#CCCCCC"> to figure this part out</font><font color="#E5E5E5"> we need</font>

93
00:03:39,630 --> 00:03:42,510
to<font color="#E5E5E5"> go from normal to anomalous the</font>

94
00:03:41,670 --> 00:03:44,760
unusual things

95
00:03:42,510 --> 00:03:48,500
the suspicious things the things that<font color="#CCCCCC"> we</font>

96
00:03:44,760 --> 00:03:48,500
know will<font color="#E5E5E5"> be bad in our environment</font><font color="#CCCCCC"> I</font>

97
00:03:48,920 --> 00:03:55,559
said I had<font color="#E5E5E5"> about five minutes of fluff</font>

98
00:03:51,480 --> 00:03:57,690
<font color="#CCCCCC">let's</font><font color="#E5E5E5"> move on to</font><font color="#CCCCCC"> the good</font><font color="#E5E5E5"> stuff</font><font color="#CCCCCC"> enabling</font>

99
00:03:55,560 --> 00:03:58,620
this logging provides<font color="#CCCCCC"> tremendous insight</font>

100
00:03:57,690 --> 00:04:01,890
<font color="#E5E5E5">know what's going on in your environment</font>

101
00:03:58,620 --> 00:04:05,120
but the logging is only step<font color="#CCCCCC"> one</font><font color="#E5E5E5"> we need</font>

102
00:04:01,890 --> 00:04:08,940
<font color="#CCCCCC">to flow</font><font color="#E5E5E5"> this data</font><font color="#CCCCCC"> into our sim</font><font color="#E5E5E5"> into our</font>

103
00:04:05,120 --> 00:04:10,799
central event management<font color="#E5E5E5"> system we want</font>

104
00:04:08,940 --> 00:04:12,750
to understand what kind<font color="#E5E5E5"> of command</font>

105
00:04:10,799 --> 00:04:14,519
prompt tools or<font color="#E5E5E5"> command-line tools are</font>

106
00:04:12,750 --> 00:04:16,829
being run<font color="#CCCCCC"> in our environment</font><font color="#E5E5E5"> we want to</font>

107
00:04:14,519 --> 00:04:18,959
see<font color="#E5E5E5"> PowerShell tools that</font><font color="#CCCCCC"> our PowerShell</font>

108
00:04:16,829 --> 00:04:21,390
commands that<font color="#E5E5E5"> are being run we want to</font>

109
00:04:18,959 --> 00:04:23,039
have a good<font color="#CCCCCC"> understanding</font><font color="#E5E5E5"> of what sort</font>

110
00:04:21,390 --> 00:04:25,440
of activity is there and blow it into

111
00:04:23,039 --> 00:04:27,169
<font color="#E5E5E5">our sensual because ultimately the</font>

112
00:04:25,440 --> 00:04:30,830
battle is being fought on our end

113
00:04:27,170 --> 00:04:32,270
our workstations<font color="#E5E5E5"> and most</font><font color="#CCCCCC"> organizations</font>

114
00:04:30,830 --> 00:04:37,219
are not<font color="#E5E5E5"> pulling events from their</font>

115
00:04:32,270 --> 00:04:38,570
workstations not if you agree<font color="#E5E5E5"> yeah see a</font>

116
00:04:37,220 --> 00:04:41,180
lot of<font color="#E5E5E5"> head</font><font color="#CCCCCC"> knives I won't have people</font>

117
00:04:38,570 --> 00:04:43,159
<font color="#E5E5E5">raise hands on that and so how do we get</font>

118
00:04:41,180 --> 00:04:45,290
the<font color="#CCCCCC"> data from</font><font color="#E5E5E5"> our workstations into our</font>

119
00:04:43,160 --> 00:04:46,760
sim<font color="#CCCCCC"> a lot</font><font color="#E5E5E5"> of times people</font><font color="#CCCCCC"> say I don't</font>

120
00:04:45,290 --> 00:04:49,430
want to push agents out to<font color="#CCCCCC"> all those</font>

121
00:04:46,760 --> 00:04:51,500
systems<font color="#CCCCCC"> I want to put</font><font color="#E5E5E5"> another agent on a</font>

122
00:04:49,430 --> 00:04:54,050
computer<font color="#E5E5E5"> that already has five or six</font>

123
00:04:51,500 --> 00:04:55,280
<font color="#CCCCCC">different agents because the users are</font>

124
00:04:54,050 --> 00:04:57,020
already<font color="#E5E5E5"> complaining about all</font><font color="#CCCCCC"> these</font>

125
00:04:55,280 --> 00:05:00,349
agents and<font color="#E5E5E5"> the contention for resources</font>

126
00:04:57,020 --> 00:05:02,870
<font color="#E5E5E5">that they already have so Microsoft web</font>

127
00:05:00,350 --> 00:05:05,890
is a great opportunity or a great tool

128
00:05:02,870 --> 00:05:08,720
<font color="#CCCCCC">to do that you don't need an agent and</font>

129
00:05:05,890 --> 00:05:10,729
definitely look in the<font color="#E5E5E5"> system on this</font>

130
00:05:08,720 --> 00:05:13,730
<font color="#CCCCCC">mahn is a good way to get enhanced</font>

131
00:05:10,730 --> 00:05:15,950
<font color="#E5E5E5">auditing of Windows system</font><font color="#CCCCCC"> activity</font><font color="#E5E5E5"> and</font>

132
00:05:13,730 --> 00:05:17,750
so with system on it's part of<font color="#CCCCCC"> the</font>

133
00:05:15,950 --> 00:05:20,270
sysinternals suite that Microsoft bought

134
00:05:17,750 --> 00:05:22,760
a<font color="#E5E5E5"> number of years ago about the company</font>

135
00:05:20,270 --> 00:05:24,620
bought mark russinovich is one of the

136
00:05:22,760 --> 00:05:26,120
founders they brought him in made him a

137
00:05:24,620 --> 00:05:26,660
technical fellow he's now<font color="#E5E5E5"> the CTO of</font>

138
00:05:26,120 --> 00:05:30,950
<font color="#E5E5E5">Azure</font>

139
00:05:26,660 --> 00:05:32,990
<font color="#CCCCCC">and Microsoft but there's an install</font>

140
00:05:30,950 --> 00:05:34,940
that configures a Windows service<font color="#E5E5E5"> with a</font>

141
00:05:32,990 --> 00:05:37,280
device<font color="#CCCCCC"> driver for</font><font color="#E5E5E5"> 32 and 64-bit versions</font>

142
00:05:34,940 --> 00:05:39,170
<font color="#CCCCCC">of Windows</font><font color="#E5E5E5"> and the configuration</font><font color="#CCCCCC"> is</font>

143
00:05:37,280 --> 00:05:40,789
stored in the registry<font color="#CCCCCC"> but effectively</font>

144
00:05:39,170 --> 00:05:42,500
<font color="#E5E5E5">there's some key</font><font color="#CCCCCC"> components</font><font color="#E5E5E5"> that it</font>

145
00:05:40,790 --> 00:05:46,370
monitors<font color="#CCCCCC"> and there's a number of things</font>

146
00:05:42,500 --> 00:05:48,530
here<font color="#CCCCCC"> like process activity with hashes</font>

147
00:05:46,370 --> 00:05:51,290
image load driver loads<font color="#E5E5E5"> file creation</font>

148
00:05:48,530 --> 00:05:52,369
<font color="#E5E5E5">time changes network connections so this</font>

149
00:05:51,290 --> 00:05:54,860
is the one that<font color="#E5E5E5"> I</font><font color="#CCCCCC"> would</font><font color="#E5E5E5"> like</font><font color="#CCCCCC"> about</font>

150
00:05:52,370 --> 00:05:58,010
system on is network connections we can

151
00:05:54,860 --> 00:06:02,440
<font color="#CCCCCC">also look for injection into win logon</font>

152
00:05:58,010 --> 00:06:05,480
and<font color="#E5E5E5"> else ask we can look at raw disk</font>

153
00:06:02,440 --> 00:06:07,340
pulls from<font color="#CCCCCC"> the from that from the file</font>

154
00:06:05,480 --> 00:06:10,280
system<font color="#CCCCCC"> so for example invoke</font><font color="#E5E5E5"> ninja</font><font color="#CCCCCC"> your</font>

155
00:06:07,340 --> 00:06:12,200
copy is a PowerShell tool<font color="#CCCCCC"> power sploit</font>

156
00:06:10,280 --> 00:06:14,119
<font color="#E5E5E5">tool they can actually pull the NCVS</font>

157
00:06:12,200 --> 00:06:15,740
<font color="#E5E5E5">that</font><font color="#CCCCCC"> file off the main controller while</font>

158
00:06:14,120 --> 00:06:17,930
it's running<font color="#E5E5E5"> because it's doing raw</font>

159
00:06:15,740 --> 00:06:20,540
access reads off of that<font color="#E5E5E5"> denied</font><font color="#CCCCCC"> file</font>

160
00:06:17,930 --> 00:06:22,610
<font color="#CCCCCC">system</font><font color="#E5E5E5"> but like I</font><font color="#CCCCCC"> said I</font><font color="#E5E5E5"> really like</font>

161
00:06:20,540 --> 00:06:24,320
<font color="#E5E5E5">looking</font><font color="#CCCCCC"> at system</font><font color="#E5E5E5"> on for what</font>

162
00:06:22,610 --> 00:06:25,910
applications are<font color="#CCCCCC"> actually connecting on</font>

163
00:06:24,320 --> 00:06:28,070
the network<font color="#E5E5E5"> which ones are connected to</font>

164
00:06:25,910 --> 00:06:31,550
the<font color="#E5E5E5"> internet because things like notepad</font>

165
00:06:28,070 --> 00:06:33,260
probably shouldn't and we<font color="#CCCCCC"> want to ignore</font>

166
00:06:31,550 --> 00:06:36,279
most of<font color="#E5E5E5"> the Microsoft signed image loads</font>

167
00:06:33,260 --> 00:06:39,579
<font color="#E5E5E5">there are some exceptions</font>

168
00:06:36,279 --> 00:06:41,589
so Casey Smith aka<font color="#CCCCCC"> subti has identified</font>

169
00:06:39,579 --> 00:06:43,439
a number of Microsoft signed binaries

170
00:06:41,589 --> 00:06:46,739
<font color="#CCCCCC">they do some very interesting things</font>

171
00:06:43,439 --> 00:06:49,359
<font color="#E5E5E5">some of these actually enable you to</font>

172
00:06:46,739 --> 00:06:50,438
connect<font color="#E5E5E5"> to the</font><font color="#CCCCCC"> internet pull</font><font color="#E5E5E5"> down code</font>

173
00:06:49,359 --> 00:06:52,948
and execute<font color="#E5E5E5"> it</font>

174
00:06:50,439 --> 00:06:55,389
this<font color="#E5E5E5"> bypasses whitelisting and</font>

175
00:06:52,949 --> 00:06:57,369
<font color="#E5E5E5">oftentimes</font><font color="#CCCCCC"> the attacker doesn't</font><font color="#E5E5E5"> need to</font>

176
00:06:55,389 --> 00:07:02,259
use PowerShell<font color="#CCCCCC"> or any other command line</font>

177
00:06:57,369 --> 00:07:04,239
facility because of these tools<font color="#E5E5E5"> so with</font>

178
00:07:02,259 --> 00:07:07,239
this<font color="#CCCCCC"> mahn we go ahead and run the top</font>

179
00:07:04,239 --> 00:07:08,558
command we<font color="#CCCCCC"> can push it out</font><font color="#E5E5E5"> via group for</font>

180
00:07:07,239 --> 00:07:14,018
<font color="#CCCCCC">policy we can push</font><font color="#E5E5E5"> it out via your</font>

181
00:07:08,559 --> 00:07:15,399
standard application<font color="#CCCCCC"> point and tool we</font>

182
00:07:14,019 --> 00:07:19,389
can<font color="#E5E5E5"> look at the configuration using</font>

183
00:07:15,399 --> 00:07:21,219
system on<font color="#E5E5E5"> -</font><font color="#CCCCCC"> C but we want to</font><font color="#E5E5E5"> know where</font>

184
00:07:19,389 --> 00:07:22,959
<font color="#E5E5E5">Swiper is right we want to know when</font>

185
00:07:21,219 --> 00:07:25,058
he's sneaking around what is what is

186
00:07:22,959 --> 00:07:27,119
<font color="#CCCCCC">happening what's going on so it's this</font>

187
00:07:25,059 --> 00:07:30,699
<font color="#CCCCCC">Mon we can get an event</font><font color="#E5E5E5"> like this</font>

188
00:07:27,119 --> 00:07:33,129
<font color="#E5E5E5">notepad connected to the network</font><font color="#CCCCCC"> they</font>

189
00:07:30,699 --> 00:07:37,539
connected<font color="#E5E5E5"> to destination 1</font><font color="#CCCCCC"> v</font><font color="#E5E5E5"> 1 dot</font><font color="#CCCCCC"> 101</font>

190
00:07:33,129 --> 00:07:38,949
<font color="#CCCCCC">32 that</font><font color="#E5E5E5"> 1</font><font color="#CCCCCC"> 3</font><font color="#E5E5E5"> 3 that's interesting</font><font color="#CCCCCC"> that's</font>

191
00:07:37,539 --> 00:07:42,759
<font color="#E5E5E5">on the internet if I on my internal</font>

192
00:07:38,949 --> 00:07:45,099
network<font color="#E5E5E5"> I'm a 10 dot this actually</font>

193
00:07:42,759 --> 00:07:48,009
resolves to<font color="#E5E5E5"> rod at github user content</font>

194
00:07:45,099 --> 00:07:51,248
<font color="#CCCCCC">comm and in this instance</font><font color="#E5E5E5"> I reached out</font>

195
00:07:48,009 --> 00:07:53,409
and using notepad<font color="#CCCCCC"> I connected</font><font color="#E5E5E5"> to github</font>

196
00:07:51,249 --> 00:07:56,199
<font color="#E5E5E5">and I opened up invoke mimikatz</font><font color="#CCCCCC"> in</font>

197
00:07:53,409 --> 00:07:57,729
notepad<font color="#CCCCCC"> now I could go through modify</font>

198
00:07:56,199 --> 00:07:59,259
that and<font color="#CCCCCC"> I could save it somewhere and</font>

199
00:07:57,729 --> 00:08:00,849
run it or figure out<font color="#E5E5E5"> a number</font><font color="#CCCCCC"> of</font>

200
00:07:59,259 --> 00:08:03,219
<font color="#CCCCCC">different ways execute</font><font color="#E5E5E5"> on the system</font>

201
00:08:00,849 --> 00:08:04,389
without<font color="#E5E5E5"> something that's monitoring what</font>

202
00:08:03,219 --> 00:08:05,739
applications are connecting<font color="#E5E5E5"> to the</font>

203
00:08:04,389 --> 00:08:09,639
network<font color="#E5E5E5"> you're probably going to miss</font>

204
00:08:05,739 --> 00:08:12,248
this<font color="#CCCCCC"> so when there's a vent forwarding I</font>

205
00:08:09,639 --> 00:08:13,779
mentioned it a<font color="#E5E5E5"> little bit ago it's</font>

206
00:08:12,249 --> 00:08:17,939
critical<font color="#E5E5E5"> to get our</font><font color="#CCCCCC"> workstation logs</font>

207
00:08:13,779 --> 00:08:20,049
into<font color="#E5E5E5"> our</font><font color="#CCCCCC"> SEM and how do we</font><font color="#E5E5E5"> get them</font>

208
00:08:17,939 --> 00:08:22,649
Microsoft has<font color="#CCCCCC"> this</font><font color="#E5E5E5"> built into Windows</font>

209
00:08:20,049 --> 00:08:26,169
there's no agent so it uses<font color="#CCCCCC"> win RM</font>

210
00:08:22,649 --> 00:08:27,909
Kerberos in order to pull that<font color="#E5E5E5"> data back</font>

211
00:08:26,169 --> 00:08:29,948
<font color="#E5E5E5">you can configure a Windows Event</font>

212
00:08:27,909 --> 00:08:31,449
collector on a server<font color="#CCCCCC"> or technically</font><font color="#E5E5E5"> a</font>

213
00:08:29,949 --> 00:08:34,149
workstation I would use a server and

214
00:08:31,449 --> 00:08:36,610
<font color="#E5E5E5">then</font><font color="#CCCCCC"> use group policy to configure</font><font color="#E5E5E5"> your</font>

215
00:08:34,149 --> 00:08:40,000
clients to send their<font color="#E5E5E5"> events there you</font>

216
00:08:36,610 --> 00:08:41,889
don't<font color="#E5E5E5"> need all of them 10 to 20 event</font>

217
00:08:40,000 --> 00:08:44,740
IDs getting this information

218
00:08:41,889 --> 00:08:46,120
<font color="#E5E5E5">specifically for PowerShell and specific</font>

219
00:08:44,740 --> 00:08:48,309
events that I'm going<font color="#E5E5E5"> to mention in a</font>

220
00:08:46,120 --> 00:08:49,630
bit<font color="#E5E5E5"> will give you tremendous insight</font>

221
00:08:48,309 --> 00:08:51,160
into what's going<font color="#E5E5E5"> on</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> your environment</font>

222
00:08:49,630 --> 00:08:52,660
especially in<font color="#E5E5E5"> your workstations now</font>

223
00:08:51,160 --> 00:08:55,240
there is a bit<font color="#CCCCCC"> of an initial learning</font>

224
00:08:52,660 --> 00:08:58,780
<font color="#E5E5E5">curve</font><font color="#CCCCCC"> there's a great reference here at</font>

225
00:08:55,240 --> 00:09:00,610
the bottom<font color="#E5E5E5"> a</font><font color="#CCCCCC"> KMS</font><font color="#E5E5E5"> slash</font><font color="#CCCCCC"> way</font><font color="#E5E5E5"> on some</font>

226
00:08:58,780 --> 00:09:03,010
pointers on<font color="#E5E5E5"> how to configure</font><font color="#CCCCCC"> whack in</font>

227
00:09:00,610 --> 00:09:05,350
your<font color="#E5E5E5"> environment it is so when you</font>

228
00:09:03,010 --> 00:09:07,750
<font color="#CCCCCC">configure a</font><font color="#E5E5E5"> web collector you can point</font>

229
00:09:05,350 --> 00:09:10,030
your clients to one web collector but

230
00:09:07,750 --> 00:09:15,730
there's not any<font color="#E5E5E5"> load balancing on that</font>

231
00:09:10,030 --> 00:09:18,430
or fault<font color="#E5E5E5"> tolerance yes so let's talk</font>

232
00:09:15,730 --> 00:09:20,380
about<font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> we know that attackers</font>

233
00:09:18,430 --> 00:09:21,729
<font color="#CCCCCC">are using PowerShell they're doing a</font><font color="#E5E5E5"> lot</font>

234
00:09:20,380 --> 00:09:23,110
<font color="#CCCCCC">of</font><font color="#E5E5E5"> interesting</font><font color="#CCCCCC"> things with PowerShell so</font>

235
00:09:21,730 --> 00:09:24,730
we need a log<font color="#CCCCCC"> powershell and</font><font color="#E5E5E5"> see what's</font>

236
00:09:23,110 --> 00:09:26,530
going<font color="#E5E5E5"> on</font><font color="#CCCCCC"> because this</font><font color="#E5E5E5"> is what they're</font>

237
00:09:24,730 --> 00:09:28,240
<font color="#CCCCCC">doing</font><font color="#E5E5E5"> they're sending out these</font>

238
00:09:26,530 --> 00:09:31,150
malicious Word documents that have

239
00:09:28,240 --> 00:09:32,740
macros these macros are running

240
00:09:31,150 --> 00:09:39,069
PowerShell code<font color="#E5E5E5"> or doing other things on</font>

241
00:09:32,740 --> 00:09:41,290
the system because macros are code<font color="#E5E5E5"> third</font>

242
00:09:39,070 --> 00:09:43,090
<font color="#E5E5E5">party code from untrusted sources</font>

243
00:09:41,290 --> 00:09:46,120
running on your network<font color="#E5E5E5"> running on your</font>

244
00:09:43,090 --> 00:09:49,420
gear systems this gives an attacker

245
00:09:46,120 --> 00:09:51,940
initial foothold well the last document

246
00:09:49,420 --> 00:09:53,770
<font color="#CCCCCC">I showed you</font><font color="#E5E5E5"> isn't that interesting from</font>

247
00:09:51,940 --> 00:09:55,750
a perspective of I wouldn't click on

248
00:09:53,770 --> 00:09:57,939
<font color="#E5E5E5">that or why</font><font color="#CCCCCC"> would I click on that</font><font color="#E5E5E5"> but</font>

249
00:09:55,750 --> 00:09:59,800
what about<font color="#CCCCCC"> one of these</font><font color="#E5E5E5"> what about the</font>

250
00:09:57,940 --> 00:10:01,330
one<font color="#E5E5E5"> that says is protected by McAfee or</font>

251
00:09:59,800 --> 00:10:04,329
the one that<font color="#CCCCCC"> says it's confidential with</font>

252
00:10:01,330 --> 00:10:06,130
the<font color="#E5E5E5"> DocuSign logo on it or the one that</font>

253
00:10:04,330 --> 00:10:09,100
<font color="#E5E5E5">says</font><font color="#CCCCCC"> Microsoft Office</font><font color="#E5E5E5"> Enterprise</font>

254
00:10:06,130 --> 00:10:10,570
<font color="#CCCCCC">Protection or the one that says office</font>

255
00:10:09,100 --> 00:10:14,260
365 and<font color="#CCCCCC"> Proofpoint</font>

256
00:10:10,570 --> 00:10:16,480
these are fairly compelling<font color="#E5E5E5"> and it's</font>

257
00:10:14,260 --> 00:10:18,400
<font color="#E5E5E5">likely that many of your users would</font>

258
00:10:16,480 --> 00:10:21,250
click<font color="#CCCCCC"> on enable</font><font color="#E5E5E5"> content when</font><font color="#CCCCCC"> they got</font>

259
00:10:18,400 --> 00:10:24,010
one<font color="#E5E5E5"> of these these are</font><font color="#CCCCCC"> in the wild these</font>

260
00:10:21,250 --> 00:10:26,470
are live samples of what attackers are

261
00:10:24,010 --> 00:10:28,300
using we can't<font color="#E5E5E5"> blame the users for</font>

262
00:10:26,470 --> 00:10:30,310
opening these if you're in finance<font color="#E5E5E5"> or</font>

263
00:10:28,300 --> 00:10:32,229
sorry contracts<font color="#E5E5E5"> and you get a</font><font color="#CCCCCC"> document</font>

264
00:10:30,310 --> 00:10:34,089
like this<font color="#CCCCCC"> as</font><font color="#E5E5E5"> DocuSign confidential</font>

265
00:10:32,230 --> 00:10:35,380
encrypted they're probably going to open

266
00:10:34,090 --> 00:10:37,600
it<font color="#CCCCCC"> because a lot of contracts using</font>

267
00:10:35,380 --> 00:10:39,460
DocuSign<font color="#E5E5E5"> why they're getting a word</font>

268
00:10:37,600 --> 00:10:41,890
document via<font color="#E5E5E5"> email I don't know but</font>

269
00:10:39,460 --> 00:10:44,320
people<font color="#CCCCCC"> are busy</font><font color="#E5E5E5"> they have</font><font color="#CCCCCC"> a job to</font><font color="#E5E5E5"> get</font>

270
00:10:41,890 --> 00:10:48,370
home<font color="#E5E5E5"> we need to better control macros in</font>

271
00:10:44,320 --> 00:10:50,560
our environment<font color="#E5E5E5"> though even if we do</font>

272
00:10:48,370 --> 00:10:53,530
control macros<font color="#E5E5E5"> we need to make</font><font color="#CCCCCC"> sure</font><font color="#E5E5E5"> that</font>

273
00:10:50,560 --> 00:10:57,219
we're controlling Oly Oly is a way to

274
00:10:53,530 --> 00:11:00,250
embed<font color="#CCCCCC"> an</font><font color="#E5E5E5"> object that can that includes</font>

275
00:10:57,220 --> 00:11:02,080
code into an email<font color="#E5E5E5"> so when the user</font>

276
00:11:00,250 --> 00:11:03,720
double clicks on it<font color="#E5E5E5"> and opens it</font><font color="#CCCCCC"> it</font>

277
00:11:02,080 --> 00:11:05,579
actually<font color="#CCCCCC"> X cubes</font>

278
00:11:03,720 --> 00:11:07,860
it looks<font color="#E5E5E5"> like a word document</font><font color="#CCCCCC"> but it's</font>

279
00:11:05,579 --> 00:11:09,479
really<font color="#E5E5E5"> cold we can disable this and</font>

280
00:11:07,860 --> 00:11:10,619
<font color="#CCCCCC">Outlook via Reggie and I have a</font><font color="#E5E5E5"> URL at</font>

281
00:11:09,480 --> 00:11:12,119
the bottom<font color="#E5E5E5"> by the way all these slides</font>

282
00:11:10,619 --> 00:11:14,339
will be available probably<font color="#CCCCCC"> tonight or</font>

283
00:11:12,119 --> 00:11:17,189
tomorrow on<font color="#CCCCCC"> AV security org or on</font>

284
00:11:14,339 --> 00:11:19,550
<font color="#E5E5E5">Trimark security</font><font color="#CCCCCC"> comm so I have a link</font>

285
00:11:17,189 --> 00:11:23,748
<font color="#E5E5E5">at the last slide</font><font color="#CCCCCC"> that where the</font>

286
00:11:19,550 --> 00:11:26,008
presentation will be so module<font color="#E5E5E5"> logging</font>

287
00:11:23,749 --> 00:11:28,619
who's got PowerShell module logging

288
00:11:26,009 --> 00:11:30,689
enabled<font color="#E5E5E5"> or some sort</font><font color="#CCCCCC"> of power</font><font color="#E5E5E5"> so log</font><font color="#CCCCCC"> ok</font>

289
00:11:28,619 --> 00:11:32,429
a few<font color="#CCCCCC"> and that's typically what</font><font color="#E5E5E5"> we</font><font color="#CCCCCC"> see</font>

290
00:11:30,689 --> 00:11:33,779
with<font color="#CCCCCC"> our customers is there's a handful</font>

291
00:11:32,429 --> 00:11:35,279
<font color="#E5E5E5">of people</font><font color="#CCCCCC"> that are logging power shut</font>

292
00:11:33,779 --> 00:11:36,929
you definitely want a log<font color="#CCCCCC"> powershell</font>

293
00:11:35,279 --> 00:11:38,459
because again this<font color="#E5E5E5"> is where this is what</font>

294
00:11:36,929 --> 00:11:39,959
attackers<font color="#CCCCCC"> you're using they love</font>

295
00:11:38,459 --> 00:11:42,719
<font color="#E5E5E5">PowerShell PowerShell gives them</font>

296
00:11:39,959 --> 00:11:45,689
tremendous capability<font color="#CCCCCC"> without a whole</font>

297
00:11:42,720 --> 00:11:47,249
<font color="#CCCCCC">lot of issues or compatibility concerns</font>

298
00:11:45,689 --> 00:11:49,309
<font color="#E5E5E5">because pretty much all versions of</font>

299
00:11:47,249 --> 00:11:52,679
Windows now have<font color="#E5E5E5"> power</font><font color="#CCCCCC"> Charlotte</font>

300
00:11:49,309 --> 00:11:53,730
slogging is enhanced in v4<font color="#CCCCCC"> you need b3</font>

301
00:11:52,679 --> 00:11:55,679
in order to get PowerShell module

302
00:11:53,730 --> 00:11:57,720
logging but PowerShell version 5 is

303
00:11:55,679 --> 00:11:59,309
<font color="#E5E5E5">really worth that</font><font color="#CCCCCC"> if you definitely want</font>

304
00:11:57,720 --> 00:12:01,170
<font color="#CCCCCC">to deploy</font><font color="#E5E5E5"> a PowerShell</font><font color="#CCCCCC"> version 5 on all</font>

305
00:11:59,309 --> 00:12:03,689
your workstations<font color="#E5E5E5"> 110 has it built in</font>

306
00:12:01,170 --> 00:12:05,009
<font color="#E5E5E5">and look to deploy it on your servers</font>

307
00:12:03,689 --> 00:12:08,069
because<font color="#E5E5E5"> we have something</font><font color="#CCCCCC"> called script</font>

308
00:12:05,009 --> 00:12:10,589
lock logging which basically logs<font color="#E5E5E5"> the</font>

309
00:12:08,069 --> 00:12:12,748
<font color="#E5E5E5">smallest component of a</font><font color="#CCCCCC"> PowerShell</font>

310
00:12:10,589 --> 00:12:16,319
script<font color="#E5E5E5"> that PowerShell script block and</font>

311
00:12:12,749 --> 00:12:18,839
in doing<font color="#CCCCCC"> so</font><font color="#E5E5E5"> it can actually provide some</font>

312
00:12:16,319 --> 00:12:20,849
<font color="#E5E5E5">more information about what</font><font color="#CCCCCC"> the code is</font>

313
00:12:18,839 --> 00:12:22,110
<font color="#E5E5E5">and what it's trying</font><font color="#CCCCCC"> to do because</font>

314
00:12:20,850 --> 00:12:23,309
<font color="#E5E5E5">that's effectively the code that's</font>

315
00:12:22,110 --> 00:12:25,799
delivered<font color="#CCCCCC"> to the engine to</font><font color="#E5E5E5"> be</font>

316
00:12:23,309 --> 00:12:28,790
interpreted<font color="#E5E5E5"> to be executed so a lot</font><font color="#CCCCCC"> of</font>

317
00:12:25,799 --> 00:12:30,809
the older style obfuscation<font color="#E5E5E5"> gets removed</font>

318
00:12:28,790 --> 00:12:32,339
before<font color="#E5E5E5"> it gets lost</font>

319
00:12:30,809 --> 00:12:34,379
whereas with module logging you might

320
00:12:32,339 --> 00:12:35,639
get a<font color="#E5E5E5"> lot of that propagation probably</font>

321
00:12:34,379 --> 00:12:37,470
wouldn't get a<font color="#E5E5E5"> lot of good insight</font>

322
00:12:35,639 --> 00:12:39,600
<font color="#CCCCCC">system-wide transcripts are pretty</font>

323
00:12:37,470 --> 00:12:41,730
impressive<font color="#CCCCCC"> and and I</font><font color="#E5E5E5"> think very</font><font color="#CCCCCC"> useful</font>

324
00:12:39,600 --> 00:12:43,589
because what you do<font color="#E5E5E5"> is you set up a</font>

325
00:12:41,730 --> 00:12:45,929
share on<font color="#CCCCCC"> your network a write one share</font>

326
00:12:43,589 --> 00:12:48,089
so<font color="#E5E5E5"> that the system's whenever someone</font>

327
00:12:45,929 --> 00:12:49,819
runs<font color="#CCCCCC"> anything from PowerShell</font><font color="#E5E5E5"> it gets</font>

328
00:12:48,089 --> 00:12:53,819
<font color="#E5E5E5">logged to a system-wide transcript file</font>

329
00:12:49,819 --> 00:12:56,179
<font color="#CCCCCC">onto that system onto that shit into</font>

330
00:12:53,819 --> 00:12:58,889
that<font color="#CCCCCC"> files because put on</font><font color="#E5E5E5"> that share and</font>

331
00:12:56,179 --> 00:13:00,749
you<font color="#E5E5E5"> can pull the data</font><font color="#CCCCCC"> from that share</font>

332
00:12:58,889 --> 00:13:02,220
from<font color="#E5E5E5"> this transcript files so you can</font>

333
00:13:00,749 --> 00:13:04,679
actually see what the<font color="#E5E5E5"> person</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> typing</font>

334
00:13:02,220 --> 00:13:08,490
and running in in<font color="#E5E5E5"> that transcript file</font>

335
00:13:04,679 --> 00:13:10,249
<font color="#CCCCCC">I've found interesting</font><font color="#E5E5E5"> activity in the</font>

336
00:13:08,490 --> 00:13:13,740
transcript file that I could not find

337
00:13:10,249 --> 00:13:16,860
within<font color="#E5E5E5"> the event law or within the bench</font>

338
00:13:13,740 --> 00:13:20,379
<font color="#CCCCCC">that were</font><font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> event phone systems</font>

339
00:13:16,860 --> 00:13:23,500
<font color="#E5E5E5">anti-malware the anti-malware system</font>

340
00:13:20,379 --> 00:13:26,769
<font color="#E5E5E5">integration</font><font color="#CCCCCC"> from scan interface MSI and</font>

341
00:13:23,500 --> 00:13:30,699
Windows 10<font color="#E5E5E5"> is really great</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> is a</font>

342
00:13:26,769 --> 00:13:33,220
tool that<font color="#CCCCCC"> provides the capability to on</font>

343
00:13:30,699 --> 00:13:34,779
a Windows 10 system<font color="#E5E5E5"> when someone runs</font>

344
00:13:33,220 --> 00:13:37,300
PowerShell code<font color="#E5E5E5"> be it in memory</font>

345
00:13:34,779 --> 00:13:40,689
<font color="#CCCCCC">downloaded</font><font color="#E5E5E5"> from the internet</font><font color="#CCCCCC"> file on the</font>

346
00:13:37,300 --> 00:13:42,180
system<font color="#E5E5E5"> or just typed in manually when it</font>

347
00:13:40,689 --> 00:13:44,199
gets delivered to<font color="#E5E5E5"> the PowerShell engine</font>

348
00:13:42,180 --> 00:13:46,120
PowerShell actually kicks it over<font color="#E5E5E5"> to a</font>

349
00:13:44,199 --> 00:13:48,310
<font color="#E5E5E5">MSI and then there's a registered</font>

350
00:13:46,120 --> 00:13:51,850
anti-malware solution that supports

351
00:13:48,310 --> 00:13:53,739
<font color="#CCCCCC">amasai it can give</font><font color="#E5E5E5"> MC a thumbs-up or</font>

352
00:13:51,850 --> 00:13:56,500
<font color="#CCCCCC">thumbs-down it's two thumbs down the</font>

353
00:13:53,740 --> 00:13:58,839
<font color="#E5E5E5">PowerShell engine will not run it this</font>

354
00:13:56,500 --> 00:14:01,930
works for<font color="#CCCCCC"> all of</font><font color="#E5E5E5"> the PowerShell</font>

355
00:13:58,839 --> 00:14:06,910
scripting supported scripting tools so<font color="#E5E5E5"> C</font>

356
00:14:01,930 --> 00:14:08,829
script jscript<font color="#CCCCCC"> wsh</font><font color="#E5E5E5"> VB script if the</font>

357
00:14:06,910 --> 00:14:14,230
anti-malware solution understands that

358
00:14:08,829 --> 00:14:17,109
and<font color="#E5E5E5"> is watching</font><font color="#CCCCCC"> the ansi event flow then</font>

359
00:14:14,230 --> 00:14:19,000
it can be<font color="#E5E5E5"> blocked here's the problem</font>

360
00:14:17,110 --> 00:14:23,560
<font color="#E5E5E5">though our vendors are not listening</font>

361
00:14:19,000 --> 00:14:24,759
<font color="#CCCCCC">they don't seem to</font><font color="#E5E5E5"> care please please</font>

362
00:14:23,560 --> 00:14:26,768
please reach out to<font color="#CCCCCC"> your antivirus</font>

363
00:14:24,759 --> 00:14:28,810
<font color="#E5E5E5">vendor and say we</font><font color="#CCCCCC"> are</font><font color="#E5E5E5"> going to be</font>

364
00:14:26,769 --> 00:14:31,660
deploying<font color="#E5E5E5"> Windows 10 we want you to</font>

365
00:14:28,810 --> 00:14:33,758
support Amazon Microsoft Defender

366
00:14:31,660 --> 00:14:36,750
supports it<font color="#E5E5E5"> and AVG is onboard</font>

367
00:14:33,759 --> 00:14:41,980
ESET is<font color="#E5E5E5"> onboard</font><font color="#CCCCCC"> as well the big ones</font>

368
00:14:36,750 --> 00:14:44,889
<font color="#E5E5E5">they say we do memory scraping</font><font color="#CCCCCC"> ok</font><font color="#E5E5E5"> that's</font>

369
00:14:41,980 --> 00:14:47,290
nice but how do<font color="#CCCCCC"> you know you're</font><font color="#E5E5E5"> not</font>

370
00:14:44,889 --> 00:14:51,880
missing something<font color="#CCCCCC"> and you're letting it</font>

371
00:14:47,290 --> 00:14:54,399
run and<font color="#E5E5E5"> so you can block</font><font color="#CCCCCC"> it so with</font>

372
00:14:51,880 --> 00:14:55,420
PowerShell<font color="#CCCCCC"> a lot of customers say you</font>

373
00:14:54,399 --> 00:14:56,620
know what we're just<font color="#E5E5E5"> going to block</font>

374
00:14:55,420 --> 00:14:58,750
PowerShell and<font color="#E5E5E5"> that way we won't have to</font>

375
00:14:56,620 --> 00:15:00,279
worry<font color="#E5E5E5"> about it wow there's some benefits</font>

376
00:14:58,750 --> 00:15:02,230
and actually locking PowerShell down

377
00:15:00,279 --> 00:15:05,980
PowerShell<font color="#E5E5E5"> dot exe down so that way</font>

378
00:15:02,230 --> 00:15:08,019
<font color="#E5E5E5">potentially code won't run but let's</font>

379
00:15:05,980 --> 00:15:10,949
<font color="#E5E5E5">talk</font><font color="#CCCCCC"> about running PowerShell code from</font>

380
00:15:08,019 --> 00:15:13,809
an executable from a compiled binary

381
00:15:10,949 --> 00:15:16,269
because<font color="#E5E5E5"> Microsoft provides this nice</font>

382
00:15:13,809 --> 00:15:19,209
script<font color="#E5E5E5"> code here on the right on</font><font color="#CCCCCC"> MSDN on</font>

383
00:15:16,269 --> 00:15:22,059
how to execute power shell code from an

384
00:15:19,209 --> 00:15:23,619
executable<font color="#E5E5E5"> and then</font><font color="#CCCCCC"> ten</font><font color="#E5E5E5"> actually put out</font>

385
00:15:22,059 --> 00:15:25,389
it so we'll call that<font color="#E5E5E5"> PowerShell it</font>

386
00:15:23,620 --> 00:15:29,110
looks like PowerShell<font color="#E5E5E5"> the PowerShell</font>

387
00:15:25,389 --> 00:15:30,280
console but it's<font color="#E5E5E5"> MPs</font><font color="#CCCCCC"> that exe and it</font>

388
00:15:29,110 --> 00:15:32,680
just calls the PowerShell

389
00:15:30,280 --> 00:15:35,500
<font color="#E5E5E5">then runs</font><font color="#CCCCCC"> powerful clothes and</font><font color="#E5E5E5"> we can do</font>

390
00:15:32,680 --> 00:15:37,660
<font color="#E5E5E5">this from a dotnet executable</font><font color="#CCCCCC"> or any dot</font>

391
00:15:35,500 --> 00:15:39,640
through net<font color="#E5E5E5"> within from any executable</font>

392
00:15:37,660 --> 00:15:42,550
<font color="#E5E5E5">using powershell PS equals powershell</font>

393
00:15:39,640 --> 00:15:45,310
create the tool<font color="#CCCCCC"> i do want to mention</font>

394
00:15:42,550 --> 00:15:48,729
<font color="#E5E5E5">which i think is</font><font color="#CCCCCC"> very</font><font color="#E5E5E5"> interesting is PS</font>

395
00:15:45,310 --> 00:15:50,920
attack<font color="#E5E5E5"> PS attack exe is</font><font color="#CCCCCC"> a self-contained</font>

396
00:15:48,730 --> 00:15:53,110
custom PowerShell console which includes

397
00:15:50,920 --> 00:15:56,050
<font color="#E5E5E5">many of</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> popular offensive powerful</font>

398
00:15:53,110 --> 00:15:57,850
tools and what's interesting about it<font color="#E5E5E5"> is</font>

399
00:15:56,050 --> 00:16:00,189
they're encrypted within that executable

400
00:15:57,850 --> 00:16:02,350
<font color="#E5E5E5">when you run PS attack they get</font>

401
00:16:00,190 --> 00:16:03,970
decrypted loaded directly<font color="#CCCCCC"> into memory so</font>

402
00:16:02,350 --> 00:16:06,280
guess what<font color="#E5E5E5"> antivirus vendors you're not</font>

403
00:16:03,970 --> 00:16:09,400
going to see that<font color="#CCCCCC"> am so you can catch</font>

404
00:16:06,280 --> 00:16:11,350
<font color="#E5E5E5">this so it gets decrypted loaded in the</font>

405
00:16:09,400 --> 00:16:13,090
memory and we have a number<font color="#CCCCCC"> of</font>

406
00:16:11,350 --> 00:16:17,770
<font color="#E5E5E5">interesting tools we can run like</font><font color="#CCCCCC"> invoke</font>

407
00:16:13,090 --> 00:16:20,560
<font color="#E5E5E5">mini cats and powershell dot exe is not</font>

408
00:16:17,770 --> 00:16:23,020
running<font color="#CCCCCC"> on this system what we're</font>

409
00:16:20,560 --> 00:16:27,250
running is PS attack dot exe which is

410
00:16:23,020 --> 00:16:29,439
calling the powershell engine another

411
00:16:27,250 --> 00:16:31,090
<font color="#E5E5E5">interesting thing is that powershell has</font>

412
00:16:29,440 --> 00:16:32,530
different language modes<font color="#E5E5E5"> constrain</font>

413
00:16:31,090 --> 00:16:34,410
language mode is a way that you can<font color="#E5E5E5"> lock</font>

414
00:16:32,530 --> 00:16:36,910
down powershell do<font color="#E5E5E5"> its core element and</font>

415
00:16:34,410 --> 00:16:39,819
it's things like<font color="#CCCCCC"> invoke many cats</font><font color="#E5E5E5"> don't</font>

416
00:16:36,910 --> 00:16:41,530
work in contain language mode<font color="#E5E5E5"> microsoft</font>

417
00:16:39,820 --> 00:16:44,370
made the design decision that<font color="#E5E5E5"> any</font>

418
00:16:41,530 --> 00:16:46,480
executable that's calling powershell

419
00:16:44,370 --> 00:16:48,460
engine the powershell engine with

420
00:16:46,480 --> 00:16:50,020
<font color="#E5E5E5">PowerShell code uses the full language</font>

421
00:16:48,460 --> 00:16:52,390
<font color="#CCCCCC">mode</font><font color="#E5E5E5"> so on this system</font><font color="#CCCCCC"> we have</font>

422
00:16:50,020 --> 00:16:53,800
<font color="#CCCCCC">constraint language mode in a enabled by</font>

423
00:16:52,390 --> 00:16:56,860
using PS attack we could still run

424
00:16:53,800 --> 00:16:59,400
invoke mimikatz<font color="#E5E5E5"> the other interesting</font>

425
00:16:56,860 --> 00:17:02,050
<font color="#E5E5E5">thing about this is</font><font color="#CCCCCC"> on windows 7</font>

426
00:16:59,400 --> 00:17:04,449
it had powershell version<font color="#CCCCCC"> 2 by default</font>

427
00:17:02,050 --> 00:17:08,230
<font color="#E5E5E5">we then put powershell version 4 on it</font>

428
00:17:04,449 --> 00:17:11,709
<font color="#E5E5E5">or version 5</font><font color="#CCCCCC"> or version</font><font color="#E5E5E5"> 3 running PS</font>

429
00:17:08,230 --> 00:17:14,160
<font color="#E5E5E5">attack actually runs the PowerShell code</font>

430
00:17:11,709 --> 00:17:16,449
connecting to the powershell v2 engine

431
00:17:14,160 --> 00:17:19,480
<font color="#E5E5E5">there are no advanced security features</font>

432
00:17:16,449 --> 00:17:21,939
<font color="#CCCCCC">in powershell v2 no module logging</font>

433
00:17:19,480 --> 00:17:24,250
<font color="#E5E5E5">there's no script lock logging there's</font>

434
00:17:21,939 --> 00:17:26,319
no transcription so that means that we

435
00:17:24,250 --> 00:17:28,480
run we when we run invoke mimikatz from

436
00:17:26,319 --> 00:17:31,510
within<font color="#E5E5E5"> PS attack it's connecting to that</font>

437
00:17:28,480 --> 00:17:33,580
powershell v2 engine<font color="#E5E5E5"> and it doesn't show</font>

438
00:17:31,510 --> 00:17:36,250
<font color="#CCCCCC">up in the operational law so</font><font color="#E5E5E5"> all that</font>

439
00:17:33,580 --> 00:17:37,840
logging just isn't there<font color="#E5E5E5"> we can do this</font>

440
00:17:36,250 --> 00:17:40,150
normally<font color="#CCCCCC"> just</font><font color="#E5E5E5"> by doing powershell -</font>

441
00:17:37,840 --> 00:17:42,820
version<font color="#CCCCCC"> 2</font><font color="#E5E5E5"> calling powershell and then</font>

442
00:17:40,150 --> 00:17:43,840
running<font color="#E5E5E5"> PS so i get process which won't</font>

443
00:17:42,820 --> 00:17:45,759
show up<font color="#E5E5E5"> in our log</font>

444
00:17:43,840 --> 00:17:48,970
but if we<font color="#E5E5E5"> open up</font><font color="#CCCCCC"> PowerShell normally we</font>

445
00:17:45,759 --> 00:17:50,980
run get service that it'll be there so

446
00:17:48,970 --> 00:17:52,600
how do<font color="#E5E5E5"> we detect</font><font color="#CCCCCC"> this sort of thing off</font>

447
00:17:50,980 --> 00:17:54,190
we have a tool where we<font color="#E5E5E5"> can look at the</font>

448
00:17:52,600 --> 00:17:56,049
processes on a system and see what

449
00:17:54,190 --> 00:17:57,580
modules<font color="#CCCCCC"> actually get loaded we can</font><font color="#E5E5E5"> look</font>

450
00:17:56,049 --> 00:18:00,999
for system<font color="#CCCCCC"> bot management automation</font>

451
00:17:57,580 --> 00:18:04,149
which is the PowerShell engine that<font color="#CCCCCC"> vol</font>

452
00:18:00,999 --> 00:18:06,009
so we can see here<font color="#CCCCCC"> powershell powershell</font>

453
00:18:04,149 --> 00:18:09,428
PS attack<font color="#CCCCCC"> well i could or a</font><font color="#E5E5E5"> name PS</font>

454
00:18:06,009 --> 00:18:12,399
attack but it's more<font color="#E5E5E5"> interesting when</font><font color="#CCCCCC"> i</font>

455
00:18:09,429 --> 00:18:13,749
don't and when we dig into this we can

456
00:18:12,399 --> 00:18:15,489
<font color="#CCCCCC">look</font><font color="#E5E5E5"> at the modules that are there and</font>

457
00:18:13,749 --> 00:18:18,039
<font color="#CCCCCC">there's system</font><font color="#E5E5E5"> map management that ni</font>

458
00:18:15,490 --> 00:18:21,039
which is the image<font color="#CCCCCC"> file</font><font color="#E5E5E5"> that DLL</font><font color="#CCCCCC"> which</font>

459
00:18:18,039 --> 00:18:24,129
is called by PS attack so how do we

460
00:18:21,039 --> 00:18:26,919
<font color="#E5E5E5">detect this if our nice new powershell</font>

461
00:18:24,129 --> 00:18:29,259
logging isn't working we look at the old

462
00:18:26,919 --> 00:18:31,419
PowerShell logging this is the engine

463
00:18:29,259 --> 00:18:32,830
<font color="#E5E5E5">started the engine stopped and you can</font>

464
00:18:31,419 --> 00:18:35,409
see here it says the<font color="#CCCCCC"> host name</font><font color="#E5E5E5"> the host</font>

465
00:18:32,830 --> 00:18:37,029
version of that of<font color="#E5E5E5"> that tool and then at</font>

466
00:18:35,409 --> 00:18:39,879
the<font color="#CCCCCC"> bottom it says</font><font color="#E5E5E5"> engine version equals</font>

467
00:18:37,029 --> 00:18:43,029
<font color="#CCCCCC">to now we know that</font><font color="#E5E5E5"> it called</font><font color="#CCCCCC"> powershell</font>

468
00:18:39,879 --> 00:18:45,610
version<font color="#CCCCCC"> two if we have powershell v3 v4</font>

469
00:18:43,029 --> 00:18:47,169
v5<font color="#E5E5E5"> deployed everywhere and we see this</font>

470
00:18:45,610 --> 00:18:49,209
we know<font color="#CCCCCC"> that this is something that's</font><font color="#E5E5E5"> a</font>

471
00:18:47,169 --> 00:18:52,600
little<font color="#CCCCCC"> suspicious we need to look into</font>

472
00:18:49,210 --> 00:18:54,070
<font color="#E5E5E5">why this is happening</font><font color="#CCCCCC"> but it starts with</font>

473
00:18:52,600 --> 00:18:56,230
<font color="#E5E5E5">getting these logs back from our</font>

474
00:18:54,070 --> 00:18:58,749
endpoints and<font color="#E5E5E5"> our servers and getting</font>

475
00:18:56,230 --> 00:19:00,610
them into<font color="#E5E5E5"> spunk or our</font><font color="#CCCCCC"> central or</font>

476
00:18:58,749 --> 00:19:02,980
whatever else we have<font color="#CCCCCC"> for</font><font color="#E5E5E5"> central</font>

477
00:19:00,610 --> 00:19:05,258
logging we can detect<font color="#E5E5E5"> this like a said</font>

478
00:19:02,980 --> 00:19:07,149
event<font color="#CCCCCC"> 400-800 the standard powershell</font>

479
00:19:05,259 --> 00:19:09,009
logging by looking<font color="#E5E5E5"> for an engine version</font>

480
00:19:07,149 --> 00:19:11,709
<font color="#E5E5E5">that's less than</font><font color="#CCCCCC"> our standard</font><font color="#E5E5E5"> deployment</font>

481
00:19:09,009 --> 00:19:13,419
of<font color="#CCCCCC"> powershell looking for system</font><font color="#E5E5E5"> lot</font>

482
00:19:11,710 --> 00:19:16,690
management automation hosted in these

483
00:19:13,419 --> 00:19:19,600
non-standard<font color="#E5E5E5"> processes this</font><font color="#CCCCCC"> is not a PS</font>

484
00:19:16,690 --> 00:19:21,820
attack problem<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> our powershell</font>

485
00:19:19,600 --> 00:19:24,490
problem because PS attack is calling

486
00:19:21,820 --> 00:19:26,289
<font color="#E5E5E5">powershell we could just as easily drop</font>

487
00:19:24,490 --> 00:19:28,059
an executable<font color="#CCCCCC"> that does everything we</font>

488
00:19:26,289 --> 00:19:30,158
wanted<font color="#CCCCCC"> to and have it do those calls</font>

489
00:19:28,059 --> 00:19:31,658
<font color="#E5E5E5">right we don't necessarily need</font>

490
00:19:30,159 --> 00:19:34,090
<font color="#E5E5E5">powershell to do that when we can run</font>

491
00:19:31,659 --> 00:19:36,879
any executable<font color="#E5E5E5"> on our system that</font><font color="#CCCCCC"> we</font>

492
00:19:34,090 --> 00:19:38,740
want so you<font color="#CCCCCC"> want to remove the</font>

493
00:19:36,879 --> 00:19:40,449
powershell v2 engine<font color="#E5E5E5"> when it's not</font><font color="#CCCCCC"> being</font>

494
00:19:38,740 --> 00:19:43,149
used<font color="#CCCCCC"> you can do this starting in Windows</font>

495
00:19:40,450 --> 00:19:45,309
8<font color="#CCCCCC"> and 2012 and</font><font color="#E5E5E5"> newer it still requires</font>

496
00:19:43,149 --> 00:19:48,279
<font color="#E5E5E5">the</font><font color="#CCCCCC"> dotnet framework 3.5 for someone to</font>

497
00:19:45,309 --> 00:19:49,720
actually<font color="#E5E5E5"> leverage that PowerShell v2 but</font>

498
00:19:48,279 --> 00:19:52,620
<font color="#CCCCCC">a lot of organizations</font><font color="#E5E5E5"> already deployed</font>

499
00:19:49,720 --> 00:19:55,299
this broadly to their systems

500
00:19:52,620 --> 00:19:56,918
so info confiscation<font color="#E5E5E5"> is a tool that</font><font color="#CCCCCC"> was</font>

501
00:19:55,299 --> 00:19:59,139
really<font color="#CCCCCC"> spied Daniel Bohannon at Derby</font>

502
00:19:56,919 --> 00:20:02,169
<font color="#E5E5E5">Con last year and this takes obfuscation</font>

503
00:19:59,140 --> 00:20:04,299
to the next level effectively what it

504
00:20:02,169 --> 00:20:06,160
does you can<font color="#E5E5E5"> feed it</font><font color="#CCCCCC"> script code</font><font color="#E5E5E5"> you can</font>

505
00:20:04,299 --> 00:20:08,230
feed<font color="#CCCCCC"> it a script</font><font color="#E5E5E5"> and it'll go</font><font color="#CCCCCC"> through</font>

506
00:20:06,160 --> 00:20:09,730
and completely obfuscate it<font color="#E5E5E5"> rendering a</font>

507
00:20:08,230 --> 00:20:11,950
lot of the signatures that<font color="#CCCCCC"> have been</font>

508
00:20:09,730 --> 00:20:14,080
used by blue<font color="#E5E5E5"> teams for a while now</font><font color="#CCCCCC"> to</font>

509
00:20:11,950 --> 00:20:14,679
look for malicious PowerShell<font color="#E5E5E5"> just</font><font color="#CCCCCC"> don't</font>

510
00:20:14,080 --> 00:20:17,168
work anymore

511
00:20:14,679 --> 00:20:19,510
same thing with antivirus so I took this

512
00:20:17,169 --> 00:20:20,890
function from invoke mimikatz get image

513
00:20:19,510 --> 00:20:22,539
<font color="#E5E5E5">empty headers it's one of the core</font>

514
00:20:20,890 --> 00:20:24,400
<font color="#E5E5E5">components</font><font color="#CCCCCC"> of Innoko</font><font color="#E5E5E5"> and book mini cats</font>

515
00:20:22,539 --> 00:20:26,110
<font color="#E5E5E5">so we go</font><font color="#CCCCCC"> through</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> year and</font><font color="#E5E5E5"> we can</font>

516
00:20:24,400 --> 00:20:27,400
signature off the<font color="#E5E5E5"> function name or off a</font>

517
00:20:26,110 --> 00:20:31,750
<font color="#E5E5E5">number of these different</font><font color="#CCCCCC"> things like</font>

518
00:20:27,400 --> 00:20:33,190
<font color="#CCCCCC">HDR supreme for magic but when we run</font>

519
00:20:31,750 --> 00:20:38,110
this through<font color="#E5E5E5"> in brookmont invoke</font>

520
00:20:33,190 --> 00:20:40,390
obfuscation<font color="#E5E5E5"> it looks like this and all</font>

521
00:20:38,110 --> 00:20:41,918
those signatures<font color="#E5E5E5"> don't work anymore this</font>

522
00:20:40,390 --> 00:20:45,429
<font color="#E5E5E5">is at a base level within the invoke</font>

523
00:20:41,919 --> 00:20:47,380
invoke obfuscation<font color="#E5E5E5"> so I took the</font>

524
00:20:45,429 --> 00:20:50,140
<font color="#CCCCCC">powerful Power View</font><font color="#E5E5E5"> tool that will</font>

525
00:20:47,380 --> 00:20:52,120
<font color="#CCCCCC">Schroeder wrote which</font><font color="#E5E5E5"> is a great way to</font>

526
00:20:50,140 --> 00:20:53,559
do ad recon get information<font color="#E5E5E5"> about</font><font color="#CCCCCC"> the</font>

527
00:20:52,120 --> 00:20:55,719
active active environment and<font color="#E5E5E5"> PowerShell</font>

528
00:20:53,559 --> 00:20:57,158
<font color="#E5E5E5">and I ran that through in</font><font color="#CCCCCC"> both I'm sorry</font>

529
00:20:55,720 --> 00:20:59,919
I'll get to that<font color="#CCCCCC"> a minute but it</font>

530
00:20:57,159 --> 00:21:02,230
basically bypasses<font color="#E5E5E5"> a V so when we run</font>

531
00:20:59,919 --> 00:21:04,780
invoke mimikatz normally it<font color="#E5E5E5"> doesn't work</font>

532
00:21:02,230 --> 00:21:06,159
when we run the obfuscated version it

533
00:21:04,780 --> 00:21:09,158
does<font color="#E5E5E5"> one so that's what I</font><font color="#CCCCCC"> meant</font><font color="#E5E5E5"> when I</font>

534
00:21:06,159 --> 00:21:12,940
said if it's around antivirus<font color="#E5E5E5"> so let's</font>

535
00:21:09,159 --> 00:21:14,620
look at the<font color="#E5E5E5"> power view sample so when I</font>

536
00:21:12,940 --> 00:21:17,500
ran<font color="#CCCCCC"> Power View through invoke</font>

537
00:21:14,620 --> 00:21:18,699
obfuscation it looks like this we're not

538
00:21:17,500 --> 00:21:20,289
<font color="#CCCCCC">going</font><font color="#E5E5E5"> to be able to signature off of</font>

539
00:21:18,700 --> 00:21:22,750
that pretty<font color="#E5E5E5"> easily because</font><font color="#CCCCCC"> if I ran it</font>

540
00:21:20,289 --> 00:21:24,250
through<font color="#CCCCCC"> at a higher level deeper</font>

541
00:21:22,750 --> 00:21:26,740
obfuscation it almost starts looking

542
00:21:24,250 --> 00:21:28,120
like machine code so we're not<font color="#E5E5E5"> going to</font>

543
00:21:26,740 --> 00:21:34,090
be able<font color="#CCCCCC"> to look</font><font color="#E5E5E5"> for standard English</font>

544
00:21:28,120 --> 00:21:37,000
words phrases<font color="#E5E5E5"> etc in this jumble so what</font>

545
00:21:34,090 --> 00:21:39,100
do<font color="#E5E5E5"> we do to to find this well Lee</font><font color="#CCCCCC"> Holmes</font>

546
00:21:37,000 --> 00:21:42,010
who wrote all of<font color="#CCCCCC"> the security features</font>

547
00:21:39,100 --> 00:21:44,559
in<font color="#E5E5E5"> PowerShell v5</font><font color="#CCCCCC"> in October he did this</font>

548
00:21:42,010 --> 00:21:48,908
blog<font color="#CCCCCC"> post on us on his site</font><font color="#E5E5E5"> and he</font>

549
00:21:44,559 --> 00:21:52,120
pointed out<font color="#E5E5E5"> how when looking at three to</font>

550
00:21:48,909 --> 00:21:55,299
<font color="#CCCCCC">five hundred PowerShell scripts</font><font color="#E5E5E5"> from a</font>

551
00:21:52,120 --> 00:21:57,489
doubt the download script library he saw

552
00:21:55,299 --> 00:22:00,908
that the top<font color="#E5E5E5"> nine from standard</font>

553
00:21:57,490 --> 00:22:02,980
<font color="#CCCCCC">PowerShell scripts</font><font color="#E5E5E5"> were letters on the</font>

554
00:22:00,909 --> 00:22:04,450
right he looked at a bunch<font color="#CCCCCC"> of obfuscated</font>

555
00:22:02,980 --> 00:22:05,290
code<font color="#CCCCCC"> and he saw</font><font color="#E5E5E5"> that they're all</font>

556
00:22:04,450 --> 00:22:07,240
characters

557
00:22:05,290 --> 00:22:08,980
so by looking<font color="#E5E5E5"> at the type and</font>

558
00:22:07,240 --> 00:22:10,810
<font color="#E5E5E5">distribution of the characters in the</font>

559
00:22:08,980 --> 00:22:13,510
script<font color="#E5E5E5"> we can pretty</font><font color="#CCCCCC"> easily determine</font>

560
00:22:10,810 --> 00:22:15,010
whether it's obfuscated or not so this

561
00:22:13,510 --> 00:22:17,290
<font color="#E5E5E5">leads us</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the next question how do we</font>

562
00:22:15,010 --> 00:22:19,990
find it<font color="#E5E5E5"> well we get powershell</font><font color="#CCCCCC"> v v out</font>

563
00:22:17,290 --> 00:22:21,280
we enable power<font color="#E5E5E5"> script block logging we</font>

564
00:22:19,990 --> 00:22:22,810
look we can<font color="#CCCCCC"> look at the</font><font color="#E5E5E5"> length of the</font>

565
00:22:21,280 --> 00:22:24,070
<font color="#CCCCCC">powershell command because obfuscation</font>

566
00:22:22,810 --> 00:22:26,290
is going to add a whole<font color="#CCCCCC"> lot of</font>

567
00:22:24,070 --> 00:22:29,230
<font color="#E5E5E5">extraneous characters to it</font><font color="#CCCCCC"> in symbols</font>

568
00:22:26,290 --> 00:22:31,330
in<font color="#E5E5E5"> order to the application look for</font>

569
00:22:29,230 --> 00:22:33,040
brackets look for<font color="#E5E5E5"> lots of quotes there's</font>

570
00:22:31,330 --> 00:22:35,260
a lot<font color="#E5E5E5"> more of these than you would you</font>

571
00:22:33,040 --> 00:22:37,960
typically see in your normal PowerShell

572
00:22:35,260 --> 00:22:40,360
code and we<font color="#E5E5E5"> can look for other things</font>

573
00:22:37,960 --> 00:22:41,950
<font color="#E5E5E5">that</font><font color="#CCCCCC"> are like</font><font color="#E5E5E5"> Brandon so last year when</font>

574
00:22:40,360 --> 00:22:44,080
<font color="#CCCCCC">I was</font><font color="#E5E5E5"> here</font><font color="#CCCCCC"> I talked</font><font color="#E5E5E5"> about power</font><font color="#CCCCCC"> self</font>

575
00:22:41,950 --> 00:22:45,880
security some of these slides<font color="#CCCCCC"> are very</font>

576
00:22:44,080 --> 00:22:48,220
<font color="#E5E5E5">familiar</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> you if you've sat in that I</font>

577
00:22:45,880 --> 00:22:49,510
also showed the offensive power<font color="#E5E5E5"> cell</font>

578
00:22:48,220 --> 00:22:52,540
detection cheat sheet which<font color="#E5E5E5"> I've updated</font>

579
00:22:49,510 --> 00:22:53,940
<font color="#CCCCCC">since then and update regularly</font><font color="#E5E5E5"> but this</font>

580
00:22:52,540 --> 00:22:56,740
is a good way to start looking for

581
00:22:53,940 --> 00:22:57,460
<font color="#E5E5E5">malicious offensive</font><font color="#CCCCCC"> PowerShell use in</font>

582
00:22:56,740 --> 00:23:00,010
<font color="#E5E5E5">your environment</font>

583
00:22:57,460 --> 00:23:02,890
pull the<font color="#CCCCCC"> PowerShell log data back put it</font>

584
00:23:00,010 --> 00:23:04,090
in<font color="#E5E5E5"> your sim</font><font color="#CCCCCC"> school</font><font color="#E5E5E5"> and then use these</font>

585
00:23:02,890 --> 00:23:06,070
indicators to look for it

586
00:23:04,090 --> 00:23:09,000
stuff like kernel32 that diella is going

587
00:23:06,070 --> 00:23:13,540
to be more noisy<font color="#E5E5E5"> but</font><font color="#CCCCCC"> i looked at all of</font>

588
00:23:09,000 --> 00:23:15,720
<font color="#E5E5E5">it was 80</font><font color="#CCCCCC"> powershell offensive toolkits</font>

589
00:23:13,540 --> 00:23:18,490
<font color="#E5E5E5">and identified what the most common</font>

590
00:23:15,720 --> 00:23:20,500
<font color="#CCCCCC">halls were in them basically</font><font color="#E5E5E5"> the key</font>

591
00:23:18,490 --> 00:23:23,170
functionality<font color="#E5E5E5"> and what they</font><font color="#CCCCCC"> needed</font><font color="#E5E5E5"> from</font>

592
00:23:20,500 --> 00:23:25,270
<font color="#E5E5E5">windows to work and I got this</font><font color="#CCCCCC"> loss and</font>

593
00:23:23,170 --> 00:23:26,800
I've<font color="#E5E5E5"> used this list to actually</font><font color="#CCCCCC"> check</font>

594
00:23:25,270 --> 00:23:31,120
<font color="#E5E5E5">some interesting behavior at customer</font>

595
00:23:26,800 --> 00:23:32,800
<font color="#E5E5E5">shows all right</font><font color="#CCCCCC"> Shawn that's PowerShell</font>

596
00:23:31,120 --> 00:23:35,169
<font color="#CCCCCC">we're here to talk</font><font color="#E5E5E5"> about</font><font color="#CCCCCC"> act directory</font>

597
00:23:32,800 --> 00:23:37,750
right<font color="#E5E5E5"> so let's get into auditing attack</font>

598
00:23:35,170 --> 00:23:41,530
<font color="#E5E5E5">activity and environment let's figure</font>

599
00:23:37,750 --> 00:23:43,060
<font color="#CCCCCC">out how we can see what's going on</font><font color="#E5E5E5"> so</font>

600
00:23:41,530 --> 00:23:45,070
when we<font color="#CCCCCC"> talk about</font><font color="#E5E5E5"> Windows logging</font>

601
00:23:43,060 --> 00:23:49,000
originally there was<font color="#CCCCCC"> nine audit settings</font>

602
00:23:45,070 --> 00:23:51,760
in Windows<font color="#CCCCCC"> 7 xx 2008 r2 we get 53</font><font color="#E5E5E5"> now</font>

603
00:23:49,000 --> 00:23:54,760
the problem is<font color="#E5E5E5"> that a lot of times and</font>

604
00:23:51,760 --> 00:23:56,890
organizations that have<font color="#E5E5E5"> had</font><font color="#CCCCCC"> Windows over</font>

605
00:23:54,760 --> 00:23:59,530
the years and had Active Directory since

606
00:23:56,890 --> 00:24:02,800
2000 2003<font color="#E5E5E5"> they're still operating</font><font color="#CCCCCC"> with</font>

607
00:23:59,530 --> 00:24:04,899
these original<font color="#E5E5E5"> 9 audit settings and the</font>

608
00:24:02,800 --> 00:24:07,480
other thing that we get<font color="#E5E5E5"> with</font><font color="#CCCCCC"> win 7</font><font color="#E5E5E5"> 2008</font>

609
00:24:04,900 --> 00:24:10,210
r2 is special logon auditing<font color="#E5E5E5"> which is</font>

610
00:24:07,480 --> 00:24:12,400
<font color="#CCCCCC">fantastic</font><font color="#E5E5E5"> because there's companies that</font>

611
00:24:10,210 --> 00:24:14,440
I work<font color="#CCCCCC"> with it can't log all of the</font>

612
00:24:12,400 --> 00:24:16,360
<font color="#E5E5E5">logon data from all their systems right</font>

613
00:24:14,440 --> 00:24:18,850
<font color="#E5E5E5">a lot</font><font color="#CCCCCC"> of us</font>

614
00:24:16,360 --> 00:24:23,168
but what we can do is we can look<font color="#E5E5E5"> in</font>

615
00:24:18,850 --> 00:24:25,840
particular<font color="#E5E5E5"> at specific groups specific</font>

616
00:24:23,169 --> 00:24:29,669
accounts and<font color="#E5E5E5"> audit when they log on and</font>

617
00:24:25,840 --> 00:24:32,860
<font color="#E5E5E5">where they log on so this</font><font color="#CCCCCC"> is the</font>

618
00:24:29,669 --> 00:24:34,720
advanced audit<font color="#CCCCCC"> policy as we can see here</font>

619
00:24:32,860 --> 00:24:36,070
there's a lot of granular data that we

620
00:24:34,720 --> 00:24:40,140
can<font color="#E5E5E5"> get out</font><font color="#CCCCCC"> of this by configuring</font>

621
00:24:36,070 --> 00:24:42,700
success<font color="#CCCCCC"> and</font><font color="#E5E5E5"> failure</font><font color="#CCCCCC"> and there's top left</font>

622
00:24:40,140 --> 00:24:44,350
configuration within<font color="#E5E5E5"> the audit policy or</font>

623
00:24:42,700 --> 00:24:46,090
<font color="#CCCCCC">then</font><font color="#E5E5E5"> the group policy we want to make</font>

624
00:24:44,350 --> 00:24:48,490
<font color="#CCCCCC">sure that we enable it it says audit</font>

625
00:24:46,090 --> 00:24:50,769
force audit policy<font color="#E5E5E5"> subcategory settings</font>

626
00:24:48,490 --> 00:24:54,190
window<font color="#CCCCCC"> Vista or later to override audit</font>

627
00:24:50,769 --> 00:24:57,250
policy<font color="#E5E5E5"> category settings so if you don't</font>

628
00:24:54,190 --> 00:24:59,470
have that set and you<font color="#E5E5E5"> have the standard</font>

629
00:24:57,250 --> 00:25:02,470
audit policy<font color="#E5E5E5"> setting and the advanced</font>

630
00:24:59,470 --> 00:25:03,730
ones<font color="#CCCCCC"> windows is going to use this which</font>

631
00:25:02,470 --> 00:25:06,399
<font color="#E5E5E5">means you're not getting all of</font><font color="#CCCCCC"> that</font>

632
00:25:03,730 --> 00:25:07,990
<font color="#CCCCCC">more granular of NID data you're not</font>

633
00:25:06,399 --> 00:25:09,158
going to get<font color="#E5E5E5"> the things you really</font><font color="#CCCCCC"> need</font>

634
00:25:07,990 --> 00:25:11,950
to figure<font color="#E5E5E5"> out what's going on in your</font>

635
00:25:09,159 --> 00:25:13,990
environment<font color="#CCCCCC"> so how do you figure</font><font color="#E5E5E5"> this</font>

636
00:25:11,950 --> 00:25:16,000
out well audit<font color="#E5E5E5"> Paul</font><font color="#CCCCCC"> dot exe is</font><font color="#E5E5E5"> a great</font>

637
00:25:13,990 --> 00:25:17,830
way to<font color="#E5E5E5"> get information about</font><font color="#CCCCCC"> how that</font>

638
00:25:16,000 --> 00:25:19,149
system<font color="#CCCCCC"> is configured</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> certainly</font>

639
00:25:17,830 --> 00:25:20,500
<font color="#E5E5E5">want to run this on one of your domain</font>

640
00:25:19,149 --> 00:25:23,229
controllers<font color="#CCCCCC"> to see what sort of event</font>

641
00:25:20,500 --> 00:25:27,870
log data<font color="#E5E5E5"> auditing you actually have and</font>

642
00:25:23,230 --> 00:25:30,159
are capturing<font color="#E5E5E5"> I usually recommend these</font>

643
00:25:27,870 --> 00:25:32,080
settings<font color="#E5E5E5"> for auditing on domain</font>

644
00:25:30,159 --> 00:25:33,669
controllers<font color="#E5E5E5"> they're very similar for</font>

645
00:25:32,080 --> 00:25:35,199
auditing on other systems<font color="#CCCCCC"> and again</font>

646
00:25:33,669 --> 00:25:36,490
<font color="#E5E5E5">these</font><font color="#CCCCCC"> slides will be available later and</font>

647
00:25:35,200 --> 00:25:38,789
I'm going<font color="#E5E5E5"> to call out specifically</font>

648
00:25:36,490 --> 00:25:41,799
Kerberos<font color="#CCCCCC"> serves</font><font color="#E5E5E5"> ticket operations and</font>

649
00:25:38,789 --> 00:25:44,980
special logon<font color="#E5E5E5"> and I'll show</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> in a</font><font color="#CCCCCC"> bit</font>

650
00:25:41,799 --> 00:25:49,269
why that why that<font color="#E5E5E5"> matters special audit</font>

651
00:25:44,980 --> 00:25:52,750
<font color="#E5E5E5">logon or special logon auditing logs of</font>

652
00:25:49,269 --> 00:25:54,399
NID<font color="#CCCCCC"> 4960 for when a user who's a member</font>

653
00:25:52,750 --> 00:25:56,769
<font color="#E5E5E5">of one of</font><font color="#CCCCCC"> these</font><font color="#E5E5E5"> groups that you've</font>

654
00:25:54,399 --> 00:25:59,860
configured<font color="#CCCCCC"> within this special logon</font>

655
00:25:56,769 --> 00:26:02,529
group auditing when they log on and so

656
00:25:59,860 --> 00:26:05,889
<font color="#E5E5E5">you can track this track</font><font color="#CCCCCC"> these log ons</font>

657
00:26:02,529 --> 00:26:08,110
<font color="#E5E5E5">based on who's in these groups they're</font>

658
00:26:05,889 --> 00:26:11,019
logged on<font color="#E5E5E5"> the system to which the user</font>

659
00:26:08,110 --> 00:26:12,939
authenticates so if a<font color="#E5E5E5"> domain admin logs</font>

660
00:26:11,019 --> 00:26:14,470
on to<font color="#CCCCCC"> a</font><font color="#E5E5E5"> workstation</font><font color="#CCCCCC"> and you have domain</font>

661
00:26:12,940 --> 00:26:16,389
admins configured with auditing and

662
00:26:14,470 --> 00:26:19,330
<font color="#E5E5E5">you're flowing that data from that</font>

663
00:26:16,389 --> 00:26:21,490
workstation<font color="#E5E5E5"> to your</font><font color="#CCCCCC"> sim you're going to</font>

664
00:26:19,330 --> 00:26:23,049
see that<font color="#E5E5E5"> logon activity and you're going</font>

665
00:26:21,490 --> 00:26:24,460
<font color="#E5E5E5">to be able to talk</font><font color="#CCCCCC"> to that to me and</font>

666
00:26:23,049 --> 00:26:26,020
<font color="#CCCCCC">evan and</font><font color="#E5E5E5"> say well how you logging</font><font color="#CCCCCC"> on to</font>

667
00:26:24,460 --> 00:26:28,990
<font color="#E5E5E5">this workstation</font><font color="#CCCCCC"> it's not a good</font><font color="#E5E5E5"> idea</font>

668
00:26:26,020 --> 00:26:30,129
but Jessica<font color="#CCCCCC"> Payne did</font><font color="#E5E5E5"> a great article</font>

669
00:26:28,990 --> 00:26:31,360
and<font color="#CCCCCC"> I have the</font>

670
00:26:30,130 --> 00:26:33,760
linked<font color="#E5E5E5"> here on the bottom to this</font>

671
00:26:31,360 --> 00:26:37,418
<font color="#CCCCCC">article talking about</font><font color="#E5E5E5"> recommendations</font>

672
00:26:33,760 --> 00:26:38,620
how to configure<font color="#E5E5E5"> this and these are</font>

673
00:26:37,419 --> 00:26:40,720
groups<font color="#E5E5E5"> that she recommends and I</font>

674
00:26:38,620 --> 00:26:42,820
<font color="#E5E5E5">recommend as</font><font color="#CCCCCC"> well create a custom group</font>

675
00:26:40,720 --> 00:26:45,809
<font color="#CCCCCC">call it whatever you want add it</font><font color="#E5E5E5"> to this</font>

676
00:26:42,820 --> 00:26:47,950
and then any users that are of interest

677
00:26:45,809 --> 00:26:49,629
<font color="#CCCCCC">maybe their executives maybe there's</font>

678
00:26:47,950 --> 00:26:51,039
have special powers<font color="#E5E5E5"> within the</font>

679
00:26:49,630 --> 00:26:53,530
organization that<font color="#E5E5E5"> aren't actually</font>

680
00:26:51,039 --> 00:26:55,510
administrators add them to this<font color="#CCCCCC"> special</font>

681
00:26:53,530 --> 00:26:57,370
<font color="#E5E5E5">group and that way you can see where</font>

682
00:26:55,510 --> 00:27:00,910
<font color="#E5E5E5">they're logging on pull this event ID</font>

683
00:26:57,370 --> 00:27:02,590
<font color="#E5E5E5">from all your assistants so we configure</font>

684
00:27:00,910 --> 00:27:05,200
<font color="#E5E5E5">this we can figure out its special</font><font color="#CCCCCC"> logon</font>

685
00:27:02,590 --> 00:27:06,459
success and failure we need the SIDS for

686
00:27:05,200 --> 00:27:08,710
each of our groups in Active<font color="#CCCCCC"> Directory</font>

687
00:27:06,460 --> 00:27:10,720
so here we do domain admins Enterprise

688
00:27:08,710 --> 00:27:13,360
admins<font color="#E5E5E5"> special</font><font color="#CCCCCC"> group auditing which is a</font>

689
00:27:10,720 --> 00:27:15,760
group I created<font color="#E5E5E5"> got the</font><font color="#CCCCCC"> SID for that</font><font color="#E5E5E5"> in</font>

690
00:27:13,360 --> 00:27:19,149
this<font color="#E5E5E5"> group policy we</font><font color="#CCCCCC"> need to configure</font><font color="#E5E5E5"> a</font>

691
00:27:15,760 --> 00:27:21,250
registry key which is LSA audit special

692
00:27:19,150 --> 00:27:23,169
groups<font color="#E5E5E5"> and then we put in the SIDS for</font>

693
00:27:21,250 --> 00:27:25,690
the ones the groups that<font color="#E5E5E5"> we want to on</font>

694
00:27:23,169 --> 00:27:29,169
it<font color="#E5E5E5"> once we do</font><font color="#CCCCCC"> that and deploy it these</font>

695
00:27:25,690 --> 00:27:30,970
systems will log of NID 4908<font color="#CCCCCC"> and it'll</font>

696
00:27:29,169 --> 00:27:33,490
<font color="#CCCCCC">lists the special groups that</font><font color="#E5E5E5"> it's</font><font color="#CCCCCC"> it's</font>

697
00:27:30,970 --> 00:27:35,500
auditing for auditing logins for on the

698
00:27:33,490 --> 00:27:38,320
right we<font color="#E5E5E5"> can see</font><font color="#CCCCCC"> that Luke Skywalker the</font>

699
00:27:35,500 --> 00:27:40,120
domain admin<font color="#E5E5E5"> in this in this act</font>

700
00:27:38,320 --> 00:27:42,189
directory environment<font color="#E5E5E5"> he logged on to</font>

701
00:27:40,120 --> 00:27:44,469
this system and he's also a member<font color="#CCCCCC"> of</font>

702
00:27:42,190 --> 00:27:46,539
the<font color="#CCCCCC"> special group auditing so a</font><font color="#E5E5E5"> couple</font>

703
00:27:44,470 --> 00:27:50,530
<font color="#E5E5E5">different groups that said why he's</font>

704
00:27:46,539 --> 00:27:52,750
<font color="#E5E5E5">getting audited when he logs on so</font>

705
00:27:50,530 --> 00:27:54,250
someone asked me before<font color="#CCCCCC"> they started</font><font color="#E5E5E5"> it</font>

706
00:27:52,750 --> 00:27:57,490
would be really<font color="#E5E5E5"> great</font><font color="#CCCCCC"> to have a list of</font>

707
00:27:54,250 --> 00:27:58,929
all the<font color="#E5E5E5"> event IDs on that we need to get</font>

708
00:27:57,490 --> 00:28:00,760
<font color="#E5E5E5">from like the main controllers and</font>

709
00:27:58,929 --> 00:28:03,659
<font color="#CCCCCC">Windows</font><font color="#E5E5E5"> what you guys think would that</font>

710
00:28:00,760 --> 00:28:07,840
be useful<font color="#E5E5E5"> have you found that anywhere</font>

711
00:28:03,659 --> 00:28:10,210
now our<font color="#E5E5E5"> sim vendors have said hey log</font>

712
00:28:07,840 --> 00:28:12,158
<font color="#E5E5E5">these events throw them in this event</font><font color="#CCCCCC"> ID</font>

713
00:28:10,210 --> 00:28:14,020
bubble<font color="#E5E5E5"> let's get what those are let's</font>

714
00:28:12,159 --> 00:28:15,580
<font color="#CCCCCC">capture those right as</font><font color="#E5E5E5"> that event ID</font>

715
00:28:14,020 --> 00:28:16,960
bubble<font color="#CCCCCC"> turned into</font><font color="#E5E5E5"> a crystal</font><font color="#CCCCCC"> ball where</font>

716
00:28:15,580 --> 00:28:19,620
we can see malicious activity on<font color="#E5E5E5"> our</font>

717
00:28:16,960 --> 00:28:23,140
networks what's that

718
00:28:19,620 --> 00:28:24,760
it gets murkier<font color="#E5E5E5"> yeah exactly</font><font color="#CCCCCC"> so let's</font>

719
00:28:23,140 --> 00:28:28,900
talk about<font color="#E5E5E5"> the</font><font color="#CCCCCC"> event</font><font color="#E5E5E5"> I use a matter in</font>

720
00:28:24,760 --> 00:28:30,908
domain controllers Kerberos off ticket

721
00:28:28,900 --> 00:28:34,030
was requested the initial Kerberos login

722
00:28:30,909 --> 00:28:36,190
<font color="#CCCCCC">at Kerberos service ticket request</font>

723
00:28:34,030 --> 00:28:38,950
<font color="#CCCCCC">custom special group</font><font color="#E5E5E5"> log on tracking</font>

724
00:28:36,190 --> 00:28:41,200
<font color="#CCCCCC">logon</font><font color="#E5E5E5"> failure Sid history added or</font>

725
00:28:38,950 --> 00:28:42,700
attempted the SRM account password

726
00:28:41,200 --> 00:28:43,750
change attempt<font color="#E5E5E5"> this is the local</font>

727
00:28:42,700 --> 00:28:46,000
administrator account on the

728
00:28:43,750 --> 00:28:47,950
and controllers<font color="#CCCCCC"> a cassette on admin</font>

729
00:28:46,000 --> 00:28:50,170
accounts the main<font color="#E5E5E5"> policy Kerberos policy</font>

730
00:28:47,950 --> 00:28:52,240
changing<font color="#E5E5E5"> temp to reset account password</font>

731
00:28:50,170 --> 00:28:54,130
specifically for admins<font color="#E5E5E5"> or sensitive</font>

732
00:28:52,240 --> 00:28:55,840
accounts and then a number<font color="#E5E5E5"> of group</font>

733
00:28:54,130 --> 00:28:57,640
modifications<font color="#E5E5E5"> and</font><font color="#CCCCCC"> active directory</font>

734
00:28:55,840 --> 00:29:00,340
modifications<font color="#E5E5E5"> the bottom one we can use</font>

735
00:28:57,640 --> 00:29:02,080
<font color="#CCCCCC">to monitor</font><font color="#E5E5E5"> for group policy changes this</font>

736
00:29:00,340 --> 00:29:03,429
is a really good<font color="#CCCCCC"> idea</font><font color="#E5E5E5"> especially to see</font>

737
00:29:02,080 --> 00:29:05,949
who's changing group policies of the

738
00:29:03,430 --> 00:29:07,720
domain level<font color="#E5E5E5"> the domain default the main</font>

739
00:29:05,950 --> 00:29:09,850
controller show you<font color="#E5E5E5"> and where</font><font color="#CCCCCC"> our</font>

740
00:29:07,720 --> 00:29:12,610
accounts are<font color="#E5E5E5"> where our workstations are</font>

741
00:29:09,850 --> 00:29:14,379
<font color="#E5E5E5">where our servers are but more than the</font>

742
00:29:12,610 --> 00:29:17,110
main controllers we want to also<font color="#E5E5E5"> audit</font>

743
00:29:14,380 --> 00:29:17,620
specific event IDs on<font color="#CCCCCC"> all Windows</font>

744
00:29:17,110 --> 00:29:22,060
systems

745
00:29:17,620 --> 00:29:23,709
so<font color="#E5E5E5"> someone cleared the event log</font><font color="#CCCCCC"> local</font>

746
00:29:22,060 --> 00:29:27,300
security authority modification this<font color="#E5E5E5"> is</font>

747
00:29:23,710 --> 00:29:30,820
the<font color="#CCCCCC"> logon system this is what stores the</font>

748
00:29:27,300 --> 00:29:34,330
<font color="#E5E5E5">logged on credentials into L SAS that</font>

749
00:29:30,820 --> 00:29:37,330
protected<font color="#E5E5E5"> memory space explicit</font>

750
00:29:34,330 --> 00:29:38,860
credential<font color="#CCCCCC"> logon handle to an object</font>

751
00:29:37,330 --> 00:29:40,629
report<font color="#CCCCCC"> requester this is typically</font>

752
00:29:38,860 --> 00:29:42,610
accessing the local<font color="#E5E5E5"> Sam on a Windows</font>

753
00:29:40,630 --> 00:29:45,610
system or the<font color="#CCCCCC"> Act directory database</font><font color="#E5E5E5"> on</font>

754
00:29:42,610 --> 00:29:47,889
a domain<font color="#E5E5E5"> controller special</font><font color="#CCCCCC"> Group</font>

755
00:29:45,610 --> 00:29:50,500
auditing account password change<font color="#E5E5E5"> new</font>

756
00:29:47,890 --> 00:29:52,660
service was installed new<font color="#CCCCCC"> scheduled</font><font color="#E5E5E5"> task</font>

757
00:29:50,500 --> 00:29:54,730
was<font color="#E5E5E5"> created</font><font color="#CCCCCC"> or scheduled</font><font color="#E5E5E5"> fastest</font>

758
00:29:52,660 --> 00:29:56,800
modified this<font color="#E5E5E5"> is how attackers are</font>

759
00:29:54,730 --> 00:29:59,370
persisting on networks today<font color="#E5E5E5"> if we're</font>

760
00:29:56,800 --> 00:30:02,409
not<font color="#E5E5E5"> monitoring this we're missing it and</font>

761
00:29:59,370 --> 00:30:05,409
then of course<font color="#E5E5E5"> modifications of the</font>

762
00:30:02,410 --> 00:30:07,630
local group<font color="#E5E5E5"> on a Windows system so</font>

763
00:30:05,410 --> 00:30:09,370
modification of administrators attackers

764
00:30:07,630 --> 00:30:11,050
love creating another user account on<font color="#E5E5E5"> a</font>

765
00:30:09,370 --> 00:30:13,270
system and adding it<font color="#CCCCCC"> to the</font><font color="#E5E5E5"> local</font>

766
00:30:11,050 --> 00:30:15,430
administrators<font color="#CCCCCC"> group why because it's a</font>

767
00:30:13,270 --> 00:30:20,050
great<font color="#E5E5E5"> way to persist and very few</font>

768
00:30:15,430 --> 00:30:22,960
companies<font color="#CCCCCC"> are monitoring</font><font color="#E5E5E5"> for this newer</font>

769
00:30:20,050 --> 00:30:25,330
versions of windows with 8.1 and 2012 r2

770
00:30:22,960 --> 00:30:28,170
<font color="#CCCCCC">a newer we get</font><font color="#E5E5E5"> L SAS auditing basically</font>

771
00:30:25,330 --> 00:30:31,449
<font color="#CCCCCC">anything that tries</font><font color="#E5E5E5"> to inject or connect</font>

772
00:30:28,170 --> 00:30:33,760
<font color="#E5E5E5">plug-in to</font><font color="#CCCCCC"> LSA which</font><font color="#E5E5E5"> again is our key</font>

773
00:30:31,450 --> 00:30:36,100
authentication component many cats does

774
00:30:33,760 --> 00:30:38,610
this so we<font color="#E5E5E5"> can enable auditing</font><font color="#CCCCCC"> to see</font>

775
00:30:36,100 --> 00:30:41,919
which tools or components<font color="#E5E5E5"> plugins</font>

776
00:30:38,610 --> 00:30:43,659
<font color="#E5E5E5">drivers etc connect into L SAS and are</font>

777
00:30:41,920 --> 00:30:45,010
communicating with<font color="#CCCCCC"> it keep in mind</font>

778
00:30:43,660 --> 00:30:47,080
though before<font color="#CCCCCC"> you do this you do want to</font>

779
00:30:45,010 --> 00:30:48,820
test<font color="#E5E5E5"> because if you have a security</font>

780
00:30:47,080 --> 00:30:50,169
<font color="#CCCCCC">product that shims else ask to get</font>

781
00:30:48,820 --> 00:30:52,510
<font color="#E5E5E5">information about what's happening</font><font color="#CCCCCC"> on</font>

782
00:30:50,170 --> 00:30:55,660
<font color="#CCCCCC">that</font><font color="#E5E5E5"> Windows system</font><font color="#CCCCCC"> it will cause</font>

783
00:30:52,510 --> 00:30:56,830
<font color="#CCCCCC">problems</font><font color="#E5E5E5"> so be careful but you</font>

784
00:30:55,660 --> 00:30:57,549
definitely<font color="#E5E5E5"> want to test these out and</font>

785
00:30:56,830 --> 00:30:59,230
use these advanced

786
00:30:57,549 --> 00:31:01,629
<font color="#CCCCCC">features looking at drivers that failed</font>

787
00:30:59,230 --> 00:31:04,720
<font color="#E5E5E5">to load connecting the</font><font color="#CCCCCC"> lsat LSA you can</font>

788
00:31:01,629 --> 00:31:08,830
protect<font color="#E5E5E5"> it and say only sign binaries</font>

789
00:31:04,720 --> 00:31:11,830
can connect to LSA and plug<font color="#E5E5E5"> into it so a</font>

790
00:31:08,830 --> 00:31:13,840
note about<font color="#CCCCCC"> logon types of NID 46:24 this</font>

791
00:31:11,830 --> 00:31:16,509
is like the<font color="#E5E5E5"> most numerous event ID will</font>

792
00:31:13,840 --> 00:31:20,230
find in any<font color="#CCCCCC"> network system log on type</font>

793
00:31:16,509 --> 00:31:22,570
<font color="#E5E5E5">zero occurs sometimes but attackers</font>

794
00:31:20,230 --> 00:31:24,789
<font color="#E5E5E5">based on specific activity that they use</font>

795
00:31:22,570 --> 00:31:25,749
<font color="#E5E5E5">you may see this logged so the ones in</font>

796
00:31:24,789 --> 00:31:28,658
bold are<font color="#CCCCCC"> the ones</font><font color="#E5E5E5"> that you definitely</font>

797
00:31:25,749 --> 00:31:30,669
<font color="#CCCCCC">want to pull you don't</font><font color="#E5E5E5"> need all 46 24s</font>

798
00:31:28,659 --> 00:31:33,309
but the<font color="#CCCCCC"> logon</font><font color="#E5E5E5"> types and bold you</font>

799
00:31:30,669 --> 00:31:35,980
definitely want batch and service<font color="#E5E5E5"> so a</font>

800
00:31:33,309 --> 00:31:37,418
<font color="#CCCCCC">scheduled task</font><font color="#E5E5E5"> started a service started</font>

801
00:31:35,980 --> 00:31:39,730
or scheduled<font color="#E5E5E5"> tasks ran and service</font>

802
00:31:37,419 --> 00:31:42,309
started what the account name<font color="#E5E5E5"> was that</font>

803
00:31:39,730 --> 00:31:44,559
was used to start those or run those new

804
00:31:42,309 --> 00:31:47,320
credentials run as net only<font color="#E5E5E5"> or mode</font>

805
00:31:44,559 --> 00:31:49,749
interactive which is RDP<font color="#E5E5E5"> so let's talk</font>

806
00:31:47,320 --> 00:31:51,789
<font color="#E5E5E5">about run as net only people have heard</font>

807
00:31:49,749 --> 00:31:53,350
of<font color="#E5E5E5"> you using honey tokens and you know</font>

808
00:31:51,789 --> 00:31:55,539
<font color="#E5E5E5">using run adds not only to put honey</font>

809
00:31:53,350 --> 00:31:57,639
tokens in<font color="#E5E5E5"> the systems I'm not talking</font>

810
00:31:55,539 --> 00:31:58,929
about that let's<font color="#E5E5E5"> look at an</font><font color="#CCCCCC"> interesting</font>

811
00:31:57,639 --> 00:32:01,359
situation that<font color="#CCCCCC"> just campaigned with</font>

812
00:31:58,929 --> 00:32:03,190
Microsoft again pointed out this<font color="#CCCCCC"> is a</font>

813
00:32:01,359 --> 00:32:04,928
way<font color="#E5E5E5"> to lock down your workstation so</font>

814
00:32:03,190 --> 00:32:06,669
domain admins cannot log<font color="#E5E5E5"> in</font><font color="#CCCCCC"> to them</font>

815
00:32:04,929 --> 00:32:08,559
which makes<font color="#E5E5E5"> sense you prevent them</font>

816
00:32:06,669 --> 00:32:10,269
logging on interactively they can't

817
00:32:08,559 --> 00:32:12,249
connect they can't RDP they can't run

818
00:32:10,269 --> 00:32:14,200
batch service batch jobs or services

819
00:32:12,249 --> 00:32:16,480
even<font color="#CCCCCC"> if</font><font color="#E5E5E5"> they log on as a regular user</font>

820
00:32:14,200 --> 00:32:16,980
account they cannot do run apps<font color="#CCCCCC"> makes</font>

821
00:32:16,480 --> 00:32:20,289
sense

822
00:32:16,980 --> 00:32:21,730
however with run as net only<font color="#CCCCCC"> it just</font>

823
00:32:20,289 --> 00:32:24,549
<font color="#E5E5E5">loads us in a memory and</font><font color="#CCCCCC"> that credential</font>

824
00:32:21,730 --> 00:32:28,330
<font color="#E5E5E5">is leveraged when it's called this means</font>

825
00:32:24,549 --> 00:32:30,850
that this<font color="#CCCCCC"> DEA account can run the Active</font>

826
00:32:28,330 --> 00:32:34,389
Directory<font color="#CCCCCC"> users and computers MMC after</font>

827
00:32:30,850 --> 00:32:37,119
logging on as a regular<font color="#CCCCCC"> user</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> is</font>

828
00:32:34,389 --> 00:32:39,219
pretty interesting<font color="#E5E5E5"> so this is a way that</font>

829
00:32:37,119 --> 00:32:41,529
<font color="#CCCCCC">a</font><font color="#E5E5E5"> domain admin could bypass these</font>

830
00:32:39,220 --> 00:32:42,639
security controls because maybe they

831
00:32:41,529 --> 00:32:44,470
don't<font color="#E5E5E5"> understand why the</font><font color="#CCCCCC"> security</font>

832
00:32:42,639 --> 00:32:46,178
controls are there<font color="#E5E5E5"> in the first place so</font>

833
00:32:44,470 --> 00:32:47,830
we also have<font color="#E5E5E5"> to make sure that the</font>

834
00:32:46,179 --> 00:32:49,539
admins understand why these<font color="#E5E5E5"> security</font>

835
00:32:47,830 --> 00:32:51,399
controls are there<font color="#E5E5E5"> because</font><font color="#CCCCCC"> by doing this</font>

836
00:32:49,539 --> 00:32:52,690
the DEA has just loaded their

837
00:32:51,399 --> 00:32:55,809
credentials in a memory which can<font color="#E5E5E5"> be</font>

838
00:32:52,690 --> 00:32:57,549
pulled by something like<font color="#CCCCCC"> minimaps way to</font>

839
00:32:55,809 --> 00:32:59,980
mitigate<font color="#E5E5E5"> this obviously you can block</font>

840
00:32:57,549 --> 00:33:02,480
run as from specific groups that are

841
00:32:59,980 --> 00:33:04,160
logged<font color="#E5E5E5"> on</font><font color="#CCCCCC"> to that system</font>

842
00:33:02,480 --> 00:33:05,690
so let's talk about password spraying

843
00:33:04,160 --> 00:33:07,670
<font color="#E5E5E5">password spring is really interesting</font>

844
00:33:05,690 --> 00:33:09,560
because it's automated<font color="#E5E5E5"> password guessing</font>

845
00:33:07,670 --> 00:33:10,940
<font color="#E5E5E5">so there's a list of passwords that</font>

846
00:33:09,560 --> 00:33:12,770
<font color="#E5E5E5">we're going to try</font><font color="#CCCCCC"> we start with the</font>

847
00:33:10,940 --> 00:33:15,230
first<font color="#E5E5E5"> one use that first password to</font>

848
00:33:12,770 --> 00:33:17,110
authenticate<font color="#CCCCCC"> as every</font><font color="#E5E5E5"> single user in</font>

849
00:33:15,230 --> 00:33:19,700
Active Directory<font color="#CCCCCC"> we run through the list</font>

850
00:33:17,110 --> 00:33:23,750
<font color="#E5E5E5">flock out threshold is</font><font color="#CCCCCC"> five so we can</font>

851
00:33:19,700 --> 00:33:26,000
try<font color="#CCCCCC"> four for every user</font><font color="#E5E5E5"> and then we wait</font>

852
00:33:23,750 --> 00:33:29,390
for<font color="#E5E5E5"> 30 minutes 31</font><font color="#CCCCCC"> minutes and then we</font>

853
00:33:26,000 --> 00:33:33,620
try again<font color="#CCCCCC"> and</font><font color="#E5E5E5"> this works a lot of the</font>

854
00:33:29,390 --> 00:33:35,240
time<font color="#E5E5E5"> because users have bad passwords we</font>

855
00:33:33,620 --> 00:33:37,669
can connect to<font color="#CCCCCC"> an SMB share or a network</font>

856
00:33:35,240 --> 00:33:39,500
<font color="#E5E5E5">service so let's</font><font color="#CCCCCC"> start with connections</font>

857
00:33:37,670 --> 00:33:41,170
<font color="#E5E5E5">to the PDC s net</font><font color="#CCCCCC"> logon share we run it</font>

858
00:33:39,500 --> 00:33:44,120
through we get<font color="#CCCCCC"> a bunch</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> passwords</font>

859
00:33:41,170 --> 00:33:45,650
46:25<font color="#CCCCCC"> logon failure well most</font>

860
00:33:44,120 --> 00:33:46,909
organizations are<font color="#CCCCCC"> logging that</font><font color="#E5E5E5"> so we</font>

861
00:33:45,650 --> 00:33:48,950
<font color="#E5E5E5">should be able to see that if we're</font>

862
00:33:46,910 --> 00:33:51,260
<font color="#CCCCCC">looking for a whole</font><font color="#E5E5E5"> bunch at a time or</font>

863
00:33:48,950 --> 00:33:55,940
we can<font color="#E5E5E5"> also look at the user attribute</font>

864
00:33:51,260 --> 00:33:57,650
<font color="#E5E5E5">of when they last</font><font color="#CCCCCC"> that password was last</font>

865
00:33:55,940 --> 00:34:01,310
attempted<font color="#E5E5E5"> so we can see here it's within</font>

866
00:33:57,650 --> 00:34:03,350
<font color="#E5E5E5">the same</font><font color="#CCCCCC"> timeframe that's</font><font color="#E5E5E5"> unusual but</font>

867
00:34:01,310 --> 00:34:04,790
let's say<font color="#E5E5E5"> instead</font><font color="#CCCCCC"> of connecting</font><font color="#E5E5E5"> s and B</font>

868
00:34:03,350 --> 00:34:06,409
we connect to<font color="#E5E5E5"> the LDAP service on a</font>

869
00:34:04,790 --> 00:34:10,250
domain<font color="#E5E5E5"> controller what happens</font>

870
00:34:06,410 --> 00:34:13,310
no more<font color="#CCCCCC"> 46:25 Wow</font>

871
00:34:10,250 --> 00:34:17,690
where<font color="#E5E5E5"> did they go a lot of organizations</font>

872
00:34:13,310 --> 00:34:19,310
<font color="#E5E5E5">are monitoring for</font><font color="#CCCCCC"> 46:25 but if we</font>

873
00:34:17,690 --> 00:34:20,990
connect to the<font color="#E5E5E5"> LDAP service for password</font>

874
00:34:19,310 --> 00:34:24,020
<font color="#E5E5E5">frying you wouldn't see this you have to</font>

875
00:34:20,989 --> 00:34:27,259
get 4770 once Kerberos<font color="#E5E5E5"> free</font>

876
00:34:24,020 --> 00:34:29,989
authentication<font color="#E5E5E5"> failed that's not very</font>

877
00:34:27,260 --> 00:34:33,020
useful why would I log that so we

878
00:34:29,989 --> 00:34:35,330
password spray<font color="#E5E5E5"> you see</font><font color="#CCCCCC"> 47 71 s</font><font color="#E5E5E5"> last bad</font>

879
00:34:33,020 --> 00:34:36,889
passwords temp shows up and we<font color="#E5E5E5"> look at</font>

880
00:34:35,330 --> 00:34:38,509
this event forty seven seventy one

881
00:34:36,889 --> 00:34:43,190
failure code is zero by<font color="#CCCCCC"> eighteen that</font>

882
00:34:38,510 --> 00:34:45,710
<font color="#E5E5E5">means bad password we also get 46 48 on</font>

883
00:34:43,190 --> 00:34:47,600
the<font color="#CCCCCC"> workstation or the system that</font><font color="#E5E5E5"> the</font>

884
00:34:45,710 --> 00:34:49,370
attacker is running password spraying on

885
00:34:47,600 --> 00:34:52,190
so we'll see a bunch<font color="#CCCCCC"> of these where Jo</font>

886
00:34:49,370 --> 00:34:53,810
<font color="#CCCCCC">user</font><font color="#E5E5E5"> logged on and attempted</font><font color="#CCCCCC"> to use</font><font color="#E5E5E5"> the</font>

887
00:34:52,190 --> 00:34:57,050
<font color="#E5E5E5">credentials for Alexis Phillips or</font>

888
00:34:53,810 --> 00:34:58,940
<font color="#E5E5E5">Christopher Kelly or whoever and a bunch</font>

889
00:34:57,050 --> 00:35:01,520
of those within<font color="#CCCCCC"> seconds of each</font><font color="#E5E5E5"> other</font><font color="#CCCCCC"> so</font>

890
00:34:58,940 --> 00:35:04,790
<font color="#CCCCCC">that's</font><font color="#E5E5E5"> pretty unusual</font>

891
00:35:01,520 --> 00:35:06,650
so with one of the methods that

892
00:35:04,790 --> 00:35:08,180
<font color="#E5E5E5">attackers use is something that I called</font>

893
00:35:06,650 --> 00:35:09,800
spin scanning which is basically asking

894
00:35:08,180 --> 00:35:11,660
<font color="#E5E5E5">Active Directory for what are the</font>

895
00:35:09,800 --> 00:35:13,190
services that<font color="#CCCCCC"> are using Kerberos in the</font>

896
00:35:11,660 --> 00:35:14,779
environment<font color="#E5E5E5"> because in order for</font>

897
00:35:13,190 --> 00:35:16,730
Kerberos authentication to work<font color="#E5E5E5"> a</font>

898
00:35:14,780 --> 00:35:18,860
service has to have a service<font color="#CCCCCC"> principal</font>

899
00:35:16,730 --> 00:35:20,690
name associated<font color="#E5E5E5"> with it</font><font color="#CCCCCC"> that service</font>

900
00:35:18,860 --> 00:35:23,260
principal<font color="#E5E5E5"> name associates that service</font>

901
00:35:20,690 --> 00:35:26,630
count<font color="#E5E5E5"> with a service running on a server</font>

902
00:35:23,260 --> 00:35:28,220
<font color="#E5E5E5">so it looks</font><font color="#CCCCCC"> like</font><font color="#E5E5E5"> this and we</font><font color="#CCCCCC"> can do</font>

903
00:35:26,630 --> 00:35:30,140
something<font color="#CCCCCC"> like</font><font color="#E5E5E5"> I said spin scanning and</font>

904
00:35:28,220 --> 00:35:31,669
we can get<font color="#E5E5E5"> information on all the</font>

905
00:35:30,140 --> 00:35:32,839
services<font color="#CCCCCC"> of the sequel servers</font><font color="#E5E5E5"> in the</font>

906
00:35:31,670 --> 00:35:35,510
environment<font color="#E5E5E5"> because they have spins</font>

907
00:35:32,840 --> 00:35:36,830
registered we get the port number we can

908
00:35:35,510 --> 00:35:38,480
get the instance name<font color="#E5E5E5"> we know what the</font>

909
00:35:36,830 --> 00:35:40,369
secret<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the sequel service</font><font color="#CCCCCC"> count is</font>

910
00:35:38,480 --> 00:35:42,710
<font color="#CCCCCC">associated with</font><font color="#E5E5E5"> it and again we can do</font>

911
00:35:40,369 --> 00:35:44,240
this by<font color="#CCCCCC"> asking the domain controller</font><font color="#E5E5E5"> we</font>

912
00:35:42,710 --> 00:35:46,970
don't<font color="#E5E5E5"> need to do any kind of</font><font color="#CCCCCC"> cord</font>

913
00:35:44,240 --> 00:35:48,950
scanning and at the bottom<font color="#CCCCCC"> all we need</font>

914
00:35:46,970 --> 00:35:50,959
<font color="#CCCCCC">to do is get a list</font><font color="#E5E5E5"> of all of the users</font>

915
00:35:48,950 --> 00:35:52,310
<font color="#CCCCCC">in the domain</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> have a service</font>

916
00:35:50,960 --> 00:35:55,340
<font color="#CCCCCC">principle</font><font color="#E5E5E5"> name those are service</font>

917
00:35:52,310 --> 00:35:57,529
<font color="#CCCCCC">accounts so that's useful</font><font color="#E5E5E5"> because then</font>

918
00:35:55,340 --> 00:35:58,820
we can do<font color="#E5E5E5"> something called Kerberos we</font>

919
00:35:57,530 --> 00:36:00,710
get a list<font color="#E5E5E5"> of all the service</font><font color="#CCCCCC"> accounts</font>

920
00:35:58,820 --> 00:36:01,970
<font color="#E5E5E5">in the organization because</font><font color="#CCCCCC"> they have</font>

921
00:36:00,710 --> 00:36:03,470
service<font color="#CCCCCC"> principal names we pull a</font>

922
00:36:01,970 --> 00:36:06,049
<font color="#E5E5E5">service principal name from each of them</font>

923
00:36:03,470 --> 00:36:08,209
<font color="#E5E5E5">we request a service</font><font color="#CCCCCC"> ticket using rc4</font>

924
00:36:06,050 --> 00:36:11,420
encryption for each of<font color="#CCCCCC"> those we get a</font>

925
00:36:08,210 --> 00:36:13,100
service ticket encrypt it with<font color="#CCCCCC"> rc4</font><font color="#E5E5E5"> which</font>

926
00:36:11,420 --> 00:36:15,700
means that it's encrypted<font color="#E5E5E5"> with</font><font color="#CCCCCC"> that</font>

927
00:36:13,100 --> 00:36:18,500
service<font color="#CCCCCC"> counts ntlm password hash</font>

928
00:36:15,700 --> 00:36:20,299
<font color="#E5E5E5">interesting</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> cool thing about this</font>

929
00:36:18,500 --> 00:36:22,190
as we do this<font color="#CCCCCC"> with a user and we never</font>

930
00:36:20,300 --> 00:36:24,560
connect to any of<font color="#E5E5E5"> those servers we just</font>

931
00:36:22,190 --> 00:36:27,020
ask the domain controller looks<font color="#E5E5E5"> like</font>

932
00:36:24,560 --> 00:36:29,390
<font color="#E5E5E5">this we use a PowerShell tool our</font>

933
00:36:27,020 --> 00:36:32,150
<font color="#E5E5E5">PowerShell command at the top</font><font color="#CCCCCC"> which</font>

934
00:36:29,390 --> 00:36:33,500
enables us<font color="#CCCCCC"> to request</font><font color="#E5E5E5"> this the service</font>

935
00:36:32,150 --> 00:36:35,480
ticket<font color="#CCCCCC"> for the service principle name</font>

936
00:36:33,500 --> 00:36:36,859
and at the bottom<font color="#CCCCCC"> we run a</font><font color="#E5E5E5"> que list</font><font color="#CCCCCC"> and</font>

937
00:36:35,480 --> 00:36:39,890
we can see<font color="#CCCCCC"> that we got that service</font>

938
00:36:36,859 --> 00:36:44,090
ticket<font color="#CCCCCC"> in this instance it's a</font><font color="#E5E5E5"> DSD</font><font color="#CCCCCC"> do1</font>

939
00:36:39,890 --> 00:36:45,470
it's a sequel server<font color="#E5E5E5"> and it's</font><font color="#CCCCCC"> rc4 so we</font>

940
00:36:44,090 --> 00:36:46,910
can use<font color="#CCCCCC"> mimic ants to pull this out of</font>

941
00:36:45,470 --> 00:36:48,799
the user memory<font color="#E5E5E5"> space but since it is</font>

942
00:36:46,910 --> 00:36:50,839
user<font color="#E5E5E5"> memory space the user has access to</font>

943
00:36:48,800 --> 00:36:52,369
this ticket<font color="#CCCCCC"> we can use a PowerShell tool</font>

944
00:36:50,840 --> 00:36:54,070
in<font color="#CCCCCC"> order to do it or</font><font color="#E5E5E5"> something else to</font>

945
00:36:52,369 --> 00:36:56,600
just<font color="#E5E5E5"> pull it out</font><font color="#CCCCCC"> save it as a file</font>

946
00:36:54,070 --> 00:36:58,520
<font color="#E5E5E5">offload it to our attacker system on the</font>

947
00:36:56,600 --> 00:37:00,380
internet<font color="#CCCCCC"> somewhere and run Kerberos</font>

948
00:36:58,520 --> 00:37:02,960
which is what<font color="#CCCCCC"> Timothy and</font><font color="#E5E5E5"> released the</font>

949
00:37:00,380 --> 00:37:05,090
<font color="#E5E5E5">Derby con a few years ago and since</font><font color="#CCCCCC"> then</font>

950
00:37:02,960 --> 00:37:06,650
most<font color="#E5E5E5"> of the password crackers have been</font>

951
00:37:05,090 --> 00:37:09,530
updated<font color="#E5E5E5"> for this so you can use your</font>

952
00:37:06,650 --> 00:37:12,260
<font color="#E5E5E5">heavy duty password cracking rig GPUs to</font>

953
00:37:09,530 --> 00:37:15,230
<font color="#CCCCCC">crack service</font><font color="#E5E5E5"> count passwords offline</font>

954
00:37:12,260 --> 00:37:17,990
and if humans have<font color="#CCCCCC"> created</font>

955
00:37:15,230 --> 00:37:19,910
these generally they can be cracked if

956
00:37:17,990 --> 00:37:22,729
your minimum account password length for

957
00:37:19,910 --> 00:37:24,080
your<font color="#CCCCCC"> domain is the default which is 7</font>

958
00:37:22,730 --> 00:37:26,720
we're going to crack all of these

959
00:37:24,080 --> 00:37:28,609
probably because<font color="#E5E5E5"> most people go</font><font color="#CCCCCC"> with</font>

960
00:37:26,720 --> 00:37:32,330
whatever the<font color="#CCCCCC"> minimum is even if</font><font color="#E5E5E5"> it's 10</font>

961
00:37:28,609 --> 00:37:33,650
or<font color="#E5E5E5"> 12 very likely it can be cracked so</font>

962
00:37:32,330 --> 00:37:35,299
how do we<font color="#E5E5E5"> detect this about a year and a</font>

963
00:37:33,650 --> 00:37:38,270
half ago I put up a<font color="#E5E5E5"> blog post on</font>

964
00:37:35,300 --> 00:37:40,570
potential detection<font color="#CCCCCC"> tgs wrecked packets</font>

965
00:37:38,270 --> 00:37:44,600
with<font color="#E5E5E5"> RC for looking at the network</font>

966
00:37:40,570 --> 00:37:46,130
<font color="#CCCCCC">searching for excessive 4769 events</font><font color="#E5E5E5"> so</font>

967
00:37:44,600 --> 00:37:48,319
recently<font color="#E5E5E5"> I decided to look at this again</font>

968
00:37:46,130 --> 00:37:50,480
and go<font color="#E5E5E5"> how can</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> detect this so I put</font>

969
00:37:48,320 --> 00:37:52,430
up<font color="#E5E5E5"> a post on the</font><font color="#CCCCCC"> Trimark security</font>

970
00:37:50,480 --> 00:37:54,619
website as well as on<font color="#CCCCCC"> 80 security and</font>

971
00:37:52,430 --> 00:37:57,500
this is the the nuts<font color="#E5E5E5"> and</font><font color="#CCCCCC"> bolts of</font><font color="#E5E5E5"> it</font>

972
00:37:54,619 --> 00:38:00,830
look<font color="#E5E5E5"> at of</font><font color="#CCCCCC"> nid 4769 with specific</font>

973
00:37:57,500 --> 00:38:04,460
options as well<font color="#E5E5E5"> as ticket encryption 0</font>

974
00:38:00,830 --> 00:38:06,170
by 17 which is<font color="#CCCCCC"> our c4 we filter out</font>

975
00:38:04,460 --> 00:38:08,020
service counts we filter our computers

976
00:38:06,170 --> 00:38:10,130
and serves<font color="#E5E5E5"> name the</font><font color="#CCCCCC"> account name</font><font color="#E5E5E5"> field</font>

977
00:38:08,020 --> 00:38:13,070
<font color="#E5E5E5">keeping in mind that inner-force</font>

978
00:38:10,130 --> 00:38:16,369
tickets<font color="#CCCCCC"> use rc4 by default ad</font><font color="#E5E5E5"> FS</font><font color="#CCCCCC"> tend to</font>

979
00:38:13,070 --> 00:38:18,800
use it as well but by doing<font color="#CCCCCC"> this we can</font>

980
00:38:16,369 --> 00:38:20,810
<font color="#E5E5E5">take those 4769 events which you may</font>

981
00:38:18,800 --> 00:38:23,510
have<font color="#CCCCCC"> millions of them</font><font color="#E5E5E5"> and take it down</font>

982
00:38:20,810 --> 00:38:24,859
<font color="#E5E5E5">to maybe a thousand or</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> at that point</font>

983
00:38:23,510 --> 00:38:26,630
we're<font color="#E5E5E5"> really digging</font><font color="#CCCCCC"> into</font><font color="#E5E5E5"> looking at</font>

984
00:38:24,859 --> 00:38:29,180
what's<font color="#E5E5E5"> going on in our</font><font color="#CCCCCC"> environment</font><font color="#E5E5E5"> and</font>

985
00:38:26,630 --> 00:38:30,920
<font color="#E5E5E5">when we do that when an attacker does</font>

986
00:38:29,180 --> 00:38:32,930
something<font color="#CCCCCC"> like this</font><font color="#E5E5E5"> a sample code on how</font>

987
00:38:30,920 --> 00:38:34,460
to basically<font color="#CCCCCC"> Kerberos get those service</font>

988
00:38:32,930 --> 00:38:35,450
tickets for all<font color="#E5E5E5"> those different service</font>

989
00:38:34,460 --> 00:38:39,080
<font color="#E5E5E5">principal names in the in the</font>

990
00:38:35,450 --> 00:38:43,009
<font color="#CCCCCC">organization remain K</font><font color="#E5E5E5"> list</font><font color="#CCCCCC"> all of these</font>

991
00:38:39,080 --> 00:38:46,759
<font color="#E5E5E5">are our</font><font color="#CCCCCC"> C fours so when we look here</font><font color="#E5E5E5"> we</font>

992
00:38:43,010 --> 00:38:48,109
see our<font color="#CCCCCC"> c4</font><font color="#E5E5E5"> we see our c4 our c4 so all</font>

993
00:38:46,760 --> 00:38:52,100
they're doing is requesting our<font color="#E5E5E5"> c4</font>

994
00:38:48,109 --> 00:38:54,319
service tickets<font color="#E5E5E5"> and we can look at that</font>

995
00:38:52,100 --> 00:38:57,830
by using these indicators so we see<font color="#CCCCCC"> Jo</font>

996
00:38:54,320 --> 00:39:02,000
user at 9:36 requested the service

997
00:38:57,830 --> 00:39:05,509
ticket<font color="#E5E5E5"> for</font><font color="#CCCCCC"> Citrix VDI</font><font color="#E5E5E5"> Microsoft is talk</font>

998
00:39:02,000 --> 00:39:08,060
<font color="#CCCCCC">Business Objects</font><font color="#E5E5E5"> Microsoft's AG</font><font color="#CCCCCC"> PM group</font>

999
00:39:05,510 --> 00:39:09,770
policy management console<font color="#E5E5E5"> and</font><font color="#CCCCCC"> for</font>

1000
00:39:08,060 --> 00:39:11,240
different<font color="#CCCCCC"> sequel servers all within a</font>

1001
00:39:09,770 --> 00:39:13,759
couple seconds<font color="#E5E5E5"> of each other</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> is</font>

1002
00:39:11,240 --> 00:39:15,200
extremely suspicious<font color="#CCCCCC"> I don't know what</font>

1003
00:39:13,760 --> 00:39:16,670
Joe's doing maybe he's trying<font color="#E5E5E5"> to work</font>

1004
00:39:15,200 --> 00:39:18,830
overtime or<font color="#CCCCCC"> figure out some security</font>

1005
00:39:16,670 --> 00:39:21,230
stuff that he's up to something<font color="#CCCCCC"> like</font><font color="#E5E5E5"> up</font>

1006
00:39:18,830 --> 00:39:23,150
<font color="#E5E5E5">to no good</font><font color="#CCCCCC"> all</font><font color="#E5E5E5"> right Shawn but what if</font>

1007
00:39:21,230 --> 00:39:25,609
the attacker decided to<font color="#E5E5E5"> request these</font>

1008
00:39:23,150 --> 00:39:27,020
but like did one a day we<font color="#E5E5E5"> would really</font>

1009
00:39:25,609 --> 00:39:29,080
never see<font color="#CCCCCC"> that right how would</font><font color="#E5E5E5"> we know</font>

1010
00:39:27,020 --> 00:39:33,430
that<font color="#CCCCCC"> Joe's doing</font><font color="#E5E5E5"> something shouldn't</font>

1011
00:39:29,080 --> 00:39:36,520
so I figured if we<font color="#CCCCCC"> actually set up a</font>

1012
00:39:33,430 --> 00:39:38,049
honeypot<font color="#E5E5E5"> account where we created a new</font>

1013
00:39:36,520 --> 00:39:40,360
service<font color="#CCCCCC"> principal name that doesn't</font>

1014
00:39:38,050 --> 00:39:41,500
<font color="#E5E5E5">exist</font><font color="#CCCCCC"> I made it up it's not associated</font>

1015
00:39:40,360 --> 00:39:44,050
with an application<font color="#E5E5E5"> no one should ever</font>

1016
00:39:41,500 --> 00:39:45,820
request it and we<font color="#E5E5E5"> set admin count to</font><font color="#CCCCCC"> 1</font>

1017
00:39:44,050 --> 00:39:47,650
<font color="#E5E5E5">which makes it look like</font><font color="#CCCCCC"> it could be an</font>

1018
00:39:45,820 --> 00:39:49,780
account with the main admin rights or

1019
00:39:47,650 --> 00:39:52,150
domain level<font color="#E5E5E5"> rights so when the attacker</font>

1020
00:39:49,780 --> 00:39:53,860
goes through and<font color="#E5E5E5"> says I want</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> know all</font>

1021
00:39:52,150 --> 00:39:56,020
of<font color="#E5E5E5"> the user accounts that have admin</font>

1022
00:39:53,860 --> 00:39:58,180
count as one<font color="#E5E5E5"> could be admins and a</font>

1023
00:39:56,020 --> 00:40:00,610
service<font color="#E5E5E5"> principal</font><font color="#CCCCCC"> name give them to me</font>

1024
00:39:58,180 --> 00:40:02,020
we see Kerberos<font color="#E5E5E5"> honeypot hopefully they</font>

1025
00:40:00,610 --> 00:40:03,310
<font color="#E5E5E5">don't actually look at the service</font>

1026
00:40:02,020 --> 00:40:06,280
Prince William they've requested<font color="#CCCCCC"> 4</font>

1027
00:40:03,310 --> 00:40:08,549
because it's a trap and<font color="#E5E5E5"> we can see that</font>

1028
00:40:06,280 --> 00:40:11,080
it's an RC<font color="#E5E5E5"> 4 ticket pretty standard and</font>

1029
00:40:08,550 --> 00:40:13,150
then we go<font color="#E5E5E5"> back</font><font color="#CCCCCC"> to our indicator and our</font>

1030
00:40:11,080 --> 00:40:15,100
<font color="#E5E5E5">search and we see that Kerberos honeypot</font>

1031
00:40:13,150 --> 00:40:17,050
<font color="#CCCCCC">is there now we know that</font><font color="#E5E5E5"> Joe</font><font color="#CCCCCC"> is up to</font>

1032
00:40:15,100 --> 00:40:19,299
no good<font color="#E5E5E5"> he</font><font color="#CCCCCC"> is requesting</font><font color="#E5E5E5"> service</font>

1033
00:40:17,050 --> 00:40:21,520
principal names<font color="#E5E5E5"> for a system that</font><font color="#CCCCCC"> does</font>

1034
00:40:19,300 --> 00:40:23,500
not<font color="#E5E5E5"> exist</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> this network and if we</font><font color="#CCCCCC"> just</font>

1035
00:40:21,520 --> 00:40:24,970
<font color="#E5E5E5">look for</font><font color="#CCCCCC"> that specific service name</font>

1036
00:40:23,500 --> 00:40:28,780
which we don't<font color="#E5E5E5"> have the name honeypot</font>

1037
00:40:24,970 --> 00:40:31,330
call it something else<font color="#E5E5E5"> we can see that</font>

1038
00:40:28,780 --> 00:40:35,470
it happened<font color="#E5E5E5"> so from millions to</font>

1039
00:40:31,330 --> 00:40:39,630
thousands to<font color="#E5E5E5"> one one guaranteed high</font>

1040
00:40:35,470 --> 00:40:46,240
fidelity<font color="#E5E5E5"> event</font><font color="#CCCCCC"> Packers are doing this</font>

1041
00:40:39,630 --> 00:40:47,470
but there's more<font color="#CCCCCC"> in the newer versions</font>

1042
00:40:46,240 --> 00:40:48,759
of Windows<font color="#E5E5E5"> when you have them on your</font>

1043
00:40:47,470 --> 00:40:50,500
<font color="#E5E5E5">domain controllers</font><font color="#CCCCCC"> you get these new</font>

1044
00:40:48,760 --> 00:40:54,280
check boxes this<font color="#E5E5E5"> account supports</font>

1045
00:40:50,500 --> 00:40:56,410
Kerberos AES 128 256<font color="#E5E5E5"> right so if you set</font>

1046
00:40:54,280 --> 00:40:58,180
this on a<font color="#E5E5E5"> service</font><font color="#CCCCCC"> principal or service</font>

1047
00:40:56,410 --> 00:41:00,370
<font color="#E5E5E5">account that has service principal name</font>

1048
00:40:58,180 --> 00:41:02,200
and your application supports AES

1049
00:41:00,370 --> 00:41:06,069
Kerberos<font color="#E5E5E5"> which most of the Windows ones</font>

1050
00:41:02,200 --> 00:41:08,560
do this changes the<font color="#E5E5E5"> game because</font><font color="#CCCCCC"> now</font>

1051
00:41:06,070 --> 00:41:12,160
when we run<font color="#E5E5E5"> this standard Kerberos</font><font color="#CCCCCC"> tting</font>

1052
00:41:08,560 --> 00:41:17,440
method PowerShell code<font color="#E5E5E5"> script they get</font>

1053
00:41:12,160 --> 00:41:18,819
an<font color="#CCCCCC"> Aes ticket which changes the game so</font>

1054
00:41:17,440 --> 00:41:21,190
this isn't going<font color="#E5E5E5"> to</font><font color="#CCCCCC"> work 100</font><font color="#E5E5E5"> percent of</font>

1055
00:41:18,820 --> 00:41:23,470
time because this<font color="#E5E5E5"> basically tells the DC</font>

1056
00:41:21,190 --> 00:41:25,120
<font color="#E5E5E5">it prefers a yes give them an Aes ticket</font>

1057
00:41:23,470 --> 00:41:27,189
<font color="#E5E5E5">and there's a way to say I really need</font>

1058
00:41:25,120 --> 00:41:29,230
an RC<font color="#CCCCCC"> for ticket give that to me</font><font color="#E5E5E5"> but</font>

1059
00:41:27,190 --> 00:41:33,100
<font color="#E5E5E5">that's another indicator that's other</font>

1060
00:41:29,230 --> 00:41:37,870
activity that<font color="#CCCCCC"> you can look for the key</font>

1061
00:41:33,100 --> 00:41:41,009
<font color="#CCCCCC">to this is not necessarily saying I need</font>

1062
00:41:37,870 --> 00:41:43,029
<font color="#CCCCCC">to</font><font color="#E5E5E5"> detect all bad activity right</font>

1063
00:41:41,010 --> 00:41:44,620
<font color="#CCCCCC">attackers dilemma</font>

1064
00:41:43,030 --> 00:41:48,520
defenders<font color="#CCCCCC"> ulema</font><font color="#E5E5E5"> we've heard this several</font>

1065
00:41:44,620 --> 00:41:50,200
<font color="#CCCCCC">times</font><font color="#E5E5E5"> the attacker you know can can just</font>

1066
00:41:48,520 --> 00:41:52,090
throw<font color="#E5E5E5"> things at it and once they get</font>

1067
00:41:50,200 --> 00:41:54,460
<font color="#E5E5E5">through then they're good the defender</font>

1068
00:41:52,090 --> 00:41:57,100
<font color="#CCCCCC">has to be right a</font><font color="#E5E5E5"> hundred percent of the</font>

1069
00:41:54,460 --> 00:41:59,770
<font color="#CCCCCC">time this is false do not think that</font>

1070
00:41:57,100 --> 00:42:01,480
it's<font color="#E5E5E5"> not the way it works when the</font>

1071
00:41:59,770 --> 00:42:03,370
attacker<font color="#E5E5E5"> gets on the network and they're</font>

1072
00:42:01,480 --> 00:42:05,290
<font color="#CCCCCC">moving around</font><font color="#E5E5E5"> they have to be right a</font>

1073
00:42:03,370 --> 00:42:07,810
hundred percent of<font color="#E5E5E5"> the</font><font color="#CCCCCC"> time</font><font color="#E5E5E5"> they have to</font>

1074
00:42:05,290 --> 00:42:09,700
avoid all<font color="#E5E5E5"> of your traps and tricks and</font>

1075
00:42:07,810 --> 00:42:12,549
logging<font color="#CCCCCC"> that you have on</font><font color="#E5E5E5"> your network</font><font color="#CCCCCC"> if</font>

1076
00:42:09,700 --> 00:42:13,930
you<font color="#CCCCCC"> configure those and</font><font color="#E5E5E5"> you're alerting</font>

1077
00:42:12,550 --> 00:42:16,750
on these things<font color="#E5E5E5"> you're pulling what you</font>

1078
00:42:13,930 --> 00:42:18,730
need they<font color="#E5E5E5"> have to trip over one single</font>

1079
00:42:16,750 --> 00:42:27,940
tripwire that you set up<font color="#E5E5E5"> and then you</font>

1080
00:42:18,730 --> 00:42:30,760
<font color="#E5E5E5">know they're there</font><font color="#CCCCCC"> oh yeah yeah I mean</font>

1081
00:42:27,940 --> 00:42:32,710
<font color="#E5E5E5">so if you use GM SAS like group managed</font>

1082
00:42:30,760 --> 00:42:34,360
service accounts absolutely<font color="#CCCCCC"> I've talked</font>

1083
00:42:32,710 --> 00:42:35,470
before<font color="#CCCCCC"> about mitigation</font><font color="#E5E5E5"> of that</font>

1084
00:42:34,360 --> 00:42:39,040
specifically we're talking about

1085
00:42:35,470 --> 00:42:41,560
<font color="#E5E5E5">detecting but yes long passwords for</font>

1086
00:42:39,040 --> 00:42:44,020
service counts 20 30<font color="#E5E5E5"> characters great</font>

1087
00:42:41,560 --> 00:42:46,330
<font color="#E5E5E5">very difficult to crack nation-states</font>

1088
00:42:44,020 --> 00:42:48,280
are probably in that<font color="#E5E5E5"> area but like most</font>

1089
00:42:46,330 --> 00:42:49,450
<font color="#E5E5E5">of us are not defending against</font>

1090
00:42:48,280 --> 00:42:51,070
<font color="#E5E5E5">nation-states we're defending against</font>

1091
00:42:49,450 --> 00:42:54,330
ransomware<font color="#CCCCCC"> and other other types of</font>

1092
00:42:51,070 --> 00:42:56,680
<font color="#E5E5E5">things but yes absolutely you want long</font>

1093
00:42:54,330 --> 00:42:59,440
complex passwords for service<font color="#CCCCCC"> accounts</font>

1094
00:42:56,680 --> 00:43:00,609
ideally a system creates it like<font color="#E5E5E5"> group</font>

1095
00:42:59,440 --> 00:43:02,260
managed service accounts where<font color="#E5E5E5"> ad</font>

1096
00:43:00,610 --> 00:43:04,450
actually<font color="#E5E5E5"> manages the passwords for those</font>

1097
00:43:02,260 --> 00:43:06,580
for those<font color="#CCCCCC"> accounts</font><font color="#E5E5E5"> we want to make</font><font color="#CCCCCC"> sure</font>

1098
00:43:04,450 --> 00:43:08,560
that we can<font color="#E5E5E5"> protect those set up a</font>

1099
00:43:06,580 --> 00:43:10,660
<font color="#CCCCCC">fine-grained password policy create a</font>

1100
00:43:08,560 --> 00:43:12,670
new<font color="#E5E5E5"> group called all service accounts</font>

1101
00:43:10,660 --> 00:43:14,560
add all service<font color="#CCCCCC"> accounts into that into</font>

1102
00:43:12,670 --> 00:43:16,930
<font color="#E5E5E5">that group and apply that fine-grained</font>

1103
00:43:14,560 --> 00:43:19,180
password policy to<font color="#E5E5E5"> that group and then</font>

1104
00:43:16,930 --> 00:43:20,710
all your service<font color="#E5E5E5"> accounts now you can</font>

1105
00:43:19,180 --> 00:43:23,290
tell them they have<font color="#E5E5E5"> to be 25 characters</font>

1106
00:43:20,710 --> 00:43:25,570
<font color="#E5E5E5">long whenever they get changed yeah</font>

1107
00:43:23,290 --> 00:43:27,610
great great question thank<font color="#E5E5E5"> you so in</font>

1108
00:43:25,570 --> 00:43:29,260
conclusion<font color="#E5E5E5"> we've had this event ID</font>

1109
00:43:27,610 --> 00:43:31,600
bubble we've thrown all these of<font color="#E5E5E5"> n IDs</font>

1110
00:43:29,260 --> 00:43:33,670
in we haven't got a lot<font color="#E5E5E5"> a lot of benefit</font>

1111
00:43:31,600 --> 00:43:34,839
<font color="#E5E5E5">out of it but we can track this activity</font>

1112
00:43:33,670 --> 00:43:37,090
if we're<font color="#CCCCCC"> looking at the</font><font color="#E5E5E5"> right things</font>

1113
00:43:34,840 --> 00:43:38,530
because<font color="#CCCCCC"> most attackers are following the</font>

1114
00:43:37,090 --> 00:43:40,630
same procedures they run through the

1115
00:43:38,530 --> 00:43:42,970
<font color="#E5E5E5">same parts of the playbook we want them</font>

1116
00:43:40,630 --> 00:43:44,560
<font color="#CCCCCC">to go past the</font><font color="#E5E5E5"> first page</font><font color="#CCCCCC"> further back</font>

1117
00:43:42,970 --> 00:43:46,660
<font color="#E5E5E5">into their playbook</font><font color="#CCCCCC"> to figure out how to</font>

1118
00:43:44,560 --> 00:43:49,299
avoid<font color="#E5E5E5"> the logging that we have</font>

1119
00:43:46,660 --> 00:43:53,319
<font color="#E5E5E5">configured we can detect Kerberos</font><font color="#CCCCCC"> ting</font>

1120
00:43:49,300 --> 00:43:54,730
which is a huge help<font color="#E5E5E5"> to us because</font><font color="#CCCCCC"> kerb</font>

1121
00:43:53,320 --> 00:43:56,680
<font color="#CCCCCC">hosting is something a lot of tackers</font>

1122
00:43:54,730 --> 00:43:58,420
<font color="#E5E5E5">use it and I just want to call out</font>

1123
00:43:56,680 --> 00:44:00,399
thanks Jessica<font color="#CCCCCC"> pain for</font><font color="#E5E5E5"> resources she</font>

1124
00:43:58,420 --> 00:44:02,770
also helped me identify some of the key

1125
00:44:00,400 --> 00:44:05,349
event I DS<font color="#CCCCCC"> I also have</font><font color="#E5E5E5"> friends at</font><font color="#CCCCCC"> Mandy</font>

1126
00:44:02,770 --> 00:44:07,270
<font color="#E5E5E5">and so</font><font color="#CCCCCC"> Devon was a help there as well</font>

1127
00:44:05,349 --> 00:44:09,520
slides will<font color="#CCCCCC"> be on presentations about</font>

1128
00:44:07,270 --> 00:44:11,530
<font color="#CCCCCC">eighty security org thank you very much</font>

1129
00:44:09,520 --> 00:44:20,770
for<font color="#E5E5E5"> your time</font><font color="#CCCCCC"> that has been mine</font><font color="#E5E5E5"> and</font>

1130
00:44:11,530 --> 00:44:23,079
<font color="#CCCCCC">we'll open</font><font color="#E5E5E5"> up for</font><font color="#CCCCCC"> questions so I think</font>

1131
00:44:20,770 --> 00:44:31,420
we have a few minutes<font color="#CCCCCC"> or questions this</font>

1132
00:44:23,079 --> 00:44:34,210
variant gets how effective is the

1133
00:44:31,420 --> 00:44:38,430
<font color="#E5E5E5">Microsoft</font><font color="#CCCCCC"> 88 tool a defect at detecting</font>

1134
00:44:34,210 --> 00:44:40,900
attacker activity<font color="#CCCCCC"> ata has pretty decent</font>

1135
00:44:38,430 --> 00:44:43,118
detection of specific types<font color="#E5E5E5"> of attacks</font>

1136
00:44:40,900 --> 00:44:45,849
and the user behavior analysis component

1137
00:44:43,119 --> 00:44:47,230
<font color="#CCCCCC">of it is maturing</font><font color="#E5E5E5"> if you want to talk</font>

1138
00:44:45,849 --> 00:44:49,030
<font color="#E5E5E5">about it in more detail</font><font color="#CCCCCC"> I'll be at the</font>

1139
00:44:47,230 --> 00:44:51,040
<font color="#CCCCCC">Trimark security booth after this</font><font color="#E5E5E5"> I</font>

1140
00:44:49,030 --> 00:44:54,099
<font color="#E5E5E5">don't sell products but yeah I'll be</font>

1141
00:44:51,040 --> 00:44:56,640
happy<font color="#CCCCCC"> to talk in more detail</font><font color="#E5E5E5"> off mic any</font>

1142
00:44:54,099 --> 00:44:56,640
other questions

1143
00:44:57,150 --> 00:45:00,640
great well like I said<font color="#CCCCCC"> I'll be at the</font>

1144
00:44:59,050 --> 00:45:02,470
<font color="#CCCCCC">try</font><font color="#E5E5E5"> mark security booth in the vendor</font>

1145
00:45:00,640 --> 00:45:04,150
<font color="#CCCCCC">area after this</font><font color="#E5E5E5"> if you have any</font>

1146
00:45:02,470 --> 00:45:06,419
questions thanks very much appreciate<font color="#CCCCCC"> it</font>

1147
00:45:04,150 --> 00:45:06,420
enjoy

