1
00:00:06,230 --> 00:00:10,920
now I can't get microphone to work

2
00:00:08,610 --> 00:00:14,579
<font color="#E5E5E5">nicely</font><font color="#CCCCCC"> okay there we go all</font><font color="#E5E5E5"> right</font>

3
00:00:10,920 --> 00:00:17,400
<font color="#E5E5E5">everybody welcome sorry about that</font><font color="#CCCCCC"> so my</font>

4
00:00:14,580 --> 00:00:19,859
name is<font color="#CCCCCC"> oh</font><font color="#E5E5E5"> I have to do my disclaimer</font>

5
00:00:17,400 --> 00:00:22,560
first I stole my<font color="#E5E5E5"> company's slideshow</font>

6
00:00:19,859 --> 00:00:24,869
template<font color="#CCCCCC"> I did not steal the material if</font>

7
00:00:22,560 --> 00:00:28,049
<font color="#CCCCCC">I say something crazy sue Matt</font><font color="#E5E5E5"> Dom</font><font color="#CCCCCC"> code</font>

8
00:00:24,869 --> 00:00:31,948
not my company<font color="#E5E5E5"> okay cool so</font><font color="#CCCCCC"> my name</font><font color="#E5E5E5"> is</font>

9
00:00:28,050 --> 00:00:34,910
Matt Darko I used to be a professional

10
00:00:31,949 --> 00:00:38,460
PowerPoint slide developer and presenter

11
00:00:34,910 --> 00:00:40,559
that's not true<font color="#E5E5E5"> obviously</font><font color="#CCCCCC"> but I was in</font>

12
00:00:38,460 --> 00:00:42,059
the Army<font color="#CCCCCC"> for about ten years</font>

13
00:00:40,559 --> 00:00:45,000
loved what I did<font color="#CCCCCC"> jumped out of airplanes</font>

14
00:00:42,059 --> 00:00:47,879
for the first nine<font color="#CCCCCC"> did enterprise admin</font>

15
00:00:45,000 --> 00:00:51,510
kind of stuff<font color="#E5E5E5"> and</font><font color="#CCCCCC"> then the last two I</font>

16
00:00:47,879 --> 00:00:52,890
moved<font color="#CCCCCC"> down to to Fort Gordon it was a in</font>

17
00:00:51,510 --> 00:00:55,349
the cyber protection<font color="#CCCCCC"> Brigade</font><font color="#E5E5E5"> that they</font>

18
00:00:52,890 --> 00:00:58,079
have down there<font color="#CCCCCC"> it was really cool</font>

19
00:00:55,350 --> 00:01:00,629
because<font color="#CCCCCC"> you got to get exposed</font><font color="#E5E5E5"> to lots</font>

20
00:00:58,079 --> 00:01:02,969
of different<font color="#E5E5E5"> networks and a lot the way</font>

21
00:01:00,629 --> 00:01:04,530
that you do things<font color="#E5E5E5"> in your organization</font>

22
00:01:02,969 --> 00:01:06,330
might be completely<font color="#CCCCCC"> different from</font>

23
00:01:04,530 --> 00:01:09,180
<font color="#E5E5E5">another organization</font><font color="#CCCCCC"> so being on the</font>

24
00:01:06,330 --> 00:01:10,979
team that<font color="#E5E5E5"> I was on I got to see many</font>

25
00:01:09,180 --> 00:01:14,130
<font color="#E5E5E5">different organizations and many</font>

26
00:01:10,979 --> 00:01:18,560
<font color="#E5E5E5">different attempts at security it was</font>

27
00:01:14,130 --> 00:01:21,990
really cool<font color="#CCCCCC"> I teach blue team II stuff</font>

28
00:01:18,560 --> 00:01:24,210
<font color="#E5E5E5">for my company I hang out on slack a lot</font>

29
00:01:21,990 --> 00:01:25,649
and Twitter so<font color="#CCCCCC"> if you have any questions</font>

30
00:01:24,210 --> 00:01:28,408
about the stuff<font color="#CCCCCC"> that I</font><font color="#E5E5E5"> talked</font><font color="#CCCCCC"> about</font>

31
00:01:25,650 --> 00:01:30,930
<font color="#E5E5E5">that's where I pretty much live so at</font>

32
00:01:28,409 --> 00:01:33,000
<font color="#E5E5E5">hashtag</font><font color="#CCCCCC"> cipher</font>

33
00:01:30,930 --> 00:01:37,400
<font color="#CCCCCC">oh this is a different version of</font><font color="#E5E5E5"> my</font>

34
00:01:33,000 --> 00:01:40,740
slides but<font color="#E5E5E5"> that's okay</font><font color="#CCCCCC"> so why am I here</font>

35
00:01:37,400 --> 00:01:42,630
<font color="#CCCCCC">whenever I was in the Army</font><font color="#E5E5E5"> one of the</font>

36
00:01:40,740 --> 00:01:45,140
things that we had to do all<font color="#CCCCCC"> the time</font>

37
00:01:42,630 --> 00:01:48,869
<font color="#E5E5E5">and it took the longest amount of time</font>

38
00:01:45,140 --> 00:01:52,049
was sit down and make a list of every

39
00:01:48,869 --> 00:01:54,030
<font color="#E5E5E5">single port and protocol that a system</font>

40
00:01:52,049 --> 00:01:56,700
<font color="#E5E5E5">use right has anybody ever done</font><font color="#CCCCCC"> like</font><font color="#E5E5E5"> a</font>

41
00:01:54,030 --> 00:01:57,210
<font color="#CCCCCC">PPS</font><font color="#E5E5E5"> M document before it's so much fun</font>

42
00:01:56,700 --> 00:02:00,450
<font color="#CCCCCC">right</font>

43
00:01:57,210 --> 00:02:03,419
like flu I love do it no I hate<font color="#CCCCCC"> it and</font>

44
00:02:00,450 --> 00:02:06,180
so I would spend<font color="#E5E5E5"> like hours in Excel and</font>

45
00:02:03,420 --> 00:02:08,550
write crazy formulas and still it was it

46
00:02:06,180 --> 00:02:10,920
was not fun<font color="#E5E5E5"> at all so I kind of sat down</font>

47
00:02:08,550 --> 00:02:13,400
and<font color="#E5E5E5"> I</font><font color="#CCCCCC"> was like how can</font><font color="#E5E5E5"> I do this</font><font color="#CCCCCC"> better</font>

48
00:02:10,919 --> 00:02:16,069
I wrote a tool to do<font color="#CCCCCC"> it and I</font><font color="#E5E5E5"> was</font>

49
00:02:13,400 --> 00:02:18,709
this is<font color="#E5E5E5"> going to make my life</font><font color="#CCCCCC"> super</font>

50
00:02:16,069 --> 00:02:20,420
<font color="#E5E5E5">super easy right as far</font><font color="#CCCCCC"> as that goes so</font>

51
00:02:18,709 --> 00:02:22,250
I figured out how can I<font color="#E5E5E5"> make this list</font>

52
00:02:20,420 --> 00:02:24,439
<font color="#E5E5E5">and I made the list but then I got to</font>

53
00:02:22,250 --> 00:02:27,409
<font color="#CCCCCC">thinking</font><font color="#E5E5E5"> I was like well can I use this</font>

54
00:02:24,439 --> 00:02:29,930
to<font color="#E5E5E5"> detect malicious activity is that is</font>

55
00:02:27,409 --> 00:02:31,750
that<font color="#CCCCCC"> something that</font><font color="#E5E5E5"> I can do and so the</font>

56
00:02:29,930 --> 00:02:34,609
<font color="#E5E5E5">problem right</font>

57
00:02:31,750 --> 00:02:37,370
identifying malicious activity on the

58
00:02:34,609 --> 00:02:39,349
network<font color="#E5E5E5"> so</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> can do it</font><font color="#CCCCCC"> using</font><font color="#E5E5E5"> signatures</font>

59
00:02:37,370 --> 00:02:41,629
<font color="#E5E5E5">right everybody sort of snort or sir</font>

60
00:02:39,349 --> 00:02:44,230
<font color="#E5E5E5">cata right it's a thing so we</font><font color="#CCCCCC"> have</font>

61
00:02:41,629 --> 00:02:47,739
signatures<font color="#CCCCCC"> this</font><font color="#E5E5E5"> is what they look like</font>

62
00:02:44,230 --> 00:02:51,138
and that's<font color="#CCCCCC"> what they look like and</font>

63
00:02:47,739 --> 00:02:54,650
that's<font color="#E5E5E5"> what they look</font><font color="#CCCCCC"> like that's</font><font color="#E5E5E5"> what</font>

64
00:02:51,139 --> 00:02:56,840
they look like<font color="#E5E5E5"> all in all with</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> a</font>

65
00:02:54,650 --> 00:02:59,180
<font color="#CCCCCC">default installed security onion you end</font>

66
00:02:56,840 --> 00:03:00,470
up with about<font color="#E5E5E5"> 21,000 rules just by</font>

67
00:02:59,180 --> 00:03:04,549
default<font color="#E5E5E5"> that's not even pulling updates</font>

68
00:03:00,470 --> 00:03:06,950
<font color="#E5E5E5">just out of the box 21,000 signatures</font><font color="#CCCCCC"> so</font>

69
00:03:04,549 --> 00:03:09,200
this kind of points<font color="#CCCCCC"> that itself right</font>

70
00:03:06,950 --> 00:03:11,839
<font color="#E5E5E5">the problem is with signature based</font>

71
00:03:09,200 --> 00:03:13,790
detection<font color="#E5E5E5"> you can't create a signature</font>

72
00:03:11,840 --> 00:03:16,939
<font color="#E5E5E5">for everything if you don't know that</font>

73
00:03:13,790 --> 00:03:20,358
<font color="#E5E5E5">someone is throwing</font><font color="#CCCCCC"> MS 1834 right now</font>

74
00:03:16,939 --> 00:03:21,948
because<font color="#E5E5E5"> it's the</font><font color="#CCCCCC"> year 2017 you can't</font>

75
00:03:20,359 --> 00:03:24,739
have a signature for<font color="#CCCCCC"> it so it doesn't</font>

76
00:03:21,949 --> 00:03:28,870
<font color="#E5E5E5">protect you as well as we would like</font><font color="#CCCCCC"> to</font>

77
00:03:24,739 --> 00:03:32,449
as<font color="#E5E5E5"> well</font><font color="#CCCCCC"> as we would</font><font color="#E5E5E5"> like it to do so</font>

78
00:03:28,870 --> 00:03:34,730
what do we<font color="#E5E5E5"> do my idea after</font><font color="#CCCCCC"> I came up</font>

79
00:03:32,449 --> 00:03:37,099
with<font color="#CCCCCC"> that little tool to write my</font><font color="#E5E5E5"> PP SMS</font>

80
00:03:34,730 --> 00:03:41,328
<font color="#CCCCCC">I was like I got this</font><font color="#E5E5E5"> here's what</font><font color="#CCCCCC"> I can</font>

81
00:03:37,099 --> 00:03:43,129
do to do anomaly based alerts for<font color="#E5E5E5"> super</font>

82
00:03:41,329 --> 00:03:44,780
<font color="#CCCCCC">cheap because</font><font color="#E5E5E5"> we're the government so</font>

83
00:03:43,129 --> 00:03:48,260
we're super<font color="#E5E5E5"> poor right that's the way</font>

84
00:03:44,780 --> 00:03:50,299
that that<font color="#CCCCCC"> is so this was this</font><font color="#E5E5E5"> was the</font>

85
00:03:48,260 --> 00:03:53,209
the initial<font color="#E5E5E5"> idea build a network</font>

86
00:03:50,299 --> 00:03:56,269
baseline<font color="#E5E5E5"> writes some rules in snort</font>

87
00:03:53,209 --> 00:03:58,909
<font color="#CCCCCC">that'll alert when something is not in</font>

88
00:03:56,269 --> 00:04:01,639
my<font color="#E5E5E5"> baseline what happens</font><font color="#CCCCCC"> I didn't really</font>

89
00:03:58,909 --> 00:04:05,090
know how exactly<font color="#E5E5E5"> to do it but that's</font>

90
00:04:01,639 --> 00:04:06,530
what<font color="#CCCCCC"> I was</font><font color="#E5E5E5"> going</font><font color="#CCCCCC"> to do so I wrote it</font>

91
00:04:05,090 --> 00:04:08,419
down<font color="#E5E5E5"> it's like okay I'm going to do this</font>

92
00:04:06,530 --> 00:04:09,680
<font color="#E5E5E5">and after</font><font color="#CCCCCC"> I finish I'm going to put in</font>

93
00:04:08,419 --> 00:04:12,500
for our talk and<font color="#CCCCCC"> it's going</font><font color="#E5E5E5"> to be great</font>

94
00:04:09,680 --> 00:04:14,629
<font color="#CCCCCC">so the problem was</font><font color="#E5E5E5"> I said I'm going</font><font color="#CCCCCC"> to</font>

95
00:04:12,500 --> 00:04:17,180
do it this way with snort<font color="#E5E5E5"> and I ended up</font>

96
00:04:14,629 --> 00:04:21,469
with<font color="#CCCCCC"> about</font><font color="#E5E5E5"> 800 lines of snort rules</font>

97
00:04:17,180 --> 00:04:24,080
saying if not this if not<font color="#E5E5E5"> this if life</font>

98
00:04:21,469 --> 00:04:26,450
was super hard<font color="#CCCCCC"> so kind</font><font color="#E5E5E5"> of threw that in</font>

99
00:04:24,080 --> 00:04:27,320
the trash<font color="#CCCCCC"> and then</font><font color="#E5E5E5"> I thought well how</font>

100
00:04:26,450 --> 00:04:29,690
else<font color="#E5E5E5"> do</font>

101
00:04:27,320 --> 00:04:31,250
we detect malicious things what's a

102
00:04:29,690 --> 00:04:34,760
similar problem that we have to<font color="#E5E5E5"> take a</font>

103
00:04:31,250 --> 00:04:37,850
look at malicious binaries right finding

104
00:04:34,760 --> 00:04:41,719
malware on systems<font color="#E5E5E5"> anything for a very</font>

105
00:04:37,850 --> 00:04:46,940
very<font color="#E5E5E5"> long</font><font color="#CCCCCC"> time now right so initially</font>

106
00:04:41,720 --> 00:04:48,410
how did McAfee 1.0 detect<font color="#CCCCCC"> back orifice</font>

107
00:04:46,940 --> 00:04:52,010
<font color="#E5E5E5">well first of</font><font color="#CCCCCC"> all it probably</font><font color="#E5E5E5"> didn't</font>

108
00:04:48,410 --> 00:04:55,160
<font color="#E5E5E5">right but but it looked for signatures</font>

109
00:04:52,010 --> 00:04:58,310
and it was<font color="#E5E5E5"> looking for bad hashes ego</font>

110
00:04:55,160 --> 00:05:00,350
strings<font color="#E5E5E5"> something to fingerprint</font><font color="#CCCCCC"> that</font>

111
00:04:58,310 --> 00:05:02,030
file and it would find it and<font color="#CCCCCC"> be like</font>

112
00:05:00,350 --> 00:05:04,100
hey this<font color="#CCCCCC"> is this is bad you don't want</font>

113
00:05:02,030 --> 00:05:06,260
this<font color="#E5E5E5"> I know you downloaded it from your</font>

114
00:05:04,100 --> 00:05:07,010
<font color="#E5E5E5">AOL Instant</font><font color="#CCCCCC"> Messenger but</font><font color="#E5E5E5"> you don't want</font>

115
00:05:06,260 --> 00:05:10,030
to run this program

116
00:05:07,010 --> 00:05:13,700
<font color="#CCCCCC">the problem with signature detection</font>

117
00:05:10,030 --> 00:05:16,010
specifically for binaries is how many

118
00:05:13,700 --> 00:05:19,060
<font color="#E5E5E5">tools do we have right</font><font color="#CCCCCC"> now that can</font><font color="#E5E5E5"> take</font>

119
00:05:16,010 --> 00:05:21,560
a piece<font color="#E5E5E5"> of malware and off you skate it</font>

120
00:05:19,060 --> 00:05:24,500
right so we've got veil evasion

121
00:05:21,560 --> 00:05:26,000
<font color="#CCCCCC">we've got Hyperion</font><font color="#E5E5E5"> MSF</font><font color="#CCCCCC"> Vento maven for a</font>

122
00:05:24,500 --> 00:05:27,860
<font color="#E5E5E5">little while right well still sometimes</font>

123
00:05:26,000 --> 00:05:30,650
it's<font color="#E5E5E5"> pretty cool on those days when you</font>

124
00:05:27,860 --> 00:05:33,020
see a mess of<font color="#CCCCCC"> phenol work in 2017</font><font color="#E5E5E5"> and</font>

125
00:05:30,650 --> 00:05:34,880
make sure your heart get big but but

126
00:05:33,020 --> 00:05:36,590
there's lots of tools that<font color="#E5E5E5"> we can</font><font color="#CCCCCC"> use to</font>

127
00:05:34,880 --> 00:05:39,409
<font color="#E5E5E5">evade PSPs</font>

128
00:05:36,590 --> 00:05:41,419
so yeah signature based detection it's

129
00:05:39,410 --> 00:05:44,390
not<font color="#E5E5E5"> useless it helps but</font><font color="#CCCCCC"> it's not going</font>

130
00:05:41,420 --> 00:05:44,900
<font color="#E5E5E5">to catch all the things so what happened</font>

131
00:05:44,390 --> 00:05:47,750
after<font color="#CCCCCC"> that</font>

132
00:05:44,900 --> 00:05:49,479
with<font color="#CCCCCC"> PSPs was the next cool technique</font>

133
00:05:47,750 --> 00:05:52,460
<font color="#CCCCCC">after we did signature based detection</font>

134
00:05:49,480 --> 00:05:54,380
<font color="#CCCCCC">okay so one thing about me</font><font color="#E5E5E5"> I'm a teacher</font>

135
00:05:52,460 --> 00:05:56,060
<font color="#CCCCCC">you guys is a</font><font color="#E5E5E5"> little</font><font color="#CCCCCC"> bit bigger than I'm</font>

136
00:05:54,380 --> 00:05:58,070
used to but<font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> going to ask</font><font color="#CCCCCC"> questions</font>

137
00:05:56,060 --> 00:05:58,880
<font color="#E5E5E5">and I you can holler out an answer it's</font>

138
00:05:58,070 --> 00:06:00,409
totally<font color="#CCCCCC"> okay</font>

139
00:05:58,880 --> 00:06:02,560
nobody's going<font color="#CCCCCC"> to like</font><font color="#E5E5E5"> strong-armed you</font>

140
00:06:00,410 --> 00:06:05,690
out of here<font color="#E5E5E5"> does that sound like a plan</font>

141
00:06:02,560 --> 00:06:08,240
<font color="#E5E5E5">see somebody at least</font><font color="#CCCCCC"> okay perfect all</font>

142
00:06:05,690 --> 00:06:10,610
<font color="#CCCCCC">right so after signatures right so</font>

143
00:06:08,240 --> 00:06:12,140
<font color="#CCCCCC">mcafee 1.0 had just straight signatures</font>

144
00:06:10,610 --> 00:06:13,100
looking for this file hash or this

145
00:06:12,140 --> 00:06:16,729
<font color="#CCCCCC">string</font>

146
00:06:13,100 --> 00:06:16,910
<font color="#CCCCCC">Mac speed 1.5 Mac</font><font color="#E5E5E5"> c 2.0 maybe I don't</font>

147
00:06:16,730 --> 00:06:19,070
know

148
00:06:16,910 --> 00:06:20,800
what do we bring<font color="#E5E5E5"> into the mix after</font><font color="#CCCCCC"> we</font>

149
00:06:19,070 --> 00:06:23,270
realized signatures<font color="#E5E5E5"> don't work</font>

150
00:06:20,800 --> 00:06:27,080
<font color="#E5E5E5">heuristics right exactly it's on the</font>

151
00:06:23,270 --> 00:06:29,479
slide<font color="#E5E5E5"> awesome see so heuristics</font><font color="#CCCCCC"> the</font>

152
00:06:27,080 --> 00:06:31,190
great thing about heuristics<font color="#CCCCCC"> was</font><font color="#E5E5E5"> I don't</font>

153
00:06:29,480 --> 00:06:34,130
have to catch the exact file<font color="#E5E5E5"> I just</font>

154
00:06:31,190 --> 00:06:38,719
<font color="#CCCCCC">trace its pattern so if someone remotely</font>

155
00:06:34,130 --> 00:06:40,920
<font color="#E5E5E5">maps my C Drive copies a binary</font><font color="#CCCCCC"> - it</font>

156
00:06:38,720 --> 00:06:43,410
schedules<font color="#CCCCCC"> an ad job - instant</font>

157
00:06:40,920 --> 00:06:45,480
run it like yeah<font color="#E5E5E5"> okay that's probably</font>

158
00:06:43,410 --> 00:06:47,880
<font color="#E5E5E5">bad that's</font><font color="#CCCCCC"> not a thing that people do on</font>

159
00:06:45,480 --> 00:06:51,060
<font color="#CCCCCC">a regular basis right the heuristics of</font>

160
00:06:47,880 --> 00:06:52,860
that action<font color="#CCCCCC"> they're bad so we we did</font>

161
00:06:51,060 --> 00:06:54,570
that right<font color="#E5E5E5"> and now most of your</font>

162
00:06:52,860 --> 00:06:56,700
antivirus<font color="#CCCCCC"> Suites have some sort of</font>

163
00:06:54,570 --> 00:07:03,780
heuristic detection method really really

164
00:06:56,700 --> 00:07:06,770
<font color="#CCCCCC">beneficial</font><font color="#E5E5E5"> does it catch everything yeah</font>

165
00:07:03,780 --> 00:07:09,559
so it still doesn't catch everything

166
00:07:06,770 --> 00:07:11,789
<font color="#CCCCCC">what else can</font><font color="#E5E5E5"> we do</font>

167
00:07:09,560 --> 00:07:15,420
<font color="#E5E5E5">whitelisting right oh my goodness I was</font>

168
00:07:11,790 --> 00:07:17,520
<font color="#E5E5E5">so like super excited about</font><font color="#CCCCCC"> app Locker</font>

169
00:07:15,420 --> 00:07:21,090
and<font color="#E5E5E5"> the things that you can do until I</font>

170
00:07:17,520 --> 00:07:23,460
saw Chris<font color="#CCCCCC"> truster talk about</font><font color="#E5E5E5"> device</font>

171
00:07:21,090 --> 00:07:25,560
guard with Windows 10<font color="#E5E5E5"> the other day and</font>

172
00:07:23,460 --> 00:07:26,549
I<font color="#E5E5E5"> was like device guard is the coolest</font>

173
00:07:25,560 --> 00:07:29,310
thing<font color="#E5E5E5"> in the world</font>

174
00:07:26,550 --> 00:07:30,980
I mean application whitelisting is still

175
00:07:29,310 --> 00:07:34,320
<font color="#E5E5E5">pretty cool and device guard is just a</font>

176
00:07:30,980 --> 00:07:35,630
more mature<font color="#E5E5E5"> version of it</font><font color="#CCCCCC"> but exactly</font>

177
00:07:34,320 --> 00:07:39,300
that we can do<font color="#CCCCCC"> application whitelisting</font>

178
00:07:35,630 --> 00:07:41,370
<font color="#E5E5E5">so I create a</font><font color="#CCCCCC"> policy and I say</font><font color="#E5E5E5"> all right</font>

179
00:07:39,300 --> 00:07:43,890
<font color="#E5E5E5">computer you're only allowed to run</font>

180
00:07:41,370 --> 00:07:46,790
<font color="#CCCCCC">software that I say you can</font><font color="#E5E5E5"> and if</font>

181
00:07:43,890 --> 00:07:49,200
<font color="#CCCCCC">anything else tries to run don't do it</font>

182
00:07:46,790 --> 00:07:50,940
right that's<font color="#E5E5E5"> especially in an enterprise</font>

183
00:07:49,200 --> 00:07:54,240
organization that's a thing<font color="#CCCCCC"> that I can</font>

184
00:07:50,940 --> 00:07:56,310
do<font color="#E5E5E5"> right</font><font color="#CCCCCC"> so let me go ahead and</font><font color="#E5E5E5"> say only</font>

185
00:07:54,240 --> 00:07:58,020
<font color="#E5E5E5">these hashes</font><font color="#CCCCCC"> are allowed to run</font><font color="#E5E5E5"> only</font>

186
00:07:56,310 --> 00:08:00,660
things side<font color="#CCCCCC"> by Microsoft are allowed to</font>

187
00:07:58,020 --> 00:08:02,729
run<font color="#E5E5E5"> only things in this directory</font><font color="#CCCCCC"> I</font>

188
00:08:00,660 --> 00:08:04,800
probably wouldn't go with that one<font color="#E5E5E5"> that</font>

189
00:08:02,730 --> 00:08:06,690
<font color="#E5E5E5">doesn't sound like</font><font color="#CCCCCC"> a good</font><font color="#E5E5E5"> idea but you</font>

190
00:08:04,800 --> 00:08:08,310
<font color="#E5E5E5">can do it right if you're just trying to</font>

191
00:08:06,690 --> 00:08:11,540
<font color="#E5E5E5">get it implemented</font>

192
00:08:08,310 --> 00:08:16,020
okay so what's<font color="#E5E5E5"> Matt</font><font color="#CCCCCC"> DOM Coast basic</font><font color="#E5E5E5"> way</font>

193
00:08:11,540 --> 00:08:18,510
<font color="#CCCCCC">to apply application whitelisting</font><font color="#E5E5E5"> this</font>

194
00:08:16,020 --> 00:08:21,240
is super<font color="#CCCCCC"> super easy when you talk about</font>

195
00:08:18,510 --> 00:08:23,520
it super<font color="#E5E5E5"> super easy when you do it start</font>

196
00:08:21,240 --> 00:08:25,490
with an empty<font color="#E5E5E5"> whitelist create a policy</font>

197
00:08:23,520 --> 00:08:29,180
that says don't allow anything to<font color="#E5E5E5"> run</font>

198
00:08:25,490 --> 00:08:34,080
but if it does log it so now you have a

199
00:08:29,180 --> 00:08:36,140
huge list<font color="#E5E5E5"> of logs that say hey this</font>

200
00:08:34,080 --> 00:08:39,690
piece of<font color="#E5E5E5"> software ran on your system</font><font color="#CCCCCC"> so</font>

201
00:08:36,140 --> 00:08:41,610
<font color="#CCCCCC">what do you know</font><font color="#E5E5E5"> now all</font><font color="#CCCCCC"> the software</font>

202
00:08:39,690 --> 00:08:43,680
that's<font color="#E5E5E5"> running on your systems right so</font>

203
00:08:41,610 --> 00:08:45,690
now<font color="#E5E5E5"> you take</font><font color="#CCCCCC"> that list yeah you got</font><font color="#E5E5E5"> to</font>

204
00:08:43,679 --> 00:08:48,870
go through it<font color="#E5E5E5"> make sure</font><font color="#CCCCCC"> that like</font><font color="#E5E5E5"> met</font>

205
00:08:45,690 --> 00:08:50,670
service<font color="#E5E5E5"> DLL isn't being fingerprinted</font>

206
00:08:48,870 --> 00:08:52,320
but other than<font color="#CCCCCC"> that once you go through</font>

207
00:08:50,670 --> 00:08:53,640
<font color="#E5E5E5">it now you have a list of every</font>

208
00:08:52,320 --> 00:08:54,130
application<font color="#E5E5E5"> that's running in your</font>

209
00:08:53,640 --> 00:08:55,750
enterprise

210
00:08:54,130 --> 00:08:57,970
and all you had to do<font color="#CCCCCC"> was</font><font color="#E5E5E5"> create a</font>

211
00:08:55,750 --> 00:08:59,980
policy<font color="#E5E5E5"> that said hey allow this log</font>

212
00:08:57,970 --> 00:09:02,590
<font color="#E5E5E5">everything else done</font><font color="#CCCCCC"> now you have a</font>

213
00:08:59,980 --> 00:09:04,120
complete software<font color="#E5E5E5"> inventory</font><font color="#CCCCCC"> go you</font><font color="#E5E5E5"> so</font>

214
00:09:02,590 --> 00:09:06,190
once you have<font color="#E5E5E5"> that that list and you've</font>

215
00:09:04,120 --> 00:09:08,260
gone through with a<font color="#CCCCCC"> fine tooth tooth</font>

216
00:09:06,190 --> 00:09:11,020
comb and picked everything out<font color="#CCCCCC"> that you</font>

217
00:09:08,260 --> 00:09:13,600
want to run you just update<font color="#E5E5E5"> the policy</font>

218
00:09:11,020 --> 00:09:16,350
now<font color="#CCCCCC"> if something that's not</font><font color="#E5E5E5"> on your</font>

219
00:09:13,600 --> 00:09:19,450
whitelist tries to run it gets blocked

220
00:09:16,350 --> 00:09:21,820
<font color="#E5E5E5">how how easy</font><font color="#CCCCCC"> is it going to be to upload</font>

221
00:09:19,450 --> 00:09:23,620
backdoor if the only<font color="#CCCCCC"> thing that's</font>

222
00:09:21,820 --> 00:09:26,430
allowed<font color="#CCCCCC"> to run on</font><font color="#E5E5E5"> that system is</font>

223
00:09:23,620 --> 00:09:29,620
executable signed by Microsoft or

224
00:09:26,430 --> 00:09:31,930
executables that you've explicitly

225
00:09:29,620 --> 00:09:33,300
authorized<font color="#E5E5E5"> pretty hard right kind of</font>

226
00:09:31,930 --> 00:09:35,170
<font color="#E5E5E5">hard to get an implant installed if</font>

227
00:09:33,300 --> 00:09:38,469
you're not allowed to<font color="#CCCCCC"> execute the</font>

228
00:09:35,170 --> 00:09:40,479
implant<font color="#E5E5E5"> so that's that's the</font><font color="#CCCCCC"> way that</font>

229
00:09:38,470 --> 00:09:43,750
I'm<font color="#E5E5E5"> solving it as far as applications go</font>

230
00:09:40,480 --> 00:09:46,270
<font color="#E5E5E5">and I thought maybe I do this with</font>

231
00:09:43,750 --> 00:09:49,960
networking<font color="#E5E5E5"> so I'll start with an empty</font>

232
00:09:46,270 --> 00:09:51,850
whitelist<font color="#E5E5E5"> I'll create a policy that logs</font>

233
00:09:49,960 --> 00:09:53,530
<font color="#E5E5E5">everything</font><font color="#CCCCCC"> that's not</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> my whitelist</font>

234
00:09:51,850 --> 00:09:55,420
so it's going<font color="#E5E5E5"> to log everything right</font>

235
00:09:53,530 --> 00:09:56,319
now<font color="#CCCCCC"> a little</font><font color="#E5E5E5"> bit intensive but it'll be</font>

236
00:09:55,420 --> 00:09:59,170
all<font color="#CCCCCC"> right</font>

237
00:09:56,320 --> 00:10:00,730
take<font color="#E5E5E5"> those logs combine them parse the</font>

238
00:09:59,170 --> 00:10:02,589
room everything<font color="#CCCCCC"> that is actually</font>

239
00:10:00,730 --> 00:10:04,780
authorized<font color="#E5E5E5"> will go in my whitelist</font>

240
00:10:02,590 --> 00:10:06,910
<font color="#E5E5E5">everything that's not well it doesn't</font>

241
00:10:04,780 --> 00:10:08,140
<font color="#CCCCCC">need to be happening anyway right</font><font color="#E5E5E5"> let me</font>

242
00:10:06,910 --> 00:10:10,870
<font color="#E5E5E5">go ahead</font><font color="#CCCCCC"> and create</font><font color="#E5E5E5"> some rules to stop</font>

243
00:10:08,140 --> 00:10:15,180
that<font color="#CCCCCC"> once I have my new whitelist</font>

244
00:10:10,870 --> 00:10:15,180
generated I'm good<font color="#CCCCCC"> I just sit</font><font color="#E5E5E5"> back relax</font>

245
00:10:15,360 --> 00:10:18,580
<font color="#E5E5E5">review my logs every once in a while</font>

246
00:10:17,230 --> 00:10:21,300
<font color="#CCCCCC">maybe I need to update some ports</font>

247
00:10:18,580 --> 00:10:24,760
<font color="#E5E5E5">because somebody turned on a new service</font>

248
00:10:21,300 --> 00:10:31,030
so<font color="#E5E5E5"> that being said how</font><font color="#CCCCCC"> can I do all</font>

249
00:10:24,760 --> 00:10:34,480
<font color="#CCCCCC">these things I'm a major bro fanboy yeah</font>

250
00:10:31,030 --> 00:10:37,030
so how do I get data for<font color="#E5E5E5"> my whitelist</font><font color="#CCCCCC"> I</font>

251
00:10:34,480 --> 00:10:39,130
can do that<font color="#CCCCCC"> with bro how do I do have a</font>

252
00:10:37,030 --> 00:10:42,010
<font color="#CCCCCC">policy that creates that logging that I</font>

253
00:10:39,130 --> 00:10:44,380
want I can do that with bro<font color="#CCCCCC"> logs</font><font color="#E5E5E5"> from</font>

254
00:10:42,010 --> 00:10:47,410
<font color="#CCCCCC">the new traffic</font><font color="#E5E5E5"> that doesn't fit my my</font>

255
00:10:44,380 --> 00:10:52,930
whitelist<font color="#E5E5E5"> bro</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> only thing that I</font>

256
00:10:47,410 --> 00:10:54,699
can't do in<font color="#E5E5E5"> bro is review new logs</font><font color="#CCCCCC"> if</font>

257
00:10:52,930 --> 00:10:58,089
you have everybody<font color="#CCCCCC"> heard of anybody not</font>

258
00:10:54,700 --> 00:10:59,620
her<font color="#CCCCCC"> to bro before one two okay</font><font color="#E5E5E5"> cool so</font>

259
00:10:58,090 --> 00:11:01,000
<font color="#E5E5E5">I'll talk</font><font color="#CCCCCC"> about it so in 30 seconds</font>

260
00:10:59,620 --> 00:11:03,220
right<font color="#E5E5E5"> and the war</font><font color="#CCCCCC"> know on this</font><font color="#E5E5E5"> is my</font>

261
00:11:01,000 --> 00:11:06,910
name is not Seth halls<font color="#CCCCCC"> mat</font><font color="#E5E5E5"> dom co so</font>

262
00:11:03,220 --> 00:11:09,990
this is my version<font color="#CCCCCC"> of what bro is</font><font color="#E5E5E5"> it's</font>

263
00:11:06,910 --> 00:11:12,760
IDs<font color="#E5E5E5"> tool</font><font color="#CCCCCC"> suite right</font><font color="#E5E5E5"> it's more like a</font>

264
00:11:09,990 --> 00:11:16,030
network monitoring framework<font color="#CCCCCC"> but</font>

265
00:11:12,760 --> 00:11:17,590
<font color="#E5E5E5">basically if I have full pcap over on</font>

266
00:11:16,030 --> 00:11:19,060
the left that takes up one gig per

267
00:11:17,590 --> 00:11:22,420
second because<font color="#E5E5E5"> my link is completely</font>

268
00:11:19,060 --> 00:11:24,040
<font color="#E5E5E5">saturated and I have just my net flow</font>

269
00:11:22,420 --> 00:11:26,620
right that my<font color="#E5E5E5"> Cisco devices are</font>

270
00:11:24,040 --> 00:11:28,569
providing to me which takes up maybe one

271
00:11:26,620 --> 00:11:31,150
gig<font color="#E5E5E5"> in a year</font>

272
00:11:28,570 --> 00:11:33,250
bro gives me that<font color="#E5E5E5"> in between it gives me</font>

273
00:11:31,150 --> 00:11:36,310
<font color="#CCCCCC">packet strength</font><font color="#E5E5E5"> so anything</font><font color="#CCCCCC"> that's in a</font>

274
00:11:33,250 --> 00:11:38,770
packet<font color="#E5E5E5"> that</font><font color="#CCCCCC"> can be printed</font><font color="#E5E5E5"> out as</font><font color="#CCCCCC"> ascii</font>

275
00:11:36,310 --> 00:11:41,109
text we can<font color="#CCCCCC"> pull that out so just like</font>

276
00:11:38,770 --> 00:11:43,600
in net flow where I get my source<font color="#E5E5E5"> and</font>

277
00:11:41,110 --> 00:11:46,870
destination IP<font color="#CCCCCC"> imports I can pull those</font>

278
00:11:43,600 --> 00:11:50,260
<font color="#E5E5E5">out but I can also pull out</font><font color="#CCCCCC"> DNS requests</font>

279
00:11:46,870 --> 00:11:52,330
<font color="#CCCCCC">I can pull out HTTP GET requests I can</font>

280
00:11:50,260 --> 00:11:53,890
pull out<font color="#E5E5E5"> files as</font><font color="#CCCCCC"> they get transferred</font>

281
00:11:52,330 --> 00:11:55,870
<font color="#CCCCCC">across the network there's a script</font>

282
00:11:53,890 --> 00:11:57,280
<font color="#CCCCCC">built into bro where I can automatically</font>

283
00:11:55,870 --> 00:11:59,230
extract binaries as they're being

284
00:11:57,280 --> 00:12:00,670
transferred across<font color="#E5E5E5"> the wire so later on</font>

285
00:11:59,230 --> 00:12:04,450
<font color="#E5E5E5">whenever I'm doing an incident response</font>

286
00:12:00,670 --> 00:12:06,910
<font color="#CCCCCC">I don't have to go in and manually pull</font>

287
00:12:04,450 --> 00:12:08,590
the file<font color="#E5E5E5"> out of pcap it already got</font>

288
00:12:06,910 --> 00:12:10,449
pulled and<font color="#E5E5E5"> now it's</font><font color="#CCCCCC"> sitting on my server</font>

289
00:12:08,590 --> 00:12:13,360
<font color="#E5E5E5">and I can analyze it the same way that</font><font color="#CCCCCC"> I</font>

290
00:12:10,450 --> 00:12:15,370
would<font color="#E5E5E5"> any anything else so I love that</font>

291
00:12:13,360 --> 00:12:15,550
<font color="#E5E5E5">the plugins and scripts that come with</font>

292
00:12:15,370 --> 00:12:17,830
it

293
00:12:15,550 --> 00:12:20,349
it's a scripting language<font color="#CCCCCC"> so you</font><font color="#E5E5E5"> can</font>

294
00:12:17,830 --> 00:12:22,600
tell it to<font color="#E5E5E5"> do whatever you want it's</font>

295
00:12:20,350 --> 00:12:23,980
it's<font color="#CCCCCC"> amazing and</font><font color="#E5E5E5"> then I think I've</font>

296
00:12:22,600 --> 00:12:26,560
<font color="#CCCCCC">already hit on it the fact that logs are</font>

297
00:12:23,980 --> 00:12:29,440
small so instead<font color="#CCCCCC"> of pulling a gig per</font>

298
00:12:26,560 --> 00:12:33,400
second<font color="#E5E5E5"> and</font><font color="#CCCCCC"> for full pcap I'll spend</font>

299
00:12:29,440 --> 00:12:35,050
maybe a Meg for<font color="#CCCCCC"> a day not not that big</font>

300
00:12:33,400 --> 00:12:37,199
right<font color="#E5E5E5"> depending</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> the size of your pipe</font>

301
00:12:35,050 --> 00:12:40,750
but you're not<font color="#E5E5E5"> going to be anywhere</font><font color="#CCCCCC"> near</font>

302
00:12:37,200 --> 00:12:42,220
the data storage requirements with<font color="#E5E5E5"> bro</font>

303
00:12:40,750 --> 00:12:44,410
as you would be with<font color="#CCCCCC"> full</font><font color="#E5E5E5"> peak app and</font>

304
00:12:42,220 --> 00:12:46,150
so I love it<font color="#E5E5E5"> for that it's my in between</font>

305
00:12:44,410 --> 00:12:47,920
if I can only keep<font color="#CCCCCC"> peak app for a week I</font>

306
00:12:46,150 --> 00:12:50,650
won't bro for a year<font color="#E5E5E5"> net flow for two</font>

307
00:12:47,920 --> 00:12:54,400
just<font color="#E5E5E5"> so that I can see in detail what's</font>

308
00:12:50,650 --> 00:12:56,230
going on<font color="#CCCCCC"> makes life easier oh by the way</font>

309
00:12:54,400 --> 00:12:57,850
<font color="#CCCCCC">this super awesome tool is built in</font>

310
00:12:56,230 --> 00:13:01,360
security<font color="#E5E5E5"> onions so I have</font><font color="#CCCCCC"> a turnkey I</font>

311
00:12:57,850 --> 00:13:03,400
can just spin<font color="#CCCCCC"> up to DM and it's good so</font>

312
00:13:01,360 --> 00:13:05,020
as far as my bro logs<font color="#E5E5E5"> before we take a</font>

313
00:13:03,400 --> 00:13:07,990
look<font color="#CCCCCC"> at what those logs look like a</font>

314
00:13:05,020 --> 00:13:10,180
<font color="#E5E5E5">couple of fields</font><font color="#CCCCCC"> that are useful</font><font color="#E5E5E5"> the UID</font>

315
00:13:07,990 --> 00:13:11,380
so the connection ID so bro tracks<font color="#E5E5E5"> each</font>

316
00:13:10,180 --> 00:13:13,810
<font color="#E5E5E5">connection and it gives it a unique</font>

317
00:13:11,380 --> 00:13:15,130
number<font color="#E5E5E5"> if we want</font><font color="#CCCCCC"> to do IP source</font>

318
00:13:13,810 --> 00:13:17,530
<font color="#E5E5E5">originating host</font>

319
00:13:15,130 --> 00:13:20,140
if we want<font color="#E5E5E5"> to do source port originating</font>

320
00:13:17,530 --> 00:13:20,800
port<font color="#CCCCCC"> same thing</font><font color="#E5E5E5"> for destination response</font>

321
00:13:20,140 --> 00:13:26,470
host

322
00:13:20,800 --> 00:13:29,260
<font color="#CCCCCC">'once</font><font color="#E5E5E5"> port our logs</font><font color="#CCCCCC"> super</font><font color="#E5E5E5"> super easy to</font>

323
00:13:26,470 --> 00:13:30,940
parse<font color="#CCCCCC"> if you're a</font><font color="#E5E5E5"> computer I don't</font><font color="#CCCCCC"> know</font>

324
00:13:29,260 --> 00:13:34,930
<font color="#E5E5E5">about anybody else but I don't want to</font>

325
00:13:30,940 --> 00:13:37,089
stare at<font color="#E5E5E5"> that and be</font><font color="#CCCCCC"> like so one57</font>

326
00:13:34,930 --> 00:13:39,279
talked to<font color="#CCCCCC"> sixty no that's way too much</font>

327
00:13:37,089 --> 00:13:41,220
<font color="#CCCCCC">work I'm not going</font><font color="#E5E5E5"> to do it I'm going to</font>

328
00:13:39,279 --> 00:13:47,380
use<font color="#E5E5E5"> something like Elsa or spunk or</font>

329
00:13:41,220 --> 00:13:49,899
elastic stack as far as blowpro

330
00:13:47,380 --> 00:13:52,959
configuration directories these are the

331
00:13:49,899 --> 00:13:55,480
ones<font color="#CCCCCC"> that I use right</font><font color="#E5E5E5"> now because they</font>

332
00:13:52,959 --> 00:13:56,890
feed<font color="#E5E5E5"> into my tool so just a couple of</font>

333
00:13:55,480 --> 00:13:59,410
reference points if later on<font color="#E5E5E5"> you're like</font>

334
00:13:56,890 --> 00:14:01,480
hey I want to try<font color="#CCCCCC"> out brophy</font><font color="#E5E5E5"> you can</font>

335
00:13:59,410 --> 00:14:02,469
take a look back<font color="#E5E5E5"> basically you need to</font>

336
00:14:01,480 --> 00:14:03,970
know where the scripts are<font color="#E5E5E5"> going to go</font>

337
00:14:02,470 --> 00:14:06,029
<font color="#E5E5E5">you need to know where your logs are</font>

338
00:14:03,970 --> 00:14:08,800
going to be<font color="#E5E5E5"> and you need to know where</font>

339
00:14:06,029 --> 00:14:11,019
the<font color="#E5E5E5"> configuration file for</font><font color="#CCCCCC"> bro</font><font color="#E5E5E5"> where it</font>

340
00:14:08,800 --> 00:14:12,969
loads up the scripts<font color="#CCCCCC"> this</font><font color="#E5E5E5"> is the default</font>

341
00:14:11,019 --> 00:14:14,529
<font color="#E5E5E5">for security onion if you compile from</font>

342
00:14:12,970 --> 00:14:21,130
source and install it yourself it'll be

343
00:14:14,529 --> 00:14:24,130
<font color="#E5E5E5">wherever you told it to</font><font color="#CCCCCC"> be so</font><font color="#E5E5E5"> 2013/2014</font>

344
00:14:21,130 --> 00:14:26,939
I don't remember which one<font color="#CCCCCC"> 2015</font><font color="#E5E5E5"> okay</font><font color="#CCCCCC"> I</font>

345
00:14:24,130 --> 00:14:29,860
was at security onion<font color="#CCCCCC"> Khan and Seth Hall</font>

346
00:14:26,940 --> 00:14:30,550
<font color="#E5E5E5">one of the developers of the the bro</font>

347
00:14:29,860 --> 00:14:33,190
project

348
00:14:30,550 --> 00:14:35,199
bro project he's my hero<font color="#E5E5E5"> and he's up</font>

349
00:14:33,190 --> 00:14:37,329
front<font color="#E5E5E5"> and I'm waiting I'm eager</font><font color="#CCCCCC"> for him</font>

350
00:14:35,200 --> 00:14:39,430
to lay down some<font color="#E5E5E5"> bro knowledge and he</font>

351
00:14:37,329 --> 00:14:41,560
steps up there and he says<font color="#E5E5E5"> the best way</font>

352
00:14:39,430 --> 00:14:44,560
to learn<font color="#E5E5E5"> to write bro scripts is to</font>

353
00:14:41,560 --> 00:14:46,300
write bro scripts<font color="#E5E5E5"> and I was like yeah</font>

354
00:14:44,560 --> 00:14:48,130
but<font color="#CCCCCC"> I don't know how so that's why I'm</font>

355
00:14:46,300 --> 00:14:50,050
at your talk could you please tell<font color="#E5E5E5"> me</font>

356
00:14:48,130 --> 00:14:51,279
<font color="#E5E5E5">about it and I was freaking out because</font>

357
00:14:50,050 --> 00:14:53,829
<font color="#E5E5E5">I thought he wasn't going to actually</font>

358
00:14:51,279 --> 00:14:56,050
<font color="#E5E5E5">talk about it</font><font color="#CCCCCC"> so he said that and I was</font>

359
00:14:53,829 --> 00:14:57,849
<font color="#E5E5E5">like</font><font color="#CCCCCC"> that's kind of</font><font color="#E5E5E5"> a jerk move but then</font>

360
00:14:56,050 --> 00:14:59,319
I started working<font color="#E5E5E5"> on my own bro scripts</font>

361
00:14:57,850 --> 00:15:00,940
<font color="#E5E5E5">and I was like okay so he was exactly</font>

362
00:14:59,320 --> 00:15:02,079
<font color="#E5E5E5">right this is just like any other</font>

363
00:15:00,940 --> 00:15:03,880
<font color="#CCCCCC">language you want</font><font color="#E5E5E5"> to know the best way</font>

364
00:15:02,079 --> 00:15:05,739
<font color="#CCCCCC">to learn Python start writing</font><font color="#E5E5E5"> Python</font>

365
00:15:03,880 --> 00:15:08,980
<font color="#E5E5E5">make yourself write Python you want to</font>

366
00:15:05,740 --> 00:15:14,199
learn<font color="#CCCCCC"> C same thing bro</font><font color="#E5E5E5"> exactly the same</font>

367
00:15:08,980 --> 00:15:17,290
<font color="#E5E5E5">way so I figured in interest of learning</font>

368
00:15:14,199 --> 00:15:18,790
let's write a simple bro script<font color="#E5E5E5"> and work</font>

369
00:15:17,290 --> 00:15:22,630
through<font color="#E5E5E5"> it all of the pieces to</font><font color="#CCCCCC"> the</font>

370
00:15:18,790 --> 00:15:24,279
script are actually used in one<font color="#E5E5E5"> of the</font>

371
00:15:22,630 --> 00:15:26,199
scripts that<font color="#E5E5E5"> comes with</font><font color="#CCCCCC"> brophy</font><font color="#E5E5E5"> and it's</font>

372
00:15:24,279 --> 00:15:30,790
what does the heavy lifting the logging

373
00:15:26,199 --> 00:15:32,680
and the alerting so our bro scripts we

374
00:15:30,790 --> 00:15:34,780
can use<font color="#E5E5E5"> variables just like in any</font><font color="#CCCCCC"> of</font>

375
00:15:32,680 --> 00:15:37,390
<font color="#CCCCCC">the</font><font color="#E5E5E5"> language right if</font>

376
00:15:34,780 --> 00:15:40,930
<font color="#CCCCCC">is for python</font><font color="#E5E5E5"> so set port this is</font><font color="#CCCCCC"> a list</font>

377
00:15:37,390 --> 00:15:47,199
of ports<font color="#CCCCCC"> I give</font><font color="#E5E5E5"> it curly braces</font><font color="#CCCCCC"> the port</font>

378
00:15:40,930 --> 00:15:49,780
number<font color="#E5E5E5"> and then the protocol</font><font color="#CCCCCC"> to easy bro</font>

379
00:15:47,200 --> 00:15:52,660
scripts are actually event-driven<font color="#E5E5E5"> so my</font>

380
00:15:49,780 --> 00:15:55,060
script<font color="#CCCCCC"> a package can come in cause an</font>

381
00:15:52,660 --> 00:15:56,319
action<font color="#CCCCCC"> caused an event and all the</font>

382
00:15:55,060 --> 00:15:58,479
scripts that<font color="#E5E5E5"> are listening for that</font>

383
00:15:56,320 --> 00:16:00,880
event<font color="#E5E5E5"> can</font><font color="#CCCCCC"> take action at the same</font><font color="#E5E5E5"> time</font>

384
00:15:58,480 --> 00:16:02,290
<font color="#CCCCCC">so</font><font color="#E5E5E5"> that's pretty cool</font><font color="#CCCCCC"> the only downside</font>

385
00:16:00,880 --> 00:16:03,730
<font color="#CCCCCC">to</font><font color="#E5E5E5"> that is if you're writing scripts you</font>

386
00:16:02,290 --> 00:16:06,310
have to know what the different events

387
00:16:03,730 --> 00:16:08,110
do and that they exist<font color="#CCCCCC"> right but it's</font>

388
00:16:06,310 --> 00:16:10,510
really<font color="#E5E5E5"> cool my script can cause an event</font>

389
00:16:08,110 --> 00:16:12,280
or packet can cause an event or another

390
00:16:10,510 --> 00:16:14,140
script can cause an event and everything

391
00:16:12,280 --> 00:16:17,589
<font color="#E5E5E5">kind of gets</font><font color="#CCCCCC"> to execute at the same time</font>

392
00:16:14,140 --> 00:16:19,600
it's really<font color="#E5E5E5"> nice so event brewing it</font>

393
00:16:17,590 --> 00:16:23,710
when bro first starts up what do I want

394
00:16:19,600 --> 00:16:26,620
it<font color="#E5E5E5"> to do well I want it to print a</font>

395
00:16:23,710 --> 00:16:30,400
string<font color="#E5E5E5"> and then I wanted to do format</font>

396
00:16:26,620 --> 00:16:33,700
string<font color="#CCCCCC"> so I took my variable</font><font color="#E5E5E5"> and using</font>

397
00:16:30,400 --> 00:16:36,340
the pipes<font color="#CCCCCC"> I don't have a yeah on the</font>

398
00:16:33,700 --> 00:16:37,720
<font color="#E5E5E5">right hand</font><font color="#CCCCCC"> side you can see pipes my</font>

399
00:16:36,340 --> 00:16:42,850
<font color="#E5E5E5">ports so</font><font color="#CCCCCC"> it's actually</font><font color="#E5E5E5"> going to tell me</font>

400
00:16:37,720 --> 00:16:44,890
how many<font color="#E5E5E5"> items are in my ports after</font>

401
00:16:42,850 --> 00:16:47,620
that I<font color="#E5E5E5"> said</font><font color="#CCCCCC"> okay the next event that I</font>

402
00:16:44,890 --> 00:16:49,689
want to track is new connection so every

403
00:16:47,620 --> 00:16:52,780
time a new<font color="#E5E5E5"> connection is detected</font>

404
00:16:49,690 --> 00:16:54,910
I want bro to do something for me<font color="#E5E5E5"> what I</font>

405
00:16:52,780 --> 00:16:56,890
wanted to do I want to check the

406
00:16:54,910 --> 00:16:59,350
destination<font color="#E5E5E5"> port and see if it's in that</font>

407
00:16:56,890 --> 00:17:01,960
<font color="#E5E5E5">list we created</font><font color="#CCCCCC"> earlier it's pretty</font>

408
00:16:59,350 --> 00:17:04,960
simple<font color="#E5E5E5"> right</font><font color="#CCCCCC"> so if the destination port</font>

409
00:17:01,960 --> 00:17:11,050
is in<font color="#CCCCCC"> my list I want</font><font color="#E5E5E5"> to print an alert</font>

410
00:17:04,960 --> 00:17:16,240
to the<font color="#E5E5E5"> screen or do something</font><font color="#CCCCCC"> okay feel</font>

411
00:17:11,050 --> 00:17:18,339
like that's those three things<font color="#CCCCCC"> an if</font>

412
00:17:16,240 --> 00:17:20,920
statement the ability to call a file or

413
00:17:18,339 --> 00:17:23,879
to call a list<font color="#E5E5E5"> that's that's what I'm</font>

414
00:17:20,920 --> 00:17:26,620
doing as far<font color="#E5E5E5"> as my pro scripting goes</font>

415
00:17:23,880 --> 00:17:28,990
<font color="#CCCCCC">the this bro script that I'm using is</font>

416
00:17:26,619 --> 00:17:31,540
baseline report bro it's also on github

417
00:17:28,990 --> 00:17:33,700
with<font color="#CCCCCC"> brokey but basically it pulls in a</font>

418
00:17:31,540 --> 00:17:36,940
table<font color="#E5E5E5"> and it checks every</font><font color="#CCCCCC"> single</font><font color="#E5E5E5"> new</font>

419
00:17:33,700 --> 00:17:40,270
connection<font color="#E5E5E5"> is this in the database if it</font>

420
00:17:36,940 --> 00:17:42,940
is is this source allowed to talk<font color="#E5E5E5"> to</font>

421
00:17:40,270 --> 00:17:44,770
that destination<font color="#CCCCCC"> so yeah my file server</font>

422
00:17:42,940 --> 00:17:46,930
<font color="#E5E5E5">people within the organization should</font><font color="#CCCCCC"> be</font>

423
00:17:44,770 --> 00:17:48,629
allowed to<font color="#E5E5E5"> talk</font><font color="#CCCCCC"> to the file server right</font>

424
00:17:46,930 --> 00:17:51,150
people on<font color="#E5E5E5"> the</font><font color="#CCCCCC"> Internet Eve</font>

425
00:17:48,630 --> 00:17:54,660
if I have the worst<font color="#E5E5E5"> admin in the world</font>

426
00:17:51,150 --> 00:17:57,890
<font color="#E5E5E5">should not be</font><font color="#CCCCCC"> allowed to talk to my file</font>

427
00:17:54,660 --> 00:17:59,820
server right<font color="#CCCCCC"> like that's</font><font color="#E5E5E5"> not a thing so</font>

428
00:17:57,890 --> 00:18:01,170
that's what we're<font color="#E5E5E5"> doing we're checking</font>

429
00:17:59,820 --> 00:18:03,720
source and destination to see if they're

430
00:18:01,170 --> 00:18:05,640
authorized<font color="#CCCCCC"> if they are cool we're good</font>

431
00:18:03,720 --> 00:18:09,300
<font color="#CCCCCC">next packet</font><font color="#E5E5E5"> if they're not let's go</font>

432
00:18:05,640 --> 00:18:12,710
ahead<font color="#E5E5E5"> and do some logging as far as</font>

433
00:18:09,300 --> 00:18:15,450
<font color="#E5E5E5">installing it goes super simple</font><font color="#CCCCCC"> you</font>

434
00:18:12,710 --> 00:18:17,010
download the<font color="#E5E5E5"> script editor line that</font>

435
00:18:15,450 --> 00:18:18,570
<font color="#E5E5E5">tells it what subnet you want to protect</font>

436
00:18:17,010 --> 00:18:20,040
<font color="#E5E5E5">because you</font><font color="#CCCCCC"> obviously don't want</font><font color="#E5E5E5"> to</font>

437
00:18:18,570 --> 00:18:22,169
check every single<font color="#E5E5E5"> packet that</font><font color="#CCCCCC"> goes</font>

438
00:18:20,040 --> 00:18:24,330
across<font color="#E5E5E5"> the</font><font color="#CCCCCC"> network just</font><font color="#E5E5E5"> the hosts that</font>

439
00:18:22,170 --> 00:18:27,360
<font color="#CCCCCC">you want to baseline</font><font color="#E5E5E5"> right and you want</font>

440
00:18:24,330 --> 00:18:29,310
to manage for that so you<font color="#E5E5E5"> do that you</font>

441
00:18:27,360 --> 00:18:32,520
copy it<font color="#E5E5E5"> to wherever your scripts go you</font>

442
00:18:29,310 --> 00:18:35,010
edit a local<font color="#CCCCCC"> Dobrow</font><font color="#E5E5E5"> to calm call</font>

443
00:18:32,520 --> 00:18:38,879
baseline report and restart bro that's

444
00:18:35,010 --> 00:18:44,110
it except we<font color="#E5E5E5"> don't have</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> baseline</font><font color="#CCCCCC"> so</font>

445
00:18:38,880 --> 00:18:47,240
what you'll have<font color="#CCCCCC"> to do is go through</font>

446
00:18:44,110 --> 00:18:47,240
[Music]

447
00:18:47,960 --> 00:18:55,850
that's not going so what<font color="#E5E5E5"> you'll have to</font>

448
00:18:51,570 --> 00:18:59,030
do is hop<font color="#CCCCCC"> into Elsa</font>

449
00:18:55,850 --> 00:18:59,030
[Music]

450
00:19:23,630 --> 00:19:37,110
maybe I'm<font color="#E5E5E5"> just having</font><font color="#CCCCCC"> a terrible day</font>

451
00:19:31,500 --> 00:19:39,090
with computers either<font color="#E5E5E5"> way you'll you'll</font>

452
00:19:37,110 --> 00:19:41,550
hop into Elsa<font color="#CCCCCC"> and you'll</font><font color="#E5E5E5"> just make a</font>

453
00:19:39,090 --> 00:19:45,020
list<font color="#E5E5E5"> of every single port and protocol</font>

454
00:19:41,550 --> 00:19:54,480
that you use based on searches<font color="#E5E5E5"> in</font>

455
00:19:45,020 --> 00:19:56,129
<font color="#E5E5E5">security onion why that sounds like a</font>

456
00:19:54,480 --> 00:20:00,930
lot of work<font color="#CCCCCC"> right I'm not actually</font><font color="#E5E5E5"> going</font>

457
00:19:56,130 --> 00:20:02,490
<font color="#E5E5E5">to do that</font><font color="#CCCCCC"> so what I am going</font><font color="#E5E5E5"> to do yeah</font>

458
00:20:00,930 --> 00:20:04,650
<font color="#E5E5E5">so that was what I</font><font color="#CCCCCC"> wanted to show you</font>

459
00:20:02,490 --> 00:20:06,930
was creating a list like<font color="#E5E5E5"> this</font><font color="#CCCCCC"> by hand</font>

460
00:20:04,650 --> 00:20:08,070
<font color="#CCCCCC">does not sound like</font><font color="#E5E5E5"> fun</font><font color="#CCCCCC"> right every</font>

461
00:20:06,930 --> 00:20:09,900
<font color="#E5E5E5">single port that your</font><font color="#CCCCCC"> domain controller</font>

462
00:20:08,070 --> 00:20:13,889
uses<font color="#E5E5E5"> anybody know how many that is off</font>

463
00:20:09,900 --> 00:20:16,680
the<font color="#CCCCCC"> top of</font><font color="#E5E5E5"> their head</font><font color="#CCCCCC"> 17</font><font color="#E5E5E5"> exactly see</font>

464
00:20:13,890 --> 00:20:18,840
that 17 or 42 right one of the<font color="#CCCCCC"> two you</font>

465
00:20:16,680 --> 00:20:20,640
but no<font color="#CCCCCC"> it's a lot and it's way too</font><font color="#E5E5E5"> much</font>

466
00:20:18,840 --> 00:20:23,040
<font color="#E5E5E5">work to sit down and do it so why don't</font>

467
00:20:20,640 --> 00:20:28,560
I do something<font color="#E5E5E5"> create something</font><font color="#CCCCCC"> that'll</font>

468
00:20:23,040 --> 00:20:30,810
automatically parse the logs<font color="#E5E5E5"> for me so</font>

469
00:20:28,560 --> 00:20:33,570
that's<font color="#E5E5E5"> why I wrote gropey is to parse</font>

470
00:20:30,810 --> 00:20:35,159
those logs<font color="#CCCCCC"> so my baseline</font><font color="#E5E5E5"> report dot my</font>

471
00:20:33,570 --> 00:20:37,439
baseline<font color="#E5E5E5"> report script will create the</font>

472
00:20:35,160 --> 00:20:40,470
logs and then<font color="#CCCCCC"> brophy will parse them and</font>

473
00:20:37,440 --> 00:20:42,870
create that list for you<font color="#CCCCCC"> as far as</font>

474
00:20:40,470 --> 00:20:45,450
<font color="#E5E5E5">generating lists all it is is a yes/no</font>

475
00:20:42,870 --> 00:20:48,840
prompt this connection<font color="#E5E5E5"> was made</font><font color="#CCCCCC"> do you</font>

476
00:20:45,450 --> 00:20:51,750
want it<font color="#E5E5E5"> in your</font><font color="#CCCCCC"> base line</font><font color="#E5E5E5"> yes you do no</font>

477
00:20:48,840 --> 00:20:53,639
you<font color="#E5E5E5"> don't pretty simple right so if you</font>

478
00:20:51,750 --> 00:20:55,230
can't tell<font color="#CCCCCC"> I was in the Army so I had to</font>

479
00:20:53,640 --> 00:20:58,560
keep things<font color="#E5E5E5"> simple so</font><font color="#CCCCCC"> that I</font><font color="#E5E5E5"> wouldn't</font>

480
00:20:55,230 --> 00:21:01,440
<font color="#E5E5E5">like not be able</font><font color="#CCCCCC"> to do it so as far as</font>

481
00:20:58,560 --> 00:21:04,379
my scenario<font color="#CCCCCC"> network goes hopefully my</font>

482
00:21:01,440 --> 00:21:07,230
onion will come back<font color="#E5E5E5"> up but I built this</font>

483
00:21:04,380 --> 00:21:10,560
<font color="#CCCCCC">network with a couple hundred</font><font color="#E5E5E5"> systems a</font>

484
00:21:07,230 --> 00:21:14,160
couple servers<font color="#CCCCCC"> sequel server sharepoint</font>

485
00:21:10,560 --> 00:21:15,810
server<font color="#CCCCCC"> WCS RDP and a DC and I was like</font>

486
00:21:14,160 --> 00:21:17,730
I'm<font color="#E5E5E5"> going to baseline all</font><font color="#CCCCCC"> of this stuff</font>

487
00:21:15,810 --> 00:21:19,260
in an hour

488
00:21:17,730 --> 00:21:20,550
<font color="#CCCCCC">that was the goal was to be able</font><font color="#E5E5E5"> to get</font>

489
00:21:19,260 --> 00:21:21,930
a<font color="#E5E5E5"> list of every single important</font>

490
00:21:20,550 --> 00:21:27,810
<font color="#E5E5E5">protocol that I was actually using in</font>

491
00:21:21,930 --> 00:21:29,990
less than an hour<font color="#E5E5E5"> so that's what bro P</font>

492
00:21:27,810 --> 00:21:29,990
does

493
00:22:11,900 --> 00:22:18,480
<font color="#E5E5E5">so</font><font color="#CCCCCC"> brophy let's do this so all I'm going</font>

494
00:22:17,130 --> 00:22:22,320
to do to go<font color="#E5E5E5"> ahead and install Brophy is</font>

495
00:22:18,480 --> 00:22:26,040
just get clone it<font color="#CCCCCC"> I already</font><font color="#E5E5E5"> have it</font><font color="#CCCCCC"> but</font>

496
00:22:22,320 --> 00:22:27,419
pull it down off github<font color="#CCCCCC"> you've got three</font>

497
00:22:26,040 --> 00:22:30,330
files in there<font color="#E5E5E5"> that you're actually</font>

498
00:22:27,420 --> 00:22:31,830
<font color="#E5E5E5">going to use so baseline data</font><font color="#CCCCCC"> that's</font>

499
00:22:30,330 --> 00:22:32,310
your baseline<font color="#E5E5E5"> that's where</font><font color="#CCCCCC"> that's what</font>

500
00:22:31,830 --> 00:22:34,470
<font color="#E5E5E5">that is</font>

501
00:22:32,310 --> 00:22:36,149
<font color="#E5E5E5">baseline reports the script that</font>

502
00:22:34,470 --> 00:22:37,950
generates all<font color="#CCCCCC"> the alerts</font><font color="#E5E5E5"> and then</font><font color="#CCCCCC"> brophy</font>

503
00:22:36,150 --> 00:22:39,360
is what does all the magic for<font color="#CCCCCC"> us so</font>

504
00:22:37,950 --> 00:22:57,270
that<font color="#E5E5E5"> we don't have to do</font><font color="#CCCCCC"> very much</font><font color="#E5E5E5"> work</font>

505
00:22:39,360 --> 00:23:07,429
so I'm<font color="#E5E5E5"> just going</font><font color="#CCCCCC"> to sudo Brophy oh yeah</font>

506
00:22:57,270 --> 00:23:07,430
<font color="#CCCCCC">oh I'm already root that's awesome</font>

507
00:23:16,600 --> 00:23:20,560
I'm not crazy<font color="#E5E5E5"> right</font>

508
00:23:18,530 --> 00:23:20,560
Oh

509
00:23:21,380 --> 00:23:27,350
<font color="#CCCCCC">Delp I</font><font color="#E5E5E5"> thank you there we go and we</font>

510
00:23:24,650 --> 00:23:29,510
can't read it<font color="#E5E5E5"> because I</font><font color="#CCCCCC"> turn this</font><font color="#E5E5E5"> too</font>

511
00:23:27,350 --> 00:23:32,209
big<font color="#E5E5E5"> but basically</font><font color="#CCCCCC"> it pops you up for the</font>

512
00:23:29,510 --> 00:23:35,990
<font color="#E5E5E5">menu</font><font color="#CCCCCC"> would you rather</font><font color="#E5E5E5"> be able to read it</font>

513
00:23:32,210 --> 00:23:40,460
or make<font color="#E5E5E5"> it look pretty you can read it</font>

514
00:23:35,990 --> 00:23:42,820
<font color="#E5E5E5">okay cool so I've got three options</font>

515
00:23:40,460 --> 00:23:46,280
<font color="#CCCCCC">really I only have two so the first one</font>

516
00:23:42,820 --> 00:23:47,689
<font color="#E5E5E5">this is</font><font color="#CCCCCC"> just for I trust</font><font color="#E5E5E5"> everything in</font>

517
00:23:46,280 --> 00:23:49,250
the network what<font color="#CCCCCC"> it's going to do it's</font>

518
00:23:47,690 --> 00:23:52,850
<font color="#CCCCCC">going</font><font color="#E5E5E5"> to automatically go out and build</font>

519
00:23:49,250 --> 00:23:54,620
you a<font color="#E5E5E5"> baseline based on your bro logs we</font>

520
00:23:52,850 --> 00:23:56,030
don't necessarily<font color="#CCCCCC"> want to automatically</font>

521
00:23:54,620 --> 00:23:57,709
<font color="#E5E5E5">trust everything that's already happened</font>

522
00:23:56,030 --> 00:23:59,810
in<font color="#E5E5E5"> our network right</font><font color="#CCCCCC"> it's</font><font color="#E5E5E5"> probably a bad</font>

523
00:23:57,710 --> 00:24:04,100
<font color="#CCCCCC">thing to do so I</font><font color="#E5E5E5"> would generate this and</font>

524
00:23:59,810 --> 00:24:05,300
then pass it out to<font color="#E5E5E5"> my my server admin</font>

525
00:24:04,100 --> 00:24:07,610
<font color="#CCCCCC">so be like hey are all</font><font color="#E5E5E5"> these ports</font>

526
00:24:05,300 --> 00:24:09,110
actual ports<font color="#E5E5E5"> so now you have</font><font color="#CCCCCC"> fax these</font>

527
00:24:07,610 --> 00:24:10,610
ports<font color="#E5E5E5"> are being used and you can say</font>

528
00:24:09,110 --> 00:24:12,350
sysadmin this is your job

529
00:24:10,610 --> 00:24:13,580
what are these and if you can't answer

530
00:24:12,350 --> 00:24:16,010
you then we probably don't need<font color="#CCCCCC"> to</font><font color="#E5E5E5"> let</font>

531
00:24:13,580 --> 00:24:18,199
them<font color="#CCCCCC"> happen</font><font color="#E5E5E5"> right</font><font color="#CCCCCC"> the second option that</font>

532
00:24:16,010 --> 00:24:20,780
we have<font color="#CCCCCC"> is to step through every single</font>

533
00:24:18,200 --> 00:24:22,460
<font color="#E5E5E5">alert that was generated and</font><font color="#CCCCCC"> then the</font>

534
00:24:20,780 --> 00:24:23,840
third is just<font color="#CCCCCC"> to install</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> so we do</font>

535
00:24:22,460 --> 00:24:26,840
have<font color="#E5E5E5"> to start with install so I'm going</font>

536
00:24:23,840 --> 00:24:28,520
<font color="#E5E5E5">to do three and we tell it what subnet</font>

537
00:24:26,840 --> 00:24:30,169
do we want to watch like I said you

538
00:24:28,520 --> 00:24:31,520
don't<font color="#E5E5E5"> want to check every single packet</font>

539
00:24:30,170 --> 00:24:33,590
you just want<font color="#E5E5E5"> to check the ones that are</font>

540
00:24:31,520 --> 00:24:35,870
important<font color="#E5E5E5"> right we're doing</font><font color="#CCCCCC"> an anima na</font>

541
00:24:33,590 --> 00:24:38,179
<font color="#CCCCCC">mele logging on this one small very very</font>

542
00:24:35,870 --> 00:24:39,590
<font color="#E5E5E5">important piece of our network if I want</font>

543
00:24:38,180 --> 00:24:42,170
five sensors to do five different pieces

544
00:24:39,590 --> 00:24:43,820
<font color="#CCCCCC">I can do that</font><font color="#E5E5E5"> but for this one instance</font>

545
00:24:42,170 --> 00:24:45,320
<font color="#E5E5E5">I want to do just</font><font color="#CCCCCC"> these important ones</font>

546
00:24:43,820 --> 00:24:48,110
<font color="#E5E5E5">so I'm going</font><font color="#CCCCCC"> to go ahead and do my</font>

547
00:24:45,320 --> 00:24:53,810
server subnet<font color="#E5E5E5"> for my lab one five six</font>

548
00:24:48,110 --> 00:24:57,500
<font color="#CCCCCC">twenty 2.11</font><font color="#E5E5E5"> 0/24</font><font color="#CCCCCC"> and you can do multiple</font>

549
00:24:53,810 --> 00:24:58,399
subnets just do<font color="#CCCCCC"> comma-separated</font><font color="#E5E5E5"> and it</font>

550
00:24:57,500 --> 00:25:01,880
becomes easy if you want<font color="#CCCCCC"> to do a</font>

551
00:24:58,400 --> 00:25:03,710
<font color="#CCCCCC">particular host just do a</font><font color="#E5E5E5"> slash 32</font><font color="#CCCCCC"> it's</font>

552
00:25:01,880 --> 00:25:04,820
going to do some checks and<font color="#E5E5E5"> see like you</font>

553
00:25:03,710 --> 00:25:06,230
want to overwrite things that already

554
00:25:04,820 --> 00:25:08,840
<font color="#E5E5E5">exist</font><font color="#CCCCCC"> I'm going to go ahead and</font>

555
00:25:06,230 --> 00:25:10,250
overwrite<font color="#E5E5E5"> things that already exist</font><font color="#CCCCCC"> I'm</font>

556
00:25:08,840 --> 00:25:13,070
going to overwrite my previous script

557
00:25:10,250 --> 00:25:15,830
<font color="#CCCCCC">and then do I want to restart bro</font><font color="#E5E5E5"> so</font>

558
00:25:13,070 --> 00:25:18,070
that that line right<font color="#E5E5E5"> there</font><font color="#CCCCCC"> do</font><font color="#E5E5E5"> you want</font>

559
00:25:15,830 --> 00:25:20,620
to restart bro actually<font color="#CCCCCC"> happened after</font>

560
00:25:18,070 --> 00:25:21,790
<font color="#E5E5E5">I asked my buddy to demo this the tool</font>

561
00:25:20,620 --> 00:25:24,179
for me I was like hey can<font color="#CCCCCC"> you try this</font>

562
00:25:21,790 --> 00:25:26,440
and<font color="#E5E5E5"> they've got like 500 bro installs</font>

563
00:25:24,180 --> 00:25:28,660
across your network<font color="#CCCCCC"> can</font><font color="#E5E5E5"> you run this for</font>

564
00:25:26,440 --> 00:25:30,460
<font color="#CCCCCC">me</font><font color="#E5E5E5"> and he installed it and then it</font>

565
00:25:28,660 --> 00:25:32,950
automatically restarted every single

566
00:25:30,460 --> 00:25:36,100
sensor of his so he has like<font color="#E5E5E5"> an hour</font><font color="#CCCCCC"> of</font>

567
00:25:32,950 --> 00:25:37,840
<font color="#E5E5E5">downtime and I feel really bad about it</font>

568
00:25:36,100 --> 00:25:39,310
but he probably<font color="#E5E5E5"> should have done some</font>

569
00:25:37,840 --> 00:25:40,899
code review before he just ran a random

570
00:25:39,310 --> 00:25:43,300
stuff<font color="#E5E5E5"> on this</font><font color="#CCCCCC"> production</font><font color="#E5E5E5"> network so I</font>

571
00:25:40,900 --> 00:25:45,310
blame me but<font color="#CCCCCC"> I also a little bit I</font>

572
00:25:43,300 --> 00:25:47,560
<font color="#CCCCCC">believed him</font><font color="#E5E5E5"> but so now we have are you</font>

573
00:25:45,310 --> 00:25:49,690
ready to restart bro<font color="#CCCCCC"> that's why that's</font>

574
00:25:47,560 --> 00:25:51,850
there<font color="#CCCCCC"> alright so I installed bro alright</font>

575
00:25:49,690 --> 00:25:53,980
<font color="#CCCCCC">it's all bro P</font><font color="#E5E5E5"> everything is already</font>

576
00:25:51,850 --> 00:25:57,699
configured<font color="#E5E5E5"> for me all I have to do now</font>

577
00:25:53,980 --> 00:26:00,460
<font color="#CCCCCC">is generate some traffic so I've got a</font>

578
00:25:57,700 --> 00:26:02,890
<font color="#E5E5E5">honk baseline</font><font color="#CCCCCC"> P cap</font><font color="#E5E5E5"> and that's just my</font>

579
00:26:00,460 --> 00:26:06,280
my baseline<font color="#E5E5E5"> traffic right it's just</font>

580
00:26:02,890 --> 00:26:22,090
recording<font color="#CCCCCC"> up a week so pseudo I'm are</font>

581
00:26:06,280 --> 00:26:27,399
you<font color="#E5E5E5"> so</font><font color="#CCCCCC"> TCP and I'm going</font><font color="#E5E5E5"> to go ahead and</font>

582
00:26:22,090 --> 00:26:37,379
use<font color="#CCCCCC"> it to replay</font><font color="#E5E5E5"> that traffic</font><font color="#CCCCCC"> so if I</font>

583
00:26:27,400 --> 00:26:37,380
<font color="#E5E5E5">take a look</font><font color="#CCCCCC"> at last /sm brew current</font><font color="#E5E5E5"> I</font>

584
00:26:40,440 --> 00:26:47,340
don't have any laws<font color="#E5E5E5"> and demo gods or</font>

585
00:26:44,500 --> 00:26:47,340
awesome

586
00:26:58,160 --> 00:27:16,710
<font color="#E5E5E5">okay so what I should see here I'm just</font>

587
00:27:15,390 --> 00:27:20,400
<font color="#CCCCCC">going</font><font color="#E5E5E5"> to go ahead and roll on because</font>

588
00:27:16,710 --> 00:27:22,470
this<font color="#E5E5E5"> is going to be a bad</font><font color="#CCCCCC"> day for</font><font color="#E5E5E5"> me so</font>

589
00:27:20,400 --> 00:27:25,830
what<font color="#CCCCCC"> I should</font><font color="#E5E5E5"> see here I've got</font><font color="#CCCCCC"> my</font>

590
00:27:22,470 --> 00:27:27,690
standard<font color="#E5E5E5"> error and my reporter log so</font>

591
00:27:25,830 --> 00:27:32,189
I'm sure I just<font color="#CCCCCC"> crashed bro instead of</font>

592
00:27:27,690 --> 00:27:34,049
installing<font color="#CCCCCC"> it appropriately but what I</font>

593
00:27:32,190 --> 00:27:35,790
should see here is a notice log in that

594
00:27:34,049 --> 00:27:39,830
notice log I'll have a bunch of alerts

595
00:27:35,790 --> 00:27:47,549
that say<font color="#E5E5E5"> non-standard traffic detected</font>

596
00:27:39,830 --> 00:27:49,199
<font color="#E5E5E5">whenever I run bro</font><font color="#CCCCCC"> P again now</font><font color="#E5E5E5"> that I've</font>

597
00:27:47,549 --> 00:27:52,260
actually<font color="#E5E5E5"> ran bro P once I can actually</font>

598
00:27:49,200 --> 00:27:55,500
<font color="#E5E5E5">hit</font><font color="#CCCCCC"> one and it will</font><font color="#E5E5E5"> go through parse all</font>

599
00:27:52,260 --> 00:27:58,500
of my logs<font color="#E5E5E5"> and generate a baseline file</font>

600
00:27:55,500 --> 00:28:00,929
<font color="#E5E5E5">so I'm going to hit yes to restart</font><font color="#CCCCCC"> but</font>

601
00:27:58,500 --> 00:28:05,070
then I'm<font color="#E5E5E5"> also going to go ahead and take</font>

602
00:28:00,929 --> 00:28:24,780
a look at my my new baseline file<font color="#E5E5E5"> so</font>

603
00:28:05,070 --> 00:28:28,710
that'll<font color="#E5E5E5"> be less so I replayed that pcap</font>

604
00:28:24,780 --> 00:28:31,590
and ran<font color="#E5E5E5"> bro P now I have a list of every</font>

605
00:28:28,710 --> 00:28:38,549
<font color="#CCCCCC">single port protocol and destination</font>

606
00:28:31,590 --> 00:28:44,428
host<font color="#E5E5E5"> that that happened in</font><font color="#CCCCCC"> that P cap so</font>

607
00:28:38,549 --> 00:28:48,389
you see ICMP the<font color="#CCCCCC"> 128</font><font color="#E5E5E5"> box got pinged a</font>

608
00:28:44,429 --> 00:28:52,640
lot from a lot<font color="#CCCCCC"> of hosts so I can</font>

609
00:28:48,390 --> 00:28:55,320
<font color="#CCCCCC">actually</font><font color="#E5E5E5"> see that now visibly right</font><font color="#CCCCCC"> and</font>

610
00:28:52,640 --> 00:28:58,500
I didn't have to do any of<font color="#E5E5E5"> this it all</font>

611
00:28:55,320 --> 00:29:03,050
<font color="#CCCCCC">just got created for me really</font><font color="#E5E5E5"> really</font>

612
00:28:58,500 --> 00:29:05,490
nice if I wanted<font color="#E5E5E5"> to go in and maybe so</font>

613
00:29:03,050 --> 00:29:07,649
SMB traffic right<font color="#E5E5E5"> I know it's going to</font>

614
00:29:05,490 --> 00:29:09,630
<font color="#CCCCCC">exist for my entire network</font><font color="#E5E5E5"> I'll see a</font>

615
00:29:07,650 --> 00:29:11,100
bunch of<font color="#E5E5E5"> these one nine two</font><font color="#CCCCCC"> one</font><font color="#E5E5E5"> six</font>

616
00:29:09,630 --> 00:29:14,100
<font color="#E5E5E5">eight what Evers</font><font color="#CCCCCC"> I'll</font><font color="#E5E5E5"> probably change</font>

617
00:29:11,100 --> 00:29:15,689
this /<font color="#E5E5E5"> 30 to using by to be a 24</font>

618
00:29:14,100 --> 00:29:18,149
whatever<font color="#E5E5E5"> my network is so you can go in</font>

619
00:29:15,690 --> 00:29:19,650
and manually do that in the future<font color="#E5E5E5"> it'd</font>

620
00:29:18,150 --> 00:29:21,990
be great if<font color="#E5E5E5"> I had like a bunch of people</font>

621
00:29:19,650 --> 00:29:26,190
<font color="#CCCCCC">that</font><font color="#E5E5E5"> know Python</font><font color="#CCCCCC"> to come help</font><font color="#E5E5E5"> me work on</font>

622
00:29:21,990 --> 00:29:27,510
<font color="#E5E5E5">this and make</font><font color="#CCCCCC"> it better but</font><font color="#E5E5E5"> that we</font>

623
00:29:26,190 --> 00:29:29,370
could do that<font color="#CCCCCC"> right at the command</font><font color="#E5E5E5"> line</font>

624
00:29:27,510 --> 00:29:30,629
say do you want the default 32 or do you

625
00:29:29,370 --> 00:29:32,790
want to put in a custom subnet mask

626
00:29:30,630 --> 00:29:34,920
<font color="#E5E5E5">that's authorized</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> would be great it</font>

627
00:29:32,790 --> 00:29:36,629
wouldn't be too<font color="#CCCCCC"> hard</font><font color="#E5E5E5"> to do but I just</font>

628
00:29:34,920 --> 00:29:38,810
<font color="#CCCCCC">haven't had the time to put it in there</font>

629
00:29:36,630 --> 00:29:38,810
yet

630
00:29:54,480 --> 00:29:59,490
<font color="#E5E5E5">so just to recap my awesomely failed</font>

631
00:29:57,210 --> 00:30:02,070
demo I'm sorry about that

632
00:29:59,490 --> 00:30:05,240
you just get clone change directory into

633
00:30:02,070 --> 00:30:07,980
<font color="#E5E5E5">it and run</font><font color="#CCCCCC"> bro pre tell</font><font color="#E5E5E5"> it to install</font>

634
00:30:05,240 --> 00:30:10,800
<font color="#E5E5E5">once it's done gather your traffic</font>

635
00:30:07,980 --> 00:30:13,830
<font color="#E5E5E5">you'll have logs run bro pre again and</font>

636
00:30:10,800 --> 00:30:16,080
either step through each individual log

637
00:30:13,830 --> 00:30:18,240
and say yes no yes no<font color="#E5E5E5"> or have it Auto</font>

638
00:30:16,080 --> 00:30:19,860
generate and<font color="#E5E5E5"> then manually take a look</font>

639
00:30:18,240 --> 00:30:21,810
at the list<font color="#E5E5E5"> because now instead of</font>

640
00:30:19,860 --> 00:30:23,729
having<font color="#E5E5E5"> to parse through and do searches</font>

641
00:30:21,810 --> 00:30:26,040
<font color="#E5E5E5">you have a list so just</font><font color="#CCCCCC"> go through it</font>

642
00:30:23,730 --> 00:30:27,060
have<font color="#E5E5E5"> your engineers do the work as to</font>

643
00:30:26,040 --> 00:30:30,629
whether<font color="#E5E5E5"> or not people should be</font>

644
00:30:27,060 --> 00:30:33,179
connecting to<font color="#E5E5E5"> those ports and then so</font>

645
00:30:30,630 --> 00:30:35,760
use<font color="#CCCCCC"> cases these</font><font color="#E5E5E5"> are</font><font color="#CCCCCC"> the three things</font>

646
00:30:33,180 --> 00:30:38,220
that<font color="#E5E5E5"> I love that's the one reason why I</font>

647
00:30:35,760 --> 00:30:40,860
wrote the tool<font color="#CCCCCC"> I now have a list</font><font color="#E5E5E5"> of</font>

648
00:30:38,220 --> 00:30:43,530
everything<font color="#E5E5E5"> that's connecting to my</font>

649
00:30:40,860 --> 00:30:45,959
critical resources<font color="#E5E5E5"> I can get alerts</font>

650
00:30:43,530 --> 00:30:47,760
<font color="#E5E5E5">whenever new hosts connect to it or a</font>

651
00:30:45,960 --> 00:30:49,320
new<font color="#E5E5E5"> service pops up right I know we have</font>

652
00:30:47,760 --> 00:30:51,750
that<font color="#CCCCCC"> with like pads and stuff like that</font>

653
00:30:49,320 --> 00:30:53,490
but<font color="#CCCCCC"> I've wanted a lot of</font><font color="#E5E5E5"> things in one</font>

654
00:30:51,750 --> 00:30:57,090
spot<font color="#E5E5E5"> for me and that's why I did it</font>

655
00:30:53,490 --> 00:31:00,120
and then with our baseline<font color="#E5E5E5"> data so I get</font>

656
00:30:57,090 --> 00:31:03,919
this baseline employed and I go a month

657
00:31:00,120 --> 00:31:06,959
without any logs how about I just take

658
00:31:03,920 --> 00:31:08,910
<font color="#CCCCCC">that baseline</font><font color="#E5E5E5"> pass it off to my</font>

659
00:31:06,960 --> 00:31:11,580
engineering team on the networking side

660
00:31:08,910 --> 00:31:14,250
<font color="#E5E5E5">and say this is the only traffic that's</font>

661
00:31:11,580 --> 00:31:17,429
allowed to<font color="#CCCCCC"> happen to go into our network</font>

662
00:31:14,250 --> 00:31:20,460
just<font color="#E5E5E5"> these and then somebody is probably</font>

663
00:31:17,430 --> 00:31:22,740
your your your CIO he's gonna be like<font color="#CCCCCC"> uh</font>

664
00:31:20,460 --> 00:31:24,870
so but<font color="#E5E5E5"> is that going to break anything</font>

665
00:31:22,740 --> 00:31:27,030
<font color="#E5E5E5">because the website has to say up and</font>

666
00:31:24,870 --> 00:31:29,399
<font color="#E5E5E5">you'll be</font><font color="#CCCCCC"> like I can guarantee</font><font color="#E5E5E5"> you that</font>

667
00:31:27,030 --> 00:31:32,460
nothing<font color="#E5E5E5"> will be</font><font color="#CCCCCC"> broken</font><font color="#E5E5E5"> because</font><font color="#CCCCCC"> I haven't</font>

668
00:31:29,400 --> 00:31:35,520
<font color="#E5E5E5">had any alerts in a month</font><font color="#CCCCCC"> and nobody's</font>

669
00:31:32,460 --> 00:31:37,470
using<font color="#E5E5E5"> any ports other than these so you</font>

670
00:31:35,520 --> 00:31:40,530
can<font color="#E5E5E5"> guarantee your CIO</font>

671
00:31:37,470 --> 00:31:42,270
<font color="#E5E5E5">we are only using</font><font color="#CCCCCC"> these ports</font><font color="#E5E5E5"> if you</font>

672
00:31:40,530 --> 00:31:48,920
have a list of all the<font color="#E5E5E5"> ports that</font><font color="#CCCCCC"> you</font>

673
00:31:42,270 --> 00:32:12,240
use so that's that's that<font color="#E5E5E5"> any questions</font>

674
00:31:48,920 --> 00:32:13,890
<font color="#E5E5E5">okay in the back yeah so if if you're</font>

675
00:32:12,240 --> 00:32:16,620
<font color="#E5E5E5">really good at machine learning and</font>

676
00:32:13,890 --> 00:32:20,490
those type of<font color="#CCCCCC"> maps</font><font color="#E5E5E5"> you can</font><font color="#CCCCCC"> totally come</font>

677
00:32:16,620 --> 00:32:23,040
help me<font color="#E5E5E5"> make this better like like so</font>

678
00:32:20,490 --> 00:32:24,270
that's that's the<font color="#CCCCCC"> thing right</font><font color="#E5E5E5"> is and I</font>

679
00:32:23,040 --> 00:32:25,830
say this all<font color="#CCCCCC"> the time to my students</font>

680
00:32:24,270 --> 00:32:28,110
it's like I'm just<font color="#E5E5E5"> a guy playing with</font>

681
00:32:25,830 --> 00:32:29,399
<font color="#CCCCCC">Legos right now and so I know a</font><font color="#E5E5E5"> little</font>

682
00:32:28,110 --> 00:32:33,330
<font color="#E5E5E5">bit of</font><font color="#CCCCCC"> this and a little</font><font color="#E5E5E5"> bit of this and</font>

683
00:32:29,400 --> 00:32:36,960
it will<font color="#E5E5E5"> solve my problem</font><font color="#CCCCCC"> it might</font><font color="#E5E5E5"> not be</font>

684
00:32:33,330 --> 00:32:38,460
the<font color="#CCCCCC"> $50.00 Deathstar Lego kit</font><font color="#E5E5E5"> mine's</font>

685
00:32:36,960 --> 00:32:40,050
actually<font color="#CCCCCC"> a</font><font color="#E5E5E5"> bunch of blue and green Legos</font>

686
00:32:38,460 --> 00:32:42,810
but I think it<font color="#E5E5E5"> looks like the Death Star</font>

687
00:32:40,050 --> 00:32:45,180
<font color="#E5E5E5">so that's uh that's but yeah I love the</font>

688
00:32:42,810 --> 00:32:46,409
idea<font color="#E5E5E5"> and as soon as I can find</font><font color="#CCCCCC"> somebody</font>

689
00:32:45,180 --> 00:32:48,740
<font color="#E5E5E5">to help me with</font><font color="#CCCCCC"> it that would be</font><font color="#E5E5E5"> amazing</font>

690
00:32:46,410 --> 00:32:48,740
<font color="#CCCCCC">okay</font>

691
00:33:00,500 --> 00:33:12,950
right okay<font color="#E5E5E5"> cool</font>

692
00:33:11,000 --> 00:33:21,650
yeah no I<font color="#E5E5E5"> would love to hear</font><font color="#CCCCCC"> more about</font>

693
00:33:12,950 --> 00:33:24,530
that<font color="#E5E5E5"> so anybody else yeah so it's</font>

694
00:33:21,650 --> 00:33:26,630
creating<font color="#CCCCCC"> new logs</font><font color="#E5E5E5"> somebody brought</font><font color="#CCCCCC"> it up</font>

695
00:33:24,530 --> 00:33:29,658
<font color="#CCCCCC">the</font><font color="#E5E5E5"> other day we do a nerd night</font><font color="#CCCCCC"> in</font>

696
00:33:26,630 --> 00:33:31,190
<font color="#E5E5E5">Augusta every couple weeks</font><font color="#CCCCCC"> and somebody</font>

697
00:33:29,659 --> 00:33:32,900
was like well but you're<font color="#E5E5E5"> putting your</font>

698
00:33:31,190 --> 00:33:34,280
own thing that<font color="#E5E5E5"> makes these alerts but</font>

699
00:33:32,900 --> 00:33:37,240
how<font color="#CCCCCC"> about you just</font><font color="#E5E5E5"> read the bro logs</font>

700
00:33:34,280 --> 00:33:39,080
that already<font color="#CCCCCC"> exist and</font><font color="#E5E5E5"> so that's a</font>

701
00:33:37,240 --> 00:33:40,970
definite feature that I'm going<font color="#CCCCCC"> to try</font>

702
00:33:39,080 --> 00:33:42,649
and get<font color="#E5E5E5"> in soon because yeah initially</font>

703
00:33:40,970 --> 00:33:44,780
<font color="#CCCCCC">just read all the old bro logs</font><font color="#E5E5E5"> and then</font>

704
00:33:42,650 --> 00:33:47,710
now you can<font color="#E5E5E5"> have the anomaly logging but</font>

705
00:33:44,780 --> 00:33:52,990
yeah<font color="#E5E5E5"> so that would have</font><font color="#CCCCCC"> been way easier</font>

706
00:33:47,710 --> 00:34:08,750
<font color="#E5E5E5">so anybody else</font>

707
00:33:52,990 --> 00:34:11,440
okay<font color="#E5E5E5"> I'm yes</font>

708
00:34:08,750 --> 00:34:15,349
so what<font color="#CCCCCC"> end date right my initial</font>

709
00:34:11,440 --> 00:34:17,570
baseline<font color="#CCCCCC"> data</font><font color="#E5E5E5"> file had the name of the</font>

710
00:34:15,349 --> 00:34:20,359
service<font color="#E5E5E5"> the hash of the binary</font><font color="#CCCCCC"> that was</font>

711
00:34:17,570 --> 00:34:21,649
actually hosting the service<font color="#E5E5E5"> like like</font>

712
00:34:20,359 --> 00:34:25,009
that<font color="#CCCCCC"> kind of thing and my goal was to</font>

713
00:34:21,649 --> 00:34:27,199
<font color="#E5E5E5">have you</font><font color="#CCCCCC"> run bro be with creds and it</font>

714
00:34:25,010 --> 00:34:29,389
reaches out and contacts does a net stat

715
00:34:27,199 --> 00:34:31,279
pulls down<font color="#CCCCCC"> the hash of the file and then</font>

716
00:34:29,389 --> 00:34:32,450
brings it back in and it's like okay<font color="#E5E5E5"> not</font>

717
00:34:31,280 --> 00:34:36,409
<font color="#E5E5E5">only should those be</font><font color="#CCCCCC"> the only things</font>

718
00:34:32,449 --> 00:34:39,290
<font color="#CCCCCC">that</font><font color="#E5E5E5"> are listening but those they should</font>

719
00:34:36,409 --> 00:34:42,020
be hosted by this particular hash for

720
00:34:39,290 --> 00:34:46,668
this service<font color="#CCCCCC"> right that that</font><font color="#E5E5E5"> would have</font>

721
00:34:42,020 --> 00:34:49,520
<font color="#CCCCCC">been super cool but yeah thank you</font><font color="#E5E5E5"> for</font>

722
00:34:46,668 --> 00:34:50,868
<font color="#CCCCCC">your</font><font color="#E5E5E5"> question anybody else</font><font color="#CCCCCC"> I'm going to</font>

723
00:34:49,520 --> 00:34:57,230
see if I can get this to<font color="#CCCCCC"> work now that I</font>

724
00:34:50,869 --> 00:34:59,080
<font color="#E5E5E5">snapshot it you</font><font color="#CCCCCC"> know okay well thank you</font>

725
00:34:57,230 --> 00:35:01,430
<font color="#E5E5E5">for your time</font>

726
00:34:59,080 --> 00:35:03,140
if you want to stay<font color="#E5E5E5"> and watch</font><font color="#CCCCCC"> me try</font><font color="#E5E5E5"> and</font>

727
00:35:01,430 --> 00:35:05,029
fix<font color="#E5E5E5"> this you can</font><font color="#CCCCCC"> you're not</font><font color="#E5E5E5"> going to</font>

728
00:35:03,140 --> 00:35:07,868
hurt<font color="#E5E5E5"> my feelings</font><font color="#CCCCCC"> you get up and throw</font>

729
00:35:05,030 --> 00:35:07,869
stuff and walk away

730
00:35:10,700 --> 00:35:19,049
[Applause]

