1
00:00:00,000 --> 00:00:05,520
it's my pleasure to introduce you to our

2
00:00:03,030 --> 00:00:07,770
next speaker Casey Martin Casey Martin

3
00:00:05,520 --> 00:00:09,690
information security professional with

4
00:00:07,770 --> 00:00:10,740
the curiosity for enabling Blue Team

5
00:00:09,690 --> 00:00:13,110
operations

6
00:00:10,740 --> 00:00:15,089
he's operated in all technical aspects

7
00:00:13,110 --> 00:00:16,500
of information security as well as

8
00:00:15,089 --> 00:00:19,590
leading the consumer and valent

9
00:00:16,500 --> 00:00:22,640
enablement effort as the director of

10
00:00:19,590 --> 00:00:26,310
security operations for some of merit

11
00:00:22,640 --> 00:00:27,869
I'm messing this up sorry Casey for some

12
00:00:26,310 --> 00:00:29,820
of the world's most trusted brands

13
00:00:27,869 --> 00:00:31,679
rather than mess it up any further it's

14
00:00:29,820 --> 00:00:39,120
my pleasure to introduce you to Casey

15
00:00:31,679 --> 00:00:41,519
Martin good morning everyone thanks for

16
00:00:39,120 --> 00:00:43,140
having me if I'm already yelling in the

17
00:00:41,520 --> 00:00:45,180
mic I'm gonna try to speak loud enough

18
00:00:43,140 --> 00:00:46,710
that hopefully you guys can hear me but

19
00:00:45,180 --> 00:00:48,989
if not in the back you guys can still

20
00:00:46,710 --> 00:00:50,070
use the headset but again thanks for

21
00:00:48,989 --> 00:00:51,839
having me out here at the conference

22
00:00:50,070 --> 00:00:53,820
today really happy to talk to you guys

23
00:00:51,840 --> 00:00:56,789
about how to fingerprint an enterprise

24
00:00:53,820 --> 00:00:57,930
network from a blue team perspective in

25
00:00:56,789 --> 00:01:00,359
something when I'm calling Network

26
00:00:57,930 --> 00:01:02,489
gravity so real quick going a little bit

27
00:01:00,359 --> 00:01:04,409
more in depth about my background and

28
00:01:02,489 --> 00:01:07,679
why this 12 year old is up in front of

29
00:01:04,409 --> 00:01:10,650
you guys speaking so in my six years in

30
00:01:07,680 --> 00:01:12,450
the professional world I've been working

31
00:01:10,650 --> 00:01:13,830
with roll a quest working with you know

32
00:01:12,450 --> 00:01:16,710
numerous customers at the enterprise

33
00:01:13,830 --> 00:01:18,420
level in capacities such as directory

34
00:01:16,710 --> 00:01:21,240
security operations overseeing our

35
00:01:18,420 --> 00:01:24,090
entire stock analyst engineering threat

36
00:01:21,240 --> 00:01:26,280
management and most recently working as

37
00:01:24,090 --> 00:01:27,960
our director of threat management which

38
00:01:26,280 --> 00:01:29,759
oversees our red team threat

39
00:01:27,960 --> 00:01:32,850
intelligence attack and breach

40
00:01:29,759 --> 00:01:34,380
simulation and lastly the content

41
00:01:32,850 --> 00:01:35,880
research and development so how can you

42
00:01:34,380 --> 00:01:39,810
detect threats in your network and

43
00:01:35,880 --> 00:01:41,520
provide good content around that as

44
00:01:39,810 --> 00:01:42,659
mentioned I'm security focused

45
00:01:41,520 --> 00:01:44,700
definitely on the Blues team side of

46
00:01:42,659 --> 00:01:47,579
things and I have a love for automation

47
00:01:44,700 --> 00:01:49,470
I hate doing the same thing twice so

48
00:01:47,579 --> 00:01:51,689
when possible I'm gonna try to script

49
00:01:49,470 --> 00:01:53,009
that and try to figure out how I can can

50
00:01:51,689 --> 00:01:55,949
make that so I don't have to do that the

51
00:01:53,009 --> 00:01:58,380
same thing twice not great at it but I

52
00:01:55,950 --> 00:02:00,119
love scripting so and lastly as you guys

53
00:01:58,380 --> 00:02:03,298
will see here and what I call it the bad

54
00:02:00,119 --> 00:02:05,700
analogy expert I love trying to tie

55
00:02:03,299 --> 00:02:06,869
things back to normal human terms try to

56
00:02:05,700 --> 00:02:09,810
take it the layman terms such that

57
00:02:06,869 --> 00:02:12,209
anyone can understand me so without

58
00:02:09,810 --> 00:02:13,650
further ado real quick I feel like I

59
00:02:12,209 --> 00:02:14,579
have to say these

60
00:02:13,650 --> 00:02:15,780
quick disclaimers none of the

61
00:02:14,579 --> 00:02:16,950
information above material views

62
00:02:15,780 --> 00:02:19,290
contained within the presentation

63
00:02:16,950 --> 00:02:22,439
represents that of my employer or peers

64
00:02:19,290 --> 00:02:24,798
and secondly the knowledge methods

65
00:02:22,439 --> 00:02:26,489
presented are based on generalizations

66
00:02:24,799 --> 00:02:28,560
everything that I'm going to say here is

67
00:02:26,489 --> 00:02:30,150
highly assumption based I think they're

68
00:02:28,560 --> 00:02:31,950
high probability assumptions which is

69
00:02:30,150 --> 00:02:33,180
why I'm here to present but again you

70
00:02:31,950 --> 00:02:35,578
should not make a Thorat ativ

71
00:02:33,180 --> 00:02:37,650
conclusions off this alone please

72
00:02:35,579 --> 00:02:39,540
confirm with other sources in your

73
00:02:37,650 --> 00:02:45,090
environment your network admins your

74
00:02:39,540 --> 00:02:46,739
other teams just admins etc so real

75
00:02:45,090 --> 00:02:48,810
quick why am i calling this network

76
00:02:46,739 --> 00:02:50,310
gravity well one late night watching the

77
00:02:48,810 --> 00:02:51,269
interstellar if you guys have seen the

78
00:02:50,310 --> 00:02:52,440
movie great movie

79
00:02:51,269 --> 00:02:55,170
highly recommended with Matthew

80
00:02:52,440 --> 00:02:56,340
McConaughey had a few drinks me so of

81
00:02:55,170 --> 00:02:58,500
course I'm working and just getting

82
00:02:56,340 --> 00:03:00,000
creative and they were talking about

83
00:02:58,500 --> 00:03:03,480
theory and they're talking about gravity

84
00:03:00,000 --> 00:03:05,400
and it kind of took me back to black

85
00:03:03,480 --> 00:03:08,069
holes and while we can't see a black

86
00:03:05,400 --> 00:03:10,650
hole we can see the forces it exerts on

87
00:03:08,069 --> 00:03:11,970
things around it that we can observe so

88
00:03:10,650 --> 00:03:14,400
if we can observe certain things that we

89
00:03:11,970 --> 00:03:15,659
can see how certain things are acting we

90
00:03:14,400 --> 00:03:16,769
know in this case the planets were

91
00:03:15,659 --> 00:03:19,138
gravitating towards those black holes

92
00:03:16,769 --> 00:03:20,609
and if you start calculating all those

93
00:03:19,139 --> 00:03:23,250
planets around it and you start to add

94
00:03:20,609 --> 00:03:25,709
up all those vectors of gravity you can

95
00:03:23,250 --> 00:03:27,329
start to determine size mass location of

96
00:03:25,709 --> 00:03:29,040
these things that you cannot directly

97
00:03:27,329 --> 00:03:31,349
observe so while you can't observe

98
00:03:29,040 --> 00:03:34,620
something directly the theory is you can

99
00:03:31,349 --> 00:03:38,369
see that and how it forces other objects

100
00:03:34,620 --> 00:03:39,900
around it so bear with me through this

101
00:03:38,370 --> 00:03:41,940
presentation you may see me looking a

102
00:03:39,900 --> 00:03:43,409
little bit like Charlie tying strings

103
00:03:41,940 --> 00:03:45,810
across the board calculating this all

104
00:03:43,409 --> 00:03:48,510
out but I promise you it's hopefully a

105
00:03:45,810 --> 00:03:50,129
little bit more sane than that so my

106
00:03:48,510 --> 00:03:52,349
theory is that a network is no different

107
00:03:50,129 --> 00:03:54,510
there are objects on the network that

108
00:03:52,349 --> 00:03:56,760
exert forces and generate whether its

109
00:03:54,510 --> 00:03:59,280
network traffic processes login requests

110
00:03:56,760 --> 00:04:01,888
etc and while you may not be able to see

111
00:03:59,280 --> 00:04:03,810
the true source of that activity you can

112
00:04:01,889 --> 00:04:06,120
see the objects that it's acting upon

113
00:04:03,810 --> 00:04:07,799
and start to calculate backwards to get

114
00:04:06,120 --> 00:04:11,790
a conclusion of what you have for an end

115
00:04:07,799 --> 00:04:14,400
point based for user base etc and couple

116
00:04:11,790 --> 00:04:16,289
quick examples there but I'll go further

117
00:04:14,400 --> 00:04:17,340
into those examples and walk through in

118
00:04:16,289 --> 00:04:22,108
a second here because that'll be the

119
00:04:17,339 --> 00:04:23,900
bulk of this talk and so why is this

120
00:04:22,108 --> 00:04:26,820
matter right it's not just something fun

121
00:04:23,900 --> 00:04:27,989
but it serves a purpose

122
00:04:26,820 --> 00:04:30,630
all of us on the blue team side of

123
00:04:27,990 --> 00:04:32,850
things have a responsibility to drive

124
00:04:30,630 --> 00:04:35,219
visibility into our environments if you

125
00:04:32,850 --> 00:04:37,560
can't see something you can't protect it

126
00:04:35,220 --> 00:04:38,670
if you don't have logs from you

127
00:04:37,560 --> 00:04:40,550
endpoints whether it's the

128
00:04:38,670 --> 00:04:42,680
authentication attempts you're a virus

129
00:04:40,550 --> 00:04:45,030
network traffic those endpoints

130
00:04:42,680 --> 00:04:47,310
there's no good right you can't do

131
00:04:45,030 --> 00:04:49,619
anything about it so this is really an

132
00:04:47,310 --> 00:04:52,920
attempt to try to drive initiative in

133
00:04:49,620 --> 00:04:56,070
ourselves to try to find those answers

134
00:04:52,920 --> 00:04:57,390
of what exists and what can I see prior

135
00:04:56,070 --> 00:05:00,450
to just like going out there and asking

136
00:04:57,390 --> 00:05:02,010
there's nothing worse than having

137
00:05:00,450 --> 00:05:03,900
someone come up to you and ask you a

138
00:05:02,010 --> 00:05:05,789
question and your first answer every

139
00:05:03,900 --> 00:05:07,650
first question back then is did you try

140
00:05:05,790 --> 00:05:09,900
googling this first and if they say no

141
00:05:07,650 --> 00:05:12,750
it's very frustrating you want someone

142
00:05:09,900 --> 00:05:14,969
to take that initiative and I think the

143
00:05:12,750 --> 00:05:16,530
the quote says it best that Murphy's law

144
00:05:14,970 --> 00:05:18,720
states that the best way to get the

145
00:05:16,530 --> 00:05:20,369
right answer on the Internet is not to

146
00:05:18,720 --> 00:05:21,960
ask a question but it's to post the

147
00:05:20,370 --> 00:05:24,300
wrong answer what are some examples

148
00:05:21,960 --> 00:05:26,190
you've seen with this first response

149
00:05:24,300 --> 00:05:27,840
that's actually not the right law it's

150
00:05:26,190 --> 00:05:29,190
Cunningham's law murphy's law states

151
00:05:27,840 --> 00:05:31,500
that anything that can go wrong will go

152
00:05:29,190 --> 00:05:34,200
wrong I think that kind of frames up

153
00:05:31,500 --> 00:05:35,670
this discussion right I mean you go out

154
00:05:34,200 --> 00:05:37,320
there and just ask a question but

155
00:05:35,670 --> 00:05:39,840
they're gonna look at you as if you

156
00:05:37,320 --> 00:05:41,700
didn't try to help yourself and why

157
00:05:39,840 --> 00:05:43,919
should they then try to help you right

158
00:05:41,700 --> 00:05:46,860
if they see that you're trying to go and

159
00:05:43,920 --> 00:05:49,800
get 90% of the way there they're much

160
00:05:46,860 --> 00:05:51,600
more gonna be able to react and say I

161
00:05:49,800 --> 00:05:54,030
want to help you I'm gonna get you the

162
00:05:51,600 --> 00:05:56,190
last 10% it makes it look like you did

163
00:05:54,030 --> 00:05:58,349
some of the work so a couple examples

164
00:05:56,190 --> 00:06:00,360
where that's that's powerful right new

165
00:05:58,350 --> 00:06:02,640
employees you're new to an organization

166
00:06:00,360 --> 00:06:04,620
and you don't know what this network

167
00:06:02,640 --> 00:06:06,330
looks like it's you don't wanna be that

168
00:06:04,620 --> 00:06:07,710
new guy walking around asking every

169
00:06:06,330 --> 00:06:08,940
single question in the book what does

170
00:06:07,710 --> 00:06:10,739
the network look like how is traffic

171
00:06:08,940 --> 00:06:12,620
flowing one of the egress points do we

172
00:06:10,740 --> 00:06:16,710
have antivirus installed on every asset

173
00:06:12,620 --> 00:06:17,760
for asset management a single person

174
00:06:16,710 --> 00:06:20,520
here says they have perfect asset

175
00:06:17,760 --> 00:06:21,840
management please raise your hands I'm

176
00:06:20,520 --> 00:06:23,969
gonna assume I don't see a single hand

177
00:06:21,840 --> 00:06:26,190
because no one does it's a sever

178
00:06:23,970 --> 00:06:28,740
difficult challenge and lastly

179
00:06:26,190 --> 00:06:30,990
organizational bureaucracy in my world

180
00:06:28,740 --> 00:06:33,690
is prior director security operations

181
00:06:30,990 --> 00:06:35,640
and now director of threat management we

182
00:06:33,690 --> 00:06:37,500
work with customers customers sometimes

183
00:06:35,640 --> 00:06:38,940
feel threatened that we're coming in to

184
00:06:37,500 --> 00:06:40,160
take their job and that that's just not

185
00:06:38,940 --> 00:06:42,320
the case we're

186
00:06:40,160 --> 00:06:44,060
we there to help them we want to help

187
00:06:42,320 --> 00:06:46,550
them drive visibility into organizations

188
00:06:44,060 --> 00:06:48,980
but it's no different you know us being

189
00:06:46,550 --> 00:06:52,190
a client or our clients and us being

190
00:06:48,980 --> 00:06:54,110
kind of the service provider but even

191
00:06:52,190 --> 00:06:56,000
within organizations very very large

192
00:06:54,110 --> 00:06:58,550
organizations do not want to tell you

193
00:06:56,000 --> 00:07:00,740
certain things against us admins may not

194
00:06:58,550 --> 00:07:02,630
want to give you know security teams

195
00:07:00,740 --> 00:07:04,460
access to their boxes it's gonna ruin

196
00:07:02,630 --> 00:07:05,870
and make their jobs harder so all these

197
00:07:04,460 --> 00:07:07,909
things kind of add up to making it very

198
00:07:05,870 --> 00:07:10,040
hard to share information in a world

199
00:07:07,910 --> 00:07:13,940
where we really should be sharing tons

200
00:07:10,040 --> 00:07:16,120
of information so again like I said I

201
00:07:13,940 --> 00:07:18,650
want this to be a very interactive

202
00:07:16,120 --> 00:07:19,820
walkthrough and basically explain some

203
00:07:18,650 --> 00:07:21,500
of these crazy theories so you're not

204
00:07:19,820 --> 00:07:24,170
just seeing me talk theory but you're

205
00:07:21,500 --> 00:07:25,790
seeing it in practice so I'm actually

206
00:07:24,170 --> 00:07:28,430
did this with a customer of ours a real

207
00:07:25,790 --> 00:07:31,070
customer it's a customer that I was not

208
00:07:28,430 --> 00:07:35,120
familiar with in my capacity at any time

209
00:07:31,070 --> 00:07:36,380
it relaxed was I only leveraged public

210
00:07:35,120 --> 00:07:38,060
knowledge about that organization so

211
00:07:36,380 --> 00:07:39,890
anything I could Google on their

212
00:07:38,060 --> 00:07:40,370
Wikipedia page on their LinkedIn page is

213
00:07:39,890 --> 00:07:43,700
fair game

214
00:07:40,370 --> 00:07:45,620
anything else didn't do it and lastly I

215
00:07:43,700 --> 00:07:47,360
am gonna show screenshots and there is

216
00:07:45,620 --> 00:07:49,550
gonna be a couple like ruff-ruff Network

217
00:07:47,360 --> 00:07:51,800
diagrams from what I was able to find

218
00:07:49,550 --> 00:07:54,530
but I guarantee you're not going to tell

219
00:07:51,800 --> 00:07:56,660
the organization's identity if you're

220
00:07:54,530 --> 00:07:58,099
thinking it looks like your network it's

221
00:07:56,660 --> 00:08:00,410
probably because again these assumptions

222
00:07:58,100 --> 00:08:01,850
or high probability assumptions there

223
00:08:00,410 --> 00:08:03,260
are things that are very common in

224
00:08:01,850 --> 00:08:05,000
almost every single one of our customer

225
00:08:03,260 --> 00:08:07,099
environments and I could replicate this

226
00:08:05,000 --> 00:08:11,500
this experiment over and over and get a

227
00:08:07,100 --> 00:08:13,880
lot of the same results so real quick

228
00:08:11,500 --> 00:08:15,410
what is the organization that I tried

229
00:08:13,880 --> 00:08:17,480
this for well in the purpose I'm going

230
00:08:15,410 --> 00:08:20,840
to call it the Acme organization they

231
00:08:17,480 --> 00:08:24,470
are a retail company with 500 plus

232
00:08:20,840 --> 00:08:26,359
stores nationally across the u.s. they

233
00:08:24,470 --> 00:08:30,710
are very very small stores you know a

234
00:08:26,360 --> 00:08:33,080
couple endpoints per store LinkedIn says

235
00:08:30,710 --> 00:08:34,699
they have roughly 20,000 employees most

236
00:08:33,080 --> 00:08:36,560
of them retail with only a thousand of

237
00:08:34,700 --> 00:08:40,039
those employees roughly at their

238
00:08:36,559 --> 00:08:43,098
corporate location so that's my that's

239
00:08:40,039 --> 00:08:44,689
my starting point so what am I going to

240
00:08:43,099 --> 00:08:47,300
do right I want to walk you through a

241
00:08:44,690 --> 00:08:48,950
couple of steps that have time here to

242
00:08:47,300 --> 00:08:52,400
talk today but I really do think this is

243
00:08:48,950 --> 00:08:53,640
an endless possibility and what it

244
00:08:52,400 --> 00:08:55,860
starts with is you gotta have

245
00:08:53,640 --> 00:08:57,930
to a sim which is essentially our Google

246
00:08:55,860 --> 00:09:00,090
for this purposes or a carbon black or

247
00:08:57,930 --> 00:09:01,880
an endpoint detection tool something

248
00:09:00,090 --> 00:09:04,110
that has a good repository of logs

249
00:09:01,880 --> 00:09:05,880
something that you know most large

250
00:09:04,110 --> 00:09:07,470
organizations have and as a secured

251
00:09:05,880 --> 00:09:09,390
provider you have access to that right

252
00:09:07,470 --> 00:09:11,250
we're going one step beyond red team red

253
00:09:09,390 --> 00:09:13,680
team has to work for it we're given all

254
00:09:11,250 --> 00:09:14,670
that right away which is pretty cool so

255
00:09:13,680 --> 00:09:16,949
you'll see a couple different steps in

256
00:09:14,670 --> 00:09:18,990
the walkthrough first identified to make

257
00:09:16,950 --> 00:09:21,090
choice every organization has two main

258
00:09:18,990 --> 00:09:22,410
controllers and if I can tell you one

259
00:09:21,090 --> 00:09:24,210
thing that I see common across all

260
00:09:22,410 --> 00:09:26,189
organizations we work with those the

261
00:09:24,210 --> 00:09:27,900
main controllers are logged so the one

262
00:09:26,190 --> 00:09:30,000
thing that I feel like companies are

263
00:09:27,900 --> 00:09:33,360
mostly 100% on is their domain

264
00:09:30,000 --> 00:09:36,150
controllers endpoints servers security

265
00:09:33,360 --> 00:09:38,910
technologies those are hit or miss but

266
00:09:36,150 --> 00:09:41,370
to make toys are almost always there so

267
00:09:38,910 --> 00:09:42,990
working back from that that output of

268
00:09:41,370 --> 00:09:44,460
that query of what to make choices they

269
00:09:42,990 --> 00:09:45,960
have I'm going to take and start to

270
00:09:44,460 --> 00:09:49,520
identify targets authenticating that

271
00:09:45,960 --> 00:09:52,020
what domain join systems do they have

272
00:09:49,520 --> 00:09:53,430
work my way down start to say are those

273
00:09:52,020 --> 00:09:54,600
systems logging do I have visibility

274
00:09:53,430 --> 00:09:56,520
into those systems that I believe your

275
00:09:54,600 --> 00:09:57,720
domain joined start to create some

276
00:09:56,520 --> 00:09:58,860
percentages of what I see what I don't

277
00:09:57,720 --> 00:10:00,860
see

278
00:09:58,860 --> 00:10:03,570
and then lastly kind of go towards more

279
00:10:00,860 --> 00:10:04,740
network traffic can I see egress traffic

280
00:10:03,570 --> 00:10:06,570
for those everything's connected

281
00:10:04,740 --> 00:10:08,480
can I see it talking to the Internet do

282
00:10:06,570 --> 00:10:11,370
I have coverage there and lastly

283
00:10:08,480 --> 00:10:13,170
internal traffic any antivirus updates

284
00:10:11,370 --> 00:10:15,240
can I see east-west traffic between

285
00:10:13,170 --> 00:10:17,250
these endpoints and lastly do I have

286
00:10:15,240 --> 00:10:18,780
good antivirus coverage you may have the

287
00:10:17,250 --> 00:10:21,720
best EDR in the world but if it's

288
00:10:18,780 --> 00:10:23,130
deployed to ten workstations it's no

289
00:10:21,720 --> 00:10:27,150
good right we want we want total

290
00:10:23,130 --> 00:10:28,800
coverage so like I said the first step

291
00:10:27,150 --> 00:10:30,660
I'm gonna watch through the assumptions

292
00:10:28,800 --> 00:10:32,160
and in my interpretation of what I

293
00:10:30,660 --> 00:10:34,110
believe you can conclude from this so

294
00:10:32,160 --> 00:10:35,850
the first assumption to make shoulders

295
00:10:34,110 --> 00:10:38,340
are one of the most common ly log

296
00:10:35,850 --> 00:10:40,200
systems in the environment and I know

297
00:10:38,340 --> 00:10:44,790
that Kerberos requests generates certain

298
00:10:40,200 --> 00:10:46,830
event IDs looking at that we can start

299
00:10:44,790 --> 00:10:49,050
to interpret that data right we're gonna

300
00:10:46,830 --> 00:10:51,060
start to see those servers logging in

301
00:10:49,050 --> 00:10:53,130
the environment and based on IP address

302
00:10:51,060 --> 00:10:55,079
ranges naming conventions things like

303
00:10:53,130 --> 00:10:57,540
that you can start to identify primary

304
00:10:55,080 --> 00:10:59,580
and secondary pairs and things like that

305
00:10:57,540 --> 00:11:00,900
you can start to identify you know based

306
00:10:59,580 --> 00:11:02,970
on the IP addresses you'll see further

307
00:11:00,900 --> 00:11:04,439
in but maybe what server or what network

308
00:11:02,970 --> 00:11:06,120
are they in the data center are they in

309
00:11:04,440 --> 00:11:07,209
data center - are they in a headquarter

310
00:11:06,120 --> 00:11:09,009
location do that

311
00:11:07,209 --> 00:11:11,618
domain controllers per branch you can

312
00:11:09,009 --> 00:11:13,480
start to identify all that and the

313
00:11:11,619 --> 00:11:15,249
volume of Kerberos requests indicates

314
00:11:13,480 --> 00:11:16,839
utilization if you got you know a couple

315
00:11:15,249 --> 00:11:18,879
hundred a day it's probably not being

316
00:11:16,839 --> 00:11:20,439
used for the enterprise but again if

317
00:11:18,879 --> 00:11:25,720
you're getting tens of thousands it's

318
00:11:20,439 --> 00:11:27,339
all your primary versus a test system so

319
00:11:25,720 --> 00:11:29,499
let's go Splunk whelk is the easiest so

320
00:11:27,339 --> 00:11:30,759
I just tended to use it for this one but

321
00:11:29,499 --> 00:11:33,249
it's really easy to group these things

322
00:11:30,759 --> 00:11:35,319
together so all those Kerberos requests

323
00:11:33,249 --> 00:11:36,699
look at the output and you can see

324
00:11:35,319 --> 00:11:38,979
there's really four main two main

325
00:11:36,699 --> 00:11:41,170
controllers that I saw just in that

326
00:11:38,980 --> 00:11:42,970
rough quick query it's for primaries

327
00:11:41,170 --> 00:11:45,910
they all share the same naming mention

328
00:11:42,970 --> 00:11:46,929
one through four so it's good indication

329
00:11:45,910 --> 00:11:49,779
that they're all primary secondary

330
00:11:46,929 --> 00:11:53,800
tertiary all in that same subnet makes

331
00:11:49,779 --> 00:11:55,089
sense so what I conclude from that again

332
00:11:53,800 --> 00:11:56,679
there's there's really four Dominque

333
00:11:55,089 --> 00:11:59,100
toys are dominant they share the IP

334
00:11:56,679 --> 00:12:01,059
address space share holding conventions

335
00:11:59,100 --> 00:12:02,949
but then there's two other ones that are

336
00:12:01,059 --> 00:12:04,868
rarely contacted and I don't entirely

337
00:12:02,949 --> 00:12:09,878
know what those are just yet but we'll

338
00:12:04,869 --> 00:12:11,709
find out so let's see let's scrap this

339
00:12:09,879 --> 00:12:17,350
out what are we starting with very basic

340
00:12:11,709 --> 00:12:19,868
I know I have servers not much but now

341
00:12:17,350 --> 00:12:21,999
let's build off that I know that systems

342
00:12:19,869 --> 00:12:23,949
are domain joint we want that for

343
00:12:21,999 --> 00:12:25,809
security we want those systems joined

344
00:12:23,949 --> 00:12:27,368
and we want to be able to see what those

345
00:12:25,809 --> 00:12:30,579
are doing on the network single sign-on

346
00:12:27,369 --> 00:12:32,350
you name it so a big assumption here

347
00:12:30,579 --> 00:12:34,748
most enterprise systems are two main

348
00:12:32,350 --> 00:12:36,249
joined it's good to have probability

349
00:12:34,749 --> 00:12:37,779
assumption and we know that those

350
00:12:36,249 --> 00:12:41,290
endpoints generate machine

351
00:12:37,779 --> 00:12:43,089
authentication to the domain trollers so

352
00:12:41,290 --> 00:12:45,399
now that we have that we can start to

353
00:12:43,089 --> 00:12:47,889
break that down again same thing similar

354
00:12:45,399 --> 00:12:49,569
similar address space kind of could

355
00:12:47,889 --> 00:12:51,100
indicate physical or logical barriers

356
00:12:49,569 --> 00:12:52,719
right you have systems in the ten dot

357
00:12:51,100 --> 00:12:56,139
space and maybe corporate you have

358
00:12:52,720 --> 00:12:58,980
systems in the 192 private IP space they

359
00:12:56,139 --> 00:13:03,009
may be in a DMZ or some other network

360
00:12:58,980 --> 00:13:05,259
host names indicate the purpose right no

361
00:13:03,009 --> 00:13:06,999
one puts time into naming laptops it's

362
00:13:05,259 --> 00:13:10,329
very rare that people put a purpose to

363
00:13:06,999 --> 00:13:12,399
that but as you'll see here one of the

364
00:13:10,329 --> 00:13:13,929
things I found was they just named it

365
00:13:12,399 --> 00:13:15,970
the Dell service tag so it's pretty easy

366
00:13:13,929 --> 00:13:17,919
to say yeah that's that's a laptop or a

367
00:13:15,970 --> 00:13:21,220
computer just based on a Dell service

368
00:13:17,919 --> 00:13:24,340
tag again volumes at the endpoints

369
00:13:21,220 --> 00:13:26,590
might indicate utilization so let's go

370
00:13:24,340 --> 00:13:28,710
back to Splunk so use the same kerberos

371
00:13:26,590 --> 00:13:30,790
request but diff it by something else

372
00:13:28,710 --> 00:13:32,830
and you're gonna see here I take a gross

373
00:13:30,790 --> 00:13:34,900
assumption and that's that all of our

374
00:13:32,830 --> 00:13:36,670
networks are slash twenty fours I know

375
00:13:34,900 --> 00:13:38,350
that's not a hundreds inaccurate if you

376
00:13:36,670 --> 00:13:41,110
have OCD this talk may start to bother

377
00:13:38,350 --> 00:13:43,090
you more and more but I break them into

378
00:13:41,110 --> 00:13:44,650
slash twenty fours so it's a rough

379
00:13:43,090 --> 00:13:47,500
assumption that all of those things are

380
00:13:44,650 --> 00:13:48,640
joining the same network like that you

381
00:13:47,500 --> 00:13:50,650
can start to see what to make sure all

382
00:13:48,640 --> 00:13:52,960
is the authenticate against how often

383
00:13:50,650 --> 00:13:56,770
you're seeing them and where they might

384
00:13:52,960 --> 00:13:57,760
be so you can see they're your start to

385
00:13:56,770 --> 00:13:59,620
seeing workstation names

386
00:13:57,760 --> 00:14:02,290
those look like servers what we were

387
00:13:59,620 --> 00:14:04,210
seeing and some of the ten dot space or

388
00:14:02,290 --> 00:14:07,120
I'm sorry those looks like workstation

389
00:14:04,210 --> 00:14:08,770
names I think I think I kept the account

390
00:14:07,120 --> 00:14:10,540
okay so that that's what was the account

391
00:14:08,770 --> 00:14:11,949
names were the system's logging in to

392
00:14:10,540 --> 00:14:13,800
that I'm a controller the machine counts

393
00:14:11,950 --> 00:14:16,360
we know those end with the dollar size

394
00:14:13,800 --> 00:14:19,839
so it's pretty easy identify that and

395
00:14:16,360 --> 00:14:23,500
search on that so what do we find

396
00:14:19,840 --> 00:14:26,860
found 4300 unique domain join systems

397
00:14:23,500 --> 00:14:28,900
based on account name and we saw a bunch

398
00:14:26,860 --> 00:14:32,200
of different networks we saw 10.1 72 dot

399
00:14:28,900 --> 00:14:35,140
and 192 dot we started to see kind of

400
00:14:32,200 --> 00:14:37,090
how many slash 24s existed in each one

401
00:14:35,140 --> 00:14:39,640
how highly utilized were those different

402
00:14:37,090 --> 00:14:41,590
networks so we found 3 out of 35

403
00:14:39,640 --> 00:14:43,150
networks with very few nodes per network

404
00:14:41,590 --> 00:14:46,120
again I know this is a retail

405
00:14:43,150 --> 00:14:48,790
organization with very remote branch

406
00:14:46,120 --> 00:14:50,260
kind of offices stores so you can start

407
00:14:48,790 --> 00:14:52,750
to say alright it makes sense that

408
00:14:50,260 --> 00:14:55,230
there's a few nodes per slash 24 that's

409
00:14:52,750 --> 00:14:59,580
probably Store 1 or store 2 or store 3

410
00:14:55,230 --> 00:15:03,520
and then I saw that 172 Network this had

411
00:14:59,580 --> 00:15:04,750
again a moderate number of networks it

412
00:15:03,520 --> 00:15:07,270
kind of differed with naming conventions

413
00:15:04,750 --> 00:15:09,400
some had laptop Dell server stacks

414
00:15:07,270 --> 00:15:11,530
some had server name expansions right

415
00:15:09,400 --> 00:15:13,180
you might see sequel or app or something

416
00:15:11,530 --> 00:15:14,620
else in that so you can identify ok that

417
00:15:13,180 --> 00:15:16,719
might be a server network these are

418
00:15:14,620 --> 00:15:19,630
workstation networks and some you even

419
00:15:16,720 --> 00:15:22,030
saw more than 255 workstations

420
00:15:19,630 --> 00:15:23,410
authenticating to or from good

421
00:15:22,030 --> 00:15:25,089
indication they're it's a wireless

422
00:15:23,410 --> 00:15:26,469
network right people are hopping on and

423
00:15:25,089 --> 00:15:27,610
off getting different addresses as

424
00:15:26,470 --> 00:15:28,900
they're navigating through that office

425
00:15:27,610 --> 00:15:30,640
and that's why you're seeing a lot of

426
00:15:28,900 --> 00:15:32,650
those you can start to conclude you know

427
00:15:30,640 --> 00:15:34,569
wireless networks wired networks server

428
00:15:32,650 --> 00:15:36,040
networks store networks

429
00:15:34,570 --> 00:15:38,260
specifically what I was interested in

430
00:15:36,040 --> 00:15:40,240
with CDE networks right if there are a

431
00:15:38,260 --> 00:15:42,700
retail store they care about cardholder

432
00:15:40,240 --> 00:15:45,040
data so we want to make sure that those

433
00:15:42,700 --> 00:15:46,330
are logging that-that'll yeah a big

434
00:15:45,040 --> 00:15:48,819
piece of where I'm gonna go with this

435
00:15:46,330 --> 00:15:51,490
talk and lastly there was a 192 net

436
00:15:48,820 --> 00:15:53,290
worth add a handful networks some

437
00:15:51,490 --> 00:15:54,970
servers but it was really again there

438
00:15:53,290 --> 00:15:56,800
wasn't much indication exactly what it

439
00:15:54,970 --> 00:15:58,810
was and why I would have been separate

440
00:15:56,800 --> 00:16:00,939
from the 172 network and those server

441
00:15:58,810 --> 00:16:03,369
networks could be you know again a

442
00:16:00,940 --> 00:16:06,640
specific cardholder data network could

443
00:16:03,370 --> 00:16:07,780
be a DMZ it could be something else but

444
00:16:06,640 --> 00:16:11,140
for some reason they wanted to segment

445
00:16:07,780 --> 00:16:12,850
it so let's go back to that map and

446
00:16:11,140 --> 00:16:15,939
continue to build off so I kind of built

447
00:16:12,850 --> 00:16:18,070
three logical boundaries right store

448
00:16:15,940 --> 00:16:19,960
that works on the Left more data center

449
00:16:18,070 --> 00:16:21,670
headquarters and Center and that kind of

450
00:16:19,960 --> 00:16:26,500
random other address space on the far

451
00:16:21,670 --> 00:16:28,360
right and I you'll start to see in the

452
00:16:26,500 --> 00:16:31,570
the diagrams that there's transparency

453
00:16:28,360 --> 00:16:33,220
to the icons if it's a solid dark black

454
00:16:31,570 --> 00:16:35,410
it means I know I have logging for those

455
00:16:33,220 --> 00:16:37,690
if it's more transparent it's either

456
00:16:35,410 --> 00:16:39,250
unknown or there's not as much logging

457
00:16:37,690 --> 00:16:40,900
for it so in this case we just saw the

458
00:16:39,250 --> 00:16:42,130
authentications on its bank troller that

459
00:16:40,900 --> 00:16:44,140
force being exerted from those

460
00:16:42,130 --> 00:16:45,700
workstations we just don't know if they

461
00:16:44,140 --> 00:16:47,020
exist in or logging yet we don't know if

462
00:16:45,700 --> 00:16:48,490
we have information from those but we

463
00:16:47,020 --> 00:16:52,750
know that we need to start providing

464
00:16:48,490 --> 00:16:53,740
controls around those so let's go let's

465
00:16:52,750 --> 00:16:57,160
go see if we do have those systems

466
00:16:53,740 --> 00:16:59,500
logging we know that endpoints the

467
00:16:57,160 --> 00:17:01,270
logins are logged directly and locally

468
00:16:59,500 --> 00:17:03,040
to those systems we know they you know

469
00:17:01,270 --> 00:17:05,400
depending on your verbosity of logs you

470
00:17:03,040 --> 00:17:08,050
might be logging process creation events

471
00:17:05,400 --> 00:17:10,000
all sorts of different things right so

472
00:17:08,050 --> 00:17:11,399
we know what these generate logs just as

473
00:17:10,000 --> 00:17:14,709
much as honestly two main controllers

474
00:17:11,400 --> 00:17:16,810
but the organization's really don't log

475
00:17:14,709 --> 00:17:18,939
in points it's very difficult to do it's

476
00:17:16,810 --> 00:17:21,188
very expensive for your licensing so we

477
00:17:18,939 --> 00:17:22,839
know that generally a weak spot

478
00:17:21,189 --> 00:17:24,790
but again knowing there's a cardholder

479
00:17:22,839 --> 00:17:26,020
data environment we want to make sure

480
00:17:24,790 --> 00:17:29,680
that they have that log in because that

481
00:17:26,020 --> 00:17:32,050
is a compliance requirement so how do we

482
00:17:29,680 --> 00:17:33,970
interpret that we know what workstations

483
00:17:32,050 --> 00:17:36,580
we expect to exist what servers we

484
00:17:33,970 --> 00:17:38,740
expect to exist if we intersect that

485
00:17:36,580 --> 00:17:40,629
with what logs we actually have from a

486
00:17:38,740 --> 00:17:42,910
Windows and Linux perspective we can

487
00:17:40,630 --> 00:17:44,410
start to identify gaps right if we know

488
00:17:42,910 --> 00:17:47,160
stuff is logging we expect stuff to

489
00:17:44,410 --> 00:17:50,280
exist the difference there

490
00:17:47,160 --> 00:17:51,600
is what's missing so let's do the same

491
00:17:50,280 --> 00:17:53,160
thing and Splunk you can kind of search

492
00:17:51,600 --> 00:17:54,929
on a couple of the indexes look for

493
00:17:53,160 --> 00:17:56,640
windows logs look for windows logs or

494
00:17:54,930 --> 00:17:58,620
windows and linux logs and start to

495
00:17:56,640 --> 00:18:02,130
identify just that source host that's

496
00:17:58,620 --> 00:18:04,080
logging in this case you end up seeing

497
00:18:02,130 --> 00:18:06,060
that in the query there's some two

498
00:18:04,080 --> 00:18:07,830
thousand systems that we saw logs for

499
00:18:06,060 --> 00:18:09,360
and they all had really really odd

500
00:18:07,830 --> 00:18:11,490
naming conventions that I didn't see

501
00:18:09,360 --> 00:18:13,770
prior in the machine authentications and

502
00:18:11,490 --> 00:18:14,970
it's not the exact one I have sanitize

503
00:18:13,770 --> 00:18:17,430
it a little bit for the purpose of the

504
00:18:14,970 --> 00:18:20,970
demo but it was pretty clear to me that

505
00:18:17,430 --> 00:18:24,060
there was a number another string and

506
00:18:20,970 --> 00:18:25,800
then another number and just based off

507
00:18:24,060 --> 00:18:27,720
our experience we know what that might

508
00:18:25,800 --> 00:18:29,340
be you know a way to track those assets

509
00:18:27,720 --> 00:18:32,160
so in this case what I believed it to be

510
00:18:29,340 --> 00:18:34,709
is a store code that string represents

511
00:18:32,160 --> 00:18:36,750
two point of sale system and then the

512
00:18:34,710 --> 00:18:39,300
digit after that was likely the number

513
00:18:36,750 --> 00:18:41,820
system it was right the register number

514
00:18:39,300 --> 00:18:44,129
etc at that location so that gives us

515
00:18:41,820 --> 00:18:45,659
some good information right these things

516
00:18:44,130 --> 00:18:48,570
that I believe are cardholder dator

517
00:18:45,660 --> 00:18:51,360
clark cardholder data and systems are

518
00:18:48,570 --> 00:18:52,679
logging but they're not domain joints

519
00:18:51,360 --> 00:18:55,110
not at least to the domain that I know

520
00:18:52,680 --> 00:18:57,210
about so that right there I started to

521
00:18:55,110 --> 00:18:58,320
identify a gap alright that's that's

522
00:18:57,210 --> 00:19:02,670
something we can work from and add

523
00:18:58,320 --> 00:19:04,980
visibility to for that organization but

524
00:19:02,670 --> 00:19:05,430
I saw nothing of what I expected to

525
00:19:04,980 --> 00:19:07,890
exist

526
00:19:05,430 --> 00:19:10,650
none of the server's none of the

527
00:19:07,890 --> 00:19:12,780
corporate machines none of the other

528
00:19:10,650 --> 00:19:15,090
store systems that I expected to be

529
00:19:12,780 --> 00:19:16,590
there were there so there's two really

530
00:19:15,090 --> 00:19:18,449
store systems there was one that had a

531
00:19:16,590 --> 00:19:19,560
normal laptop naming convention and then

532
00:19:18,450 --> 00:19:21,510
there was the ones you guys just saw

533
00:19:19,560 --> 00:19:23,129
they had point-of-sale like naming

534
00:19:21,510 --> 00:19:24,510
conventions this is really weird though

535
00:19:23,130 --> 00:19:26,190
none of those were logging none of them

536
00:19:24,510 --> 00:19:29,040
which is unheard of really I mean you

537
00:19:26,190 --> 00:19:30,510
just usually see a subset but nothing

538
00:19:29,040 --> 00:19:32,430
was there so the only thing we knew that

539
00:19:30,510 --> 00:19:38,129
was logging and me and joined for those

540
00:19:32,430 --> 00:19:40,890
two main controllers so really what we

541
00:19:38,130 --> 00:19:43,610
find again no that was logging and we

542
00:19:40,890 --> 00:19:45,740
started to find a hint that all of those

543
00:19:43,610 --> 00:19:48,870
point-of-sale systems that were logging

544
00:19:45,740 --> 00:19:50,670
existed in the same ten dot space as the

545
00:19:48,870 --> 00:19:52,979
other ones which starts to make sense

546
00:19:50,670 --> 00:19:54,660
right it confirms my theory that that's

547
00:19:52,980 --> 00:19:57,410
a store location and they probably

548
00:19:54,660 --> 00:19:59,790
differ the stores by by subnet right and

549
00:19:57,410 --> 00:20:00,390
so then I took the naming conventions

550
00:19:59,790 --> 00:20:03,450
and

551
00:20:00,390 --> 00:20:06,420
meet all those and there was roughly 550

552
00:20:03,450 --> 00:20:08,790
store IDs which makes sense going back

553
00:20:06,420 --> 00:20:11,280
to Google we knew they had roughly 500

554
00:20:08,790 --> 00:20:13,350
stores so it Maps up it starts to make a

555
00:20:11,280 --> 00:20:15,240
lot of sense and then you look at those

556
00:20:13,350 --> 00:20:17,790
system identifiers and there is less

557
00:20:15,240 --> 00:20:20,070
than 10 per network so that makes sense

558
00:20:17,790 --> 00:20:23,450
again you know few stores have more than

559
00:20:20,070 --> 00:20:25,620
10 registers unless the big-box retailer

560
00:20:23,450 --> 00:20:27,780
again all that started giving me more

561
00:20:25,620 --> 00:20:32,010
context about those environments and

562
00:20:27,780 --> 00:20:33,450
ultimately led us to this map pretty

563
00:20:32,010 --> 00:20:34,980
much the same as prior but you're gonna

564
00:20:33,450 --> 00:20:36,840
see the box on the left the bigger box

565
00:20:34,980 --> 00:20:38,970
that kind of indicates the domain that

566
00:20:36,840 --> 00:20:39,990
we know about then there's these random

567
00:20:38,970 --> 00:20:42,180
systems off to the right

568
00:20:39,990 --> 00:20:43,860
not authenticating I did a quick check

569
00:20:42,180 --> 00:20:45,480
and then put in the slides but they're

570
00:20:43,860 --> 00:20:48,300
all doing local authentication for their

571
00:20:45,480 --> 00:20:49,410
CDE POS systems which is interesting but

572
00:20:48,300 --> 00:20:51,260
it's good they of those login so they do

573
00:20:49,410 --> 00:20:54,390
have that kind of information about it

574
00:20:51,260 --> 00:20:56,100
so now we have a rough understanding of

575
00:20:54,390 --> 00:20:59,010
what their endpoints and servers look

576
00:20:56,100 --> 00:21:00,389
like but now we want to know you know

577
00:20:59,010 --> 00:21:02,030
where is this traffic flowing

578
00:21:00,390 --> 00:21:07,050
how do those stores connect back to the

579
00:21:02,030 --> 00:21:08,879
data center do we have visibility into

580
00:21:07,050 --> 00:21:10,710
those store systems you know some

581
00:21:08,880 --> 00:21:13,470
organizations for those branch locations

582
00:21:10,710 --> 00:21:16,050
egress traffic directly out through that

583
00:21:13,470 --> 00:21:17,580
store and only pipe back to their their

584
00:21:16,050 --> 00:21:20,399
corporate what they need to four

585
00:21:17,580 --> 00:21:22,080
services some tunnel everything back cuz

586
00:21:20,400 --> 00:21:24,720
they want that visibility so we want to

587
00:21:22,080 --> 00:21:26,159
see how that was laid out if we if for

588
00:21:24,720 --> 00:21:28,140
example they are putting firewalls at

589
00:21:26,160 --> 00:21:30,630
all these branch locations do we have

590
00:21:28,140 --> 00:21:32,420
those logs do we have visibility into

591
00:21:30,630 --> 00:21:34,590
that network traffic going in and out

592
00:21:32,420 --> 00:21:36,270
whenever they're evolving you know

593
00:21:34,590 --> 00:21:37,980
command control infrastructure going on

594
00:21:36,270 --> 00:21:40,050
out in the world we want to know if

595
00:21:37,980 --> 00:21:43,170
they're beaconing back we can see those

596
00:21:40,050 --> 00:21:45,330
logs and we can detect that so let's go

597
00:21:43,170 --> 00:21:47,600
to egress traffic again assumptions

598
00:21:45,330 --> 00:21:51,149
everything talk to the internet nowadays

599
00:21:47,600 --> 00:21:54,389
everything frigerators toasters you name

600
00:21:51,150 --> 00:21:55,800
it so we know that and then we know

601
00:21:54,390 --> 00:21:57,360
again based on this being a retailer

602
00:21:55,800 --> 00:21:58,500
there's a couple different methods they

603
00:21:57,360 --> 00:22:00,419
could bring that traffic out to the

604
00:21:58,500 --> 00:22:02,040
internet could bring it back to the data

605
00:22:00,420 --> 00:22:04,620
center or directly out through the

606
00:22:02,040 --> 00:22:06,780
stores so we're gonna start to interpret

607
00:22:04,620 --> 00:22:08,580
that data and start to see what is

608
00:22:06,780 --> 00:22:11,490
logging what's not logging if we do not

609
00:22:08,580 --> 00:22:13,439
see egress traffic for our network it's

610
00:22:11,490 --> 00:22:14,260
likely we're missing a device right it's

611
00:22:13,440 --> 00:22:20,710
not logging

612
00:22:14,260 --> 00:22:22,780
it's again another gap in our network so

613
00:22:20,710 --> 00:22:24,100
let's go back to Splunk run a query we

614
00:22:22,780 --> 00:22:25,720
knew that they had two devices log in

615
00:22:24,100 --> 00:22:27,520
this block they had an AAS a device type

616
00:22:25,720 --> 00:22:29,650
and they had a Palo Alto device type and

617
00:22:27,520 --> 00:22:31,210
we started to you know all you guys

618
00:22:29,650 --> 00:22:32,950
traffic again I'm taking the broad

619
00:22:31,210 --> 00:22:34,990
assumptions I'm just taking slash 24s

620
00:22:32,950 --> 00:22:37,300
but I started to look at all that

621
00:22:34,990 --> 00:22:39,040
traffic going out and said do I see

622
00:22:37,300 --> 00:22:43,919
traffic for every single network that I

623
00:22:39,040 --> 00:22:46,840
expect to be there and sure enough I did

624
00:22:43,920 --> 00:22:48,520
we saw all that traffic going out so

625
00:22:46,840 --> 00:22:51,040
it's good we have visibility into every

626
00:22:48,520 --> 00:22:52,360
single system and egress traffic I

627
00:22:51,040 --> 00:22:54,060
filtered a little bit extra and just

628
00:22:52,360 --> 00:22:57,250
made sure that I was seeing HTTP traffic

629
00:22:54,060 --> 00:22:58,750
HTTP traffic DNS traffic and all that

630
00:22:57,250 --> 00:23:00,490
was coming back through what I assumed

631
00:22:58,750 --> 00:23:02,170
to be the data center so that's good we

632
00:23:00,490 --> 00:23:05,020
have visibility there that organization

633
00:23:02,170 --> 00:23:06,370
isn't missing anything but one of things

634
00:23:05,020 --> 00:23:08,950
I thought was weird is that the Cisco

635
00:23:06,370 --> 00:23:11,110
assay and the Palo seeing the exact same

636
00:23:08,950 --> 00:23:12,730
sets of traffic no difference he saw a

637
00:23:11,110 --> 00:23:15,639
packet going through one you saw it

638
00:23:12,730 --> 00:23:17,440
going through the other and that led me

639
00:23:15,640 --> 00:23:18,430
to again my initial thought what we

640
00:23:17,440 --> 00:23:21,880
commonly see in a lot of organizations

641
00:23:18,430 --> 00:23:23,770
is that they may use a SAS internally to

642
00:23:21,880 --> 00:23:25,780
terminate the store connection back into

643
00:23:23,770 --> 00:23:27,220
their network and then you know some

644
00:23:25,780 --> 00:23:28,389
sort of palo at the edge that's gonna

645
00:23:27,220 --> 00:23:30,400
filter that out but it was a little

646
00:23:28,390 --> 00:23:32,230
weird because again I started see every

647
00:23:30,400 --> 00:23:33,400
single packet so this is was my

648
00:23:32,230 --> 00:23:36,670
assumption kind of coming out of that

649
00:23:33,400 --> 00:23:39,370
last iteration but I wasn't quite

650
00:23:36,670 --> 00:23:40,870
certain that was it until this next step

651
00:23:39,370 --> 00:23:43,479
so again we know we have good and

652
00:23:40,870 --> 00:23:47,679
external visibility which is which is

653
00:23:43,480 --> 00:23:49,840
really good but now internal visibility

654
00:23:47,680 --> 00:23:51,580
this is a this is a concept that I feel

655
00:23:49,840 --> 00:23:53,850
like most organizations do not do well

656
00:23:51,580 --> 00:23:55,810
they have very little east-west traffic

657
00:23:53,850 --> 00:23:57,939
it could be expensive it can be

658
00:23:55,810 --> 00:24:01,030
expensive to log be expensive to put

659
00:23:57,940 --> 00:24:02,890
those devices in place so oftentimes we

660
00:24:01,030 --> 00:24:05,920
just see egress traffic organizations

661
00:24:02,890 --> 00:24:07,270
but let's write a check anyways so we

662
00:24:05,920 --> 00:24:09,460
know that few organizations have this

663
00:24:07,270 --> 00:24:12,610
but if they do again we can start to

664
00:24:09,460 --> 00:24:14,590
diff all those networks is the ten dot

665
00:24:12,610 --> 00:24:16,689
store networks talking to ten dot

666
00:24:14,590 --> 00:24:19,540
corporate and I'm not I'm sorry

667
00:24:16,690 --> 00:24:21,490
172 corporate workstation networks once

668
00:24:19,540 --> 00:24:23,290
they need to corporate server networks

669
00:24:21,490 --> 00:24:24,880
and start to identify which systems

670
00:24:23,290 --> 00:24:27,430
these networks are talking to and if we

671
00:24:24,880 --> 00:24:28,160
see it or not especially with a CD

672
00:24:27,430 --> 00:24:31,970
environment that

673
00:24:28,160 --> 00:24:33,200
you do want strong segmentation so let's

674
00:24:31,970 --> 00:24:34,040
run the same query we know that those

675
00:24:33,200 --> 00:24:36,380
devices were logging

676
00:24:34,040 --> 00:24:38,210
ASA's and palos so let's rerun the same

677
00:24:36,380 --> 00:24:41,120
query but now just look internal to

678
00:24:38,210 --> 00:24:43,520
internal traffic and I know it's pretty

679
00:24:41,120 --> 00:24:45,800
hard to see but you'll see I just

680
00:24:43,520 --> 00:24:47,690
roughly did ten dots for the screenshot

681
00:24:45,800 --> 00:24:50,780
and you'll see that we have visibility

682
00:24:47,690 --> 00:24:52,550
from every single private network to

683
00:24:50,780 --> 00:24:54,139
every other private network so

684
00:24:52,550 --> 00:24:55,520
everything that's talking across those

685
00:24:54,140 --> 00:24:57,140
different those three different main

686
00:24:55,520 --> 00:24:59,570
environments right the ten dot which I

687
00:24:57,140 --> 00:25:01,060
believe is stores the 172 dot which I

688
00:24:59,570 --> 00:25:04,250
believe is their corporate headquarters

689
00:25:01,060 --> 00:25:06,200
data center and the 192 which again I'm

690
00:25:04,250 --> 00:25:09,710
still unsure it's like a segmented CDE

691
00:25:06,200 --> 00:25:12,050
Network or DMZ we've all that traffic

692
00:25:09,710 --> 00:25:13,460
which is awesome and furthermore on the

693
00:25:12,050 --> 00:25:15,770
far right I kind of put some

694
00:25:13,460 --> 00:25:19,580
interpretations accounts how many unique

695
00:25:15,770 --> 00:25:23,600
slash twenty fours did I see / again

696
00:25:19,580 --> 00:25:27,020
rough location stores headquarters DM Z

697
00:25:23,600 --> 00:25:29,719
/ CDE and so it's really interesting

698
00:25:27,020 --> 00:25:31,220
that for example between the ten dot and

699
00:25:29,720 --> 00:25:33,410
ten dot which to the store let see

700
00:25:31,220 --> 00:25:36,320
everything between the 172 dot and the

701
00:25:33,410 --> 00:25:37,120
172 dot I see everything which is really

702
00:25:36,320 --> 00:25:39,740
weird

703
00:25:37,120 --> 00:25:41,510
they might have complete internal

704
00:25:39,740 --> 00:25:43,700
visibility they might have these panels

705
00:25:41,510 --> 00:25:45,410
or NSA's their core and everything is

706
00:25:43,700 --> 00:25:47,480
going through them for east-west

707
00:25:45,410 --> 00:25:50,060
visibility that's unheard of but really

708
00:25:47,480 --> 00:25:52,100
cool as a defender that gives us a lot

709
00:25:50,060 --> 00:25:54,620
of opportunities to start creating

710
00:25:52,100 --> 00:25:58,969
detections for for abnormalities in the

711
00:25:54,620 --> 00:26:01,669
network and again the same thing we saw

712
00:25:58,970 --> 00:26:04,580
was Cisco essays and Paolo's we're

713
00:26:01,670 --> 00:26:07,700
seeing exact identical traffic between

714
00:26:04,580 --> 00:26:08,810
them which led me to one conclusion as I

715
00:26:07,700 --> 00:26:11,540
was talking to one of our network guys

716
00:26:08,810 --> 00:26:12,620
are they migrating and it turns out they

717
00:26:11,540 --> 00:26:14,420
were I think I think they're in the

718
00:26:12,620 --> 00:26:17,149
middle of a migration away from ASAS to

719
00:26:14,420 --> 00:26:19,010
pal is that core but we could tell that

720
00:26:17,150 --> 00:26:20,900
because there is one little keyword in

721
00:26:19,010 --> 00:26:22,610
one of the palaces owns for V wire which

722
00:26:20,900 --> 00:26:23,480
again I'm not a network guy not an

723
00:26:22,610 --> 00:26:25,520
expert on that front

724
00:26:23,480 --> 00:26:26,720
buddy means but it's basically something

725
00:26:25,520 --> 00:26:30,129
that spans the traffic between the two

726
00:26:26,720 --> 00:26:32,120
devices and allows for kind of that

727
00:26:30,130 --> 00:26:34,010
intermediate both devices are in place

728
00:26:32,120 --> 00:26:36,229
you can map over the policies between

729
00:26:34,010 --> 00:26:39,680
one on the other and then rip out the

730
00:26:36,230 --> 00:26:41,810
old device so we're going to modify my

731
00:26:39,680 --> 00:26:43,220
map a little bit

732
00:26:41,810 --> 00:26:45,290
think everything's connecting to those a

733
00:26:43,220 --> 00:26:47,630
essays and palos again you'll start to

734
00:26:45,290 --> 00:26:49,820
see in the store environment as we were

735
00:26:47,630 --> 00:26:52,130
looking at specific traffic between the

736
00:26:49,820 --> 00:26:53,570
ten dot networks I never saw a traffic

737
00:26:52,130 --> 00:26:55,430
cross between what I thought was the

738
00:26:53,570 --> 00:26:57,020
point-of-sale systems and the other

739
00:26:55,430 --> 00:26:58,460
laptops in that environment which makes

740
00:26:57,020 --> 00:27:01,820
sense they have a laptop why they're

741
00:26:58,460 --> 00:27:03,440
franchise information see the

742
00:27:01,820 --> 00:27:06,230
environments completely separate and

743
00:27:03,440 --> 00:27:07,370
segments so that that's good and now I'm

744
00:27:06,230 --> 00:27:10,220
starting to create some physical

745
00:27:07,370 --> 00:27:12,469
boundaries right the stores are always

746
00:27:10,220 --> 00:27:15,170
obviously remote 500 plus satellite

747
00:27:12,470 --> 00:27:16,490
offices satellite stores but it looks

748
00:27:15,170 --> 00:27:20,750
like they have that that one corporate

749
00:27:16,490 --> 00:27:23,360
environment again this this is really

750
00:27:20,750 --> 00:27:25,070
useful because as we're blue teamers you

751
00:27:23,360 --> 00:27:26,959
can start to create rules right

752
00:27:25,070 --> 00:27:29,389
if you expect and now you know what

753
00:27:26,960 --> 00:27:31,850
those cardholder data networks are you

754
00:27:29,390 --> 00:27:33,890
expected to never talk to a non

755
00:27:31,850 --> 00:27:35,540
cardholder due to network

756
00:27:33,890 --> 00:27:37,310
you probably don't expect your

757
00:27:35,540 --> 00:27:40,000
point-of-sale systems to be talking to

758
00:27:37,310 --> 00:27:42,169
your corporate laptops that's just weird

759
00:27:40,000 --> 00:27:43,400
but there's probably some applications

760
00:27:42,170 --> 00:27:47,810
and that server network I was talking

761
00:27:43,400 --> 00:27:49,820
about that would make sense and again

762
00:27:47,810 --> 00:27:51,260
you'll start to see here that the

763
00:27:49,820 --> 00:27:53,540
devices I know that are logging again

764
00:27:51,260 --> 00:27:55,820
more straight black and then there's

765
00:27:53,540 --> 00:27:59,210
some devices in the network that are not

766
00:27:55,820 --> 00:28:01,730
as not as solid and they're transparent

767
00:27:59,210 --> 00:28:03,590
and that's because I don't have logs

768
00:28:01,730 --> 00:28:05,990
from those systems so I've Dominque

769
00:28:03,590 --> 00:28:08,689
trailer logs I have all internal all

770
00:28:05,990 --> 00:28:14,630
egress logs for traffic and I have the

771
00:28:08,690 --> 00:28:16,100
CDE point-of-sale systems logging so we

772
00:28:14,630 --> 00:28:18,770
know that there's some systems missing

773
00:28:16,100 --> 00:28:21,169
right we know that there's gaps on the

774
00:28:18,770 --> 00:28:22,970
systems why are we looking at those a

775
00:28:21,170 --> 00:28:25,550
different way right do we have endpoint

776
00:28:22,970 --> 00:28:28,130
detection coverage for those systems so

777
00:28:25,550 --> 00:28:30,230
a good assumption is that organizations

778
00:28:28,130 --> 00:28:31,430
have an endpoint technology they have an

779
00:28:30,230 --> 00:28:34,340
anti-virus they Vinita are they have

780
00:28:31,430 --> 00:28:36,410
something in those technologies generate

781
00:28:34,340 --> 00:28:37,939
traffic for signature updates generate

782
00:28:36,410 --> 00:28:40,490
traffic if they're sending out data for

783
00:28:37,940 --> 00:28:43,970
a correlation in the cloud or or on Prem

784
00:28:40,490 --> 00:28:45,800
and so I know that that's there I'm

785
00:28:43,970 --> 00:28:47,810
seeing those updates that means that

786
00:28:45,800 --> 00:28:50,300
that rough Network that I see it

787
00:28:47,810 --> 00:28:52,700
originating from has some sort of IDR in

788
00:28:50,300 --> 00:28:55,520
that Network so let's go back and run

789
00:28:52,700 --> 00:28:58,370
another query in this case they did

790
00:28:55,520 --> 00:29:02,330
have an ee our solution logging to their

791
00:28:58,370 --> 00:29:05,510
Splunk took that EDR did a quick Google

792
00:29:02,330 --> 00:29:07,909
obviously it's a sanitized here but they

793
00:29:05,510 --> 00:29:09,920
had a domain for their updates so let's

794
00:29:07,910 --> 00:29:11,540
go search for all traffic to that now

795
00:29:09,920 --> 00:29:14,360
knowing that I see every single network

796
00:29:11,540 --> 00:29:17,060
egressing so I had that visibility let's

797
00:29:14,360 --> 00:29:19,669
use that output as input for this query

798
00:29:17,060 --> 00:29:21,590
then we start to see that there was tons

799
00:29:19,670 --> 00:29:23,960
of networks I didn't let it fully run I

800
00:29:21,590 --> 00:29:25,699
think but there was roughly 1300

801
00:29:23,960 --> 00:29:27,260
networks that we saw generating that

802
00:29:25,700 --> 00:29:30,380
that in point traffic for the updates

803
00:29:27,260 --> 00:29:32,600
for the signature updates but what we

804
00:29:30,380 --> 00:29:35,270
didn't see was ad networks without

805
00:29:32,600 --> 00:29:36,530
endpoint coverage there's mostly non the

806
00:29:35,270 --> 00:29:38,780
non seedy environments of the stores

807
00:29:36,530 --> 00:29:40,910
probably just some local laptop they

808
00:29:38,780 --> 00:29:43,160
tossed out to those guys so it may not

809
00:29:40,910 --> 00:29:45,350
be as critical right we saw earlier that

810
00:29:43,160 --> 00:29:47,180
those non CTE environments can't talk

811
00:29:45,350 --> 00:29:48,740
the CD environment so if you're gonna

812
00:29:47,180 --> 00:29:52,130
accept some risk that might be a good

813
00:29:48,740 --> 00:29:53,630
place to not increase your license but

814
00:29:52,130 --> 00:29:55,940
the weird part that I saw was there was

815
00:29:53,630 --> 00:29:59,750
some application server there's some

816
00:29:55,940 --> 00:30:01,970
server networks it had nothing no EDR no

817
00:29:59,750 --> 00:30:04,220
laws and that's a little concerning

818
00:30:01,970 --> 00:30:05,960
because again knowing that it's a retail

819
00:30:04,220 --> 00:30:08,120
organization that could be storing PII

820
00:30:05,960 --> 00:30:11,120
could be storing cardholder information

821
00:30:08,120 --> 00:30:12,020
on these systems if we don't have any

822
00:30:11,120 --> 00:30:14,929
visibility into it

823
00:30:12,020 --> 00:30:18,560
local logs or endpoint we're really

824
00:30:14,930 --> 00:30:20,360
limiting ourselves so I kind of dropped

825
00:30:18,560 --> 00:30:22,159
a little antivirus logo for the

826
00:30:20,360 --> 00:30:24,080
different networks and you'll start to

827
00:30:22,160 --> 00:30:25,790
see that again there was like a random

828
00:30:24,080 --> 00:30:27,770
network I think was some wireless

829
00:30:25,790 --> 00:30:29,420
networks everything on that those

830
00:30:27,770 --> 00:30:31,160
networks for sending updates so we had

831
00:30:29,420 --> 00:30:34,790
what I believe is probably corporate

832
00:30:31,160 --> 00:30:37,400
laptops EDRs covered see the environment

833
00:30:34,790 --> 00:30:40,970
on the far left all hundred of those all

834
00:30:37,400 --> 00:30:44,180
those networks covered the non CD stores

835
00:30:40,970 --> 00:30:47,360
or the non CD store locations those are

836
00:30:44,180 --> 00:30:48,170
spotty some had them some didn't not

837
00:30:47,360 --> 00:30:51,020
really sure if they're in the middle of

838
00:30:48,170 --> 00:30:53,030
rolling that out but then when you come

839
00:30:51,020 --> 00:30:53,920
back to the corporate location you look

840
00:30:53,030 --> 00:30:57,710
at those servers

841
00:30:53,920 --> 00:30:59,660
there's near nothing no coverage so

842
00:30:57,710 --> 00:31:01,730
that's a big gap for us that we can go

843
00:30:59,660 --> 00:31:03,680
back to that customer and without even

844
00:31:01,730 --> 00:31:05,540
asking them hey how far along are you

845
00:31:03,680 --> 00:31:06,950
and your EDR deployment we can almost go

846
00:31:05,540 --> 00:31:08,120
to them and tell them right going back

847
00:31:06,950 --> 00:31:09,360
to that Murphy's Law Cunningham's law

848
00:31:08,120 --> 00:31:11,040
example

849
00:31:09,360 --> 00:31:13,709
you can go back and say hey yeah I don't

850
00:31:11,040 --> 00:31:14,790
see this you guys confirm and they could

851
00:31:13,710 --> 00:31:17,190
be like yeah I know you're right like we

852
00:31:14,790 --> 00:31:19,710
haven't found that far you know things

853
00:31:17,190 --> 00:31:23,010
like that and there's other cases that I

854
00:31:19,710 --> 00:31:25,110
think you know this is one example but I

855
00:31:23,010 --> 00:31:27,330
tested it in a couple other environments

856
00:31:25,110 --> 00:31:29,040
and for example with bigger branch

857
00:31:27,330 --> 00:31:32,280
offices sometimes again they put that

858
00:31:29,040 --> 00:31:33,659
firewall at the edge well if we see the

859
00:31:32,280 --> 00:31:36,090
main authentication is from endpoints

860
00:31:33,660 --> 00:31:37,860
but we don't have endpoints logging we

861
00:31:36,090 --> 00:31:39,570
know that network exists and then we

862
00:31:37,860 --> 00:31:41,790
look for egress traffic we don't see any

863
00:31:39,570 --> 00:31:43,649
egress traffic from that Network we now

864
00:31:41,790 --> 00:31:45,299
have a pretty good conclusion that they

865
00:31:43,650 --> 00:31:47,010
aren't logging some egress device at

866
00:31:45,299 --> 00:31:49,080
that location and they're not logging

867
00:31:47,010 --> 00:31:52,520
those devices logs either so they're

868
00:31:49,080 --> 00:31:55,740
again a blind spot in that branch office

869
00:31:52,520 --> 00:31:57,150
so again there's there's many iterations

870
00:31:55,740 --> 00:31:58,890
of things that I think you could search

871
00:31:57,150 --> 00:32:01,410
for a little again going back to the

872
00:31:58,890 --> 00:32:04,140
gravitational forces that devices exert

873
00:32:01,410 --> 00:32:07,230
that we can see through other devices we

874
00:32:04,140 --> 00:32:09,900
can observe from and all that can be put

875
00:32:07,230 --> 00:32:12,240
together to start to draw very crude

876
00:32:09,900 --> 00:32:14,130
maps and start to identify weaknesses in

877
00:32:12,240 --> 00:32:16,020
our visibility areas of improvement

878
00:32:14,130 --> 00:32:19,410
where to prioritize and things like that

879
00:32:16,020 --> 00:32:22,260
so for the sake of time I know I'm

880
00:32:19,410 --> 00:32:23,220
coming up here with ten minutes left but

881
00:32:22,260 --> 00:32:24,990
I want to talk through a couple other

882
00:32:23,220 --> 00:32:28,440
theories that you know I think we could

883
00:32:24,990 --> 00:32:30,630
go explore and test let's say we do have

884
00:32:28,440 --> 00:32:33,390
these law server logs or endpoint logs

885
00:32:30,630 --> 00:32:35,490
if you're looking at login processes you

886
00:32:33,390 --> 00:32:37,410
can start to map what that server is if

887
00:32:35,490 --> 00:32:39,570
you see logins from w3 WP it's probably

888
00:32:37,410 --> 00:32:41,760
got a web front-end to it right so now

889
00:32:39,570 --> 00:32:44,220
we got it a web server out there we can

890
00:32:41,760 --> 00:32:46,080
start to map all of our web servers in

891
00:32:44,220 --> 00:32:48,480
this case we have total east-west

892
00:32:46,080 --> 00:32:50,460
visibility so imagine looking at all the

893
00:32:48,480 --> 00:32:52,919
traffic on that network for known

894
00:32:50,460 --> 00:32:55,470
services I just threw up 1433 which is

895
00:32:52,919 --> 00:32:57,809
for MS sequel now you know all your

896
00:32:55,470 --> 00:32:59,700
database services going back to web

897
00:32:57,809 --> 00:33:03,240
let's say it's not running is but it's

898
00:32:59,700 --> 00:33:05,940
running Apache 80 and 443 you'd start to

899
00:33:03,240 --> 00:33:07,980
find those web servers going even

900
00:33:05,940 --> 00:33:10,410
further right you might have again if

901
00:33:07,980 --> 00:33:12,870
that network was a DMZ Network and you

902
00:33:10,410 --> 00:33:14,960
see inbound traffic to 80 and 443 now

903
00:33:12,870 --> 00:33:17,219
you know your internet exposed systems

904
00:33:14,960 --> 00:33:19,650
you can start to really use that again

905
00:33:17,220 --> 00:33:20,900
to guide what protections do you have in

906
00:33:19,650 --> 00:33:22,130
place what can you actually see

907
00:33:20,900 --> 00:33:23,280
centrally logged

908
00:33:22,130 --> 00:33:26,010
[Music]

909
00:33:23,280 --> 00:33:27,270
in the environment and lastly I don't

910
00:33:26,010 --> 00:33:30,000
think it just applies the network's I

911
00:33:27,270 --> 00:33:31,860
think it could apply to user base naming

912
00:33:30,000 --> 00:33:32,850
conventions for users are often pretty

913
00:33:31,860 --> 00:33:35,159
verbose they give you a lot of

914
00:33:32,850 --> 00:33:36,120
information about what's going on so if

915
00:33:35,160 --> 00:33:37,860
you're looking at domain joined

916
00:33:36,120 --> 00:33:39,449
authentications you can start to look at

917
00:33:37,860 --> 00:33:41,459
those user names and start to deduce

918
00:33:39,450 --> 00:33:43,260
their naming convention a lot of

919
00:33:41,460 --> 00:33:45,840
organizations will throw SVC in front of

920
00:33:43,260 --> 00:33:47,850
a service account or da and front of a

921
00:33:45,840 --> 00:33:50,639
domain admin account or sa for system

922
00:33:47,850 --> 00:33:54,360
admin and then normal accounts may just

923
00:33:50,640 --> 00:33:56,040
be first initial last name so we can use

924
00:33:54,360 --> 00:33:58,350
that start break down user groups and

925
00:33:56,040 --> 00:34:01,530
what users are and then if we have

926
00:33:58,350 --> 00:34:03,419
normal users and from our steps prior we

927
00:34:01,530 --> 00:34:06,480
start to identify applications that are

928
00:34:03,420 --> 00:34:08,129
running on those systems let's say you

929
00:34:06,480 --> 00:34:08,610
see only a subset of users hitting the

930
00:34:08,129 --> 00:34:10,560
server

931
00:34:08,610 --> 00:34:13,169
well now you can kind of join those

932
00:34:10,560 --> 00:34:15,239
users into a department right if they're

933
00:34:13,168 --> 00:34:18,830
hitting some sort of server and that

934
00:34:15,239 --> 00:34:21,060
host name has finance in it or if it has

935
00:34:18,830 --> 00:34:22,739
marketing in the name or even with

936
00:34:21,060 --> 00:34:25,379
server naming conventions then you only

937
00:34:22,739 --> 00:34:27,330
see half a dozen a dozen users logging

938
00:34:25,379 --> 00:34:29,909
into that it's a pretty good bet they're

939
00:34:27,330 --> 00:34:31,379
either admins for that system or they're

940
00:34:29,909 --> 00:34:32,490
the users of that system so it's a

941
00:34:31,379 --> 00:34:35,759
financing application

942
00:34:32,489 --> 00:34:37,290
maybe they're Finance users and you can

943
00:34:35,760 --> 00:34:38,909
keep using that information to drive

944
00:34:37,290 --> 00:34:41,399
further and further visibility in your

945
00:34:38,909 --> 00:34:44,490
network again I really think the number

946
00:34:41,399 --> 00:34:47,699
of small small pieces of logs artifacts

947
00:34:44,489 --> 00:34:50,790
and logs that we can observe will allow

948
00:34:47,699 --> 00:34:52,888
us to really explore that network figure

949
00:34:50,790 --> 00:34:55,830
out what's out there and take a little

950
00:34:52,889 --> 00:34:57,240
bit of initiative on our own before just

951
00:34:55,830 --> 00:35:01,799
going out there and asking what servers

952
00:34:57,240 --> 00:35:04,259
do we have so where do I think I can

953
00:35:01,800 --> 00:35:06,690
take this next automation is a big one

954
00:35:04,260 --> 00:35:08,520
as I mentioned the first slide I'm a

955
00:35:06,690 --> 00:35:10,950
huge fan of automation a lot of these

956
00:35:08,520 --> 00:35:13,259
queries are very applicable to almost

957
00:35:10,950 --> 00:35:14,910
every single environment obviously

958
00:35:13,260 --> 00:35:15,750
Splunk you can bring logs in a couple

959
00:35:14,910 --> 00:35:17,640
different ways so you might have to

960
00:35:15,750 --> 00:35:22,830
adjust some fields but whether you're

961
00:35:17,640 --> 00:35:25,620
using QRadar or logarithm or you name it

962
00:35:22,830 --> 00:35:29,009
you could start to use this data extract

963
00:35:25,620 --> 00:35:33,720
it with the query and and start to pull

964
00:35:29,010 --> 00:35:36,420
together a rough map but the one hiccup

965
00:35:33,720 --> 00:35:36,959
I think I'll will encounter is quirky

966
00:35:36,420 --> 00:35:39,450
pieces

967
00:35:36,960 --> 00:35:41,010
we don't expect in this case there was a

968
00:35:39,450 --> 00:35:43,259
couple things just threw me off and

969
00:35:41,010 --> 00:35:45,560
there wasn't enough information for me

970
00:35:43,260 --> 00:35:47,849
to be all determine what that system was

971
00:35:45,560 --> 00:35:49,380
in the case of the ASA's impalas it was

972
00:35:47,849 --> 00:35:53,300
weird that I saw a duplication of

973
00:35:49,380 --> 00:35:55,770
traffic's that's a rare rare occurrence

974
00:35:53,300 --> 00:35:58,560
the server network we never really

975
00:35:55,770 --> 00:36:01,080
concluded whether it had Internet public

976
00:35:58,560 --> 00:36:02,190
facing systems or CDE systems that was

977
00:36:01,080 --> 00:36:04,170
only talking to it but I think you could

978
00:36:02,190 --> 00:36:07,619
go back and further look at that traffic

979
00:36:04,170 --> 00:36:09,060
and analyze it and again the last part

980
00:36:07,619 --> 00:36:10,710
is really just continued testing this

981
00:36:09,060 --> 00:36:12,390
I've tested it in a couple of

982
00:36:10,710 --> 00:36:14,430
environments and gone back to the

983
00:36:12,390 --> 00:36:15,990
engineers the threat management constant

984
00:36:14,430 --> 00:36:17,430
developers for that account have

985
00:36:15,990 --> 00:36:20,720
basically brought them this map and

986
00:36:17,430 --> 00:36:23,930
sometimes it's spot-on what they expect

987
00:36:20,720 --> 00:36:27,240
so it kind of is proves that it's

988
00:36:23,930 --> 00:36:28,410
beneficial and works and in some cases I

989
00:36:27,240 --> 00:36:30,060
take it back to that developer that

990
00:36:28,410 --> 00:36:31,319
engineer I go hey I think they're

991
00:36:30,060 --> 00:36:33,060
missing this device thank you're missing

992
00:36:31,320 --> 00:36:34,650
this device you could start to build

993
00:36:33,060 --> 00:36:35,640
rules around this based off I only see

994
00:36:34,650 --> 00:36:37,470
these networks are talking to these

995
00:36:35,640 --> 00:36:38,700
networks and things they didn't even

996
00:36:37,470 --> 00:36:40,259
know about it

997
00:36:38,700 --> 00:36:42,118
so I really think even within your own

998
00:36:40,260 --> 00:36:45,270
on your organization you could start to

999
00:36:42,119 --> 00:36:46,980
identify gaps that you're seeing through

1000
00:36:45,270 --> 00:36:49,080
these logs and bring it back to that

1001
00:36:46,980 --> 00:36:51,599
department hey I see finance people

1002
00:36:49,080 --> 00:36:53,250
logging in for the server but I'll see

1003
00:36:51,599 --> 00:36:56,190
this other user talking to the server is

1004
00:36:53,250 --> 00:36:57,300
he belong she belong in the system and I

1005
00:36:56,190 --> 00:36:58,920
think you can start to bring that

1006
00:36:57,300 --> 00:37:03,240
information and things that they

1007
00:36:58,920 --> 00:37:05,089
typically aren't observing and really

1008
00:37:03,240 --> 00:37:07,140
start to ask questions around that so

1009
00:37:05,089 --> 00:37:09,720
with that said I mean that that's really

1010
00:37:07,140 --> 00:37:11,279
where I'm at with the project I'd love

1011
00:37:09,720 --> 00:37:13,020
to get you guys as questions see if you

1012
00:37:11,280 --> 00:37:14,940
guys have any thoughts additional things

1013
00:37:13,020 --> 00:37:16,349
that maybe I could have tested or did

1014
00:37:14,940 --> 00:37:18,810
test and just didn't get to including

1015
00:37:16,349 --> 00:37:21,109
the slides but again if you have any

1016
00:37:18,810 --> 00:37:21,109
questions

1017
00:37:25,140 --> 00:37:28,770
what specifically for the Wi-Fi segment

1018
00:37:27,140 --> 00:37:35,879
like what do you what are you looking

1019
00:37:28,770 --> 00:37:37,020
for on that yeah so in this case I was

1020
00:37:35,880 --> 00:37:39,510
yep

1021
00:37:37,020 --> 00:37:41,430
so the question was is there any way to

1022
00:37:39,510 --> 00:37:43,890
know who's accessing the Wi-Fi network

1023
00:37:41,430 --> 00:37:47,790
wireless network that might not be be

1024
00:37:43,890 --> 00:37:48,750
expected in this case if I'm looking at

1025
00:37:47,790 --> 00:37:50,119
it and I'm trying to figure out who's on

1026
00:37:48,750 --> 00:37:51,740
my Wi-Fi it's

1027
00:37:50,119 --> 00:37:54,559
probably not a domain join system right

1028
00:37:51,740 --> 00:37:55,578
if I'm bringing in outside device to

1029
00:37:54,559 --> 00:37:57,349
connect to that Wi-Fi

1030
00:37:55,579 --> 00:37:59,359
it may not be generating the machine

1031
00:37:57,349 --> 00:38:02,509
accounts to the domain controller so I

1032
00:37:59,359 --> 00:38:04,460
wouldn't have that visibility I didn't

1033
00:38:02,509 --> 00:38:06,499
go down that route of looking to see if

1034
00:38:04,460 --> 00:38:07,999
they have what our system is handling

1035
00:38:06,499 --> 00:38:11,480
authentication to Wi-Fi whether it's pre

1036
00:38:07,999 --> 00:38:12,709
shared key or individual access I didn't

1037
00:38:11,480 --> 00:38:14,630
check that but you can start to say hey

1038
00:38:12,710 --> 00:38:17,420
like are there devices if you have those

1039
00:38:14,630 --> 00:38:19,190
logs are there devices connecting to

1040
00:38:17,420 --> 00:38:20,839
wireless that don't fit the normal

1041
00:38:19,190 --> 00:38:22,670
naming convention or use your convention

1042
00:38:20,839 --> 00:38:23,839
or or things like that so I think

1043
00:38:22,670 --> 00:38:25,819
there's areas where you could do it

1044
00:38:23,839 --> 00:38:27,230
again you'd have to see if that logging

1045
00:38:25,819 --> 00:38:50,569
is there and kind of keep working off of

1046
00:38:27,230 --> 00:38:52,670
that but I think it's possible yeah so

1047
00:38:50,569 --> 00:38:54,319
the question is like is it going to be

1048
00:38:52,670 --> 00:38:56,299
manual is there the ability to build out

1049
00:38:54,319 --> 00:38:58,609
dashboards queries and Splunk to make it

1050
00:38:56,299 --> 00:39:00,940
repeatable I want to hope so I really do

1051
00:38:58,609 --> 00:39:04,339
I think that a lot of these assumptions

1052
00:39:00,940 --> 00:39:05,809
theories interpretations are general

1053
00:39:04,339 --> 00:39:09,230
enough that it applies to most

1054
00:39:05,809 --> 00:39:12,249
organizations you know it's tough right

1055
00:39:09,230 --> 00:39:14,269
now it's a it's a very manual process

1056
00:39:12,249 --> 00:39:15,709
again just as I'm proving out the theory

1057
00:39:14,269 --> 00:39:17,390
but I think there are cases where we

1058
00:39:15,710 --> 00:39:20,059
could could put in a dashboard and drive

1059
00:39:17,390 --> 00:39:21,558
that visibility and say hey again one of

1060
00:39:20,059 --> 00:39:24,829
the things that I saw in one environment

1061
00:39:21,559 --> 00:39:26,839
was a an organization had acquired in

1062
00:39:24,829 --> 00:39:28,910
this case it was a hospital network and

1063
00:39:26,839 --> 00:39:31,730
they had acquired a hospital that they

1064
00:39:28,910 --> 00:39:34,038
weren't even aware of but they ended up

1065
00:39:31,730 --> 00:39:36,140
joining those systems in the domain

1066
00:39:34,039 --> 00:39:37,519
weren't logging those systems and then

1067
00:39:36,140 --> 00:39:39,319
weren't logging the egress point and

1068
00:39:37,519 --> 00:39:42,470
that organization didn't even know they

1069
00:39:39,319 --> 00:39:43,700
had that Hospital in their network until

1070
00:39:42,470 --> 00:39:44,779
we basically started looking at the

1071
00:39:43,700 --> 00:39:46,609
forces coming across from the

1072
00:39:44,779 --> 00:39:48,769
workstations and then realized there was

1073
00:39:46,609 --> 00:39:51,288
gaps all across the board from that

1074
00:39:48,769 --> 00:39:53,868
central now you know network they didn't

1075
00:39:51,289 --> 00:39:54,980
see that that acquired network in their

1076
00:39:53,869 --> 00:40:00,109
their monitoring tools and their

1077
00:39:54,980 --> 00:40:02,349
security tools in fraud they will go

1078
00:40:00,109 --> 00:40:02,348
bind

1079
00:40:09,490 --> 00:40:15,410
so the question is do we see attackers

1080
00:40:11,960 --> 00:40:18,050
or do we see companies trying to off you

1081
00:40:15,410 --> 00:40:21,259
skate hostnames usernames etc to try to

1082
00:40:18,050 --> 00:40:23,710
make it harder for the attackers yes

1083
00:40:21,260 --> 00:40:25,880
usernames I think a common one that

1084
00:40:23,710 --> 00:40:28,250
probably made thirty thirty percent of

1085
00:40:25,880 --> 00:40:30,440
the time we'll see like a user ID so it

1086
00:40:28,250 --> 00:40:33,290
doesn't tell you who it is what it is

1087
00:40:30,440 --> 00:40:35,120
what role it's in that can make it hard

1088
00:40:33,290 --> 00:40:39,830
right first is a username that you go

1089
00:40:35,120 --> 00:40:43,069
search on LinkedIn post names rarely

1090
00:40:39,830 --> 00:40:45,529
honestly wearily the inconvenience for

1091
00:40:43,070 --> 00:40:46,850
them not knowing what that system is I I

1092
00:40:45,530 --> 00:40:48,140
think it's probably more of an

1093
00:40:46,850 --> 00:40:52,549
inconvenience than it's worth and

1094
00:40:48,140 --> 00:40:53,870
obfuscating it so I don't see it often I

1095
00:40:52,550 --> 00:40:55,670
see it as more like they be making their

1096
00:40:53,870 --> 00:41:23,870
own job more difficult so they are

1097
00:40:55,670 --> 00:41:25,280
typically doing that so I'm gonna go

1098
00:41:23,870 --> 00:41:29,870
ahead and plug my colleagues talk at

1099
00:41:25,280 --> 00:41:32,030
3:15 Kevin 3:15 is it so Kevin will be

1100
00:41:29,870 --> 00:41:35,779
going to talk at 3:15 he covers that in

1101
00:41:32,030 --> 00:41:38,150
depth all sorts of logging failures how

1102
00:41:35,780 --> 00:41:40,190
you can know if something is logging if

1103
00:41:38,150 --> 00:41:42,620
it's logging do you have all the right

1104
00:41:40,190 --> 00:41:44,030
logs from that device if you have all

1105
00:41:42,620 --> 00:41:45,890
the logs from those devices you know

1106
00:41:44,030 --> 00:41:47,900
about other devices out there that you

1107
00:41:45,890 --> 00:41:49,580
know are just not capable of detecting

1108
00:41:47,900 --> 00:41:52,400
that threat for example ASA's aren't

1109
00:41:49,580 --> 00:41:53,660
protocol where things like that I would

1110
00:41:52,400 --> 00:41:56,000
go to his talk for more but yeah I mean

1111
00:41:53,660 --> 00:41:58,040
from what I could see I think they were

1112
00:41:56,000 --> 00:41:59,870
logging builds tear downs they had some

1113
00:41:58,040 --> 00:42:02,900
ACL hit logs coming off those devices so

1114
00:41:59,870 --> 00:42:04,220
I think I was seeing everything but

1115
00:42:02,900 --> 00:42:06,020
again in your organization I think you

1116
00:42:04,220 --> 00:42:09,819
could start to tear tear back the layers

1117
00:42:06,020 --> 00:42:09,820
and and find if there's gaps or not

1118
00:42:25,390 --> 00:42:33,819
[Music]

1119
00:42:39,440 --> 00:42:46,620
yeah so no I agree I mean I think Mia

1120
00:42:44,760 --> 00:42:49,680
organization are a unique spot right

1121
00:42:46,620 --> 00:42:52,890
because we work with near 200 enterprise

1122
00:42:49,680 --> 00:42:55,169
organizations I think in a more like a

1123
00:42:52,890 --> 00:42:56,310
single company approach if you are the

1124
00:42:55,170 --> 00:42:59,430
security ministry or for one company

1125
00:42:56,310 --> 00:43:00,810
things belong cap makes sense for us I

1126
00:42:59,430 --> 00:43:03,230
kind of see us taking it and putting it

1127
00:43:00,810 --> 00:43:05,970
into our product and more of a hunt so

1128
00:43:03,230 --> 00:43:07,470
using the queries and the api's that we

1129
00:43:05,970 --> 00:43:10,919
know exists with curate our logarithm

1130
00:43:07,470 --> 00:43:12,750
Splunk and writing that such that kind

1131
00:43:10,920 --> 00:43:15,150
of our product will translate those

1132
00:43:12,750 --> 00:43:18,090
queries into each technologies query

1133
00:43:15,150 --> 00:43:21,210
bring back that data and ourside can

1134
00:43:18,090 --> 00:43:22,860
visualize that but yes I think there's a

1135
00:43:21,210 --> 00:43:25,530
lot of options we could go down even

1136
00:43:22,860 --> 00:43:27,270
like a local Python scripts you know you

1137
00:43:25,530 --> 00:43:29,790
could do that and dump it to some sort

1138
00:43:27,270 --> 00:43:30,930
of JSON structure or something I it's

1139
00:43:29,790 --> 00:43:36,509
gotta be an approach there's got to be a

1140
00:43:30,930 --> 00:43:37,919
good approach any other questions all

1141
00:43:36,510 --> 00:43:39,330
right well thank you all for sticking

1142
00:43:37,920 --> 00:43:41,840
around for the talk we appreciate it

1143
00:43:39,330 --> 00:43:41,840
happy day

