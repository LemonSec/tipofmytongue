1
00:00:08,119 --> 00:00:15,030
let's go into big eyes um so if you guys

2
00:00:12,570 --> 00:00:17,610
attended a the earlier session at nine

3
00:00:15,030 --> 00:00:18,570
this morning about crypto wall you're

4
00:00:17,610 --> 00:00:21,650
going to be familiar with some of the

5
00:00:18,570 --> 00:00:21,650
topics that we're going to cover today

6
00:00:21,920 --> 00:00:27,480
so welcome to the presentation I'm Ryan

7
00:00:25,890 --> 00:00:29,160
to let I currently run security

8
00:00:27,480 --> 00:00:30,720
operations for a company called carbon

9
00:00:29,160 --> 00:00:34,710
black their local in boston they do

10
00:00:30,720 --> 00:00:36,140
endpoint security as a disclaimer some

11
00:00:34,710 --> 00:00:38,820
of the slides in here do you have

12
00:00:36,140 --> 00:00:41,519
snippets of our product in it but it's

13
00:00:38,820 --> 00:00:44,070
not marketing a promise marketing HR and

14
00:00:41,519 --> 00:00:47,909
sales has never seen this as you'll soon

15
00:00:44,070 --> 00:00:50,280
find out ah today I'm going to talk

16
00:00:47,909 --> 00:00:53,210
about how attackers particularly around

17
00:00:50,280 --> 00:00:56,129
the ransomware variants are abusing

18
00:00:53,210 --> 00:00:58,170
legitimately signed Microsoft binaries

19
00:00:56,129 --> 00:01:01,468
and how to defend your enterprise

20
00:00:58,170 --> 00:01:02,960
against nice type of tax using free and

21
00:01:01,469 --> 00:01:06,600
open source stuff that you can replicate

22
00:01:02,960 --> 00:01:09,390
in any of your environments I'll go over

23
00:01:06,600 --> 00:01:11,880
quickly uh you know who I am what I've

24
00:01:09,390 --> 00:01:13,979
been doing and a high level of the topic

25
00:01:11,880 --> 00:01:15,810
I can kind of assume that the majority

26
00:01:13,979 --> 00:01:18,360
of you in here know what ransomware is

27
00:01:15,810 --> 00:01:22,579
at least at a conceptual level so we can

28
00:01:18,360 --> 00:01:25,049
just skim through all that um so

29
00:01:22,579 --> 00:01:27,570
carondelet for the past 15 years I've

30
00:01:25,049 --> 00:01:30,630
been doing Incident Response forensics

31
00:01:27,570 --> 00:01:33,288
threat Intel and most recently more and

32
00:01:30,630 --> 00:01:36,630
more security operations focus stuff

33
00:01:33,289 --> 00:01:38,549
currently I'm handle basically the

34
00:01:36,630 --> 00:01:40,829
day-to-day operations of the sock handle

35
00:01:38,549 --> 00:01:42,719
our analysts going through the

36
00:01:40,829 --> 00:01:45,750
compliance doing security oversight all

37
00:01:42,719 --> 00:01:47,460
that good stuff I have a very long list

38
00:01:45,750 --> 00:01:50,299
of things I'm responsible for but they

39
00:01:47,460 --> 00:01:53,669
can all get summed up pretty quickly um

40
00:01:50,299 --> 00:01:57,659
basically any of you who work in sec ops

41
00:01:53,670 --> 00:02:00,950
know this feeling um you just we might

42
00:01:57,659 --> 00:02:04,340
as we told waste management really

43
00:02:00,950 --> 00:02:06,409
so so what's ransomware well if you type

44
00:02:04,340 --> 00:02:08,929
that question into google you get a

45
00:02:06,409 --> 00:02:11,360
definition of a particular piece of

46
00:02:08,929 --> 00:02:13,519
software that's designed to block access

47
00:02:11,360 --> 00:02:16,099
to a computer system until a sum of

48
00:02:13,519 --> 00:02:18,260
money is paid I can't really argue with

49
00:02:16,099 --> 00:02:19,599
that definition it's not mine I don't

50
00:02:18,260 --> 00:02:22,640
really think there is much room to argue

51
00:02:19,599 --> 00:02:24,619
but when it comes down to what can

52
00:02:22,640 --> 00:02:27,619
ransomware actually do to your system ah

53
00:02:24,620 --> 00:02:29,569
it does a ton of things a short list of

54
00:02:27,620 --> 00:02:31,970
them up here the most common are

55
00:02:29,569 --> 00:02:33,349
encrypting your files and not allowing

56
00:02:31,970 --> 00:02:36,319
you to use your system without paying

57
00:02:33,349 --> 00:02:38,390
the ransom there's also the scareware

58
00:02:36,319 --> 00:02:40,548
ransomware which just as a pop up that

59
00:02:38,390 --> 00:02:42,260
it just downloaded terrible things to

60
00:02:40,549 --> 00:02:45,079
your system and it will tell the cops

61
00:02:42,260 --> 00:02:47,179
about it if you don't pay but by far and

62
00:02:45,079 --> 00:02:50,209
away the most devious and evil thing

63
00:02:47,180 --> 00:02:54,110
I've ever seen right somewhere do is

64
00:02:50,209 --> 00:02:55,220
make you complete surveys and I would

65
00:02:54,110 --> 00:02:57,739
like to find out where that guy lives

66
00:02:55,220 --> 00:02:59,150
cuz how that's like it took me 20

67
00:02:57,739 --> 00:03:01,069
minutes to get through the survey so I

68
00:02:59,150 --> 00:03:09,019
could finish executing the ransomware in

69
00:03:01,069 --> 00:03:12,138
my lab you can't automate that so what's

70
00:03:09,019 --> 00:03:15,079
v shadow v shadow is a command line tool

71
00:03:12,139 --> 00:03:17,769
that microsoft created to allow you to

72
00:03:15,079 --> 00:03:21,069
create and manage volume shadow copies a

73
00:03:17,769 --> 00:03:23,660
shadow copies technology that's included

74
00:03:21,069 --> 00:03:26,450
that allows taking the backup copies of

75
00:03:23,660 --> 00:03:29,269
computer files or an entire volumes on

76
00:03:26,450 --> 00:03:32,000
the system these backups can be taken

77
00:03:29,269 --> 00:03:34,310
even when files are in use which adds to

78
00:03:32,000 --> 00:03:35,540
a whole bunch of use cases for this

79
00:03:34,310 --> 00:03:37,519
because you don't actually have to stop

80
00:03:35,540 --> 00:03:40,910
anything in order to start messing

81
00:03:37,519 --> 00:03:42,500
around the Shadow Copy um it's

82
00:03:40,910 --> 00:03:44,840
implemented in Windows as a service

83
00:03:42,500 --> 00:03:47,660
called the volume Shadow Copy Service or

84
00:03:44,840 --> 00:03:49,090
VSS so throughout the presentation

85
00:03:47,660 --> 00:03:52,069
you're going to hear a couple of terms

86
00:03:49,090 --> 00:03:55,630
they all kind of mean the same thing VSS

87
00:03:52,069 --> 00:03:58,160
VSS admin V shadow volume Shadow Copy um

88
00:03:55,630 --> 00:03:59,569
I'm just going to stick them in a shop

89
00:03:58,160 --> 00:04:01,220
gonna point it and you're going to get

90
00:03:59,569 --> 00:04:04,130
one of them but they all relate to the

91
00:04:01,220 --> 00:04:07,760
same concept they're just our names of

92
00:04:04,130 --> 00:04:10,090
different aspects of the same tool um I

93
00:04:07,760 --> 00:04:12,739
I can see from some of your expressions

94
00:04:10,090 --> 00:04:15,560
that you know why this is a bad thing

95
00:04:12,739 --> 00:04:17,750
right this is a legitimately sign

96
00:04:15,560 --> 00:04:20,478
microsoft binary that exists on your

97
00:04:17,750 --> 00:04:23,690
system already that when we abuse it

98
00:04:20,478 --> 00:04:28,250
doesn't raise any flags right from your

99
00:04:23,690 --> 00:04:32,360
normal detection sources so let's uh

100
00:04:28,250 --> 00:04:33,800
let's break something right so what I'm

101
00:04:32,360 --> 00:04:36,409
going to show you guys is actually how

102
00:04:33,800 --> 00:04:38,360
to do this attack um I cut out a few

103
00:04:36,409 --> 00:04:39,979
things there's one or two steps missing

104
00:04:38,360 --> 00:04:42,289
in there and I'm not telling you how to

105
00:04:39,979 --> 00:04:44,690
get on to the system because I'm not

106
00:04:42,289 --> 00:04:48,500
liable for the terrible things or pranks

107
00:04:44,690 --> 00:04:51,919
you will do with this there's my caveat

108
00:04:48,500 --> 00:04:54,289
and liability gun so some variants of

109
00:04:51,919 --> 00:04:55,669
the crypto Locker family particularly

110
00:04:54,289 --> 00:04:58,909
i'm going to talk about cryptolocker

111
00:04:55,669 --> 00:05:01,580
version 1 and its variants and by

112
00:04:58,909 --> 00:05:04,729
variants I mean they're minor revisions

113
00:05:01,580 --> 00:05:06,289
there's both probably thousands to

114
00:05:04,729 --> 00:05:08,690
different variants at this point there's

115
00:05:06,289 --> 00:05:10,969
you know ransomware in general the

116
00:05:08,690 --> 00:05:13,700
blocky the crypto wall cryptolocker all

117
00:05:10,969 --> 00:05:15,860
this stuff and at a conceptual level

118
00:05:13,700 --> 00:05:18,200
they're the same idea right they lock

119
00:05:15,860 --> 00:05:20,990
your down and they don't let you

120
00:05:18,200 --> 00:05:23,030
use it until you pay them um we're going

121
00:05:20,990 --> 00:05:26,270
to focus on one because you only have

122
00:05:23,030 --> 00:05:27,440
like 40 minutes to talk about it um so

123
00:05:26,270 --> 00:05:30,349
if you guys want to talk about the newer

124
00:05:27,440 --> 00:05:32,990
stuff I'm sure I can find beer somewhere

125
00:05:30,349 --> 00:05:35,630
and we'll go through it so the technique

126
00:05:32,990 --> 00:05:38,990
that I'm going to show you uh is what

127
00:05:35,630 --> 00:05:41,300
I've seen most recently with these minor

128
00:05:38,990 --> 00:05:44,030
variants and it's being utilized to

129
00:05:41,300 --> 00:05:46,610
avoid detection and for something called

130
00:05:44,030 --> 00:05:48,140
anti forensics or anti analysis

131
00:05:46,610 --> 00:05:50,979
depending on who you're talking to for

132
00:05:48,140 --> 00:05:53,479
terminology the technique consists of

133
00:05:50,979 --> 00:05:55,870
dropping your malware onto the file

134
00:05:53,479 --> 00:05:58,250
system via whatever mechanism you choose

135
00:05:55,870 --> 00:06:01,550
the second steps creating a volume

136
00:05:58,250 --> 00:06:03,700
shadow copy then mounting the volume

137
00:06:01,550 --> 00:06:05,630
shadow copy dropping them our on it

138
00:06:03,700 --> 00:06:06,990
executing the malware and then

139
00:06:05,630 --> 00:06:09,570
unmounting and deleting the

140
00:06:06,990 --> 00:06:11,940
shadow what's very unique about this

141
00:06:09,570 --> 00:06:14,670
technique is that even after unmounting

142
00:06:11,940 --> 00:06:16,740
and deleting of the shadow the mount

143
00:06:14,670 --> 00:06:18,180
we're still running so what we're really

144
00:06:16,740 --> 00:06:20,130
doing is we're taking away all the

145
00:06:18,180 --> 00:06:23,700
filesystem artifacts that exist it from

146
00:06:20,130 --> 00:06:27,300
the attack and having it still run that

147
00:06:23,700 --> 00:06:30,180
would really piss off your AV vendor so

148
00:06:27,300 --> 00:06:34,110
on windows XP the VSS admin tool doesn't

149
00:06:30,180 --> 00:06:36,750
exist natively later on microsoft

150
00:06:34,110 --> 00:06:38,820
supplied a patch that would add it to

151
00:06:36,750 --> 00:06:42,750
their but basically windows vista and up

152
00:06:38,820 --> 00:06:47,130
have built into the sdk the VSS admin

153
00:06:42,750 --> 00:06:49,970
executable once the volumes of sorry

154
00:06:47,130 --> 00:06:52,530
what's the Shadow Copy ends up getting

155
00:06:49,970 --> 00:06:55,410
executed on the system the attacker uses

156
00:06:52,530 --> 00:06:56,760
it to create persistent shadows what

157
00:06:55,410 --> 00:06:59,610
we're going to work with here is

158
00:06:56,760 --> 00:07:01,770
persistence as defined by survives

159
00:06:59,610 --> 00:07:03,980
between reboots so there's different

160
00:07:01,770 --> 00:07:06,750
forms of persistence there's different

161
00:07:03,980 --> 00:07:08,970
definitions of it depending on your use

162
00:07:06,750 --> 00:07:11,040
case and whatnot I'm very specifically

163
00:07:08,970 --> 00:07:13,590
talking about you can reboot the system

164
00:07:11,040 --> 00:07:17,430
and the malware remains and will run

165
00:07:13,590 --> 00:07:20,219
again so for this we're going to create

166
00:07:17,430 --> 00:07:23,340
this persistent shadow by having the

167
00:07:20,220 --> 00:07:26,100
dash p option p for persistence see for

168
00:07:23,340 --> 00:07:27,869
cookie whatever you like to have to

169
00:07:26,100 --> 00:07:29,340
remember it so we're going to point this

170
00:07:27,870 --> 00:07:31,740
towards the location on the file system

171
00:07:29,340 --> 00:07:33,270
of where we want to create the shadow

172
00:07:31,740 --> 00:07:37,050
what we're doing here is we're creating

173
00:07:33,270 --> 00:07:39,840
the shadow of the full C Drive the

174
00:07:37,050 --> 00:07:42,170
entire volume and what this is doing is

175
00:07:39,840 --> 00:07:44,429
it's allowing us to drop files into

176
00:07:42,170 --> 00:07:47,580
basically a file system that doesn't

177
00:07:44,430 --> 00:07:53,280
exist yet will mirror your active file

178
00:07:47,580 --> 00:07:56,310
system in the example what's going to

179
00:07:53,280 --> 00:07:58,440
happen when we kick off the initial V

180
00:07:56,310 --> 00:08:01,140
shadow executable with these options it

181
00:07:58,440 --> 00:08:03,360
takes a few seconds to run and what you

182
00:08:01,140 --> 00:08:07,110
see is the second output here that I

183
00:08:03,360 --> 00:08:09,540
have highlighted in red the thing I want

184
00:08:07,110 --> 00:08:12,150
to pay attention to is the ending name

185
00:08:09,540 --> 00:08:13,670
of it because that's what it's going to

186
00:08:12,150 --> 00:08:16,219
be referred to in the further

187
00:08:13,670 --> 00:08:18,710
not that this is you know something you

188
00:08:16,220 --> 00:08:20,360
have to memorize like CD dot dot means

189
00:08:18,710 --> 00:08:23,599
go back it's just what one we're going

190
00:08:20,360 --> 00:08:25,550
to use I probably could have named it

191
00:08:23,600 --> 00:08:29,480
something easier like Batman but I

192
00:08:25,550 --> 00:08:32,600
didn't take it at the time so going into

193
00:08:29,480 --> 00:08:34,880
the actual attack we created a shadow

194
00:08:32,600 --> 00:08:38,510
it's persistent it's there on the system

195
00:08:34,880 --> 00:08:39,679
well you have to mount it so what we're

196
00:08:38,510 --> 00:08:42,080
going to do is we're going to use this

197
00:08:39,679 --> 00:08:44,930
end link command to create a symbolic

198
00:08:42,080 --> 00:08:48,950
link which is very commonly done in

199
00:08:44,930 --> 00:08:51,140
lenox you can also do it in windows all

200
00:08:48,950 --> 00:08:53,960
here the attackers are creating the link

201
00:08:51,140 --> 00:08:56,090
in the system32 directory and what we

202
00:08:53,960 --> 00:09:01,850
did is we created another directory

203
00:08:56,090 --> 00:09:04,460
under it called msdc what we're doing is

204
00:09:01,850 --> 00:09:07,160
we're pointing the shadow into that

205
00:09:04,460 --> 00:09:08,660
directory so that new virtual file

206
00:09:07,160 --> 00:09:15,350
system that we just created a minute ago

207
00:09:08,660 --> 00:09:18,560
now exists in 6 32 / MS DC / volume

208
00:09:15,350 --> 00:09:20,000
shadow and everything that's under all

209
00:09:18,560 --> 00:09:21,589
the child directories all the child

210
00:09:20,000 --> 00:09:25,580
processes everything like that now

211
00:09:21,590 --> 00:09:28,070
exists in that one folder um the malware

212
00:09:25,580 --> 00:09:31,640
itself after this is mounted is dropped

213
00:09:28,070 --> 00:09:34,400
in /c of the volume shadow so you

214
00:09:31,640 --> 00:09:37,040
dropped in the root of it yet when you

215
00:09:34,400 --> 00:09:40,160
look at the system as you can see from

216
00:09:37,040 --> 00:09:45,020
the directory listing that we did that

217
00:09:40,160 --> 00:09:49,459
malware isn't in /c its insist 32 / ms

218
00:09:45,020 --> 00:09:50,750
DC / mallard exe that's not real malware

219
00:09:49,460 --> 00:09:54,050
that's command da da to you that i

220
00:09:50,750 --> 00:09:57,530
renamed just to show you that any binary

221
00:09:54,050 --> 00:09:58,880
can be used for this um so when you

222
00:09:57,530 --> 00:10:01,069
actually do a file listing of this

223
00:09:58,880 --> 00:10:03,530
you're not seeing anything weird or

224
00:10:01,070 --> 00:10:05,780
funky you're seeing a path that looks

225
00:10:03,530 --> 00:10:08,949
pretty legitimate if you saw a path

226
00:10:05,780 --> 00:10:11,750
insist 32 the directory named ms DC

227
00:10:08,950 --> 00:10:13,910
during your initial analysis of a system

228
00:10:11,750 --> 00:10:15,380
would that make the top of your list or

229
00:10:13,910 --> 00:10:17,150
would that fall towards the bottom of

230
00:10:15,380 --> 00:10:18,860
something that could be legitimate and

231
00:10:17,150 --> 00:10:21,560
I'll come back to it to look at it if

232
00:10:18,860 --> 00:10:22,590
nothing else pops up well for most of

233
00:10:21,560 --> 00:10:24,270
the time you're looking for

234
00:10:22,590 --> 00:10:26,310
weird things randomly generated file

235
00:10:24,270 --> 00:10:30,270
names some of this stuff that you'll see

236
00:10:26,310 --> 00:10:33,829
in a minute happening but this adds in a

237
00:10:30,270 --> 00:10:37,500
little bit of the not anti forensics but

238
00:10:33,830 --> 00:10:39,120
forensic deterrence right there making

239
00:10:37,500 --> 00:10:43,260
it harder for the investigators to find

240
00:10:39,120 --> 00:10:44,970
it by making themselves mimic the native

241
00:10:43,260 --> 00:10:47,850
tools native directories to native paths

242
00:10:44,970 --> 00:10:50,790
they're trying to hide themselves by

243
00:10:47,850 --> 00:10:52,320
living off the land so to speak so once

244
00:10:50,790 --> 00:10:53,670
the symlinks been created and the

245
00:10:52,320 --> 00:10:55,890
contents of the Shadow Copy are

246
00:10:53,670 --> 00:10:57,420
accessible via any normal means so you

247
00:10:55,890 --> 00:10:59,790
can use your command prompt to get to it

248
00:10:57,420 --> 00:11:02,760
you can use file explorer any batch

249
00:10:59,790 --> 00:11:05,550
script you write anything really can now

250
00:11:02,760 --> 00:11:08,520
interact with this file as if it existed

251
00:11:05,550 --> 00:11:11,670
on your actual file system well that's

252
00:11:08,520 --> 00:11:13,710
not connected I once the file systems in

253
00:11:11,670 --> 00:11:16,380
place the malware started just like any

254
00:11:13,710 --> 00:11:18,720
felder executable you know choose your

255
00:11:16,380 --> 00:11:20,790
weapon so to speak when the malware

256
00:11:18,720 --> 00:11:23,190
started you can look at it in a tool

257
00:11:20,790 --> 00:11:26,459
like process explorer I used um you know

258
00:11:23,190 --> 00:11:28,170
task manager for this to make it just

259
00:11:26,460 --> 00:11:30,120
basically look at what it's doing and we

260
00:11:28,170 --> 00:11:31,979
can see that the malware isn't running

261
00:11:30,120 --> 00:11:34,020
out of the rootsy directory where we

262
00:11:31,980 --> 00:11:36,810
actually dropped it it's running out of

263
00:11:34,020 --> 00:11:40,230
this msdc directory because it's linked

264
00:11:36,810 --> 00:11:42,420
to it and this is how the file system is

265
00:11:40,230 --> 00:11:45,420
actually representing the location of

266
00:11:42,420 --> 00:11:47,969
this malware now so the path doesn't

267
00:11:45,420 --> 00:11:50,579
really that suspicious and when you're

268
00:11:47,970 --> 00:11:53,160
looking for in your normal tools if I

269
00:11:50,580 --> 00:11:55,080
didn't have this named mallory XE you

270
00:11:53,160 --> 00:11:57,110
probably wouldn't do a second glance at

271
00:11:55,080 --> 00:11:57,110
it

272
00:11:57,750 --> 00:12:02,160
so once the malware started the attacker

273
00:12:00,420 --> 00:12:06,319
can unmount and delete the shadow and

274
00:12:02,160 --> 00:12:10,680
the matter will continue to run up here

275
00:12:06,320 --> 00:12:14,190
you can see that I have the structure of

276
00:12:10,680 --> 00:12:16,260
the msec I go in and I delete the Shadow

277
00:12:14,190 --> 00:12:18,510
Copy there's unmount commands and stuff

278
00:12:16,260 --> 00:12:20,280
but you know I like the break thing so I

279
00:12:18,510 --> 00:12:23,580
just didn't bother unmounting properly

280
00:12:20,280 --> 00:12:25,350
my USB would yell at me but the same

281
00:12:23,580 --> 00:12:29,580
kind of ideas here I just delete the

282
00:12:25,350 --> 00:12:34,230
Shadow Copy say yes to it but even after

283
00:12:29,580 --> 00:12:37,190
that our Mauer is still running so now

284
00:12:34,230 --> 00:12:39,210
what we see is it's a hiding mechanism

285
00:12:37,190 --> 00:12:40,800
and there's an empty friends have

286
00:12:39,210 --> 00:12:43,140
started because now you've removed

287
00:12:40,800 --> 00:12:46,349
filesystem artifacts that didn't really

288
00:12:43,140 --> 00:12:48,680
exist to begin with so how do you find

289
00:12:46,350 --> 00:12:51,480
it detected how are you going to end up

290
00:12:48,680 --> 00:12:54,420
finding this malware running on a system

291
00:12:51,480 --> 00:12:56,550
in your environment if most your tools

292
00:12:54,420 --> 00:13:00,030
are filed based security tools and file

293
00:12:56,550 --> 00:13:02,250
based sorry file system based visibility

294
00:13:00,030 --> 00:13:05,610
there's no registry values for this at

295
00:13:02,250 --> 00:13:08,010
the moment there's no new files there's

296
00:13:05,610 --> 00:13:10,620
not even temp files or metadata

297
00:13:08,010 --> 00:13:12,390
associated with it everything has been

298
00:13:10,620 --> 00:13:15,120
deleted and unless you're watching

299
00:13:12,390 --> 00:13:16,650
everything in real time and actually

300
00:13:15,120 --> 00:13:18,720
have this logged out to somewhere else

301
00:13:16,650 --> 00:13:21,000
you won't even see these commands that

302
00:13:18,720 --> 00:13:22,740
happened and your virus scanner won't

303
00:13:21,000 --> 00:13:25,980
detect them happening because it only

304
00:13:22,740 --> 00:13:27,150
scans at increments so basically your

305
00:13:25,980 --> 00:13:29,400
security tools have missed this

306
00:13:27,150 --> 00:13:32,060
completely and we just did in three

307
00:13:29,400 --> 00:13:37,740
seconds that you can do with the script

308
00:13:32,060 --> 00:13:39,810
surprise no I I like to end those sad

309
00:13:37,740 --> 00:13:46,380
notes with very happy things normally I

310
00:13:39,810 --> 00:13:47,939
dance but no so um so visibility right

311
00:13:46,380 --> 00:13:49,980
though that's the main thing we're

312
00:13:47,940 --> 00:13:52,170
talking about for the rest of the

313
00:13:49,980 --> 00:13:54,330
presentation um you see basically how

314
00:13:52,170 --> 00:13:56,729
the attack was was outlined and how it

315
00:13:54,330 --> 00:13:59,430
was executed all this can be done from a

316
00:13:56,730 --> 00:14:00,710
script so there's really nothing fancy

317
00:13:59,430 --> 00:14:03,800
or secret about it

318
00:14:00,710 --> 00:14:05,630
but what's you know more difficult more

319
00:14:03,800 --> 00:14:07,760
interesting is how are we going to

320
00:14:05,630 --> 00:14:09,110
actually find this happening and then

321
00:14:07,760 --> 00:14:11,810
how are we going to stop it from

322
00:14:09,110 --> 00:14:14,870
happening so we're going to do a couple

323
00:14:11,810 --> 00:14:16,339
things here first and foremost let's

324
00:14:14,870 --> 00:14:18,920
talk about the things that we can see

325
00:14:16,340 --> 00:14:20,510
when I do any kind of malware

326
00:14:18,920 --> 00:14:23,079
investigation I'd like to bucket things

327
00:14:20,510 --> 00:14:25,220
into two big buckets visibility and

328
00:14:23,080 --> 00:14:26,780
accountability if you can't see it you

329
00:14:25,220 --> 00:14:29,060
can't account for it you can't say who

330
00:14:26,780 --> 00:14:30,770
did what and when right if you're trying

331
00:14:29,060 --> 00:14:33,290
to do a friendship timeline or an IR

332
00:14:30,770 --> 00:14:35,630
it's one of your you know critical tasks

333
00:14:33,290 --> 00:14:37,790
you have to show time lining what

334
00:14:35,630 --> 00:14:41,470
happened over time what was the scope of

335
00:14:37,790 --> 00:14:43,760
it all this really boring paperwork but

336
00:14:41,470 --> 00:14:45,380
what's really important about it is it

337
00:14:43,760 --> 00:14:47,840
also finds those gaps you have in your

338
00:14:45,380 --> 00:14:50,150
security already and it's really about

339
00:14:47,840 --> 00:14:51,860
adding more and more visibility until

340
00:14:50,150 --> 00:14:54,500
you slowly but surely kind of tie a

341
00:14:51,860 --> 00:14:56,180
fence around the accountability right we

342
00:14:54,500 --> 00:14:58,910
find those gaps and you start trying to

343
00:14:56,180 --> 00:15:00,890
detect things so what I'm going to do is

344
00:14:58,910 --> 00:15:04,250
I'm going to go over this from two

345
00:15:00,890 --> 00:15:06,710
points of view what's it look like from

346
00:15:04,250 --> 00:15:09,620
the host point of view so using only

347
00:15:06,710 --> 00:15:12,440
native tools on the system what can we

348
00:15:09,620 --> 00:15:15,260
find and then the second one is I have

349
00:15:12,440 --> 00:15:17,900
two slides with an IR tool which is

350
00:15:15,260 --> 00:15:19,880
carbon black one because it's free I

351
00:15:17,900 --> 00:15:23,750
don't have to pay for it and ignites and

352
00:15:19,880 --> 00:15:25,610
very nice pretty pictures but going to

353
00:15:23,750 --> 00:15:28,100
show these two techniques after that I'm

354
00:15:25,610 --> 00:15:30,740
going to go into had actually block this

355
00:15:28,100 --> 00:15:32,150
from happening using only native tools

356
00:15:30,740 --> 00:15:34,340
that if you have a Windows environment

357
00:15:32,150 --> 00:15:36,430
you already own these tools and have a

358
00:15:34,340 --> 00:15:40,519
fully licensed so

359
00:15:36,430 --> 00:15:43,128
all so you don't have to memorize this I

360
00:15:40,519 --> 00:15:46,459
noticed a crap ton info but I'm going to

361
00:15:43,129 --> 00:15:48,019
quiz you all later and since we

362
00:15:46,459 --> 00:15:50,329
detonated this malware on purpose right

363
00:15:48,019 --> 00:15:52,279
we have this short list we don't really

364
00:15:50,329 --> 00:15:54,888
have that luxury in the real world right

365
00:15:52,279 --> 00:15:56,750
you're not going to have a list of you

366
00:15:54,889 --> 00:15:59,420
know I ox and things like that square

367
00:15:56,750 --> 00:16:01,370
off the bat you'll be lucky if you have

368
00:15:59,420 --> 00:16:04,339
a basic alert when this thing tried to

369
00:16:01,370 --> 00:16:05,360
beacon home or talk about something to

370
00:16:04,339 --> 00:16:08,720
make this work a little bit more

371
00:16:05,360 --> 00:16:11,509
realistic what I'm going to do is I'm

372
00:16:08,720 --> 00:16:14,000
going to create what I call watch lists

373
00:16:11,509 --> 00:16:16,759
which are basic things that I have for

374
00:16:14,000 --> 00:16:18,439
monitoring on my local system that

375
00:16:16,759 --> 00:16:21,079
happened in real time so as this event

376
00:16:18,439 --> 00:16:24,469
goes off I know about it think of it as

377
00:16:21,079 --> 00:16:28,399
you know like I think the like a like a

378
00:16:24,470 --> 00:16:30,410
trip wire or any other kind of automated

379
00:16:28,399 --> 00:16:33,199
script you up running that'll tell you a

380
00:16:30,410 --> 00:16:35,870
file systems change hashing anything

381
00:16:33,199 --> 00:16:39,979
like that basically tell me when this

382
00:16:35,870 --> 00:16:42,170
behavior or event occurs up so what I'm

383
00:16:39,980 --> 00:16:45,110
going to look for is conditions that

384
00:16:42,170 --> 00:16:49,120
occur if VSS admin was executed from the

385
00:16:45,110 --> 00:16:53,180
command line der from a batch script so

386
00:16:49,120 --> 00:16:55,670
let's do it from the IR tool so once

387
00:16:53,180 --> 00:16:57,800
again does pretty pictures of what's

388
00:16:55,670 --> 00:17:01,009
interesting about the malware that I

389
00:16:57,800 --> 00:17:05,599
executed so when I did this full attack

390
00:17:01,009 --> 00:17:09,470
I ended up using a copy of crypto Locker

391
00:17:05,599 --> 00:17:11,119
that I got from Mauer calm right I just

392
00:17:09,470 --> 00:17:13,010
pulled it down and I executed it and I

393
00:17:11,119 --> 00:17:16,129
wanted to see what happened the file

394
00:17:13,010 --> 00:17:19,970
that I pulled down ended up having some

395
00:17:16,130 --> 00:17:23,089
kind of extension obfuscation what it

396
00:17:19,970 --> 00:17:25,579
represented itself as is a PDF file yet

397
00:17:23,089 --> 00:17:28,309
we know unfortunately cut off the really

398
00:17:25,579 --> 00:17:30,168
long hash name of it that even though

399
00:17:28,309 --> 00:17:32,629
it's showing itself as a PDF it's

400
00:17:30,169 --> 00:17:35,240
actually an executable so when you try

401
00:17:32,630 --> 00:17:38,900
to read that PDF on your system it opens

402
00:17:35,240 --> 00:17:42,289
up a couple of child processes and start

403
00:17:38,900 --> 00:17:46,159
spawning off things to look at based on

404
00:17:42,289 --> 00:17:48,080
the alert you know alone a PDF is an

405
00:17:46,159 --> 00:17:50,240
executable is hiding itself as a PD

406
00:17:48,080 --> 00:17:52,100
is a warning flag and something you

407
00:17:50,240 --> 00:17:54,279
should investigate but the fact that a

408
00:17:52,100 --> 00:17:57,199
PDF is spawning off child processes

409
00:17:54,279 --> 00:17:58,940
gives me even more worried to look at so

410
00:17:57,200 --> 00:18:02,269
let's go up the tree and kind of look at

411
00:17:58,940 --> 00:18:03,860
what the originating file was so the

412
00:18:02,269 --> 00:18:05,360
original file is it has this really long

413
00:18:03,860 --> 00:18:07,189
hash number and that's because I pulled

414
00:18:05,360 --> 00:18:09,350
it down off you know place that's a

415
00:18:07,190 --> 00:18:12,590
malware database and that's how they

416
00:18:09,350 --> 00:18:14,840
store the models by hashes but the icons

417
00:18:12,590 --> 00:18:17,600
that it shows itself is something to

418
00:18:14,840 --> 00:18:22,279
give us a warning but also the hash when

419
00:18:17,600 --> 00:18:23,899
I go look it up it's like a 43 out of 56

420
00:18:22,279 --> 00:18:26,570
score a that's probably something you

421
00:18:23,899 --> 00:18:30,018
should look at and check out in your

422
00:18:26,570 --> 00:18:31,428
environment but if we break it down to

423
00:18:30,019 --> 00:18:34,490
what are the things that actually did on

424
00:18:31,429 --> 00:18:37,340
the system it spawned three new child

425
00:18:34,490 --> 00:18:39,110
processes which then spawned grandchild

426
00:18:37,340 --> 00:18:40,639
process these great grandchild processes

427
00:18:39,110 --> 00:18:43,039
all the way down to do its dirty work

428
00:18:40,639 --> 00:18:44,870
throughout the system it ended up

429
00:18:43,039 --> 00:18:47,419
creating for new registry values and

430
00:18:44,870 --> 00:18:49,668
from these registry values we can infer

431
00:18:47,419 --> 00:18:52,220
that it is doing extra persistence

432
00:18:49,669 --> 00:18:54,909
mechanisms on your system it's adding

433
00:18:52,220 --> 00:18:58,850
registry values to the run once and run

434
00:18:54,909 --> 00:19:01,070
registry keys so that way it can try to

435
00:18:58,850 --> 00:19:03,889
execute itself on boots and at login

436
00:19:01,070 --> 00:19:06,799
which is a common persistence mechanism

437
00:19:03,889 --> 00:19:09,918
and then it also created ten new files

438
00:19:06,799 --> 00:19:11,210
on the system y you can see them in the

439
00:19:09,919 --> 00:19:12,559
different paths but i'll talk about them

440
00:19:11,210 --> 00:19:14,539
a little more in the next section that

441
00:19:12,559 --> 00:19:15,830
actually details the full file path in

442
00:19:14,539 --> 00:19:20,090
and how tiding the persistence

443
00:19:15,830 --> 00:19:21,408
mechanisms based on our findings no you

444
00:19:20,090 --> 00:19:25,820
can tell pretty well easily that you're

445
00:19:21,409 --> 00:19:28,760
owned right and you basically need to

446
00:19:25,820 --> 00:19:31,309
reimage at this point so how do we go

447
00:19:28,760 --> 00:19:33,590
through the manual process of detecting

448
00:19:31,309 --> 00:19:36,440
this and then removing these files

449
00:19:33,590 --> 00:19:38,750
having only tools that's on you know

450
00:19:36,440 --> 00:19:40,549
your grandmother's computer you know i'm

451
00:19:38,750 --> 00:19:42,200
not talking about in the enterprise when

452
00:19:40,549 --> 00:19:44,870
you can pay for a half-million-dollar

453
00:19:42,200 --> 00:19:47,059
technology i'm talking about you know

454
00:19:44,870 --> 00:19:50,000
your grandma calls you up that her

455
00:19:47,059 --> 00:19:52,250
system has a weird red pop up on it can

456
00:19:50,000 --> 00:19:57,139
you help her out and that's what we're

457
00:19:52,250 --> 00:20:00,220
going to go into the hunting native so

458
00:19:57,139 --> 00:20:04,550
what happens on the host point of view

459
00:20:00,220 --> 00:20:07,730
well what we can see is we can do some

460
00:20:04,550 --> 00:20:10,780
time stamp mapping so up here at the top

461
00:20:07,730 --> 00:20:13,940
I have a little powershell snippet

462
00:20:10,780 --> 00:20:15,950
because batch scripting is weird and if

463
00:20:13,940 --> 00:20:19,640
you try to do this in batch script you

464
00:20:15,950 --> 00:20:22,400
actually have to say show me all files

465
00:20:19,640 --> 00:20:24,680
modified in a certain time then show me

466
00:20:22,400 --> 00:20:26,360
all files modified within a different

467
00:20:24,680 --> 00:20:28,400
set of time and then do a diff between

468
00:20:26,360 --> 00:20:31,659
the two and that's what you get left

469
00:20:28,400 --> 00:20:34,850
with that's confusing that's annoying so

470
00:20:31,660 --> 00:20:36,350
powershell just very straightforward and

471
00:20:34,850 --> 00:20:37,879
what this is doing is basically looking

472
00:20:36,350 --> 00:20:41,199
for tell me all files that were created

473
00:20:37,880 --> 00:20:44,030
on the system in the last 24 hours so

474
00:20:41,200 --> 00:20:45,830
how many people here have done some kind

475
00:20:44,030 --> 00:20:50,060
of mal reverse engineering or I our

476
00:20:45,830 --> 00:20:53,360
stuff so you guys know malware changes

477
00:20:50,060 --> 00:20:56,659
its time stamps right it usually changes

478
00:20:53,360 --> 00:20:58,070
its modified timestamp but it's really

479
00:20:56,660 --> 00:21:00,620
rare for it to change its creation

480
00:20:58,070 --> 00:21:03,230
timestamp for automated attacks for very

481
00:21:00,620 --> 00:21:04,540
specific campaigns or specific targeted

482
00:21:03,230 --> 00:21:07,790
attacks yeah it'll change everything

483
00:21:04,540 --> 00:21:10,370
possibly can but in this case since it

484
00:21:07,790 --> 00:21:12,379
was all automated we can depend pretty

485
00:21:10,370 --> 00:21:15,199
well on the creation time for this

486
00:21:12,380 --> 00:21:16,760
detection and what I've done is I

487
00:21:15,200 --> 00:21:19,100
basically I ran the script and I got a

488
00:21:16,760 --> 00:21:21,830
list of tell me every single file that

489
00:21:19,100 --> 00:21:24,290
was created in this time frame when it

490
00:21:21,830 --> 00:21:26,560
was created I was then either able to

491
00:21:24,290 --> 00:21:28,940
just parse through the list and look for

492
00:21:26,560 --> 00:21:31,429
what a rent what looks like a randomly

493
00:21:28,940 --> 00:21:34,400
generated file name and out of a

494
00:21:31,430 --> 00:21:37,730
location where a new binary shouldn't

495
00:21:34,400 --> 00:21:39,320
have been created so we have a brand new

496
00:21:37,730 --> 00:21:42,500
binary that looks pretty randomly

497
00:21:39,320 --> 00:21:45,620
generated in your roaming directory from

498
00:21:42,500 --> 00:21:48,820
app data for those you who have worked

499
00:21:45,620 --> 00:21:51,620
with you know Trojans before Zeus SpyEye

500
00:21:48,820 --> 00:21:54,530
this is where all of the Trojans drop

501
00:21:51,620 --> 00:21:56,360
their executables or in a child

502
00:21:54,530 --> 00:21:58,639
directory of this directory it's

503
00:21:56,360 --> 00:22:00,139
extremely common to the point where this

504
00:21:58,640 --> 00:22:02,120
is one of the first places I look on a

505
00:22:00,140 --> 00:22:04,310
system if I'm trying to see if it's

506
00:22:02,120 --> 00:22:05,629
owned there's a couple other directories

507
00:22:04,310 --> 00:22:08,270
i'm going to show you that i look at

508
00:22:05,630 --> 00:22:11,430
that are the first places I look for

509
00:22:08,270 --> 00:22:12,900
so now that we found this thread right

510
00:22:11,430 --> 00:22:14,970
we found one thing that looks kind of

511
00:22:12,900 --> 00:22:16,950
weird let's pull on it a bit and see

512
00:22:14,970 --> 00:22:20,970
where it takes us I keep thinking this

513
00:22:16,950 --> 00:22:24,180
is plugged in oh well in the process of

514
00:22:20,970 --> 00:22:26,790
researching ways of trying to find these

515
00:22:24,180 --> 00:22:29,400
detections I was thinking about how can

516
00:22:26,790 --> 00:22:31,409
I create my own little tool to end up

517
00:22:29,400 --> 00:22:34,920
basically be in my virus total check

518
00:22:31,410 --> 00:22:37,460
right virustotal is a database of hashes

519
00:22:34,920 --> 00:22:42,930
that associated good and bad known files

520
00:22:37,460 --> 00:22:45,000
and basically every AV vendor has an

521
00:22:42,930 --> 00:22:47,100
engine up there I'll assault all the

522
00:22:45,000 --> 00:22:48,840
most prominent ones so you can actually

523
00:22:47,100 --> 00:22:51,959
see if any of them have a signature for

524
00:22:48,840 --> 00:22:54,629
the file that you're working with what's

525
00:22:51,960 --> 00:22:57,270
nice is they have an API so i can use

526
00:22:54,630 --> 00:22:59,130
python just the toss the file up or

527
00:22:57,270 --> 00:23:01,670
check the hash and returns a bunch of

528
00:22:59,130 --> 00:23:04,110
data for me in this case what i did is i

529
00:23:01,670 --> 00:23:06,420
found out that window is actually has a

530
00:23:04,110 --> 00:23:08,100
native hashing tool that i had no idea

531
00:23:06,420 --> 00:23:10,710
it existed I've always used the third

532
00:23:08,100 --> 00:23:13,980
party tool to do it but this command up

533
00:23:10,710 --> 00:23:16,950
here was very useful for me um it's a

534
00:23:13,980 --> 00:23:18,840
cert util command and you I threw this

535
00:23:16,950 --> 00:23:21,090
in a script and went through all those

536
00:23:18,840 --> 00:23:22,980
files that I found the last PowerShell

537
00:23:21,090 --> 00:23:25,919
so I just put those two things together

538
00:23:22,980 --> 00:23:29,130
so for every file that was created in

539
00:23:25,920 --> 00:23:31,560
last 24 hours hash it and then drop it

540
00:23:29,130 --> 00:23:32,970
into my virustotal check goes out and

541
00:23:31,560 --> 00:23:34,830
checks the hash comes back with the

542
00:23:32,970 --> 00:23:38,880
score and tells me those things and

543
00:23:34,830 --> 00:23:40,409
prints me out a nice pretty CSV it did

544
00:23:38,880 --> 00:23:43,710
your return doesn't look like the nice

545
00:23:40,410 --> 00:23:48,150
fires total picture but CSDs not that

546
00:23:43,710 --> 00:23:50,400
pretty to put up so once again we can

547
00:23:48,150 --> 00:23:52,650
see off this check you know using just

548
00:23:50,400 --> 00:23:56,820
native tools that are already installed

549
00:23:52,650 --> 00:23:59,400
on your system that this has a score of

550
00:23:56,820 --> 00:24:02,040
44 out of 56 and virustotal and it's on

551
00:23:59,400 --> 00:24:03,330
your system we should look at it but

552
00:24:02,040 --> 00:24:04,740
let's look at some other associated

553
00:24:03,330 --> 00:24:06,960
things right we have the creation

554
00:24:04,740 --> 00:24:09,000
timestamp of this file now well if this

555
00:24:06,960 --> 00:24:11,430
was done through a script there should

556
00:24:09,000 --> 00:24:13,080
be other created files within a very

557
00:24:11,430 --> 00:24:15,270
short time frame around it because it's

558
00:24:13,080 --> 00:24:19,649
all automated so let's start looking for

559
00:24:15,270 --> 00:24:20,379
those so next up we find that created at

560
00:24:19,650 --> 00:24:23,140
roughly the same

561
00:24:20,380 --> 00:24:24,970
time is a file actually by the same name

562
00:24:23,140 --> 00:24:27,310
this isn't always true with the same

563
00:24:24,970 --> 00:24:29,080
name but in this case it was created at

564
00:24:27,310 --> 00:24:31,840
pretty much the exact same time stand-in

565
00:24:29,080 --> 00:24:34,600
your start menu programs start a folder

566
00:24:31,840 --> 00:24:37,090
this is the second place a commonly look

567
00:24:34,600 --> 00:24:40,360
because this has been a persistence

568
00:24:37,090 --> 00:24:43,389
location for the past two or three years

569
00:24:40,360 --> 00:24:45,280
at least with the cryptolocker variants

570
00:24:43,390 --> 00:24:47,530
that I've been working with so first

571
00:24:45,280 --> 00:24:49,720
place I check is app data looking local

572
00:24:47,530 --> 00:24:52,840
local oh and roaming and then I come

573
00:24:49,720 --> 00:24:56,530
over to the startup directory this is

574
00:24:52,840 --> 00:24:58,689
where applications that start on login

575
00:24:56,530 --> 00:25:01,530
are so things like if you want your

576
00:24:58,690 --> 00:25:04,030
outlook to start at login it drops of

577
00:25:01,530 --> 00:25:05,800
basically a redirect link in here now

578
00:25:04,030 --> 00:25:09,820
outlook starts when you log into your

579
00:25:05,800 --> 00:25:13,120
system so on next up going through the

580
00:25:09,820 --> 00:25:15,429
timestamps again I'm able to find a

581
00:25:13,120 --> 00:25:18,520
hidden directory actually at the root

582
00:25:15,430 --> 00:25:20,830
sidra directory which once again is

583
00:25:18,520 --> 00:25:22,120
named the same thing I'm starting to

584
00:25:20,830 --> 00:25:23,919
think you know this off it doesn't have

585
00:25:22,120 --> 00:25:26,739
much imagination they should have make

586
00:25:23,920 --> 00:25:29,590
better names but I'm going off

587
00:25:26,740 --> 00:25:33,160
timestamps at this point in time and I

588
00:25:29,590 --> 00:25:36,340
find get another thing so I end up doing

589
00:25:33,160 --> 00:25:38,530
a search for all hidden in this

590
00:25:36,340 --> 00:25:40,899
directory at end up finding this and get

591
00:25:38,530 --> 00:25:43,960
some more information about it inside

592
00:25:40,900 --> 00:25:46,210
this directory is actually another

593
00:25:43,960 --> 00:25:47,770
binary by the same name which is the

594
00:25:46,210 --> 00:25:49,990
exact same hash as the stuff we've been

595
00:25:47,770 --> 00:25:52,540
finding so if for those of you who

596
00:25:49,990 --> 00:25:56,230
accounting that's three new binaries

597
00:25:52,540 --> 00:25:58,270
that it's done in different places it's

598
00:25:56,230 --> 00:26:00,700
in your roaming directory which is the

599
00:25:58,270 --> 00:26:02,830
primary when it's working off of it's in

600
00:26:00,700 --> 00:26:05,200
your startup directory which is unknown

601
00:26:02,830 --> 00:26:07,419
persistence mechanism and then if you

602
00:26:05,200 --> 00:26:08,770
found both of those it created hidden

603
00:26:07,420 --> 00:26:11,830
directory and through the binary in

604
00:26:08,770 --> 00:26:14,110
there as well alright and the best part

605
00:26:11,830 --> 00:26:15,699
is after it does this it then deletes

606
00:26:14,110 --> 00:26:18,040
the originating binary from where you

607
00:26:15,700 --> 00:26:21,550
downloaded it to so it's trying to hide

608
00:26:18,040 --> 00:26:23,590
its tracks so if we look in this hidden

609
00:26:21,550 --> 00:26:27,460
directory we find once again that binary

610
00:26:23,590 --> 00:26:30,909
that's the exact same thing the author

611
00:26:27,460 --> 00:26:32,410
is very much afraid of this being found

612
00:26:30,910 --> 00:26:32,950
so the creating backup plans for the

613
00:26:32,410 --> 00:26:35,710
backup

614
00:26:32,950 --> 00:26:37,419
is for the backup plans and I for one

615
00:26:35,710 --> 00:26:40,690
feel that that kind of paranoia is not

616
00:26:37,419 --> 00:26:45,070
healthy and they should really talk to

617
00:26:40,690 --> 00:26:47,139
someone about it so talking about those

618
00:26:45,070 --> 00:26:48,309
persistent mechanisms something that

619
00:26:47,139 --> 00:26:51,250
you're not really able to search for

620
00:26:48,309 --> 00:26:53,200
it's that time stamping but because we

621
00:26:51,250 --> 00:26:57,130
did the original time stamp search first

622
00:26:53,200 --> 00:26:59,350
we're able to know file names so an full

623
00:26:57,130 --> 00:27:01,779
file paths so now we can search the

624
00:26:59,350 --> 00:27:04,809
registry for those file names and file

625
00:27:01,779 --> 00:27:08,289
paths to find more so she ated artifacts

626
00:27:04,809 --> 00:27:09,789
so if we search through it um we can

627
00:27:08,289 --> 00:27:13,720
actually find some things these are in

628
00:27:09,789 --> 00:27:15,850
the run and run once which are the

629
00:27:13,720 --> 00:27:18,519
registry keys that are used for when

630
00:27:15,850 --> 00:27:22,689
things boot sorry when applications

631
00:27:18,519 --> 00:27:25,179
launch either at boot or login I can't

632
00:27:22,690 --> 00:27:27,460
remember which ones which I think run is

633
00:27:25,179 --> 00:27:29,070
for a regular login and run once is for

634
00:27:27,460 --> 00:27:32,019
safe mode or it's the other way around

635
00:27:29,070 --> 00:27:35,379
if anybody knows shout it out I don't

636
00:27:32,019 --> 00:27:37,539
remember off top of my head but what I

637
00:27:35,380 --> 00:27:41,350
can infer from these being in existence

638
00:27:37,539 --> 00:27:43,299
is that once again the attacker is

639
00:27:41,350 --> 00:27:46,120
aiming for more and more mechanism

640
00:27:43,299 --> 00:27:48,010
persistence they're trying to get more

641
00:27:46,120 --> 00:27:51,360
ways on there they're making it harder

642
00:27:48,010 --> 00:27:51,360
for them to be removed from the system

643
00:27:52,799 --> 00:28:02,470
next up ah if you're after this stuff is

644
00:27:57,970 --> 00:28:04,929
run well you can start to see a list so

645
00:28:02,470 --> 00:28:07,720
there's a registry value called

646
00:28:04,929 --> 00:28:10,600
cryptolocker for other malwares this

647
00:28:07,720 --> 00:28:12,000
doesn't exist but in this case this is a

648
00:28:10,600 --> 00:28:15,158
list of everything that's encrypted

649
00:28:12,000 --> 00:28:17,980
right in your registry I refer to this

650
00:28:15,159 --> 00:28:21,549
as the pissed list because the more you

651
00:28:17,980 --> 00:28:23,950
read it the angrier you get and if this

652
00:28:21,549 --> 00:28:27,370
ends up on your executives machine you

653
00:28:23,950 --> 00:28:31,389
have a real problem right oh this is not

654
00:28:27,370 --> 00:28:34,768
a happy person to deal with no no just

655
00:28:31,389 --> 00:28:34,769
soak it in really that's

656
00:28:35,500 --> 00:28:39,289
originally I had the JIP of us steve

657
00:28:37,760 --> 00:28:42,679
ballmer and Bill Gates doing the dance

658
00:28:39,289 --> 00:28:49,279
with the huge shoulder pads but now this

659
00:28:42,679 --> 00:28:52,870
one wins um so how do we detect this

660
00:28:49,279 --> 00:28:56,179
attack how do we avoid the whining exact

661
00:28:52,870 --> 00:29:00,408
that's really upset so let's let's talk

662
00:28:56,179 --> 00:29:02,360
about a bit we're going to stick to

663
00:29:00,409 --> 00:29:04,909
different kinds of indicators here so I

664
00:29:02,360 --> 00:29:08,408
broke it into two categories right

665
00:29:04,909 --> 00:29:11,299
there's I ox which are I consider static

666
00:29:08,409 --> 00:29:14,570
kind of indicators so things like hashes

667
00:29:11,299 --> 00:29:17,690
file names registry values even full

668
00:29:14,570 --> 00:29:20,178
paths and network connections I consider

669
00:29:17,690 --> 00:29:22,820
those static the IP addresses and domain

670
00:29:20,179 --> 00:29:26,120
names are not static so I group those

671
00:29:22,820 --> 00:29:29,689
into the behaviors category because any

672
00:29:26,120 --> 00:29:33,860
of you familiar with DGA to Trojans of

673
00:29:29,690 --> 00:29:36,649
domain generating an algorithm so an

674
00:29:33,860 --> 00:29:39,620
author will basically register a couple

675
00:29:36,649 --> 00:29:42,320
thousand domains based off an algorithm

676
00:29:39,620 --> 00:29:45,529
and the algorithm is put into the actual

677
00:29:42,320 --> 00:29:47,840
code so depending on some kind of

678
00:29:45,529 --> 00:29:50,330
factors in some fancy math it knows

679
00:29:47,840 --> 00:29:52,580
which domain name to reach out to and

680
00:29:50,330 --> 00:29:58,309
all these domain names redirect one

681
00:29:52,580 --> 00:29:59,960
single cnc host right um sorry somebody

682
00:29:58,309 --> 00:30:02,120
out there's name is Ryan and so is mine

683
00:29:59,960 --> 00:30:06,200
so every time so he says it I kind of

684
00:30:02,120 --> 00:30:08,510
twitch um so so I'm sticking the

685
00:30:06,200 --> 00:30:11,210
indicators that you can use in other

686
00:30:08,510 --> 00:30:14,510
tools right not just the the fancy ones

687
00:30:11,210 --> 00:30:17,120
that I have but pretty much any kind of

688
00:30:14,510 --> 00:30:19,970
IR tool so these hashes which is not a

689
00:30:17,120 --> 00:30:22,340
full list they constantly update these

690
00:30:19,970 --> 00:30:24,620
and the hash changes but to give you an

691
00:30:22,340 --> 00:30:29,750
example here's the hashes that I pulled

692
00:30:24,620 --> 00:30:32,639
off of msdn for windows 7 8 and 8 10

693
00:30:29,750 --> 00:30:34,890
even vista

694
00:30:32,640 --> 00:30:38,910
you know that that are 32-bit and 64-bit

695
00:30:34,890 --> 00:30:41,220
and then what I did is I took them and I

696
00:30:38,910 --> 00:30:43,020
threw them into whatever I are two lad

697
00:30:41,220 --> 00:30:44,880
at the time you could do this search

698
00:30:43,020 --> 00:30:47,879
manually if you really want you do a

699
00:30:44,880 --> 00:30:51,060
powershell script to do it but I just

700
00:30:47,880 --> 00:30:53,550
threw it into my script so um you know

701
00:30:51,060 --> 00:30:54,929
process md5 is that hash and then you

702
00:30:53,550 --> 00:30:57,110
see an or state Matt the end because

703
00:30:54,930 --> 00:31:03,930
originally had them all on there but

704
00:30:57,110 --> 00:31:06,030
space and I forgot to delete the or so

705
00:31:03,930 --> 00:31:09,360
you can grab these indicators and start

706
00:31:06,030 --> 00:31:11,520
searching for them in your tools these

707
00:31:09,360 --> 00:31:14,219
hashes are specifically for the s2k

708
00:31:11,520 --> 00:31:16,080
versions of V shadow so these are the

709
00:31:14,220 --> 00:31:18,990
ones that are not natively on your

710
00:31:16,080 --> 00:31:21,600
system so you can find these and it's

711
00:31:18,990 --> 00:31:24,570
not a developer and that's a bad sign

712
00:31:21,600 --> 00:31:26,939
because you know your marketing guy is

713
00:31:24,570 --> 00:31:31,050
not going to install copies of the

714
00:31:26,940 --> 00:31:32,520
shadow to look at Salesforce what if he

715
00:31:31,050 --> 00:31:36,750
does I want to talk to him cuz that

716
00:31:32,520 --> 00:31:39,120
dudes a genius um so let's take a little

717
00:31:36,750 --> 00:31:41,970
bit closer look at the v shadow that EXT

718
00:31:39,120 --> 00:31:44,370
process um one of the attributes that

719
00:31:41,970 --> 00:31:46,680
we're looking for is unique

720
00:31:44,370 --> 00:31:48,989
characteristics right how do you choose

721
00:31:46,680 --> 00:31:53,370
between a legitimate execution V shadow

722
00:31:48,990 --> 00:31:56,070
and an illegitimate use of it well here

723
00:31:53,370 --> 00:31:57,870
we can see that parent process ease

724
00:31:56,070 --> 00:32:00,899
would be something like you know

725
00:31:57,870 --> 00:32:03,000
commanded exe so if you see command that

726
00:32:00,900 --> 00:32:04,530
exe Ron you know that either somebody

727
00:32:03,000 --> 00:32:06,900
manually type that in their command

728
00:32:04,530 --> 00:32:08,879
prompt or a batch file did it all right

729
00:32:06,900 --> 00:32:11,880
because it runs under the same parent

730
00:32:08,880 --> 00:32:14,540
process in this case I'm looking for

731
00:32:11,880 --> 00:32:18,120
very specific things such as the VSS

732
00:32:14,540 --> 00:32:21,360
underscore PS dll which is loaded only

733
00:32:18,120 --> 00:32:24,689
for v shadow so i can narrow this down

734
00:32:21,360 --> 00:32:28,110
to if i look for this dll being loaded I

735
00:32:24,690 --> 00:32:31,680
know that V shadow was executed and was

736
00:32:28,110 --> 00:32:33,659
executed out of a sprint so I ended up

737
00:32:31,680 --> 00:32:36,780
writing these queries down here which

738
00:32:33,660 --> 00:32:39,480
basically look for on the detection of

739
00:32:36,780 --> 00:32:41,040
the loading of the dsl sorry not the dsl

740
00:32:39,480 --> 00:32:45,810
the dll

741
00:32:41,040 --> 00:32:48,060
because that's faster than dsl and you

742
00:32:45,810 --> 00:32:49,679
gotta laugh or you'll cry oh so once

743
00:32:48,060 --> 00:32:51,450
this loads up we have to look for a

744
00:32:49,680 --> 00:32:54,000
command-line argument of dash p for that

745
00:32:51,450 --> 00:32:55,500
persistence so this was the initial step

746
00:32:54,000 --> 00:32:57,690
that i showed you guys in the attack

747
00:32:55,500 --> 00:33:01,440
we're now looking for that happening in

748
00:32:57,690 --> 00:33:03,390
real time on the system below that we're

749
00:33:01,440 --> 00:33:05,940
looking for the make link command this

750
00:33:03,390 --> 00:33:08,700
is the attacker interacting with the

751
00:33:05,940 --> 00:33:10,290
Shadow Copy it's the second stage of the

752
00:33:08,700 --> 00:33:12,720
attack right we can look for that as

753
00:33:10,290 --> 00:33:16,020
well or you can look just for V shadow

754
00:33:12,720 --> 00:33:17,280
being run with those with those commands

755
00:33:16,020 --> 00:33:19,530
at the end of it what we're really

756
00:33:17,280 --> 00:33:20,730
trying to do is basically narrow down

757
00:33:19,530 --> 00:33:24,960
the script and rule out the false

758
00:33:20,730 --> 00:33:28,590
positives um I have a about 3000 hosts

759
00:33:24,960 --> 00:33:30,720
that I can throw this stuff into so i

760
00:33:28,590 --> 00:33:33,350
can only i can detect a lot of false

761
00:33:30,720 --> 00:33:35,790
positives but your environments may vary

762
00:33:33,350 --> 00:33:38,909
depending on your users and what access

763
00:33:35,790 --> 00:33:41,220
to have the things in this case i only

764
00:33:38,910 --> 00:33:44,850
had one false positive and that was for

765
00:33:41,220 --> 00:33:47,100
something called we're fault exe it's a

766
00:33:44,850 --> 00:33:49,429
windows process off the top of my head I

767
00:33:47,100 --> 00:33:53,399
can't remember what it does but it

768
00:33:49,430 --> 00:33:58,440
apparently interacts with v shadow um I

769
00:33:53,400 --> 00:34:01,440
don't know why but it does oh one caveat

770
00:33:58,440 --> 00:34:04,260
that I found is on the make link command

771
00:34:01,440 --> 00:34:06,450
is a function of command that exe so

772
00:34:04,260 --> 00:34:08,040
depending on what tool you use you need

773
00:34:06,450 --> 00:34:10,380
to make sure your tool has the ability

774
00:34:08,040 --> 00:34:13,230
to see command-line arguments not just

775
00:34:10,380 --> 00:34:14,790
the commands issued or else um now you

776
00:34:13,230 --> 00:34:16,679
have a bunch of gaps and your queries a

777
00:34:14,790 --> 00:34:17,790
lot broader either going to have false

778
00:34:16,679 --> 00:34:19,168
positives or you're going to have

779
00:34:17,790 --> 00:34:21,529
collateral damage depending on your

780
00:34:19,168 --> 00:34:21,529
command

781
00:34:21,599 --> 00:34:31,240
so once again we go back to this name of

782
00:34:26,289 --> 00:34:35,259
this thumb shadow so what we're doing is

783
00:34:31,239 --> 00:34:37,719
we're looking for a random process that

784
00:34:35,259 --> 00:34:39,429
is talking with this but we can actually

785
00:34:37,719 --> 00:34:41,649
cut this down a whole bunch we can just

786
00:34:39,429 --> 00:34:44,529
look for these shadow copies being

787
00:34:41,649 --> 00:34:49,449
created right um if you see these new

788
00:34:44,529 --> 00:34:51,759
volumes created on your system they are

789
00:34:49,449 --> 00:34:53,918
most likely not legitimate because most

790
00:34:51,759 --> 00:34:55,389
users don't interact with shadow copies

791
00:34:53,918 --> 00:34:57,670
most of them don't even enable this on

792
00:34:55,389 --> 00:35:00,700
the system so unless this is enabled at

793
00:34:57,670 --> 00:35:02,200
the gpo level by your admins this is not

794
00:35:00,700 --> 00:35:03,848
a normal event in your environment and

795
00:35:02,200 --> 00:35:05,710
this is another unique characteristic

796
00:35:03,849 --> 00:35:10,029
that you can look for in order to detect

797
00:35:05,710 --> 00:35:12,789
this attack you can also look for

798
00:35:10,029 --> 00:35:15,190
processes running out of that path which

799
00:35:12,789 --> 00:35:18,460
would tell you that it's something

800
00:35:15,190 --> 00:35:20,140
terrible is happening as well um so I

801
00:35:18,460 --> 00:35:22,509
know I have couple minutes left so I'm

802
00:35:20,140 --> 00:35:24,460
going to bust through the last portion

803
00:35:22,509 --> 00:35:27,539
of this which I think try the most

804
00:35:24,460 --> 00:35:30,250
important how do you block this right

805
00:35:27,539 --> 00:35:32,289
let's who've gone through the attack

806
00:35:30,250 --> 00:35:34,690
we've gone through the you know all the

807
00:35:32,289 --> 00:35:35,920
legwork we've gone through a couple

808
00:35:34,690 --> 00:35:37,690
different ways to detect it there's a

809
00:35:35,920 --> 00:35:40,480
million other ways to do this but in

810
00:35:37,690 --> 00:35:41,859
this case let's block this with tools

811
00:35:40,480 --> 00:35:46,269
that you guys have in your environment

812
00:35:41,859 --> 00:35:49,450
already all right so with any ransom

813
00:35:46,269 --> 00:35:51,250
where the two main things come up make

814
00:35:49,450 --> 00:35:54,038
sure you have good backups and train

815
00:35:51,250 --> 00:35:58,089
your users not to do terrible things one

816
00:35:54,039 --> 00:36:06,400
is easier than the other and both of

817
00:35:58,089 --> 00:36:08,019
them are backups so this is how I had up

818
00:36:06,400 --> 00:36:10,000
restoring previous versions of files

819
00:36:08,019 --> 00:36:14,558
there's ways to do it programmatically

820
00:36:10,000 --> 00:36:16,299
but what I liked this is that it's

821
00:36:14,559 --> 00:36:18,279
accessible on pretty much every window

822
00:36:16,299 --> 00:36:20,950
system right when you go on to that

823
00:36:18,279 --> 00:36:22,740
system you're going to have this console

824
00:36:20,950 --> 00:36:25,750
it might not be populated with anything

825
00:36:22,740 --> 00:36:29,709
and the copies might not be the most

826
00:36:25,750 --> 00:36:32,230
recent they may help you and I use may

827
00:36:29,710 --> 00:36:33,450
dripping with hope that these could be

828
00:36:32,230 --> 00:36:35,099
restored and be used

829
00:36:33,450 --> 00:36:37,200
for you but it's not really something

830
00:36:35,099 --> 00:36:38,550
that you should depend on so you know

831
00:36:37,200 --> 00:36:40,799
the off-site backups and things like

832
00:36:38,550 --> 00:36:42,119
that are important that's all the

833
00:36:40,800 --> 00:36:44,310
proactive stuff and that doesn't have

834
00:36:42,119 --> 00:36:46,680
much to do with the actual blocking that

835
00:36:44,310 --> 00:36:48,480
we're about to do but it's good to

836
00:36:46,680 --> 00:36:50,730
remember anything you can do proactively

837
00:36:48,480 --> 00:36:55,109
is going to save you a lot of time doing

838
00:36:50,730 --> 00:36:55,920
this in your environment so um one of

839
00:36:55,109 --> 00:37:00,450
the things that i'm going to show you

840
00:36:55,920 --> 00:37:01,859
guys is whitelisting and this isn't

841
00:37:00,450 --> 00:37:03,270
whitelisting like my company's

842
00:37:01,859 --> 00:37:05,339
whitelisting product so don't let

843
00:37:03,270 --> 00:37:07,890
marketing hear you we're going to use a

844
00:37:05,339 --> 00:37:09,660
free tool that's available for Microsoft

845
00:37:07,890 --> 00:37:13,230
once again don't let my marketing team

846
00:37:09,660 --> 00:37:14,490
here you uh-uh and um the reason why

847
00:37:13,230 --> 00:37:19,740
we're looking at white listing for this

848
00:37:14,490 --> 00:37:22,140
is think of the malware like you know

849
00:37:19,740 --> 00:37:24,598
like an arrow or you know how about like

850
00:37:22,140 --> 00:37:28,578
a basketball and wait listing is

851
00:37:24,599 --> 00:37:32,220
basically you know shot-blocking right

852
00:37:28,579 --> 00:37:34,619
and the malware author is this little

853
00:37:32,220 --> 00:37:36,419
kid and we want to crush his spirit we

854
00:37:34,619 --> 00:37:40,140
don't just want to win we want to make

855
00:37:36,420 --> 00:37:43,550
him cry so how are we going to do this

856
00:37:40,140 --> 00:37:46,259
the more you wash it better it gets us

857
00:37:43,550 --> 00:37:48,300
now I got this on like a little window

858
00:37:46,260 --> 00:37:49,740
on my side I can't I can't actually look

859
00:37:48,300 --> 00:37:53,609
over to my notes like I can't look away

860
00:37:49,740 --> 00:37:55,339
um so let's uh let's block the stuff in

861
00:37:53,609 --> 00:37:59,339
your environment we're going to leverage

862
00:37:55,339 --> 00:38:02,009
three pillars of good I teamwork right

863
00:37:59,339 --> 00:38:05,400
we're gonna leverage gpo witchcraft and

864
00:38:02,010 --> 00:38:10,680
cursing because we're about to deal with

865
00:38:05,400 --> 00:38:13,200
the most complex in complex is the most

866
00:38:10,680 --> 00:38:16,410
polite word I can use example and that

867
00:38:13,200 --> 00:38:17,549
is we're going to start touching GPO so

868
00:38:16,410 --> 00:38:20,790
what we're going to use here is

869
00:38:17,550 --> 00:38:22,980
Microsoft's tool app Locker of course

870
00:38:20,790 --> 00:38:26,310
once again Proactive don't click on

871
00:38:22,980 --> 00:38:27,839
suspicious links zelda is upset and for

872
00:38:26,310 --> 00:38:30,420
any of you that think that's zelda on

873
00:38:27,839 --> 00:38:33,750
the screen I will slap you

874
00:38:30,420 --> 00:38:35,190
that is definitely linked um anyways uh

875
00:38:33,750 --> 00:38:36,540
what we're going to do here is we're

876
00:38:35,190 --> 00:38:39,540
taking some of that info that we found

877
00:38:36,540 --> 00:38:42,180
earlier right oh so we did that initial

878
00:38:39,540 --> 00:38:44,369
query show me all the files that were

879
00:38:42,180 --> 00:38:46,770
created in 24 hours I went and I hashed

880
00:38:44,369 --> 00:38:49,470
him I found on virus total hits for them

881
00:38:46,770 --> 00:38:52,770
I know these are bad files and I know

882
00:38:49,470 --> 00:38:54,359
these are in these locations right these

883
00:38:52,770 --> 00:38:56,130
are all things that we have discovered

884
00:38:54,359 --> 00:38:59,220
and we have confirmed through this

885
00:38:56,130 --> 00:39:02,099
information so let's use these to build

886
00:38:59,220 --> 00:39:04,250
these proactive detections and blocks

887
00:39:02,099 --> 00:39:08,309
well which is the more important thing

888
00:39:04,250 --> 00:39:09,750
so what we're going to do is we're going

889
00:39:08,309 --> 00:39:13,410
to create software restriction policies

890
00:39:09,750 --> 00:39:15,240
um you can use oh you can do this on a

891
00:39:13,410 --> 00:39:17,190
single computer using the local security

892
00:39:15,240 --> 00:39:19,649
policy editor so you can do that at your

893
00:39:17,190 --> 00:39:20,790
house grandma's computer whatever but if

894
00:39:19,650 --> 00:39:23,130
you have a domain you're going to end up

895
00:39:20,790 --> 00:39:25,890
using group policy editor in order to

896
00:39:23,130 --> 00:39:29,460
supply this for your entire enterprise a

897
00:39:25,890 --> 00:39:31,799
fun fact that I learned after initially

898
00:39:29,460 --> 00:39:34,200
doing all this research and ways to do

899
00:39:31,799 --> 00:39:37,020
this is that i found out that app Locker

900
00:39:34,200 --> 00:39:40,618
actually has an option excuse me to

901
00:39:37,020 --> 00:39:43,470
enforce dll blocking as well i didn't

902
00:39:40,619 --> 00:39:45,270
know that um i just found that out and

903
00:39:43,470 --> 00:39:48,180
then i tried doing it without reading

904
00:39:45,270 --> 00:39:50,460
any of the documentation around it this

905
00:39:48,180 --> 00:39:53,040
will destroy all the performance on your

906
00:39:50,460 --> 00:39:57,260
end point um basically it's very

907
00:39:53,040 --> 00:40:01,410
effective but it monitors every single

908
00:39:57,260 --> 00:40:05,040
execution of the dll um so it's going to

909
00:40:01,410 --> 00:40:07,020
dramatically decrease performance um and

910
00:40:05,040 --> 00:40:08,759
I don't have to show you the picture of

911
00:40:07,020 --> 00:40:11,130
the exact again right that's what's kind

912
00:40:08,760 --> 00:40:14,520
of it up happening so what we're going

913
00:40:11,130 --> 00:40:16,589
to stick to is just the binaries here so

914
00:40:14,520 --> 00:40:18,210
first thing we're doing is we're open up

915
00:40:16,589 --> 00:40:20,339
the security policy editor this is kind

916
00:40:18,210 --> 00:40:23,430
of what it looks like um and through a

917
00:40:20,339 --> 00:40:28,099
couple of clicks you're able to create

918
00:40:23,430 --> 00:40:31,020
the policy on your system just like that

919
00:40:28,099 --> 00:40:35,609
five clicks you populate it with your

920
00:40:31,020 --> 00:40:38,009
path here I use a wild card wild cards

921
00:40:35,609 --> 00:40:41,700
are fun and easy ah but to come with

922
00:40:38,010 --> 00:40:43,369
collateral damage right when you're when

923
00:40:41,700 --> 00:40:45,348
you're going to evaluate what

924
00:40:43,369 --> 00:40:48,349
listing tools you might want to look for

925
00:40:45,349 --> 00:40:50,950
ones that have extra conditions involved

926
00:40:48,349 --> 00:40:53,900
in them like trust ratings prevalence

927
00:40:50,950 --> 00:40:56,538
other useful things because if you're

928
00:40:53,900 --> 00:40:58,009
doing just plain white listing um that's

929
00:40:56,539 --> 00:41:00,349
like trying to open a pickle jar with a

930
00:40:58,009 --> 00:41:02,329
sledgehammer um you're going to get it

931
00:41:00,349 --> 00:41:07,210
open but you're gonna break

932
00:41:02,329 --> 00:41:10,430
everywhere um and for example here we're

933
00:41:07,210 --> 00:41:14,299
where we are going to block one of the

934
00:41:10,430 --> 00:41:17,930
initial infection vectors but we're also

935
00:41:14,299 --> 00:41:21,470
going to end up blocking spotify firefox

936
00:41:17,930 --> 00:41:23,269
chrome and any other application that i

937
00:41:21,470 --> 00:41:25,459
would consider poorly coded because

938
00:41:23,269 --> 00:41:27,140
they're executing binaries out of app

939
00:41:25,460 --> 00:41:30,740
data working fig file should be not

940
00:41:27,140 --> 00:41:33,440
binaries so that's my grievance I've

941
00:41:30,740 --> 00:41:35,299
aired it but here you're going to create

942
00:41:33,440 --> 00:41:37,490
exceptions and on your environment if

943
00:41:35,299 --> 00:41:39,589
you're going to do this or look for a

944
00:41:37,490 --> 00:41:41,538
tool that has those extra conditions

945
00:41:39,589 --> 00:41:43,308
that you can add to your white listing

946
00:41:41,539 --> 00:41:48,769
if so you can get around that ended up

947
00:41:43,309 --> 00:41:51,559
not blocking legitimate files lastly you

948
00:41:48,769 --> 00:41:55,129
know here's the final product um you've

949
00:41:51,559 --> 00:41:57,319
now blocked cryptolocker from installing

950
00:41:55,130 --> 00:42:01,009
on your computer but you've also stopped

951
00:41:57,319 --> 00:42:03,019
Zeus and SpyEye they don't Ted serve and

952
00:42:01,009 --> 00:42:06,619
a whole bunch of other genres that were

953
00:42:03,019 --> 00:42:07,999
built off of the Zeus source code that

954
00:42:06,619 --> 00:42:11,329
one you know that one open source years

955
00:42:07,999 --> 00:42:13,118
ago so a lot of malware reuses the same

956
00:42:11,329 --> 00:42:15,470
code so you reuse the same directories

957
00:42:13,119 --> 00:42:17,900
once again you will have collateral

958
00:42:15,470 --> 00:42:21,109
damage so make sure you create those

959
00:42:17,900 --> 00:42:23,180
exceptions um because I love my Spotify

960
00:42:21,109 --> 00:42:27,078
and I'll be very upset if you walk it on

961
00:42:23,180 --> 00:42:29,450
me in closing read somewhere is really

962
00:42:27,079 --> 00:42:31,730
annoyingly effective right the recent

963
00:42:29,450 --> 00:42:33,589
additional features of removing shadow

964
00:42:31,730 --> 00:42:36,289
copies make it even more dangerous

965
00:42:33,589 --> 00:42:37,940
because when you can no longer restore

966
00:42:36,289 --> 00:42:40,220
from backup you are at the attackers

967
00:42:37,940 --> 00:42:42,799
mercy right and your options are pretty

968
00:42:40,220 --> 00:42:45,140
slim at that point regardless what

969
00:42:42,799 --> 00:42:47,359
security products you use on your best

970
00:42:45,140 --> 00:42:50,299
defense for any of these attacks is user

971
00:42:47,359 --> 00:42:51,619
training and good backups even if you're

972
00:42:50,299 --> 00:42:53,660
Duncan hit by rain somewhere you get hit

973
00:42:51,619 --> 00:42:55,240
by some other variant rather than having

974
00:42:53,660 --> 00:42:58,118
to completely

975
00:42:55,240 --> 00:42:59,740
can rebuild the system can restore to a

976
00:42:58,119 --> 00:43:01,660
gold image and put your backups

977
00:42:59,740 --> 00:43:03,580
restoring backups to it and have all

978
00:43:01,660 --> 00:43:05,470
your data working again so anything

979
00:43:03,580 --> 00:43:07,869
preventative that you can do proactively

980
00:43:05,470 --> 00:43:10,930
is is really going to help you out in

981
00:43:07,869 --> 00:43:13,420
the long run um so thank you for your

982
00:43:10,930 --> 00:43:15,069
time today and remember my motto flag it

983
00:43:13,420 --> 00:43:17,350
tag it and bag it also known as the

984
00:43:15,070 --> 00:43:27,400
double tap for any of the malware that

985
00:43:17,350 --> 00:43:29,140
you do questions once again HR has not

986
00:43:27,400 --> 00:43:32,110
seen these this used to have a lot more

987
00:43:29,140 --> 00:43:35,710
chips in it but when you try and system

988
00:43:32,110 --> 00:43:37,869
it like a 50 meg PowerPoint they start

989
00:43:35,710 --> 00:43:41,350
asking questions and they don't want to

990
00:43:37,869 --> 00:43:48,040
open it the way went to static pictures

991
00:43:41,350 --> 00:43:49,290
yeah what do you think hahaha where

992
00:43:48,040 --> 00:43:52,680
mothers day

993
00:43:49,290 --> 00:43:55,710
there's quite a few so the real purpose

994
00:43:52,680 --> 00:43:57,930
of this method of detection is living

995
00:43:55,710 --> 00:43:59,790
off the land so the tools that are

996
00:43:57,930 --> 00:44:02,460
natively installed on your microsoft

997
00:43:59,790 --> 00:44:05,400
system already and because of that you

998
00:44:02,460 --> 00:44:09,240
have the limitations of those tools they

999
00:44:05,400 --> 00:44:10,740
were not designed for hunting malware so

1000
00:44:09,240 --> 00:44:13,200
they don't have a lot of options and

1001
00:44:10,740 --> 00:44:15,689
also if you're trying to do some kind of

1002
00:44:13,200 --> 00:44:19,069
forensic investigation these will modify

1003
00:44:15,690 --> 00:44:22,470
things on your system therefore your

1004
00:44:19,070 --> 00:44:24,300
forensic timeline will be off and you

1005
00:44:22,470 --> 00:44:25,799
will end up rained issues when people

1006
00:44:24,300 --> 00:44:27,840
talk about your gold image and whatnot

1007
00:44:25,800 --> 00:44:29,670
so if you're going to do this stuff on a

1008
00:44:27,840 --> 00:44:32,850
known affected machine and you can only

1009
00:44:29,670 --> 00:44:34,620
use Windows tools make a copy of the

1010
00:44:32,850 --> 00:44:36,450
system and then run these tools against

1011
00:44:34,620 --> 00:44:39,120
that copy so you don't mess up the

1012
00:44:36,450 --> 00:44:40,740
original image and it's still some

1013
00:44:39,120 --> 00:44:44,370
what's the middle submissive belen court

1014
00:44:40,740 --> 00:44:45,870
um there's also i mean if you get to the

1015
00:44:44,370 --> 00:44:47,759
point where you're making a backup of

1016
00:44:45,870 --> 00:44:49,109
this you should probably buy good enough

1017
00:44:47,760 --> 00:44:51,780
tool to be able to do a lot of this

1018
00:44:49,110 --> 00:44:53,940
automatically and get around a lot of

1019
00:44:51,780 --> 00:44:57,950
the shortcomings of the tools and have

1020
00:44:53,940 --> 00:44:57,950
more options and more things you can do

1021
00:44:58,820 --> 00:45:05,440
anyone else all right thanks for the

1022
00:45:02,780 --> 00:45:05,440
double tap enjoy

