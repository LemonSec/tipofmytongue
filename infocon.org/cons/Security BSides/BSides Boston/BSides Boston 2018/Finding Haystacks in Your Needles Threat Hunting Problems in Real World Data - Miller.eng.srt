1
00:00:00,030 --> 00:00:05,400
feed so sorry for that we're going to

2
00:00:03,480 --> 00:00:06,689
actually kick off here for Sarah

3
00:00:05,400 --> 00:00:09,300
so a little bit of Sarah's background

4
00:00:06,690 --> 00:00:12,360
Sarah is a current employee of carbon

5
00:00:09,300 --> 00:00:14,580
block another fine Boston company so

6
00:00:12,360 --> 00:00:16,320
she's a threat analyst our threat Intel

7
00:00:14,580 --> 00:00:19,698
analyst excuse me previously she worked

8
00:00:16,320 --> 00:00:23,850
as a security operations team manager or

9
00:00:19,699 --> 00:00:25,980
just an analyst I hold that ms:i a from

10
00:00:23,850 --> 00:00:29,869
Northeastern University with that sorry

11
00:00:25,980 --> 00:00:29,869
for the delay on my part Sarah Miller

12
00:00:32,479 --> 00:00:38,040
okay so last talk of the day thank you

13
00:00:35,520 --> 00:00:39,930
for coming I know we're all excited to

14
00:00:38,040 --> 00:00:43,160
get on to the closing ceremonies in the

15
00:00:39,930 --> 00:00:45,539
networking event but this talk is called

16
00:00:43,160 --> 00:00:49,620
haystacks in your needle threat hunting

17
00:00:45,539 --> 00:00:51,270
in real world data you probably want to

18
00:00:49,620 --> 00:00:52,800
know who's giving the talk so that's my

19
00:00:51,270 --> 00:00:56,370
Twitter picture it's a disgruntled

20
00:00:52,800 --> 00:00:59,370
Hedgehog and I'm a threat Intel analyst

21
00:00:56,370 --> 00:01:01,980
for carbon black I started I was an ESL

22
00:00:59,370 --> 00:01:03,538
teacher originally and then I thought

23
00:01:01,980 --> 00:01:05,640
computer security sounded really

24
00:01:03,539 --> 00:01:08,659
interesting so I went to Northeastern I

25
00:01:05,640 --> 00:01:11,729
got a master's program and then I

26
00:01:08,659 --> 00:01:14,070
started in the carbon black sock three

27
00:01:11,729 --> 00:01:15,659
years ago was on the blue team for two

28
00:01:14,070 --> 00:01:18,199
years and then got moved over to the

29
00:01:15,659 --> 00:01:20,250
product side so my current job is

30
00:01:18,200 --> 00:01:21,960
analyzing malware looking at his hat

31
00:01:20,250 --> 00:01:24,150
campaigns and trying to find behavioral

32
00:01:21,960 --> 00:01:26,610
signatures that our customers can use to

33
00:01:24,150 --> 00:01:31,740
detect attacks malware in their

34
00:01:26,610 --> 00:01:34,259
environments so this is a talk about

35
00:01:31,740 --> 00:01:36,689
false positives I just said my job is to

36
00:01:34,259 --> 00:01:38,670
look for sort of behaviors that you can

37
00:01:36,689 --> 00:01:40,589
use to identify attackers of malware and

38
00:01:38,670 --> 00:01:42,869
it turns out that this is a really hard

39
00:01:40,590 --> 00:01:45,840
problem it's a really hard problem for

40
00:01:42,869 --> 00:01:47,490
two reasons the first reason which I

41
00:01:45,840 --> 00:01:49,350
have this picture there's actually an

42
00:01:47,490 --> 00:01:50,789
octopus in that picture pretending to be

43
00:01:49,350 --> 00:01:52,949
a piece of coral

44
00:01:50,790 --> 00:01:55,259
the first reason that this is difficult

45
00:01:52,950 --> 00:01:56,909
is because malware is trying really

46
00:01:55,259 --> 00:01:58,530
really hard to look legitimate and

47
00:01:56,909 --> 00:02:00,960
actors are trying really really hard to

48
00:01:58,530 --> 00:02:02,610
look legitimate so the closer that they

49
00:02:00,960 --> 00:02:04,589
can get to looking legitimate the harder

50
00:02:02,610 --> 00:02:05,969
it is for us to detect and that's why

51
00:02:04,590 --> 00:02:09,330
they're trying really really hard to do

52
00:02:05,969 --> 00:02:10,649
that the second problem is that you have

53
00:02:09,330 --> 00:02:13,480
a bunch of really smart threat

54
00:02:10,649 --> 00:02:15,489
researchers who are all looking at

55
00:02:13,480 --> 00:02:18,640
malware and looking at attack data in

56
00:02:15,489 --> 00:02:20,260
very isolated clean environments and

57
00:02:18,640 --> 00:02:22,298
they're actually not going out and

58
00:02:20,260 --> 00:02:24,429
they're not sitting in a sim all day

59
00:02:22,299 --> 00:02:26,049
dealing with all of the weird false

60
00:02:24,430 --> 00:02:28,360
positives that come out when you take

61
00:02:26,049 --> 00:02:30,400
these beautiful signatures that detects

62
00:02:28,360 --> 00:02:32,290
malware in a lab and put them in a real

63
00:02:30,400 --> 00:02:34,030
environment it turns out that real

64
00:02:32,290 --> 00:02:36,879
environments have all kinds of weird

65
00:02:34,030 --> 00:02:39,459
things that your users are doing your IT

66
00:02:36,879 --> 00:02:41,200
admins are doing and the people who

67
00:02:39,459 --> 00:02:43,390
wrote your software is doing your

68
00:02:41,200 --> 00:02:47,170
security software is doing and you have

69
00:02:43,390 --> 00:02:48,640
no idea kind of what what noise you're

70
00:02:47,170 --> 00:02:51,819
going to get until you actually start

71
00:02:48,640 --> 00:02:53,319
testing stuff out in the real world so

72
00:02:51,819 --> 00:02:55,750
that's what this talk is about this talk

73
00:02:53,319 --> 00:03:00,268
is about why it's so difficult to come

74
00:02:55,750 --> 00:03:02,799
up with signatures that actually work so

75
00:03:00,269 --> 00:03:05,349
because this talk is basically a bunch

76
00:03:02,799 --> 00:03:07,720
of unconnected examples I needed a

77
00:03:05,349 --> 00:03:10,179
little bit of a framework and everybody

78
00:03:07,720 --> 00:03:12,750
loves the kill chain so I went there if

79
00:03:10,180 --> 00:03:15,099
you don't know what the kill chain is

80
00:03:12,750 --> 00:03:18,970
you probably haven't been to a lot of

81
00:03:15,099 --> 00:03:22,888
talks today but um for my mom who is

82
00:03:18,970 --> 00:03:22,889
here and knows nothing about technology

83
00:03:25,590 --> 00:03:31,959
the kill chain is basically a series of

84
00:03:29,560 --> 00:03:35,919
steps that attackers used to get into a

85
00:03:31,959 --> 00:03:37,690
targeted network I've used the I show a

86
00:03:35,919 --> 00:03:41,049
screenshot of the mitre kill chain here

87
00:03:37,690 --> 00:03:42,760
because I work with endpoint data they

88
00:03:41,049 --> 00:03:44,440
focus on sort of a lot of the different

89
00:03:42,760 --> 00:03:46,120
tactics and techniques that happen once

90
00:03:44,440 --> 00:03:49,590
you're on an endpoint trying to achieve

91
00:03:46,120 --> 00:03:51,579
your objectives and stay hidden and

92
00:03:49,590 --> 00:03:53,590
originally when I gave this talk it was

93
00:03:51,579 --> 00:03:55,510
50 minutes long I've cut it down to 25

94
00:03:53,590 --> 00:03:57,220
which means I didn't get to do an

95
00:03:55,510 --> 00:03:59,290
example for every single step in this

96
00:03:57,220 --> 00:04:03,129
one but I do have a few examples and

97
00:03:59,290 --> 00:04:04,569
they are organized in the in the order

98
00:04:03,129 --> 00:04:07,750
of the kill chain so we're going to be

99
00:04:04,569 --> 00:04:09,040
going through those okay so the first

100
00:04:07,750 --> 00:04:10,750
thing that we're going to talk about is

101
00:04:09,040 --> 00:04:12,370
a reconnaissance false positive

102
00:04:10,750 --> 00:04:13,540
reconnaissance you're outside the

103
00:04:12,370 --> 00:04:14,739
network you want to learn about the

104
00:04:13,540 --> 00:04:18,548
target you want to figure out how you

105
00:04:14,739 --> 00:04:21,909
can get in a really common technique in

106
00:04:18,548 --> 00:04:23,620
reconnaissance is scanning two types of

107
00:04:21,909 --> 00:04:27,070
scans that you're kind of looking for

108
00:04:23,620 --> 00:04:28,930
one is a sort of scanning every port

109
00:04:27,070 --> 00:04:31,480
and I on a particular server a

110
00:04:28,930 --> 00:04:32,830
particular IP so you know they want to

111
00:04:31,480 --> 00:04:34,630
profile it they want to see what

112
00:04:32,830 --> 00:04:36,430
services are open they want to see if

113
00:04:34,630 --> 00:04:38,920
any of those services are vulnerable but

114
00:04:36,430 --> 00:04:40,510
it's all ports on one IP the other type

115
00:04:38,920 --> 00:04:42,460
of scan that you see a lot and we

116
00:04:40,510 --> 00:04:45,460
generally treat it as a nuisance scan is

117
00:04:42,460 --> 00:04:46,960
when you have an IP that's going you

118
00:04:45,460 --> 00:04:48,940
have an IP that's going across all of

119
00:04:46,960 --> 00:04:52,330
your servers and it's checking port 22

120
00:04:48,940 --> 00:04:55,150
on everything or it's checking port 3 3

121
00:04:52,330 --> 00:04:58,090
8 9 so it's looking for just an open

122
00:04:55,150 --> 00:05:00,880
service that it thinks is easy prey it's

123
00:04:58,090 --> 00:05:02,950
going to look for a nice easy target but

124
00:05:00,880 --> 00:05:05,219
it's sort of one port across all servers

125
00:05:02,950 --> 00:05:08,229
so this is a really distinctive behavior

126
00:05:05,220 --> 00:05:10,270
our sims know about it our firewalls

127
00:05:08,230 --> 00:05:12,970
know about it you're tier one analysts

128
00:05:10,270 --> 00:05:16,810
know about it and they have sort of an

129
00:05:12,970 --> 00:05:20,260
expectation of what this is so we were

130
00:05:16,810 --> 00:05:21,940
in the sock in our sim and we had this

131
00:05:20,260 --> 00:05:26,140
alert pop-up and this was kind of

132
00:05:21,940 --> 00:05:27,640
alarming it was an internal IP so

133
00:05:26,140 --> 00:05:29,770
someone's workstation or someone's

134
00:05:27,640 --> 00:05:31,390
server and it was reaching out to the

135
00:05:29,770 --> 00:05:33,070
Internet to hundreds and hundreds and

136
00:05:31,390 --> 00:05:37,630
hundreds of IP is out on the public

137
00:05:33,070 --> 00:05:40,060
Internet and trying to hit port 137 for

138
00:05:37,630 --> 00:05:41,409
those of you who don't know port 137 is

139
00:05:40,060 --> 00:05:43,270
something that you're only supposed to

140
00:05:41,410 --> 00:05:45,730
see in your local internal network it's

141
00:05:43,270 --> 00:05:47,950
a protocol called NetBIOS which is used

142
00:05:45,730 --> 00:05:50,680
for other computers to discover the

143
00:05:47,950 --> 00:05:52,750
hostname locally but it should never be

144
00:05:50,680 --> 00:05:54,610
going out to the Internet and the fact

145
00:05:52,750 --> 00:05:56,920
that it's going out to so many hosts

146
00:05:54,610 --> 00:05:58,540
looks exactly like one of those nuisance

147
00:05:56,920 --> 00:06:00,610
scans we were talking about where you're

148
00:05:58,540 --> 00:06:03,070
looking for one service across a wide

149
00:06:00,610 --> 00:06:06,100
range of hosts so if you're working in a

150
00:06:03,070 --> 00:06:09,640
sock and you see this your first thought

151
00:06:06,100 --> 00:06:11,890
is someone got into my network and they

152
00:06:09,640 --> 00:06:13,210
compromised this one computer inside my

153
00:06:11,890 --> 00:06:15,520
network and now they're using that

154
00:06:13,210 --> 00:06:18,370
computer to go bother other people on

155
00:06:15,520 --> 00:06:21,130
the internet so that was kind of our

156
00:06:18,370 --> 00:06:24,460
first thought and we were like what is

157
00:06:21,130 --> 00:06:25,750
this we did a bunch of investigation and

158
00:06:24,460 --> 00:06:27,370
we actually figured out that what

159
00:06:25,750 --> 00:06:29,260
happened was that a developer was

160
00:06:27,370 --> 00:06:31,990
running process monitor and web browsing

161
00:06:29,260 --> 00:06:34,120
at the same time and this actually

162
00:06:31,990 --> 00:06:36,610
causes this behavior so what's happening

163
00:06:34,120 --> 00:06:37,600
is process monitor is looking at

164
00:06:36,610 --> 00:06:38,740
everything that's running on your

165
00:06:37,600 --> 00:06:40,550
computer

166
00:06:38,740 --> 00:06:43,220
and it has a set

167
00:06:40,550 --> 00:06:45,220
that allows you to resolve any network

168
00:06:43,220 --> 00:06:48,919
addresses that it makes connections to

169
00:06:45,220 --> 00:06:51,830
it does this by using DNS but it turns

170
00:06:48,919 --> 00:06:54,919
out that if the DNS lookup fails it then

171
00:06:51,830 --> 00:06:57,198
tries to NetBIOS the host so if your web

172
00:06:54,919 --> 00:06:59,419
browsing you're connecting to hundreds

173
00:06:57,199 --> 00:07:01,699
of IPs out on the Internet it tries to

174
00:06:59,419 --> 00:07:04,549
do DNS lookups for all of them it fails

175
00:07:01,699 --> 00:07:07,699
and then it tries to NetBIOS them so

176
00:07:04,550 --> 00:07:09,800
kind of are after the first one we spent

177
00:07:07,699 --> 00:07:12,319
the first time we saw this we spent a

178
00:07:09,800 --> 00:07:13,970
good bit of time trying to figure out

179
00:07:12,319 --> 00:07:15,860
exactly what the hell was going on and

180
00:07:13,970 --> 00:07:17,690
then after that we'd see it and we'd

181
00:07:15,860 --> 00:07:20,030
message the developer and say are you

182
00:07:17,690 --> 00:07:22,039
running pokémon and web browsing you say

183
00:07:20,030 --> 00:07:24,799
yes and we'd say stop it

184
00:07:22,039 --> 00:07:27,560
so it turned out to be you know not a

185
00:07:24,800 --> 00:07:30,470
big deal but also it looked exactly like

186
00:07:27,560 --> 00:07:32,780
a scan to the sim and they had no way of

187
00:07:30,470 --> 00:07:34,370
knowing that this was a behavior of proc

188
00:07:32,780 --> 00:07:36,948
mods and how would they even know that

189
00:07:34,370 --> 00:07:38,900
pokémon was on that end point so kind of

190
00:07:36,949 --> 00:07:41,500
an interesting no one could have

191
00:07:38,900 --> 00:07:45,258
predicted that this is going to go wrong

192
00:07:41,500 --> 00:07:47,120
okay so reconnaissance you've learned

193
00:07:45,259 --> 00:07:48,500
about your network next thing you want

194
00:07:47,120 --> 00:07:50,360
to get inside your network you need to

195
00:07:48,500 --> 00:07:52,759
deliver and exploit it in some way get a

196
00:07:50,360 --> 00:07:55,909
foothold a really common way of doing

197
00:07:52,759 --> 00:07:57,860
this is phishing emails and so we spend

198
00:07:55,909 --> 00:08:00,259
a lot of time doing user education about

199
00:07:57,860 --> 00:08:02,150
phishing emails telling them you know if

200
00:08:00,259 --> 00:08:05,300
it's from someone you don't know be a

201
00:08:02,150 --> 00:08:07,489
little cautious if it's from if it's got

202
00:08:05,300 --> 00:08:10,099
an attachment be a little cautious if

203
00:08:07,490 --> 00:08:12,229
it's asking for your password you know

204
00:08:10,099 --> 00:08:13,759
throw up the big red flags contact

205
00:08:12,229 --> 00:08:15,979
someone it since they should never be

206
00:08:13,759 --> 00:08:18,139
asking for your password and email be

207
00:08:15,979 --> 00:08:19,669
careful of links we have all these

208
00:08:18,139 --> 00:08:20,870
different examples of phishing emails

209
00:08:19,669 --> 00:08:26,568
where they're trying to get passwords

210
00:08:20,870 --> 00:08:28,310
out of people so we had a user submit

211
00:08:26,569 --> 00:08:30,259
this to us and say hey I think this is a

212
00:08:28,310 --> 00:08:34,669
phishing email what should I do

213
00:08:30,259 --> 00:08:36,800
and it's a secure message from this

214
00:08:34,669 --> 00:08:38,449
company the user had never heard of this

215
00:08:36,799 --> 00:08:40,789
company before has never interacted with

216
00:08:38,450 --> 00:08:42,979
them and it says you've received a

217
00:08:40,789 --> 00:08:46,069
secure message there's an attachment and

218
00:08:42,979 --> 00:08:47,990
HTML attachment called secure dock to

219
00:08:46,070 --> 00:08:51,890
open the attachment and read your secure

220
00:08:47,990 --> 00:08:53,720
message type in your password and if you

221
00:08:51,890 --> 00:08:54,439
look at the attachment and sort of just

222
00:08:53,720 --> 00:08:56,420
look at what

223
00:08:54,440 --> 00:08:59,930
it presents to you the HTML in a browser

224
00:08:56,420 --> 00:09:02,300
you see this very nice little envelope

225
00:08:59,930 --> 00:09:05,000
sort of looking thing and it has you

226
00:09:02,300 --> 00:09:06,709
know from and to and again you've got a

227
00:09:05,000 --> 00:09:09,590
secure message from this company and

228
00:09:06,710 --> 00:09:11,360
then a little box for your passwords if

229
00:09:09,590 --> 00:09:13,850
you go a step further and you look at

230
00:09:11,360 --> 00:09:16,250
what is actually making up the HTML you

231
00:09:13,850 --> 00:09:18,230
see a bunch of this JavaScript and this

232
00:09:16,250 --> 00:09:19,400
is really obfuscated JavaScript it's

233
00:09:18,230 --> 00:09:22,310
really hard to figure out what it's

234
00:09:19,400 --> 00:09:24,410
doing if you've ever looked at

235
00:09:22,310 --> 00:09:28,280
JavaScript malware it's all super

236
00:09:24,410 --> 00:09:29,810
obfuscated all the time and even sort of

237
00:09:28,280 --> 00:09:31,370
normal JavaScript can be kind of tough

238
00:09:29,810 --> 00:09:33,229
to read but generally when you see stuff

239
00:09:31,370 --> 00:09:34,670
like this you start thinking oh it

240
00:09:33,230 --> 00:09:37,250
doesn't want me to know what it's doing

241
00:09:34,670 --> 00:09:38,979
so it has all of this gibberish in there

242
00:09:37,250 --> 00:09:42,290
and all of these weird variable names

243
00:09:38,980 --> 00:09:44,630
but it turns out this is not a phishing

244
00:09:42,290 --> 00:09:47,810
email this is a real product that Cisco

245
00:09:44,630 --> 00:09:51,530
puts out called the registered envelope

246
00:09:47,810 --> 00:09:53,060
service if you don't have s/mime or PGP

247
00:09:51,530 --> 00:09:55,010
configured you can't you don't have

248
00:09:53,060 --> 00:09:57,500
email security working this was sort of

249
00:09:55,010 --> 00:09:59,300
an older solution for that now we have

250
00:09:57,500 --> 00:10:01,970
all these sort of secure file transfer

251
00:09:59,300 --> 00:10:03,890
things that we might use instead but at

252
00:10:01,970 --> 00:10:10,070
the time this is a good way to send

253
00:10:03,890 --> 00:10:12,620
secure messages so for us our our user

254
00:10:10,070 --> 00:10:14,600
wasn't used to this she reported it to

255
00:10:12,620 --> 00:10:17,990
us we investigated we figured out that

256
00:10:14,600 --> 00:10:19,940
it wasn't a fish because we saw where

257
00:10:17,990 --> 00:10:22,430
the HTML was connecting out to and it

258
00:10:19,940 --> 00:10:23,660
was all legitimate Cisco domains but it

259
00:10:22,430 --> 00:10:26,239
was really interesting because you could

260
00:10:23,660 --> 00:10:28,069
imagine as a red teamer if you found out

261
00:10:26,240 --> 00:10:30,110
that an organization was using this

262
00:10:28,070 --> 00:10:31,670
service and then you sent them something

263
00:10:30,110 --> 00:10:33,320
that looked exactly like this and just

264
00:10:31,670 --> 00:10:34,699
change the IP use that it was beaconing

265
00:10:33,320 --> 00:10:37,310
out too you could probably get their

266
00:10:34,700 --> 00:10:40,010
passwords so I thought that was kind of

267
00:10:37,310 --> 00:10:41,630
interesting and if anyone here is a red

268
00:10:40,010 --> 00:10:43,430
teamer who ends up using that on a

269
00:10:41,630 --> 00:10:49,910
client I'd be interested to know how

270
00:10:43,430 --> 00:10:52,579
successful it is okay so we've done our

271
00:10:49,910 --> 00:10:56,000
recon we've done our delivery let's talk

272
00:10:52,580 --> 00:10:57,230
about exploits and it was really

273
00:10:56,000 --> 00:10:58,490
interesting being in the keynote this

274
00:10:57,230 --> 00:11:00,950
morning because he has a couple of

275
00:10:58,490 --> 00:11:02,930
examples that I talked about also and

276
00:11:00,950 --> 00:11:07,670
the first one of those is encoded

277
00:11:02,930 --> 00:11:08,000
commands PowerShell so Palo Alto did a

278
00:11:07,670 --> 00:11:10,880
real

279
00:11:08,000 --> 00:11:13,310
great article at the beginning of March

280
00:11:10,880 --> 00:11:16,280
where they took about four thousand

281
00:11:13,310 --> 00:11:18,109
samples of PowerShell malware and they

282
00:11:16,280 --> 00:11:20,180
look at the different arguments that it

283
00:11:18,110 --> 00:11:21,920
uses to run so since they were

284
00:11:20,180 --> 00:11:24,020
specifically looking at encoded command

285
00:11:21,920 --> 00:11:26,300
100 percent of their samples had that

286
00:11:24,020 --> 00:11:27,800
command-line argument they had different

287
00:11:26,300 --> 00:11:29,089
variations of it because you don't

288
00:11:27,800 --> 00:11:30,229
always have to write out encoded

289
00:11:29,090 --> 00:11:33,320
commands but all of them use that

290
00:11:30,230 --> 00:11:34,910
command in one form of the other they

291
00:11:33,320 --> 00:11:36,830
also had some other commands that you

292
00:11:34,910 --> 00:11:39,980
might some showing up in these different

293
00:11:36,830 --> 00:11:41,570
powershell malware samples so and most

294
00:11:39,980 --> 00:11:43,160
of these are either trying to hide

295
00:11:41,570 --> 00:11:45,680
themselves from the user or trying to

296
00:11:43,160 --> 00:11:46,819
get around some type of security policy

297
00:11:45,680 --> 00:11:50,319
or profile that you might have

298
00:11:46,820 --> 00:11:54,230
configured so window style hidden

299
00:11:50,320 --> 00:11:55,910
non-interactive no exit and no logo are

300
00:11:54,230 --> 00:11:59,480
all trying to hide themselves to make

301
00:11:55,910 --> 00:12:02,079
themselves long obvious and no exit is

302
00:11:59,480 --> 00:12:05,540
actually this said that no exit is

303
00:12:02,080 --> 00:12:07,880
PowerShell continues running after you

304
00:12:05,540 --> 00:12:11,329
execute the commands so a little bit of

305
00:12:07,880 --> 00:12:14,120
persistence there and then execution

306
00:12:11,330 --> 00:12:16,400
policy bypass are unrestricted and no

307
00:12:14,120 --> 00:12:19,220
profile are both used to sort of get

308
00:12:16,400 --> 00:12:20,870
around if you had security settings

309
00:12:19,220 --> 00:12:24,440
configured for PowerShell this will get

310
00:12:20,870 --> 00:12:26,000
rid of stuff so they looked at malicious

311
00:12:24,440 --> 00:12:28,250
PowerShell and they said these are the

312
00:12:26,000 --> 00:12:29,870
frequency that these particular

313
00:12:28,250 --> 00:12:31,730
arguments show up in our malicious

314
00:12:29,870 --> 00:12:33,860
PowerShell and I looked at that and I

315
00:12:31,730 --> 00:12:35,630
thought that's really interesting I'm

316
00:12:33,860 --> 00:12:37,190
very cynical and I'm very dubious about

317
00:12:35,630 --> 00:12:42,550
these things because I spend a lot of

318
00:12:37,190 --> 00:12:46,160
time QA testing signatures so I said I

319
00:12:42,550 --> 00:12:47,780
wonder how many legitimate environments

320
00:12:46,160 --> 00:12:49,670
see this and what kind of legitimate

321
00:12:47,780 --> 00:12:52,819
encoded PowerShell is running out in the

322
00:12:49,670 --> 00:12:55,160
wild so I took a small sample of our

323
00:12:52,820 --> 00:12:57,800
customers between 50 and 100 and I

324
00:12:55,160 --> 00:13:00,680
looked in their environments for these

325
00:12:57,800 --> 00:13:03,500
different things and I found that I

326
00:13:00,680 --> 00:13:06,620
found four percent of them had

327
00:13:03,500 --> 00:13:09,710
legitimate encoded command PowerShell

328
00:13:06,620 --> 00:13:11,750
and these max numbers are sort of in one

329
00:13:09,710 --> 00:13:14,000
customer environment what was the

330
00:13:11,750 --> 00:13:15,950
highest number of results I got when I

331
00:13:14,000 --> 00:13:17,690
looked for this particular command so

332
00:13:15,950 --> 00:13:21,699
there was one customer environment I

333
00:13:17,690 --> 00:13:24,499
looked at that had 1,700

334
00:13:21,699 --> 00:13:27,920
different encoded command PowerShell

335
00:13:24,499 --> 00:13:29,629
processes running and this is that you

336
00:13:27,920 --> 00:13:32,719
can imagine if you're working in a sock

337
00:13:29,629 --> 00:13:35,870
you put in an alert 4 encoded command

338
00:13:32,720 --> 00:13:38,059
PowerShell and then you get 1,800 hits

339
00:13:35,870 --> 00:13:40,550
back you get 1,800 alerts in your sim

340
00:13:38,059 --> 00:13:43,279
you're going to go a little bit not so

341
00:13:40,550 --> 00:13:44,420
clearly in a lot of environments this

342
00:13:43,279 --> 00:13:45,620
works really well and in some

343
00:13:44,420 --> 00:13:47,930
environments it's going to drive you

344
00:13:45,620 --> 00:13:51,019
nuts with false positives same with some

345
00:13:47,930 --> 00:13:53,540
of these other commands so hidden and

346
00:13:51,019 --> 00:13:55,430
execution policy bypass were kind of the

347
00:13:53,540 --> 00:13:58,248
most the two most common in the samples

348
00:13:55,430 --> 00:14:00,170
that I was looking at a few others were

349
00:13:58,249 --> 00:14:03,230
much less common and again this is a

350
00:14:00,170 --> 00:14:05,389
pretty small sample so it may not be

351
00:14:03,230 --> 00:14:06,889
representative of sort of organizations

352
00:14:05,389 --> 00:14:08,300
as a whole and I've also been

353
00:14:06,889 --> 00:14:10,550
discovering that there's a lot of

354
00:14:08,300 --> 00:14:12,920
variation in organization so what's very

355
00:14:10,550 --> 00:14:15,680
normal in one organization is not normal

356
00:14:12,920 --> 00:14:17,569
at all in a different one which is why

357
00:14:15,680 --> 00:14:18,620
it's really kind of it's all about kind

358
00:14:17,569 --> 00:14:22,819
of what's going on in your environment

359
00:14:18,620 --> 00:14:25,279
your baseline your sense of normal so

360
00:14:22,819 --> 00:14:28,569
you say okay well what what is running

361
00:14:25,279 --> 00:14:31,370
legitimately and wants to encode things

362
00:14:28,569 --> 00:14:33,559
and we found a lot of VDI tools that

363
00:14:31,370 --> 00:14:36,589
we're doing it and so here's a couple of

364
00:14:33,559 --> 00:14:38,809
examples newton extent and then i forget

365
00:14:36,589 --> 00:14:40,670
an egg Hrant doesn't and we have there

366
00:14:38,809 --> 00:14:44,480
encoded command examples and then we

367
00:14:40,670 --> 00:14:48,229
have what they decode as so nothing

368
00:14:44,480 --> 00:14:49,790
super super malicious going on here but

369
00:14:48,230 --> 00:14:52,579
for whatever reason they're using be

370
00:14:49,790 --> 00:14:54,649
encoded command argument the Palo Alto

371
00:14:52,579 --> 00:14:58,519
blog post does go on to say there are

372
00:14:54,649 --> 00:15:01,339
certain combinations of commands that

373
00:14:58,519 --> 00:15:03,829
are certain combinations of arguments

374
00:15:01,339 --> 00:15:04,879
that are more frequent in malware and or

375
00:15:03,829 --> 00:15:07,399
less frequent innerwear

376
00:15:04,879 --> 00:15:09,439
but as Dave was saying this morning it's

377
00:15:07,399 --> 00:15:10,879
really easy for an attacker to change

378
00:15:09,439 --> 00:15:13,879
those once they know you're looking for

379
00:15:10,879 --> 00:15:15,769
a particular pattern so it can can help

380
00:15:13,879 --> 00:15:20,149
you detect things but it can also give

381
00:15:15,769 --> 00:15:24,589
you a sense of false confidence okay so

382
00:15:20,149 --> 00:15:25,910
we're on the host we've exploited it we

383
00:15:24,589 --> 00:15:27,350
don't want to get kicked off too quickly

384
00:15:25,910 --> 00:15:29,569
so one of the things that we're going to

385
00:15:27,350 --> 00:15:30,649
do while we're on a host is probably

386
00:15:29,569 --> 00:15:32,479
some type of ization

387
00:15:30,649 --> 00:15:34,100
so there's a whole bunch of different

388
00:15:32,480 --> 00:15:34,970
things that nowhere might do for evasion

389
00:15:34,100 --> 00:15:36,319
but one

390
00:15:34,970 --> 00:15:39,680
of the really interesting ones that I

391
00:15:36,319 --> 00:15:41,810
like is checking for AV products this

392
00:15:39,680 --> 00:15:43,579
can be both checking on the host to see

393
00:15:41,810 --> 00:15:45,859
if there's a V running and also a lot of

394
00:15:43,579 --> 00:15:47,810
times it shows up there checking to see

395
00:15:45,860 --> 00:15:50,120
if they're in a sandbox or if they're in

396
00:15:47,810 --> 00:15:51,560
a researchers VM and if they are they're

397
00:15:50,120 --> 00:15:54,170
going to shut down not do anything

398
00:15:51,560 --> 00:15:56,959
interesting so you can't analyze them so

399
00:15:54,170 --> 00:15:59,779
a few different examples here first him

400
00:15:56,959 --> 00:16:01,638
was a piece of malware that Sentinel one

401
00:15:59,779 --> 00:16:04,040
wrote about last summer it's really cool

402
00:16:01,639 --> 00:16:06,290
it's really complicated so they looked

403
00:16:04,040 --> 00:16:08,029
at the dll's that were getting hooked in

404
00:16:06,290 --> 00:16:10,399
and they had a list of which AV you use

405
00:16:08,029 --> 00:16:12,740
which hooking dll's they also looks for

406
00:16:10,399 --> 00:16:14,810
kernel drivers and they knew which AV is

407
00:16:12,740 --> 00:16:17,480
used which kernel drivers and I think

408
00:16:14,810 --> 00:16:19,099
forum is actually the one that would see

409
00:16:17,480 --> 00:16:21,379
what AV you had running and then would

410
00:16:19,100 --> 00:16:22,819
change its behavior based on which AV

411
00:16:21,379 --> 00:16:25,399
you had running so it wasn't even as

412
00:16:22,819 --> 00:16:27,769
simple as I'm going to shutdown now it

413
00:16:25,399 --> 00:16:29,269
was I have specific things that I'm

414
00:16:27,769 --> 00:16:31,209
going to do or not do based on the

415
00:16:29,269 --> 00:16:34,490
presence of a V in your environment

416
00:16:31,209 --> 00:16:36,638
second one dry text macros a little bit

417
00:16:34,490 --> 00:16:39,019
more trying to detect sandboxes and

418
00:16:36,639 --> 00:16:42,259
researchers so it would be Canal and

419
00:16:39,019 --> 00:16:44,959
then it would check the IP or the domain

420
00:16:42,259 --> 00:16:48,889
that the traffic was coming from it had

421
00:16:44,959 --> 00:16:51,349
a list of different IPS or domains that

422
00:16:48,889 --> 00:16:53,509
belong to different vendors and so it

423
00:16:51,350 --> 00:16:56,420
would shut down if it was beaconing out

424
00:16:53,509 --> 00:16:57,980
from a vendor and the final one was

425
00:16:56,420 --> 00:16:59,628
actually just a sample that a colleague

426
00:16:57,980 --> 00:17:01,939
of mine was looking at when I was

427
00:16:59,629 --> 00:17:02,360
putting together this talk so a sample

428
00:17:01,939 --> 00:17:04,938
called

429
00:17:02,360 --> 00:17:06,500
eye pyramid which checks your Program

430
00:17:04,939 --> 00:17:08,569
Files directory to see what you have

431
00:17:06,500 --> 00:17:10,579
installed checks your run key and checks

432
00:17:08,569 --> 00:17:14,240
to file all entries and here's a

433
00:17:10,579 --> 00:17:16,188
screenshot of the different various

434
00:17:14,240 --> 00:17:21,770
antivirus programs that it was actually

435
00:17:16,189 --> 00:17:24,260
looking for so you look at this and say

436
00:17:21,770 --> 00:17:26,418
ok I understand why malware would do

437
00:17:24,260 --> 00:17:28,730
this or I understand why a malicious

438
00:17:26,419 --> 00:17:30,440
actor would do this but I can't really

439
00:17:28,730 --> 00:17:33,350
think of any reasons that someone would

440
00:17:30,440 --> 00:17:36,500
legitimately check for 20 different AP

441
00:17:33,350 --> 00:17:38,240
companies that seems weird so I think to

442
00:17:36,500 --> 00:17:40,250
myself okay I'm pretty confident that if

443
00:17:38,240 --> 00:17:43,220
I see this this is malware this is a bad

444
00:17:40,250 --> 00:17:46,850
actor you know that this should be high

445
00:17:43,220 --> 00:17:48,500
confidence in theory so we got this

446
00:17:46,850 --> 00:17:51,740
submitted from a customer

447
00:17:48,500 --> 00:17:53,630
in December December 8th which I'm

448
00:17:51,740 --> 00:17:55,250
mentioning that specifically because if

449
00:17:53,630 --> 00:17:58,580
you look at the compilation time stamp

450
00:17:55,250 --> 00:18:01,820
down here it's November 30th so this was

451
00:17:58,580 --> 00:18:04,310
pretty new it doesn't have a lot of

452
00:18:01,820 --> 00:18:06,770
metadata describing what it is it has

453
00:18:04,310 --> 00:18:08,750
kind of a innocuous name it doesn't have

454
00:18:06,770 --> 00:18:13,010
a description it is not signed by the

455
00:18:08,750 --> 00:18:14,050
publisher and its guests so 17 out of 61

456
00:18:13,010 --> 00:18:17,120
on virustotal

457
00:18:14,050 --> 00:18:18,860
when you look at it it's a very small at

458
00:18:17,120 --> 00:18:20,719
the dll so it's meant to be loaded by

459
00:18:18,860 --> 00:18:24,500
some and run by some other process and

460
00:18:20,720 --> 00:18:28,040
all it does is it has a list of AES and

461
00:18:24,500 --> 00:18:29,510
it checks the Avs to see if they're

462
00:18:28,040 --> 00:18:30,889
there and it checks what version they

463
00:18:29,510 --> 00:18:32,800
are and then it writes them out to an

464
00:18:30,890 --> 00:18:35,210
XML file that's all it does

465
00:18:32,800 --> 00:18:38,030
so we look at this and we go okay we

466
00:18:35,210 --> 00:18:40,250
know that evasion is something that

467
00:18:38,030 --> 00:18:42,410
malware does maybe this is a piece of

468
00:18:40,250 --> 00:18:45,290
malware because it's a dll we know we

469
00:18:42,410 --> 00:18:46,880
don't have the whole story so we sort of

470
00:18:45,290 --> 00:18:49,070
go back and forth with the customer we

471
00:18:46,880 --> 00:18:50,720
get more data about where it is I think

472
00:18:49,070 --> 00:18:54,919
it was in a temp directory which made it

473
00:18:50,720 --> 00:18:56,870
even worse and we finally are able to

474
00:18:54,920 --> 00:19:00,470
confirm that this is actually part of

475
00:18:56,870 --> 00:19:03,379
their VPN software so a lot of companies

476
00:19:00,470 --> 00:19:05,150
on your VPN they won't let you connect

477
00:19:03,380 --> 00:19:07,850
until they've checked that your software

478
00:19:05,150 --> 00:19:09,740
is fully patched and you have the AV

479
00:19:07,850 --> 00:19:12,080
that your IT department put on and it's

480
00:19:09,740 --> 00:19:14,450
completely updated and your GPO is

481
00:19:12,080 --> 00:19:19,639
updated and that looks like this and

482
00:19:14,450 --> 00:19:22,820
it's completely legitimate so I don't so

483
00:19:19,640 --> 00:19:24,530
i scans this again on April 1st and it

484
00:19:22,820 --> 00:19:28,720
still had that pretty high score and

485
00:19:24,530 --> 00:19:31,670
virus total and I'm not saying that you

486
00:19:28,720 --> 00:19:33,020
talked about how silly AV vendors are

487
00:19:31,670 --> 00:19:35,450
because I think this is actually a

488
00:19:33,020 --> 00:19:38,060
really hard choice to decide if all you

489
00:19:35,450 --> 00:19:40,010
have is a static this is bad or this is

490
00:19:38,060 --> 00:19:42,470
not bad what are you supposed to do with

491
00:19:40,010 --> 00:19:45,500
this particular DLL it's doing something

492
00:19:42,470 --> 00:19:48,050
that we know malware does but it's not

493
00:19:45,500 --> 00:19:50,060
malware so I don't think the 17 AV

494
00:19:48,050 --> 00:19:51,980
vendors who marked this is malicious are

495
00:19:50,060 --> 00:19:55,669
necessarily wrong and I don't think the

496
00:19:51,980 --> 00:19:56,900
you know the other forty-something who

497
00:19:55,670 --> 00:19:58,790
marked it as non malicious or

498
00:19:56,900 --> 00:20:01,400
necessarily they have the right answer

499
00:19:58,790 --> 00:20:02,000
right like this could just have easily

500
00:20:01,400 --> 00:20:05,360
been

501
00:20:02,000 --> 00:20:06,830
and based on this binary isolated by

502
00:20:05,360 --> 00:20:08,990
itself without knowing anything about

503
00:20:06,830 --> 00:20:14,179
the process that ran it there's just no

504
00:20:08,990 --> 00:20:17,090
way to know for sure okay so that's one

505
00:20:14,180 --> 00:20:20,180
type of evasion the other type of

506
00:20:17,090 --> 00:20:21,919
evasion which again is kind of

507
00:20:20,180 --> 00:20:26,480
overlapping with the keynote this

508
00:20:21,920 --> 00:20:28,790
morning is that if you have a legitimate

509
00:20:26,480 --> 00:20:31,520
process you're using PowerShell you're

510
00:20:28,790 --> 00:20:34,220
using command something like that people

511
00:20:31,520 --> 00:20:35,930
are monitoring for it and your security

512
00:20:34,220 --> 00:20:37,700
software is often monitoring for it

513
00:20:35,930 --> 00:20:39,560
looking for malicious things based on

514
00:20:37,700 --> 00:20:42,590
the process name so if you change the

515
00:20:39,560 --> 00:20:44,870
process name they don't know they're no

516
00:20:42,590 --> 00:20:46,610
longer monitoring and therefore you can

517
00:20:44,870 --> 00:20:51,610
run sort of whatever you want undetected

518
00:20:46,610 --> 00:20:54,290
so the top example here is a run DLL

519
00:20:51,610 --> 00:20:57,199
process but it's been renamed to service

520
00:20:54,290 --> 00:20:59,840
host uxe so both legitimate Windows

521
00:20:57,200 --> 00:21:01,430
binaries but because run DLL 32 can be

522
00:20:59,840 --> 00:21:03,169
abused and we know it can be abused

523
00:21:01,430 --> 00:21:05,870
they've renamed it and this was a

524
00:21:03,170 --> 00:21:08,090
ransomware sample called crypt xxx that

525
00:21:05,870 --> 00:21:09,409
was you know briefly popular over the

526
00:21:08,090 --> 00:21:09,949
summer before something else took

527
00:21:09,410 --> 00:21:13,010
advantage

528
00:21:09,950 --> 00:21:16,100
it took took precedence over it the

529
00:21:13,010 --> 00:21:17,720
bottom example again is a command the

530
00:21:16,100 --> 00:21:20,449
windows command processor and it's just

531
00:21:17,720 --> 00:21:24,770
been renamed to Johnson exe so I'm not

532
00:21:20,450 --> 00:21:27,230
sure who Johnson was but he had he was

533
00:21:24,770 --> 00:21:29,900
used to evade someone's security

534
00:21:27,230 --> 00:21:31,550
software at some point so ok this is

535
00:21:29,900 --> 00:21:35,260
kind of cool this is kind of interesting

536
00:21:31,550 --> 00:21:37,970
you start thinking how do I catch this

537
00:21:35,260 --> 00:21:39,950
there's kind of two options that come to

538
00:21:37,970 --> 00:21:41,930
mind one is you get it a list of all of

539
00:21:39,950 --> 00:21:43,340
the hashes for PowerShell and you

540
00:21:41,930 --> 00:21:46,040
compare them against the name of the

541
00:21:43,340 --> 00:21:47,510
running process and if it has the

542
00:21:46,040 --> 00:21:49,280
PowerShell hash but it's not named

543
00:21:47,510 --> 00:21:52,160
PowerShell than you you know do

544
00:21:49,280 --> 00:21:54,500
something about it um this is kind of

545
00:21:52,160 --> 00:21:56,480
it's hard for it to be human readable

546
00:21:54,500 --> 00:21:58,280
there's a lot of opportunities for error

547
00:21:56,480 --> 00:22:00,860
you might miss a version of PowerShell

548
00:21:58,280 --> 00:22:04,850
if to keep it updated all the time so

549
00:22:00,860 --> 00:22:06,379
maybe not great the other option which

550
00:22:04,850 --> 00:22:08,419
is kind of interesting we were kind of

551
00:22:06,380 --> 00:22:10,550
playing around with it is to be able to

552
00:22:08,420 --> 00:22:12,110
compare the binary metadata the internal

553
00:22:10,550 --> 00:22:15,050
description of the internal name against

554
00:22:12,110 --> 00:22:15,889
the path or the process name so there's

555
00:22:15,050 --> 00:22:17,659
a whole bunch of different

556
00:22:15,890 --> 00:22:20,060
examples of that it works really well to

557
00:22:17,660 --> 00:22:21,860
detect sticky keys it works really well

558
00:22:20,060 --> 00:22:24,020
to detect renamed command renamed

559
00:22:21,860 --> 00:22:26,899
PowerShell but it does have false

560
00:22:24,020 --> 00:22:29,360
positives it's all positives happen when

561
00:22:26,900 --> 00:22:31,580
your company goes international because

562
00:22:29,360 --> 00:22:34,010
at that point your french computers or

563
00:22:31,580 --> 00:22:35,929
your chinese computers are going to have

564
00:22:34,010 --> 00:22:38,570
their binary metadata in the local

565
00:22:35,930 --> 00:22:41,480
language so that can be kind of an

566
00:22:38,570 --> 00:22:43,909
interesting problem and I I like that

567
00:22:41,480 --> 00:22:45,800
example because you know if you have a

568
00:22:43,910 --> 00:22:48,740
threat research team that's all American

569
00:22:45,800 --> 00:22:51,020
or American and UK and Canada and

570
00:22:48,740 --> 00:22:52,340
they're working and thinking about

571
00:22:51,020 --> 00:22:54,680
things from an english-speaking

572
00:22:52,340 --> 00:22:56,360
perspective there might be things that

573
00:22:54,680 --> 00:22:58,640
are normal in other environments they

574
00:22:56,360 --> 00:23:00,860
don't know about so it's kind of a good

575
00:22:58,640 --> 00:23:03,410
a good reminder that even if we're based

576
00:23:00,860 --> 00:23:05,780
in one place a lot of times you know

577
00:23:03,410 --> 00:23:10,460
we're trying to do security all over the

578
00:23:05,780 --> 00:23:13,399
world so okay I think I might actually

579
00:23:10,460 --> 00:23:15,050
be on time this is exciting okay so

580
00:23:13,400 --> 00:23:16,730
those are a few examples and that leaves

581
00:23:15,050 --> 00:23:20,330
us with the question there's the problem

582
00:23:16,730 --> 00:23:22,190
what's the solution if I can't trust

583
00:23:20,330 --> 00:23:25,310
what my vendors are telling me is

584
00:23:22,190 --> 00:23:27,530
malicious or not malicious and you know

585
00:23:25,310 --> 00:23:29,990
I I get stuff from the fire I blog post

586
00:23:27,530 --> 00:23:31,610
I run it in my environment and it has

587
00:23:29,990 --> 00:23:36,260
hundreds and hundreds of false positives

588
00:23:31,610 --> 00:23:38,629
what do I do about this and first step

589
00:23:36,260 --> 00:23:40,100
is not to panic sometimes when you start

590
00:23:38,630 --> 00:23:41,630
threat hunting or you start

591
00:23:40,100 --> 00:23:43,100
investigating a false positive you

592
00:23:41,630 --> 00:23:46,070
realize there are thousands and

593
00:23:43,100 --> 00:23:49,840
thousands of processes that are coming

594
00:23:46,070 --> 00:23:52,070
up in your search coming up in your hunt

595
00:23:49,840 --> 00:23:53,300
you are going to be able to figure out

596
00:23:52,070 --> 00:23:54,560
an answer and you are going to be able

597
00:23:53,300 --> 00:23:56,120
to figure out what's normal in your

598
00:23:54,560 --> 00:23:57,649
environment you just need to put a

599
00:23:56,120 --> 00:24:00,909
little bit of time and a little bit of

600
00:23:57,650 --> 00:24:03,230
thought into it so first thing is really

601
00:24:00,910 --> 00:24:04,610
understanding what it's trying to alert

602
00:24:03,230 --> 00:24:08,390
on or what the thing that you're looking

603
00:24:04,610 --> 00:24:10,070
for that what the you know the bit of

604
00:24:08,390 --> 00:24:11,720
advice that you took from the fire I

605
00:24:10,070 --> 00:24:14,600
blog post is actually trying to find

606
00:24:11,720 --> 00:24:17,450
write so why does an attacker want to

607
00:24:14,600 --> 00:24:19,610
use the encoded command switch the more

608
00:24:17,450 --> 00:24:21,590
you understand about what the alert is

609
00:24:19,610 --> 00:24:23,689
actually based on the easier it is to

610
00:24:21,590 --> 00:24:25,280
tell if it's a false positive or not the

611
00:24:23,690 --> 00:24:27,350
other part is that the more you

612
00:24:25,280 --> 00:24:28,879
understand about sort of the intent of

613
00:24:27,350 --> 00:24:31,370
it the easier it is to ask

614
00:24:28,880 --> 00:24:33,680
question well okay if I detect encoded

615
00:24:31,370 --> 00:24:36,860
command and I detect PowerShell is there

616
00:24:33,680 --> 00:24:39,500
anything the attacker can do to change

617
00:24:36,860 --> 00:24:41,479
those and still kind of get there their

618
00:24:39,500 --> 00:24:43,520
objective so it allows you to start

619
00:24:41,480 --> 00:24:45,140
thinking really creatively and not get

620
00:24:43,520 --> 00:24:47,660
too tied down to a specific set of

621
00:24:45,140 --> 00:24:49,610
indicators the other part is looking for

622
00:24:47,660 --> 00:24:51,530
patterns unique to your environment so I

623
00:24:49,610 --> 00:24:55,669
don't know what you've got running in

624
00:24:51,530 --> 00:24:57,440
your environment and I don't know if

625
00:24:55,670 --> 00:24:59,330
you've got a VDI tool that's running in

626
00:24:57,440 --> 00:25:00,890
coded PowerShell but you do and it's

627
00:24:59,330 --> 00:25:03,080
going to be really obvious as soon as

628
00:25:00,890 --> 00:25:04,640
you start looking so now you know okay

629
00:25:03,080 --> 00:25:06,980
encoded PowerShell in my environment

630
00:25:04,640 --> 00:25:08,600
should look exactly like this and if it

631
00:25:06,980 --> 00:25:11,030
doesn't look exactly like this then I

632
00:25:08,600 --> 00:25:12,889
want to see an alert finger another

633
00:25:11,030 --> 00:25:16,120
really good one that I think more people

634
00:25:12,890 --> 00:25:18,200
should be should be profiling is

635
00:25:16,120 --> 00:25:20,810
PowerShell that makes network

636
00:25:18,200 --> 00:25:22,460
connections outside your environment you

637
00:25:20,810 --> 00:25:24,110
will there are some environments where

638
00:25:22,460 --> 00:25:26,000
it will a lot of people a lot of IT

639
00:25:24,110 --> 00:25:28,610
admins use PowerShell to talk back to

640
00:25:26,000 --> 00:25:31,100
Microsoft get updates get patches stuff

641
00:25:28,610 --> 00:25:33,320
like that but it's not going to be all

642
00:25:31,100 --> 00:25:35,449
of the organization's and you can still

643
00:25:33,320 --> 00:25:38,330
profile that you can whitelist the

644
00:25:35,450 --> 00:25:40,190
Microsoft IPs and get IPS for you know

645
00:25:38,330 --> 00:25:41,540
if it connects out to anything that's

646
00:25:40,190 --> 00:25:47,060
not Microsoft you want to know about

647
00:25:41,540 --> 00:25:50,210
that so you're not going to be able to

648
00:25:47,060 --> 00:25:51,379
get rid of everything you're not going

649
00:25:50,210 --> 00:25:52,880
to be able to get rid of all the false

650
00:25:51,380 --> 00:25:54,650
positives in your sim you're not going

651
00:25:52,880 --> 00:26:00,350
to be able to make all threat hunts work

652
00:25:54,650 --> 00:26:02,630
perfectly so what do you do you tune out

653
00:26:00,350 --> 00:26:04,129
the stuff that you can if your tools

654
00:26:02,630 --> 00:26:06,350
aren't letting you tune things and they

655
00:26:04,130 --> 00:26:07,910
aren't being really granular and push

656
00:26:06,350 --> 00:26:09,939
back on the vendor and say I really

657
00:26:07,910 --> 00:26:12,710
really want this please let me keep this

658
00:26:09,940 --> 00:26:15,380
and the stuff that you can't tune out

659
00:26:12,710 --> 00:26:16,850
document it you're going to get new sake

660
00:26:15,380 --> 00:26:18,920
analyst and you're going to get new blue

661
00:26:16,850 --> 00:26:20,899
teamers you're going to get in IR

662
00:26:18,920 --> 00:26:23,030
consultants when you have a breach who

663
00:26:20,900 --> 00:26:25,970
don't know your environment and if they

664
00:26:23,030 --> 00:26:27,560
can say hey why is this printer making

665
00:26:25,970 --> 00:26:29,510
this weird network connection and you

666
00:26:27,560 --> 00:26:31,550
say oh yeah we investigated that two

667
00:26:29,510 --> 00:26:33,800
years ago here's what it's doing here's

668
00:26:31,550 --> 00:26:35,510
the steps we used to find it and having

669
00:26:33,800 --> 00:26:39,520
this really really rich wiki that's

670
00:26:35,510 --> 00:26:39,520
going to make everything a lot faster

671
00:26:40,180 --> 00:26:46,360
so takeaways and we're just about done

672
00:26:43,500 --> 00:26:47,950
the vendors are there's a lot of really

673
00:26:46,360 --> 00:26:49,449
smart people working for the vendors I

674
00:26:47,950 --> 00:26:52,360
work with these brilliant people every

675
00:26:49,450 --> 00:26:54,250
day but that's only half the battle and

676
00:26:52,360 --> 00:26:56,379
their knowledge in their experience only

677
00:26:54,250 --> 00:26:58,180
sells half of the problem the other half

678
00:26:56,380 --> 00:27:00,100
of the problem is what's normal in your

679
00:26:58,180 --> 00:27:02,920
environment and honestly the blue

680
00:27:00,100 --> 00:27:05,350
teamers are the experts there so don't

681
00:27:02,920 --> 00:27:07,480
feel bad about working in a sock or

682
00:27:05,350 --> 00:27:08,919
don't feel like you're less important

683
00:27:07,480 --> 00:27:10,420
than a malware researcher because you

684
00:27:08,920 --> 00:27:12,580
work in a sock because you are actually

685
00:27:10,420 --> 00:27:15,040
an expert in your own environment and

686
00:27:12,580 --> 00:27:17,379
your knowledge is just as valuable or

687
00:27:15,040 --> 00:27:19,770
more valuable than sort of the knowledge

688
00:27:17,380 --> 00:27:22,180
this abstract knowledge that's out here

689
00:27:19,770 --> 00:27:24,250
your security tools are making

690
00:27:22,180 --> 00:27:25,870
assumptions they have to make

691
00:27:24,250 --> 00:27:27,490
assumptions because a lot of times they

692
00:27:25,870 --> 00:27:29,830
just don't have enough information to

693
00:27:27,490 --> 00:27:31,420
know for sure so they have to say this

694
00:27:29,830 --> 00:27:33,760
is malware or they have to say this is

695
00:27:31,420 --> 00:27:35,500
not malware and you want to understand

696
00:27:33,760 --> 00:27:37,600
those assumptions as far as you can and

697
00:27:35,500 --> 00:27:40,300
you want to be willing to question them

698
00:27:37,600 --> 00:27:43,360
and challenge them I'm a Harry Potter

699
00:27:40,300 --> 00:27:44,800
person so I always think of the quote in

700
00:27:43,360 --> 00:27:46,929
the second Harry Potter book where they

701
00:27:44,800 --> 00:27:49,000
say don't trust anything if you can't

702
00:27:46,930 --> 00:27:50,800
see where it keeps its brain and I want

703
00:27:49,000 --> 00:27:52,900
to understand if my skin says hey this

704
00:27:50,800 --> 00:27:54,730
is a situ I want to understand why it

705
00:27:52,900 --> 00:27:56,680
stinks it's a situ I'm not going to

706
00:27:54,730 --> 00:27:59,110
trust it right away

707
00:27:56,680 --> 00:28:01,440
false positives are not always a waste

708
00:27:59,110 --> 00:28:04,570
of your time this is very controversial

709
00:28:01,440 --> 00:28:05,860
but if you're getting thousands and

710
00:28:04,570 --> 00:28:07,870
thousands of alerts that are all the

711
00:28:05,860 --> 00:28:09,729
same yes that is a waste of your time if

712
00:28:07,870 --> 00:28:11,320
you've gotten a false positive it's the

713
00:28:09,730 --> 00:28:13,360
first time you've ever seen it in your

714
00:28:11,320 --> 00:28:14,860
environment that's interesting that's

715
00:28:13,360 --> 00:28:16,959
worth taking some time to try to

716
00:28:14,860 --> 00:28:18,939
understand you know what is this false

717
00:28:16,960 --> 00:28:21,040
positive about why did my tool think

718
00:28:18,940 --> 00:28:23,410
that this was malicious what is actually

719
00:28:21,040 --> 00:28:25,659
going on here is it new or did the tool

720
00:28:23,410 --> 00:28:26,890
get an update because all of those

721
00:28:25,660 --> 00:28:28,210
things are either going to teach you

722
00:28:26,890 --> 00:28:29,860
more about security and more about

723
00:28:28,210 --> 00:28:32,340
attackers or they're going to teach you

724
00:28:29,860 --> 00:28:34,090
more about your environment and finally

725
00:28:32,340 --> 00:28:35,889
configure your tools

726
00:28:34,090 --> 00:28:38,199
don't take the out-of-the-box settings

727
00:28:35,890 --> 00:28:39,730
make them specific to your environment

728
00:28:38,200 --> 00:28:44,110
make them about the things that you care

729
00:28:39,730 --> 00:28:46,630
about automate what you can this can be

730
00:28:44,110 --> 00:28:48,340
hard and then document everything that

731
00:28:46,630 --> 00:28:51,430
is sort of weird in your environment

732
00:28:48,340 --> 00:28:52,629
that is not intuitive and that anything

733
00:28:51,430 --> 00:28:53,799
that you've spent 15 minutes

734
00:28:52,630 --> 00:28:55,570
investigating

735
00:28:53,799 --> 00:28:57,730
to figure out what the hell it is don't

736
00:28:55,570 --> 00:28:59,110
just walk away from that spend another

737
00:28:57,730 --> 00:29:02,789
three minutes writing down what you

738
00:28:59,110 --> 00:29:06,309
found so that's the end of my slide show

739
00:29:02,789 --> 00:29:08,080
the end of my presentation I'm happy to

740
00:29:06,309 --> 00:29:10,090
take questions now or if people are

741
00:29:08,080 --> 00:29:15,580
feeling shy they can come up to me later

742
00:29:10,090 --> 00:29:23,050
but thank you I think I have a question

743
00:29:15,580 --> 00:29:23,050
[Applause]

744
00:29:30,570 --> 00:29:35,990
thank you

745
00:29:32,490 --> 00:29:35,990
[Applause]

