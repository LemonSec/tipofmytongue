1
00:00:00,030 --> 00:00:03,599
and he's going to talk to you today

2
00:00:01,680 --> 00:00:08,820
about breaking out of application

3
00:00:03,600 --> 00:00:13,759
sandbox environments carcase fun yeah

4
00:00:08,820 --> 00:00:17,480
okay we even lose stuff a little bit so

5
00:00:13,759 --> 00:00:21,449
I'm excited to be here today

6
00:00:17,480 --> 00:00:23,699
Dave graver gave a great talk and I

7
00:00:21,449 --> 00:00:27,060
think there's a lot of great talks on

8
00:00:23,699 --> 00:00:29,400
tap today hope you guys are excited for

9
00:00:27,060 --> 00:00:32,729
this one I know I am I'm excited to be

10
00:00:29,400 --> 00:00:35,989
here and mainly because I can finally

11
00:00:32,729 --> 00:00:39,290
tell my family friends I went to Harvard

12
00:00:35,989 --> 00:00:41,430
thank you for laughing at my lame jokes

13
00:00:39,290 --> 00:00:44,940
yeah so I'm going to talk about escaping

14
00:00:41,430 --> 00:00:48,110
Alcatraz today and we'll just jump right

15
00:00:44,940 --> 00:00:50,519
in this is a little bit about Who I am

16
00:00:48,110 --> 00:00:55,199
Patrick I already talked about me so

17
00:00:50,520 --> 00:00:57,539
we'll just move right on so we're going

18
00:00:55,199 --> 00:00:59,218
to look at a lot of different things

19
00:00:57,539 --> 00:01:01,410
today specifically we're going to look

20
00:00:59,219 --> 00:01:03,559
at the history of Alcatraz

21
00:01:01,410 --> 00:01:05,729
you'll notice that Alcatraz is in

22
00:01:03,559 --> 00:01:08,460
quotations there's a reason for that

23
00:01:05,729 --> 00:01:10,229
we're going to look at the island the

24
00:01:08,460 --> 00:01:11,970
prison of Alcatraz but we're also going

25
00:01:10,229 --> 00:01:13,650
to I'm going to define what I mean by

26
00:01:11,970 --> 00:01:16,170
Alcatraz for the purpose of this

27
00:01:13,650 --> 00:01:19,170
presentation we're then going to move

28
00:01:16,170 --> 00:01:20,790
into some escapes and how we break out

29
00:01:19,170 --> 00:01:22,590
of these and we're going to do it at

30
00:01:20,790 --> 00:01:26,759
different levels I'm using the

31
00:01:22,590 --> 00:01:28,979
Wolfenstein three levels because as kid

32
00:01:26,759 --> 00:01:30,479
I love playing Wolfenstein 3 anybody's

33
00:01:28,979 --> 00:01:33,299
played that when they were growing up

34
00:01:30,479 --> 00:01:36,240
awesome so you'll know how these

35
00:01:33,299 --> 00:01:38,100
different levels got gradually harder

36
00:01:36,240 --> 00:01:39,960
and harder until you got I am death

37
00:01:38,100 --> 00:01:42,929
incarnate and I never could get through

38
00:01:39,960 --> 00:01:44,759
that so but we will through this one to

39
00:01:42,930 --> 00:01:47,479
these escapes we'll talk about the

40
00:01:44,759 --> 00:01:49,829
mitigation techniques how can we stop or

41
00:01:47,479 --> 00:01:52,110
at least figure out that somebody's

42
00:01:49,829 --> 00:01:55,949
trying to escape and then we'll wrap up

43
00:01:52,110 --> 00:01:59,219
with a little conclusion here so a

44
00:01:55,950 --> 00:02:02,219
couple years ago I would do some work

45
00:01:59,219 --> 00:02:07,048
out in the San Francisco area and I'm a

46
00:02:02,219 --> 00:02:10,699
big history guy so when I go places on

47
00:02:07,049 --> 00:02:12,830
vacation or for work I like to go visit

48
00:02:10,699 --> 00:02:14,989
historical sites on

49
00:02:12,830 --> 00:02:16,880
it just gives the history kind of

50
00:02:14,990 --> 00:02:19,010
instead of it's just in the book when

51
00:02:16,880 --> 00:02:22,010
you learn in school really being able to

52
00:02:19,010 --> 00:02:24,140
touch and see things needs a lot for me

53
00:02:22,010 --> 00:02:27,500
so when we were out there of course I

54
00:02:24,140 --> 00:02:29,480
had to go to Alcatraz and was a ton of

55
00:02:27,500 --> 00:02:33,860
fun so how many anybody had been to

56
00:02:29,480 --> 00:02:36,190
Alcatraz a number of you okay great so

57
00:02:33,860 --> 00:02:41,570
some of this you'll know

58
00:02:36,190 --> 00:02:45,280
Alcatraz opened in 1934 it's this island

59
00:02:41,570 --> 00:02:48,620
in the middle of the San Francisco Bay

60
00:02:45,280 --> 00:02:51,950
San Francisco Bay if you don't know is

61
00:02:48,620 --> 00:02:53,870
not warm water it's cold it gets up to

62
00:02:51,950 --> 00:02:56,510
about sixty degrees Fahrenheit at the

63
00:02:53,870 --> 00:02:59,900
warmest so that's that since late August

64
00:02:56,510 --> 00:03:01,880
September at sixty degrees hypothermia

65
00:02:59,900 --> 00:03:04,670
kicks in

66
00:03:01,880 --> 00:03:08,690
within an hour to two you'll pass out

67
00:03:04,670 --> 00:03:10,070
from the cold so it's a mile and a half

68
00:03:08,690 --> 00:03:12,680
to the closest shore how long do you

69
00:03:10,070 --> 00:03:16,489
think that it would take to swim a mile

70
00:03:12,680 --> 00:03:18,640
and a half anybody have a guess twenty

71
00:03:16,490 --> 00:03:21,110
minutes No

72
00:03:18,640 --> 00:03:25,399
about an hour and a half

73
00:03:21,110 --> 00:03:26,959
my sister-in-law does triathlons and a

74
00:03:25,400 --> 00:03:30,940
lot of these things and so she'll swim

75
00:03:26,959 --> 00:03:34,640
this type of distance in warmer water

76
00:03:30,940 --> 00:03:36,500
but in the ocean and it takes her about

77
00:03:34,640 --> 00:03:39,920
an hour and 20 minutes hour-and-a-half

78
00:03:36,500 --> 00:03:43,630
and she trains for this so a mile and a

79
00:03:39,920 --> 00:03:46,040
half hour and have to take approximately

80
00:03:43,630 --> 00:03:49,340
hypothermia is kicking in within an hour

81
00:03:46,040 --> 00:03:52,880
to two it's very unlikely that somebody

82
00:03:49,340 --> 00:03:55,310
if they try to escape yep they get past

83
00:03:52,880 --> 00:03:58,160
the guards they get past the walls they

84
00:03:55,310 --> 00:03:59,480
get past everything and they try to swim

85
00:03:58,160 --> 00:04:01,670
it's very unlikely they're going to

86
00:03:59,480 --> 00:04:04,459
survive so the government kind of

87
00:04:01,670 --> 00:04:06,500
thought this is a great place for this

88
00:04:04,459 --> 00:04:08,480
president looking house ability most

89
00:04:06,500 --> 00:04:12,530
notorious prisoners here and they'll be

90
00:04:08,480 --> 00:04:16,730
safe well in the 29 years of operation

91
00:04:12,530 --> 00:04:19,579
there were 14 escape attempts this was

92
00:04:16,730 --> 00:04:22,700
by 36 prisoners two of them tried twice

93
00:04:19,579 --> 00:04:26,180
23 were caught six were shot and killed

94
00:04:22,700 --> 00:04:26,570
two drowned but the scary part is their

95
00:04:26,180 --> 00:04:29,780
spy

96
00:04:26,570 --> 00:04:31,490
unaccounted for and they don't know what

97
00:04:29,780 --> 00:04:35,960
happened to these there's been reports

98
00:04:31,490 --> 00:04:38,750
that they've been seen afterwards but we

99
00:04:35,960 --> 00:04:40,250
don't know for sure if they survived if

100
00:04:38,750 --> 00:04:44,060
we think about that with our computing

101
00:04:40,250 --> 00:04:47,210
environment that can be kind of scary if

102
00:04:44,060 --> 00:04:49,040
you set up your network and you try to

103
00:04:47,210 --> 00:04:52,070
secure it but if there's five

104
00:04:49,040 --> 00:04:55,450
unaccounted for English's actors in your

105
00:04:52,070 --> 00:05:00,010
environment that can be kind of scary so

106
00:04:55,450 --> 00:05:02,330
we've got to be careful with that now I

107
00:05:00,010 --> 00:05:03,800
don't want to just talk about the island

108
00:05:02,330 --> 00:05:05,419
we want to talk about what we're really

109
00:05:03,800 --> 00:05:07,520
here for which is these applications

110
00:05:05,420 --> 00:05:10,490
sandbox environments and some of the

111
00:05:07,520 --> 00:05:13,820
technologies we use are the Microsoft

112
00:05:10,490 --> 00:05:15,620
Remote Desktop you can use this and do

113
00:05:13,820 --> 00:05:18,380
web applications publish these

114
00:05:15,620 --> 00:05:21,710
applications to the web login access

115
00:05:18,380 --> 00:05:25,300
them just like they're on your computer

116
00:05:21,710 --> 00:05:28,070
I don't recommend it I've used it just

117
00:05:25,300 --> 00:05:30,590
as a proof of concept it was terribly

118
00:05:28,070 --> 00:05:32,330
slow when I tried doing this but it's

119
00:05:30,590 --> 00:05:35,169
great for for management and trying

120
00:05:32,330 --> 00:05:38,120
things up we also have VMware View

121
00:05:35,170 --> 00:05:43,550
they're thin app which is what I used

122
00:05:38,120 --> 00:05:46,100
when I was a sysadmin works great allows

123
00:05:43,550 --> 00:05:48,740
you to just publish these apps and it's

124
00:05:46,100 --> 00:05:50,570
very easy to manage and then if you ask

125
00:05:48,740 --> 00:05:53,360
anybody Citrix everybody knows what

126
00:05:50,570 --> 00:05:56,990
Citrix is it's probably one of the BEA

127
00:05:53,360 --> 00:05:59,840
leader in this space with application

128
00:05:56,990 --> 00:06:01,790
virtualization but we can apply these

129
00:05:59,840 --> 00:06:05,770
same concepts that we'll learn today -

130
00:06:01,790 --> 00:06:10,220
kiosk PCs so you go to the library and

131
00:06:05,770 --> 00:06:14,180
you want to look up some books and you

132
00:06:10,220 --> 00:06:15,860
have the the browser window that's lost

133
00:06:14,180 --> 00:06:18,170
there for you to look it up

134
00:06:15,860 --> 00:06:19,550
what can you escape that can you get out

135
00:06:18,170 --> 00:06:23,270
of that to get access to the underlying

136
00:06:19,550 --> 00:06:29,060
operating system it's it's possible

137
00:06:23,270 --> 00:06:31,099
right so we'll look at that as well so

138
00:06:29,060 --> 00:06:33,800
what's the purpose of these applications

139
00:06:31,100 --> 00:06:36,470
well simplified management we're

140
00:06:33,800 --> 00:06:37,249
responsible we're expected to do less

141
00:06:36,470 --> 00:06:42,129
with

142
00:06:37,249 --> 00:06:45,559
or more with less now we don't want to

143
00:06:42,129 --> 00:06:48,139
hire more people and all that companies

144
00:06:45,559 --> 00:06:50,149
so if we can simplify this management's

145
00:06:48,139 --> 00:06:52,039
going to make it easier for us we want

146
00:06:50,149 --> 00:06:56,889
to be able to provide remote access to

147
00:06:52,039 --> 00:06:59,359
our our resources easily for our users

148
00:06:56,889 --> 00:07:03,189
we want to deliver these applications to

149
00:06:59,359 --> 00:07:06,248
any device so if my sales team or my

150
00:07:03,189 --> 00:07:09,219
executives want to use their iPad to

151
00:07:06,249 --> 00:07:11,949
access some Windows 98

152
00:07:09,219 --> 00:07:15,229
application that can only run Windows 98

153
00:07:11,949 --> 00:07:17,719
we want to be able to do that and so

154
00:07:15,229 --> 00:07:19,008
this allows us to do and then we can

155
00:07:17,719 --> 00:07:22,429
centralize that control of those

156
00:07:19,009 --> 00:07:24,979
applications so I can provide an

157
00:07:22,429 --> 00:07:28,938
application that's all set up ready to

158
00:07:24,979 --> 00:07:31,459
go for that user and specify who's has

159
00:07:28,939 --> 00:07:34,299
access to it what they can access and

160
00:07:31,459 --> 00:07:38,359
really control that application and so

161
00:07:34,299 --> 00:07:40,279
from from a administration standpoint

162
00:07:38,359 --> 00:07:44,929
these things are great and we want to do

163
00:07:40,279 --> 00:07:47,449
this but as the malicious actor or as a

164
00:07:44,929 --> 00:07:49,489
pen tester myself I want to be able to

165
00:07:47,449 --> 00:07:51,589
break out because having access to an

166
00:07:49,489 --> 00:07:54,049
application is cool having actions to

167
00:07:51,589 --> 00:07:55,279
that data is okay but I want more right

168
00:07:54,049 --> 00:07:57,679
I want to I'm going to start moving

169
00:07:55,279 --> 00:07:59,899
around the environment more so I want to

170
00:07:57,679 --> 00:08:03,799
escape out of that if I can and then

171
00:07:59,899 --> 00:08:07,179
keep moving but to escape we need a good

172
00:08:03,799 --> 00:08:11,119
escape plan so this map is shows the

173
00:08:07,179 --> 00:08:14,448
locations that those 14 escape attempts

174
00:08:11,119 --> 00:08:16,339
were made from and by who and the dates

175
00:08:14,449 --> 00:08:19,009
all that stuff but each of these

176
00:08:16,339 --> 00:08:21,679
attempts they had to have a plan they

177
00:08:19,009 --> 00:08:23,929
couldn't just wing it they're not going

178
00:08:21,679 --> 00:08:26,748
to do well if they did that so they have

179
00:08:23,929 --> 00:08:28,099
to get everything ready maybe they have

180
00:08:26,749 --> 00:08:30,019
a scape rafts that they have to build

181
00:08:28,099 --> 00:08:31,429
maybe they have to get a job and it's

182
00:08:30,019 --> 00:08:34,360
certainly part of the prison so that

183
00:08:31,429 --> 00:08:36,769
they can gather the materials they want

184
00:08:34,360 --> 00:08:40,870
they have to know where they want to

185
00:08:36,769 --> 00:08:44,169
escape from the one kind of at the top

186
00:08:40,870 --> 00:08:47,059
escape attempt 13 those three of those

187
00:08:44,169 --> 00:08:49,490
there's three guys in that one and those

188
00:08:47,059 --> 00:08:50,360
three of those were part of the five

189
00:08:49,490 --> 00:08:53,149
that are on account of

190
00:08:50,360 --> 00:08:54,740
for they needed to know where they

191
00:08:53,149 --> 00:08:56,660
wanted to escape from because of the way

192
00:08:54,740 --> 00:08:58,880
that the current was running in the

193
00:08:56,660 --> 00:09:00,620
water and everything that would help

194
00:08:58,880 --> 00:09:04,870
them be successful so we want to do the

195
00:09:00,620 --> 00:09:07,850
same thing so I've created a little

196
00:09:04,870 --> 00:09:09,350
escape plan here for us so the first

197
00:09:07,850 --> 00:09:12,140
thing we want to do is of course obtain

198
00:09:09,350 --> 00:09:14,450
access to our Alcatraz so what's that

199
00:09:12,140 --> 00:09:17,510
mean do we want to get arrested no we're

200
00:09:14,450 --> 00:09:19,310
not going to prison we have to gain

201
00:09:17,510 --> 00:09:21,709
access to that computing environment so

202
00:09:19,310 --> 00:09:23,869
if it's Citrix if it's VMware whatever

203
00:09:21,709 --> 00:09:26,869
it is we need to gain access how do we

204
00:09:23,870 --> 00:09:28,730
do that a number of ways we kiosk pcs we

205
00:09:26,870 --> 00:09:31,850
can get physical access these

206
00:09:28,730 --> 00:09:33,579
virtualized maybe we do password

207
00:09:31,850 --> 00:09:39,829
guessing that's usually the easiest way

208
00:09:33,579 --> 00:09:42,410
people are very choose weak passwords

209
00:09:39,829 --> 00:09:45,319
that we can just guess and often that's

210
00:09:42,410 --> 00:09:49,160
how we get in the second thing we want

211
00:09:45,320 --> 00:09:52,480
to do of course is figure out how secure

212
00:09:49,160 --> 00:09:54,230
this application is and so we do this by

213
00:09:52,480 --> 00:09:58,010
just poking around the application

214
00:09:54,230 --> 00:10:00,500
usually normal usually if you use is use

215
00:09:58,010 --> 00:10:04,250
it the way it's designed we can start

216
00:10:00,500 --> 00:10:07,820
seeing flaws in it based on what we've

217
00:10:04,250 --> 00:10:10,010
done in the past this is where the

218
00:10:07,820 --> 00:10:11,209
prisoners are getting that job in that

219
00:10:10,010 --> 00:10:13,850
certain area they're doing the

220
00:10:11,209 --> 00:10:17,209
reconnaissance of where the guards are

221
00:10:13,850 --> 00:10:20,779
when and figuring out what the best time

222
00:10:17,209 --> 00:10:22,339
is for their escape then we want to set

223
00:10:20,779 --> 00:10:24,410
up our tap infrastructure and that's

224
00:10:22,339 --> 00:10:27,829
where we set up our command control

225
00:10:24,410 --> 00:10:31,130
channels we set up our media Metasploit

226
00:10:27,829 --> 00:10:33,130
or Empire listener of some sort and so

227
00:10:31,130 --> 00:10:36,170
we get that all set up and ready to go

228
00:10:33,130 --> 00:10:38,660
this is where of course our prisoners

229
00:10:36,170 --> 00:10:40,040
are creating their escape raft again

230
00:10:38,660 --> 00:10:42,410
they're probably not going to make that

231
00:10:40,040 --> 00:10:46,579
swim so let's create a raft so that's

232
00:10:42,410 --> 00:10:47,990
maybe we can make it and then we escape

233
00:10:46,579 --> 00:10:51,529
the application this is where we

234
00:10:47,990 --> 00:10:52,610
actually get code execution we can get

235
00:10:51,529 --> 00:10:56,029
access to the underlying operating

236
00:10:52,610 --> 00:10:59,170
system and out of that sandbox

237
00:10:56,029 --> 00:11:01,850
environment and this is where the

238
00:10:59,170 --> 00:11:02,939
prisoners have escaped and they've made

239
00:11:01,850 --> 00:11:06,300
that attempt

240
00:11:02,940 --> 00:11:09,000
and finally we profit we gain access to

241
00:11:06,300 --> 00:11:11,430
other resources other data and that's

242
00:11:09,000 --> 00:11:14,760
what we want this is where the prisoners

243
00:11:11,430 --> 00:11:17,670
get their freedom but the prisoners now

244
00:11:14,760 --> 00:11:19,830
have to do something they can't just

245
00:11:17,670 --> 00:11:21,689
live life normal they have to keep their

246
00:11:19,830 --> 00:11:24,810
I over their shoulder at all times and

247
00:11:21,690 --> 00:11:28,800
as a attacker we need to do the same

248
00:11:24,810 --> 00:11:31,319
thing I need to make sure I'm careful

249
00:11:28,800 --> 00:11:34,079
what I'm doing to cover my tracks and to

250
00:11:31,320 --> 00:11:37,050
be quiet so that way I'm not detected

251
00:11:34,080 --> 00:11:39,650
and the prisoners would be sent back to

252
00:11:37,050 --> 00:11:42,829
jail we would be kicked out and possibly

253
00:11:39,650 --> 00:11:46,430
the loopholes that we found will be

254
00:11:42,830 --> 00:11:50,580
blocked so we need to be careful there

255
00:11:46,430 --> 00:11:52,859
so we're going to get into some escapes

256
00:11:50,580 --> 00:11:54,690
then and so we're going to have some fun

257
00:11:52,860 --> 00:11:58,290
with this we're gonna start on the easy

258
00:11:54,690 --> 00:11:59,970
level if you played Wolfenstein this

259
00:11:58,290 --> 00:12:02,250
level was so easy just blow right

260
00:11:59,970 --> 00:12:05,820
through it and and so that's what we're

261
00:12:02,250 --> 00:12:08,670
going to hit here keep in mind some of

262
00:12:05,820 --> 00:12:10,410
these demos are heavily blurred and

263
00:12:08,670 --> 00:12:13,339
that's just because the data that's in

264
00:12:10,410 --> 00:12:23,310
them and to protect the systems that are

265
00:12:13,340 --> 00:12:26,850
being recorded so so this first one this

266
00:12:23,310 --> 00:12:30,750
first one is a the remote desktop web

267
00:12:26,850 --> 00:12:33,570
access we've gained access and for all

268
00:12:30,750 --> 00:12:35,130
of our attempts here we're going to

269
00:12:33,570 --> 00:12:36,330
assume that you have access we're not

270
00:12:35,130 --> 00:12:39,240
going to cover that part we're going to

271
00:12:36,330 --> 00:12:41,700
kind of go the other steps and in this

272
00:12:39,240 --> 00:12:43,530
case the application is Internet

273
00:12:41,700 --> 00:12:48,750
Explorer's is very common we see this

274
00:12:43,530 --> 00:12:51,630
all the time and it's most applications

275
00:12:48,750 --> 00:12:53,310
or most companies when they do this they

276
00:12:51,630 --> 00:12:55,920
want to be able to provide access to

277
00:12:53,310 --> 00:12:58,380
their internal resources the internal

278
00:12:55,920 --> 00:13:01,829
websites so they give access to Internet

279
00:12:58,380 --> 00:13:04,439
Explorer to do that so Internet Explorer

280
00:13:01,830 --> 00:13:06,800
is a lot like another Explorer that's in

281
00:13:04,440 --> 00:13:09,930
Windows called Windows Explorer right a

282
00:13:06,800 --> 00:13:13,380
lot of the code is similar that they do

283
00:13:09,930 --> 00:13:16,709
the same functionality I can access

284
00:13:13,380 --> 00:13:21,990
files from Internet Explorer so why not

285
00:13:16,710 --> 00:13:24,750
so I'm going to type in the path to the

286
00:13:21,990 --> 00:13:29,910
command prompt because that's one good

287
00:13:24,750 --> 00:13:31,710
place to start with for this so type it

288
00:13:29,910 --> 00:13:36,469
in we run it and we have a command

289
00:13:31,710 --> 00:13:38,940
prompt right very easy there's no

290
00:13:36,470 --> 00:13:41,700
difficulty here at all and we can run

291
00:13:38,940 --> 00:13:43,649
basic commands and so I'll run through

292
00:13:41,700 --> 00:13:46,709
you know what's the hostname of the

293
00:13:43,649 --> 00:13:51,120
Machine maybe what are what's the user

294
00:13:46,709 --> 00:13:53,310
I'm running as what our users on the

295
00:13:51,120 --> 00:13:54,959
system are in the domain we can type all

296
00:13:53,310 --> 00:13:57,479
these commands we can start running

297
00:13:54,959 --> 00:14:01,339
executable too long we can whatever we

298
00:13:57,480 --> 00:14:01,339
want to do at this point we have access

299
00:14:01,459 --> 00:14:07,770
in this case we're going to also look at

300
00:14:04,860 --> 00:14:09,870
who's the domain admins and on the

301
00:14:07,770 --> 00:14:12,149
domain we notice that da3 who's the user

302
00:14:09,870 --> 00:14:14,399
we're running at is a domain admin again

303
00:14:12,149 --> 00:14:16,709
this is easy level right this is not

304
00:14:14,399 --> 00:14:19,920
likely to happen in the real world but

305
00:14:16,709 --> 00:14:24,199
we need that tutorial kind of to get

306
00:14:19,920 --> 00:14:28,529
started to see where we can start from

307
00:14:24,200 --> 00:14:31,770
the second demo here again is pretty

308
00:14:28,529 --> 00:14:33,029
easy and same Internet Explorer but

309
00:14:31,770 --> 00:14:36,089
we're going to right click and go to

310
00:14:33,029 --> 00:14:39,600
view source we're going to save the

311
00:14:36,089 --> 00:14:41,670
source as and gives us kind of a pseudo

312
00:14:39,600 --> 00:14:45,050
Windows Explorer we can just right click

313
00:14:41,670 --> 00:14:49,529
on computer open now we have access to

314
00:14:45,050 --> 00:14:53,729
the file structure and then we'll go

315
00:14:49,529 --> 00:14:54,839
gate to see windows system32 and this

316
00:14:53,730 --> 00:14:58,350
time we're going to use Windows

317
00:14:54,839 --> 00:15:00,180
PowerShell because usually that's a lot

318
00:14:58,350 --> 00:15:02,220
easier we can do a lot more with it and

319
00:15:00,180 --> 00:15:05,099
the same kinds of commands that we had

320
00:15:02,220 --> 00:15:10,310
as before we can run our hostname and

321
00:15:05,100 --> 00:15:12,839
all that so very easy not very hard

322
00:15:10,310 --> 00:15:14,459
usually when I play a game I skip that

323
00:15:12,839 --> 00:15:18,899
easy level when I go right to the next

324
00:15:14,459 --> 00:15:21,779
level or even harder but we need to kind

325
00:15:18,899 --> 00:15:24,420
of understand how we start so that gave

326
00:15:21,779 --> 00:15:26,550
us that so we'll bump up the difficulty

327
00:15:24,420 --> 00:15:28,150
a little bit and what they don't hurt me

328
00:15:26,550 --> 00:15:33,910
and I like to think of this as

329
00:15:28,150 --> 00:15:35,560
more of a amaze and so this maze you

330
00:15:33,910 --> 00:15:37,510
know you can look at it and you probably

331
00:15:35,560 --> 00:15:39,640
can figure out what the best path is

332
00:15:37,510 --> 00:15:43,089
without even trying

333
00:15:39,640 --> 00:15:45,819
my three-year-old did this maze and you

334
00:15:43,089 --> 00:15:47,350
can see she she traced the whole way

335
00:15:45,820 --> 00:15:51,390
without getting stuck once which is

336
00:15:47,350 --> 00:15:53,800
pretty good and then she proceeded to

337
00:15:51,390 --> 00:15:57,250
correct make it more pretty

338
00:15:53,800 --> 00:16:00,699
so she colored it and now you can't

339
00:15:57,250 --> 00:16:04,350
really see the path but that's okay but

340
00:16:00,700 --> 00:16:07,420
it was even easy for her she's three so

341
00:16:04,350 --> 00:16:09,190
again there's multiple ways as well so

342
00:16:07,420 --> 00:16:13,829
maybe there's multiple ways to escape we

343
00:16:09,190 --> 00:16:18,480
got a look at so in this demo we have an

344
00:16:13,830 --> 00:16:20,890
old version of wind Microsoft Word and

345
00:16:18,480 --> 00:16:22,839
so we're going to try to open a file

346
00:16:20,890 --> 00:16:25,480
we're right-clicking things aren't

347
00:16:22,839 --> 00:16:29,230
working that way we can't right click

348
00:16:25,480 --> 00:16:30,040
and open because of the version of it so

349
00:16:29,230 --> 00:16:32,020
we're going to look at some different

350
00:16:30,040 --> 00:16:35,310
things here we don't even have a C Drive

351
00:16:32,020 --> 00:16:39,220
so we can't go with navigate the drive

352
00:16:35,310 --> 00:16:41,949
again we try using it somewhat normal

353
00:16:39,220 --> 00:16:44,529
and we poke at it we try to see where we

354
00:16:41,950 --> 00:16:46,029
can escape from and so nothing is

355
00:16:44,529 --> 00:16:49,390
working there so let's look at some

356
00:16:46,029 --> 00:16:51,550
other areas we'll look at the print

357
00:16:49,390 --> 00:16:54,850
dialog I like to use the print dialog

358
00:16:51,550 --> 00:16:57,130
because it's not usually thought of a

359
00:16:54,850 --> 00:16:59,830
good place to escape but it's easy to

360
00:16:57,130 --> 00:17:01,510
escape from from that so maybe we could

361
00:16:59,830 --> 00:17:03,490
try I tried looking for a printer in the

362
00:17:01,510 --> 00:17:05,770
directory the directory wasn't working

363
00:17:03,490 --> 00:17:07,980
had some issues there maybe look at the

364
00:17:05,770 --> 00:17:10,470
options there's nothing really there

365
00:17:07,980 --> 00:17:14,439
look at the properties of that printer

366
00:17:10,470 --> 00:17:17,380
sometimes you'll see files pass in there

367
00:17:14,439 --> 00:17:18,970
that we can mess with it's important to

368
00:17:17,380 --> 00:17:20,350
always change that printer to different

369
00:17:18,970 --> 00:17:22,720
printers because the different

370
00:17:20,349 --> 00:17:24,698
properties in this case we have a

371
00:17:22,720 --> 00:17:26,709
default folder so we can browse and look

372
00:17:24,699 --> 00:17:29,890
at it again it's an older version of

373
00:17:26,709 --> 00:17:32,620
Windows of word so it might not be as

374
00:17:29,890 --> 00:17:35,820
easy as some of the newer stuff so we're

375
00:17:32,620 --> 00:17:35,820
just going to get out of that

376
00:17:37,040 --> 00:17:41,510
so we'll try some other things maybe in

377
00:17:39,650 --> 00:17:43,820
the help menu and we notice that

378
00:17:41,510 --> 00:17:47,629
Microsoft Office online so let's click

379
00:17:43,820 --> 00:17:49,730
that and we get access to our Internet

380
00:17:47,630 --> 00:17:52,580
Explorer browser which we had fun with

381
00:17:49,730 --> 00:17:56,090
before so we're moving we're making a

382
00:17:52,580 --> 00:17:58,639
little bit more progress here we have no

383
00:17:56,090 --> 00:18:02,959
file many of those so we can't do file

384
00:17:58,640 --> 00:18:14,420
save as or open or any of that maybe we

385
00:18:02,960 --> 00:18:16,550
can try navigating to a web site here so

386
00:18:14,420 --> 00:18:20,300
we'll try going to Google nothing's

387
00:18:16,550 --> 00:18:22,909
loading they may have some kind of web

388
00:18:20,300 --> 00:18:26,919
application proxeny that's stopping us

389
00:18:22,910 --> 00:18:30,080
so or a little proxy for the web that

390
00:18:26,920 --> 00:18:32,750
doesn't allow us outbound access maybe

391
00:18:30,080 --> 00:18:34,600
we can go to the internet options and so

392
00:18:32,750 --> 00:18:37,580
going to the temporary internet files

393
00:18:34,600 --> 00:18:39,350
areas is a lot of fun too because they

394
00:18:37,580 --> 00:18:42,590
have links to where those are stored

395
00:18:39,350 --> 00:18:44,360
where those files are and so if you

396
00:18:42,590 --> 00:18:47,419
files doesn't work maybe view objects

397
00:18:44,360 --> 00:18:50,209
well and now we have access to Windows

398
00:18:47,420 --> 00:18:53,690
Explorer so we can try typing in the

399
00:18:50,210 --> 00:18:56,330
path and doing that but this is going to

400
00:18:53,690 --> 00:18:58,610
be unsuccessful they have some

401
00:18:56,330 --> 00:19:00,230
protections in place for this again this

402
00:18:58,610 --> 00:19:01,669
is that maze where we're butting up

403
00:19:00,230 --> 00:19:03,610
against dead ends okay let's move

404
00:19:01,670 --> 00:19:06,770
another way let's try something else and

405
00:19:03,610 --> 00:19:09,949
so in this we're going to create a new

406
00:19:06,770 --> 00:19:11,960
folder just as an example there was

407
00:19:09,950 --> 00:19:15,200
nothing on there but likely you'll find

408
00:19:11,960 --> 00:19:17,930
folders within my documents and stuff

409
00:19:15,200 --> 00:19:19,550
for that user and in this case when we

410
00:19:17,930 --> 00:19:21,680
double-click it it moves us to a

411
00:19:19,550 --> 00:19:23,360
different Windows Explorer Explorer too

412
00:19:21,680 --> 00:19:26,390
which is a little more powerful it's

413
00:19:23,360 --> 00:19:28,879
kind of like the power shell of Windows

414
00:19:26,390 --> 00:19:32,780
Explorer it gives us a little more and

415
00:19:28,880 --> 00:19:36,230
now we can start to play and and get

416
00:19:32,780 --> 00:19:38,750
more access here so we're going to try

417
00:19:36,230 --> 00:19:41,330
modifying the path here to just the C

418
00:19:38,750 --> 00:19:44,120
Drive which we didn't have access to

419
00:19:41,330 --> 00:19:47,000
through word remember and now we do so

420
00:19:44,120 --> 00:19:48,409
now again we'll go system32 and we're

421
00:19:47,000 --> 00:19:50,399
going to try to run the command prompt

422
00:19:48,410 --> 00:19:53,620
again

423
00:19:50,399 --> 00:19:55,389
now we get a message that software

424
00:19:53,620 --> 00:20:00,129
restriction policy is in effect and

425
00:19:55,389 --> 00:20:04,299
that's blocking so now what do we do so

426
00:20:00,129 --> 00:20:09,789
maybe we can copy this file off and move

427
00:20:04,299 --> 00:20:13,240
it to our My Documents folder so create

428
00:20:09,789 --> 00:20:16,110
a new folder just throw it in well paste

429
00:20:13,240 --> 00:20:18,909
it in there and we can now try to run it

430
00:20:16,110 --> 00:20:20,649
now this ran because the software

431
00:20:18,909 --> 00:20:23,950
restriction policy was based on the path

432
00:20:20,649 --> 00:20:26,830
but like David says maybe renaming the

433
00:20:23,950 --> 00:20:31,110
file would work here different different

434
00:20:26,830 --> 00:20:31,110
options so now we can start enumerate

435
00:20:31,379 --> 00:20:40,928
this application what was a little more

436
00:20:35,980 --> 00:20:48,519
difficult you'll notice kind of up in in

437
00:20:40,929 --> 00:20:50,710
this area there's Excel icons and so we

438
00:20:48,519 --> 00:20:52,690
as we poked around here and we're

439
00:20:50,710 --> 00:20:54,970
usually normal we we see what does it

440
00:20:52,690 --> 00:20:59,159
what are those dude so we find that it

441
00:20:54,970 --> 00:21:02,950
allows us to save the data as an Excel

442
00:20:59,159 --> 00:21:04,720
so let's save it and once we save it it

443
00:21:02,950 --> 00:21:08,559
actually opens it in Excel which gives

444
00:21:04,720 --> 00:21:10,269
us access to another application and if

445
00:21:08,559 --> 00:21:13,269
we go to the Excel options we can go to

446
00:21:10,269 --> 00:21:15,279
the the ribbon and to enable the

447
00:21:13,269 --> 00:21:18,039
Developer tab which isn't enabled by

448
00:21:15,279 --> 00:21:19,720
default but gives us a lot of control so

449
00:21:18,039 --> 00:21:22,899
now if we go to that Developer tab we

450
00:21:19,720 --> 00:21:26,559
can now run a macro which is a lot of

451
00:21:22,899 --> 00:21:32,018
fun so let's let's create a macro and in

452
00:21:26,559 --> 00:21:34,918
this case I like to use unicorn to do

453
00:21:32,019 --> 00:21:38,649
this Dave and them over it just a sec

454
00:21:34,919 --> 00:21:41,559
made this and it's great tool to to

455
00:21:38,649 --> 00:21:44,439
really easily make those the macro so

456
00:21:41,559 --> 00:21:47,799
we'll just generate a macro here we'll

457
00:21:44,440 --> 00:21:49,419
copy it will paste it in usually this is

458
00:21:47,799 --> 00:21:51,340
used in session attacks and things like

459
00:21:49,419 --> 00:21:54,009
that but hey I have control over a

460
00:21:51,340 --> 00:21:57,730
remote Excel why not try it

461
00:21:54,009 --> 00:21:59,559
so we'll paste that in but now we need

462
00:21:57,730 --> 00:22:02,870
to get our attack infrastructure set up

463
00:21:59,559 --> 00:22:04,610
and again unicorn makes it nice and easy

464
00:22:02,870 --> 00:22:07,669
by giving us an RC file that we can just

465
00:22:04,610 --> 00:22:10,370
load into through Metasploit and not

466
00:22:07,670 --> 00:22:13,250
have to type everything out so we'll

467
00:22:10,370 --> 00:22:15,290
load that in and this is going to

468
00:22:13,250 --> 00:22:18,260
establish our listener so now we're our

469
00:22:15,290 --> 00:22:20,180
attack infrastructure setup we figured

470
00:22:18,260 --> 00:22:22,520
out where we're going to attack escape

471
00:22:20,180 --> 00:22:24,020
from and so then we can once we listen

472
00:22:22,520 --> 00:22:27,620
there's up we can actually do the escape

473
00:22:24,020 --> 00:22:30,370
and we got the cows a so it's likely to

474
00:22:27,620 --> 00:22:35,229
succeed whenever you see that

475
00:22:30,370 --> 00:22:38,570
so our listeners up we'll run the macro

476
00:22:35,230 --> 00:22:40,790
we'll get an error which is in the macro

477
00:22:38,570 --> 00:22:43,399
itself so I don't care I don't care

478
00:22:40,790 --> 00:22:47,809
about saving it but then we'll switch

479
00:22:43,400 --> 00:22:50,540
back to our listener and we found out we

480
00:22:47,809 --> 00:22:51,770
have a session open so now we can

481
00:22:50,540 --> 00:22:53,420
interact with that machine we could

482
00:22:51,770 --> 00:23:01,580
pivot into the internal network we could

483
00:22:53,420 --> 00:23:04,520
do what we want at this point so again

484
00:23:01,580 --> 00:23:06,949
it's gotten a little harder it's not too

485
00:23:04,520 --> 00:23:10,400
hard though so let's let's get a little

486
00:23:06,950 --> 00:23:12,500
harder here again we've got the maze

487
00:23:10,400 --> 00:23:14,120
it's a little harder of a maze though

488
00:23:12,500 --> 00:23:17,120
you probably can't look at this and

489
00:23:14,120 --> 00:23:18,919
figure out the path like that right it

490
00:23:17,120 --> 00:23:22,850
takes a little more you have to kind of

491
00:23:18,920 --> 00:23:24,830
play with it my six-year-old son tried

492
00:23:22,850 --> 00:23:27,590
doing this you can tell that he hit a

493
00:23:24,830 --> 00:23:29,809
lot of roadblocks on the way but he was

494
00:23:27,590 --> 00:23:31,490
able to finally do it and so we may do

495
00:23:29,809 --> 00:23:35,300
the same thing we may find a lot of a

496
00:23:31,490 --> 00:23:39,140
blocks but if we keep trying we'll get

497
00:23:35,300 --> 00:23:43,090
there so we're back to our remote

498
00:23:39,140 --> 00:23:49,010
desktop here and our internet explorer

499
00:23:43,090 --> 00:23:52,790
so we'll run that this is the problem

500
00:23:49,010 --> 00:23:56,270
that I have with remote desktop is it's

501
00:23:52,790 --> 00:24:02,149
just slow so even on the local network

502
00:23:56,270 --> 00:24:05,660
that's why I never used it so we'll just

503
00:24:02,150 --> 00:24:08,360
run this this time where I is a

504
00:24:05,660 --> 00:24:10,340
different user hopefully when you're

505
00:24:08,360 --> 00:24:12,830
doing your password guessing and you're

506
00:24:10,340 --> 00:24:14,959
starting these processes you have

507
00:24:12,830 --> 00:24:16,490
multiple accounts that you can have

508
00:24:14,960 --> 00:24:19,610
compromised that you can use

509
00:24:16,490 --> 00:24:26,120
usually if one is burned you're okay you

510
00:24:19,610 --> 00:24:30,520
can move on so in this case we have the

511
00:24:26,120 --> 00:24:32,928
file menu and we're going to go open

512
00:24:30,520 --> 00:24:35,809
we're going to look around to see what

513
00:24:32,929 --> 00:24:37,570
we can do here often I'll find that a

514
00:24:35,809 --> 00:24:42,580
lot of things are locked down on it on

515
00:24:37,570 --> 00:24:48,110
the system but interactively so I go to

516
00:24:42,580 --> 00:24:53,330
the command prompt or PowerShell so

517
00:24:48,110 --> 00:24:57,949
we'll go to the command prompt here and

518
00:24:53,330 --> 00:25:00,110
I'll right-click and open and I'll find

519
00:24:57,950 --> 00:25:03,140
this message but it's been disabled by

520
00:25:00,110 --> 00:25:05,479
the administrator happens a lot so I

521
00:25:03,140 --> 00:25:09,800
can't interactively use this command

522
00:25:05,480 --> 00:25:12,320
prompt now I could try moving it I could

523
00:25:09,800 --> 00:25:14,720
try renaming it in those cases maybe it

524
00:25:12,320 --> 00:25:19,370
all fails but let's let's try some other

525
00:25:14,720 --> 00:25:21,080
things and so we'll do all file and

526
00:25:19,370 --> 00:25:23,270
we're going to actually create a file

527
00:25:21,080 --> 00:25:25,399
sometimes you could download a file if

528
00:25:23,270 --> 00:25:28,370
you have access to your own servers but

529
00:25:25,400 --> 00:25:30,200
in this case I'll just create one we're

530
00:25:28,370 --> 00:25:32,780
going to just give it a generic name

531
00:25:30,200 --> 00:25:34,490
whatever PowerShell and I'm going to

532
00:25:32,780 --> 00:25:38,770
open that now I have notepad so now I

533
00:25:34,490 --> 00:25:41,510
have a little bit more access here and

534
00:25:38,770 --> 00:25:46,460
so we're just going to try calling the

535
00:25:41,510 --> 00:25:48,590
command prompt from it and I like to

536
00:25:46,460 --> 00:25:51,860
throw in the pause in there when you do

537
00:25:48,590 --> 00:25:54,919
not interactive because just in case it

538
00:25:51,860 --> 00:25:58,250
just closes you can pause it and see

539
00:25:54,920 --> 00:26:02,240
what's on the screen in this case I

540
00:25:58,250 --> 00:26:04,940
can't go to the properties to rename it

541
00:26:02,240 --> 00:26:08,390
so I'm gonna have to reopen it and save

542
00:26:04,940 --> 00:26:11,570
as so I have a batch file this could be

543
00:26:08,390 --> 00:26:13,580
done with VB script - or any other

544
00:26:11,570 --> 00:26:19,659
scripting language that you might want

545
00:26:13,580 --> 00:26:19,659
to use we'll give it the bat extension

546
00:26:25,960 --> 00:26:32,320
and then we'll try right clicking open

547
00:26:28,899 --> 00:26:35,469
and we'll see what happens and we see

548
00:26:32,320 --> 00:26:37,418
we've hit another dead end here we can't

549
00:26:35,470 --> 00:26:38,980
do that it's not allowing us it's been

550
00:26:37,419 --> 00:26:41,100
blocked by the administrator so let's

551
00:26:38,980 --> 00:26:43,869
let's change this let's use PowerShell

552
00:26:41,100 --> 00:26:45,998
instead often when you see command

553
00:26:43,869 --> 00:26:53,049
prompted block power self not so let's

554
00:26:45,999 --> 00:26:56,590
try it so again we're going to

555
00:26:53,049 --> 00:26:59,499
right-click and open and this time we

556
00:26:56,590 --> 00:27:02,439
have PowerShell but it was PowerShell

557
00:26:59,499 --> 00:27:05,619
through a back script which uses command

558
00:27:02,440 --> 00:27:08,529
prompt so we have some kind of execution

559
00:27:05,619 --> 00:27:10,029
there so even if you don't have access

560
00:27:08,529 --> 00:27:12,249
to PowerShell you can't run those things

561
00:27:10,029 --> 00:27:15,789
and nothing interactive is happening for

562
00:27:12,249 --> 00:27:17,350
you you can at least run command so I do

563
00:27:15,789 --> 00:27:18,999
this often when when I'm trying to

564
00:27:17,350 --> 00:27:21,490
enumerate the system and figure out

565
00:27:18,999 --> 00:27:23,559
users and from the domain and everything

566
00:27:21,490 --> 00:27:25,779
else I could run it throw that pause in

567
00:27:23,559 --> 00:27:33,850
there and now I have the data I want and

568
00:27:25,779 --> 00:27:37,629
just go from there so let's move to the

569
00:27:33,850 --> 00:27:40,899
hard level I like to think of this as

570
00:27:37,629 --> 00:27:43,799
this kind of mace right now we have the

571
00:27:40,899 --> 00:27:46,418
Minotaur in there we have fire we have

572
00:27:43,799 --> 00:27:48,580
maybe the walls are changing on us as

573
00:27:46,419 --> 00:27:52,600
we're walking through this labyrinth so

574
00:27:48,580 --> 00:27:54,999
it's it's actually extremely hard when I

575
00:27:52,600 --> 00:27:58,379
played Wolfenstein I stayed away from

576
00:27:54,999 --> 00:28:00,700
these levels is I just got killed

577
00:27:58,379 --> 00:28:02,740
so again we have another app and this

578
00:28:00,700 --> 00:28:05,110
time we're going to hit the shift key

579
00:28:02,740 --> 00:28:06,879
five times to get our sticky key prompt

580
00:28:05,110 --> 00:28:08,769
and even if we don't get that command

581
00:28:06,879 --> 00:28:11,498
prompt we didn't still do things and we

582
00:28:08,769 --> 00:28:15,340
can open up the preferences for the

583
00:28:11,499 --> 00:28:18,850
sticky keys and that gives us control

584
00:28:15,340 --> 00:28:21,999
panel windows explorer so let's try some

585
00:28:18,850 --> 00:28:23,860
things let's try running these files and

586
00:28:21,999 --> 00:28:25,749
we're trying PowerShell we're trying

587
00:28:23,860 --> 00:28:28,570
PowerShell ISE we're trying command

588
00:28:25,749 --> 00:28:31,179
prompt and these things are all failing

589
00:28:28,570 --> 00:28:33,100
on us and so you're going to hit this

590
00:28:31,179 --> 00:28:37,940
you're going to these systems are more

591
00:28:33,100 --> 00:28:42,260
locked out so maybe we can

592
00:28:37,940 --> 00:28:45,310
try running an actual command through

593
00:28:42,260 --> 00:28:47,690
command prompt it's not working either

594
00:28:45,310 --> 00:28:49,730
try open your notepad or something

595
00:28:47,690 --> 00:28:53,870
nuttin things are just not working for

596
00:28:49,730 --> 00:28:57,770
us so we'll see we're blocked at all

597
00:28:53,870 --> 00:29:00,850
these different places and so I can't

598
00:28:57,770 --> 00:29:06,080
even right-click they've disabled that

599
00:29:00,850 --> 00:29:09,020
so sometimes we can go to the settings

600
00:29:06,080 --> 00:29:11,419
and get a internet explorer window which

601
00:29:09,020 --> 00:29:14,389
is back to where we like to escape from

602
00:29:11,420 --> 00:29:18,350
it's a good place to escape from so we

603
00:29:14,390 --> 00:29:20,780
have no file menu this time we can get

604
00:29:18,350 --> 00:29:23,570
to the internet so I can get to a server

605
00:29:20,780 --> 00:29:25,070
that I control I have a batch file

606
00:29:23,570 --> 00:29:28,280
waiting for me I want to download that

607
00:29:25,070 --> 00:29:30,379
but it's not letting me so maybe I can

608
00:29:28,280 --> 00:29:33,680
go to the internet options and allow it

609
00:29:30,380 --> 00:29:37,730
but they blocked that too so again we're

610
00:29:33,680 --> 00:29:40,580
a lot harder here no file menu I can't

611
00:29:37,730 --> 00:29:43,220
right click and save as to do this or

612
00:29:40,580 --> 00:29:44,929
view source and or any of that stuff so

613
00:29:43,220 --> 00:29:47,270
that's not the best way so let's break

614
00:29:44,930 --> 00:29:48,980
out of here go back to the application

615
00:29:47,270 --> 00:29:51,230
remember it we want to use this as

616
00:29:48,980 --> 00:29:53,210
normal so let's see what we can do so we

617
00:29:51,230 --> 00:29:56,390
start clicking around and we find export

618
00:29:53,210 --> 00:29:59,960
to excel and so we'll see what happened

619
00:29:56,390 --> 00:30:02,900
well we get an Excel document right in

620
00:29:59,960 --> 00:30:03,110
this case that Excel options were locked

621
00:30:02,900 --> 00:30:06,020
down

622
00:30:03,110 --> 00:30:11,990
I couldn't enable that Developer tab but

623
00:30:06,020 --> 00:30:14,480
why not use the cell to put in macros

624
00:30:11,990 --> 00:30:17,480
that we want or other commands we want

625
00:30:14,480 --> 00:30:23,120
so here I'm going to try with PowerShell

626
00:30:17,480 --> 00:30:26,770
and I missed the quote so we'll run that

627
00:30:23,120 --> 00:30:29,600
it yes let's run it and nothing happens

628
00:30:26,770 --> 00:30:32,720
ok so let's try with our command prompt

629
00:30:29,600 --> 00:30:33,530
this is likely to fail as well and

630
00:30:32,720 --> 00:30:38,300
that's ok

631
00:30:33,530 --> 00:30:41,300
it happens run that nothing happens as

632
00:30:38,300 --> 00:30:43,909
well but when PowerShell is blocked a

633
00:30:41,300 --> 00:30:46,159
lot of times Power Cells interactive

634
00:30:43,910 --> 00:30:51,389
scripting environments not and so we'll

635
00:30:46,160 --> 00:30:54,269
run PowerShell ISE and run that and Loan

636
00:30:51,389 --> 00:30:57,779
hold we now powershell interactive

637
00:30:54,269 --> 00:30:59,940
scripting environment which is great now

638
00:30:57,779 --> 00:31:02,129
I can do whatever I want from that load

639
00:30:59,940 --> 00:31:04,829
load in my own custom modules run

640
00:31:02,129 --> 00:31:07,349
commands everything autocompletes for me

641
00:31:04,829 --> 00:31:10,529
so it's nice and easy so here i'm going

642
00:31:07,349 --> 00:31:13,589
to dump all the users in the domain so

643
00:31:10,529 --> 00:31:15,649
then i can use those in other attacks if

644
00:31:13,589 --> 00:31:20,219
i wanted to i could use in a corner or

645
00:31:15,649 --> 00:31:22,168
another empire or something to get a

646
00:31:20,219 --> 00:31:27,239
shell if i wanted whatever you want to

647
00:31:22,169 --> 00:31:33,769
do at this point and then for our last

648
00:31:27,239 --> 00:31:33,769
demo this one is extremely tough

649
00:31:41,730 --> 00:31:48,260
I don't know why that's not let's just

650
00:31:45,480 --> 00:31:48,260
open it up here

651
00:32:11,929 --> 00:32:16,240
ah

652
00:32:13,930 --> 00:32:18,340
so the export didn't work on that one

653
00:32:16,240 --> 00:32:25,930
for some reason so we'll just skip that

654
00:32:18,340 --> 00:32:28,540
one in that one sometimes you'll get a

655
00:32:25,930 --> 00:32:31,090
system that you can't get command

656
00:32:28,540 --> 00:32:34,090
execution you can't get anything to load

657
00:32:31,090 --> 00:32:39,419
but what can you do with it and in in

658
00:32:34,090 --> 00:32:43,929
that example that was not playing I

659
00:32:39,420 --> 00:32:46,570
could steal data right I can I was able

660
00:32:43,930 --> 00:32:48,670
to finally get to be using the printer

661
00:32:46,570 --> 00:32:51,310
menu I was able to escape out and get

662
00:32:48,670 --> 00:32:54,490
access to the file system and I could

663
00:32:51,310 --> 00:32:58,090
mount my drives on that system so now

664
00:32:54,490 --> 00:33:00,460
when I do that I can then start moving

665
00:32:58,090 --> 00:33:03,310
data back and forth between them and I

666
00:33:00,460 --> 00:33:06,700
was able to steal all their data which

667
00:33:03,310 --> 00:33:09,460
is great especially their custom

668
00:33:06,700 --> 00:33:12,970
proprietary software which then I can

669
00:33:09,460 --> 00:33:15,970
pull off decompile find you know

670
00:33:12,970 --> 00:33:20,110
different flaws in and then without even

671
00:33:15,970 --> 00:33:23,320
trying then exploit their system a

672
00:33:20,110 --> 00:33:27,219
different way their proprietary software

673
00:33:23,320 --> 00:33:30,220
so so what can we do we need to be able

674
00:33:27,220 --> 00:33:33,370
to mitigate things and and I don't like

675
00:33:30,220 --> 00:33:36,490
to just show hey this is how we own

676
00:33:33,370 --> 00:33:39,250
things we want to be able to also

677
00:33:36,490 --> 00:33:40,630
mitigate these things so first thing we

678
00:33:39,250 --> 00:33:43,120
want to do is of course those login

679
00:33:40,630 --> 00:33:45,010
portals if I can stop me from logging in

680
00:33:43,120 --> 00:33:47,379
that's going to go a long way so use

681
00:33:45,010 --> 00:33:49,330
multi-factor authentication train your

682
00:33:47,380 --> 00:33:51,130
users to use those strong passphrase is

683
00:33:49,330 --> 00:33:52,570
going to make my job a lot harder and

684
00:33:51,130 --> 00:33:54,940
it's going to make it harder for me to

685
00:33:52,570 --> 00:33:58,629
get through you want to secure your

686
00:33:54,940 --> 00:34:01,420
operating systems these issues you saw

687
00:33:58,630 --> 00:34:04,300
are not issues with vmware they're not

688
00:34:01,420 --> 00:34:05,980
issues with citrix or remote desktop

689
00:34:04,300 --> 00:34:08,380
there are issues at the operating system

690
00:34:05,980 --> 00:34:10,060
level we have to secure our operating

691
00:34:08,380 --> 00:34:12,610
system in our applications that are on

692
00:34:10,060 --> 00:34:14,949
those so prevent access to your command

693
00:34:12,610 --> 00:34:17,800
prompt your powershell PowerShell ISE a

694
00:34:14,949 --> 00:34:20,319
lot of these different things that Dave

695
00:34:17,800 --> 00:34:24,280
had talked about as well restrict the

696
00:34:20,320 --> 00:34:27,350
use of those macros I shouldn't have to

697
00:34:24,280 --> 00:34:28,670
be able to just load any macro I want

698
00:34:27,350 --> 00:34:31,639
you should be able to limit that and

699
00:34:28,670 --> 00:34:34,159
restrictive the internet access really I

700
00:34:31,639 --> 00:34:35,569
mean why should I connect to my company

701
00:34:34,159 --> 00:34:38,899
and then get out to the internet through

702
00:34:35,570 --> 00:34:41,300
Citrix the purpose of that should be to

703
00:34:38,900 --> 00:34:48,110
access internal websites so limit that

704
00:34:41,300 --> 00:34:50,930
access and then monitor everything you

705
00:34:48,110 --> 00:34:53,360
you have to be able to know where this

706
00:34:50,929 --> 00:34:55,850
is happening I've been hit I hit a lot

707
00:34:53,360 --> 00:34:56,960
of walls while I was trying things you

708
00:34:55,850 --> 00:35:01,549
should be able to see that when you're

709
00:34:56,960 --> 00:35:04,160
monitoring so in conclusion you know

710
00:35:01,550 --> 00:35:05,630
securing your systems it's not a game we

711
00:35:04,160 --> 00:35:08,690
had some fun with the Wolfenstein and

712
00:35:05,630 --> 00:35:10,970
the mazes and all that stuff but it's

713
00:35:08,690 --> 00:35:13,250
hard work and so we have to be diligent

714
00:35:10,970 --> 00:35:16,879
and do that using multi-factor

715
00:35:13,250 --> 00:35:19,070
authentication again it's your friend

716
00:35:16,880 --> 00:35:22,340
lock down those shared systems no matter

717
00:35:19,070 --> 00:35:24,670
what architectures you select and of

718
00:35:22,340 --> 00:35:28,220
course it can't catch what you don't see

719
00:35:24,670 --> 00:35:31,430
escaping is a lot of fun it for me it's

720
00:35:28,220 --> 00:35:33,259
it's one of my favorite things to do is

721
00:35:31,430 --> 00:35:35,629
get access to these systems and then

722
00:35:33,260 --> 00:35:39,410
escape them in some sort so it's a lot

723
00:35:35,630 --> 00:35:42,350
of fun as well and so that's it thank

724
00:35:39,410 --> 00:35:44,270
you and so my contact information some

725
00:35:42,350 --> 00:35:46,190
of the tools I've written and stuff if

726
00:35:44,270 --> 00:35:49,460
you want to if anybody has questions of

727
00:35:46,190 --> 00:35:57,829
course would be great so thank you

728
00:35:49,460 --> 00:35:57,829
[Applause]

729
00:36:23,870 --> 00:36:28,759
who have I been stopped by a

730
00:36:26,180 --> 00:36:34,069
general-purpose kiosk where multiple

731
00:36:28,760 --> 00:36:36,950
applications are available I don't see

732
00:36:34,070 --> 00:36:38,660
those a lot personally when I'm when I'm

733
00:36:36,950 --> 00:36:41,240
doing testing a lot of it most of it is

734
00:36:38,660 --> 00:36:43,399
all through the virtual application so

735
00:36:41,240 --> 00:36:46,129
you're Citrix or VMware you're that kind

736
00:36:43,400 --> 00:36:48,800
of thing but what I'm saying here is

737
00:36:46,130 --> 00:36:53,600
just the same things can apply to those

738
00:36:48,800 --> 00:36:55,460
systems as well yeah I again those

739
00:36:53,600 --> 00:36:57,290
locking down those those management

740
00:36:55,460 --> 00:36:59,090
tools is probably the biggest thing

741
00:36:57,290 --> 00:37:03,160
there and monitoring those those systems

742
00:36:59,090 --> 00:37:03,160
would be the biggest help

743
00:37:15,220 --> 00:37:27,180
I have not no

