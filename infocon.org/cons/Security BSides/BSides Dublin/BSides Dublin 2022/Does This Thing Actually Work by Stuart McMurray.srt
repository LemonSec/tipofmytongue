1
00:00:03,600 --> 00:00:05,759
okay we're live hi everybody

2
00:00:05,759 --> 00:00:06,960
i am

3
00:00:06,960 --> 00:00:09,440
this guy stuart mcmurray i am a lead

4
00:00:09,440 --> 00:00:10,480
engineer

5
00:00:10,480 --> 00:00:12,320
on klarna the payment company's

6
00:00:12,320 --> 00:00:14,480
ever-growing security offensive security

7
00:00:14,480 --> 00:00:15,280
team

8
00:00:15,280 --> 00:00:16,560
contesting red teaming that kind of

9
00:00:16,560 --> 00:00:17,600
things

10
00:00:17,600 --> 00:00:19,680
also just a gold fashion

11
00:00:19,680 --> 00:00:22,720
neckbeard unix nerd um these slides

12
00:00:22,720 --> 00:00:24,480
should be tweeted now onto twitter so

13
00:00:24,480 --> 00:00:25,920
feel free to grab twitter if you want

14
00:00:25,920 --> 00:00:28,240
copy the slides

15
00:00:28,240 --> 00:00:30,240
also welcome worth mentioning that i'm

16
00:00:30,240 --> 00:00:31,760
not affiliated with any company

17
00:00:31,760 --> 00:00:33,600
organization or cartel or

18
00:00:33,600 --> 00:00:34,719
anything of the sort which does

19
00:00:34,719 --> 00:00:36,079
defensive type things that we'll be

20
00:00:36,079 --> 00:00:38,399
talking about so this is my own my own

21
00:00:38,399 --> 00:00:40,640
opinions um and even more so it's not

22
00:00:40,640 --> 00:00:42,719
the opinions necessarily of my employer

23
00:00:42,719 --> 00:00:45,360
past present future

24
00:00:45,360 --> 00:00:47,600
and so on um also

25
00:00:47,600 --> 00:00:49,520
typical disclaimer please like don't

26
00:00:49,520 --> 00:00:52,399
hack things if you're not allowed to

27
00:00:52,399 --> 00:00:54,160
um if you do my name is george

28
00:00:54,160 --> 00:00:55,440
washington keep that in mind when

29
00:00:55,440 --> 00:00:57,199
somebody asks

30
00:00:57,199 --> 00:01:00,000
so back to the talk um quick deal they

31
00:01:00,000 --> 00:01:01,760
are of the talk uh

32
00:01:01,760 --> 00:01:03,199
we have this problem that we don't

33
00:01:03,199 --> 00:01:05,680
really know if defensive tools work

34
00:01:05,680 --> 00:01:07,520
until the tools are tested

35
00:01:07,520 --> 00:01:08,880
um

36
00:01:08,880 --> 00:01:10,320
point number two is you have to figure

37
00:01:10,320 --> 00:01:12,880
out how like who knows um vendors are

38
00:01:12,880 --> 00:01:15,200
probably not the best to ask and in fact

39
00:01:15,200 --> 00:01:16,240
in my opinion they're like the worst

40
00:01:16,240 --> 00:01:17,439
people to ask is i don't know they're

41
00:01:17,439 --> 00:01:19,280
selling something um and and the whole

42
00:01:19,280 --> 00:01:20,400
thesis behind the talk is the best

43
00:01:20,400 --> 00:01:22,560
people to ask for the blue teamers to to

44
00:01:22,560 --> 00:01:24,560
figure out if their tools are working um

45
00:01:24,560 --> 00:01:25,920
and point three it's you know doing the

46
00:01:25,920 --> 00:01:27,360
testing itself is actually quite fun and

47
00:01:27,360 --> 00:01:28,799
it's pretty easy and it's an enjoyable

48
00:01:28,799 --> 00:01:29,680
thing to do and that's sort of what

49
00:01:29,680 --> 00:01:31,600
we'll be talking about

50
00:01:31,600 --> 00:01:34,320
so over the next 40 odd minutes um we'll

51
00:01:34,320 --> 00:01:35,439
go we'll talk about sort of the idea

52
00:01:35,439 --> 00:01:37,680
behind this talk uh and then

53
00:01:37,680 --> 00:01:38,880
it's a little weird to say yeah blue

54
00:01:38,880 --> 00:01:40,640
teamers should doing security testing

55
00:01:40,640 --> 00:01:41,600
it's kind of like the opposite to what

56
00:01:41,600 --> 00:01:42,960
they normally do

57
00:01:42,960 --> 00:01:45,040
then we'll look at sort of my red ish

58
00:01:45,040 --> 00:01:46,880
approach to a blue

59
00:01:46,880 --> 00:01:48,079
problem

60
00:01:48,079 --> 00:01:49,360
and how to test things and we'll take a

61
00:01:49,360 --> 00:01:50,799
quick case study

62
00:01:50,799 --> 00:01:52,880
that i was originally going to like use

63
00:01:52,880 --> 00:01:54,479
a tool i've

64
00:01:54,479 --> 00:01:56,640
gone against so to speak uh we won't do

65
00:01:56,640 --> 00:01:59,360
that because that wouldn't be very nice

66
00:01:59,360 --> 00:02:00,640
so the idea behind the talk is we have

67
00:02:00,640 --> 00:02:02,479
this problem um every every large

68
00:02:02,479 --> 00:02:03,840
organization with the network needs some

69
00:02:03,840 --> 00:02:05,119
sort of security tooling in place we

70
00:02:05,119 --> 00:02:06,960
need the ability to find bad guys stock

71
00:02:06,960 --> 00:02:09,360
bad guys make reactions so on and so

72
00:02:09,360 --> 00:02:10,160
forth

73
00:02:10,160 --> 00:02:11,120
we have to figure out though if they

74
00:02:11,120 --> 00:02:12,800
actually work and it turns out a lot of

75
00:02:12,800 --> 00:02:14,560
blue teams that i've talked to don't

76
00:02:14,560 --> 00:02:15,760
really know they're like yeah we know

77
00:02:15,760 --> 00:02:18,080
what it should do we know it has done we

78
00:02:18,080 --> 00:02:19,760
don't know if in the future it will keep

79
00:02:19,760 --> 00:02:21,680
doing um also these tools are

80
00:02:21,680 --> 00:02:24,319
ridiculously expensive so like

81
00:02:24,319 --> 00:02:26,319
um back before i moved over this way of

82
00:02:26,319 --> 00:02:28,640
course the us had a car and it would not

83
00:02:28,640 --> 00:02:30,239
occur to me to make like a massive

84
00:02:30,239 --> 00:02:32,160
purchase that's like multiple times my

85
00:02:32,160 --> 00:02:33,120
income

86
00:02:33,120 --> 00:02:35,680
uh without test driving and i i feel the

87
00:02:35,680 --> 00:02:37,040
same way about security tools like you

88
00:02:37,040 --> 00:02:39,200
know multi-million dollars or euros of

89
00:02:39,200 --> 00:02:41,120
tooling um you probably should test it

90
00:02:41,120 --> 00:02:43,360
before you buy it there is a counter

91
00:02:43,360 --> 00:02:44,640
argument to that

92
00:02:44,640 --> 00:02:47,120
and that is that it's somebody else's

93
00:02:47,120 --> 00:02:48,800
budget really like you know it shouldn't

94
00:02:48,800 --> 00:02:50,640
be on the budget of the organization

95
00:02:50,640 --> 00:02:52,080
buying the thing to figure out if the

96
00:02:52,080 --> 00:02:54,400
thing works like do dev work basically

97
00:02:54,400 --> 00:02:55,920
for the vendor

98
00:02:55,920 --> 00:02:57,440
so here's the solution

99
00:02:57,440 --> 00:02:59,440
let's just see if this thing that we may

100
00:02:59,440 --> 00:03:01,040
be hoping to buy or may have bought

101
00:03:01,040 --> 00:03:02,400
already is actually worth the money

102
00:03:02,400 --> 00:03:04,080
we'll just dig in and find out if it

103
00:03:04,080 --> 00:03:05,120
works

104
00:03:05,120 --> 00:03:06,480
um

105
00:03:06,480 --> 00:03:08,319
in the interest of a 40-minute talk

106
00:03:08,319 --> 00:03:10,480
scope it down though um so when i talk

107
00:03:10,480 --> 00:03:12,080
about a thing a defensive tool i really

108
00:03:12,080 --> 00:03:13,519
am talking about like a single defensive

109
00:03:13,519 --> 00:03:15,920
thing i'm talking about an edr

110
00:03:15,920 --> 00:03:17,840
box appliance agent what have you a

111
00:03:17,840 --> 00:03:19,360
network traffic analysis thing a

112
00:03:19,360 --> 00:03:21,599
firewall thing maybe even like a dns

113
00:03:21,599 --> 00:03:22,720
server that's configured to be

114
00:03:22,720 --> 00:03:25,120
particularly hacker unfriendly

115
00:03:25,120 --> 00:03:27,760
um the same principles apply to what you

116
00:03:27,760 --> 00:03:28,959
know in the modern world you get oh it's

117
00:03:28,959 --> 00:03:30,640
a cyber analytics a defense platform is

118
00:03:30,640 --> 00:03:32,720
using ai and ml and threat intelligence

119
00:03:32,720 --> 00:03:34,239
and all that stuff it's same thing

120
00:03:34,239 --> 00:03:35,200
applies

121
00:03:35,200 --> 00:03:37,280
um tweaked a little of course and and

122
00:03:37,280 --> 00:03:39,200
every so often you'll find yourself or

123
00:03:39,200 --> 00:03:41,440
find a situation where it's not just

124
00:03:41,440 --> 00:03:42,799
like hey i'm testing a thing it's like

125
00:03:42,799 --> 00:03:45,440
hey we've hired this this other team to

126
00:03:45,440 --> 00:03:46,640
you know defend a part of the network

127
00:03:46,640 --> 00:03:48,480
sort of an mssp type thing

128
00:03:48,480 --> 00:03:51,360
it works more or less the same um

129
00:03:51,360 --> 00:03:52,400
with some

130
00:03:52,400 --> 00:03:54,640
minor adjustments and and we're going to

131
00:03:54,640 --> 00:03:56,239
again scope it down to one question to

132
00:03:56,239 --> 00:03:58,560
answer and the question is does it work

133
00:03:58,560 --> 00:04:00,159
which in real life something turns

134
00:04:00,159 --> 00:04:01,599
sometimes turns into like okay does it

135
00:04:01,599 --> 00:04:03,760
just work enough um which actually

136
00:04:03,760 --> 00:04:05,680
realize in real life often turns into

137
00:04:05,680 --> 00:04:07,840
like okay does this thing do anything

138
00:04:07,840 --> 00:04:09,760
um and then sort of as a side quest we

139
00:04:09,760 --> 00:04:11,840
like to also answer and just how hard is

140
00:04:11,840 --> 00:04:13,360
it to get past it i mean like you know

141
00:04:13,360 --> 00:04:14,879
most most of these tools are not uh

142
00:04:14,879 --> 00:04:17,199
particularly impossible to bypass so

143
00:04:17,199 --> 00:04:18,320
that's that and that's that's just a fun

144
00:04:18,320 --> 00:04:20,560
bit anyways so it's like

145
00:04:20,560 --> 00:04:21,759
kind of your reward for doing all the

146
00:04:21,759 --> 00:04:23,520
work um and then the question is when

147
00:04:23,520 --> 00:04:24,479
you would do this and hopefully you're

148
00:04:24,479 --> 00:04:25,919
doing this pre-purchase hopefully you

149
00:04:25,919 --> 00:04:27,840
know somebody is like hey we need a new

150
00:04:27,840 --> 00:04:29,759
edr product for whatever reason

151
00:04:29,759 --> 00:04:31,440
um let's let's

152
00:04:31,440 --> 00:04:32,960
get a bunch of trials and test them and

153
00:04:32,960 --> 00:04:34,240
see what happens i've done that it's

154
00:04:34,240 --> 00:04:35,759
it's enjoyable for sure and it's it's

155
00:04:35,759 --> 00:04:37,280
really helpful to see like hey the

156
00:04:37,280 --> 00:04:39,120
vendor you know we're being exactly

157
00:04:39,120 --> 00:04:41,040
forthcoming for this one and this one

158
00:04:41,040 --> 00:04:43,280
works better um probably more often it's

159
00:04:43,280 --> 00:04:44,800
post purchase it's like hey we have this

160
00:04:44,800 --> 00:04:46,720
tool maybe you hired a red team or maybe

161
00:04:46,720 --> 00:04:48,639
you set up a new red team or whatever

162
00:04:48,639 --> 00:04:50,479
and you can see like oh

163
00:04:50,479 --> 00:04:52,080
you know just doesn't actually do what

164
00:04:52,080 --> 00:04:54,639
it says um and and i say red team it's

165
00:04:54,639 --> 00:04:55,680
actually probably better for the blue

166
00:04:55,680 --> 00:04:56,479
teams

167
00:04:56,479 --> 00:04:57,759
um the other time i've seen it is post

168
00:04:57,759 --> 00:04:59,840
compromise like bad thing happened bad

169
00:04:59,840 --> 00:05:01,199
thing was done to the company really it

170
00:05:01,199 --> 00:05:02,960
doesn't just happen and the company's

171
00:05:02,960 --> 00:05:05,039
like all right we missed that one

172
00:05:05,039 --> 00:05:06,479
what else are we going to miss or what

173
00:05:06,479 --> 00:05:08,800
else can we catch at least to know where

174
00:05:08,800 --> 00:05:11,360
to fix things a bit better

175
00:05:11,360 --> 00:05:12,800
which gets us then to the who's going to

176
00:05:12,800 --> 00:05:14,479
do it um

177
00:05:14,479 --> 00:05:15,759
the thesis behind this whole talk is

178
00:05:15,759 --> 00:05:17,039
that i think the blue teamers are the

179
00:05:17,039 --> 00:05:18,960
best not just like because i have other

180
00:05:18,960 --> 00:05:20,240
things i want to do but blue teamers in

181
00:05:20,240 --> 00:05:21,840
general are the best suited to do this

182
00:05:21,840 --> 00:05:22,960
testing

183
00:05:22,960 --> 00:05:25,039
um start from the other end like who is

184
00:05:25,039 --> 00:05:26,639
not good

185
00:05:26,639 --> 00:05:29,440
managers stock managers sizzos that kind

186
00:05:29,440 --> 00:05:30,960
some of them are awesome um i have to

187
00:05:30,960 --> 00:05:33,360
work for one some of them

188
00:05:33,360 --> 00:05:34,960
you know they have different priorities

189
00:05:34,960 --> 00:05:36,639
they're more concerned with kpis closing

190
00:05:36,639 --> 00:05:38,880
tickets what not uh sometimes they're a

191
00:05:38,880 --> 00:05:40,320
little less technical than would be

192
00:05:40,320 --> 00:05:42,000
expedient to know exactly how their

193
00:05:42,000 --> 00:05:44,320
tools they're meant to have work

194
00:05:44,320 --> 00:05:45,360
um

195
00:05:45,360 --> 00:05:46,639
the other obvious answer is usually the

196
00:05:46,639 --> 00:05:48,160
red team the fantaster so on and so

197
00:05:48,160 --> 00:05:50,639
forth uh quick pull of the audience

198
00:05:50,639 --> 00:05:53,600
who's on the blue side of things

199
00:05:53,600 --> 00:05:54,720
so about

200
00:05:54,720 --> 00:05:56,479
a third maybe how many blue tumors

201
00:05:56,479 --> 00:05:58,080
cringed when i was like hey yeah we'll

202
00:05:58,080 --> 00:05:59,280
just get the red teamers to test the

203
00:05:59,280 --> 00:06:01,599
tools

204
00:06:01,680 --> 00:06:04,800
one one is honest in the crowd all right

205
00:06:04,800 --> 00:06:06,720
so um

206
00:06:06,720 --> 00:06:07,919
we have one person who's honest anyways

207
00:06:07,919 --> 00:06:09,680
but yeah um that having been said ask us

208
00:06:09,680 --> 00:06:11,840
for planning ask us for like you know

209
00:06:11,840 --> 00:06:13,520
hey how else could you get through this

210
00:06:13,520 --> 00:06:15,120
how else could you would you attack this

211
00:06:15,120 --> 00:06:16,479
what you know what other tricks you have

212
00:06:16,479 --> 00:06:18,560
up your sleeve um besides we also don't

213
00:06:18,560 --> 00:06:20,800
really always know the entire defensive

214
00:06:20,800 --> 00:06:22,639
scope of the company or the organization

215
00:06:22,639 --> 00:06:24,479
as it turns as it may be

216
00:06:24,479 --> 00:06:25,520
um

217
00:06:25,520 --> 00:06:27,600
and then then the other you know and

218
00:06:27,600 --> 00:06:29,600
actually probably the most often asked

219
00:06:29,600 --> 00:06:31,360
if the thing works is whoever's selling

220
00:06:31,360 --> 00:06:32,080
it

221
00:06:32,080 --> 00:06:33,520
you're like oh can you map this to

222
00:06:33,520 --> 00:06:35,520
whatever framework or matrix or whatnot

223
00:06:35,520 --> 00:06:37,280
and they'll have a nice list for you of

224
00:06:37,280 --> 00:06:39,440
test cases they've done and um there's

225
00:06:39,440 --> 00:06:41,039
the benefit that it's free hopefully uh

226
00:06:41,039 --> 00:06:42,560
it should be anyways there's the

227
00:06:42,560 --> 00:06:45,280
downside that um

228
00:06:45,280 --> 00:06:46,400
you know i have cat pictures and that's

229
00:06:46,400 --> 00:06:49,840
a cool cat picture

230
00:06:50,160 --> 00:06:53,199
so that that's who you wouldn't ask um

231
00:06:53,199 --> 00:06:55,039
who you would ask or the blue team

232
00:06:55,039 --> 00:06:58,080
uh ask them because they they know

233
00:06:58,080 --> 00:06:59,840
all that or hopefully know anyways all

234
00:06:59,840 --> 00:07:01,680
the defenses that are there they know

235
00:07:01,680 --> 00:07:03,520
probably the gaps i

236
00:07:03,520 --> 00:07:05,360
i used to work with a fellow who went

237
00:07:05,360 --> 00:07:07,360
from blue to red and um actually it's

238
00:07:07,360 --> 00:07:08,639
running the red team i think the

239
00:07:08,639 --> 00:07:11,199
organization i was at now and um we hit

240
00:07:11,199 --> 00:07:12,319
this amazing thing you would just rock

241
00:07:12,319 --> 00:07:13,520
into a company we were working with and

242
00:07:13,520 --> 00:07:14,560
you just go to their sock and be like

243
00:07:14,560 --> 00:07:15,759
hey it was a sock analyst how do i hack

244
00:07:15,759 --> 00:07:16,639
you

245
00:07:16,639 --> 00:07:18,400
and they'd be like oh dude all you gotta

246
00:07:18,400 --> 00:07:20,240
do is like use this creds there and jump

247
00:07:20,240 --> 00:07:21,919
to the system so yeah the blue team

248
00:07:21,919 --> 00:07:23,759
knows um and they'll know

249
00:07:23,759 --> 00:07:25,759
they've used these tools every day so

250
00:07:25,759 --> 00:07:28,639
they're you know pretty pretty set even

251
00:07:28,639 --> 00:07:31,280
just from that point of view um

252
00:07:31,280 --> 00:07:32,319
more importantly blue knows the

253
00:07:32,319 --> 00:07:33,360
environment that you're operating in

254
00:07:33,360 --> 00:07:34,880
they know that hey that you know we

255
00:07:34,880 --> 00:07:36,319
block whatever out we've got high cmp

256
00:07:36,319 --> 00:07:37,599
outbound say so no we don't need to

257
00:07:37,599 --> 00:07:38,960
worry about that even though the vendors

258
00:07:38,960 --> 00:07:41,520
may be iffy on that um they know some

259
00:07:41,520 --> 00:07:43,280
things are definitely possible like man

260
00:07:43,280 --> 00:07:45,520
we know that who is gets out happened

261
00:07:45,520 --> 00:07:46,879
once we know who is gets out all you

262
00:07:46,879 --> 00:07:48,479
have to do is ssh over who is and it

263
00:07:48,479 --> 00:07:49,360
works

264
00:07:49,360 --> 00:07:51,039
um and they know you know where they may

265
00:07:51,039 --> 00:07:52,639
have a little less visibility which is

266
00:07:52,639 --> 00:07:54,960
what's kind of testing is good um and

267
00:07:54,960 --> 00:07:57,360
they also know like hey we don't just

268
00:07:57,360 --> 00:07:59,440
need like one trick to win

269
00:07:59,440 --> 00:08:00,720
on the red side and certainly i would

270
00:08:00,720 --> 00:08:02,879
never do this um but some red teamers

271
00:08:02,879 --> 00:08:05,360
anyways are like hey i used https and it

272
00:08:05,360 --> 00:08:07,599
won hey i used https and i got out of

273
00:08:07,599 --> 00:08:09,199
your network again hey by the way hd

274
00:08:09,199 --> 00:08:11,360
yeah so it's you know you get a broader

275
00:08:11,360 --> 00:08:13,599
scope of things um

276
00:08:13,599 --> 00:08:16,080
and so from that no it's missing

277
00:08:16,080 --> 00:08:19,759
uh the red side does know that too

278
00:08:19,759 --> 00:08:21,120
a few more side benefits you get from

279
00:08:21,120 --> 00:08:23,759
this um when i've done this in the past

280
00:08:23,759 --> 00:08:25,280
working red blue you know the whole

281
00:08:25,280 --> 00:08:26,879
chain of people uh communication gets a

282
00:08:26,879 --> 00:08:27,840
little weird

283
00:08:27,840 --> 00:08:29,599
so you know you find yourself like i

284
00:08:29,599 --> 00:08:31,039
think oh i need to test this you know

285
00:08:31,039 --> 00:08:32,240
one set of activities one set of

286
00:08:32,240 --> 00:08:34,399
behaviors and the blue team you know

287
00:08:34,399 --> 00:08:35,599
analyst or whatnot i'm working with

288
00:08:35,599 --> 00:08:38,080
stock analyst is like not quite and then

289
00:08:38,080 --> 00:08:40,159
he goes talk to his it's like whoa

290
00:08:40,159 --> 00:08:41,360
wrong operating system something along

291
00:08:41,360 --> 00:08:42,399
those lines

292
00:08:42,399 --> 00:08:43,440
um

293
00:08:43,440 --> 00:08:44,880
also get a sort of more honest look at

294
00:08:44,880 --> 00:08:46,080
what needs improvement especially if

295
00:08:46,080 --> 00:08:49,040
you're hiring a external team to do this

296
00:08:49,040 --> 00:08:51,440
uh they like repeat business and if if

297
00:08:51,440 --> 00:08:53,200
your report that you hand a client is

298
00:08:53,200 --> 00:08:55,600
like yo everything's broken

299
00:08:55,600 --> 00:08:57,120
it's it's really hard to say and please

300
00:08:57,120 --> 00:08:59,279
hire us again it happens but not that i

301
00:08:59,279 --> 00:09:00,800
would ever do this again

302
00:09:00,800 --> 00:09:03,519
um cheaper of course and i've also found

303
00:09:03,519 --> 00:09:06,080
when i've worked sort of on the purplish

304
00:09:06,080 --> 00:09:07,440
not like in the modern sense of purple

305
00:09:07,440 --> 00:09:08,720
team you're just like hey you see this

306
00:09:08,720 --> 00:09:10,399
kind of thing hey you know come come

307
00:09:10,399 --> 00:09:12,080
look at this cool thing i'm doing um i

308
00:09:12,080 --> 00:09:13,440
find that oftentimes especially like

309
00:09:13,440 --> 00:09:15,760
junior soccer analysts and it guys

310
00:09:15,760 --> 00:09:17,519
really love like the learning like oh

311
00:09:17,519 --> 00:09:19,920
how you do this one trick and such i'm

312
00:09:19,920 --> 00:09:22,640
usually smaller scoped

313
00:09:22,640 --> 00:09:24,640
so that is sort of a thesis the why

314
00:09:24,640 --> 00:09:26,320
behind it um

315
00:09:26,320 --> 00:09:28,480
here is sort of an approach my own

316
00:09:28,480 --> 00:09:30,240
approach to testing these sorts of

317
00:09:30,240 --> 00:09:31,839
things

318
00:09:31,839 --> 00:09:34,240
for a bit of context

319
00:09:34,240 --> 00:09:36,240
mostly when i'm thinking you know tool

320
00:09:36,240 --> 00:09:38,000
bypass i'm i'm really thinking about two

321
00:09:38,000 --> 00:09:39,360
things i have to get past and thinking

322
00:09:39,360 --> 00:09:40,240
about

323
00:09:40,240 --> 00:09:42,480
um automated tools so like something

324
00:09:42,480 --> 00:09:44,080
making an alert and i'm thinking about

325
00:09:44,080 --> 00:09:46,080
whoever's doing the triage tier one sock

326
00:09:46,080 --> 00:09:48,480
something along those lines um sort of a

327
00:09:48,480 --> 00:09:50,800
counter example i know young lad who he

328
00:09:50,800 --> 00:09:52,560
had a file on his desktop i think

329
00:09:52,560 --> 00:09:54,000
lol.pie

330
00:09:54,000 --> 00:09:55,920
and because he just thought it was funny

331
00:09:55,920 --> 00:09:57,600
and uh sock was like oh my god what are

332
00:09:57,600 --> 00:09:59,200
you doing you know deconfliction

333
00:09:59,200 --> 00:10:01,040
happened and he's like i don't know what

334
00:10:01,040 --> 00:10:02,320
he was doing but he's like not playing

335
00:10:02,320 --> 00:10:03,519
league of legends because the soccer

336
00:10:03,519 --> 00:10:05,279
stock because you know the one the sock

337
00:10:05,279 --> 00:10:06,720
was like oh my gosh file names are

338
00:10:06,720 --> 00:10:09,040
credible we'll believe this so you know

339
00:10:09,040 --> 00:10:10,399
flip that on his head like hey if i just

340
00:10:10,399 --> 00:10:12,640
rename a file and it works

341
00:10:12,640 --> 00:10:14,480
then it works so you know that's kind of

342
00:10:14,480 --> 00:10:16,000
like thought number one is okay just it

343
00:10:16,000 --> 00:10:17,600
just has to work enough um somebody

344
00:10:17,600 --> 00:10:19,600
asked me yesterday like how do you pack

345
00:10:19,600 --> 00:10:21,920
linux binaries and i'm like

346
00:10:21,920 --> 00:10:23,680
why and the answer is because nothing

347
00:10:23,680 --> 00:10:24,800
looks so

348
00:10:24,800 --> 00:10:27,200
uh upx i guess but

349
00:10:27,200 --> 00:10:29,120
yeah so that's the kind of thing um and

350
00:10:29,120 --> 00:10:30,640
then so that

351
00:10:30,640 --> 00:10:32,160
you know dependency to figure that out

352
00:10:32,160 --> 00:10:34,000
is okay what what can i get away with to

353
00:10:34,000 --> 00:10:35,680
get to that point uh so i need to know

354
00:10:35,680 --> 00:10:37,279
what's not blocked uh because if

355
00:10:37,279 --> 00:10:38,480
something's blocked

356
00:10:38,480 --> 00:10:39,600
but not caught because i also need to

357
00:10:39,600 --> 00:10:40,720
know it's not cod something's blocked

358
00:10:40,720 --> 00:10:42,399
and not caught it's like well let's try

359
00:10:42,399 --> 00:10:44,720
again okay you know respond go again

360
00:10:44,720 --> 00:10:46,000
likewise if something's caught but not

361
00:10:46,000 --> 00:10:47,440
blocked

362
00:10:47,440 --> 00:10:49,440
well it still works i mean i'll get a

363
00:10:49,440 --> 00:10:52,000
socket manager mad at me probably but um

364
00:10:52,000 --> 00:10:53,360
that's kind of par for the course with

365
00:10:53,360 --> 00:10:55,040
red teaming so that's kind of the two

366
00:10:55,040 --> 00:10:56,560
things when we're formulating these

367
00:10:56,560 --> 00:10:57,839
tests we're talking about to think what

368
00:10:57,839 --> 00:10:58,959
what can we do to avoid getting blocked

369
00:10:58,959 --> 00:11:01,120
what can you do to avoid getting caught

370
00:11:01,120 --> 00:11:02,880
um and then it's always good to keep in

371
00:11:02,880 --> 00:11:04,000
the back of your mind what else can you

372
00:11:04,000 --> 00:11:05,760
get away with uh

373
00:11:05,760 --> 00:11:07,519
you know it's it's sort of the red team

374
00:11:07,519 --> 00:11:10,000
mentality um

375
00:11:10,000 --> 00:11:11,519
context from the red side but like hey

376
00:11:11,519 --> 00:11:13,279
not not just like yeah i won yeah i got

377
00:11:13,279 --> 00:11:14,560
ceos you know dropped a report on the

378
00:11:14,560 --> 00:11:16,320
ceo's desktop or something but like what

379
00:11:16,320 --> 00:11:17,600
else can i do

380
00:11:17,600 --> 00:11:18,959
um

381
00:11:18,959 --> 00:11:20,560
this all turns into like fooling the

382
00:11:20,560 --> 00:11:23,680
system at five ish places um sometimes

383
00:11:23,680 --> 00:11:26,240
on the sensing side so uh network

384
00:11:26,240 --> 00:11:27,920
traffic analysis you know it's sniffing

385
00:11:27,920 --> 00:11:29,440
taking pcap and whatnot it can't be

386
00:11:29,440 --> 00:11:31,200
doing that for everything so i'll just

387
00:11:31,200 --> 00:11:33,120
like turn things off um

388
00:11:33,120 --> 00:11:34,240
i know of

389
00:11:34,240 --> 00:11:36,079
three different tools that don't look at

390
00:11:36,079 --> 00:11:38,959
icp so okay i can fool the sensing

391
00:11:38,959 --> 00:11:41,040
because it's not sensing icp processing

392
00:11:41,040 --> 00:11:43,680
so um if something is taking a stream of

393
00:11:43,680 --> 00:11:46,000
events data whatever has to like turn

394
00:11:46,000 --> 00:11:47,760
that from some raw sensor output to

395
00:11:47,760 --> 00:11:49,040
something useful

396
00:11:49,040 --> 00:11:50,000
um

397
00:11:50,000 --> 00:11:52,000
so if i can break it there i that that's

398
00:11:52,000 --> 00:11:54,399
another win another way to break a tool

399
00:11:54,399 --> 00:11:56,160
which is then informs these test cases

400
00:11:56,160 --> 00:11:57,600
we're gonna be talking about later

401
00:11:57,600 --> 00:11:59,440
um good example of that we had something

402
00:11:59,440 --> 00:12:00,800
a tool i was going against it was

403
00:12:00,800 --> 00:12:02,160
parsing http

404
00:12:02,160 --> 00:12:04,560
sure um so i put at the beginning of my

405
00:12:04,560 --> 00:12:07,200
ssh stream like an http request header

406
00:12:07,200 --> 00:12:08,399
just like the one line get something

407
00:12:08,399 --> 00:12:10,320
something and then just ssh after that

408
00:12:10,320 --> 00:12:11,519
and then likewise from the server i just

409
00:12:11,519 --> 00:12:13,600
put like an http 200 okay and then like

410
00:12:13,600 --> 00:12:15,519
ssh after that and and that poor tool

411
00:12:15,519 --> 00:12:17,360
then it was not expecting gigs and gigs

412
00:12:17,360 --> 00:12:18,800
of http requests and response

413
00:12:18,800 --> 00:12:20,639
simultaneously

414
00:12:20,639 --> 00:12:22,240
that broke um

415
00:12:22,240 --> 00:12:24,079
likewise decisioning is the next sort of

416
00:12:24,079 --> 00:12:25,279
step in this

417
00:12:25,279 --> 00:12:26,800
i hate to call it a chain it's overused

418
00:12:26,800 --> 00:12:28,480
but chain uh if you can break the

419
00:12:28,480 --> 00:12:30,639
decision if you can say you know hey you

420
00:12:30,639 --> 00:12:32,399
you sensed this thing on the wire you

421
00:12:32,399 --> 00:12:34,000
looked at it but you decided it's

422
00:12:34,000 --> 00:12:35,920
probably not that bad then that's a win

423
00:12:35,920 --> 00:12:36,839
too

424
00:12:36,839 --> 00:12:39,600
um i don't have a canned example off the

425
00:12:39,600 --> 00:12:41,680
top of my head but you know that is like

426
00:12:41,680 --> 00:12:43,279
fooling it where it's like yeah it looks

427
00:12:43,279 --> 00:12:44,320
okay

428
00:12:44,320 --> 00:12:45,279
um

429
00:12:45,279 --> 00:12:48,000
alerting as well so every so often i'll

430
00:12:48,000 --> 00:12:49,440
do something

431
00:12:49,440 --> 00:12:50,720
that you know what else can i get away

432
00:12:50,720 --> 00:12:52,560
with i'll do like something like that

433
00:12:52,560 --> 00:12:53,920
and i'll usually say to the stock guys

434
00:12:53,920 --> 00:12:55,760
hey dudes do you uh do you see that

435
00:12:55,760 --> 00:12:57,040
and

436
00:12:57,040 --> 00:12:58,800
there is a tool without naming names of

437
00:12:58,800 --> 00:13:00,880
course that you know they'll say yeah it

438
00:13:00,880 --> 00:13:03,519
made an alert i was like cool

439
00:13:03,519 --> 00:13:04,800
would you have seen that and you know

440
00:13:04,800 --> 00:13:06,560
most of the time yes but every once in a

441
00:13:06,560 --> 00:13:08,480
blue moon it's like well the tool was

442
00:13:08,480 --> 00:13:10,480
like nah it's not that not that awesome

443
00:13:10,480 --> 00:13:12,000
it's not that important so if you can

444
00:13:12,000 --> 00:13:13,040
break it there and then of course the

445
00:13:13,040 --> 00:13:15,519
response is the other one um

446
00:13:15,519 --> 00:13:16,880
you know if you know even if you're like

447
00:13:16,880 --> 00:13:19,279
oh my gosh the sky is falling but you

448
00:13:19,279 --> 00:13:20,959
don't actually kill the whatever needs

449
00:13:20,959 --> 00:13:22,079
to be killed

450
00:13:22,079 --> 00:13:25,120
well i still win

451
00:13:26,000 --> 00:13:28,320
cool so back to this this uh rambly

452
00:13:28,320 --> 00:13:30,160
philosophy step one what what are we

453
00:13:30,160 --> 00:13:31,680
actually meant to do what is this tool

454
00:13:31,680 --> 00:13:33,680
really meant to do um and sometimes it's

455
00:13:33,680 --> 00:13:35,760
not obvious if you if you get one of

456
00:13:35,760 --> 00:13:37,920
these uh enterprise grade cloud native

457
00:13:37,920 --> 00:13:40,639
ai ml low calorie intel driven makes

458
00:13:40,639 --> 00:13:42,399
your t in the morning thing does not

459
00:13:42,399 --> 00:13:43,600
tell you what it's actually supposed to

460
00:13:43,600 --> 00:13:45,120
do it tells you that like some some

461
00:13:45,120 --> 00:13:46,560
ceo's gonna buy it

462
00:13:46,560 --> 00:13:48,800
but um so you have to sort of sometimes

463
00:13:48,800 --> 00:13:50,320
really dig and figure out okay what does

464
00:13:50,320 --> 00:13:51,279
this thing actually do and sometimes

465
00:13:51,279 --> 00:13:53,519
it's just as simple as like regex

466
00:13:53,519 --> 00:13:55,120
um sometimes it's as simple as like

467
00:13:55,120 --> 00:13:56,560
matching domain names

468
00:13:56,560 --> 00:13:58,160
uh sometimes it's complicated neural

469
00:13:58,160 --> 00:13:59,360
nets are involved and whatever else and

470
00:13:59,360 --> 00:14:01,920
then also how it does it so if you can

471
00:14:01,920 --> 00:14:03,519
figure out what source of data it gets

472
00:14:03,519 --> 00:14:04,240
in

473
00:14:04,240 --> 00:14:06,800
um that much you know the closer you get

474
00:14:06,800 --> 00:14:08,639
to like truth for lack of a better word

475
00:14:08,639 --> 00:14:10,399
the closer you get to uh figuring out

476
00:14:10,399 --> 00:14:12,320
how things work oh boy my timer just

477
00:14:12,320 --> 00:14:13,519
locked itself

478
00:14:13,519 --> 00:14:14,880
there we go

479
00:14:14,880 --> 00:14:16,720
uh so like the network tool i was

480
00:14:16,720 --> 00:14:19,279
talking about it it used a packet socket

481
00:14:19,279 --> 00:14:21,600
or something snapped snarfs traffic and

482
00:14:21,600 --> 00:14:24,000
pcapped it and did some math over that

483
00:14:24,000 --> 00:14:26,000
um the linux edr thing that actually did

484
00:14:26,000 --> 00:14:27,839
catch me once and it just it parsed on

485
00:14:27,839 --> 00:14:29,600
it d output i was like oh so i just have

486
00:14:29,600 --> 00:14:31,360
to stay out of audit d no problem

487
00:14:31,360 --> 00:14:33,120
um things like that

488
00:14:33,120 --> 00:14:35,680
and so where do we find this well

489
00:14:35,680 --> 00:14:38,160
poker on the ui um which is something

490
00:14:38,160 --> 00:14:39,760
that blue teamers are way better at

491
00:14:39,760 --> 00:14:41,839
doing than red teamers um

492
00:14:41,839 --> 00:14:43,440
speaking only for myself i poke around

493
00:14:43,440 --> 00:14:46,079
like edr ai uis and i'm like

494
00:14:46,079 --> 00:14:47,760
i could do doing other things

495
00:14:47,760 --> 00:14:50,320
uh false positives as well so if if the

496
00:14:50,320 --> 00:14:51,839
tool whatever it is says hey this is a

497
00:14:51,839 --> 00:14:53,839
bad thing like the ll.pi like oh my god

498
00:14:53,839 --> 00:14:56,320
he's running a forbidden game okay we

499
00:14:56,320 --> 00:14:57,760
know it's looking for games let's see if

500
00:14:57,760 --> 00:14:59,040
let's let's validate that let's try

501
00:14:59,040 --> 00:15:00,560
another game let's try something

502
00:15:00,560 --> 00:15:02,000
pretending to be a game so on and so

503
00:15:02,000 --> 00:15:02,959
forth

504
00:15:02,959 --> 00:15:04,959
um in a similar situation i found out it

505
00:15:04,959 --> 00:15:07,600
was like mac app like dot app directory

506
00:15:07,600 --> 00:15:09,920
things that was just a name matchy thing

507
00:15:09,920 --> 00:15:13,199
um spotify was not allowed by technical

508
00:15:13,199 --> 00:15:15,680
policy but allowed by like hr policy um

509
00:15:15,680 --> 00:15:17,040
and it turned out splattified that app

510
00:15:17,040 --> 00:15:19,360
worked really good uh and i had music

511
00:15:19,360 --> 00:15:21,279
and the sock was

512
00:15:21,279 --> 00:15:22,399
not happy

513
00:15:22,399 --> 00:15:25,600
uh documentation also um documentation

514
00:15:25,600 --> 00:15:27,199
can be misleading by the way but you

515
00:15:27,199 --> 00:15:29,120
know just like if it says hey turn this

516
00:15:29,120 --> 00:15:31,360
thing on to catch this thing but there

517
00:15:31,360 --> 00:15:32,720
is it can't be misleading there is a

518
00:15:32,720 --> 00:15:35,440
tool out there i i um my name is not on

519
00:15:35,440 --> 00:15:37,120
it and hopefully it never will be but

520
00:15:37,120 --> 00:15:38,959
there is a like bug report in that the

521
00:15:38,959 --> 00:15:40,560
documentation says it blocks x and

522
00:15:40,560 --> 00:15:41,759
allows y

523
00:15:41,759 --> 00:15:44,880
and it actually allows x and blocks y so

524
00:15:44,880 --> 00:15:46,560
yeah keep it take it for what it's worth

525
00:15:46,560 --> 00:15:48,320
um previous incidents as well if you had

526
00:15:48,320 --> 00:15:50,160
a thing that happened and it did not get

527
00:15:50,160 --> 00:15:51,680
caught you're like maybe that should get

528
00:15:51,680 --> 00:15:53,199
caught or you had a thing that happened

529
00:15:53,199 --> 00:15:55,120
and i mean it's an incidence you somehow

530
00:15:55,120 --> 00:15:57,120
you had happened um that's a good way of

531
00:15:57,120 --> 00:15:59,600
saying hey this you get caught um

532
00:15:59,600 --> 00:16:02,000
so a call i had once and by call like i

533
00:16:02,000 --> 00:16:02,959
was doing something it sounds like what

534
00:16:02,959 --> 00:16:05,040
are you doing and i was like hey yos

535
00:16:05,040 --> 00:16:06,240
made up yes credits don't you and i was

536
00:16:06,240 --> 00:16:09,519
like no they're like yeah you do it's

537
00:16:09,519 --> 00:16:10,560
you're coming from the wrong network for

538
00:16:10,560 --> 00:16:12,399
those creds okay so i know that whatever

539
00:16:12,399 --> 00:16:13,680
tool that was i don't know what tool it

540
00:16:13,680 --> 00:16:15,680
is because don't tell me but whatever

541
00:16:15,680 --> 00:16:18,079
tool that was i know like it catches aws

542
00:16:18,079 --> 00:16:19,360
creds from a weird place that's good

543
00:16:19,360 --> 00:16:22,000
it's good um less good sources that

544
00:16:22,000 --> 00:16:23,600
still may give you good information

545
00:16:23,600 --> 00:16:24,959
about what our tool does uh the sales

546
00:16:24,959 --> 00:16:26,959
pitch itself um if especially if you get

547
00:16:26,959 --> 00:16:28,240
like a sales engineer that will give you

548
00:16:28,240 --> 00:16:29,600
good information

549
00:16:29,600 --> 00:16:30,639
um

550
00:16:30,639 --> 00:16:32,480
and also false negatives if if you have

551
00:16:32,480 --> 00:16:34,079
a team that does a thing and you're like

552
00:16:34,079 --> 00:16:34,959
they're like hey you catch this and

553
00:16:34,959 --> 00:16:36,880
they're like no

554
00:16:36,880 --> 00:16:38,959
uh yeah take that um and then let's take

555
00:16:38,959 --> 00:16:40,079
these you know what's this tool meant to

556
00:16:40,079 --> 00:16:41,279
do and compile it into sort of a list of

557
00:16:41,279 --> 00:16:43,040
use cases um this can be all the way

558
00:16:43,040 --> 00:16:45,199
from really specific things like i would

559
00:16:45,199 --> 00:16:46,639
like to match dns names that are longer

560
00:16:46,639 --> 00:16:48,000
than 18 characters and catch dns

561
00:16:48,000 --> 00:16:49,920
tunneling just to like i want x-fil

562
00:16:49,920 --> 00:16:52,320
blocked

563
00:16:52,320 --> 00:16:53,839
and then we should also ask what should

564
00:16:53,839 --> 00:16:55,440
this tool do what we like this tool do

565
00:16:55,440 --> 00:16:57,120
especially if we're looking for a

566
00:16:57,120 --> 00:16:58,720
replacement for a tool

567
00:16:58,720 --> 00:17:00,160
um if it's something like hey we have

568
00:17:00,160 --> 00:17:01,440
this thing it's not working all that

569
00:17:01,440 --> 00:17:03,279
good let's find another thing

570
00:17:03,279 --> 00:17:05,679
you know kind of a wish list um

571
00:17:05,679 --> 00:17:07,760
it does happen and i've i've seen this

572
00:17:07,760 --> 00:17:09,599
before vendors are just like oh yeah

573
00:17:09,599 --> 00:17:10,959
that would be a good thing to block um

574
00:17:10,959 --> 00:17:12,640
so like i mentioned the 18 character dns

575
00:17:12,640 --> 00:17:14,559
thing it was a friend of mine was going

576
00:17:14,559 --> 00:17:16,880
against a dns something and

577
00:17:16,880 --> 00:17:18,240
the client specifically said hey could

578
00:17:18,240 --> 00:17:20,079
you could you do dns tunneling we want

579
00:17:20,079 --> 00:17:21,839
to see how this looks in our tools and i

580
00:17:21,839 --> 00:17:23,039
just happened to have some code to hand

581
00:17:23,039 --> 00:17:24,959
him and i handed it to him and that the

582
00:17:24,959 --> 00:17:26,799
blue guys came back and were like you

583
00:17:26,799 --> 00:17:28,079
didn't do dns tunneling and he's like

584
00:17:28,079 --> 00:17:29,520
well i did and they're like well your

585
00:17:29,520 --> 00:17:31,120
domain names were too short so okay

586
00:17:31,120 --> 00:17:33,280
lesson learned for them maybe we

587
00:17:33,280 --> 00:17:35,600
we shortened the like length of domain

588
00:17:35,600 --> 00:17:37,280
names just because the vendor was like

589
00:17:37,280 --> 00:17:38,960
oh yeah i guess i guess you can't like

590
00:17:38,960 --> 00:17:40,480
tunnel out with three character sub

591
00:17:40,480 --> 00:17:41,520
domains

592
00:17:41,520 --> 00:17:43,919
um regulatory requirements as well

593
00:17:43,919 --> 00:17:45,760
especially if you work in like pci dss

594
00:17:45,760 --> 00:17:48,400
fintechy type things um

595
00:17:48,400 --> 00:17:49,760
finding credit card numbers is always

596
00:17:49,760 --> 00:17:51,760
like you know if something can identify

597
00:17:51,760 --> 00:17:53,280
credit card numbers and three cpv

598
00:17:53,280 --> 00:17:54,640
numbers and whatnot that's that's an

599
00:17:54,640 --> 00:17:56,960
excellent ask it's next to impossible

600
00:17:56,960 --> 00:17:59,280
but it's a good thing to think about um

601
00:17:59,280 --> 00:18:01,840
et cetera uh trade magazines i find come

602
00:18:01,840 --> 00:18:04,160
from above usually um

603
00:18:04,160 --> 00:18:05,280
did this thing and i was like hey i

604
00:18:05,280 --> 00:18:07,039
found a power strip several jobs ago i

605
00:18:07,039 --> 00:18:08,880
found a power strip on you know let you

606
00:18:08,880 --> 00:18:09,919
know loose

607
00:18:09,919 --> 00:18:11,679
uh i could log in and like shut down a

608
00:18:11,679 --> 00:18:12,799
server rack and they're like cool story

609
00:18:12,799 --> 00:18:13,600
bro

610
00:18:13,600 --> 00:18:15,840
and then like six months later uh some

611
00:18:15,840 --> 00:18:17,200
trademark or some sizzle magazine or

612
00:18:17,200 --> 00:18:19,120
whatever had like oh my god you can get

613
00:18:19,120 --> 00:18:20,720
hacked by iot

614
00:18:20,720 --> 00:18:22,080
um

615
00:18:22,080 --> 00:18:23,520
just happen to have a report

616
00:18:23,520 --> 00:18:25,440
ready for that it's had a funny date on

617
00:18:25,440 --> 00:18:26,880
it but you know all right so we kind of

618
00:18:26,880 --> 00:18:28,320
have our like wish list high level wish

619
00:18:28,320 --> 00:18:30,320
list of use cases um in the terminology

620
00:18:30,320 --> 00:18:32,320
use case test case it's everybody's

621
00:18:32,320 --> 00:18:33,919
going to use different terms that's cool

622
00:18:33,919 --> 00:18:35,600
um so let's then come up with kind of a

623
00:18:35,600 --> 00:18:37,520
list of test cases more technical like

624
00:18:37,520 --> 00:18:39,360
things we can put on the wire it's it's

625
00:18:39,360 --> 00:18:41,280
a good idea to keep these small

626
00:18:41,280 --> 00:18:45,120
like a pass fail or a like a severity of

627
00:18:45,120 --> 00:18:46,480
alert or something

628
00:18:46,480 --> 00:18:47,440
um

629
00:18:47,440 --> 00:18:49,679
it's also a good idea to keep it part of

630
00:18:49,679 --> 00:18:51,120
like notionally part of some larger

631
00:18:51,120 --> 00:18:53,520
scenario part of something that's uh

632
00:18:53,520 --> 00:18:56,320
either like a cool hack that happened um

633
00:18:56,320 --> 00:18:59,120
so when electronic arts lost

634
00:18:59,120 --> 00:19:00,720
something like source code and it came

635
00:19:00,720 --> 00:19:02,640
out it was a slack cookie that was owned

636
00:19:02,640 --> 00:19:03,919
uh team came to me and was like hey

637
00:19:03,919 --> 00:19:06,000
could you show us talk to us about slack

638
00:19:06,000 --> 00:19:07,600
cookies neat little demo and some

639
00:19:07,600 --> 00:19:08,799
learnings happened and some fixes

640
00:19:08,799 --> 00:19:11,440
happened it was good um but like the the

641
00:19:11,440 --> 00:19:12,880
the test if you wanted to call it that

642
00:19:12,880 --> 00:19:14,559
was just like can i put this slack

643
00:19:14,559 --> 00:19:17,039
cookie in a browser oh yeah of course um

644
00:19:17,039 --> 00:19:18,400
i could anyways

645
00:19:18,400 --> 00:19:19,440
so

646
00:19:19,440 --> 00:19:20,640
you know make it make it part of a

647
00:19:20,640 --> 00:19:21,840
larger scenario that gives you a bit of

648
00:19:21,840 --> 00:19:24,240
impact uh gives you a bit of credibility

649
00:19:24,240 --> 00:19:25,600
and makes it easier for the people who

650
00:19:25,600 --> 00:19:27,840
are reading these like results to kind

651
00:19:27,840 --> 00:19:29,280
of figure out oh yeah this is this is

652
00:19:29,280 --> 00:19:30,400
actually useful

653
00:19:30,400 --> 00:19:32,640
um you can also take it just like from

654
00:19:32,640 --> 00:19:33,919
knowledge of how things could happen

655
00:19:33,919 --> 00:19:35,600
like i said the guy i knew was just like

656
00:19:35,600 --> 00:19:37,280
hey sock how do we own you and they're

657
00:19:37,280 --> 00:19:39,039
like yeah sure so that sort of like

658
00:19:39,039 --> 00:19:40,640
chain of events and they knew like okay

659
00:19:40,640 --> 00:19:41,840
we should probably worry about this then

660
00:19:41,840 --> 00:19:44,000
there's like little bit like oh yeah

661
00:19:44,000 --> 00:19:45,520
this one little thing it does actually

662
00:19:45,520 --> 00:19:46,720
work and

663
00:19:46,720 --> 00:19:49,440
you know helpful tests um and then

664
00:19:49,440 --> 00:19:52,320
sometimes you know bad things are done

665
00:19:52,320 --> 00:19:54,400
uh and you know you can take your tests

666
00:19:54,400 --> 00:19:56,960
and go on that there was an organization

667
00:19:56,960 --> 00:19:59,120
um i heard of and it was had some crypto

668
00:19:59,120 --> 00:20:00,799
minor stuff and some

669
00:20:00,799 --> 00:20:03,360
you know comms out and uh the question

670
00:20:03,360 --> 00:20:05,120
was like hey can we test like just the

671
00:20:05,120 --> 00:20:07,120
comms that were similar to what happened

672
00:20:07,120 --> 00:20:09,200
and i could see that actually um until

673
00:20:09,200 --> 00:20:10,799
we did and we just i mean it was http

674
00:20:10,799 --> 00:20:12,080
requests in a loop there's nothing big

675
00:20:12,080 --> 00:20:14,240
but it was a useful thing um and a thing

676
00:20:14,240 --> 00:20:15,760
and a question like hey just do our

677
00:20:15,760 --> 00:20:17,039
tools that are supposed to catch c2

678
00:20:17,039 --> 00:20:19,120
actually catch this um those years ago i

679
00:20:19,120 --> 00:20:20,880
have no idea if they did or not also

680
00:20:20,880 --> 00:20:21,919
when you're putting together these test

681
00:20:21,919 --> 00:20:25,200
cases keep as few confounding factors

682
00:20:25,200 --> 00:20:27,360
around as possible um

683
00:20:27,360 --> 00:20:29,520
a because it's good science uh but b

684
00:20:29,520 --> 00:20:31,760
more importantly it's it's like 100

685
00:20:31,760 --> 00:20:33,120
chance somebody's going to say something

686
00:20:33,120 --> 00:20:35,039
to the tune of well yeah it worked when

687
00:20:35,039 --> 00:20:37,600
you did it but you know you you had a an

688
00:20:37,600 --> 00:20:38,960
easier answer you know it worked when

689
00:20:38,960 --> 00:20:41,360
you did it but like a real bad guy so

690
00:20:41,360 --> 00:20:43,360
the less of that the better

691
00:20:43,360 --> 00:20:45,200
um

692
00:20:45,200 --> 00:20:47,120
also when you have a stopwatch make sure

693
00:20:47,120 --> 00:20:48,880
it stays on

694
00:20:48,880 --> 00:20:50,480
cool so then then as you're coming up

695
00:20:50,480 --> 00:20:51,600
with these test cases it's good to

696
00:20:51,600 --> 00:20:52,880
figure out like where to start it's

697
00:20:52,880 --> 00:20:54,320
really tempting to be like i'm just

698
00:20:54,320 --> 00:20:55,600
going to do a whole hack from beginning

699
00:20:55,600 --> 00:20:57,120
to end um sales dudes love that if you

700
00:20:57,120 --> 00:20:58,880
ever gonna sell a product like having a

701
00:20:58,880 --> 00:21:01,200
scenario and scenario like

702
00:21:01,200 --> 00:21:03,919
uh is is a very valued thing

703
00:21:03,919 --> 00:21:04,880
that's not what we're doing here we're

704
00:21:04,880 --> 00:21:06,480
just testing like does this thing work

705
00:21:06,480 --> 00:21:08,080
so a better idea is just start start

706
00:21:08,080 --> 00:21:09,919
right before the thing that your testing

707
00:21:09,919 --> 00:21:11,919
is supposed to come into play

708
00:21:11,919 --> 00:21:13,760
uh so if you're gonna say hey does this

709
00:21:13,760 --> 00:21:16,559
thing catch some execution okay just ssh

710
00:21:16,559 --> 00:21:18,480
in star dp in just something drop it to

711
00:21:18,480 --> 00:21:20,400
the desktop double click see if it works

712
00:21:20,400 --> 00:21:21,600
um

713
00:21:21,600 --> 00:21:23,600
it does work if you're going to look at

714
00:21:23,600 --> 00:21:25,039
something that blocks c2 you start with

715
00:21:25,039 --> 00:21:26,880
code execution ssh and drop your thing

716
00:21:26,880 --> 00:21:27,840
don't worry about whether that gets

717
00:21:27,840 --> 00:21:29,520
caught just see like hey does you know

718
00:21:29,520 --> 00:21:31,600
my http out to

719
00:21:31,600 --> 00:21:33,600
something weird get caught

720
00:21:33,600 --> 00:21:36,320
um it is it is highly likely that at

721
00:21:36,320 --> 00:21:37,440
some point

722
00:21:37,440 --> 00:21:39,039
when you're doing this you're like yeah

723
00:21:39,039 --> 00:21:41,280
we assumed access to whatever someone

724
00:21:41,280 --> 00:21:42,320
will come back and say yeah but if

725
00:21:42,320 --> 00:21:44,240
somebody has access to whatever we have

726
00:21:44,240 --> 00:21:46,400
bigger problems um

727
00:21:46,400 --> 00:21:48,080
you've done two things there yes that's

728
00:21:48,080 --> 00:21:49,280
what the tools for and then you've also

729
00:21:49,280 --> 00:21:50,720
identified sort of a bigger problem in

730
00:21:50,720 --> 00:21:52,480
the organization as like the security

731
00:21:52,480 --> 00:21:53,679
mindset

732
00:21:53,679 --> 00:21:54,960
um so anyways once you have this list of

733
00:21:54,960 --> 00:21:56,960
test cases like single testable things

734
00:21:56,960 --> 00:21:58,559
make a list you know so you have a list

735
00:21:58,559 --> 00:22:00,559
of use cases test cases

736
00:22:00,559 --> 00:22:02,320
and then last things try and get caught

737
00:22:02,320 --> 00:22:04,320
like do it um

738
00:22:04,320 --> 00:22:06,960
which is uh very situationally dependent

739
00:22:06,960 --> 00:22:08,240
it's very like

740
00:22:08,240 --> 00:22:10,000
way outside the scope of the talk how to

741
00:22:10,000 --> 00:22:11,600
like test all the things

742
00:22:11,600 --> 00:22:13,120
but essentially it's hacking light it's

743
00:22:13,120 --> 00:22:14,720
all like the fun bits of hacking without

744
00:22:14,720 --> 00:22:16,559
like the setting up infrastructure and

745
00:22:16,559 --> 00:22:18,000
really boring stuff you'll need some

746
00:22:18,000 --> 00:22:19,520
sort of hacker tools

747
00:22:19,520 --> 00:22:22,000
hacker tools i the vast majority of the

748
00:22:22,000 --> 00:22:24,720
hacker tools i use involve ssh and like

749
00:22:24,720 --> 00:22:26,159
cat and grip

750
00:22:26,159 --> 00:22:28,400
um but you'll need something to test it

751
00:22:28,400 --> 00:22:29,520
especially if you're on the network side

752
00:22:29,520 --> 00:22:31,360
of things a great place to find this is

753
00:22:31,360 --> 00:22:33,360
search results favorite search engine

754
00:22:33,360 --> 00:22:34,400
um

755
00:22:34,400 --> 00:22:36,159
some search engines are less great about

756
00:22:36,159 --> 00:22:37,520
getting things on the first page but the

757
00:22:37,520 --> 00:22:39,360
second page is some forget the fella's

758
00:22:39,360 --> 00:22:40,799
name i'll never remember but he says you

759
00:22:40,799 --> 00:22:42,159
know the one thing i'm worried about

760
00:22:42,159 --> 00:22:43,520
blue team one thing i'm worried about is

761
00:22:43,520 --> 00:22:45,200
like a monkey armed with github i think

762
00:22:45,200 --> 00:22:47,200
is what he said so yes google proof see

763
00:22:47,200 --> 00:22:48,799
if the uh

764
00:22:48,799 --> 00:22:50,080
not supposed to name things apologies

765
00:22:50,080 --> 00:22:52,480
yeah see if it's google proof um

766
00:22:52,480 --> 00:22:55,520
for and postpoit host endpoint based

767
00:22:55,520 --> 00:22:58,960
things um the gtfo bins and the lol bins

768
00:22:58,960 --> 00:23:00,400
projects are great sources they'll just

769
00:23:00,400 --> 00:23:02,080
give you a list of like commands you can

770
00:23:02,080 --> 00:23:03,679
run to do bad things

771
00:23:03,679 --> 00:23:04,720
um

772
00:23:04,720 --> 00:23:05,840
by the way if you're interviewing

773
00:23:05,840 --> 00:23:07,440
somebody and you're like ah find the one

774
00:23:07,440 --> 00:23:08,960
command that does weird things and you

775
00:23:08,960 --> 00:23:11,120
let like open internet ability totally

776
00:23:11,120 --> 00:23:12,559
go to the website

777
00:23:12,559 --> 00:23:13,760
um

778
00:23:13,760 --> 00:23:15,440
more more you know to that point also

779
00:23:15,440 --> 00:23:16,960
roll your own like if there's nothing

780
00:23:16,960 --> 00:23:18,640
out there that tests the exact use case

781
00:23:18,640 --> 00:23:20,640
you want that's cool um it's it's always

782
00:23:20,640 --> 00:23:22,640
surprising to me like how like eight

783
00:23:22,640 --> 00:23:24,720
lines of python were discovered five

784
00:23:24,720 --> 00:23:25,840
years later

785
00:23:25,840 --> 00:23:27,840
um or how like you know really like

786
00:23:27,840 --> 00:23:31,280
terribly written implants work um

787
00:23:31,280 --> 00:23:32,960
there's this one that was uh iranian

788
00:23:32,960 --> 00:23:35,200
malware i think it was dns tunneling

789
00:23:35,200 --> 00:23:38,080
and um like i i re-implemented it as

790
00:23:38,080 --> 00:23:39,840
best i could from reporting

791
00:23:39,840 --> 00:23:41,279
i took it to a client site was like hey

792
00:23:41,279 --> 00:23:43,120
let's test and see you know this kind of

793
00:23:43,120 --> 00:23:45,440
thing and it like broke immediately

794
00:23:45,440 --> 00:23:47,200
because like they were blocking the ip

795
00:23:47,200 --> 00:23:48,159
address

796
00:23:48,159 --> 00:23:50,320
scheme type thing that this tool used

797
00:23:50,320 --> 00:23:52,400
i'm like how did this actually work i i

798
00:23:52,400 --> 00:23:54,400
wrote the thing i think during a meeting

799
00:23:54,400 --> 00:23:56,400
because i was bored that day uh so yeah

800
00:23:56,400 --> 00:23:58,000
to take it it's totally there's the

801
00:23:58,000 --> 00:23:59,520
argument like hey is this realistic yeah

802
00:23:59,520 --> 00:24:01,360
i could do whatever it works

803
00:24:01,360 --> 00:24:02,320
um

804
00:24:02,320 --> 00:24:03,600
as you're doing this think about impact

805
00:24:03,600 --> 00:24:05,120
you don't necessarily have to like drop

806
00:24:05,120 --> 00:24:07,360
something it works and then you know get

807
00:24:07,360 --> 00:24:10,480
domain admin but it it does make a

808
00:24:10,480 --> 00:24:12,000
better story when you can say hey this

809
00:24:12,000 --> 00:24:13,760
thing happened um

810
00:24:13,760 --> 00:24:15,120
it's good you know like hey this you

811
00:24:15,120 --> 00:24:16,480
know whatever we did made an alert so

812
00:24:16,480 --> 00:24:18,240
it's obviously bad or we hope it is

813
00:24:18,240 --> 00:24:20,720
anyways that's a start but some human

814
00:24:20,720 --> 00:24:22,320
visible-ish something is better if you

815
00:24:22,320 --> 00:24:24,640
can you know make the test such that

816
00:24:24,640 --> 00:24:26,640
somebody sees something add yourself to

817
00:24:26,640 --> 00:24:28,640
an ldap group um

818
00:24:28,640 --> 00:24:30,000
i know a fellow and that's like he just

819
00:24:30,000 --> 00:24:31,840
gets bored and and he ends up in ldap

820
00:24:31,840 --> 00:24:32,799
groups

821
00:24:32,799 --> 00:24:34,000
and and then we end up with things to

822
00:24:34,000 --> 00:24:36,080
fix um

823
00:24:36,080 --> 00:24:37,520
less and less these days which is quite

824
00:24:37,520 --> 00:24:38,400
nice

825
00:24:38,400 --> 00:24:39,200
uh

826
00:24:39,200 --> 00:24:40,799
and the more the more real you make

827
00:24:40,799 --> 00:24:43,039
these tests the more real you execute

828
00:24:43,039 --> 00:24:44,960
the tests uh the more credible it is and

829
00:24:44,960 --> 00:24:46,559
by this i mostly mean where you're doing

830
00:24:46,559 --> 00:24:47,440
them

831
00:24:47,440 --> 00:24:48,159
so

832
00:24:48,159 --> 00:24:50,480
user endpoints i mean don't just like go

833
00:24:50,480 --> 00:24:51,520
up to somebody and say hey can i hack

834
00:24:51,520 --> 00:24:53,840
you please um but you know something

835
00:24:53,840 --> 00:24:55,679
configured reasonably similarly it's not

836
00:24:55,679 --> 00:24:57,520
great to say like oh yeah we just got

837
00:24:57,520 --> 00:24:59,679
domain admin but the box didn't have the

838
00:24:59,679 --> 00:25:01,039
normal set of defensive tools on it

839
00:25:01,039 --> 00:25:02,400
because you know there's the question

840
00:25:02,400 --> 00:25:04,880
like would that have blocked it um prod

841
00:25:04,880 --> 00:25:06,640
network as well uh

842
00:25:06,640 --> 00:25:08,400
with care um

843
00:25:08,400 --> 00:25:10,320
if you don't have care i get this

844
00:25:10,320 --> 00:25:12,480
message one day and and i

845
00:25:12,480 --> 00:25:14,080
i got the message after i figured out

846
00:25:14,080 --> 00:25:15,679
how to reconnect to the network and uh

847
00:25:15,679 --> 00:25:16,960
the message was

848
00:25:16,960 --> 00:25:18,799
our ceo would really like you to stop

849
00:25:18,799 --> 00:25:21,360
breaking the wi-fi

850
00:25:21,360 --> 00:25:22,480
so

851
00:25:22,480 --> 00:25:23,679
test and fraud

852
00:25:23,679 --> 00:25:24,720
carefully

853
00:25:24,720 --> 00:25:26,400
on the blue side another benefit is you

854
00:25:26,400 --> 00:25:27,600
you know how things look in security

855
00:25:27,600 --> 00:25:28,960
tools nothing's looking defensive tools

856
00:25:28,960 --> 00:25:30,400
so you don't have to worry about like

857
00:25:30,400 --> 00:25:31,520
false positives i mean you're going to

858
00:25:31,520 --> 00:25:34,000
hopefully have them but you also have

859
00:25:34,000 --> 00:25:35,919
hopefully a much better idea than red

860
00:25:35,919 --> 00:25:37,360
side does how things are laid out and

861
00:25:37,360 --> 00:25:39,120
how to not break things

862
00:25:39,120 --> 00:25:40,400
anyway so you have all this you know

863
00:25:40,400 --> 00:25:41,679
test cases and list updated listed with

864
00:25:41,679 --> 00:25:43,279
results

865
00:25:43,279 --> 00:25:45,760
uh so now let's take a few minutes and

866
00:25:45,760 --> 00:25:48,240
look at sort of a kind of real-ish case

867
00:25:48,240 --> 00:25:49,600
study and like i said in the beginning

868
00:25:49,600 --> 00:25:51,200
originally i was gonna you know think of

869
00:25:51,200 --> 00:25:53,200
something i've gone against tested and

870
00:25:53,200 --> 00:25:54,880
be like all right here just change the

871
00:25:54,880 --> 00:25:56,640
names to protect the innocent

872
00:25:56,640 --> 00:25:58,799
um that wouldn't be very kind so let's

873
00:25:58,799 --> 00:25:59,919
not do that

874
00:25:59,919 --> 00:26:01,039
instead the tool we're going to go

875
00:26:01,039 --> 00:26:03,200
against is kind of a

876
00:26:03,200 --> 00:26:05,600
kind of a mishmash of several other

877
00:26:05,600 --> 00:26:07,679
real-life things all of the all of what

878
00:26:07,679 --> 00:26:08,720
we're going to talk about has happened

879
00:26:08,720 --> 00:26:11,840
just not in one tool

880
00:26:12,000 --> 00:26:14,000
recap what we'll do in the case study um

881
00:26:14,000 --> 00:26:14,960
we're going to work out what this tool

882
00:26:14,960 --> 00:26:16,240
is meant to do and also what we'd like

883
00:26:16,240 --> 00:26:17,840
it to do we'll figure out some test

884
00:26:17,840 --> 00:26:19,440
cases and then

885
00:26:19,440 --> 00:26:20,480
and we won't actually do it but

886
00:26:20,480 --> 00:26:22,400
notionally get caught

887
00:26:22,400 --> 00:26:23,600
also please note when you're doing this

888
00:26:23,600 --> 00:26:25,360
there's no need for this all to be this

889
00:26:25,360 --> 00:26:27,679
formal like it can totally just be like

890
00:26:27,679 --> 00:26:30,000
you know got some time in one day and

891
00:26:30,000 --> 00:26:31,600
write it i i don't know how many times

892
00:26:31,600 --> 00:26:32,720
i've sat in meetings that i wasn't

893
00:26:32,720 --> 00:26:35,039
really part of like i was there because

894
00:26:35,039 --> 00:26:35,919
i don't know they wanted somebody with

895
00:26:35,919 --> 00:26:37,360
long hair and a beard

896
00:26:37,360 --> 00:26:38,320
and i was like i'll just write this

897
00:26:38,320 --> 00:26:40,400
thing and then like a month later i'm

898
00:26:40,400 --> 00:26:42,159
like let's use this thing and see what

899
00:26:42,159 --> 00:26:43,360
happens

900
00:26:43,360 --> 00:26:44,720
so every situation of course is

901
00:26:44,720 --> 00:26:46,240
different

902
00:26:46,240 --> 00:26:49,600
so here's our super duper effective tool

903
00:26:49,600 --> 00:26:51,840
which is really not one tool but it's a

904
00:26:51,840 --> 00:26:54,000
network-based bad guy catcher and maybe

905
00:26:54,000 --> 00:26:56,960
bad guy sometimes blocker um and and in

906
00:26:56,960 --> 00:26:58,880
the sales pitch again notional they were

907
00:26:58,880 --> 00:27:00,880
like this thing catches c2 this thing

908
00:27:00,880 --> 00:27:02,640
catches x-fil this thing catches lateral

909
00:27:02,640 --> 00:27:04,159
movement so on

910
00:27:04,159 --> 00:27:06,320
um and and what we've sort of figured

911
00:27:06,320 --> 00:27:07,840
out is it catches

912
00:27:07,840 --> 00:27:09,840
everything and it's meant to block

913
00:27:09,840 --> 00:27:11,600
obviously bad like high confidence

914
00:27:11,600 --> 00:27:13,120
malicious activity

915
00:27:13,120 --> 00:27:14,080
um

916
00:27:14,080 --> 00:27:15,919
totally not a contrived example that

917
00:27:15,919 --> 00:27:18,240
works for a 40-minute talk

918
00:27:18,240 --> 00:27:19,600
okay so step one let's figure out what

919
00:27:19,600 --> 00:27:21,919
what this tool is meant to do

920
00:27:21,919 --> 00:27:23,279
so from the vendor's description we know

921
00:27:23,279 --> 00:27:25,440
it catches c2x fill lateral movement

922
00:27:25,440 --> 00:27:26,960
cool

923
00:27:26,960 --> 00:27:28,640
we need a little more to go on than that

924
00:27:28,640 --> 00:27:30,720
though so we know from previous alerts

925
00:27:30,720 --> 00:27:32,720
notional alerts that dns tunneling gets

926
00:27:32,720 --> 00:27:34,240
caught okay that's something we can go

927
00:27:34,240 --> 00:27:35,279
on

928
00:27:35,279 --> 00:27:37,520
we know from a friend that you know high

929
00:27:37,520 --> 00:27:39,840
volume ssh is bad and that a tool like

930
00:27:39,840 --> 00:27:42,000
this that catches x-fil can reasonably

931
00:27:42,000 --> 00:27:44,720
be assumed to catch high volume ssh

932
00:27:44,720 --> 00:27:47,039
true story actually a lot i know

933
00:27:47,039 --> 00:27:48,640
network admin went to him security guy

934
00:27:48,640 --> 00:27:50,080
and it's like hey why does our network

935
00:27:50,080 --> 00:27:51,760
traffic go like this

936
00:27:51,760 --> 00:27:53,120
and he said

937
00:27:53,120 --> 00:27:54,240
that doesn't happen our network traffic

938
00:27:54,240 --> 00:27:56,080
doesn't go like this and

939
00:27:56,080 --> 00:27:58,000
and it goes like this if you scp out the

940
00:27:58,000 --> 00:28:00,000
entire company's code base as it turns

941
00:28:00,000 --> 00:28:00,880
out

942
00:28:00,880 --> 00:28:03,600
uh then it goes like this really fast

943
00:28:03,600 --> 00:28:07,360
so does somebody's paycheck um

944
00:28:07,360 --> 00:28:08,960
likewise the thing i alluded to earlier

945
00:28:08,960 --> 00:28:10,960
uh we know that you know again somebody

946
00:28:10,960 --> 00:28:12,240
else uh

947
00:28:12,240 --> 00:28:14,080
quite a bit ago was compromise

948
00:28:14,080 --> 00:28:15,360
cryptocurrency

949
00:28:15,360 --> 00:28:17,919
dropper persistent steel was a cron job

950
00:28:17,919 --> 00:28:19,679
and uh all it did was curl in a crown

951
00:28:19,679 --> 00:28:21,440
job that reached out to whatever so

952
00:28:21,440 --> 00:28:22,799
we'll assume that that's probably

953
00:28:22,799 --> 00:28:23,919
something that should get caught that's

954
00:28:23,919 --> 00:28:26,000
well within the scope of this tool

955
00:28:26,000 --> 00:28:28,559
um on the catch side on the block side

956
00:28:28,559 --> 00:28:29,760
from the vendor description we know it's

957
00:28:29,760 --> 00:28:32,000
high confidence malicious activity

958
00:28:32,000 --> 00:28:34,640
that's great uh what does that mean

959
00:28:34,640 --> 00:28:36,640
so let's poke into the documentation ssh

960
00:28:36,640 --> 00:28:38,000
tunnels are meant to be blocked and

961
00:28:38,000 --> 00:28:40,320
there is a tool that does this um

962
00:28:40,320 --> 00:28:42,640
and it's like hey we will not allow ssh

963
00:28:42,640 --> 00:28:43,600
tunnels to be made your only

964
00:28:43,600 --> 00:28:46,000
point-to-point shell type things

965
00:28:46,000 --> 00:28:48,000
sure that's cool um and then we just

966
00:28:48,000 --> 00:28:50,000
like take a first page of search results

967
00:28:50,000 --> 00:28:51,679
like high confidence malicious activity

968
00:28:51,679 --> 00:28:53,440
or just known malware and see what's

969
00:28:53,440 --> 00:28:55,120
there so you'll get some pretty old

970
00:28:55,120 --> 00:28:57,200
stuff that hopefully is caught you'll

971
00:28:57,200 --> 00:28:58,399
get some maybe modern stuff that

972
00:28:58,399 --> 00:29:00,480
hopefully is caught there are a few

973
00:29:00,480 --> 00:29:03,120
tools out there that um

974
00:29:03,120 --> 00:29:04,880
without naming names that are really

975
00:29:04,880 --> 00:29:06,799
really common to see in the wild

976
00:29:06,799 --> 00:29:08,799
uh if you can convince somebody to spend

977
00:29:08,799 --> 00:29:10,880
a couple thousand bucks for a license

978
00:29:10,880 --> 00:29:12,399
that would be an excellent test case for

979
00:29:12,399 --> 00:29:13,840
almost everything

980
00:29:13,840 --> 00:29:15,360
um and then we'll say from a previous

981
00:29:15,360 --> 00:29:17,440
job another true story we'll just comms

982
00:29:17,440 --> 00:29:19,360
to a malicious ip um

983
00:29:19,360 --> 00:29:22,399
we were using this network scanner tool

984
00:29:22,399 --> 00:29:23,679
and uh

985
00:29:23,679 --> 00:29:25,279
and the guy who was not actually on our

986
00:29:25,279 --> 00:29:26,320
team who was using the tool from our

987
00:29:26,320 --> 00:29:28,480
infrastructure for his own purposes like

988
00:29:28,480 --> 00:29:29,919
work purposes not that kind of own

989
00:29:29,919 --> 00:29:30,880
purposes

990
00:29:30,880 --> 00:29:31,840
uh

991
00:29:31,840 --> 00:29:33,200
scott called him and was like hey dude

992
00:29:33,200 --> 00:29:35,200
um what you got against russia

993
00:29:35,200 --> 00:29:36,880
he's supposed to be like 10. network

994
00:29:36,880 --> 00:29:38,960
right like internal he's like

995
00:29:38,960 --> 00:29:40,559
cool dudes i guess and uh turns out

996
00:29:40,559 --> 00:29:42,320
there was a bug in the tool but one of

997
00:29:42,320 --> 00:29:43,919
the defensive systems was like one of

998
00:29:43,919 --> 00:29:45,520
the defensive tools was like hey yeah

999
00:29:45,520 --> 00:29:48,320
coms to known c2 address comes to

1000
00:29:48,320 --> 00:29:50,799
like some ip that is known to

1001
00:29:50,799 --> 00:29:52,320
harbor bad things

1002
00:29:52,320 --> 00:29:53,600
nowadays

1003
00:29:53,600 --> 00:29:55,039
everyone this was before everything went

1004
00:29:55,039 --> 00:29:57,200
to cloud um it's a little less high

1005
00:29:57,200 --> 00:29:59,120
fidelity but we'll just assume for the

1006
00:29:59,120 --> 00:30:01,279
sake of a case study

1007
00:30:01,279 --> 00:30:04,240
in 10 minutes that uh that's a thing and

1008
00:30:04,240 --> 00:30:06,640
then sort of like stretch goals like hey

1009
00:30:06,640 --> 00:30:07,919
what else what else can we get this to

1010
00:30:07,919 --> 00:30:09,760
catch so let's ask the red team

1011
00:30:09,760 --> 00:30:11,840
um there is a red teamer that at least

1012
00:30:11,840 --> 00:30:14,000
one will say try icmp i know at least

1013
00:30:14,000 --> 00:30:15,679
three tools that block it

1014
00:30:15,679 --> 00:30:17,919
add that to the list um another person

1015
00:30:17,919 --> 00:30:19,440
to ask is the people who deal with

1016
00:30:19,440 --> 00:30:21,360
regulators like hey if you know if we

1017
00:30:21,360 --> 00:30:22,399
could

1018
00:30:22,399 --> 00:30:24,240
use defensive tools to help with

1019
00:30:24,240 --> 00:30:26,320
regulatory oddity things then it's a

1020
00:30:26,320 --> 00:30:28,640
conversation i've had before what what

1021
00:30:28,640 --> 00:30:29,679
would it be

1022
00:30:29,679 --> 00:30:31,919
um and the answer i got being working

1023
00:30:31,919 --> 00:30:33,840
for fintech is credit card numbers like

1024
00:30:33,840 --> 00:30:36,559
yeah cool if if you know that happens

1025
00:30:36,559 --> 00:30:38,000
sure

1026
00:30:38,000 --> 00:30:39,440
so we have a list of use cases like i

1027
00:30:39,440 --> 00:30:41,279
said make a list here's our list uh we

1028
00:30:41,279 --> 00:30:43,039
will go against dns tunneling high

1029
00:30:43,039 --> 00:30:45,200
volume ssh periodic http requests on the

1030
00:30:45,200 --> 00:30:48,320
catching side we'll try and test ssh

1031
00:30:48,320 --> 00:30:50,799
tunneling known malware google search

1032
00:30:50,799 --> 00:30:53,279
engine results and some malicious ip on

1033
00:30:53,279 --> 00:30:55,840
the blocking side and we'll just throw

1034
00:30:55,840 --> 00:30:59,120
some icmp tool at it and maybe some fake

1035
00:30:59,120 --> 00:31:01,039
but you know past one check credit card

1036
00:31:01,039 --> 00:31:02,000
numbers

1037
00:31:02,000 --> 00:31:02,840
see what

1038
00:31:02,840 --> 00:31:05,679
happens that then turns into a bunch of

1039
00:31:05,679 --> 00:31:06,960
test cases

1040
00:31:06,960 --> 00:31:08,960
which look something like this

1041
00:31:08,960 --> 00:31:10,240
um

1042
00:31:10,240 --> 00:31:13,039
do i have a little pointer thing

1043
00:31:13,039 --> 00:31:14,720
no

1044
00:31:14,720 --> 00:31:16,320
sometimes google gives you pointers and

1045
00:31:16,320 --> 00:31:18,080
sometimes it doesn't it's my yeah the

1046
00:31:18,080 --> 00:31:20,000
crystal's visible yeah so we'll just

1047
00:31:20,000 --> 00:31:21,760
lump them sort of into three things that

1048
00:31:21,760 --> 00:31:23,919
are our imaginary tools meant to do it's

1049
00:31:23,919 --> 00:31:25,440
meant to catch c2 protocols we'll have a

1050
00:31:25,440 --> 00:31:26,559
bunch of test cases meant to catch well

1051
00:31:26,559 --> 00:31:27,919
known malware bunch of test cases meant

1052
00:31:27,919 --> 00:31:30,480
to catch x fill bunch of test cases um

1053
00:31:30,480 --> 00:31:32,799
i will not read these all out i promise

1054
00:31:32,799 --> 00:31:34,799
i would like to point out a couple that

1055
00:31:34,799 --> 00:31:37,600
are sort of interesting um

1056
00:31:37,600 --> 00:31:39,120
it doesn't have to be

1057
00:31:39,120 --> 00:31:41,519
elegant necessarily uh this is actually

1058
00:31:41,519 --> 00:31:44,880
a way to get dns on twitter um

1059
00:31:44,880 --> 00:31:47,360
you can't actually get dns feel this way

1060
00:31:47,360 --> 00:31:48,720
we're testing a network thing it doesn't

1061
00:31:48,720 --> 00:31:50,399
really matter that you know the

1062
00:31:50,399 --> 00:31:51,519
likelihood of finding something like

1063
00:31:51,519 --> 00:31:53,039
that in your logs is low

1064
00:31:53,039 --> 00:31:54,159
um

1065
00:31:54,159 --> 00:31:55,679
what wrote something similar to this and

1066
00:31:55,679 --> 00:31:57,120
like the guy next to me was like hugging

1067
00:31:57,120 --> 00:31:59,360
his tummy and rocking back and forth and

1068
00:31:59,360 --> 00:32:01,360
uh and at that point i realized pearl is

1069
00:32:01,360 --> 00:32:03,679
an awesome language to write things in

1070
00:32:03,679 --> 00:32:05,039
uh because

1071
00:32:05,039 --> 00:32:06,640
i can't yeah i would have trouble

1072
00:32:06,640 --> 00:32:08,559
reading that somebody looking at that by

1073
00:32:08,559 --> 00:32:10,159
catching it the same thing gives me

1074
00:32:10,159 --> 00:32:11,360
another hour

1075
00:32:11,360 --> 00:32:12,640
um

1076
00:32:12,640 --> 00:32:14,320
and then similar on the the simple side

1077
00:32:14,320 --> 00:32:15,519
here's that curl and loop i was talking

1078
00:32:15,519 --> 00:32:16,480
about

1079
00:32:16,480 --> 00:32:18,960
that's girl in a loop that's all that is

1080
00:32:18,960 --> 00:32:20,960
so that works um

1081
00:32:20,960 --> 00:32:22,559
and and it can be really simple or you

1082
00:32:22,559 --> 00:32:24,799
can go complicated or so uh we were

1083
00:32:24,799 --> 00:32:26,399
talking about you know first search

1084
00:32:26,399 --> 00:32:28,399
first page of i literally typed in like

1085
00:32:28,399 --> 00:32:30,799
dns tunneling entered and this there is

1086
00:32:30,799 --> 00:32:32,320
a tool i changed the name um but there's

1087
00:32:32,320 --> 00:32:33,440
a tool written in ruby that i've used

1088
00:32:33,440 --> 00:32:35,120
before it's a pretty good tool

1089
00:32:35,120 --> 00:32:36,960
um yeah throw on there see if it works

1090
00:32:36,960 --> 00:32:38,559
that kind of thing

1091
00:32:38,559 --> 00:32:40,720
um

1092
00:32:40,720 --> 00:32:42,799
anything else of note

1093
00:32:42,799 --> 00:32:44,240
no

1094
00:32:44,240 --> 00:32:46,399
so also also worth mentioning it doesn't

1095
00:32:46,399 --> 00:32:48,480
have to be exactly faithful so this was

1096
00:32:48,480 --> 00:32:51,919
scpus the high volume ssh thing um scp

1097
00:32:51,919 --> 00:32:53,279
on the wire is going to look like ssh

1098
00:32:53,279 --> 00:32:54,880
because it's tunnel over ssh right so

1099
00:32:54,880 --> 00:32:57,360
that that is sort of that

1100
00:32:57,360 --> 00:32:59,840
a few tips that i've gotten just learned

1101
00:32:59,840 --> 00:33:00,799
over the years when you're going to do

1102
00:33:00,799 --> 00:33:04,240
this use long format options in syntax

1103
00:33:04,240 --> 00:33:05,200
so

1104
00:33:05,200 --> 00:33:07,919
things like curl here um i probably

1105
00:33:07,919 --> 00:33:09,440
should just use hyphen hyphen silent

1106
00:33:09,440 --> 00:33:11,840
there much like down here form uh that

1107
00:33:11,840 --> 00:33:13,120
way when you're reading it and more

1108
00:33:13,120 --> 00:33:14,080
importantly when you hand this

1109
00:33:14,080 --> 00:33:15,120
spreadsheet something somebody's gonna

1110
00:33:15,120 --> 00:33:15,919
ask for the spreadsheet and the

1111
00:33:15,919 --> 00:33:17,200
spreadsheet to somebody with like red

1112
00:33:17,200 --> 00:33:19,120
boxes everywhere or whatever it'll be a

1113
00:33:19,120 --> 00:33:21,360
lot more obvious what it is

1114
00:33:21,360 --> 00:33:23,600
um speaking of the spreadsheet make a

1115
00:33:23,600 --> 00:33:24,960
copy uh

1116
00:33:24,960 --> 00:33:26,880
it has happened in the past

1117
00:33:26,880 --> 00:33:28,559
years ago that i had this nice

1118
00:33:28,559 --> 00:33:30,480
spreadsheet color coded and all sorts of

1119
00:33:30,480 --> 00:33:32,240
good notes and whatnot and

1120
00:33:32,240 --> 00:33:33,679
and we were handing it to somebody i

1121
00:33:33,679 --> 00:33:36,080
forget who and it it turns out that my

1122
00:33:36,080 --> 00:33:37,760
spreadsheet changed and things that i

1123
00:33:37,760 --> 00:33:39,200
was like hey this is important for

1124
00:33:39,200 --> 00:33:40,720
whoever it was to know

1125
00:33:40,720 --> 00:33:42,960
were deemed not as important uh by

1126
00:33:42,960 --> 00:33:44,399
probably a sales guy

1127
00:33:44,399 --> 00:33:46,080
uh so yeah copy your spreadsheet you

1128
00:33:46,080 --> 00:33:47,919
might need it i i did not and then i had

1129
00:33:47,919 --> 00:33:50,240
to go like reconstruct it um

1130
00:33:50,240 --> 00:33:51,360
also make sure your tools are fairly

1131
00:33:51,360 --> 00:33:53,120
easy to use there's

1132
00:33:53,120 --> 00:33:54,240
without getting any details there's a

1133
00:33:54,240 --> 00:33:56,159
tool set that i wrote to do this sort of

1134
00:33:56,159 --> 00:33:58,480
thing uh that is still in use at an

1135
00:33:58,480 --> 00:34:00,480
organization that i have not been a part

1136
00:34:00,480 --> 00:34:02,000
of for a few years now

1137
00:34:02,000 --> 00:34:04,000
um but you know i i turned it into a

1138
00:34:04,000 --> 00:34:05,840
just sort of like a a draggy double

1139
00:34:05,840 --> 00:34:08,079
clicky thing that worked pretty good

1140
00:34:08,079 --> 00:34:09,280
um

1141
00:34:09,280 --> 00:34:11,199
keeping logs is also important pcap is

1142
00:34:11,199 --> 00:34:13,679
good as a log uh and i've had many

1143
00:34:13,679 --> 00:34:15,040
people say hey can you give me the p cap

1144
00:34:15,040 --> 00:34:16,159
for that

1145
00:34:16,159 --> 00:34:17,440
i am not entirely sure what somebody's

1146
00:34:17,440 --> 00:34:19,280
going to do with 100 gig of ssh p cap

1147
00:34:19,280 --> 00:34:21,760
but somebody will ask um and likewise

1148
00:34:21,760 --> 00:34:23,440
just logs of like what you're doing uh

1149
00:34:23,440 --> 00:34:25,199
screen recordings are also not a bad

1150
00:34:25,199 --> 00:34:26,800
thing um

1151
00:34:26,800 --> 00:34:28,079
that when i was talking about the icmp

1152
00:34:28,079 --> 00:34:29,520
thing the vendor was like hey can you

1153
00:34:29,520 --> 00:34:31,599
send us a screen recording of you

1154
00:34:31,599 --> 00:34:33,839
abusing icmp and i did and i hit up

1155
00:34:33,839 --> 00:34:37,599
arrow and enter and it was like done

1156
00:34:37,599 --> 00:34:38,639
it happened

1157
00:34:38,639 --> 00:34:41,119
um and then last last but not least uh

1158
00:34:41,119 --> 00:34:42,800
and it will happen come prepared with

1159
00:34:42,800 --> 00:34:44,560
answers to the hand wavy like no that

1160
00:34:44,560 --> 00:34:46,399
could never happen there are no droids

1161
00:34:46,399 --> 00:34:49,359
here move along uh you'll find yourself

1162
00:34:49,359 --> 00:34:50,719
in these meetings where like you'll

1163
00:34:50,719 --> 00:34:52,000
start the meeting and you'll be like

1164
00:34:52,000 --> 00:34:53,760
yeah so i tested

1165
00:34:53,760 --> 00:34:54,960
i don't know just to pull one of these

1166
00:34:54,960 --> 00:34:56,800
things out yeah we wrote a tool to do

1167
00:34:56,800 --> 00:34:58,400
icmp tunneling we were you know had some

1168
00:34:58,400 --> 00:34:59,760
time we wrote it

1169
00:34:59,760 --> 00:35:01,280
and uh

1170
00:35:01,280 --> 00:35:02,480
you know it worked and then somebody

1171
00:35:02,480 --> 00:35:03,839
would be like yeah but you know you can

1172
00:35:03,839 --> 00:35:05,760
sit and write tools the bad guy class

1173
00:35:05,760 --> 00:35:06,800
we're worried we're not really worried

1174
00:35:06,800 --> 00:35:08,640
about the you know fsb or something

1175
00:35:08,640 --> 00:35:10,400
we're worried about like you know our

1176
00:35:10,400 --> 00:35:11,599
lower level hackers they're not gonna be

1177
00:35:11,599 --> 00:35:13,040
able to write their tools only focus on

1178
00:35:13,040 --> 00:35:15,520
like known malware

1179
00:35:15,520 --> 00:35:17,040
um and then you'll sit in the meeting

1180
00:35:17,040 --> 00:35:19,440
and and you'll be like yeah so we also

1181
00:35:19,440 --> 00:35:22,079
did this thing where we um

1182
00:35:22,079 --> 00:35:23,760
you know we use curl and loop like you

1183
00:35:23,760 --> 00:35:25,040
know kind of the lower level guys you're

1184
00:35:25,040 --> 00:35:26,720
talking about and and somebody will

1185
00:35:26,720 --> 00:35:28,640
invariably tell you yeah but you know

1186
00:35:28,640 --> 00:35:30,079
we're looking at more sophisticated

1187
00:35:30,079 --> 00:35:31,280
adversaries it's true story i mean these

1188
00:35:31,280 --> 00:35:32,720
things happen all the time in meetings

1189
00:35:32,720 --> 00:35:34,320
um and and you're sitting there thinking

1190
00:35:34,320 --> 00:35:36,480
like all right either i'm a wizard or

1191
00:35:36,480 --> 00:35:38,000
i'm a knucklehead i don't know which i

1192
00:35:38,000 --> 00:35:39,359
am

1193
00:35:39,359 --> 00:35:40,320
and then sometimes you can be

1194
00:35:40,320 --> 00:35:41,760
mathematical and possibilities and i've

1195
00:35:41,760 --> 00:35:43,920
been there too um i was i was working

1196
00:35:43,920 --> 00:35:45,040
with a group of mathematicians who were

1197
00:35:45,040 --> 00:35:47,680
using math uh that that is not sort of

1198
00:35:47,680 --> 00:35:49,920
math i understand to catch bad guys and

1199
00:35:49,920 --> 00:35:52,320
like take various data points and and

1200
00:35:52,320 --> 00:35:54,960
turn that into a score basically and one

1201
00:35:54,960 --> 00:35:57,040
of them one of them was convinced that i

1202
00:35:57,040 --> 00:35:58,800
think it was like a one minute beacon

1203
00:35:58,800 --> 00:36:00,480
interval or something was not a

1204
00:36:00,480 --> 00:36:03,599
malicious beacon interval

1205
00:36:03,839 --> 00:36:05,119
i had a shell with a one minute beacon

1206
00:36:05,119 --> 00:36:06,640
interval at that point but

1207
00:36:06,640 --> 00:36:09,040
you know these things happen uh so yeah

1208
00:36:09,040 --> 00:36:11,200
be prepared to be you know you'll have

1209
00:36:11,200 --> 00:36:13,119
all sorts of um sort of resolution of

1210
00:36:13,119 --> 00:36:15,440
cognitive dissonance things um

1211
00:36:15,440 --> 00:36:16,560
they happen or you know to be

1212
00:36:16,560 --> 00:36:18,880
mathematically impossible

1213
00:36:18,880 --> 00:36:21,440
all right quick recap so um

1214
00:36:21,440 --> 00:36:22,880
tools it's really hard to know if they

1215
00:36:22,880 --> 00:36:24,720
actually work when you're using them

1216
00:36:24,720 --> 00:36:26,400
before you just test them um and even if

1217
00:36:26,400 --> 00:36:27,440
you test them you'll only know if they

1218
00:36:27,440 --> 00:36:28,720
work for what you've tested but it's

1219
00:36:28,720 --> 00:36:31,520
still quite a bit better than probably

1220
00:36:31,520 --> 00:36:32,400
um

1221
00:36:32,400 --> 00:36:34,079
i think blue teamers sort of the thesis

1222
00:36:34,079 --> 00:36:35,599
of the talk uh the best people to test

1223
00:36:35,599 --> 00:36:36,720
are blue teamers you have the most

1224
00:36:36,720 --> 00:36:37,599
knowledge

1225
00:36:37,599 --> 00:36:40,880
um you have the most uh skin in the game

1226
00:36:40,880 --> 00:36:43,040
really so you know you're the best and

1227
00:36:43,040 --> 00:36:44,480
then when you do the testing itself

1228
00:36:44,480 --> 00:36:46,640
figure out what the tool should do

1229
00:36:46,640 --> 00:36:49,119
uh come up with some test cases and do

1230
00:36:49,119 --> 00:36:50,880
it

1231
00:36:50,880 --> 00:36:52,960
uh thank you for watching uh happy to

1232
00:36:52,960 --> 00:36:54,720
take questions if there are any

1233
00:36:54,720 --> 00:36:56,160
and again that will link you to the

1234
00:36:56,160 --> 00:36:59,920
slides which makes you all the fun stuff

1235
00:37:01,200 --> 00:37:03,119
none

1236
00:37:03,119 --> 00:37:06,560
it's like pub is open now

1237
00:37:07,440 --> 00:37:09,119
oh

1238
00:37:09,119 --> 00:37:11,599
all right non-drinker there

1239
00:37:11,599 --> 00:37:13,920
well thank you for the amazing talk was

1240
00:37:13,920 --> 00:37:16,160
very interesting just

1241
00:37:16,160 --> 00:37:18,960
you let me think in

1242
00:37:18,960 --> 00:37:21,920
it is true that the red red team can

1243
00:37:21,920 --> 00:37:22,800
help

1244
00:37:22,800 --> 00:37:25,760
but you you know also

1245
00:37:25,760 --> 00:37:28,160
when you are testing that the tool

1246
00:37:28,160 --> 00:37:30,079
because at the end that is the message

1247
00:37:30,079 --> 00:37:32,800
you you gave us that you we need to test

1248
00:37:32,800 --> 00:37:35,200
in order to check that the tool actually

1249
00:37:35,200 --> 00:37:37,839
work we need to think

1250
00:37:37,839 --> 00:37:40,240
like the attacker so

1251
00:37:40,240 --> 00:37:42,880
so in a way we need to think like like

1252
00:37:42,880 --> 00:37:45,760
the red red team is thinking you're just

1253
00:37:45,760 --> 00:37:48,839
curious what what do you

1254
00:37:48,839 --> 00:37:52,320
think i have a slide for you okay yeah

1255
00:37:52,320 --> 00:37:54,320
so things i'm thinking with regards to

1256
00:37:54,320 --> 00:37:56,320
one tool these are the things on my on

1257
00:37:56,320 --> 00:37:58,000
my brain on my mind

1258
00:37:58,000 --> 00:37:59,280
um

1259
00:37:59,280 --> 00:38:01,599
you know mostly i'm thinking

1260
00:38:01,599 --> 00:38:03,359
i have to full tier one or whatever i

1261
00:38:03,359 --> 00:38:05,280
was automated whatever the first step

1262
00:38:05,280 --> 00:38:06,640
that makes the decision because if

1263
00:38:06,640 --> 00:38:08,000
whatever the first step that makes that

1264
00:38:08,000 --> 00:38:11,040
decision uh decisioning right here um

1265
00:38:11,040 --> 00:38:12,800
whatever that is if that's like yeah

1266
00:38:12,800 --> 00:38:14,160
it's cool then

1267
00:38:14,160 --> 00:38:15,520
yeah that's cool

1268
00:38:15,520 --> 00:38:17,119
so uh that's that's the first thing and

1269
00:38:17,119 --> 00:38:19,359
then figure out what

1270
00:38:19,359 --> 00:38:20,720
what i can do that won't get blocked

1271
00:38:20,720 --> 00:38:22,560
maybe it blends in maybe there's just no

1272
00:38:22,560 --> 00:38:24,240
capability against it and things i do

1273
00:38:24,240 --> 00:38:25,920
that won't just not get blocked but

1274
00:38:25,920 --> 00:38:27,200
won't get caught

1275
00:38:27,200 --> 00:38:28,320
they're not i mean there's subtle

1276
00:38:28,320 --> 00:38:30,880
differences there so that's kind of

1277
00:38:30,880 --> 00:38:32,560
in one half of a slide sort of the

1278
00:38:32,560 --> 00:38:34,240
mentality there

1279
00:38:34,240 --> 00:38:36,240
yeah um but happy to talk to you

1280
00:38:36,240 --> 00:38:37,680
afterwards much longer conversation if

1281
00:38:37,680 --> 00:38:40,160
you'd like yeah good question though

1282
00:38:40,160 --> 00:38:43,680
um any other questions

1283
00:38:44,560 --> 00:38:49,240
all right cool thank you very much

