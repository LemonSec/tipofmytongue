1
00:00:05,920 --> 00:00:07,839
hi everyone my name is lindsey k

2
00:00:07,839 --> 00:00:08,960
and today i'm going to talk to you a

3
00:00:08,960 --> 00:00:10,880
little bit about a gregor awakens taking

4
00:00:10,880 --> 00:00:14,480
a tour of threat actors new digs

5
00:00:15,519 --> 00:00:18,320
so a bit about me um just as was

6
00:00:18,320 --> 00:00:19,279
mentioned i'm

7
00:00:19,279 --> 00:00:21,039
by trade and malware analyst and reverse

8
00:00:21,039 --> 00:00:23,119
engineer and i particularly really like

9
00:00:23,119 --> 00:00:24,080
taking apart weird

10
00:00:24,080 --> 00:00:25,920
cryptography during my analysis so i'll

11
00:00:25,920 --> 00:00:27,279
talk a little bit about that in this

12
00:00:27,279 --> 00:00:28,080
talk

13
00:00:28,080 --> 00:00:29,840
um and currently i run instinct group's

14
00:00:29,840 --> 00:00:31,359
technical team at recorded future

15
00:00:31,359 --> 00:00:33,040
insect group is the threat intelligence

16
00:00:33,040 --> 00:00:35,600
team for the company

17
00:00:35,600 --> 00:00:36,960
so today we're going to start with some

18
00:00:36,960 --> 00:00:38,399
background on a gregor then we're going

19
00:00:38,399 --> 00:00:40,160
to do a technical deep dive

20
00:00:40,160 --> 00:00:41,920
talk about some technical overlaps with

21
00:00:41,920 --> 00:00:43,600
other threat actors and then finally

22
00:00:43,600 --> 00:00:44,000
finish

23
00:00:44,000 --> 00:00:47,120
up with ways to track a gregor so for

24
00:00:47,120 --> 00:00:48,160
those of you who aren't familiar with

25
00:00:48,160 --> 00:00:49,360
mcgregor they began

26
00:00:49,360 --> 00:00:51,760
operating in september 2020 and they're

27
00:00:51,760 --> 00:00:53,280
considered a variant of the sekhmet

28
00:00:53,280 --> 00:00:54,079
family

29
00:00:54,079 --> 00:00:55,760
so around the same time in september

30
00:00:55,760 --> 00:00:58,079
2020 maze another ransomware family

31
00:00:58,079 --> 00:01:00,559
stopped encrypting new victims so at the

32
00:01:00,559 --> 00:01:02,000
time that maze went down

33
00:01:02,000 --> 00:01:03,600
mcgregor started coming up and it's

34
00:01:03,600 --> 00:01:05,199
suspected that many affiliates of the

35
00:01:05,199 --> 00:01:06,720
maze ransomware variant have likely

36
00:01:06,720 --> 00:01:08,080
moved to the mcgregor

37
00:01:08,080 --> 00:01:11,200
ransomware as a service group like many

38
00:01:11,200 --> 00:01:12,880
big game ransomware hunting

39
00:01:12,880 --> 00:01:15,439
uh groups they do the name and shame of

40
00:01:15,439 --> 00:01:16,880
victims on their extortion state of

41
00:01:16,880 --> 00:01:17,759
gregor news

42
00:01:17,759 --> 00:01:19,280
and you can see an example of one of

43
00:01:19,280 --> 00:01:21,520
these name and shame instances on a

44
00:01:21,520 --> 00:01:25,360
gregor news in the image on the right

45
00:01:25,680 --> 00:01:27,920
so in mid-february members of the gregor

46
00:01:27,920 --> 00:01:29,119
ransomware's service were actually

47
00:01:29,119 --> 00:01:30,560
arrested in the ukraine

48
00:01:30,560 --> 00:01:33,759
and at the time so since about 2 12 21

49
00:01:33,759 --> 00:01:35,920
we saw their infrastructure so their c2s

50
00:01:35,920 --> 00:01:37,520
and that leak site

51
00:01:37,520 --> 00:01:40,000
have been down so since then they've

52
00:01:40,000 --> 00:01:41,840
stopped encrypting new victims and they

53
00:01:41,840 --> 00:01:43,200
don't appear to rebuild their

54
00:01:43,200 --> 00:01:44,560
infrastructure suggesting that they are

55
00:01:44,560 --> 00:01:46,960
no longer active

56
00:01:46,960 --> 00:01:48,399
so for those of you who aren't familiar

57
00:01:48,399 --> 00:01:49,840
with what ransomware as a service is

58
00:01:49,840 --> 00:01:51,680
i'll give you a brief explanation

59
00:01:51,680 --> 00:01:53,520
so the concept of ransomware service

60
00:01:53,520 --> 00:01:55,200
starts with a ransomware developer who

61
00:01:55,200 --> 00:01:55,920
creates

62
00:01:55,920 --> 00:01:57,920
ransomware code so this individual is

63
00:01:57,920 --> 00:01:59,439
technical enough to write the code

64
00:01:59,439 --> 00:02:01,360
create it package it up and then make it

65
00:02:01,360 --> 00:02:02,560
something that could

66
00:02:02,560 --> 00:02:03,920
you know actually be effective on a

67
00:02:03,920 --> 00:02:06,079
victim system and then another group of

68
00:02:06,079 --> 00:02:07,759
individuals called affiliates can either

69
00:02:07,759 --> 00:02:08,080
buy

70
00:02:08,080 --> 00:02:09,758
or release this malware to execute their

71
00:02:09,758 --> 00:02:11,920
own attacks so these individuals really

72
00:02:11,920 --> 00:02:13,680
don't have to be technical or capable of

73
00:02:13,680 --> 00:02:15,440
writing their own ransomware

74
00:02:15,440 --> 00:02:16,560
but they have to have some sort of

75
00:02:16,560 --> 00:02:18,000
appetite and desire to conduct

76
00:02:18,000 --> 00:02:20,080
ransomware attacks themselves

77
00:02:20,080 --> 00:02:22,720
so the developer if these affiliates are

78
00:02:22,720 --> 00:02:24,720
successful in

79
00:02:24,720 --> 00:02:27,120
getting a ransom from an organization um

80
00:02:27,120 --> 00:02:28,800
we'll usually get some cut of that

81
00:02:28,800 --> 00:02:30,400
ransom so that's how the business model

82
00:02:30,400 --> 00:02:31,519
works

83
00:02:31,519 --> 00:02:33,200
and because mcgregor uses that

84
00:02:33,200 --> 00:02:34,879
ransomware as a service model

85
00:02:34,879 --> 00:02:36,400
um you'll notice and we'll talk a little

86
00:02:36,400 --> 00:02:38,640
bit about this the ttps observed in the

87
00:02:38,640 --> 00:02:39,120
attacks

88
00:02:39,120 --> 00:02:40,720
will vary so all these different

89
00:02:40,720 --> 00:02:42,239
affiliates will bring different

90
00:02:42,239 --> 00:02:43,360
techniques around

91
00:02:43,360 --> 00:02:45,280
initial access so how they initially get

92
00:02:45,280 --> 00:02:46,800
on the victim system

93
00:02:46,800 --> 00:02:48,720
um some of the pre-encryption things

94
00:02:48,720 --> 00:02:50,640
that they'll use so for lateral movement

95
00:02:50,640 --> 00:02:52,080
so it's how do they move around the

96
00:02:52,080 --> 00:02:53,040
victim's network

97
00:02:53,040 --> 00:02:54,800
um get to other parts of it you know

98
00:02:54,800 --> 00:02:56,160
really they want to create maximum

99
00:02:56,160 --> 00:02:57,920
impact so making sure you could encrypt

100
00:02:57,920 --> 00:02:59,680
as much as possible is key

101
00:02:59,680 --> 00:03:01,200
i'm reconnaissance still collecting

102
00:03:01,200 --> 00:03:03,040
information about the victim the

103
00:03:03,040 --> 00:03:04,239
organization

104
00:03:04,239 --> 00:03:05,840
other information that might be valuable

105
00:03:05,840 --> 00:03:07,760
to them in again increasing the impact

106
00:03:07,760 --> 00:03:08,720
of their attack

107
00:03:08,720 --> 00:03:10,159
and then doing some sort of credential

108
00:03:10,159 --> 00:03:12,159
stealing so enabling further access or

109
00:03:12,159 --> 00:03:14,159
more extensive access

110
00:03:14,159 --> 00:03:16,159
but really this can extend to tools used

111
00:03:16,159 --> 00:03:17,519
in any stage of the attack

112
00:03:17,519 --> 00:03:19,840
so sometimes you'll see between the

113
00:03:19,840 --> 00:03:21,360
initial access and the dropping the

114
00:03:21,360 --> 00:03:22,239
ransomware

115
00:03:22,239 --> 00:03:23,920
additional tools will be dropped based

116
00:03:23,920 --> 00:03:25,280
on the desire of the affiliate

117
00:03:25,280 --> 00:03:28,400
um the needs of the attack what the

118
00:03:28,400 --> 00:03:29,920
organization's security looks like and

119
00:03:29,920 --> 00:03:32,159
really what they're trying to accomplish

120
00:03:32,159 --> 00:03:34,239
so it's also worth noting that some

121
00:03:34,239 --> 00:03:35,200
affiliates

122
00:03:35,200 --> 00:03:37,440
either may be or have been involved with

123
00:03:37,440 --> 00:03:38,959
other ransomware groups

124
00:03:38,959 --> 00:03:40,480
so they might not just be working for

125
00:03:40,480 --> 00:03:42,080
this one ransomware as a service group

126
00:03:42,080 --> 00:03:43,599
but they might be working for others as

127
00:03:43,599 --> 00:03:44,239
well

128
00:03:44,239 --> 00:03:45,840
and it's key to know that while some

129
00:03:45,840 --> 00:03:47,599
ransomwares and service groups are free

130
00:03:47,599 --> 00:03:48,000
for

131
00:03:48,000 --> 00:03:50,319
whoever to join if they'd like some are

132
00:03:50,319 --> 00:03:53,920
very exclusive and invite only

133
00:03:53,920 --> 00:03:56,560
so to give you an idea of exactly how

134
00:03:56,560 --> 00:03:58,239
prolific mcgregor was while it was

135
00:03:58,239 --> 00:03:59,519
active

136
00:03:59,519 --> 00:04:02,159
by the end of 2020 they had claimed 206

137
00:04:02,159 --> 00:04:02,799
victims

138
00:04:02,799 --> 00:04:04,879
so this included many large well-known

139
00:04:04,879 --> 00:04:06,319
organizations that i'm sure you've heard

140
00:04:06,319 --> 00:04:06,640
of

141
00:04:06,640 --> 00:04:09,120
um and to give you an idea of kind of

142
00:04:09,120 --> 00:04:10,640
how this distributed

143
00:04:10,640 --> 00:04:12,080
if you look at this graph of ransomware

144
00:04:12,080 --> 00:04:13,920
attacks by family so through november

145
00:04:13,920 --> 00:04:14,799
2020

146
00:04:14,799 --> 00:04:17,199
you'll see that maze represents about 26

147
00:04:17,199 --> 00:04:18,238
percent of the attacks

148
00:04:18,238 --> 00:04:20,079
but keep in mind at this time maze had

149
00:04:20,079 --> 00:04:22,000
been active for the better part of about

150
00:04:22,000 --> 00:04:23,120
nine months

151
00:04:23,120 --> 00:04:25,120
um and if you look at a gregor at this

152
00:04:25,120 --> 00:04:26,720
point they'd only been active for about

153
00:04:26,720 --> 00:04:28,320
two and represented about

154
00:04:28,320 --> 00:04:32,160
13 so they kind of spun up very quickly

155
00:04:32,160 --> 00:04:33,919
and then really got to

156
00:04:33,919 --> 00:04:36,240
um their whole encrypting and

157
00:04:36,240 --> 00:04:39,680
victimizing organizations

158
00:04:39,759 --> 00:04:42,240
so in order to understand how a gregor

159
00:04:42,240 --> 00:04:43,840
ransomware attacks unfold in the tools

160
00:04:43,840 --> 00:04:45,440
that they use i've divided the attack

161
00:04:45,440 --> 00:04:46,720
into four

162
00:04:46,720 --> 00:04:49,040
kind of main stages so initial access

163
00:04:49,040 --> 00:04:50,639
like we talked about so

164
00:04:50,639 --> 00:04:52,639
how the threat actor gains access to the

165
00:04:52,639 --> 00:04:54,320
organizational system

166
00:04:54,320 --> 00:04:56,240
then lateral movement and reconnaissance

167
00:04:56,240 --> 00:04:58,639
so this is that kind of dwell time

168
00:04:58,639 --> 00:05:00,400
so dwell time could last anywhere

169
00:05:00,400 --> 00:05:02,000
between you know a couple hours

170
00:05:02,000 --> 00:05:05,120
or up to you know days or weeks so

171
00:05:05,120 --> 00:05:07,039
it really does vary based on the

172
00:05:07,039 --> 00:05:08,880
affiliate involved and

173
00:05:08,880 --> 00:05:10,160
different groups and really what their

174
00:05:10,160 --> 00:05:12,800
needs are so um i wasn't able to find

175
00:05:12,800 --> 00:05:14,800
any statistics on the average

176
00:05:14,800 --> 00:05:16,720
dwell time for a mcgregor attack but i

177
00:05:16,720 --> 00:05:18,479
would suggest that it might not be very

178
00:05:18,479 --> 00:05:19,039
meaningful

179
00:05:19,039 --> 00:05:20,479
given the fact that there are so many

180
00:05:20,479 --> 00:05:22,800
different affiliates involved and

181
00:05:22,800 --> 00:05:25,919
it very likely depends on which

182
00:05:25,919 --> 00:05:27,360
affiliate is doing what and what the

183
00:05:27,360 --> 00:05:29,360
needs of their attack are

184
00:05:29,360 --> 00:05:31,039
so moving on to data exfiltration

185
00:05:31,039 --> 00:05:32,800
because as you can imagine extortion is

186
00:05:32,800 --> 00:05:34,560
more effective when you have something

187
00:05:34,560 --> 00:05:36,479
to extort the organization with so this

188
00:05:36,479 --> 00:05:39,039
will be where the threat actor will

189
00:05:39,039 --> 00:05:40,880
exfiltrate this victim's data so that

190
00:05:40,880 --> 00:05:42,400
they can post on their league site and

191
00:05:42,400 --> 00:05:44,479
then attempt to use it to

192
00:05:44,479 --> 00:05:46,160
have the threat actor or have the

193
00:05:46,160 --> 00:05:48,160
organization provide them with money so

194
00:05:48,160 --> 00:05:50,320
that they take down and don't leak it

195
00:05:50,320 --> 00:05:51,759
and then finally the dropping of the

196
00:05:51,759 --> 00:05:53,840
ransomware which i'm sure is the kind of

197
00:05:53,840 --> 00:05:54,320
most

198
00:05:54,320 --> 00:05:55,840
familiar part to all of us of a

199
00:05:55,840 --> 00:05:57,600
ransomware attack and obviously the one

200
00:05:57,600 --> 00:05:58,080
that

201
00:05:58,080 --> 00:06:00,479
kind of creates the most um notice

202
00:06:00,479 --> 00:06:02,240
because now your victim system is

203
00:06:02,240 --> 00:06:04,800
suddenly encrypted

204
00:06:04,800 --> 00:06:06,319
so to look at some of the tools that are

205
00:06:06,319 --> 00:06:08,639
used by in association with the gregor

206
00:06:08,639 --> 00:06:09,919
attacks at each stage

207
00:06:09,919 --> 00:06:12,479
uh let's start with initial access so

208
00:06:12,479 --> 00:06:12,960
here

209
00:06:12,960 --> 00:06:16,000
um what we observed is that primarily

210
00:06:16,000 --> 00:06:19,120
three fairly common um techniques used

211
00:06:19,120 --> 00:06:20,479
among you know

212
00:06:20,479 --> 00:06:22,880
phishing is used among apts as well as a

213
00:06:22,880 --> 00:06:24,400
lot of other rants a big game ransomware

214
00:06:24,400 --> 00:06:26,000
hunting as well really everybody does

215
00:06:26,000 --> 00:06:27,120
use phishing

216
00:06:27,120 --> 00:06:29,039
um and then rdp exploits and vpn

217
00:06:29,039 --> 00:06:31,520
exploits so we've seen those

218
00:06:31,520 --> 00:06:33,199
different kinds of techniques used with

219
00:06:33,199 --> 00:06:34,800
many other big game ransomware hunting

220
00:06:34,800 --> 00:06:36,479
so really nothing super aggressor

221
00:06:36,479 --> 00:06:38,240
specific or distinctive there

222
00:06:38,240 --> 00:06:40,720
but again these are effective and fairly

223
00:06:40,720 --> 00:06:41,280
popular

224
00:06:41,280 --> 00:06:44,080
among threat actors moving into the

225
00:06:44,080 --> 00:06:45,600
lateral movement reconnaissance stage

226
00:06:45,600 --> 00:06:46,960
i'm sure you see a bunch of tools that

227
00:06:46,960 --> 00:06:48,639
you're super familiar with

228
00:06:48,639 --> 00:06:51,199
um so cobalt strike right everybody uses

229
00:06:51,199 --> 00:06:52,639
cobalt strike

230
00:06:52,639 --> 00:06:55,520
that's a little bit facetious but many

231
00:06:55,520 --> 00:06:56,800
actors within the apt

232
00:06:56,800 --> 00:06:58,560
space as well as big game ransomware

233
00:06:58,560 --> 00:07:00,000
hunting it is an

234
00:07:00,000 --> 00:07:01,919
openly available tool that you can

235
00:07:01,919 --> 00:07:03,440
purchase on the internet

236
00:07:03,440 --> 00:07:05,599
um similar to kind of the idea of

237
00:07:05,599 --> 00:07:07,199
quakebot or sniffing ice id

238
00:07:07,199 --> 00:07:09,680
popular banking trojans that we see used

239
00:07:09,680 --> 00:07:10,639
and i'd find an

240
00:07:10,639 --> 00:07:12,720
advanced ip scanner so again we're not

241
00:07:12,720 --> 00:07:14,080
really seeing anything

242
00:07:14,080 --> 00:07:16,560
highly specific or distinctive to the

243
00:07:16,560 --> 00:07:18,479
actual gregor ransomware family

244
00:07:18,479 --> 00:07:19,919
but really just kind of a lot of

245
00:07:19,919 --> 00:07:22,080
commodity openly available popular

246
00:07:22,080 --> 00:07:24,880
um you know malicious behavior type

247
00:07:24,880 --> 00:07:26,639
tools here to enable this

248
00:07:26,639 --> 00:07:29,120
stage of the attack and then moving into

249
00:07:29,120 --> 00:07:30,560
data exfiltration

250
00:07:30,560 --> 00:07:32,720
um you're probably familiar with our

251
00:07:32,720 --> 00:07:34,479
clone and 7-zip for their benign use

252
00:07:34,479 --> 00:07:36,080
cases and this is probably where you

253
00:07:36,080 --> 00:07:37,440
start to get pause

254
00:07:37,440 --> 00:07:39,520
so arguably the extortion part of the

255
00:07:39,520 --> 00:07:41,199
attack is one of the most

256
00:07:41,199 --> 00:07:43,680
impactful for an organization because

257
00:07:43,680 --> 00:07:45,759
this is the hardest thing to really

258
00:07:45,759 --> 00:07:47,759
mitigate right so you may be able to

259
00:07:47,759 --> 00:07:49,039
kind of detect tools in the lateral

260
00:07:49,039 --> 00:07:50,160
movement stage and

261
00:07:50,160 --> 00:07:51,680
you know have anti-ransomware and

262
00:07:51,680 --> 00:07:54,479
anti-phishing protections kind of

263
00:07:54,479 --> 00:07:56,879
present but the exfiltration of the data

264
00:07:56,879 --> 00:07:58,479
and the extortion is something that is

265
00:07:58,479 --> 00:08:01,120
incredibly impactful and also as you can

266
00:08:01,120 --> 00:08:02,960
see somewhat hard to detect

267
00:08:02,960 --> 00:08:06,080
so having to decide whether the presence

268
00:08:06,080 --> 00:08:07,599
of 7-zip on a system

269
00:08:07,599 --> 00:08:09,440
is being used for malicious or benign

270
00:08:09,440 --> 00:08:11,599
purposes is fairly complex and we'll

271
00:08:11,599 --> 00:08:12,000
talk more

272
00:08:12,000 --> 00:08:14,960
about that later and then finally the

273
00:08:14,960 --> 00:08:16,400
dropping of the malware which is really

274
00:08:16,400 --> 00:08:17,680
where we see that first

275
00:08:17,680 --> 00:08:21,039
gregor specific um tool that is dropped

276
00:08:21,039 --> 00:08:22,800
so a gregor ransomware which we'll dive

277
00:08:22,800 --> 00:08:24,000
into

278
00:08:24,000 --> 00:08:25,120
and i thought this was fairly

279
00:08:25,120 --> 00:08:26,800
interesting um so in one of their

280
00:08:26,800 --> 00:08:28,639
attacks agregar actually

281
00:08:28,639 --> 00:08:31,840
um print bombed their ransom note to

282
00:08:31,840 --> 00:08:33,360
all the printers of that organization

283
00:08:33,360 --> 00:08:34,880
and so you can see here a picture of a

284
00:08:34,880 --> 00:08:36,000
receipt printer

285
00:08:36,000 --> 00:08:37,760
at the organization printing out copies

286
00:08:37,760 --> 00:08:39,120
of their ransom note which i thought was

287
00:08:39,120 --> 00:08:40,559
particularly interesting

288
00:08:40,559 --> 00:08:42,179
um and kind of snarky

289
00:08:42,179 --> 00:08:43,919
[Music]

290
00:08:43,919 --> 00:08:45,600
so looking at the gregor ransomware

291
00:08:45,600 --> 00:08:47,760
payload there's really three layers to

292
00:08:47,760 --> 00:08:48,480
this

293
00:08:48,480 --> 00:08:51,120
payload malware so first the stage one

294
00:08:51,120 --> 00:08:53,279
packer i saw obfuscated on obfuscated

295
00:08:53,279 --> 00:08:54,000
versions a

296
00:08:54,000 --> 00:08:55,839
stage 2 packer and the aggregator

297
00:08:55,839 --> 00:08:57,200
payload itself

298
00:08:57,200 --> 00:08:59,440
so in order to successfully execute this

299
00:08:59,440 --> 00:09:01,440
payload you need to provide the correct

300
00:09:01,440 --> 00:09:03,760
cryptographic key at runtime

301
00:09:03,760 --> 00:09:07,440
so no key no execution and the payload

302
00:09:07,440 --> 00:09:08,880
accepts several different command line

303
00:09:08,880 --> 00:09:10,640
arguments to determine its functionality

304
00:09:10,640 --> 00:09:11,839
and behavior

305
00:09:11,839 --> 00:09:13,600
um we'll talk a little bit about that

306
00:09:13,600 --> 00:09:15,519
soon

307
00:09:15,519 --> 00:09:17,360
so starting with that stage one packer

308
00:09:17,360 --> 00:09:19,040
as i mentioned i saw two different

309
00:09:19,040 --> 00:09:20,640
versions so an obfuscated and an

310
00:09:20,640 --> 00:09:22,160
unobfuscated version

311
00:09:22,160 --> 00:09:23,519
and to the right you can see the

312
00:09:23,519 --> 00:09:25,200
unobfuscated version mostly just because

313
00:09:25,200 --> 00:09:26,720
it's a lot easier to see kind of what's

314
00:09:26,720 --> 00:09:28,000
going on there

315
00:09:28,000 --> 00:09:29,360
um and really talk about its

316
00:09:29,360 --> 00:09:31,600
functionality so to me this suggests

317
00:09:31,600 --> 00:09:33,360
it's probably some sort of compile-time

318
00:09:33,360 --> 00:09:34,959
obfuscation utility

319
00:09:34,959 --> 00:09:37,440
because the obfuscated and obfuscated

320
00:09:37,440 --> 00:09:38,560
ones were semantically

321
00:09:38,560 --> 00:09:41,040
so similar so it's probably not

322
00:09:41,040 --> 00:09:42,080
something that

323
00:09:42,080 --> 00:09:44,399
um the threat actor wrote completely

324
00:09:44,399 --> 00:09:45,760
different code to accomplish but

325
00:09:45,760 --> 00:09:47,200
probably a compile time

326
00:09:47,200 --> 00:09:49,360
it post-processed and made it look

327
00:09:49,360 --> 00:09:50,720
obfuscated

328
00:09:50,720 --> 00:09:52,959
so let's talk about this so you can see

329
00:09:52,959 --> 00:09:54,800
the baked in cryptographic key material

330
00:09:54,800 --> 00:09:57,040
so it uses a choctaw cipher so

331
00:09:57,040 --> 00:09:58,399
as you can see the key expanding

332
00:09:58,399 --> 00:10:00,560
keynotes add that is the cryptographic

333
00:10:00,560 --> 00:10:01,519
key material

334
00:10:01,519 --> 00:10:03,600
so because the key material is provided

335
00:10:03,600 --> 00:10:05,839
there's really nothing that will

336
00:10:05,839 --> 00:10:08,160
prevent the execution of this stage and

337
00:10:08,160 --> 00:10:10,000
the unpacking and decryption of the next

338
00:10:10,000 --> 00:10:10,560
stage

339
00:10:10,560 --> 00:10:12,240
so really what it's doing is functioning

340
00:10:12,240 --> 00:10:13,600
to obfuscate what

341
00:10:13,600 --> 00:10:15,920
is contained within this binary so

342
00:10:15,920 --> 00:10:18,480
fairly common for packers to do

343
00:10:18,480 --> 00:10:20,640
um overall all of them were very similar

344
00:10:20,640 --> 00:10:22,560
with some very slight differences

345
00:10:22,560 --> 00:10:24,399
so first the command line parameter that

346
00:10:24,399 --> 00:10:26,320
was passed so here it's dash dash no

347
00:10:26,320 --> 00:10:27,279
operation

348
00:10:27,279 --> 00:10:29,360
saw a whole variety of others not really

349
00:10:29,360 --> 00:10:31,839
super meaningful to the functionality of

350
00:10:31,839 --> 00:10:33,519
the stage 1 packer

351
00:10:33,519 --> 00:10:36,240
the xor value that was used in the

352
00:10:36,240 --> 00:10:38,560
base64 decode and xor function

353
00:10:38,560 --> 00:10:42,560
to kind of decode that basicsu4

354
00:10:42,560 --> 00:10:45,839
key generally i saw three or four used

355
00:10:45,839 --> 00:10:48,240
as the extra key but

356
00:10:48,240 --> 00:10:50,399
it can vary and then finally the crypto

357
00:10:50,399 --> 00:10:52,240
key and initialization vector

358
00:10:52,240 --> 00:10:55,120
that were used in those key functions um

359
00:10:55,120 --> 00:10:57,200
again not really impactful

360
00:10:57,200 --> 00:10:59,600
because ultimately all the key material

361
00:10:59,600 --> 00:11:03,120
is provided so we're off to the races

362
00:11:03,120 --> 00:11:04,640
so another interesting thing about the

363
00:11:04,640 --> 00:11:06,320
stage one packer is that some of them

364
00:11:06,320 --> 00:11:08,320
actually had baked in pdb paths that

365
00:11:08,320 --> 00:11:10,560
were really fairly similar to each other

366
00:11:10,560 --> 00:11:13,519
so i saw a lot of things that sort of m

367
00:11:13,519 --> 00:11:14,480
ewtk

368
00:11:14,480 --> 00:11:18,240
and m schustp and if you look at the big

369
00:11:18,240 --> 00:11:19,440
chart on the right

370
00:11:19,440 --> 00:11:21,920
um it's the approximate count of how

371
00:11:21,920 --> 00:11:24,160
many instances of each pdb path i saw in

372
00:11:24,160 --> 00:11:25,920
the collection of samples i had

373
00:11:25,920 --> 00:11:27,440
so this could suggest that there are

374
00:11:27,440 --> 00:11:29,120
multiple individuals that are compiling

375
00:11:29,120 --> 00:11:30,079
the code

376
00:11:30,079 --> 00:11:31,680
um with some of them being more active

377
00:11:31,680 --> 00:11:33,519
than others but this also could just be

378
00:11:33,519 --> 00:11:34,959
kind of the distribution of samples that

379
00:11:34,959 --> 00:11:36,720
i was able to acquire

380
00:11:36,720 --> 00:11:39,120
um but ultimately pdb is fairly easy to

381
00:11:39,120 --> 00:11:40,320
modify per build

382
00:11:40,320 --> 00:11:41,839
um so while these patterns are super

383
00:11:41,839 --> 00:11:43,760
interesting noting that it's not

384
00:11:43,760 --> 00:11:45,440
necessarily deterministic of

385
00:11:45,440 --> 00:11:46,959
you know if this pdb path is the same

386
00:11:46,959 --> 00:11:48,720
between two samples it's absolutely the

387
00:11:48,720 --> 00:11:50,079
same individual

388
00:11:50,079 --> 00:11:53,040
um but it is worth noting so sometimes

389
00:11:53,040 --> 00:11:54,399
you'll see other threat actors you know

390
00:11:54,399 --> 00:11:55,600
maze in particular

391
00:11:55,600 --> 00:11:57,519
will use the pdb path to make snarky

392
00:11:57,519 --> 00:12:00,000
comments or you know rude jokes against

393
00:12:00,000 --> 00:12:02,000
other security researchers so i just

394
00:12:02,000 --> 00:12:03,200
wanted to highlight this for our

395
00:12:03,200 --> 00:12:05,760
discussion

396
00:12:06,079 --> 00:12:07,839
so moving on to that stage two package

397
00:12:07,839 --> 00:12:09,120
so here's where things start to get

398
00:12:09,120 --> 00:12:10,240
interesting

399
00:12:10,240 --> 00:12:12,720
so pretty much how this works is there's

400
00:12:12,720 --> 00:12:14,639
a function that first reads the command

401
00:12:14,639 --> 00:12:15,440
line

402
00:12:15,440 --> 00:12:17,200
and is looking for that password that we

403
00:12:17,200 --> 00:12:19,040
talked about after the dash

404
00:12:19,040 --> 00:12:22,240
p so it has to be passed at runtime

405
00:12:22,240 --> 00:12:24,959
and this password is then passed to a

406
00:12:24,959 --> 00:12:26,639
rabbit decryption function

407
00:12:26,639 --> 00:12:27,839
so if you're not familiar with the

408
00:12:27,839 --> 00:12:29,519
rabbit description cipher um you're not

409
00:12:29,519 --> 00:12:30,480
alone

410
00:12:30,480 --> 00:12:33,120
gen this is fairly uncommon to see used

411
00:12:33,120 --> 00:12:35,040
in ransomware and generally i'll see

412
00:12:35,040 --> 00:12:37,760
you know crypto algorithms like rc4 des

413
00:12:37,760 --> 00:12:39,120
triple des aes

414
00:12:39,120 --> 00:12:42,240
um so route was fairly uncommon

415
00:12:42,240 --> 00:12:45,040
to be observed here but that's what they

416
00:12:45,040 --> 00:12:46,000
use

417
00:12:46,000 --> 00:12:49,600
and after the decryption takes place um

418
00:12:49,600 --> 00:12:51,920
the next function looks for an mz header

419
00:12:51,920 --> 00:12:52,959
so whether or not

420
00:12:52,959 --> 00:12:56,160
it has decrypted a valid pe file so

421
00:12:56,160 --> 00:12:58,240
has successfully decrypted the actual

422
00:12:58,240 --> 00:12:59,360
ransomware payload

423
00:12:59,360 --> 00:13:02,000
and if it does it runs it so here as you

424
00:13:02,000 --> 00:13:03,600
can imagine if you do not pass the

425
00:13:03,600 --> 00:13:05,200
correct cryptographic key

426
00:13:05,200 --> 00:13:06,959
you will not successfully decrypt it and

427
00:13:06,959 --> 00:13:08,560
then it will be game over

428
00:13:08,560 --> 00:13:10,639
so for samples that you do not have the

429
00:13:10,639 --> 00:13:12,800
right cryptographic key for

430
00:13:12,800 --> 00:13:14,959
this is where they stop executing and no

431
00:13:14,959 --> 00:13:17,839
ransom uh no ransomware is deployed and

432
00:13:17,839 --> 00:13:21,120
nothing else takes place

433
00:13:21,120 --> 00:13:24,000
so if you actually succeed in decrypting

434
00:13:24,000 --> 00:13:25,360
the aggregator payload

435
00:13:25,360 --> 00:13:28,000
this is what you get um fairly typical

436
00:13:28,000 --> 00:13:29,360
ransomware behaviors

437
00:13:29,360 --> 00:13:31,040
um doesn't really stick out as

438
00:13:31,040 --> 00:13:32,800
particularly

439
00:13:32,800 --> 00:13:34,880
novel in terms of what it does so it'll

440
00:13:34,880 --> 00:13:36,160
do the language checks for the

441
00:13:36,160 --> 00:13:37,600
commonwealth of independent states

442
00:13:37,600 --> 00:13:38,480
countries

443
00:13:38,480 --> 00:13:40,800
so fairly common to be doing and if it

444
00:13:40,800 --> 00:13:42,880
finds that the computer

445
00:13:42,880 --> 00:13:44,880
is associated with one of those

446
00:13:44,880 --> 00:13:46,160
languages it will stop

447
00:13:46,160 --> 00:13:48,880
executing it will delete the shadow

448
00:13:48,880 --> 00:13:50,399
copies using wmi

449
00:13:50,399 --> 00:13:52,079
this is also another pretty common thing

450
00:13:52,079 --> 00:13:54,639
to do to really make recovery more

451
00:13:54,639 --> 00:13:56,000
difficult for the victim

452
00:13:56,000 --> 00:13:57,839
stopping processes and services that

453
00:13:57,839 --> 00:13:59,839
again aid in recovery or backup of the

454
00:13:59,839 --> 00:14:00,880
system

455
00:14:00,880 --> 00:14:02,160
and then finally because it is

456
00:14:02,160 --> 00:14:04,560
ransomware it does encrypt the files on

457
00:14:04,560 --> 00:14:05,600
the system

458
00:14:05,600 --> 00:14:07,680
except for specific file extensions and

459
00:14:07,680 --> 00:14:09,760
folders predominantly that would

460
00:14:09,760 --> 00:14:12,160
enable the computer to function so

461
00:14:12,160 --> 00:14:14,000
executables dlls things like that

462
00:14:14,000 --> 00:14:15,680
because as you can imagine

463
00:14:15,680 --> 00:14:17,600
if you encrypt all of those the computer

464
00:14:17,600 --> 00:14:18,880
no longer functions

465
00:14:18,880 --> 00:14:21,600
even if the person does pay the ransom

466
00:14:21,600 --> 00:14:22,639
then it's going to be very hard to

467
00:14:22,639 --> 00:14:24,079
decrypt their stuff because the computer

468
00:14:24,079 --> 00:14:25,279
no longer functions

469
00:14:25,279 --> 00:14:27,920
so you can see an example of what the

470
00:14:27,920 --> 00:14:29,600
ransom note looks like that is dropped

471
00:14:29,600 --> 00:14:30,320
so we saw

472
00:14:30,320 --> 00:14:31,600
an example of that being printed on a

473
00:14:31,600 --> 00:14:33,279
receipt printer but here's a slightly

474
00:14:33,279 --> 00:14:37,040
bigger example for you to look at here

475
00:14:37,760 --> 00:14:40,480
so as i mentioned mcgregor and sekhmet

476
00:14:40,480 --> 00:14:42,320
are fairly related and it borrows very

477
00:14:42,320 --> 00:14:44,560
heavily from the sekhmet code

478
00:14:44,560 --> 00:14:46,320
so they have very similar processes

479
00:14:46,320 --> 00:14:48,480
terminated like i talked about to

480
00:14:48,480 --> 00:14:50,000
make recovery more difficult for the

481
00:14:50,000 --> 00:14:52,639
victim the extensions and file names

482
00:14:52,639 --> 00:14:54,399
that they avoid encrypting again like i

483
00:14:54,399 --> 00:14:55,279
talked about

484
00:14:55,279 --> 00:14:57,519
um the name of the ransom note file

485
00:14:57,519 --> 00:14:59,560
itself they both use recover

486
00:14:59,560 --> 00:15:02,959
files.txt the way that they rename

487
00:15:02,959 --> 00:15:05,040
encrypted files so they append an

488
00:15:05,040 --> 00:15:06,800
extension to the end of the file

489
00:15:06,800 --> 00:15:08,160
to show it's encrypted and the victim

490
00:15:08,160 --> 00:15:10,320
notices something is wrong

491
00:15:10,320 --> 00:15:11,920
the string encryption method as well

492
00:15:11,920 --> 00:15:13,279
like i said i love talking about weird

493
00:15:13,279 --> 00:15:14,160
encryption

494
00:15:14,160 --> 00:15:16,079
so you can see the pseudo code for the

495
00:15:16,079 --> 00:15:18,240
string encryption on the bottom right

496
00:15:18,240 --> 00:15:21,120
that i put together so this is a fairly

497
00:15:21,120 --> 00:15:23,519
simple i would say xor cipher

498
00:15:23,519 --> 00:15:26,720
xor base type ciphers are fairly common

499
00:15:26,720 --> 00:15:29,279
um as in you know obfuscation mechanisms

500
00:15:29,279 --> 00:15:30,880
used by different ransomware groups and

501
00:15:30,880 --> 00:15:32,399
other apts

502
00:15:32,399 --> 00:15:34,399
but this is not a specific one that i

503
00:15:34,399 --> 00:15:35,440
had seen before

504
00:15:35,440 --> 00:15:37,360
and they are absolutely identical

505
00:15:37,360 --> 00:15:39,199
between a gregor and sekhmet

506
00:15:39,199 --> 00:15:40,560
suggesting that there is some sort of

507
00:15:40,560 --> 00:15:42,480
relation um though

508
00:15:42,480 --> 00:15:44,959
anybody could really probably you know

509
00:15:44,959 --> 00:15:46,480
incorporate this into their ransomware

510
00:15:46,480 --> 00:15:48,399
themselves if they felt like it or other

511
00:15:48,399 --> 00:15:50,000
pieces of code but this is

512
00:15:50,000 --> 00:15:51,920
exactly how they do the string

513
00:15:51,920 --> 00:15:54,480
decryption i thought it was cool

514
00:15:54,480 --> 00:15:55,839
additionally the method of code

515
00:15:55,839 --> 00:15:58,000
obfuscation that is used so

516
00:15:58,000 --> 00:16:00,399
mcgregor is not a very straightforward

517
00:16:00,399 --> 00:16:02,800
payload and they obfuscate the code

518
00:16:02,800 --> 00:16:05,199
specifically the control flow so if you

519
00:16:05,199 --> 00:16:07,440
look at the top two images on the slide

520
00:16:07,440 --> 00:16:08,959
that gives you some idea of some of the

521
00:16:08,959 --> 00:16:10,639
techniques that they use and try to

522
00:16:10,639 --> 00:16:11,519
remember this for

523
00:16:11,519 --> 00:16:14,560
our next slide or shortly so

524
00:16:14,560 --> 00:16:16,720
the jump if zero and jump if not zero

525
00:16:16,720 --> 00:16:18,240
fairly common makes it harder for

526
00:16:18,240 --> 00:16:19,440
reverse engineer to understand the

527
00:16:19,440 --> 00:16:20,399
control flow

528
00:16:20,399 --> 00:16:22,320
and does do some to confuse the tools

529
00:16:22,320 --> 00:16:23,839
that we use

530
00:16:23,839 --> 00:16:26,320
um finally they had a highly similar

531
00:16:26,320 --> 00:16:27,839
first stage packer so remember that

532
00:16:27,839 --> 00:16:29,440
packer we talked about with the baked in

533
00:16:29,440 --> 00:16:30,399
key material

534
00:16:30,399 --> 00:16:32,959
that uses the cha-cha cipher i saw very

535
00:16:32,959 --> 00:16:37,279
similar first stage packers used in both

536
00:16:37,279 --> 00:16:39,199
so there are a few key differences

537
00:16:39,199 --> 00:16:40,959
between a gregor and segment though

538
00:16:40,959 --> 00:16:43,440
so the first one is that a gregor does

539
00:16:43,440 --> 00:16:44,079
contain

540
00:16:44,079 --> 00:16:47,360
code for an http http post network

541
00:16:47,360 --> 00:16:49,120
request

542
00:16:49,120 --> 00:16:50,800
but it doesn't appear to be triggered at

543
00:16:50,800 --> 00:16:52,160
any point um

544
00:16:52,160 --> 00:16:54,959
in sekhmet this code is used and

545
00:16:54,959 --> 00:16:55,680
actually does

546
00:16:55,680 --> 00:16:57,920
the post um but it's worth noting

547
00:16:57,920 --> 00:16:59,759
because maybe this is kind of a sigil

548
00:16:59,759 --> 00:17:01,279
code that has been left over that the

549
00:17:01,279 --> 00:17:03,440
developers did not take out

550
00:17:03,440 --> 00:17:06,480
worth noting and also sekhmet only has

551
00:17:06,480 --> 00:17:09,039
two stages so remember aggregator has

552
00:17:09,039 --> 00:17:09,839
three

553
00:17:09,839 --> 00:17:12,720
and does not require a password so

554
00:17:12,720 --> 00:17:13,359
gregor

555
00:17:13,359 --> 00:17:15,520
so sekhmet has that first stage packer

556
00:17:15,520 --> 00:17:17,039
that we said was very similar

557
00:17:17,039 --> 00:17:19,039
and the sec met ransomware but what it's

558
00:17:19,039 --> 00:17:20,559
missing is that middle stage with the

559
00:17:20,559 --> 00:17:21,760
rabbit decryption

560
00:17:21,760 --> 00:17:23,439
that takes in the password and tries to

561
00:17:23,439 --> 00:17:24,959
decrypt the payload so

562
00:17:24,959 --> 00:17:27,919
again no password is required and if you

563
00:17:27,919 --> 00:17:29,600
double click on some segment

564
00:17:29,600 --> 00:17:32,000
you will in fact get ransomed so

565
00:17:32,000 --> 00:17:34,080
aggregate requires password segment does

566
00:17:34,080 --> 00:17:35,200
not

567
00:17:35,200 --> 00:17:37,039
additionally a gregor adds a couple

568
00:17:37,039 --> 00:17:38,720
different command line parameters so

569
00:17:38,720 --> 00:17:41,600
dash dash samba so that means link files

570
00:17:41,600 --> 00:17:43,039
will not have a delete on close

571
00:17:43,039 --> 00:17:43,919
attribute

572
00:17:43,919 --> 00:17:46,039
and dash dash kill rdp which is

573
00:17:46,039 --> 00:17:47,840
self-explanatory

574
00:17:47,840 --> 00:17:50,880
um finally the file names of the dropped

575
00:17:50,880 --> 00:17:52,799
files as part of the ransomware attack

576
00:17:52,799 --> 00:17:55,919
differ so a gregor uses dtb.dat

577
00:17:55,919 --> 00:18:00,080
and segment uses sysconfig.db

578
00:18:00,080 --> 00:18:01,520
so i hear a lot of people talk about

579
00:18:01,520 --> 00:18:03,280
similarities between maze and mcgregor

580
00:18:03,280 --> 00:18:03,679
and we

581
00:18:03,679 --> 00:18:05,840
kind of alluded to that in the beginning

582
00:18:05,840 --> 00:18:07,679
but um i wanted to highlight a couple of

583
00:18:07,679 --> 00:18:08,799
the difference that i saw

584
00:18:08,799 --> 00:18:10,400
at the technical level in the code

585
00:18:10,400 --> 00:18:12,080
itself so first

586
00:18:12,080 --> 00:18:13,840
um they use substantially different

587
00:18:13,840 --> 00:18:15,200
obfuscation techniques

588
00:18:15,200 --> 00:18:17,520
so for example maze does import

589
00:18:17,520 --> 00:18:18,720
obfuscation

590
00:18:18,720 --> 00:18:20,880
so it makes it harder to tell which

591
00:18:20,880 --> 00:18:22,720
functions are imported to be used in the

592
00:18:22,720 --> 00:18:24,160
binary using

593
00:18:24,160 --> 00:18:26,240
um this import hashing technique that i

594
00:18:26,240 --> 00:18:27,440
show at the top

595
00:18:27,440 --> 00:18:29,840
or right in that image um mcgregor

596
00:18:29,840 --> 00:18:31,919
doesn't do any sort of import hashing so

597
00:18:31,919 --> 00:18:33,840
there's kind of one key difference

598
00:18:33,840 --> 00:18:36,960
and maze doesn't appear to obfuscate

599
00:18:36,960 --> 00:18:38,880
their strings in any way while mcgregor

600
00:18:38,880 --> 00:18:39,440
does

601
00:18:39,440 --> 00:18:42,160
so kind of two key different approaches

602
00:18:42,160 --> 00:18:43,679
to obfuscation

603
00:18:43,679 --> 00:18:46,000
uh worth highlighting as well

604
00:18:46,000 --> 00:18:47,520
additionally the packers and first

605
00:18:47,520 --> 00:18:49,200
stages are very different so like i

606
00:18:49,200 --> 00:18:50,000
mentioned

607
00:18:50,000 --> 00:18:53,039
there is a fairly consistent group of

608
00:18:53,039 --> 00:18:55,600
like that one first stage packer used

609
00:18:55,600 --> 00:18:56,799
with a gregor

610
00:18:56,799 --> 00:18:59,200
but there's a huge variety with maze so

611
00:18:59,200 --> 00:19:01,520
maze also has an affiliate program

612
00:19:01,520 --> 00:19:03,600
and this is likely an artifact of that

613
00:19:03,600 --> 00:19:05,200
so different affiliates will join the

614
00:19:05,200 --> 00:19:05,679
program

615
00:19:05,679 --> 00:19:08,240
and likely bring tools techniques

616
00:19:08,240 --> 00:19:09,760
different sort of capabilities with them

617
00:19:09,760 --> 00:19:10,559
from

618
00:19:10,559 --> 00:19:12,320
you know previous gigs or just because

619
00:19:12,320 --> 00:19:13,760
that's what they have so either things

620
00:19:13,760 --> 00:19:15,600
they write themselves to pack it

621
00:19:15,600 --> 00:19:17,440
or packers that are commodity that they

622
00:19:17,440 --> 00:19:19,600
purchase or acquire in some way

623
00:19:19,600 --> 00:19:21,280
so that's probably the reason for so

624
00:19:21,280 --> 00:19:22,640
much variety with maze

625
00:19:22,640 --> 00:19:24,400
versus that one that we really saw with

626
00:19:24,400 --> 00:19:25,919
the gregor

627
00:19:25,919 --> 00:19:27,679
and then there were different code

628
00:19:27,679 --> 00:19:29,360
obfuscation techniques so

629
00:19:29,360 --> 00:19:31,360
as we saw with the aggregator they did

630
00:19:31,360 --> 00:19:33,679
one kind of code obfuscation

631
00:19:33,679 --> 00:19:36,000
mesa's code obfuscation was i would say

632
00:19:36,000 --> 00:19:37,760
significantly more extensive and there

633
00:19:37,760 --> 00:19:39,520
are many different techniques used

634
00:19:39,520 --> 00:19:41,280
so i'm not going to go into these in a

635
00:19:41,280 --> 00:19:42,960
lot of detail but you can see them in

636
00:19:42,960 --> 00:19:45,039
the two images on the right

637
00:19:45,039 --> 00:19:46,720
so some researchers have done a really

638
00:19:46,720 --> 00:19:48,720
great breakdown of these techniques and

639
00:19:48,720 --> 00:19:50,480
really explained kind of what is going

640
00:19:50,480 --> 00:19:51,039
on here

641
00:19:51,039 --> 00:19:52,480
so that's definitely worth checking out

642
00:19:52,480 --> 00:19:54,400
if you want but

643
00:19:54,400 --> 00:19:56,160
there was a pretty similar looking

644
00:19:56,160 --> 00:19:57,440
country check so we talked about the

645
00:19:57,440 --> 00:19:58,880
commonwealth of independence state's

646
00:19:58,880 --> 00:19:59,919
country check

647
00:19:59,919 --> 00:20:02,640
um and you can see in the bottom left

648
00:20:02,640 --> 00:20:04,400
the mcgregor country language check and

649
00:20:04,400 --> 00:20:06,400
base language check look very familiar

650
00:20:06,400 --> 00:20:08,080
so i wouldn't consider this a smoking

651
00:20:08,080 --> 00:20:10,000
gun but in order to do this discussion

652
00:20:10,000 --> 00:20:10,720
justice

653
00:20:10,720 --> 00:20:14,159
i am pointing it out

654
00:20:14,159 --> 00:20:16,640
so yes lindsay that is just code what

655
00:20:16,640 --> 00:20:18,720
else yes the diamond model does not go

656
00:20:18,720 --> 00:20:20,400
away so we can't just look at things

657
00:20:20,400 --> 00:20:22,159
from the technical perspective here

658
00:20:22,159 --> 00:20:24,400
and we have to think about um these

659
00:20:24,400 --> 00:20:26,400
ransomware attacks in relation to

660
00:20:26,400 --> 00:20:28,320
the victims the adversaries and

661
00:20:28,320 --> 00:20:30,000
infrastructure that is involved

662
00:20:30,000 --> 00:20:32,640
and let's talk about why that is so

663
00:20:32,640 --> 00:20:34,559
ransomware affiliates are moving to new

664
00:20:34,559 --> 00:20:35,120
variants

665
00:20:35,120 --> 00:20:36,720
operations are spinning up and spinning

666
00:20:36,720 --> 00:20:38,320
down over the course of the year

667
00:20:38,320 --> 00:20:40,320
um we talked a lot about the commodity

668
00:20:40,320 --> 00:20:41,679
tools that have been used

669
00:20:41,679 --> 00:20:43,679
and so this really starts to blur from a

670
00:20:43,679 --> 00:20:44,960
technical perspective

671
00:20:44,960 --> 00:20:47,039
the obvious hallmarks hallmarks of

672
00:20:47,039 --> 00:20:49,600
specific threat actors or variants

673
00:20:49,600 --> 00:20:52,640
um so here's kind of why that is so as

674
00:20:52,640 --> 00:20:54,159
chain analysis points out they believe

675
00:20:54,159 --> 00:20:56,240
that the blockchain analysis so

676
00:20:56,240 --> 00:20:57,600
a lot of the cryptocurrency things that

677
00:20:57,600 --> 00:20:59,440
are involved suggest that there's

678
00:20:59,440 --> 00:21:01,360
affiliate overlap and other possible

679
00:21:01,360 --> 00:21:02,320
connections between

680
00:21:02,320 --> 00:21:04,320
maze mcgregor suncrypt and doppelgamer

681
00:21:04,320 --> 00:21:05,679
so for

682
00:21:05,679 --> 00:21:07,440
i guess very well known ransomware

683
00:21:07,440 --> 00:21:08,880
groups um

684
00:21:08,880 --> 00:21:10,880
cobalt strike which we've talked about

685
00:21:10,880 --> 00:21:12,640
was actually used in 70

686
00:21:12,640 --> 00:21:14,320
of the big game hunting incidents in

687
00:21:14,320 --> 00:21:16,400
2020 so you remember that large pie

688
00:21:16,400 --> 00:21:17,919
chart of all the different threat actors

689
00:21:17,919 --> 00:21:18,720
that were

690
00:21:18,720 --> 00:21:20,559
using or doing ransomware attacks in

691
00:21:20,559 --> 00:21:22,159
2020 70

692
00:21:22,159 --> 00:21:24,080
of the big game ones actually used this

693
00:21:24,080 --> 00:21:26,000
one tool so it's not a very distinctive

694
00:21:26,000 --> 00:21:28,240
indicator of any one group in particular

695
00:21:28,240 --> 00:21:31,120
just kind of bad behavior um rdp is the

696
00:21:31,120 --> 00:21:32,799
most common attack vector employed to

697
00:21:32,799 --> 00:21:34,960
install ransomware which are gregar used

698
00:21:34,960 --> 00:21:36,559
and then vpn vulnerabilities really

699
00:21:36,559 --> 00:21:38,480
aren't far behind and then like i said

700
00:21:38,480 --> 00:21:39,360
before

701
00:21:39,360 --> 00:21:41,360
everyone uses phishing so really what

702
00:21:41,360 --> 00:21:42,559
we're looking at from the technical

703
00:21:42,559 --> 00:21:43,520
perspective

704
00:21:43,520 --> 00:21:46,880
is a lot of harm hallmarks of

705
00:21:46,880 --> 00:21:48,640
you know threat actors and malware and

706
00:21:48,640 --> 00:21:51,280
at a broad technical level but we're

707
00:21:51,280 --> 00:21:53,440
really not seeing anything very

708
00:21:53,440 --> 00:21:56,080
um ransomware family specific until we

709
00:21:56,080 --> 00:21:56,640
get to that

710
00:21:56,640 --> 00:21:58,559
actual malware so that's why context

711
00:21:58,559 --> 00:21:59,760
remains super

712
00:21:59,760 --> 00:22:03,440
important so what does this mean for us

713
00:22:03,440 --> 00:22:05,679
as defenders so there is some good news

714
00:22:05,679 --> 00:22:08,400
um because many of these same gtps are

715
00:22:08,400 --> 00:22:10,720
used between ransomware threat actors

716
00:22:10,720 --> 00:22:12,480
so this really helps us focus our

717
00:22:12,480 --> 00:22:14,080
detections and mitigations on some of

718
00:22:14,080 --> 00:22:16,240
these common issues and common tools

719
00:22:16,240 --> 00:22:18,080
so different vulnerabilities different

720
00:22:18,080 --> 00:22:19,840
vulnerable uh products

721
00:22:19,840 --> 00:22:21,520
you know really being aware of what

722
00:22:21,520 --> 00:22:23,200
these are so that we can

723
00:22:23,200 --> 00:22:26,240
start to protect them um in

724
00:22:26,240 --> 00:22:29,679
its advisory on mcgregor ransomware fbi

725
00:22:29,679 --> 00:22:31,280
advised patching several rdp

726
00:22:31,280 --> 00:22:34,080
vulnerabilities from 2019 and 2020

727
00:22:34,080 --> 00:22:36,320
and you know while these were in

728
00:22:36,320 --> 00:22:37,840
association with mcgregor

729
00:22:37,840 --> 00:22:39,840
there's you know no reason that maybe

730
00:22:39,840 --> 00:22:40,960
other fret actors

731
00:22:40,960 --> 00:22:42,799
aren't using them now which they might

732
00:22:42,799 --> 00:22:44,159
be and

733
00:22:44,159 --> 00:22:46,080
may not use them in the future so

734
00:22:46,080 --> 00:22:47,679
potentially even though gregor doesn't

735
00:22:47,679 --> 00:22:49,520
seem to be very active anymore

736
00:22:49,520 --> 00:22:50,720
by protecting against these

737
00:22:50,720 --> 00:22:52,640
vulnerabilities we may be heading off

738
00:22:52,640 --> 00:22:54,559
some other avenues that other big game

739
00:22:54,559 --> 00:22:56,320
hunting ransomware threat actors will be

740
00:22:56,320 --> 00:22:57,440
using

741
00:22:57,440 --> 00:22:59,600
but there's also bad news so they're

742
00:22:59,600 --> 00:23:01,679
still using these ttps because they're

743
00:23:01,679 --> 00:23:03,600
succeeding with them

744
00:23:03,600 --> 00:23:05,840
fishing will always be a problem while

745
00:23:05,840 --> 00:23:07,360
you have people

746
00:23:07,360 --> 00:23:09,120
they will click on things and the lures

747
00:23:09,120 --> 00:23:11,200
are only getting more creative

748
00:23:11,200 --> 00:23:13,200
more stealthy and more interesting to

749
00:23:13,200 --> 00:23:14,960
potential victims

750
00:23:14,960 --> 00:23:16,799
so additionally as we all know patching

751
00:23:16,799 --> 00:23:18,880
takes resources and

752
00:23:18,880 --> 00:23:20,480
may fall by the wayside as your

753
00:23:20,480 --> 00:23:22,000
resources are you know

754
00:23:22,000 --> 00:23:25,039
handling whatever is kind of top of mind

755
00:23:25,039 --> 00:23:26,000
or

756
00:23:26,000 --> 00:23:27,919
super critical right now and you may not

757
00:23:27,919 --> 00:23:29,600
even be able to patch

758
00:23:29,600 --> 00:23:31,600
all of the potential vulnerabilities

759
00:23:31,600 --> 00:23:33,280
that exist for all the

760
00:23:33,280 --> 00:23:34,799
ransomware threats and other kinds of

761
00:23:34,799 --> 00:23:36,720
threats that you're afraid of

762
00:23:36,720 --> 00:23:38,480
and then finally separating the good

763
00:23:38,480 --> 00:23:40,880
versus bad use of tools is difficult

764
00:23:40,880 --> 00:23:43,200
so we talked about the presence of 7-zip

765
00:23:43,200 --> 00:23:45,360
being used for data exfiltration so

766
00:23:45,360 --> 00:23:47,120
for an organization to decide whether

767
00:23:47,120 --> 00:23:49,520
the presence of 7-zip on their system is

768
00:23:49,520 --> 00:23:51,120
good or bad

769
00:23:51,120 --> 00:23:53,520
it's doable it's not insurmountable but

770
00:23:53,520 --> 00:23:54,880
it is very difficult

771
00:23:54,880 --> 00:23:56,400
especially given the size of many

772
00:23:56,400 --> 00:23:59,120
organizations and the diversity of tools

773
00:23:59,120 --> 00:24:01,120
and the difficulty to truly base on and

774
00:24:01,120 --> 00:24:02,320
understand what a

775
00:24:02,320 --> 00:24:05,279
malicious use of 7-zip really looks like

776
00:24:05,279 --> 00:24:06,559
and detect it and then

777
00:24:06,559 --> 00:24:09,520
thwart it and the worst news of all is

778
00:24:09,520 --> 00:24:10,400
that

779
00:24:10,400 --> 00:24:12,240
if they need to they will evolve their

780
00:24:12,240 --> 00:24:13,440
ttps

781
00:24:13,440 --> 00:24:16,480
so as i'm sure you're aware there is big

782
00:24:16,480 --> 00:24:18,559
game money there's big money in big game

783
00:24:18,559 --> 00:24:19,600
hunting

784
00:24:19,600 --> 00:24:22,240
and while it is still profitable

785
00:24:22,240 --> 00:24:24,320
profitable people will still do it

786
00:24:24,320 --> 00:24:25,760
and remember those affiliates they're

787
00:24:25,760 --> 00:24:27,440
moving between programs they're learning

788
00:24:27,440 --> 00:24:29,440
new skills bringing new tools

789
00:24:29,440 --> 00:24:32,400
so while you may be aware of what

790
00:24:32,400 --> 00:24:33,840
they're using now

791
00:24:33,840 --> 00:24:35,440
keep in mind that as new affiliates join

792
00:24:35,440 --> 00:24:36,960
and move around

793
00:24:36,960 --> 00:24:39,279
these techniques will evolve over time

794
00:24:39,279 --> 00:24:40,640
and then we'll start to see kind of a

795
00:24:40,640 --> 00:24:42,480
lot more diversity associated with

796
00:24:42,480 --> 00:24:46,960
any specific type of threat actor

797
00:24:46,960 --> 00:24:48,799
so if you're interested in tracking

798
00:24:48,799 --> 00:24:50,000
aggregate there's kind of a couple

799
00:24:50,000 --> 00:24:51,919
approaches we could take

800
00:24:51,919 --> 00:24:53,919
so first monitoring for unexpected

801
00:24:53,919 --> 00:24:55,760
commodity and openly available tools

802
00:24:55,760 --> 00:24:56,799
like they use

803
00:24:56,799 --> 00:24:58,799
so specifically quakebot and cobalt

804
00:24:58,799 --> 00:25:01,039
strike so again these aren't a gregor

805
00:25:01,039 --> 00:25:01,840
specific

806
00:25:01,840 --> 00:25:03,120
but they are commonly used with

807
00:25:03,120 --> 00:25:05,520
ransomware deployments as i've mentioned

808
00:25:05,520 --> 00:25:07,520
and generally they're precursor to many

809
00:25:07,520 --> 00:25:09,600
kinds of unsavory behavior so again

810
00:25:09,600 --> 00:25:10,799
kind of more bang for your buck

811
00:25:10,799 --> 00:25:13,200
detecting those and recorded futures

812
00:25:13,200 --> 00:25:14,720
actually created summer rules and yara

813
00:25:14,720 --> 00:25:17,120
rules for some of these tools

814
00:25:17,120 --> 00:25:18,640
um but if you want to track aggregators

815
00:25:18,640 --> 00:25:19,840
specifically a couple things that you

816
00:25:19,840 --> 00:25:21,760
can look at so that second stage with

817
00:25:21,760 --> 00:25:23,039
the rabbit decryption

818
00:25:23,039 --> 00:25:24,720
is actually extremely consistent between

819
00:25:24,720 --> 00:25:27,279
the samples so even at the bite level

820
00:25:27,279 --> 00:25:29,279
um the string decryption technique using

821
00:25:29,279 --> 00:25:30,320
the final payload that

822
00:25:30,320 --> 00:25:32,240
used between both greger and sekhmet was

823
00:25:32,240 --> 00:25:34,400
a fairly consistent kind of

824
00:25:34,400 --> 00:25:36,799
indicator mcgregor as i mentioned it

825
00:25:36,799 --> 00:25:37,840
hadn't really seen it

826
00:25:37,840 --> 00:25:39,919
anywhere else and then finally that

827
00:25:39,919 --> 00:25:41,760
first stage decryption process

828
00:25:41,760 --> 00:25:44,320
with the xor cha-cha cipher check for

829
00:25:44,320 --> 00:25:46,640
the valid pe file and then sleep if fail

830
00:25:46,640 --> 00:25:50,000
was also something that could be tracked

831
00:25:50,000 --> 00:25:53,200
in association with the gregor itself

832
00:25:53,200 --> 00:25:56,480
so what's next where are we so now that

833
00:25:56,480 --> 00:25:58,240
the affiliates have been arrested

834
00:25:58,240 --> 00:26:00,640
uh a gregor operation is pretty likely

835
00:26:00,640 --> 00:26:01,760
dead um

836
00:26:01,760 --> 00:26:03,360
it's pretty likely that the the

837
00:26:03,360 --> 00:26:05,520
operators themselves will move to a new

838
00:26:05,520 --> 00:26:06,720
operation

839
00:26:06,720 --> 00:26:08,480
um and it is possible to see some of the

840
00:26:08,480 --> 00:26:10,159
ttps used so

841
00:26:10,159 --> 00:26:11,919
again those commodity tools but maybe

842
00:26:11,919 --> 00:26:14,159
also aspects of the actual code itself

843
00:26:14,159 --> 00:26:15,360
or different techniques that they

844
00:26:15,360 --> 00:26:16,799
developed

845
00:26:16,799 --> 00:26:18,400
that they found particularly successful

846
00:26:18,400 --> 00:26:21,279
can carry over to their new operation

847
00:26:21,279 --> 00:26:23,440
um also worth noting ransomware isn't

848
00:26:23,440 --> 00:26:25,039
going away anytime soon

849
00:26:25,039 --> 00:26:27,039
so like i said big game hunting is big

850
00:26:27,039 --> 00:26:29,039
business and while it is profitable they

851
00:26:29,039 --> 00:26:30,559
will keep doing it

852
00:26:30,559 --> 00:26:33,200
um name and shame has proven fairly

853
00:26:33,200 --> 00:26:34,960
profitable and successful for threat

854
00:26:34,960 --> 00:26:35,520
actors

855
00:26:35,520 --> 00:26:37,440
and it will likely remain popular and

856
00:26:37,440 --> 00:26:39,360
then cartels in which

857
00:26:39,360 --> 00:26:41,120
threat actors team up and then share

858
00:26:41,120 --> 00:26:43,520
different resources so things like leak

859
00:26:43,520 --> 00:26:45,039
site and infrastructure

860
00:26:45,039 --> 00:26:47,360
will also probably remain popular as

861
00:26:47,360 --> 00:26:50,320
well as we move forward

862
00:26:50,320 --> 00:26:51,919
so with that thank you so much i'm

863
00:26:51,919 --> 00:26:53,520
lindsay k thank you for attending my

864
00:26:53,520 --> 00:26:54,000
talk

865
00:26:54,000 --> 00:26:56,880
sammy have any questions we actually do

866
00:26:56,880 --> 00:26:57,520
lindsey

867
00:26:57,520 --> 00:27:00,080
and thanks very much for the talk first

868
00:27:00,080 --> 00:27:00,559
of all

869
00:27:00,559 --> 00:27:02,080
and we have a couple of minutes for

870
00:27:02,080 --> 00:27:03,919
questions so and

871
00:27:03,919 --> 00:27:07,120
we have a question here um how common is

872
00:27:07,120 --> 00:27:08,000
the cs

873
00:27:08,000 --> 00:27:11,919
exclusion across different ransomwares

874
00:27:11,919 --> 00:27:14,960
the cis exclusion so generally

875
00:27:14,960 --> 00:27:17,919
it will be in any sort of ransomware

876
00:27:17,919 --> 00:27:18,799
that is

877
00:27:18,799 --> 00:27:20,880
created by threat actors who are very

878
00:27:20,880 --> 00:27:22,320
likely in

879
00:27:22,320 --> 00:27:24,080
you know eastern european countries

880
00:27:24,080 --> 00:27:25,520
where executing

881
00:27:25,520 --> 00:27:28,640
this kind of attack on other

882
00:27:28,640 --> 00:27:31,760
on computers that are in that kind of

883
00:27:31,760 --> 00:27:33,279
group of countries would be very very

884
00:27:33,279 --> 00:27:35,919
bad um you'll see a lot of that there so

885
00:27:35,919 --> 00:27:37,840
like i said maze does it

886
00:27:37,840 --> 00:27:40,880
um i believe a couple other of the big

887
00:27:40,880 --> 00:27:42,000
game hunting

888
00:27:42,000 --> 00:27:44,320
ransomware families do it um i saw

889
00:27:44,320 --> 00:27:45,440
sample the other day

890
00:27:45,440 --> 00:27:47,679
i believe it was dear cry that doesn't

891
00:27:47,679 --> 00:27:50,000
um so i would say that a lot of the more

892
00:27:50,000 --> 00:27:51,279
famous names of

893
00:27:51,279 --> 00:27:54,080
ransomware that are created in probably

894
00:27:54,080 --> 00:27:54,960
eastern europe

895
00:27:54,960 --> 00:27:57,679
are more likely to have it um versus not

896
00:27:57,679 --> 00:27:58,960
and those are a lot of like the really

897
00:27:58,960 --> 00:28:00,840
sophisticated ones that we hear a lot

898
00:28:00,840 --> 00:28:02,559
about

899
00:28:02,559 --> 00:28:05,760
brilliant thank you and one more thing

900
00:28:05,760 --> 00:28:08,159
so gregory is pretty much dead as you

901
00:28:08,159 --> 00:28:09,200
said um

902
00:28:09,200 --> 00:28:12,159
it's on his way out but um those

903
00:28:12,159 --> 00:28:13,679
criminals are going to move on to new

904
00:28:13,679 --> 00:28:15,840
operations potentially use the same ttp

905
00:28:15,840 --> 00:28:16,799
so

906
00:28:16,799 --> 00:28:20,000
what would be your advice on

907
00:28:20,000 --> 00:28:22,480
um mitigating or protecting against the

908
00:28:22,480 --> 00:28:23,840
threat of

909
00:28:23,840 --> 00:28:25,679
a gregor or the next thing that comes

910
00:28:25,679 --> 00:28:28,240
after a greg are using the same ttvs

911
00:28:28,240 --> 00:28:30,080
sure so like i said there are a couple

912
00:28:30,080 --> 00:28:31,919
ways of getting sort of more bang for

913
00:28:31,919 --> 00:28:33,360
your buck for detection

914
00:28:33,360 --> 00:28:36,080
so the best time to detect a ransomware

915
00:28:36,080 --> 00:28:38,080
attack is as early as possible so at

916
00:28:38,080 --> 00:28:39,520
that fishing stage

917
00:28:39,520 --> 00:28:41,200
um but really looking at that kind of

918
00:28:41,200 --> 00:28:43,600
dwell time stage so the use of things

919
00:28:43,600 --> 00:28:44,880
like cobalt strike

920
00:28:44,880 --> 00:28:46,640
a lot of the really popular banking bots

921
00:28:46,640 --> 00:28:48,320
and trojans as i mentioned

922
00:28:48,320 --> 00:28:50,399
um frequently used so as i mentioned

923
00:28:50,399 --> 00:28:52,159
those are generally precursors to

924
00:28:52,159 --> 00:28:54,240
you know all kinds of unsavory behavior

925
00:28:54,240 --> 00:28:56,000
so really kind of understanding what are

926
00:28:56,000 --> 00:28:58,240
those common ttps among the big game

927
00:28:58,240 --> 00:28:59,440
threat actors

928
00:28:59,440 --> 00:29:01,440
um so you'll see a lot of malicious use

929
00:29:01,440 --> 00:29:03,520
of those tools but then you'll also see

930
00:29:03,520 --> 00:29:05,279
malicious use of a lot of

931
00:29:05,279 --> 00:29:06,720
you know living off the land type

932
00:29:06,720 --> 00:29:08,720
techniques so windows tools themselves

933
00:29:08,720 --> 00:29:10,880
so really trying to understand like what

934
00:29:10,880 --> 00:29:12,720
are the tools and techniques that a lot

935
00:29:12,720 --> 00:29:14,640
of thread actors use because they remain

936
00:29:14,640 --> 00:29:15,520
successful

937
00:29:15,520 --> 00:29:17,520
and then looking to protect against and

938
00:29:17,520 --> 00:29:19,600
mitigate those and then also monitor for

939
00:29:19,600 --> 00:29:21,679
their use

940
00:29:21,679 --> 00:29:23,679
that's brilliant thank you very much and

941
00:29:23,679 --> 00:29:25,760
that brings us to the end of this talk

942
00:29:25,760 --> 00:29:27,600
lindsay thank you very much the

943
00:29:27,600 --> 00:29:30,080
the feedback on the chat is is great

944
00:29:30,080 --> 00:29:31,520
people love the talk so

945
00:29:31,520 --> 00:29:33,039
thank you again for being with us today

946
00:29:33,039 --> 00:29:40,799
thank you so much

947
00:29:40,799 --> 00:29:42,879
you

