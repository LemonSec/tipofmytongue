1
00:00:00,299 --> 00:00:02,940
okay right uh hi everyone so today we

2
00:00:02,940 --> 00:00:06,000
are here to talk about a noble signing

3
00:00:06,000 --> 00:00:07,919
that we saw pertaining to the use of

4
00:00:07,919 --> 00:00:10,139
internal domains as potential for

5
00:00:10,139 --> 00:00:13,920
information disclosure so uh I'm

6
00:00:13,920 --> 00:00:16,020
generally and then we'll charge here as

7
00:00:16,020 --> 00:00:18,180
well so just a quick overview so we're

8
00:00:18,180 --> 00:00:19,560
going to be talking about some of the

9
00:00:19,560 --> 00:00:22,320
basic fundamental concepts they will go

10
00:00:22,320 --> 00:00:25,199
deep into the issue proper from there

11
00:00:25,199 --> 00:00:27,300
this is a live issue that we have seen

12
00:00:27,300 --> 00:00:29,279
occurring uh globally so whatever it

13
00:00:29,279 --> 00:00:30,539
presents of the sample findings here

14
00:00:30,539 --> 00:00:33,059
some of the key observations uh our

15
00:00:33,059 --> 00:00:36,120
efforts and status in reach out to a

16
00:00:36,120 --> 00:00:40,500
vulnerable entities as well as some some

17
00:00:40,500 --> 00:00:42,480
fight pointers on how to look for such

18
00:00:42,480 --> 00:00:45,000
similar behavior in your environment as

19
00:00:45,000 --> 00:00:46,860
well as the limitation steps

20
00:00:46,860 --> 00:00:49,920
all right so as the title suggests this

21
00:00:49,920 --> 00:00:53,100
is a issue specific to DNS so for the

22
00:00:53,100 --> 00:00:54,480
purposes of this presentation where you

23
00:00:54,480 --> 00:00:55,800
could assume that everyone has some

24
00:00:55,800 --> 00:00:57,420
basic understanding of what DNS is about

25
00:00:57,420 --> 00:01:00,480
basically resolving a host name to an IP

26
00:01:00,480 --> 00:01:03,600
address uh the important concept that we

27
00:01:03,600 --> 00:01:05,400
want to take note here is the idea of

28
00:01:05,400 --> 00:01:07,979
the concept of labels in DNS so this is

29
00:01:07,979 --> 00:01:09,720
defined in RSC one two three four one

30
00:01:09,720 --> 00:01:12,479
two three five labels in DNS put simply

31
00:01:12,479 --> 00:01:15,960
are the string components in your DNS

32
00:01:15,960 --> 00:01:18,780
hosting separated by periods so for the

33
00:01:18,780 --> 00:01:21,780
end zapper.com example is a label com is

34
00:01:21,780 --> 00:01:23,820
a labor as well uh com in this case it's

35
00:01:23,820 --> 00:01:26,580
also a pld but uh technically at the

36
00:01:26,580 --> 00:01:27,780
technical level these are all constant

37
00:01:27,780 --> 00:01:30,299
labels in VNS why do we talk about

38
00:01:30,299 --> 00:01:32,040
Labor's Indians because there are

39
00:01:32,040 --> 00:01:33,840
multiple ways to classify host names in

40
00:01:33,840 --> 00:01:35,880
DNS so over here I got a few examples

41
00:01:35,880 --> 00:01:38,340
here you have just example it is just

42
00:01:38,340 --> 00:01:40,799
example we call it a single label name

43
00:01:40,799 --> 00:01:43,140
now next item intranet dot example.com

44
00:01:43,140 --> 00:01:46,079
notice that the internet calling it an

45
00:01:46,079 --> 00:01:48,240
unqualified Quality Labor why is it

46
00:01:48,240 --> 00:01:49,439
unqualified because there's no

47
00:01:49,439 --> 00:01:51,240
terminating period after the last waiver

48
00:01:51,240 --> 00:01:54,140
so if you look at the last example

49
00:01:54,140 --> 00:01:56,340
intranet.assemble.com another period

50
00:01:56,340 --> 00:01:58,439
that is not typo that is delivered so

51
00:01:58,439 --> 00:01:59,939
this is what we call a fully qualified

52
00:01:59,939 --> 00:02:01,920
multi labeling some implementations

53
00:02:01,920 --> 00:02:03,479
called your fully qualified domain name

54
00:02:03,479 --> 00:02:05,460
they mean the same thing uh the fully

55
00:02:05,460 --> 00:02:07,680
qualified part refers to the part where

56
00:02:07,680 --> 00:02:09,660
you add a permeating period to the very

57
00:02:09,660 --> 00:02:13,319
last label in the hostname so it is just

58
00:02:13,319 --> 00:02:15,420
something to keep in mind for the rest

59
00:02:15,420 --> 00:02:17,099
of the presentation

60
00:02:17,099 --> 00:02:18,660
now

61
00:02:18,660 --> 00:02:21,599
uh the idea of this DNS such the effects

62
00:02:21,599 --> 00:02:23,400
if there's something that is advertised

63
00:02:23,400 --> 00:02:26,280
by a DHCP Cloud Server to clients within

64
00:02:26,280 --> 00:02:28,500
the network so these DNS search surface

65
00:02:28,500 --> 00:02:30,900
uh is typically communicated by DHCP

66
00:02:30,900 --> 00:02:33,599
server by option post 15 or 119. if you

67
00:02:33,599 --> 00:02:35,280
operate your own ghcp server you can

68
00:02:35,280 --> 00:02:37,860
actually push this setting called a DNS

69
00:02:37,860 --> 00:02:39,560
such surface to your respective

70
00:02:39,560 --> 00:02:42,180
endpoints within your network so what

71
00:02:42,180 --> 00:02:45,060
exactly is this DNS search prefix by far

72
00:02:45,060 --> 00:02:46,800
the most common implementation of this

73
00:02:46,800 --> 00:02:49,920
DNS such surface is when you uh in

74
00:02:49,920 --> 00:02:51,360
internal corporate networks you have

75
00:02:51,360 --> 00:02:53,940
browsing shortcuts or for example if you

76
00:02:53,940 --> 00:02:55,980
just type Go slash whatever Shop link in

77
00:02:55,980 --> 00:02:57,540
your browser or just type some short

78
00:02:57,540 --> 00:02:59,040
link your browser this is typically the

79
00:02:59,040 --> 00:03:01,140
most popular example used in many

80
00:03:01,140 --> 00:03:04,440
corporate networks so internally what

81
00:03:04,440 --> 00:03:05,700
really happens behind the scenes is that

82
00:03:05,700 --> 00:03:07,319
when you type let's say you type in your

83
00:03:07,319 --> 00:03:09,060
browser you type Go slash whatever short

84
00:03:09,060 --> 00:03:13,080
link this go rgo is expanded to the

85
00:03:13,080 --> 00:03:15,720
hostname Gold Dot whatever DNS suffix

86
00:03:15,720 --> 00:03:18,000
and this DNA search surface usually a

87
00:03:18,000 --> 00:03:20,700
domain that is resolvable internally

88
00:03:20,700 --> 00:03:22,440
from within your corporate Network that

89
00:03:22,440 --> 00:03:24,739
is the most common application uh

90
00:03:24,739 --> 00:03:26,700
alternatively you sometimes also have

91
00:03:26,700 --> 00:03:28,379
internal clients they are referencing

92
00:03:28,379 --> 00:03:30,840
non-qualified postings in other words a

93
00:03:30,840 --> 00:03:33,720
single label advisable we buy zero y

94
00:03:33,720 --> 00:03:36,239
domain controller zero y behind the

95
00:03:36,239 --> 00:03:38,280
scenes where you attempt to query that

96
00:03:38,280 --> 00:03:40,440
particular short name over DNS it

97
00:03:40,440 --> 00:03:43,200
expands up to whatever hostname is plot

98
00:03:43,200 --> 00:03:45,000
your suffix so in this case we could be

99
00:03:45,000 --> 00:03:48,620
some internal domain.com for example

100
00:03:48,620 --> 00:03:51,180
I mean it works pretty well it's a very

101
00:03:51,180 --> 00:03:53,940
it's a huge convenience for clients

102
00:03:53,940 --> 00:03:56,099
within an internal corporate network but

103
00:03:56,099 --> 00:03:58,140
as we move on to remote working we no

104
00:03:58,140 --> 00:03:59,940
longer can guarantee that every employee

105
00:03:59,940 --> 00:04:02,099
is actually physically within the office

106
00:04:02,099 --> 00:04:03,659
premises they are not physically

107
00:04:03,659 --> 00:04:05,340
connected to the corporate Network so

108
00:04:05,340 --> 00:04:06,360
what actually happens if you're not

109
00:04:06,360 --> 00:04:07,739
connected to the corporate Network this

110
00:04:07,739 --> 00:04:10,560
is where the vulnerability arises

111
00:04:10,560 --> 00:04:12,420
go over here just to illustrate it

112
00:04:12,420 --> 00:04:14,879
graphically I got flowchart here uh

113
00:04:14,879 --> 00:04:17,100
showing what the DNS query Behavior

114
00:04:17,100 --> 00:04:18,418
would look like under ordinary

115
00:04:18,418 --> 00:04:21,000
circumstances so for the purposes of

116
00:04:21,000 --> 00:04:24,419
this example uh example dot intern.com

117
00:04:24,419 --> 00:04:26,880
we assume it to be an internal reference

118
00:04:26,880 --> 00:04:29,160
to some internal destination within a

119
00:04:29,160 --> 00:04:31,440
corporate Maps within the within private

120
00:04:31,440 --> 00:04:34,740
ID space so ordinarily if you have an

121
00:04:34,740 --> 00:04:36,479
endpoint that is connected to internal

122
00:04:36,479 --> 00:04:38,600
corporate Network and you query this

123
00:04:38,600 --> 00:04:41,220
example.internaldash.com it goes to your

124
00:04:41,220 --> 00:04:42,780
internet DNS result within your

125
00:04:42,780 --> 00:04:44,639
corporate Network the internet resolver

126
00:04:44,639 --> 00:04:47,100
replies with his internal IP address and

127
00:04:47,100 --> 00:04:48,780
this is return to the application so all

128
00:04:48,780 --> 00:04:51,180
this it was fine it was Final we assume

129
00:04:51,180 --> 00:04:52,860
for the purpose of this explanation that

130
00:04:52,860 --> 00:04:55,259
the application is using the standard

131
00:04:55,259 --> 00:04:58,919
API calls to obtain the DNA the object

132
00:04:58,919 --> 00:05:01,620
IP address of a given DNS hostname so

133
00:05:01,620 --> 00:05:03,960
all these resolution activity is coming

134
00:05:03,960 --> 00:05:05,639
from the system DNS client UW

135
00:05:05,639 --> 00:05:07,199
application just referencing the

136
00:05:07,199 --> 00:05:09,000
hostname everything is resolved by the

137
00:05:09,000 --> 00:05:09,780
system

138
00:05:09,780 --> 00:05:13,259
so now if we move on to the alternate

139
00:05:13,259 --> 00:05:15,780
scenario where your computer is not

140
00:05:15,780 --> 00:05:17,759
physically connected to a corporate

141
00:05:17,759 --> 00:05:18,960
network of the corporate Network

142
00:05:18,960 --> 00:05:21,240
entirely not connected with ivpn or

143
00:05:21,240 --> 00:05:23,160
viable connection so what happens here

144
00:05:23,160 --> 00:05:27,300
internal dashcorp.com uh in most cases

145
00:05:27,300 --> 00:05:31,080
companies do not publish a DNS entry in

146
00:05:31,080 --> 00:05:33,360
public DNS for your for that internal

147
00:05:33,360 --> 00:05:35,580
domain so in this case example dot

148
00:05:35,580 --> 00:05:37,560
internet cop.com even if internal

149
00:05:37,560 --> 00:05:39,660
desktop.com is registered on public DNS

150
00:05:39,660 --> 00:05:42,000
the sub domain fund example the example

151
00:05:42,000 --> 00:05:43,500
part may not actually return the result

152
00:05:43,500 --> 00:05:45,479
so in this case public resolvers will

153
00:05:45,479 --> 00:05:47,820
return an installment uh and in that

154
00:05:47,820 --> 00:05:49,020
case even in public domains with an

155
00:05:49,020 --> 00:05:50,280
internal IP address they are not going

156
00:05:50,280 --> 00:05:52,139
to go anywhere either so we assume that

157
00:05:52,139 --> 00:05:54,060
it Returns the NS domain which indicates

158
00:05:54,060 --> 00:05:56,340
a response code of No Such no such

159
00:05:56,340 --> 00:05:58,440
hosting file so what happens here is

160
00:05:58,440 --> 00:06:01,740
that you know if I enrolled attention to

161
00:06:01,740 --> 00:06:04,139
the next part now the external resolver

162
00:06:04,139 --> 00:06:05,639
replace the MS domain for the original

163
00:06:05,639 --> 00:06:09,360
internal hostname the system will now

164
00:06:09,360 --> 00:06:12,600
proceed to make another DNS query that

165
00:06:12,600 --> 00:06:15,000
opens the suffix so your full DNS query

166
00:06:15,000 --> 00:06:17,180
suddenly becomes example dot internal

167
00:06:17,180 --> 00:06:20,400
dashcrop.com dot the suffix

168
00:06:20,400 --> 00:06:22,319
all this is transparent to the

169
00:06:22,319 --> 00:06:24,840
application now here's the where the

170
00:06:24,840 --> 00:06:27,840
security issue is if the suffix that is

171
00:06:27,840 --> 00:06:29,280
communicated previously communicated by

172
00:06:29,280 --> 00:06:32,639
DVD if this suffix is a domain name

173
00:06:32,639 --> 00:06:33,900
that's under the control of a third

174
00:06:33,900 --> 00:06:36,240
party it is Trivial for this third party

175
00:06:36,240 --> 00:06:39,539
to return any remote IP address any

176
00:06:39,539 --> 00:06:42,720
public IP address for any hostname query

177
00:06:42,720 --> 00:06:44,940
for this suffix because you can just

178
00:06:44,940 --> 00:06:46,620
create it as a wild card c-name entry

179
00:06:46,620 --> 00:06:50,460
that's one example a entry so over here

180
00:06:50,460 --> 00:06:52,520
let's assume that everybody has done so

181
00:06:52,520 --> 00:06:55,380
example.international.com the surface is

182
00:06:55,380 --> 00:06:58,319
a is a value domain name itself

183
00:06:58,319 --> 00:07:00,360
from there public resource returned

184
00:07:00,360 --> 00:07:02,819
another remote IP address is controlled

185
00:07:02,819 --> 00:07:05,220
by the third party and the system will

186
00:07:05,220 --> 00:07:07,020
return this IP address to the

187
00:07:07,020 --> 00:07:09,539
application so all this while the

188
00:07:09,539 --> 00:07:12,360
application assumes that this remote IP

189
00:07:12,360 --> 00:07:13,919
response that receives here from the

190
00:07:13,919 --> 00:07:15,960
public resolver is actually the answer

191
00:07:15,960 --> 00:07:18,660
for example dot internet code.com and

192
00:07:18,660 --> 00:07:19,860
the application will communicate

193
00:07:19,860 --> 00:07:22,319
accordingly under the assumption that

194
00:07:22,319 --> 00:07:24,240
that is actually the top the destination

195
00:07:24,240 --> 00:07:25,979
that is is supposed to be communicating

196
00:07:25,979 --> 00:07:27,539
with when in realities that's just not

197
00:07:27,539 --> 00:07:29,759
really the case the application at no

198
00:07:29,759 --> 00:07:31,919
point is aware that the IP address

199
00:07:31,919 --> 00:07:33,780
actually is the IP address for the

200
00:07:33,780 --> 00:07:35,819
suffix into it so that's where the issue

201
00:07:35,819 --> 00:07:38,819
is now just as a sample to further

202
00:07:38,819 --> 00:07:40,800
illustrate what this really means I hear

203
00:07:40,800 --> 00:07:42,840
a packet capture sample here we

204
00:07:42,840 --> 00:07:44,639
deliberately choose not instant domains

205
00:07:44,639 --> 00:07:46,080
but the point here is that we don't want

206
00:07:46,080 --> 00:07:48,120
to show what the behavior is from the

207
00:07:48,120 --> 00:07:51,979
system DNS resolver so I we deliver a

208
00:07:51,979 --> 00:07:54,080
non-existent domain

209
00:07:54,080 --> 00:07:57,120
example121212.net so as expected the

210
00:07:57,120 --> 00:07:59,699
public resource returned the hosting

211
00:07:59,699 --> 00:08:01,979
does not exist what you see here

212
00:08:01,979 --> 00:08:03,479
highlighted in break this is the

213
00:08:03,479 --> 00:08:04,860
subsequent part and that part is

214
00:08:04,860 --> 00:08:06,419
transparent to the application this part

215
00:08:06,419 --> 00:08:08,520
is the appending behavior is something

216
00:08:08,520 --> 00:08:10,620
that a system does on its own so over

217
00:08:10,620 --> 00:08:12,840
here previously we advertise a DNS

218
00:08:12,840 --> 00:08:16,020
suffix of non-tech assistant121212.com

219
00:08:16,020 --> 00:08:17,819
notice here that we have the original

220
00:08:17,819 --> 00:08:19,280
query

221
00:08:19,280 --> 00:08:21,860
example1212.net dot

222
00:08:21,860 --> 00:08:23,580
non-existence121212.com that is the

223
00:08:23,580 --> 00:08:25,620
surface non-existent1212.com is the

224
00:08:25,620 --> 00:08:28,080
Sussex so in this case the taxi numbers

225
00:08:28,080 --> 00:08:29,819
the track scenario here will be is a

226
00:08:29,819 --> 00:08:31,979
third party measures to get all of this

227
00:08:31,979 --> 00:08:33,419
information and loads of the assistant

228
00:08:33,419 --> 00:08:35,760
successful suffix and registers that

229
00:08:35,760 --> 00:08:38,279
particle surface in polydians Via your

230
00:08:38,279 --> 00:08:40,559
typical DNS register so if taking

231
00:08:40,559 --> 00:08:42,299
control of that domain and there are

232
00:08:42,299 --> 00:08:43,559
endpoints that are configured this

233
00:08:43,559 --> 00:08:44,820
perfect what's going to happen is that

234
00:08:44,820 --> 00:08:47,220
they are we are essentially having a

235
00:08:47,220 --> 00:08:49,980
takeover a table scenario you can

236
00:08:49,980 --> 00:08:52,980
impersonate any internal host that is

237
00:08:52,980 --> 00:08:54,779
better on the concrete Network by just

238
00:08:54,779 --> 00:08:55,980
pointing them towards an IP address

239
00:08:55,980 --> 00:08:57,300
phone value

240
00:08:57,300 --> 00:09:00,300
so now I got to move on to a further

241
00:09:00,300 --> 00:09:01,560
background about how we discover the

242
00:09:01,560 --> 00:09:02,640
issue as well as some of the key

243
00:09:02,640 --> 00:09:05,959
findings that we brought from this

244
00:09:06,120 --> 00:09:08,700
cool so we first made this observation

245
00:09:08,700 --> 00:09:11,040
within our Network while looking at DNS

246
00:09:11,040 --> 00:09:13,440
locks where we saw unrecognized domain

247
00:09:13,440 --> 00:09:16,320
suffixes on internal traffic or traffic

248
00:09:16,320 --> 00:09:18,839
that is unintended for those domain

249
00:09:18,839 --> 00:09:21,480
suffixes well we took a look at these

250
00:09:21,480 --> 00:09:23,220
domains some of them are registered

251
00:09:23,220 --> 00:09:25,860
mostly to isps to router manufacturers

252
00:09:25,860 --> 00:09:28,980
though there are some exceptions but the

253
00:09:28,980 --> 00:09:31,920
bulk of it they are unregistered so um

254
00:09:31,920 --> 00:09:34,200
we thought we're wondering what we will

255
00:09:34,200 --> 00:09:35,580
see if we've had registered those

256
00:09:35,580 --> 00:09:37,500
domains and style listening on onto them

257
00:09:37,500 --> 00:09:40,260
right so we picked a few and we started

258
00:09:40,260 --> 00:09:42,720
registering them based on the observed

259
00:09:42,720 --> 00:09:44,700
suffixes and started listening to the

260
00:09:44,700 --> 00:09:45,600
traffic

261
00:09:45,600 --> 00:09:48,660
and we found that we we did in fact

262
00:09:48,660 --> 00:09:51,899
um we were in fact able to listen to

263
00:09:51,899 --> 00:09:53,519
um unintended traffic internal traffic

264
00:09:53,519 --> 00:09:55,620
sensitive traffic they were being linked

265
00:09:55,620 --> 00:09:57,240
to us by different corporations

266
00:09:57,240 --> 00:09:59,940
and we decided to also expand the number

267
00:09:59,940 --> 00:10:01,620
of domains that we're listening on just

268
00:10:01,620 --> 00:10:04,440
to get more volume and we did so using a

269
00:10:04,440 --> 00:10:05,700
few methods right first of all we use

270
00:10:05,700 --> 00:10:08,040
open data sets for instance uh before

271
00:10:08,040 --> 00:10:10,500
USD commission Alex's top 1 million

272
00:10:10,500 --> 00:10:13,500
domains uh we took that we dumped it to

273
00:10:13,500 --> 00:10:16,320
bulk domain checks to see which domains

274
00:10:16,320 --> 00:10:19,040
weren't registered or had expired

275
00:10:19,040 --> 00:10:21,779
although this might be a different a

276
00:10:21,779 --> 00:10:23,220
slightly different use case but this is

277
00:10:23,220 --> 00:10:24,899
one of the ways that we have obtained a

278
00:10:24,899 --> 00:10:27,480
larger pool of domains we also did some

279
00:10:27,480 --> 00:10:28,920
guesswork from certain patterns for

280
00:10:28,920 --> 00:10:30,779
instance certain router manufacturers

281
00:10:30,779 --> 00:10:33,480
they might have some default patterns on

282
00:10:33,480 --> 00:10:36,620
their domain suffixes it might be called

283
00:10:36,620 --> 00:10:39,480
routerabc.com right so the ABC is the

284
00:10:39,480 --> 00:10:42,180
variating string so using that pattern

285
00:10:42,180 --> 00:10:44,940
we varied the string and we got about 50

286
00:10:44,940 --> 00:10:47,279
hit rate some of them receive traffic

287
00:10:47,279 --> 00:10:49,260
some of them didn't

288
00:10:49,260 --> 00:10:52,560
uh we also use utilize some of the

289
00:10:52,560 --> 00:10:54,000
traffic that we have received for

290
00:10:54,000 --> 00:10:55,680
instance based on the internal traffic

291
00:10:55,680 --> 00:10:57,540
that we have been listening to uh we

292
00:10:57,540 --> 00:10:59,459
look at the Domain surfaces and some of

293
00:10:59,459 --> 00:11:01,560
the domain suffixes were not registered

294
00:11:01,560 --> 00:11:03,540
so based on that we further expanded our

295
00:11:03,540 --> 00:11:06,120
pool of domains now with regards to what

296
00:11:06,120 --> 00:11:07,800
this domains are unfortunately we are

297
00:11:07,800 --> 00:11:09,899
under non-disclosure with the uh

298
00:11:09,899 --> 00:11:12,899
supposed misconfiguration owners uh I

299
00:11:12,899 --> 00:11:14,339
can give you an example for instance for

300
00:11:14,339 --> 00:11:16,260
instance hotspot owners right many of

301
00:11:16,260 --> 00:11:18,959
the hospital owners would have may have

302
00:11:18,959 --> 00:11:21,000
uh misconfiguration in their domain

303
00:11:21,000 --> 00:11:22,440
surfaces within their network

304
00:11:22,440 --> 00:11:25,140
configuration so um we have reported to

305
00:11:25,140 --> 00:11:26,880
them and because it affects their

306
00:11:26,880 --> 00:11:27,839
customers

307
00:11:27,839 --> 00:11:31,380
um we can't disclose uh these domains

308
00:11:31,380 --> 00:11:34,140
and this is an example how the suffix

309
00:11:34,140 --> 00:11:35,760
will look like when someone has already

310
00:11:35,760 --> 00:11:39,000
shown but just to show again if your

311
00:11:39,000 --> 00:11:41,839
traffic was intended to hit

312
00:11:41,839 --> 00:11:43,399
example.internacorp.com

313
00:11:43,399 --> 00:11:45,540
with this misconfiguration which is

314
00:11:45,540 --> 00:11:47,160
pretty widespread we will see in a bit

315
00:11:47,160 --> 00:11:49,560
we the traffic will actually hit suffix

316
00:11:49,560 --> 00:11:52,079
domain.com instead so if we have a you

317
00:11:52,079 --> 00:11:53,760
set up a listener on suffix domain.com

318
00:11:53,760 --> 00:11:55,620
you'll be listening to this unintended

319
00:11:55,620 --> 00:11:57,480
or this intended traffic being routed to

320
00:11:57,480 --> 00:12:00,000
you and this misconfiguration can come

321
00:12:00,000 --> 00:12:02,100
in multiple layers from our observations

322
00:12:02,100 --> 00:12:04,740
or it can come from your browser you can

323
00:12:04,740 --> 00:12:06,600
come from your opening system on a

324
00:12:06,600 --> 00:12:09,000
network level if you are at home or

325
00:12:09,000 --> 00:12:10,860
private Network it can be on your router

326
00:12:10,860 --> 00:12:14,040
or even ISP as well and based on the

327
00:12:14,040 --> 00:12:16,320
past few months of observation we have

328
00:12:16,320 --> 00:12:18,779
seen over 7 000 different entities

329
00:12:18,779 --> 00:12:21,360
unique entities sending their either

330
00:12:21,360 --> 00:12:23,640
intended or internal or unintended

331
00:12:23,640 --> 00:12:26,600
traffic to us now this 7000 will include

332
00:12:26,600 --> 00:12:30,019
mnc's uh small media Enterprises

333
00:12:30,019 --> 00:12:33,839
different schools governments and a

334
00:12:33,839 --> 00:12:35,579
whole bunch of individuals as well or

335
00:12:35,579 --> 00:12:37,740
their own private Network now let's take

336
00:12:37,740 --> 00:12:40,140
a look at some sample logs that we've

337
00:12:40,140 --> 00:12:41,399
captured

338
00:12:41,399 --> 00:12:43,800
this is an aggregated view of in this

339
00:12:43,800 --> 00:12:45,360
case we are specifically looking for

340
00:12:45,360 --> 00:12:46,920
anti it's a bit small but it's like

341
00:12:46,920 --> 00:12:48,660
we're specifically looking for nclm

342
00:12:48,660 --> 00:12:52,320
hashes this is of course redacted we

343
00:12:52,320 --> 00:12:55,800
have mask out the user the username so

344
00:12:55,800 --> 00:12:58,620
as the domain and part of the hasher

345
00:12:58,620 --> 00:13:00,420
store but just to show kind of the

346
00:13:00,420 --> 00:13:02,120
volume at which we are collecting

347
00:13:02,120 --> 00:13:05,639
secrets in this case over the over a

348
00:13:05,639 --> 00:13:07,800
period of 90 days or three months we

349
00:13:07,800 --> 00:13:12,600
have received over 650 000 of such ntlm

350
00:13:12,600 --> 00:13:14,820
hashes different sets of anti-im hashes

351
00:13:14,820 --> 00:13:16,680
and we'll talk more about the impact in

352
00:13:16,680 --> 00:13:18,540
a bit if you look at the trend it's uh

353
00:13:18,540 --> 00:13:20,279
undulating it's because at different

354
00:13:20,279 --> 00:13:21,899
points of time we might be listening to

355
00:13:21,899 --> 00:13:24,540
different kinds of traffic so it might

356
00:13:24,540 --> 00:13:27,000
not be as consistent but this is just a

357
00:13:27,000 --> 00:13:30,480
sensing of where on the volume itself

358
00:13:30,480 --> 00:13:33,300
let's look at some other uh types of

359
00:13:33,300 --> 00:13:36,300
logs

360
00:13:37,560 --> 00:13:41,579
so this is the web blocks uh we set our

361
00:13:41,579 --> 00:13:45,300
Apache instance and we listen for the

362
00:13:45,300 --> 00:13:48,660
URI paths that were being hit by this

363
00:13:48,660 --> 00:13:51,420
the various organizations and this is uh

364
00:13:51,420 --> 00:13:53,579
within 30 days right so within 30 days

365
00:13:53,579 --> 00:13:57,480
we see more than 10 000 unique URL URI

366
00:13:57,480 --> 00:14:00,959
paths uh sorting by count you see the

367
00:14:00,959 --> 00:14:03,779
first the first hit you see wpet.det

368
00:14:03,779 --> 00:14:05,760
which is your web proxy Auto Discovery

369
00:14:05,760 --> 00:14:08,220
protocol this will tell your browser how

370
00:14:08,220 --> 00:14:10,380
to configure its proxy settings

371
00:14:10,380 --> 00:14:15,240
uh next we see AV binaries and we will

372
00:14:15,240 --> 00:14:16,860
also see some patches

373
00:14:16,860 --> 00:14:18,779
and we see

374
00:14:18,779 --> 00:14:21,000
Microsoft active sync polling for mail

375
00:14:21,000 --> 00:14:23,779
updates from different clients

376
00:14:23,779 --> 00:14:27,720
and we see printed discovery and

377
00:14:27,720 --> 00:14:30,000
generate underscore 204 which is related

378
00:14:30,000 --> 00:14:31,800
to captive portal

379
00:14:31,800 --> 00:14:34,500
we also see requests for APK binaries so

380
00:14:34,500 --> 00:14:35,880
and so forth and the other observations

381
00:14:35,880 --> 00:14:38,519
that we had was were internal files file

382
00:14:38,519 --> 00:14:43,019
shares directories and documents and

383
00:14:43,019 --> 00:14:44,100
many of these documents are actually

384
00:14:44,100 --> 00:14:47,040
bearing sensitive project names

385
00:14:47,040 --> 00:14:49,980
uh we also saw SCCM polling so and so

386
00:14:49,980 --> 00:14:52,440
forth let's drill down on active sync as

387
00:14:52,440 --> 00:14:55,079
an example so you can see over here

388
00:14:55,079 --> 00:14:56,040
um

389
00:14:56,040 --> 00:14:59,519
on the web blocks itself we saw about

390
00:14:59,519 --> 00:15:03,779
200 plus unique users with their clients

391
00:15:03,779 --> 00:15:07,440
on Legacy trying to do a poll on active

392
00:15:07,440 --> 00:15:10,920
sync to pull any email pool or email

393
00:15:10,920 --> 00:15:12,420
updates

394
00:15:12,420 --> 00:15:15,120
right so let's look at more samples on

395
00:15:15,120 --> 00:15:16,440
logs

396
00:15:16,440 --> 00:15:19,860
we'll look at some Roblox over here what

397
00:15:19,860 --> 00:15:21,540
we see over here is a bit messy but this

398
00:15:21,540 --> 00:15:24,600
is a stream of captured uh raw HTTP

399
00:15:24,600 --> 00:15:26,459
request of an endpoint attempt to

400
00:15:26,459 --> 00:15:28,560
register with an on-prem tychotic

401
00:15:28,560 --> 00:15:31,079
privilege management system or indicated

402
00:15:31,079 --> 00:15:32,579
crtms

403
00:15:32,579 --> 00:15:35,279
so tychotic is a Pam solution privileged

404
00:15:35,279 --> 00:15:36,600
access management

405
00:15:36,600 --> 00:15:39,300
and the secret server traffic is meant

406
00:15:39,300 --> 00:15:41,040
to be highly sensitive but in this case

407
00:15:41,040 --> 00:15:43,380
it was leaked by one of the companies

408
00:15:43,380 --> 00:15:45,540
that we have uh that was sending traffic

409
00:15:45,540 --> 00:15:46,800
to us

410
00:15:46,800 --> 00:15:50,459
next we see an attempt by endpoint to

411
00:15:50,459 --> 00:15:53,100
access a local network file share so

412
00:15:53,100 --> 00:15:55,740
this is showing up as hdb requests on

413
00:15:55,740 --> 00:15:57,600
our site from the Microsoft web dev

414
00:15:57,600 --> 00:15:59,940
client because Windows fell back to

415
00:15:59,940 --> 00:16:02,120
attempting the destination via web dev

416
00:16:02,120 --> 00:16:05,279
when SMB fails in this case you know

417
00:16:05,279 --> 00:16:08,060
testing server we did not host any SMB

418
00:16:08,060 --> 00:16:13,019
shares and and therefore the fallback

419
00:16:13,019 --> 00:16:15,899
uh with the sample logs now let's look

420
00:16:15,899 --> 00:16:17,699
at some key observations and impacts

421
00:16:17,699 --> 00:16:20,760
that we have uh noted down uh first item

422
00:16:20,760 --> 00:16:23,459
first right we saw ntlm hash and NTM

423
00:16:23,459 --> 00:16:26,699
hashes uh in the first sample uh sample

424
00:16:26,699 --> 00:16:30,540
capture log slide so potentially uh this

425
00:16:30,540 --> 00:16:31,620
is not something we did but potentially

426
00:16:31,620 --> 00:16:34,440
we can attempt offline password cracking

427
00:16:34,440 --> 00:16:38,220
and we can get by the original password

428
00:16:38,220 --> 00:16:41,160
of the let's say the employees and we

429
00:16:41,160 --> 00:16:42,779
can then try to attempt to log into

430
00:16:42,779 --> 00:16:44,519
their SSO endpoint or whichever

431
00:16:44,519 --> 00:16:46,380
endpoints right or Legacy endpoints for

432
00:16:46,380 --> 00:16:49,459
instance and if the employees

433
00:16:49,459 --> 00:16:52,259
use do password we use on their

434
00:16:52,259 --> 00:16:54,300
passwords which is fairly common then we

435
00:16:54,300 --> 00:16:55,560
can pivot to their other personal

436
00:16:55,560 --> 00:16:58,800
machines as well and if we were a

437
00:16:58,800 --> 00:17:00,839
network attacker instead of a web we

438
00:17:00,839 --> 00:17:02,220
could also perform a man in the middle

439
00:17:02,220 --> 00:17:05,280
or replay relay attacks for

440
00:17:05,280 --> 00:17:07,260
Authentication

441
00:17:07,260 --> 00:17:09,720
uh we saw a bunch of internal power

442
00:17:09,720 --> 00:17:11,819
subdomains asset names internet host

443
00:17:11,819 --> 00:17:13,919
names different softwares that are being

444
00:17:13,919 --> 00:17:15,900
used their own builds different file

445
00:17:15,900 --> 00:17:18,419
names and this uh all part of sensitive

446
00:17:18,419 --> 00:17:20,339
information disclosure that isn't

447
00:17:20,339 --> 00:17:21,780
intended by the companies to expose

448
00:17:21,780 --> 00:17:24,900
externally uh and on the same note we

449
00:17:24,900 --> 00:17:27,179
also saw metadata such as email

450
00:17:27,179 --> 00:17:28,620
addresses that we've saw or that we've

451
00:17:28,620 --> 00:17:32,520
seen IDs phone numbers uh location of

452
00:17:32,520 --> 00:17:35,400
the uh the users from which country they

453
00:17:35,400 --> 00:17:36,960
are which transport they are at

454
00:17:36,960 --> 00:17:38,580
currently

455
00:17:38,580 --> 00:17:43,679
uh on the wpet uh dot debt uh

456
00:17:43,679 --> 00:17:46,559
that is uh we could actually uh exploit

457
00:17:46,559 --> 00:17:49,140
that to serve a malicious configuration

458
00:17:49,140 --> 00:17:51,179
files right in this case we would be

459
00:17:51,179 --> 00:17:54,120
able to act as a proxy layer and

460
00:17:54,120 --> 00:17:56,880
intercept their audio traffic subsequent

461
00:17:56,880 --> 00:17:58,620
traffic once we have kind of polluted

462
00:17:58,620 --> 00:18:00,240
the the proxy

463
00:18:00,240 --> 00:18:02,340
we saw sscm deployments status updates

464
00:18:02,340 --> 00:18:05,580
for antivirus uh next item we have error

465
00:18:05,580 --> 00:18:06,960
downstairs so and aerodynamics is a

466
00:18:06,960 --> 00:18:08,880
treasure Trove for a lot of different

467
00:18:08,880 --> 00:18:10,919
insights through the error done we saw

468
00:18:10,919 --> 00:18:13,440
different exceptions on exceptions that

469
00:18:13,440 --> 00:18:15,539
were not called printing out some of

470
00:18:15,539 --> 00:18:17,340
their code Snippets some of their

471
00:18:17,340 --> 00:18:20,400
internal comments and other sensitive

472
00:18:20,400 --> 00:18:22,980
data mobile traffic is an interesting

473
00:18:22,980 --> 00:18:25,620
one through our observations we have

474
00:18:25,620 --> 00:18:29,940
seen multiple hosts trying to connect to

475
00:18:29,940 --> 00:18:33,900
expired malware domains and what we did

476
00:18:33,900 --> 00:18:35,640
was we were curious to see what kind of

477
00:18:35,640 --> 00:18:37,620
traffic was being sent to the domain so

478
00:18:37,620 --> 00:18:39,960
we registered one of the expired Norway

479
00:18:39,960 --> 00:18:42,780
domains and over over one week we saw

480
00:18:42,780 --> 00:18:45,059
about 200 plus hosts connecting back to

481
00:18:45,059 --> 00:18:48,360
to it I'm sorry 300 we saw 300

482
00:18:48,360 --> 00:18:51,059
horsepower pulling back to it

483
00:18:51,059 --> 00:18:54,419
and uh HTTP cookies and request body uh

484
00:18:54,419 --> 00:18:57,000
we've seen an example previously

485
00:18:57,000 --> 00:18:59,940
since we can uh we're receiving this

486
00:18:59,940 --> 00:19:01,740
potentially we can do session hijacking

487
00:19:01,740 --> 00:19:04,860
we can also do men in the middle as well

488
00:19:04,860 --> 00:19:07,200
and for active sync we could potentially

489
00:19:07,200 --> 00:19:09,720
send fake updates to the email client

490
00:19:09,720 --> 00:19:14,059
model that wouldn't do much much damage

491
00:19:14,880 --> 00:19:17,100
right

492
00:19:17,100 --> 00:19:19,580
so

493
00:19:19,679 --> 00:19:23,220
all of these 7000 plus entities that we

494
00:19:23,220 --> 00:19:26,400
have found right we we kind of did some

495
00:19:26,400 --> 00:19:27,500
filtering

496
00:19:27,500 --> 00:19:29,460
and uh

497
00:19:29,460 --> 00:19:31,620
to see which are the ones that we could

498
00:19:31,620 --> 00:19:33,720
actually report to and uh we actually

499
00:19:33,720 --> 00:19:35,460
had a hard time trying to find uh The

500
00:19:35,460 --> 00:19:37,440
Avenues to report to the various

501
00:19:37,440 --> 00:19:39,539
organizations because it was so far

502
00:19:39,539 --> 00:19:41,580
sorry and at the end of the day we

503
00:19:41,580 --> 00:19:43,679
filtered out to a few hundreds that were

504
00:19:43,679 --> 00:19:45,480
relatively confident in correctly

505
00:19:45,480 --> 00:19:47,700
mapping out the ncrm domain to the right

506
00:19:47,700 --> 00:19:49,440
organization uh what do I mean by this

507
00:19:49,440 --> 00:19:51,360
one for instance the ntim domain might

508
00:19:51,360 --> 00:19:54,120
say it is company ABC but which company

509
00:19:54,120 --> 00:19:55,679
ABC would that be there are multiple

510
00:19:55,679 --> 00:19:57,960
company ABCs and within this country

511
00:19:57,960 --> 00:19:59,760
there are multiple companies are called

512
00:19:59,760 --> 00:20:01,380
ABC right so the attribution was a

513
00:20:01,380 --> 00:20:03,840
little tough uh we measured drilled on

514
00:20:03,840 --> 00:20:05,400
to a few hundreds and out of those few

515
00:20:05,400 --> 00:20:07,919
hundred uh we only found we only managed

516
00:20:07,919 --> 00:20:10,140
to find a suitable channels for a

517
00:20:10,140 --> 00:20:12,120
handful of them in this case we we have

518
00:20:12,120 --> 00:20:14,880
so far reported to 45 entities

519
00:20:14,880 --> 00:20:18,900
denoted by the send key diagram above so

520
00:20:18,900 --> 00:20:22,320
all of the 42 diagrams are 42 entities

521
00:20:22,320 --> 00:20:24,960
that we've reported to 26 were through a

522
00:20:24,960 --> 00:20:26,700
dedicated program that is through bank

523
00:20:26,700 --> 00:20:28,320
Bounty vulnerability disclosure program

524
00:20:28,320 --> 00:20:32,880
VDP or csat uh email uh inbox for

525
00:20:32,880 --> 00:20:33,780
instance

526
00:20:33,780 --> 00:20:36,840
and out of this 20 26 9 were accepted

527
00:20:36,840 --> 00:20:38,460
for

528
00:20:38,460 --> 00:20:40,980
paid out the Bounty and five did not for

529
00:20:40,980 --> 00:20:42,720
the ones that did not they are usually

530
00:20:42,720 --> 00:20:44,640
part of the bdp program where they do

531
00:20:44,640 --> 00:20:47,280
not incentivize but instead they uh they

532
00:20:47,280 --> 00:20:49,440
offer some kind of other recognition uh

533
00:20:49,440 --> 00:20:50,640
two of them are pretty interesting they

534
00:20:50,640 --> 00:20:52,679
thought we attacked them so they were

535
00:20:52,679 --> 00:20:54,720
questioning uh they were asking a lot of

536
00:20:54,720 --> 00:20:56,280
questions like did we tailgate their

537
00:20:56,280 --> 00:20:58,860
employees did we enter their premises uh

538
00:20:58,860 --> 00:20:59,880
how do we connect to their Network

539
00:20:59,880 --> 00:21:01,200
things like that so we had a hard time

540
00:21:01,200 --> 00:21:04,799
explaining to them uh about how we did

541
00:21:04,799 --> 00:21:07,260
the the scenario the attack scenario

542
00:21:07,260 --> 00:21:09,240
four of them deem findings as

543
00:21:09,240 --> 00:21:12,080
informational citing that they had other

544
00:21:12,080 --> 00:21:14,340
defensive mechanisms for instance they

545
00:21:14,340 --> 00:21:16,860
had a MFA their hashing algorithm was

546
00:21:16,860 --> 00:21:18,840
strong enough what it's all fine and

547
00:21:18,840 --> 00:21:20,580
none of them are still pending uh

548
00:21:20,580 --> 00:21:22,320
probably it's probably four to five

549
00:21:22,320 --> 00:21:23,940
months now

550
00:21:23,940 --> 00:21:27,120
uh we did also report this to two major

551
00:21:27,120 --> 00:21:29,820
software vendors but as usual many of

552
00:21:29,820 --> 00:21:31,440
them would say this is a feature more

553
00:21:31,440 --> 00:21:33,080
than a bug

554
00:21:33,080 --> 00:21:36,240
uh we did contact a number of them

555
00:21:36,240 --> 00:21:38,640
through their generic contact forms and

556
00:21:38,640 --> 00:21:39,960
email addresses because we couldn't find

557
00:21:39,960 --> 00:21:41,520
a dedicated Channel and as you can see

558
00:21:41,520 --> 00:21:43,919
over here uh they did not even

559
00:21:43,919 --> 00:21:46,559
acknowledge they did not reply and so we

560
00:21:46,559 --> 00:21:47,520
kind of stopped it at this straight

561
00:21:47,520 --> 00:21:49,080
right if they do not

562
00:21:49,080 --> 00:21:51,780
uh reply uh then it's it's kind of

563
00:21:51,780 --> 00:21:53,580
wasting our efforts so as as you can see

564
00:21:53,580 --> 00:21:55,440
over here right it's important to have a

565
00:21:55,440 --> 00:21:57,600
dedicated and structured program to

566
00:21:57,600 --> 00:21:59,460
receive such

567
00:21:59,460 --> 00:22:01,440
researcher reports even if you don't

568
00:22:01,440 --> 00:22:03,539
have a structured program uh you know at

569
00:22:03,539 --> 00:22:05,460
least a email inbox a dedicated email

570
00:22:05,460 --> 00:22:06,780
inbox

571
00:22:06,780 --> 00:22:08,760
uh we did also

572
00:22:08,760 --> 00:22:09,419
um

573
00:22:09,419 --> 00:22:12,360
uh report this to several router

574
00:22:12,360 --> 00:22:13,679
manufacturers although they did not

575
00:22:13,679 --> 00:22:16,260
acknowledge we did speak to CIS

576
00:22:16,260 --> 00:22:19,799
benchmarking and they have accepted our

577
00:22:19,799 --> 00:22:22,080
proposal for this to be added as a

578
00:22:22,080 --> 00:22:23,820
hardening item and this will be

579
00:22:23,820 --> 00:22:26,460
published later on

580
00:22:26,460 --> 00:22:28,799
now let's look at the kind of our magic

581
00:22:28,799 --> 00:22:31,860
quadrant over here where we have the

582
00:22:31,860 --> 00:22:34,679
assigned celebrity in the y-axis and the

583
00:22:34,679 --> 00:22:36,539
speed of three option limitation in our

584
00:22:36,539 --> 00:22:39,059
x-axis if I may Point your attention to

585
00:22:39,059 --> 00:22:42,419
the top right corner uh you see cyber

586
00:22:42,419 --> 00:22:44,640
security from number one being the first

587
00:22:44,640 --> 00:22:46,919
to remediate

588
00:22:46,919 --> 00:22:49,740
uh this uh this report that that we've

589
00:22:49,740 --> 00:22:51,900
sent in no surprises over here we have

590
00:22:51,900 --> 00:22:55,440
actually submitted this as a P3 and they

591
00:22:55,440 --> 00:22:57,360
have escalated this to a P1 and within

592
00:22:57,360 --> 00:22:59,640
two days they close they implemented the

593
00:22:59,640 --> 00:23:01,080
fix they close it out and they paid out

594
00:23:01,080 --> 00:23:03,000
a bounty and it thank us about this so

595
00:23:03,000 --> 00:23:05,280
not surprising for cyber security one

596
00:23:05,280 --> 00:23:07,559
uh what is the pricing over here is that

597
00:23:07,559 --> 00:23:09,419
uh there are two other companies in this

598
00:23:09,419 --> 00:23:11,520
top rank quadrant uh there is a beverage

599
00:23:11,520 --> 00:23:13,980
company and a beauty uh Products company

600
00:23:13,980 --> 00:23:15,480
that that will that we didn't expect

601
00:23:15,480 --> 00:23:17,700
they were very proactive in and prompt

602
00:23:17,700 --> 00:23:19,860
in fixing this and closing the quality

603
00:23:19,860 --> 00:23:21,840
report as compared to the other Tech

604
00:23:21,840 --> 00:23:25,140
firms uh on the bottom bottom left

605
00:23:25,140 --> 00:23:27,360
uh interest interestingly uh there are

606
00:23:27,360 --> 00:23:28,919
we reported three cyber security

607
00:23:28,919 --> 00:23:31,640
companies and um

608
00:23:31,640 --> 00:23:34,380
uh the other cyber security company tree

609
00:23:34,380 --> 00:23:36,780
right uh was ranked uh ranked pretty low

610
00:23:36,780 --> 00:23:39,480
actually uh so it's pretty ironic that a

611
00:23:39,480 --> 00:23:41,880
cyber security company wouldn't kind of

612
00:23:41,880 --> 00:23:44,280
uh pay attention to such such sensitive

613
00:23:44,280 --> 00:23:46,799
traffic being leaked

614
00:23:46,799 --> 00:23:49,200
there were actually a couple of a

615
00:23:49,200 --> 00:23:51,179
handful of consulting firms providing

616
00:23:51,179 --> 00:23:52,799
cyber security services that were

617
00:23:52,799 --> 00:23:54,539
vulnerable as well but they either

618
00:23:54,539 --> 00:23:58,020
didn't have a Channel or bb or VDB

619
00:23:58,020 --> 00:24:00,000
program or didn't respond to our email

620
00:24:00,000 --> 00:24:02,700
and the rest of them are at the bottom

621
00:24:02,700 --> 00:24:06,059
left-hand Corner over here you see uh

622
00:24:06,059 --> 00:24:08,039
some government companies VI companies

623
00:24:08,039 --> 00:24:11,460
computer manufacturers Furniture food

624
00:24:11,460 --> 00:24:13,980
some I.T companies over here they

625
00:24:13,980 --> 00:24:15,780
average at about five to six months

626
00:24:15,780 --> 00:24:17,340
citing various complexity in

627
00:24:17,340 --> 00:24:19,200
understanding the uh the Gap that we

628
00:24:19,200 --> 00:24:22,320
have explained to them as well as having

629
00:24:22,320 --> 00:24:25,799
to fix this on a organizational wide uh

630
00:24:25,799 --> 00:24:28,799
basis uh with that uh we will now

631
00:24:28,799 --> 00:24:33,539
explain to us how this relates to to us

632
00:24:33,539 --> 00:24:36,240
right so at this point uh one common

633
00:24:36,240 --> 00:24:37,980
question they will probably be asking

634
00:24:37,980 --> 00:24:40,260
really uh at my vulnerable is my

635
00:24:40,260 --> 00:24:42,360
organization vulnerable so because of

636
00:24:42,360 --> 00:24:44,460
the nature of how the system manifests

637
00:24:44,460 --> 00:24:46,740
uh trying to really look for such active

638
00:24:46,740 --> 00:24:48,480
such Behavior occur within your

639
00:24:48,480 --> 00:24:51,179
environment is relatively trivial so in

640
00:24:51,179 --> 00:24:53,640
general uh what you should really be

641
00:24:53,640 --> 00:24:55,980
looking at are DNS queries originating

642
00:24:55,980 --> 00:24:57,960
from your endpoints that is from your

643
00:24:57,960 --> 00:25:00,539
computer with the pattern of your

644
00:25:00,539 --> 00:25:03,299
organization domain dot whatever TLT dot

645
00:25:03,299 --> 00:25:06,360
whatever comes after that so yeah that

646
00:25:06,360 --> 00:25:07,919
is the video this channel guide here we

647
00:25:07,919 --> 00:25:09,780
have specific queries for different

648
00:25:09,780 --> 00:25:11,820
scenes but uh the journal principle

649
00:25:11,820 --> 00:25:14,159
Remains the Same now one thing that we

650
00:25:14,159 --> 00:25:15,900
need to emphasize is that when you look

651
00:25:15,900 --> 00:25:18,960
for logs for available for DNS DNS Lots

652
00:25:18,960 --> 00:25:21,600
specifically it is recommended that you

653
00:25:21,600 --> 00:25:24,120
query the loss of that come from your

654
00:25:24,120 --> 00:25:26,880
endpoints themselves it is not as

655
00:25:26,880 --> 00:25:29,279
effective to query your internal DNS

656
00:25:29,279 --> 00:25:32,039
resolver for such a behavior why do we

657
00:25:32,039 --> 00:25:34,860
say so is because by this definition a

658
00:25:34,860 --> 00:25:36,720
successful exploitation so to speak of

659
00:25:36,720 --> 00:25:39,179
this vulnerable behavior requires the

660
00:25:39,179 --> 00:25:40,980
end point to be disconnected from a

661
00:25:40,980 --> 00:25:42,900
corporator because if you are connected

662
00:25:42,900 --> 00:25:44,940
to your corporate Network and you may

663
00:25:44,940 --> 00:25:46,380
perform the query against your internal

664
00:25:46,380 --> 00:25:48,240
resolvers you will never reach the point

665
00:25:48,240 --> 00:25:50,400
where you where the system makes the

666
00:25:50,400 --> 00:25:52,740
query the DNS query for the suffix

667
00:25:52,740 --> 00:25:54,840
domain because the internal resolver

668
00:25:54,840 --> 00:25:56,279
would have responded with a very

669
00:25:56,279 --> 00:25:58,320
internal id address so for this reason

670
00:25:58,320 --> 00:26:01,500
package is your intelligence resolvers

671
00:26:01,500 --> 00:26:03,299
are not likely to throw any positive

672
00:26:03,299 --> 00:26:04,860
results so this needs to be determined

673
00:26:04,860 --> 00:26:07,380
at the endpoint level so for this year

674
00:26:07,380 --> 00:26:08,940
you have to probably look into your

675
00:26:08,940 --> 00:26:11,400
device management infrastructure or your

676
00:26:11,400 --> 00:26:13,260
endpoint detection response solution

677
00:26:13,260 --> 00:26:15,960
whichever applies to your organization

678
00:26:15,960 --> 00:26:18,179
as an alternative if your organization

679
00:26:18,179 --> 00:26:19,980
has a capability to do so you can also

680
00:26:19,980 --> 00:26:22,980
run the on Microsoft Windows endpoints

681
00:26:22,980 --> 00:26:24,360
you can run the get DNS client

682
00:26:24,360 --> 00:26:26,640
Powershell commandlet that will allow

683
00:26:26,640 --> 00:26:28,980
you to list the configuration for each

684
00:26:28,980 --> 00:26:31,140
network adapter and the configuration uh

685
00:26:31,140 --> 00:26:34,080
the command output does show the DNS

686
00:26:34,080 --> 00:26:36,419
such surface value and by the way the

687
00:26:36,419 --> 00:26:38,340
DNS such suffix value does support

688
00:26:38,340 --> 00:26:40,140
multiple variants so this is something

689
00:26:40,140 --> 00:26:42,419
that could be done in your organization

690
00:26:42,419 --> 00:26:44,640
so we are looking at so this is the part

691
00:26:44,640 --> 00:26:46,440
about looking at our cinematic

692
00:26:46,440 --> 00:26:49,200
perspective so the next Point here would

693
00:26:49,200 --> 00:26:51,240
be what exactly should we be doing to

694
00:26:51,240 --> 00:26:53,760
stop this in the first place now as got

695
00:26:53,760 --> 00:26:55,740
alluded to earlier this is actually a

696
00:26:55,740 --> 00:26:59,100
feature rather than a block so on

697
00:26:59,100 --> 00:27:01,200
Windows or rather the for about majority

698
00:27:01,200 --> 00:27:03,120
of places we did observe them coming

699
00:27:03,120 --> 00:27:05,820
from the system DNS sliding on windows

700
00:27:05,820 --> 00:27:07,679
so on Windows endpoints the fix is

701
00:27:07,679 --> 00:27:09,419
relatively trivial you just push this

702
00:27:09,419 --> 00:27:11,640
particular group policy object to all of

703
00:27:11,640 --> 00:27:13,200
your endpoints so as you can see here

704
00:27:13,200 --> 00:27:15,179
allow DNS suffix appending to

705
00:27:15,179 --> 00:27:17,700
unqualified multi-label name queries uh

706
00:27:17,700 --> 00:27:20,039
name here really does is really it's

707
00:27:20,039 --> 00:27:21,720
quite self-explanatory here this should

708
00:27:21,720 --> 00:27:24,840
be explicitly set to disabled and it's

709
00:27:24,840 --> 00:27:26,760
not configured state in a default not

710
00:27:26,760 --> 00:27:29,279
configured State the default behavior is

711
00:27:29,279 --> 00:27:30,960
to enable such surface offending

712
00:27:30,960 --> 00:27:32,159
Behavior

713
00:27:32,159 --> 00:27:35,159
now next for Google Chrome as well as

714
00:27:35,159 --> 00:27:36,720
all chromium based browsers we did

715
00:27:36,720 --> 00:27:38,880
identify that there is a small handful

716
00:27:38,880 --> 00:27:41,159
of chrome browsers or non-windows

717
00:27:41,159 --> 00:27:43,740
endpoints predominantly Mac OS where

718
00:27:43,740 --> 00:27:45,240
Chrome or the Chromium browser

719
00:27:45,240 --> 00:27:47,580
implements it its own built-in DNS

720
00:27:47,580 --> 00:27:49,260
client that means it's independent of

721
00:27:49,260 --> 00:27:53,279
the system DNS client so for this uh if

722
00:27:53,279 --> 00:27:55,020
you want to stop this Behavior occurring

723
00:27:55,020 --> 00:27:57,059
on Chrome on Chrome browser the Chrome

724
00:27:57,059 --> 00:27:59,159
web browser specifically reach the

725
00:27:59,159 --> 00:28:01,620
policy flag built-in DNS client enabled

726
00:28:01,620 --> 00:28:03,659
should be set to 4. now this policy

727
00:28:03,659 --> 00:28:06,360
effect can be set either in your device

728
00:28:06,360 --> 00:28:08,700
management system or by manic

729
00:28:08,700 --> 00:28:10,440
preferences whichever works for your

730
00:28:10,440 --> 00:28:12,360
organization now there's just one thing

731
00:28:12,360 --> 00:28:13,860
we want to clarify here although we say

732
00:28:13,860 --> 00:28:15,900
that Chrome and chromium based browsers

733
00:28:15,900 --> 00:28:19,260
do estimate such DNS surface appending

734
00:28:19,260 --> 00:28:22,020
Behavior we need test it out and we

735
00:28:22,020 --> 00:28:24,419
found that we did not find it possible

736
00:28:24,419 --> 00:28:27,000
to actually in person in TLS protected

737
00:28:27,000 --> 00:28:30,480
websites so the TLs the TRS mechanism

738
00:28:30,480 --> 00:28:32,100
works as intended you get a certificate

739
00:28:32,100 --> 00:28:34,559
me or of course it remains a warning of

740
00:28:34,559 --> 00:28:36,240
course whether the user bypasses their

741
00:28:36,240 --> 00:28:38,100
money that's a different question

742
00:28:38,100 --> 00:28:41,400
uh next item uh ecl home user now will

743
00:28:41,400 --> 00:28:43,260
be probably a good time to look at your

744
00:28:43,260 --> 00:28:45,419
own router configuration and if your

745
00:28:45,419 --> 00:28:47,400
router configuration does have a domain

746
00:28:47,400 --> 00:28:50,760
name value or DNS suffix or DNS search

747
00:28:50,760 --> 00:28:52,860
topics value in the administration

748
00:28:52,860 --> 00:28:54,840
console you probably want to either

749
00:28:54,840 --> 00:28:57,900
remove the value entirely or set it such

750
00:28:57,900 --> 00:29:00,720
that it results to either a domain that

751
00:29:00,720 --> 00:29:03,720
you own or just an inverted domain RFC

752
00:29:03,720 --> 00:29:07,200
6762 does reserve specific tlds there

753
00:29:07,200 --> 00:29:09,960
are never meant to be allowed for domain

754
00:29:09,960 --> 00:29:11,760
registration so we have got local dot

755
00:29:11,760 --> 00:29:15,000
internal dot localhost so and so forth

756
00:29:15,000 --> 00:29:18,779
now next item is your Enterprise user or

757
00:29:18,779 --> 00:29:20,720
if your Enterprise Network Administrator

758
00:29:20,720 --> 00:29:23,580
you definitely should be using your

759
00:29:23,580 --> 00:29:25,919
internal corporate domain for the DNS

760
00:29:25,919 --> 00:29:26,960
service

761
00:29:26,960 --> 00:29:29,640
let's assume it's registered at this

762
00:29:29,640 --> 00:29:32,399
point if you realize that your internal

763
00:29:32,399 --> 00:29:33,480
corporate domain is actually not

764
00:29:33,480 --> 00:29:35,159
registered on the public domain

765
00:29:35,159 --> 00:29:36,419
infrastructure you should probably

766
00:29:36,419 --> 00:29:38,039
consider your entire environment

767
00:29:38,039 --> 00:29:40,500
vulnerable and really take efforts to

768
00:29:40,500 --> 00:29:41,940
register the domain at the least

769
00:29:41,940 --> 00:29:44,760
possible opportunity now in most cases

770
00:29:44,760 --> 00:29:47,520
most Enterprises should already be using

771
00:29:47,520 --> 00:29:49,320
their internal corporate domain for

772
00:29:49,320 --> 00:29:50,880
their DNS such surface why because

773
00:29:50,880 --> 00:29:52,740
technique directory requires it to be

774
00:29:52,740 --> 00:29:54,299
sold if you do not set it to this

775
00:29:54,299 --> 00:29:55,740
correct value expect a lot of weird

776
00:29:55,740 --> 00:29:57,179
behavior and breakage from active

777
00:29:57,179 --> 00:29:58,320
directory

778
00:29:58,320 --> 00:30:02,220
now next item uh fundamentally uh how

779
00:30:02,220 --> 00:30:04,140
this DNS such surface valued or whether

780
00:30:04,140 --> 00:30:06,779
the invalid DNS or suffix value are

781
00:30:06,779 --> 00:30:09,000
communicated to prices through the DHCP

782
00:30:09,000 --> 00:30:12,059
mechanism so as always uh this this is

783
00:30:12,059 --> 00:30:13,740
really true generic advice but it also

784
00:30:13,740 --> 00:30:15,360
does apply for this particular scenario

785
00:30:15,360 --> 00:30:17,039
here as an employee if you are

786
00:30:17,039 --> 00:30:18,840
connecting your work device to some

787
00:30:18,840 --> 00:30:20,279
unknown level is something you probably

788
00:30:20,279 --> 00:30:22,980
want to pay attention to in effect if

789
00:30:22,980 --> 00:30:24,480
possible don't do it at all if you don't

790
00:30:24,480 --> 00:30:26,100
trust the network then you should trust

791
00:30:26,100 --> 00:30:28,799
if you won't be right and establishing

792
00:30:28,799 --> 00:30:31,200
VPN connections yes it may be effective

793
00:30:31,200 --> 00:30:33,120
but the problem is that during the very

794
00:30:33,120 --> 00:30:35,100
narrow time window between you

795
00:30:35,100 --> 00:30:36,960
establishing the VPN connection and you

796
00:30:36,960 --> 00:30:38,700
first connected a network that is a

797
00:30:38,700 --> 00:30:40,860
vulnerable time window and as we have

798
00:30:40,860 --> 00:30:43,740
seen earlier a lot of these DNS will be

799
00:30:43,740 --> 00:30:45,120
able to actually require user

800
00:30:45,120 --> 00:30:47,760
intervention why because this focus at

801
00:30:47,760 --> 00:30:50,039
system levels slowly something that keep

802
00:30:50,039 --> 00:30:51,659
in mind here

803
00:30:51,659 --> 00:30:53,640
now some of the challenges while

804
00:30:53,640 --> 00:30:55,020
actually attempting to chase down this

805
00:30:55,020 --> 00:30:56,520
issue well first and foremost is that

806
00:30:56,520 --> 00:30:58,919
this is a relatively unknown track case

807
00:30:58,919 --> 00:31:00,960
as far as we could tell no one has

808
00:31:00,960 --> 00:31:02,399
really talked about discount behavior

809
00:31:02,399 --> 00:31:03,659
before so there was an inherent

810
00:31:03,659 --> 00:31:05,520
difficulty really explaining the risk to

811
00:31:05,520 --> 00:31:08,039
companies not to mention that uh we took

812
00:31:08,039 --> 00:31:10,159
a we really took a very

813
00:31:10,159 --> 00:31:12,299
conservative approach here we did not

814
00:31:12,299 --> 00:31:13,919
attempt to send anything back to the

815
00:31:13,919 --> 00:31:15,840
vulnerable employees we don't attempt to

816
00:31:15,840 --> 00:31:19,380
send any binary uh crop them further we

817
00:31:19,380 --> 00:31:20,820
really just really listen to the traffic

818
00:31:20,820 --> 00:31:23,700
so as a result that it's really hard to

819
00:31:23,700 --> 00:31:26,700
tell and tell organizations what exactly

820
00:31:26,700 --> 00:31:28,500
the vulnerable Vector is because as we

821
00:31:28,500 --> 00:31:29,700
have said earlier there are multiple

822
00:31:29,700 --> 00:31:32,279
root causes here and indeed only a

823
00:31:32,279 --> 00:31:33,899
minority of companies actually recognize

824
00:31:33,899 --> 00:31:35,279
the risk where we made the initial

825
00:31:35,279 --> 00:31:38,120
report uh there are a lot of root causes

826
00:31:38,120 --> 00:31:40,440
you have mentioned earlier on the

827
00:31:40,440 --> 00:31:42,000
previous slide I mean although the most

828
00:31:42,000 --> 00:31:44,220
common root cause is really in the

829
00:31:44,220 --> 00:31:46,500
windows DNS file there were also

830
00:31:46,500 --> 00:31:48,539
applications will make with performance

831
00:31:48,539 --> 00:31:50,340
pm and that in mind this is actually

832
00:31:50,340 --> 00:31:53,399
typically valid Behavior so because the

833
00:31:53,399 --> 00:31:55,860
hosting is not fully qualified it is not

834
00:31:55,860 --> 00:31:57,840
terminated with period so that's why the

835
00:31:57,840 --> 00:31:59,820
surface gets appended to it so with

836
00:31:59,820 --> 00:32:01,500
variously causes and with our limited

837
00:32:01,500 --> 00:32:03,360
visibility we did not try to gather any

838
00:32:03,360 --> 00:32:04,980
other Telemetry we don't attempt to send

839
00:32:04,980 --> 00:32:06,419
anything back we don't attempt to

840
00:32:06,419 --> 00:32:08,159
execute anything so there's really not

841
00:32:08,159 --> 00:32:10,440
much as for us as external researchers

842
00:32:10,440 --> 00:32:12,840
to tell organizations because they at

843
00:32:12,840 --> 00:32:14,100
that point of time they know their

844
00:32:14,100 --> 00:32:15,720
internal configuration pattern that we

845
00:32:15,720 --> 00:32:18,360
do so that really adds on to the

846
00:32:18,360 --> 00:32:21,299
complexity of contributed to the

847
00:32:21,299 --> 00:32:24,179
confusion there no no one company in the

848
00:32:24,179 --> 00:32:26,279
same every company has its own uh has

849
00:32:26,279 --> 00:32:28,860
its own environment now next item that

850
00:32:28,860 --> 00:32:30,720
we want to talk about is that while we

851
00:32:30,720 --> 00:32:32,159
were reporting this to various companies

852
00:32:32,159 --> 00:32:34,260
through about 1p platform the user

853
00:32:34,260 --> 00:32:35,940
public property platform so we did

854
00:32:35,940 --> 00:32:37,860
notice that there was uh there were at

855
00:32:37,860 --> 00:32:40,020
times inconsistent reaction coming from

856
00:32:40,020 --> 00:32:42,000
the background a platform we have seen

857
00:32:42,000 --> 00:32:44,399
traces where we reported the issue to

858
00:32:44,399 --> 00:32:46,320
multiple companies via the same bug

859
00:32:46,320 --> 00:32:49,080
Bounty platform but this same issue was

860
00:32:49,080 --> 00:32:50,880
closed already prepared with different

861
00:32:50,880 --> 00:32:53,279
results on the same platform so for if

862
00:32:53,279 --> 00:32:55,620
let's say we for example we reported

863
00:32:55,620 --> 00:32:58,440
this issue to two companies via platform

864
00:32:58,440 --> 00:33:00,720
a we can have one particular report

865
00:33:00,720 --> 00:33:03,299
closed as actually as accepted the

866
00:33:03,299 --> 00:33:04,860
message was escalated to the company it

867
00:33:04,860 --> 00:33:06,779
was remediated so and so forth and for

868
00:33:06,779 --> 00:33:07,980
the other one it could have been those

869
00:33:07,980 --> 00:33:09,840
as informational or not always or even

870
00:33:09,840 --> 00:33:12,059
invariant so that's something to think

871
00:33:12,059 --> 00:33:14,279
about if your end up if you are a

872
00:33:14,279 --> 00:33:16,200
company that uses a existing public

873
00:33:16,200 --> 00:33:18,059
Cloud quality platforms I mean this is

874
00:33:18,059 --> 00:33:20,399
really general advice here it may also

875
00:33:20,399 --> 00:33:22,679
be useful to occasionally look through

876
00:33:22,679 --> 00:33:24,960
all reports that have been periodic

877
00:33:24,960 --> 00:33:27,120
perhaps as false positives or invalid or

878
00:33:27,120 --> 00:33:29,039
information each other by about multiple

879
00:33:29,039 --> 00:33:30,960
platform because when they are triggered

880
00:33:30,960 --> 00:33:33,059
and closed and a platform side they

881
00:33:33,059 --> 00:33:34,200
don't most of them they don't actually

882
00:33:34,200 --> 00:33:35,760
make it to your organization because

883
00:33:35,760 --> 00:33:37,679
they have first class filter so that's

884
00:33:37,679 --> 00:33:39,480
one potential source of information I

885
00:33:39,480 --> 00:33:42,620
mean it is a is one source of potential

886
00:33:42,620 --> 00:33:45,360
force a post-magnative state

887
00:33:45,360 --> 00:33:48,480
so what really happens from here so what

888
00:33:48,480 --> 00:33:49,980
are we really doing I mean at this point

889
00:33:49,980 --> 00:33:51,179
we are still continuing to work with

890
00:33:51,179 --> 00:33:52,620
vendors and service providers there's

891
00:33:52,620 --> 00:33:53,940
still a couple of reports that really

892
00:33:53,940 --> 00:33:55,740
left in pending State we are waiting for

893
00:33:55,740 --> 00:33:57,720
either The annotation or we're waiting

894
00:33:57,720 --> 00:33:58,799
for them to actually complete

895
00:33:58,799 --> 00:34:01,380
remediation uh if you are if you think

896
00:34:01,380 --> 00:34:02,880
about this company space really look

897
00:34:02,880 --> 00:34:06,240
come and look for us because uh for wise

898
00:34:06,240 --> 00:34:07,919
well we are still holding on or whether

899
00:34:07,919 --> 00:34:09,239
we still gain control we are still

900
00:34:09,239 --> 00:34:11,280
heavily control to some of these suffix

901
00:34:11,280 --> 00:34:12,418
domains so that's really important

902
00:34:12,418 --> 00:34:14,219
traffic is important

903
00:34:14,219 --> 00:34:17,639
and ideally really we should be uh or we

904
00:34:17,639 --> 00:34:19,020
should really be transferring ownership

905
00:34:19,020 --> 00:34:20,580
of these domains back to the respective

906
00:34:20,580 --> 00:34:22,859
misconfig ratio openers so keep in mind

907
00:34:22,859 --> 00:34:24,540
that in terms of misconfiguration owners

908
00:34:24,540 --> 00:34:26,639
what we are talking about is that in

909
00:34:26,639 --> 00:34:28,859
some cases the owner or rather what use

910
00:34:28,859 --> 00:34:30,599
what is supported the rightful owner of

911
00:34:30,599 --> 00:34:32,820
the domain the domain suffix is not the

912
00:34:32,820 --> 00:34:34,739
same sometimes it's not the same as the

913
00:34:34,739 --> 00:34:36,719
vulnerable company that was observed

914
00:34:36,719 --> 00:34:38,099
connecting to the domain we have seen

915
00:34:38,099 --> 00:34:39,899
that in some cases because some of these

916
00:34:39,899 --> 00:34:41,520
surfaces were associated as what drives

917
00:34:41,520 --> 00:34:44,280
methods are associated with hotspots so

918
00:34:44,280 --> 00:34:46,020
uh if you think you are one of them

919
00:34:46,020 --> 00:34:48,540
please reach out to us and as an

920
00:34:48,540 --> 00:34:50,699
interesting uh part of researching

921
00:34:50,699 --> 00:34:52,260
filter one one thing that we are

922
00:34:52,260 --> 00:34:53,820
considering is that we are intended on

923
00:34:53,820 --> 00:34:56,219
taking over as the S5 normal domains

924
00:34:56,219 --> 00:34:57,780
that we have seen in our traffic data

925
00:34:57,780 --> 00:35:00,960
set and really let's look at what posts

926
00:35:00,960 --> 00:35:02,339
have still been attempting to

927
00:35:02,339 --> 00:35:04,440
communicate with this Runway domains

928
00:35:04,440 --> 00:35:06,960
historically associated with no acid so

929
00:35:06,960 --> 00:35:08,220
that's one Future Part of research

930
00:35:08,220 --> 00:35:10,140
therapy

931
00:35:10,140 --> 00:35:11,940
uh so with that we reached the end of

932
00:35:11,940 --> 00:35:13,140
our presentation here our contact

933
00:35:13,140 --> 00:35:15,540
details uh there is a written supplement

934
00:35:15,540 --> 00:35:17,099
to this presentation it will be

935
00:35:17,099 --> 00:35:19,020
published on medium shortly after this

936
00:35:19,020 --> 00:35:21,540
presentation uh I got the URL here also

937
00:35:21,540 --> 00:35:24,000
this will also be placed in Discord so

938
00:35:24,000 --> 00:35:25,859
as again if you are one of these

939
00:35:25,859 --> 00:35:28,380
companies who will think have been

940
00:35:28,380 --> 00:35:30,359
affected or if you need a additional

941
00:35:30,359 --> 00:35:32,220
system in really diagnosing the EQ

942
00:35:32,220 --> 00:35:34,200
please feel free to reach out to us uh

943
00:35:34,200 --> 00:35:36,240
yeah and then now I'll open a lot of

944
00:35:36,240 --> 00:35:38,359
questions

