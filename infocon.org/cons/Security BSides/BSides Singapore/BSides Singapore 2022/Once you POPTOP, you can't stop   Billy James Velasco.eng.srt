1
00:00:00,000 --> 00:00:02,760
hey good afternoon hello besides good

2
00:00:02,760 --> 00:00:04,019
afternoon good morning good evening

3
00:00:04,019 --> 00:00:06,120
wherever you are driving in hello beside

4
00:00:06,120 --> 00:00:08,400
Singapore thanks for helping me my name

5
00:00:08,400 --> 00:00:10,200
is Bill James Velasco and today I'll be

6
00:00:10,200 --> 00:00:12,179
presenting once she popped up you can't

7
00:00:12,179 --> 00:00:13,080
stop

8
00:00:13,080 --> 00:00:14,940
so from the title itself the talk will

9
00:00:14,940 --> 00:00:17,340
be about pop top one of the recent

10
00:00:17,340 --> 00:00:18,900
interesting malware families that we

11
00:00:18,900 --> 00:00:22,939
discovered imagine from the past years

12
00:00:25,680 --> 00:00:28,199
so a little bit more about myself I'm

13
00:00:28,199 --> 00:00:29,580
currently a senior principal security

14
00:00:29,580 --> 00:00:33,540
Analyst at management defense and from

15
00:00:33,540 --> 00:00:34,920
the response and thread hunting team

16
00:00:34,920 --> 00:00:37,739
within manager so management defense is

17
00:00:37,739 --> 00:00:39,120
management

18
00:00:39,120 --> 00:00:41,820
um detection response team

19
00:00:41,820 --> 00:00:43,500
so me and my team has responded to the

20
00:00:43,500 --> 00:00:45,239
latest and greatest compromises

21
00:00:45,239 --> 00:00:47,460
perpetrated by Advanced threat actors to

22
00:00:47,460 --> 00:00:49,260
hundreds of our subscribed customers

23
00:00:49,260 --> 00:00:52,020
globally so fun fact about me I'm also a

24
00:00:52,020 --> 00:00:55,440
sneakerhead and a dotted tuner

25
00:00:55,440 --> 00:00:57,239
so we thought we'll start with how the

26
00:00:57,239 --> 00:00:59,160
pop-up model was discovered

27
00:00:59,160 --> 00:01:01,559
and next one the pop pop malware was

28
00:01:01,559 --> 00:01:03,719
first seen in the wild then we'll talk

29
00:01:03,719 --> 00:01:05,339
about the collaborative efforts between

30
00:01:05,339 --> 00:01:07,500
the incident response the malware

31
00:01:07,500 --> 00:01:09,540
analysis team the reverse engineering

32
00:01:09,540 --> 00:01:12,240
team and the detection team and fighting

33
00:01:12,240 --> 00:01:13,680
a common adversary

34
00:01:13,680 --> 00:01:15,360
you will also hear me talk about the

35
00:01:15,360 --> 00:01:17,820
time when the attacker returned and a

36
00:01:17,820 --> 00:01:20,700
pop-up tithing at the government agency

37
00:01:20,700 --> 00:01:22,500
they all started in one faithful day

38
00:01:22,500 --> 00:01:24,840
when I was performing app compat cache

39
00:01:24,840 --> 00:01:27,180
hunting that's one of our subscribe

40
00:01:27,180 --> 00:01:28,860
customers let's call that customer

41
00:01:28,860 --> 00:01:32,119
Beacon Forge one

42
00:01:34,040 --> 00:01:37,740
is a Windows artifact that records the

43
00:01:37,740 --> 00:01:40,500
most recent executed binary so it's a

44
00:01:40,500 --> 00:01:42,299
great way of differentiating which

45
00:01:42,299 --> 00:01:45,119
binary should be executing and shouldn't

46
00:01:45,119 --> 00:01:47,820
be executing in an environment so like

47
00:01:47,820 --> 00:01:50,460
most hunters in manage defense I'm

48
00:01:50,460 --> 00:01:51,780
already familiar with the customer

49
00:01:51,780 --> 00:01:54,060
environment so I easily filter out the

50
00:01:54,060 --> 00:01:56,159
benign leads that I keep seeing

51
00:01:56,159 --> 00:01:58,439
and then this entry stood out

52
00:01:58,439 --> 00:02:01,220
can you see why

53
00:02:01,439 --> 00:02:03,960
so battery is residing in subfolders of

54
00:02:03,960 --> 00:02:05,219
the program directory are typically

55
00:02:05,219 --> 00:02:08,160
benign but we all also don't see a

56
00:02:08,160 --> 00:02:09,479
binary in the root of this directory

57
00:02:09,479 --> 00:02:12,060
often uh in addition the economic

58
00:02:12,060 --> 00:02:14,580
binaries are typically given descriptive

59
00:02:14,580 --> 00:02:18,020
names such as chrome.xc zoom.xc or

60
00:02:18,020 --> 00:02:20,760
teams.xc but this is a single character

61
00:02:20,760 --> 00:02:23,879
binary so that's suspicious

62
00:02:23,879 --> 00:02:26,879
so Arctic XC become our initial e so

63
00:02:26,879 --> 00:02:29,160
looking into the parse fields for the

64
00:02:29,160 --> 00:02:31,500
acrobat cash entry we can see the

65
00:02:31,500 --> 00:02:33,599
hunting filter that identify this entry

66
00:02:33,599 --> 00:02:35,640
is suspicious because it's a single

67
00:02:35,640 --> 00:02:37,739
character binary so one of the things

68
00:02:37,739 --> 00:02:39,720
that initially looked at by reviewing

69
00:02:39,720 --> 00:02:42,900
this data is the md5 hash of the binary

70
00:02:42,900 --> 00:02:44,760
which turns out to be a copy of

71
00:02:44,760 --> 00:02:46,980
legitimulator installed right

72
00:02:46,980 --> 00:02:49,739
application now I took note of the file

73
00:02:49,739 --> 00:02:51,180
file as well

74
00:02:51,180 --> 00:02:53,160
now you can see clearly that this is not

75
00:02:53,160 --> 00:02:56,459
a typical path for a benign installed

76
00:02:56,459 --> 00:02:58,080
application

77
00:02:58,080 --> 00:03:00,560
when we see misplaced binaries like this

78
00:03:00,560 --> 00:03:02,879
it is possible that we are dealing with

79
00:03:02,879 --> 00:03:04,739
the case of the outside loading so in

80
00:03:04,739 --> 00:03:07,379
order to investigate further I acquired

81
00:03:07,379 --> 00:03:09,180
additional forensic data such as file

82
00:03:09,180 --> 00:03:13,019
listing task listing and persistence

83
00:03:13,019 --> 00:03:16,260
so first I analyze the file system using

84
00:03:16,260 --> 00:03:18,540
our initially is the Pivot Point

85
00:03:18,540 --> 00:03:21,959
which is the legitimate command line or

86
00:03:21,959 --> 00:03:23,879
executable

87
00:03:23,879 --> 00:03:25,800
I look at the files created around the

88
00:03:25,800 --> 00:03:28,860
time the r.xc was created

89
00:03:28,860 --> 00:03:31,739
however I only found benign engagement

90
00:03:31,739 --> 00:03:35,040
Google Chrome files there are also

91
00:03:35,040 --> 00:03:37,560
some prefetch files that corresponds to

92
00:03:37,560 --> 00:03:40,260
execution uh commanded xcn system that

93
00:03:40,260 --> 00:03:42,720
actually system info that actually but

94
00:03:42,720 --> 00:03:44,519
those are both legitimate windows

95
00:03:44,519 --> 00:03:46,080
binaries and there's nothing suspicious

96
00:03:46,080 --> 00:03:48,720
about that execution so at this point

97
00:03:48,720 --> 00:03:51,060
before I decided to move along and say

98
00:03:51,060 --> 00:03:53,340
this is the benign hunting lead I also

99
00:03:53,340 --> 00:03:55,379
took a quick peek at some of the other

100
00:03:55,379 --> 00:03:57,959
data that I already pulled from The Host

101
00:03:57,959 --> 00:04:00,780
one of them is persistence data which

102
00:04:00,780 --> 00:04:02,580
presents the persistence mechanisms in

103
00:04:02,580 --> 00:04:05,220
Windows so I reviewed the AutoStart

104
00:04:05,220 --> 00:04:07,340
locations such as the startup folders

105
00:04:07,340 --> 00:04:10,200
register one piece and others but I

106
00:04:10,200 --> 00:04:12,299
didn't found anything suspicious there

107
00:04:12,299 --> 00:04:14,519
next I review the windows services so

108
00:04:14,519 --> 00:04:16,798
this is a favorite persistence mechanism

109
00:04:16,798 --> 00:04:19,798
by both Advanced and commodity reactors

110
00:04:19,798 --> 00:04:22,560
because it survives a reboot however I

111
00:04:22,560 --> 00:04:24,000
also didn't find anything suspicious

112
00:04:24,000 --> 00:04:25,020
there

113
00:04:25,020 --> 00:04:27,419
then I start code when I review the

114
00:04:27,419 --> 00:04:28,800
schedule pass

115
00:04:28,800 --> 00:04:30,840
now let's run through how I analyze the

116
00:04:30,840 --> 00:04:32,699
schedule tasks there are two types of

117
00:04:32,699 --> 00:04:34,800
Windows schedule tasks one is the

118
00:04:34,800 --> 00:04:37,860
executable type and the com Handler so I

119
00:04:37,860 --> 00:04:39,720
filter first with the most common which

120
00:04:39,720 --> 00:04:40,620
is

121
00:04:40,620 --> 00:04:43,020
to the executable type and this type we

122
00:04:43,020 --> 00:04:44,880
can look for a suspicious executable

123
00:04:44,880 --> 00:04:48,180
paths suspicious arguments or suspicious

124
00:04:48,180 --> 00:04:49,560
task names

125
00:04:49,560 --> 00:04:51,300
but in this case I didn't find anything

126
00:04:51,300 --> 00:04:54,660
suspicious all turned out to be benign

127
00:04:54,660 --> 00:04:56,699
then I moved to the the last comment

128
00:04:56,699 --> 00:04:59,460
type which is the com Handler

129
00:04:59,460 --> 00:05:01,680
first let's talk about con Basics so com

130
00:05:01,680 --> 00:05:03,720
which stands for component object model

131
00:05:03,720 --> 00:05:05,759
it's a method for sharing binary codes

132
00:05:05,759 --> 00:05:07,620
across different applications and

133
00:05:07,620 --> 00:05:10,020
languages and here you can see a few

134
00:05:10,020 --> 00:05:12,300
common elements so let's start with com

135
00:05:12,300 --> 00:05:14,820
handlers which are functions or methods

136
00:05:14,820 --> 00:05:16,500
containing program statements that are

137
00:05:16,500 --> 00:05:18,960
executed in response to an event so that

138
00:05:18,960 --> 00:05:20,699
sounds like a scheduled task to me right

139
00:05:20,699 --> 00:05:23,520
and then there's the compass

140
00:05:23,520 --> 00:05:26,220
which is contained in either a dll or an

141
00:05:26,220 --> 00:05:28,860
executable so comp classes are named and

142
00:05:28,860 --> 00:05:31,380
unique identifiers called Compass IDs

143
00:05:31,380 --> 00:05:32,400
right here

144
00:05:32,400 --> 00:05:34,500
and the state that I have here I review

145
00:05:34,500 --> 00:05:37,440
the staff names and Compass IDs

146
00:05:37,440 --> 00:05:40,020
so I found a suspicious schedule task

147
00:05:40,020 --> 00:05:42,120
name as the way updated now why is that

148
00:05:42,120 --> 00:05:43,620
suspicious

149
00:05:43,620 --> 00:05:45,180
it's not common to see Adobe

150
00:05:45,180 --> 00:05:47,759
applications persist as compounded so

151
00:05:47,759 --> 00:05:49,500
rather we observe Adobe applications

152
00:05:49,500 --> 00:05:52,139
persist as speed of service or an

153
00:05:52,139 --> 00:05:54,000
executable scheduled task just like we

154
00:05:54,000 --> 00:05:56,520
saw in the previous slide so then take a

155
00:05:56,520 --> 00:06:00,000
look as well at the compass ID

156
00:06:00,000 --> 00:06:02,220
the compass ID associated with Adobe

157
00:06:02,220 --> 00:06:04,440
Player I did a quick Google search for

158
00:06:04,440 --> 00:06:06,960
that I didn't find anything

159
00:06:06,960 --> 00:06:08,880
however when I did a quick Google search

160
00:06:08,880 --> 00:06:12,479
for all the the compass like this you're

161
00:06:12,479 --> 00:06:13,680
seeing here

162
00:06:13,680 --> 00:06:16,139
the rest of them led to articles

163
00:06:16,139 --> 00:06:17,940
indicating they are legitimate they are

164
00:06:17,940 --> 00:06:19,860
either associated with the legitimate

165
00:06:19,860 --> 00:06:22,380
application or components of the Windows

166
00:06:22,380 --> 00:06:23,759
operating system

167
00:06:23,759 --> 00:06:26,160
so in the later slides I will talk more

168
00:06:26,160 --> 00:06:29,940
about the comp the impress server dll

169
00:06:29,940 --> 00:06:32,280
associated with this task and also

170
00:06:32,280 --> 00:06:33,840
throughout the presentation I refer to

171
00:06:33,840 --> 00:06:37,380
Compass IDs at clsie just for to make it

172
00:06:37,380 --> 00:06:39,300
easier for us

173
00:06:39,300 --> 00:06:41,160
some next I review the schedule past

174
00:06:41,160 --> 00:06:44,039
figures associated with Adobe theater so

175
00:06:44,039 --> 00:06:46,440
by filtering for the Adobe updater the

176
00:06:46,440 --> 00:06:48,180
task name that we identified from

177
00:06:48,180 --> 00:06:48,979
previous

178
00:06:48,979 --> 00:06:51,720
analysis I found out that it will

179
00:06:51,720 --> 00:06:54,539
execute every time there is a user logo

180
00:06:54,539 --> 00:06:56,220
and event

181
00:06:56,220 --> 00:06:59,220
so that's a trigger now the Hut Begins

182
00:06:59,220 --> 00:07:01,620
for the in-process server dll so the

183
00:07:01,620 --> 00:07:03,780
in-process server dll will be loaded by

184
00:07:03,780 --> 00:07:06,240
run dll 32 process every time there's a

185
00:07:06,240 --> 00:07:09,180
user logon that's a trigger for this

186
00:07:09,180 --> 00:07:11,759
schedule tab so by searching the winner

187
00:07:11,759 --> 00:07:15,660
strategy for the Comcast IDs and CLS ID

188
00:07:15,660 --> 00:07:17,460
that we identified

189
00:07:17,460 --> 00:07:20,039
Under The Improv server 32 key

190
00:07:20,039 --> 00:07:22,220
I was able to find the path of the dll

191
00:07:22,220 --> 00:07:26,400
which is VC underscore runtime.dll now

192
00:07:26,400 --> 00:07:27,840
the pad of this deal doesn't look

193
00:07:27,840 --> 00:07:29,639
suspicious at all right it actually

194
00:07:29,639 --> 00:07:31,139
looks like a normally installed

195
00:07:31,139 --> 00:07:33,660
application but keep in mind it was

196
00:07:33,660 --> 00:07:36,900
associated with another node CLS ID

197
00:07:36,900 --> 00:07:38,400
Plus

198
00:07:38,400 --> 00:07:41,099
it also runs a system so this is the

199
00:07:41,099 --> 00:07:42,300
highest privilege in the Windows

200
00:07:42,300 --> 00:07:44,099
operating system

201
00:07:44,099 --> 00:07:46,020
so I proceeded with another round of

202
00:07:46,020 --> 00:07:47,699
file system analysis now we have an

203
00:07:47,699 --> 00:07:49,919
additional need this time we can pivot

204
00:07:49,919 --> 00:07:52,919
our the file name uh that we we see

205
00:07:52,919 --> 00:07:54,960
runtime dll that we uncover it from

206
00:07:54,960 --> 00:07:56,639
registry analysis

207
00:07:56,639 --> 00:07:58,740
and by looking at the files created on

208
00:07:58,740 --> 00:08:00,900
the time this dll was created

209
00:08:00,900 --> 00:08:03,539
I found two other suspicious files and

210
00:08:03,539 --> 00:08:05,699
same directory so at this point we have

211
00:08:05,699 --> 00:08:08,520
enough data to reach out for malware

212
00:08:08,520 --> 00:08:10,380
analysis team for assistance we have a

213
00:08:10,380 --> 00:08:12,120
suspicious binary we see underscore

214
00:08:12,120 --> 00:08:13,560
runtime dll

215
00:08:13,560 --> 00:08:16,319
that processes a schedule pass that's

216
00:08:16,319 --> 00:08:18,599
also associated with any known com class

217
00:08:18,599 --> 00:08:21,000
ID or CLS ID

218
00:08:21,000 --> 00:08:24,479
so later I found out that this vll was

219
00:08:24,479 --> 00:08:26,520
already known to mention so about a

220
00:08:26,520 --> 00:08:28,080
month before the person leave was

221
00:08:28,080 --> 00:08:30,240
discovered it was found while hunting

222
00:08:30,240 --> 00:08:32,279
for files with the same obfuscation

223
00:08:32,279 --> 00:08:34,860
techniques used by the red so my family

224
00:08:34,860 --> 00:08:37,440
so advice so they there's a feature

225
00:08:37,440 --> 00:08:38,159
called

226
00:08:38,159 --> 00:08:39,059
um

227
00:08:39,059 --> 00:08:40,440
um

228
00:08:40,440 --> 00:08:43,140
so from that we were able to find this

229
00:08:43,140 --> 00:08:45,480
file so Red Sox memory family by the way

230
00:08:45,480 --> 00:08:48,540
is a suspective APT malware the initial

231
00:08:48,540 --> 00:08:51,060
triage of this dll states that it will

232
00:08:51,060 --> 00:08:52,380
decrypt and load the file name

233
00:08:52,380 --> 00:08:54,540
resource.t

234
00:08:54,540 --> 00:08:56,580
it was suspected this is filed it's

235
00:08:56,580 --> 00:08:57,720
going to take the majority of the model

236
00:08:57,720 --> 00:09:00,300
logic however it was not recovered

237
00:09:00,300 --> 00:09:03,120
during its initial initial Discovery in

238
00:09:03,120 --> 00:09:05,700
that store any diverse engineering and

239
00:09:05,700 --> 00:09:07,920
malware analysis process so everything

240
00:09:07,920 --> 00:09:09,899
installed from there you just know that

241
00:09:09,899 --> 00:09:13,560
this dll will load that file whoever

242
00:09:13,560 --> 00:09:15,600
that's why it looks familiar right it's

243
00:09:15,600 --> 00:09:17,459
the same file I just recovered from my

244
00:09:17,459 --> 00:09:19,380
investigation

245
00:09:19,380 --> 00:09:22,560
so I immediately pick up the file and

246
00:09:22,560 --> 00:09:24,839
went to our malware analysis team for

247
00:09:24,839 --> 00:09:26,760
them to analyze the file together with

248
00:09:26,760 --> 00:09:28,740
VC underscore runtime dll

249
00:09:28,740 --> 00:09:30,660
and provided them with notes on how I

250
00:09:30,660 --> 00:09:33,060
discovered it I found it to add compact

251
00:09:33,060 --> 00:09:34,500
cache

252
00:09:34,500 --> 00:09:36,000
now I received the results of the

253
00:09:36,000 --> 00:09:37,980
malware analysis request so are you

254
00:09:37,980 --> 00:09:40,019
excited to know how the model works all

255
00:09:40,019 --> 00:09:42,720
right let's dig right to it

256
00:09:42,720 --> 00:09:45,060
so we had BC underscore runtime the dll

257
00:09:45,060 --> 00:09:47,640
the militia level that persists as a

258
00:09:47,640 --> 00:09:50,399
schedule task so it is loader that can

259
00:09:50,399 --> 00:09:53,640
execute as a service or a com object or

260
00:09:53,640 --> 00:09:56,279
a dll so in our case it was executed as

261
00:09:56,279 --> 00:09:57,480
com object

262
00:09:57,480 --> 00:09:59,700
so it will decrypt a file named

263
00:09:59,700 --> 00:10:02,600
resource.dat

264
00:10:02,820 --> 00:10:05,100
and the decrypted pillow which is the

265
00:10:05,100 --> 00:10:07,320
vector component will that will be

266
00:10:07,320 --> 00:10:09,300
manually loaded by VC underscore and

267
00:10:09,300 --> 00:10:10,440
time DOL

268
00:10:10,440 --> 00:10:13,019
into memory so it's also at this point

269
00:10:13,019 --> 00:10:14,760
that I was informed by a thread analysis

270
00:10:14,760 --> 00:10:16,800
team that hey Bill really this is a

271
00:10:16,800 --> 00:10:19,440
numeral family and we will name it as

272
00:10:19,440 --> 00:10:22,019
pop top

273
00:10:22,019 --> 00:10:24,480
so part of the malware analysis request

274
00:10:24,480 --> 00:10:26,279
is to determine any network-based

275
00:10:26,279 --> 00:10:28,620
indicators now this is an important part

276
00:10:28,620 --> 00:10:31,019
of the request because it helps in

277
00:10:31,019 --> 00:10:32,880
creating Network signatures for this

278
00:10:32,880 --> 00:10:34,220
malware

279
00:10:34,220 --> 00:10:36,720
the malware has the capability to make

280
00:10:36,720 --> 00:10:38,279
network connections to the commanding

281
00:10:38,279 --> 00:10:40,940
control domain to Warren moon.com over

282
00:10:40,940 --> 00:10:44,700
tcp480 now take note of this to one this

283
00:10:44,700 --> 00:10:46,560
domain it's important we're going to go

284
00:10:46,560 --> 00:10:48,480
through that in the next slide

285
00:10:48,480 --> 00:10:50,700
it will also make HTTP connections to

286
00:10:50,700 --> 00:10:52,800
command and control IP address

287
00:10:52,800 --> 00:10:55,019
and there is also a sort of connectivity

288
00:10:55,019 --> 00:10:57,660
check that the model performs to verify

289
00:10:57,660 --> 00:10:59,880
if a victim system has internet access

290
00:10:59,880 --> 00:11:02,700
so also take note of the that and white

291
00:11:02,700 --> 00:11:04,980
label domain because that's interesting

292
00:11:04,980 --> 00:11:07,140
as it potentially indicates the targeted

293
00:11:07,140 --> 00:11:09,959
nature of this malware so upon getting

294
00:11:09,959 --> 00:11:11,640
these details the managed defense

295
00:11:11,640 --> 00:11:14,579
responding hunting team my team we

296
00:11:14,579 --> 00:11:16,740
started tasking the pop-up C2 domain and

297
00:11:16,740 --> 00:11:17,760
IP address

298
00:11:17,760 --> 00:11:20,640
so the process of passing allows us to

299
00:11:20,640 --> 00:11:22,860
Monitor and store all Network traffic to

300
00:11:22,860 --> 00:11:25,200
and from a public IP address

301
00:11:25,200 --> 00:11:28,920
that is deployed and we were able to get

302
00:11:28,920 --> 00:11:31,980
all those three caps going into uh or

303
00:11:31,980 --> 00:11:34,680
coming from our Network sensors so upon

304
00:11:34,680 --> 00:11:37,680
tasking we started getting pcaps which

305
00:11:37,680 --> 00:11:40,019
is awesome right because that means the

306
00:11:40,019 --> 00:11:41,839
attacker is still active

307
00:11:41,839 --> 00:11:44,399
so now let's take a look at how the

308
00:11:44,399 --> 00:11:46,980
public network traffic looks like across

309
00:11:46,980 --> 00:11:47,820
the wire

310
00:11:47,820 --> 00:11:50,100
so you can easily pick out the unique

311
00:11:50,100 --> 00:11:52,500
patterns in here such as the initial

312
00:11:52,500 --> 00:11:56,339
portion of the URL the HTTP method and

313
00:11:56,339 --> 00:11:58,560
also a fixed link portion of the URL

314
00:11:58,560 --> 00:12:00,779
that appears to be encoded and encrypted

315
00:12:00,779 --> 00:12:02,720
well at first look it looks like space

316
00:12:02,720 --> 00:12:06,000
64. it actually isn't

317
00:12:06,000 --> 00:12:08,760
so from piece patterns myself and our

318
00:12:08,760 --> 00:12:10,800
detection team was able to immediately

319
00:12:10,800 --> 00:12:13,620
write and push Network signatures that

320
00:12:13,620 --> 00:12:15,899
to detect power of network behavior in

321
00:12:15,899 --> 00:12:17,459
our Network sensors

322
00:12:17,459 --> 00:12:19,680
the same time our detection team also

323
00:12:19,680 --> 00:12:22,140
requested for pop-up detection with our

324
00:12:22,140 --> 00:12:25,440
IPS and EDR vendors so with our

325
00:12:25,440 --> 00:12:27,779
partnership they were able to use the

326
00:12:27,779 --> 00:12:30,120
details of malware analysis and the

327
00:12:30,120 --> 00:12:33,079
pickups that we captured then lastly

328
00:12:33,079 --> 00:12:35,940
we sent the pcaps to our malware

329
00:12:35,940 --> 00:12:37,440
analysis and reverse engineering team

330
00:12:37,440 --> 00:12:40,260
because we are we observed potentially

331
00:12:40,260 --> 00:12:43,440
obfuscated Denver traffic

332
00:12:43,440 --> 00:12:46,139
then we were excited when we received

333
00:12:46,139 --> 00:12:47,880
notice that the matter analysis team was

334
00:12:47,880 --> 00:12:50,339
able to decrease the pcaps because we

335
00:12:50,339 --> 00:12:51,959
were able to find

336
00:12:51,959 --> 00:12:53,940
evidence of Hosting that particular

337
00:12:53,940 --> 00:12:56,040
conscious commands through the pickaxe

338
00:12:56,040 --> 00:12:58,560
and there's also the staging activities

339
00:12:58,560 --> 00:13:00,839
so from this command you can see that

340
00:13:00,839 --> 00:13:02,639
the attacker attempted to use the

341
00:13:02,639 --> 00:13:04,440
command line or our galaxy

342
00:13:04,440 --> 00:13:06,899
to Stage the contents of the windows of

343
00:13:06,899 --> 00:13:09,839
data log into an archive file named

344
00:13:09,839 --> 00:13:12,120
075.cmp

345
00:13:12,120 --> 00:13:15,120
but wait a minute this rxc looks

346
00:13:15,120 --> 00:13:17,940
familiar to you well definitely should

347
00:13:17,940 --> 00:13:21,360
because these are the XC file was our

348
00:13:21,360 --> 00:13:24,839
initially from hunting so at this point

349
00:13:24,839 --> 00:13:26,399
we didn't know where it fits in the

350
00:13:26,399 --> 00:13:28,440
overall picture of the compromise but

351
00:13:28,440 --> 00:13:30,899
now you know the attacker leverages for

352
00:13:30,899 --> 00:13:33,480
staging stolen there

353
00:13:33,480 --> 00:13:35,940
and we found more valuable evidence in

354
00:13:35,940 --> 00:13:37,260
the description

355
00:13:37,260 --> 00:13:39,660
so remember from our first file system

356
00:13:39,660 --> 00:13:41,459
analysis that where we found newly

357
00:13:41,459 --> 00:13:43,800
created prefetch files

358
00:13:43,800 --> 00:13:46,500
they actually correspond commands issued

359
00:13:46,500 --> 00:13:48,360
by the attacker just remember

360
00:13:48,360 --> 00:13:50,639
um prefetch files they are an Evidence

361
00:13:50,639 --> 00:13:52,019
of execution

362
00:13:52,019 --> 00:13:54,180
so correlated with the commands that

363
00:13:54,180 --> 00:13:57,860
attacker run such as system info.xc

364
00:13:57,860 --> 00:14:01,139
ipconfig task list and others

365
00:14:01,139 --> 00:14:03,300
we were able to confirm not only did the

366
00:14:03,300 --> 00:14:05,339
attacker issue this command but also

367
00:14:05,339 --> 00:14:08,100
because they were successfully executed

368
00:14:08,100 --> 00:14:10,079
in a host due to the creation of the

369
00:14:10,079 --> 00:14:12,320
prefetch files

370
00:14:12,320 --> 00:14:14,639
so at this point we completed an

371
00:14:14,639 --> 00:14:16,980
investigation and provided victim org

372
00:14:16,980 --> 00:14:18,720
one with the report containing the

373
00:14:18,720 --> 00:14:20,760
details of our investigation so that

374
00:14:20,760 --> 00:14:22,680
includes a description of the malware

375
00:14:22,680 --> 00:14:24,360
and its capabilities

376
00:14:24,360 --> 00:14:27,300
the indicators that we observed and

377
00:14:27,300 --> 00:14:29,760
because we have fully compromised now we

378
00:14:29,760 --> 00:14:31,620
can tell the customer to

379
00:14:31,620 --> 00:14:34,920
and and the victim org to block the

380
00:14:34,920 --> 00:14:36,600
malicious domain and IP address and to

381
00:14:36,600 --> 00:14:38,240
consider the building the system because

382
00:14:38,240 --> 00:14:41,100
it was compromised by Advanced threat

383
00:14:41,100 --> 00:14:42,120
Act

384
00:14:42,120 --> 00:14:44,279
the report also contains the detailed

385
00:14:44,279 --> 00:14:47,519
findings of our investigations

386
00:14:47,519 --> 00:14:49,860
so fast forward to a couple of months

387
00:14:49,860 --> 00:14:52,620
later the attacker returns the threat

388
00:14:52,620 --> 00:14:54,060
actors behind the pop-up model

389
00:14:54,060 --> 00:14:56,639
compromise the same organization victim

390
00:14:56,639 --> 00:14:58,139
org one again

391
00:14:58,139 --> 00:15:00,420
but they also are more aggressive this

392
00:15:00,420 --> 00:15:03,180
time around so they we have observed

393
00:15:03,180 --> 00:15:04,560
five different hosts that were

394
00:15:04,560 --> 00:15:06,660
effectively popped up so the managed

395
00:15:06,660 --> 00:15:08,820
defense team spawned up a rapid response

396
00:15:08,820 --> 00:15:10,740
engagement so a rapid response

397
00:15:10,740 --> 00:15:12,600
engagement is an incident response

398
00:15:12,600 --> 00:15:14,579
service for our managed defense

399
00:15:14,579 --> 00:15:16,740
customers so the goal of this engagement

400
00:15:16,740 --> 00:15:19,500
is the full scope the compromise and to

401
00:15:19,500 --> 00:15:21,480
answer any questions that organization

402
00:15:21,480 --> 00:15:24,060
may have about the compromise so typical

403
00:15:24,060 --> 00:15:25,860
questions are what was the initial

404
00:15:25,860 --> 00:15:28,800
Vector did we observe lateral movement

405
00:15:28,800 --> 00:15:32,880
and also do we observe data exploitation

406
00:15:32,880 --> 00:15:35,160
so during this investigation

407
00:15:35,160 --> 00:15:37,980
the EDR smart signature is automatically

408
00:15:37,980 --> 00:15:40,440
automatically detected pop-up activity

409
00:15:40,440 --> 00:15:43,500
so this time we don't have to hunt in

410
00:15:43,500 --> 00:15:45,540
order to detect pop top the detection

411
00:15:45,540 --> 00:15:48,180
efforts that we made two months prior is

412
00:15:48,180 --> 00:15:50,820
now beginning is now paid off and also

413
00:15:50,820 --> 00:15:53,699
the IPS that all data traffic so that

414
00:15:53,699 --> 00:15:55,800
means there's no attacker observed

415
00:15:55,800 --> 00:15:57,839
interaction observed which is an

416
00:15:57,839 --> 00:16:01,139
absolute win for the victim port however

417
00:16:01,139 --> 00:16:02,760
the initial Vector is still not

418
00:16:02,760 --> 00:16:05,579
determined so the means to be elusive

419
00:16:05,579 --> 00:16:07,560
and from there on we wrap up the

420
00:16:07,560 --> 00:16:09,420
investigation because it was full scope

421
00:16:09,420 --> 00:16:11,459
and provided the report to the victim

422
00:16:11,459 --> 00:16:13,740
organization

423
00:16:13,740 --> 00:16:16,199
then a few months later I received a tip

424
00:16:16,199 --> 00:16:18,240
from my friends in managed Intel because

425
00:16:18,240 --> 00:16:20,279
it's a different team there was a part

426
00:16:20,279 --> 00:16:22,199
of compromise at the government agency

427
00:16:22,199 --> 00:16:25,560
so let's call them victim org II so a

428
00:16:25,560 --> 00:16:27,660
pop-top EDR alert trigger in this case

429
00:16:27,660 --> 00:16:30,120
so the signature that triggered it was

430
00:16:30,120 --> 00:16:32,160
an output of a detection effort from few

431
00:16:32,160 --> 00:16:34,920
months ago so the alert created a triage

432
00:16:34,920 --> 00:16:37,500
package which contains real-time events

433
00:16:37,500 --> 00:16:40,139
captured by the EDR agents such as file

434
00:16:40,139 --> 00:16:42,899
right events process execution network

435
00:16:42,899 --> 00:16:45,240
connections and other events so there's

436
00:16:45,240 --> 00:16:47,220
a bunch more information to analyze

437
00:16:47,220 --> 00:16:49,620
compared when we first discovered pop-up

438
00:16:49,620 --> 00:16:51,480
where and it's already lying there for

439
00:16:51,480 --> 00:16:53,759
men many months even years

440
00:16:53,759 --> 00:16:55,680
and then there's also one interesting

441
00:16:55,680 --> 00:16:58,199
fact about this case is that the CLS ID

442
00:16:58,199 --> 00:17:00,120
we observed is different from between

443
00:17:00,120 --> 00:17:01,259
organ

444
00:17:01,259 --> 00:17:03,899
now we may ask so why is it relevant so

445
00:17:03,899 --> 00:17:06,059
what if the sales ID is different

446
00:17:06,059 --> 00:17:07,859
let's do a quick comparison of the

447
00:17:07,859 --> 00:17:09,900
registry entries that press pause to the

448
00:17:09,900 --> 00:17:12,419
location now the pop-up binaries so in

449
00:17:12,419 --> 00:17:16,260
each bit in order here is the sales ID

450
00:17:16,260 --> 00:17:18,299
observed and victim org one at the top

451
00:17:18,299 --> 00:17:20,520
so I stole it differently with the CLS

452
00:17:20,520 --> 00:17:23,819
ID observed in big demolition

453
00:17:23,819 --> 00:17:26,400
and then they also have the same full

454
00:17:26,400 --> 00:17:29,640
path same full fat different CLS ID

455
00:17:29,640 --> 00:17:32,160
so it's also important to remember that

456
00:17:32,160 --> 00:17:33,900
all the pipe compromise housing victim

457
00:17:33,900 --> 00:17:36,840
organ have sustained pop-up CLS ID

458
00:17:36,840 --> 00:17:39,240
so these potentially means that you

459
00:17:39,240 --> 00:17:41,400
might be dealing with the new pathway at

460
00:17:41,400 --> 00:17:43,980
victim order 2. and you might also see

461
00:17:43,980 --> 00:17:45,480
attacker perform different activities

462
00:17:45,480 --> 00:17:48,960
added and what we observed so far

463
00:17:48,960 --> 00:17:50,820
another interesting and exciting fact

464
00:17:50,820 --> 00:17:52,980
about this case is now we finally have a

465
00:17:52,980 --> 00:17:55,380
potential lead into the ever elusive

466
00:17:55,380 --> 00:17:57,780
initial infection benefit so one of the

467
00:17:57,780 --> 00:17:59,580
users of the compromise house while

468
00:17:59,580 --> 00:18:02,940
browsing gmail.com performance train

469
00:18:02,940 --> 00:18:05,580
search for the string foreign

470
00:18:05,580 --> 00:18:08,100
so cheaper users would recognize that

471
00:18:08,100 --> 00:18:10,320
this URL means that the user made a

472
00:18:10,320 --> 00:18:12,539
string search for tawaremore within

473
00:18:12,539 --> 00:18:15,240
their emails so now why why is that

474
00:18:15,240 --> 00:18:16,320
interesting

475
00:18:16,320 --> 00:18:19,380
remember from the malware National I'm

476
00:18:19,380 --> 00:18:21,660
not a such a quest where we observed

477
00:18:21,660 --> 00:18:23,580
Network base indicators

478
00:18:23,580 --> 00:18:24,919
triple

479
00:18:24,919 --> 00:18:27,780
w.tawaremore.com is one of the commands

480
00:18:27,780 --> 00:18:29,400
uncontrolled domains of the back third

481
00:18:29,400 --> 00:18:32,220
components so maybe we are dealing with

482
00:18:32,220 --> 00:18:34,080
phishing email on its initial vector and

483
00:18:34,080 --> 00:18:36,059
the string to Warrant can be found in

484
00:18:36,059 --> 00:18:38,760
the email body the email subject or even

485
00:18:38,760 --> 00:18:40,980
in the email attachments so we

486
00:18:40,980 --> 00:18:42,419
definitely need to acquire more evidence

487
00:18:42,419 --> 00:18:44,400
from the host and continue digging

488
00:18:44,400 --> 00:18:46,640
further

489
00:18:47,460 --> 00:18:49,559
now we're excited stop right there when

490
00:18:49,559 --> 00:18:50,940
we heard that the victim organization

491
00:18:50,940 --> 00:18:53,520
decided to play whack mode and the image

492
00:18:53,520 --> 00:18:55,140
the infected house

493
00:18:55,140 --> 00:18:57,480
is this Mario familiar to you

494
00:18:57,480 --> 00:18:59,880
that also marked the end of this

495
00:18:59,880 --> 00:19:01,799
investigation since we have first got

496
00:19:01,799 --> 00:19:03,840
the data we have and we can't get any

497
00:19:03,840 --> 00:19:05,400
more data from the house because the

498
00:19:05,400 --> 00:19:08,580
host has been re-image

499
00:19:08,580 --> 00:19:10,799
now let's talk about what whack-a-mole

500
00:19:10,799 --> 00:19:13,260
and why is a bad reputation technique

501
00:19:13,260 --> 00:19:15,240
so Waxman always focused on each system

502
00:19:15,240 --> 00:19:18,000
in isolation the idea is to immediately

503
00:19:18,000 --> 00:19:20,400
remediate compromise systems such as the

504
00:19:20,400 --> 00:19:22,260
Imaging assist team or powering it down

505
00:19:22,260 --> 00:19:24,660
now those simulation techniques might

506
00:19:24,660 --> 00:19:25,919
work when you're

507
00:19:25,919 --> 00:19:27,720
increasing a company to track such as

508
00:19:27,720 --> 00:19:30,059
computer virus or a worm but we're

509
00:19:30,059 --> 00:19:31,980
facing Advanced and targeted attackers

510
00:19:31,980 --> 00:19:34,080
it can lead to a lot a lot of adverse

511
00:19:34,080 --> 00:19:36,179
consequences

512
00:19:36,179 --> 00:19:37,799
so why it leads to a cycle of

513
00:19:37,799 --> 00:19:39,840
continuously investigating and regening

514
00:19:39,840 --> 00:19:42,120
so you might continuously image it and

515
00:19:42,120 --> 00:19:44,940
then the same product Team trap tips

516
00:19:44,940 --> 00:19:47,580
coming back because you didn't find out

517
00:19:47,580 --> 00:19:50,160
how it got there and what to do about it

518
00:19:50,160 --> 00:19:52,320
it also leads to Friends full sense of

519
00:19:52,320 --> 00:19:54,179
security so you may think that the

520
00:19:54,179 --> 00:19:56,039
Imaging of host makes your problem but

521
00:19:56,039 --> 00:19:58,500
by not horoscoping the compromise you're

522
00:19:58,500 --> 00:20:00,360
unable to determine the attacker moved

523
00:20:00,360 --> 00:20:02,100
laterally from that one whole subject

524
00:20:02,100 --> 00:20:03,000
image

525
00:20:03,000 --> 00:20:04,799
two different hosts in your environment

526
00:20:04,799 --> 00:20:06,900
and they may also switch tactics from

527
00:20:06,900 --> 00:20:09,480
using malware so it just popped up to

528
00:20:09,480 --> 00:20:10,980
these different tools like such as

529
00:20:10,980 --> 00:20:15,299
remote desktop SMB or Powershell

530
00:20:15,299 --> 00:20:17,880
and their responders you you tip your

531
00:20:17,880 --> 00:20:20,100
hand to attack it so someone package may

532
00:20:20,100 --> 00:20:22,260
not care at all to catch them on well

533
00:20:22,260 --> 00:20:24,960
touch them but there are some Advanced

534
00:20:24,960 --> 00:20:26,760
fed actors that will change the tactics

535
00:20:26,760 --> 00:20:29,520
the tool sets the first building moment

536
00:20:29,520 --> 00:20:32,039
that they know that you're on to them

537
00:20:32,039 --> 00:20:34,080
and they may even accelerate their

538
00:20:34,080 --> 00:20:35,880
missions so instead of just chilling and

539
00:20:35,880 --> 00:20:37,799
monitoring your network it will start

540
00:20:37,799 --> 00:20:40,260
explorating and stealing data or even

541
00:20:40,260 --> 00:20:43,200
worse they start destroying data and

542
00:20:43,200 --> 00:20:45,360
then lastly most importantly you may

543
00:20:45,360 --> 00:20:47,940
lose valuable forensic data by your

544
00:20:47,940 --> 00:20:49,620
Imaging or power down compromise house

545
00:20:49,620 --> 00:20:52,020
without full scoping you may lose data

546
00:20:52,020 --> 00:20:53,760
that may lead to determining the initial

547
00:20:53,760 --> 00:20:56,280
Vector how it got there or provide

548
00:20:56,280 --> 00:20:57,900
evidence of collateral movement or

549
00:20:57,900 --> 00:21:00,480
evidence of the exploitation these are

550
00:21:00,480 --> 00:21:02,100
the things that you may want to know to

551
00:21:02,100 --> 00:21:04,260
pull assess the compromise and fully

552
00:21:04,260 --> 00:21:07,260
immediate the threats so if you want to

553
00:21:07,260 --> 00:21:09,240
know more about the pitfalls of lack of

554
00:21:09,240 --> 00:21:11,460
all the migration factors you can take a

555
00:21:11,460 --> 00:21:14,700
look and check out the blog below

556
00:21:14,700 --> 00:21:16,860
so let's go back now to our discussion

557
00:21:16,860 --> 00:21:19,620
malware and talk about attribution and

558
00:21:19,620 --> 00:21:22,260
actual profile so management activity

559
00:21:22,260 --> 00:21:24,900
popped up to um one Triple Tree

560
00:21:24,900 --> 00:21:27,299
if you are the only chat with a few life

561
00:21:27,299 --> 00:21:29,159
popped up and different compromises

562
00:21:29,159 --> 00:21:31,679
across southeast Asia they targeted the

563
00:21:31,679 --> 00:21:33,059
Telecom and government organizations

564
00:21:33,059 --> 00:21:35,220
which is consistent with our

565
00:21:35,220 --> 00:21:37,320
investigations that we can Oregon and

566
00:21:37,320 --> 00:21:38,880
victim order 2.

567
00:21:38,880 --> 00:21:41,100
if you're not familiar with upgroups or

568
00:21:41,100 --> 00:21:43,320
the architect race group these are

569
00:21:43,320 --> 00:21:45,179
clusters of cyber intuition activity

570
00:21:45,179 --> 00:21:47,820
which includes observable artifacts such

571
00:21:47,820 --> 00:21:50,400
as adversary infrastructure tools and

572
00:21:50,400 --> 00:21:52,559
tradecraft that mindset is not here

573
00:21:52,559 --> 00:21:56,159
ready to classify such as an apron as an

574
00:21:56,159 --> 00:22:00,960
apt group such as an ap032 or apt-41 or

575
00:22:00,960 --> 00:22:03,840
a film group such as print 12.

576
00:22:03,840 --> 00:22:06,780
or between 13. you can read more about

577
00:22:06,780 --> 00:22:08,880
how magic facts and categories groups

578
00:22:08,880 --> 00:22:11,039
and the blog

579
00:22:11,039 --> 00:22:13,380
and now let's talk about takeaways which

580
00:22:13,380 --> 00:22:15,360
hopefully you can bring back to

581
00:22:15,360 --> 00:22:17,520
from this top

582
00:22:17,520 --> 00:22:19,620
so first finding pieces related to a

583
00:22:19,620 --> 00:22:21,720
compromise May spawn multiple

584
00:22:21,720 --> 00:22:24,179
compromises or even victim environments

585
00:22:24,179 --> 00:22:26,640
that's GMC we have found answers at

586
00:22:26,640 --> 00:22:28,440
different intrusions even at different

587
00:22:28,440 --> 00:22:30,720
victim environments which gave us a

588
00:22:30,720 --> 00:22:32,640
clear picture about the top of malware

589
00:22:32,640 --> 00:22:35,460
the compromises where it was utilized

590
00:22:35,460 --> 00:22:38,760
and the threat access behind it

591
00:22:38,760 --> 00:22:41,100
rapid detection deployment has

592
00:22:41,100 --> 00:22:42,600
tremendous impact on detection

593
00:22:42,600 --> 00:22:44,820
protection from future threats through

594
00:22:44,820 --> 00:22:46,440
the timely malware analysis work and

595
00:22:46,440 --> 00:22:48,240
deployment of detection measures we

596
00:22:48,240 --> 00:22:51,140
observed that the IPS at victim one

597
00:22:51,140 --> 00:22:53,640
black the part of malware traffic when

598
00:22:53,640 --> 00:22:55,200
the attacker exchange just two months

599
00:22:55,200 --> 00:22:58,020
when it was first discovered and also

600
00:22:58,020 --> 00:23:00,000
the PDR signature at victim or to

601
00:23:00,000 --> 00:23:01,980
automatically detect the pop-up although

602
00:23:01,980 --> 00:23:04,500
they haven't seen it before

603
00:23:04,500 --> 00:23:06,419
last and most importantly the course

604
00:23:06,419 --> 00:23:08,039
coordination within between the

605
00:23:08,039 --> 00:23:09,960
investigation teams is very important in

606
00:23:09,960 --> 00:23:11,880
finding evil and protecting from

607
00:23:11,880 --> 00:23:13,620
Advanced threats as you've seen in this

608
00:23:13,620 --> 00:23:15,720
talk depending against Advanced threats

609
00:23:15,720 --> 00:23:17,640
such as pop-up is always a team effort

610
00:23:17,640 --> 00:23:20,280
to imagine we have an IRT who

611
00:23:20,280 --> 00:23:22,440
investigates the live response data they

612
00:23:22,440 --> 00:23:23,880
have the morale analysis team that

613
00:23:23,880 --> 00:23:25,980
reverses the malware and the Cozy

614
00:23:25,980 --> 00:23:28,020
Network traffic we have the Protection

615
00:23:28,020 --> 00:23:30,600
Team who helps deploy signatures and

616
00:23:30,600 --> 00:23:32,700
coordinate with their Partners like

617
00:23:32,700 --> 00:23:34,679
video and IPS to deploy product

618
00:23:34,679 --> 00:23:36,720
detections and we have a track

619
00:23:36,720 --> 00:23:38,940
attribution team that provides valuable

620
00:23:38,940 --> 00:23:40,860
insights about the attackers and their

621
00:23:40,860 --> 00:23:42,720
gtps or

622
00:23:42,720 --> 00:23:46,320
and the close coordination between

623
00:23:46,320 --> 00:23:48,480
um this teams resulted in fully scoping

624
00:23:48,480 --> 00:23:50,760
nutrition and successfully deploying or

625
00:23:50,760 --> 00:23:53,780
blocking the threat actors

626
00:23:53,820 --> 00:23:55,559
now that's the end of my presentation

627
00:23:55,559 --> 00:23:57,360
thank you everyone for listening and

628
00:23:57,360 --> 00:23:59,220
thank you besides Singapore for having

629
00:23:59,220 --> 00:24:01,260
me I hope you enjoyed this talk and

630
00:24:01,260 --> 00:24:03,360
learn a few things from it the floor is

631
00:24:03,360 --> 00:24:06,199
now open for questions

