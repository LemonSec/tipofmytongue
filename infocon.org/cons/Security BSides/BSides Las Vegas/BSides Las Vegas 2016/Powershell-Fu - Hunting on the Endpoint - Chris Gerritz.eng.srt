1
00:00:01,879 --> 00:00:07,289
<font color="#CCCCCC">alright</font><font color="#E5E5E5"> how's everyone doing today my</font>

2
00:00:06,359 --> 00:00:08,610
<font color="#CCCCCC">name's Chris Garrett's I'm gonna</font><font color="#E5E5E5"> be</font>

3
00:00:07,290 --> 00:00:11,910
<font color="#E5E5E5">talking about hunting on the</font><font color="#CCCCCC"> endpoint</font>

4
00:00:08,610 --> 00:00:13,799
<font color="#E5E5E5">using some</font><font color="#CCCCCC"> built-in PowerShell commands</font>

5
00:00:11,910 --> 00:00:15,599
<font color="#CCCCCC">built a framework I'm actually gonna</font><font color="#E5E5E5"> be</font>

6
00:00:13,799 --> 00:00:18,990
open sourcing this I did<font color="#E5E5E5"> not post it</font><font color="#CCCCCC"> yet</font>

7
00:00:15,599 --> 00:00:21,029
because<font color="#E5E5E5"> pride</font><font color="#CCCCCC"> I've got to clean up some</font>

8
00:00:18,990 --> 00:00:22,759
<font color="#CCCCCC">of the code that looks messy so but</font><font color="#E5E5E5"> that</font>

9
00:00:21,029 --> 00:00:24,810
should be<font color="#E5E5E5"> posted by tonight or</font><font color="#CCCCCC"> tomorrow</font>

10
00:00:22,760 --> 00:00:27,480
<font color="#CCCCCC">so everything</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> see here will be</font>

11
00:00:24,810 --> 00:00:30,689
<font color="#CCCCCC">available and you can go ahead</font><font color="#E5E5E5"> and</font>

12
00:00:27,480 --> 00:00:32,790
download<font color="#CCCCCC"> that see</font><font color="#E5E5E5"> what we're doing</font><font color="#CCCCCC"> my</font>

13
00:00:30,689 --> 00:00:34,290
background<font color="#E5E5E5"> I was</font><font color="#CCCCCC"> in the Air Force</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> 10</font>

14
00:00:32,790 --> 00:00:35,550
years<font color="#CCCCCC"> I did an incident response for the</font>

15
00:00:34,290 --> 00:00:38,160
Air<font color="#CCCCCC"> Force cert for about</font><font color="#E5E5E5"> five of</font><font color="#CCCCCC"> that</font>

16
00:00:35,550 --> 00:00:39,718
<font color="#E5E5E5">those years</font><font color="#CCCCCC"> I helped establish</font><font color="#E5E5E5"> the</font>

17
00:00:38,160 --> 00:00:41,760
enterprise hunt team there

18
00:00:39,719 --> 00:00:43,500
<font color="#E5E5E5">our entire job we had a team</font><font color="#CCCCCC"> that would</font>

19
00:00:41,760 --> 00:00:47,070
<font color="#CCCCCC">go out and</font><font color="#E5E5E5"> look for compromises on our</font>

20
00:00:43,500 --> 00:00:49,170
network<font color="#CCCCCC"> after that</font><font color="#E5E5E5"> ended up founding a</font>

21
00:00:47,070 --> 00:00:51,750
company<font color="#E5E5E5"> called info site to build a</font>

22
00:00:49,170 --> 00:00:54,800
<font color="#E5E5E5">product</font><font color="#CCCCCC"> and a toolset to</font><font color="#E5E5E5"> do hunting on</font>

23
00:00:51,750 --> 00:00:57,870
the<font color="#E5E5E5"> end point so you can follow me here</font>

24
00:00:54,800 --> 00:00:59,280
but one of<font color="#E5E5E5"> the key things here is</font><font color="#CCCCCC"> power</font>

25
00:00:57,870 --> 00:01:03,538
<font color="#CCCCCC">shows</font><font color="#E5E5E5"> was really great and I started</font>

26
00:00:59,280 --> 00:01:05,519
using PowerShell<font color="#E5E5E5"> very early</font><font color="#CCCCCC"> I was a</font>

27
00:01:03,539 --> 00:01:07,290
electrical engineer<font color="#CCCCCC"> in school but</font><font color="#E5E5E5"> I</font>

28
00:01:05,519 --> 00:01:08,900
<font color="#CCCCCC">never</font><font color="#E5E5E5"> actually did professional Cody and</font>

29
00:01:07,290 --> 00:01:11,729
I never did professional<font color="#CCCCCC"> programming</font>

30
00:01:08,900 --> 00:01:13,380
<font color="#CCCCCC">when it came to getting stuff done</font>

31
00:01:11,729 --> 00:01:17,240
PowerShell<font color="#E5E5E5"> was really the way I went</font>

32
00:01:13,380 --> 00:01:19,500
with<font color="#E5E5E5"> it because it enables so much power</font>

33
00:01:17,240 --> 00:01:22,039
especially on<font color="#E5E5E5"> Windows systems which you</font>

34
00:01:19,500 --> 00:01:24,390
know government<font color="#CCCCCC"> all</font><font color="#E5E5E5"> they have</font><font color="#CCCCCC"> is Windows</font>

35
00:01:22,040 --> 00:01:27,420
<font color="#CCCCCC">it enables so much power to do</font>

36
00:01:24,390 --> 00:01:29,280
automation<font color="#E5E5E5"> to deal with data sets to</font>

37
00:01:27,420 --> 00:01:30,390
deal with Excel spreadsheets things like

38
00:01:29,280 --> 00:01:32,070
that so that's kind of where I<font color="#E5E5E5"> got</font>

39
00:01:30,390 --> 00:01:36,119
started with PowerShell was just being

40
00:01:32,070 --> 00:01:39,570
able to<font color="#E5E5E5"> parse things parse spreadsheets</font>

41
00:01:36,119 --> 00:01:40,590
was how I<font color="#E5E5E5"> started</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> led into hunting</font>

42
00:01:39,570 --> 00:01:42,329
where I had to get additional

43
00:01:40,590 --> 00:01:45,000
<font color="#CCCCCC">information from</font><font color="#E5E5E5"> the computer from the</font>

44
00:01:42,329 --> 00:01:46,259
<font color="#CCCCCC">hosts</font><font color="#E5E5E5"> and the tools I had wasn't giving</font>

45
00:01:45,000 --> 00:01:49,020
me<font color="#E5E5E5"> the</font><font color="#CCCCCC"> information so PowerShell</font>

46
00:01:46,259 --> 00:01:51,720
unlocked that and some recent advances

47
00:01:49,020 --> 00:01:53,908
in PowerShell<font color="#E5E5E5"> which I'll show you have</font>

48
00:01:51,720 --> 00:01:58,020
unlocked even more to<font color="#E5E5E5"> make</font><font color="#CCCCCC"> it easier to</font>

49
00:01:53,909 --> 00:02:00,719
do<font color="#E5E5E5"> anything you want off of</font><font color="#CCCCCC"> a system so</font>

50
00:01:58,020 --> 00:02:02,670
<font color="#E5E5E5">i'll talked about hunting what is it</font>

51
00:02:00,719 --> 00:02:04,649
there's a lot<font color="#E5E5E5"> of marketing out there</font>

52
00:02:02,670 --> 00:02:06,540
<font color="#E5E5E5">today</font><font color="#CCCCCC"> i have two years ago when</font><font color="#E5E5E5"> i</font><font color="#CCCCCC"> got</font>

53
00:02:04,649 --> 00:02:09,360
out<font color="#E5E5E5"> of the military and created info</font>

54
00:02:06,540 --> 00:02:11,009
<font color="#CCCCCC">site we got told</font><font color="#E5E5E5"> no one's ever heard of</font>

55
00:02:09,360 --> 00:02:12,510
<font color="#E5E5E5">that</font><font color="#CCCCCC"> thing unless you've been</font><font color="#E5E5E5"> in the</font>

56
00:02:11,008 --> 00:02:12,950
military<font color="#CCCCCC"> now everyone's heard of</font><font color="#E5E5E5"> it and</font>

57
00:02:12,510 --> 00:02:16,819
<font color="#E5E5E5">everyone has</font>

58
00:02:12,950 --> 00:02:18,200
<font color="#CCCCCC">Marketing on</font><font color="#E5E5E5"> it so that's fun so what is</font>

59
00:02:16,819 --> 00:02:19,399
it it's a proactive search for threats

60
00:02:18,200 --> 00:02:21,170
hiding within<font color="#E5E5E5"> a network you control</font>

61
00:02:19,400 --> 00:02:24,019
that's really what it's all<font color="#CCCCCC"> about it's</font>

62
00:02:21,170 --> 00:02:25,970
<font color="#E5E5E5">not it's not a firewall it's not a it's</font>

63
00:02:24,019 --> 00:02:27,440
<font color="#CCCCCC">not using antivirus because</font><font color="#E5E5E5"> what most</font>

64
00:02:25,970 --> 00:02:28,910
tools on your<font color="#E5E5E5"> network are trying to do</font>

65
00:02:27,440 --> 00:02:30,200
is prevent an<font color="#CCCCCC"> attack from getting in you</font>

66
00:02:28,910 --> 00:02:31,130
want to<font color="#E5E5E5"> stop cryptolocker from getting</font>

67
00:02:30,200 --> 00:02:32,268
in you want<font color="#E5E5E5"> to stop an attack from</font>

68
00:02:31,130 --> 00:02:34,569
<font color="#E5E5E5">getting in that's the number one</font>

69
00:02:32,269 --> 00:02:36,440
<font color="#E5E5E5">priority unfortunately that's never 100%</font>

70
00:02:34,569 --> 00:02:37,579
<font color="#CCCCCC">especially when you have insider threats</font>

71
00:02:36,440 --> 00:02:40,010
when you have people<font color="#E5E5E5"> getting in your</font>

72
00:02:37,580 --> 00:02:41,989
network<font color="#E5E5E5"> around your automation</font><font color="#CCCCCC"> how do</font>

73
00:02:40,010 --> 00:02:44,359
you find that<font color="#E5E5E5"> stuff can you go back</font><font color="#CCCCCC"> on</font>

74
00:02:41,989 --> 00:02:45,830
your<font color="#E5E5E5"> logs</font><font color="#CCCCCC"> it was it logged</font><font color="#E5E5E5"> if it's been</font>

75
00:02:44,360 --> 00:02:47,599
there<font color="#CCCCCC"> for six</font><font color="#E5E5E5"> months your logs go back</font>

76
00:02:45,830 --> 00:02:49,489
far enough<font color="#E5E5E5"> you know all these</font><font color="#CCCCCC"> things are</font>

77
00:02:47,599 --> 00:02:51,590
big problems<font color="#CCCCCC"> when it comes to</font><font color="#E5E5E5"> persistent</font>

78
00:02:49,489 --> 00:02:53,150
compromises<font color="#E5E5E5"> and that's</font><font color="#CCCCCC"> really the the</font>

79
00:02:51,590 --> 00:02:55,250
<font color="#CCCCCC">big problem is</font><font color="#E5E5E5"> persisting compromises</font>

80
00:02:53,150 --> 00:02:57,890
most<font color="#E5E5E5"> the tools today are to stop</font>

81
00:02:55,250 --> 00:03:00,560
<font color="#E5E5E5">exploitation to stop installation of</font>

82
00:02:57,890 --> 00:03:02,540
malware<font color="#CCCCCC"> you're on access scans and</font>

83
00:03:00,560 --> 00:03:04,940
<font color="#CCCCCC">things that that look at malware either</font>

84
00:03:02,540 --> 00:03:07,548
in transit<font color="#E5E5E5"> or as</font><font color="#CCCCCC"> it's executing very</font>

85
00:03:04,940 --> 00:03:09,739
little very few tools<font color="#E5E5E5"> and I've</font><font color="#CCCCCC"> evaluated</font>

86
00:03:07,549 --> 00:03:11,450
a lot<font color="#E5E5E5"> very few of them actually look in</font>

87
00:03:09,739 --> 00:03:12,829
memory look in an<font color="#E5E5E5"> operating system</font><font color="#CCCCCC"> and</font>

88
00:03:11,450 --> 00:03:15,018
find out if you<font color="#CCCCCC"> already have a rootkit</font>

89
00:03:12,829 --> 00:03:16,489
installed<font color="#E5E5E5"> there's some</font><font color="#CCCCCC"> open-source tools</font>

90
00:03:15,019 --> 00:03:17,569
out there<font color="#CCCCCC"> but for the most part</font><font color="#E5E5E5"> our</font>

91
00:03:16,489 --> 00:03:20,569
products don't<font color="#E5E5E5"> do that even in the</font>

92
00:03:17,569 --> 00:03:22,100
enterprise<font color="#E5E5E5"> so the big</font><font color="#CCCCCC"> problem is many</font>

93
00:03:20,569 --> 00:03:23,929
are<font color="#E5E5E5"> breached and don't know it you see</font>

94
00:03:22,100 --> 00:03:25,638
the headlines<font color="#CCCCCC"> every day and they're</font>

95
00:03:23,930 --> 00:03:28,310
going<font color="#E5E5E5"> they're being breached for a very</font>

96
00:03:25,639 --> 00:03:29,750
long time<font color="#CCCCCC"> just the the</font><font color="#E5E5E5"> DNC hacks you</font>

97
00:03:28,310 --> 00:03:31,910
know that was a year<font color="#E5E5E5"> the OPM hack</font><font color="#CCCCCC"> that</font>

98
00:03:29,750 --> 00:03:33,799
<font color="#E5E5E5">was a year everybody that every breach</font>

99
00:03:31,910 --> 00:03:34,940
report<font color="#E5E5E5"> that comes out it's usually been</font>

100
00:03:33,799 --> 00:03:36,980
there for a year<font color="#CCCCCC"> and they didn't know it</font>

101
00:03:34,940 --> 00:03:38,840
and I've got<font color="#CCCCCC"> a long list of</font><font color="#E5E5E5"> these</font><font color="#CCCCCC"> things</font>

102
00:03:36,980 --> 00:03:41,720
<font color="#E5E5E5">and how long it took for them to</font>

103
00:03:38,840 --> 00:03:43,670
<font color="#CCCCCC">actually find it how</font><font color="#E5E5E5"> are they finding</font>

104
00:03:41,720 --> 00:03:46,940
<font color="#E5E5E5">them today</font><font color="#CCCCCC"> usually it's</font><font color="#E5E5E5"> it's Brian Krebs</font>

105
00:03:43,670 --> 00:03:49,069
<font color="#CCCCCC">writing</font><font color="#E5E5E5"> an article</font><font color="#CCCCCC"> or the FBI</font>

106
00:03:46,940 --> 00:03:51,680
telling you nine<font color="#E5E5E5"> months later that they</font>

107
00:03:49,069 --> 00:03:53,569
saw some stuff go to Ukraine but that's

108
00:03:51,680 --> 00:03:56,090
legitimate<font color="#CCCCCC"> ly almost all of them</font><font color="#E5E5E5"> are</font>

109
00:03:53,569 --> 00:03:57,980
found that way<font color="#E5E5E5"> so hunting really bridges</font>

110
00:03:56,090 --> 00:04:01,910
that gap<font color="#E5E5E5"> let's</font><font color="#CCCCCC"> go find some some</font>

111
00:03:57,980 --> 00:04:04,099
breaches<font color="#CCCCCC"> this debate</font><font color="#E5E5E5"> comes up a lot is</font>

112
00:04:01,910 --> 00:04:06,380
hunt<font color="#E5E5E5"> and digital</font><font color="#CCCCCC"> forensics</font><font color="#E5E5E5"> is that the</font>

113
00:04:04,099 --> 00:04:07,578
same<font color="#E5E5E5"> thing this sort of they use a lot</font>

114
00:04:06,380 --> 00:04:08,780
<font color="#CCCCCC">of the same techniques but it is</font>

115
00:04:07,579 --> 00:04:11,510
different<font color="#CCCCCC"> because</font><font color="#E5E5E5"> we're gonna be more</font>

116
00:04:08,780 --> 00:04:13,040
scalable<font color="#CCCCCC"> a lot</font><font color="#E5E5E5"> of the products that are</font>

117
00:04:11,510 --> 00:04:14,690
<font color="#CCCCCC">in use today</font><font color="#E5E5E5"> for forensics and</font><font color="#CCCCCC"> intercept</font>

118
00:04:13,040 --> 00:04:17,329
<font color="#E5E5E5">response are not very scalable when it</font>

119
00:04:14,690 --> 00:04:18,260
comes to looking for<font color="#E5E5E5"> a</font><font color="#CCCCCC"> a wide net if you</font>

120
00:04:17,329 --> 00:04:19,099
know what you're looking<font color="#CCCCCC"> for and</font><font color="#E5E5E5"> you</font>

121
00:04:18,260 --> 00:04:22,130
have<font color="#CCCCCC"> a</font><font color="#E5E5E5"> breadcrumb trail</font>

122
00:04:19,099 --> 00:04:24,320
perfect<font color="#CCCCCC"> if you're analyzing</font><font color="#E5E5E5"> one host</font>

123
00:04:22,130 --> 00:04:26,230
<font color="#CCCCCC">there's a lot of tools to do that</font><font color="#E5E5E5"> but</font>

124
00:04:24,320 --> 00:04:28,420
what if you have a thousand

125
00:04:26,230 --> 00:04:30,730
<font color="#E5E5E5">or</font><font color="#CCCCCC"> 10,000</font><font color="#E5E5E5"> how am I gonna do</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> you</font>

126
00:04:28,420 --> 00:04:32,020
need to be very scalable and<font color="#E5E5E5"> you need to</font>

127
00:04:30,730 --> 00:04:33,250
reduce<font color="#CCCCCC"> the</font><font color="#E5E5E5"> complexity otherwise you're</font>

128
00:04:32,020 --> 00:04:36,310
just<font color="#CCCCCC"> not gonna be able to</font><font color="#E5E5E5"> do this very</font>

129
00:04:33,250 --> 00:04:37,360
often<font color="#CCCCCC"> there's another thing when it</font>

130
00:04:36,310 --> 00:04:38,620
comes<font color="#CCCCCC"> to hunting</font><font color="#E5E5E5"> is principle of</font>

131
00:04:37,360 --> 00:04:40,750
<font color="#E5E5E5">diminishing returns a lot of people when</font>

132
00:04:38,620 --> 00:04:42,100
they<font color="#E5E5E5"> get</font><font color="#CCCCCC"> started with hunting</font><font color="#E5E5E5"> is they're</font>

133
00:04:40,750 --> 00:04:46,240
<font color="#CCCCCC">looking</font><font color="#E5E5E5"> for something</font><font color="#CCCCCC"> specific</font><font color="#E5E5E5"> like</font>

134
00:04:42,100 --> 00:04:48,760
<font color="#CCCCCC">let's go look</font><font color="#E5E5E5"> for you know signs of mini</font>

135
00:04:46,240 --> 00:04:51,190
cats being<font color="#E5E5E5"> run and they go look for that</font>

136
00:04:48,760 --> 00:04:52,900
<font color="#E5E5E5">but if you're just looking for one thing</font>

137
00:04:51,190 --> 00:04:54,910
<font color="#E5E5E5">you're gonna have a problem when</font><font color="#CCCCCC"> it</font>

138
00:04:52,900 --> 00:04:57,400
comes<font color="#E5E5E5"> to hey is</font><font color="#CCCCCC"> that thing</font><font color="#E5E5E5"> even there</font>

139
00:04:54,910 --> 00:04:59,440
did they use<font color="#E5E5E5"> that tool or do they use</font><font color="#CCCCCC"> a</font>

140
00:04:57,400 --> 00:05:00,909
different<font color="#CCCCCC"> tool</font><font color="#E5E5E5"> so if you're</font><font color="#CCCCCC"> just looking</font>

141
00:04:59,440 --> 00:05:02,440
for<font color="#E5E5E5"> something</font><font color="#CCCCCC"> that call that focused or</font>

142
00:05:00,910 --> 00:05:04,330
IOC based hunts you're looking for

143
00:05:02,440 --> 00:05:06,610
something<font color="#CCCCCC"> that you</font><font color="#E5E5E5"> know you want</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> look</font>

144
00:05:04,330 --> 00:05:08,260
for it's some kind of hypothesis you

145
00:05:06,610 --> 00:05:10,270
know I'm looking for this<font color="#E5E5E5"> specific</font><font color="#CCCCCC"> type</font>

146
00:05:08,260 --> 00:05:11,680
<font color="#CCCCCC">of malware I don't recommend</font><font color="#E5E5E5"> that</font>

147
00:05:10,270 --> 00:05:14,140
<font color="#E5E5E5">because it's just not</font><font color="#CCCCCC"> scalable</font><font color="#E5E5E5"> and</font>

148
00:05:11,680 --> 00:05:16,650
there's no ROI in it<font color="#E5E5E5"> so the methodology</font>

149
00:05:14,140 --> 00:05:18,690
we're gonna show you<font color="#E5E5E5"> today</font><font color="#CCCCCC"> is basically</font>

150
00:05:16,650 --> 00:05:21,250
collect a lot<font color="#CCCCCC"> of</font><font color="#E5E5E5"> stuff from the endpoint</font>

151
00:05:18,690 --> 00:05:22,990
<font color="#E5E5E5">compare it against you know every state</font>

152
00:05:21,250 --> 00:05:24,520
of<font color="#E5E5E5"> source we</font><font color="#CCCCCC"> have to see if we can</font><font color="#E5E5E5"> find</font>

153
00:05:22,990 --> 00:05:26,950
things<font color="#E5E5E5"> and then filter to the top</font>

154
00:05:24,520 --> 00:05:28,930
through<font color="#E5E5E5"> through anomaly detection</font>

155
00:05:26,950 --> 00:05:32,140
what's interesting<font color="#E5E5E5"> to</font><font color="#CCCCCC"> look</font><font color="#E5E5E5"> at I</font>

156
00:05:28,930 --> 00:05:33,310
guarantee<font color="#E5E5E5"> if you have some reverse</font>

157
00:05:32,140 --> 00:05:34,539
engineering skills or if you have some

158
00:05:33,310 --> 00:05:36,460
malware<font color="#E5E5E5"> analysis skills if you're</font>

159
00:05:34,540 --> 00:05:39,670
looking at malware<font color="#E5E5E5"> it's gonna be pretty</font>

160
00:05:36,460 --> 00:05:41,590
<font color="#E5E5E5">obvious to you the problem is you have</font>

161
00:05:39,670 --> 00:05:43,750
<font color="#CCCCCC">10,000 hosts and there's</font><font color="#E5E5E5"> some hundreds</font>

162
00:05:41,590 --> 00:05:44,530
<font color="#E5E5E5">of thousands of processes</font><font color="#CCCCCC"> and drivers</font>

163
00:05:43,750 --> 00:05:46,150
and<font color="#CCCCCC"> everything running</font><font color="#E5E5E5"> in your</font>

164
00:05:44,530 --> 00:05:49,780
environment<font color="#CCCCCC"> how do you</font><font color="#E5E5E5"> filter that down</font>

165
00:05:46,150 --> 00:05:50,799
to something<font color="#CCCCCC"> manageable so in the</font>

166
00:05:49,780 --> 00:05:52,809
hunters tool bag there's a couple

167
00:05:50,800 --> 00:05:53,950
<font color="#E5E5E5">different</font><font color="#CCCCCC"> ways to do this</font><font color="#E5E5E5"> there's n</font>

168
00:05:52,810 --> 00:05:55,030
<font color="#E5E5E5">point solutions there's</font><font color="#CCCCCC"> data-centric</font>

169
00:05:53,950 --> 00:05:56,170
<font color="#E5E5E5">solutions if you're in a large</font>

170
00:05:55,030 --> 00:05:58,450
enterprise<font color="#E5E5E5"> you're gonna do a data</font>

171
00:05:56,170 --> 00:05:59,800
<font color="#E5E5E5">centric usually almost all of the</font>

172
00:05:58,450 --> 00:06:02,080
<font color="#CCCCCC">information online</font><font color="#E5E5E5"> right now</font><font color="#CCCCCC"> about</font>

173
00:05:59,800 --> 00:06:03,730
hunting is data centric<font color="#E5E5E5"> you've got some</font>

174
00:06:02,080 --> 00:06:05,830
<font color="#E5E5E5">kind of database a Hadoop cluster or</font>

175
00:06:03,730 --> 00:06:10,420
something that has a<font color="#CCCCCC"> massive load of</font>

176
00:06:05,830 --> 00:06:12,039
logs<font color="#CCCCCC"> and event data and packets how am I</font>

177
00:06:10,420 --> 00:06:14,100
gonna hunt in there how am I gonna build

178
00:06:12,040 --> 00:06:16,150
queries<font color="#E5E5E5"> that let me find additional</font>

179
00:06:14,100 --> 00:06:17,530
<font color="#E5E5E5">context in there and find find those</font>

180
00:06:16,150 --> 00:06:19,120
those bad guys<font color="#E5E5E5"> rolling around in my</font>

181
00:06:17,530 --> 00:06:21,340
<font color="#CCCCCC">network you're not going to have that</font>

182
00:06:19,120 --> 00:06:22,450
<font color="#CCCCCC">access to</font><font color="#E5E5E5"> that data and that</font><font color="#CCCCCC"> data is</font><font color="#E5E5E5"> not</font>

183
00:06:21,340 --> 00:06:23,799
<font color="#CCCCCC">going to go back far enough if you're</font>

184
00:06:22,450 --> 00:06:24,940
not if you<font color="#CCCCCC"> don't</font><font color="#E5E5E5"> have a limited</font><font color="#CCCCCC"> budget</font>

185
00:06:23,800 --> 00:06:28,480
<font color="#E5E5E5">which most people</font><font color="#CCCCCC"> don't</font>

186
00:06:24,940 --> 00:06:29,980
<font color="#E5E5E5">so the solution we're gonna show you is</font>

187
00:06:28,480 --> 00:06:31,210
an endpoint solution<font color="#E5E5E5"> scripting we're</font>

188
00:06:29,980 --> 00:06:32,800
gonna be able<font color="#E5E5E5"> to find</font><font color="#CCCCCC"> everything on</font><font color="#E5E5E5"> a</font>

189
00:06:31,210 --> 00:06:33,849
host regardless of what security<font color="#E5E5E5"> stack</font>

190
00:06:32,800 --> 00:06:36,850
is already<font color="#E5E5E5"> there and what you've</font>

191
00:06:33,850 --> 00:06:37,990
<font color="#E5E5E5">collected and then of course malware</font>

192
00:06:36,850 --> 00:06:39,879
analysis tools when you<font color="#E5E5E5"> do find</font>

193
00:06:37,990 --> 00:06:41,720
<font color="#CCCCCC">something suspicious and weird</font>

194
00:06:39,879 --> 00:06:43,310
<font color="#CCCCCC">actually verifying</font><font color="#E5E5E5"> that that's actually</font>

195
00:06:41,720 --> 00:06:43,960
malware<font color="#CCCCCC"> you need to be able to do that</font>

196
00:06:43,310 --> 00:06:46,580
<font color="#E5E5E5">as well</font>

197
00:06:43,960 --> 00:06:49,090
so again that's<font color="#E5E5E5"> choose two different</font>

198
00:06:46,580 --> 00:06:51,109
<font color="#CCCCCC">ways big enterprise event data centric</font>

199
00:06:49,090 --> 00:06:53,508
<font color="#CCCCCC">the rest of us we're</font><font color="#E5E5E5"> gonna do an</font>

200
00:06:51,110 --> 00:06:54,800
<font color="#E5E5E5">endpoint validation strategy validate</font>

201
00:06:53,509 --> 00:06:56,180
what's on these<font color="#CCCCCC"> systems if I don't trust</font>

202
00:06:54,800 --> 00:07:00,979
this computer how do I begin to<font color="#E5E5E5"> trust it</font>

203
00:06:56,180 --> 00:07:03,800
<font color="#CCCCCC">so now further ado I introduce powers PS</font>

204
00:07:00,979 --> 00:07:06,020
Hunt is the<font color="#CCCCCC"> threading module that we're</font>

205
00:07:03,800 --> 00:07:08,860
gonna be<font color="#E5E5E5"> releasing today</font><font color="#CCCCCC"> it is a</font>

206
00:07:06,020 --> 00:07:10,878
PowerShell module that<font color="#E5E5E5"> allows you</font><font color="#CCCCCC"> to</font>

207
00:07:08,860 --> 00:07:12,080
scan systems<font color="#E5E5E5"> it gives you a couple</font>

208
00:07:10,879 --> 00:07:13,430
<font color="#CCCCCC">different options to</font><font color="#E5E5E5"> either look for</font>

209
00:07:12,080 --> 00:07:16,490
information<font color="#CCCCCC"> that you want to look</font><font color="#E5E5E5"> for or</font>

210
00:07:13,430 --> 00:07:17,870
just survey systems for everything<font color="#CCCCCC"> from</font>

211
00:07:16,490 --> 00:07:19,190
<font color="#E5E5E5">what's running what's triggered to run</font>

212
00:07:17,870 --> 00:07:22,009
to any manipulation that<font color="#E5E5E5"> we're looking</font>

213
00:07:19,190 --> 00:07:24,349
<font color="#CCCCCC">for so we'll go through that the</font>

214
00:07:22,009 --> 00:07:26,599
different<font color="#E5E5E5"> components of this</font><font color="#CCCCCC"> there's</font>

215
00:07:24,349 --> 00:07:28,849
about six different<font color="#CCCCCC"> components I break</font>

216
00:07:26,599 --> 00:07:32,240
it<font color="#E5E5E5"> down into scanners and surveys so a</font>

217
00:07:28,849 --> 00:07:33,349
scanner<font color="#E5E5E5"> is a script or a utility where</font>

218
00:07:32,240 --> 00:07:35,389
I'm gonna<font color="#CCCCCC"> be looking for something</font>

219
00:07:33,349 --> 00:07:37,639
<font color="#E5E5E5">remotely</font><font color="#CCCCCC"> I'm gonna be using WMI</font><font color="#E5E5E5"> I'm</font>

220
00:07:35,389 --> 00:07:39,440
<font color="#E5E5E5">going to be using remote registry</font><font color="#CCCCCC"> to say</font>

221
00:07:37,639 --> 00:07:41,180
I want to<font color="#E5E5E5"> find this one registry key</font>

222
00:07:39,440 --> 00:07:42,680
across my entire<font color="#CCCCCC"> environment that's</font>

223
00:07:41,180 --> 00:07:44,780
<font color="#E5E5E5">gonna be very fast and it's gonna be the</font>

224
00:07:42,680 --> 00:07:49,009
threaded so I can look for that one<font color="#E5E5E5"> item</font>

225
00:07:44,780 --> 00:07:50,840
<font color="#E5E5E5">if I know I've got a problem</font><font color="#CCCCCC"> and this</font>

226
00:07:49,009 --> 00:07:53,659
<font color="#CCCCCC">specific malware uses a name pipe you</font>

227
00:07:50,840 --> 00:07:55,698
can enumerate<font color="#CCCCCC"> name pipes and that's for</font>

228
00:07:53,659 --> 00:07:58,449
for clarification that<font color="#E5E5E5"> is when any</font>

229
00:07:55,699 --> 00:08:00,680
<font color="#E5E5E5">malware that does lateral movement with</font>

230
00:07:58,449 --> 00:08:02,389
<font color="#E5E5E5">SMB which is very modern everybody's</font>

231
00:08:00,680 --> 00:08:03,590
doing<font color="#E5E5E5"> it these days if they use a</font>

232
00:08:02,389 --> 00:08:06,529
<font color="#E5E5E5">specific name pipe you can enumerate</font>

233
00:08:03,590 --> 00:08:09,710
that<font color="#E5E5E5"> name pipe remotely using W mine so</font>

234
00:08:06,529 --> 00:08:11,599
that's<font color="#CCCCCC"> a C enter a survey is a script or</font>

235
00:08:09,710 --> 00:08:13,460
a module<font color="#E5E5E5"> or an executable then</font><font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> gonna</font>

236
00:08:11,599 --> 00:08:15,620
drop on<font color="#E5E5E5"> that box and execute and let it</font>

237
00:08:13,460 --> 00:08:17,419
run that's where we're gonna<font color="#E5E5E5"> get more</font>

238
00:08:15,620 --> 00:08:18,800
information<font color="#CCCCCC"> W my and everything else and</font>

239
00:08:17,419 --> 00:08:20,389
<font color="#E5E5E5">and remote registry</font><font color="#CCCCCC"> is not going to give</font>

240
00:08:18,800 --> 00:08:23,810
you the kind<font color="#E5E5E5"> of information</font><font color="#CCCCCC"> we need</font><font color="#E5E5E5"> at</font>

241
00:08:20,389 --> 00:08:25,130
the level we need so survey is something

242
00:08:23,810 --> 00:08:28,490
that<font color="#E5E5E5"> gets dropped on that box and we</font>

243
00:08:25,130 --> 00:08:30,139
have one major one that that<font color="#E5E5E5"> I developed</font>

244
00:08:28,490 --> 00:08:32,659
that lets you get all the<font color="#CCCCCC"> information</font>

245
00:08:30,139 --> 00:08:34,039
<font color="#E5E5E5">you need from that host discovery what</font>

246
00:08:32,659 --> 00:08:36,319
assets<font color="#E5E5E5"> are out there building</font><font color="#CCCCCC"> a target</font>

247
00:08:34,039 --> 00:08:38,958
list<font color="#E5E5E5"> your utilities for</font><font color="#CCCCCC"> transporting</font>

248
00:08:36,320 --> 00:08:40,789
execution<font color="#CCCCCC"> and then how do you analyze</font>

249
00:08:38,958 --> 00:08:42,439
the data<font color="#CCCCCC"> from</font><font color="#E5E5E5"> that survey and then how</font>

250
00:08:40,789 --> 00:08:44,930
do you analyze files that you identify

251
00:08:42,440 --> 00:08:48,529
so all of<font color="#E5E5E5"> these components</font><font color="#CCCCCC"> go into the</font>

252
00:08:44,930 --> 00:08:50,149
the<font color="#CCCCCC"> PS hunt framework scanners again</font>

253
00:08:48,529 --> 00:08:52,250
this is going<font color="#CCCCCC"> to be used to</font><font color="#E5E5E5"> rapidly scan</font>

254
00:08:50,149 --> 00:08:53,180
systems basically<font color="#CCCCCC"> I'm doing</font><font color="#E5E5E5"> W my queries</font>

255
00:08:52,250 --> 00:08:55,420
I'm doing register queries

256
00:08:53,180 --> 00:08:59,209
<font color="#E5E5E5">anyone's looking for</font><font color="#CCCCCC"> that one thing</font>

257
00:08:55,420 --> 00:09:02,510
<font color="#CCCCCC">surveys are again dropped on the</font><font color="#E5E5E5"> host</font>

258
00:08:59,210 --> 00:09:04,220
<font color="#E5E5E5">cause some</font><font color="#CCCCCC"> of the challenges is a how do</font>

259
00:09:02,510 --> 00:09:06,399
I get<font color="#E5E5E5"> it on a lot of hosts</font><font color="#CCCCCC"> we've got the</font>

260
00:09:04,220 --> 00:09:08,899
transport and execution methods<font color="#E5E5E5"> for</font><font color="#CCCCCC"> that</font>

261
00:09:06,399 --> 00:09:10,610
<font color="#CCCCCC">B is how do I get it back</font><font color="#E5E5E5"> how do I get</font>

262
00:09:08,899 --> 00:09:13,040
<font color="#E5E5E5">that information</font><font color="#CCCCCC"> that it just dropped</font><font color="#E5E5E5"> on</font>

263
00:09:10,610 --> 00:09:15,529
disk or wants to<font color="#E5E5E5"> return to me from</font>

264
00:09:13,040 --> 00:09:17,089
memory<font color="#E5E5E5"> so if this is</font><font color="#CCCCCC"> gonna run</font><font color="#E5E5E5"> for a</font>

265
00:09:15,529 --> 00:09:19,700
<font color="#CCCCCC">little while</font><font color="#E5E5E5"> because most of my surveys</font>

266
00:09:17,089 --> 00:09:21,709
do<font color="#E5E5E5"> a couple minutes</font><font color="#CCCCCC"> one way to be</font>

267
00:09:19,700 --> 00:09:23,779
scalable<font color="#CCCCCC"> is you can either go back and</font>

268
00:09:21,709 --> 00:09:26,599
pick it up from<font color="#E5E5E5"> your main box that you</font>

269
00:09:23,779 --> 00:09:29,540
<font color="#CCCCCC">just deployed it from or you can have</font><font color="#E5E5E5"> it</font>

270
00:09:26,600 --> 00:09:32,180
automatically send it up to<font color="#CCCCCC"> a an HTTP</font>

271
00:09:29,540 --> 00:09:34,430
server or an FTP server<font color="#CCCCCC"> so that's how</font>

272
00:09:32,180 --> 00:09:35,930
you do<font color="#CCCCCC"> it's caleb lee i usually host one</font>

273
00:09:34,430 --> 00:09:37,010
on the box that i'm scanning from<font color="#E5E5E5"> so</font>

274
00:09:35,930 --> 00:09:40,130
that<font color="#CCCCCC"> it always returns to</font><font color="#E5E5E5"> a folder that</font>

275
00:09:37,010 --> 00:09:42,470
<font color="#CCCCCC">i have there's another way</font><font color="#E5E5E5"> to do this so</font>

276
00:09:40,130 --> 00:09:44,689
<font color="#E5E5E5">the surveys themselves can</font><font color="#CCCCCC"> be quite</font>

277
00:09:42,470 --> 00:09:46,970
large if<font color="#E5E5E5"> you're packaging other</font>

278
00:09:44,690 --> 00:09:48,589
executables<font color="#E5E5E5"> so are the implementation</font>

279
00:09:46,970 --> 00:09:50,600
<font color="#E5E5E5">here is going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> use some system</font>

280
00:09:48,589 --> 00:09:52,310
<font color="#CCCCCC">Eternals tools</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> i actually use sic</font>

281
00:09:50,600 --> 00:09:54,589
check for instance because<font color="#E5E5E5"> doing</font>

282
00:09:52,310 --> 00:09:58,609
signature checking and<font color="#CCCCCC"> PowerShell is</font>

283
00:09:54,589 --> 00:10:00,589
hard so<font color="#E5E5E5"> I use that</font><font color="#CCCCCC"> that's an extra five</font>

284
00:09:58,610 --> 00:10:02,420
<font color="#CCCCCC">hundred</font><font color="#E5E5E5"> kilobytes</font><font color="#CCCCCC"> so there's two ways to</font>

285
00:10:00,589 --> 00:10:03,560
<font color="#E5E5E5">do that if you have an executable if you</font>

286
00:10:02,420 --> 00:10:05,240
want to get down to kernel level<font color="#E5E5E5"> you're</font>

287
00:10:03,560 --> 00:10:07,969
gonna need an executable<font color="#E5E5E5"> car shell won't</font>

288
00:10:05,240 --> 00:10:10,760
let you<font color="#E5E5E5"> get down to kernel</font><font color="#CCCCCC"> you can do</font><font color="#E5E5E5"> it</font>

289
00:10:07,970 --> 00:10:14,180
two ways<font color="#E5E5E5"> one I use a function called</font>

290
00:10:10,760 --> 00:10:16,819
<font color="#CCCCCC">unload file that's</font><font color="#E5E5E5"> basically says I have</font>

291
00:10:14,180 --> 00:10:18,620
my script<font color="#CCCCCC"> it's very small</font><font color="#E5E5E5"> when I deploy</font>

292
00:10:16,820 --> 00:10:21,080
it out that host<font color="#E5E5E5"> is gonna download from</font>

293
00:10:18,620 --> 00:10:23,690
the internet<font color="#CCCCCC"> an additional module</font><font color="#E5E5E5"> so I</font>

294
00:10:21,080 --> 00:10:27,080
<font color="#E5E5E5">actually download a sig check from</font>

295
00:10:23,690 --> 00:10:29,089
Microsoft<font color="#CCCCCC"> system journals live so they</font>

296
00:10:27,080 --> 00:10:30,580
host it<font color="#E5E5E5"> it downloads to the box and gets</font>

297
00:10:29,089 --> 00:10:33,020
executed<font color="#E5E5E5"> if it's not already on the</font><font color="#CCCCCC"> box</font>

298
00:10:30,580 --> 00:10:34,120
another way is if<font color="#E5E5E5"> you don't have access</font>

299
00:10:33,020 --> 00:10:36,529
<font color="#E5E5E5">to</font><font color="#CCCCCC"> the internet and you don't want to</font>

300
00:10:34,120 --> 00:10:38,690
you<font color="#CCCCCC"> know make</font><font color="#E5E5E5"> 10,000 boxes call out to</font>

301
00:10:36,529 --> 00:10:40,640
the Microsoft<font color="#E5E5E5"> live you can</font><font color="#CCCCCC"> actually</font>

302
00:10:38,690 --> 00:10:43,430
<font color="#E5E5E5">convert that</font><font color="#CCCCCC"> binary and do it at base64</font>

303
00:10:40,640 --> 00:10:45,050
string<font color="#CCCCCC"> put that in your</font><font color="#E5E5E5"> script and now</font>

304
00:10:43,430 --> 00:10:48,709
your script has that executable<font color="#CCCCCC"> to be</font>

305
00:10:45,050 --> 00:10:49,790
dropped on this when it runs<font color="#CCCCCC"> that's some</font>

306
00:10:48,709 --> 00:10:51,199
really<font color="#E5E5E5"> cool ways to do it</font>

307
00:10:49,790 --> 00:10:56,089
packages everything<font color="#E5E5E5"> up into one powerful</font>

308
00:10:51,200 --> 00:10:58,270
script so how we gonna get there i

309
00:10:56,089 --> 00:11:00,950
implemented<font color="#E5E5E5"> five different ways to do</font>

310
00:10:58,270 --> 00:11:03,140
<font color="#E5E5E5">transport</font><font color="#CCCCCC"> an execution transport is</font>

311
00:11:00,950 --> 00:11:06,320
usually done with SMB server message

312
00:11:03,140 --> 00:11:06,620
block<font color="#E5E5E5"> basically just copy file</font><font color="#CCCCCC"> for those</font>

313
00:11:06,320 --> 00:11:09,410
<font color="#CCCCCC">power</font>

314
00:11:06,620 --> 00:11:11,030
folks that know<font color="#E5E5E5"> that</font><font color="#CCCCCC"> W my PowerShell</font>

315
00:11:09,410 --> 00:11:13,160
remoting<font color="#CCCCCC"> scheduled tasks and service</font>

316
00:11:11,030 --> 00:11:17,240
manager<font color="#E5E5E5"> all of those are implemented</font>

317
00:11:13,160 --> 00:11:19,550
into one<font color="#E5E5E5"> wrapper which I'll show</font><font color="#CCCCCC"> in a</font>

318
00:11:17,240 --> 00:11:20,900
second<font color="#E5E5E5"> so all</font><font color="#CCCCCC"> of them are wrapped into</font>

319
00:11:19,550 --> 00:11:22,339
one<font color="#CCCCCC"> powershell script if i want to</font>

320
00:11:20,900 --> 00:11:24,140
<font color="#E5E5E5">deploy a survey it's gonna</font><font color="#CCCCCC"> basically</font>

321
00:11:22,340 --> 00:11:26,000
reach out figure<font color="#E5E5E5"> out which ones are</font>

322
00:11:24,140 --> 00:11:28,370
<font color="#CCCCCC">available on that</font><font color="#E5E5E5"> host if it's a Linux</font>

323
00:11:26,000 --> 00:11:30,620
host<font color="#E5E5E5"> it'll tell you to go away</font><font color="#CCCCCC"> if it's</font>

324
00:11:28,370 --> 00:11:32,750
if it's got W my exposed<font color="#CCCCCC"> then it's gonna</font>

325
00:11:30,620 --> 00:11:34,700
use W mine<font color="#E5E5E5"> if that doesn't work it'll</font>

326
00:11:32,750 --> 00:11:37,670
<font color="#E5E5E5">it'll back down to</font><font color="#CCCCCC"> scheduled tasks</font><font color="#E5E5E5"> so</font>

327
00:11:34,700 --> 00:11:39,050
all those uses different<font color="#E5E5E5"> port um</font><font color="#CCCCCC"> I would</font>

328
00:11:37,670 --> 00:11:40,610
do this all<font color="#CCCCCC"> the PowerShell remoting but</font>

329
00:11:39,050 --> 00:11:44,449
I've almost<font color="#E5E5E5"> never seen a network that</font>

330
00:11:40,610 --> 00:11:45,770
has<font color="#E5E5E5"> it enabled they're very rare so I am</font>

331
00:11:44,450 --> 00:11:47,000
a big advocate<font color="#E5E5E5"> that you enable it</font>

332
00:11:45,770 --> 00:11:50,540
<font color="#E5E5E5">PowerShell remoting should be your</font>

333
00:11:47,000 --> 00:11:52,730
primary<font color="#CCCCCC"> remote admin protocol it</font><font color="#E5E5E5"> is</font>

334
00:11:50,540 --> 00:11:56,650
awesome<font color="#E5E5E5"> it lets you do anything you you</font>

335
00:11:52,730 --> 00:11:56,650
need<font color="#CCCCCC"> to do</font><font color="#E5E5E5"> on a network and managing it</font>

336
00:11:58,360 --> 00:12:02,840
doing<font color="#CCCCCC"> discovering access we have</font><font color="#E5E5E5"> to get</font>

337
00:12:00,890 --> 00:12:04,390
<font color="#CCCCCC">access to the system on</font><font color="#E5E5E5"> these ports so</font>

338
00:12:02,840 --> 00:12:06,980
depending on what<font color="#E5E5E5"> protocol we're using</font>

339
00:12:04,390 --> 00:12:08,330
<font color="#E5E5E5">we need we need these port access so</font>

340
00:12:06,980 --> 00:12:11,240
there's a couple discovery tools in

341
00:12:08,330 --> 00:12:13,660
there that allow you<font color="#E5E5E5"> to automatically do</font>

342
00:12:11,240 --> 00:12:17,000
this<font color="#E5E5E5"> if you go ahead and just hit via</font>

343
00:12:13,660 --> 00:12:18,650
the invokes<font color="#E5E5E5"> remote task which is</font><font color="#CCCCCC"> the</font>

344
00:12:17,000 --> 00:12:19,910
<font color="#CCCCCC">task that</font><font color="#E5E5E5"> does it it will automatically</font>

345
00:12:18,650 --> 00:12:22,400
do all this for<font color="#E5E5E5"> you you</font><font color="#CCCCCC"> don't</font><font color="#E5E5E5"> have to</font>

346
00:12:19,910 --> 00:12:24,170
remember<font color="#E5E5E5"> it</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> it'll look for TCP ports</font>

347
00:12:22,400 --> 00:12:25,699
it'll look for assets out of<font color="#E5E5E5"> it</font><font color="#CCCCCC"> there</font><font color="#E5E5E5"> in</font>

348
00:12:24,170 --> 00:12:27,620
your network to be able<font color="#E5E5E5"> to find it and</font>

349
00:12:25,700 --> 00:12:31,370
determine if it's the right<font color="#E5E5E5"> operating</font>

350
00:12:27,620 --> 00:12:34,190
system things like that the Windows host

351
00:12:31,370 --> 00:12:36,530
survey is pretty complicated<font color="#CCCCCC"> a codon but</font>

352
00:12:34,190 --> 00:12:38,540
each of<font color="#E5E5E5"> the functions is fairly well</font>

353
00:12:36,530 --> 00:12:40,910
<font color="#E5E5E5">defined</font><font color="#CCCCCC"> and it doesn't have a lot of</font>

354
00:12:38,540 --> 00:12:44,410
dependencies<font color="#CCCCCC"> so if you want</font><font color="#E5E5E5"> to go online</font>

355
00:12:40,910 --> 00:12:46,280
<font color="#E5E5E5">use it you need a function that you</font><font color="#CCCCCC"> know</font>

356
00:12:44,410 --> 00:12:47,420
enumerates<font color="#E5E5E5"> all the</font><font color="#CCCCCC"> main pipes</font><font color="#E5E5E5"> I got a</font>

357
00:12:46,280 --> 00:12:50,120
function in there for that<font color="#E5E5E5"> so</font><font color="#CCCCCC"> you can</font>

358
00:12:47,420 --> 00:12:52,040
<font color="#E5E5E5">just take</font><font color="#CCCCCC"> that out of</font><font color="#E5E5E5"> there</font><font color="#CCCCCC"> so we're</font>

359
00:12:50,120 --> 00:12:53,930
gonna do is<font color="#E5E5E5"> get active processes modules</font>

360
00:12:52,040 --> 00:12:56,329
drivers<font color="#E5E5E5"> any floating or injected dll's</font>

361
00:12:53,930 --> 00:12:58,400
in memory we're gonna look for active

362
00:12:56,330 --> 00:12:59,960
connections any auto starts the

363
00:12:58,400 --> 00:13:01,430
implementation I have<font color="#E5E5E5"> for</font><font color="#CCCCCC"> auto starts is</font>

364
00:12:59,960 --> 00:13:03,260
just<font color="#CCCCCC"> Auto runs so it'll download</font>

365
00:13:01,430 --> 00:13:07,219
sysinternals<font color="#E5E5E5"> Auto runs it's not perfect</font>

366
00:13:03,260 --> 00:13:10,069
but it does<font color="#CCCCCC"> the</font><font color="#E5E5E5"> job</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> accounts and key</font>

367
00:13:07,220 --> 00:13:11,420
event logs for execution<font color="#E5E5E5"> so the idea for</font>

368
00:13:10,070 --> 00:13:12,800
<font color="#E5E5E5">the survey is</font><font color="#CCCCCC"> to collect enough</font>

369
00:13:11,420 --> 00:13:16,240
comprehensive information<font color="#CCCCCC"> to give me</font>

370
00:13:12,800 --> 00:13:16,240
what's the state of<font color="#CCCCCC"> this</font><font color="#E5E5E5"> system</font>

371
00:13:17,379 --> 00:13:23,269
just a normally in<font color="#CCCCCC"> PowerShell</font><font color="#E5E5E5"> you can do</font>

372
00:13:20,689 --> 00:13:24,589
a command like<font color="#E5E5E5"> get process and get</font>

373
00:13:23,269 --> 00:13:25,759
process<font color="#CCCCCC"> we'll give you the process list</font>

374
00:13:24,589 --> 00:13:27,019
<font color="#E5E5E5">unfortunately doesn't have all the</font>

375
00:13:25,759 --> 00:13:28,790
<font color="#E5E5E5">information we need for hunting</font><font color="#CCCCCC"> it</font>

376
00:13:27,019 --> 00:13:31,009
doesn't have the hash<font color="#E5E5E5"> it doesn't have</font>

377
00:13:28,790 --> 00:13:32,449
signature information<font color="#E5E5E5"> it doesn't have</font>

378
00:13:31,009 --> 00:13:34,100
the owner of that process so<font color="#CCCCCC"> there's a</font>

379
00:13:32,449 --> 00:13:35,359
bunch<font color="#CCCCCC"> of</font><font color="#E5E5E5"> things that</font><font color="#CCCCCC"> are</font><font color="#E5E5E5"> missing</font><font color="#CCCCCC"> from</font>

380
00:13:34,100 --> 00:13:38,629
the standard utilities that<font color="#E5E5E5"> are in</font>

381
00:13:35,360 --> 00:13:40,639
PowerShell<font color="#CCCCCC"> so I built a wrapper</font><font color="#E5E5E5"> for that</font>

382
00:13:38,629 --> 00:13:42,139
<font color="#E5E5E5">to put all</font><font color="#CCCCCC"> that information in there so</font>

383
00:13:40,639 --> 00:13:44,449
the survey is collecting with them I get

384
00:13:42,139 --> 00:13:47,449
process<font color="#E5E5E5"> list it'll get the process list</font>

385
00:13:44,449 --> 00:13:48,620
from<font color="#CCCCCC"> WMI it'll get it from</font><font color="#E5E5E5"> additional</font>

386
00:13:47,449 --> 00:13:51,019
<font color="#E5E5E5">information such as the loaded modules</font>

387
00:13:48,620 --> 00:13:53,329
<font color="#CCCCCC">it'll get the hashes it'll do signature</font>

388
00:13:51,019 --> 00:13:55,970
checking and validation as well as get

389
00:13:53,329 --> 00:13:57,739
the<font color="#E5E5E5"> owner so everything from processes</font>

390
00:13:55,970 --> 00:14:01,519
modules drivers<font color="#E5E5E5"> auto runs everything is</font>

391
00:13:57,740 --> 00:14:03,529
going<font color="#E5E5E5"> to have a similar layout</font><font color="#CCCCCC"> to it</font><font color="#E5E5E5"> to</font>

392
00:14:01,519 --> 00:14:07,149
where all that<font color="#CCCCCC"> information is available</font>

393
00:14:03,529 --> 00:14:08,899
<font color="#CCCCCC">for me</font><font color="#E5E5E5"> and when you actually see malware</font>

394
00:14:07,149 --> 00:14:10,100
there's going to be a lot<font color="#CCCCCC"> of things</font>

395
00:14:08,899 --> 00:14:12,170
<font color="#E5E5E5">missing and there's</font><font color="#CCCCCC"> going to be</font><font color="#E5E5E5"> a lot</font><font color="#CCCCCC"> of</font>

396
00:14:10,100 --> 00:14:17,089
things weird<font color="#E5E5E5"> and so I'll show you that a</font>

397
00:14:12,170 --> 00:14:19,219
little<font color="#CCCCCC"> bit</font><font color="#E5E5E5"> later here persistence</font>

398
00:14:17,089 --> 00:14:21,410
mechanisms right<font color="#E5E5E5"> now</font><font color="#CCCCCC"> assist internals</font>

399
00:14:19,220 --> 00:14:23,629
autoruns<font color="#CCCCCC"> is going to be what we're using</font>

400
00:14:21,410 --> 00:14:25,100
<font color="#CCCCCC">we'll download that</font><font color="#E5E5E5"> execute it and then</font>

401
00:14:23,629 --> 00:14:28,209
wrap some additional<font color="#CCCCCC"> information in</font>

402
00:14:25,100 --> 00:14:31,279
there as well<font color="#CCCCCC"> so just as an example</font>

403
00:14:28,209 --> 00:14:35,809
<font color="#CCCCCC">here's my totally not malware free</font>

404
00:14:31,279 --> 00:14:37,550
online games dot exe<font color="#E5E5E5"> this is running and</font>

405
00:14:35,809 --> 00:14:38,719
it's gonna run<font color="#E5E5E5"> key so you're gonna be</font>

406
00:14:37,550 --> 00:14:40,729
able<font color="#CCCCCC"> to enumerate all those with Auto</font>

407
00:14:38,720 --> 00:14:43,790
runs<font color="#E5E5E5"> this is the other thing when you</font>

408
00:14:40,730 --> 00:14:46,189
get this information on every file

409
00:14:43,790 --> 00:14:47,990
you're gonna find things missing<font color="#E5E5E5"> most</font>

410
00:14:46,189 --> 00:14:50,269
people who write software for<font color="#CCCCCC"> a living</font>

411
00:14:47,990 --> 00:14:52,009
for<font color="#E5E5E5"> like companies to use forget to put</font>

412
00:14:50,269 --> 00:14:54,639
a publisher name sometimes<font color="#E5E5E5"> they</font><font color="#CCCCCC"> forget</font>

413
00:14:52,009 --> 00:14:57,410
<font color="#E5E5E5">you</font><font color="#CCCCCC"> know to put a version</font><font color="#E5E5E5"> name in there</font>

414
00:14:54,639 --> 00:14:59,720
<font color="#E5E5E5">but malware writers almost never bother</font>

415
00:14:57,410 --> 00:15:00,769
so you a lot of<font color="#E5E5E5"> times you don't</font><font color="#CCCCCC"> see any</font>

416
00:14:59,720 --> 00:15:03,230
<font color="#E5E5E5">of that in there unless they</font><font color="#CCCCCC"> progeny</font>

417
00:15:00,769 --> 00:15:05,540
<font color="#E5E5E5">another executable another thing that I</font>

418
00:15:03,230 --> 00:15:08,870
always find if it's not a<font color="#CCCCCC"> trojan eyes is</font>

419
00:15:05,540 --> 00:15:11,300
the internal name<font color="#E5E5E5"> is never the same as</font>

420
00:15:08,870 --> 00:15:12,439
the actual<font color="#CCCCCC"> file name because when</font>

421
00:15:11,300 --> 00:15:13,910
<font color="#E5E5E5">they're deploying malware that they'll</font>

422
00:15:12,439 --> 00:15:15,589
try<font color="#CCCCCC"> to hide it</font><font color="#E5E5E5"> as</font><font color="#CCCCCC"> a different file name</font>

423
00:15:13,910 --> 00:15:17,120
hide it in with the<font color="#E5E5E5"> system so that</font>

424
00:15:15,589 --> 00:15:19,250
<font color="#E5E5E5">internal name is almost never</font><font color="#CCCCCC"> the same</font>

425
00:15:17,120 --> 00:15:21,050
so those are the types of<font color="#E5E5E5"> things you can</font>

426
00:15:19,250 --> 00:15:24,610
do with that<font color="#CCCCCC"> data set is</font><font color="#E5E5E5"> just look for</font>

427
00:15:21,050 --> 00:15:24,609
that that<font color="#E5E5E5"> kind of pattern</font>

428
00:15:26,320 --> 00:15:31,250
so memory resident malware this<font color="#E5E5E5"> is the</font>

429
00:15:28,610 --> 00:15:33,500
cool part<font color="#E5E5E5"> so Matt</font><font color="#CCCCCC"> Graber if you've ever</font>

430
00:15:31,250 --> 00:15:34,310
used<font color="#E5E5E5"> power sploit</font><font color="#CCCCCC"> or any</font><font color="#E5E5E5"> of those other</font>

431
00:15:33,500 --> 00:15:36,470
<font color="#E5E5E5">tools</font>

432
00:15:34,310 --> 00:15:38,359
he built a module called PS reflect and

433
00:15:36,470 --> 00:15:40,430
it changed my life<font color="#E5E5E5"> with PowerShell</font>

434
00:15:38,360 --> 00:15:43,430
<font color="#E5E5E5">because I no longer have</font><font color="#CCCCCC"> to compile C</font>

435
00:15:40,430 --> 00:15:45,920
code I no longer have<font color="#CCCCCC"> to do and</font><font color="#E5E5E5"> I no</font>

436
00:15:43,430 --> 00:15:48,770
longer have to<font color="#CCCCCC"> use net to get access to</font>

437
00:15:45,920 --> 00:15:50,569
the native<font color="#E5E5E5"> Windows API so just directly</font>

438
00:15:48,770 --> 00:15:53,120
from<font color="#E5E5E5"> PowerShell just by including his PS</font>

439
00:15:50,570 --> 00:15:54,680
reflect module into our survey anywhere

440
00:15:53,120 --> 00:15:57,200
else<font color="#E5E5E5"> I'm using I have direct access to</font>

441
00:15:54,680 --> 00:15:59,270
native win32<font color="#CCCCCC"> api x' i control through</font>

442
00:15:57,200 --> 00:16:00,950
memory<font color="#CCCCCC"> I can look for things</font><font color="#E5E5E5"> so the</font>

443
00:15:59,270 --> 00:16:03,110
<font color="#CCCCCC">implementation I have for this</font><font color="#E5E5E5"> to look</font>

444
00:16:00,950 --> 00:16:05,360
for this is<font color="#E5E5E5"> I'm into a virtual query</font>

445
00:16:03,110 --> 00:16:06,800
walk across<font color="#E5E5E5"> bosses memory and I'm just</font>

446
00:16:05,360 --> 00:16:10,160
looking<font color="#CCCCCC"> for portable executables and in</font>

447
00:16:06,800 --> 00:16:11,779
protected memory spaces<font color="#CCCCCC"> that's a pretty</font>

448
00:16:10,160 --> 00:16:14,870
effective<font color="#CCCCCC"> way</font><font color="#E5E5E5"> to do it there are ways</font>

449
00:16:11,779 --> 00:16:16,279
around<font color="#E5E5E5"> it but that pretty much finds</font><font color="#CCCCCC"> 98%</font>

450
00:16:14,870 --> 00:16:17,870
of the<font color="#E5E5E5"> malware out there that uses</font>

451
00:16:16,279 --> 00:16:20,720
process injection and<font color="#E5E5E5"> almost all malware</font>

452
00:16:17,870 --> 00:16:23,240
does in fact I don't<font color="#E5E5E5"> have any this is</font>

453
00:16:20,720 --> 00:16:25,040
all user mode so I'm a question that

454
00:16:23,240 --> 00:16:26,779
might<font color="#CCCCCC"> come up</font><font color="#E5E5E5"> is what about kernel-mode</font>

455
00:16:25,040 --> 00:16:29,449
rootkits how do you find those well

456
00:16:26,779 --> 00:16:30,830
modern rootkit design<font color="#E5E5E5"> actually</font><font color="#CCCCCC"> doesn't</font>

457
00:16:29,450 --> 00:16:34,600
<font color="#E5E5E5">have all the functionality in the kernel</font>

458
00:16:30,830 --> 00:16:37,490
module so every rootkit that I've seen

459
00:16:34,600 --> 00:16:38,720
from like uroboros to everything they

460
00:16:37,490 --> 00:16:40,600
don't<font color="#E5E5E5"> put all their functionality in it</font>

461
00:16:38,720 --> 00:16:43,730
<font color="#E5E5E5">if they got networking functionality or</font>

462
00:16:40,600 --> 00:16:45,380
parsing or command interpretation<font color="#CCCCCC"> all of</font>

463
00:16:43,730 --> 00:16:47,600
<font color="#E5E5E5">that is in a user mode DLL that</font><font color="#CCCCCC"> the</font>

464
00:16:45,380 --> 00:16:49,610
kernel module injects into<font color="#E5E5E5"> memory</font><font color="#CCCCCC"> so you</font>

465
00:16:47,600 --> 00:16:51,650
<font color="#CCCCCC">can find most kernel-mode rootkits by</font>

466
00:16:49,610 --> 00:16:57,500
just<font color="#E5E5E5"> looking for their injected modules</font>

467
00:16:51,650 --> 00:17:00,079
in memory using<font color="#E5E5E5"> this how do you analyze</font>

468
00:16:57,500 --> 00:17:02,540
<font color="#E5E5E5">this data once you get it so we got a</font>

469
00:17:00,080 --> 00:17:04,670
few<font color="#CCCCCC"> functions I have a list of</font>

470
00:17:02,540 --> 00:17:07,609
reputation<font color="#CCCCCC"> so if I've done a virustotal</font>

471
00:17:04,670 --> 00:17:09,620
<font color="#CCCCCC">lookup I store that</font><font color="#E5E5E5"> data</font><font color="#CCCCCC"> if I've got</font>

472
00:17:07,609 --> 00:17:11,448
I've downloaded the<font color="#E5E5E5"> NIST database</font><font color="#CCCCCC"> I have</font>

473
00:17:09,619 --> 00:17:12,800
<font color="#CCCCCC">a list of hashes from</font><font color="#E5E5E5"> the NIST database</font>

474
00:17:11,449 --> 00:17:15,770
just<font color="#E5E5E5"> to give me a my white list of my</font>

475
00:17:12,800 --> 00:17:17,959
<font color="#E5E5E5">black</font><font color="#CCCCCC"> lists</font><font color="#E5E5E5"> I load that right now into a</font>

476
00:17:15,770 --> 00:17:20,179
global<font color="#CCCCCC"> variable so</font><font color="#E5E5E5"> it's all in memory</font><font color="#CCCCCC"> to</font>

477
00:17:17,959 --> 00:17:22,910
do<font color="#E5E5E5"> lookups against this might be better</font>

478
00:17:20,179 --> 00:17:23,209
to<font color="#E5E5E5"> do with like a like an SQL light or</font>

479
00:17:22,910 --> 00:17:25,459
something

480
00:17:23,209 --> 00:17:27,050
SQLite<font color="#CCCCCC"> but for now I just</font><font color="#E5E5E5"> do it</font><font color="#CCCCCC"> with</font>

481
00:17:25,459 --> 00:17:29,450
pure PowerShell and<font color="#E5E5E5"> loaded</font><font color="#CCCCCC"> to memory</font><font color="#E5E5E5"> so</font>

482
00:17:27,050 --> 00:17:31,159
make sure<font color="#E5E5E5"> you have you know a gig of</font>

483
00:17:29,450 --> 00:17:34,760
extra<font color="#E5E5E5"> memory because I'm storing a</font><font color="#CCCCCC"> lot</font>

484
00:17:31,160 --> 00:17:36,559
<font color="#E5E5E5">of lists in there so the objective is to</font>

485
00:17:34,760 --> 00:17:39,470
compare everything<font color="#E5E5E5"> we find in these</font>

486
00:17:36,559 --> 00:17:40,040
surveys against the white list<font color="#E5E5E5"> and the</font>

487
00:17:39,470 --> 00:17:42,680
black<font color="#E5E5E5"> list</font>

488
00:17:40,040 --> 00:17:44,659
query virustotal<font color="#E5E5E5"> we can put additional</font>

489
00:17:42,680 --> 00:17:46,700
<font color="#E5E5E5">modules in there to query you know</font>

490
00:17:44,660 --> 00:17:47,990
another set of thread until sources<font color="#E5E5E5"> but</font>

491
00:17:46,700 --> 00:17:51,550
for now we<font color="#CCCCCC"> just got</font><font color="#E5E5E5"> virus total in there</font>

492
00:17:47,990 --> 00:17:54,740
<font color="#CCCCCC">and</font><font color="#E5E5E5"> we'll the implementation I have</font>

493
00:17:51,550 --> 00:17:56,300
available<font color="#E5E5E5"> if you only have a free</font><font color="#CCCCCC"> API</font>

494
00:17:54,740 --> 00:17:59,060
key from<font color="#E5E5E5"> virus total you can only do one</font>

495
00:17:56,300 --> 00:18:02,000
lookup every 15 seconds that's<font color="#E5E5E5"> their</font>

496
00:17:59,060 --> 00:18:04,909
throttling so usually when I'm doing it

497
00:18:02,000 --> 00:18:07,820
with<font color="#E5E5E5"> a freaky</font><font color="#CCCCCC"> I'll just run this</font>

498
00:18:04,910 --> 00:18:09,560
overnight<font color="#E5E5E5"> so you can do about at that</font>

499
00:18:07,820 --> 00:18:11,810
rate you<font color="#E5E5E5"> can do about 5,000 hashes</font>

500
00:18:09,560 --> 00:18:15,950
lookups<font color="#E5E5E5"> a day with virus total with</font><font color="#CCCCCC"> the</font>

501
00:18:11,810 --> 00:18:17,840
freaky<font color="#CCCCCC"> and</font><font color="#E5E5E5"> then if you've got a thousand</font>

502
00:18:15,950 --> 00:18:19,010
hosts<font color="#E5E5E5"> you need to group them so that you</font>

503
00:18:17,840 --> 00:18:20,000
<font color="#E5E5E5">can look at all the data at once you</font>

504
00:18:19,010 --> 00:18:20,270
don't<font color="#E5E5E5"> want to look at one house at a</font>

505
00:18:20,000 --> 00:18:22,100
time

506
00:18:20,270 --> 00:18:23,780
I got another function called group host

507
00:18:22,100 --> 00:18:26,750
<font color="#E5E5E5">objects so the host object is what I</font>

508
00:18:23,780 --> 00:18:27,980
call the results of<font color="#E5E5E5"> that survey will</font>

509
00:18:26,750 --> 00:18:30,770
group that together<font color="#CCCCCC"> so we can look at</font>

510
00:18:27,980 --> 00:18:32,510
<font color="#E5E5E5">all the data once just with unique set</font>

511
00:18:30,770 --> 00:18:34,100
if you've got<font color="#CCCCCC"> ten</font><font color="#E5E5E5"> if you've got a</font>

512
00:18:32,510 --> 00:18:36,080
thousand<font color="#CCCCCC"> Windows seven boxes you'll have</font>

513
00:18:34,100 --> 00:18:38,510
the same Internet Explorer on most<font color="#E5E5E5"> of</font>

514
00:18:36,080 --> 00:18:40,370
them so unique in that set and<font color="#CCCCCC"> in</font>

515
00:18:38,510 --> 00:18:44,210
grouping it makes a lot<font color="#CCCCCC"> of sense for</font>

516
00:18:40,370 --> 00:18:44,929
<font color="#CCCCCC">that so let's put it all</font><font color="#E5E5E5"> together</font><font color="#CCCCCC"> how</font>

517
00:18:44,210 --> 00:18:46,910
are<font color="#E5E5E5"> we gonna do this</font>

518
00:18:44,930 --> 00:18:48,590
so when we<font color="#CCCCCC"> actually deploy we're gonna</font>

519
00:18:46,910 --> 00:18:49,880
be sending out our<font color="#E5E5E5"> surveys to the hosts</font>

520
00:18:48,590 --> 00:18:51,679
<font color="#E5E5E5">it's gonna get what's running what's</font>

521
00:18:49,880 --> 00:18:54,830
<font color="#CCCCCC">triggered to run and any indicators</font>

522
00:18:51,680 --> 00:18:57,350
<font color="#CCCCCC">compromise that I'm looking for</font><font color="#E5E5E5"> will</font>

523
00:18:54,830 --> 00:18:59,060
<font color="#E5E5E5">collect that either through going</font><font color="#CCCCCC"> to</font>

524
00:18:57,350 --> 00:19:02,030
grab<font color="#E5E5E5"> it or waiting</font><font color="#CCCCCC"> for it to return to</font>

525
00:18:59,060 --> 00:19:04,010
<font color="#CCCCCC">my FTP</font><font color="#E5E5E5"> server then I'm gonna do some</font>

526
00:19:02,030 --> 00:19:05,480
<font color="#E5E5E5">lookups I'm doing</font><font color="#CCCCCC"> that on the back end</font>

527
00:19:04,010 --> 00:19:07,129
the<font color="#E5E5E5"> system</font><font color="#CCCCCC"> kernels tools actually do</font>

528
00:19:05,480 --> 00:19:08,750
lookups<font color="#E5E5E5"> themselves I have</font><font color="#CCCCCC"> that disabled</font>

529
00:19:07,130 --> 00:19:11,930
because<font color="#CCCCCC"> I don't want every box doing</font>

530
00:19:08,750 --> 00:19:14,720
<font color="#E5E5E5">that so I activate all the data unique</font>

531
00:19:11,930 --> 00:19:18,070
it and then I'll do my<font color="#E5E5E5"> our sort of</font>

532
00:19:14,720 --> 00:19:20,240
lookups<font color="#E5E5E5"> and my hash reputation lookups</font>

533
00:19:18,070 --> 00:19:23,120
after that you get<font color="#E5E5E5"> a certain number of</font>

534
00:19:20,240 --> 00:19:24,500
suspicious<font color="#E5E5E5"> executables unknowns</font><font color="#CCCCCC"> no</font><font color="#E5E5E5"> one's</font>

535
00:19:23,120 --> 00:19:25,939
<font color="#E5E5E5">ever seen this before</font><font color="#CCCCCC"> you're gonna get a</font>

536
00:19:24,500 --> 00:19:28,310
set of<font color="#E5E5E5"> those those are</font><font color="#CCCCCC"> the what you</font>

537
00:19:25,940 --> 00:19:30,170
actually triage you look for anomalies

538
00:19:28,310 --> 00:19:32,000
<font color="#E5E5E5">and unknowns you do some data stacking</font>

539
00:19:30,170 --> 00:19:34,640
to be<font color="#CCCCCC"> able</font><font color="#E5E5E5"> to find out hey</font><font color="#CCCCCC"> this is an</font>

540
00:19:32,000 --> 00:19:35,810
interesting<font color="#E5E5E5"> guy</font><font color="#CCCCCC"> let's pull a sample of</font>

541
00:19:34,640 --> 00:19:37,790
<font color="#E5E5E5">that file back from where those hosts</font>

542
00:19:35,810 --> 00:19:40,520
and let's submit<font color="#E5E5E5"> that to</font><font color="#CCCCCC"> virustotal</font>

543
00:19:37,790 --> 00:19:42,920
let's<font color="#E5E5E5"> submit that into</font><font color="#CCCCCC"> of pop it into</font><font color="#E5E5E5"> PD</font>

544
00:19:40,520 --> 00:19:44,480
<font color="#CCCCCC">studio so</font><font color="#E5E5E5"> some of</font><font color="#CCCCCC"> these open</font><font color="#E5E5E5"> source</font>

545
00:19:42,920 --> 00:19:46,190
tools that allow you to<font color="#E5E5E5"> do that</font>

546
00:19:44,480 --> 00:19:48,770
<font color="#CCCCCC">PowerShell Arsenal has some cool re</font>

547
00:19:46,190 --> 00:19:50,240
tools<font color="#E5E5E5"> that you can use and then of</font>

548
00:19:48,770 --> 00:19:51,110
course dynamic analysis if you want to

549
00:19:50,240 --> 00:19:53,480
pop it in the sandbox

550
00:19:51,110 --> 00:19:54,399
so malware<font color="#CCCCCC"> comes free you can do cuckoo</font>

551
00:19:53,480 --> 00:19:57,860
that's<font color="#E5E5E5"> for</font>

552
00:19:54,400 --> 00:20:01,190
that's not part of<font color="#E5E5E5"> the PS hunt module</font>

553
00:19:57,860 --> 00:20:05,629
yet<font color="#E5E5E5"> that's kind of manual right now but</font>

554
00:20:01,190 --> 00:20:09,110
it will<font color="#E5E5E5"> be implemented later so how do</font>

555
00:20:05,630 --> 00:20:11,530
we find bad things<font color="#CCCCCC"> misspellings and lack</font>

556
00:20:09,110 --> 00:20:13,850
of<font color="#E5E5E5"> spaces</font>

557
00:20:11,530 --> 00:20:14,930
<font color="#E5E5E5">all right active processes modules</font>

558
00:20:13,850 --> 00:20:16,219
drivers all these things are going<font color="#CCCCCC"> to be</font>

559
00:20:14,930 --> 00:20:18,440
<font color="#E5E5E5">normalized in the same data set so we</font>

560
00:20:16,220 --> 00:20:20,540
can stack them we can look at them<font color="#E5E5E5"> so a</font>

561
00:20:18,440 --> 00:20:21,920
lot of malware today if it's advanced

562
00:20:20,540 --> 00:20:24,320
<font color="#CCCCCC">it's not going to try to</font><font color="#E5E5E5"> hide from you</font>

563
00:20:21,920 --> 00:20:25,520
<font color="#E5E5E5">so there are things that will hide</font><font color="#CCCCCC"> root</font>

564
00:20:24,320 --> 00:20:27,830
<font color="#CCCCCC">kits that'll hide user mode you kids</font>

565
00:20:25,520 --> 00:20:31,070
<font color="#E5E5E5">root kits that are hide a lot of malware</font>

566
00:20:27,830 --> 00:20:32,510
today hides in plain sight so<font color="#CCCCCC"> you know</font>

567
00:20:31,070 --> 00:20:35,480
you can still enumerate it using these

568
00:20:32,510 --> 00:20:36,470
these these API calls<font color="#CCCCCC"> the initial</font>

569
00:20:35,480 --> 00:20:39,050
technique<font color="#E5E5E5"> of course is to hash</font>

570
00:20:36,470 --> 00:20:40,550
everything compare it look for digital

571
00:20:39,050 --> 00:20:42,559
<font color="#E5E5E5">signatures make sure it's the correct</font>

572
00:20:40,550 --> 00:20:45,169
<font color="#E5E5E5">digital signature and a good CA a</font>

573
00:20:42,559 --> 00:20:46,460
certificate authority<font color="#CCCCCC"> and then</font><font color="#E5E5E5"> compare</font>

574
00:20:45,170 --> 00:20:47,720
that<font color="#E5E5E5"> against buyers total and</font><font color="#CCCCCC"> that'll</font>

575
00:20:46,460 --> 00:20:50,750
clear<font color="#E5E5E5"> out all our good knowns and known</font>

576
00:20:47,720 --> 00:20:52,190
<font color="#CCCCCC">goes known Bad's</font><font color="#E5E5E5"> from the unknowns stack</font>

577
00:20:50,750 --> 00:20:53,750
the remaining<font color="#E5E5E5"> data and do nominally an</font>

578
00:20:52,190 --> 00:20:54,770
outlier analysis look for things<font color="#CCCCCC"> that</font>

579
00:20:53,750 --> 00:20:56,210
<font color="#CCCCCC">are weird look for things that</font><font color="#E5E5E5"> are</font><font color="#CCCCCC"> out</font>

580
00:20:54,770 --> 00:20:57,710
<font color="#E5E5E5">of place look</font><font color="#CCCCCC"> for a do frequency</font>

581
00:20:56,210 --> 00:20:59,480
analysis and say I've got<font color="#CCCCCC"> a thousand</font>

582
00:20:57,710 --> 00:21:01,429
boxes<font color="#E5E5E5"> that have that version of</font>

583
00:20:59,480 --> 00:21:03,440
<font color="#E5E5E5">explorer.exe but you've got you know</font>

584
00:21:01,429 --> 00:21:05,330
this other one running<font color="#E5E5E5"> on this one box</font>

585
00:21:03,440 --> 00:21:07,700
<font color="#E5E5E5">and that's</font><font color="#CCCCCC"> interesting because</font><font color="#E5E5E5"> it</font>

586
00:21:05,330 --> 00:21:09,590
doesn't<font color="#CCCCCC"> look like a Microsoft</font><font color="#E5E5E5"> file so</font>

587
00:21:07,700 --> 00:21:11,120
anomaly analysis and outlier analysis

588
00:21:09,590 --> 00:21:12,260
using that data set and PowerShell is

589
00:21:11,120 --> 00:21:14,149
awesome<font color="#E5E5E5"> for that</font><font color="#CCCCCC"> because you</font><font color="#E5E5E5"> can filter</font>

590
00:21:12,260 --> 00:21:16,690
things you can<font color="#E5E5E5"> structure</font><font color="#CCCCCC"> it in different</font>

591
00:21:14,150 --> 00:21:19,400
ways it's awesome<font color="#CCCCCC"> and then of course</font>

592
00:21:16,690 --> 00:21:21,470
when<font color="#CCCCCC"> that when you've</font><font color="#E5E5E5"> filtered that list</font>

593
00:21:19,400 --> 00:21:23,780
down to<font color="#CCCCCC"> something manageable start</font>

594
00:21:21,470 --> 00:21:27,260
analyzing<font color="#E5E5E5"> those files and do it with</font>

595
00:21:23,780 --> 00:21:29,210
static<font color="#E5E5E5"> and dynamic analysis digital</font>

596
00:21:27,260 --> 00:21:31,129
signatures most malware<font color="#E5E5E5"> is not digitally</font>

597
00:21:29,210 --> 00:21:33,860
signed especially when they're<font color="#E5E5E5"> popping</font>

598
00:21:31,130 --> 00:21:35,720
different<font color="#CCCCCC"> dll's</font><font color="#E5E5E5"> around</font><font color="#CCCCCC"> and the ones</font><font color="#E5E5E5"> that</font>

599
00:21:33,860 --> 00:21:37,459
are<font color="#E5E5E5"> oftentimes</font><font color="#CCCCCC"> they load a rogue</font>

600
00:21:35,720 --> 00:21:40,460
<font color="#E5E5E5">certificate authority into your Windows</font>

601
00:21:37,460 --> 00:21:42,410
host so one of<font color="#E5E5E5"> the things that the</font>

602
00:21:40,460 --> 00:21:43,490
survey does is<font color="#E5E5E5"> collect all of the</font>

603
00:21:42,410 --> 00:21:44,840
certificate authorities<font color="#E5E5E5"> that are loaded</font>

604
00:21:43,490 --> 00:21:47,780
<font color="#E5E5E5">in the trusted host store on every</font>

605
00:21:44,840 --> 00:21:49,010
<font color="#E5E5E5">computer and then</font><font color="#CCCCCC"> will be able to check</font>

606
00:21:47,780 --> 00:21:51,200
<font color="#CCCCCC">that they all have serial numbers</font>

607
00:21:49,010 --> 00:21:53,090
<font color="#CCCCCC">they're all searchable</font><font color="#E5E5E5"> online and you</font>

608
00:21:51,200 --> 00:21:55,460
can tell you know whose certificate

609
00:21:53,090 --> 00:21:57,020
authority is this<font color="#CCCCCC"> I used to think</font><font color="#E5E5E5"> that</font>

610
00:21:55,460 --> 00:21:58,640
<font color="#E5E5E5">there was a good set of certificate</font>

611
00:21:57,020 --> 00:22:00,440
authorities there isn't there's no

612
00:21:58,640 --> 00:22:01,760
<font color="#E5E5E5">online like whitelist of certificate</font>

613
00:22:00,440 --> 00:22:05,300
authorities<font color="#CCCCCC"> or it's good other</font><font color="#E5E5E5"> than</font>

614
00:22:01,760 --> 00:22:07,670
<font color="#E5E5E5">Microsoft set</font><font color="#CCCCCC"> and most of the experience</font>

615
00:22:05,300 --> 00:22:08,990
I have is a lot of people stand up

616
00:22:07,670 --> 00:22:10,010
certificate<font color="#E5E5E5"> authorities especially in an</font>

617
00:22:08,990 --> 00:22:12,530
enterprise they actually have<font color="#E5E5E5"> their own</font>

618
00:22:10,010 --> 00:22:14,480
<font color="#E5E5E5">and they're not even like it fails every</font>

619
00:22:12,530 --> 00:22:18,080
check you do because they've implemented

620
00:22:14,480 --> 00:22:21,800
it wrong<font color="#CCCCCC"> so just be aware of</font><font color="#E5E5E5"> that but</font>

621
00:22:18,080 --> 00:22:23,689
<font color="#CCCCCC">oftentimes you can</font><font color="#E5E5E5"> find</font><font color="#CCCCCC"> rogue</font><font color="#E5E5E5"> CAS</font><font color="#CCCCCC"> that</font>

622
00:22:21,800 --> 00:22:25,669
<font color="#CCCCCC">someone just stood up</font><font color="#E5E5E5"> sign their malware</font>

623
00:22:23,690 --> 00:22:28,310
so if you're not<font color="#E5E5E5"> doing your signature</font>

624
00:22:25,670 --> 00:22:31,730
<font color="#CCCCCC">check incorrectly</font><font color="#E5E5E5"> it'll come up</font><font color="#CCCCCC"> assigned</font>

625
00:22:28,310 --> 00:22:34,100
on<font color="#E5E5E5"> that host and of course</font><font color="#CCCCCC"> someone</font>

626
00:22:31,730 --> 00:22:35,660
compromises a legitimate CA<font color="#E5E5E5"> you're</font>

627
00:22:34,100 --> 00:22:37,580
screwed<font color="#CCCCCC"> with</font><font color="#E5E5E5"> this technique so it's not</font>

628
00:22:35,660 --> 00:22:41,840
<font color="#E5E5E5">gonna work and that's</font><font color="#CCCCCC"> what happened</font><font color="#E5E5E5"> with</font>

629
00:22:37,580 --> 00:22:44,240
like<font color="#CCCCCC"> bit 9</font><font color="#E5E5E5"> CA in 2013</font><font color="#CCCCCC"> person's</font>

630
00:22:41,840 --> 00:22:46,780
mechanisms<font color="#CCCCCC"> trolling through scheduled</font>

631
00:22:44,240 --> 00:22:49,370
tasks jobs<font color="#CCCCCC"> person registry persistence</font>

632
00:22:46,780 --> 00:22:52,970
looking for anything<font color="#E5E5E5"> referencing and</font>

633
00:22:49,370 --> 00:22:54,139
executable<font color="#E5E5E5"> or a script so once we have</font>

634
00:22:52,970 --> 00:22:55,490
that<font color="#E5E5E5"> reference we're gonna collect the</font>

635
00:22:54,140 --> 00:22:57,140
same data<font color="#E5E5E5"> that we would normally collect</font>

636
00:22:55,490 --> 00:22:59,600
<font color="#E5E5E5">on our processes so all those things I</font>

637
00:22:57,140 --> 00:23:01,430
told<font color="#E5E5E5"> you about on the get process list</font>

638
00:22:59,600 --> 00:23:03,709
<font color="#CCCCCC">I'm doing that</font><font color="#E5E5E5"> with anything referenced</font>

639
00:23:01,430 --> 00:23:06,260
in the registry as well<font color="#E5E5E5"> especially</font><font color="#CCCCCC"> if</font>

640
00:23:03,710 --> 00:23:08,150
it's<font color="#E5E5E5"> referenced in it's on disk boot</font>

641
00:23:06,260 --> 00:23:10,940
process redirection<font color="#E5E5E5"> I don't have this</font>

642
00:23:08,150 --> 00:23:13,970
done yet this is a it's messy<font color="#E5E5E5"> so I don't</font>

643
00:23:10,940 --> 00:23:17,840
<font color="#E5E5E5">have it</font><font color="#CCCCCC"> in there yet</font><font color="#E5E5E5"> but one way you can</font>

644
00:23:13,970 --> 00:23:19,220
<font color="#E5E5E5">do that there's a module called power</font>

645
00:23:17,840 --> 00:23:21,649
forensics<font color="#E5E5E5"> that you should</font><font color="#CCCCCC"> download it</font>

646
00:23:19,220 --> 00:23:23,900
has the<font color="#CCCCCC"> ability to get a lot</font><font color="#E5E5E5"> of</font>

647
00:23:21,650 --> 00:23:27,470
<font color="#E5E5E5">low-level things one</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> those is you can</font>

648
00:23:23,900 --> 00:23:29,390
grab the<font color="#CCCCCC"> NBR and if it's redirecting</font><font color="#E5E5E5"> to</font>

649
00:23:27,470 --> 00:23:31,720
a different<font color="#E5E5E5"> bootloader you can find boot</font>

650
00:23:29,390 --> 00:23:31,720
kits as well

651
00:23:32,410 --> 00:23:35,930
memory injection<font color="#E5E5E5"> the way that it's</font>

652
00:23:34,640 --> 00:23:37,520
<font color="#CCCCCC">always done every type of memory</font>

653
00:23:35,930 --> 00:23:39,620
injection out there whether it's<font color="#E5E5E5"> dll</font>

654
00:23:37,520 --> 00:23:41,180
reflective DLL injection<font color="#E5E5E5"> or process</font>

655
00:23:39,620 --> 00:23:42,620
Halloween they all have one thing in

656
00:23:41,180 --> 00:23:43,940
common<font color="#E5E5E5"> and that's unprotected memory</font>

657
00:23:42,620 --> 00:23:46,729
regions that<font color="#E5E5E5"> are continuous they're</font>

658
00:23:43,940 --> 00:23:48,530
always in one stack<font color="#CCCCCC"> you can't do</font>

659
00:23:46,730 --> 00:23:51,260
reflective DLL injection and heap you

660
00:23:48,530 --> 00:23:52,760
can't do it in and different things<font color="#CCCCCC"> like</font>

661
00:23:51,260 --> 00:23:54,800
<font color="#CCCCCC">that</font><font color="#E5E5E5"> so it's almost always going</font><font color="#CCCCCC"> to be</font>

662
00:23:52,760 --> 00:23:57,379
in one continuous memory section<font color="#E5E5E5"> there</font>

663
00:23:54,800 --> 00:24:00,980
there is some malware<font color="#E5E5E5"> that will like</font>

664
00:23:57,380 --> 00:24:02,450
move itself<font color="#E5E5E5"> around like a</font><font color="#CCCCCC"> tool pack</font>

665
00:24:00,980 --> 00:24:04,730
itself and unpack<font color="#CCCCCC"> itself in memory</font>

666
00:24:02,450 --> 00:24:06,920
<font color="#E5E5E5">that's a little more advanced this will</font>

667
00:24:04,730 --> 00:24:09,770
you'll miss<font color="#CCCCCC"> it with this</font><font color="#E5E5E5"> technique but</font>

668
00:24:06,920 --> 00:24:11,090
<font color="#CCCCCC">for the most part</font><font color="#E5E5E5"> you know 90 plus</font>

669
00:24:09,770 --> 00:24:12,950
percent of malware<font color="#CCCCCC"> out there will have</font>

670
00:24:11,090 --> 00:24:14,840
all<font color="#E5E5E5"> their malware and continuous</font>

671
00:24:12,950 --> 00:24:18,160
sections<font color="#E5E5E5"> so I just look for unprotected</font>

672
00:24:14,840 --> 00:24:20,540
memory regions<font color="#E5E5E5"> legitimately loaded dll's</font>

673
00:24:18,160 --> 00:24:21,410
<font color="#CCCCCC">there PG header is supposed to be</font>

674
00:24:20,540 --> 00:24:25,490
<font color="#CCCCCC">read-only</font>

675
00:24:21,410 --> 00:24:27,320
especially if you have<font color="#CCCCCC"> DEP enabled so</font>

676
00:24:25,490 --> 00:24:28,520
when you look for<font color="#E5E5E5"> read</font><font color="#CCCCCC"> executors</font>

677
00:24:27,320 --> 00:24:30,500
<font color="#CCCCCC">read/write/execute and you find</font><font color="#E5E5E5"> P</font>

678
00:24:28,520 --> 00:24:33,040
headers in memory those are almost

679
00:24:30,500 --> 00:24:35,060
always not supposed<font color="#E5E5E5"> to be there</font><font color="#CCCCCC"> or</font>

680
00:24:33,040 --> 00:24:37,190
you've<font color="#E5E5E5"> got like dotnet doing</font>

681
00:24:35,060 --> 00:24:38,480
just-in-time compiled in memory<font color="#E5E5E5"> so those</font>

682
00:24:37,190 --> 00:24:40,670
are your false positives you'll see<font color="#E5E5E5"> that</font>

683
00:24:38,480 --> 00:24:44,420
some<font color="#E5E5E5"> of those but</font><font color="#CCCCCC"> oftentimes</font><font color="#E5E5E5"> they won't</font>

684
00:24:40,670 --> 00:24:46,610
have the ietters so<font color="#E5E5E5"> we'll just walk</font><font color="#CCCCCC"> PD</font>

685
00:24:44,420 --> 00:24:48,170
headers<font color="#E5E5E5"> and volatility they do this at</font>

686
00:24:46,610 --> 00:24:50,840
the kernel level<font color="#CCCCCC"> we're doing</font><font color="#E5E5E5"> in a user</font>

687
00:24:48,170 --> 00:24:52,490
mode<font color="#E5E5E5"> so it's still a very very effective</font>

688
00:24:50,840 --> 00:24:55,220
<font color="#E5E5E5">most of the malware that</font><font color="#CCCCCC"> I've tried</font><font color="#E5E5E5"> this</font>

689
00:24:52,490 --> 00:24:56,900
<font color="#E5E5E5">on it still finds the</font><font color="#CCCCCC"> PG headers</font><font color="#E5E5E5"> unless</font>

690
00:24:55,220 --> 00:25:00,100
they've mangled their PDA doors and it's

691
00:24:56,900 --> 00:25:00,100
just more<font color="#CCCCCC"> complicated but it does happen</font>

692
00:25:00,850 --> 00:25:07,070
so that's it<font color="#E5E5E5"> for now more come some of</font>

693
00:25:04,040 --> 00:25:08,950
<font color="#CCCCCC">the things</font><font color="#E5E5E5"> that I'm</font><font color="#CCCCCC"> working on a new mer</font>

694
00:25:07,070 --> 00:25:12,260
clean hooks doing custom<font color="#CCCCCC"> yarrow scans</font>

695
00:25:08,950 --> 00:25:13,610
<font color="#E5E5E5">being able to deploy that widely</font><font color="#CCCCCC"> did a</font>

696
00:25:12,260 --> 00:25:17,210
lot<font color="#E5E5E5"> of cleanup of this code this code</font>

697
00:25:13,610 --> 00:25:18,889
set was actually what I showed our

698
00:25:17,210 --> 00:25:20,480
investors when I started my<font color="#CCCCCC"> company</font>

699
00:25:18,890 --> 00:25:22,010
because<font color="#E5E5E5"> we were doing this as a service</font>

700
00:25:20,480 --> 00:25:26,030
<font color="#CCCCCC">for folks</font><font color="#E5E5E5"> going</font><font color="#CCCCCC"> out and doing these</font>

701
00:25:22,010 --> 00:25:28,670
scans<font color="#CCCCCC"> so we're</font><font color="#E5E5E5"> open sourcing this now</font>

702
00:25:26,030 --> 00:25:31,070
<font color="#CCCCCC">it's it's an old</font><font color="#E5E5E5"> old</font><font color="#CCCCCC"> toolset and old</font>

703
00:25:28,670 --> 00:25:33,530
<font color="#CCCCCC">codebase about two years old but I've</font>

704
00:25:31,070 --> 00:25:37,189
updated it and I'll continue<font color="#E5E5E5"> to maintain</font>

705
00:25:33,530 --> 00:25:41,080
it<font color="#E5E5E5"> but we'll be adding</font><font color="#CCCCCC"> more techniques</font>

706
00:25:37,190 --> 00:25:45,320
in there to find things on the<font color="#CCCCCC"> endpoint</font>

707
00:25:41,080 --> 00:25:48,490
so I'm at 30<font color="#E5E5E5"> minutes</font><font color="#CCCCCC"> now so I guess we</font>

708
00:25:45,320 --> 00:25:48,490
have<font color="#E5E5E5"> 15</font><font color="#CCCCCC"> minutes</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> questions</font><font color="#E5E5E5"> right</font>

709
00:26:07,360 --> 00:26:10,719
any questions

710
00:26:13,250 --> 00:26:17,090
if you're not<font color="#E5E5E5"> using PowerShell you</font>

711
00:26:14,870 --> 00:26:20,149
should and if you manage<font color="#CCCCCC"> a network</font>

712
00:26:17,090 --> 00:26:26,658
please enable PS remoting it's a simple

713
00:26:20,150 --> 00:26:27,679
command<font color="#CCCCCC"> yeah I</font><font color="#E5E5E5"> got figure we're gonna</font>

714
00:26:26,659 --> 00:26:34,010
put the<font color="#E5E5E5"> help I'll put all you</font><font color="#CCCCCC"> put it on</font>

715
00:26:27,679 --> 00:26:38,020
<font color="#E5E5E5">SlideShare yeah cool how many people use</font>

716
00:26:34,010 --> 00:26:38,020
PowerShell awesome

717
00:26:40,320 --> 00:27:00,510
well I'll be I'll<font color="#CCCCCC"> be around yeah so I</font>

718
00:26:44,730 --> 00:27:01,770
use this to do yeah unfortunately<font color="#CCCCCC"> right</font>

719
00:27:00,510 --> 00:27:03,330
now<font color="#E5E5E5"> for my</font><font color="#CCCCCC"> open-source development I</font>

720
00:27:01,770 --> 00:27:05,160
don't have a big domain to test against

721
00:27:03,330 --> 00:27:06,929
<font color="#E5E5E5">so I've got like a</font><font color="#CCCCCC"> little</font><font color="#E5E5E5"> virtual</font><font color="#CCCCCC"> box</font>

722
00:27:05,160 --> 00:27:08,910
containers with<font color="#E5E5E5"> 20 boxes</font><font color="#CCCCCC"> so I</font><font color="#E5E5E5"> don't get</font>

723
00:27:06,930 --> 00:27:10,200
<font color="#E5E5E5">a do whole lot of that but</font><font color="#CCCCCC"> that is</font>

724
00:27:08,910 --> 00:27:13,440
something<font color="#CCCCCC"> that</font><font color="#E5E5E5"> I would do if I had</font><font color="#CCCCCC"> a</font>

725
00:27:10,200 --> 00:27:14,880
playground<font color="#E5E5E5"> but yeah all this stuff is</font>

726
00:27:13,440 --> 00:27:16,110
done with privileged privileged you have

727
00:27:14,880 --> 00:27:20,130
to have an account<font color="#E5E5E5"> that has privileges</font>

728
00:27:16,110 --> 00:27:21,469
<font color="#E5E5E5">and the</font><font color="#CCCCCC"> active</font><font color="#E5E5E5"> directory stuff</font><font color="#CCCCCC"> there's</font>

729
00:27:20,130 --> 00:27:24,660
there's a couple<font color="#CCCCCC"> tool sets out there</font>

730
00:27:21,470 --> 00:27:26,180
that some of the pen testers have like

731
00:27:24,660 --> 00:27:30,170
<font color="#E5E5E5">Power View and</font><font color="#CCCCCC"> a couple other tools that</font>

732
00:27:26,180 --> 00:27:32,940
enumerate active directory like accounts

733
00:27:30,170 --> 00:27:34,310
<font color="#CCCCCC">using that for hunting isn't as</font>

734
00:27:32,940 --> 00:27:37,730
<font color="#E5E5E5">straightforward as I originally thought</font>

735
00:27:34,310 --> 00:27:37,730
<font color="#CCCCCC">but it can't be done</font>

