1
00:00:06,480 --> 00:00:08,880
besides las vegas breaking ground is now

2
00:00:08,880 --> 00:00:09,840
proud to present

3
00:00:09,840 --> 00:00:12,880
andrew brandt and gabor sapanos in their

4
00:00:12,880 --> 00:00:13,519
talk

5
00:00:13,519 --> 00:00:15,440
on search engine de-optimization with

6
00:00:15,440 --> 00:00:18,000
gootloader

7
00:00:20,720 --> 00:00:23,920
hi everyone so thank you very much for

8
00:00:23,920 --> 00:00:27,439
coming to our talk today at b-sides

9
00:00:27,439 --> 00:00:30,160
i'm andrew brandt principal researcher

10
00:00:30,160 --> 00:00:30,720
with

11
00:00:30,720 --> 00:00:34,160
um my colleague gabor shapnos

12
00:00:34,160 --> 00:00:37,520
who is our research director

13
00:00:37,520 --> 00:00:39,840
at sophos labs we're going to be talking

14
00:00:39,840 --> 00:00:42,480
today about a very interesting

15
00:00:42,480 --> 00:00:45,039
in our opinion uh attack that we

16
00:00:45,039 --> 00:00:45,920
discovered

17
00:00:45,920 --> 00:00:49,360
uh that we're calling goop loader

18
00:00:49,360 --> 00:00:53,199
so um what is it exactly well

19
00:00:53,199 --> 00:00:56,480
um in essence it's a web-based

20
00:00:56,480 --> 00:00:59,520
uh attack that delivers

21
00:00:59,520 --> 00:01:01,680
something called gootkit uh we're you

22
00:01:01,680 --> 00:01:03,039
know good loader being a

23
00:01:03,039 --> 00:01:06,240
concatenation of good kid and loader um

24
00:01:06,240 --> 00:01:08,400
good kid has been around for a while

25
00:01:08,400 --> 00:01:09,840
it's

26
00:01:09,840 --> 00:01:13,439
at least since 2018 and it's been used

27
00:01:13,439 --> 00:01:14,080
as a

28
00:01:14,080 --> 00:01:16,720
malware family that's delivered several

29
00:01:16,720 --> 00:01:17,920
ransomware

30
00:01:17,920 --> 00:01:21,119
uh rats and other types of malware

31
00:01:21,119 --> 00:01:24,240
um it really has evolved into

32
00:01:24,240 --> 00:01:27,280
a more widespread uh distribution

33
00:01:27,280 --> 00:01:28,479
network for malware and

34
00:01:28,479 --> 00:01:32,159
it the way that it delivers the payloads

35
00:01:32,159 --> 00:01:33,200
to targets

36
00:01:33,200 --> 00:01:35,600
is through some very interesting uh

37
00:01:35,600 --> 00:01:37,200
search engine optimization although

38
00:01:37,200 --> 00:01:38,560
we've characterized this

39
00:01:38,560 --> 00:01:42,400
search engine de-optimization

40
00:01:42,720 --> 00:01:46,240
and uses a large network of compromised

41
00:01:46,240 --> 00:01:47,439
websites

42
00:01:47,439 --> 00:01:50,640
to um to bring down a

43
00:01:50,640 --> 00:01:54,799
a sort of watering hole uh page

44
00:01:54,799 --> 00:01:59,119
that then if the if the target downloads

45
00:01:59,119 --> 00:02:01,600
what is presented on that page and and

46
00:02:01,600 --> 00:02:02,799
double clicks it

47
00:02:02,799 --> 00:02:06,159
uh starts this path of uh infection

48
00:02:06,159 --> 00:02:09,679
that we're gonna get into in a minute um

49
00:02:09,679 --> 00:02:13,840
so the the this gootloader attack

50
00:02:13,840 --> 00:02:17,599
um because it relies on

51
00:02:17,599 --> 00:02:20,720
uh manipulating search results uh the

52
00:02:20,720 --> 00:02:22,319
the attackers have done

53
00:02:22,319 --> 00:02:25,280
some poisoning of search results and

54
00:02:25,280 --> 00:02:27,440
that requires necessarily

55
00:02:27,440 --> 00:02:30,480
uh focus on specific languages and so

56
00:02:30,480 --> 00:02:33,680
what we see is that there are certain

57
00:02:33,680 --> 00:02:35,920
countries that have been targeted or at

58
00:02:35,920 --> 00:02:36,879
least the

59
00:02:36,879 --> 00:02:38,879
uh the languages of those countries have

60
00:02:38,879 --> 00:02:40,560
been targeted for

61
00:02:40,560 --> 00:02:44,080
these attacks and that

62
00:02:44,080 --> 00:02:45,760
the attackers have been delivering

63
00:02:45,760 --> 00:02:47,519
different payloads depending on

64
00:02:47,519 --> 00:02:50,560
where the target has been located

65
00:02:50,560 --> 00:02:54,239
so um the majority of the attacks we've

66
00:02:54,239 --> 00:02:54,720
seen

67
00:02:54,720 --> 00:02:57,040
have targeted the united states and

68
00:02:57,040 --> 00:02:59,120
canada and north america

69
00:02:59,120 --> 00:03:02,640
um but there also have been attacks

70
00:03:02,640 --> 00:03:06,640
targeting germany france and south korea

71
00:03:06,640 --> 00:03:09,200
and the again because of the way that

72
00:03:09,200 --> 00:03:11,519
the attack works

73
00:03:11,519 --> 00:03:15,360
the attackers are using key terms in

74
00:03:15,360 --> 00:03:18,400
the languages of those countries to

75
00:03:18,400 --> 00:03:20,800
lure people sort of into this network

76
00:03:20,800 --> 00:03:21,440
and then

77
00:03:21,440 --> 00:03:24,080
as a result the output is that they're

78
00:03:24,080 --> 00:03:25,200
getting these

79
00:03:25,200 --> 00:03:27,280
different malware payloads depending on

80
00:03:27,280 --> 00:03:28,640
the region of the world

81
00:03:28,640 --> 00:03:32,000
in which they're located so

82
00:03:32,000 --> 00:03:35,599
um doing analysis on this project was

83
00:03:35,599 --> 00:03:38,720
very challenging it was a uh the

84
00:03:38,720 --> 00:03:41,280
people who have come up with the system

85
00:03:41,280 --> 00:03:42,959
by which this works

86
00:03:42,959 --> 00:03:45,440
uh have spent a lot of time trying to

87
00:03:45,440 --> 00:03:47,040
figure out how to make it hard for

88
00:03:47,040 --> 00:03:48,959
people like zobby and myself to do the

89
00:03:48,959 --> 00:03:51,519
work that we did

90
00:03:51,519 --> 00:03:52,959
one of the ways they do that is they

91
00:03:52,959 --> 00:03:55,360
make it hard to sort of stumble into the

92
00:03:55,360 --> 00:03:57,120
watering hole

93
00:03:57,120 --> 00:03:58,959
there's a lot of criteria that have to

94
00:03:58,959 --> 00:04:00,159
be met

95
00:04:00,159 --> 00:04:04,080
the the person who goes to the page

96
00:04:04,080 --> 00:04:05,280
where the malicious

97
00:04:05,280 --> 00:04:08,400
code is being hosted has to have a

98
00:04:08,400 --> 00:04:10,560
referrer link from a web search and

99
00:04:10,560 --> 00:04:12,239
specifically

100
00:04:12,239 --> 00:04:14,000
as far as we can tell it has to be from

101
00:04:14,000 --> 00:04:15,680
google um

102
00:04:15,680 --> 00:04:18,880
it has to obviously be a visit to the

103
00:04:18,880 --> 00:04:20,478
web page from one of the targeted

104
00:04:20,478 --> 00:04:21,120
countries

105
00:04:21,120 --> 00:04:24,800
that they've that they're trying to

106
00:04:24,800 --> 00:04:27,680
infect people in and the ip address that

107
00:04:27,680 --> 00:04:29,199
you visit from

108
00:04:29,199 --> 00:04:32,400
uh has to have not been uh on that

109
00:04:32,400 --> 00:04:33,680
website in the past

110
00:04:33,680 --> 00:04:37,280
24 hours and that's just the

111
00:04:37,280 --> 00:04:39,600
part where you stumble into the page

112
00:04:39,600 --> 00:04:41,360
where they deliver

113
00:04:41,360 --> 00:04:43,840
the first stage payload but then that

114
00:04:43,840 --> 00:04:45,919
first stage payload itself

115
00:04:45,919 --> 00:04:49,120
has additional obfuscation has a

116
00:04:49,120 --> 00:04:50,720
polymorphic code

117
00:04:50,720 --> 00:04:54,639
it has incredibly long sleeps and

118
00:04:54,639 --> 00:04:57,440
some of those sleeps have been hidden

119
00:04:57,440 --> 00:04:58,160
inside

120
00:04:58,160 --> 00:05:01,120
of the encoded layer so you can't just

121
00:05:01,120 --> 00:05:01,520
uh

122
00:05:01,520 --> 00:05:04,160
you know bypass the sleeps by uh by

123
00:05:04,160 --> 00:05:04,800
rewriting

124
00:05:04,800 --> 00:05:08,320
some of the scripting code and then

125
00:05:08,320 --> 00:05:11,919
there is a whole fileless um

126
00:05:11,919 --> 00:05:13,759
sort of mechanism that it uses for

127
00:05:13,759 --> 00:05:15,039
persistence

128
00:05:15,039 --> 00:05:17,039
where some of the information and

129
00:05:17,039 --> 00:05:18,240
including the

130
00:05:18,240 --> 00:05:21,120
actual malicious payloads are being

131
00:05:21,120 --> 00:05:23,360
stored in the registry as this encoded

132
00:05:23,360 --> 00:05:24,080
data

133
00:05:24,080 --> 00:05:26,479
and then being pulled out again on

134
00:05:26,479 --> 00:05:28,720
demand

135
00:05:28,720 --> 00:05:30,560
so let me give you a quick overview of

136
00:05:30,560 --> 00:05:31,759
the attack

137
00:05:31,759 --> 00:05:34,080
and then i'm going to pass the it on to

138
00:05:34,080 --> 00:05:36,160
uh to zopy for

139
00:05:36,160 --> 00:05:39,759
the deep dive so here's a quick

140
00:05:39,759 --> 00:05:43,039
diagram that that sort of highlights the

141
00:05:43,039 --> 00:05:45,759
the high points of what we knew about

142
00:05:45,759 --> 00:05:46,560
the attack

143
00:05:46,560 --> 00:05:49,199
um back when we initially started doing

144
00:05:49,199 --> 00:05:51,280
this research

145
00:05:51,280 --> 00:05:54,080
as i mentioned it all starts with a

146
00:05:54,080 --> 00:05:55,280
google search

147
00:05:55,280 --> 00:05:59,120
and the google search terms are for

148
00:05:59,120 --> 00:06:01,360
that they're trying to you know lure

149
00:06:01,360 --> 00:06:02,880
people in with

150
00:06:02,880 --> 00:06:06,720
have to do with sort of business terms

151
00:06:06,720 --> 00:06:10,319
things like downloads but also contract

152
00:06:10,319 --> 00:06:14,160
and agreement uh in the in the languages

153
00:06:14,160 --> 00:06:15,840
that they're targeting

154
00:06:15,840 --> 00:06:19,360
and the poisoning that's happening um

155
00:06:19,360 --> 00:06:22,240
basically results in the the web page

156
00:06:22,240 --> 00:06:24,720
with the malicious stuff

157
00:06:24,720 --> 00:06:26,960
ending up at you know usually one of the

158
00:06:26,960 --> 00:06:28,639
top results but almost

159
00:06:28,639 --> 00:06:31,680
in in almost every case that we found uh

160
00:06:31,680 --> 00:06:33,520
it was the very top result

161
00:06:33,520 --> 00:06:36,240
uh in the search when when we were doing

162
00:06:36,240 --> 00:06:38,240
the analysis

163
00:06:38,240 --> 00:06:40,720
once you click that link in that first

164
00:06:40,720 --> 00:06:41,280
search

165
00:06:41,280 --> 00:06:45,280
search result you land on a web page

166
00:06:45,280 --> 00:06:47,520
that belongs to a legitimate

167
00:06:47,520 --> 00:06:48,319
organization

168
00:06:48,319 --> 00:06:52,080
or sometimes it's a private web page um

169
00:06:52,080 --> 00:06:55,039
but the web page has been modified to

170
00:06:55,039 --> 00:06:55,840
basically

171
00:06:55,840 --> 00:07:00,240
generate uh in real time a dynamic

172
00:07:00,240 --> 00:07:03,440
fake message board or forum page

173
00:07:03,440 --> 00:07:06,479
that you land on uh and that when you

174
00:07:06,479 --> 00:07:09,520
when you get there it it appears that

175
00:07:09,520 --> 00:07:10,479
there is a

176
00:07:10,479 --> 00:07:12,319
you've sort of stumbled into a

177
00:07:12,319 --> 00:07:14,880
conversation in which someone else

178
00:07:14,880 --> 00:07:17,520
has asked for exactly the thing that you

179
00:07:17,520 --> 00:07:19,199
were doing the search for

180
00:07:19,199 --> 00:07:21,680
and someone a different person on this

181
00:07:21,680 --> 00:07:23,919
fake forum page has responded to that

182
00:07:23,919 --> 00:07:24,720
question

183
00:07:24,720 --> 00:07:26,639
with hey i've got exactly what you're

184
00:07:26,639 --> 00:07:28,720
looking for here it is

185
00:07:28,720 --> 00:07:31,680
and it's that payload that you download

186
00:07:31,680 --> 00:07:33,759
from that conversation

187
00:07:33,759 --> 00:07:36,800
uh that we call the uh the first stage

188
00:07:36,800 --> 00:07:40,319
java javascript so

189
00:07:40,319 --> 00:07:42,560
that then you pull that down you end up

190
00:07:42,560 --> 00:07:43,520
with a js

191
00:07:43,520 --> 00:07:46,479
file on your your uh workstation your

192
00:07:46,479 --> 00:07:47,840
windows machine

193
00:07:47,840 --> 00:07:51,120
and by double clicking that you start w

194
00:07:51,120 --> 00:07:51,680
script

195
00:07:51,680 --> 00:07:55,039
on windows which then runs through and

196
00:07:55,039 --> 00:07:59,120
and does the the process of decrypting

197
00:07:59,120 --> 00:08:01,919
uh all of the internal stuff that then

198
00:08:01,919 --> 00:08:04,160
pulls down a second

199
00:08:04,160 --> 00:08:07,199
set of scripts and begins the rest of

200
00:08:07,199 --> 00:08:09,360
the process that you see here

201
00:08:09,360 --> 00:08:12,560
and that includes writing data into the

202
00:08:12,560 --> 00:08:13,840
registry

203
00:08:13,840 --> 00:08:17,680
um using powershell to load some of that

204
00:08:17,680 --> 00:08:18,000
stuff

205
00:08:18,000 --> 00:08:20,800
out of the registry bringing down and

206
00:08:20,800 --> 00:08:21,280
and

207
00:08:21,280 --> 00:08:24,160
you know running you know injected code

208
00:08:24,160 --> 00:08:24,720
that

209
00:08:24,720 --> 00:08:27,520
through process hollowing runs within a

210
00:08:27,520 --> 00:08:29,280
legitimate process

211
00:08:29,280 --> 00:08:32,159
and then that final that final payload

212
00:08:32,159 --> 00:08:34,640
that's running in the context of

213
00:08:34,640 --> 00:08:37,919
some other legitimate process in windows

214
00:08:37,919 --> 00:08:40,080
has the ability to do things like bring

215
00:08:40,080 --> 00:08:42,080
down the final payload

216
00:08:42,080 --> 00:08:44,240
now what we discovered in doing the

217
00:08:44,240 --> 00:08:45,440
analysis of this

218
00:08:45,440 --> 00:08:48,160
is that this entire process is handled

219
00:08:48,160 --> 00:08:49,120
through

220
00:08:49,120 --> 00:08:51,440
a machine that we're calling the mother

221
00:08:51,440 --> 00:08:53,200
ship but it's essentially the command

222
00:08:53,200 --> 00:08:54,720
and control server

223
00:08:54,720 --> 00:08:58,000
for for the malware it also is

224
00:08:58,000 --> 00:09:00,320
delivering the fake forum content to

225
00:09:00,320 --> 00:09:01,600
that page

226
00:09:01,600 --> 00:09:06,000
and delivering the javascript

227
00:09:07,360 --> 00:09:11,120
so um this this visualization is from a

228
00:09:11,120 --> 00:09:13,600
tool that we call the root cause

229
00:09:13,600 --> 00:09:16,000
analysis tool it's an internal tool

230
00:09:16,000 --> 00:09:19,360
here in sofos and it shows

231
00:09:19,360 --> 00:09:22,480
a representation of um

232
00:09:22,480 --> 00:09:24,480
the telemetry that we've collected from

233
00:09:24,480 --> 00:09:26,399
one of these attacks

234
00:09:26,399 --> 00:09:28,080
and what what you'll see here is that it

235
00:09:28,080 --> 00:09:30,480
sort of starts in the upper right corner

236
00:09:30,480 --> 00:09:33,200
with the firefox browser in this case uh

237
00:09:33,200 --> 00:09:35,279
browsing to a page on google

238
00:09:35,279 --> 00:09:39,519
and then following it to a search result

239
00:09:39,519 --> 00:09:43,279
which delivers a zip file

240
00:09:43,279 --> 00:09:47,200
that contains a js script

241
00:09:47,200 --> 00:09:49,279
so as you sort of move from the upper

242
00:09:49,279 --> 00:09:51,360
right to the

243
00:09:51,360 --> 00:09:54,399
to the lower right you see that the user

244
00:09:54,399 --> 00:09:54,800
ran

245
00:09:54,800 --> 00:09:57,839
winrar to unzip the file they double

246
00:09:57,839 --> 00:09:58,880
clicked it

247
00:09:58,880 --> 00:10:02,240
which then invokes wscript

248
00:10:02,240 --> 00:10:04,800
and the windows scripting host then sort

249
00:10:04,800 --> 00:10:06,880
of handles the rest of the infection

250
00:10:06,880 --> 00:10:08,560
process at which point

251
00:10:08,560 --> 00:10:10,800
um you know the machine is basically

252
00:10:10,800 --> 00:10:12,880
toast within a few seconds

253
00:10:12,880 --> 00:10:16,160
uh wscript invokes powershell

254
00:10:16,160 --> 00:10:18,560
powershell is running through a bunch of

255
00:10:18,560 --> 00:10:19,279
commands

256
00:10:19,279 --> 00:10:22,480
doing the decrypting doing the

257
00:10:22,480 --> 00:10:24,800
the process hollowing and injecting and

258
00:10:24,800 --> 00:10:25,680
eventually

259
00:10:25,680 --> 00:10:27,440
you you end up in the bot sort of the

260
00:10:27,440 --> 00:10:30,000
bottom left corner there with gootkit

261
00:10:30,000 --> 00:10:33,200
at step six

262
00:10:33,200 --> 00:10:34,959
so i'm gonna pass it over to zopi who's

263
00:10:34,959 --> 00:10:37,680
gonna take over the rest of the

264
00:10:37,680 --> 00:10:40,160
the talk

265
00:10:41,040 --> 00:10:43,279
uh yes and i'm trying to explain the

266
00:10:43,279 --> 00:10:44,880
technicalities of the

267
00:10:44,880 --> 00:10:49,279
whole infection chain and as andrew said

268
00:10:49,279 --> 00:10:52,560
it it starts with a google search but

269
00:10:52,560 --> 00:10:55,040
that's not where the whole store story

270
00:10:55,040 --> 00:10:56,720
begins

271
00:10:56,720 --> 00:11:00,079
because before that the operators of

272
00:11:00,079 --> 00:11:03,360
this good loader infrastructure

273
00:11:03,360 --> 00:11:07,360
must already have compromised several

274
00:11:07,360 --> 00:11:12,320
web servers that host their code

275
00:11:12,839 --> 00:11:14,800
so before

276
00:11:14,800 --> 00:11:17,600
uh the beginning of the infection there

277
00:11:17,600 --> 00:11:19,120
is a prerequisite

278
00:11:19,120 --> 00:11:22,240
a preparation phase where several dozens

279
00:11:22,240 --> 00:11:24,959
or hundreds or maybe even thousands of

280
00:11:24,959 --> 00:11:26,240
uh

281
00:11:26,240 --> 00:11:29,600
websites are compromised and we don't

282
00:11:29,600 --> 00:11:30,640
have

283
00:11:30,640 --> 00:11:33,279
information how exactly they are

284
00:11:33,279 --> 00:11:34,959
compromising these

285
00:11:34,959 --> 00:11:38,640
wordpress sites uh it could be

286
00:11:38,640 --> 00:11:40,800
some remote vulnerability or they're

287
00:11:40,800 --> 00:11:43,360
just using

288
00:11:43,360 --> 00:11:45,120
weak password username password

289
00:11:45,120 --> 00:11:47,360
combinations but what we know

290
00:11:47,360 --> 00:11:50,560
is the result of this compromise and the

291
00:11:50,560 --> 00:11:53,439
result is that

292
00:11:55,040 --> 00:11:58,560
a set of scripts are injected into

293
00:11:58,560 --> 00:12:02,639
into the wordpress installation and

294
00:12:02,639 --> 00:12:05,760
these scripts are defined as event

295
00:12:05,760 --> 00:12:06,560
handlers

296
00:12:06,560 --> 00:12:09,600
to different wordpress events for

297
00:12:09,600 --> 00:12:10,000
example

298
00:12:10,000 --> 00:12:12,800
the the first three uh on the list on

299
00:12:12,800 --> 00:12:13,760
the top

300
00:12:13,760 --> 00:12:18,000
are uh responding to

301
00:12:18,000 --> 00:12:19,760
the events when the content or the

302
00:12:19,760 --> 00:12:21,920
header of the or the footer of the web

303
00:12:21,920 --> 00:12:22,720
page is

304
00:12:22,720 --> 00:12:26,000
being prepared and is ready to publish

305
00:12:26,000 --> 00:12:29,600
on the the html page and the last one

306
00:12:29,600 --> 00:12:32,800
is uh executed and the last look is

307
00:12:32,800 --> 00:12:35,760
executed when the wordpress instance is

308
00:12:35,760 --> 00:12:38,000
started up this is the

309
00:12:38,000 --> 00:12:41,040
the boot up at initialization phase of

310
00:12:41,040 --> 00:12:42,480
the malicious code

311
00:12:42,480 --> 00:12:45,600
and one of the typical

312
00:12:45,600 --> 00:12:47,360
code fragments that we see on these

313
00:12:47,360 --> 00:12:49,519
compromised sites

314
00:12:49,519 --> 00:12:52,560
is a piece of code that does

315
00:12:52,560 --> 00:12:56,720
ip address filtering and blacklisting

316
00:12:56,720 --> 00:13:00,399
and what it does it makes sure that

317
00:13:00,399 --> 00:13:03,360
it doesn't serve the same ip address

318
00:13:03,360 --> 00:13:05,680
again if it is already been served on

319
00:13:05,680 --> 00:13:06,959
the same day

320
00:13:06,959 --> 00:13:08,880
so you cannot go to the website and

321
00:13:08,880 --> 00:13:10,880
infect yourself over and over again it

322
00:13:10,880 --> 00:13:11,440
doesn't

323
00:13:11,440 --> 00:13:14,560
really happen to victims

324
00:13:14,560 --> 00:13:17,839
of this infection more like

325
00:13:17,839 --> 00:13:20,480
researchers who want to understand the

326
00:13:20,480 --> 00:13:21,839
entire process

327
00:13:21,839 --> 00:13:24,959
anyway not only the i the address itself

328
00:13:24,959 --> 00:13:26,639
but the

329
00:13:26,639 --> 00:13:28,560
a large neighborhood of that ip

330
00:13:28,560 --> 00:13:30,959
addresses

331
00:13:30,959 --> 00:13:33,360
is also blacklisted which shows that the

332
00:13:33,360 --> 00:13:34,560
operators of

333
00:13:34,560 --> 00:13:36,320
goodwill there are not particularly

334
00:13:36,320 --> 00:13:37,600
interested

335
00:13:37,600 --> 00:13:40,880
in infecting thousands of users in fact

336
00:13:40,880 --> 00:13:42,399
they are quite happy if they

337
00:13:42,399 --> 00:13:44,880
manage to infect only a single user

338
00:13:44,880 --> 00:13:49,839
within an organization

339
00:13:55,120 --> 00:13:58,320
and then let's start

340
00:13:58,320 --> 00:14:01,519
with the infection process

341
00:14:01,519 --> 00:14:04,480
itself now that the preparations are

342
00:14:04,480 --> 00:14:05,760
done and

343
00:14:05,760 --> 00:14:09,199
let me begin why i found this research

344
00:14:09,199 --> 00:14:11,600
interesting because i've been analyzing

345
00:14:11,600 --> 00:14:13,360
computer viruses and other

346
00:14:13,360 --> 00:14:16,560
sorts of malware for 25 years i have

347
00:14:16,560 --> 00:14:17,440
seen

348
00:14:17,440 --> 00:14:20,320
many different infection forms we have

349
00:14:20,320 --> 00:14:22,320
seen a lot of presentations about

350
00:14:22,320 --> 00:14:25,360
mulder delivered in email messages

351
00:14:25,360 --> 00:14:29,360
or marker being distributed via

352
00:14:29,360 --> 00:14:31,519
vulnerabilities or weak passwords in

353
00:14:31,519 --> 00:14:32,399
that

354
00:14:32,399 --> 00:14:35,680
facing applications or services or

355
00:14:35,680 --> 00:14:38,959
water hauling attacks

356
00:14:40,160 --> 00:14:43,519
but malware being delivered through

357
00:14:43,519 --> 00:14:44,560
search engine on

358
00:14:44,560 --> 00:14:47,680
optimization is a is somewhat

359
00:14:47,680 --> 00:14:50,959
of a different uh different thing that i

360
00:14:50,959 --> 00:14:53,120
have not experienced before

361
00:14:53,120 --> 00:14:55,279
and i it was very interesting for me one

362
00:14:55,279 --> 00:14:56,240
of my

363
00:14:56,240 --> 00:14:58,959
most interesting researches that

364
00:14:58,959 --> 00:15:00,079
happened and i

365
00:15:00,079 --> 00:15:03,040
i tried to understand the end-to-end

366
00:15:03,040 --> 00:15:04,720
infection process

367
00:15:04,720 --> 00:15:06,639
and i'm trying to explain in the

368
00:15:06,639 --> 00:15:08,000
remaining of the

369
00:15:08,000 --> 00:15:10,240
presentation how this impression process

370
00:15:10,240 --> 00:15:11,839
goes

371
00:15:11,839 --> 00:15:14,560
because it's a very different infection

372
00:15:14,560 --> 00:15:15,199
strategy

373
00:15:15,199 --> 00:15:19,199
from the trajectory's point of view

374
00:15:19,600 --> 00:15:22,639
the good loader operators are

375
00:15:22,639 --> 00:15:25,760
they are like spiders they cast a web

376
00:15:25,760 --> 00:15:28,880
of poisoned search expressions

377
00:15:28,880 --> 00:15:31,360
and then they don't do anything they are

378
00:15:31,360 --> 00:15:32,720
waiting for the

379
00:15:32,720 --> 00:15:35,199
the victims to hit those expressions in

380
00:15:35,199 --> 00:15:36,880
a search engine

381
00:15:36,880 --> 00:15:40,560
and get themselves

382
00:15:40,560 --> 00:15:43,759
infected so unlike other distribution

383
00:15:43,759 --> 00:15:45,600
strategies they don't have

384
00:15:45,600 --> 00:15:48,560
a predefined target list that they are

385
00:15:48,560 --> 00:15:50,160
going to after they are different

386
00:15:50,160 --> 00:15:52,480
mechanisms to make sure

387
00:15:52,480 --> 00:15:54,320
uh that they are reaching their desired

388
00:15:54,320 --> 00:15:56,160
targets if you can skip back to the

389
00:15:56,160 --> 00:15:58,000
previous slide

390
00:15:58,000 --> 00:16:01,199
one of these um target selection

391
00:16:01,199 --> 00:16:05,519
mechanism is the search

392
00:16:06,639 --> 00:16:10,079
expressions that they are poisoning

393
00:16:10,079 --> 00:16:13,600
and uh if you're able

394
00:16:13,600 --> 00:16:16,959
to gain reasonable statistics from the

395
00:16:16,959 --> 00:16:17,839
german

396
00:16:17,839 --> 00:16:20,079
search terms that they were poisoning

397
00:16:20,079 --> 00:16:21,519
and it turns out that

398
00:16:21,519 --> 00:16:24,480
the main terms were related to free

399
00:16:24,480 --> 00:16:26,160
software downloads

400
00:16:26,160 --> 00:16:29,600
or samples

401
00:16:29,600 --> 00:16:32,959
or forms of contracts and

402
00:16:32,959 --> 00:16:36,079
other legal documents these are what

403
00:16:36,079 --> 00:16:39,519
they were after more

404
00:16:39,519 --> 00:16:43,040
most notably uh they were not targeting

405
00:16:43,040 --> 00:16:44,000
search terms

406
00:16:44,000 --> 00:16:48,480
like viagra or porn or

407
00:16:48,480 --> 00:16:51,600
software cracks so they were not

408
00:16:51,600 --> 00:16:55,120
going after the average uh

409
00:16:55,120 --> 00:16:57,759
computer user more like business

410
00:16:57,759 --> 00:16:59,199
environments and

411
00:16:59,199 --> 00:17:02,399
business computer users

412
00:17:02,399 --> 00:17:04,480
this is one of the selection methods

413
00:17:04,480 --> 00:17:06,000
they were using

414
00:17:06,000 --> 00:17:09,599
and then when one of the victims goes to

415
00:17:09,599 --> 00:17:10,400
the

416
00:17:10,400 --> 00:17:14,000
web browser and starts punching in

417
00:17:14,000 --> 00:17:17,280
his search terms like in in this case

418
00:17:17,280 --> 00:17:20,880
we are simulating a german

419
00:17:20,880 --> 00:17:25,599
victim who is looking for a free

420
00:17:25,599 --> 00:17:29,280
free download of midi songs so it enters

421
00:17:29,280 --> 00:17:31,200
the google search engine which we found

422
00:17:31,200 --> 00:17:33,440
is

423
00:17:33,520 --> 00:17:36,480
the good loader infrastructure is most

424
00:17:36,480 --> 00:17:38,400
efficient in targeting the google search

425
00:17:38,400 --> 00:17:39,280
engine

426
00:17:39,280 --> 00:17:43,919
and we actually found that

427
00:17:43,919 --> 00:17:46,240
they are pretty successful in that on

428
00:17:46,240 --> 00:17:47,280
the

429
00:17:47,280 --> 00:17:49,520
around the top of the list of the hit

430
00:17:49,520 --> 00:17:50,400
list we

431
00:17:50,400 --> 00:17:54,000
always found the compromised

432
00:17:54,000 --> 00:17:55,919
websites that are delivering the

433
00:17:55,919 --> 00:17:58,000
malicious content

434
00:17:58,000 --> 00:18:01,360
but how are they able to uh

435
00:18:01,360 --> 00:18:05,679
achieve that how can they be successful

436
00:18:05,679 --> 00:18:08,240
and how can they fool the google search

437
00:18:08,240 --> 00:18:10,640
engine

438
00:18:11,440 --> 00:18:13,679
so let's look at the the original web

439
00:18:13,679 --> 00:18:14,960
page

440
00:18:14,960 --> 00:18:19,760
that is that was on the top of the list

441
00:18:19,760 --> 00:18:23,280
of the search results it's actually

442
00:18:23,280 --> 00:18:26,240
an informational site from michigan

443
00:18:26,240 --> 00:18:29,440
cannabis entrepreneurs little to do with

444
00:18:29,440 --> 00:18:33,280
german midi songs but

445
00:18:33,280 --> 00:18:36,400
if we look into the

446
00:18:36,400 --> 00:18:40,720
code of the website itself that is

447
00:18:40,720 --> 00:18:43,520
exposed in the in the source code what

448
00:18:43,520 --> 00:18:45,039
we find

449
00:18:45,039 --> 00:18:48,640
is that it contains

450
00:18:48,640 --> 00:18:51,600
a large

451
00:18:52,160 --> 00:18:56,080
blob of of data

452
00:18:56,160 --> 00:18:58,960
and and that data contains the the most

453
00:18:58,960 --> 00:19:01,039
common search terms that this good

454
00:19:01,039 --> 00:19:02,720
loader malware distribution

455
00:19:02,720 --> 00:19:04,720
infrastructure is targeting

456
00:19:04,720 --> 00:19:08,640
also along with the subsides within the

457
00:19:08,640 --> 00:19:11,919
within that host that are allegedly

458
00:19:11,919 --> 00:19:13,360
serving those

459
00:19:13,360 --> 00:19:17,200
and all this is organized into a

460
00:19:17,200 --> 00:19:19,039
an element within the web page this

461
00:19:19,039 --> 00:19:22,640
element is called a64 ec 48

462
00:19:22,640 --> 00:19:25,200
and there is a script tag at the end of

463
00:19:25,200 --> 00:19:26,320
this

464
00:19:26,320 --> 00:19:29,520
element that makes sure that it is it is

465
00:19:29,520 --> 00:19:30,799
an invisible

466
00:19:30,799 --> 00:19:34,080
uh non-display element so when an

467
00:19:34,080 --> 00:19:36,720
average user would visit this site it

468
00:19:36,720 --> 00:19:38,480
would experience nothing

469
00:19:38,480 --> 00:19:42,160
about this content and this search terms

470
00:19:42,160 --> 00:19:42,799
and the

471
00:19:42,799 --> 00:19:46,799
this advertised subpage sub pages

472
00:19:46,799 --> 00:19:49,520
but when a search engine scroller visits

473
00:19:49,520 --> 00:19:51,120
the site

474
00:19:51,120 --> 00:19:53,919
it will find all this and it will uh

475
00:19:53,919 --> 00:19:55,840
gather all these keywords and it will

476
00:19:55,840 --> 00:19:56,960
rank highly

477
00:19:56,960 --> 00:19:59,919
in the search results anyway let's go

478
00:19:59,919 --> 00:20:01,360
back to the

479
00:20:01,360 --> 00:20:03,039
german user that was trying to infect

480
00:20:03,039 --> 00:20:04,480
itself himself

481
00:20:04,480 --> 00:20:07,840
with a good law there

482
00:20:09,120 --> 00:20:12,000
if the site is visited from any other

483
00:20:12,000 --> 00:20:12,799
country then

484
00:20:12,799 --> 00:20:16,080
target from mexico

485
00:20:16,080 --> 00:20:19,840
or sweden or hungary my home country

486
00:20:19,840 --> 00:20:23,360
the content that would be displayed

487
00:20:23,360 --> 00:20:26,080
after the click from the google search

488
00:20:26,080 --> 00:20:26,960
is an

489
00:20:26,960 --> 00:20:30,240
innocently looking german text about the

490
00:20:30,240 --> 00:20:34,480
german electronic music scene

491
00:20:34,480 --> 00:20:37,200
that mouse and other outdoors are listed

492
00:20:37,200 --> 00:20:39,120
there

493
00:20:39,120 --> 00:20:42,000
fair enough but how does it turn into a

494
00:20:42,000 --> 00:20:43,200
malware distribution

495
00:20:43,200 --> 00:20:45,280
framework let's look into the source

496
00:20:45,280 --> 00:20:48,400
code of this page

497
00:20:48,400 --> 00:20:51,520
and it turns out that the

498
00:20:51,520 --> 00:20:54,720
depending on the if the conditions are

499
00:20:54,720 --> 00:20:55,440
met

500
00:20:55,440 --> 00:20:58,080
for the target selection the content of

501
00:20:58,080 --> 00:21:01,120
the page will be changed on the fly

502
00:21:01,120 --> 00:21:04,080
this page the the content of this uh

503
00:21:04,080 --> 00:21:06,400
website the html code contains the

504
00:21:06,400 --> 00:21:07,200
original

505
00:21:07,200 --> 00:21:10,400
german text about the german electronic

506
00:21:10,400 --> 00:21:11,520
music scene

507
00:21:11,520 --> 00:21:14,159
plus an inserted javascript and this is

508
00:21:14,159 --> 00:21:14,559
where

509
00:21:14,559 --> 00:21:17,600
it starts to get interesting

510
00:21:17,600 --> 00:21:21,440
this inside javascript is the one that

511
00:21:21,440 --> 00:21:21,919
will

512
00:21:21,919 --> 00:21:25,280
first reshack to the mothership

513
00:21:25,280 --> 00:21:28,840
and it does that by first gathering

514
00:21:28,840 --> 00:21:30,240
information

515
00:21:30,240 --> 00:21:34,159
about the request uh that led the the

516
00:21:34,159 --> 00:21:36,080
user to clicking

517
00:21:36,080 --> 00:21:38,159
on that page and visiting that page that

518
00:21:38,159 --> 00:21:40,480
the information is the

519
00:21:40,480 --> 00:21:44,000
server id the ip address from the

520
00:21:44,000 --> 00:21:48,080
user that the user was visiting from

521
00:21:48,080 --> 00:21:50,760
it is used for filtering out

522
00:21:50,760 --> 00:21:52,799
non-intended and non

523
00:21:52,799 --> 00:21:56,480
non-wanted countries visiting that

524
00:21:56,480 --> 00:21:59,520
site and restricting it only to

525
00:21:59,520 --> 00:22:02,720
germany in this case user agent

526
00:22:02,720 --> 00:22:05,760
and most importantly the reference

527
00:22:05,760 --> 00:22:08,960
string of the web browsing and in this

528
00:22:08,960 --> 00:22:10,880
case the reference string will contain

529
00:22:10,880 --> 00:22:13,600
the original search terms that were

530
00:22:13,600 --> 00:22:17,360
punched in into the web search engine

531
00:22:17,360 --> 00:22:20,720
and from all that a large uh request is

532
00:22:20,720 --> 00:22:25,120
is built and it is sent to mygame.ps

533
00:22:25,120 --> 00:22:27,520
server which is the mothership that's

534
00:22:27,520 --> 00:22:29,679
the domain name of the mothership

535
00:22:29,679 --> 00:22:31,760
that serves the malicious content

536
00:22:31,760 --> 00:22:34,000
throughout this distribution campaign

537
00:22:34,000 --> 00:22:37,440
and at the end whatever is returned from

538
00:22:37,440 --> 00:22:38,240
the mothership

539
00:22:38,240 --> 00:22:40,640
is going to be rendered into the finally

540
00:22:40,640 --> 00:22:42,080
displayed page

541
00:22:42,080 --> 00:22:44,720
a header to header and a body text to

542
00:22:44,720 --> 00:22:47,039
the body text

543
00:22:47,039 --> 00:22:50,559
but what will be this returned content

544
00:22:50,559 --> 00:22:54,320
first of all uh what it will do

545
00:22:54,320 --> 00:22:58,080
is uh at first it will purge all

546
00:22:58,080 --> 00:23:00,640
original content that was to be

547
00:23:00,640 --> 00:23:01,840
displayed

548
00:23:01,840 --> 00:23:04,400
so the entire thing about dead mouse and

549
00:23:04,400 --> 00:23:05,200
the

550
00:23:05,200 --> 00:23:08,640
german electronic music scene

551
00:23:08,640 --> 00:23:12,240
is is deleted uh after that

552
00:23:12,240 --> 00:23:16,080
a fake forum discussion text is inserted

553
00:23:16,080 --> 00:23:18,880
in the next step

554
00:23:18,880 --> 00:23:22,480
it is going to talk about uh

555
00:23:22,480 --> 00:23:26,000
free midi song downloads just as the

556
00:23:26,000 --> 00:23:27,760
as the user requested from the search

557
00:23:27,760 --> 00:23:30,320
engine and finally downloaded link will

558
00:23:30,320 --> 00:23:32,320
be presented

559
00:23:32,320 --> 00:23:36,080
so at the end when the webpage

560
00:23:36,080 --> 00:23:39,280
is swapped what the user will

561
00:23:39,280 --> 00:23:43,440
not see uh is the original content

562
00:23:43,440 --> 00:23:46,559
uh actually it will probably see

563
00:23:46,559 --> 00:23:49,440
for a couple of milliseconds the the

564
00:23:49,440 --> 00:23:51,600
header of the page or

565
00:23:51,600 --> 00:23:54,559
or the blank uh content but uh

566
00:23:54,559 --> 00:23:57,039
immediately it will be replaced

567
00:23:57,039 --> 00:24:00,000
uh by the fake forum conversation and

568
00:24:00,000 --> 00:24:02,159
this fake forum conversation

569
00:24:02,159 --> 00:24:04,559
it will always have the same general

570
00:24:04,559 --> 00:24:05,840
structure

571
00:24:05,840 --> 00:24:10,320
it will be about some user looking for

572
00:24:10,320 --> 00:24:14,000
miraculously in the same search terms

573
00:24:14,000 --> 00:24:17,679
that the visiting victim

574
00:24:17,679 --> 00:24:21,039
has been searching for and then a very

575
00:24:21,039 --> 00:24:24,240
helpful administrator is providing with

576
00:24:24,240 --> 00:24:27,279
the download link and the thankful user

577
00:24:27,279 --> 00:24:29,440
is very grateful and thanking for for

578
00:24:29,440 --> 00:24:31,200
all the have and

579
00:24:31,200 --> 00:24:34,480
uh very happy at the end it is a very

580
00:24:34,480 --> 00:24:37,600
very smart social engineering trick the

581
00:24:37,600 --> 00:24:38,880
user punched in

582
00:24:38,880 --> 00:24:42,000
uh free midi song downloads in the web

583
00:24:42,000 --> 00:24:42,640
browser

584
00:24:42,640 --> 00:24:45,600
and it will end up in a forum discussion

585
00:24:45,600 --> 00:24:46,240
that

586
00:24:46,240 --> 00:24:48,400
discusses exactly that and provides a

587
00:24:48,400 --> 00:24:51,840
solution for exactly that

588
00:24:52,159 --> 00:24:55,120
and this the same structure is repeated

589
00:24:55,120 --> 00:24:57,360
over and over again whatever we are

590
00:24:57,360 --> 00:25:01,440
looking at the german german

591
00:25:01,440 --> 00:25:04,640
or the french or the the

592
00:25:04,640 --> 00:25:07,679
english or the korean versions of this

593
00:25:07,679 --> 00:25:09,679
distribution framework

594
00:25:09,679 --> 00:25:11,840
uh the text was always the same

595
00:25:11,840 --> 00:25:12,960
translated

596
00:25:12,960 --> 00:25:15,760
to that particular language and even the

597
00:25:15,760 --> 00:25:18,240
icons representing the users

598
00:25:18,240 --> 00:25:22,080
are the same so it always has the same

599
00:25:22,080 --> 00:25:25,919
visual fear and the important part is

600
00:25:25,919 --> 00:25:29,120
the download link that is inserted and

601
00:25:29,120 --> 00:25:29,679
that's

602
00:25:29,679 --> 00:25:33,360
allegedly provided by the administrator

603
00:25:33,360 --> 00:25:36,240
and what does this download link contain

604
00:25:36,240 --> 00:25:37,600
it will

605
00:25:37,600 --> 00:25:41,200
it will point to a zip file

606
00:25:41,200 --> 00:25:45,039
that will contain a javascript

607
00:25:45,039 --> 00:25:48,240
component and

608
00:25:48,480 --> 00:25:50,640
if we look at the name of the javascript

609
00:25:50,640 --> 00:25:53,679
file it will be exactly the same

610
00:25:53,679 --> 00:25:56,880
name composed from the original search

611
00:25:56,880 --> 00:25:57,840
terms

612
00:25:57,840 --> 00:26:02,400
it's because when the page is rendered

613
00:26:02,400 --> 00:26:04,480
the request to the mothership will

614
00:26:04,480 --> 00:26:06,240
contain the refreshed

615
00:26:06,240 --> 00:26:09,120
string which contains the original

616
00:26:09,120 --> 00:26:11,360
search terms and the mothership returns

617
00:26:11,360 --> 00:26:13,279
a file

618
00:26:13,279 --> 00:26:16,480
with the name exactly matching uh

619
00:26:16,480 --> 00:26:19,360
the beast so from the victim's point of

620
00:26:19,360 --> 00:26:20,880
view he was searching

621
00:26:20,880 --> 00:26:25,840
for three midi songs in

622
00:26:26,880 --> 00:26:29,360
search engine it will end up at a forum

623
00:26:29,360 --> 00:26:30,240
discussion

624
00:26:30,240 --> 00:26:33,600
uh discussing uh the same exact terms

625
00:26:33,600 --> 00:26:35,279
three midi songs

626
00:26:35,279 --> 00:26:37,600
and it will be served with a file that

627
00:26:37,600 --> 00:26:39,679
will have the exact same name

628
00:26:39,679 --> 00:26:42,400
uh free mini song so it all looks so

629
00:26:42,400 --> 00:26:45,679
convenient and so

630
00:26:46,240 --> 00:26:48,559
not suspicious so why wouldn't they

631
00:26:48,559 --> 00:26:49,760
click it anyone would kill

632
00:26:49,760 --> 00:26:54,960
it right what happens then

633
00:26:56,640 --> 00:27:00,000
then the mayhem will be released on him

634
00:27:00,000 --> 00:27:04,400
and the infection process will start

635
00:27:04,400 --> 00:27:06,880
by executing the first stage javascript

636
00:27:06,880 --> 00:27:07,840
which was

637
00:27:07,840 --> 00:27:10,960
uh downloaded and clicked by the the

638
00:27:10,960 --> 00:27:13,760
suspecting victim and this first

639
00:27:13,760 --> 00:27:16,080
javascript is a highly obfuscated

640
00:27:16,080 --> 00:27:19,279
server-side polymorphic code

641
00:27:19,279 --> 00:27:23,039
where the the initial instructions

642
00:27:23,039 --> 00:27:26,000
are broken up into elementary pieces the

643
00:27:26,000 --> 00:27:27,600
first two lines

644
00:27:27,600 --> 00:27:31,200
uh are the first is a function that just

645
00:27:31,200 --> 00:27:34,159
does nothing but adds two numbers the

646
00:27:34,159 --> 00:27:34,960
second

647
00:27:34,960 --> 00:27:37,600
splits a string so the the elementary

648
00:27:37,600 --> 00:27:39,440
operations are split into

649
00:27:39,440 --> 00:27:41,520
uh functions and they are placed in

650
00:27:41,520 --> 00:27:42,720
random order

651
00:27:42,720 --> 00:27:46,480
and all these pivots have an encryptor

652
00:27:46,480 --> 00:27:49,600
uh which uh decrypts

653
00:27:49,600 --> 00:27:53,279
uh the the content uh

654
00:27:53,279 --> 00:27:56,399
that's in the middle of this uh

655
00:27:56,399 --> 00:28:00,480
display actually the the decrypted

656
00:28:00,480 --> 00:28:03,120
content would continue the layer of the

657
00:28:03,120 --> 00:28:04,640
same encryption so

658
00:28:04,640 --> 00:28:07,840
then it's all over the end result will

659
00:28:07,840 --> 00:28:08,799
be

660
00:28:08,799 --> 00:28:11,679
the download there code for the the

661
00:28:11,679 --> 00:28:12,159
second

662
00:28:12,159 --> 00:28:13,840
three stage installer and this

663
00:28:13,840 --> 00:28:15,440
downloader code

664
00:28:15,440 --> 00:28:18,399
has a simple structure it has a it uses

665
00:28:18,399 --> 00:28:19,600
a set of three

666
00:28:19,600 --> 00:28:22,720
possible download server names

667
00:28:22,720 --> 00:28:25,440
and it sends a request to the to the

668
00:28:25,440 --> 00:28:26,880
download server

669
00:28:26,880 --> 00:28:30,799
and the request will contain the unique

670
00:28:30,799 --> 00:28:33,919
unit parameter highlighted by yellow in

671
00:28:33,919 --> 00:28:34,320
this

672
00:28:34,320 --> 00:28:37,279
in this code listing that will be

673
00:28:37,279 --> 00:28:39,760
randomly generated unique parameter for

674
00:28:39,760 --> 00:28:40,640
each

675
00:28:40,640 --> 00:28:43,679
visit and each user

676
00:28:43,679 --> 00:28:47,600
and the randomly looking string

677
00:28:47,679 --> 00:28:50,080
consisting of numbers is appended as a

678
00:28:50,080 --> 00:28:51,600
value of this parameter

679
00:28:51,600 --> 00:28:56,480
but the last six digits of this

680
00:28:56,480 --> 00:28:58,720
this value will not be that random

681
00:28:58,720 --> 00:28:59,760
because

682
00:28:59,760 --> 00:29:02,720
that's always two seven eight one four

683
00:29:02,720 --> 00:29:04,000
six

684
00:29:04,000 --> 00:29:07,520
and uh this represents that the user

685
00:29:07,520 --> 00:29:11,279
who who executed this javascript is

686
00:29:11,279 --> 00:29:13,840
actually

687
00:29:13,840 --> 00:29:15,919
using a computer that is connected to a

688
00:29:15,919 --> 00:29:18,240
windows domain so it's likely

689
00:29:18,240 --> 00:29:21,039
to be part of a corporate environment

690
00:29:21,039 --> 00:29:21,600
and not

691
00:29:21,600 --> 00:29:25,919
a researcher running in a sandbox on or

692
00:29:25,919 --> 00:29:26,159
an

693
00:29:26,159 --> 00:29:28,559
analysis environment it is also uh

694
00:29:28,559 --> 00:29:30,640
anti-analysis to lend a sort of

695
00:29:30,640 --> 00:29:35,200
selection of the potential victims

696
00:29:35,600 --> 00:29:38,960
so this

697
00:29:38,960 --> 00:29:42,799
code reaches out to a php file

698
00:29:42,799 --> 00:29:45,840
on the second the

699
00:29:45,840 --> 00:29:48,880
second search hosting server

700
00:29:48,880 --> 00:29:52,880
and this simple php file

701
00:29:52,880 --> 00:29:55,840
it does nothing more but collects all

702
00:29:55,840 --> 00:29:57,039
the

703
00:29:57,039 --> 00:30:00,799
request parameters and hands it over

704
00:30:00,799 --> 00:30:03,120
to the mothership that request is

705
00:30:03,120 --> 00:30:04,960
visible at the bottom of the code in

706
00:30:04,960 --> 00:30:06,000
this case

707
00:30:06,000 --> 00:30:08,080
the mothership is not represented by the

708
00:30:08,080 --> 00:30:09,600
my game that this

709
00:30:09,600 --> 00:30:12,640
domain name but the corresponding ip

710
00:30:12,640 --> 00:30:13,919
address

711
00:30:13,919 --> 00:30:17,159
anyway the request is sent to this file

712
00:30:17,159 --> 00:30:18,720
sd.php file

713
00:30:18,720 --> 00:30:22,720
and this php file in return if the

714
00:30:22,720 --> 00:30:25,279
conditions are met for the infection of

715
00:30:25,279 --> 00:30:26,559
the user

716
00:30:26,559 --> 00:30:31,600
it returns the installer javascript

717
00:30:31,600 --> 00:30:36,000
and that installer javascript

718
00:30:36,000 --> 00:30:38,480
um

719
00:30:39,440 --> 00:30:42,880
it contains two embedded large strings

720
00:30:42,880 --> 00:30:45,279
uh these are the windows components that

721
00:30:45,279 --> 00:30:46,960
are used in the later stages of

722
00:30:46,960 --> 00:30:48,080
infection

723
00:30:48,080 --> 00:30:50,320
one is the injector of the final payload

724
00:30:50,320 --> 00:30:52,640
the other is the registry order that

725
00:30:52,640 --> 00:30:55,279
will load the injector from the registry

726
00:30:55,279 --> 00:30:56,320
there is a

727
00:30:56,320 --> 00:30:59,600
short javascript code that will save

728
00:30:59,600 --> 00:31:04,720
both of these blobs into the registry

729
00:31:04,720 --> 00:31:08,159
and then uh creates an autorun key in

730
00:31:08,159 --> 00:31:10,159
the registry it is it will be executed

731
00:31:10,159 --> 00:31:10,640
whenever

732
00:31:10,640 --> 00:31:13,440
the computer is rebooted every time and

733
00:31:13,440 --> 00:31:13,919
this

734
00:31:13,919 --> 00:31:17,120
uh the value of this key will be

735
00:31:17,120 --> 00:31:19,200
the powershell code that is visible at

736
00:31:19,200 --> 00:31:20,480
the listing

737
00:31:20,480 --> 00:31:23,840
on the bottom which will extract the

738
00:31:23,840 --> 00:31:25,039
registry loader

739
00:31:25,039 --> 00:31:27,440
and

740
00:31:28,799 --> 00:31:33,840
proceed on with the infection process

741
00:31:35,840 --> 00:31:40,640
so at the end of the successful

742
00:31:40,640 --> 00:31:43,679
execution of the installer script we are

743
00:31:43,679 --> 00:31:44,880
going to have

744
00:31:44,880 --> 00:31:48,960
a set of registry keys that are storing

745
00:31:48,960 --> 00:31:52,399
the the payload injector we are going to

746
00:31:52,399 --> 00:31:54,399
have another set of registry keys that

747
00:31:54,399 --> 00:31:55,600
is storing

748
00:31:55,600 --> 00:31:57,519
the registry order these are the two

749
00:31:57,519 --> 00:31:59,760
windows malicious components

750
00:31:59,760 --> 00:32:02,720
of the uh good loader distribution

751
00:32:02,720 --> 00:32:03,679
framework

752
00:32:03,679 --> 00:32:06,320
we are going to have an an autorun key

753
00:32:06,320 --> 00:32:08,080
in the registry

754
00:32:08,080 --> 00:32:11,200
uh which if we look at the value of the

755
00:32:11,200 --> 00:32:12,240
autorun key

756
00:32:12,240 --> 00:32:15,919
it's the at the bottom of the the window

757
00:32:15,919 --> 00:32:20,640
it will read a value of some

758
00:32:20,640 --> 00:32:22,960
windows environment variable and

759
00:32:22,960 --> 00:32:25,039
whatever the value was there

760
00:32:25,039 --> 00:32:28,240
it will execute it and the value

761
00:32:28,240 --> 00:32:31,039
of that environment variable is going to

762
00:32:31,039 --> 00:32:31,679
be

763
00:32:31,679 --> 00:32:35,279
a final piece of

764
00:32:35,279 --> 00:32:38,240
powershell code that will go through the

765
00:32:38,240 --> 00:32:39,279
registry

766
00:32:39,279 --> 00:32:42,640
uh extracts the the keys that are

767
00:32:42,640 --> 00:32:43,919
corresponding to the

768
00:32:43,919 --> 00:32:47,440
registry loader loads that program into

769
00:32:47,440 --> 00:32:48,080
the memory

770
00:32:48,080 --> 00:32:51,600
and runs it so

771
00:32:51,679 --> 00:32:54,159
at the end of the successful injection

772
00:32:54,159 --> 00:32:55,519
we are going to have

773
00:32:55,519 --> 00:32:58,399
two blobs in the registry we are going

774
00:32:58,399 --> 00:32:59,919
to have a registry key

775
00:32:59,919 --> 00:33:01,840
and we are going to have an environment

776
00:33:01,840 --> 00:33:03,679
variable and that's all

777
00:33:03,679 --> 00:33:06,960
the the files components that are on the

778
00:33:06,960 --> 00:33:09,120
infected system

779
00:33:09,120 --> 00:33:13,279
uh no malicious content will be created

780
00:33:13,279 --> 00:33:16,399
in the file system uh so most of the

781
00:33:16,399 --> 00:33:18,000
components will be

782
00:33:18,000 --> 00:33:21,039
invisible from uh across the classic

783
00:33:21,039 --> 00:33:22,840
traditional

784
00:33:22,840 --> 00:33:27,679
uh antivirus protection programs

785
00:33:27,679 --> 00:33:30,399
so let's look at what the registry

786
00:33:30,399 --> 00:33:31,360
loader does

787
00:33:31,360 --> 00:33:34,640
after the the previous

788
00:33:34,640 --> 00:33:38,559
powershell loader invoked it it will

789
00:33:38,559 --> 00:33:42,159
go through the registry and uh

790
00:33:42,159 --> 00:33:45,279
it's the the content of the

791
00:33:45,279 --> 00:33:47,919
the the payload injector which is stored

792
00:33:47,919 --> 00:33:48,480
in

793
00:33:48,480 --> 00:33:51,519
uh consequently named

794
00:33:51,519 --> 00:33:54,559
register sub key 0 0 1 2 3

795
00:33:54,559 --> 00:33:57,679
up to however long that loader is

796
00:33:57,679 --> 00:33:59,919
now at first it doesn't look like much

797
00:33:59,919 --> 00:34:01,279
of an executable

798
00:34:01,279 --> 00:34:05,760
it's just some random junk string

799
00:34:05,760 --> 00:34:08,879
but what the registry loader does is

800
00:34:08,879 --> 00:34:12,239
after it collected it it will

801
00:34:12,239 --> 00:34:17,520
uh do a brief

802
00:34:17,520 --> 00:34:20,719
transformation uh i

803
00:34:20,719 --> 00:34:22,560
decryption would be too ambitious for

804
00:34:22,560 --> 00:34:25,280
that so let's uh look at what happens to

805
00:34:25,280 --> 00:34:26,879
the first four

806
00:34:26,879 --> 00:34:30,320
characters or of the stored registry law

807
00:34:30,320 --> 00:34:30,639
that

808
00:34:30,639 --> 00:34:34,879
is a wdua string

809
00:34:34,879 --> 00:34:37,040
the

810
00:34:38,320 --> 00:34:42,399
the y will be replaced by 4

811
00:34:42,399 --> 00:34:46,800
at the beginning the d it will be

812
00:34:46,800 --> 00:34:48,480
it will remain the same it is not

813
00:34:48,480 --> 00:34:50,320
transferred uh

814
00:34:50,320 --> 00:34:53,918
the u it will be replaced by four

815
00:34:53,918 --> 00:34:57,200
obama by five and the

816
00:34:57,200 --> 00:35:00,400
a again it will be not transferred

817
00:35:00,400 --> 00:35:04,400
so it start to resemble a hexadecimal

818
00:35:04,400 --> 00:35:06,800
representation of an executable because

819
00:35:06,800 --> 00:35:08,160
these two

820
00:35:08,160 --> 00:35:11,520
bytes correspond to the mz marker at the

821
00:35:11,520 --> 00:35:15,040
beginning of the windows executable

822
00:35:15,040 --> 00:35:16,800
from that we can get a picture of how

823
00:35:16,800 --> 00:35:18,640
this file will be

824
00:35:18,640 --> 00:35:21,440
extracted from the memory uh from the

825
00:35:21,440 --> 00:35:22,800
registry

826
00:35:22,800 --> 00:35:24,880
and will be loaded into the memory as a

827
00:35:24,880 --> 00:35:28,000
windows executable

828
00:35:29,280 --> 00:35:32,320
in in the next step

829
00:35:32,320 --> 00:35:35,520
the the loaded injector will inject the

830
00:35:35,520 --> 00:35:38,160
final payload using process hollowing

831
00:35:38,160 --> 00:35:41,119
um this is illustrated in this simple

832
00:35:41,119 --> 00:35:43,520
process trace

833
00:35:43,520 --> 00:35:47,359
that we have observed it goes from the

834
00:35:47,359 --> 00:35:51,520
bottom right to the upper left corner

835
00:35:51,520 --> 00:35:54,960
it starts with a the powershell code

836
00:35:54,960 --> 00:35:56,160
that was read from the

837
00:35:56,160 --> 00:36:00,560
environment variable then uh

838
00:36:00,640 --> 00:36:02,640
no it starts from the powershell code

839
00:36:02,640 --> 00:36:04,960
that was uh setting the registry autorun

840
00:36:04,960 --> 00:36:06,720
key then in the middle is the powershell

841
00:36:06,720 --> 00:36:07,920
code that was in the

842
00:36:07,920 --> 00:36:11,680
environment variable and then a clean

843
00:36:11,680 --> 00:36:13,280
seemingly keen windows application

844
00:36:13,280 --> 00:36:15,280
imaging devices.exe

845
00:36:15,280 --> 00:36:19,440
is executed but what happens is that

846
00:36:19,440 --> 00:36:22,720
uh the that the injector is going to

847
00:36:22,720 --> 00:36:23,200
load

848
00:36:23,200 --> 00:36:25,200
these imaging devices exa which is part

849
00:36:25,200 --> 00:36:27,440
of the microsoft photo viewer

850
00:36:27,440 --> 00:36:31,040
suit application

851
00:36:31,040 --> 00:36:33,200
loads it for execution but holds the

852
00:36:33,200 --> 00:36:34,480
execution

853
00:36:34,480 --> 00:36:37,280
and overrides the entire memory area

854
00:36:37,280 --> 00:36:38,480
occupied by it

855
00:36:38,480 --> 00:36:40,640
by the final payload which would be one

856
00:36:40,640 --> 00:36:42,560
of the trojans distributed by this

857
00:36:42,560 --> 00:36:44,079
framework so

858
00:36:44,079 --> 00:36:46,720
uh on the first side it would look like

859
00:36:46,720 --> 00:36:47,200
that

860
00:36:47,200 --> 00:36:48,800
a clean windows application imaging

861
00:36:48,800 --> 00:36:50,480
devices except was uh

862
00:36:50,480 --> 00:36:54,000
executed but really at the

863
00:36:54,000 --> 00:36:56,800
bottom of that a malicious windows code

864
00:36:56,800 --> 00:36:57,280
is

865
00:36:57,280 --> 00:37:00,000
has taken over that memory space and

866
00:37:00,000 --> 00:37:02,320
executed from there

867
00:37:02,320 --> 00:37:05,359
later on uh they the

868
00:37:05,359 --> 00:37:08,000
the operators of mood loader that why

869
00:37:08,000 --> 00:37:09,280
bother with

870
00:37:09,280 --> 00:37:12,720
relying on the the existence of

871
00:37:12,720 --> 00:37:14,880
of the imaging devices it may not be

872
00:37:14,880 --> 00:37:16,560
there it may have been uninstalled or

873
00:37:16,560 --> 00:37:17,440
deleted

874
00:37:17,440 --> 00:37:19,599
so they brought along a benign

875
00:37:19,599 --> 00:37:21,280
application by themselves

876
00:37:21,280 --> 00:37:23,280
so the the injector contained two

877
00:37:23,280 --> 00:37:26,400
executables a clean one that was loaded

878
00:37:26,400 --> 00:37:30,079
uh and the execution was halted

879
00:37:30,079 --> 00:37:33,200
and was posed

880
00:37:33,200 --> 00:37:35,680
and then the the content was overwritten

881
00:37:35,680 --> 00:37:36,880
by the chronos

882
00:37:36,880 --> 00:37:39,920
banking roger payload so if you are

883
00:37:39,920 --> 00:37:43,280
looking at from a process explorer

884
00:37:43,280 --> 00:37:47,359
you would see that a clean trusted

885
00:37:47,359 --> 00:37:50,400
even digitally signed application

886
00:37:50,400 --> 00:37:52,720
from embarcadero technologies uh has

887
00:37:52,720 --> 00:37:54,079
been executed

888
00:37:54,079 --> 00:37:57,359
but really at the in

889
00:37:57,359 --> 00:38:01,440
in reality uh the the coronal spanking

890
00:38:01,440 --> 00:38:02,320
trojan is

891
00:38:02,320 --> 00:38:05,359
running in disguise of of this clean

892
00:38:05,359 --> 00:38:08,000
application

893
00:38:15,359 --> 00:38:18,560
so the i'll take over from here zopie

894
00:38:18,560 --> 00:38:21,280
um so what we found in doing the

895
00:38:21,280 --> 00:38:23,440
analysis on this story

896
00:38:23,440 --> 00:38:26,320
uh is that um as we mentioned earlier

897
00:38:26,320 --> 00:38:28,000
they're using these compromised

898
00:38:28,000 --> 00:38:30,240
uh wordpress sites we don't know how

899
00:38:30,240 --> 00:38:32,400
they're compromising these sites

900
00:38:32,400 --> 00:38:34,960
and in the course of doing uh the

901
00:38:34,960 --> 00:38:36,960
analysis of this attack

902
00:38:36,960 --> 00:38:41,359
uh we found relatively small numbers of

903
00:38:41,359 --> 00:38:44,079
uh sites that were that were hosting the

904
00:38:44,079 --> 00:38:45,599
landing pages

905
00:38:45,599 --> 00:38:47,599
that we're delivering that first stage

906
00:38:47,599 --> 00:38:49,280
of malware and then

907
00:38:49,280 --> 00:38:50,800
slightly more that we're hosting the

908
00:38:50,800 --> 00:38:53,280
second stage

909
00:38:53,280 --> 00:38:56,240
however we suspect that that these

910
00:38:56,240 --> 00:38:57,920
numbers are much larger

911
00:38:57,920 --> 00:39:00,960
and that we are only seeing a uh a tiny

912
00:39:00,960 --> 00:39:02,079
window

913
00:39:02,079 --> 00:39:05,440
into this uh sort of much

914
00:39:05,440 --> 00:39:09,440
greater size attack um

915
00:39:09,440 --> 00:39:11,599
and uh it's sort of to highlight the

916
00:39:11,599 --> 00:39:13,280
fact that everything

917
00:39:13,280 --> 00:39:15,200
uh is really being controlled by the

918
00:39:15,200 --> 00:39:16,640
mothership we also

919
00:39:16,640 --> 00:39:19,359
noted that there was this um additional

920
00:39:19,359 --> 00:39:20,800
php

921
00:39:20,800 --> 00:39:22,800
that uh that was being delivered to the

922
00:39:22,800 --> 00:39:24,480
wordpress sites

923
00:39:24,480 --> 00:39:29,359
uh is a very simple uh remote shell

924
00:39:29,359 --> 00:39:32,400
so that they can take anything uh pass

925
00:39:32,400 --> 00:39:33,040
it as a

926
00:39:33,040 --> 00:39:36,480
as a as a variable or as a

927
00:39:36,480 --> 00:39:38,880
in the query string to the website and

928
00:39:38,880 --> 00:39:40,480
have the website

929
00:39:40,480 --> 00:39:44,400
basically interpret that and uh run the

930
00:39:44,400 --> 00:39:46,720
code or command or whatever it is uh

931
00:39:46,720 --> 00:39:47,680
remotely on

932
00:39:47,680 --> 00:39:50,800
on the wordpress site

933
00:39:50,800 --> 00:39:53,839
so um what do we do about this

934
00:39:53,839 --> 00:39:57,599
the real problem here is the is the next

935
00:39:57,599 --> 00:39:59,200
step so you say you're a

936
00:39:59,200 --> 00:40:01,839
standard sort of like you know windows

937
00:40:01,839 --> 00:40:02,480
using

938
00:40:02,480 --> 00:40:05,359
web browser person um what do you do

939
00:40:05,359 --> 00:40:06,400
about this

940
00:40:06,400 --> 00:40:09,440
um there's a few steps that that

941
00:40:09,440 --> 00:40:12,400
savvy people can take and the problem

942
00:40:12,400 --> 00:40:13,839
that we discovered

943
00:40:13,839 --> 00:40:16,720
is that with each of these possible

944
00:40:16,720 --> 00:40:17,839
solutions and

945
00:40:17,839 --> 00:40:19,599
you know we're not including you know

946
00:40:19,599 --> 00:40:21,359
running ace uh you know

947
00:40:21,359 --> 00:40:24,240
quality uh endpoint security product on

948
00:40:24,240 --> 00:40:25,440
your machine but just

949
00:40:25,440 --> 00:40:26,800
what are things that you can do that

950
00:40:26,800 --> 00:40:28,800
don't involve buying a security

951
00:40:28,800 --> 00:40:31,920
product um well there are free tools

952
00:40:31,920 --> 00:40:32,880
like things like

953
00:40:32,880 --> 00:40:35,680
noscript security suite which runs in

954
00:40:35,680 --> 00:40:36,839
firefox and

955
00:40:36,839 --> 00:40:40,079
chrome they do offer some protection

956
00:40:40,079 --> 00:40:43,280
the problem is that um using noscript is

957
00:40:43,280 --> 00:40:44,400
a pretty high bar

958
00:40:44,400 --> 00:40:47,920
for non-technical people to to sort of

959
00:40:47,920 --> 00:40:49,200
become

960
00:40:49,200 --> 00:40:51,440
aware of how it works and to understand

961
00:40:51,440 --> 00:40:52,400
how to

962
00:40:52,400 --> 00:40:55,440
use it effectively um there are things

963
00:40:55,440 --> 00:40:57,680
like you can learn to recognize this

964
00:40:57,680 --> 00:41:00,319
this fake message board the the redirect

965
00:41:00,319 --> 00:41:02,319
page that we were talking about

966
00:41:02,319 --> 00:41:04,880
um they always use the same icons they

967
00:41:04,880 --> 00:41:06,480
always use the same

968
00:41:06,480 --> 00:41:09,440
sort of structure and visual appearance

969
00:41:09,440 --> 00:41:11,359
of the page

970
00:41:11,359 --> 00:41:13,200
not everybody is going to do that not

971
00:41:13,200 --> 00:41:14,880
everybody is going to have seen this

972
00:41:14,880 --> 00:41:16,240
talk

973
00:41:16,240 --> 00:41:17,920
as much as we would like the whole world

974
00:41:17,920 --> 00:41:19,520
to know about this um

975
00:41:19,520 --> 00:41:20,800
there will be people who have never

976
00:41:20,800 --> 00:41:22,640
heard of this until they get

977
00:41:22,640 --> 00:41:24,720
you know sort of this thrust in their

978
00:41:24,720 --> 00:41:25,680
face

979
00:41:25,680 --> 00:41:28,480
um it's also probably too high a bar to

980
00:41:28,480 --> 00:41:29,359
say

981
00:41:29,359 --> 00:41:32,160
um instead of clicking a link in the

982
00:41:32,160 --> 00:41:33,200
search result

983
00:41:33,200 --> 00:41:35,119
just type in the address and go to the

984
00:41:35,119 --> 00:41:37,119
home page of that website make sure that

985
00:41:37,119 --> 00:41:39,200
it has the type of content

986
00:41:39,200 --> 00:41:40,960
that that they claim that they're going

987
00:41:40,960 --> 00:41:42,480
to have

988
00:41:42,480 --> 00:41:43,760
i don't i don't think that that's a

989
00:41:43,760 --> 00:41:46,319
reasonable thing to say and

990
00:41:46,319 --> 00:41:48,240
you know i've said this for years but

991
00:41:48,240 --> 00:41:50,079
you know by default windows has this

992
00:41:50,079 --> 00:41:52,000
setting called hide file extensions for

993
00:41:52,000 --> 00:41:53,680
known file types

994
00:41:53,680 --> 00:41:56,319
i've always told people to turn that off

995
00:41:56,319 --> 00:41:56,960
um

996
00:41:56,960 --> 00:42:00,240
and if you do it you might realize that

997
00:42:00,240 --> 00:42:02,560
you've downloaded a file with a dot js

998
00:42:02,560 --> 00:42:04,960
extension and not a pdf or a document

999
00:42:04,960 --> 00:42:05,760
file

1000
00:42:05,760 --> 00:42:08,079
uh but that also then relies on people

1001
00:42:08,079 --> 00:42:09,760
knowing that they shouldn't click a js

1002
00:42:09,760 --> 00:42:11,920
file that that it's actually dangerous

1003
00:42:11,920 --> 00:42:15,760
and so these are all very problematic

1004
00:42:15,760 --> 00:42:17,520
solutions for end users

1005
00:42:17,520 --> 00:42:19,359
and really what i what i want to say is

1006
00:42:19,359 --> 00:42:21,520
that google itself

1007
00:42:21,520 --> 00:42:25,200
is the watering hole in this case there

1008
00:42:25,200 --> 00:42:28,480
they really need to be aware

1009
00:42:28,480 --> 00:42:30,880
of this method of manipulating their

1010
00:42:30,880 --> 00:42:32,000
search results

1011
00:42:32,000 --> 00:42:33,680
um you know here's here's one of these

1012
00:42:33,680 --> 00:42:35,359
results and you know there's this

1013
00:42:35,359 --> 00:42:37,520
ability to kind of look at it and

1014
00:42:37,520 --> 00:42:39,200
google will even tell you like this

1015
00:42:39,200 --> 00:42:41,359
website was indexed you know

1016
00:42:41,359 --> 00:42:44,079
several years ago and even though you

1017
00:42:44,079 --> 00:42:44,640
know

1018
00:42:44,640 --> 00:42:47,680
it's not https that may not matter

1019
00:42:47,680 --> 00:42:50,480
you know the re the reality is that um

1020
00:42:50,480 --> 00:42:52,480
it's the search engine optimization that

1021
00:42:52,480 --> 00:42:53,040
starts

1022
00:42:53,040 --> 00:42:55,760
the whole rest of the snowball effect

1023
00:42:55,760 --> 00:42:56,800
happening

1024
00:42:56,800 --> 00:42:59,119
and leads to something like this and and

1025
00:42:59,119 --> 00:43:00,720
until google

1026
00:43:00,720 --> 00:43:03,040
sort of is able to recognize when this

1027
00:43:03,040 --> 00:43:04,079
kind of search engine

1028
00:43:04,079 --> 00:43:06,400
manipulation is happening on their

1029
00:43:06,400 --> 00:43:07,440
platform

1030
00:43:07,440 --> 00:43:09,359
and start to address it and adjust their

1031
00:43:09,359 --> 00:43:10,560
algorithms

1032
00:43:10,560 --> 00:43:12,720
i don't know that there's really a great

1033
00:43:12,720 --> 00:43:14,480
solution for end users

1034
00:43:14,480 --> 00:43:17,520
other than to just be extremely careful

1035
00:43:17,520 --> 00:43:20,560
when something that is exactly what

1036
00:43:20,560 --> 00:43:22,240
you've been looking for gets dropped in

1037
00:43:22,240 --> 00:43:24,560
your lap like it was basically

1038
00:43:24,560 --> 00:43:28,240
um you know gift from heaven so um

1039
00:43:28,240 --> 00:43:30,560
so hopefully google will deal with that

1040
00:43:30,560 --> 00:43:31,280
and uh

1041
00:43:31,280 --> 00:43:33,920
and that concludes our talk so we'll

1042
00:43:33,920 --> 00:43:35,920
open it up for questions

1043
00:43:35,920 --> 00:43:41,839
and uh thank you for attending our talk

1044
00:43:45,440 --> 00:43:48,720
all right thank you for joining us today

1045
00:43:48,720 --> 00:43:49,680
this is the

1046
00:43:49,680 --> 00:43:52,720
q a or the search engine de-optimization

1047
00:43:52,720 --> 00:43:55,359
with gootloader

1048
00:44:04,640 --> 00:44:06,640
i understand your co-author gabor

1049
00:44:06,640 --> 00:44:08,000
couldn't make it today

1050
00:44:08,000 --> 00:44:10,400
due to the time zone uh but we're really

1051
00:44:10,400 --> 00:44:11,920
glad to have the chance to talk about

1052
00:44:11,920 --> 00:44:12,319
this

1053
00:44:12,319 --> 00:44:14,800
presentation with you um i love your

1054
00:44:14,800 --> 00:44:16,240
background by the way that is

1055
00:44:16,240 --> 00:44:19,359
uh really awesome

1056
00:44:19,359 --> 00:44:22,960
thank you what is that uh so yeah uh

1057
00:44:22,960 --> 00:44:25,359
this is a uh it's a historic photograph

1058
00:44:25,359 --> 00:44:28,319
of the computer lab at ucla uh from the

1059
00:44:28,319 --> 00:44:29,920
1970s i'm a

1060
00:44:29,920 --> 00:44:32,319
uh in addition to doing uh malware

1061
00:44:32,319 --> 00:44:33,599
analysis

1062
00:44:33,599 --> 00:44:36,720
uh i volunteer at a retro computing

1063
00:44:36,720 --> 00:44:37,520
museum

1064
00:44:37,520 --> 00:44:40,640
uh here in colorado and uh so i

1065
00:44:40,640 --> 00:44:43,200
i use some of these machines for real

1066
00:44:43,200 --> 00:44:44,640
and i like to play with them

1067
00:44:44,640 --> 00:44:47,440
uh you know at the museum as well so we

1068
00:44:47,440 --> 00:44:48,960
had a really great museum here in

1069
00:44:48,960 --> 00:44:50,079
seattle that went out

1070
00:44:50,079 --> 00:44:51,839
uh because of kovit it's out of business

1071
00:44:51,839 --> 00:44:53,920
so i'm very sad but hopefully maybe

1072
00:44:53,920 --> 00:44:54,960
someday it comes back

1073
00:44:54,960 --> 00:44:57,520
i'm aware of that yeah we've been trying

1074
00:44:57,520 --> 00:44:58,079
to obtain

1075
00:44:58,079 --> 00:45:01,760
some of their stuff actually excellent

1076
00:45:01,760 --> 00:45:03,760
well i'm glad it ends up somewhere um so

1077
00:45:03,760 --> 00:45:05,839
first off uh let me just say that you

1078
00:45:05,839 --> 00:45:06,880
know the structure

1079
00:45:06,880 --> 00:45:10,079
of this attack is just i mean

1080
00:45:10,079 --> 00:45:11,680
you know it's really really hit me it's

1081
00:45:11,680 --> 00:45:13,599
beautiful it's it's such a lovely middle

1082
00:45:13,599 --> 00:45:14,560
point between

1083
00:45:14,560 --> 00:45:17,200
fishing and like actual spear fishing

1084
00:45:17,200 --> 00:45:18,960
and it kind of hit me on a personal

1085
00:45:18,960 --> 00:45:20,640
level right in a way like

1086
00:45:20,640 --> 00:45:22,640
let's say scattering usb drives or

1087
00:45:22,640 --> 00:45:24,400
malicious ads for

1088
00:45:24,400 --> 00:45:26,240
various you know too good to be true

1089
00:45:26,240 --> 00:45:28,240
products just can't right yeah i mean

1090
00:45:28,240 --> 00:45:29,680
this is something we've all been there

1091
00:45:29,680 --> 00:45:31,599
right trying to rtfm or

1092
00:45:31,599 --> 00:45:33,599
pull up a hail mary on a code feature

1093
00:45:33,599 --> 00:45:35,119
where we're trying to implement or

1094
00:45:35,119 --> 00:45:36,720
a communication protocol we're trying to

1095
00:45:36,720 --> 00:45:38,640
reverse engineer a song or movie we

1096
00:45:38,640 --> 00:45:40,240
can't find in print anywhere

1097
00:45:40,240 --> 00:45:42,160
or some buggy interaction we can't

1098
00:45:42,160 --> 00:45:43,359
figure out and then like

1099
00:45:43,359 --> 00:45:45,359
we cast it out into the internet's

1100
00:45:45,359 --> 00:45:46,800
hoping desperately

1101
00:45:46,800 --> 00:45:49,520
that someone somewhere has documented

1102
00:45:49,520 --> 00:45:50,960
this thing that we're wrestling with

1103
00:45:50,960 --> 00:45:52,000
right and then

1104
00:45:52,000 --> 00:45:54,400
chorus of angels oh you know they're in

1105
00:45:54,400 --> 00:45:56,240
the glow of the monitors this thing that

1106
00:45:56,240 --> 00:45:58,079
promises salvation you know

1107
00:45:58,079 --> 00:46:00,079
or at least that possibility of cutting

1108
00:46:00,079 --> 00:46:02,240
a few hours off our struggles and

1109
00:46:02,240 --> 00:46:03,839
it just plays so beautifully into

1110
00:46:03,839 --> 00:46:05,280
psychology

1111
00:46:05,280 --> 00:46:07,280
of certain you know niche problems and

1112
00:46:07,280 --> 00:46:09,280
professions and subcultures that you

1113
00:46:09,280 --> 00:46:11,200
really have to admire it

1114
00:46:11,200 --> 00:46:13,440
and and that is really the danger here

1115
00:46:13,440 --> 00:46:14,400
is that it is

1116
00:46:14,400 --> 00:46:17,520
handing you precisely what you what you

1117
00:46:17,520 --> 00:46:18,720
are asking for

1118
00:46:18,720 --> 00:46:22,079
and in fact uh it is using uh exactly

1119
00:46:22,079 --> 00:46:23,839
the same words that you have entered

1120
00:46:23,839 --> 00:46:25,680
into your search query right that they

1121
00:46:25,680 --> 00:46:28,079
uh know that it's able to parse that

1122
00:46:28,079 --> 00:46:29,040
stuff

1123
00:46:29,040 --> 00:46:31,599
and then uh send it off to that um to

1124
00:46:31,599 --> 00:46:32,560
that what we call

1125
00:46:32,560 --> 00:46:35,599
the um the mothership server which then

1126
00:46:35,599 --> 00:46:37,359
serves you up with a piece of malware

1127
00:46:37,359 --> 00:46:39,520
that is named the you know after the

1128
00:46:39,520 --> 00:46:41,200
query that you have just entered so it

1129
00:46:41,200 --> 00:46:41,680
is

1130
00:46:41,680 --> 00:46:43,839
essentially handing you exactly what you

1131
00:46:43,839 --> 00:46:45,040
asked for

1132
00:46:45,040 --> 00:46:48,000
um but again like you said it's only in

1133
00:46:48,000 --> 00:46:48,480
very

1134
00:46:48,480 --> 00:46:51,200
niche types of of queries right and

1135
00:46:51,200 --> 00:46:53,119
they're all business related we saw that

1136
00:46:53,119 --> 00:46:53,440
the

1137
00:46:53,440 --> 00:46:56,480
terminology uh in all of the languages

1138
00:46:56,480 --> 00:46:59,599
that these threat actors targeted uh

1139
00:46:59,599 --> 00:47:01,440
were looking for terms that had to do

1140
00:47:01,440 --> 00:47:03,680
with contracts or business agreements of

1141
00:47:03,680 --> 00:47:04,960
some kind and so

1142
00:47:04,960 --> 00:47:06,960
you would see things like you know terms

1143
00:47:06,960 --> 00:47:08,560
like agreement or

1144
00:47:08,560 --> 00:47:12,000
documents or loan or uh you know

1145
00:47:12,000 --> 00:47:14,240
contract and and those were the kinds of

1146
00:47:14,240 --> 00:47:15,119
words

1147
00:47:15,119 --> 00:47:18,240
that turned up uh most frequently

1148
00:47:18,240 --> 00:47:21,440
in these searches so i

1149
00:47:21,440 --> 00:47:23,520
you know that actually does lead me to

1150
00:47:23,520 --> 00:47:24,480
another question

1151
00:47:24,480 --> 00:47:26,880
um which is how common is this thing

1152
00:47:26,880 --> 00:47:28,400
actually in the wild i mean what's your

1153
00:47:28,400 --> 00:47:29,440
sense of

1154
00:47:29,440 --> 00:47:30,960
who's employing this and how they're

1155
00:47:30,960 --> 00:47:32,720
targeting it

1156
00:47:32,720 --> 00:47:35,520
uh that that is a great question and um

1157
00:47:35,520 --> 00:47:36,160
you know we

1158
00:47:36,160 --> 00:47:39,280
we only have um basically a tiny window

1159
00:47:39,280 --> 00:47:40,400
into this

1160
00:47:40,400 --> 00:47:43,520
uh the way that we discovered it was

1161
00:47:43,520 --> 00:47:45,440
was fairly niched in the sense that you

1162
00:47:45,440 --> 00:47:47,200
know we have telemetry that we're

1163
00:47:47,200 --> 00:47:49,359
receiving from customers that is telling

1164
00:47:49,359 --> 00:47:50,720
us about

1165
00:47:50,720 --> 00:47:53,040
uh essentially the these a couple of

1166
00:47:53,040 --> 00:47:54,400
activities just before

1167
00:47:54,400 --> 00:47:57,280
something bad is detected on the machine

1168
00:47:57,280 --> 00:47:57,760
and

1169
00:47:57,760 --> 00:47:59,680
using that we were able to bet to back

1170
00:47:59,680 --> 00:48:02,319
trace you know sort of what they did

1171
00:48:02,319 --> 00:48:04,640
and um we think that it's actually

1172
00:48:04,640 --> 00:48:06,480
extremely widespread

1173
00:48:06,480 --> 00:48:10,160
we are aware of 90 to 100 compromised

1174
00:48:10,160 --> 00:48:12,400
web servers we believe it's probably

1175
00:48:12,400 --> 00:48:15,440
an order of magnitude more uh web

1176
00:48:15,440 --> 00:48:17,599
servers that are being used to do this

1177
00:48:17,599 --> 00:48:19,119
search engine optimization

1178
00:48:19,119 --> 00:48:22,480
and um you know again it's not it's it's

1179
00:48:22,480 --> 00:48:23,920
obviously not difficult

1180
00:48:23,920 --> 00:48:26,960
for a sort of dedicated threat actor and

1181
00:48:26,960 --> 00:48:28,880
and the payload that they're delivering

1182
00:48:28,880 --> 00:48:29,839
in a lot of cases

1183
00:48:29,839 --> 00:48:32,480
is a steeler that steals credentials

1184
00:48:32,480 --> 00:48:34,400
from a big variety of

1185
00:48:34,400 --> 00:48:36,079
software including you know an ftp

1186
00:48:36,079 --> 00:48:37,839
credential for a website

1187
00:48:37,839 --> 00:48:40,240
so is is quite reasonable for them to

1188
00:48:40,240 --> 00:48:42,240
have access to a thousand or two

1189
00:48:42,240 --> 00:48:43,839
thousand servers that they then

1190
00:48:43,839 --> 00:48:46,960
you know inject this code into wow

1191
00:48:46,960 --> 00:48:49,599
um so i also my understanding is i mean

1192
00:48:49,599 --> 00:48:50,079
you guys

1193
00:48:50,079 --> 00:48:51,359
you were depressed with this a little

1194
00:48:51,359 --> 00:48:54,000
while back in like march right so what

1195
00:48:54,000 --> 00:48:55,599
uh is there anything like that you've

1196
00:48:55,599 --> 00:48:57,040
learned since then that you know didn't

1197
00:48:57,040 --> 00:48:57,760
make it into

1198
00:48:57,760 --> 00:48:59,520
into the presentation or anything you

1199
00:48:59,520 --> 00:49:02,160
know uh that's evolving still with this

1200
00:49:02,160 --> 00:49:04,160
so what's the the direction forward

1201
00:49:04,160 --> 00:49:07,440
yeah so um we so the new stuff that we

1202
00:49:07,440 --> 00:49:08,240
discovered

1203
00:49:08,240 --> 00:49:11,760
since the the publication is uh that we

1204
00:49:11,760 --> 00:49:14,079
we obtained with the help of one of the

1205
00:49:14,079 --> 00:49:15,520
owners of one of these compromised

1206
00:49:15,520 --> 00:49:16,640
websites

1207
00:49:16,640 --> 00:49:19,839
we got all the the um the wordpress

1208
00:49:19,839 --> 00:49:22,160
modification code the so that stuff that

1209
00:49:22,160 --> 00:49:24,960
you saw in the presentation

1210
00:49:24,960 --> 00:49:26,720
about how the mothership talks back and

1211
00:49:26,720 --> 00:49:28,079
forth to the wordpress site

1212
00:49:28,079 --> 00:49:31,280
is all new um we also you know in the

1213
00:49:31,280 --> 00:49:33,040
course of doing that we discovered that

1214
00:49:33,040 --> 00:49:34,000
one-liner

1215
00:49:34,000 --> 00:49:36,000
uh you know remote shell that they were

1216
00:49:36,000 --> 00:49:37,280
injecting into every one of these

1217
00:49:37,280 --> 00:49:38,880
wordpress sites which basically means

1218
00:49:38,880 --> 00:49:39,599
that

1219
00:49:39,599 --> 00:49:41,680
even if they were lose their you know

1220
00:49:41,680 --> 00:49:43,520
the whatever credential that they had

1221
00:49:43,520 --> 00:49:45,280
you know stolen from somebody to break

1222
00:49:45,280 --> 00:49:47,359
into those sites and change those pages

1223
00:49:47,359 --> 00:49:49,119
they could just ask commands in the

1224
00:49:49,119 --> 00:49:51,119
context of wordpress

1225
00:49:51,119 --> 00:49:53,119
on that machine and make changes you

1226
00:49:53,119 --> 00:49:55,839
know in that way as well

1227
00:49:55,839 --> 00:49:58,960
right okay wow i uh that

1228
00:49:58,960 --> 00:50:01,359
you got to admire the the dedication

1229
00:50:01,359 --> 00:50:02,720
craft and the amount of effort that's

1230
00:50:02,720 --> 00:50:04,319
that they've put into this

1231
00:50:04,319 --> 00:50:07,200
i mean you know i i feel like they're

1232
00:50:07,200 --> 00:50:09,040
that that you have to admire

1233
00:50:09,040 --> 00:50:10,960
the amount of effort that went into this

1234
00:50:10,960 --> 00:50:12,400
and yet

1235
00:50:12,400 --> 00:50:14,720
with that much effort and that much

1236
00:50:14,720 --> 00:50:15,520
trouble

1237
00:50:15,520 --> 00:50:17,359
you know could they have not done

1238
00:50:17,359 --> 00:50:19,440
something that would be more beneficial

1239
00:50:19,440 --> 00:50:22,319
to humanity

1240
00:50:22,640 --> 00:50:25,359
cobalt strike on a you know targeted

1241
00:50:25,359 --> 00:50:26,400
person's machine

1242
00:50:26,400 --> 00:50:28,960
i mean right yeah so to to that extent

1243
00:50:28,960 --> 00:50:29,920
like

1244
00:50:29,920 --> 00:50:32,559
i i recognize that they spent a lot of

1245
00:50:32,559 --> 00:50:34,000
time contriving this

1246
00:50:34,000 --> 00:50:36,319
very difficult to reverse engineer

1247
00:50:36,319 --> 00:50:38,160
method of infection

1248
00:50:38,160 --> 00:50:39,839
and then the persistence method where

1249
00:50:39,839 --> 00:50:42,640
it's encoded in the registry

1250
00:50:42,640 --> 00:50:45,680
so that can you know conventional uh av

1251
00:50:45,680 --> 00:50:48,720
can't find it um but yeah just

1252
00:50:48,720 --> 00:50:51,359
it i blows my mind to think that

1253
00:50:51,359 --> 00:50:52,480
couldn't they have just done something

1254
00:50:52,480 --> 00:50:54,079
better with their lives if you're

1255
00:50:54,079 --> 00:50:55,760
capable of this you're capable of

1256
00:50:55,760 --> 00:50:57,520
actually making some really great money

1257
00:50:57,520 --> 00:50:59,040
you know doing something constructive

1258
00:50:59,040 --> 00:51:02,160
absolutely yeah um so the

1259
00:51:02,160 --> 00:51:05,359
uh the other thing that i was interested

1260
00:51:05,359 --> 00:51:07,599
in of course is you know

1261
00:51:07,599 --> 00:51:09,520
your your summary at the end like i had

1262
00:51:09,520 --> 00:51:10,880
all these questions like well you know

1263
00:51:10,880 --> 00:51:13,440
how can we you know other than you know

1264
00:51:13,440 --> 00:51:15,280
automated detection of the fingerprint

1265
00:51:15,280 --> 00:51:16,480
and this or they're like how could

1266
00:51:16,480 --> 00:51:18,880
a human being actually like understand

1267
00:51:18,880 --> 00:51:20,240
that this link was going to be bad and

1268
00:51:20,240 --> 00:51:21,760
so forth or a system

1269
00:51:21,760 --> 00:51:22,960
but all that you're i think you're

1270
00:51:22,960 --> 00:51:24,480
completely right that you know the it is

1271
00:51:24,480 --> 00:51:25,520
the the seo

1272
00:51:25,520 --> 00:51:27,520
problem it is the the search engine

1273
00:51:27,520 --> 00:51:28,720
problem um

1274
00:51:28,720 --> 00:51:32,240
so what though you know given how paulie

1275
00:51:32,240 --> 00:51:34,720
sort of the hiding that that they go

1276
00:51:34,720 --> 00:51:36,319
through here and the the you know the

1277
00:51:36,319 --> 00:51:37,599
the work that they do to

1278
00:51:37,599 --> 00:51:40,800
uh to avoid you know turning up

1279
00:51:40,800 --> 00:51:44,000
in uh you know a a bot or a scan

1280
00:51:44,000 --> 00:51:45,520
or these sorts of things like what would

1281
00:51:45,520 --> 00:51:47,839
you think uh you know

1282
00:51:47,839 --> 00:51:49,280
is the direction for trying to make that

1283
00:51:49,280 --> 00:51:51,599
happen like i mean i i certainly hope

1284
00:51:51,599 --> 00:51:53,680
that somebody who works at google is

1285
00:51:53,680 --> 00:51:56,319
is you know watching some of these talks

1286
00:51:56,319 --> 00:51:58,480
and that can you know

1287
00:51:58,480 --> 00:51:59,920
back to their you know to their

1288
00:51:59,920 --> 00:52:01,839
engineering team to say look here's

1289
00:52:01,839 --> 00:52:03,680
another here's another abuse method that

1290
00:52:03,680 --> 00:52:04,480
we had not

1291
00:52:04,480 --> 00:52:06,720
uh previously discovered or you know

1292
00:52:06,720 --> 00:52:07,760
noticed

1293
00:52:07,760 --> 00:52:10,800
um but yeah i mean all of those

1294
00:52:10,800 --> 00:52:12,960
with the exception of using a you know

1295
00:52:12,960 --> 00:52:14,559
an endpoint security product

1296
00:52:14,559 --> 00:52:16,880
that is observing behavior and it's you

1297
00:52:16,880 --> 00:52:18,559
know using behavior to sort of

1298
00:52:18,559 --> 00:52:21,440
uh manage these these very very

1299
00:52:21,440 --> 00:52:23,680
difficult to detect files

1300
00:52:23,680 --> 00:52:25,920
um there's almost nothing an end user

1301
00:52:25,920 --> 00:52:27,920
can do to protect themselves i mean

1302
00:52:27,920 --> 00:52:30,400
all of all of those suggestions that i

1303
00:52:30,400 --> 00:52:32,240
came up with on that uh second and last

1304
00:52:32,240 --> 00:52:33,040
slide

1305
00:52:33,040 --> 00:52:36,559
were were just you know a desperation

1306
00:52:36,559 --> 00:52:37,920
move because we're trying

1307
00:52:37,920 --> 00:52:41,280
is there anything that you can do

1308
00:52:41,280 --> 00:52:43,680
i particularly love the getting to be

1309
00:52:43,680 --> 00:52:45,359
able to recognize

1310
00:52:45,359 --> 00:52:48,480
the sights i mean that's by that by that

1311
00:52:48,480 --> 00:52:49,119
point

1312
00:52:49,119 --> 00:52:50,480
if you've been infected repeatedly

1313
00:52:50,480 --> 00:52:52,160
enough you'll you'll probably like

1314
00:52:52,160 --> 00:52:54,240
get a sense for it but i i certainly

1315
00:52:54,240 --> 00:52:55,760
hope that the whole world

1316
00:52:55,760 --> 00:52:57,839
watches this talk and learns that of

1317
00:52:57,839 --> 00:53:00,000
that little you know icon of the little

1318
00:53:00,000 --> 00:53:02,000
you know daisy and the icon of the

1319
00:53:02,000 --> 00:53:03,760
little you know the administrators icon

1320
00:53:03,760 --> 00:53:05,920
that looks like an hourglass like

1321
00:53:05,920 --> 00:53:08,720
those the thing is is that it's not

1322
00:53:08,720 --> 00:53:10,640
doing anything different and it's doing

1323
00:53:10,640 --> 00:53:12,000
the same thing in four different

1324
00:53:12,000 --> 00:53:12,960
languages

1325
00:53:12,960 --> 00:53:15,680
they always look exactly the same if we

1326
00:53:15,680 --> 00:53:16,400
can just get

1327
00:53:16,400 --> 00:53:18,480
word out that hey you see it's something

1328
00:53:18,480 --> 00:53:20,000
that looks like this

1329
00:53:20,000 --> 00:53:21,280
you know don't go there but then of

1330
00:53:21,280 --> 00:53:22,800
course as soon as that word gets out

1331
00:53:22,800 --> 00:53:23,760
widely enough

1332
00:53:23,760 --> 00:53:27,839
you're going to change it up so yeah

1333
00:53:27,839 --> 00:53:28,880
that's a losing battle

1334
00:53:28,880 --> 00:53:32,160
absolutely there's um

1335
00:53:32,160 --> 00:53:34,480
needs to be someone with a far broader

1336
00:53:34,480 --> 00:53:35,280
sample base

1337
00:53:35,280 --> 00:53:37,359
of of you know data to look at and to

1338
00:53:37,359 --> 00:53:39,119
see it as it evolves and

1339
00:53:39,119 --> 00:53:40,559
to incorporate that into their

1340
00:53:40,559 --> 00:53:42,160
detections and so forth so yeah you're

1341
00:53:42,160 --> 00:53:43,440
right it needs to be

1342
00:53:43,440 --> 00:53:44,800
something like a google and you know

1343
00:53:44,800 --> 00:53:46,480
fortunately i know a couple people there

1344
00:53:46,480 --> 00:53:49,680
so we could probably you know

1345
00:53:51,599 --> 00:53:55,200
but uh okay

1346
00:53:55,200 --> 00:53:57,280
all right cool all right sorry i didn't

1347
00:53:57,280 --> 00:53:59,040
hear the warning um all right well thank

1348
00:53:59,040 --> 00:54:00,240
you so much for your time

1349
00:54:00,240 --> 00:54:04,319
uh yeah and uh talk to you soon

1350
00:54:04,319 --> 00:54:08,558
be safe everyone

