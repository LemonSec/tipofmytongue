1
00:00:00,160 --> 00:00:02,000
good afternoon and welcome to b-sides

2
00:00:02,000 --> 00:00:04,160
las vegas lucky 13.

3
00:00:04,160 --> 00:00:06,799
you are in breaking ground

4
00:00:06,799 --> 00:00:09,360
this talk is titled cookie monster

5
00:00:09,360 --> 00:00:12,320
exfiltrating data and more bite by tasty

6
00:00:12,320 --> 00:00:13,519
bite

7
00:00:13,519 --> 00:00:16,239
i will be given by eric and mick

8
00:00:16,239 --> 00:00:18,240
whitehorn gillum

9
00:00:18,240 --> 00:00:19,600
just a few quick announcements before we

10
00:00:19,600 --> 00:00:21,039
start here

11
00:00:21,039 --> 00:00:22,320
i would like to thank our sponsors

12
00:00:22,320 --> 00:00:24,160
especially our diamond sponsors lastpass

13
00:00:24,160 --> 00:00:26,160
and palo alto networks and our gold

14
00:00:26,160 --> 00:00:29,279
sponsors intel google and bluecat

15
00:00:29,279 --> 00:00:30,880
it's their support along with our other

16
00:00:30,880 --> 00:00:32,719
sponsors donors and volunteers that make

17
00:00:32,719 --> 00:00:34,800
besides possible

18
00:00:34,800 --> 00:00:36,640
regarding cell phones these talks are

19
00:00:36,640 --> 00:00:38,640
being live streamed and as a courtesy to

20
00:00:38,640 --> 00:00:40,239
our speakers and audience we'd like

21
00:00:40,239 --> 00:00:41,920
everybody to silence your cell phone if

22
00:00:41,920 --> 00:00:44,239
you would thank you

23
00:00:44,239 --> 00:00:45,680
if you have a question

24
00:00:45,680 --> 00:00:47,360
use the audience microphone this is the

25
00:00:47,360 --> 00:00:49,120
one i'm holding

26
00:00:49,120 --> 00:00:50,879
so that youtube can hear what your

27
00:00:50,879 --> 00:00:54,079
question was we appreciate that

28
00:00:54,079 --> 00:00:56,239
uh as a reminder the besides photo

29
00:00:56,239 --> 00:00:58,079
policy prohibits taking pictures without

30
00:00:58,079 --> 00:00:59,760
the explicit permission of everyone in

31
00:00:59,760 --> 00:01:01,039
frame

32
00:01:01,039 --> 00:01:02,719
again these talks are being recorded so

33
00:01:02,719 --> 00:01:04,640
these will be available online youtube

34
00:01:04,640 --> 00:01:07,040
in the future

35
00:01:07,040 --> 00:01:08,560
last but not least we would like to

36
00:01:08,560 --> 00:01:10,640
please ask you to please keep your masks

37
00:01:10,640 --> 00:01:12,560
on at all times

38
00:01:12,560 --> 00:01:14,400
and with that let's get started please

39
00:01:14,400 --> 00:01:17,520
welcome eric and mick

40
00:01:18,799 --> 00:01:20,400
thank you

41
00:01:20,400 --> 00:01:22,000
i hope everybody's having a good time

42
00:01:22,000 --> 00:01:23,840
and is excited to be here is actually

43
00:01:23,840 --> 00:01:26,240
making ir to be here talking we've

44
00:01:26,240 --> 00:01:28,080
spoken at other b sides but never las

45
00:01:28,080 --> 00:01:30,479
vegas first time here so really excited

46
00:01:30,479 --> 00:01:32,000
about uh being able to present in front

47
00:01:32,000 --> 00:01:33,600
of all of you

48
00:01:33,600 --> 00:01:34,560
so

49
00:01:34,560 --> 00:01:36,880
as we said it's a cookie monster excel

50
00:01:36,880 --> 00:01:38,560
trading data and more the n more kind of

51
00:01:38,560 --> 00:01:40,560
got dropped off we'll talk about that

52
00:01:40,560 --> 00:01:42,079
towards the end yeah it kind of dropped

53
00:01:42,079 --> 00:01:43,119
off

54
00:01:43,119 --> 00:01:44,960
and this really has been here it's been

55
00:01:44,960 --> 00:01:47,280
like four years in the making we built

56
00:01:47,280 --> 00:01:48,479
this utility that we're going to talk

57
00:01:48,479 --> 00:01:52,079
about to serve a specific purpose

58
00:01:52,079 --> 00:01:53,920
and then over the years we thought maybe

59
00:01:53,920 --> 00:01:55,280
we should do more with it back and forth

60
00:01:55,280 --> 00:01:56,719
back and forth and finally decided that

61
00:01:56,719 --> 00:01:57,680
we wanted

62
00:01:57,680 --> 00:02:00,880
to make it publicly available to people

63
00:02:00,880 --> 00:02:03,280
but overall this tool while it serves a

64
00:02:03,280 --> 00:02:05,360
purpose it's really more about getting

65
00:02:05,360 --> 00:02:08,239
us thinking about our networks right as

66
00:02:08,239 --> 00:02:10,080
most of the conversations and talks have

67
00:02:10,080 --> 00:02:11,599
been here it's about knowing your

68
00:02:11,599 --> 00:02:13,200
network and visibility into your network

69
00:02:13,200 --> 00:02:15,520
and what's actually occurring and that's

70
00:02:15,520 --> 00:02:17,680
what this tool is here to help do

71
00:02:17,680 --> 00:02:19,120
before we start talking about it a

72
00:02:19,120 --> 00:02:20,400
little bit about us we both work for

73
00:02:20,400 --> 00:02:21,680
secure ideas

74
00:02:21,680 --> 00:02:23,599
it's a consulting company security

75
00:02:23,599 --> 00:02:25,040
consulting company based out of

76
00:02:25,040 --> 00:02:27,360
jacksonville florida our ceo kevin

77
00:02:27,360 --> 00:02:29,360
johnson former sands instructor started

78
00:02:29,360 --> 00:02:32,239
it back in 2010 it's our 12th year hard

79
00:02:32,239 --> 00:02:34,160
to believe we've been around that long

80
00:02:34,160 --> 00:02:36,239
but we do pen testing et cetera right so

81
00:02:36,239 --> 00:02:37,519
what we're talking about is something

82
00:02:37,519 --> 00:02:40,080
that we've tested it's not just us

83
00:02:40,080 --> 00:02:41,280
coming up with a theory it's something

84
00:02:41,280 --> 00:02:43,840
we actually tried my name is eric keane

85
00:02:43,840 --> 00:02:45,920
i'm a principal security consultant

86
00:02:45,920 --> 00:02:47,840
uh before i started working for secure

87
00:02:47,840 --> 00:02:50,080
ideas five years ago i was responsible

88
00:02:50,080 --> 00:02:51,599
for very large active directory

89
00:02:51,599 --> 00:02:54,720
infrastructures at fortune 50 companies

90
00:02:54,720 --> 00:02:56,640
uh like windows environments i know that

91
00:02:56,640 --> 00:02:58,080
probably gets me booed off stage when i

92
00:02:58,080 --> 00:02:59,680
say i actually kind of like windows but

93
00:02:59,680 --> 00:03:01,040
i do

94
00:03:01,040 --> 00:03:03,760
and when i'm not working i'm a movie

95
00:03:03,760 --> 00:03:05,599
enthusiast i love movies i was actually

96
00:03:05,599 --> 00:03:08,159
a film major acting minor i love

97
00:03:08,159 --> 00:03:09,519
watching movies now that my kids are

98
00:03:09,519 --> 00:03:11,040
older we're getting to watch all of the

99
00:03:11,040 --> 00:03:13,840
really good movies uh it's not just you

100
00:03:13,840 --> 00:03:16,159
know disney movies which are nice but i

101
00:03:16,159 --> 00:03:18,800
like what action films too

102
00:03:18,800 --> 00:03:21,840
uh so i'm mick whitehorn gillam uh i'm

103
00:03:21,840 --> 00:03:23,680
from canada but i'm i don't live there

104
00:03:23,680 --> 00:03:25,360
now uh

105
00:03:25,360 --> 00:03:27,599
you probably tell that

106
00:03:27,599 --> 00:03:29,840
uh i write code i've been doing it for a

107
00:03:29,840 --> 00:03:32,560
really long time uh

108
00:03:32,560 --> 00:03:36,159
started when i was six basically

109
00:03:36,159 --> 00:03:37,840
on the command line migrated to batch

110
00:03:37,840 --> 00:03:39,360
files within a couple of years and then

111
00:03:39,360 --> 00:03:40,480
actual

112
00:03:40,480 --> 00:03:42,000
real programming languages not long

113
00:03:42,000 --> 00:03:44,480
after that and if you can't guess my age

114
00:03:44,480 --> 00:03:47,120
that makes me old um

115
00:03:47,120 --> 00:03:50,319
so yeah uh i used to run long distances

116
00:03:50,319 --> 00:03:51,920
so as i do on the slide but it's been a

117
00:03:51,920 --> 00:03:52,720
while

118
00:03:52,720 --> 00:03:55,200
uh covid unfortunately i used to lift

119
00:03:55,200 --> 00:03:58,480
weights and then covet yeah so yeah it's

120
00:03:58,480 --> 00:04:01,680
harder now i'm heavier now um

121
00:04:01,680 --> 00:04:04,879
because you know that happens too

122
00:04:04,879 --> 00:04:06,480
so we're here to talk about data

123
00:04:06,480 --> 00:04:08,080
exfiltration

124
00:04:08,080 --> 00:04:10,080
and i'll admit for us when we're doing

125
00:04:10,080 --> 00:04:11,920
our pen tests this is usually not

126
00:04:11,920 --> 00:04:14,319
something that's on our radar at all

127
00:04:14,319 --> 00:04:15,120
right

128
00:04:15,120 --> 00:04:17,519
unless you're a very very mature

129
00:04:17,519 --> 00:04:19,680
organization and you have some controls

130
00:04:19,680 --> 00:04:21,440
really probably all i'm going to have to

131
00:04:21,440 --> 00:04:23,280
do is just browse out to an s3 bucket

132
00:04:23,280 --> 00:04:24,720
and i can take whatever i want off your

133
00:04:24,720 --> 00:04:27,040
network right that's not true for

134
00:04:27,040 --> 00:04:28,400
everybody

135
00:04:28,400 --> 00:04:30,160
and and you know there's all these

136
00:04:30,160 --> 00:04:32,000
wonderful options you know sure you can

137
00:04:32,000 --> 00:04:33,680
use command and control channels you can

138
00:04:33,680 --> 00:04:36,960
use network protocols ftp https

139
00:04:36,960 --> 00:04:39,280
uh cloud services like i said one of our

140
00:04:39,280 --> 00:04:41,840
favorites uh code repos then there's all

141
00:04:41,840 --> 00:04:42,960
those physical yeah i need to move a

142
00:04:42,960 --> 00:04:44,160
little further away from you evidently

143
00:04:44,160 --> 00:04:45,440
we'll get an echo

144
00:04:45,440 --> 00:04:47,280
physical things that you read about that

145
00:04:47,280 --> 00:04:48,960
sound so awesome

146
00:04:48,960 --> 00:04:51,199
but i don't think i've ever had to do or

147
00:04:51,199 --> 00:04:53,120
probably never will but you know using

148
00:04:53,120 --> 00:04:54,800
lights on a device

149
00:04:54,800 --> 00:04:56,479
and doing morse code or something

150
00:04:56,479 --> 00:04:59,360
strange or fan speeds or cable harmonics

151
00:04:59,360 --> 00:05:02,000
all this stuff but like i said that's

152
00:05:02,000 --> 00:05:04,720
really really high tech and not often

153
00:05:04,720 --> 00:05:06,320
what's needed and i mean i love my

154
00:05:06,320 --> 00:05:08,080
picture there of the the monitor on the

155
00:05:08,080 --> 00:05:09,759
copier right for that physical access in

156
00:05:09,759 --> 00:05:10,800
case

157
00:05:10,800 --> 00:05:12,560
that's all we have is the ability to

158
00:05:12,560 --> 00:05:14,960
print something

159
00:05:14,960 --> 00:05:16,800
and when we're talking about trying to

160
00:05:16,800 --> 00:05:18,560
get data off of a network there's all

161
00:05:18,560 --> 00:05:20,560
these controls that organizations are

162
00:05:20,560 --> 00:05:22,080
putting in place

163
00:05:22,080 --> 00:05:24,320
there's a considerable amount of time

164
00:05:24,320 --> 00:05:27,440
effort money etc all they're trying to

165
00:05:27,440 --> 00:05:28,560
prevent

166
00:05:28,560 --> 00:05:30,639
what we had to do

167
00:05:30,639 --> 00:05:32,800
you know our small list you can limit

168
00:05:32,800 --> 00:05:35,039
the open ports which most orgs are doing

169
00:05:35,039 --> 00:05:38,080
yep only http https although you'll

170
00:05:38,080 --> 00:05:40,400
still find even large orbs that somehow

171
00:05:40,400 --> 00:05:43,199
forgot about some random port that

172
00:05:43,199 --> 00:05:44,960
suddenly you can get access out there

173
00:05:44,960 --> 00:05:48,479
that's not covered by a firewall or a a

174
00:05:48,479 --> 00:05:51,759
proxy smb oh let's not yet please no

175
00:05:51,759 --> 00:05:53,840
although it does happen smb although

176
00:05:53,840 --> 00:05:56,720
i've seen smb in that's even worse let's

177
00:05:56,720 --> 00:05:58,880
move past uh then we have next-gen

178
00:05:58,880 --> 00:06:00,720
firewalls right seeing what's going on

179
00:06:00,720 --> 00:06:02,960
doing that deep packet inspection all

180
00:06:02,960 --> 00:06:04,840
those intrusion detection and prevention

181
00:06:04,840 --> 00:06:07,280
systems the inspection proxies that are

182
00:06:07,280 --> 00:06:09,520
ripping apart everything that we tried

183
00:06:09,520 --> 00:06:11,759
to hide over that tls encryption right

184
00:06:11,759 --> 00:06:13,600
let's break that apart then you have

185
00:06:13,600 --> 00:06:15,360
your dlp software making sure people

186
00:06:15,360 --> 00:06:17,120
aren't opening files that they're not

187
00:06:17,120 --> 00:06:19,199
supposed to with credit card information

188
00:06:19,199 --> 00:06:20,639
or whatever it might be

189
00:06:20,639 --> 00:06:22,560
then your drive encryption so that

190
00:06:22,560 --> 00:06:24,000
people just can't walk off with your

191
00:06:24,000 --> 00:06:25,680
laptop hopefully

192
00:06:25,680 --> 00:06:27,680
uh and then you know of course we have

193
00:06:27,680 --> 00:06:29,199
netflow and other things that are

194
00:06:29,199 --> 00:06:30,240
showing

195
00:06:30,240 --> 00:06:32,000
what devices are actually talking to and

196
00:06:32,000 --> 00:06:34,479
where right all of these things that

197
00:06:34,479 --> 00:06:35,840
somebody is going to have to try and

198
00:06:35,840 --> 00:06:36,720
defeat

199
00:06:36,720 --> 00:06:38,240
of course once again

200
00:06:38,240 --> 00:06:39,759
if you don't have

201
00:06:39,759 --> 00:06:41,840
all of these things

202
00:06:41,840 --> 00:06:43,440
maybe having somebody trying to actually

203
00:06:43,440 --> 00:06:45,520
trade data should not be one of your top

204
00:06:45,520 --> 00:06:47,280
priorities

205
00:06:47,280 --> 00:06:48,479
but that's what we were trying to solve

206
00:06:48,479 --> 00:06:50,160
way back in 2018 hard to believe it's

207
00:06:50,160 --> 00:06:52,080
been four years

208
00:06:52,080 --> 00:06:53,680
we were actually doing a red team

209
00:06:53,680 --> 00:06:55,120
assignment different from what we

210
00:06:55,120 --> 00:06:56,720
typically do we're pen testers but we do

211
00:06:56,720 --> 00:06:58,800
red team as well right pen testing if

212
00:06:58,800 --> 00:07:00,000
you're not familiar the difference red

213
00:07:00,000 --> 00:07:02,160
team and pen testing pen testing is down

214
00:07:02,160 --> 00:07:04,319
and dirty we have like this much time to

215
00:07:04,319 --> 00:07:06,319
get wherever you want us to get to red

216
00:07:06,319 --> 00:07:07,759
teaming we're going to try and be really

217
00:07:07,759 --> 00:07:09,039
stealthy

218
00:07:09,039 --> 00:07:11,759
we've been on the network for a while

219
00:07:11,759 --> 00:07:13,120
and our problems really came down to

220
00:07:13,120 --> 00:07:15,520
that last bullet point the blue team was

221
00:07:15,520 --> 00:07:17,440
really responsive you messed up at all

222
00:07:17,440 --> 00:07:18,319
once

223
00:07:18,319 --> 00:07:20,240
and they were on you we made a small

224
00:07:20,240 --> 00:07:22,880
mistake on one device trying to test a

225
00:07:22,880 --> 00:07:24,240
website to see if we could get a

226
00:07:24,240 --> 00:07:25,840
phishing campaign to work

227
00:07:25,840 --> 00:07:28,319
they caught it that domain was burned

228
00:07:28,319 --> 00:07:29,840
i'm sorry if i'm echoing i don't know

229
00:07:29,840 --> 00:07:32,000
what i did wrong

230
00:07:32,000 --> 00:07:33,120
but

231
00:07:33,120 --> 00:07:35,599
our client wanted us to exfoliate data

232
00:07:35,599 --> 00:07:38,240
right they had these controls they only

233
00:07:38,240 --> 00:07:41,199
allowed https out not over not even http

234
00:07:41,199 --> 00:07:42,720
they proxied everything they were

235
00:07:42,720 --> 00:07:44,319
ripping everything apart they were

236
00:07:44,319 --> 00:07:45,919
inspecting it

237
00:07:45,919 --> 00:07:48,879
they limited where we could go right we

238
00:07:48,879 --> 00:07:51,120
had very limited domain options

239
00:07:51,120 --> 00:07:54,560
um content filtering dlp software that

240
00:07:54,560 --> 00:07:56,240
everything

241
00:07:56,240 --> 00:07:57,520
we knew that they were ripping the

242
00:07:57,520 --> 00:07:59,280
traffic apart but we couldn't tell what

243
00:07:59,280 --> 00:08:00,560
they were using

244
00:08:00,560 --> 00:08:02,800
right and they wanted us to get this

245
00:08:02,800 --> 00:08:04,639
file that they gave us that was full of

246
00:08:04,639 --> 00:08:06,560
credit cards and other sensitive

247
00:08:06,560 --> 00:08:07,840
information and see if we could get it

248
00:08:07,840 --> 00:08:08,879
somewhere

249
00:08:08,879 --> 00:08:10,960
we didn't want to try that the good old

250
00:08:10,960 --> 00:08:13,440
s3 bucket they weren't using the cloud

251
00:08:13,440 --> 00:08:15,840
it was 2018 this institution hadn't

252
00:08:15,840 --> 00:08:17,919
moved there yet and we knew we had one

253
00:08:17,919 --> 00:08:19,759
shot

254
00:08:19,759 --> 00:08:21,440
so mick myself and another gentleman

255
00:08:21,440 --> 00:08:22,879
we're sitting around we're discussing

256
00:08:22,879 --> 00:08:24,879
we're like what are we gonna do

257
00:08:24,879 --> 00:08:27,919
that might mask this and let us get some

258
00:08:27,919 --> 00:08:29,520
data off of this network we need

259
00:08:29,520 --> 00:08:31,199
something that's quick we didn't have a

260
00:08:31,199 --> 00:08:32,320
lot of time we're getting towards the

261
00:08:32,320 --> 00:08:33,760
end of the engagement

262
00:08:33,760 --> 00:08:35,519
and we need something that's low-tech

263
00:08:35,519 --> 00:08:37,760
right we don't want to invest the time

264
00:08:37,760 --> 00:08:39,519
and effort to try and get one of their

265
00:08:39,519 --> 00:08:41,679
devices to do some strange harmonics on

266
00:08:41,679 --> 00:08:43,440
a cable or something

267
00:08:43,440 --> 00:08:44,240
so

268
00:08:44,240 --> 00:08:46,160
we actually said

269
00:08:46,160 --> 00:08:49,200
what's normal in web traffic that's

270
00:08:49,200 --> 00:08:50,880
there that probably isn't going to be

271
00:08:50,880 --> 00:08:52,720
looked at by anything

272
00:08:52,720 --> 00:08:56,240
and that brought us to cookies

273
00:08:56,320 --> 00:08:58,320
right so uh

274
00:08:58,320 --> 00:09:00,160
just to do a quick overview because

275
00:09:00,160 --> 00:09:01,200
people are at different levels with

276
00:09:01,200 --> 00:09:03,440
cookies most people probably if you deal

277
00:09:03,440 --> 00:09:06,000
with http traffic on a regular basis

278
00:09:06,000 --> 00:09:08,399
this is going to be why is that guy

279
00:09:08,399 --> 00:09:10,320
explaining cookies

280
00:09:10,320 --> 00:09:11,920
but for

281
00:09:11,920 --> 00:09:13,200
the people in the audience that might

282
00:09:13,200 --> 00:09:15,760
not uh so

283
00:09:15,760 --> 00:09:17,519
example there that's a request there's a

284
00:09:17,519 --> 00:09:19,040
cookie in it that's

285
00:09:19,040 --> 00:09:21,519
being sent to the server

286
00:09:21,519 --> 00:09:24,160
in normal traffic

287
00:09:24,160 --> 00:09:26,880
uh that would be set one of two ways uh

288
00:09:26,880 --> 00:09:28,800
would be common so either

289
00:09:28,800 --> 00:09:30,320
a response header would have come back

290
00:09:30,320 --> 00:09:31,920
that said set cookie and provided the

291
00:09:31,920 --> 00:09:34,000
value

292
00:09:34,000 --> 00:09:35,200
or

293
00:09:35,200 --> 00:09:36,880
a response of some other kind like a

294
00:09:36,880 --> 00:09:39,600
json response uh would be a common one

295
00:09:39,600 --> 00:09:41,440
sent the value back and then javascript

296
00:09:41,440 --> 00:09:43,519
on the page picked it up and

297
00:09:43,519 --> 00:09:45,920
shoved it in through the browser's api

298
00:09:45,920 --> 00:09:48,080
uh those be the two ways they normally

299
00:09:48,080 --> 00:09:49,440
would get set

300
00:09:49,440 --> 00:09:50,480
um

301
00:09:50,480 --> 00:09:52,880
and then when the requests go

302
00:09:52,880 --> 00:09:55,040
to the server whatever the scope is for

303
00:09:55,040 --> 00:09:57,440
the cookie uh those cookies get included

304
00:09:57,440 --> 00:09:58,720
in a header just like in the picture

305
00:09:58,720 --> 00:09:59,920
there

306
00:09:59,920 --> 00:10:01,760
and the important part is as you see

307
00:10:01,760 --> 00:10:04,560
from our website secure ideas right it's

308
00:10:04,560 --> 00:10:06,320
pretty much unintelligible right there

309
00:10:06,320 --> 00:10:07,760
there's nothing there to give you any

310
00:10:07,760 --> 00:10:09,600
indication of what it is

311
00:10:09,600 --> 00:10:11,680
and if that's what a system is looking

312
00:10:11,680 --> 00:10:14,079
at to determine if this is normal

313
00:10:14,079 --> 00:10:15,680
behavior or not

314
00:10:15,680 --> 00:10:17,440
i we were pretty sure we could do

315
00:10:17,440 --> 00:10:18,880
something that would look kind of like

316
00:10:18,880 --> 00:10:19,920
that

317
00:10:19,920 --> 00:10:21,920
and bypass all of those wonderful

318
00:10:21,920 --> 00:10:22,959
controls

319
00:10:22,959 --> 00:10:25,200
which brought us to cookie monster so

320
00:10:25,200 --> 00:10:27,360
cookies have a max size

321
00:10:27,360 --> 00:10:28,880
right you can't just send that that

322
00:10:28,880 --> 00:10:31,040
whole file all at once it's gonna be way

323
00:10:31,040 --> 00:10:33,519
way too big so we said let's you know

324
00:10:33,519 --> 00:10:34,959
come up with this idea let's encode the

325
00:10:34,959 --> 00:10:38,160
data take that file just encode it

326
00:10:38,160 --> 00:10:39,600
read everything read the contents and

327
00:10:39,600 --> 00:10:41,040
code the contents break it apart into

328
00:10:41,040 --> 00:10:42,640
nice sized chunks

329
00:10:42,640 --> 00:10:44,399
send all of those out and request as

330
00:10:44,399 --> 00:10:46,160
cookies merge it all back together on

331
00:10:46,160 --> 00:10:48,480
the back end bam we have a file right

332
00:10:48,480 --> 00:10:50,160
and of course we needed a mascot as soon

333
00:10:50,160 --> 00:10:51,440
as you build a utility if you don't have

334
00:10:51,440 --> 00:10:53,600
a mascot it's not a utility right

335
00:10:53,600 --> 00:10:55,360
okay so

336
00:10:55,360 --> 00:10:57,440
cookie monster v1

337
00:10:57,440 --> 00:11:00,720
back in 2018 built on node we had a web

338
00:11:00,720 --> 00:11:02,160
server in our case it was apache because

339
00:11:02,160 --> 00:11:04,240
we wanted to have that tls encryption

340
00:11:04,240 --> 00:11:05,920
just because we didn't want to send

341
00:11:05,920 --> 00:11:08,240
anything over http and it wouldn't have

342
00:11:08,240 --> 00:11:10,240
worked anyways through the proxy so we

343
00:11:10,240 --> 00:11:11,440
had the cert

344
00:11:11,440 --> 00:11:13,760
and then we had the feeder the one lim

345
00:11:13,760 --> 00:11:15,360
the one thing that we found on the

346
00:11:15,360 --> 00:11:16,959
network which was very nice for us it

347
00:11:16,959 --> 00:11:18,399
was 2018

348
00:11:18,399 --> 00:11:20,240
so powershell was still a very good

349
00:11:20,240 --> 00:11:22,399
attack vector back then right not quite

350
00:11:22,399 --> 00:11:23,519
as good now

351
00:11:23,519 --> 00:11:24,800
we can have discussions about that i

352
00:11:24,800 --> 00:11:26,079
think it's still a good attack vector

353
00:11:26,079 --> 00:11:28,720
but uh powershell was enabled we could

354
00:11:28,720 --> 00:11:31,920
use it so we built the feeder the script

355
00:11:31,920 --> 00:11:34,959
around invoke web we create web request

356
00:11:34,959 --> 00:11:37,360
this is sending just like it sounds a

357
00:11:37,360 --> 00:11:39,920
request as if it was like a browser to a

358
00:11:39,920 --> 00:11:41,440
website

359
00:11:41,440 --> 00:11:44,000
so we encoded the file on memory

360
00:11:44,000 --> 00:11:45,680
all right took up a little bit of space

361
00:11:45,680 --> 00:11:47,920
we used that normal commandlet to bypass

362
00:11:47,920 --> 00:11:49,839
them if they were looking for something

363
00:11:49,839 --> 00:11:52,240
using a.net library because that is a

364
00:11:52,240 --> 00:11:54,000
little odd in most cases

365
00:11:54,000 --> 00:11:55,760
we made sure to set the user agent on

366
00:11:55,760 --> 00:11:57,920
the on the request so it didn't say

367
00:11:57,920 --> 00:11:59,680
powershell right that would be kind of

368
00:11:59,680 --> 00:12:00,720
obvious

369
00:12:00,720 --> 00:12:03,519
uh and then we also said let's allow it

370
00:12:03,519 --> 00:12:05,360
to send a whole bunch of files not just

371
00:12:05,360 --> 00:12:07,279
one and then put that random sleep in

372
00:12:07,279 --> 00:12:08,880
there so it's not just

373
00:12:08,880 --> 00:12:10,240
you know sending requests over request

374
00:12:10,240 --> 00:12:12,160
of a request let it take some time

375
00:12:12,160 --> 00:12:14,320
somewhere between oh like half a second

376
00:12:14,320 --> 00:12:16,639
and a minute whatever you want to make

377
00:12:16,639 --> 00:12:19,200
it look a little odd and not sit there

378
00:12:19,200 --> 00:12:22,320
and be a consistent state

379
00:12:22,320 --> 00:12:23,680
it was simple

380
00:12:23,680 --> 00:12:25,279
but effective

381
00:12:25,279 --> 00:12:27,360
and you know you look at that

382
00:12:27,360 --> 00:12:28,880
and it looks very different from our

383
00:12:28,880 --> 00:12:31,200
cookie and i'm kind of embarrassed to

384
00:12:31,200 --> 00:12:32,399
say that this is what we came up with

385
00:12:32,399 --> 00:12:34,160
but we were running out of time

386
00:12:34,160 --> 00:12:36,160
and the funny thing is it worked

387
00:12:36,160 --> 00:12:38,880
right this bypassed their content filter

388
00:12:38,880 --> 00:12:41,360
their inspection proxy everything to us

389
00:12:41,360 --> 00:12:43,200
any person looking at it who has any

390
00:12:43,200 --> 00:12:45,519
idea what a cookie looks like this looks

391
00:12:45,519 --> 00:12:47,519
pretty odd right we've got double

392
00:12:47,519 --> 00:12:49,680
slashes in the front and that was

393
00:12:49,680 --> 00:12:51,200
because we were encoding certain things

394
00:12:51,200 --> 00:12:52,959
we didn't want it to be able to see it

395
00:12:52,959 --> 00:12:55,519
that's not normal we have some random

396
00:12:55,519 --> 00:12:56,959
integers in there that we're telling

397
00:12:56,959 --> 00:12:58,800
cookie monster the back end hey this is

398
00:12:58,800 --> 00:13:00,800
part one of x

399
00:13:00,800 --> 00:13:03,040
so that incremented and then we had our

400
00:13:03,040 --> 00:13:05,519
payload which is the first that was part

401
00:13:05,519 --> 00:13:07,519
one of the file

402
00:13:07,519 --> 00:13:08,959
and then we had some other bad things in

403
00:13:08,959 --> 00:13:11,120
there right the web server did things

404
00:13:11,120 --> 00:13:13,920
like said okay whatever but overall

405
00:13:13,920 --> 00:13:16,000
it worked um

406
00:13:16,000 --> 00:13:18,560
if somebody would have seen this while

407
00:13:18,560 --> 00:13:21,279
we were going through the 45 minutes or

408
00:13:21,279 --> 00:13:22,959
so was sending the data

409
00:13:22,959 --> 00:13:24,720
um you know they would have instantly

410
00:13:24,720 --> 00:13:26,320
known it was wrong right if they would

411
00:13:26,320 --> 00:13:27,680
have gone to that website that we had

412
00:13:27,680 --> 00:13:29,600
picked when we got that domain name it

413
00:13:29,600 --> 00:13:31,200
would have aired because of nav cookies

414
00:13:31,200 --> 00:13:35,680
it was down and dirty but it worked

415
00:13:35,680 --> 00:13:37,519
it's not good enough we know it's not

416
00:13:37,519 --> 00:13:39,440
good enough right that that was like gen

417
00:13:39,440 --> 00:13:40,399
one

418
00:13:40,399 --> 00:13:42,160
let's let's do a proof of concept we

419
00:13:42,160 --> 00:13:44,399
needed to be better we need to be hiding

420
00:13:44,399 --> 00:13:46,560
in plain sight better than we were this

421
00:13:46,560 --> 00:13:48,720
is a picture of a snake do you see the

422
00:13:48,720 --> 00:13:50,320
snake

423
00:13:50,320 --> 00:13:51,120
no

424
00:13:51,120 --> 00:13:53,279
she's right there do you see him it's a

425
00:13:53,279 --> 00:13:55,279
copperhead

426
00:13:55,279 --> 00:13:56,720
okay can you see him now that's the no

427
00:13:56,720 --> 00:13:58,399
broke that's the bad end of the no rope

428
00:13:58,399 --> 00:13:59,839
you don't want to get bit by it would be

429
00:13:59,839 --> 00:14:02,720
really really bad okay this is one that

430
00:14:02,720 --> 00:14:04,480
mick saw when he was running when he was

431
00:14:04,480 --> 00:14:07,199
running that's not true yeah this this

432
00:14:07,199 --> 00:14:08,720
is what we needed to be we needed to be

433
00:14:08,720 --> 00:14:11,120
like this guy

434
00:14:11,120 --> 00:14:14,480
so we came up with version two

435
00:14:14,480 --> 00:14:15,839
we said all right let's let's take a

436
00:14:15,839 --> 00:14:17,680
step back we want to stick with our same

437
00:14:17,680 --> 00:14:18,720
premise

438
00:14:18,720 --> 00:14:20,800
but things have gotten better right

439
00:14:20,800 --> 00:14:23,199
we're sure detections have gotten better

440
00:14:23,199 --> 00:14:25,360
so let's set up some other stuff for us

441
00:14:25,360 --> 00:14:27,519
number one let's set up a unique id

442
00:14:27,519 --> 00:14:29,760
for for our device because before

443
00:14:29,760 --> 00:14:31,760
it would accept like if we had four

444
00:14:31,760 --> 00:14:33,199
computers all sending files at the same

445
00:14:33,199 --> 00:14:34,639
time it was going to get confused really

446
00:14:34,639 --> 00:14:37,040
fast so let's add a unique id

447
00:14:37,040 --> 00:14:38,480
let's do some better padding let's get

448
00:14:38,480 --> 00:14:40,720
rid of that slash in the front right

449
00:14:40,720 --> 00:14:42,880
let's do something a little bit better

450
00:14:42,880 --> 00:14:45,600
do some graceful handling in case the

451
00:14:45,600 --> 00:14:48,320
server goes offline or something strange

452
00:14:48,320 --> 00:14:50,959
so that we can do some retries because

453
00:14:50,959 --> 00:14:53,040
when you encode the contents of a file

454
00:14:53,040 --> 00:14:54,800
and you miss a section you pretty much

455
00:14:54,800 --> 00:14:56,480
lost everything

456
00:14:56,480 --> 00:14:59,680
we mick made a beautiful ui all right a

457
00:14:59,680 --> 00:15:01,120
functional ui

458
00:15:01,120 --> 00:15:02,160
uh and a whole bunch of other

459
00:15:02,160 --> 00:15:03,120
enhancements and then we put it on

460
00:15:03,120 --> 00:15:04,399
github because

461
00:15:04,399 --> 00:15:06,480
well once again

462
00:15:06,480 --> 00:15:09,040
we think this is gonna work i admit we

463
00:15:09,040 --> 00:15:10,480
don't know if this version is gonna work

464
00:15:10,480 --> 00:15:12,639
so when we get to the question

465
00:15:12,639 --> 00:15:13,920
time and you say is that going to work

466
00:15:13,920 --> 00:15:15,040
we're going to say

467
00:15:15,040 --> 00:15:16,959
maybe we have no reason to believe it

468
00:15:16,959 --> 00:15:19,680
won't but we admit as of right now no

469
00:15:19,680 --> 00:15:21,199
one has paid us to try and exfiltrate

470
00:15:21,199 --> 00:15:23,040
data out of their network if you're

471
00:15:23,040 --> 00:15:25,199
interested in helping us test this

472
00:15:25,199 --> 00:15:26,959
please let us know reach out right we'll

473
00:15:26,959 --> 00:15:28,480
be happy to do it

474
00:15:28,480 --> 00:15:29,920
or if you test it yourself let us know

475
00:15:29,920 --> 00:15:31,600
or test it yourself let us know we want

476
00:15:31,600 --> 00:15:34,240
to know so the server enhancements all

477
00:15:34,240 --> 00:15:37,040
on mick oh that that's right that's me

478
00:15:37,040 --> 00:15:38,839
that's you uh so

479
00:15:38,839 --> 00:15:41,759
uh i rewrote it like pretty much the

480
00:15:41,759 --> 00:15:44,399
whole thing uh updated it to

481
00:15:44,399 --> 00:15:46,480
node 18 is what i was using but it would

482
00:15:46,480 --> 00:15:50,639
probably work on 14 or higher uh

483
00:15:50,720 --> 00:15:52,399
i did stuff i

484
00:15:52,399 --> 00:15:55,199
so user interface uh is there

485
00:15:55,199 --> 00:15:57,279
still doesn't have built-in tls but we

486
00:15:57,279 --> 00:15:58,639
do that through a reverse proxy

487
00:15:58,639 --> 00:16:00,399
definitely if you're using it for real

488
00:16:00,399 --> 00:16:01,360
data

489
00:16:01,360 --> 00:16:03,759
even in you know a testing environment

490
00:16:03,759 --> 00:16:07,519
be nice and tls encrypt the data

491
00:16:07,680 --> 00:16:09,519
keeps a lot of stuff in memory at this

492
00:16:09,519 --> 00:16:10,959
point in time

493
00:16:10,959 --> 00:16:11,360
uh

494
00:16:11,360 --> 00:16:12,480
[Music]

495
00:16:12,480 --> 00:16:14,160
when when eric wrote that bullet point

496
00:16:14,160 --> 00:16:15,600
that's because that's that's what i told

497
00:16:15,600 --> 00:16:17,360
him but it's not actually entirely true

498
00:16:17,360 --> 00:16:18,880
anymore oh i need to change it all right

499
00:16:18,880 --> 00:16:20,240
um

500
00:16:20,240 --> 00:16:22,160
it does write a temp file at one point

501
00:16:22,160 --> 00:16:24,160
uh but yeah so it still reassembles

502
00:16:24,160 --> 00:16:25,199
still

503
00:16:25,199 --> 00:16:28,160
decodes and it can send well i can send

504
00:16:28,160 --> 00:16:30,560
one command actually i've

505
00:16:30,560 --> 00:16:31,680
it can send

506
00:16:31,680 --> 00:16:34,000
am i premature on this it will

507
00:16:34,000 --> 00:16:35,920
go ahead it can send one one command to

508
00:16:35,920 --> 00:16:37,120
the server

509
00:16:37,120 --> 00:16:38,480
it's kind of hard coded in there it's

510
00:16:38,480 --> 00:16:40,160
who am i so you can send who mi's up to

511
00:16:40,160 --> 00:16:42,720
the server yeah um we didn't really want

512
00:16:42,720 --> 00:16:44,720
to push out a full c2

513
00:16:44,720 --> 00:16:46,079
framework because

514
00:16:46,079 --> 00:16:48,639
you know ethical concerns and all that

515
00:16:48,639 --> 00:16:50,560
so we did it that way because that way

516
00:16:50,560 --> 00:16:51,839
if anyone uses it they'll probably get

517
00:16:51,839 --> 00:16:53,360
detected

518
00:16:53,360 --> 00:16:55,040
that's right hopefully because everybody

519
00:16:55,040 --> 00:16:57,040
knows who mi is the immediate notice

520
00:16:57,040 --> 00:16:58,320
that you've been compromised right who

521
00:16:58,320 --> 00:16:59,920
am i equals you're in trouble the only

522
00:16:59,920 --> 00:17:02,000
people that don't know who they are

523
00:17:02,000 --> 00:17:04,640
people that don't belong there

524
00:17:04,640 --> 00:17:07,919
so the feeder still using powershell i

525
00:17:07,919 --> 00:17:09,919
like powershell right windows guy i like

526
00:17:09,919 --> 00:17:12,400
powershell i know it's protected right

527
00:17:12,400 --> 00:17:14,160
you can do all sorts of things to see

528
00:17:14,160 --> 00:17:15,760
what's happening if you've turned on the

529
00:17:15,760 --> 00:17:18,799
logging and everything else

530
00:17:18,799 --> 00:17:20,720
many organizations still haven't

531
00:17:20,720 --> 00:17:22,480
it's a little bit more customizable you

532
00:17:22,480 --> 00:17:24,559
can set any user agent you want it has a

533
00:17:24,559 --> 00:17:27,359
default that looks like a windows 11 box

534
00:17:27,359 --> 00:17:28,559
you can set it to go through your own

535
00:17:28,559 --> 00:17:31,039
proxy you can reconfigure the cookie

536
00:17:31,039 --> 00:17:33,760
size to be anywhere from

537
00:17:33,760 --> 00:17:34,960
well pretty much anywhere but you don't

538
00:17:34,960 --> 00:17:38,320
want to go over 40 4 000 bytes

539
00:17:38,320 --> 00:17:40,720
i think is that the limit uh

540
00:17:40,720 --> 00:17:42,480
and and now it adds some other things in

541
00:17:42,480 --> 00:17:43,919
there right it goes to a random page

542
00:17:43,919 --> 00:17:46,000
itself it kind of picks some random page

543
00:17:46,000 --> 00:17:47,760
to 72

544
00:17:47,760 --> 00:17:50,240
and it has that heartbeat option and yes

545
00:17:50,240 --> 00:17:51,919
we did

546
00:17:51,919 --> 00:17:53,679
originally have the idea that we wanted

547
00:17:53,679 --> 00:17:56,080
to to accept commands and do functions

548
00:17:56,080 --> 00:17:58,160
based upon commands but

549
00:17:58,160 --> 00:18:00,080
that was a little bit more we like the

550
00:18:00,080 --> 00:18:01,679
idea of this being a way of testing your

551
00:18:01,679 --> 00:18:03,520
ex filtration controls right now more

552
00:18:03,520 --> 00:18:05,280
than a command framework

553
00:18:05,280 --> 00:18:07,919
it probably could be expanded out

554
00:18:07,919 --> 00:18:09,760
but uh we'll let that up to you if you

555
00:18:09,760 --> 00:18:11,440
want to do it

556
00:18:11,440 --> 00:18:14,960
so now everybody needs to like with me

557
00:18:14,960 --> 00:18:17,919
hope please work that the demo is going

558
00:18:17,919 --> 00:18:19,520
to function because

559
00:18:19,520 --> 00:18:21,600
as you all know

560
00:18:21,600 --> 00:18:22,960
they never do

561
00:18:22,960 --> 00:18:26,320
but hey we'll see what happens

562
00:18:26,799 --> 00:18:30,559
all right no minimize

563
00:18:32,559 --> 00:18:33,679
thank you

564
00:18:33,679 --> 00:18:36,400
all right so here we go here is our file

565
00:18:36,400 --> 00:18:38,240
of credit cards i don't have dlp on my

566
00:18:38,240 --> 00:18:40,320
box right but you know

567
00:18:40,320 --> 00:18:42,320
we'll assume we got past it just random

568
00:18:42,320 --> 00:18:45,120
credit card numbers

569
00:18:45,360 --> 00:18:47,679
and just to show that it's a new thing

570
00:18:47,679 --> 00:18:49,280
uh where are we we're in b sides las

571
00:18:49,280 --> 00:18:51,280
vegas

572
00:18:51,280 --> 00:18:54,440
all right

573
00:18:56,160 --> 00:18:58,400
so

574
00:18:58,720 --> 00:19:00,400
over here

575
00:19:00,400 --> 00:19:03,840
we have our feeder

576
00:19:04,480 --> 00:19:06,400
so it's a simple little ui can everybody

577
00:19:06,400 --> 00:19:07,919
see it here let me make it a little bit

578
00:19:07,919 --> 00:19:10,000
bigger here

579
00:19:10,000 --> 00:19:12,400
there we go so you know you can change a

580
00:19:12,400 --> 00:19:13,679
couple of settings you can add some

581
00:19:13,679 --> 00:19:15,039
things

582
00:19:15,039 --> 00:19:17,520
oh we're out of frame we're not a frame

583
00:19:17,520 --> 00:19:19,840
sorry

584
00:19:19,840 --> 00:19:23,720
i'm going to start the server

585
00:19:26,320 --> 00:19:28,640
and so over here we can look at the

586
00:19:28,640 --> 00:19:30,320
powershell if we want i just have my

587
00:19:30,320 --> 00:19:32,559
simple little uh

588
00:19:32,559 --> 00:19:34,960
script it says invoke the feeder cookie

589
00:19:34,960 --> 00:19:36,960
monster feeder give it the url i want to

590
00:19:36,960 --> 00:19:38,480
go to the base url

591
00:19:38,480 --> 00:19:39,679
a proxy because i want to send it

592
00:19:39,679 --> 00:19:41,120
through burp so we can see what it looks

593
00:19:41,120 --> 00:19:43,919
like and the file name and now everybody

594
00:19:43,919 --> 00:19:45,679
crosses their fingers

595
00:19:45,679 --> 00:19:47,280
hey all right

596
00:19:47,280 --> 00:19:49,919
we are we are successful it worked at

597
00:19:49,919 --> 00:19:52,320
least it started so here we go we can

598
00:19:52,320 --> 00:19:55,439
see that it's getting data

599
00:19:55,520 --> 00:19:57,360
and if we look in burp right it's

600
00:19:57,360 --> 00:19:59,520
sending us to random pages

601
00:19:59,520 --> 00:20:01,440
and to top it off the server is

602
00:20:01,440 --> 00:20:04,640
responding back with data

603
00:20:04,640 --> 00:20:05,600
right

604
00:20:05,600 --> 00:20:07,840
yeah this is a big win you know it's not

605
00:20:07,840 --> 00:20:10,080
just something you know that says hi

606
00:20:10,080 --> 00:20:12,080
uh yeah it's a small selection you could

607
00:20:12,080 --> 00:20:13,600
put more in if you want but it's our

608
00:20:13,600 --> 00:20:15,679
small selection and it's running through

609
00:20:15,679 --> 00:20:17,520
you can see it's doing all the gets we

610
00:20:17,520 --> 00:20:19,280
have it doing again it'll do any web

611
00:20:19,280 --> 00:20:21,200
method you want

612
00:20:21,200 --> 00:20:22,880
what we've found is

613
00:20:22,880 --> 00:20:24,720
you know miter and many of the other

614
00:20:24,720 --> 00:20:26,159
groups that are seeing how data

615
00:20:26,159 --> 00:20:28,720
exfiltration happens it's via posts

616
00:20:28,720 --> 00:20:30,799
so if that's one of the things your data

617
00:20:30,799 --> 00:20:33,039
exfiltration is looking for it's not

618
00:20:33,039 --> 00:20:35,120
going to catch us because we'll do a get

619
00:20:35,120 --> 00:20:37,679
or a put or whatever we feel like it

620
00:20:37,679 --> 00:20:39,520
delete it doesn't make a difference

621
00:20:39,520 --> 00:20:40,640
trace

622
00:20:40,640 --> 00:20:42,240
or we can make up our own method

623
00:20:42,240 --> 00:20:44,640
whatever we want yeah uh and we can see

624
00:20:44,640 --> 00:20:47,880
here we go

625
00:20:48,320 --> 00:20:50,080
the cookies look a lot better that looks

626
00:20:50,080 --> 00:20:53,760
a lot more normal right like a cookie

627
00:20:53,760 --> 00:20:56,080
and that has everything so uh we also

628
00:20:56,080 --> 00:20:58,240
included we decided that our identifier

629
00:20:58,240 --> 00:21:00,240
should be like a google identifier

630
00:21:00,240 --> 00:21:01,600
because everybody's using google for

631
00:21:01,600 --> 00:21:03,919
tracking their website so there you go

632
00:21:03,919 --> 00:21:06,159
uh so that identifies the box we still

633
00:21:06,159 --> 00:21:08,080
have our our session data that's holding

634
00:21:08,080 --> 00:21:09,039
it

635
00:21:09,039 --> 00:21:11,039
but we added a random letter in the

636
00:21:11,039 --> 00:21:11,919
front

637
00:21:11,919 --> 00:21:14,240
all right

638
00:21:15,280 --> 00:21:17,600
so in theory

639
00:21:17,600 --> 00:21:21,039
my file is sitting over there

640
00:21:24,240 --> 00:21:26,960
i'm just going to scp to the box

641
00:21:26,960 --> 00:21:28,960
to grab my file

642
00:21:28,960 --> 00:21:32,799
oops helps if i change the ip address

643
00:21:42,880 --> 00:21:47,679
all right and in theory if this worked

644
00:21:49,440 --> 00:21:52,880
there's my new file the exact same one

645
00:21:52,880 --> 00:21:54,880
it worked

646
00:21:54,880 --> 00:21:57,200
oh always a good day always a good day

647
00:21:57,200 --> 00:22:00,240
so but just to show in case you want to

648
00:22:00,240 --> 00:22:02,880
do the other thing

649
00:22:02,880 --> 00:22:06,400
we have this other option for you

650
00:22:06,799 --> 00:22:08,159
so now

651
00:22:08,159 --> 00:22:09,280
cookie monster is running in the

652
00:22:09,280 --> 00:22:10,640
background

653
00:22:10,640 --> 00:22:12,320
every 30 seconds or if you want to

654
00:22:12,320 --> 00:22:14,159
change that he goes out and he just does

655
00:22:14,159 --> 00:22:17,520
a quick heartbeat to the server

656
00:22:22,320 --> 00:22:23,440
and

657
00:22:23,440 --> 00:22:25,760
we can see there there he is that should

658
00:22:25,760 --> 00:22:27,919
match him but i'll trust it matches him

659
00:22:27,919 --> 00:22:29,520
it matches and there we go we're going

660
00:22:29,520 --> 00:22:30,320
to do

661
00:22:30,320 --> 00:22:33,440
the one command you're who am i

662
00:22:33,440 --> 00:22:35,280
and then we just sit here and we wait

663
00:22:35,280 --> 00:22:37,919
and we'll go back to burp

664
00:22:37,919 --> 00:22:40,919
uh

665
00:22:42,960 --> 00:22:44,880
there was the response back from our

666
00:22:44,880 --> 00:22:48,880
seat from our server saying hey

667
00:22:49,120 --> 00:22:51,200
please do something so we said set the

668
00:22:51,200 --> 00:22:54,200
cookie

669
00:22:54,559 --> 00:22:59,000
my server and cookie monster responded

670
00:23:08,320 --> 00:23:10,880
and there you go

671
00:23:10,880 --> 00:23:11,679
right

672
00:23:11,679 --> 00:23:12,640
so

673
00:23:12,640 --> 00:23:15,280
normal web traffic it looked just like

674
00:23:15,280 --> 00:23:16,720
web traffic

675
00:23:16,720 --> 00:23:18,159
once again

676
00:23:18,159 --> 00:23:20,640
we set this up just to do

677
00:23:20,640 --> 00:23:22,640
this one method right using powershell

678
00:23:22,640 --> 00:23:23,840
it doesn't need to be powershell it

679
00:23:23,840 --> 00:23:26,159
could be anything you want

680
00:23:26,159 --> 00:23:30,240
uh all right so let me go back so i can

681
00:23:35,039 --> 00:23:36,720
we didn't really explicitly call it up

682
00:23:36,720 --> 00:23:39,120
there but so a lot of people

683
00:23:39,120 --> 00:23:40,799
probably recognized that cookie was base

684
00:23:40,799 --> 00:23:42,400
64 encoded

685
00:23:42,400 --> 00:23:44,799
um thank you we threw another character

686
00:23:44,799 --> 00:23:45,840
on the front of it just a random

687
00:23:45,840 --> 00:23:47,600
character that we ignore but it's enough

688
00:23:47,600 --> 00:23:49,440
to throw off the padding of the base64

689
00:23:49,440 --> 00:23:50,720
so if you grab the whole thing and

690
00:23:50,720 --> 00:23:53,520
decode it it looks like junk yep so if

691
00:23:53,520 --> 00:23:55,200
you just grab the actual encoded part

692
00:23:55,200 --> 00:23:58,000
you're good but once again we're not

693
00:23:58,000 --> 00:24:00,559
trying to defeat people right at no

694
00:24:00,559 --> 00:24:02,240
point am i trying to defeat a real

695
00:24:02,240 --> 00:24:04,080
person who's looking at this because if

696
00:24:04,080 --> 00:24:06,240
your job is to be looking at every

697
00:24:06,240 --> 00:24:08,640
single web request going out that's a

698
00:24:08,640 --> 00:24:11,039
really bad day i'm sorry for you right

699
00:24:11,039 --> 00:24:12,720
we have systems that do this and we just

700
00:24:12,720 --> 00:24:15,360
need to defeat that system

701
00:24:15,360 --> 00:24:18,000
so pros and cons of cookie monster pros

702
00:24:18,000 --> 00:24:20,799
standard high use port right web traffic

703
00:24:20,799 --> 00:24:23,600
happening all the time everywhere

704
00:24:23,600 --> 00:24:26,320
it runs as any method we could make up

705
00:24:26,320 --> 00:24:28,000
anything we want once again it doesn't

706
00:24:28,000 --> 00:24:29,919
care it's just running in the background

707
00:24:29,919 --> 00:24:31,360
looking for cookies

708
00:24:31,360 --> 00:24:32,400
right

709
00:24:32,400 --> 00:24:34,320
the cookies are you know once again

710
00:24:34,320 --> 00:24:36,640
cookies themselves are typically encoded

711
00:24:36,640 --> 00:24:39,600
or encrypted or some random stuff that

712
00:24:39,600 --> 00:24:42,400
isn't going to be inspected or useful

713
00:24:42,400 --> 00:24:43,440
cons

714
00:24:43,440 --> 00:24:45,200
there are cons you can't make a perfect

715
00:24:45,200 --> 00:24:46,960
tool unfortunately

716
00:24:46,960 --> 00:24:48,480
it requires a lot of web requests to

717
00:24:48,480 --> 00:24:50,080
send a message right depending on your

718
00:24:50,080 --> 00:24:52,159
file do simple math if we're only going

719
00:24:52,159 --> 00:24:54,320
to send 500 bytes at a time you're

720
00:24:54,320 --> 00:24:56,000
sending a one gig file that's going to

721
00:24:56,000 --> 00:24:59,120
be a lot of requests we admit that

722
00:24:59,120 --> 00:25:00,880
but once again you could space it out

723
00:25:00,880 --> 00:25:02,799
over a long period of time too you don't

724
00:25:02,799 --> 00:25:05,039
need to send it all at once

725
00:25:05,039 --> 00:25:06,480
uh it can

726
00:25:06,480 --> 00:25:08,880
make some files bigger because encoding

727
00:25:08,880 --> 00:25:10,480
things the data that it could make it a

728
00:25:10,480 --> 00:25:12,880
bigger file than what it was originally

729
00:25:12,880 --> 00:25:14,559
um and then of course you have to host

730
00:25:14,559 --> 00:25:15,919
it somewhere

731
00:25:15,919 --> 00:25:18,000
so if they have some really good content

732
00:25:18,000 --> 00:25:19,919
filtering or um

733
00:25:19,919 --> 00:25:21,760
based on reputation filtering it may not

734
00:25:21,760 --> 00:25:22,880
work

735
00:25:22,880 --> 00:25:26,159
but it's there and once again we we know

736
00:25:26,159 --> 00:25:27,919
it's it's listed in mitre it's listed in

737
00:25:27,919 --> 00:25:30,480
other places the this is a attack that

738
00:25:30,480 --> 00:25:32,480
is known we just tried to tweak it a

739
00:25:32,480 --> 00:25:35,520
little bit and pick an area that might

740
00:25:35,520 --> 00:25:37,279
not be used setting a custom server

741
00:25:37,279 --> 00:25:39,840
header is is easier to pick out than

742
00:25:39,840 --> 00:25:42,960
trying to inspect cookies i i don't know

743
00:25:42,960 --> 00:25:44,320
why a

744
00:25:44,320 --> 00:25:46,159
real legitimate

745
00:25:46,159 --> 00:25:47,440
detection system would be trying to

746
00:25:47,440 --> 00:25:49,360
break cookies apart but there could be a

747
00:25:49,360 --> 00:25:50,559
valid reason

748
00:25:50,559 --> 00:25:52,640
and then once again your max size is

749
00:25:52,640 --> 00:25:54,559
just over 4 000 bytes because that's the

750
00:25:54,559 --> 00:25:55,840
biggest you can actually set with the

751
00:25:55,840 --> 00:25:59,200
cookie or the the entire um

752
00:25:59,200 --> 00:26:00,960
it's the the entire header yeah that

753
00:26:00,960 --> 00:26:02,960
header and everything breaks yeah but it

754
00:26:02,960 --> 00:26:04,640
that would be that would look weird that

755
00:26:04,640 --> 00:26:06,320
would also look very weird so yeah

756
00:26:06,320 --> 00:26:08,640
please don't send it that big

757
00:26:08,640 --> 00:26:11,279
so where do we go from here well

758
00:26:11,279 --> 00:26:13,039
you know we think more feeders would be

759
00:26:13,039 --> 00:26:15,840
good not not just powershell python

760
00:26:15,840 --> 00:26:17,600
we've talked about it why even limit

761
00:26:17,600 --> 00:26:19,520
ourselves to just a programmatic way

762
00:26:19,520 --> 00:26:21,600
let's build an actual website that's

763
00:26:21,600 --> 00:26:23,279
just sitting in the background

764
00:26:23,279 --> 00:26:25,440
looking for the cookies and then you can

765
00:26:25,440 --> 00:26:27,279
browse there yourself and just send the

766
00:26:27,279 --> 00:26:30,480
data and it looks 100 legit because i'm

767
00:26:30,480 --> 00:26:32,320
not actually going to move even as fast

768
00:26:32,320 --> 00:26:34,320
or as normal or repetitive as something

769
00:26:34,320 --> 00:26:36,640
with asleep or you upload an html file

770
00:26:36,640 --> 00:26:39,200
on it i'm relatively confident i could

771
00:26:39,200 --> 00:26:41,440
implement that that feeder in the web

772
00:26:41,440 --> 00:26:42,880
browser

773
00:26:42,880 --> 00:26:44,799
uh we want to enhance the server some

774
00:26:44,799 --> 00:26:46,880
more uh

775
00:26:46,880 --> 00:26:48,240
we want to store the information

776
00:26:48,240 --> 00:26:50,400
somewhere in a little bit better we

777
00:26:50,400 --> 00:26:52,320
still need to work on on breaking it

778
00:26:52,320 --> 00:26:54,559
apart by device we have some potential

779
00:26:54,559 --> 00:26:55,840
limits there

780
00:26:55,840 --> 00:26:58,559
even better disguises um because we know

781
00:26:58,559 --> 00:27:00,240
we can have them better web pages like

782
00:27:00,240 --> 00:27:02,240
we said better things to see

783
00:27:02,240 --> 00:27:04,480
uh yeah so a couple options i floated

784
00:27:04,480 --> 00:27:06,320
around there where one would be use use

785
00:27:06,320 --> 00:27:08,080
an interception proxy to collect a bunch

786
00:27:08,080 --> 00:27:10,880
of responses to then pass to this pass

787
00:27:10,880 --> 00:27:12,320
the project file in there like a burp

788
00:27:12,320 --> 00:27:15,520
project or a owasp zap project

789
00:27:15,520 --> 00:27:16,240
or

790
00:27:16,240 --> 00:27:17,919
proxy it and actually point it at live

791
00:27:17,919 --> 00:27:20,720
sources and get your responses from

792
00:27:20,720 --> 00:27:23,039
there yeah just forward them on perfect

793
00:27:23,039 --> 00:27:24,320
yeah uh

794
00:27:24,320 --> 00:27:26,960
better obfuscation redirects et cetera

795
00:27:26,960 --> 00:27:28,399
we want to have other encoding options

796
00:27:28,399 --> 00:27:29,919
why limit ourselves to cookies let's use

797
00:27:29,919 --> 00:27:31,440
jwts

798
00:27:31,440 --> 00:27:34,000
right the signatures in the jwt that is

799
00:27:34,000 --> 00:27:36,159
a hundred percent unreadable it's

800
00:27:36,159 --> 00:27:38,080
supposed to be it's always opaque anyway

801
00:27:38,080 --> 00:27:40,159
yeah it's always opaque i mean that

802
00:27:40,159 --> 00:27:42,480
would be incredible uh we just didn't

803
00:27:42,480 --> 00:27:44,559
have time to do it uh do some iterations

804
00:27:44,559 --> 00:27:47,520
of encoding uh have the server

805
00:27:47,520 --> 00:27:49,840
actually dictate the cookies because

806
00:27:49,840 --> 00:27:51,760
right now it's hard-coded in both right

807
00:27:51,760 --> 00:27:54,240
so this cookie monster first thing

808
00:27:54,240 --> 00:27:56,480
before it sends a file goes out to say

809
00:27:56,480 --> 00:27:58,720
what should i do we get the cookies back

810
00:27:58,720 --> 00:28:00,960
to actually look like the server is

811
00:28:00,960 --> 00:28:02,480
setting some cookies

812
00:28:02,480 --> 00:28:04,640
uh all sorts of things oh and and let's

813
00:28:04,640 --> 00:28:06,640
actually have the ability to have cookie

814
00:28:06,640 --> 00:28:08,399
monster tell the feeder to stop doing

815
00:28:08,399 --> 00:28:09,679
the heartbeat that that would probably

816
00:28:09,679 --> 00:28:11,360
be a good thing to add in there

817
00:28:11,360 --> 00:28:12,399
yeah

818
00:28:12,399 --> 00:28:14,480
um and you know then we have these other

819
00:28:14,480 --> 00:28:16,240
questions like we said the whole command

820
00:28:16,240 --> 00:28:18,080
and control framework is that something

821
00:28:18,080 --> 00:28:20,399
we want to get into i don't know we

822
00:28:20,399 --> 00:28:21,679
think once again we think it would

823
00:28:21,679 --> 00:28:23,039
bypass it

824
00:28:23,039 --> 00:28:25,039
but i don't know if that's something we

825
00:28:25,039 --> 00:28:26,559
want to be responsible for you know

826
00:28:26,559 --> 00:28:27,679
people have written command control

827
00:28:27,679 --> 00:28:28,880
frameworks i'm like this is awesome

828
00:28:28,880 --> 00:28:30,559
let's release it to the world

829
00:28:30,559 --> 00:28:33,200
oh boy what did we do right that might

830
00:28:33,200 --> 00:28:36,799
not be where we want to go with this

831
00:28:37,200 --> 00:28:38,559
so

832
00:28:38,559 --> 00:28:39,919
what's the point of talking about this

833
00:28:39,919 --> 00:28:41,120
awesome tool other than saying hey we

834
00:28:41,120 --> 00:28:42,799
think we made this awesome tool

835
00:28:42,799 --> 00:28:45,200
how do you detect or prevent it

836
00:28:45,200 --> 00:28:46,240
well all right so you're gonna have a

837
00:28:46,240 --> 00:28:47,440
large number of requests going to a

838
00:28:47,440 --> 00:28:48,640
single source

839
00:28:48,640 --> 00:28:50,559
or will you

840
00:28:50,559 --> 00:28:53,760
why not have like one central server

841
00:28:53,760 --> 00:28:54,480
just

842
00:28:54,480 --> 00:28:56,720
getting everything from a whole bunch of

843
00:28:56,720 --> 00:28:58,080
websites that you create out there

844
00:28:58,080 --> 00:28:59,520
that's going to mask it even more all

845
00:28:59,520 --> 00:29:02,559
right so maybe that's not a good one

846
00:29:02,559 --> 00:29:04,320
uh reputational based filtering yeah

847
00:29:04,320 --> 00:29:06,480
that that'll work oh wait

848
00:29:06,480 --> 00:29:07,600
all of the people who do the

849
00:29:07,600 --> 00:29:09,120
reputational based filtering will be

850
00:29:09,120 --> 00:29:10,960
more than happy to tell you

851
00:29:10,960 --> 00:29:12,640
the web domains and what their

852
00:29:12,640 --> 00:29:14,720
reputation is right now

853
00:29:14,720 --> 00:29:16,559
all right and it's easy to find domains

854
00:29:16,559 --> 00:29:18,000
that are expiring okay so we can't use

855
00:29:18,000 --> 00:29:19,039
that

856
00:29:19,039 --> 00:29:20,799
uh sending cookies without getting it

857
00:29:20,799 --> 00:29:22,240
from a server

858
00:29:22,240 --> 00:29:24,559
okay that's pretty strange except all of

859
00:29:24,559 --> 00:29:26,080
the websites that say remember me

860
00:29:26,080 --> 00:29:28,399
forever yeah because of long-lived

861
00:29:28,399 --> 00:29:29,440
cookies

862
00:29:29,440 --> 00:29:31,360
it wouldn't be that weird to see traffic

863
00:29:31,360 --> 00:29:33,120
today that you didn't see a set cookie

864
00:29:33,120 --> 00:29:35,039
for so you know

865
00:29:35,039 --> 00:29:37,120
uh let's see cookies being rotated

866
00:29:37,120 --> 00:29:39,120
without server yep uh the endpoint

867
00:29:39,120 --> 00:29:40,799
protections and heuristics absolutely

868
00:29:40,799 --> 00:29:43,039
but as we all know those you don't want

869
00:29:43,039 --> 00:29:45,520
to put all your cookies ha in one basket

870
00:29:45,520 --> 00:29:48,799
right or all your eggs in one place um

871
00:29:48,799 --> 00:29:51,679
they can be broken and and let's face it

872
00:29:51,679 --> 00:29:53,919
that may not actually catch it depending

873
00:29:53,919 --> 00:29:56,320
on what's going on in the background

874
00:29:56,320 --> 00:29:57,760
it all comes down to what everybody's

875
00:29:57,760 --> 00:29:59,520
been talking about like all the keynotes

876
00:29:59,520 --> 00:30:01,520
and everybody what's normal in your

877
00:30:01,520 --> 00:30:02,960
environment

878
00:30:02,960 --> 00:30:05,039
where are people talking where are they

879
00:30:05,039 --> 00:30:06,399
suddenly going that they weren't going

880
00:30:06,399 --> 00:30:07,600
to before

881
00:30:07,600 --> 00:30:09,440
that's what's going to detect it right

882
00:30:09,440 --> 00:30:12,159
knowing that level of information

883
00:30:12,159 --> 00:30:14,799
but maybe we missed something right is

884
00:30:14,799 --> 00:30:16,960
this did we write a utility that nobody

885
00:30:16,960 --> 00:30:19,039
needs did we solve a problem that didn't

886
00:30:19,039 --> 00:30:21,760
exist anybody have any ideas i think

887
00:30:21,760 --> 00:30:23,120
we came up with something different and

888
00:30:23,120 --> 00:30:24,960
something a little unique a new take on

889
00:30:24,960 --> 00:30:26,799
stuff

890
00:30:26,799 --> 00:30:28,399
how would you protect against it in your

891
00:30:28,399 --> 00:30:29,840
environment

892
00:30:29,840 --> 00:30:31,039
that's why we came to breaking ground

893
00:30:31,039 --> 00:30:32,480
right we're like hey we think we have

894
00:30:32,480 --> 00:30:34,640
something we thought we've come up with

895
00:30:34,640 --> 00:30:36,960
ideas to break all of the ways that a

896
00:30:36,960 --> 00:30:38,559
system is going to try and detect it

897
00:30:38,559 --> 00:30:40,080
what did we miss

898
00:30:40,080 --> 00:30:41,279
anybody have any ideas if you have a

899
00:30:41,279 --> 00:30:42,799
question let us know

900
00:30:42,799 --> 00:30:43,600
right

901
00:30:43,600 --> 00:30:45,440
um you know we're here because we want

902
00:30:45,440 --> 00:30:47,760
to get your thoughts you know know who's

903
00:30:47,760 --> 00:30:49,919
using that sensitive data where it is

904
00:30:49,919 --> 00:30:51,600
don't let it float around

905
00:30:51,600 --> 00:30:53,760
and i that's it so we're really early

906
00:30:53,760 --> 00:30:55,760
we'd like questions

907
00:30:55,760 --> 00:30:57,200
or we could go through the demo again

908
00:30:57,200 --> 00:30:58,399
and watch it break

909
00:30:58,399 --> 00:31:00,399
since we have to get hubripo on there i

910
00:31:00,399 --> 00:31:01,919
i just want to say

911
00:31:01,919 --> 00:31:05,120
there's some really bad code in there

912
00:31:05,120 --> 00:31:06,480
fair enough and i'm gonna i'm gonna

913
00:31:06,480 --> 00:31:09,279
repeat that i said i was a windows guy

914
00:31:09,279 --> 00:31:11,039
i can write powershell that doesn't mean

915
00:31:11,039 --> 00:31:12,799
it's good-looking powershell it's

916
00:31:12,799 --> 00:31:15,440
functional it works but it it's not good

917
00:31:15,440 --> 00:31:18,799
looking so eric has an excuse

918
00:31:18,799 --> 00:31:20,880
i know better

919
00:31:20,880 --> 00:31:22,960
i run a dev team and i told my

920
00:31:22,960 --> 00:31:26,240
developers don't write stuff like this

921
00:31:26,240 --> 00:31:27,840
we will have a hard conversation if you

922
00:31:27,840 --> 00:31:29,919
write stuff like that

923
00:31:29,919 --> 00:31:32,960
it works uh it's not pretty it

924
00:31:32,960 --> 00:31:34,720
needs a lot of polish

925
00:31:34,720 --> 00:31:37,200
but it's there it's based on an idea we

926
00:31:37,200 --> 00:31:38,960
know it worked four years ago we think

927
00:31:38,960 --> 00:31:41,120
it's going to work even better now

928
00:31:41,120 --> 00:31:42,720
we'd like to know

929
00:31:42,720 --> 00:31:44,720
if it does for you if you ever give it a

930
00:31:44,720 --> 00:31:46,880
try

931
00:31:46,880 --> 00:31:49,120
any questions please give us questions

932
00:31:49,120 --> 00:31:50,320
yeah i've got the microphone here if

933
00:31:50,320 --> 00:31:52,320
anybody has a question or wants to try

934
00:31:52,320 --> 00:31:53,600
to answer the question they had at the

935
00:31:53,600 --> 00:31:55,039
end about how you would prevent against

936
00:31:55,039 --> 00:31:56,480
this against this i can just raise your

937
00:31:56,480 --> 00:31:58,399
hand and i can bring the mic over please

938
00:31:58,399 --> 00:32:01,840
give us something coming from the back

939
00:32:04,080 --> 00:32:05,919
it came all the way from the back um so

940
00:32:05,919 --> 00:32:07,840
one question i have is this in your

941
00:32:07,840 --> 00:32:09,200
slide you had

942
00:32:09,200 --> 00:32:10,880
um you know sending cookies without

943
00:32:10,880 --> 00:32:12,159
getting them from the server cookies

944
00:32:12,159 --> 00:32:14,880
rotate being set from the server or you

945
00:32:14,880 --> 00:32:16,159
know stuff like that

946
00:32:16,159 --> 00:32:18,000
so i mean to me that sounds like maybe a

947
00:32:18,000 --> 00:32:20,480
spec change on the http side you know to

948
00:32:20,480 --> 00:32:22,080
deal with that because implementation in

949
00:32:22,080 --> 00:32:23,760
the browser but a question i have and

950
00:32:23,760 --> 00:32:25,919
this is this is the question

951
00:32:25,919 --> 00:32:26,720
what

952
00:32:26,720 --> 00:32:28,960
in your research is anyone else

953
00:32:28,960 --> 00:32:32,000
legitimately rotating cookies or setting

954
00:32:32,000 --> 00:32:34,720
cookies without receiving them first

955
00:32:34,720 --> 00:32:36,880
so is there any false positives we might

956
00:32:36,880 --> 00:32:39,760
get based off of that so absolutely the

957
00:32:39,760 --> 00:32:41,279
seeing a cookie being sent before it was

958
00:32:41,279 --> 00:32:44,000
set will absolutely happen right because

959
00:32:44,000 --> 00:32:46,159
okay let me take a step back if you're

960
00:32:46,159 --> 00:32:47,840
sending all of the traffic from your

961
00:32:47,840 --> 00:32:49,840
devices all the time through the proxy

962
00:32:49,840 --> 00:32:51,600
even when they're at home and not vpned

963
00:32:51,600 --> 00:32:54,000
in okay then that would probably be

964
00:32:54,000 --> 00:32:56,159
pretty rare but how far back are you

965
00:32:56,159 --> 00:32:58,159
going to take that data set right how

966
00:32:58,159 --> 00:33:00,240
long do you say

967
00:33:00,240 --> 00:33:02,240
it did i see that cookie a minute ago or

968
00:33:02,240 --> 00:33:04,559
did i i looked back a month ago right

969
00:33:04,559 --> 00:33:05,760
because

970
00:33:05,760 --> 00:33:08,240
right websites remember me forever so

971
00:33:08,240 --> 00:33:10,320
absolutely the looking for a cookie

972
00:33:10,320 --> 00:33:12,080
being sent before it is set by the

973
00:33:12,080 --> 00:33:13,200
server

974
00:33:13,200 --> 00:33:15,679
would give you false positives uh the

975
00:33:15,679 --> 00:33:16,880
rotating

976
00:33:16,880 --> 00:33:18,399
that would be weird that would be a

977
00:33:18,399 --> 00:33:21,279
weird thing that would be uncommon so

978
00:33:21,279 --> 00:33:24,480
yes we do admit that is a limitation

979
00:33:24,480 --> 00:33:26,559
so i think i saw another hand over this

980
00:33:26,559 --> 00:33:27,600
way

981
00:33:27,600 --> 00:33:30,000
awesome

982
00:33:36,080 --> 00:33:38,480
hey uh just like say like really awesome

983
00:33:38,480 --> 00:33:40,799
tool so far i love it man

984
00:33:40,799 --> 00:33:42,960
my question was when you said you have

985
00:33:42,960 --> 00:33:45,440
the reverse proxy handling say cls

986
00:33:45,440 --> 00:33:47,440
connections and whatnot um do you have

987
00:33:47,440 --> 00:33:49,039
kind of a fear of being fingerprinted

988
00:33:49,039 --> 00:33:52,559
using ja3 because i know uh ciphers and

989
00:33:52,559 --> 00:33:55,360
things that are offered to income to

990
00:33:55,360 --> 00:33:57,679
clients are being fingerprinted now like

991
00:33:57,679 --> 00:33:59,840
i don't know if uh it's on the internet

992
00:33:59,840 --> 00:34:01,840
but j3 is a way to fingerprint c2

993
00:34:01,840 --> 00:34:03,679
frameworks and certain endpoints based

994
00:34:03,679 --> 00:34:06,640
on the offer tls ciphers and whatnot

995
00:34:06,640 --> 00:34:08,560
um is there any changes that have to be

996
00:34:08,560 --> 00:34:10,239
made to this framework specifically to

997
00:34:10,239 --> 00:34:12,560
accommodate you know randomizing that or

998
00:34:12,560 --> 00:34:15,599
is that more on the proxy side no so get

999
00:34:15,599 --> 00:34:16,960
your if you get the certificate from a

1000
00:34:16,960 --> 00:34:18,960
legitimate source right we're not using

1001
00:34:18,960 --> 00:34:20,480
it for

1002
00:34:20,480 --> 00:34:22,480
the encryption of the program we're just

1003
00:34:22,480 --> 00:34:24,000
using it as a normal

1004
00:34:24,000 --> 00:34:25,599
tls

1005
00:34:25,599 --> 00:34:27,199
encryption if i heard your question

1006
00:34:27,199 --> 00:34:28,960
right so the question was do we need to

1007
00:34:28,960 --> 00:34:30,639
compensate for specific ciphers or

1008
00:34:30,639 --> 00:34:32,719
anything as far as going out and being

1009
00:34:32,719 --> 00:34:35,520
used for the the reverse proxy correct

1010
00:34:35,520 --> 00:34:38,000
yeah it was more so just you know

1011
00:34:38,000 --> 00:34:40,079
will you account for being

1012
00:34:40,079 --> 00:34:42,399
fingerprinted by offering the same tls

1013
00:34:42,399 --> 00:34:43,440
ciphers

1014
00:34:43,440 --> 00:34:44,399
uh

1015
00:34:44,399 --> 00:34:46,480
over and over after each deployment of

1016
00:34:46,480 --> 00:34:49,679
the tool so right so

1017
00:34:49,679 --> 00:34:51,280
if we would stand this up in multiple

1018
00:34:51,280 --> 00:34:53,440
locations or we'd stand it up again and

1019
00:34:53,440 --> 00:34:55,918
like we use nginx is what we used if

1020
00:34:55,918 --> 00:34:58,000
we've got a cert for that server it

1021
00:34:58,000 --> 00:35:00,960
would be one right whichever website we

1022
00:35:00,960 --> 00:35:03,280
decide to stand up at the time to host

1023
00:35:03,280 --> 00:35:04,880
cookie monster could have a new

1024
00:35:04,880 --> 00:35:06,480
certificate so

1025
00:35:06,480 --> 00:35:08,560
you'd go through the renegotiation as

1026
00:35:08,560 --> 00:35:10,720
necessary but once again it doesn't need

1027
00:35:10,720 --> 00:35:12,400
to be the same certificate everywhere

1028
00:35:12,400 --> 00:35:14,720
okay cool thank you yep i think if i

1029
00:35:14,720 --> 00:35:16,160
wanted to make it distributed i'd

1030
00:35:16,160 --> 00:35:18,880
probably stick it in there as a an end

1031
00:35:18,880 --> 00:35:20,800
point behind a bunch of like cloudfront

1032
00:35:20,800 --> 00:35:22,760
instances or something like that

1033
00:35:22,760 --> 00:35:24,400
[Music]

1034
00:35:24,400 --> 00:35:26,960
who else has a question

1035
00:35:26,960 --> 00:35:28,839
upfront

1036
00:35:28,839 --> 00:35:31,280
first anybody have a better way of

1037
00:35:31,280 --> 00:35:33,200
detecting it come on

1038
00:35:33,200 --> 00:35:34,320
i know there are a lot of smart people

1039
00:35:34,320 --> 00:35:35,599
in this room i know you're smarter than

1040
00:35:35,599 --> 00:35:37,200
me too yeah like i guess if you want to

1041
00:35:37,200 --> 00:35:39,119
add like more uh obfuscation techniques

1042
00:35:39,119 --> 00:35:41,200
to it or maybe make it so that there's

1043
00:35:41,200 --> 00:35:43,119
not so many patterns would it add too

1044
00:35:43,119 --> 00:35:44,960
much complexity if you have like a

1045
00:35:44,960 --> 00:35:46,400
little i know there are some a lot of

1046
00:35:46,400 --> 00:35:47,520
links that have like really crazy

1047
00:35:47,520 --> 00:35:48,720
parameters or

1048
00:35:48,720 --> 00:35:50,079
like when well when you visit google

1049
00:35:50,079 --> 00:35:51,280
sometimes people are website it has like

1050
00:35:51,280 --> 00:35:53,200
a bunch of garbage um what would look

1051
00:35:53,200 --> 00:35:55,599
like garbage uh parameters and it looks

1052
00:35:55,599 --> 00:35:57,040
like a really crazy link so i'm

1053
00:35:57,040 --> 00:35:59,040
wondering if you do have a skating and

1054
00:35:59,040 --> 00:36:01,599
maybe throw in some parameter and use

1055
00:36:01,599 --> 00:36:03,200
that to alternative sophistication would

1056
00:36:03,200 --> 00:36:05,359
that uh too much complexity to the

1057
00:36:05,359 --> 00:36:07,680
project

1058
00:36:08,079 --> 00:36:10,720
we could i mean we we absolutely could

1059
00:36:10,720 --> 00:36:12,720
have it send parameters it would not add

1060
00:36:12,720 --> 00:36:14,720
that much complexity to what we're doing

1061
00:36:14,720 --> 00:36:17,680
um or having the web server respected

1062
00:36:17,680 --> 00:36:19,680
right

1063
00:36:19,680 --> 00:36:22,320
it's just extra development programming

1064
00:36:22,320 --> 00:36:24,000
um yeah i don't think that would be

1065
00:36:24,000 --> 00:36:25,280
difficult at all

1066
00:36:25,280 --> 00:36:27,359
so yeah uh to

1067
00:36:27,359 --> 00:36:28,960
add

1068
00:36:28,960 --> 00:36:30,560
some kind of generated parameters in

1069
00:36:30,560 --> 00:36:32,160
there right we just don't want to we

1070
00:36:32,160 --> 00:36:33,359
actually just don't want to send any

1071
00:36:33,359 --> 00:36:35,839
real data through it right the whole

1072
00:36:35,839 --> 00:36:37,599
idea is to keep all of the

1073
00:36:37,599 --> 00:36:41,119
important data stuck in the cookies cool

1074
00:36:41,119 --> 00:36:43,119
and would it help at all like uh to kind

1075
00:36:43,119 --> 00:36:45,119
of alternate um the obfuscation

1076
00:36:45,119 --> 00:36:47,200
technique you're using in the cookies

1077
00:36:47,200 --> 00:36:50,320
yeah possibly possibly like we said talk

1078
00:36:50,320 --> 00:36:52,240
about jwts is the way we definitely want

1079
00:36:52,240 --> 00:36:54,800
to go next yeah jwt signatures would be

1080
00:36:54,800 --> 00:36:58,960
a neat hiding spot um you could do

1081
00:36:59,280 --> 00:37:01,599
possibly some uh

1082
00:37:01,599 --> 00:37:04,240
like base64 encoded image uploads you

1083
00:37:04,240 --> 00:37:07,280
know you could stagger it in there

1084
00:37:07,280 --> 00:37:08,320
there are options there are a lot of

1085
00:37:08,320 --> 00:37:10,079
ways to go with it um

1086
00:37:10,079 --> 00:37:11,440
in terms of

1087
00:37:11,440 --> 00:37:13,359
more variety and another simple one

1088
00:37:13,359 --> 00:37:14,800
would be to just

1089
00:37:14,800 --> 00:37:16,480
renegotiate what names we're going to

1090
00:37:16,480 --> 00:37:17,920
use for the cookies

1091
00:37:17,920 --> 00:37:19,839
periodically so that they're not always

1092
00:37:19,839 --> 00:37:20,960
the same

1093
00:37:20,960 --> 00:37:23,520
cookie names those could also change

1094
00:37:23,520 --> 00:37:25,359
sessions are common j session id is

1095
00:37:25,359 --> 00:37:26,960
another different common name for a

1096
00:37:26,960 --> 00:37:28,320
session cookie

1097
00:37:28,320 --> 00:37:29,599
but it doesn't even have to be either of

1098
00:37:29,599 --> 00:37:32,240
those it could look like a cognito

1099
00:37:32,240 --> 00:37:34,079
cookie

1100
00:37:34,079 --> 00:37:37,720
yeah lots of options

1101
00:37:38,640 --> 00:37:40,160
yeah you mentioned one of the drawbacks

1102
00:37:40,160 --> 00:37:42,400
of the tool was that you the data would

1103
00:37:42,400 --> 00:37:44,720
be going out to an unknown host right

1104
00:37:44,720 --> 00:37:46,560
and you know obviously setting something

1105
00:37:46,560 --> 00:37:48,480
up at the last second as a destination

1106
00:37:48,480 --> 00:37:49,280
is

1107
00:37:49,280 --> 00:37:51,920
risky and i've been in situations where

1108
00:37:51,920 --> 00:37:54,000
outbound proxies are

1109
00:37:54,000 --> 00:37:56,560
incredibly extremely stringent i mean

1110
00:37:56,560 --> 00:37:58,160
have you done much research on like

1111
00:37:58,160 --> 00:37:59,920
anything with like legitimacy you can

1112
00:37:59,920 --> 00:38:02,560
hijack like a google sites or

1113
00:38:02,560 --> 00:38:05,040
like an old defunct cert you can renew

1114
00:38:05,040 --> 00:38:07,359
yourself i mean maybe outside of that

1115
00:38:07,359 --> 00:38:10,320
part but like any yeah i mean so

1116
00:38:10,320 --> 00:38:12,240
extensive research no i mean when we

1117
00:38:12,240 --> 00:38:14,240
need a site we have our places that we

1118
00:38:14,240 --> 00:38:16,880
go that list recently expired sites you

1119
00:38:16,880 --> 00:38:18,960
can check those through

1120
00:38:18,960 --> 00:38:20,960
any of the tools to say what's your

1121
00:38:20,960 --> 00:38:22,880
reputation do you have one right they

1122
00:38:22,880 --> 00:38:24,640
provide it for you so

1123
00:38:24,640 --> 00:38:27,599
beyond that no i have not done extensive

1124
00:38:27,599 --> 00:38:29,440
research into you know using this

1125
00:38:29,440 --> 00:38:31,359
specific item or one that will

1126
00:38:31,359 --> 00:38:33,520
absolutely be this

1127
00:38:33,520 --> 00:38:36,640
utility versus another

1128
00:38:44,000 --> 00:38:44,960
hey

1129
00:38:44,960 --> 00:38:46,400
i have two questions

1130
00:38:46,400 --> 00:38:47,760
sure uh the first is have you thought

1131
00:38:47,760 --> 00:38:49,440
about using web sockets to create that

1132
00:38:49,440 --> 00:38:51,520
connection and send the information

1133
00:38:51,520 --> 00:38:52,720
that's fine

1134
00:38:52,720 --> 00:38:54,480
it's like a continuous connection we

1135
00:38:54,480 --> 00:38:56,640
actually did discuss that and so we went

1136
00:38:56,640 --> 00:38:58,560
back and forth we think it could work

1137
00:38:58,560 --> 00:39:00,560
but

1138
00:39:00,560 --> 00:39:03,119
would that be inspected more than not so

1139
00:39:03,119 --> 00:39:04,480
that's one of those it was one of those

1140
00:39:04,480 --> 00:39:06,240
takeoffs and something we debated of

1141
00:39:06,240 --> 00:39:07,680
potentially doing

1142
00:39:07,680 --> 00:39:10,720
um yeah it really came down to we we

1143
00:39:10,720 --> 00:39:13,359
were afraid that that would look

1144
00:39:13,359 --> 00:39:16,240
more suspicious to somebody watching

1145
00:39:16,240 --> 00:39:17,599
which kind of feeds it to the next

1146
00:39:17,599 --> 00:39:19,920
question because if that is the typical

1147
00:39:19,920 --> 00:39:22,400
way that client communicates on the web

1148
00:39:22,400 --> 00:39:24,640
application could you take that into

1149
00:39:24,640 --> 00:39:27,119
account and maybe first of all clone

1150
00:39:27,119 --> 00:39:29,520
that way of communicating via websockets

1151
00:39:29,520 --> 00:39:31,280
and use that as the base for your

1152
00:39:31,280 --> 00:39:33,200
communication but then also could you

1153
00:39:33,200 --> 00:39:35,599
take the cookies they typically send on

1154
00:39:35,599 --> 00:39:37,680
their applications and then name them

1155
00:39:37,680 --> 00:39:39,040
accordingly

1156
00:39:39,040 --> 00:39:40,960
to then bypass any filters that might

1157
00:39:40,960 --> 00:39:42,320
come on to the names of the cookies from

1158
00:39:42,320 --> 00:39:43,359
before

1159
00:39:43,359 --> 00:39:45,520
absolutely right if we wanted to once

1160
00:39:45,520 --> 00:39:47,839
again we get to dictate whatever we want

1161
00:39:47,839 --> 00:39:50,000
the whole idea is

1162
00:39:50,000 --> 00:39:52,000
as long as what i am sending is

1163
00:39:52,000 --> 00:39:54,480
understandable by the server

1164
00:39:54,480 --> 00:39:56,800
it doesn't make a difference right so we

1165
00:39:56,800 --> 00:39:58,480
could pick up the cookies if we found a

1166
00:39:58,480 --> 00:40:00,640
website that we really wanted to clone

1167
00:40:00,640 --> 00:40:02,720
we could right assuming it had the right

1168
00:40:02,720 --> 00:40:04,720
number of cookies in it for us which is

1169
00:40:04,720 --> 00:40:05,839
four

1170
00:40:05,839 --> 00:40:08,880
right now four or more or more um so we

1171
00:40:08,880 --> 00:40:10,480
could but then of course then you have

1172
00:40:10,480 --> 00:40:13,359
the other problem of hey that's saying

1173
00:40:13,359 --> 00:40:18,160
that's rsa.com but it's not right so i'd

1174
00:40:18,160 --> 00:40:21,200
rather go and pick up my sites now like

1175
00:40:21,200 --> 00:40:24,240
my five six financial sites that have

1176
00:40:24,240 --> 00:40:27,440
expired or whatever rated sit up there

1177
00:40:27,440 --> 00:40:29,359
put up a good website that says coming

1178
00:40:29,359 --> 00:40:31,040
soon and then

1179
00:40:31,040 --> 00:40:32,480
when we need to exfiltrate data we just

1180
00:40:32,480 --> 00:40:34,000
throw a cookie monster in the back end

1181
00:40:34,000 --> 00:40:35,680
right and it's waiting there

1182
00:40:35,680 --> 00:40:36,480
ready

1183
00:40:36,480 --> 00:40:38,400
cool thanks really interesting also the

1184
00:40:38,400 --> 00:40:40,880
idea of a c2 server sounds really

1185
00:40:40,880 --> 00:40:43,119
interesting with this as well so

1186
00:40:43,119 --> 00:40:45,200
risky exactly that's where we were we're

1187
00:40:45,200 --> 00:40:47,599
like this would be awesome because

1188
00:40:47,599 --> 00:40:49,040
i didn't say it i have a hate

1189
00:40:49,040 --> 00:40:50,880
relationship with metasploit and many of

1190
00:40:50,880 --> 00:40:52,800
the other frameworks out there i will

1191
00:40:52,800 --> 00:40:54,560
type something and say go and i get that

1192
00:40:54,560 --> 00:40:55,599
horrible

1193
00:40:55,599 --> 00:40:58,079
exploit ran but session failed whatever

1194
00:40:58,079 --> 00:41:00,160
a peer of mine nathan would go up there

1195
00:41:00,160 --> 00:41:02,560
just hit enter and it works right so me

1196
00:41:02,560 --> 00:41:04,480
no bad i'm not good with cg framework so

1197
00:41:04,480 --> 00:41:07,680
i like living off the land

1198
00:41:07,680 --> 00:41:11,040
who else has a question there we go

1199
00:41:12,960 --> 00:41:15,119
hey thanks for the talk uh quick

1200
00:41:15,119 --> 00:41:18,319
question so you mentioned that the um

1201
00:41:18,319 --> 00:41:19,920
the file you're trying to exfiltrate

1202
00:41:19,920 --> 00:41:22,800
it'll break down and have like an id as

1203
00:41:22,800 --> 00:41:24,560
part of like each request going through

1204
00:41:24,560 --> 00:41:26,560
right so the files split into smaller

1205
00:41:26,560 --> 00:41:28,560
sizes if you're excel trading a large

1206
00:41:28,560 --> 00:41:30,960
file and maybe some of the requests time

1207
00:41:30,960 --> 00:41:33,760
out and they don't send those chunks can

1208
00:41:33,760 --> 00:41:35,680
you from the server side to say hey

1209
00:41:35,680 --> 00:41:38,319
request part 5 or something

1210
00:41:38,319 --> 00:41:40,800
so yes so there's another part that we

1211
00:41:40,800 --> 00:41:42,400
started we went down that path of hey

1212
00:41:42,400 --> 00:41:44,800
had the server tell me it failed or not

1213
00:41:44,800 --> 00:41:48,800
and what we decided instead is to just

1214
00:41:48,800 --> 00:41:51,040
we're doing it sequentially right so

1215
00:41:51,040 --> 00:41:53,200
server goes offline

1216
00:41:53,200 --> 00:41:54,800
the feeder pauses

1217
00:41:54,800 --> 00:41:57,359
tries pauses tries and once it gets a

1218
00:41:57,359 --> 00:42:00,640
good message it'll continue again

1219
00:42:00,640 --> 00:42:02,880
we did discuss the whole let's send a

1220
00:42:02,880 --> 00:42:05,920
final act and do everything it just came

1221
00:42:05,920 --> 00:42:08,319
down to time before we got here uh we do

1222
00:42:08,319 --> 00:42:10,480
pen testing a lot and this was a side

1223
00:42:10,480 --> 00:42:12,640
project for mick and i that was yeah

1224
00:42:12,640 --> 00:42:14,160
that makes sense that was the scope

1225
00:42:14,160 --> 00:42:16,400
creeping on me because i decided to

1226
00:42:16,400 --> 00:42:18,560
rewrite a thing yeah

1227
00:42:18,560 --> 00:42:20,800
we write a thing to do a thing yeah and

1228
00:42:20,800 --> 00:42:22,720
so we did change and

1229
00:42:22,720 --> 00:42:24,400
uh so

1230
00:42:24,400 --> 00:42:25,760
let me find i've been heartbeating in

1231
00:42:25,760 --> 00:42:26,960
the background as we've been talking so

1232
00:42:26,960 --> 00:42:28,240
let me find somebody

1233
00:42:28,240 --> 00:42:29,680
so

1234
00:42:29,680 --> 00:42:31,760
we changed the entire mechanism right

1235
00:42:31,760 --> 00:42:34,319
this itn

1236
00:42:34,319 --> 00:42:35,920
there oh you can't see it because i'm

1237
00:42:35,920 --> 00:42:38,880
not sharing the screen

1238
00:42:40,000 --> 00:42:41,680
um

1239
00:42:41,680 --> 00:42:44,640
this entire itn there

1240
00:42:44,640 --> 00:42:48,240
is actually the the encoded

1241
00:42:48,240 --> 00:42:50,240
you know this is part

1242
00:42:50,240 --> 00:42:52,560
we have 28 parts this is part 2 or

1243
00:42:52,560 --> 00:42:53,920
whatever so

1244
00:42:53,920 --> 00:42:55,680
it still gets that information it's just

1245
00:42:55,680 --> 00:42:58,079
encoded in a better way

1246
00:42:58,079 --> 00:42:59,760
okay cool yeah i mean my main thing was

1247
00:42:59,760 --> 00:43:01,359
like obviously if you're exciting a

1248
00:43:01,359 --> 00:43:02,960
large file and it fails you don't want

1249
00:43:02,960 --> 00:43:04,560
to repeat the entire process all over

1250
00:43:04,560 --> 00:43:06,319
again so just be able to

1251
00:43:06,319 --> 00:43:08,079
say oh i'm missing this part can i just

1252
00:43:08,079 --> 00:43:09,520
request this only

1253
00:43:09,520 --> 00:43:11,359
yep that is definitely something that

1254
00:43:11,359 --> 00:43:13,680
we've talked about and so

1255
00:43:13,680 --> 00:43:15,599
it would be a good addition to put in uh

1256
00:43:15,599 --> 00:43:16,800
just time

1257
00:43:16,800 --> 00:43:19,440
all right thanks

1258
00:43:20,319 --> 00:43:23,200
any other questions

1259
00:43:24,319 --> 00:43:26,880
make sure you're not the

1260
00:43:32,079 --> 00:43:34,319
hello i wanted to ask one thing

1261
00:43:34,319 --> 00:43:37,119
uh i suppose this is quite stealthy on

1262
00:43:37,119 --> 00:43:38,720
the network level but what about the

1263
00:43:38,720 --> 00:43:40,480
detection when you have like windows

1264
00:43:40,480 --> 00:43:43,520
defender and you're doing the base 60

1265
00:43:43,520 --> 00:43:46,480
for encryption or use the invoker

1266
00:43:46,480 --> 00:43:49,280
web request functionality does this get

1267
00:43:49,280 --> 00:43:51,359
that detected a lot or what's your

1268
00:43:51,359 --> 00:43:54,240
experience with yeah no by by default

1269
00:43:54,240 --> 00:43:56,800
okay so as of right now the feeder has

1270
00:43:56,800 --> 00:43:58,079
not been submitted to anything that's

1271
00:43:58,079 --> 00:43:59,760
saying it's malicious

1272
00:43:59,760 --> 00:44:01,040
that could change and then it would

1273
00:44:01,040 --> 00:44:02,079
right and then defenders going to pick

1274
00:44:02,079 --> 00:44:04,000
it up but the behavior that we are

1275
00:44:04,000 --> 00:44:06,560
exploiting underneath the hood no it's

1276
00:44:06,560 --> 00:44:08,400
invoke web request it's it is an

1277
00:44:08,400 --> 00:44:10,720
expected behavior of powershell we are

1278
00:44:10,720 --> 00:44:14,079
doing nothing malicious at all right

1279
00:44:14,079 --> 00:44:16,000
it's not malicious but i think uh

1280
00:44:16,000 --> 00:44:18,000
nowadays when you're basing coding for

1281
00:44:18,000 --> 00:44:20,240
example or when you're using the invoke

1282
00:44:20,240 --> 00:44:22,400
web request it sometimes gets flagged

1283
00:44:22,400 --> 00:44:24,720
because it's unusual activity so it

1284
00:44:24,720 --> 00:44:25,520
might

1285
00:44:25,520 --> 00:44:27,520
yeah so if you have the full defender

1286
00:44:27,520 --> 00:44:30,400
suite identity and all the cloud the it

1287
00:44:30,400 --> 00:44:32,720
very well could i i can't speak to that

1288
00:44:32,720 --> 00:44:34,960
the default defender ed point protection

1289
00:44:34,960 --> 00:44:37,839
on its own it isn't going to care

1290
00:44:37,839 --> 00:44:41,119
does that thank you yeah

1291
00:44:43,280 --> 00:44:46,640
any other questions thoughts

1292
00:44:46,800 --> 00:44:48,160
is anybody going to download it and try

1293
00:44:48,160 --> 00:44:49,680
it

1294
00:44:49,680 --> 00:44:50,880
awesome who's going to download and try

1295
00:44:50,880 --> 00:44:53,760
it all right eric secure ideas.com make

1296
00:44:53,760 --> 00:44:55,680
it secure ideas.com let us know all

1297
00:44:55,680 --> 00:44:57,280
right not a difficult email address

1298
00:44:57,280 --> 00:44:59,119
please let us know how it goes because

1299
00:44:59,119 --> 00:45:00,560
we only get to try it when somebody pays

1300
00:45:00,560 --> 00:45:04,000
us to so

1301
00:45:04,000 --> 00:45:07,220
you guys

1302
00:45:07,220 --> 00:45:09,870
[Applause]

