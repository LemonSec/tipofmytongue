1
00:00:00,500 --> 00:00:13,499
[Music]

2
00:00:13,630 --> 00:00:20,600
<font color="#E5E5E5">okay well welcome to</font><font color="#CCCCCC"> Lake City</font><font color="#E5E5E5"> I am</font>

3
00:00:17,750 --> 00:00:23,480
thrilled<font color="#E5E5E5"> to</font><font color="#CCCCCC"> be back at b-sides</font><font color="#E5E5E5"> I'm</font>

4
00:00:20,600 --> 00:00:25,400
actually<font color="#E5E5E5"> a local here</font><font color="#CCCCCC"> in Utah</font><font color="#E5E5E5"> and I feel</font>

5
00:00:23,480 --> 00:00:26,660
<font color="#CCCCCC">very</font><font color="#E5E5E5"> fortunate</font><font color="#CCCCCC"> how many how many folks</font>

6
00:00:25,400 --> 00:00:29,778
are not<font color="#E5E5E5"> from Utah on here</font>

7
00:00:26,660 --> 00:00:32,360
a handful<font color="#E5E5E5"> cool no</font><font color="#CCCCCC"> talk to</font><font color="#E5E5E5"> some folks</font>

8
00:00:29,779 --> 00:00:34,880
from Vegas<font color="#CCCCCC"> LA</font><font color="#E5E5E5"> I know Leslie coming up</font>

9
00:00:32,360 --> 00:00:38,090
all the<font color="#CCCCCC"> way</font><font color="#E5E5E5"> from</font><font color="#CCCCCC"> Chicago so great</font><font color="#E5E5E5"> to</font>

10
00:00:34,880 --> 00:00:39,950
<font color="#E5E5E5">have you here I am</font><font color="#CCCCCC"> always thrilled</font><font color="#E5E5E5"> and</font>

11
00:00:38,090 --> 00:00:42,500
excited by our<font color="#CCCCCC"> security community</font><font color="#E5E5E5"> I'm</font>

12
00:00:39,950 --> 00:00:45,770
always amazed at what's been built out

13
00:00:42,500 --> 00:00:47,960
<font color="#CCCCCC">here</font><font color="#E5E5E5"> I'm I feel privileged to</font><font color="#CCCCCC"> be invited</font>

14
00:00:45,770 --> 00:00:49,760
<font color="#CCCCCC">to</font><font color="#E5E5E5"> be a part</font><font color="#CCCCCC"> of that and I'd say really</font>

15
00:00:47,960 --> 00:00:52,160
the security key to me<font color="#CCCCCC"> is kind of all of</font>

16
00:00:49,760 --> 00:00:54,019
you sitting<font color="#E5E5E5"> in those seats so I just</font>

17
00:00:52,160 --> 00:00:56,809
want to<font color="#E5E5E5"> thank you for doing such an</font>

18
00:00:54,020 --> 00:00:59,600
amazing<font color="#CCCCCC"> job or for such a</font><font color="#E5E5E5"> small area we</font>

19
00:00:56,810 --> 00:01:01,880
have an awesome<font color="#CCCCCC"> community</font><font color="#E5E5E5"> so awesome to</font>

20
00:00:59,600 --> 00:01:07,939
be<font color="#E5E5E5"> here</font><font color="#CCCCCC"> what I want</font><font color="#E5E5E5"> to talk to you guys</font>

21
00:01:01,880 --> 00:01:11,079
about is a<font color="#E5E5E5"> little bit of credentials and</font>

22
00:01:07,939 --> 00:01:13,309
<font color="#E5E5E5">it we've got a problem</font>

23
00:01:11,079 --> 00:01:15,919
we have a<font color="#CCCCCC"> credential problem ladies and</font>

24
00:01:13,310 --> 00:01:18,680
gentlemen and I think you're<font color="#E5E5E5"> all aware</font>

25
00:01:15,920 --> 00:01:20,750
<font color="#E5E5E5">that</font><font color="#CCCCCC"> I think we you've been in security</font>

26
00:01:18,680 --> 00:01:22,820
community for any period<font color="#E5E5E5"> of</font><font color="#CCCCCC"> time you are</font>

27
00:01:20,750 --> 00:01:24,700
<font color="#E5E5E5">well aware that credentials are a</font>

28
00:01:22,820 --> 00:01:26,960
<font color="#E5E5E5">vulnerability</font>

29
00:01:24,700 --> 00:01:29,830
however I've got this<font color="#E5E5E5"> sneaking suspicion</font>

30
00:01:26,960 --> 00:01:32,229
that most people<font color="#E5E5E5"> in our field actually</font>

31
00:01:29,830 --> 00:01:35,150
<font color="#E5E5E5">don't know the extent</font><font color="#CCCCCC"> of the problem</font>

32
00:01:32,229 --> 00:01:37,460
<font color="#CCCCCC">it's incredibly complex the windows</font>

33
00:01:35,150 --> 00:01:39,350
authentication system and I think

34
00:01:37,460 --> 00:01:40,729
frankly it's almost too complex for

35
00:01:39,350 --> 00:01:42,850
someone<font color="#CCCCCC"> that</font><font color="#E5E5E5"> doesn't dedicate a lot of</font>

36
00:01:40,729 --> 00:01:46,310
<font color="#E5E5E5">time to fully understand</font>

37
00:01:42,850 --> 00:01:47,780
<font color="#E5E5E5">I'll give you example I've done you know</font>

38
00:01:46,310 --> 00:01:52,010
over the last<font color="#CCCCCC"> couple of years probably a</font>

39
00:01:47,780 --> 00:01:53,960
<font color="#E5E5E5">hundred plus interviews for folks</font><font color="#CCCCCC"> on the</font>

40
00:01:52,010 --> 00:01:56,720
<font color="#CCCCCC">CrowdStrike</font><font color="#E5E5E5"> team these are top tier</font>

41
00:01:53,960 --> 00:01:58,520
security professionals and I've walked

42
00:01:56,720 --> 00:02:01,429
away from almost every single<font color="#CCCCCC"> one</font><font color="#E5E5E5"> of</font>

43
00:01:58,520 --> 00:02:03,949
those interviews largely with the<font color="#E5E5E5"> the</font>

44
00:02:01,430 --> 00:02:06,490
sinking feeling<font color="#CCCCCC"> that my god you know</font>

45
00:02:03,950 --> 00:02:09,289
this person<font color="#CCCCCC"> really</font><font color="#E5E5E5"> doesn't understand</font>

46
00:02:06,490 --> 00:02:10,639
<font color="#CCCCCC">credentials</font><font color="#E5E5E5"> it's one of the common</font>

47
00:02:09,288 --> 00:02:12,920
questions<font color="#E5E5E5"> I ask because I think it's so</font>

48
00:02:10,639 --> 00:02:15,349
important and<font color="#E5E5E5"> very rarely will anyone</font>

49
00:02:12,920 --> 00:02:20,268
nail sometimes even the most<font color="#E5E5E5"> simple</font>

50
00:02:15,349 --> 00:02:22,219
questions<font color="#E5E5E5"> and that's a problem</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> this</font>

51
00:02:20,269 --> 00:02:23,989
<font color="#E5E5E5">is both red teamers and blue team's</font>

52
00:02:22,219 --> 00:02:25,969
amazing<font color="#E5E5E5"> I expect kind of blue team or</font>

53
00:02:23,989 --> 00:02:26,900
sometimes we kind<font color="#E5E5E5"> of get get our heads</font>

54
00:02:25,969 --> 00:02:28,700
down<font color="#E5E5E5"> you know</font>

55
00:02:26,900 --> 00:02:31,310
kind of<font color="#E5E5E5"> got our artifacts we look for</font><font color="#CCCCCC"> I</font>

56
00:02:28,700 --> 00:02:33,500
<font color="#CCCCCC">was especially surprised of red teamers</font>

57
00:02:31,310 --> 00:02:35,390
not truly understanding what they're

58
00:02:33,500 --> 00:02:36,349
constantly taking advantage<font color="#E5E5E5"> of they</font>

59
00:02:35,390 --> 00:02:38,089
certainly know<font color="#CCCCCC"> that they're stealing</font>

60
00:02:36,349 --> 00:02:39,738
tickets or tokens<font color="#E5E5E5"> and they may be</font>

61
00:02:38,090 --> 00:02:42,409
reusing those in<font color="#E5E5E5"> order to move</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the</font>

62
00:02:39,739 --> 00:02:45,349
environment but commonly they don't know

63
00:02:42,409 --> 00:02:46,849
why the tickets<font color="#E5E5E5"> or tokens are there and</font>

64
00:02:45,349 --> 00:02:48,108
that's going<font color="#E5E5E5"> to be a big problem because</font>

65
00:02:46,849 --> 00:02:49,760
<font color="#E5E5E5">we're going to see in</font><font color="#CCCCCC"> this presentation</font>

66
00:02:48,109 --> 00:02:52,670
there's some good mitigations coming

67
00:02:49,760 --> 00:02:56,149
Microsoft<font color="#CCCCCC"> the sleeping giant</font><font color="#E5E5E5"> has finally</font>

68
00:02:52,670 --> 00:02:58,458
<font color="#E5E5E5">woken up maybe and started to try to fix</font>

69
00:02:56,150 --> 00:03:00,049
some of these problems<font color="#CCCCCC"> and we're going</font>

70
00:02:58,459 --> 00:03:01,879
to<font color="#E5E5E5"> have some you know pen testers red</font>

71
00:03:00,049 --> 00:03:03,769
<font color="#E5E5E5">team is and hopefully attackers which</font>

72
00:03:01,879 --> 00:03:05,840
are<font color="#CCCCCC"> going</font><font color="#E5E5E5"> to start stumbling because</font>

73
00:03:03,769 --> 00:03:07,489
what<font color="#CCCCCC"> their old-school techniques that</font>

74
00:03:05,840 --> 00:03:09,440
work<font color="#E5E5E5"> every time all the sudden are going</font>

75
00:03:07,489 --> 00:03:10,579
to stop working<font color="#E5E5E5"> with any luck right we</font>

76
00:03:09,440 --> 00:03:13,280
can only hope

77
00:03:10,579 --> 00:03:14,689
but the idea this presentation<font color="#E5E5E5"> is really</font>

78
00:03:13,280 --> 00:03:16,849
<font color="#E5E5E5">to kind of get us all up to speed on</font>

79
00:03:14,689 --> 00:03:19,760
credentials<font color="#CCCCCC"> this is actually something I</font>

80
00:03:16,849 --> 00:03:21,888
sat down<font color="#E5E5E5"> I was</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> so kind of down just</font>

81
00:03:19,760 --> 00:03:23,599
with with the level of<font color="#E5E5E5"> kind of</font>

82
00:03:21,889 --> 00:03:25,129
understanding<font color="#CCCCCC"> of this but I just</font><font color="#E5E5E5"> sat</font>

83
00:03:23,599 --> 00:03:27,470
down<font color="#E5E5E5"> and kind of wrote what we're</font><font color="#CCCCCC"> about</font>

84
00:03:25,129 --> 00:03:29,989
to see<font color="#E5E5E5"> actually this is a part of a</font>

85
00:03:27,470 --> 00:03:32,840
<font color="#E5E5E5">class</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> I co-author for sans is 508</font>

86
00:03:29,989 --> 00:03:34,639
instant response class and you guys<font color="#E5E5E5"> will</font>

87
00:03:32,840 --> 00:03:36,650
<font color="#CCCCCC">be some of the first ones to get a look</font>

88
00:03:34,639 --> 00:03:38,660
<font color="#E5E5E5">at it</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> so I also wanted to get you to</font>

89
00:03:36,650 --> 00:03:41,629
the<font color="#E5E5E5"> slides so</font><font color="#CCCCCC"> you have kind of all the</font>

90
00:03:38,660 --> 00:03:45,530
<font color="#E5E5E5">the bulk behind it but we're going to</font>

91
00:03:41,629 --> 00:03:48,709
<font color="#E5E5E5">talk</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> credentials now think about</font>

92
00:03:45,530 --> 00:03:50,840
<font color="#E5E5E5">the common attack cycle</font><font color="#CCCCCC"> I'm an instant</font>

93
00:03:48,709 --> 00:03:52,970
responder kind of<font color="#CCCCCC"> bitrates I'm more blue</font>

94
00:03:50,840 --> 00:03:55,040
team<font color="#E5E5E5"> and so I'm constantly looking at</font>

95
00:03:52,970 --> 00:03:57,290
what<font color="#CCCCCC"> I call funnel points</font><font color="#E5E5E5"> looking for</font>

96
00:03:55,040 --> 00:03:59,989
<font color="#E5E5E5">areas where I can</font><font color="#CCCCCC"> actually sift that big</font>

97
00:03:57,290 --> 00:04:01,310
haystack<font color="#CCCCCC"> and actually find where the</font>

98
00:03:59,989 --> 00:04:03,019
attackers are right hundreds of

99
00:04:01,310 --> 00:04:04,430
thousands of<font color="#E5E5E5"> endpoints where do I know</font>

100
00:04:03,019 --> 00:04:05,900
they're going to<font color="#CCCCCC"> be what I know they're</font>

101
00:04:04,430 --> 00:04:09,019
going<font color="#CCCCCC"> to do that I can learn to track</font>

102
00:04:05,900 --> 00:04:11,120
<font color="#E5E5E5">and in my</font><font color="#CCCCCC"> experience or really in my</font>

103
00:04:09,019 --> 00:04:13,579
<font color="#CCCCCC">opinion probably credentials are the</font>

104
00:04:11,120 --> 00:04:15,829
most critical<font color="#CCCCCC"> part of any attack I can't</font>

105
00:04:13,579 --> 00:04:17,030
think of<font color="#E5E5E5"> anything</font><font color="#CCCCCC"> more important and so</font>

106
00:04:15,829 --> 00:04:19,250
let's<font color="#CCCCCC"> kind of go</font><font color="#E5E5E5"> to the cycle a little</font>

107
00:04:17,029 --> 00:04:21,380
<font color="#CCCCCC">bit here</font><font color="#E5E5E5"> yeah so an attack our first</font>

108
00:04:19,250 --> 00:04:23,210
<font color="#CCCCCC">gains</font><font color="#E5E5E5"> a foothold</font><font color="#CCCCCC"> on the network this</font><font color="#E5E5E5"> is</font>

109
00:04:21,380 --> 00:04:24,979
almost never<font color="#E5E5E5"> going to be the place they</font>

110
00:04:23,210 --> 00:04:26,299
<font color="#E5E5E5">want</font><font color="#CCCCCC"> to end up</font><font color="#E5E5E5"> unless they get</font>

111
00:04:24,979 --> 00:04:28,159
incredibly lucky they're going to have

112
00:04:26,300 --> 00:04:30,460
goals<font color="#E5E5E5"> that extend far beyond this first</font>

113
00:04:28,159 --> 00:04:33,469
<font color="#E5E5E5">foothold this first user workstation</font>

114
00:04:30,460 --> 00:04:34,638
we're going to have to somehow get

115
00:04:33,470 --> 00:04:36,169
credentials where they can move around

116
00:04:34,639 --> 00:04:39,110
<font color="#E5E5E5">that</font><font color="#CCCCCC"> environment</font><font color="#E5E5E5"> the great thing about</font>

117
00:04:36,169 --> 00:04:40,190
<font color="#CCCCCC">Windows is that everything is tied to an</font>

118
00:04:39,110 --> 00:04:42,470
account

119
00:04:40,190 --> 00:04:44,930
to give you an example<font color="#CCCCCC"> Computers</font>

120
00:04:42,470 --> 00:04:47,150
themself have accounts<font color="#E5E5E5"> right registry</font>

121
00:04:44,930 --> 00:04:49,310
<font color="#E5E5E5">keys are tied to specific accounts right</font>

122
00:04:47,150 --> 00:04:52,130
everything so if you don't have

123
00:04:49,310 --> 00:04:54,140
<font color="#E5E5E5">credentials you're stuck so very</font>

124
00:04:52,130 --> 00:04:56,300
commonly if they're already admins<font color="#CCCCCC"> well</font>

125
00:04:54,140 --> 00:04:58,580
they're ready<font color="#E5E5E5"> to rock and they can kind</font>

126
00:04:56,300 --> 00:04:59,720
<font color="#CCCCCC">of dump credentials</font><font color="#E5E5E5"> if they're not admin</font>

127
00:04:58,580 --> 00:05:01,070
yet they're going<font color="#CCCCCC"> to have to do some</font>

128
00:04:59,720 --> 00:05:03,410
sort<font color="#CCCCCC"> of privilege escalation attack to</font>

129
00:05:01,070 --> 00:05:06,409
get there because<font color="#CCCCCC"> one of</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> key</font>

130
00:05:03,410 --> 00:05:07,970
components<font color="#CCCCCC"> of</font><font color="#E5E5E5"> credentials and</font><font color="#CCCCCC"> windows</font><font color="#E5E5E5"> is</font>

131
00:05:06,410 --> 00:05:09,560
there's nothing<font color="#E5E5E5"> native</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> can just</font>

132
00:05:07,970 --> 00:05:10,670
allow you to get them you're going<font color="#E5E5E5"> to</font>

133
00:05:09,560 --> 00:05:12,860
<font color="#E5E5E5">have to use some sort of attack</font>

134
00:05:10,670 --> 00:05:13,850
<font color="#CCCCCC">technique some sort of tool</font><font color="#E5E5E5"> and as we go</font>

135
00:05:12,860 --> 00:05:16,130
<font color="#E5E5E5">through these slides I'm</font><font color="#CCCCCC"> going</font><font color="#E5E5E5"> to try to</font>

136
00:05:13,850 --> 00:05:19,580
<font color="#E5E5E5">point out kind of</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> common tools that</font>

137
00:05:16,130 --> 00:05:20,659
<font color="#E5E5E5">we'll see attackers use all right so</font>

138
00:05:19,580 --> 00:05:23,930
they're<font color="#E5E5E5"> going to dump their first set of</font>

139
00:05:20,660 --> 00:05:25,550
credentials<font color="#E5E5E5"> now similar</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the all the</font>

140
00:05:23,930 --> 00:05:26,840
<font color="#CCCCCC">data</font><font color="#E5E5E5"> they want not being on this box</font>

141
00:05:25,550 --> 00:05:28,370
<font color="#E5E5E5">it's</font><font color="#CCCCCC"> very unlikely that all</font><font color="#E5E5E5"> the</font>

142
00:05:26,840 --> 00:05:30,500
credentials<font color="#CCCCCC"> they want are going to be on</font>

143
00:05:28,370 --> 00:05:32,660
<font color="#E5E5E5">this initial box so they're going to</font>

144
00:05:30,500 --> 00:05:33,650
take whatever they gather<font color="#E5E5E5"> here and with</font>

145
00:05:32,660 --> 00:05:34,940
any luck<font color="#CCCCCC"> they're going to be able</font><font color="#E5E5E5"> to</font>

146
00:05:33,650 --> 00:05:37,039
<font color="#E5E5E5">move laterally</font><font color="#CCCCCC"> through the</font><font color="#E5E5E5"> environment</font>

147
00:05:34,940 --> 00:05:38,300
<font color="#CCCCCC">they're going</font><font color="#E5E5E5"> to start kind of expanding</font>

148
00:05:37,040 --> 00:05:41,330
<font color="#E5E5E5">their influence throughout the</font>

149
00:05:38,300 --> 00:05:43,730
<font color="#E5E5E5">environment now everywhere they go</font><font color="#CCCCCC"> this</font>

150
00:05:41,330 --> 00:05:45,349
<font color="#CCCCCC">is very early</font><font color="#E5E5E5"> in their tax cycle they're</font>

151
00:05:43,730 --> 00:05:47,630
going<font color="#E5E5E5"> to as you might have guessed</font>

152
00:05:45,350 --> 00:05:49,580
<font color="#CCCCCC">dumped more credentials you're going to</font>

153
00:05:47,630 --> 00:05:51,740
see them<font color="#CCCCCC"> over and over</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> over again</font>

154
00:05:49,580 --> 00:05:53,120
dumping credentials as they move<font color="#CCCCCC"> through</font>

155
00:05:51,740 --> 00:05:55,300
<font color="#E5E5E5">the</font><font color="#CCCCCC"> environment tramp I've seen</font>

156
00:05:53,120 --> 00:05:58,040
attackers send out a<font color="#CCCCCC"> schedule task to</font>

157
00:05:55,300 --> 00:05:59,800
<font color="#CCCCCC">150 systems just</font><font color="#E5E5E5"> to dump credentials</font>

158
00:05:58,040 --> 00:06:02,419
from<font color="#E5E5E5"> every system and bring them back</font>

159
00:05:59,800 --> 00:06:03,680
<font color="#E5E5E5">the goal</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> course is that one</font><font color="#CCCCCC"> of those</font>

160
00:06:02,419 --> 00:06:06,229
credentials<font color="#CCCCCC"> is going to take them to the</font>

161
00:06:03,680 --> 00:06:08,570
<font color="#E5E5E5">next</font><font color="#CCCCCC"> level and so they're</font><font color="#E5E5E5"> going to</font>

162
00:06:06,230 --> 00:06:10,640
continue<font color="#E5E5E5"> to dump credentials until they</font>

163
00:06:08,570 --> 00:06:13,180
achieve some sort<font color="#E5E5E5"> of what I think</font>

164
00:06:10,640 --> 00:06:16,789
<font color="#E5E5E5">Microsoft nicely calls domain dominance</font>

165
00:06:13,180 --> 00:06:19,490
this means total ownage<font color="#E5E5E5"> right once you</font>

166
00:06:16,790 --> 00:06:21,169
get domain admin now you have new unpaid

167
00:06:19,490 --> 00:06:22,130
admins in<font color="#E5E5E5"> your</font><font color="#CCCCCC"> environment</font><font color="#E5E5E5"> and you get</font>

168
00:06:21,169 --> 00:06:24,680
to deal with all the fun that<font color="#E5E5E5"> comes</font>

169
00:06:22,130 --> 00:06:26,510
<font color="#E5E5E5">along with</font><font color="#CCCCCC"> that and so this of</font><font color="#E5E5E5"> course is</font>

170
00:06:24,680 --> 00:06:28,370
the<font color="#CCCCCC"> the primary goal of the attackers</font>

171
00:06:26,510 --> 00:06:29,630
<font color="#E5E5E5">early attack cycle and eventually they</font>

172
00:06:28,370 --> 00:06:31,280
are<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to get to a system</font><font color="#E5E5E5"> where</font>

173
00:06:29,630 --> 00:06:33,650
they're going to<font color="#CCCCCC"> achieve those it's</font>

174
00:06:31,280 --> 00:06:36,320
<font color="#E5E5E5">almost</font><font color="#CCCCCC"> inevitable how many pin testers</font>

175
00:06:33,650 --> 00:06:38,090
do I have in<font color="#E5E5E5"> here don't be shy</font><font color="#CCCCCC"> I know</font>

176
00:06:36,320 --> 00:06:40,460
we've<font color="#E5E5E5"> got</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> guys never want</font><font color="#CCCCCC"> to</font>

177
00:06:38,090 --> 00:06:42,200
self-identify<font color="#CCCCCC"> all</font><font color="#E5E5E5"> right of my pen</font>

178
00:06:40,460 --> 00:06:45,169
testers when's the last time you did<font color="#CCCCCC"> not</font>

179
00:06:42,200 --> 00:06:48,820
<font color="#E5E5E5">get domain admin the new one not get</font>

180
00:06:45,169 --> 00:06:52,719
domain admin in<font color="#E5E5E5"> their last attack you</font>

181
00:06:48,820 --> 00:06:52,719
<font color="#CCCCCC">scoped was that the problem</font>

182
00:06:53,709 --> 00:06:59,300
so you didn't do ain't doing<font color="#CCCCCC"> pen testing</font>

183
00:06:57,379 --> 00:07:01,069
in a Windows<font color="#CCCCCC"> environment yes</font><font color="#E5E5E5"> yeah it's</font>

184
00:06:59,300 --> 00:07:04,869
so funny I was<font color="#CCCCCC"> talking to someone it was</font>

185
00:07:01,069 --> 00:07:07,039
actually a computer network exploitation

186
00:07:04,869 --> 00:07:09,619
<font color="#E5E5E5">individual that actually was formerly at</font>

187
00:07:07,039 --> 00:07:11,360
the Fort Meade NSA<font color="#E5E5E5"> and I was like ah</font>

188
00:07:09,619 --> 00:07:13,490
<font color="#CCCCCC">okay well tell me how you simply do your</font>

189
00:07:11,360 --> 00:07:15,499
<font color="#E5E5E5">attack so you</font><font color="#CCCCCC"> can is specialize on in</font>

190
00:07:13,490 --> 00:07:17,719
<font color="#CCCCCC">UNIX systems</font><font color="#E5E5E5"> you know what's your what's</font>

191
00:07:15,499 --> 00:07:19,520
your initial kind of entry point when

192
00:07:17,719 --> 00:07:21,589
you get there well we first<font color="#E5E5E5"> go to the</font>

193
00:07:19,520 --> 00:07:23,419
<font color="#E5E5E5">Windows Network and we gather</font>

194
00:07:21,589 --> 00:07:24,349
credentials there<font color="#E5E5E5"> inevitably some of</font>

195
00:07:23,419 --> 00:07:26,779
those credentials<font color="#CCCCCC"> we'll be able to</font><font color="#E5E5E5"> reuse</font>

196
00:07:24,349 --> 00:07:28,909
<font color="#CCCCCC">in the Linux environment</font><font color="#E5E5E5"> like that</font><font color="#CCCCCC"> is</font>

197
00:07:26,779 --> 00:07:30,529
not<font color="#E5E5E5"> very exciting right that is not</font><font color="#CCCCCC"> what</font>

198
00:07:28,909 --> 00:07:32,240
I<font color="#E5E5E5"> expected you to say right I want to</font>

199
00:07:30,529 --> 00:07:36,019
<font color="#CCCCCC">hear</font><font color="#E5E5E5"> some ninja techniques you know kind</font>

200
00:07:32,240 --> 00:07:37,069
of attacking Linux<font color="#E5E5E5"> so bottom</font><font color="#CCCCCC"> line is are</font>

201
00:07:36,019 --> 00:07:38,449
<font color="#CCCCCC">eventually going to get</font><font color="#E5E5E5"> their domain</font>

202
00:07:37,069 --> 00:07:39,469
admin and this is where they're finally

203
00:07:38,449 --> 00:07:41,809
going<font color="#E5E5E5"> to</font><font color="#CCCCCC"> achieve their goals</font><font color="#E5E5E5"> and in my</font>

204
00:07:39,469 --> 00:07:44,899
<font color="#CCCCCC">experience</font><font color="#E5E5E5"> a dedicated attack group</font>

205
00:07:41,809 --> 00:07:47,330
likely achieving domain admin 24 to 48

206
00:07:44,899 --> 00:07:49,369
hours<font color="#CCCCCC"> into the into the attack</font><font color="#E5E5E5"> but the</font>

207
00:07:47,330 --> 00:07:50,808
good news<font color="#E5E5E5"> is the techniques that they're</font>

208
00:07:49,369 --> 00:07:53,149
<font color="#E5E5E5">using and what they're gathering a</font>

209
00:07:50,809 --> 00:07:54,559
relatively finite set so these are

210
00:07:53,149 --> 00:07:56,539
things<font color="#E5E5E5"> we can watch for these things we</font>

211
00:07:54,559 --> 00:07:58,729
can detect<font color="#E5E5E5"> and if we get lucky and</font>

212
00:07:56,539 --> 00:08:00,409
detect it we are<font color="#E5E5E5"> very early</font><font color="#CCCCCC"> in the</font>

213
00:07:58,729 --> 00:08:04,878
attack cycle we<font color="#CCCCCC"> can stop it well before</font>

214
00:08:00,409 --> 00:08:07,308
they can accomplish<font color="#E5E5E5"> their goals all</font>

215
00:08:04,879 --> 00:08:10,399
right<font color="#E5E5E5"> my pen testers</font>

216
00:08:07,309 --> 00:08:14,719
has anyone ever written a 140 character

217
00:08:10,399 --> 00:08:17,119
pen test report anybody<font color="#E5E5E5"> 200 characters</font>

218
00:08:14,719 --> 00:08:18,680
<font color="#E5E5E5">yeah anybody raise their hand I'm going</font>

219
00:08:17,119 --> 00:08:22,459
<font color="#E5E5E5">to switch over</font><font color="#CCCCCC"> I'm moving to the red</font>

220
00:08:18,680 --> 00:08:24,589
team right but I will<font color="#CCCCCC"> bet you</font><font color="#E5E5E5"> your 50</font>

221
00:08:22,459 --> 00:08:26,449
page<font color="#CCCCCC"> pen</font><font color="#E5E5E5"> test report doesn't</font><font color="#CCCCCC"> really say</font>

222
00:08:24,589 --> 00:08:28,009
much<font color="#CCCCCC"> more than this</font><font color="#E5E5E5"> typically</font><font color="#CCCCCC"> all</font><font color="#E5E5E5"> right</font>

223
00:08:26,449 --> 00:08:31,459
this is pretty much<font color="#CCCCCC"> the way it</font><font color="#E5E5E5"> always</font>

224
00:08:28,009 --> 00:08:33,529
goes right get an initial foothold<font color="#CCCCCC"> spear</font>

225
00:08:31,459 --> 00:08:37,610
<font color="#CCCCCC">fish attack get</font><font color="#E5E5E5"> access</font><font color="#CCCCCC"> dump credentials</font>

226
00:08:33,529 --> 00:08:43,099
move around get domain admin and get

227
00:08:37,610 --> 00:08:45,079
paid all right now there is some hope<font color="#CCCCCC"> on</font>

228
00:08:43,099 --> 00:08:47,420
<font color="#CCCCCC">the horizon I will tell you and</font><font color="#E5E5E5"> you</font>

229
00:08:45,079 --> 00:08:49,399
think<font color="#CCCCCC"> about the XP timeframe</font><font color="#E5E5E5"> total</font>

230
00:08:47,420 --> 00:08:51,229
security<font color="#CCCCCC"> disaster all</font><font color="#E5E5E5"> right there are</font>

231
00:08:49,399 --> 00:08:54,230
basically<font color="#E5E5E5"> nothing stopping credential</font>

232
00:08:51,230 --> 00:08:59,329
attacks in that world we<font color="#E5E5E5"> get the</font><font color="#CCCCCC"> Windows</font>

233
00:08:54,230 --> 00:09:01,279
<font color="#CCCCCC">7 sort</font><font color="#E5E5E5"> of not much</font><font color="#CCCCCC"> we got user access</font>

234
00:08:59,329 --> 00:09:04,279
control which really<font color="#CCCCCC"> just upset users</font>

235
00:09:01,279 --> 00:09:06,410
more than anything<font color="#E5E5E5"> but not you know user</font>

236
00:09:04,279 --> 00:09:08,149
access control can frustrate<font color="#E5E5E5"> some</font>

237
00:09:06,410 --> 00:09:10,310
<font color="#CCCCCC">firts</font><font color="#E5E5E5"> to gain credentials</font><font color="#CCCCCC"> you know the</font>

238
00:09:08,149 --> 00:09:12,980
whole idea<font color="#CCCCCC"> of the UAC was being able to</font>

239
00:09:10,310 --> 00:09:14,989
have<font color="#E5E5E5"> users</font><font color="#CCCCCC"> run as admin but not</font><font color="#E5E5E5"> allowing</font>

240
00:09:12,980 --> 00:09:17,089
kind of all their processes<font color="#E5E5E5"> you know to</font>

241
00:09:14,990 --> 00:09:19,879
run as admin even even at that kind of

242
00:09:17,089 --> 00:09:21,440
level<font color="#E5E5E5"> so kind of restricting kind of</font>

243
00:09:19,879 --> 00:09:22,279
that<font color="#E5E5E5"> lease privilege or enforcing lease</font>

244
00:09:21,440 --> 00:09:23,839
privilege

245
00:09:22,279 --> 00:09:25,910
the fortunate thing UAC is not a

246
00:09:23,839 --> 00:09:27,170
security boundary<font color="#E5E5E5"> and if you do some</font>

247
00:09:25,910 --> 00:09:30,110
searching you'll see there<font color="#E5E5E5"> are plenty of</font>

248
00:09:27,170 --> 00:09:32,029
UAC<font color="#CCCCCC"> kind</font><font color="#E5E5E5"> of attacks that allow kind of</font>

249
00:09:30,110 --> 00:09:33,589
easy<font color="#CCCCCC"> in runs around it right</font><font color="#E5E5E5"> but at</font>

250
00:09:32,029 --> 00:09:36,350
least causes attackers to work a little

251
00:09:33,589 --> 00:09:38,389
harder to get<font color="#E5E5E5"> that initial first kind of</font>

252
00:09:36,350 --> 00:09:40,009
admin rights to<font color="#CCCCCC"> dump credentials</font>

253
00:09:38,389 --> 00:09:41,300
about the only<font color="#CCCCCC"> other good thing that</font>

254
00:09:40,009 --> 00:09:43,490
<font color="#E5E5E5">came out of Windows</font><font color="#CCCCCC"> 7 was something</font>

255
00:09:41,300 --> 00:09:45,920
called managed service accounts now

256
00:09:43,490 --> 00:09:47,779
we'll come back to these but<font color="#E5E5E5"> this was</font>

257
00:09:45,920 --> 00:09:49,610
the idea of recognized effective service

258
00:09:47,779 --> 00:09:51,620
accounts are a huge liability<font color="#CCCCCC"> in your</font>

259
00:09:49,610 --> 00:09:52,519
environment<font color="#CCCCCC"> and managed service accounts</font>

260
00:09:51,620 --> 00:09:56,329
will basically<font color="#E5E5E5"> allow you to</font>

261
00:09:52,519 --> 00:09:58,220
automatically set very complex passwords

262
00:09:56,329 --> 00:10:00,469
on your service accounts and rotate

263
00:09:58,220 --> 00:10:02,870
those right now<font color="#CCCCCC"> it's I</font><font color="#E5E5E5"> think every 30</font>

264
00:10:00,470 --> 00:10:04,819
days<font color="#E5E5E5"> by default and this is all managed</font>

265
00:10:02,870 --> 00:10:07,069
<font color="#E5E5E5">to Active Directory</font><font color="#CCCCCC"> the initial</font>

266
00:10:04,819 --> 00:10:09,019
<font color="#E5E5E5">implantation of it was totally kludgy</font>

267
00:10:07,069 --> 00:10:11,089
and almost<font color="#E5E5E5"> impossible to use at scale</font>

268
00:10:09,019 --> 00:10:13,730
there's a new version<font color="#E5E5E5"> called grouped</font>

269
00:10:11,089 --> 00:10:16,040
managed service<font color="#E5E5E5"> accounts which came out</font>

270
00:10:13,730 --> 00:10:18,110
subsequently<font color="#E5E5E5"> much better and much more</font>

271
00:10:16,040 --> 00:10:19,160
realistic<font color="#CCCCCC"> so you'll see</font><font color="#E5E5E5"> that's one of</font>

272
00:10:18,110 --> 00:10:20,810
the things that I'm<font color="#E5E5E5"> going to point</font><font color="#CCCCCC"> out</font>

273
00:10:19,160 --> 00:10:23,779
<font color="#CCCCCC">the in as one of the most important</font>

274
00:10:20,810 --> 00:10:26,149
<font color="#E5E5E5">things you start thinking about now</font>

275
00:10:23,779 --> 00:10:27,980
<font color="#E5E5E5">between Windows 7 and</font><font color="#CCCCCC"> Windows 8 we had a</font>

276
00:10:26,149 --> 00:10:30,380
little<font color="#CCCCCC"> thing called</font><font color="#E5E5E5"> mini</font><font color="#CCCCCC"> cats who sort</font>

277
00:10:27,980 --> 00:10:31,759
<font color="#E5E5E5">of that yeah thank you</font><font color="#CCCCCC"> I know that</font>

278
00:10:30,380 --> 00:10:33,829
<font color="#CCCCCC">almost every</font><font color="#E5E5E5"> in the room is heard about</font>

279
00:10:31,759 --> 00:10:35,569
you know some<font color="#E5E5E5"> of the most evil kind</font><font color="#CCCCCC"> of</font>

280
00:10:33,829 --> 00:10:38,149
malware we've seen in recent<font color="#E5E5E5"> memory</font><font color="#CCCCCC"> and</font>

281
00:10:35,569 --> 00:10:40,130
<font color="#CCCCCC">Mimi</font><font color="#E5E5E5"> Katz did something that kind of</font>

282
00:10:38,149 --> 00:10:41,389
punched Microsoft in<font color="#E5E5E5"> the face</font><font color="#CCCCCC"> basically</font>

283
00:10:40,130 --> 00:10:43,459
did something<font color="#CCCCCC"> that no one</font><font color="#E5E5E5"> thought was</font>

284
00:10:41,389 --> 00:10:44,899
even<font color="#E5E5E5"> possible which is start to pull out</font>

285
00:10:43,459 --> 00:10:48,439
<font color="#E5E5E5">things like clear text passwords</font>

286
00:10:44,899 --> 00:10:51,529
<font color="#E5E5E5">and so when Windows 8 really 8.1 rolled</font>

287
00:10:48,439 --> 00:10:53,180
out<font color="#E5E5E5"> Microsoft finally you know kind of</font>

288
00:10:51,529 --> 00:10:54,740
woke up and said<font color="#CCCCCC"> my god we've got</font><font color="#E5E5E5"> to do</font>

289
00:10:53,180 --> 00:10:58,250
something<font color="#CCCCCC"> about this</font><font color="#E5E5E5"> this is insane</font>

290
00:10:54,740 --> 00:11:00,589
and so we get<font color="#E5E5E5"> a lot of great mitigation</font>

291
00:10:58,250 --> 00:11:02,779
to come out in the 8.1 world<font color="#E5E5E5"> right so</font>

292
00:11:00,589 --> 00:11:04,670
that idea<font color="#CCCCCC"> of now the removal of</font><font color="#E5E5E5"> those</font><font color="#CCCCCC"> a</font>

293
00:11:02,779 --> 00:11:06,800
<font color="#E5E5E5">lot</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> those clear text passwords</font><font color="#CCCCCC"> from</font>

294
00:11:04,670 --> 00:11:08,360
<font color="#E5E5E5">memory assuming that they're not added</font>

295
00:11:06,800 --> 00:11:11,870
back<font color="#E5E5E5"> you know through some stupid</font>

296
00:11:08,360 --> 00:11:14,329
<font color="#E5E5E5">configuration the admin is done we get</font>

297
00:11:11,870 --> 00:11:16,309
some better account restrictions there's

298
00:11:14,329 --> 00:11:18,349
a much easier<font color="#E5E5E5"> way to restrict local</font>

299
00:11:16,309 --> 00:11:20,930
accounts<font color="#E5E5E5"> from being all</font><font color="#CCCCCC"> eldest indicate</font>

300
00:11:18,350 --> 00:11:22,459
over the network<font color="#E5E5E5"> this is going to go</font>

301
00:11:20,930 --> 00:11:24,199
reduce the<font color="#CCCCCC"> attack surface</font><font color="#E5E5E5"> for things</font>

302
00:11:22,459 --> 00:11:26,959
like pass the<font color="#CCCCCC"> hash tickets or sorry</font>

303
00:11:24,200 --> 00:11:29,029
that's the hash attacks and so this is a

304
00:11:26,959 --> 00:11:32,000
this is<font color="#CCCCCC"> a big</font><font color="#E5E5E5"> win a really easy thing</font><font color="#CCCCCC"> to</font>

305
00:11:29,029 --> 00:11:33,649
kind of get implemented<font color="#E5E5E5"> protected</font>

306
00:11:32,000 --> 00:11:35,630
processes<font color="#E5E5E5"> almost all of</font><font color="#CCCCCC"> the credentials</font>

307
00:11:33,649 --> 00:11:38,180
<font color="#CCCCCC">helping tools will deal with</font><font color="#E5E5E5"> attack else</font>

308
00:11:35,630 --> 00:11:39,860
<font color="#CCCCCC">as you often inject</font><font color="#E5E5E5"> into</font><font color="#CCCCCC"> else ask</font><font color="#E5E5E5"> to get</font>

309
00:11:38,180 --> 00:11:42,050
<font color="#CCCCCC">access to those credentials</font><font color="#E5E5E5"> so now we</font>

310
00:11:39,860 --> 00:11:43,910
have a<font color="#E5E5E5"> bility to set protected processes</font>

311
00:11:42,050 --> 00:11:45,589
to<font color="#E5E5E5"> greatly restrict who is access to</font>

312
00:11:43,910 --> 00:11:48,350
<font color="#CCCCCC">something that frankly no one</font><font color="#E5E5E5"> should</font>

313
00:11:45,589 --> 00:11:49,940
<font color="#CCCCCC">have access</font><font color="#E5E5E5"> to we get into things</font><font color="#CCCCCC"> like</font>

314
00:11:48,350 --> 00:11:51,500
<font color="#E5E5E5">we stricted admin that's an idea of</font>

315
00:11:49,940 --> 00:11:53,779
trying<font color="#E5E5E5"> to reduce the attack</font><font color="#CCCCCC"> servers by</font>

316
00:11:51,500 --> 00:11:55,519
not<font color="#E5E5E5"> leaving your credentials everywhere</font>

317
00:11:53,779 --> 00:11:57,140
<font color="#E5E5E5">that admin has actually interacted with</font>

318
00:11:55,519 --> 00:11:59,329
your<font color="#E5E5E5"> environment you know right now the</font>

319
00:11:57,140 --> 00:12:01,699
<font color="#E5E5E5">current state is basically shotgunning</font>

320
00:11:59,329 --> 00:12:04,760
domain admin everywhere that admins ever

321
00:12:01,700 --> 00:12:06,110
been and<font color="#E5E5E5"> that's totally</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> fail so</font>

322
00:12:04,760 --> 00:12:07,760
restricted admin starts us down that

323
00:12:06,110 --> 00:12:09,500
<font color="#CCCCCC">path of</font><font color="#E5E5E5"> maybe reducing that attack</font>

324
00:12:07,760 --> 00:12:10,700
surface and then probably<font color="#E5E5E5"> the most</font>

325
00:12:09,500 --> 00:12:13,640
important thing we'll<font color="#E5E5E5"> talk</font><font color="#CCCCCC"> about the</font>

326
00:12:10,700 --> 00:12:16,459
entire deck<font color="#E5E5E5"> the domain protected users</font>

327
00:12:13,640 --> 00:12:18,140
group this<font color="#CCCCCC"> is a huge win</font><font color="#E5E5E5"> this is a new</font>

328
00:12:16,459 --> 00:12:21,529
<font color="#E5E5E5">group that</font><font color="#CCCCCC"> comes</font><font color="#E5E5E5"> out starting</font><font color="#CCCCCC"> with</font>

329
00:12:18,140 --> 00:12:23,300
Windows 8<font color="#CCCCCC"> that allows you to now put</font>

330
00:12:21,529 --> 00:12:25,870
<font color="#E5E5E5">your highly privileged accounts inside</font>

331
00:12:23,300 --> 00:12:28,130
of it<font color="#E5E5E5"> and it greatly</font><font color="#CCCCCC"> reduces the</font>

332
00:12:25,870 --> 00:12:32,690
capabilities<font color="#CCCCCC"> of those accounts</font><font color="#E5E5E5"> to read</font>

333
00:12:28,130 --> 00:12:34,880
<font color="#E5E5E5">they're really sensitive tokens hashes</font>

334
00:12:32,690 --> 00:12:35,839
kind of around the environment<font color="#CCCCCC"> now so</font>

335
00:12:34,880 --> 00:12:37,339
we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to see we're</font><font color="#E5E5E5"> going</font><font color="#CCCCCC"> to see</font>

336
00:12:35,839 --> 00:12:39,860
<font color="#E5E5E5">that kind</font><font color="#CCCCCC"> of reference as we go through</font>

337
00:12:37,339 --> 00:12:42,050
as a excellent kind of mitigation piece

338
00:12:39,860 --> 00:12:44,089
<font color="#E5E5E5">it's a no-brainer</font><font color="#CCCCCC"> to do you know it'll</font>

339
00:12:42,050 --> 00:12:45,829
<font color="#E5E5E5">make your admins job</font><font color="#CCCCCC"> maybe</font><font color="#E5E5E5"> a little more</font>

340
00:12:44,089 --> 00:12:47,540
<font color="#E5E5E5">difficult</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> have to figure out some</font>

341
00:12:45,829 --> 00:12:50,000
ways for<font color="#E5E5E5"> instance delegate tokens they</font>

342
00:12:47,540 --> 00:12:52,939
won't be able to<font color="#E5E5E5"> just single sign-on</font><font color="#CCCCCC"> to</font>

343
00:12:50,000 --> 00:12:55,010
<font color="#CCCCCC">third-party</font><font color="#E5E5E5"> systems</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> it is a huge win</font>

344
00:12:52,940 --> 00:12:57,529
from preventing attackers from<font color="#E5E5E5"> getting</font>

345
00:12:55,010 --> 00:12:59,779
<font color="#E5E5E5">access to</font><font color="#CCCCCC"> those credentials another good</font>

346
00:12:57,529 --> 00:13:01,070
news is<font color="#E5E5E5"> these were so</font><font color="#CCCCCC"> popular that most</font>

347
00:12:59,779 --> 00:13:03,410
of these<font color="#E5E5E5"> have now been back ported to</font>

348
00:13:01,070 --> 00:13:05,779
Windows<font color="#E5E5E5"> 7 so</font><font color="#CCCCCC"> you really have no excuse</font>

349
00:13:03,410 --> 00:13:07,430
to not<font color="#CCCCCC"> implement some of</font><font color="#E5E5E5"> these so you</font>

350
00:13:05,779 --> 00:13:10,250
might<font color="#CCCCCC"> be</font><font color="#E5E5E5"> familiar with the past the hash</font>

351
00:13:07,430 --> 00:13:12,439
patch<font color="#E5E5E5"> which didn't</font><font color="#CCCCCC"> really prevent past</font>

352
00:13:10,250 --> 00:13:14,000
the hash<font color="#E5E5E5"> but certainly added a bunch of</font>

353
00:13:12,440 --> 00:13:16,760
<font color="#E5E5E5">these capabilities that's now been back</font>

354
00:13:14,000 --> 00:13:18,170
ported back to your older systems then

355
00:13:16,760 --> 00:13:19,760
finally in the new<font color="#E5E5E5"> world we live in</font>

356
00:13:18,170 --> 00:13:21,019
Windows 10 I'm sure you're all

357
00:13:19,760 --> 00:13:22,010
implementing Windows 10 in your

358
00:13:21,019 --> 00:13:26,180
<font color="#CCCCCC">enterprise</font><font color="#E5E5E5"> right now</font>

359
00:13:22,010 --> 00:13:28,100
and when we get there<font color="#CCCCCC"> we do get some</font>

360
00:13:26,180 --> 00:13:30,670
additional<font color="#E5E5E5"> capabilities credential guard</font>

361
00:13:28,100 --> 00:13:33,920
here is probably<font color="#E5E5E5"> the big win this is a</font>

362
00:13:30,670 --> 00:13:35,389
truly kind<font color="#CCCCCC"> of revolutionary piece</font>

363
00:13:33,920 --> 00:13:37,429
finally we get<font color="#CCCCCC"> to a point where we may</font>

364
00:13:35,389 --> 00:13:39,529
be able to prevent the<font color="#E5E5E5"> access to things</font>

365
00:13:37,429 --> 00:13:40,879
like<font color="#E5E5E5"> caches and tickets</font><font color="#CCCCCC"> basically what's</font>

366
00:13:39,529 --> 00:13:42,589
happening is they're taking<font color="#E5E5E5"> that L SAS</font>

367
00:13:40,879 --> 00:13:44,899
process<font color="#E5E5E5"> moving into a protected</font>

368
00:13:42,589 --> 00:13:46,819
hypervisor<font color="#CCCCCC"> so all of</font><font color="#E5E5E5"> your kind of</font>

369
00:13:44,899 --> 00:13:49,809
<font color="#E5E5E5">credentials now are in a very protected</font>

370
00:13:46,819 --> 00:13:52,459
space like an<font color="#CCCCCC"> enclave with very very few</font>

371
00:13:49,809 --> 00:13:54,019
functions that<font color="#E5E5E5"> can</font><font color="#CCCCCC"> access them</font><font color="#E5E5E5"> I'm not</font>

372
00:13:52,459 --> 00:13:56,628
<font color="#E5E5E5">saying this will never be compromised</font>

373
00:13:54,019 --> 00:13:58,639
<font color="#E5E5E5">but certainly it breaks all current set</font>

374
00:13:56,629 --> 00:14:00,529
of tools out<font color="#E5E5E5"> there</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> only problem is</font>

375
00:13:58,639 --> 00:14:02,869
you need<font color="#E5E5E5"> certain hardware and certain</font>

376
00:14:00,529 --> 00:14:03,859
software<font color="#E5E5E5"> to get it up and</font><font color="#CCCCCC"> running but</font>

377
00:14:02,869 --> 00:14:06,079
<font color="#E5E5E5">this is something</font><font color="#CCCCCC"> that's going to</font><font color="#E5E5E5"> be a</font>

378
00:14:03,859 --> 00:14:07,489
potential<font color="#E5E5E5"> big win</font><font color="#CCCCCC"> finally for us to</font>

379
00:14:06,079 --> 00:14:10,309
finally stop attackers from<font color="#E5E5E5"> getting</font>

380
00:14:07,489 --> 00:14:12,019
those those easy wins<font color="#E5E5E5"> remote credential</font>

381
00:14:10,309 --> 00:14:14,629
guard is an update to<font color="#E5E5E5"> restricted admin</font>

382
00:14:12,019 --> 00:14:16,999
that's<font color="#E5E5E5"> a better</font><font color="#CCCCCC"> implementation not just</font>

383
00:14:14,629 --> 00:14:20,989
admin but any account<font color="#E5E5E5"> again protecting</font>

384
00:14:16,999 --> 00:14:22,339
any accounts that are authenticating

385
00:14:20,989 --> 00:14:24,769
over the network<font color="#CCCCCC"> right</font><font color="#E5E5E5"> through things</font>

386
00:14:22,339 --> 00:14:26,410
like RDP and then finally device guard

387
00:14:24,769 --> 00:14:28,009
is basically an upgrade to a blocker

388
00:14:26,410 --> 00:14:29,988
<font color="#E5E5E5">whitelisting capability that will</font>

389
00:14:28,009 --> 00:14:32,540
prevent certain binaries from running<font color="#CCCCCC"> so</font>

390
00:14:29,989 --> 00:14:34,939
this implemented correctly<font color="#E5E5E5"> could</font>

391
00:14:32,540 --> 00:14:36,319
<font color="#E5E5E5">basically break again all of our known</font>

392
00:14:34,939 --> 00:14:39,649
attack tools because<font color="#E5E5E5"> essentially doing</font>

393
00:14:36,319 --> 00:14:41,959
application whitelisting<font color="#E5E5E5"> so hope</font><font color="#CCCCCC"> on</font>

394
00:14:39,649 --> 00:14:43,069
<font color="#CCCCCC">there ivan</font><font color="#E5E5E5"> as we're going to see we're</font>

395
00:14:41,959 --> 00:14:45,229
<font color="#E5E5E5">severely outmatched</font>

396
00:14:43,069 --> 00:14:46,998
these mitigations<font color="#E5E5E5"> are not going to be</font>

397
00:14:45,230 --> 00:14:48,169
the Silver<font color="#CCCCCC"> Bullet for us but what I'm</font>

398
00:14:46,999 --> 00:14:51,319
going to do is<font color="#CCCCCC"> reference these as we</font><font color="#E5E5E5"> go</font>

399
00:14:48,169 --> 00:14:52,489
through with a thought<font color="#CCCCCC"> of trying</font><font color="#E5E5E5"> to talk</font>

400
00:14:51,319 --> 00:14:55,759
<font color="#CCCCCC">about how we</font><font color="#E5E5E5"> can at least make our</font>

401
00:14:52,489 --> 00:14:57,049
attackers<font color="#CCCCCC"> life's more</font><font color="#E5E5E5"> difficult</font><font color="#CCCCCC"> ok so</font>

402
00:14:55,759 --> 00:15:01,489
who's been in security more than<font color="#CCCCCC"> 10</font>

403
00:14:57,049 --> 00:15:04,549
years<font color="#CCCCCC"> Thank You Han</font><font color="#E5E5E5"> all right</font><font color="#CCCCCC"> of those</font>

404
00:15:01,489 --> 00:15:07,389
ahead your hands up who remembers

405
00:15:04,549 --> 00:15:09,949
talking<font color="#CCCCCC"> about hashes</font><font color="#E5E5E5"> over</font><font color="#CCCCCC"> ten years ago</font>

406
00:15:07,389 --> 00:15:11,629
<font color="#E5E5E5">yeah</font><font color="#CCCCCC"> this is a gimme right we've been</font>

407
00:15:09,949 --> 00:15:13,790
<font color="#E5E5E5">talking about hashes forever right we</font>

408
00:15:11,629 --> 00:15:15,769
started<font color="#E5E5E5"> with land man hashes those have</font>

409
00:15:13,790 --> 00:15:17,269
<font color="#E5E5E5">been largely deprecated although there's</font>

410
00:15:15,769 --> 00:15:18,559
probably<font color="#E5E5E5"> environments that you guys are</font>

411
00:15:17,269 --> 00:15:20,689
<font color="#CCCCCC">working and where it may still be</font>

412
00:15:18,559 --> 00:15:22,219
present<font color="#E5E5E5"> now we're at the in T hash we've</font>

413
00:15:20,689 --> 00:15:24,618
known the NT hashes<font color="#CCCCCC"> are incredibly</font>

414
00:15:22,220 --> 00:15:28,149
insecure for I don't<font color="#E5E5E5"> know a good decade</font>

415
00:15:24,619 --> 00:15:29,720
or longer<font color="#CCCCCC"> right no salt totally</font>

416
00:15:28,149 --> 00:15:31,279
vulnerable<font color="#CCCCCC"> to</font><font color="#E5E5E5"> things like</font>

417
00:15:29,720 --> 00:15:34,189
pre-computation attacks and rainbow

418
00:15:31,279 --> 00:15:35,869
tables<font color="#CCCCCC"> these are one of the first</font><font color="#E5E5E5"> things</font>

419
00:15:34,189 --> 00:15:37,368
that attackers<font color="#E5E5E5"> will try to dump when</font>

420
00:15:35,869 --> 00:15:39,319
they get on<font color="#CCCCCC"> a system right it's been</font>

421
00:15:37,369 --> 00:15:41,779
this way for probably<font color="#E5E5E5"> 15 plus</font><font color="#CCCCCC"> years</font>

422
00:15:39,319 --> 00:15:44,089
maybe two decades<font color="#E5E5E5"> attackers have been</font>

423
00:15:41,779 --> 00:15:46,519
<font color="#E5E5E5">going after</font><font color="#CCCCCC"> our hashes</font><font color="#E5E5E5"> now the</font>

424
00:15:44,089 --> 00:15:47,779
old-school<font color="#E5E5E5"> techniques when you know new</font>

425
00:15:46,519 --> 00:15:49,519
<font color="#CCCCCC">old</font><font color="#E5E5E5"> timers were getting</font>

426
00:15:47,779 --> 00:15:53,360
your initial training<font color="#CCCCCC"> was to dump</font><font color="#E5E5E5"> the</font>

427
00:15:49,519 --> 00:15:54,949
hashes<font color="#CCCCCC"> and do what crack</font><font color="#E5E5E5"> them right so</font>

428
00:15:53,360 --> 00:15:56,329
you<font color="#E5E5E5"> dump them crack them we still do</font>

429
00:15:54,949 --> 00:15:58,339
<font color="#E5E5E5">that</font><font color="#CCCCCC"> a day</font><font color="#E5E5E5"> because it's fun we</font><font color="#CCCCCC"> still</font>

430
00:15:56,329 --> 00:15:59,779
like hackers<font color="#E5E5E5"> but I'm telling you</font><font color="#CCCCCC"> we</font>

431
00:15:58,339 --> 00:16:01,040
<font color="#E5E5E5">don't even have to do that anymore</font><font color="#CCCCCC"> all</font>

432
00:15:59,779 --> 00:16:02,810
<font color="#E5E5E5">right so hopefully</font><font color="#CCCCCC"> you've heard of</font>

433
00:16:01,040 --> 00:16:03,889
things like pass<font color="#CCCCCC"> the hash</font><font color="#E5E5E5"> where you</font>

434
00:16:02,810 --> 00:16:04,969
don't even<font color="#E5E5E5"> need</font><font color="#CCCCCC"> to crack the hash</font>

435
00:16:03,889 --> 00:16:08,059
<font color="#E5E5E5">anymore you're nice</font>

436
00:16:04,970 --> 00:16:10,100
25 character passwords so long and

437
00:16:08,059 --> 00:16:12,350
complex it makes<font color="#E5E5E5"> your fingers bleed</font><font color="#CCCCCC"> when</font>

438
00:16:10,100 --> 00:16:13,759
you type it in<font color="#CCCCCC"> it</font><font color="#E5E5E5"> doesn't matter because</font>

439
00:16:12,350 --> 00:16:15,259
<font color="#E5E5E5">if you have the hash we can simply</font>

440
00:16:13,759 --> 00:16:18,259
replay it through the environment<font color="#CCCCCC"> and</font>

441
00:16:15,259 --> 00:16:19,730
I'll syndicate with just a hash one<font color="#E5E5E5"> of</font>

442
00:16:18,259 --> 00:16:21,800
the biggest vulnerabilities that's come

443
00:16:19,730 --> 00:16:23,029
out<font color="#E5E5E5"> as you can see tons of tools down</font>

444
00:16:21,800 --> 00:16:25,459
here<font color="#CCCCCC"> that allow us access to</font><font color="#E5E5E5"> these</font>

445
00:16:23,029 --> 00:16:29,329
hashes<font color="#E5E5E5"> you know kind of the the rogues</font>

446
00:16:25,459 --> 00:16:30,709
gallery here now one<font color="#CCCCCC"> of the interesting</font>

447
00:16:29,329 --> 00:16:33,138
things I've<font color="#E5E5E5"> seen in the wild is that</font>

448
00:16:30,709 --> 00:16:33,859
<font color="#E5E5E5">while we get a lot of custom malware you</font>

449
00:16:33,139 --> 00:16:36,139
know we're all dealing<font color="#E5E5E5"> with</font>

450
00:16:33,860 --> 00:16:38,120
<font color="#E5E5E5">nation-states now or highly resourced</font>

451
00:16:36,139 --> 00:16:39,379
criminal syndicates<font color="#CCCCCC"> with obvious</font>

452
00:16:38,120 --> 00:16:41,149
capabilities to develop<font color="#CCCCCC"> their own</font>

453
00:16:39,379 --> 00:16:43,370
malware one of the most interesting

454
00:16:41,149 --> 00:16:45,019
<font color="#E5E5E5">things</font><font color="#CCCCCC"> is that the</font><font color="#E5E5E5"> one tool that most</font>

455
00:16:43,370 --> 00:16:47,360
attack groups are not implementing are

456
00:16:45,019 --> 00:16:49,249
the credential dumping tools these<font color="#CCCCCC"> works</font>

457
00:16:47,360 --> 00:16:51,980
<font color="#E5E5E5">so well there's</font><font color="#CCCCCC"> just no incentive for</font>

458
00:16:49,249 --> 00:16:53,389
<font color="#E5E5E5">them</font><font color="#CCCCCC"> to go build their own</font><font color="#E5E5E5"> and so it's a</font>

459
00:16:51,980 --> 00:16:54,949
you know<font color="#E5E5E5"> you took at any attack I think</font>

460
00:16:53,389 --> 00:16:56,839
<font color="#E5E5E5">every attack I've seen</font><font color="#CCCCCC"> in the</font><font color="#E5E5E5"> last five</font>

461
00:16:54,949 --> 00:16:58,459
<font color="#CCCCCC">years probably had me me</font><font color="#E5E5E5"> cats involved</font>

462
00:16:56,839 --> 00:17:00,500
in it right<font color="#CCCCCC"> you just</font><font color="#E5E5E5"> got to learn</font><font color="#CCCCCC"> to</font>

463
00:16:58,459 --> 00:17:04,398
look for<font color="#E5E5E5"> that type of attack and your</font>

464
00:17:00,500 --> 00:17:07,490
<font color="#E5E5E5">role along your way all right</font><font color="#CCCCCC"> so we get</font>

465
00:17:04,398 --> 00:17:09,500
<font color="#E5E5E5">our hashes right now one thing I think</font>

466
00:17:07,490 --> 00:17:13,309
<font color="#CCCCCC">the security community has absolutely</font>

467
00:17:09,500 --> 00:17:14,750
woken up to is this idea of where our

468
00:17:13,309 --> 00:17:16,010
hashes are being stored I think finally

469
00:17:14,750 --> 00:17:18,589
<font color="#E5E5E5">we're realizing this is an important</font>

470
00:17:16,010 --> 00:17:21,829
<font color="#CCCCCC">concept so you know just as a quick</font>

471
00:17:18,589 --> 00:17:23,500
<font color="#CCCCCC">review any interactive</font><font color="#E5E5E5"> logon your</font>

472
00:17:21,829 --> 00:17:25,339
credentials are going to be in play

473
00:17:23,500 --> 00:17:29,240
<font color="#E5E5E5">interactive logon</font><font color="#CCCCCC"> smeeting at the</font>

474
00:17:25,339 --> 00:17:30,770
console RDP you do a run as<font color="#CCCCCC"> alright</font><font color="#E5E5E5"> when</font>

475
00:17:29,240 --> 00:17:32,990
you do those and<font color="#E5E5E5"> you're authenticated to</font>

476
00:17:30,770 --> 00:17:34,610
that remote system your<font color="#E5E5E5"> credentials are</font>

477
00:17:32,990 --> 00:17:37,070
<font color="#E5E5E5">now present on that remote system for</font>

478
00:17:34,610 --> 00:17:38,418
the length of<font color="#CCCCCC"> your session if an</font>

479
00:17:37,070 --> 00:17:40,370
attacker happens to<font color="#E5E5E5"> stumble upon that</font>

480
00:17:38,419 --> 00:17:43,070
box<font color="#E5E5E5"> they can easily dump your</font>

481
00:17:40,370 --> 00:17:45,949
credentials<font color="#E5E5E5"> and now they're off using</font>

482
00:17:43,070 --> 00:17:47,240
<font color="#CCCCCC">your credentials</font><font color="#E5E5E5"> for evil so what we</font>

483
00:17:45,950 --> 00:17:48,980
have to do is we have to<font color="#E5E5E5"> take the</font>

484
00:17:47,240 --> 00:17:51,500
<font color="#CCCCCC">knowledge as a</font><font color="#E5E5E5"> security community we</font>

485
00:17:48,980 --> 00:17:53,270
have<font color="#CCCCCC"> to filter</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> down to the admins</font>

486
00:17:51,500 --> 00:17:54,919
where it really<font color="#E5E5E5"> matters</font><font color="#CCCCCC"> I think most of</font>

487
00:17:53,270 --> 00:17:56,480
us<font color="#E5E5E5"> are</font><font color="#CCCCCC"> probably good with this but I</font>

488
00:17:54,919 --> 00:17:58,520
know that most admins are not most

489
00:17:56,480 --> 00:18:00,080
<font color="#CCCCCC">elements have no idea</font><font color="#E5E5E5"> that when they RDP</font>

490
00:17:58,520 --> 00:18:00,999
to assist them<font color="#E5E5E5"> with their domain admin</font>

491
00:18:00,080 --> 00:18:02,379
creds<font color="#E5E5E5"> the</font>

492
00:18:00,999 --> 00:18:04,929
<font color="#E5E5E5">the domain</font><font color="#CCCCCC"> creds are now going</font><font color="#E5E5E5"> to be</font>

493
00:18:02,379 --> 00:18:06,218
present<font color="#E5E5E5"> on every mo system right even</font>

494
00:18:04,929 --> 00:18:09,459
worse than<font color="#CCCCCC"> that they make stupid</font>

495
00:18:06,219 --> 00:18:12,429
mistakes<font color="#CCCCCC"> now so when</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> RDP</font><font color="#E5E5E5"> you can</font>

496
00:18:09,459 --> 00:18:14,379
either close your RDP session<font color="#CCCCCC"> alright so</font>

497
00:18:12,429 --> 00:18:18,039
you can<font color="#E5E5E5"> actually log off or</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> can do</font>

498
00:18:14,379 --> 00:18:20,559
what just X out<font color="#CCCCCC"> and close the client</font>

499
00:18:18,039 --> 00:18:22,779
right when you X out<font color="#CCCCCC"> and close that</font>

500
00:18:20,559 --> 00:18:24,459
client your session is<font color="#E5E5E5"> still present on</font>

501
00:18:22,779 --> 00:18:25,689
<font color="#E5E5E5">that remote system you might have run</font>

502
00:18:24,459 --> 00:18:27,459
into<font color="#E5E5E5"> this sometimes you'll run into a</font>

503
00:18:25,689 --> 00:18:29,259
box like your own<font color="#CCCCCC"> you'll go into work in</font>

504
00:18:27,459 --> 00:18:30,759
<font color="#E5E5E5">the</font><font color="#CCCCCC"> morning and you'll go</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> login</font><font color="#E5E5E5"> I'll</font>

505
00:18:29,259 --> 00:18:32,859
say do you want me to<font color="#E5E5E5"> log out the admin</font>

506
00:18:30,759 --> 00:18:34,569
<font color="#CCCCCC">because they were I</font><font color="#E5E5E5"> in your system</font>

507
00:18:32,859 --> 00:18:36,428
overnight<font color="#E5E5E5"> maybe patching it and they</font>

508
00:18:34,569 --> 00:18:38,589
just<font color="#CCCCCC"> closed their RDP client they didn't</font>

509
00:18:36,429 --> 00:18:40,119
actually<font color="#E5E5E5"> log out of</font><font color="#CCCCCC"> your box your their</font>

510
00:18:38,589 --> 00:18:43,418
credentials are still present<font color="#CCCCCC"> on</font><font color="#E5E5E5"> that</font>

511
00:18:40,119 --> 00:18:45,069
system<font color="#CCCCCC"> we've</font><font color="#E5E5E5"> got to retrain well we got</font>

512
00:18:43,419 --> 00:18:46,239
a retrain our admin and we've got to

513
00:18:45,069 --> 00:18:48,039
take the keys to the kingdom<font color="#E5E5E5"> out of</font>

514
00:18:46,239 --> 00:18:49,929
<font color="#CCCCCC">their hands</font><font color="#E5E5E5"> until they can actually use</font>

515
00:18:48,039 --> 00:18:51,489
it effectively<font color="#CCCCCC"> map</font><font color="#E5E5E5"> so lots of</font><font color="#CCCCCC"> different</font>

516
00:18:49,929 --> 00:18:54,099
<font color="#E5E5E5">ways probably the most effective way on</font>

517
00:18:51,489 --> 00:18:55,719
this<font color="#E5E5E5"> on this chart PowerShell when you</font>

518
00:18:54,099 --> 00:18:57,428
get to PowerShell remoting<font color="#CCCCCC"> all of a</font>

519
00:18:55,719 --> 00:18:59,169
sudden it's no matter what you're<font color="#E5E5E5"> doing</font>

520
00:18:57,429 --> 00:19:00,609
<font color="#CCCCCC">if you open up a remote</font><font color="#E5E5E5"> terminal using</font>

521
00:18:59,169 --> 00:19:02,139
PowerShell that's still a non

522
00:19:00,609 --> 00:19:04,418
interactive<font color="#E5E5E5"> logon it's about the</font>

523
00:19:02,139 --> 00:19:07,299
<font color="#CCCCCC">best-case scenario using</font><font color="#E5E5E5"> the best of</font>

524
00:19:04,419 --> 00:19:09,309
<font color="#CCCCCC">Windows authentication</font><font color="#E5E5E5"> and you're not</font>

525
00:19:07,299 --> 00:19:12,189
<font color="#E5E5E5">sending your credentials all over the</font>

526
00:19:09,309 --> 00:19:15,999
place<font color="#E5E5E5"> so we've got to train our admins</font>

527
00:19:12,189 --> 00:19:19,089
to<font color="#E5E5E5"> do this more reasonable alright so</font>

528
00:19:15,999 --> 00:19:21,449
how does this work<font color="#CCCCCC"> GG sect dump a very</font>

529
00:19:19,089 --> 00:19:23,708
very<font color="#E5E5E5"> common tool so often see this</font>

530
00:19:21,449 --> 00:19:26,019
<font color="#E5E5E5">actually in this example this is a very</font>

531
00:19:23,709 --> 00:19:27,359
common place we'll see it<font color="#E5E5E5"> what this</font>

532
00:19:26,019 --> 00:19:29,579
example was done on a domain<font color="#E5E5E5"> controller</font>

533
00:19:27,359 --> 00:19:31,658
<font color="#CCCCCC">so what we're seeing</font><font color="#E5E5E5"> here is at the top</font>

534
00:19:29,579 --> 00:19:33,519
<font color="#CCCCCC">we're elevating our privileges from</font>

535
00:19:31,659 --> 00:19:34,839
admin up to the system account<font color="#E5E5E5"> so a lot</font>

536
00:19:33,519 --> 00:19:36,399
of<font color="#CCCCCC"> these tools require actually system</font>

537
00:19:34,839 --> 00:19:38,859
level privileges to actually do the

538
00:19:36,399 --> 00:19:40,779
injection<font color="#E5E5E5"> kind of into L SAS to actually</font>

539
00:19:38,859 --> 00:19:43,059
pull<font color="#E5E5E5"> the credentials out and then we're</font>

540
00:19:40,779 --> 00:19:47,009
<font color="#CCCCCC">simply just</font><font color="#E5E5E5"> running the tool ji-suk dump</font>

541
00:19:43,059 --> 00:19:47,009
<font color="#E5E5E5">and dumping the output to a text file</font>

542
00:19:47,189 --> 00:19:51,549
the<font color="#CCCCCC"> contents</font><font color="#E5E5E5"> of text file look like this</font>

543
00:19:49,569 --> 00:19:54,849
this<font color="#E5E5E5"> won't surprise anyone we get a huge</font>

544
00:19:51,549 --> 00:19:56,949
<font color="#E5E5E5">collection of hashes but remember what I</font>

545
00:19:54,849 --> 00:19:58,718
just<font color="#CCCCCC"> said</font><font color="#E5E5E5"> I just said that I should only</font>

546
00:19:56,949 --> 00:20:01,629
be<font color="#E5E5E5"> seeing the hashes on the system of</font>

547
00:19:58,719 --> 00:20:02,679
the current login<font color="#CCCCCC"> sessions this</font><font color="#E5E5E5"> is</font>

548
00:20:01,629 --> 00:20:03,069
actually something<font color="#CCCCCC"> that wasn't</font><font color="#E5E5E5"> always</font>

549
00:20:02,679 --> 00:20:05,469
<font color="#CCCCCC">the case</font>

550
00:20:03,069 --> 00:20:06,789
I think<font color="#E5E5E5"> XP service pack 2 started to</font>

551
00:20:05,469 --> 00:20:09,549
enforce<font color="#CCCCCC"> that where they try</font><font color="#E5E5E5"> to clean up</font>

552
00:20:06,789 --> 00:20:11,440
<font color="#E5E5E5">the</font><font color="#CCCCCC"> sessions when you close them</font><font color="#E5E5E5"> out but</font>

553
00:20:09,549 --> 00:20:13,089
we're seeing hundreds in this in this

554
00:20:11,440 --> 00:20:14,440
<font color="#E5E5E5">example there were hundreds of hashes</font>

555
00:20:13,089 --> 00:20:16,149
available on<font color="#E5E5E5"> this box</font>

556
00:20:14,440 --> 00:20:17,230
and the reason is<font color="#CCCCCC"> because what I</font><font color="#E5E5E5"> just</font>

557
00:20:16,149 --> 00:20:18,969
<font color="#E5E5E5">mentioned this actually happen to be a</font>

558
00:20:17,230 --> 00:20:21,309
domain<font color="#E5E5E5"> controller</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> domain controller</font>

559
00:20:18,970 --> 00:20:22,750
is leveraging hundreds of current

560
00:20:21,309 --> 00:20:24,340
concurrent kind of logon sessions

561
00:20:22,750 --> 00:20:26,710
<font color="#E5E5E5">through that environment and this is why</font>

562
00:20:24,340 --> 00:20:28,600
you'll see<font color="#E5E5E5"> a lot of attackers taking the</font>

563
00:20:26,710 --> 00:20:30,429
very risky<font color="#CCCCCC"> move of dropping to your</font>

564
00:20:28,600 --> 00:20:32,980
<font color="#E5E5E5">domain controller and running you know</font>

565
00:20:30,429 --> 00:20:34,779
pretty evil malware on it<font color="#E5E5E5"> you know if</font>

566
00:20:32,980 --> 00:20:36,549
you're<font color="#CCCCCC"> a good attacker stay away from</font>

567
00:20:34,779 --> 00:20:38,679
the domain controller right<font color="#E5E5E5"> this is the</font>

568
00:20:36,549 --> 00:20:41,980
one place that admins will actually kind

569
00:20:38,679 --> 00:20:43,600
of look at<font color="#E5E5E5"> and monitor but sometimes you</font>

570
00:20:41,980 --> 00:20:46,090
just got to<font color="#E5E5E5"> do what you</font><font color="#CCCCCC"> got to do</font><font color="#E5E5E5"> right</font>

571
00:20:43,600 --> 00:20:47,259
<font color="#CCCCCC">and so</font><font color="#E5E5E5"> a common technique you'll see is</font>

572
00:20:46,090 --> 00:20:49,750
dropping over the main controller

573
00:20:47,259 --> 00:20:52,330
<font color="#E5E5E5">running</font><font color="#CCCCCC"> a tool like g6</font><font color="#E5E5E5"> dump now I've got</font>

574
00:20:49,750 --> 00:20:53,860
you know 100 plus hashes on there<font color="#E5E5E5"> the</font>

575
00:20:52,330 --> 00:20:58,178
odds<font color="#E5E5E5"> of one of those being a highly</font>

576
00:20:53,860 --> 00:21:01,479
privileged user very high<font color="#CCCCCC"> alright so</font>

577
00:20:58,179 --> 00:21:03,429
once I<font color="#CCCCCC"> get</font><font color="#E5E5E5"> these hashes</font><font color="#CCCCCC"> well now I can</font>

578
00:21:01,480 --> 00:21:06,460
go to<font color="#E5E5E5"> a tool like</font><font color="#CCCCCC"> Mimi cats or</font>

579
00:21:03,429 --> 00:21:08,320
<font color="#CCCCCC">Metasploit</font><font color="#E5E5E5"> or your tool of choice and</font><font color="#CCCCCC"> do</font>

580
00:21:06,460 --> 00:21:10,059
what we call pass the hash attack<font color="#CCCCCC"> all</font>

581
00:21:08,320 --> 00:21:12,549
I'm<font color="#CCCCCC"> doing is essentially</font><font color="#E5E5E5"> feeding one of</font>

582
00:21:10,059 --> 00:21:15,759
<font color="#CCCCCC">those hashes I just retrieved to my tool</font>

583
00:21:12,549 --> 00:21:18,190
and as<font color="#E5E5E5"> that to authenticate now I'm</font>

584
00:21:15,759 --> 00:21:20,610
actually<font color="#E5E5E5"> authenticating as that user in</font>

585
00:21:18,190 --> 00:21:23,799
this<font color="#E5E5E5"> case we yanked the helpdesk account</font>

586
00:21:20,610 --> 00:21:25,629
<font color="#E5E5E5">so now I've got the hash and I'm</font><font color="#CCCCCC"> able to</font>

587
00:21:23,799 --> 00:21:27,658
start to traverse or laterally move the

588
00:21:25,629 --> 00:21:30,939
network as that helped us account

589
00:21:27,659 --> 00:21:34,779
literally one line using<font color="#CCCCCC"> mimic acts and</font>

590
00:21:30,940 --> 00:21:36,129
now<font color="#CCCCCC"> in that person this</font><font color="#E5E5E5"> is a classic</font>

591
00:21:34,779 --> 00:21:38,379
example<font color="#E5E5E5"> what we call pass the hash</font>

592
00:21:36,129 --> 00:21:42,149
attack take the hash replay get through

593
00:21:38,379 --> 00:21:42,149
the environment<font color="#E5E5E5"> to accomplish my goals</font>

594
00:21:42,240 --> 00:21:46,870
anybody seen this in real life<font color="#E5E5E5"> anybody</font>

595
00:21:44,620 --> 00:21:48,189
<font color="#CCCCCC">done this</font><font color="#E5E5E5"> I hope we've got some pin</font>

596
00:21:46,870 --> 00:21:53,949
testers<font color="#E5E5E5"> you</font><font color="#CCCCCC"> must</font><font color="#E5E5E5"> certainly have done</font>

597
00:21:48,190 --> 00:21:58,480
<font color="#CCCCCC">pass the hash all right how do we</font>

598
00:21:53,950 --> 00:22:01,659
<font color="#E5E5E5">protect about against this simple this</font>

599
00:21:58,480 --> 00:22:03,039
<font color="#CCCCCC">is all you</font><font color="#E5E5E5"> have to do seriously so go</font>

600
00:22:01,659 --> 00:22:05,440
back and<font color="#CCCCCC"> just stop attackers from</font>

601
00:22:03,039 --> 00:22:07,210
<font color="#E5E5E5">getting admin rights and when you figure</font>

602
00:22:05,440 --> 00:22:09,279
out how to do that<font color="#CCCCCC"> please</font><font color="#E5E5E5"> email me tell</font>

603
00:22:07,210 --> 00:22:13,330
me how you did<font color="#E5E5E5"> it it's basically</font>

604
00:22:09,279 --> 00:22:14,860
<font color="#CCCCCC">impossible right</font><font color="#E5E5E5"> now sad so</font><font color="#CCCCCC"> sad but this</font>

605
00:22:13,330 --> 00:22:17,080
is<font color="#E5E5E5"> just something we</font><font color="#CCCCCC"> have proven as a</font>

606
00:22:14,860 --> 00:22:19,269
community<font color="#E5E5E5"> we're just virtually</font>

607
00:22:17,080 --> 00:22:21,428
impossible at<font color="#E5E5E5"> this</font><font color="#CCCCCC"> point but if we could</font>

608
00:22:19,269 --> 00:22:22,730
all of these attacks I'll talk about<font color="#CCCCCC"> for</font>

609
00:22:21,429 --> 00:22:24,980
the<font color="#E5E5E5"> rest of this deck</font>

610
00:22:22,730 --> 00:22:26,780
<font color="#CCCCCC">I actually require admin</font><font color="#E5E5E5"> rights so if we</font>

611
00:22:24,980 --> 00:22:29,780
ever got<font color="#E5E5E5"> to this magic land where we</font>

612
00:22:26,780 --> 00:22:31,820
could enforce<font color="#E5E5E5"> privileges well we'd be we</font>

613
00:22:29,780 --> 00:22:33,799
be well off<font color="#CCCCCC"> to a head start on</font><font color="#E5E5E5"> the</font>

614
00:22:31,820 --> 00:22:34,490
<font color="#E5E5E5">attackers but assuming that that's not</font>

615
00:22:33,799 --> 00:22:35,720
possible

616
00:22:34,490 --> 00:22:37,820
there are other things<font color="#E5E5E5"> we can do</font>

617
00:22:35,720 --> 00:22:39,260
certainly stop spraying<font color="#E5E5E5"> your most</font>

618
00:22:37,820 --> 00:22:41,780
important accounts to the environment

619
00:22:39,260 --> 00:22:45,440
get your admins<font color="#E5E5E5"> to stop RT peeing with</font>

620
00:22:41,780 --> 00:22:47,030
their domain admin crits<font color="#E5E5E5"> right</font><font color="#CCCCCC"> teach</font>

621
00:22:45,440 --> 00:22:49,070
them<font color="#E5E5E5"> about how to properly terminate</font>

622
00:22:47,030 --> 00:22:51,410
<font color="#E5E5E5">those sessions think about if you're in</font>

623
00:22:49,070 --> 00:22:53,240
a Windows 10 or<font color="#CCCCCC"> 8 world in place</font><font color="#E5E5E5"> on the</font>

624
00:22:51,410 --> 00:22:55,160
<font color="#E5E5E5">like restricted admin or remote</font>

625
00:22:53,240 --> 00:22:56,450
credential guard<font color="#E5E5E5"> which</font><font color="#CCCCCC"> Beth means</font><font color="#E5E5E5"> even</font>

626
00:22:55,160 --> 00:22:58,370
if they already<font color="#CCCCCC"> pee with their domain</font>

627
00:22:56,450 --> 00:22:59,929
admin creds<font color="#E5E5E5"> those won't be present on</font>

628
00:22:58,370 --> 00:23:04,070
<font color="#E5E5E5">those remote systems they're protected</font>

629
00:22:59,929 --> 00:23:05,600
now with these new<font color="#E5E5E5"> mitigations obviously</font>

630
00:23:04,070 --> 00:23:06,830
when we get to Windows 10<font color="#E5E5E5"> we</font><font color="#CCCCCC"> can start</font>

631
00:23:05,600 --> 00:23:08,330
to prevent the ability to get<font color="#E5E5E5"> the</font>

632
00:23:06,830 --> 00:23:10,699
<font color="#CCCCCC">credentials themselves</font><font color="#E5E5E5"> if you have</font>

633
00:23:08,330 --> 00:23:12,439
<font color="#CCCCCC">credential guard running on a system no</font>

634
00:23:10,700 --> 00:23:13,610
current attack tool can actually dump

635
00:23:12,440 --> 00:23:14,570
the hashes so<font color="#CCCCCC"> you don't don't worry</font>

636
00:23:13,610 --> 00:23:18,409
<font color="#E5E5E5">about them passing them because they</font>

637
00:23:14,570 --> 00:23:20,210
can't get<font color="#E5E5E5"> them and obviously things like</font>

638
00:23:18,410 --> 00:23:21,470
<font color="#E5E5E5">that the main protected users group</font>

639
00:23:20,210 --> 00:23:22,880
that's again<font color="#E5E5E5"> going to be probably</font><font color="#CCCCCC"> the</font>

640
00:23:21,470 --> 00:23:25,370
<font color="#E5E5E5">most important takeaway of the entire</font>

641
00:23:22,880 --> 00:23:27,470
talk<font color="#E5E5E5"> today which is if you can get your</font>

642
00:23:25,370 --> 00:23:30,159
<font color="#E5E5E5">most important accounts in that those</font>

643
00:23:27,470 --> 00:23:32,510
<font color="#E5E5E5">also aren't providing those hashes</font>

644
00:23:30,160 --> 00:23:38,570
<font color="#E5E5E5">around your network and that can easily</font>

645
00:23:32,510 --> 00:23:41,090
<font color="#E5E5E5">be stolen all right hashes I think</font>

646
00:23:38,570 --> 00:23:43,340
hashes<font color="#CCCCCC"> are the gimme here tokens where I</font>

647
00:23:41,090 --> 00:23:45,549
see a lot of people<font color="#E5E5E5"> falling down on this</font>

648
00:23:43,340 --> 00:23:48,530
is<font color="#E5E5E5"> just a surprisingly complicated</font>

649
00:23:45,549 --> 00:23:50,480
<font color="#E5E5E5">authentication mechanism in Windows</font><font color="#CCCCCC"> and</font>

650
00:23:48,530 --> 00:23:52,460
so the idea of<font color="#E5E5E5"> a token is that when you</font>

651
00:23:50,480 --> 00:23:54,169
log<font color="#CCCCCC"> in to</font><font color="#E5E5E5"> a session a token is created</font>

652
00:23:52,460 --> 00:23:55,880
the token as<font color="#E5E5E5"> your your security</font>

653
00:23:54,169 --> 00:23:58,450
<font color="#E5E5E5">identifier</font><font color="#CCCCCC"> it has all the groups you</font>

654
00:23:55,880 --> 00:24:01,760
belong to it has all of your<font color="#CCCCCC"> privileges</font>

655
00:23:58,450 --> 00:24:04,700
<font color="#CCCCCC">now this token is reused</font><font color="#E5E5E5"> all over the</font>

656
00:24:01,760 --> 00:24:06,860
place every<font color="#E5E5E5"> process that you spawn and</font>

657
00:24:04,700 --> 00:24:08,870
your session<font color="#CCCCCC"> actually gets a copy of</font>

658
00:24:06,860 --> 00:24:10,668
your token right this is how these

659
00:24:08,870 --> 00:24:12,469
processes<font color="#E5E5E5"> know kind of what your levels</font>

660
00:24:10,669 --> 00:24:14,090
of privileges are<font color="#E5E5E5"> all right you'll have</font>

661
00:24:12,470 --> 00:24:15,890
<font color="#E5E5E5">things like a view</font><font color="#CCCCCC"> attached to</font><font color="#E5E5E5"> like a</font>

662
00:24:14,090 --> 00:24:17,720
file share something like that<font color="#E5E5E5"> very</font>

663
00:24:15,890 --> 00:24:20,000
<font color="#CCCCCC">calmly</font><font color="#E5E5E5"> that process attaching will need</font>

664
00:24:17,720 --> 00:24:22,010
to do something<font color="#E5E5E5"> that we call impersonate</font>

665
00:24:20,000 --> 00:24:24,320
your token<font color="#E5E5E5"> you'll need to load your</font>

666
00:24:22,010 --> 00:24:28,010
token up into<font color="#E5E5E5"> their</font><font color="#CCCCCC"> process space in</font>

667
00:24:24,320 --> 00:24:31,399
order<font color="#CCCCCC"> to basically</font><font color="#E5E5E5"> restrict or keep keep</font>

668
00:24:28,010 --> 00:24:32,990
all of your privileges<font color="#E5E5E5"> in place to make</font>

669
00:24:31,400 --> 00:24:35,000
sure<font color="#E5E5E5"> that</font><font color="#CCCCCC"> you can't exceed those rights</font>

670
00:24:32,990 --> 00:24:36,169
and<font color="#E5E5E5"> privileges that you have so this is</font>

671
00:24:35,000 --> 00:24:37,909
<font color="#E5E5E5">an idea of impersonate</font>

672
00:24:36,169 --> 00:24:39,590
is used all over the<font color="#CCCCCC"> place in</font><font color="#E5E5E5"> Windows</font>

673
00:24:37,909 --> 00:24:43,009
<font color="#E5E5E5">they see something else</font><font color="#CCCCCC"> taking</font><font color="#E5E5E5"> your</font>

674
00:24:39,590 --> 00:24:45,738
token<font color="#E5E5E5"> and reusing it as you now as you</font>

675
00:24:43,009 --> 00:24:48,230
<font color="#E5E5E5">can imagine if a standard Windows</font>

676
00:24:45,739 --> 00:24:50,570
<font color="#CCCCCC">processor</font><font color="#E5E5E5"> service can do this so can</font><font color="#CCCCCC"> an</font>

677
00:24:48,230 --> 00:24:51,830
attack tool and what our attackers do is

678
00:24:50,570 --> 00:24:53,629
when they get those admin rights<font color="#CCCCCC"> they</font>

679
00:24:51,830 --> 00:24:54,889
get on the<font color="#E5E5E5"> box</font><font color="#CCCCCC"> they can basically</font><font color="#E5E5E5"> look</font>

680
00:24:53,629 --> 00:24:56,570
<font color="#E5E5E5">at all the open tokens in the</font>

681
00:24:54,889 --> 00:24:58,850
environment<font color="#E5E5E5"> or on the system that</font>

682
00:24:56,570 --> 00:24:59,869
<font color="#E5E5E5">they're currently on grab one and start</font>

683
00:24:58,850 --> 00:25:02,509
reusing<font color="#E5E5E5"> it they can basically</font>

684
00:24:59,869 --> 00:25:04,279
impersonate you so very<font color="#E5E5E5"> commonly this is</font>

685
00:25:02,509 --> 00:25:05,869
<font color="#E5E5E5">used for privilege escalation</font><font color="#CCCCCC"> all right</font>

686
00:25:04,279 --> 00:25:07,820
your admin currently you want to be

687
00:25:05,869 --> 00:25:10,158
domain admin so I can find a<font color="#CCCCCC"> machine</font>

688
00:25:07,820 --> 00:25:12,408
that a domain<font color="#E5E5E5"> admin is on or didn't</font>

689
00:25:10,159 --> 00:25:14,450
properly terminate a session<font color="#E5E5E5"> on I can</font>

690
00:25:12,409 --> 00:25:16,940
<font color="#E5E5E5">steal their token I automatically become</font>

691
00:25:14,450 --> 00:25:18,739
domain admin maybe the<font color="#E5E5E5"> simplest way to</font>

692
00:25:16,940 --> 00:25:21,200
achieve domain admin rights<font color="#E5E5E5"> kind of in</font>

693
00:25:18,739 --> 00:25:24,019
the wild this also<font color="#E5E5E5"> allows us</font><font color="#CCCCCC"> to do</font>

694
00:25:21,200 --> 00:25:25,129
<font color="#E5E5E5">things that maybe hashes</font><font color="#CCCCCC"> don't allow us</font>

695
00:25:24,019 --> 00:25:26,989
to do let's say<font color="#CCCCCC"> I want to create like</font><font color="#E5E5E5"> a</font>

696
00:25:25,129 --> 00:25:29,269
user account<font color="#CCCCCC"> I can't really do that</font>

697
00:25:26,989 --> 00:25:31,720
<font color="#E5E5E5">through a pass the hash account or pass</font>

698
00:25:29,269 --> 00:25:34,190
the hash attack<font color="#CCCCCC"> but having like a token</font>

699
00:25:31,720 --> 00:25:36,470
<font color="#E5E5E5">impersonation I can and probably even</font>

700
00:25:34,190 --> 00:25:38,480
worse and by far<font color="#CCCCCC"> the most biggest</font>

701
00:25:36,470 --> 00:25:40,009
<font color="#CCCCCC">liability of tokens</font><font color="#E5E5E5"> is that certain</font>

702
00:25:38,480 --> 00:25:42,379
impersonation tokens<font color="#E5E5E5"> can be what we call</font>

703
00:25:40,009 --> 00:25:43,609
delegate tokens delegate tokens are

704
00:25:42,379 --> 00:25:45,709
essentially single sign-on

705
00:25:43,609 --> 00:25:48,320
they allow you<font color="#CCCCCC"> to authenticate</font><font color="#E5E5E5"> to remote</font>

706
00:25:45,710 --> 00:25:49,730
resources using<font color="#E5E5E5"> your token so if you</font>

707
00:25:48,320 --> 00:25:51,678
have a<font color="#CCCCCC"> domain admin token</font><font color="#E5E5E5"> that's a</font>

708
00:25:49,730 --> 00:25:52,999
delegate token basically now<font color="#E5E5E5"> you can</font>

709
00:25:51,679 --> 00:25:56,179
<font color="#E5E5E5">move around the environment</font><font color="#CCCCCC"> using that</font>

710
00:25:52,999 --> 00:25:58,369
account<font color="#E5E5E5"> so it's a huge</font><font color="#CCCCCC"> problem you see</font>

711
00:25:56,179 --> 00:26:00,710
we've got<font color="#CCCCCC"> some</font><font color="#E5E5E5"> pretty classic tools that</font>

712
00:25:58,369 --> 00:26:01,070
allow us to<font color="#E5E5E5"> do this this</font><font color="#CCCCCC"> is what it</font>

713
00:26:00,710 --> 00:26:03,889
looks like

714
00:26:01,070 --> 00:26:05,749
so me me<font color="#E5E5E5"> cats has a</font><font color="#CCCCCC"> one-line</font><font color="#E5E5E5"> command</font>

715
00:26:03,889 --> 00:26:08,119
<font color="#E5E5E5">right so we're currently sitting here as</font>

716
00:26:05,749 --> 00:26:10,159
a<font color="#CCCCCC"> tea as a</font><font color="#E5E5E5"> key</font><font color="#CCCCCC"> Dungan user all right</font><font color="#E5E5E5"> I</font>

717
00:26:08,119 --> 00:26:12,139
run the very simple command with a mini

718
00:26:10,159 --> 00:26:13,609
<font color="#E5E5E5">cats elevate domain admin but it does</font><font color="#CCCCCC"> is</font>

719
00:26:12,139 --> 00:26:15,559
search through all<font color="#E5E5E5"> the</font><font color="#CCCCCC"> tokens on</font><font color="#E5E5E5"> the</font>

720
00:26:13,609 --> 00:26:17,989
current system if it finds a domain

721
00:26:15,559 --> 00:26:20,330
admin level token it will<font color="#CCCCCC"> immediately</font>

722
00:26:17,989 --> 00:26:22,489
grab it<font color="#E5E5E5"> and load</font><font color="#CCCCCC"> that into memory for me</font>

723
00:26:20,330 --> 00:26:25,369
<font color="#E5E5E5">so I can</font><font color="#CCCCCC"> start to</font><font color="#E5E5E5"> interact as that user</font>

724
00:26:22,489 --> 00:26:26,690
<font color="#E5E5E5">and you'll notice in this case</font><font color="#CCCCCC"> look at</font>

725
00:26:25,369 --> 00:26:29,119
the impersonation down at the<font color="#E5E5E5"> bottom</font>

726
00:26:26,690 --> 00:26:32,389
this case we found<font color="#E5E5E5"> a domain</font><font color="#CCCCCC"> admin token</font>

727
00:26:29,119 --> 00:26:34,070
that<font color="#E5E5E5"> had the delegation of capability so</font>

728
00:26:32,389 --> 00:26:37,070
now we can immediately start laterally

729
00:26:34,070 --> 00:26:40,639
moving as users<font color="#CCCCCC"> I now essentially owned</font>

730
00:26:37,070 --> 00:26:43,100
the environment so<font color="#E5E5E5"> extremely common</font><font color="#CCCCCC"> will</font>

731
00:26:40,639 --> 00:26:47,500
a<font color="#CCCCCC"> to to achieve</font><font color="#E5E5E5"> that next</font><font color="#CCCCCC"> level</font><font color="#E5E5E5"> or that</font>

732
00:26:43,100 --> 00:26:49,820
<font color="#CCCCCC">next</font><font color="#E5E5E5"> rung up on the credential scale</font>

733
00:26:47,500 --> 00:26:51,680
you know how many how many<font color="#E5E5E5"> of</font><font color="#CCCCCC"> my pen</font>

734
00:26:49,820 --> 00:26:55,490
testers have actually still<font color="#E5E5E5"> wanted token</font>

735
00:26:51,680 --> 00:26:58,490
in the last year anybody you have scary

736
00:26:55,490 --> 00:27:00,440
<font color="#E5E5E5">yeah so I know we probably have you know</font>

737
00:26:58,490 --> 00:27:02,840
almost<font color="#E5E5E5"> every</font><font color="#CCCCCC"> pin tester</font><font color="#E5E5E5"> is probably done</font>

738
00:27:00,440 --> 00:27:04,280
token<font color="#CCCCCC"> stealing last year how many of the</font>

739
00:27:02,840 --> 00:27:06,980
blue teamers so<font color="#E5E5E5"> I assume the</font><font color="#CCCCCC"> rest of</font>

740
00:27:04,280 --> 00:27:12,320
your have actually found token stealing

741
00:27:06,980 --> 00:27:15,950
in your environment<font color="#E5E5E5"> it's really</font><font color="#CCCCCC"> hard</font><font color="#E5E5E5"> it</font>

742
00:27:12,320 --> 00:27:17,659
leaves very very few clues<font color="#CCCCCC"> you'll see</font>

743
00:27:15,950 --> 00:27:19,730
some event logs<font color="#CCCCCC"> some</font><font color="#E5E5E5"> you know</font>

744
00:27:17,660 --> 00:27:21,710
<font color="#E5E5E5">essentially some</font><font color="#CCCCCC"> chemist indication</font>

745
00:27:19,730 --> 00:27:23,450
events start to show up<font color="#E5E5E5"> but actually</font>

746
00:27:21,710 --> 00:27:24,830
<font color="#E5E5E5">identifying the fact</font><font color="#CCCCCC"> that a token was</font>

747
00:27:23,450 --> 00:27:28,760
stolen unless you have really really

748
00:27:24,830 --> 00:27:31,159
<font color="#CCCCCC">good auditing you're basically blind</font><font color="#E5E5E5"> so</font>

749
00:27:28,760 --> 00:27:33,440
again<font color="#E5E5E5"> our</font><font color="#CCCCCC"> best-case scenario is going</font><font color="#E5E5E5"> to</font>

750
00:27:31,160 --> 00:27:35,990
be to essentially stop these tokens<font color="#E5E5E5"> from</font>

751
00:27:33,440 --> 00:27:37,790
being available<font color="#E5E5E5"> so yes if we could have</font>

752
00:27:35,990 --> 00:27:41,150
proven<font color="#CCCCCC"> admin</font><font color="#E5E5E5"> we'd be</font><font color="#CCCCCC"> alright</font><font color="#E5E5E5"> so I mean</font>

753
00:27:37,790 --> 00:27:44,480
that's<font color="#E5E5E5"> not first cases stop the madness</font>

754
00:27:41,150 --> 00:27:47,900
I<font color="#E5E5E5"> stop these interactive sessions from</font>

755
00:27:44,480 --> 00:27:49,880
<font color="#E5E5E5">being kind of using highly privileged</font>

756
00:27:47,900 --> 00:27:53,030
accounts we just can't do that<font color="#CCCCCC"> anymore</font>

757
00:27:49,880 --> 00:27:54,350
<font color="#E5E5E5">right yeah</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> again something like</font>

758
00:27:53,030 --> 00:27:56,629
remote credential guard when you have

759
00:27:54,350 --> 00:27:59,750
that<font color="#E5E5E5"> in place it actually</font><font color="#CCCCCC"> does not</font><font color="#E5E5E5"> push</font>

760
00:27:56,630 --> 00:28:01,370
your token to that remote system<font color="#E5E5E5"> simple</font>

761
00:27:59,750 --> 00:28:02,900
<font color="#E5E5E5">way</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> even</font><font color="#CCCCCC"> if you can't get to some of</font>

762
00:28:01,370 --> 00:28:04,969
<font color="#E5E5E5">the new hotness</font><font color="#CCCCCC"> like remote credential</font>

763
00:28:02,900 --> 00:28:07,400
guard<font color="#E5E5E5"> in Windows 10</font><font color="#CCCCCC"> well-protected</font><font color="#E5E5E5"> users</font>

764
00:28:04,970 --> 00:28:09,080
group you can easily<font color="#E5E5E5"> go</font><font color="#CCCCCC"> to Active</font>

765
00:28:07,400 --> 00:28:11,570
Directory and for your<font color="#E5E5E5"> most important</font>

766
00:28:09,080 --> 00:28:14,480
accounts just<font color="#E5E5E5"> mark them to not delegate</font>

767
00:28:11,570 --> 00:28:16,909
<font color="#CCCCCC">right</font><font color="#E5E5E5"> that essentially killed that well</font>

768
00:28:14,480 --> 00:28:19,670
it doesn't kill<font color="#CCCCCC"> it still allows on the</font>

769
00:28:16,910 --> 00:28:22,730
system<font color="#E5E5E5"> impersonation which you can still</font>

770
00:28:19,670 --> 00:28:24,560
get<font color="#E5E5E5"> kind of the next rung up from a</font>

771
00:28:22,730 --> 00:28:25,850
<font color="#CCCCCC">privilege escalation but it prevents you</font>

772
00:28:24,560 --> 00:28:27,860
from you<font color="#CCCCCC"> under use that token now</font>

773
00:28:25,850 --> 00:28:30,350
<font color="#E5E5E5">remotely just what most attackers want</font>

774
00:28:27,860 --> 00:28:31,790
so that's<font color="#E5E5E5"> a big win and then certainly</font>

775
00:28:30,350 --> 00:28:33,320
if you can<font color="#CCCCCC"> get two protected</font><font color="#E5E5E5"> users group</font>

776
00:28:31,790 --> 00:28:35,480
so if you can<font color="#E5E5E5"> employ that</font><font color="#CCCCCC"> in your</font>

777
00:28:33,320 --> 00:28:37,159
environment<font color="#CCCCCC"> that by</font><font color="#E5E5E5"> default does not</font>

778
00:28:35,480 --> 00:28:40,040
push tokens actually all tokens in that

779
00:28:37,160 --> 00:28:41,690
group<font color="#E5E5E5"> are non delegate by definition you</font>

780
00:28:40,040 --> 00:28:43,190
can't change it right so you

781
00:28:41,690 --> 00:28:46,130
automatically get<font color="#E5E5E5"> like this</font><font color="#CCCCCC"> wonderful</font>

782
00:28:43,190 --> 00:28:51,900
kind<font color="#CCCCCC"> of group of protections around</font><font color="#E5E5E5"> the</font>

783
00:28:46,130 --> 00:28:55,230
accounts in that<font color="#E5E5E5"> group all right</font>

784
00:28:51,900 --> 00:28:57,570
so hashes tokens<font color="#E5E5E5"> right let's say that</font>

785
00:28:55,230 --> 00:28:59,040
you do everything<font color="#E5E5E5"> right</font><font color="#CCCCCC"> right you</font><font color="#E5E5E5"> are on</font>

786
00:28:57,570 --> 00:29:00,360
the ball you've already implemented

787
00:28:59,040 --> 00:29:02,309
credential guard in your environment

788
00:29:00,360 --> 00:29:04,559
<font color="#CCCCCC">right</font><font color="#E5E5E5"> you are</font><font color="#CCCCCC"> high-fiving your team</font>

789
00:29:02,309 --> 00:29:08,160
<font color="#E5E5E5">right you get to actually</font><font color="#CCCCCC"> have a weekend</font>

790
00:29:04,559 --> 00:29:09,930
for<font color="#CCCCCC"> a change right so the attackers get</font>

791
00:29:08,160 --> 00:29:12,180
<font color="#E5E5E5">on the</font><font color="#CCCCCC"> box they can't dump tokens they</font>

792
00:29:09,930 --> 00:29:13,740
cannot dump hashes you you've locked

793
00:29:12,180 --> 00:29:15,720
everything down there's no delegate

794
00:29:13,740 --> 00:29:18,090
tokens you got your hashes in in<font color="#E5E5E5"> your</font>

795
00:29:15,720 --> 00:29:21,660
protected<font color="#E5E5E5"> enclave of credential guard</font>

796
00:29:18,090 --> 00:29:22,980
and sadly all attackers have to do is go

797
00:29:21,660 --> 00:29:24,900
and dump<font color="#E5E5E5"> something called</font><font color="#CCCCCC"> caster</font>

798
00:29:22,980 --> 00:29:25,559
<font color="#E5E5E5">controls and they're off to the</font><font color="#CCCCCC"> races</font>

799
00:29:24,900 --> 00:29:28,380
<font color="#E5E5E5">again</font>

800
00:29:25,559 --> 00:29:30,660
now<font color="#CCCCCC"> there's another</font><font color="#E5E5E5"> super old-school</font>

801
00:29:28,380 --> 00:29:32,390
kind of authentication mechanism<font color="#CCCCCC"> all</font>

802
00:29:30,660 --> 00:29:34,620
right how<font color="#E5E5E5"> many have heard of this</font>

803
00:29:32,390 --> 00:29:35,460
probably a lot more<font color="#CCCCCC"> than tokens right</font>

804
00:29:34,620 --> 00:29:38,100
this is<font color="#E5E5E5"> something we've known about</font>

805
00:29:35,460 --> 00:29:41,340
<font color="#E5E5E5">forever the idea</font><font color="#CCCCCC"> is that in a</font><font color="#E5E5E5"> domain</font>

806
00:29:38,100 --> 00:29:43,490
environment<font color="#CCCCCC"> usually your accounts I'll</font>

807
00:29:41,340 --> 00:29:45,510
<font color="#E5E5E5">Finnick eight to the domain controller</font>

808
00:29:43,490 --> 00:29:46,860
<font color="#E5E5E5">the only problem is what if you've got</font>

809
00:29:45,510 --> 00:29:48,270
all your<font color="#E5E5E5"> Knights laptops in front of you</font>

810
00:29:46,860 --> 00:29:49,649
<font color="#E5E5E5">and you're not currently connected</font><font color="#CCCCCC"> your</font>

811
00:29:48,270 --> 00:29:52,889
domain controller<font color="#E5E5E5"> how do you actually</font>

812
00:29:49,650 --> 00:29:55,290
<font color="#E5E5E5">log on with your</font><font color="#CCCCCC"> domain account</font><font color="#E5E5E5"> well to</font>

813
00:29:52,890 --> 00:29:56,880
do that<font color="#CCCCCC"> the account credentials has to</font>

814
00:29:55,290 --> 00:29:58,290
be stored someplace outside<font color="#CCCCCC"> of domain</font>

815
00:29:56,880 --> 00:29:59,250
controller<font color="#E5E5E5"> all right where this is</font>

816
00:29:58,290 --> 00:30:00,840
stored is actually something called

817
00:29:59,250 --> 00:30:03,390
<font color="#E5E5E5">cached credentials basically allows you</font>

818
00:30:00,840 --> 00:30:06,629
<font color="#E5E5E5">to use a domain account offline by</font>

819
00:30:03,390 --> 00:30:09,179
default<font color="#CCCCCC"> ten of these are stored some</font>

820
00:30:06,630 --> 00:30:11,730
<font color="#CCCCCC">brilliant</font><font color="#E5E5E5"> individual at Microsoft</font>

821
00:30:09,179 --> 00:30:14,700
<font color="#CCCCCC">decided with that the 2008 server</font>

822
00:30:11,730 --> 00:30:16,830
release to upgrade this<font color="#CCCCCC"> the</font><font color="#E5E5E5"> last 25 for</font>

823
00:30:14,700 --> 00:30:19,020
the<font color="#CCCCCC"> chills beam</font><font color="#E5E5E5"> cache now I want you to</font>

824
00:30:16,830 --> 00:30:20,730
<font color="#E5E5E5">think about this</font><font color="#CCCCCC"> all</font><font color="#E5E5E5"> right first of all</font>

825
00:30:19,020 --> 00:30:22,710
how<font color="#E5E5E5"> often should a server not be</font>

826
00:30:20,730 --> 00:30:26,550
connected<font color="#CCCCCC"> to</font><font color="#E5E5E5"> domain and that's pretty</font>

827
00:30:22,710 --> 00:30:27,900
darn rare<font color="#E5E5E5"> right</font><font color="#CCCCCC"> also on your</font><font color="#E5E5E5"> laptops</font><font color="#CCCCCC"> do</font>

828
00:30:26,550 --> 00:30:28,700
we<font color="#E5E5E5"> have a lot of shared computers</font>

829
00:30:27,900 --> 00:30:30,870
anymore

830
00:30:28,700 --> 00:30:33,179
how many people have actually logged

831
00:30:30,870 --> 00:30:36,270
<font color="#CCCCCC">onto your laptop in the last year</font><font color="#E5E5E5"> I said</font>

832
00:30:33,179 --> 00:30:39,510
<font color="#E5E5E5">you know I'll be you and</font><font color="#CCCCCC"> you and you</font><font color="#E5E5E5"> and</font>

833
00:30:36,270 --> 00:30:41,460
<font color="#CCCCCC">maybe the</font><font color="#E5E5E5"> helpdesk</font><font color="#CCCCCC"> right why do we</font><font color="#E5E5E5"> need</font>

834
00:30:39,510 --> 00:30:43,410
to cache<font color="#CCCCCC"> 10 credentials that's often an</font>

835
00:30:41,460 --> 00:30:45,600
historical<font color="#E5E5E5"> record of everyone who's</font><font color="#CCCCCC"> ever</font>

836
00:30:43,410 --> 00:30:47,429
logged<font color="#CCCCCC"> onto</font><font color="#E5E5E5"> that box including the</font>

837
00:30:45,600 --> 00:30:49,260
domain admin who set<font color="#CCCCCC"> it</font><font color="#E5E5E5"> up for you three</font>

838
00:30:47,429 --> 00:30:50,550
<font color="#CCCCCC">years</font><font color="#E5E5E5"> ago hopefully they've changed the</font>

839
00:30:49,260 --> 00:30:52,410
password<font color="#E5E5E5"> since then but if they haven't</font>

840
00:30:50,550 --> 00:30:55,520
their credentials are still<font color="#E5E5E5"> archives on</font>

841
00:30:52,410 --> 00:30:58,559
every machine<font color="#E5E5E5"> that they've been to so</font>

842
00:30:55,520 --> 00:31:01,710
<font color="#CCCCCC">cache</font><font color="#E5E5E5"> credentials are are a huge</font>

843
00:30:58,559 --> 00:31:03,780
<font color="#CCCCCC">liability</font><font color="#E5E5E5"> all right</font>

844
00:31:01,710 --> 00:31:05,580
the good news is they<font color="#CCCCCC"> are not</font><font color="#E5E5E5"> in the</font>

845
00:31:03,780 --> 00:31:07,830
same format as your<font color="#CCCCCC"> traditional and</font>

846
00:31:05,580 --> 00:31:10,399
<font color="#CCCCCC">Killam hashes so they are salted so</font>

847
00:31:07,830 --> 00:31:12,929
rainbow tables<font color="#E5E5E5"> don't work against these</font>

848
00:31:10,400 --> 00:31:14,910
<font color="#E5E5E5">this is one of</font><font color="#CCCCCC"> the few places where</font>

849
00:31:12,930 --> 00:31:16,620
<font color="#CCCCCC">actually having a really</font><font color="#E5E5E5"> good password</font>

850
00:31:14,910 --> 00:31:18,240
policy can actually help you because the

851
00:31:16,620 --> 00:31:18,929
<font color="#CCCCCC">only attack against these is they have</font>

852
00:31:18,240 --> 00:31:20,970
to be<font color="#E5E5E5"> correct</font>

853
00:31:18,930 --> 00:31:22,470
they can't be replayed like an<font color="#CCCCCC"> entail</font>

854
00:31:20,970 --> 00:31:25,460
<font color="#CCCCCC">and hashes that's the only kind</font><font color="#E5E5E5"> of</font>

855
00:31:22,470 --> 00:31:28,410
saving grace<font color="#CCCCCC"> here but check this out</font><font color="#E5E5E5"> so</font>

856
00:31:25,460 --> 00:31:31,560
one of the trends<font color="#CCCCCC"> that we've seen</font>

857
00:31:28,410 --> 00:31:33,240
<font color="#E5E5E5">recently is moving away from dumping</font>

858
00:31:31,560 --> 00:31:35,159
credentials on a standard box<font color="#E5E5E5"> so</font>

859
00:31:33,240 --> 00:31:36,930
<font color="#E5E5E5">dropping your</font><font color="#CCCCCC"> G SEC dump or your</font><font color="#E5E5E5"> Muni</font>

860
00:31:35,160 --> 00:31:38,100
<font color="#CCCCCC">cat</font><font color="#E5E5E5"> store whatever that is because</font>

861
00:31:36,930 --> 00:31:39,480
obviously we're starting to look for

862
00:31:38,100 --> 00:31:41,129
<font color="#E5E5E5">that we have security tools that know</font>

863
00:31:39,480 --> 00:31:43,520
what all<font color="#CCCCCC"> of those tools</font><font color="#E5E5E5"> look like and</font>

864
00:31:41,130 --> 00:31:46,290
we're<font color="#CCCCCC"> catching that so a common</font>

865
00:31:43,520 --> 00:31:48,690
mitigation to that<font color="#E5E5E5"> from the attack</font><font color="#CCCCCC"> your</font>

866
00:31:46,290 --> 00:31:51,750
side is basically to come and just dump

867
00:31:48,690 --> 00:31:54,420
your<font color="#CCCCCC"> L</font><font color="#E5E5E5"> SAS process or in this case dump</font>

868
00:31:51,750 --> 00:31:57,330
<font color="#E5E5E5">your registry hives</font><font color="#CCCCCC"> and take them</font><font color="#E5E5E5"> for an</font>

869
00:31:54,420 --> 00:31:59,400
offline attack<font color="#CCCCCC"> that way I don't</font><font color="#E5E5E5"> have to</font>

870
00:31:57,330 --> 00:32:00,449
<font color="#E5E5E5">run my nasty tool on</font><font color="#CCCCCC"> your box I</font><font color="#E5E5E5"> just</font>

871
00:31:59,400 --> 00:32:02,100
have to figure<font color="#CCCCCC"> out some way to get your</font>

872
00:32:00,450 --> 00:32:03,720
Sam and security<font color="#CCCCCC"> hi and I can do</font>

873
00:32:02,100 --> 00:32:05,850
everything<font color="#CCCCCC"> offline</font><font color="#E5E5E5"> without triggering</font>

874
00:32:03,720 --> 00:32:07,290
your intrusion protection system

875
00:32:05,850 --> 00:32:08,639
<font color="#E5E5E5">whatever that is so</font><font color="#CCCCCC"> this is a pretty</font>

876
00:32:07,290 --> 00:32:11,280
<font color="#E5E5E5">cool little project just written in</font>

877
00:32:08,640 --> 00:32:14,010
Python and so as you notice the top we

878
00:32:11,280 --> 00:32:15,780
did<font color="#E5E5E5"> a PW dump from the Sam hive now</font>

879
00:32:14,010 --> 00:32:17,370
<font color="#E5E5E5">those are just going</font><font color="#CCCCCC"> to be the</font><font color="#E5E5E5"> local</font>

880
00:32:15,780 --> 00:32:18,540
accounts<font color="#E5E5E5"> all right those won't be</font><font color="#CCCCCC"> a</font>

881
00:32:17,370 --> 00:32:20,100
domain<font color="#CCCCCC"> account so I'll just be</font><font color="#E5E5E5"> what's</font>

882
00:32:18,540 --> 00:32:23,909
stored<font color="#CCCCCC"> in your</font><font color="#E5E5E5"> Sam your local</font><font color="#CCCCCC"> accounts</font>

883
00:32:20,100 --> 00:32:27,209
notice there's not many<font color="#E5E5E5"> same thing same</font>

884
00:32:23,910 --> 00:32:29,190
project<font color="#E5E5E5"> did the</font><font color="#CCCCCC"> cash dump</font><font color="#E5E5E5"> tool now</font>

885
00:32:27,210 --> 00:32:30,960
running it against<font color="#E5E5E5"> your security</font><font color="#CCCCCC"> hi and</font>

886
00:32:29,190 --> 00:32:32,580
look at<font color="#CCCCCC"> everything else that pops up</font>

887
00:32:30,960 --> 00:32:34,560
<font color="#E5E5E5">these are what</font><font color="#CCCCCC"> you really</font><font color="#E5E5E5"> want these are</font>

888
00:32:32,580 --> 00:32:36,030
your domain account and actually<font color="#CCCCCC"> in this</font>

889
00:32:34,560 --> 00:32:39,090
<font color="#E5E5E5">environment one</font><font color="#CCCCCC"> of those was actually</font>

890
00:32:36,030 --> 00:32:40,470
the domain admin and so now we've got

891
00:32:39,090 --> 00:32:42,090
the<font color="#CCCCCC"> domain admins crashed cached</font>

892
00:32:40,470 --> 00:32:45,330
credentials<font color="#CCCCCC"> all I have to do is go back</font>

893
00:32:42,090 --> 00:32:47,429
<font color="#E5E5E5">to my cracking rig practice using MS</font>

894
00:32:45,330 --> 00:32:49,470
<font color="#E5E5E5">cache</font><font color="#CCCCCC"> - in John</font><font color="#E5E5E5"> the Ripper</font><font color="#CCCCCC"> you're</font><font color="#E5E5E5"> curios</font>

895
00:32:47,430 --> 00:32:50,760
<font color="#E5E5E5">and with any luck they'll have a weak</font>

896
00:32:49,470 --> 00:32:53,330
enough password that<font color="#CCCCCC"> I'll have domain</font>

897
00:32:50,760 --> 00:32:53,330
admin tomorrow

898
00:32:56,070 --> 00:32:59,859
<font color="#E5E5E5">all right how do we prevent cash</font>

899
00:32:58,239 --> 00:33:01,570
credentials well a lot<font color="#E5E5E5"> of you will see</font>

900
00:32:59,859 --> 00:33:05,259
guidance like turn your class<font color="#CCCCCC"> potential</font>

901
00:33:01,570 --> 00:33:06,698
to zero<font color="#CCCCCC"> sometimes a good</font><font color="#E5E5E5"> idea</font><font color="#CCCCCC"> NSA has</font>

902
00:33:05,259 --> 00:33:09,219
had some<font color="#CCCCCC"> guidance</font><font color="#E5E5E5"> to tell</font><font color="#CCCCCC"> people</font><font color="#E5E5E5"> to do</font>

903
00:33:06,699 --> 00:33:12,190
that a lot<font color="#CCCCCC"> of your DoD guidance comes</font>

904
00:33:09,219 --> 00:33:13,869
out to four or<font color="#CCCCCC"> less depending on</font><font color="#E5E5E5"> if the</font>

905
00:33:12,190 --> 00:33:15,940
<font color="#CCCCCC">system's</font><font color="#E5E5E5"> mobile or not you can tweak</font>

906
00:33:13,869 --> 00:33:18,399
that<font color="#E5E5E5"> just be careful</font>

907
00:33:15,940 --> 00:33:21,070
zero is<font color="#E5E5E5"> not always the right answer</font><font color="#CCCCCC"> the</font>

908
00:33:18,399 --> 00:33:22,928
reason<font color="#CCCCCC"> why is that</font><font color="#E5E5E5"> it's not always just</font>

909
00:33:21,070 --> 00:33:24,908
your personal account that's being

910
00:33:22,929 --> 00:33:27,279
<font color="#E5E5E5">cashed things like that computer account</font>

911
00:33:24,909 --> 00:33:29,589
<font color="#E5E5E5">sometimes good</font><font color="#CCCCCC"> cashed here and so if you</font>

912
00:33:27,279 --> 00:33:33,129
drop<font color="#E5E5E5"> it to like only one cash credential</font>

913
00:33:29,589 --> 00:33:34,690
well you might edge edge out the actual

914
00:33:33,129 --> 00:33:36,668
<font color="#E5E5E5">users credential or even things like</font>

915
00:33:34,690 --> 00:33:38,249
smart cards sometimes<font color="#E5E5E5"> a smart card</font>

916
00:33:36,669 --> 00:33:40,779
authentication is actually two<font color="#CCCCCC"> different</font>

917
00:33:38,249 --> 00:33:42,999
authentication or so two different

918
00:33:40,779 --> 00:33:45,489
<font color="#CCCCCC">things get cashed and that can override</font>

919
00:33:42,999 --> 00:33:47,019
<font color="#E5E5E5">or kind of age out the actual person's</font>

920
00:33:45,489 --> 00:33:48,190
credentials that need to be cashed<font color="#CCCCCC"> all</font>

921
00:33:47,019 --> 00:33:51,129
<font color="#E5E5E5">right</font><font color="#CCCCCC"> so you could</font><font color="#E5E5E5"> have a lot</font><font color="#CCCCCC"> of brick</font>

922
00:33:48,190 --> 00:33:53,229
systems<font color="#E5E5E5"> if you turn this down to low</font><font color="#CCCCCC"> by</font>

923
00:33:51,129 --> 00:33:55,089
far probably<font color="#CCCCCC"> the best option just have a</font>

924
00:33:53,229 --> 00:33:57,429
<font color="#E5E5E5">good password complexity</font><font color="#CCCCCC"> you know</font>

925
00:33:55,089 --> 00:33:58,928
<font color="#E5E5E5">usually I laugh at the complexity</font><font color="#CCCCCC"> rules</font>

926
00:33:57,429 --> 00:34:00,759
because<font color="#E5E5E5"> get things like pass the</font><font color="#CCCCCC"> hash</font>

927
00:33:58,929 --> 00:34:02,379
<font color="#E5E5E5">for the</font><font color="#CCCCCC"> totally useless this is one of</font>

928
00:34:00,759 --> 00:34:05,889
<font color="#E5E5E5">the few areas left where it still</font>

929
00:34:02,379 --> 00:34:07,448
matters and then of course<font color="#CCCCCC"> if you have</font>

930
00:34:05,889 --> 00:34:09,279
<font color="#CCCCCC">something the protected users group</font><font color="#E5E5E5"> by</font>

931
00:34:07,449 --> 00:34:11,109
<font color="#E5E5E5">definition those accounts don't cache</font>

932
00:34:09,279 --> 00:34:13,960
credentials and remote boxes so another

933
00:34:11,109 --> 00:34:17,889
big<font color="#E5E5E5"> win seeing the trend here get some</font>

934
00:34:13,960 --> 00:34:20,168
users into that group<font color="#CCCCCC"> all right so</font><font color="#E5E5E5"> cast</font>

935
00:34:17,889 --> 00:34:23,289
credentials<font color="#CCCCCC"> super old-school</font><font color="#E5E5E5"> something</font>

936
00:34:20,168 --> 00:34:25,839
maybe<font color="#E5E5E5"> even older than</font><font color="#CCCCCC"> that LS a secret I</font>

937
00:34:23,289 --> 00:34:28,299
will<font color="#E5E5E5"> tell you this is very</font><font color="#CCCCCC"> old</font><font color="#E5E5E5"> school</font>

938
00:34:25,839 --> 00:34:30,719
but I've seen<font color="#E5E5E5"> more red</font><font color="#CCCCCC"> team's get big</font>

939
00:34:28,299 --> 00:34:33,069
wins from this<font color="#E5E5E5"> and almost anything else</font>

940
00:34:30,719 --> 00:34:34,598
<font color="#E5E5E5">when we've talked about LS a secrets</font>

941
00:34:33,069 --> 00:34:36,460
we're not talking<font color="#E5E5E5"> about user accounts</font>

942
00:34:34,599 --> 00:34:39,279
now we're actually<font color="#CCCCCC"> talking more about</font>

943
00:34:36,460 --> 00:34:40,509
service accounts and so what happens<font color="#CCCCCC"> you</font>

944
00:34:39,279 --> 00:34:42,819
have<font color="#E5E5E5"> things like services remember a</font>

945
00:34:40,509 --> 00:34:45,039
service<font color="#E5E5E5"> has to run without user</font>

946
00:34:42,819 --> 00:34:47,668
interaction<font color="#CCCCCC"> all</font><font color="#E5E5E5"> right so if you set up a</font>

947
00:34:45,039 --> 00:34:50,200
service to use like a domain<font color="#E5E5E5"> account</font>

948
00:34:47,668 --> 00:34:52,388
well that domain account has<font color="#E5E5E5"> to somehow</font>

949
00:34:50,199 --> 00:34:53,799
authenticate and the way it up indicates

950
00:34:52,389 --> 00:34:55,929
without<font color="#E5E5E5"> interaction is it has to store</font>

951
00:34:53,799 --> 00:34:57,549
the credentials<font color="#E5E5E5"> locally and so what</font>

952
00:34:55,929 --> 00:34:59,049
happens let's say<font color="#CCCCCC"> you have your</font><font color="#E5E5E5"> backup</font>

953
00:34:57,549 --> 00:35:02,200
software<font color="#CCCCCC"> and your</font><font color="#E5E5E5"> backup software</font>

954
00:34:59,049 --> 00:35:04,029
requires a service being run across your

955
00:35:02,200 --> 00:35:05,980
environment<font color="#CCCCCC"> as some sort</font><font color="#E5E5E5"> of highly</font>

956
00:35:04,029 --> 00:35:08,440
privileged domain account right<font color="#E5E5E5"> so they</font>

957
00:35:05,980 --> 00:35:10,000
can access<font color="#E5E5E5"> all the boxes to back them up</font>

958
00:35:08,440 --> 00:35:13,000
well that's awesome<font color="#CCCCCC"> but what you just</font>

959
00:35:10,000 --> 00:35:15,700
<font color="#E5E5E5">did</font><font color="#CCCCCC"> is you just shotgun</font><font color="#E5E5E5"> that entire</font>

960
00:35:13,000 --> 00:35:18,160
highly privileged account into the<font color="#CCCCCC"> LSA</font>

961
00:35:15,700 --> 00:35:21,368
sequence of every<font color="#E5E5E5"> machines that service</font>

962
00:35:18,160 --> 00:35:22,750
runs on and wonderfully<font color="#E5E5E5"> once you can get</font>

963
00:35:21,369 --> 00:35:26,710
access<font color="#CCCCCC"> to the</font><font color="#E5E5E5"> machine you can dump it</font>

964
00:35:22,750 --> 00:35:28,030
out in<font color="#CCCCCC"> plaintext</font><font color="#E5E5E5"> the particular dangers</font>

965
00:35:26,710 --> 00:35:30,190
here of<font color="#CCCCCC"> serving</font><font color="#E5E5E5"> accounts is they are</font>

966
00:35:28,030 --> 00:35:31,660
<font color="#E5E5E5">rarely changed right</font>

967
00:35:30,190 --> 00:35:32,500
you have probably<font color="#E5E5E5"> have certain accounts</font>

968
00:35:31,660 --> 00:35:34,180
in<font color="#E5E5E5"> your</font><font color="#CCCCCC"> environment that</font><font color="#E5E5E5"> haven't been</font>

969
00:35:32,500 --> 00:35:36,099
changed<font color="#E5E5E5"> in three or</font><font color="#CCCCCC"> four</font><font color="#E5E5E5"> years people</font>

970
00:35:34,180 --> 00:35:38,049
<font color="#CCCCCC">are scared to change them because you</font>

971
00:35:36,099 --> 00:35:40,240
don't<font color="#CCCCCC"> know what it will break right some</font>

972
00:35:38,049 --> 00:35:41,920
<font color="#E5E5E5">admin</font><font color="#CCCCCC"> three you know</font><font color="#E5E5E5"> three generations</font>

973
00:35:40,240 --> 00:35:43,990
ago<font color="#E5E5E5"> set something up it's still running</font>

974
00:35:41,920 --> 00:35:46,480
<font color="#E5E5E5">so just keep it as is these are often</font>

975
00:35:43,990 --> 00:35:50,049
<font color="#E5E5E5">also very highly privileged accounts and</font>

976
00:35:46,480 --> 00:35:51,910
so this is kind<font color="#CCCCCC"> of the just</font><font color="#E5E5E5"> the syndrome</font>

977
00:35:50,049 --> 00:35:53,410
<font color="#E5E5E5">and the kind of worst case</font><font color="#CCCCCC"> scenario</font>

978
00:35:51,910 --> 00:35:56,140
coming<font color="#E5E5E5"> to light with these service</font>

979
00:35:53,410 --> 00:35:57,609
accounts so very<font color="#E5E5E5"> very simple these are</font>

980
00:35:56,140 --> 00:35:59,348
<font color="#E5E5E5">stored directly in the registry with</font>

981
00:35:57,609 --> 00:36:02,230
admin<font color="#CCCCCC"> rights</font><font color="#E5E5E5"> you can do something</font><font color="#CCCCCC"> like</font>

982
00:35:59,349 --> 00:36:04,000
<font color="#E5E5E5">this dump out all the LSA secrets this</font>

983
00:36:02,230 --> 00:36:07,150
case this<font color="#E5E5E5"> is a big win this is the</font>

984
00:36:04,000 --> 00:36:08,549
<font color="#E5E5E5">sequel server we pull out a relatively</font>

985
00:36:07,150 --> 00:36:10,869
strong<font color="#E5E5E5"> password that sequel server</font>

986
00:36:08,549 --> 00:36:12,430
<font color="#E5E5E5">account and now we can start</font><font color="#CCCCCC"> to</font>

987
00:36:10,869 --> 00:36:14,140
authenticate on that around the network

988
00:36:12,430 --> 00:36:15,520
<font color="#E5E5E5">now I don't know about you guys</font><font color="#CCCCCC"> but I've</font>

989
00:36:14,140 --> 00:36:16,868
actually seen environments where<font color="#CCCCCC"> people</font>

990
00:36:15,520 --> 00:36:19,450
have<font color="#CCCCCC"> been told to</font><font color="#E5E5E5"> run their sequel</font>

991
00:36:16,869 --> 00:36:21,490
server using domain<font color="#E5E5E5"> admin rights and if</font>

992
00:36:19,450 --> 00:36:24,460
that's the<font color="#E5E5E5"> case</font><font color="#CCCCCC"> you just own the network</font>

993
00:36:21,490 --> 00:36:25,299
with<font color="#CCCCCC"> one command another thing you'll</font>

994
00:36:24,460 --> 00:36:28,049
<font color="#CCCCCC">notice on this this</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> actually</font>

995
00:36:25,299 --> 00:36:30,700
PowerShell another trend we've seen<font color="#CCCCCC"> is a</font>

996
00:36:28,049 --> 00:36:32,529
many many<font color="#CCCCCC"> tools are now</font><font color="#E5E5E5"> being rewritten</font>

997
00:36:30,700 --> 00:36:34,089
to to work in<font color="#E5E5E5"> the PowerShell environment</font>

998
00:36:32,529 --> 00:36:37,779
<font color="#E5E5E5">you might be familiar with power sploit</font>

999
00:36:34,089 --> 00:36:40,630
<font color="#E5E5E5">this is a</font><font color="#CCCCCC"> lesser-known</font><font color="#E5E5E5"> framework called</font>

1000
00:36:37,779 --> 00:36:43,510
nishang<font color="#E5E5E5"> which is also a pentesting slash</font>

1001
00:36:40,630 --> 00:36:45,279
offensive power<font color="#E5E5E5"> partial exploit kit does</font>

1002
00:36:43,510 --> 00:36:50,710
an<font color="#CCCCCC"> awesome job of</font><font color="#E5E5E5"> pulling LSA</font><font color="#CCCCCC"> secrets</font>

1003
00:36:45,279 --> 00:36:53,529
out<font color="#E5E5E5"> all right so how do we protect about</font>

1004
00:36:50,710 --> 00:36:55,960
this<font color="#CCCCCC"> well this is where your big</font>

1005
00:36:53,529 --> 00:36:58,839
<font color="#E5E5E5">takeaway</font><font color="#CCCCCC"> you're probably</font><font color="#E5E5E5"> the second</font><font color="#CCCCCC"> most</font>

1006
00:36:55,960 --> 00:37:00,549
important takeaway of today go<font color="#E5E5E5"> audit</font>

1007
00:36:58,839 --> 00:37:03,609
your service accounts<font color="#CCCCCC"> alright these</font>

1008
00:37:00,549 --> 00:37:05,319
<font color="#CCCCCC">things are such a liability</font><font color="#E5E5E5"> in your</font>

1009
00:37:03,609 --> 00:37:07,180
environment<font color="#CCCCCC"> right if you do one thing</font>

1010
00:37:05,319 --> 00:37:08,680
this<font color="#CCCCCC"> year go back identify all the</font>

1011
00:37:07,180 --> 00:37:10,149
service accounts identify which ones are

1012
00:37:08,680 --> 00:37:12,190
running as<font color="#CCCCCC"> domain accounts because</font>

1013
00:37:10,150 --> 00:37:13,539
they're by<font color="#CCCCCC"> far the most vulnerable I'll</font>

1014
00:37:12,190 --> 00:37:15,130
figure out<font color="#E5E5E5"> if you need them forget if</font>

1015
00:37:13,539 --> 00:37:17,589
you've<font color="#CCCCCC"> changed the password recently and</font>

1016
00:37:15,130 --> 00:37:20,079
if you've<font color="#CCCCCC"> done</font><font color="#E5E5E5"> all of that start to</font>

1017
00:37:17,589 --> 00:37:21,970
audit those service accounts<font color="#CCCCCC"> right</font><font color="#E5E5E5"> this</font>

1018
00:37:20,079 --> 00:37:23,950
is a wonderful place<font color="#E5E5E5"> when you're hunting</font>

1019
00:37:21,970 --> 00:37:25,629
<font color="#E5E5E5">to your environment</font><font color="#CCCCCC"> identify malicious</font>

1020
00:37:23,950 --> 00:37:27,279
<font color="#CCCCCC">servers account usage can</font><font color="#E5E5E5"> be very easy</font>

1021
00:37:25,630 --> 00:37:29,710
<font color="#E5E5E5">consider these sort of accounts do the</font>

1022
00:37:27,280 --> 00:37:31,810
same thing that<font color="#CCCCCC"> backup service probably</font>

1023
00:37:29,710 --> 00:37:33,099
authenticates<font color="#E5E5E5"> type 3 log on throughout</font>

1024
00:37:31,810 --> 00:37:35,200
your environment<font color="#CCCCCC"> so your server</font>

1025
00:37:33,099 --> 00:37:37,030
environment<font color="#E5E5E5"> right if you start seeing</font>

1026
00:37:35,200 --> 00:37:38,109
<font color="#CCCCCC">that accounts indicating with a type 10</font>

1027
00:37:37,030 --> 00:37:41,530
like an RDP

1028
00:37:38,109 --> 00:37:45,460
type authentication that's a god-given

1029
00:37:41,530 --> 00:37:49,210
<font color="#E5E5E5">clue</font><font color="#CCCCCC"> that you are owned right go find</font>

1030
00:37:45,460 --> 00:37:50,230
that<font color="#E5E5E5"> and kill it</font><font color="#CCCCCC"> and so you've got we've</font>

1031
00:37:49,210 --> 00:37:52,300
got<font color="#CCCCCC"> to wrap</font><font color="#E5E5E5"> our head around these</font>

1032
00:37:50,230 --> 00:37:53,650
service accounts<font color="#E5E5E5"> if anything just doing</font>

1033
00:37:52,300 --> 00:37:56,020
<font color="#E5E5E5">this will prepare you for when you do</font>

1034
00:37:53,650 --> 00:37:57,400
get<font color="#E5E5E5"> that intrusion almost inevitably</font>

1035
00:37:56,020 --> 00:37:59,080
you're<font color="#CCCCCC"> going to end up doing</font><font color="#E5E5E5"> a full</font>

1036
00:37:57,400 --> 00:38:00,730
<font color="#CCCCCC">passive reset of your</font><font color="#E5E5E5"> environment at</font>

1037
00:37:59,080 --> 00:38:02,770
some point in your career<font color="#E5E5E5"> if you've</font>

1038
00:38:00,730 --> 00:38:05,020
already gone<font color="#CCCCCC"> out</font><font color="#E5E5E5"> and identified well</font>

1039
00:38:02,770 --> 00:38:07,300
your<font color="#E5E5E5"> service accounts are</font><font color="#CCCCCC"> your 50% of</font>

1040
00:38:05,020 --> 00:38:08,950
the way there<font color="#CCCCCC"> you know the level</font><font color="#E5E5E5"> of</font>

1041
00:38:07,300 --> 00:38:11,890
hardship that it puts<font color="#E5E5E5"> teams on to</font>

1042
00:38:08,950 --> 00:38:13,118
<font color="#E5E5E5">identify these is just astonishing so</font>

1043
00:38:11,890 --> 00:38:13,900
get ahead of the game<font color="#E5E5E5"> would</font><font color="#CCCCCC"> be my</font>

1044
00:38:13,119 --> 00:38:16,599
recommendation

1045
00:38:13,900 --> 00:38:17,830
and of course if you can Microsoft<font color="#E5E5E5"> has</font>

1046
00:38:16,599 --> 00:38:19,720
have a<font color="#CCCCCC"> solution for this called those</font>

1047
00:38:17,830 --> 00:38:22,180
group managed service accounts and this

1048
00:38:19,720 --> 00:38:25,770
will provide really strong passwords<font color="#E5E5E5"> and</font>

1049
00:38:22,180 --> 00:38:28,540
roll them over<font color="#E5E5E5"> every 30 days by default</font>

1050
00:38:25,770 --> 00:38:31,060
all<font color="#E5E5E5"> right so you guys are probably</font>

1051
00:38:28,540 --> 00:38:32,650
<font color="#CCCCCC">thinking</font><font color="#E5E5E5"> Chad I know about all</font><font color="#CCCCCC"> that</font>

1052
00:38:31,060 --> 00:38:35,890
<font color="#E5E5E5">right</font><font color="#CCCCCC"> tell me</font><font color="#E5E5E5"> something</font><font color="#CCCCCC"> that's I don't</font>

1053
00:38:32,650 --> 00:38:37,300
<font color="#CCCCCC">know right this is</font><font color="#E5E5E5"> you're boring me</font><font color="#CCCCCC"> this</font>

1054
00:38:35,890 --> 00:38:39,310
is all<font color="#CCCCCC"> old-school we've been doing this</font>

1055
00:38:37,300 --> 00:38:41,140
<font color="#E5E5E5">for 10</font><font color="#CCCCCC"> years</font><font color="#E5E5E5"> and you're right</font>

1056
00:38:39,310 --> 00:38:42,509
although I will say<font color="#CCCCCC"> it 99% your</font>

1057
00:38:41,140 --> 00:38:45,520
environment<font color="#E5E5E5"> this stuff still works</font>

1058
00:38:42,510 --> 00:38:47,830
<font color="#E5E5E5">ridiculous but this is</font><font color="#CCCCCC"> was we're</font>

1059
00:38:45,520 --> 00:38:50,109
<font color="#E5E5E5">supposed to fix it for us</font><font color="#CCCCCC"> like Kerberos</font>

1060
00:38:47,830 --> 00:38:52,119
I remember<font color="#E5E5E5"> that Kerberos comes out of</font>

1061
00:38:50,109 --> 00:38:53,980
MIT<font color="#CCCCCC"> this was going</font><font color="#E5E5E5"> to provide some</font>

1062
00:38:52,119 --> 00:38:57,430
<font color="#E5E5E5">sanity to</font><font color="#CCCCCC"> our authentication mess</font><font color="#E5E5E5"> and</font>

1063
00:38:53,980 --> 00:39:00,250
<font color="#CCCCCC">windows way back in in two days now</font>

1064
00:38:57,430 --> 00:39:02,799
<font color="#CCCCCC">unfortunately as an idea in theory</font>

1065
00:39:00,250 --> 00:39:04,359
Kerberos<font color="#CCCCCC"> is pretty darn secure</font><font color="#E5E5E5"> right it</font>

1066
00:39:02,800 --> 00:39:06,160
has<font color="#CCCCCC"> wonderful things like the ability to</font>

1067
00:39:04,359 --> 00:39:08,380
prevent<font color="#E5E5E5"> replay attacks you know there's</font>

1068
00:39:06,160 --> 00:39:10,180
a timing<font color="#E5E5E5"> mechanism</font><font color="#CCCCCC"> in Kerberos but</font>

1069
00:39:08,380 --> 00:39:13,690
you'll<font color="#E5E5E5"> notice in the implementation in</font>

1070
00:39:10,180 --> 00:39:15,640
real life is that<font color="#CCCCCC"> it's been just largely</font>

1071
00:39:13,690 --> 00:39:18,970
riddled with holes<font color="#CCCCCC"> in order</font><font color="#E5E5E5"> to make it</font>

1072
00:39:15,640 --> 00:39:20,830
work effectively<font color="#CCCCCC"> it has an example yes</font>

1073
00:39:18,970 --> 00:39:22,689
you can actually<font color="#E5E5E5"> prevent replay attacks</font>

1074
00:39:20,830 --> 00:39:24,549
<font color="#E5E5E5">in Kerberos but what happens is that</font>

1075
00:39:22,690 --> 00:39:27,010
everything in your<font color="#CCCCCC"> environment is tied</font>

1076
00:39:24,550 --> 00:39:28,180
to an account so it<font color="#CCCCCC"> unde AIT's the</font>

1077
00:39:27,010 --> 00:39:30,040
domain controller with all these

1078
00:39:28,180 --> 00:39:31,500
requests<font color="#E5E5E5"> for accessing</font><font color="#CCCCCC"> you know every</font>

1079
00:39:30,040 --> 00:39:34,089
<font color="#E5E5E5">single object</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> the environment and</font>

1080
00:39:31,500 --> 00:39:35,320
simply you can't do that<font color="#E5E5E5"> the procedures</font>

1081
00:39:34,089 --> 00:39:37,390
performance goes<font color="#E5E5E5"> kind of</font>

1082
00:39:35,320 --> 00:39:39,130
nose done<font color="#E5E5E5"> all right so what happens is</font>

1083
00:39:37,390 --> 00:39:41,379
you see here<font color="#E5E5E5"> you often have tickets that</font>

1084
00:39:39,130 --> 00:39:42,760
are<font color="#E5E5E5"> valid</font><font color="#CCCCCC"> for 10 hours</font><font color="#E5E5E5"> so I get a ticket</font>

1085
00:39:41,380 --> 00:39:44,860
<font color="#CCCCCC">I can reuse that ticket for 10 hours</font>

1086
00:39:42,760 --> 00:39:46,630
<font color="#E5E5E5">which shouldn't be possible in the kind</font>

1087
00:39:44,860 --> 00:39:49,510
<font color="#E5E5E5">of the</font><font color="#CCCCCC"> Kerberos Beck</font><font color="#E5E5E5"> right there's all</font>

1088
00:39:46,630 --> 00:39:52,150
these<font color="#E5E5E5"> kind of you</font><font color="#CCCCCC"> know</font><font color="#E5E5E5"> vulnerabilities</font>

1089
00:39:49,510 --> 00:39:54,730
have<font color="#E5E5E5"> kind of been introduced there so I</font>

1090
00:39:52,150 --> 00:39:56,320
would say<font color="#E5E5E5"> that while this is probably</font>

1091
00:39:54,730 --> 00:39:58,180
the<font color="#CCCCCC"> most advanced piece</font><font color="#E5E5E5"> of Windows</font>

1092
00:39:56,320 --> 00:40:00,610
authentication<font color="#CCCCCC"> it has the biggest</font>

1093
00:39:58,180 --> 00:40:02,589
vulnerabilities<font color="#E5E5E5"> it's the typical kind of</font>

1094
00:40:00,610 --> 00:40:04,990
the more complex<font color="#E5E5E5"> it is</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> more holes</font>

1095
00:40:02,590 --> 00:40:05,920
are in<font color="#E5E5E5"> place and traditionally like the</font>

1096
00:40:04,990 --> 00:40:08,770
last<font color="#CCCCCC"> couple of</font><font color="#E5E5E5"> years</font>

1097
00:40:05,920 --> 00:40:10,870
<font color="#E5E5E5">Kerberos has just been under fire right</font>

1098
00:40:08,770 --> 00:40:13,320
<font color="#E5E5E5">we've just seen</font><font color="#CCCCCC"> how it sirs being aimed</font>

1099
00:40:10,870 --> 00:40:16,120
at curbs and blowing giant holes<font color="#CCCCCC"> into</font>

1100
00:40:13,320 --> 00:40:18,820
here's<font color="#E5E5E5"> the simplest so just like pass</font>

1101
00:40:16,120 --> 00:40:20,770
<font color="#E5E5E5">the</font><font color="#CCCCCC"> hash well if I can get access</font><font color="#E5E5E5"> to a</font>

1102
00:40:18,820 --> 00:40:22,780
<font color="#E5E5E5">ticket which is kind of the core unit of</font>

1103
00:40:20,770 --> 00:40:24,700
Kerberos<font color="#CCCCCC"> I can just pass that ticket in</font>

1104
00:40:22,780 --> 00:40:26,740
the same exact way we saw<font color="#CCCCCC"> passed the</font>

1105
00:40:24,700 --> 00:40:29,379
hash<font color="#E5E5E5"> it's all I have to do is in this</font>

1106
00:40:26,740 --> 00:40:32,410
<font color="#E5E5E5">case we're running as a standard user to</font>

1107
00:40:29,380 --> 00:40:34,870
<font color="#CCCCCC">Duncan here all I have</font><font color="#E5E5E5"> to do now</font><font color="#CCCCCC"> is just</font>

1108
00:40:32,410 --> 00:40:37,509
dump a ticket<font color="#E5E5E5"> from anywhere import it</font>

1109
00:40:34,870 --> 00:40:40,000
into this<font color="#E5E5E5"> computer and in this case this</font>

1110
00:40:37,510 --> 00:40:41,950
was<font color="#CCCCCC"> the domain admin ticket and now I'm</font>

1111
00:40:40,000 --> 00:40:43,660
that domain admin<font color="#E5E5E5"> all right so I can</font>

1112
00:40:41,950 --> 00:40:45,819
<font color="#E5E5E5">just take</font><font color="#CCCCCC"> a ticket</font><font color="#E5E5E5"> and move it around</font>

1113
00:40:43,660 --> 00:40:50,020
<font color="#E5E5E5">the environment import it and it's off</font>

1114
00:40:45,820 --> 00:40:53,560
to the races<font color="#E5E5E5"> you can see now I must</font>

1115
00:40:50,020 --> 00:40:56,440
syndicated as that in this case domain

1116
00:40:53,560 --> 00:40:59,020
admin all right so that's the<font color="#CCCCCC"> Mimi</font><font color="#E5E5E5"> katz</font>

1117
00:40:56,440 --> 00:41:01,000
<font color="#E5E5E5">tool it's way way</font><font color="#CCCCCC"> more complicated</font><font color="#E5E5E5"> than</font>

1118
00:40:59,020 --> 00:41:03,070
<font color="#CCCCCC">passed the ticket so</font><font color="#E5E5E5"> pass</font><font color="#CCCCCC"> the ticket is</font>

1119
00:41:01,000 --> 00:41:05,290
like level<font color="#CCCCCC"> 1 if you get</font><font color="#E5E5E5"> into things</font>

1120
00:41:03,070 --> 00:41:07,900
<font color="#E5E5E5">called like over pass the hash this</font>

1121
00:41:05,290 --> 00:41:09,940
<font color="#E5E5E5">one's clever so if you start to run into</font>

1122
00:41:07,900 --> 00:41:12,310
<font color="#E5E5E5">issues where maybe pass the hash isn't</font>

1123
00:41:09,940 --> 00:41:14,110
working you could actually go and<font color="#E5E5E5"> just</font>

1124
00:41:12,310 --> 00:41:15,730
take the hash<font color="#E5E5E5"> supply the hash to</font><font color="#CCCCCC"> the</font>

1125
00:41:14,110 --> 00:41:17,470
domain controller and<font color="#CCCCCC"> get a ticket</font><font color="#E5E5E5"> back</font>

1126
00:41:15,730 --> 00:41:18,940
and now you've got<font color="#E5E5E5"> a ticket that</font><font color="#CCCCCC"> you can</font>

1127
00:41:17,470 --> 00:41:19,240
then<font color="#E5E5E5"> use</font><font color="#CCCCCC"> to do things like pass</font><font color="#E5E5E5"> the</font>

1128
00:41:18,940 --> 00:41:22,500
ticket

1129
00:41:19,240 --> 00:41:24,459
<font color="#E5E5E5">let's call this over pass the hash</font>

1130
00:41:22,500 --> 00:41:27,400
<font color="#CCCCCC">relatively new technicals come out</font>

1131
00:41:24,460 --> 00:41:28,990
called<font color="#CCCCCC"> Kerberos ting this one</font><font color="#E5E5E5"> you know</font>

1132
00:41:27,400 --> 00:41:32,110
literally<font color="#CCCCCC"> I had</font><font color="#E5E5E5"> to sit down</font><font color="#CCCCCC"> and almost</font>

1133
00:41:28,990 --> 00:41:34,629
<font color="#E5E5E5">came to tears when</font><font color="#CCCCCC"> I saw their amazingly</font>

1134
00:41:32,110 --> 00:41:36,850
the way the whole Kerberos environment

1135
00:41:34,630 --> 00:41:39,220
is set up is that<font color="#E5E5E5"> any user account can</font>

1136
00:41:36,850 --> 00:41:41,140
request a ticket or service ticket<font color="#E5E5E5"> for</font>

1137
00:41:39,220 --> 00:41:42,640
any service in<font color="#E5E5E5"> the environment the</font>

1138
00:41:41,140 --> 00:41:43,870
domain controller doesn't know whether

1139
00:41:42,640 --> 00:41:46,060
<font color="#E5E5E5">you have privileges to a certain</font>

1140
00:41:43,870 --> 00:41:48,430
computer<font color="#E5E5E5"> or certain service right</font><font color="#CCCCCC"> it</font>

1141
00:41:46,060 --> 00:41:49,259
says yeah here's<font color="#CCCCCC"> the ticket provide this</font>

1142
00:41:48,430 --> 00:41:51,118
to that remote

1143
00:41:49,260 --> 00:41:53,280
and it will authenticate<font color="#E5E5E5"> whether you</font>

1144
00:41:51,119 --> 00:41:55,650
have<font color="#E5E5E5"> access or not the only problem is</font>

1145
00:41:53,280 --> 00:41:58,980
<font color="#CCCCCC">that ticket</font><font color="#E5E5E5"> is encrypted with</font><font color="#CCCCCC"> the empty</font>

1146
00:41:55,650 --> 00:42:01,050
hash of that<font color="#E5E5E5"> service so basically I can</font>

1147
00:41:58,980 --> 00:42:02,670
<font color="#E5E5E5">request every service every account</font><font color="#CCCCCC"> in</font>

1148
00:42:01,050 --> 00:42:04,710
<font color="#CCCCCC">the</font><font color="#E5E5E5"> environment get all of their empty</font>

1149
00:42:02,670 --> 00:42:06,720
hashes back nicely

1150
00:42:04,710 --> 00:42:09,150
<font color="#E5E5E5">Kerberos provides them to me take them</font>

1151
00:42:06,720 --> 00:42:11,250
offline<font color="#CCCCCC"> find one that's a domain account</font>

1152
00:42:09,150 --> 00:42:13,400
with<font color="#E5E5E5"> high level privileges crack it</font>

1153
00:42:11,250 --> 00:42:16,680
offline and I'm back<font color="#E5E5E5"> in the game</font>

1154
00:42:13,400 --> 00:42:18,359
ridiculous<font color="#E5E5E5"> but extremely possible very</font>

1155
00:42:16,680 --> 00:42:21,419
hard to detect<font color="#CCCCCC"> who's sort of a golden</font>

1156
00:42:18,359 --> 00:42:23,940
<font color="#CCCCCC">ticket Willy Wonka golden ticket</font><font color="#E5E5E5"> I'm</font>

1157
00:42:21,420 --> 00:42:26,310
glad to see so<font color="#CCCCCC"> many hands go up</font><font color="#E5E5E5"> this was</font>

1158
00:42:23,940 --> 00:42:28,770
another kind of<font color="#CCCCCC"> a-ha moment</font><font color="#E5E5E5"> that again</font>

1159
00:42:26,310 --> 00:42:30,210
came out<font color="#E5E5E5"> via the Mimi</font><font color="#CCCCCC"> Katz tool</font><font color="#E5E5E5"> this is</font>

1160
00:42:28,770 --> 00:42:33,300
an ability<font color="#E5E5E5"> to create a ticket that</font><font color="#CCCCCC"> can</font>

1161
00:42:30,210 --> 00:42:34,890
literally work indefinitely<font color="#E5E5E5"> to any</font>

1162
00:42:33,300 --> 00:42:36,540
account you can make yourself match the

1163
00:42:34,890 --> 00:42:37,500
<font color="#E5E5E5">domain admin you can make it a</font><font color="#CCCCCC"> CAPA</font>

1164
00:42:36,540 --> 00:42:40,529
doesn't even exist in<font color="#E5E5E5"> the environment</font>

1165
00:42:37,500 --> 00:42:42,480
<font color="#E5E5E5">domain admin and authenticate the crazy</font>

1166
00:42:40,530 --> 00:42:45,720
thing here<font color="#CCCCCC"> this is the worst case</font>

1167
00:42:42,480 --> 00:42:48,240
<font color="#E5E5E5">scenario</font><font color="#CCCCCC"> you successfully remediate your</font>

1168
00:42:45,720 --> 00:42:49,859
environment<font color="#CCCCCC"> you do a full password reset</font>

1169
00:42:48,240 --> 00:42:53,160
of every account in the environment

1170
00:42:49,859 --> 00:42:54,630
<font color="#E5E5E5">right your attackers go away they come</font>

1171
00:42:53,160 --> 00:42:55,980
<font color="#E5E5E5">back the</font><font color="#CCCCCC"> next month</font><font color="#E5E5E5"> they get their</font>

1172
00:42:54,630 --> 00:42:57,900
initial foothold again through another

1173
00:42:55,980 --> 00:43:00,510
spear phishing attempt once they have

1174
00:42:57,900 --> 00:43:01,980
local access they can re import that old

1175
00:43:00,510 --> 00:43:04,710
golden ticket<font color="#E5E5E5"> in and they immediately</font>

1176
00:43:01,980 --> 00:43:06,810
<font color="#E5E5E5">become domain admin</font><font color="#CCCCCC"> I they can own the</font>

1177
00:43:04,710 --> 00:43:08,880
entire<font color="#E5E5E5"> domain there's only one way</font><font color="#CCCCCC"> to</font>

1178
00:43:06,810 --> 00:43:12,299
prevent this<font color="#E5E5E5"> you've got to change that</font>

1179
00:43:08,880 --> 00:43:13,560
<font color="#E5E5E5">KRV GT password and twice actually</font><font color="#CCCCCC"> at</font>

1180
00:43:12,300 --> 00:43:15,240
the domain controller if you forget<font color="#E5E5E5"> to</font>

1181
00:43:13,560 --> 00:43:18,060
<font color="#CCCCCC">do that Golden Tickets lasts</font>

1182
00:43:15,240 --> 00:43:20,640
indefinitely<font color="#E5E5E5"> silver tickets are kind of</font>

1183
00:43:18,060 --> 00:43:22,980
<font color="#E5E5E5">a the not</font><font color="#CCCCCC"> they at first they don't</font><font color="#E5E5E5"> seem</font>

1184
00:43:20,640 --> 00:43:25,348
<font color="#E5E5E5">as hot or useful but these things can</font><font color="#CCCCCC"> be</font>

1185
00:43:22,980 --> 00:43:28,050
incredibly<font color="#CCCCCC"> useful</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> similar to the</font>

1186
00:43:25,349 --> 00:43:30,359
golden ticket<font color="#E5E5E5"> but only is valid for a</font>

1187
00:43:28,050 --> 00:43:32,520
single<font color="#E5E5E5"> resource like a single computer</font>

1188
00:43:30,359 --> 00:43:35,160
<font color="#CCCCCC">or a</font><font color="#E5E5E5"> single service what's really</font>

1189
00:43:32,520 --> 00:43:36,390
valuable<font color="#E5E5E5"> about these is that they don't</font>

1190
00:43:35,160 --> 00:43:38,009
authenticate against the domain

1191
00:43:36,390 --> 00:43:39,750
controller so you get no logging<font color="#E5E5E5"> the</font>

1192
00:43:38,010 --> 00:43:42,060
domain controller<font color="#CCCCCC"> ponies are used right</font>

1193
00:43:39,750 --> 00:43:44,040
so become a very stealthy way to<font color="#E5E5E5"> move</font>

1194
00:43:42,060 --> 00:43:46,980
through the<font color="#CCCCCC"> environment and just to</font>

1195
00:43:44,040 --> 00:43:48,420
punch<font color="#CCCCCC"> Microsoft Munoz one more time we</font>

1196
00:43:46,980 --> 00:43:50,040
got the<font color="#E5E5E5"> skeleton key that came out a</font>

1197
00:43:48,420 --> 00:43:51,599
while<font color="#CCCCCC"> ago which essentially</font><font color="#E5E5E5"> once you</font>

1198
00:43:50,040 --> 00:43:53,640
have<font color="#E5E5E5"> actual domain controller</font><font color="#CCCCCC"> you can go</font>

1199
00:43:51,599 --> 00:43:56,730
patch<font color="#E5E5E5"> else ask the domain controller and</font>

1200
00:43:53,640 --> 00:43:58,589
since you create a backdoor into<font color="#CCCCCC"> any</font>

1201
00:43:56,730 --> 00:44:01,380
<font color="#CCCCCC">account you</font><font color="#E5E5E5"> want where your password</font>

1202
00:43:58,589 --> 00:44:02,730
always works<font color="#E5E5E5"> right so it</font><font color="#CCCCCC"> basically</font><font color="#E5E5E5"> is a</font>

1203
00:44:01,380 --> 00:44:05,630
very very<font color="#CCCCCC"> easy</font>

1204
00:44:02,730 --> 00:44:07,800
<font color="#CCCCCC">backdoor with essentially zero logging</font>

1205
00:44:05,630 --> 00:44:10,410
<font color="#E5E5E5">part of it right unless you're logging</font>

1206
00:44:07,800 --> 00:44:15,240
your driver usage on that<font color="#E5E5E5"> system which</font>

1207
00:44:10,410 --> 00:44:16,770
is pretty<font color="#E5E5E5"> rare</font><font color="#CCCCCC"> all right so the and then</font>

1208
00:44:15,240 --> 00:44:19,200
and<font color="#E5E5E5"> this is growing</font><font color="#CCCCCC"> right we're going</font><font color="#E5E5E5"> to</font>

1209
00:44:16,770 --> 00:44:21,150
see<font color="#E5E5E5"> probably three or</font><font color="#CCCCCC"> four more attacks</font>

1210
00:44:19,200 --> 00:44:22,680
the next year or<font color="#CCCCCC"> two kind of incur</font><font color="#E5E5E5"> both</font>

1211
00:44:21,150 --> 00:44:25,500
the<font color="#E5E5E5"> latest hotness which isn't on here</font>

1212
00:44:22,680 --> 00:44:28,080
things like<font color="#CCCCCC"> DC sinking</font><font color="#E5E5E5"> you can set</font><font color="#CCCCCC"> up a</font>

1213
00:44:25,500 --> 00:44:29,760
fake DC or pretend like your DC and get

1214
00:44:28,080 --> 00:44:32,970
the<font color="#E5E5E5"> entire DC to</font><font color="#CCCCCC"> sink if all</font><font color="#E5E5E5"> this</font>

1215
00:44:29,760 --> 00:44:35,369
accounts to you<font color="#E5E5E5"> effortlessly</font><font color="#CCCCCC"> alright</font><font color="#E5E5E5"> so</font>

1216
00:44:32,970 --> 00:44:38,600
how do we<font color="#E5E5E5"> prevent about this I know this</font>

1217
00:44:35,369 --> 00:44:41,150
<font color="#CCCCCC">is</font><font color="#E5E5E5"> a depressed yet I'm kind</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> depressed</font>

1218
00:44:38,600 --> 00:44:43,890
are we<font color="#E5E5E5"> valuing</font><font color="#CCCCCC"> preventers well</font>

1219
00:44:41,150 --> 00:44:45,090
credential guard<font color="#E5E5E5"> for past the ticket so</font>

1220
00:44:43,890 --> 00:44:46,890
<font color="#E5E5E5">it certainly that will</font><font color="#CCCCCC"> protect all</font><font color="#E5E5E5"> your</font>

1221
00:44:45,090 --> 00:44:48,869
<font color="#CCCCCC">tickets</font><font color="#E5E5E5"> you can't just dump tickets from</font>

1222
00:44:46,890 --> 00:44:50,040
a local<font color="#CCCCCC"> system any more</font><font color="#E5E5E5"> remote</font>

1223
00:44:48,869 --> 00:44:52,470
credential<font color="#CCCCCC"> guard</font><font color="#E5E5E5"> will prevent your</font>

1224
00:44:50,040 --> 00:44:55,050
credentials<font color="#CCCCCC"> from being</font><font color="#E5E5E5"> kind of placed</font>

1225
00:44:52,470 --> 00:44:56,899
all in all those remote systems that

1226
00:44:55,050 --> 00:44:59,910
your users are authenticating to

1227
00:44:56,900 --> 00:45:03,840
<font color="#E5E5E5">Kerberos or Kerberos link is completely</font>

1228
00:44:59,910 --> 00:45:06,720
reliant<font color="#CCCCCC"> upon cracking of those hashes</font><font color="#E5E5E5"> so</font>

1229
00:45:03,840 --> 00:45:08,010
<font color="#CCCCCC">if you can have very complex passwords</font>

1230
00:45:06,720 --> 00:45:09,029
on your service<font color="#CCCCCC"> accounts which is</font>

1231
00:45:08,010 --> 00:45:11,430
basically what Kerberos<font color="#E5E5E5"> thing is</font>

1232
00:45:09,030 --> 00:45:15,359
attacking then you will since<font color="#E5E5E5"> you</font>

1233
00:45:11,430 --> 00:45:17,250
prevent<font color="#CCCCCC"> that attack you know your</font>

1234
00:45:15,359 --> 00:45:18,960
service attack accounts are valuable and

1235
00:45:17,250 --> 00:45:21,030
<font color="#CCCCCC">interesting so set up really</font><font color="#E5E5E5"> good</font>

1236
00:45:18,960 --> 00:45:23,700
monitoring<font color="#CCCCCC"> around those</font><font color="#E5E5E5"> and then finally</font>

1237
00:45:21,030 --> 00:45:25,470
some<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the guidance and</font><font color="#CCCCCC"> that I've</font><font color="#E5E5E5"> been</font>

1238
00:45:23,700 --> 00:45:27,118
giving to people<font color="#E5E5E5"> is basically changed</font>

1239
00:45:25,470 --> 00:45:31,200
<font color="#E5E5E5">regardless of what happens change that</font>

1240
00:45:27,119 --> 00:45:33,060
<font color="#CCCCCC">Kara BG</font><font color="#E5E5E5"> krbtgt ticket at least once a</font>

1241
00:45:31,200 --> 00:45:34,799
year<font color="#CCCCCC"> that way you at least</font><font color="#E5E5E5"> are expiring</font>

1242
00:45:33,060 --> 00:45:36,420
golden tickets that may be out<font color="#CCCCCC"> in the</font>

1243
00:45:34,800 --> 00:45:38,850
wild<font color="#E5E5E5"> on your environment</font><font color="#CCCCCC"> at</font><font color="#E5E5E5"> least once</font>

1244
00:45:36,420 --> 00:45:40,440
per<font color="#E5E5E5"> year</font><font color="#CCCCCC"> now that's</font><font color="#E5E5E5"> scary in itself some</font>

1245
00:45:38,850 --> 00:45:41,670
some admins don't want to touch that<font color="#E5E5E5"> cuz</font>

1246
00:45:40,440 --> 00:45:43,650
afraid though<font color="#E5E5E5"> it'll break the entire</font>

1247
00:45:41,670 --> 00:45:44,910
<font color="#E5E5E5">domain you might as well do it now</font>

1248
00:45:43,650 --> 00:45:46,770
<font color="#E5E5E5">because</font><font color="#CCCCCC"> you're probably</font><font color="#E5E5E5"> have to do it</font>

1249
00:45:44,910 --> 00:45:48,359
<font color="#E5E5E5">later anyway all</font><font color="#CCCCCC"> right get the pain</font>

1250
00:45:46,770 --> 00:45:52,850
while you while he can plan<font color="#CCCCCC"> for it and</font>

1251
00:45:48,359 --> 00:45:52,850
<font color="#E5E5E5">then get</font><font color="#CCCCCC"> it into</font><font color="#E5E5E5"> your regular rotation</font>

1252
00:45:53,570 --> 00:46:01,100
<font color="#CCCCCC">alright and if it</font><font color="#E5E5E5"> wasn't bad enough I I</font>

1253
00:45:57,750 --> 00:46:04,260
feel<font color="#E5E5E5"> like hands on heads</font><font color="#CCCCCC"> like</font><font color="#E5E5E5"> seriously</font>

1254
00:46:01,100 --> 00:46:05,970
the nuclear option of course<font color="#E5E5E5"> is why do I</font>

1255
00:46:04,260 --> 00:46:08,040
need<font color="#E5E5E5"> a single hash or I might just</font>

1256
00:46:05,970 --> 00:46:09,629
dumping<font color="#CCCCCC"> hashes all over</font><font color="#E5E5E5"> once I've got</font>

1257
00:46:08,040 --> 00:46:11,670
domain admin privileges I can just go

1258
00:46:09,630 --> 00:46:13,080
<font color="#CCCCCC">straight to</font><font color="#E5E5E5"> the main controller and I</font>

1259
00:46:11,670 --> 00:46:15,570
can just download the entire<font color="#CCCCCC"> Active</font>

1260
00:46:13,080 --> 00:46:16,660
<font color="#CCCCCC">Directory and so this is a very very</font>

1261
00:46:15,570 --> 00:46:18,940
<font color="#E5E5E5">common technique view</font>

1262
00:46:16,660 --> 00:46:20,890
see in modern attacks<font color="#E5E5E5"> the attackers will</font>

1263
00:46:18,940 --> 00:46:22,420
just go<font color="#E5E5E5"> to the main controller find some</font>

1264
00:46:20,890 --> 00:46:26,200
<font color="#CCCCCC">way often through</font><font color="#E5E5E5"> valid volume shadow</font>

1265
00:46:22,420 --> 00:46:28,299
copies<font color="#E5E5E5"> get a back door into</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> locked</font>

1266
00:46:26,200 --> 00:46:30,520
account which is called the NTS<font color="#CCCCCC"> dip</font><font color="#E5E5E5"> and</font>

1267
00:46:28,299 --> 00:46:31,839
that is all your password hashes<font color="#E5E5E5"> not</font>

1268
00:46:30,520 --> 00:46:34,538
just all<font color="#E5E5E5"> the password hashes</font><font color="#CCCCCC"> that are</font>

1269
00:46:31,839 --> 00:46:36,880
current it also has<font color="#E5E5E5"> a history</font><font color="#CCCCCC"> of all the</font>

1270
00:46:34,539 --> 00:46:38,950
hashes<font color="#CCCCCC"> of that account you have</font><font color="#E5E5E5"> things</font>

1271
00:46:36,880 --> 00:46:40,210
like<font color="#E5E5E5"> you know kind of a history</font><font color="#CCCCCC"> of how</font>

1272
00:46:38,950 --> 00:46:42,098
many times someone has<font color="#E5E5E5"> changed their</font>

1273
00:46:40,210 --> 00:46:43,630
password<font color="#CCCCCC"> so they can't reuse the same</font>

1274
00:46:42,099 --> 00:46:45,970
password when<font color="#E5E5E5"> you force them to change</font>

1275
00:46:43,630 --> 00:46:47,770
<font color="#CCCCCC">it</font><font color="#E5E5E5"> every 90</font><font color="#CCCCCC"> days</font><font color="#E5E5E5"> you can get all their</font>

1276
00:46:45,970 --> 00:46:49,118
previous hashes as well which<font color="#E5E5E5"> can</font>

1277
00:46:47,770 --> 00:46:50,859
sometimes be valuable<font color="#CCCCCC"> because you can</font>

1278
00:46:49,119 --> 00:46:53,109
predict things like password reuse

1279
00:46:50,859 --> 00:46:55,150
<font color="#E5E5E5">through that</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> basically we can just</font>

1280
00:46:53,109 --> 00:46:56,859
yank<font color="#CCCCCC"> that file take it offline</font><font color="#E5E5E5"> and your</font>

1281
00:46:55,150 --> 00:47:01,059
entire active<font color="#E5E5E5"> directory's is now the</font>

1282
00:46:56,859 --> 00:47:02,288
attackers<font color="#CCCCCC"> right so extremely common this</font>

1283
00:47:01,059 --> 00:47:04,270
<font color="#E5E5E5">is</font><font color="#CCCCCC"> a great example</font><font color="#E5E5E5"> this is actually</font>

1284
00:47:02,289 --> 00:47:06,099
<font color="#CCCCCC">pulling it out</font><font color="#E5E5E5"> this was Italy or these</font>

1285
00:47:04,270 --> 00:47:08,859
were commands<font color="#E5E5E5"> pulled out</font><font color="#CCCCCC"> of memory</font><font color="#E5E5E5"> and</font>

1286
00:47:06,099 --> 00:47:11,230
<font color="#E5E5E5">so</font><font color="#CCCCCC"> we see the attackers essentially</font>

1287
00:47:08,859 --> 00:47:12,910
going<font color="#E5E5E5"> using VSS admin to list the shadow</font>

1288
00:47:11,230 --> 00:47:14,589
copies<font color="#CCCCCC"> they must</font><font color="#E5E5E5"> have found a shadow</font>

1289
00:47:12,910 --> 00:47:16,509
<font color="#E5E5E5">copy because they just copy out the</font>

1290
00:47:14,589 --> 00:47:19,240
<font color="#E5E5E5">three files they need number to extract</font>

1291
00:47:16,510 --> 00:47:21,099
<font color="#E5E5E5">those hashes pull them offline and if</font>

1292
00:47:19,240 --> 00:47:23,109
you look back one you get<font color="#E5E5E5"> a tool like</font>

1293
00:47:21,099 --> 00:47:25,240
the<font color="#E5E5E5"> NTDs extract nice free tool online</font>

1294
00:47:23,109 --> 00:47:27,160
which<font color="#E5E5E5"> will yank all those</font><font color="#CCCCCC"> hashes out and</font>

1295
00:47:25,240 --> 00:47:29,259
allow you<font color="#E5E5E5"> to start cracking them pass</font>

1296
00:47:27,160 --> 00:47:30,910
<font color="#E5E5E5">the hash attack over pass the hash</font>

1297
00:47:29,260 --> 00:47:32,710
attacks<font color="#CCCCCC"> you</font><font color="#E5E5E5"> know as you can imagine</font>

1298
00:47:30,910 --> 00:47:36,250
<font color="#E5E5E5">you're pretty</font><font color="#CCCCCC"> much good</font><font color="#E5E5E5"> to go at this</font>

1299
00:47:32,710 --> 00:47:38,770
<font color="#CCCCCC">point</font><font color="#E5E5E5"> you ever wonder why attackers</font>

1300
00:47:36,250 --> 00:47:40,900
<font color="#E5E5E5">continue to do things like this even</font>

1301
00:47:38,770 --> 00:47:44,079
<font color="#E5E5E5">after they've they've achieved domain</font>

1302
00:47:40,900 --> 00:47:45,640
dominance why do why do they keep

1303
00:47:44,079 --> 00:47:48,309
jumping credentials<font color="#E5E5E5"> right once you've</font>

1304
00:47:45,640 --> 00:47:50,470
got 20 good credentials<font color="#CCCCCC"> at work why do</font><font color="#E5E5E5"> I</font>

1305
00:47:48,309 --> 00:47:54,819
<font color="#CCCCCC">need</font><font color="#E5E5E5"> to actually go get everything it</font>

1306
00:47:50,470 --> 00:47:59,709
<font color="#E5E5E5">just because I pack rats password reuse</font>

1307
00:47:54,819 --> 00:48:01,808
or often what<font color="#CCCCCC"> I've seen is you do a full</font>

1308
00:47:59,710 --> 00:48:04,779
password reset in the environment<font color="#E5E5E5"> do you</font>

1309
00:48:01,809 --> 00:48:06,970
ever do a full password reset<font color="#CCCCCC"> that's so</font>

1310
00:48:04,779 --> 00:48:09,520
hard to do right<font color="#E5E5E5"> commonly you're going</font>

1311
00:48:06,970 --> 00:48:11,020
to miss a account or<font color="#E5E5E5"> two</font><font color="#CCCCCC"> they've got all</font>

1312
00:48:09,520 --> 00:48:12,220
of<font color="#E5E5E5"> them so when they come back but to</font>

1313
00:48:11,020 --> 00:48:13,630
start rolling<font color="#E5E5E5"> through all the admin</font>

1314
00:48:12,220 --> 00:48:14,770
accounts you might have an old admin

1315
00:48:13,630 --> 00:48:16,450
account you haven't touched in<font color="#E5E5E5"> three</font>

1316
00:48:14,770 --> 00:48:18,309
years<font color="#E5E5E5"> right</font><font color="#CCCCCC"> if</font><font color="#E5E5E5"> you haven't changed that</font>

1317
00:48:16,450 --> 00:48:19,779
password<font color="#CCCCCC"> they're back</font><font color="#E5E5E5"> in the next day</font>

1318
00:48:18,309 --> 00:48:21,250
this is almost<font color="#E5E5E5"> like a</font>

1319
00:48:19,779 --> 00:48:23,349
<font color="#CCCCCC">get-out-of-jail-free</font><font color="#E5E5E5"> card this</font><font color="#CCCCCC"> is their</font>

1320
00:48:21,250 --> 00:48:26,950
you<font color="#CCCCCC"> know kind of their big dumpster-dive</font>

1321
00:48:23,349 --> 00:48:28,750
of all your data<font color="#E5E5E5"> so knowing this and</font>

1322
00:48:26,950 --> 00:48:30,740
knowing<font color="#E5E5E5"> they're coming</font><font color="#CCCCCC"> right do we have</font>

1323
00:48:28,750 --> 00:48:33,599
<font color="#E5E5E5">any soccer players in here</font>

1324
00:48:30,740 --> 00:48:39,000
you have a giant<font color="#E5E5E5"> soccer field right</font>

1325
00:48:33,599 --> 00:48:41,940
where are the attackers going help me so

1326
00:48:39,000 --> 00:48:43,170
your goal right<font color="#E5E5E5"> goal right</font><font color="#CCCCCC"> you know</font>

1327
00:48:41,940 --> 00:48:44,460
where they're going<font color="#CCCCCC"> they're going to</font>

1328
00:48:43,170 --> 00:48:48,359
your domain controller if you do

1329
00:48:44,460 --> 00:48:50,130
anything watch that it's just like the

1330
00:48:48,359 --> 00:48:51,690
soccer goal we know they're<font color="#CCCCCC"> coming at</font>

1331
00:48:50,130 --> 00:48:53,400
some point now there's a million

1332
00:48:51,690 --> 00:48:56,010
different<font color="#CCCCCC"> ways they can come at you you</font>

1333
00:48:53,400 --> 00:48:57,960
<font color="#E5E5E5">know using PowerShell or any variety PS</font>

1334
00:48:56,010 --> 00:48:59,460
exact or any<font color="#E5E5E5"> variety of other tools but</font>

1335
00:48:57,960 --> 00:49:01,319
<font color="#CCCCCC">we know they're coming so this is a</font>

1336
00:48:59,460 --> 00:49:05,010
great place to<font color="#E5E5E5"> kind of put</font><font color="#CCCCCC"> some effort</font>

1337
00:49:01,319 --> 00:49:05,579
towards some detection mechanisms<font color="#CCCCCC"> all</font>

1338
00:49:05,010 --> 00:49:08,250
<font color="#E5E5E5">right</font>

1339
00:49:05,579 --> 00:49:12,000
this one's simple<font color="#CCCCCC"> a lot of mine is how</font>

1340
00:49:08,250 --> 00:49:14,160
do you<font color="#E5E5E5"> protect</font><font color="#CCCCCC"> this you don't</font><font color="#E5E5E5"> don't give</font>

1341
00:49:12,000 --> 00:49:16,680
them domain<font color="#CCCCCC"> advocates</font><font color="#E5E5E5"> again that's hard</font>

1342
00:49:14,160 --> 00:49:17,848
<font color="#E5E5E5">the other</font><font color="#CCCCCC"> way is detection you know</font><font color="#E5E5E5"> the</font>

1343
00:49:16,680 --> 00:49:20,640
way that<font color="#E5E5E5"> you create those</font><font color="#CCCCCC"> things like</font>

1344
00:49:17,849 --> 00:49:22,410
<font color="#E5E5E5">the skeleton</font><font color="#CCCCCC"> key or dumping</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> TDs did</font>

1345
00:49:20,640 --> 00:49:24,390
or going and<font color="#E5E5E5"> creating a golden ticket</font>

1346
00:49:22,410 --> 00:49:26,578
<font color="#CCCCCC">you got to</font><font color="#E5E5E5"> get the domain controller to</font>

1347
00:49:24,390 --> 00:49:29,279
<font color="#E5E5E5">get those credentials to make all that</font>

1348
00:49:26,579 --> 00:49:35,400
happen<font color="#CCCCCC"> so let's</font><font color="#E5E5E5"> sit and watch and look</font>

1349
00:49:29,280 --> 00:49:37,260
<font color="#E5E5E5">for unusual activities all right I could</font>

1350
00:49:35,400 --> 00:49:39,030
sit here<font color="#CCCCCC"> for literally another</font><font color="#E5E5E5"> three</font>

1351
00:49:37,260 --> 00:49:41,730
hours<font color="#CCCCCC"> and we</font><font color="#E5E5E5"> can keep digging into</font><font color="#CCCCCC"> this</font>

1352
00:49:39,030 --> 00:49:44,099
<font color="#E5E5E5">this is only</font><font color="#CCCCCC"> the start of the credential</font>

1353
00:49:41,730 --> 00:49:45,809
problem<font color="#CCCCCC"> in Windows there are so many</font>

1354
00:49:44,099 --> 00:49:47,010
<font color="#E5E5E5">more issues you know we haven't talked</font>

1355
00:49:45,809 --> 00:49:50,900
<font color="#E5E5E5">about things like the</font><font color="#CCCCCC"> Windows vault</font>

1356
00:49:47,010 --> 00:49:53,339
<font color="#CCCCCC">things like smart card pins the</font>

1357
00:49:50,900 --> 00:49:57,450
Microsoft cloud accounts<font color="#E5E5E5"> just total</font>

1358
00:49:53,339 --> 00:49:59,490
disaster<font color="#CCCCCC"> the Microsoft hello</font><font color="#E5E5E5"> it's coming</font>

1359
00:49:57,450 --> 00:50:02,308
out on<font color="#E5E5E5"> all the newer systems right if</font>

1360
00:49:59,490 --> 00:50:04,049
<font color="#E5E5E5">history</font><font color="#CCCCCC"> has taught us anything</font><font color="#E5E5E5"> we are</font>

1361
00:50:02,309 --> 00:50:06,030
seeing an escalated amount of attacks

1362
00:50:04,049 --> 00:50:08,190
against credentials<font color="#E5E5E5"> right so we're going</font>

1363
00:50:06,030 --> 00:50:09,329
<font color="#E5E5E5">to be surprised at what attackers are</font>

1364
00:50:08,190 --> 00:50:11,790
coming up<font color="#CCCCCC"> with in the next couple</font><font color="#E5E5E5"> of</font>

1365
00:50:09,329 --> 00:50:13,140
years<font color="#E5E5E5"> so</font><font color="#CCCCCC"> you've got to stay on top of</font>

1366
00:50:11,790 --> 00:50:15,779
those<font color="#E5E5E5"> right there's a great chart put</font>

1367
00:50:13,140 --> 00:50:19,470
out by Benjamin<font color="#E5E5E5"> Delpy who is the author</font>

1368
00:50:15,780 --> 00:50:21,690
<font color="#E5E5E5">of mini caps</font><font color="#CCCCCC"> he continues to to surprise</font>

1369
00:50:19,470 --> 00:50:23,189
us with new attacks against credential

1370
00:50:21,690 --> 00:50:29,369
if you're not<font color="#E5E5E5"> watching him you</font>

1371
00:50:23,190 --> 00:50:31,109
<font color="#E5E5E5">absolutely should</font><font color="#CCCCCC"> be all right</font><font color="#E5E5E5"> so we are</font>

1372
00:50:29,369 --> 00:50:33,240
<font color="#CCCCCC">in a red</font><font color="#E5E5E5"> state so I know that we're</font><font color="#CCCCCC"> all</font>

1373
00:50:31,109 --> 00:50:35,460
happy<font color="#CCCCCC"> that them we have a</font><font color="#E5E5E5"> matter in</font>

1374
00:50:33,240 --> 00:50:38,520
<font color="#E5E5E5">chief up here to to encourage us along I</font>

1375
00:50:35,460 --> 00:50:40,650
will tell you your mission<font color="#CCCCCC"> is</font><font color="#E5E5E5"> to go back</font>

1376
00:50:38,520 --> 00:50:43,259
<font color="#E5E5E5">and do something about this right if you</font>

1377
00:50:40,650 --> 00:50:44,369
<font color="#CCCCCC">are a blue team err go back and</font><font color="#E5E5E5"> start to</font>

1378
00:50:43,260 --> 00:50:46,380
audit those<font color="#E5E5E5"> servers</font>

1379
00:50:44,369 --> 00:50:48,329
start to look at<font color="#CCCCCC"> your</font><font color="#E5E5E5"> highly privileged</font>

1380
00:50:46,380 --> 00:50:50,969
account can you move<font color="#E5E5E5"> some of those into</font>

1381
00:50:48,329 --> 00:50:52,049
things like<font color="#E5E5E5"> that domain protected users</font>

1382
00:50:50,969 --> 00:50:55,170
group<font color="#CCCCCC"> right</font>

1383
00:50:52,049 --> 00:50:57,180
can you<font color="#CCCCCC"> actually start</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> think about</font>

1384
00:50:55,170 --> 00:51:00,269
<font color="#E5E5E5">things</font><font color="#CCCCCC"> like remote credential guard</font>

1385
00:50:57,180 --> 00:51:01,739
preventing<font color="#E5E5E5"> not if your credentials</font><font color="#CCCCCC"> from</font>

1386
00:51:00,269 --> 00:51:03,808
being<font color="#E5E5E5"> shotgunned around the environment</font>

1387
00:51:01,739 --> 00:51:05,640
can you retrain your admins can<font color="#E5E5E5"> you</font>

1388
00:51:03,809 --> 00:51:08,160
simple things like simply turn off

1389
00:51:05,640 --> 00:51:10,078
delegation for<font color="#CCCCCC"> tokens of your highly</font>

1390
00:51:08,160 --> 00:51:10,769
published accounts<font color="#E5E5E5"> right every little</font>

1391
00:51:10,079 --> 00:51:12,539
bit counts

1392
00:51:10,769 --> 00:51:14,939
right<font color="#E5E5E5"> and for those red teamers out</font>

1393
00:51:12,539 --> 00:51:18,119
there<font color="#E5E5E5"> you've got up your game</font><font color="#CCCCCC"> right it's</font>

1394
00:51:14,940 --> 00:51:19,079
been<font color="#CCCCCC"> really</font><font color="#E5E5E5"> easy</font><font color="#CCCCCC"> up</font><font color="#E5E5E5"> till now</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> I will</font>

1395
00:51:18,119 --> 00:51:20,819
<font color="#CCCCCC">tell</font><font color="#E5E5E5"> you with some of these new</font>

1396
00:51:19,079 --> 00:51:22,859
mitigations in place I've<font color="#CCCCCC"> seen attackers</font>

1397
00:51:20,819 --> 00:51:24,359
currently that<font color="#E5E5E5"> are trying to pass the</font>

1398
00:51:22,859 --> 00:51:26,098
hash in environments and failing and

1399
00:51:24,359 --> 00:51:27,749
they can't figure<font color="#CCCCCC"> out why we're</font><font color="#E5E5E5"> sitting</font>

1400
00:51:26,099 --> 00:51:29,099
there watching<font color="#E5E5E5"> them on the wire and it's</font>

1401
00:51:27,749 --> 00:51:31,109
failing failing and they're not

1402
00:51:29,099 --> 00:51:33,960
<font color="#E5E5E5">realizing</font><font color="#CCCCCC"> that now in the Windows 7 and</font>

1403
00:51:31,109 --> 00:51:35,910
<font color="#E5E5E5">above environment local accounts don't</font>

1404
00:51:33,960 --> 00:51:37,319
<font color="#E5E5E5">have the</font><font color="#CCCCCC"> ability to pass</font><font color="#E5E5E5"> the hash right</font>

1405
00:51:35,910 --> 00:51:38,879
<font color="#E5E5E5">if the environment set up correctly</font>

1406
00:51:37,319 --> 00:51:40,259
<font color="#E5E5E5">so their attacks are totally for</font><font color="#CCCCCC"> not</font>

1407
00:51:38,880 --> 00:51:42,660
<font color="#CCCCCC">what they're leaving behind clues</font><font color="#E5E5E5"> that</font>

1408
00:51:40,259 --> 00:51:43,440
we can track<font color="#E5E5E5"> anyway those red team is</font>

1409
00:51:42,660 --> 00:51:44,279
you're<font color="#E5E5E5"> going to have to up your game</font>

1410
00:51:43,440 --> 00:51:48,869
<font color="#CCCCCC">because you're</font><font color="#E5E5E5"> going</font><font color="#CCCCCC"> to start running</font>

1411
00:51:44,279 --> 00:51:51,809
<font color="#E5E5E5">into some some brick walls</font><font color="#CCCCCC"> alright so if</font>

1412
00:51:48,869 --> 00:51:54,719
you're<font color="#E5E5E5"> not familiar with sans this is</font>

1413
00:51:51,809 --> 00:51:57,210
part of the 508<font color="#E5E5E5"> advanced forensics in</font>

1414
00:51:54,719 --> 00:51:58,529
its response class you guys have some

1415
00:51:57,210 --> 00:52:00,809
<font color="#E5E5E5">hopefully some great notes that will</font>

1416
00:51:58,529 --> 00:52:03,119
<font color="#E5E5E5">help you kind of with</font><font color="#CCCCCC"> that charge</font><font color="#E5E5E5"> from</font>

1417
00:52:00,809 --> 00:52:04,109
<font color="#E5E5E5">the commander</font><font color="#CCCCCC"> in chief and if you want</font>

1418
00:52:03,119 --> 00:52:06,450
any more<font color="#CCCCCC"> information my contact</font>

1419
00:52:04,109 --> 00:52:08,400
<font color="#CCCCCC">informations</font><font color="#E5E5E5"> kind of on this deck or</font>

1420
00:52:06,450 --> 00:52:10,169
feel<font color="#CCCCCC"> free to hit me up</font><font color="#E5E5E5"> during the rest</font>

1421
00:52:08,400 --> 00:52:13,319
<font color="#E5E5E5">of the conference we've got a few</font>

1422
00:52:10,170 --> 00:52:18,989
<font color="#CCCCCC">minutes</font><font color="#E5E5E5"> for questions</font><font color="#CCCCCC"> oh you're</font><font color="#E5E5E5"> you're</font>

1423
00:52:13,319 --> 00:52:22,769
<font color="#E5E5E5">waiting because</font><font color="#CCCCCC"> multifactor helped on</font>

1424
00:52:18,989 --> 00:52:24,059
any of this<font color="#E5E5E5"> the answer is not much</font><font color="#CCCCCC"> all</font>

1425
00:52:22,769 --> 00:52:25,499
<font color="#E5E5E5">right so we got these you know you</font>

1426
00:52:24,059 --> 00:52:27,599
talked about<font color="#E5E5E5"> like</font><font color="#CCCCCC"> the DoD environment we</font>

1427
00:52:25,499 --> 00:52:29,339
have kind of a smart cards<font color="#E5E5E5"> it turns out</font>

1428
00:52:27,599 --> 00:52:31,200
the smart cards<font color="#E5E5E5"> once you authenticate</font>

1429
00:52:29,339 --> 00:52:33,719
with that smart<font color="#E5E5E5"> card you have many of</font>

1430
00:52:31,200 --> 00:52:35,759
the same<font color="#CCCCCC"> keys of the tickets the tokens</font>

1431
00:52:33,719 --> 00:52:37,529
<font color="#E5E5E5">are still all in</font><font color="#CCCCCC"> play and once the</font>

1432
00:52:35,759 --> 00:52:39,509
<font color="#E5E5E5">authentication occurs those can still be</font>

1433
00:52:37,529 --> 00:52:42,960
stolen<font color="#CCCCCC"> and moved around</font><font color="#E5E5E5"> irregardless of</font>

1434
00:52:39,509 --> 00:52:45,930
of that kind of smart<font color="#E5E5E5"> cards so in</font>

1435
00:52:42,960 --> 00:52:49,460
general sadly<font color="#CCCCCC"> multi factors</font><font color="#E5E5E5"> is not a</font>

1436
00:52:45,930 --> 00:52:49,460
great mitigation at this time

1437
00:53:16,180 --> 00:53:20,649
so are there<font color="#E5E5E5"> any attacks that</font><font color="#CCCCCC"> you don't</font>

1438
00:53:18,609 --> 00:53:24,328
need admin level privileges<font color="#E5E5E5"> to to</font>

1439
00:53:20,650 --> 00:53:29,319
<font color="#E5E5E5">accomplish that we talked about today</font>

1440
00:53:24,329 --> 00:53:31,000
<font color="#E5E5E5">man I not that I not that I can think of</font>

1441
00:53:29,319 --> 00:53:33,009
<font color="#E5E5E5">almost everything</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> even some of the</font>

1442
00:53:31,000 --> 00:53:34,960
offline attacks that<font color="#E5E5E5"> you saw like things</font>

1443
00:53:33,010 --> 00:53:36,720
like grabbing<font color="#E5E5E5"> the system Sam</font><font color="#CCCCCC"> highs</font><font color="#E5E5E5"> you</font>

1444
00:53:34,960 --> 00:53:39,640
gotta have admin to get<font color="#E5E5E5"> access to those</font>

1445
00:53:36,720 --> 00:53:41,649
<font color="#CCCCCC">if you could get around if you</font><font color="#E5E5E5"> can get</font>

1446
00:53:39,640 --> 00:53:42,940
access<font color="#E5E5E5"> to the raw disk</font><font color="#CCCCCC"> but you need</font>

1447
00:53:41,650 --> 00:53:45,279
<font color="#E5E5E5">admin rights to get access</font><font color="#CCCCCC"> to the raw</font>

1448
00:53:42,940 --> 00:53:46,809
disk<font color="#E5E5E5"> so you pretty much</font><font color="#CCCCCC"> have to</font><font color="#E5E5E5"> have</font>

1449
00:53:45,279 --> 00:53:48,579
admin<font color="#CCCCCC"> rights in my at least in my</font>

1450
00:53:46,809 --> 00:53:50,950
knowledge<font color="#E5E5E5"> for all these attacks to work</font>

1451
00:53:48,579 --> 00:53:52,900
now as you<font color="#CCCCCC"> probably know that's</font><font color="#E5E5E5"> not a</font>

1452
00:53:50,950 --> 00:53:54,640
very high hurdle right<font color="#E5E5E5"> there are so many</font>

1453
00:53:52,900 --> 00:53:56,319
privilege escalation<font color="#E5E5E5"> ataxic once you get</font>

1454
00:53:54,640 --> 00:53:58,629
your user account<font color="#E5E5E5"> getting</font><font color="#CCCCCC"> to admin it's</font>

1455
00:53:56,319 --> 00:54:00,670
just not<font color="#CCCCCC"> that difficult in majority</font><font color="#E5E5E5"> of</font>

1456
00:53:58,630 --> 00:54:01,900
environments<font color="#E5E5E5"> but if we could stop it</font><font color="#CCCCCC"> if</font>

1457
00:54:00,670 --> 00:54:04,510
you<font color="#CCCCCC"> can</font><font color="#E5E5E5"> make your environment or hostile</font>

1458
00:54:01,900 --> 00:54:06,010
you stop you know almost<font color="#E5E5E5"> all of the</font>

1459
00:54:04,510 --> 00:54:08,950
attacks that<font color="#CCCCCC"> maybe</font><font color="#E5E5E5"> everything I talked</font>

1460
00:54:06,010 --> 00:54:10,420
<font color="#CCCCCC">about today outside of maybe</font><font color="#E5E5E5"> Kerberos</font>

1461
00:54:08,950 --> 00:54:13,210
<font color="#CCCCCC">tting Kerberos things an example where</font>

1462
00:54:10,420 --> 00:54:14,799
<font color="#CCCCCC">you don't need admin</font><font color="#E5E5E5"> because you just</font>

1463
00:54:13,210 --> 00:54:16,210
request<font color="#CCCCCC"> any ticket</font><font color="#E5E5E5"> and it just comes out</font>

1464
00:54:14,799 --> 00:54:17,770
<font color="#E5E5E5">so it's probably a few in there that</font>

1465
00:54:16,210 --> 00:54:22,799
maybe<font color="#E5E5E5"> don't but for the most</font><font color="#CCCCCC"> part you</font>

1466
00:54:17,770 --> 00:54:22,799
need admin yes sir

1467
00:54:30,830 --> 00:54:33,509
yeah they're like

1468
00:54:32,250 --> 00:54:35,700
Samson<font color="#CCCCCC"> could be added to the hash to</font>

1469
00:54:33,510 --> 00:54:37,260
prevent things like<font color="#E5E5E5"> past the hash</font><font color="#CCCCCC"> there</font>

1470
00:54:35,700 --> 00:54:39,120
are actually a fair<font color="#CCCCCC"> amount of timestamp</font>

1471
00:54:37,260 --> 00:54:41,190
used for instance Kerberos<font color="#CCCCCC"> is very</font>

1472
00:54:39,120 --> 00:54:44,100
timestamp<font color="#CCCCCC"> dependent it's just as we saw</font>

1473
00:54:41,190 --> 00:54:45,540
it didn't work well scale<font color="#E5E5E5"> so they had to</font>

1474
00:54:44,100 --> 00:54:47,910
like let these<font color="#E5E5E5"> things kind of persist</font>

1475
00:54:45,540 --> 00:54:50,520
for for long periods of<font color="#E5E5E5"> time so now I</font>

1476
00:54:47,910 --> 00:54:52,830
don't<font color="#E5E5E5"> see timing</font><font color="#CCCCCC"> really</font><font color="#E5E5E5"> working at least</font>

1477
00:54:50,520 --> 00:54:55,650
I can envision what the<font color="#E5E5E5"> next up</font>

1478
00:54:52,830 --> 00:54:57,299
indications is going to be but they've

1479
00:54:55,650 --> 00:55:03,660
they've<font color="#E5E5E5"> effectively prevented a lot of</font>

1480
00:54:57,300 --> 00:55:05,310
<font color="#CCCCCC">pass the hash no but yeah I just don't I</font>

1481
00:55:03,660 --> 00:55:09,330
don't<font color="#E5E5E5"> see that as</font><font color="#CCCCCC"> being a big</font><font color="#E5E5E5"> big</font>

1482
00:55:05,310 --> 00:55:09,810
mitigation<font color="#E5E5E5"> all right well thank you</font><font color="#CCCCCC"> all</font>

1483
00:55:09,330 --> 00:55:13,110
very much

1484
00:55:09,810 --> 00:55:15,340
so awesome<font color="#CCCCCC"> to be</font><font color="#E5E5E5"> here</font><font color="#CCCCCC"> I hope you have a</font>

1485
00:55:13,110 --> 00:55:18,739
great rest<font color="#E5E5E5"> of the conference</font>

1486
00:55:15,340 --> 00:55:18,739
[Applause]

