1
00:00:00,439 --> 00:00:05,460
so feeding the shark capturing packets

2
00:00:04,290 --> 00:00:08,039
for analysis as what we're talking about

3
00:00:05,460 --> 00:00:12,780
today so if<font color="#E5E5E5"> you're expecting something</font>

4
00:00:08,039 --> 00:00:14,370
with<font color="#CCCCCC"> coating it's not it we just</font>

5
00:00:12,780 --> 00:00:16,948
summarize my bio so i would spend a ton

6
00:00:14,370 --> 00:00:18,060
of time on this<font color="#CCCCCC"> i'm a founding member</font>

7
00:00:16,949 --> 00:00:20,430
with some of the other<font color="#E5E5E5"> great guys in</font>

8
00:00:18,060 --> 00:00:22,590
this room of DC 801 in owen labs local

9
00:00:20,430 --> 00:00:24,180
hackerspace so if you<font color="#E5E5E5"> guys haven't</font>

10
00:00:22,590 --> 00:00:27,050
checked<font color="#E5E5E5"> out the hackerspace in</font><font color="#CCCCCC"> salt lake</font>

11
00:00:24,180 --> 00:00:29,429
please do come<font color="#E5E5E5"> out say hi and</font>

12
00:00:27,050 --> 00:00:31,980
occasionally<font color="#CCCCCC"> i</font><font color="#E5E5E5"> will mentor sans courses</font>

13
00:00:29,429 --> 00:00:33,780
as they came<font color="#CCCCCC"> up specifically 542 and 560</font>

14
00:00:31,980 --> 00:00:37,770
which is web app pen testing and network

15
00:00:33,780 --> 00:00:40,050
pen testing so oh one more thing is

16
00:00:37,770 --> 00:00:41,969
hacker camp it's an<font color="#CCCCCC"> annual event we do</font>

17
00:00:40,050 --> 00:00:43,260
every year where<font color="#CCCCCC"> we all get together out</font>

18
00:00:41,969 --> 00:00:45,629
<font color="#E5E5E5">of the middle of nowhere</font><font color="#CCCCCC"> and take on a</font>

19
00:00:43,260 --> 00:00:47,370
bunch of high-tech low-tech hacking

20
00:00:45,629 --> 00:00:48,690
challenges sort of off-grid so there be

21
00:00:47,370 --> 00:00:49,860
some<font color="#E5E5E5"> announcements coming out we're</font>

22
00:00:48,690 --> 00:00:52,530
hoping<font color="#CCCCCC"> to do that</font><font color="#E5E5E5"> again this year and</font>

23
00:00:49,860 --> 00:00:54,120
<font color="#E5E5E5">Judy so here's what we're going to talk</font>

24
00:00:52,530 --> 00:00:56,160
about<font color="#E5E5E5"> today we're going to talk about</font>

25
00:00:54,120 --> 00:00:58,500
how<font color="#CCCCCC"> to get packets and where to get</font>

26
00:00:56,160 --> 00:01:01,260
packets we're<font color="#E5E5E5"> going to use a packet</font>

27
00:00:58,500 --> 00:01:03,420
capture analysis tool to dive into a

28
00:01:01,260 --> 00:01:04,619
couple<font color="#CCCCCC"> different scenarios and figure</font>

29
00:01:03,420 --> 00:01:06,299
out what's going<font color="#E5E5E5"> on with</font><font color="#CCCCCC"> our network</font>

30
00:01:04,619 --> 00:01:07,439
it's it's some real world examples that

31
00:01:06,299 --> 00:01:09,960
I've pulled out<font color="#E5E5E5"> of</font><font color="#CCCCCC"> my personal</font>

32
00:01:07,439 --> 00:01:12,059
experience where<font color="#CCCCCC"> you want to dig into a</font>

33
00:01:09,960 --> 00:01:13,679
network device or a server and figure

34
00:01:12,060 --> 00:01:16,140
out what's happening at the<font color="#E5E5E5"> network</font>

35
00:01:13,680 --> 00:01:17,759
layer it's becoming more important

36
00:01:16,140 --> 00:01:19,710
especially as we see more<font color="#CCCCCC"> and more</font>

37
00:01:17,759 --> 00:01:20,970
virtualization<font color="#E5E5E5"> compartmentalize IT</font>

38
00:01:19,710 --> 00:01:22,890
groups where you don't<font color="#E5E5E5"> always have</font>

39
00:01:20,970 --> 00:01:25,710
access to rip the wire out of the socket

40
00:01:22,890 --> 00:01:27,600
and put a tap in line so we're<font color="#CCCCCC"> not</font><font color="#E5E5E5"> going</font>

41
00:01:25,710 --> 00:01:28,439
to spend<font color="#E5E5E5"> a ton of time in wireshark</font><font color="#CCCCCC"> I'm</font>

42
00:01:27,600 --> 00:01:29,850
going to give<font color="#CCCCCC"> you some Wireshark</font>

43
00:01:28,439 --> 00:01:31,649
resources but we're not focused on

44
00:01:29,850 --> 00:01:33,210
Wireshark specifically today we're

45
00:01:31,650 --> 00:01:34,979
talking about how to get the back<font color="#CCCCCC"> it's</font>

46
00:01:33,210 --> 00:01:36,570
this<font color="#E5E5E5"> talks</font><font color="#CCCCCC"> going to be</font><font color="#E5E5E5"> freely available</font>

47
00:01:34,979 --> 00:01:37,829
there's a link at the end of it you can

48
00:01:36,570 --> 00:01:39,630
download the talk and there's a couple

49
00:01:37,829 --> 00:01:41,250
<font color="#E5E5E5">of resources with it so don't worry</font>

50
00:01:39,630 --> 00:01:43,020
about<font color="#CCCCCC"> scribbling down notes if you</font><font color="#E5E5E5"> see a</font>

51
00:01:41,250 --> 00:01:45,290
link on here the<font color="#E5E5E5"> whole presentation will</font>

52
00:01:43,020 --> 00:01:47,820
be available in PowerPoint format

53
00:01:45,290 --> 00:01:51,360
keynote format for anybody else uses

54
00:01:47,820 --> 00:01:52,850
that goofy program PDF for those of us

55
00:01:51,360 --> 00:01:57,560
who<font color="#CCCCCC"> don't want</font><font color="#E5E5E5"> to deal with slides and</font>

56
00:01:52,850 --> 00:01:59,210
it's just one big zip file in sight so

57
00:01:57,560 --> 00:02:02,060
so

58
00:01:59,210 --> 00:02:03,710
a key point for today is we're talking

59
00:02:02,060 --> 00:02:06,020
about non-invasive packet capture

60
00:02:03,710 --> 00:02:07,850
techniques which how we can get traffic

61
00:02:06,020 --> 00:02:09,619
without ripping the wire out of the wall

62
00:02:07,850 --> 00:02:11,209
without doing your physical tap without

63
00:02:09,619 --> 00:02:14,090
calling up our bodies at<font color="#CCCCCC"> the NSA and</font>

64
00:02:11,209 --> 00:02:16,850
asking for<font color="#E5E5E5"> their copy of our traffic so</font>

65
00:02:14,090 --> 00:02:19,310
we want<font color="#E5E5E5"> to dive into a production</font><font color="#CCCCCC"> system</font>

66
00:02:16,850 --> 00:02:24,019
pull our traffic out analyze it offline

67
00:02:19,310 --> 00:02:26,270
and determine what's going on so in this

68
00:02:24,020 --> 00:02:28,340
room<font color="#CCCCCC"> is anybody brand-new to Wireshark</font>

69
00:02:26,270 --> 00:02:32,540
never used Wireshark no idea not real

70
00:02:28,340 --> 00:02:35,900
experience Jason okay we'll talk

71
00:02:32,540 --> 00:02:39,980
afterwards if you're new to wire shock

72
00:02:35,900 --> 00:02:41,900
here's some great resources you let like

73
00:02:39,980 --> 00:02:44,660
<font color="#E5E5E5">I couldn't exclude left shark had to</font>

74
00:02:41,900 --> 00:02:46,070
come out that was just a gift<font color="#E5E5E5"> okay</font><font color="#CCCCCC"> we</font>

75
00:02:44,660 --> 00:02:47,660
needed<font color="#E5E5E5"> left shark if you don't know who</font>

76
00:02:46,070 --> 00:02:53,630
left shark is google it up it's pretty

77
00:02:47,660 --> 00:02:55,070
entertaining there is<font color="#CCCCCC"> that so the</font>

78
00:02:53,630 --> 00:02:55,959
<font color="#E5E5E5">Wireshark blog talks about all the</font>

79
00:02:55,070 --> 00:02:58,430
latest things that are happening

80
00:02:55,959 --> 00:03:01,730
Wireshark documentation is deep but it's

81
00:02:58,430 --> 00:03:04,459
<font color="#CCCCCC">very good there is a whole system of</font>

82
00:03:01,730 --> 00:03:06,350
classes<font color="#CCCCCC"> that you can take attached to</font>

83
00:03:04,459 --> 00:03:08,329
the Wireshark website and<font color="#E5E5E5"> I think the</font>

84
00:03:06,350 --> 00:03:09,739
first three courses are free so you<font color="#E5E5E5"> can</font>

85
00:03:08,329 --> 00:03:11,120
<font color="#E5E5E5">sign</font><font color="#CCCCCC"> up and get some</font><font color="#E5E5E5"> familiar with</font>

86
00:03:09,739 --> 00:03:12,739
shifting through network traffic I think

87
00:03:11,120 --> 00:03:14,600
Laura Chappelle has her own little

88
00:03:12,739 --> 00:03:16,250
<font color="#E5E5E5">University she writes a lot of books and</font>

89
00:03:14,600 --> 00:03:18,709
<font color="#CCCCCC">their shark fest if you really want to</font>

90
00:03:16,250 --> 00:03:20,329
go full nerd on this stuff you can go to

91
00:03:18,709 --> 00:03:22,459
shark fest but they publish all their

92
00:03:20,329 --> 00:03:24,200
slides the presentations are documents

93
00:03:22,459 --> 00:03:25,880
from previous years they have that the

94
00:03:24,200 --> 00:03:28,459
Computer History Museum in California

95
00:03:25,880 --> 00:03:31,840
<font color="#E5E5E5">every year so lots of great content if</font>

96
00:03:28,459 --> 00:03:35,000
you want to dive deep with wireshark so

97
00:03:31,840 --> 00:03:36,440
why don't we want packets well let's

98
00:03:35,000 --> 00:03:38,840
<font color="#CCCCCC">think about what</font><font color="#E5E5E5"> packets our packet is</font>

99
00:03:36,440 --> 00:03:41,060
the traffic it's the actual traffic it's

100
00:03:38,840 --> 00:03:43,280
it's not a log it's not necessary trap

101
00:03:41,060 --> 00:03:46,370
it's not net flow these are evidence of

102
00:03:43,280 --> 00:03:47,900
traffic the packet is the traffic<font color="#E5E5E5"> so if</font>

103
00:03:46,370 --> 00:03:50,239
<font color="#E5E5E5">we have the ability to dive in and</font>

104
00:03:47,900 --> 00:03:53,209
actually get<font color="#CCCCCC"> the traffic from our device</font>

105
00:03:50,239 --> 00:03:55,040
we can see what<font color="#CCCCCC"> looks like</font><font color="#E5E5E5"> in transit</font>

106
00:03:53,209 --> 00:03:59,540
<font color="#E5E5E5">and what it looks like as it arrives to</font>

107
00:03:55,040 --> 00:04:03,160
his target moving on to<font color="#E5E5E5"> why we care</font>

108
00:03:59,540 --> 00:04:04,900
about where the packets come from so

109
00:04:03,160 --> 00:04:07,329
does anybody in<font color="#E5E5E5"> here not know what the</font>

110
00:04:04,900 --> 00:04:09,310
OSI model is no shame just Danny I know

111
00:04:07,330 --> 00:04:14,920
I know we'll get<font color="#E5E5E5"> you there same two guys</font>

112
00:04:09,310 --> 00:04:20,170
perfect<font color="#CCCCCC"> we'd</font><font color="#E5E5E5"> Patrick a such a genuine</font>

113
00:04:14,920 --> 00:04:22,390
engagement with the<font color="#E5E5E5"> audience yes well I</font>

114
00:04:20,170 --> 00:04:28,450
understand that's why<font color="#E5E5E5"> we start with</font>

115
00:04:22,390 --> 00:04:30,219
mimosas so the OSI model right<font color="#E5E5E5"> the</font>

116
00:04:28,450 --> 00:04:32,800
fundamental concept<font color="#E5E5E5"> network building</font>

117
00:04:30,220 --> 00:04:34,390
blocks helps us understand the layers

118
00:04:32,800 --> 00:04:36,040
that our traffic goes through as it

119
00:04:34,390 --> 00:04:39,070
leaves one machine crosses the network

120
00:04:36,040 --> 00:04:40,840
and is built up in<font color="#E5E5E5"> another the</font><font color="#CCCCCC"> way</font>

121
00:04:39,070 --> 00:04:42,280
networking works is your traffic has to

122
00:04:40,840 --> 00:04:44,140
change in transit right MAC addresses

123
00:04:42,280 --> 00:04:45,460
will change as you go through layer

124
00:04:44,140 --> 00:04:47,500
three boundaries if you're going<font color="#E5E5E5"> through</font>

125
00:04:45,460 --> 00:04:49,150
<font color="#CCCCCC">NAT devices addresses are going to</font>

126
00:04:47,500 --> 00:04:50,770
change sometimes protocols might be

127
00:04:49,150 --> 00:04:55,090
motive modified if you're going<font color="#E5E5E5"> through</font>

128
00:04:50,770 --> 00:04:56,650
<font color="#CCCCCC">IPSS or proxies so where we look at the</font>

129
00:04:55,090 --> 00:04:58,060
traffic<font color="#E5E5E5"> is going to change what the</font>

130
00:04:56,650 --> 00:04:59,289
traffic actually looks like that's<font color="#E5E5E5"> why</font>

131
00:04:58,060 --> 00:05:00,640
it's valuable to have the skill<font color="#CCCCCC"> set to</font>

132
00:04:59,290 --> 00:05:01,900
go into<font color="#CCCCCC"> a variety different places on</font>

133
00:05:00,640 --> 00:05:06,130
<font color="#E5E5E5">your network and look at the traffic</font>

134
00:05:01,900 --> 00:05:08,979
throughout the path one other quick note

135
00:05:06,130 --> 00:05:11,409
is many of the devices will pull traffic

136
00:05:08,980 --> 00:05:13,870
from have resource constraints so

137
00:05:11,410 --> 00:05:16,270
firewalls load balancers switches these

138
00:05:13,870 --> 00:05:17,740
things have a primary job and it's not

139
00:05:16,270 --> 00:05:19,870
traffic capture their primary job is

140
00:05:17,740 --> 00:05:21,700
usually to push traffic through so we

141
00:05:19,870 --> 00:05:24,790
want<font color="#E5E5E5"> to be very</font><font color="#CCCCCC"> specific and explicit</font>

142
00:05:21,700 --> 00:05:26,200
about how we define filters and how we

143
00:05:24,790 --> 00:05:27,460
create our package after we don't just

144
00:05:26,200 --> 00:05:29,440
want<font color="#CCCCCC"> to grab everything</font><font color="#E5E5E5"> we don't want to</font>

145
00:05:27,460 --> 00:05:31,599
be greedy and<font color="#CCCCCC"> there's a couple practical</font>

146
00:05:29,440 --> 00:05:33,669
reasons for that so one of the practical

147
00:05:31,600 --> 00:05:35,380
reasons is compliance if you work in an

148
00:05:33,669 --> 00:05:37,150
environment or you have a customer<font color="#CCCCCC"> that</font>

149
00:05:35,380 --> 00:05:39,330
<font color="#CCCCCC">is a sensitive environment if you're</font>

150
00:05:37,150 --> 00:05:42,370
<font color="#CCCCCC">dealing with account numbers PII</font>

151
00:05:39,330 --> 00:05:44,169
financial information perhaps pci card

152
00:05:42,370 --> 00:05:46,210
data you don't want to have your

153
00:05:44,169 --> 00:05:47,890
analysis now be part of the compliance

154
00:05:46,210 --> 00:05:49,599
scope if it doesn't need to be there's

155
00:05:47,890 --> 00:05:50,890
no reason to grab customer data if

156
00:05:49,600 --> 00:05:52,450
that's not<font color="#E5E5E5"> what you're interested in</font>

157
00:05:50,890 --> 00:05:53,800
unless you're Danny and you're just

158
00:05:52,450 --> 00:05:59,169
grabbing all the data<font color="#E5E5E5"> for your big fat</font>

159
00:05:53,800 --> 00:05:59,449
report but that's a different talk and

160
00:05:59,169 --> 00:06:00,859
then

161
00:05:59,449 --> 00:06:03,529
practically<font color="#E5E5E5"> captures take up space so</font>

162
00:06:00,860 --> 00:06:04,759
<font color="#E5E5E5">you know we're grabbing everything as it</font>

163
00:06:03,529 --> 00:06:06,499
seen across the<font color="#E5E5E5"> wire there's not any</font>

164
00:06:04,759 --> 00:06:08,569
compression and play here they get big

165
00:06:06,499 --> 00:06:09,949
quick and the bigger they are the more

166
00:06:08,569 --> 00:06:12,020
of a pain the butt it is to sift through

167
00:06:09,949 --> 00:06:15,740
<font color="#E5E5E5">them</font><font color="#CCCCCC"> the slower the filters work and</font>

168
00:06:12,020 --> 00:06:17,870
slower than<font color="#E5E5E5"> load so some terminology</font>

169
00:06:15,740 --> 00:06:19,520
that will encounter for the purposes of

170
00:06:17,870 --> 00:06:21,110
this<font color="#E5E5E5"> talk a tap is a hardware device</font>

171
00:06:19,520 --> 00:06:23,900
which will provide access<font color="#E5E5E5"> to the data</font>

172
00:06:21,110 --> 00:06:27,020
flowing across the<font color="#E5E5E5"> network tap gets</font>

173
00:06:23,900 --> 00:06:29,448
thrown around a lot as a method but for

174
00:06:27,020 --> 00:06:30,680
the purposes of day its arguments span

175
00:06:29,449 --> 00:06:34,610
monitor mirrored is able to know the

176
00:06:30,680 --> 00:06:37,039
difference between those you do that's

177
00:06:34,610 --> 00:06:39,169
<font color="#E5E5E5">impressive because yeah vendor exactly</font>

178
00:06:37,039 --> 00:06:40,460
there<font color="#E5E5E5"> really isn't a difference right so</font>

179
00:06:39,169 --> 00:06:41,150
these terms<font color="#E5E5E5"> are interchangeable I'm</font>

180
00:06:40,460 --> 00:06:43,969
going<font color="#E5E5E5"> to use them interchangeably</font>

181
00:06:41,150 --> 00:06:45,349
forgive me it's a different vendors call

182
00:06:43,969 --> 00:06:47,810
it the same<font color="#E5E5E5"> thing and they have</font>

183
00:06:45,349 --> 00:06:48,889
different technologies it is important

184
00:06:47,810 --> 00:06:51,560
to know when we're talking about

185
00:06:48,889 --> 00:06:54,020
switches and routers a lot<font color="#E5E5E5"> of the</font>

186
00:06:51,560 --> 00:06:55,939
vendors particularly<font color="#E5E5E5"> Cisco don't play</font>

187
00:06:54,020 --> 00:06:58,609
nice with the other<font color="#E5E5E5"> vendors and so as</font>

188
00:06:55,939 --> 00:07:00,949
we're grabbing packets it is sort of

189
00:06:58,610 --> 00:07:04,389
specific to each vendor the technique

190
00:07:00,949 --> 00:07:06,439
we're going to use soapy cap the basic

191
00:07:04,389 --> 00:07:09,169
<font color="#E5E5E5">definition of a pcap it's</font><font color="#CCCCCC"> actually a</font>

192
00:07:06,439 --> 00:07:11,240
library and it's a library<font color="#CCCCCC"> that runs in</font>

193
00:07:09,169 --> 00:07:14,359
the IP stack that allows<font color="#CCCCCC"> us to reach in</font>

194
00:07:11,240 --> 00:07:15,649
and grab traffic it's an API so it's

195
00:07:14,360 --> 00:07:19,389
also file output but we'll talk<font color="#E5E5E5"> about</font>

196
00:07:15,649 --> 00:07:22,249
<font color="#E5E5E5">that</font><font color="#CCCCCC"> in a minute and then a trace file</font>

197
00:07:19,389 --> 00:07:24,409
Microsoft decided that they wanted their

198
00:07:22,249 --> 00:07:26,779
own lingo and so they refer<font color="#CCCCCC"> to their</font>

199
00:07:24,409 --> 00:07:28,188
packet captures as traces we'll talk

200
00:07:26,779 --> 00:07:30,740
<font color="#E5E5E5">about</font><font color="#CCCCCC"> that but they use the event</font>

201
00:07:28,189 --> 00:07:33,949
tracing for<font color="#CCCCCC"> windows framework to grab</font>

202
00:07:30,740 --> 00:07:36,409
traffic the advantage of that is it

203
00:07:33,949 --> 00:07:39,259
doesn't<font color="#CCCCCC"> require</font><font color="#E5E5E5"> a pcap driver will die a</font>

204
00:07:36,409 --> 00:07:40,879
little deeper<font color="#E5E5E5"> in</font><font color="#CCCCCC"> about a minute so next</font>

205
00:07:39,259 --> 00:07:43,580
file types the file types are most

206
00:07:40,879 --> 00:07:47,599
likely to<font color="#E5E5E5"> encounter doc appt is the old</font>

207
00:07:43,580 --> 00:07:49,279
<font color="#CCCCCC">net</font><font color="#E5E5E5"> Mon format pcap is what we see by</font>

208
00:07:47,599 --> 00:07:50,810
default on a lot of packet capture tools

209
00:07:49,279 --> 00:07:53,689
all times if there's a packet capture

210
00:07:50,810 --> 00:07:56,569
baked into a smaller operating system

211
00:07:53,689 --> 00:07:59,389
like<font color="#E5E5E5"> pan OS or iOS it's going to dump to</font>

212
00:07:56,569 --> 00:08:01,550
<font color="#CCCCCC">peak at format</font><font color="#E5E5E5"> pcap ng is a new</font>

213
00:07:59,389 --> 00:08:03,229
Wireshark format and that supports

214
00:08:01,550 --> 00:08:06,259
tighter time definitions in multiple

215
00:08:03,229 --> 00:08:07,610
sources and etl is a<font color="#CCCCCC"> vent race log and</font>

216
00:08:06,259 --> 00:08:08,080
that's<font color="#E5E5E5"> Microsoft going off and doing</font>

217
00:08:07,610 --> 00:08:10,060
their

218
00:08:08,080 --> 00:08:15,849
thing which always works out for them

219
00:08:10,060 --> 00:08:18,250
right windows<font color="#CCCCCC"> phone yeah yeah the zooms</font>

220
00:08:15,849 --> 00:08:23,050
<font color="#E5E5E5">gray right let me have a museum</font>

221
00:08:18,250 --> 00:08:24,490
somewhere<font color="#CCCCCC"> okay so this might seem a</font>

222
00:08:23,050 --> 00:08:25,930
little obvious but one of the things if

223
00:08:24,490 --> 00:08:28,120
you're getting<font color="#E5E5E5"> started with traffic</font>

224
00:08:25,930 --> 00:08:31,419
analysis one of the<font color="#E5E5E5"> things we like to</font>

225
00:08:28,120 --> 00:08:33,219
<font color="#E5E5E5">talk about is an adapter to use there's</font>

226
00:08:31,419 --> 00:08:35,380
some really practical constraints around

227
00:08:33,219 --> 00:08:37,750
what adapt your news you certainly can

228
00:08:35,380 --> 00:08:40,630
use a wireless adapter but<font color="#E5E5E5"> oftentimes we</font>

229
00:08:37,750 --> 00:08:41,740
want to play in the copper world and if

230
00:08:40,630 --> 00:08:44,290
we're going<font color="#E5E5E5"> to play in the copper world</font>

231
00:08:41,740 --> 00:08:46,149
let's use gigabit adapters so we have

232
00:08:44,290 --> 00:08:48,130
the ability to get<font color="#CCCCCC"> the appropriate one</font>

233
00:08:46,149 --> 00:08:49,510
speed and let's use a bus that can

234
00:08:48,130 --> 00:08:50,769
actually<font color="#E5E5E5"> support and get you an adapter</font>

235
00:08:49,510 --> 00:08:55,959
what's the problem with<font color="#CCCCCC"> the gigabit</font>

236
00:08:50,769 --> 00:08:57,610
<font color="#CCCCCC">apter on USB 2 480 megabits per second</font>

237
00:08:55,959 --> 00:08:59,439
right<font color="#E5E5E5"> so if it's a busy network that's</font>

238
00:08:57,610 --> 00:09:00,700
going to be a legitimate problem so<font color="#E5E5E5"> if</font>

239
00:08:59,440 --> 00:09:03,040
you go to the apple<font color="#CCCCCC"> store and buy their</font>

240
00:09:00,700 --> 00:09:04,690
little USB network adapter you know you

241
00:09:03,040 --> 00:09:06,519
paid 30 bucks and it's 100 Meg's that

242
00:09:04,690 --> 00:09:08,350
you're locked to with that thing so

243
00:09:06,519 --> 00:09:10,540
these are<font color="#CCCCCC"> just two examples there's lots</font>

244
00:09:08,350 --> 00:09:12,579
of great<font color="#CCCCCC"> Hardware out there Thunderbolts</font>

245
00:09:10,540 --> 00:09:15,670
nice if you have the<font color="#E5E5E5"> Apple platform it's</font>

246
00:09:12,579 --> 00:09:18,550
a 10 gig back end<font color="#E5E5E5"> and the drivers pretty</font>

247
00:09:15,670 --> 00:09:21,519
solid built into the OS it's<font color="#E5E5E5"> also pretty</font>

248
00:09:18,550 --> 00:09:23,199
cheap I like<font color="#E5E5E5"> to use a dedicated adapter</font>

249
00:09:21,519 --> 00:09:25,029
for packet captures and i'll talk<font color="#E5E5E5"> about</font>

250
00:09:23,199 --> 00:09:25,990
a little bit more<font color="#E5E5E5"> on the next slide but</font>

251
00:09:25,029 --> 00:09:28,689
we want<font color="#E5E5E5"> to kind</font><font color="#CCCCCC"> of segregate ourselves</font>

252
00:09:25,990 --> 00:09:30,579
from the traffic<font color="#CCCCCC"> that's on our box we</font>

253
00:09:28,690 --> 00:09:32,050
don't<font color="#CCCCCC"> necessarily need dropbox requests</font>

254
00:09:30,579 --> 00:09:36,849
going out the middle<font color="#E5E5E5"> of our packet</font>

255
00:09:32,050 --> 00:09:39,430
capture on the<font color="#CCCCCC"> non OS</font><font color="#E5E5E5"> x</font><font color="#CCCCCC"> either the non</font>

256
00:09:36,850 --> 00:09:40,930
<font color="#CCCCCC">Thunderbolt side this</font><font color="#E5E5E5"> startac adapter is</font>

257
00:09:39,430 --> 00:09:43,959
one of several great models this

258
00:09:40,930 --> 00:09:46,089
<font color="#E5E5E5">particular one has drivers for linux for</font>

259
00:09:43,959 --> 00:09:48,939
OS X for every flavor of Windows<font color="#E5E5E5"> it's</font>

260
00:09:46,089 --> 00:09:51,220
USB 3 and it also has a USB 3 port on it

261
00:09:48,940 --> 00:09:53,769
so if you're using something you know

262
00:09:51,220 --> 00:09:56,949
like an air<font color="#CCCCCC"> go play didn't just</font>

263
00:09:53,769 --> 00:10:03,929
interrupt my connection<font color="#E5E5E5"> oh</font><font color="#CCCCCC"> okay hold</font>

264
00:09:56,949 --> 00:10:08,910
music here to do too yeah<font color="#E5E5E5"> okay</font>

265
00:10:03,929 --> 00:10:12,249
so if we're using you know<font color="#CCCCCC"> a netbook or</font>

266
00:10:08,910 --> 00:10:14,618
an<font color="#CCCCCC"> air</font><font color="#E5E5E5"> or even a tablet whatever</font>

267
00:10:12,249 --> 00:10:16,779
something with USB 3 it's<font color="#CCCCCC"> very helpful</font>

268
00:10:14,619 --> 00:10:18,040
<font color="#CCCCCC">we can you know with USB 3 we can stack</font>

269
00:10:16,779 --> 00:10:19,239
multiples right we have a bunch

270
00:10:18,040 --> 00:10:25,209
different adapters in a bunch of

271
00:10:19,239 --> 00:10:27,970
<font color="#CCCCCC">different places and they're cheap so my</font>

272
00:10:25,209 --> 00:10:28,988
little Lego my I'm here we want to

273
00:10:27,970 --> 00:10:30,459
listen we<font color="#CCCCCC"> don't want to talk we don't</font>

274
00:10:28,989 --> 00:10:32,019
<font color="#E5E5E5">want to be throwing traffic out on the</font>

275
00:10:30,459 --> 00:10:33,910
network unless we're trying to analyze

276
00:10:32,019 --> 00:10:35,949
what our box is doing in a given

277
00:10:33,910 --> 00:10:37,719
situation we don't<font color="#E5E5E5"> want to have it just</font>

278
00:10:35,949 --> 00:10:40,329
throwing traffic all over the place and

279
00:10:37,720 --> 00:10:41,949
if you ever<font color="#E5E5E5"> just booted up wireshark and</font>

280
00:10:40,329 --> 00:10:44,108
hit listen<font color="#E5E5E5"> not even connected to</font><font color="#CCCCCC"> a</font>

281
00:10:41,949 --> 00:10:46,628
network operating systems they're so

282
00:10:44,109 --> 00:10:48,790
noisy<font color="#CCCCCC"> it's broadcast all over the</font><font color="#E5E5E5"> place</font>

283
00:10:46,629 --> 00:10:51,999
and if you have sync services you know

284
00:10:48,790 --> 00:10:53,559
box<font color="#CCCCCC"> calm</font><font color="#E5E5E5"> dropbox you know god help you</font>

285
00:10:51,999 --> 00:10:55,540
if you're using any<font color="#E5E5E5"> Apple services with</font>

286
00:10:53,559 --> 00:11:02,079
bon-jure broadcasting all over the place

287
00:10:55,540 --> 00:11:04,689
like a drunk guy<font color="#CCCCCC"> at opposed so throw up</font>

288
00:11:02,079 --> 00:11:06,248
the adapter turn off the<font color="#E5E5E5"> protocols so we</font>

289
00:11:04,689 --> 00:11:08,618
kill all the protocols and now we're

290
00:11:06,249 --> 00:11:11,980
<font color="#CCCCCC">just</font><font color="#E5E5E5"> going to listen creates a much more</font>

291
00:11:08,619 --> 00:11:16,720
sanitized pcap now if you were some sort

292
00:11:11,980 --> 00:11:19,540
of cave person you could use these super

293
00:11:16,720 --> 00:11:22,749
smexy huh back I smexy his word I don't

294
00:11:19,540 --> 00:11:24,248
care who says otherwise they're nice

295
00:11:22,749 --> 00:11:25,540
because they're they're abundant right

296
00:11:24,249 --> 00:11:27,009
you know the<font color="#E5E5E5"> back of a network closet</font>

297
00:11:25,540 --> 00:11:29,618
somewhere somebody has one of these

298
00:11:27,009 --> 00:11:31,059
things the one scenario that i will

299
00:11:29,619 --> 00:11:34,929
disclaim where a hub can be very helpful

300
00:11:31,059 --> 00:11:36,939
is if you<font color="#E5E5E5"> need</font><font color="#CCCCCC"> one source in a lot</font><font color="#E5E5E5"> of</font>

301
00:11:34,929 --> 00:11:39,279
destinations because a hub is a layer

302
00:11:36,939 --> 00:11:40,569
one device it's a repeater right it's

303
00:11:39,279 --> 00:11:42,459
like you're really gossipy<font color="#E5E5E5"> coworker</font>

304
00:11:40,569 --> 00:11:44,589
everything<font color="#CCCCCC"> adheres</font><font color="#E5E5E5"> just</font><font color="#CCCCCC"> blobs</font><font color="#E5E5E5"> back out</font>

305
00:11:42,459 --> 00:11:47,219
so to every single port without

306
00:11:44,589 --> 00:11:49,629
discretion so if you have multiple

307
00:11:47,220 --> 00:11:51,489
multiple destinations for your packet

308
00:11:49,629 --> 00:11:53,350
capture and only one source so<font color="#CCCCCC"> witches</font>

309
00:11:51,489 --> 00:11:55,439
don't<font color="#E5E5E5"> always like that as much where</font>

310
00:11:53,350 --> 00:11:57,699
hubs have no problem with that at all

311
00:11:55,439 --> 00:11:59,980
below that we<font color="#CCCCCC"> have the throwing star</font>

312
00:11:57,699 --> 00:12:02,139
land tap the<font color="#E5E5E5"> gentleman out front looked</font>

313
00:11:59,980 --> 00:12:04,689
like he was selling the slightly more

314
00:12:02,139 --> 00:12:06,699
polished version of this these<font color="#CCCCCC"> are</font><font color="#E5E5E5"> okay</font>

315
00:12:04,689 --> 00:12:08,679
it's a fun project for soldering the

316
00:12:06,699 --> 00:12:11,049
<font color="#E5E5E5">problem that I've had with them is there</font>

317
00:12:08,679 --> 00:12:12,069
a symmetric so you patch them in and

318
00:12:11,049 --> 00:12:14,250
they're only<font color="#E5E5E5"> going to give you either</font>

319
00:12:12,069 --> 00:12:16,349
receive or transmit depending on how you

320
00:12:14,250 --> 00:12:21,330
and then and both of these devices<font color="#E5E5E5"> are</font>

321
00:12:16,350 --> 00:12:24,030
going to drop us down to<font color="#E5E5E5"> 100</font><font color="#CCCCCC"> Meg so</font>

322
00:12:21,330 --> 00:12:25,490
another key points you know if you

323
00:12:24,030 --> 00:12:29,400
introduce a hub into your network

324
00:12:25,490 --> 00:12:31,710
collisions are stupid we<font color="#CCCCCC"> don't</font><font color="#E5E5E5"> need to</font>

325
00:12:29,400 --> 00:12:33,660
<font color="#CCCCCC">introduce collisions it's if this is all</font>

326
00:12:31,710 --> 00:12:35,430
you have for a lab environment it's fine

327
00:12:33,660 --> 00:12:37,410
but realistically if you're<font color="#E5E5E5"> going to do</font>

328
00:12:35,430 --> 00:12:39,150
a lot<font color="#CCCCCC"> of pcap scenarios I would</font>

329
00:12:37,410 --> 00:12:41,790
<font color="#E5E5E5">recommend looking at in an expensive</font>

330
00:12:39,150 --> 00:12:44,189
switch so here are just two options

331
00:12:41,790 --> 00:12:45,420
every vendor has something<font color="#E5E5E5"> that plays in</font>

332
00:12:44,190 --> 00:12:47,340
this space<font color="#E5E5E5"> the other thing you want to</font>

333
00:12:45,420 --> 00:12:51,000
double check is whether or not it

334
00:12:47,340 --> 00:12:53,760
supports a monitor mode or span in the

335
00:12:51,000 --> 00:12:55,860
case of<font color="#CCCCCC"> Cisco and</font><font color="#E5E5E5"> you want to check what</font>

336
00:12:53,760 --> 00:12:57,480
the constraints around that are so these

337
00:12:55,860 --> 00:12:59,160
devices are about 90 bucks each their

338
00:12:57,480 --> 00:13:01,950
little gig switches these particular

339
00:12:59,160 --> 00:13:03,360
<font color="#E5E5E5">devices will both boot off of poa which</font>

340
00:13:01,950 --> 00:13:05,310
can be<font color="#E5E5E5"> helpful if your environment where</font>

341
00:13:03,360 --> 00:13:09,570
you can't<font color="#E5E5E5"> get power it's very easy to</font>

342
00:13:05,310 --> 00:13:11,400
extend power with<font color="#CCCCCC"> PV and they're cheap</font>

343
00:13:09,570 --> 00:13:14,040
they're easy to program a word of

344
00:13:11,400 --> 00:13:15,780
caution don't ever plug a switch into a

345
00:13:14,040 --> 00:13:17,910
<font color="#CCCCCC">production environment that</font><font color="#E5E5E5"> you're not</font>

346
00:13:15,780 --> 00:13:20,850
intimately familiar with spanning tree

347
00:13:17,910 --> 00:13:22,199
does not like that<font color="#E5E5E5"> network admins do not</font>

348
00:13:20,850 --> 00:13:23,280
like that so just<font color="#E5E5E5"> make</font><font color="#CCCCCC"> sure you have</font>

349
00:13:22,200 --> 00:13:27,510
permission<font color="#CCCCCC"> to know what you're</font><font color="#E5E5E5"> doing</font>

350
00:13:23,280 --> 00:13:29,310
when you plug in a foreign switch<font color="#CCCCCC"> okay</font>

351
00:13:27,510 --> 00:13:31,800
so now the meat of what we're going to

352
00:13:29,310 --> 00:13:33,989
talk about<font color="#CCCCCC"> today so for the purposes</font>

353
00:13:31,800 --> 00:13:36,900
today you are<font color="#CCCCCC"> the</font><font color="#E5E5E5"> resident packet ninja</font>

354
00:13:33,990 --> 00:13:38,100
at a<font color="#E5E5E5"> company that's not real but we're</font>

355
00:13:36,900 --> 00:13:39,329
going<font color="#E5E5E5"> to explore a corporate network</font>

356
00:13:38,100 --> 00:13:40,470
we're<font color="#E5E5E5"> going to walk through topology</font>

357
00:13:39,330 --> 00:13:42,210
we're<font color="#E5E5E5"> going to talk about how to get</font>

358
00:13:40,470 --> 00:13:45,000
packets from a variety<font color="#CCCCCC"> different places</font>

359
00:13:42,210 --> 00:13:46,980
on that<font color="#E5E5E5"> network your goal</font><font color="#CCCCCC"> is to identify</font>

360
00:13:45,000 --> 00:13:48,900
the problem as<font color="#E5E5E5"> its laid out in front of</font>

361
00:13:46,980 --> 00:13:51,120
<font color="#E5E5E5">you and find the packets and solve the</font>

362
00:13:48,900 --> 00:13:52,050
problem using your packet<font color="#E5E5E5"> food so we're</font>

363
00:13:51,120 --> 00:13:56,820
<font color="#E5E5E5">going to go</font><font color="#CCCCCC"> through four different</font>

364
00:13:52,050 --> 00:13:59,609
scenarios here is our topology we've got

365
00:13:56,820 --> 00:14:02,430
three branch offices a corporate network

366
00:13:59,610 --> 00:14:07,620
and kind<font color="#E5E5E5"> of a headquarters and connected</font>

367
00:14:02,430 --> 00:14:11,880
up to<font color="#E5E5E5"> the</font><font color="#CCCCCC"> Internet so first scenario the</font>

368
00:14:07,620 --> 00:14:13,320
boss is angry what else<font color="#E5E5E5"> is</font><font color="#CCCCCC"> new right so</font>

369
00:14:11,880 --> 00:14:15,780
today he's angry because the internal

370
00:14:13,320 --> 00:14:17,320
web application slows to a crawl every

371
00:14:15,780 --> 00:14:19,150
day at 1201 p.m.

372
00:14:17,320 --> 00:14:22,510
the server team is blaming the network

373
00:14:19,150 --> 00:14:23,650
that's never happened right server team

374
00:14:22,510 --> 00:14:26,830
has never<font color="#E5E5E5"> got out of</font><font color="#CCCCCC"> us got</font><font color="#E5E5E5"> me to</font>

375
00:14:23,650 --> 00:14:30,670
network servers fine<font color="#E5E5E5"> ask manager says</font>

376
00:14:26,830 --> 00:14:32,140
it's great i<font color="#E5E5E5"> don't work brother so our</font>

377
00:14:30,670 --> 00:14:33,579
web server is a<font color="#CCCCCC"> linux</font><font color="#E5E5E5"> box and it's</font>

378
00:14:32,140 --> 00:14:35,770
running locally in our data center<font color="#E5E5E5"> and</font>

379
00:14:33,580 --> 00:14:38,230
this is an internal application we're

380
00:14:35,770 --> 00:14:39,730
looking at<font color="#CCCCCC"> internal job so here's our</font>

381
00:14:38,230 --> 00:14:41,170
strategy we're going to<font color="#CCCCCC"> SSH into the web</font>

382
00:14:39,730 --> 00:14:42,670
server we're<font color="#E5E5E5"> going to capture traffic</font>

383
00:14:41,170 --> 00:14:44,290
over<font color="#E5E5E5"> the lunch hour when the slowdown is</font>

384
00:14:42,670 --> 00:14:46,839
happening and we're going to<font color="#E5E5E5"> use TCP</font>

385
00:14:44,290 --> 00:14:48,699
<font color="#CCCCCC">done now key point here we're going</font><font color="#E5E5E5"> to</font>

386
00:14:46,840 --> 00:14:50,920
set it<font color="#E5E5E5"> up to record 50 megs of data in</font>

387
00:14:48,700 --> 00:14:52,780
five files our capture is going to run

388
00:14:50,920 --> 00:14:54,790
continuously and overwrite itself so

389
00:14:52,780 --> 00:14:56,350
ring buffer is everybody familiar with

390
00:14:54,790 --> 00:14:59,170
the<font color="#CCCCCC"> idea of a ring buffer kind of keep</font>

391
00:14:56,350 --> 00:15:00,730
overriding yourself yes no is that a

392
00:14:59,170 --> 00:15:08,229
vacant stare of<font color="#CCCCCC"> acknowledgment I'm not</font>

393
00:15:00,730 --> 00:15:09,820
sure<font color="#CCCCCC"> alright Steve so our point is</font><font color="#E5E5E5"> we're</font>

394
00:15:08,230 --> 00:15:11,260
we're going<font color="#E5E5E5"> to do we can to not flood</font>

395
00:15:09,820 --> 00:15:15,270
the<font color="#E5E5E5"> disk and tip over the server that's</font>

396
00:15:11,260 --> 00:15:18,730
that etiquette so we<font color="#CCCCCC"> ssh into the server</font>

397
00:15:15,270 --> 00:15:19,810
with throw TCP dump business legible at

398
00:15:18,730 --> 00:15:22,770
all can you guys<font color="#E5E5E5"> kind of see what</font>

399
00:15:19,810 --> 00:15:28,060
switches are there all right good yeah

400
00:15:22,770 --> 00:15:32,470
thank<font color="#E5E5E5"> you</font><font color="#CCCCCC"> guys</font><font color="#E5E5E5"> seven feet away</font><font color="#CCCCCC"> all right</font>

401
00:15:28,060 --> 00:15:34,150
so TCP dump is very helpful included on

402
00:15:32,470 --> 00:15:36,340
just about every POSIX system and it's

403
00:15:34,150 --> 00:15:37,959
going<font color="#E5E5E5"> to use the native lib pcap</font>

404
00:15:36,340 --> 00:15:39,610
libraries that are on the<font color="#E5E5E5"> Linux system</font>

405
00:15:37,960 --> 00:15:41,200
so we're not installing any software and

406
00:15:39,610 --> 00:15:43,390
that's a key point of working in a

407
00:15:41,200 --> 00:15:46,630
production environment so we're gonna

408
00:15:43,390 --> 00:15:48,760
specify our interface<font color="#CCCCCC"> tak big C's can</font>

409
00:15:46,630 --> 00:15:51,100
specify the file size in millions of

410
00:15:48,760 --> 00:15:54,520
bytes so<font color="#E5E5E5"> roughly 10 megs 10 million</font>

411
00:15:51,100 --> 00:15:56,890
bytes tak little s is going to specify

412
00:15:54,520 --> 00:15:58,990
the snap length of 0 now the snap length

413
00:15:56,890 --> 00:16:02,620
is a parameter that says how much of the

414
00:15:58,990 --> 00:16:05,380
data to grab out of the packet most new

415
00:16:02,620 --> 00:16:07,630
versions of TCP dump will grab the whole

416
00:16:05,380 --> 00:16:09,730
packet by default older versions would

417
00:16:07,630 --> 00:16:12,090
not they would stop up at like sixty

418
00:16:09,730 --> 00:16:14,950
five thousand bytes or something<font color="#E5E5E5"> and so</font>

419
00:16:12,090 --> 00:16:16,390
the you need to specify this on old

420
00:16:14,950 --> 00:16:17,890
versions new versions you can largely

421
00:16:16,390 --> 00:16:19,420
ignore it so if you've never<font color="#E5E5E5"> seen this</font>

422
00:16:17,890 --> 00:16:21,340
switch you're not using it's probably

423
00:16:19,420 --> 00:16:23,099
not a big deal<font color="#CCCCCC"> I included here is just</font><font color="#E5E5E5"> a</font>

424
00:16:21,340 --> 00:16:25,870
fail-safe if you work on an older system

425
00:16:23,100 --> 00:16:27,490
specify<font color="#CCCCCC"> tack s0 it'll just make sure you</font>

426
00:16:25,870 --> 00:16:28,350
get everything<font color="#E5E5E5"> that you're trying to</font>

427
00:16:27,490 --> 00:16:32,139
capture

428
00:16:28,350 --> 00:16:33,759
so tech little<font color="#CCCCCC"> W is our filename and tak</font>

429
00:16:32,139 --> 00:16:35,589
<font color="#CCCCCC">Big W</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> the number of files we're going</font>

430
00:16:33,759 --> 00:16:38,259
to create so what we're<font color="#CCCCCC"> doing we're</font>

431
00:16:35,589 --> 00:16:40,420
going to create<font color="#E5E5E5"> a capture interface</font>

432
00:16:38,259 --> 00:16:41,800
ethernet<font color="#E5E5E5"> 0 we're going to let it create</font>

433
00:16:40,420 --> 00:16:43,719
five different files and it's just going

434
00:16:41,800 --> 00:16:46,209
<font color="#CCCCCC">to roll through those files as that data</font>

435
00:16:43,720 --> 00:16:48,399
comes in so we're<font color="#E5E5E5"> going to always have</font>

436
00:16:46,209 --> 00:16:50,079
sort of the last 50 megs of files broken

437
00:16:48,399 --> 00:16:51,339
<font color="#CCCCCC">out and i broke</font><font color="#E5E5E5"> it out into separate</font>

438
00:16:50,079 --> 00:16:53,229
files because it makes it more

439
00:16:51,339 --> 00:16:54,569
digestible for analysis that way wire

440
00:16:53,230 --> 00:17:00,309
sharks are not struggling the way

441
00:16:54,569 --> 00:17:01,389
loading up huge file so we<font color="#CCCCCC"> ran our TCP</font>

442
00:17:00,309 --> 00:17:03,699
dump and here's<font color="#E5E5E5"> where we have five</font>

443
00:17:01,389 --> 00:17:05,679
<font color="#CCCCCC">different files now if you guys</font><font color="#E5E5E5"> notice</font>

444
00:17:03,699 --> 00:17:07,089
<font color="#CCCCCC">the the first file is the smallest one</font>

445
00:17:05,679 --> 00:17:08,679
so<font color="#E5E5E5"> that's kind of where we dropped off</font>

446
00:17:07,089 --> 00:17:12,339
on a ring buffer when I stop this it was

447
00:17:08,679 --> 00:17:13,419
on that top file next<font color="#E5E5E5"> key step were</font>

448
00:17:12,339 --> 00:17:14,799
doing analysis and production

449
00:17:13,419 --> 00:17:16,539
environment we're not going to dig

450
00:17:14,799 --> 00:17:18,158
through<font color="#CCCCCC"> the traffic on the production</font>

451
00:17:16,539 --> 00:17:20,279
box we're going to pull it<font color="#CCCCCC"> off into an</font>

452
00:17:18,159 --> 00:17:22,929
offline box and do analysis there

453
00:17:20,279 --> 00:17:25,599
historically Wireshark has had some

454
00:17:22,929 --> 00:17:27,189
vulnerabilities parsing data so we don't

455
00:17:25,599 --> 00:17:28,750
want<font color="#CCCCCC"> to just install Wireshark and</font>

456
00:17:27,189 --> 00:17:30,190
whatever box were interested in and

457
00:17:28,750 --> 00:17:32,230
start ripping through traffic we could

458
00:17:30,190 --> 00:17:36,490
<font color="#CCCCCC">potentially be introducing stabilities</font>

459
00:17:32,230 --> 00:17:39,309
problems and vulnerability issues so

460
00:17:36,490 --> 00:17:41,080
taking a look<font color="#E5E5E5"> at our traffic basically</font>

461
00:17:39,309 --> 00:17:44,049
what we<font color="#E5E5E5"> did here is in wireshark we</font>

462
00:17:41,080 --> 00:17:45,309
click statistics conversations ipv4 and

463
00:17:44,049 --> 00:17:49,149
we have a list<font color="#E5E5E5"> of all the conversations</font>

464
00:17:45,309 --> 00:17:51,879
the one across the<font color="#E5E5E5"> top you can see this</font>

465
00:17:49,149 --> 00:17:54,340
<font color="#E5E5E5">guy right here he's by far the largest</font>

466
00:17:51,880 --> 00:17:55,960
conversation so one particular host is

467
00:17:54,340 --> 00:17:57,399
beating up on<font color="#E5E5E5"> this now if this was a</font>

468
00:17:55,960 --> 00:17:58,929
huge<font color="#E5E5E5"> production app we probably see a</font>

469
00:17:57,399 --> 00:18:01,239
lot<font color="#CCCCCC"> more traffic but this is a huge</font>

470
00:17:58,929 --> 00:18:02,860
<font color="#E5E5E5">production app in my lab so we're really</font>

471
00:18:01,240 --> 00:18:07,480
just seeing one block<font color="#CCCCCC"> beat up on this</font>

472
00:18:02,860 --> 00:18:08,830
guy so we're<font color="#CCCCCC"> going to do is create a</font>

473
00:18:07,480 --> 00:18:11,640
quick filter and we're going<font color="#E5E5E5"> to look at</font>

474
00:18:08,830 --> 00:18:15,189
that traffic from that strange host so

475
00:18:11,640 --> 00:18:17,890
we identify our<font color="#CCCCCC"> host here doc 25s our</font>

476
00:18:15,190 --> 00:18:24,460
server 167 is our host that's beating up

477
00:18:17,890 --> 00:18:27,100
on the server so our next slide I p dot

478
00:18:24,460 --> 00:18:28,929
source equals equals and then we specify

479
00:18:27,100 --> 00:18:32,010
that client is beating up on our<font color="#E5E5E5"> host</font>

480
00:18:28,929 --> 00:18:34,720
and we see tons and tons of get requests

481
00:18:32,010 --> 00:18:35,980
in an hour get<font color="#CCCCCC"> requests we see some</font>

482
00:18:34,720 --> 00:18:38,380
strange parameters<font color="#E5E5E5"> one of the parameters</font>

483
00:18:35,980 --> 00:18:41,149
says it's seeking the etsy password file

484
00:18:38,380 --> 00:18:45,190
now generally<font color="#E5E5E5"> speaking that's not</font>

485
00:18:41,149 --> 00:18:45,189
normal web<font color="#CCCCCC"> requests</font><font color="#E5E5E5"> unless you're Danny</font>

486
00:18:45,759 --> 00:18:52,190
it's usually<font color="#CCCCCC"> dot dot slash dot dot slash</font>

487
00:18:48,049 --> 00:18:53,839
dot dot<font color="#E5E5E5"> yeah so that's an abnormal</font>

488
00:18:52,190 --> 00:18:56,029
request and we're<font color="#E5E5E5"> seeing it from an</font>

489
00:18:53,839 --> 00:18:58,009
inside address to our inside servers so

490
00:18:56,029 --> 00:19:00,469
we<font color="#E5E5E5"> really want to</font><font color="#CCCCCC"> figure out who who mr</font>

491
00:18:58,009 --> 00:19:03,710
dot 167 is let's go talk to<font color="#CCCCCC"> him let's</font>

492
00:19:00,469 --> 00:19:05,089
see what they're<font color="#CCCCCC"> doing</font><font color="#E5E5E5"> now we have a</font>

493
00:19:03,710 --> 00:19:07,009
unique opportunity here<font color="#E5E5E5"> because the</font>

494
00:19:05,089 --> 00:19:08,149
source address<font color="#CCCCCC"> is on the same subnet so</font>

495
00:19:07,009 --> 00:19:10,839
we're not going<font color="#E5E5E5"> to have to do a lot of</font>

496
00:19:08,149 --> 00:19:13,158
digging to figure out who this client is

497
00:19:10,839 --> 00:19:15,379
because the source is on the same subnet

498
00:19:13,159 --> 00:19:17,419
we can simply look inside Wireshark and

499
00:19:15,379 --> 00:19:19,129
see the mac address and know that that's

500
00:19:17,419 --> 00:19:20,929
the mac address of<font color="#E5E5E5"> our hosts more than</font>

501
00:19:19,129 --> 00:19:23,988
likely unless they're spoofing it which

502
00:19:20,929 --> 00:19:26,239
is possible but<font color="#E5E5E5"> not terribly likely so</font>

503
00:19:23,989 --> 00:19:28,940
what mac address would we see if<font color="#CCCCCC"> this</font>

504
00:19:26,239 --> 00:19:30,679
was a host<font color="#E5E5E5"> on a different subnet router</font>

505
00:19:28,940 --> 00:19:31,999
exactly yeah we'd see our router and

506
00:19:30,679 --> 00:19:35,929
then<font color="#E5E5E5"> we'd be investigating a router and</font>

507
00:19:31,999 --> 00:19:36,950
that's not<font color="#E5E5E5"> that interesting so looking</font>

508
00:19:35,929 --> 00:19:39,169
at the mac address that we've identified

509
00:19:36,950 --> 00:19:41,539
<font color="#E5E5E5">here we jump into our managed switch</font>

510
00:19:39,169 --> 00:19:43,489
look at the mac address table do a quick

511
00:19:41,539 --> 00:19:46,039
<font color="#E5E5E5">show mac address table pipe it into</font>

512
00:19:43,489 --> 00:19:49,999
include and that shows us what port is

513
00:19:46,039 --> 00:19:52,669
plugged into so after looking at the

514
00:19:49,999 --> 00:19:54,200
switch we find an experienced auditor

515
00:19:52,669 --> 00:19:56,149
and he's running some web<font color="#E5E5E5"> map scans over</font>

516
00:19:54,200 --> 00:19:58,249
<font color="#E5E5E5">the lunch hour so</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> promise not to cut</font>

517
00:19:56,149 --> 00:19:59,478
a corner office cissp and he promised

518
00:19:58,249 --> 00:20:03,619
<font color="#E5E5E5">not to scan stuff</font><font color="#CCCCCC"> during production</font>

519
00:19:59,479 --> 00:20:04,609
<font color="#E5E5E5">hours without checking first so we</font>

520
00:20:03,619 --> 00:20:07,070
probably could have seen this behavior

521
00:20:04,609 --> 00:20:08,869
via the logs but one thing that's

522
00:20:07,070 --> 00:20:10,939
important here<font color="#E5E5E5"> is we now have evidence</font>

523
00:20:08,869 --> 00:20:12,769
of this behavior so if it ever goes

524
00:20:10,940 --> 00:20:14,779
further or if it was<font color="#E5E5E5"> a hostile party</font>

525
00:20:12,769 --> 00:20:17,239
we've got evidence this situation we can

526
00:20:14,779 --> 00:20:18,769
<font color="#E5E5E5">put directly in an incident</font><font color="#CCCCCC"> report more</font>

527
00:20:17,239 --> 00:20:20,419
importantly we demonstrated how<font color="#CCCCCC"> to grab</font>

528
00:20:18,769 --> 00:20:22,869
our traffic off our production system

529
00:20:20,419 --> 00:20:31,009
without adversely affecting production

530
00:20:22,869 --> 00:20:32,509
<font color="#E5E5E5">on</font><font color="#CCCCCC"> to scenario 2 so</font><font color="#E5E5E5"> let's see oh you</font>

531
00:20:31,009 --> 00:20:35,149
know this text down here is still too

532
00:20:32,509 --> 00:20:36,739
small this says my wife says her her

533
00:20:35,149 --> 00:20:40,839
development team looks exactly like this

534
00:20:36,739 --> 00:20:44,259
picture except they have<font color="#E5E5E5"> e-cigs so</font>

535
00:20:40,839 --> 00:20:44,259
developers have a look

536
00:20:44,820 --> 00:20:49,870
so in this scenario the<font color="#CCCCCC"> dev team is</font>

537
00:20:48,460 --> 00:20:51,399
sending up an LDAP connection to an

538
00:20:49,870 --> 00:20:52,748
Active Directory domain controller sound

539
00:20:51,399 --> 00:20:56,439
familiar to anybody anybody ever gone

540
00:20:52,749 --> 00:20:57,850
through that they insist everything's

541
00:20:56,440 --> 00:21:00,039
correct but<font color="#CCCCCC"> their el lab query just</font>

542
00:20:57,850 --> 00:21:01,870
won't work and so the domain controllers

543
00:21:00,039 --> 00:21:03,039
production box and in<font color="#E5E5E5"> this environment</font>

544
00:21:01,870 --> 00:21:04,239
we're not allowed to install any

545
00:21:03,039 --> 00:21:06,129
software without going through<font color="#E5E5E5"> change</font>

546
00:21:04,240 --> 00:21:09,999
control meeting and we'd rather stand in

547
00:21:06,129 --> 00:21:10,809
front of<font color="#E5E5E5"> a bus during traffic so what</font>

548
00:21:09,999 --> 00:21:12,370
we're going to do<font color="#E5E5E5"> we're going to use</font>

549
00:21:10,809 --> 00:21:13,779
<font color="#CCCCCC">some built in windows tools to capture</font>

550
00:21:12,370 --> 00:21:15,428
the traffic we're going to export that

551
00:21:13,779 --> 00:21:17,710
<font color="#E5E5E5">into a format that Wireshark can read</font>

552
00:21:15,429 --> 00:21:19,149
and we're going to digest it that way so

553
00:21:17,710 --> 00:21:21,129
the built in tool we're going to use its

554
00:21:19,149 --> 00:21:22,360
net<font color="#E5E5E5"> assets trace and we're going</font><font color="#CCCCCC"> to</font>

555
00:21:21,129 --> 00:21:24,850
capture some packets on the domain

556
00:21:22,360 --> 00:21:27,158
controller copy the trace file<font color="#E5E5E5"> bak over</font>

557
00:21:24,850 --> 00:21:30,189
to our analysis box and use<font color="#E5E5E5"> Microsoft</font>

558
00:21:27,159 --> 00:21:32,440
message analyzer which has the acronym

559
00:21:30,190 --> 00:21:36,279
MMA it's the toughest protocol analyzer

560
00:21:32,440 --> 00:21:38,590
out there and we're<font color="#E5E5E5"> going to use</font><font color="#CCCCCC"> that to</font>

561
00:21:36,279 --> 00:21:39,940
convert the the traffic into a format

562
00:21:38,590 --> 00:21:40,928
that Wireshark will understand once we

563
00:21:39,940 --> 00:21:42,669
had the<font color="#E5E5E5"> packets we're going to</font><font color="#CCCCCC"> look</font><font color="#E5E5E5"> at</font>

564
00:21:40,929 --> 00:21:47,950
the ldap requests and see what's going

565
00:21:42,669 --> 00:21:51,700
<font color="#CCCCCC">on brief intermission moment to silence</font>

566
00:21:47,950 --> 00:21:54,429
that<font color="#CCCCCC"> barn</font><font color="#E5E5E5"> is dead so anybody use net Mon</font>

567
00:21:51,700 --> 00:21:59,259
back in the day yeah a couple hands a

568
00:21:54,429 --> 00:22:00,369
couple guys that<font color="#CCCCCC"> are older than 20 you</font>

569
00:21:59,259 --> 00:22:02,049
<font color="#E5E5E5">know back back in</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> early</font><font color="#CCCCCC"> days of</font>

570
00:22:00,369 --> 00:22:04,418
packard vaca captured when it was a

571
00:22:02,049 --> 00:22:05,918
<font color="#E5E5E5">theory i'll not Wireshark net</font><font color="#CCCCCC"> mon was</font>

572
00:22:04,419 --> 00:22:08,230
your tool that you could install<font color="#E5E5E5"> on</font>

573
00:22:05,919 --> 00:22:09,970
windows and it installed its own driver

574
00:22:08,230 --> 00:22:12,220
library so this<font color="#CCCCCC"> is before</font><font color="#E5E5E5"> the driver</font>

575
00:22:09,970 --> 00:22:14,860
library was bacon with the event tracing

576
00:22:12,220 --> 00:22:17,289
for<font color="#E5E5E5"> windows architecture an event</font>

577
00:22:14,860 --> 00:22:21,939
tracing for<font color="#E5E5E5"> windows the</font><font color="#CCCCCC"> ETL libraries</font>

578
00:22:17,289 --> 00:22:25,539
this is built into 2008 r2 server 2012

579
00:22:21,940 --> 00:22:28,299
<font color="#E5E5E5">Server 2012 r2 windows 7 8 81 I imagine</font>

580
00:22:25,539 --> 00:22:30,429
10 will include it as well 32 and 64-bit

581
00:22:28,299 --> 00:22:32,889
so we have this packet capture tool on

582
00:22:30,429 --> 00:22:34,600
all modern versions of<font color="#E5E5E5"> Windows very</font>

583
00:22:32,889 --> 00:22:39,039
important to know at least how to use it

584
00:22:34,600 --> 00:22:42,580
so<font color="#CCCCCC"> Microsoft message analyzer is</font>

585
00:22:39,039 --> 00:22:44,350
Microsoft's net Mon replacement we don't

586
00:22:42,580 --> 00:22:46,720
need Microsoft message analyzer to

587
00:22:44,350 --> 00:22:52,959
capture traffic we just need it to view

588
00:22:46,720 --> 00:22:54,460
the<font color="#CCCCCC"> ETL files so I'm</font><font color="#E5E5E5"> not going to go</font>

589
00:22:52,960 --> 00:22:55,899
through this tracing architecture in

590
00:22:54,460 --> 00:22:57,970
depth the slides in here if you'd<font color="#CCCCCC"> like</font>

591
00:22:55,899 --> 00:22:59,620
to<font color="#E5E5E5"> see how Microsoft</font>

592
00:22:57,970 --> 00:23:02,410
is the stack what you need<font color="#E5E5E5"> to know</font>

593
00:22:59,620 --> 00:23:04,300
essentially is that we used to do packet

594
00:23:02,410 --> 00:23:06,280
captures on windows with<font color="#CCCCCC"> the wind pcap</font>

595
00:23:04,300 --> 00:23:07,870
library and you'd have to install<font color="#CCCCCC"> that</font>

596
00:23:06,280 --> 00:23:09,430
and that could potentially be serviced

597
00:23:07,870 --> 00:23:11,649
affecting<font color="#E5E5E5"> because you were modifying</font>

598
00:23:09,430 --> 00:23:13,840
your network stack of a box while it was

599
00:23:11,650 --> 00:23:15,190
up and<font color="#CCCCCC"> running now it's baked in so we</font>

600
00:23:13,840 --> 00:23:17,050
have this netted stage trace command

601
00:23:15,190 --> 00:23:21,520
that we can utilize without affecting

602
00:23:17,050 --> 00:23:26,260
production in net estates trace outputs

603
00:23:21,520 --> 00:23:30,160
in the<font color="#E5E5E5"> event trace log or ETL format so</font>

604
00:23:26,260 --> 00:23:31,660
here<font color="#E5E5E5"> we show using it it's not a huge</font>

605
00:23:30,160 --> 00:23:33,940
<font color="#E5E5E5">change but you do need admin access</font>

606
00:23:31,660 --> 00:23:37,270
because you are working pretty low in

607
00:23:33,940 --> 00:23:39,250
<font color="#CCCCCC">the protocol stack and one key point so</font>

608
00:23:37,270 --> 00:23:41,050
I'm<font color="#E5E5E5"> going to kick off this noted States</font>

609
00:23:39,250 --> 00:23:43,150
trace here and you'll<font color="#CCCCCC"> notice it just</font>

610
00:23:41,050 --> 00:23:46,330
returned to meet you a command prompt so

611
00:23:43,150 --> 00:23:49,630
very important to specify a file note

612
00:23:46,330 --> 00:23:51,429
equals circular because if you kick this

613
00:23:49,630 --> 00:23:53,170
off and you just<font color="#E5E5E5"> go back to lunch and</font>

614
00:23:51,430 --> 00:23:55,660
forget all about<font color="#E5E5E5"> it you will fill up the</font>

615
00:23:53,170 --> 00:23:57,280
drive it doesn't sit there and show you

616
00:23:55,660 --> 00:23:59,380
what's actively running it's not TCP

617
00:23:57,280 --> 00:24:00,730
dump<font color="#E5E5E5"> output or anything like that it</font>

618
00:23:59,380 --> 00:24:03,100
just<font color="#E5E5E5"> drops you back to a prompt from the</font>

619
00:24:00,730 --> 00:24:06,100
<font color="#CCCCCC">seems all well so for this</font><font color="#E5E5E5"> particular</font>

620
00:24:03,100 --> 00:24:07,570
capture we say capture yes file mode

621
00:24:06,100 --> 00:24:09,219
circular we're going<font color="#CCCCCC"> to specify our</font>

622
00:24:07,570 --> 00:24:11,230
maximum size at 100 megs grab a little

623
00:24:09,220 --> 00:24:13,090
<font color="#E5E5E5">bit more traffic than before and we're</font>

624
00:24:11,230 --> 00:24:18,880
specifying our trace file once again if

625
00:24:13,090 --> 00:24:20,350
that utl format so while it's running if

626
00:24:18,880 --> 00:24:23,320
<font color="#E5E5E5">you want to see what it's doing you can</font>

627
00:24:20,350 --> 00:24:24,429
do this netis<font color="#CCCCCC"> H trace show status</font><font color="#E5E5E5"> and</font>

628
00:24:23,320 --> 00:24:25,780
that'll kind of dump and tell you what

629
00:24:24,430 --> 00:24:27,160
it's doing but otherwise if<font color="#E5E5E5"> you don't do</font>

630
00:24:25,780 --> 00:24:28,450
that it just runs in the background you

631
00:24:27,160 --> 00:24:30,850
don't see anything it doesn't give<font color="#E5E5E5"> you</font>

632
00:24:28,450 --> 00:24:32,260
anything that when you're all set you

633
00:24:30,850 --> 00:24:33,820
know after<font color="#E5E5E5"> the development</font><font color="#CCCCCC"> team has</font><font color="#E5E5E5"> made</font>

634
00:24:32,260 --> 00:24:35,980
their requests we can say Nana sage

635
00:24:33,820 --> 00:24:39,460
trace stop that'll stop the running

636
00:24:35,980 --> 00:24:41,020
capturing we got a file so we<font color="#CCCCCC"> stopped to</font>

637
00:24:39,460 --> 00:24:43,780
capture we see two files we have a cab

638
00:24:41,020 --> 00:24:46,120
file cabinet file and utl utl be in a

639
00:24:43,780 --> 00:24:47,500
bigger one<font color="#CCCCCC"> so next step we're on a</font>

640
00:24:46,120 --> 00:24:49,090
production<font color="#CCCCCC"> system we're going to take</font>

641
00:24:47,500 --> 00:24:50,830
<font color="#E5E5E5">our capture and pull</font><font color="#CCCCCC"> it off the</font>

642
00:24:49,090 --> 00:24:52,990
production system we're<font color="#E5E5E5"> going to a</font>

643
00:24:50,830 --> 00:24:54,460
windows box and it pains me to say this

644
00:24:52,990 --> 00:24:56,470
you're gonna<font color="#E5E5E5"> have to use a windows box</font>

645
00:24:54,460 --> 00:24:59,230
or a vm for at least this step because

646
00:24:56,470 --> 00:25:01,870
microsoft message analyzer is a windows

647
00:24:59,230 --> 00:25:05,800
program it's not ported over format for

648
00:25:01,870 --> 00:25:06,658
the<font color="#E5E5E5"> platforms so here is our capture</font>

649
00:25:05,800 --> 00:25:10,580
inside of

650
00:25:06,659 --> 00:25:12,720
<font color="#CCCCCC">mmm a Microsoft message analyzer</font>

651
00:25:10,580 --> 00:25:14,309
honestly we could start digging into our

652
00:25:12,720 --> 00:25:16,019
ldap traffic here we could look<font color="#E5E5E5"> and go</font>

653
00:25:14,309 --> 00:25:18,320
through and<font color="#CCCCCC"> find our ldap requests but</font>

654
00:25:16,019 --> 00:25:20,639
there's a<font color="#E5E5E5"> couple constraints here one a</font>

655
00:25:18,320 --> 00:25:23,129
quick sidebar has anybody worked with

656
00:25:20,639 --> 00:25:26,758
<font color="#E5E5E5">Microsoft message analyzer showing 10</font>

657
00:25:23,129 --> 00:25:28,349
get Nate yeah anybody<font color="#E5E5E5"> else</font><font color="#CCCCCC"> okay that's</font>

658
00:25:26,759 --> 00:25:31,320
kind of the response that I found from

659
00:25:28,349 --> 00:25:32,580
folks I'm curious<font color="#E5E5E5"> in by all means reach</font>

660
00:25:31,320 --> 00:25:34,529
out if you do work with this in the

661
00:25:32,580 --> 00:25:36,119
future I found<font color="#E5E5E5"> it to be just slowish</font>

662
00:25:34,529 --> 00:25:38,460
crap I mean I there's just no<font color="#CCCCCC"> other way</font>

663
00:25:36,119 --> 00:25:39,840
to<font color="#E5E5E5"> say it just it was so painfully slow</font>

664
00:25:38,460 --> 00:25:44,309
<font color="#E5E5E5">the</font><font color="#CCCCCC"> interactive Nate was that your</font>

665
00:25:39,840 --> 00:25:46,738
<font color="#E5E5E5">experience as</font><font color="#CCCCCC"> well yeah so it</font><font color="#E5E5E5"> was</font><font color="#CCCCCC"> just</font>

666
00:25:44,309 --> 00:25:48,629
it was painfully slow and then it is a

667
00:25:46,739 --> 00:25:50,159
single path platform it is you know the

668
00:25:48,629 --> 00:25:52,590
windows architecture and I don't

669
00:25:50,159 --> 00:25:54,149
primarily work in the window space so<font color="#CCCCCC"> I</font>

670
00:25:52,590 --> 00:25:55,918
wanted<font color="#E5E5E5"> to get in there and out of there</font>

671
00:25:54,149 --> 00:26:00,029
as quickly as possible<font color="#CCCCCC"> like a dress shop</font>

672
00:25:55,919 --> 00:26:01,559
I don't even want<font color="#CCCCCC"> to be there and</font><font color="#E5E5E5"> the</font>

673
00:26:00,029 --> 00:26:03,059
floor mats not<font color="#E5E5E5"> convenient to share right</font>

674
00:26:01,559 --> 00:26:03,809
so if you're sending<font color="#E5E5E5"> this to an engineer</font>

675
00:26:03,059 --> 00:26:05,009
on<font color="#E5E5E5"> the other end of the phone and</font>

676
00:26:03,809 --> 00:26:05,879
helping your support issue he's not

677
00:26:05,009 --> 00:26:07,739
going<font color="#E5E5E5"> to sell you please send me your</font>

678
00:26:05,879 --> 00:26:10,199
<font color="#CCCCCC">tracy ETO file you can say no</font><font color="#E5E5E5"> semi a</font>

679
00:26:07,739 --> 00:26:12,659
pcap so we need to know how to export

680
00:26:10,200 --> 00:26:14,129
this and most importantly<font color="#E5E5E5"> I really have</font>

681
00:26:12,659 --> 00:26:16,499
<font color="#E5E5E5">no</font><font color="#CCCCCC"> idea how to</font><font color="#E5E5E5"> use it I don't know the</font>

682
00:26:14,129 --> 00:26:17,728
filters work on sword stuff in here so

683
00:26:16,499 --> 00:26:20,369
we're going<font color="#E5E5E5"> to get out</font><font color="#CCCCCC"> of this program</font>

684
00:26:17,729 --> 00:26:22,379
<font color="#CCCCCC">is quickly as possible file save as</font>

685
00:26:20,369 --> 00:26:23,908
export oh and this is<font color="#E5E5E5"> where net mom</font>

686
00:26:22,379 --> 00:26:26,309
comes back in we have the net malformed

687
00:26:23,909 --> 00:26:29,249
at capability so we can export from MMA

688
00:26:26,309 --> 00:26:32,428
right into a<font color="#CCCCCC"> dot cap format and then</font>

689
00:26:29,249 --> 00:26:35,879
from<font color="#E5E5E5"> there we can open up cap rate in</font>

690
00:26:32,429 --> 00:26:37,229
wireshark and now we see our traffic so

691
00:26:35,879 --> 00:26:38,908
we see an ldap response from the server

692
00:26:37,229 --> 00:26:40,979
on the dev box indicating a binder

693
00:26:38,909 --> 00:26:43,080
usually an authentication<font color="#E5E5E5"> problem so we</font>

694
00:26:40,979 --> 00:26:44,879
can share<font color="#E5E5E5"> that result we can show what</font>

695
00:26:43,080 --> 00:26:47,879
the bind request looks like to the

696
00:26:44,879 --> 00:26:52,799
server with the dev team modify that

697
00:26:47,879 --> 00:26:55,469
program and then ldap bind success so

698
00:26:52,799 --> 00:26:57,168
what<font color="#CCCCCC"> is the point of this we could have</font>

699
00:26:55,470 --> 00:27:00,149
used<font color="#E5E5E5"> windows event logs and said hey</font>

700
00:26:57,169 --> 00:27:02,249
failed ldap you know you maybe check

701
00:27:00,149 --> 00:27:03,478
your creds whatever but really we were

702
00:27:02,249 --> 00:27:05,309
able<font color="#E5E5E5"> to correlate the request and they</font>

703
00:27:03,479 --> 00:27:07,349
can see how the request is arriving and

704
00:27:05,309 --> 00:27:08,639
what it looks like to the server but

705
00:27:07,349 --> 00:27:10,349
most importantly we showed you how to

706
00:27:08,639 --> 00:27:11,998
grab packets from a windows box without

707
00:27:10,349 --> 00:27:14,399
installing anything all these<font color="#CCCCCC"> tools are</font>

708
00:27:11,999 --> 00:27:16,460
baked in

709
00:27:14,400 --> 00:27:16,460
you

710
00:27:16,570 --> 00:27:22,418
scenario number three the security team

711
00:27:22,570 --> 00:27:28,458
so security team is evaluating a new IPs

712
00:27:26,119 --> 00:27:31,580
and they want you to<font color="#E5E5E5"> help them get</font>

713
00:27:28,459 --> 00:27:35,419
traffic has anybody here been through an

714
00:27:31,580 --> 00:27:38,799
IPS demo a couple<font color="#E5E5E5"> people so for those of</font>

715
00:27:35,419 --> 00:27:41,749
<font color="#CCCCCC">you that haven't yet Jason one or two</font>

716
00:27:38,799 --> 00:27:43,489
when<font color="#E5E5E5"> you demo an IPS it's generally</font>

717
00:27:41,749 --> 00:27:45,169
considered bad form to<font color="#E5E5E5"> walk up to your</font>

718
00:27:43,489 --> 00:27:46,789
network edge and rip out the upstream

719
00:27:45,169 --> 00:27:48,829
link and plug it into a box that<font color="#CCCCCC"> you</font>

720
00:27:46,789 --> 00:27:50,479
don't know how it works<font color="#E5E5E5"> we usually</font><font color="#CCCCCC"> don't</font>

721
00:27:48,829 --> 00:27:55,459
do that all the<font color="#E5E5E5"> packets fall over the</font>

722
00:27:50,479 --> 00:27:57,049
floor it's a big mess so when we're

723
00:27:55,459 --> 00:27:58,909
demoing a device like this usually what

724
00:27:57,049 --> 00:28:01,339
<font color="#CCCCCC">we want to do is we want to</font><font color="#E5E5E5"> create a</font>

725
00:27:58,909 --> 00:28:03,109
mere port and take all that traffic and

726
00:28:01,339 --> 00:28:04,219
<font color="#E5E5E5">let it do its thing and run out the</font><font color="#CCCCCC"> door</font>

727
00:28:03,109 --> 00:28:05,509
and we're going to mirror it over to

728
00:28:04,219 --> 00:28:06,859
something else and shoot<font color="#CCCCCC"> it over to that</font>

729
00:28:05,509 --> 00:28:11,629
box so<font color="#CCCCCC"> we can kind of play with</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> box</font>

730
00:28:06,859 --> 00:28:13,369
offline and not jack up our network so

731
00:28:11,629 --> 00:28:14,178
here's our strategy first thing we're

732
00:28:13,369 --> 00:28:15,859
going to do is we're going<font color="#E5E5E5"> to look at</font>

733
00:28:14,179 --> 00:28:17,209
our topology understand what are two

734
00:28:15,859 --> 00:28:18,799
pology is and then look at the

735
00:28:17,209 --> 00:28:20,839
capabilities of the edge switch<font color="#E5E5E5"> because</font>

736
00:28:18,799 --> 00:28:23,658
that's going to limit what we can and

737
00:28:20,839 --> 00:28:26,059
cannot span once we've configured our

738
00:28:23,659 --> 00:28:26,989
port will plug in we use wireshark and

739
00:28:26,059 --> 00:28:29,719
will validate that we're<font color="#E5E5E5"> seeing the</font>

740
00:28:26,989 --> 00:28:31,999
correct traffic so I know<font color="#E5E5E5"> you guys</font>

741
00:28:29,719 --> 00:28:33,169
<font color="#CCCCCC">memorized that</font><font color="#E5E5E5"> first apology diagram and</font>

742
00:28:31,999 --> 00:28:38,149
you don't need<font color="#E5E5E5"> to look at it again but</font>

743
00:28:33,169 --> 00:28:41,440
just in case here it is<font color="#CCCCCC"> again I don't</font>

744
00:28:38,149 --> 00:28:41,439
<font color="#CCCCCC">need you nonsense</font>

745
00:28:45,020 --> 00:28:51,660
so this<font color="#CCCCCC"> is our corporate office and we</font>

746
00:28:50,550 --> 00:28:53,970
are summarizing we have three<font color="#CCCCCC"> different</font>

747
00:28:51,660 --> 00:28:55,890
subnets here we have a server<font color="#E5E5E5"> network a</font>

748
00:28:53,970 --> 00:28:58,050
<font color="#E5E5E5">DMZ in a way in and we're aggregating</font>

749
00:28:55,890 --> 00:29:02,400
<font color="#E5E5E5">and going on our edge switch so 35-7</font>

750
00:28:58,050 --> 00:29:04,139
sorry 3750 stack at our edge so what

751
00:29:02,400 --> 00:29:05,580
we're going to want<font color="#CCCCCC"> to do is the server</font>

752
00:29:04,140 --> 00:29:07,530
team requested to see the server traffic

753
00:29:05,580 --> 00:29:11,870
so we are<font color="#E5E5E5"> going to span the uplink on</font>

754
00:29:07,530 --> 00:29:15,720
the server bored so in the cisco world

755
00:29:11,870 --> 00:29:17,879
we call a port mirroring spanning

756
00:29:15,720 --> 00:29:20,970
<font color="#E5E5E5">switchport analyzer that's their term</font>

757
00:29:17,880 --> 00:29:23,100
and it is relatively<font color="#E5E5E5"> specific to their</font>

758
00:29:20,970 --> 00:29:24,780
world so different<font color="#CCCCCC"> makes miles switches</font>

759
00:29:23,100 --> 00:29:26,340
have different capabilities the biggest

760
00:29:24,780 --> 00:29:28,200
<font color="#CCCCCC">difference</font><font color="#E5E5E5"> we see is how many</font>

761
00:29:26,340 --> 00:29:30,179
<font color="#E5E5E5">simultaneous sessions can you do at the</font>

762
00:29:28,200 --> 00:29:32,070
same time and what can<font color="#CCCCCC"> you use as a</font>

763
00:29:30,180 --> 00:29:34,020
source sometimes you can use a whole

764
00:29:32,070 --> 00:29:35,850
veal and as a source sometimes you can

765
00:29:34,020 --> 00:29:38,070
use multiple supports as a source it

766
00:29:35,850 --> 00:29:40,409
give<font color="#E5E5E5"> me these five ports and shove</font><font color="#CCCCCC"> it</font>

767
00:29:38,070 --> 00:29:42,179
out this other port over here the one

768
00:29:40,410 --> 00:29:45,420
problem we run into when we see that

769
00:29:42,180 --> 00:29:48,870
that<font color="#E5E5E5"> method is it's very easy to over</font>

770
00:29:45,420 --> 00:29:51,450
subscribe so if you span 20 ports out a

771
00:29:48,870 --> 00:29:52,919
single exit port your rate limit is

772
00:29:51,450 --> 00:29:54,600
going to be whatever that single exit

773
00:29:52,920 --> 00:29:58,290
port is so something to keep in mind as

774
00:29:54,600 --> 00:30:00,389
we're doing<font color="#E5E5E5"> this so in this instance we</font>

775
00:29:58,290 --> 00:30:03,510
have<font color="#E5E5E5"> a 3750 and that's going</font><font color="#CCCCCC"> to support</font>

776
00:30:00,390 --> 00:30:05,820
<font color="#E5E5E5">two simultaneous span sessions and it's</font>

777
00:30:03,510 --> 00:30:08,670
<font color="#E5E5E5">going to be able to take ports a</font>

778
00:30:05,820 --> 00:30:13,200
multitude of ports and a VLAN as a

779
00:30:08,670 --> 00:30:14,580
source so the first thing we're going to

780
00:30:13,200 --> 00:30:16,110
do logging<font color="#CCCCCC"> into the switch is a show</font>

781
00:30:14,580 --> 00:30:18,030
monitor session all that just tells<font color="#E5E5E5"> us</font>

782
00:30:16,110 --> 00:30:19,590
there's there anything running it would

783
00:30:18,030 --> 00:30:21,090
be considered bad form to login to the

784
00:30:19,590 --> 00:30:23,000
switch and clear all the monitor

785
00:30:21,090 --> 00:30:26,970
sessions right<font color="#E5E5E5"> out of the gate if</font>

786
00:30:23,000 --> 00:30:28,290
they're already looking at something so

787
00:30:26,970 --> 00:30:30,930
then we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to define</font><font color="#E5E5E5"> our source</font>

788
00:30:28,290 --> 00:30:32,899
port and define our destination port so

789
00:30:30,930 --> 00:30:35,580
the<font color="#E5E5E5"> command is pretty straightforward</font>

790
00:30:32,900 --> 00:30:37,500
right here still monitor session<font color="#E5E5E5"> one</font>

791
00:30:35,580 --> 00:30:39,060
<font color="#E5E5E5">source till your sessions it's going to</font>

792
00:30:37,500 --> 00:30:40,830
be one<font color="#CCCCCC"> or two on this particular switch</font>

793
00:30:39,060 --> 00:30:42,720
because<font color="#E5E5E5"> that's our limit and then we're</font>

794
00:30:40,830 --> 00:30:45,060
sourcing an interface and then we're

795
00:30:42,720 --> 00:30:46,380
saying session one destination and then

796
00:30:45,060 --> 00:30:47,970
that's where we're going to plug wire

797
00:30:46,380 --> 00:30:51,660
shark into is our destination interface

798
00:30:47,970 --> 00:30:53,310
that's it it's all there is to it from

799
00:30:51,660 --> 00:30:55,320
there we can do a show monitor sessional

800
00:30:53,310 --> 00:30:56,520
and that tells<font color="#E5E5E5"> us what's going</font><font color="#CCCCCC"> on if we</font>

801
00:30:55,320 --> 00:30:57,399
have multiple<font color="#CCCCCC"> sessions that would show</font>

802
00:30:56,520 --> 00:30:59,139
us the details of each

803
00:30:57,400 --> 00:31:03,310
in this instance we just have session<font color="#CCCCCC"> 1</font>

804
00:30:59,140 --> 00:31:05,590
so now<font color="#CCCCCC"> we can see our active session and</font>

805
00:31:03,310 --> 00:31:06,909
now we're going<font color="#E5E5E5"> to plug into port 12 our</font>

806
00:31:05,590 --> 00:31:11,080
destination port and validate that we're

807
00:31:06,910 --> 00:31:13,510
getting traffic so now we've got some

808
00:31:11,080 --> 00:31:15,100
some packets we plugged into gig 10 12

809
00:31:13,510 --> 00:31:16,780
we're all good we tell security team hey

810
00:31:15,100 --> 00:31:19,480
guys you're ready to go if copied the

811
00:31:16,780 --> 00:31:20,950
traffic over to you and they can plug in

812
00:31:19,480 --> 00:31:23,710
their IPs and start analyzing the

813
00:31:20,950 --> 00:31:26,770
traffic now<font color="#E5E5E5"> again this is duplicating</font>

814
00:31:23,710 --> 00:31:28,390
another port so realistically it's a

815
00:31:26,770 --> 00:31:31,330
copy of everything so for security

816
00:31:28,390 --> 00:31:35,070
appliance it'll alert that's about it

817
00:31:31,330 --> 00:31:35,070
for the most part with a couple of<font color="#CCCCCC"> cells</font>

818
00:31:35,250 --> 00:31:39,640
so security teams happy but they review

819
00:31:38,050 --> 00:31:42,370
the topology and realize they missed a

820
00:31:39,640 --> 00:31:44,080
couple networks so they'd like to see

821
00:31:42,370 --> 00:31:47,699
<font color="#E5E5E5">everything so</font><font color="#CCCCCC"> let's talk</font><font color="#E5E5E5"> about what</font>

822
00:31:44,080 --> 00:31:47,699
looks like to span an entire trunk port

823
00:31:48,000 --> 00:31:52,030
so in this instance we look at the

824
00:31:50,500 --> 00:31:53,320
config of our trunk port it's pretty

825
00:31:52,030 --> 00:31:55,149
straightforward we're just<font color="#E5E5E5"> having</font>

826
00:31:53,320 --> 00:31:56,620
capsulation dot1q we're not pruning

827
00:31:55,150 --> 00:32:00,160
<font color="#CCCCCC">VLANs all the vlans are allowed across</font>

828
00:31:56,620 --> 00:32:02,139
and we say switchport mode trunk so to

829
00:32:00,160 --> 00:32:03,460
get identical behavior on our spam for

830
00:32:02,140 --> 00:32:06,010
our destination<font color="#CCCCCC"> port is going to be</font>

831
00:32:03,460 --> 00:32:07,750
<font color="#E5E5E5">configured as a trunk as well so we say</font>

832
00:32:06,010 --> 00:32:10,750
switch port trunk encapsulation dot1q

833
00:32:07,750 --> 00:32:12,730
and switchport mode<font color="#CCCCCC"> trump and what</font>

834
00:32:10,750 --> 00:32:14,410
that's going to do for<font color="#CCCCCC"> us is as we send</font>

835
00:32:12,730 --> 00:32:16,480
packets over to that it's going<font color="#E5E5E5"> to keep</font>

836
00:32:14,410 --> 00:32:18,520
the VLAN tags intact<font color="#E5E5E5"> so we'll be able to</font>

837
00:32:16,480 --> 00:32:21,100
see which<font color="#E5E5E5"> traffic came from which we</font>

838
00:32:18,520 --> 00:32:22,510
<font color="#CCCCCC">like so we'll create our monitor session</font>

839
00:32:21,100 --> 00:32:25,689
and we<font color="#E5E5E5"> send it out</font><font color="#CCCCCC"> our new trunk port</font>

840
00:32:22,510 --> 00:32:29,860
plug laptop into<font color="#CCCCCC"> G 10</font><font color="#E5E5E5"> 12 million capture</font>

841
00:32:25,690 --> 00:32:33,460
<font color="#E5E5E5">some packets so on our</font><font color="#CCCCCC"> previous slide</font>

842
00:32:29,860 --> 00:32:36,669
our encapsulation right here was native

843
00:32:33,460 --> 00:32:38,920
which means no tags here we see dot1q so

844
00:32:36,670 --> 00:32:41,170
the traffic is egressing that port with

845
00:32:38,920 --> 00:32:42,190
frame tags still intact that means if

846
00:32:41,170 --> 00:32:43,300
you're getting<font color="#E5E5E5"> traffic from five</font>

847
00:32:42,190 --> 00:32:44,470
different<font color="#CCCCCC"> vlans you're going to have</font>

848
00:32:43,300 --> 00:32:45,639
<font color="#E5E5E5">five different tags you'll be able to</font>

849
00:32:44,470 --> 00:32:47,590
sort through that traffic in wireshark

850
00:32:45,640 --> 00:32:49,570
and see<font color="#CCCCCC"> this frame tags and that's</font><font color="#E5E5E5"> very</font>

851
00:32:47,590 --> 00:32:51,459
helpful in<font color="#E5E5E5"> a big complex environment</font>

852
00:32:49,570 --> 00:32:53,230
it's extremely helpful if you're in an

853
00:32:51,460 --> 00:32:54,910
environment where the network folks

854
00:32:53,230 --> 00:32:56,800
maybe don't have a deep understanding of

855
00:32:54,910 --> 00:33:00,060
what traffic is on what you in and

856
00:32:56,800 --> 00:33:00,060
you're trying<font color="#E5E5E5"> to sort</font><font color="#CCCCCC"> it out for them</font>

857
00:33:00,850 --> 00:33:05,659
so here<font color="#E5E5E5"> is our trunk traffic we see IP</font>

858
00:33:04,250 --> 00:33:07,370
addresses from our three different

859
00:33:05,660 --> 00:33:11,060
networks and most importantly we see our

860
00:33:07,370 --> 00:33:14,239
tag specified so right<font color="#E5E5E5"> here tag ID 99 so</font>

861
00:33:11,060 --> 00:33:21,100
the VLAN tag systemic here which is

862
00:33:14,240 --> 00:33:21,100
fantastic unless you're running<font color="#E5E5E5"> Windows</font>

863
00:33:21,910 --> 00:33:27,290
so here is<font color="#E5E5E5"> the same packet capture with</font>

864
00:33:25,310 --> 00:33:30,620
and without tags and essentially<font color="#CCCCCC"> what</font>

865
00:33:27,290 --> 00:33:32,899
happens is that we see this<font color="#E5E5E5"> 80 to 1 Q</font>

866
00:33:30,620 --> 00:33:34,340
frame option this just disappears in<font color="#E5E5E5"> the</font>

867
00:33:32,900 --> 00:33:36,230
capture as we're looking at Wireshark

868
00:33:34,340 --> 00:33:38,360
there's not an error or anything it's

869
00:33:36,230 --> 00:33:39,980
just not<font color="#E5E5E5"> there</font><font color="#CCCCCC"> and so we look at it try</font>

870
00:33:38,360 --> 00:33:42,379
and<font color="#E5E5E5"> figure out okay what is going on why</font>

871
00:33:39,980 --> 00:33:43,580
<font color="#CCCCCC">are we not seeing</font><font color="#E5E5E5"> that at all there's a</font>

872
00:33:42,380 --> 00:33:45,530
couple<font color="#E5E5E5"> different explanations for that</font>

873
00:33:43,580 --> 00:33:47,899
one if we have native down here

874
00:33:45,530 --> 00:33:49,820
specified well what we're telling the

875
00:33:47,900 --> 00:33:52,070
switch is strip all the tags off before

876
00:33:49,820 --> 00:33:55,340
you dump<font color="#E5E5E5"> it out the port so that's a</font>

877
00:33:52,070 --> 00:34:00,439
boo-boo on our monitor session statement

878
00:33:55,340 --> 00:34:07,520
so that's easy to fix or<font color="#CCCCCC"> Windows haze</font>

879
00:34:00,440 --> 00:34:09,470
tags so there's a couple issues with the

880
00:34:07,520 --> 00:34:11,360
windows driver stack and you can modify

881
00:34:09,469 --> 00:34:13,819
the registry there's a link in here from

882
00:34:11,360 --> 00:34:15,350
<font color="#E5E5E5">Intel I don't know if this works with</font>

883
00:34:13,820 --> 00:34:17,929
every driver or not but we were able<font color="#E5E5E5"> to</font>

884
00:34:15,350 --> 00:34:20,060
<font color="#E5E5E5">summon tell internet drivers make a</font>

885
00:34:17,929 --> 00:34:21,470
couple registry changes and then we

886
00:34:20,060 --> 00:34:23,929
would start to see the tags come through

887
00:34:21,469 --> 00:34:26,959
so if<font color="#E5E5E5"> you're doing any packet analysis</font>

888
00:34:23,929 --> 00:34:27,950
and you<font color="#E5E5E5"> guys need to see frame tags this</font>

889
00:34:26,960 --> 00:34:32,659
is good to know on the windows side

890
00:34:27,949 --> 00:34:34,189
using sent<font color="#E5E5E5"> OS Ubuntu Red Hat</font><font color="#CCCCCC"> OS X</font>

891
00:34:32,659 --> 00:34:36,230
everything just came through we saw<font color="#E5E5E5"> the</font>

892
00:34:34,190 --> 00:34:37,610
text respond so i don't know why windows

893
00:34:36,230 --> 00:34:43,340
strips the tags in the driver side what

894
00:34:37,610 --> 00:34:45,530
they do so one more complication<font color="#E5E5E5"> to our</font>

895
00:34:43,340 --> 00:34:46,730
scenario the security team still

896
00:34:45,530 --> 00:34:48,110
tweaking their hardware and they don't

897
00:34:46,730 --> 00:34:50,030
<font color="#CCCCCC">want to plug their ips into the edge</font>

898
00:34:48,110 --> 00:34:51,409
they want to plug their ips into a

899
00:34:50,030 --> 00:34:52,669
switch in their lab and it's on a

900
00:34:51,409 --> 00:34:55,010
different floor it's a different switch

901
00:34:52,668 --> 00:34:56,388
and they still want all the traffic so

902
00:34:55,010 --> 00:35:00,330
how do<font color="#E5E5E5"> we get the traffic from the edge</font>

903
00:34:56,389 --> 00:35:02,550
back over to their lab we use our spam

904
00:35:00,330 --> 00:35:04,200
so our span is remote spanning and

905
00:35:02,550 --> 00:35:06,900
basically what<font color="#E5E5E5"> we're going to do is me</font>

906
00:35:04,200 --> 00:35:08,910
report but on a different switch so HP

907
00:35:06,900 --> 00:35:11,700
broke a juniper and probably every other

908
00:35:08,910 --> 00:35:14,100
big managed switch vendor will support

909
00:35:11,700 --> 00:35:16,680
this the most of those vendors refer to

910
00:35:14,100 --> 00:35:19,259
it as mirroring and<font color="#E5E5E5"> remote mirroring key</font>

911
00:35:16,680 --> 00:35:21,390
points<font color="#CCCCCC"> our span is not compatible with</font>

912
00:35:19,260 --> 00:35:23,190
<font color="#E5E5E5">remote mirroring and if you have a cisco</font>

913
00:35:21,390 --> 00:35:29,100
<font color="#E5E5E5">switch a Juniper switch in the Cisco</font>

914
00:35:23,190 --> 00:35:35,490
switch it won't<font color="#E5E5E5"> work correctly these</font>

915
00:35:29,100 --> 00:35:38,850
things<font color="#E5E5E5"> usually are so the way this works</font>

916
00:35:35,490 --> 00:35:41,160
is we're going<font color="#E5E5E5"> to</font><font color="#CCCCCC"> define a VLAN for our</font>

917
00:35:38,850 --> 00:35:43,290
network and<font color="#E5E5E5"> the VLAN is the transit for</font>

918
00:35:41,160 --> 00:35:45,029
the remote<font color="#CCCCCC"> spam and that's why that</font>

919
00:35:43,290 --> 00:35:46,860
we're dependent across the same

920
00:35:45,030 --> 00:35:48,630
environment all the way through<font color="#E5E5E5"> so we</font>

921
00:35:46,860 --> 00:35:50,580
define the VLAN here tell it to shoot

922
00:35:48,630 --> 00:35:52,710
all the traffic up to the VLAN the

923
00:35:50,580 --> 00:35:54,509
switches use their natural ability to

924
00:35:52,710 --> 00:35:55,950
pass<font color="#CCCCCC"> VLANs to another and then this</font>

925
00:35:54,510 --> 00:35:58,980
switch knows how to pull the traffic off

926
00:35:55,950 --> 00:36:02,520
that new<font color="#CCCCCC"> line so</font><font color="#E5E5E5"> let's look at the</font>

927
00:35:58,980 --> 00:36:04,350
configuration very very similar<font color="#CCCCCC"> to the</font>

928
00:36:02,520 --> 00:36:05,250
monitor session configuration the

929
00:36:04,350 --> 00:36:06,870
difference is we're going<font color="#E5E5E5"> to do</font>

930
00:36:05,250 --> 00:36:08,310
everything times two because we're going

931
00:36:06,870 --> 00:36:11,910
<font color="#E5E5E5">to configure the source and then the</font>

932
00:36:08,310 --> 00:36:13,200
destination on each switch so the first

933
00:36:11,910 --> 00:36:15,629
thing we're going to do is create a VLAN

934
00:36:13,200 --> 00:36:18,240
and then when you create this<font color="#E5E5E5"> V line</font>

935
00:36:15,630 --> 00:36:20,610
<font color="#E5E5E5">this is just your</font><font color="#CCCCCC"> our span transit VLAN</font>

936
00:36:18,240 --> 00:36:22,379
so it's<font color="#E5E5E5"> not something you're using for</font>

937
00:36:20,610 --> 00:36:25,830
anything else don't<font color="#E5E5E5"> use the printer VLAN</font>

938
00:36:22,380 --> 00:36:27,870
that's a bad day so we create the VLAN

939
00:36:25,830 --> 00:36:30,180
and then we're going to say remote span

940
00:36:27,870 --> 00:36:31,740
letting<font color="#CCCCCC"> Cisco know that our intention is</font>

941
00:36:30,180 --> 00:36:33,810
<font color="#E5E5E5">to use this as a remote spam feeling if</font>

942
00:36:31,740 --> 00:36:37,169
you<font color="#CCCCCC"> don't specify it as a remote span</font>

943
00:36:33,810 --> 00:36:41,250
VLAN on every switch it won't work

944
00:36:37,170 --> 00:36:42,600
correctly so once we specified that we

945
00:36:41,250 --> 00:36:45,060
have our<font color="#E5E5E5"> our span VLAN we can you show</font>

946
00:36:42,600 --> 00:36:48,350
VLAN and see that it's populated and

947
00:36:45,060 --> 00:36:51,779
it's<font color="#E5E5E5"> ready to use if you have vtp or a</font>

948
00:36:48,350 --> 00:36:52,980
virtual trunking protocol that will pass

949
00:36:51,780 --> 00:36:54,480
<font color="#E5E5E5">through automatically a lot of folks</font>

950
00:36:52,980 --> 00:36:56,220
don't like use<font color="#E5E5E5"> vtp so you'll have to</font>

951
00:36:54,480 --> 00:36:57,730
manually configure it on both sides that

952
00:36:56,220 --> 00:37:00,160
case

953
00:36:57,730 --> 00:37:02,230
so our source we're going<font color="#E5E5E5"> to specify the</font>

954
00:37:00,160 --> 00:37:06,460
source interface and then we're going<font color="#E5E5E5"> to</font>

955
00:37:02,230 --> 00:37:08,890
use the destination as VLAN 555 so we're

956
00:37:06,460 --> 00:37:13,750
<font color="#E5E5E5">seeing that here</font><font color="#CCCCCC"> the left side</font><font color="#E5E5E5"> right</font>

957
00:37:08,890 --> 00:37:15,970
here remote VLAN 555 so show<font color="#CCCCCC"> monitor</font>

958
00:37:13,750 --> 00:37:18,640
session all and we see and this is our

959
00:37:15,970 --> 00:37:21,730
source which we see take<font color="#E5E5E5"> it from that</font>

960
00:37:18,640 --> 00:37:24,129
port and dump it to that VLAN now on our

961
00:37:21,730 --> 00:37:26,290
lab switch which is our destination we

962
00:37:24,130 --> 00:37:28,810
are going<font color="#CCCCCC"> to see say the source is a</font>

963
00:37:26,290 --> 00:37:32,619
remote VLAN and the destination is a

964
00:37:28,810 --> 00:37:36,130
local port so over<font color="#E5E5E5"> here source out of 11</font>

965
00:37:32,619 --> 00:37:43,840
5<font color="#CCCCCC"> 5 5</font><font color="#E5E5E5"> and then dumped out the ethernet</font>

966
00:37:36,130 --> 00:37:45,609
<font color="#E5E5E5">port and here is our results we see all</font>

967
00:37:43,840 --> 00:37:47,950
three networks and that comes over<font color="#E5E5E5"> from</font>

968
00:37:45,609 --> 00:37:49,540
our lab switch now in this instance we

969
00:37:47,950 --> 00:37:52,410
don't see frame text you guys know why

970
00:37:49,540 --> 00:37:52,410
we don't<font color="#CCCCCC"> see frame tags</font>

971
00:37:55,160 --> 00:37:59,390
on the<font color="#E5E5E5"> remote VLAN it's excellent so we</font>

972
00:37:57,830 --> 00:38:00,799
cannot get free frame tags through an

973
00:37:59,390 --> 00:38:03,200
hour<font color="#CCCCCC"> span it's the limitation of how the</font>

974
00:38:00,800 --> 00:38:06,830
traffic travels the network so the first

975
00:38:03,200 --> 00:38:08,720
switch tags<font color="#E5E5E5"> it all 555 shoots it across</font>

976
00:38:06,830 --> 00:38:11,870
<font color="#CCCCCC">the network and then that remote switch</font>

977
00:38:08,720 --> 00:38:13,430
strips all those tags off so in this

978
00:38:11,870 --> 00:38:15,290
instance great we<font color="#E5E5E5"> can shoot all the</font>

979
00:38:13,430 --> 00:38:19,490
traffic over to another switch but you

980
00:38:15,290 --> 00:38:21,080
no<font color="#CCCCCC"> longer have tags in that so scenario</font>

981
00:38:19,490 --> 00:38:22,520
<font color="#CCCCCC">3 what we've shown is we duplicated</font>

982
00:38:21,080 --> 00:38:24,140
traffic on our existing infrastructure

983
00:38:22,520 --> 00:38:26,030
we didn't make any topology changes we

984
00:38:24,140 --> 00:38:27,650
just need<font color="#E5E5E5"> some ports we use the span</font>

985
00:38:26,030 --> 00:38:30,220
session when we were<font color="#E5E5E5"> on</font><font color="#CCCCCC"> the same</font><font color="#E5E5E5"> switch</font>

986
00:38:27,650 --> 00:38:36,860
we use a remote span session we're on a

987
00:38:30,220 --> 00:38:40,120
distance which scenario for the packet

988
00:38:36,860 --> 00:38:42,290
mop sometimes we drop traffic and

989
00:38:40,120 --> 00:38:44,799
sometimes we want to know what<font color="#CCCCCC"> that</font>

990
00:38:42,290 --> 00:38:44,800
traffic was

991
00:38:44,940 --> 00:38:51,970
so let's take<font color="#E5E5E5"> a look at how to analyze</font>

992
00:38:47,230 --> 00:38:54,520
drop traffic so in<font color="#E5E5E5"> our scenario our</font>

993
00:38:51,970 --> 00:38:57,970
<font color="#E5E5E5">company restricts outbound DNS so only</font>

994
00:38:54,520 --> 00:39:00,880
our<font color="#E5E5E5"> DNS servers are allowed not terribly</font>

995
00:38:57,970 --> 00:39:02,500
uncommon lately we notice that<font color="#E5E5E5"> we're</font>

996
00:39:00,880 --> 00:39:04,000
seeing<font color="#E5E5E5"> a ton of packet drops and it's a</font>

997
00:39:02,500 --> 00:39:05,470
bunch of DNS requests and they're

998
00:39:04,000 --> 00:39:07,420
circumventing our DNS servers its

999
00:39:05,470 --> 00:39:10,029
clients reaching out for dns and they're

1000
00:39:07,420 --> 00:39:11,320
circumventing our infrastructure so to

1001
00:39:10,030 --> 00:39:13,359
try<font color="#CCCCCC"> and figure out what's causing this</font>

1002
00:39:11,320 --> 00:39:15,010
spike we want to look at<font color="#E5E5E5"> that DNS</font>

1003
00:39:13,359 --> 00:39:16,390
traffic that<font color="#CCCCCC"> dropped traffic</font><font color="#E5E5E5"> after our</font>

1004
00:39:15,010 --> 00:39:17,830
firewalls are<font color="#E5E5E5"> dropped it we don't want</font>

1005
00:39:16,390 --> 00:39:19,299
to allow it<font color="#CCCCCC"> and then look at</font><font color="#E5E5E5"> it we want</font>

1006
00:39:17,830 --> 00:39:21,790
<font color="#E5E5E5">to</font><font color="#CCCCCC"> continue</font><font color="#E5E5E5"> to drop it but take a look</font>

1007
00:39:19,300 --> 00:39:23,580
and<font color="#CCCCCC"> see what's going</font><font color="#E5E5E5"> on so in this</font>

1008
00:39:21,790 --> 00:39:26,589
instance we're going to use a Palo Alto

1009
00:39:23,580 --> 00:39:27,848
you can<font color="#E5E5E5"> certainly use a cisco a SI or if</font>

1010
00:39:26,589 --> 00:39:31,029
you absolutely hide to probably<font color="#E5E5E5"> a</font>

1011
00:39:27,849 --> 00:39:38,260
fordham hannah suppose maybe a Juniper

1012
00:39:31,030 --> 00:39:40,390
if you're strapped that's<font color="#E5E5E5"> just a job a</font>

1013
00:39:38,260 --> 00:39:42,060
couple guys up for itself all good

1014
00:39:40,390 --> 00:39:44,770
<font color="#CCCCCC">Hardware they'll all do</font><font color="#E5E5E5"> this just fine</font>

1015
00:39:42,060 --> 00:39:46,599
this is specific to firewalls though

1016
00:39:44,770 --> 00:39:48,160
when we're talking like a CLS and

1017
00:39:46,599 --> 00:39:49,990
switches they don't generally<font color="#CCCCCC"> have the</font>

1018
00:39:48,160 --> 00:39:52,509
capability to grab drop traffic so

1019
00:39:49,990 --> 00:39:56,410
firewalls can grab traffic at the drop

1020
00:39:52,510 --> 00:39:58,060
state though on the Palo Alto I'm just

1021
00:39:56,410 --> 00:40:00,129
using a couple<font color="#E5E5E5"> of CLI commands to</font>

1022
00:39:58,060 --> 00:40:02,049
initiate initiate the packet capture and

1023
00:40:00,130 --> 00:40:04,540
it's just<font color="#CCCCCC"> for commands</font><font color="#E5E5E5"> I'm not going to</font>

1024
00:40:02,050 --> 00:40:06,010
go through them real deep cisco<font color="#CCCCCC"> is very</font>

1025
00:40:04,540 --> 00:40:07,060
<font color="#E5E5E5">similar so are the other vendors and I</font>

1026
00:40:06,010 --> 00:40:09,250
have a little cheat sheet at<font color="#E5E5E5"> the end</font>

1027
00:40:07,060 --> 00:40:10,740
that will kind of go over that so we're

1028
00:40:09,250 --> 00:40:15,609
going to<font color="#CCCCCC"> start the packet capture and</font>

1029
00:40:10,740 --> 00:40:17,709
again as we talked about before these

1030
00:40:15,609 --> 00:40:19,598
devices have<font color="#E5E5E5"> resource constraints so we</font>

1031
00:40:17,710 --> 00:40:21,430
want to<font color="#CCCCCC"> use</font><font color="#E5E5E5"> a filter we're specifying a</font>

1032
00:40:19,599 --> 00:40:23,320
filter here and just saying you know

1033
00:40:21,430 --> 00:40:25,000
show<font color="#CCCCCC"> me the the DNS traffic that</font><font color="#E5E5E5"> you're</font>

1034
00:40:23,320 --> 00:40:27,700
dropping we<font color="#E5E5E5"> don't want to just grab all</font>

1035
00:40:25,000 --> 00:40:28,960
the traffic on our firewall so we're

1036
00:40:27,700 --> 00:40:30,339
<font color="#E5E5E5">going to start</font><font color="#CCCCCC"> our capture let it run</font>

1037
00:40:28,960 --> 00:40:31,690
for<font color="#CCCCCC"> a little bit and stop the capture</font>

1038
00:40:30,339 --> 00:40:33,580
download the file all this can<font color="#E5E5E5"> be done</font>

1039
00:40:31,690 --> 00:40:38,560
through<font color="#E5E5E5"> the gooey on the</font><font color="#CCCCCC"> Palo and the</font>

1040
00:40:33,580 --> 00:40:40,598
cisco as well so after<font color="#CCCCCC"> we've grabbed our</font>

1041
00:40:38,560 --> 00:40:42,759
drop traffic we can dig into it in

1042
00:40:40,599 --> 00:40:45,250
wireshark and pull it<font color="#E5E5E5"> up</font><font color="#CCCCCC"> and we can now</font>

1043
00:40:42,760 --> 00:40:47,290
see it's an internal host nice thing

1044
00:40:45,250 --> 00:40:49,570
about<font color="#E5E5E5"> DNS is</font><font color="#CCCCCC"> it's wide open</font><font color="#E5E5E5"> right so we</font>

1045
00:40:47,290 --> 00:40:51,220
can see the DNS requests the DNS are

1046
00:40:49,570 --> 00:40:54,160
trying to resolve malware calm and

1047
00:40:51,220 --> 00:40:56,200
malware calm is not a real domain it's

1048
00:40:54,160 --> 00:40:56,520
just one<font color="#E5E5E5"> I created for this example but</font>

1049
00:40:56,200 --> 00:40:58,319
<font color="#E5E5E5">this</font>

1050
00:40:56,520 --> 00:41:00,660
behavior is real behavior this is you

1051
00:40:58,320 --> 00:41:04,500
will see<font color="#E5E5E5"> this if you have very strange</font>

1052
00:41:00,660 --> 00:41:07,049
<font color="#E5E5E5">dns behave here</font><font color="#CCCCCC"> malware's and oftentimes</font>

1053
00:41:04,500 --> 00:41:08,370
the culprit so this helps us understand

1054
00:41:07,050 --> 00:41:10,110
<font color="#E5E5E5">all</font><font color="#CCCCCC"> right this is not legitimate traffic</font>

1055
00:41:08,370 --> 00:41:15,390
and we need<font color="#E5E5E5"> to go look at those house</font>

1056
00:41:10,110 --> 00:41:16,860
they may<font color="#E5E5E5"> be infected so drop traffic can</font>

1057
00:41:15,390 --> 00:41:19,170
be useful helps us dig deep into the

1058
00:41:16,860 --> 00:41:20,940
network issues and once again<font color="#E5E5E5"> a</font>

1059
00:41:19,170 --> 00:41:22,140
well-defined filter is important we

1060
00:41:20,940 --> 00:41:23,220
don't<font color="#E5E5E5"> want to add too much overhead in</font>

1061
00:41:22,140 --> 00:41:27,390
the firewall we don't want that<font color="#CCCCCC"> then</font>

1062
00:41:23,220 --> 00:41:29,160
kiddo so to summarize what we showed you

1063
00:41:27,390 --> 00:41:31,440
showed you how to grab traffic using TCP

1064
00:41:29,160 --> 00:41:33,839
dump on a<font color="#CCCCCC"> Linux host how to use night</font>

1065
00:41:31,440 --> 00:41:36,630
estates trace on a Windows host<font color="#E5E5E5"> built-in</font>

1066
00:41:33,840 --> 00:41:38,520
how to create<font color="#E5E5E5"> span in an hour span again</font>

1067
00:41:36,630 --> 00:41:39,900
vendor agnostic there's mirroring and

1068
00:41:38,520 --> 00:41:41,730
<font color="#E5E5E5">remote mirroring it's very similar and</font>

1069
00:41:39,900 --> 00:41:44,100
how to capture drop traffic on a

1070
00:41:41,730 --> 00:41:45,570
firewall because there's a<font color="#CCCCCC"> lot of CLI</font>

1071
00:41:44,100 --> 00:41:48,930
stuff in here we created a<font color="#E5E5E5"> little cheat</font>

1072
00:41:45,570 --> 00:41:50,370
sheet and on my cheat sheet we have the

1073
00:41:48,930 --> 00:41:52,859
cisco span commands the<font color="#E5E5E5"> our span</font>

1074
00:41:50,370 --> 00:41:56,900
commands HP port mirroring juniper

1075
00:41:52,860 --> 00:42:02,910
brocade palo alto cisco a SI or deviate

1076
00:41:56,900 --> 00:42:05,250
TCP dump f5 which is TCP dump net estate

1077
00:42:02,910 --> 00:42:06,540
<font color="#CCCCCC">Streisand t-shirt if</font><font color="#E5E5E5"> you guys</font><font color="#CCCCCC"> think of</font>

1078
00:42:05,250 --> 00:42:08,010
any platforms where you'd like<font color="#CCCCCC"> to see</font>

1079
00:42:06,540 --> 00:42:10,440
how to<font color="#CCCCCC"> setup captures your mirrors and</font>

1080
00:42:08,010 --> 00:42:11,790
it's not included on here I reach out I

1081
00:42:10,440 --> 00:42:15,870
got some white space to fill<font color="#E5E5E5"> we'll</font>

1082
00:42:11,790 --> 00:42:17,370
update it and here<font color="#CCCCCC"> are the download</font>

1083
00:42:15,870 --> 00:42:18,750
links i promised you for all the

1084
00:42:17,370 --> 00:42:22,880
contents so if you want go ahead

1085
00:42:18,750 --> 00:42:27,420
download that are there<font color="#E5E5E5"> any questions</font>

1086
00:42:22,880 --> 00:42:31,550
would anybody like another mimosa<font color="#CCCCCC"> okay</font>

1087
00:42:27,420 --> 00:42:31,550
well there we go thanks<font color="#E5E5E5"> guys</font>

1088
00:42:33,200 --> 00:42:35,259
you

