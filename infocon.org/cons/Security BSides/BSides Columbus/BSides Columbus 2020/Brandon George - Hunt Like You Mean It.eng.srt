1
00:00:00,880 --> 00:00:04,000
good afternoon besides columbus my name

2
00:00:02,879 --> 00:00:05,439
is brandon george

3
00:00:04,000 --> 00:00:08,240
this talk is called hunt like you mean

4
00:00:05,440 --> 00:00:10,559
it uh just a quick note about myself uh

5
00:00:08,240 --> 00:00:12,400
currently i am a senior analyst at buy

6
00:00:10,559 --> 00:00:14,919
air defenses sock

7
00:00:12,400 --> 00:00:17,199
and i am currently developing and

8
00:00:14,920 --> 00:00:19,439
maintaining two projects

9
00:00:17,199 --> 00:00:20,480
fourth or hunting one of which is

10
00:00:19,439 --> 00:00:23,840
curtailed

11
00:00:20,480 --> 00:00:26,160
to quick and easy deployments

12
00:00:23,840 --> 00:00:28,160
of the elastic stack for throwhunting

13
00:00:26,160 --> 00:00:30,960
and the other is a fork of olive heart

14
00:00:28,160 --> 00:00:32,880
tongue's cismod modular project

15
00:00:30,960 --> 00:00:34,239
so topics we're going to go over today

16
00:00:32,880 --> 00:00:37,520
we're going to go over

17
00:00:34,239 --> 00:00:38,320
what targeted for hunting is why we do

18
00:00:37,520 --> 00:00:41,360
threat hunts

19
00:00:38,320 --> 00:00:42,719
and how we do threat hunts so

20
00:00:41,360 --> 00:00:44,640
i want to go over just the working

21
00:00:42,719 --> 00:00:45,680
definition we're going to use today

22
00:00:44,640 --> 00:00:48,079
this is pretty much what you'll see

23
00:00:45,680 --> 00:00:49,600
across the board but it is proactively

24
00:00:48,079 --> 00:00:50,800
searching for threats or signs of

25
00:00:49,600 --> 00:00:54,640
compromise within

26
00:00:50,800 --> 00:00:55,519
an environment so let's go over targeted

27
00:00:54,640 --> 00:01:00,239
through hunting

28
00:00:55,520 --> 00:01:02,320
target through hunting was an idea that

29
00:01:00,239 --> 00:01:04,000
i found to be the most effective in

30
00:01:02,320 --> 00:01:06,960
getting

31
00:01:04,000 --> 00:01:07,840
small organizations and small

32
00:01:06,960 --> 00:01:10,880
deployments

33
00:01:07,840 --> 00:01:12,479
for threat hunting up and going it is a

34
00:01:10,880 --> 00:01:13,520
wrist wrist-based approach to data

35
00:01:12,479 --> 00:01:16,960
retention

36
00:01:13,520 --> 00:01:20,399
um one of the many issues that

37
00:01:16,960 --> 00:01:21,520
uh i found in trying to talk about

38
00:01:20,400 --> 00:01:23,520
through hunting was

39
00:01:21,520 --> 00:01:24,798
just the sheer volume of data people

40
00:01:23,520 --> 00:01:27,840
thought they needed

41
00:01:24,799 --> 00:01:29,439
to get started with her hunting for

42
00:01:27,840 --> 00:01:31,439
hunting doesn't need to be a massive

43
00:01:29,439 --> 00:01:34,079
deployment

44
00:01:31,439 --> 00:01:35,199
it can start with a department a few

45
00:01:34,079 --> 00:01:38,399
users

46
00:01:35,200 --> 00:01:40,400
a few hosts but you want to you want to

47
00:01:38,400 --> 00:01:44,079
deploy it based on risk

48
00:01:40,400 --> 00:01:47,920
so what i mean is you want to

49
00:01:44,079 --> 00:01:49,839
hunt for users um that interact with the

50
00:01:47,920 --> 00:01:51,840
outside world a lot

51
00:01:49,840 --> 00:01:53,920
users like hr who are going to be

52
00:01:51,840 --> 00:01:55,840
receiving

53
00:01:53,920 --> 00:01:57,600
resumes who are going to be interacting

54
00:01:55,840 --> 00:01:58,320
with people to get them started on their

55
00:01:57,600 --> 00:02:02,079
jobs

56
00:01:58,320 --> 00:02:04,798
you want to talk to and hunt for

57
00:02:02,079 --> 00:02:05,839
accounting they receive a lot of expense

58
00:02:04,799 --> 00:02:09,440
reports they're going to be

59
00:02:05,840 --> 00:02:11,120
talking with vendors for costs

60
00:02:09,440 --> 00:02:13,680
these are the types of users you're

61
00:02:11,120 --> 00:02:16,400
going to want to hunt for because

62
00:02:13,680 --> 00:02:16,800
we want to protect those users we want

63
00:02:16,400 --> 00:02:20,000
to

64
00:02:16,800 --> 00:02:20,800
make sure that they can continue to do

65
00:02:20,000 --> 00:02:22,800
their job

66
00:02:20,800 --> 00:02:24,720
and that if and ever the case they do

67
00:02:22,800 --> 00:02:26,879
open a malicious document

68
00:02:24,720 --> 00:02:27,760
is not their fault is just them doing

69
00:02:26,879 --> 00:02:29,679
their job we can

70
00:02:27,760 --> 00:02:31,120
you know we still continue to train them

71
00:02:29,680 --> 00:02:32,160
we still continue to do everything we

72
00:02:31,120 --> 00:02:34,840
can for them

73
00:02:32,160 --> 00:02:36,000
but if our defenses cannot withstand a

74
00:02:34,840 --> 00:02:37,440
maldock

75
00:02:36,000 --> 00:02:39,120
that speaks more lowly of us than it

76
00:02:37,440 --> 00:02:39,920
does of them and so targeted throw

77
00:02:39,120 --> 00:02:44,080
hunting

78
00:02:39,920 --> 00:02:46,480
helps in to aid in those defenses

79
00:02:44,080 --> 00:02:47,360
because if we just focus on our critical

80
00:02:46,480 --> 00:02:48,720
assets

81
00:02:47,360 --> 00:02:50,319
we're already going to catch it way late

82
00:02:48,720 --> 00:02:50,800
in the game and so we want to be able to

83
00:02:50,319 --> 00:02:52,958
focus

84
00:02:50,800 --> 00:02:54,319
and start at the end point to catch it

85
00:02:52,959 --> 00:02:58,239
early

86
00:02:54,319 --> 00:03:00,319
and hopefully see it before our edr does

87
00:02:58,239 --> 00:03:01,519
so let's talk about this a little bit

88
00:03:00,319 --> 00:03:04,560
more

89
00:03:01,519 --> 00:03:08,159
it reduces the amount of logs

90
00:03:04,560 --> 00:03:10,159
we're going to ingest by sheer volume

91
00:03:08,159 --> 00:03:11,359
but it's going to increase in diversity

92
00:03:10,159 --> 00:03:14,319
because we're going to take it from

93
00:03:11,360 --> 00:03:16,000
multiple different sources

94
00:03:14,319 --> 00:03:17,839
it's easier to manage for small to

95
00:03:16,000 --> 00:03:18,720
medium organizations because you're

96
00:03:17,840 --> 00:03:20,560
focused on

97
00:03:18,720 --> 00:03:22,400
maybe specific departments comprised of

98
00:03:20,560 --> 00:03:24,480
only a few people rather than

99
00:03:22,400 --> 00:03:25,840
large organizations which you could do

100
00:03:24,480 --> 00:03:27,119
the same thing but your departments are

101
00:03:25,840 --> 00:03:29,360
going to be larger

102
00:03:27,120 --> 00:03:31,120
and you may not want to focus so much on

103
00:03:29,360 --> 00:03:32,400
premise as maybe you would consider

104
00:03:31,120 --> 00:03:33,680
doing so in a small to medium

105
00:03:32,400 --> 00:03:35,280
organization

106
00:03:33,680 --> 00:03:36,959
it's really going to come down to

107
00:03:35,280 --> 00:03:37,840
whatever is going to be the most cost

108
00:03:36,959 --> 00:03:40,720
effective

109
00:03:37,840 --> 00:03:42,480
and easiest to manage because when it

110
00:03:40,720 --> 00:03:45,120
comes to this you gotta

111
00:03:42,480 --> 00:03:46,238
not only organize the operational side

112
00:03:45,120 --> 00:03:49,760
of it but you gotta

113
00:03:46,239 --> 00:03:52,799
be able to uh maintain and equip

114
00:03:49,760 --> 00:03:54,640
the hunters who are gonna be in your

115
00:03:52,799 --> 00:03:57,760
platforms

116
00:03:54,640 --> 00:03:59,679
so why do we hunt

117
00:03:57,760 --> 00:04:01,359
i think the definition itself gives a

118
00:03:59,680 --> 00:04:03,599
pretty good reason about why it's a hunt

119
00:04:01,360 --> 00:04:05,120
you're proactively searching for threats

120
00:04:03,599 --> 00:04:07,359
and anomalies and i want to

121
00:04:05,120 --> 00:04:08,959
kind of harp on anomalies because it is

122
00:04:07,360 --> 00:04:10,480
easier to hunt for anomalies than it is

123
00:04:08,959 --> 00:04:14,319
for threats

124
00:04:10,480 --> 00:04:15,840
and so with all that in mind

125
00:04:14,319 --> 00:04:17,918
it equips us to do a couple of other

126
00:04:15,840 --> 00:04:19,519
things as well it allows us to get

127
00:04:17,918 --> 00:04:22,719
familiar with our environments

128
00:04:19,519 --> 00:04:26,479
and to notice anomalies as they happen

129
00:04:22,720 --> 00:04:28,160
or in a very short period of time it

130
00:04:26,479 --> 00:04:31,120
equips us in such a way that when we do

131
00:04:28,160 --> 00:04:33,120
these deployments we can get a feel for

132
00:04:31,120 --> 00:04:34,479
what is normal for these hosts and when

133
00:04:33,120 --> 00:04:37,280
something

134
00:04:34,479 --> 00:04:38,240
deviates from that normal behavior we

135
00:04:37,280 --> 00:04:41,520
can kind of catch it

136
00:04:38,240 --> 00:04:43,280
and investigate the last and i think

137
00:04:41,520 --> 00:04:44,479
most important thing that throwhand

138
00:04:43,280 --> 00:04:47,758
enables us to do

139
00:04:44,479 --> 00:04:51,758
and why we ought to be doing it is that

140
00:04:47,759 --> 00:04:55,680
we can detect what we're not detecting

141
00:04:51,759 --> 00:04:59,280
we can write rules and searches

142
00:04:55,680 --> 00:05:01,919
that maybe our edr or our sim are just

143
00:04:59,280 --> 00:05:03,198
you know not designed or equipped to do

144
00:05:01,919 --> 00:05:05,520
at this point in time

145
00:05:03,199 --> 00:05:06,800
and we once we notice that oh okay you

146
00:05:05,520 --> 00:05:08,080
know we actually have evidence that

147
00:05:06,800 --> 00:05:09,759
something is happening

148
00:05:08,080 --> 00:05:12,800
we can incorporate those detections into

149
00:05:09,759 --> 00:05:15,919
our sim into our edr platforms

150
00:05:12,800 --> 00:05:18,000
and then go forward not just to

151
00:05:15,919 --> 00:05:19,039
you know embed your organization but to

152
00:05:18,000 --> 00:05:21,520
also

153
00:05:19,039 --> 00:05:23,039
um maybe make your vendor better you

154
00:05:21,520 --> 00:05:24,479
know that way you both have something to

155
00:05:23,039 --> 00:05:26,400
benefit from

156
00:05:24,479 --> 00:05:28,639
whatever you're seeing and making use of

157
00:05:26,400 --> 00:05:30,638
those logs for

158
00:05:28,639 --> 00:05:34,240
so let's talk about types of hunts tyler

159
00:05:30,639 --> 00:05:34,240
hudak not too long ago

160
00:05:34,639 --> 00:05:38,160
recently wrote a blog for trusted tech

161
00:05:36,560 --> 00:05:39,600
talking about

162
00:05:38,160 --> 00:05:41,440
what types of threat hunts you're going

163
00:05:39,600 --> 00:05:41,919
to be doing typically there's only going

164
00:05:41,440 --> 00:05:43,919
to be two

165
00:05:41,919 --> 00:05:45,280
there's a targeted throwhunt and there's

166
00:05:43,919 --> 00:05:47,120
going to be a general threat hunt

167
00:05:45,280 --> 00:05:48,880
the target of throne hunt is when you

168
00:05:47,120 --> 00:05:52,240
know you have ants in your house

169
00:05:48,880 --> 00:05:55,919
you know there is maybe some

170
00:05:52,240 --> 00:05:56,319
kind of bec or you have ransomware or

171
00:05:55,919 --> 00:05:58,159
really

172
00:05:56,319 --> 00:06:00,400
any type of malware or actor in your

173
00:05:58,160 --> 00:06:01,600
environment and you can specifically

174
00:06:00,400 --> 00:06:05,359
narrow it down

175
00:06:01,600 --> 00:06:06,880
to at least one specific detail that you

176
00:06:05,360 --> 00:06:09,199
can hunt for

177
00:06:06,880 --> 00:06:11,600
and if you maybe you say you know it's a

178
00:06:09,199 --> 00:06:13,520
threat actor maybe you know it's

179
00:06:11,600 --> 00:06:15,520
uh you know you have emotion in your

180
00:06:13,520 --> 00:06:17,680
environment or you know god forbid you

181
00:06:15,520 --> 00:06:20,240
had ta 505 in your environment

182
00:06:17,680 --> 00:06:21,840
you know what's going to kind of follow

183
00:06:20,240 --> 00:06:23,199
and you can threat and you can thread

184
00:06:21,840 --> 00:06:25,039
hunt

185
00:06:23,199 --> 00:06:26,800
based on those details based on previous

186
00:06:25,039 --> 00:06:29,360
reports

187
00:06:26,800 --> 00:06:30,800
or what researchers are posting about

188
00:06:29,360 --> 00:06:33,680
these kind of things

189
00:06:30,800 --> 00:06:34,000
are huntable they're focused on one

190
00:06:33,680 --> 00:06:35,759
thread

191
00:06:34,000 --> 00:06:38,000
actor one piece of malware and you can

192
00:06:35,759 --> 00:06:38,960
go from there a general threat hunt may

193
00:06:38,000 --> 00:06:41,759
be focused on

194
00:06:38,960 --> 00:06:44,239
one or two aspects that may be seen

195
00:06:41,759 --> 00:06:47,120
across multiple threat actors or

196
00:06:44,240 --> 00:06:49,199
maybe in particular something that is of

197
00:06:47,120 --> 00:06:51,840
value to you

198
00:06:49,199 --> 00:06:52,960
from a pen test or from a previous

199
00:06:51,840 --> 00:06:55,679
compromise that say

200
00:06:52,960 --> 00:06:57,198
you know why didn't we detect this so

201
00:06:55,680 --> 00:07:01,120
you can do a threat hunt

202
00:06:57,199 --> 00:07:01,120
and say i want to see

203
00:07:01,520 --> 00:07:05,440
evidence of malicious powershell in my

204
00:07:04,400 --> 00:07:09,120
environment i

205
00:07:05,440 --> 00:07:11,680
you know malicious being i want to see

206
00:07:09,120 --> 00:07:12,319
encoded and compressed commands um i

207
00:07:11,680 --> 00:07:15,599
want to see

208
00:07:12,319 --> 00:07:20,240
use of encoded command as a switch in

209
00:07:15,599 --> 00:07:20,240
you know the command line i want to see

210
00:07:20,319 --> 00:07:24,319
multiple network connections via

211
00:07:23,039 --> 00:07:27,360
powershell things like that

212
00:07:24,319 --> 00:07:30,639
very general they're not specific to any

213
00:07:27,360 --> 00:07:32,639
one thread actor or type of malware

214
00:07:30,639 --> 00:07:34,479
so let's talk about how we hunt it

215
00:07:32,639 --> 00:07:37,120
starts with knowing your resources

216
00:07:34,479 --> 00:07:38,560
before you ever develop a budget see if

217
00:07:37,120 --> 00:07:40,639
you can recommission

218
00:07:38,560 --> 00:07:41,599
an old server if you're a relatively

219
00:07:40,639 --> 00:07:43,120
small

220
00:07:41,599 --> 00:07:44,719
organization this may not be something

221
00:07:43,120 --> 00:07:46,319
that you have available to you but

222
00:07:44,720 --> 00:07:48,000
you know in a medium to large size

223
00:07:46,319 --> 00:07:49,759
organization that you know that just may

224
00:07:48,000 --> 00:07:52,800
be something you can

225
00:07:49,759 --> 00:07:55,599
save your budget with see it

226
00:07:52,800 --> 00:07:57,039
you know see if it's high in ram and

227
00:07:55,599 --> 00:08:00,080
high in storage

228
00:07:57,039 --> 00:08:02,639
because these applications are mainly

229
00:08:00,080 --> 00:08:04,719
going to focus on those two

230
00:08:02,639 --> 00:08:06,960
you want to make sure that you have

231
00:08:04,720 --> 00:08:08,800
enough network capacity to not

232
00:08:06,960 --> 00:08:12,080
create so much ingestion that this has

233
00:08:08,800 --> 00:08:15,039
become more of a problem than a solution

234
00:08:12,080 --> 00:08:16,479
and when we talk about storage see if

235
00:08:15,039 --> 00:08:18,479
you can set up

236
00:08:16,479 --> 00:08:22,000
and do the math to set up three to six

237
00:08:18,479 --> 00:08:25,120
months of log retention

238
00:08:22,000 --> 00:08:27,039
that is not always feasible

239
00:08:25,120 --> 00:08:29,120
and i'm aware of that three to six

240
00:08:27,039 --> 00:08:31,280
months is a gold standard that a lot of

241
00:08:29,120 --> 00:08:33,039
people can't really aspire to

242
00:08:31,280 --> 00:08:35,360
but if you can get one to three months

243
00:08:33,039 --> 00:08:37,598
that is a great start because

244
00:08:35,360 --> 00:08:39,120
one to three months of dedicated storage

245
00:08:37,599 --> 00:08:41,519
of just logs that

246
00:08:39,120 --> 00:08:43,760
from hosts that you are interested in

247
00:08:41,519 --> 00:08:47,120
can be enough to do great threat hunts

248
00:08:43,760 --> 00:08:50,560
you know on a small but maybe

249
00:08:47,120 --> 00:08:53,760
valuable data set um see

250
00:08:50,560 --> 00:08:55,199
how many daily what size what's the size

251
00:08:53,760 --> 00:08:56,959
of the daily logs you want to receive

252
00:08:55,200 --> 00:08:58,640
from these hosts a day

253
00:08:56,959 --> 00:09:00,479
and kind of go from there because then

254
00:08:58,640 --> 00:09:01,920
you need to focus on your analysts um

255
00:09:00,480 --> 00:09:03,760
are you going to be able to feed them a

256
00:09:01,920 --> 00:09:06,560
steady flow of resources

257
00:09:03,760 --> 00:09:07,680
to distinguish one from a false positive

258
00:09:06,560 --> 00:09:09,599
from a true positive

259
00:09:07,680 --> 00:09:11,120
and are and what are they going to do

260
00:09:09,600 --> 00:09:12,240
with gray areas

261
00:09:11,120 --> 00:09:14,720
what are they going to do with hosts

262
00:09:12,240 --> 00:09:16,480
that or with logs that they are

263
00:09:14,720 --> 00:09:18,320
you know unsure about are they going to

264
00:09:16,480 --> 00:09:21,839
have the time

265
00:09:18,320 --> 00:09:23,760
and available resources to study and

266
00:09:21,839 --> 00:09:24,800
know what to hunt for

267
00:09:23,760 --> 00:09:26,240
all these things you need to kind of

268
00:09:24,800 --> 00:09:28,800
take in consideration especially if

269
00:09:26,240 --> 00:09:32,320
you're working in a team environment

270
00:09:28,800 --> 00:09:32,800
and you are not just the lone security

271
00:09:32,320 --> 00:09:36,640
guy

272
00:09:32,800 --> 00:09:39,680
that we have developed a mythos around

273
00:09:36,640 --> 00:09:40,240
so let's talk about logs know your log

274
00:09:39,680 --> 00:09:42,560
sources

275
00:09:40,240 --> 00:09:44,399
do you have departments or specific

276
00:09:42,560 --> 00:09:45,279
hosts that you are really interested in

277
00:09:44,399 --> 00:09:47,360
and want to

278
00:09:45,279 --> 00:09:49,279
always kind of keep an eye on maybe you

279
00:09:47,360 --> 00:09:50,720
have maybe you want to keep an eye on

280
00:09:49,279 --> 00:09:52,080
your c-suite you want to hunt for

281
00:09:50,720 --> 00:09:54,640
specific users

282
00:09:52,080 --> 00:09:55,600
um identify again identify those risky

283
00:09:54,640 --> 00:09:58,000
users because they're

284
00:09:55,600 --> 00:10:00,160
they're going to be of value to you when

285
00:09:58,000 --> 00:10:03,120
you were doing your third house

286
00:10:00,160 --> 00:10:05,120
keeping your assets in scope makes

287
00:10:03,120 --> 00:10:08,399
retention

288
00:10:05,120 --> 00:10:09,920
much easier and it opens up other

289
00:10:08,399 --> 00:10:12,720
opportunities later to

290
00:10:09,920 --> 00:10:15,439
increase what types of logs you're going

291
00:10:12,720 --> 00:10:15,440
to be ingesting

292
00:10:17,440 --> 00:10:21,279
once you know you're going to be

293
00:10:18,800 --> 00:10:23,359
ingesting um

294
00:10:21,279 --> 00:10:24,399
think about what is going to be most

295
00:10:23,360 --> 00:10:26,079
valuable to you

296
00:10:24,399 --> 00:10:27,600
is it you know you're obviously going to

297
00:10:26,079 --> 00:10:28,880
have windows operational logs but are

298
00:10:27,600 --> 00:10:29,920
you going to deploy sysmon are you going

299
00:10:28,880 --> 00:10:32,000
to deploy zeke

300
00:10:29,920 --> 00:10:33,519
um are you interested in windows dns

301
00:10:32,000 --> 00:10:35,440
logs um

302
00:10:33,519 --> 00:10:37,600
and this should go without saying but

303
00:10:35,440 --> 00:10:40,000
you should be logging powershell

304
00:10:37,600 --> 00:10:42,320
um all of these things can you know once

305
00:10:40,000 --> 00:10:46,240
put together can offer you

306
00:10:42,320 --> 00:10:49,360
a very clear and valuable picture into

307
00:10:46,240 --> 00:10:50,560
um you know what a successful hunt may

308
00:10:49,360 --> 00:10:54,720
look like

309
00:10:50,560 --> 00:10:57,279
can you you know extrapolate you know

310
00:10:54,720 --> 00:10:58,480
you know these what seemed like

311
00:10:57,279 --> 00:11:01,760
disparate details

312
00:10:58,480 --> 00:11:03,279
to form a clear picture

313
00:11:01,760 --> 00:11:05,279
all right let's talk about centralized

314
00:11:03,279 --> 00:11:09,360
logging if you

315
00:11:05,279 --> 00:11:11,200
want a successful threat hunting program

316
00:11:09,360 --> 00:11:12,800
and you want to save an incident

317
00:11:11,200 --> 00:11:15,839
responder a lot of time

318
00:11:12,800 --> 00:11:18,079
you must centralize your logging

319
00:11:15,839 --> 00:11:19,120
doing it now is much easier than how it

320
00:11:18,079 --> 00:11:21,680
used to be

321
00:11:19,120 --> 00:11:23,760
you know even five to seven years ago

322
00:11:21,680 --> 00:11:26,719
using shippers like nx log and when log

323
00:11:23,760 --> 00:11:26,720
beat are going to be

324
00:11:27,040 --> 00:11:31,199
the way you are going i would say the

325
00:11:29,519 --> 00:11:34,000
easiest way to get

326
00:11:31,200 --> 00:11:34,800
your logs from your endpoints to your

327
00:11:34,000 --> 00:11:37,760
platform

328
00:11:34,800 --> 00:11:38,640
now whatever that may be uh and i talked

329
00:11:37,760 --> 00:11:42,880
about this before

330
00:11:38,640 --> 00:11:46,240
but make note of how much congestion

331
00:11:42,880 --> 00:11:49,519
this might create if

332
00:11:46,240 --> 00:11:52,800
you have enough bandwidth internally

333
00:11:49,519 --> 00:11:53,760
this shouldn't be too bad however if you

334
00:11:52,800 --> 00:11:55,680
are just

335
00:11:53,760 --> 00:11:57,519
getting all gung-ho about it this might

336
00:11:55,680 --> 00:11:59,040
create some problems

337
00:11:57,519 --> 00:12:00,639
so let's talk about full text searching

338
00:11:59,040 --> 00:12:03,279
platforms uh

339
00:12:00,639 --> 00:12:04,560
three that i am going to try and just

340
00:12:03,279 --> 00:12:06,320
talk about real quick

341
00:12:04,560 --> 00:12:07,760
are the three that i know of and have

342
00:12:06,320 --> 00:12:11,760
had experience with

343
00:12:07,760 --> 00:12:15,120
um elasticsearch is remarkably efficient

344
00:12:11,760 --> 00:12:16,880
and what elastic is doing with our

345
00:12:15,120 --> 00:12:19,760
products now i think is

346
00:12:16,880 --> 00:12:21,120
quite remarkable if you want to look at

347
00:12:19,760 --> 00:12:24,480
cloud storage

348
00:12:21,120 --> 00:12:27,920
humeo is very effective and i think is

349
00:12:24,480 --> 00:12:28,639
a wonderful place to do you know basic

350
00:12:27,920 --> 00:12:31,439
searches

351
00:12:28,639 --> 00:12:32,800
and hold all the logs that you're

352
00:12:31,440 --> 00:12:34,959
looking for

353
00:12:32,800 --> 00:12:36,639
it's very similar in searching to things

354
00:12:34,959 --> 00:12:39,040
like cubana

355
00:12:36,639 --> 00:12:40,399
and you can pull all sorts of fields out

356
00:12:39,040 --> 00:12:43,199
with humeo

357
00:12:40,399 --> 00:12:46,079
splunk splunk has built quite the

358
00:12:43,200 --> 00:12:50,639
reputation in being

359
00:12:46,079 --> 00:12:53,839
just the place for log searching

360
00:12:50,639 --> 00:12:57,279
you can do powerful

361
00:12:53,839 --> 00:12:58,880
metrics tracking with splunk valuable

362
00:12:57,279 --> 00:13:00,480
field data that you can pull out and

363
00:12:58,880 --> 00:13:03,680
search for

364
00:13:00,480 --> 00:13:04,959
but it is always kind of calm with that

365
00:13:03,680 --> 00:13:08,319
hefty price tag

366
00:13:04,959 --> 00:13:10,319
so if it is not something you can do

367
00:13:08,320 --> 00:13:12,160
elasticsearch and humeo are two

368
00:13:10,320 --> 00:13:13,519
cost-effective measures you can do

369
00:13:12,160 --> 00:13:16,800
either in the cloud

370
00:13:13,519 --> 00:13:18,839
elastic cloud is

371
00:13:16,800 --> 00:13:20,000
relatively inexpensive in comparison to

372
00:13:18,839 --> 00:13:22,240
splunk

373
00:13:20,000 --> 00:13:23,040
but still something you can deploy on

374
00:13:22,240 --> 00:13:27,040
prem

375
00:13:23,040 --> 00:13:29,279
humeo is also very cost effective

376
00:13:27,040 --> 00:13:31,680
if you i will say this though if you

377
00:13:29,279 --> 00:13:34,639
have a sim or an edr that has

378
00:13:31,680 --> 00:13:35,920
searching capabilities do not go and try

379
00:13:34,639 --> 00:13:38,959
and search out a new product

380
00:13:35,920 --> 00:13:40,959
unless you are already considering

381
00:13:38,959 --> 00:13:44,079
you know getting rid of whatever you had

382
00:13:40,959 --> 00:13:49,040
before there are some very

383
00:13:44,079 --> 00:13:51,519
poor sims uh that i have seen that have

384
00:13:49,040 --> 00:13:53,680
really lackluster searching capabilities

385
00:13:51,519 --> 00:13:55,040
maybe do a lack of documentation or it's

386
00:13:53,680 --> 00:13:58,079
just too clunky

387
00:13:55,040 --> 00:14:01,519
um if that is something you want to do

388
00:13:58,079 --> 00:14:03,920
as a replacement these three

389
00:14:01,519 --> 00:14:05,360
are ones i would encourage you to go

390
00:14:03,920 --> 00:14:07,040
look at

391
00:14:05,360 --> 00:14:08,560
so let's talk about searching for

392
00:14:07,040 --> 00:14:11,279
anomalies

393
00:14:08,560 --> 00:14:12,160
as a general rule anomalies are easier

394
00:14:11,279 --> 00:14:15,279
to hunt for

395
00:14:12,160 --> 00:14:18,480
than threats the reason being

396
00:14:15,279 --> 00:14:19,680
is that uh threats

397
00:14:18,480 --> 00:14:21,680
require that you know that they're

398
00:14:19,680 --> 00:14:25,680
threats

399
00:14:21,680 --> 00:14:27,519
when you search for anomalies

400
00:14:25,680 --> 00:14:28,800
you have the opportunity to see things

401
00:14:27,519 --> 00:14:31,440
that maybe

402
00:14:28,800 --> 00:14:32,479
aren't necessarily malicious but they

403
00:14:31,440 --> 00:14:34,480
are suspicious maybe

404
00:14:32,480 --> 00:14:35,639
you know prompt something like hey you

405
00:14:34,480 --> 00:14:37,279
know we have a pretty severe

406
00:14:35,639 --> 00:14:39,760
misconfiguration

407
00:14:37,279 --> 00:14:40,800
um with our sharepoint server you know

408
00:14:39,760 --> 00:14:43,040
things like that

409
00:14:40,800 --> 00:14:45,599
you can use metrics after you've con you

410
00:14:43,040 --> 00:14:47,439
know pretty repetitiously set baselines

411
00:14:45,600 --> 00:14:49,120
to notice things that are kind of out of

412
00:14:47,440 --> 00:14:50,959
line

413
00:14:49,120 --> 00:14:52,480
because once you set baselines you can

414
00:14:50,959 --> 00:14:56,079
start catching little hanging fruit

415
00:14:52,480 --> 00:14:57,440
like should windward.exe be spawning a

416
00:14:56,079 --> 00:14:58,880
child process that's something you can

417
00:14:57,440 --> 00:15:00,639
see in an endpoint i mean you wouldn't

418
00:14:58,880 --> 00:15:05,040
necessarily see that on a server

419
00:15:00,639 --> 00:15:07,279
but you can set up searches to say hey

420
00:15:05,040 --> 00:15:08,240
is there you know any process where the

421
00:15:07,279 --> 00:15:10,079
parent process

422
00:15:08,240 --> 00:15:11,680
is one word you can set up things like

423
00:15:10,079 --> 00:15:13,040
that and

424
00:15:11,680 --> 00:15:15,519
you know have something pretty much

425
00:15:13,040 --> 00:15:18,000
instantaneously

426
00:15:15,519 --> 00:15:20,560
have you looked at ms hta recently if

427
00:15:18,000 --> 00:15:24,839
you don't know what mshta is

428
00:15:20,560 --> 00:15:27,920
mshga stands for microsoft rich html

429
00:15:24,839 --> 00:15:31,680
application you can write what's called

430
00:15:27,920 --> 00:15:35,680
hda files and they're essentially

431
00:15:31,680 --> 00:15:38,719
just html pages with

432
00:15:35,680 --> 00:15:41,680
that you can use as a gui

433
00:15:38,720 --> 00:15:44,000
hp procs are using them uh amazon

434
00:15:41,680 --> 00:15:44,719
assistant is built with hda files even

435
00:15:44,000 --> 00:15:46,720
teamviewer

436
00:15:44,720 --> 00:15:47,839
uh if you have you know the chrome

437
00:15:46,720 --> 00:15:51,199
extension

438
00:15:47,839 --> 00:15:55,040
that uses an hta file as well

439
00:15:51,199 --> 00:15:57,439
all of these things are false positives

440
00:15:55,040 --> 00:15:58,639
but you can pretty easily identify and

441
00:15:57,440 --> 00:16:02,320
we'll see this later

442
00:15:58,639 --> 00:16:04,240
what a malicious use of mshga looks like

443
00:16:02,320 --> 00:16:06,079
you want to talk about lahaine fruit

444
00:16:04,240 --> 00:16:08,720
let's talk about users

445
00:16:06,079 --> 00:16:09,839
launching and using applications they

446
00:16:08,720 --> 00:16:12,000
don't normally use

447
00:16:09,839 --> 00:16:13,680
should your href be running powershell

448
00:16:12,000 --> 00:16:16,720
things like that can be useful to you

449
00:16:13,680 --> 00:16:19,120
to try and narrow down

450
00:16:16,720 --> 00:16:21,040
what is considered anomalous maybe your

451
00:16:19,120 --> 00:16:24,320
hr rep is familiar with powershell

452
00:16:21,040 --> 00:16:26,240
and an application they use for employee

453
00:16:24,320 --> 00:16:29,040
management

454
00:16:26,240 --> 00:16:29,920
utilizes powershell it may run as that

455
00:16:29,040 --> 00:16:32,319
user

456
00:16:29,920 --> 00:16:33,360
but you know you can quickly identify

457
00:16:32,320 --> 00:16:36,399
when something

458
00:16:33,360 --> 00:16:38,800
is malicious and when it is not so let's

459
00:16:36,399 --> 00:16:40,240
talk about knowing evil

460
00:16:38,800 --> 00:16:44,240
because this is what threat hunting is

461
00:16:40,240 --> 00:16:46,560
all about you have to be able to

462
00:16:44,240 --> 00:16:48,959
read up on blogs read up on ir reports

463
00:16:46,560 --> 00:16:51,518
on what responders are seeing

464
00:16:48,959 --> 00:16:53,119
as well as utilize things like malware

465
00:16:51,519 --> 00:16:56,720
reporting feeds

466
00:16:53,120 --> 00:16:58,320
such as appany.run url house if you want

467
00:16:56,720 --> 00:16:59,600
fresh malware from researchers and what

468
00:16:58,320 --> 00:17:00,880
they're seeing and you complement that

469
00:16:59,600 --> 00:17:04,160
with virustotal

470
00:17:00,880 --> 00:17:04,959
you can get the useful sandboxing tools

471
00:17:04,160 --> 00:17:07,439
of app any

472
00:17:04,959 --> 00:17:10,319
as well as virustotal and maybe gather

473
00:17:07,439 --> 00:17:12,160
sources from url house

474
00:17:10,319 --> 00:17:13,839
i'll touch on threat intelligence real

475
00:17:12,160 --> 00:17:15,919
quick it

476
00:17:13,839 --> 00:17:17,198
can be useful but is oftentimes less

477
00:17:15,919 --> 00:17:20,319
actionable than

478
00:17:17,199 --> 00:17:23,360
the sources i just mentioned before

479
00:17:20,319 --> 00:17:25,199
i would also recommend studying open

480
00:17:23,359 --> 00:17:26,719
source signatures such as sigma

481
00:17:25,199 --> 00:17:29,120
there are a lot of threat hunters who

482
00:17:26,720 --> 00:17:31,520
use sigma as the basis

483
00:17:29,120 --> 00:17:33,439
of just kind of documenting how they are

484
00:17:31,520 --> 00:17:36,559
going to form

485
00:17:33,440 --> 00:17:38,080
queries maybe in other platforms you

486
00:17:36,559 --> 00:17:39,039
know if you have a sigma rule that you

487
00:17:38,080 --> 00:17:41,678
wrote you can use

488
00:17:39,039 --> 00:17:43,120
things like encoder to convert from

489
00:17:41,679 --> 00:17:46,960
sigma

490
00:17:43,120 --> 00:17:49,120
to kql for keyboard that we'll use later

491
00:17:46,960 --> 00:17:50,160
i would also say look at using automated

492
00:17:49,120 --> 00:17:53,760
testing suites

493
00:17:50,160 --> 00:17:55,919
like atomic red team other projects like

494
00:17:53,760 --> 00:17:58,720
low bass and gtfo bins are other great

495
00:17:55,919 --> 00:18:01,039
sources if you use

496
00:17:58,720 --> 00:18:02,880
windows living off the land binaries and

497
00:18:01,039 --> 00:18:05,280
scripts or little bass

498
00:18:02,880 --> 00:18:06,880
is a great repository by odd varbo at

499
00:18:05,280 --> 00:18:08,639
trusted sec that he has been building

500
00:18:06,880 --> 00:18:12,559
for years now

501
00:18:08,640 --> 00:18:15,360
it is a wonderful repository that i

502
00:18:12,559 --> 00:18:15,840
pretty much used from the get-go to

503
00:18:15,360 --> 00:18:19,678
search

504
00:18:15,840 --> 00:18:22,799
for to really understand

505
00:18:19,679 --> 00:18:23,840
what malicious uses of regis vr 32 look

506
00:18:22,799 --> 00:18:26,960
like

507
00:18:23,840 --> 00:18:28,000
malicious uses of front tll-32 all of

508
00:18:26,960 --> 00:18:29,760
these things you can find

509
00:18:28,000 --> 00:18:31,520
in that repository and more and if

510
00:18:29,760 --> 00:18:34,640
you're using the linux equivalent

511
00:18:31,520 --> 00:18:37,120
gtfo bins there is

512
00:18:34,640 --> 00:18:38,000
a plethora of resources you can use to

513
00:18:37,120 --> 00:18:40,719
hunt

514
00:18:38,000 --> 00:18:40,720
on linux

515
00:18:41,039 --> 00:18:44,080
something i would pretty much equate in

516
00:18:42,480 --> 00:18:47,360
the threat intelligence realm

517
00:18:44,080 --> 00:18:50,080
is minor attack framework it is

518
00:18:47,360 --> 00:18:50,719
useful if you're hunting for techniques

519
00:18:50,080 --> 00:18:53,600
um

520
00:18:50,720 --> 00:18:55,600
and if you're using something like olaf

521
00:18:53,600 --> 00:19:00,080
hartong's

522
00:18:55,600 --> 00:19:00,080
system on modular configuration

523
00:19:00,400 --> 00:19:06,720
that is all tagged with minor techniques

524
00:19:03,520 --> 00:19:07,440
and you can search for that depending on

525
00:19:06,720 --> 00:19:08,960
how

526
00:19:07,440 --> 00:19:10,720
you know your logs are parsed you can

527
00:19:08,960 --> 00:19:13,760
search by technique

528
00:19:10,720 --> 00:19:13,760
in all of your platforms

529
00:19:13,919 --> 00:19:18,160
so then let's talk about knowing normal

530
00:19:16,400 --> 00:19:18,559
someone i want to bring your attention

531
00:19:18,160 --> 00:19:20,799
to

532
00:19:18,559 --> 00:19:22,240
and whose resources i've used to even

533
00:19:20,799 --> 00:19:25,600
help develop this talk

534
00:19:22,240 --> 00:19:29,039
is samir over at elastic

535
00:19:25,600 --> 00:19:30,799
he oh i think since i've found him

536
00:19:29,039 --> 00:19:34,160
has been talking about knowing normal

537
00:19:30,799 --> 00:19:35,520
how to filter out and try and

538
00:19:34,160 --> 00:19:37,360
increase your detections and threat

539
00:19:35,520 --> 00:19:39,918
hunts by

540
00:19:37,360 --> 00:19:41,520
just filtering out and looking at

541
00:19:39,919 --> 00:19:43,039
startup processes in windows

542
00:19:41,520 --> 00:19:44,400
that's an easy thing you can do and

543
00:19:43,039 --> 00:19:45,120
we'll get into that in a little bit

544
00:19:44,400 --> 00:19:48,640
later

545
00:19:45,120 --> 00:19:49,439
as well but again this idea of

546
00:19:48,640 --> 00:19:52,080
baselining

547
00:19:49,440 --> 00:19:53,679
is fundamental to threat hunting as much

548
00:19:52,080 --> 00:19:55,840
as it is searching because if you are

549
00:19:53,679 --> 00:19:58,160
not able to filter out

550
00:19:55,840 --> 00:20:00,240
what is normal you're going to have a

551
00:19:58,160 --> 00:20:04,080
very hard time

552
00:20:00,240 --> 00:20:05,760
making this program effective

553
00:20:04,080 --> 00:20:07,760
so let's talk about building hunts there

554
00:20:05,760 --> 00:20:10,640
are

555
00:20:07,760 --> 00:20:11,600
three ways to kind of categorize how you

556
00:20:10,640 --> 00:20:13,280
can build hunts

557
00:20:11,600 --> 00:20:15,520
uh you can use automated testing

558
00:20:13,280 --> 00:20:18,080
platforms like atomic red team

559
00:20:15,520 --> 00:20:19,039
as well as build your own scripts and

560
00:20:18,080 --> 00:20:21,760
tests with

561
00:20:19,039 --> 00:20:23,039
low bass but then you're going to have

562
00:20:21,760 --> 00:20:24,000
to eventually get to a point where

563
00:20:23,039 --> 00:20:25,280
you're going to have to call on a

564
00:20:24,000 --> 00:20:27,760
professional

565
00:20:25,280 --> 00:20:28,399
so pen tests or any type of security

566
00:20:27,760 --> 00:20:30,480
test

567
00:20:28,400 --> 00:20:31,760
might be something you look into it's

568
00:20:30,480 --> 00:20:34,080
expensive

569
00:20:31,760 --> 00:20:35,440
but it may be worthwhile it's a better

570
00:20:34,080 --> 00:20:38,080
way to test your detections

571
00:20:35,440 --> 00:20:38,960
and know what artifacts are being left

572
00:20:38,080 --> 00:20:41,280
behind

573
00:20:38,960 --> 00:20:42,559
if you can you know get in communication

574
00:20:41,280 --> 00:20:46,158
with your pen tester and say hey

575
00:20:42,559 --> 00:20:48,559
we want to do an assumed breach on

576
00:20:46,159 --> 00:20:50,960
our you know on our hr department you

577
00:20:48,559 --> 00:20:53,120
know we'll have either a dropbox

578
00:20:50,960 --> 00:20:56,080
or we will set you up with an account on

579
00:20:53,120 --> 00:20:58,799
here and you can kind of go from there

580
00:20:56,080 --> 00:20:59,280
again it's it's a quick and dirty way to

581
00:20:58,799 --> 00:21:01,760
do it

582
00:20:59,280 --> 00:21:04,240
and it'll often you know take a week

583
00:21:01,760 --> 00:21:07,360
maybe two weeks at most

584
00:21:04,240 --> 00:21:08,880
and something you can say hey we want to

585
00:21:07,360 --> 00:21:10,959
test our detections

586
00:21:08,880 --> 00:21:12,559
for our throat hunting team and go from

587
00:21:10,960 --> 00:21:13,679
there because

588
00:21:12,559 --> 00:21:15,440
a lot of time you're gonna have to do

589
00:21:13,679 --> 00:21:18,159
this for compliance anyway so why not

590
00:21:15,440 --> 00:21:21,600
make use of it

591
00:21:18,159 --> 00:21:25,280
for your other teams now

592
00:21:21,600 --> 00:21:30,240
the most expensive way to really

593
00:21:25,280 --> 00:21:33,200
build hunts is around red team exercises

594
00:21:30,240 --> 00:21:34,240
i have heard in the past of red teamers

595
00:21:33,200 --> 00:21:36,480
getting caught

596
00:21:34,240 --> 00:21:38,240
by threat hunting teams because they're

597
00:21:36,480 --> 00:21:39,840
consistently looking for things

598
00:21:38,240 --> 00:21:42,080
that they know their edr and sim

599
00:21:39,840 --> 00:21:43,678
platforms are simply just not catching

600
00:21:42,080 --> 00:21:44,720
you know because correlation rules would

601
00:21:43,679 --> 00:21:47,360
be too complex

602
00:21:44,720 --> 00:21:49,120
or um maybe they don't have the kind of

603
00:21:47,360 --> 00:21:52,479
rapport with their edr vendor

604
00:21:49,120 --> 00:21:54,080
to say hey we want to detect this and

605
00:21:52,480 --> 00:21:55,679
you know maybe they're just not willing

606
00:21:54,080 --> 00:21:57,678
to do it at that point in time

607
00:21:55,679 --> 00:22:00,960
so having a throat hunting team can help

608
00:21:57,679 --> 00:22:02,400
remediate both of these problems

609
00:22:00,960 --> 00:22:04,640
so let's talk about what we should be

610
00:22:02,400 --> 00:22:05,520
searching let's talk about process

611
00:22:04,640 --> 00:22:08,080
creations because

612
00:22:05,520 --> 00:22:10,480
it is the bread and butter of most

613
00:22:08,080 --> 00:22:12,960
threat hunts

614
00:22:10,480 --> 00:22:13,760
if you are not going to deploy something

615
00:22:12,960 --> 00:22:15,840
like

616
00:22:13,760 --> 00:22:17,760
uh you know cis mod in your environment

617
00:22:15,840 --> 00:22:21,039
enabling command line auditing with

618
00:22:17,760 --> 00:22:21,520
event id 4688 is the first thing i would

619
00:22:21,039 --> 00:22:22,960
do

620
00:22:21,520 --> 00:22:25,520
there's a lot you can collect without

621
00:22:22,960 --> 00:22:28,159
having to raise your events per second

622
00:22:25,520 --> 00:22:29,760
and say something like a sim um and if

623
00:22:28,159 --> 00:22:32,559
you want to use a sam

624
00:22:29,760 --> 00:22:34,158
for threat hunting again it's not going

625
00:22:32,559 --> 00:22:36,080
to raise your eps

626
00:22:34,159 --> 00:22:38,559
and you can start flagging things like

627
00:22:36,080 --> 00:22:40,320
suspicious process creations

628
00:22:38,559 --> 00:22:42,000
suspicious service creations things like

629
00:22:40,320 --> 00:22:44,559
that are going to be useful to you

630
00:22:42,000 --> 00:22:45,679
um maybe not service creations for 46.88

631
00:22:44,559 --> 00:22:48,240
but at the very least

632
00:22:45,679 --> 00:22:49,520
you can start filtering out known and

633
00:22:48,240 --> 00:22:53,280
trusted applications

634
00:22:49,520 --> 00:22:55,760
with event id 4688 so let's talk about

635
00:22:53,280 --> 00:22:57,200
uh a simple persistence mechanism that's

636
00:22:55,760 --> 00:22:59,440
been used for years

637
00:22:57,200 --> 00:23:01,360
that is run and run run once registered

638
00:22:59,440 --> 00:23:04,400
keys

639
00:23:01,360 --> 00:23:07,039
malware to this date is still using this

640
00:23:04,400 --> 00:23:10,960
as a persistence mechanism for

641
00:23:07,039 --> 00:23:13,120
system reboots uh and user logons

642
00:23:10,960 --> 00:23:14,320
and they can start their process they

643
00:23:13,120 --> 00:23:18,080
can start their

644
00:23:14,320 --> 00:23:20,158
process as whoever based on

645
00:23:18,080 --> 00:23:22,080
which registry hive it's it's attempting

646
00:23:20,159 --> 00:23:25,039
to be ran out of

647
00:23:22,080 --> 00:23:26,480
let's talk about powershell it is

648
00:23:25,039 --> 00:23:30,000
quickly going out of style

649
00:23:26,480 --> 00:23:31,120
with our favor our favorite red teamers

650
00:23:30,000 --> 00:23:34,960
or pen testers

651
00:23:31,120 --> 00:23:38,639
because auditing aside from the

652
00:23:34,960 --> 00:23:40,640
powershell version two um is

653
00:23:38,640 --> 00:23:42,320
so much better than what it was when it

654
00:23:40,640 --> 00:23:45,360
first got started

655
00:23:42,320 --> 00:23:47,360
so however

656
00:23:45,360 --> 00:23:48,879
again commodity malware is still using

657
00:23:47,360 --> 00:23:50,959
it because it's just

658
00:23:48,880 --> 00:23:52,559
easier that way um you know maybe

659
00:23:50,960 --> 00:23:54,960
they'll hope they'll get an easy win

660
00:23:52,559 --> 00:23:56,639
and they won't get caught but you know

661
00:23:54,960 --> 00:23:59,120
you may not get so lucky with your

662
00:23:56,640 --> 00:24:00,880
with your local pentester let's talk

663
00:23:59,120 --> 00:24:06,000
about scheduled tasks and bits

664
00:24:00,880 --> 00:24:09,120
uh bits is a really remarkable way

665
00:24:06,000 --> 00:24:12,159
for malware to call back get updates

666
00:24:09,120 --> 00:24:12,559
and pull down new files in a way that

667
00:24:12,159 --> 00:24:14,080
maybe

668
00:24:12,559 --> 00:24:16,240
oftentimes people aren't even looking

669
00:24:14,080 --> 00:24:19,760
for it so

670
00:24:16,240 --> 00:24:20,480
it's really useful to look for signs of

671
00:24:19,760 --> 00:24:23,760
urls

672
00:24:20,480 --> 00:24:26,880
inside of bits jobs as well as

673
00:24:23,760 --> 00:24:30,840
look for urls in scheduled tasks

674
00:24:26,880 --> 00:24:32,960
i'll show you a mechanism for privileged

675
00:24:30,840 --> 00:24:35,840
escalation utilize

676
00:24:32,960 --> 00:24:37,440
by scheduled tasks um so there's a

677
00:24:35,840 --> 00:24:38,639
there's almost a one-two punch here with

678
00:24:37,440 --> 00:24:40,480
that because

679
00:24:38,640 --> 00:24:42,320
you know yeah you can use it as a

680
00:24:40,480 --> 00:24:43,039
persistence mechanism to maybe restart a

681
00:24:42,320 --> 00:24:45,279
job to

682
00:24:43,039 --> 00:24:46,640
let's say for a crypto miner i've seen

683
00:24:45,279 --> 00:24:49,840
that in the past

684
00:24:46,640 --> 00:24:52,000
um not just for

685
00:24:49,840 --> 00:24:54,158
privilege escalation but also for

686
00:24:52,000 --> 00:24:57,360
persistence

687
00:24:54,159 --> 00:25:00,400
so let's also look for unusual calls of

688
00:24:57,360 --> 00:25:03,199
2 volt cli you are looking

689
00:25:00,400 --> 00:25:05,440
at event id 7 for sysmon that is an

690
00:25:03,200 --> 00:25:09,440
image load

691
00:25:05,440 --> 00:25:12,840
you want to look for unusual

692
00:25:09,440 --> 00:25:16,159
images attempting to load volatility.dll

693
00:25:12,840 --> 00:25:16,559
lsas is going to call volatility dll but

694
00:25:16,159 --> 00:25:18,640
that's

695
00:25:16,559 --> 00:25:21,440
because that's what the local security

696
00:25:18,640 --> 00:25:21,440
service is going to do

697
00:25:21,760 --> 00:25:28,080
if you look for any applications in say

698
00:25:26,240 --> 00:25:30,000
in app data roaming that's something you

699
00:25:28,080 --> 00:25:32,000
can look into especially if it's an

700
00:25:30,000 --> 00:25:33,360
untrusted application

701
00:25:32,000 --> 00:25:34,880
uh so let's talk about group

702
00:25:33,360 --> 00:25:36,399
modifications real quick before we go

703
00:25:34,880 --> 00:25:39,840
back to path mismatching

704
00:25:36,400 --> 00:25:43,039
um if you have um maybe

705
00:25:39,840 --> 00:25:43,600
an iem person on your team who can help

706
00:25:43,039 --> 00:25:45,360
you

707
00:25:43,600 --> 00:25:48,000
keep track of what users are and what

708
00:25:45,360 --> 00:25:50,320
groups maybe you can see

709
00:25:48,000 --> 00:25:51,039
users being added or removed from groups

710
00:25:50,320 --> 00:25:54,799
that

711
00:25:51,039 --> 00:25:56,320
you know maybe were never specified in

712
00:25:54,799 --> 00:25:57,840
your procedures

713
00:25:56,320 --> 00:25:59,678
things like that can be things you can

714
00:25:57,840 --> 00:26:01,520
hunt for

715
00:25:59,679 --> 00:26:03,760
they're not always the most fun hunts

716
00:26:01,520 --> 00:26:05,279
but they can be done

717
00:26:03,760 --> 00:26:06,879
so i want to talk about path mismatching

718
00:26:05,279 --> 00:26:09,679
real quick

719
00:26:06,880 --> 00:26:10,240
very simple to understand you can have a

720
00:26:09,679 --> 00:26:13,520
list

721
00:26:10,240 --> 00:26:17,440
of files that you know

722
00:26:13,520 --> 00:26:20,960
are in c windows or in system 32

723
00:26:17,440 --> 00:26:21,760
that you can set negation statements to

724
00:26:20,960 --> 00:26:24,480
say

725
00:26:21,760 --> 00:26:24,799
i want every instance i've run dll32

726
00:26:24,480 --> 00:26:28,799
that

727
00:26:24,799 --> 00:26:31,760
is not in c windows or in c

728
00:26:28,799 --> 00:26:33,360
you know see windows system32 things

729
00:26:31,760 --> 00:26:34,640
like that are really easy ones as well

730
00:26:33,360 --> 00:26:37,760
because you know

731
00:26:34,640 --> 00:26:39,360
that in i can't even think of a good

732
00:26:37,760 --> 00:26:40,000
reason why that should happen but if you

733
00:26:39,360 --> 00:26:42,559
see that

734
00:26:40,000 --> 00:26:44,799
investigate it so i want to talk about

735
00:26:42,559 --> 00:26:48,799
gll search order hijacking

736
00:26:44,799 --> 00:26:52,400
it's a similar idea to path mismatching

737
00:26:48,799 --> 00:26:55,600
except for the fact that it is

738
00:26:52,400 --> 00:26:59,440
a untrusted dll

739
00:26:55,600 --> 00:27:03,039
uh being called by a trusted executable

740
00:26:59,440 --> 00:27:06,080
if a trusted a

741
00:27:03,039 --> 00:27:08,080
a trusted process is attempting to

742
00:27:06,080 --> 00:27:10,720
load maybe some sort of dll it's going

743
00:27:08,080 --> 00:27:13,360
to look first in its current directory

744
00:27:10,720 --> 00:27:15,039
and then its parent directory and then

745
00:27:13,360 --> 00:27:18,719
you know and

746
00:27:15,039 --> 00:27:21,200
whatever whatever is its path next

747
00:27:18,720 --> 00:27:22,320
so if it can set up the search order if

748
00:27:21,200 --> 00:27:24,240
malware can set it

749
00:27:22,320 --> 00:27:25,439
set itself up in such a way where a

750
00:27:24,240 --> 00:27:28,559
trusted

751
00:27:25,440 --> 00:27:30,399
um a trusted application can run its

752
00:27:28,559 --> 00:27:34,158
code

753
00:27:30,399 --> 00:27:36,320
it's an easy one so uh let's talk about

754
00:27:34,159 --> 00:27:38,960
kerberos um there is a

755
00:27:36,320 --> 00:27:40,000
great blog by trustedsec that goes over

756
00:27:38,960 --> 00:27:42,399
how to hunt

757
00:27:40,000 --> 00:27:44,399
for kerber roasting if you're not

758
00:27:42,399 --> 00:27:46,479
familiar with kerberos steam

759
00:27:44,399 --> 00:27:48,799
take time after this to go look it up

760
00:27:46,480 --> 00:27:51,440
it's very involved

761
00:27:48,799 --> 00:27:52,480
and i'm not even sure i fully understand

762
00:27:51,440 --> 00:27:53,840
it some days

763
00:27:52,480 --> 00:27:55,600
but it is something that if you use

764
00:27:53,840 --> 00:27:57,279
kerberos in your environment it's very

765
00:27:55,600 --> 00:27:58,480
easy to look for

766
00:27:57,279 --> 00:28:00,159
and something you can investigate

767
00:27:58,480 --> 00:28:00,960
because you if you use kerberos in your

768
00:28:00,159 --> 00:28:03,600
environment

769
00:28:00,960 --> 00:28:05,520
you can't stop it it's just how carperos

770
00:28:03,600 --> 00:28:07,279
works

771
00:28:05,520 --> 00:28:08,960
another one you can look for is unusual

772
00:28:07,279 --> 00:28:11,919
applications in app data

773
00:28:08,960 --> 00:28:13,760
again the reason i try and harp on app

774
00:28:11,919 --> 00:28:15,200
data so much is that if malware does not

775
00:28:13,760 --> 00:28:17,440
have high enough privileges

776
00:28:15,200 --> 00:28:19,360
maybe to drop itself in windows temp

777
00:28:17,440 --> 00:28:19,840
it's going to use app data roaming after

778
00:28:19,360 --> 00:28:23,760
local

779
00:28:19,840 --> 00:28:27,279
at that local low now let's talk about

780
00:28:23,760 --> 00:28:28,559
high volume dns queries something that

781
00:28:27,279 --> 00:28:30,720
was

782
00:28:28,559 --> 00:28:32,158
first taught to me when i was learning

783
00:28:30,720 --> 00:28:35,360
about threat hunting

784
00:28:32,159 --> 00:28:39,279
is high volume

785
00:28:35,360 --> 00:28:43,600
dns txt record requests

786
00:28:39,279 --> 00:28:43,600
you can form

787
00:28:43,679 --> 00:28:48,720
you can form whole scripts uh just

788
00:28:46,799 --> 00:28:50,559
by the records that you can get back

789
00:28:48,720 --> 00:28:54,720
from txt records because

790
00:28:50,559 --> 00:28:55,360
tc records can hold more data than your

791
00:28:54,720 --> 00:28:58,240
usual

792
00:28:55,360 --> 00:28:59,199
say a or double a record so you can use

793
00:28:58,240 --> 00:29:01,200
that to form

794
00:28:59,200 --> 00:29:02,240
powershell scripts or batch scripts you

795
00:29:01,200 --> 00:29:05,440
know or even

796
00:29:02,240 --> 00:29:07,600
if you want to pull down

797
00:29:05,440 --> 00:29:08,640
all of the data from an executable you

798
00:29:07,600 --> 00:29:10,480
know split into

799
00:29:08,640 --> 00:29:11,679
you know different parts you can drop

800
00:29:10,480 --> 00:29:15,200
that on a host

801
00:29:11,679 --> 00:29:16,559
execute it and go from there

802
00:29:15,200 --> 00:29:18,399
if you want to get into the deception

803
00:29:16,559 --> 00:29:19,918
realm and it's not going to break

804
00:29:18,399 --> 00:29:23,439
compliance

805
00:29:19,919 --> 00:29:26,480
i would say preserve one or two

806
00:29:23,440 --> 00:29:30,480
uh you old user accounts maybe

807
00:29:26,480 --> 00:29:33,120
with some faux

808
00:29:30,480 --> 00:29:34,799
security groups that you can set up

809
00:29:33,120 --> 00:29:37,918
searches for to say hey if this

810
00:29:34,799 --> 00:29:38,559
ever hits off we want to we want to be

811
00:29:37,919 --> 00:29:40,480
alerted

812
00:29:38,559 --> 00:29:42,720
you know we want to investigate

813
00:29:40,480 --> 00:29:46,880
immediately because that is a sign

814
00:29:42,720 --> 00:29:46,880
of a honey account being used

815
00:29:47,279 --> 00:29:52,880
and then we let's talk about processes

816
00:29:49,520 --> 00:29:55,039
making unusual network connections

817
00:29:52,880 --> 00:29:56,080
this is one of those things you can set

818
00:29:55,039 --> 00:29:58,720
up uh

819
00:29:56,080 --> 00:29:59,678
after you've baselined and set up

820
00:29:58,720 --> 00:30:01,600
metrics for

821
00:29:59,679 --> 00:30:04,320
say hey are there you know are there any

822
00:30:01,600 --> 00:30:06,399
processes across any of my hosts

823
00:30:04,320 --> 00:30:07,600
that are just hanging off more than

824
00:30:06,399 --> 00:30:10,080
usual

825
00:30:07,600 --> 00:30:11,520
i want to show you that in the dashboard

826
00:30:10,080 --> 00:30:13,840
for filtering

827
00:30:11,520 --> 00:30:15,360
and you can even curtail that towards

828
00:30:13,840 --> 00:30:16,240
searching for applications that

829
00:30:15,360 --> 00:30:18,240
shouldn't be making

830
00:30:16,240 --> 00:30:20,320
a lot of network connections say like

831
00:30:18,240 --> 00:30:22,399
cmd or powershell

832
00:30:20,320 --> 00:30:23,520
you know again depending on what is

833
00:30:22,399 --> 00:30:26,879
happening

834
00:30:23,520 --> 00:30:30,240
um so we'll go from there

835
00:30:26,880 --> 00:30:32,159
um and let's get started uh so

836
00:30:30,240 --> 00:30:34,320
um what i'm gonna show you is graphs for

837
00:30:32,159 --> 00:30:35,840
baselining and filtering as well as just

838
00:30:34,320 --> 00:30:37,120
kind of setting up your own hunting

839
00:30:35,840 --> 00:30:39,600
dashboard

840
00:30:37,120 --> 00:30:41,360
for things that you can see at a glance

841
00:30:39,600 --> 00:30:43,120
so searches we're going to do today

842
00:30:41,360 --> 00:30:45,918
we're going to look at traces of rdp

843
00:30:43,120 --> 00:30:46,639
tunneling a couple examples of privilege

844
00:30:45,919 --> 00:30:49,600
escalation

845
00:30:46,640 --> 00:30:50,799
as well as malicious use of mshta

846
00:30:49,600 --> 00:30:53,120
malicious powershell

847
00:30:50,799 --> 00:30:55,918
as well as regest vr32 i'm not going to

848
00:30:53,120 --> 00:30:58,639
go over searching by matter tag

849
00:30:55,919 --> 00:31:00,159
image or host just large due to the fact

850
00:30:58,640 --> 00:31:01,679
that once you have already seen the

851
00:31:00,159 --> 00:31:03,200
examples i'm going to show you

852
00:31:01,679 --> 00:31:05,840
you're going to be unable to do these on

853
00:31:03,200 --> 00:31:05,840
your own

854
00:31:06,080 --> 00:31:09,120
all right so the first thing i want to

855
00:31:07,600 --> 00:31:12,719
show you is an

856
00:31:09,120 --> 00:31:15,360
easy way to start filtering

857
00:31:12,720 --> 00:31:16,559
via search and then visualizing so i'm

858
00:31:15,360 --> 00:31:17,360
going to go through since i've already

859
00:31:16,559 --> 00:31:19,440
saved it so

860
00:31:17,360 --> 00:31:20,399
i'm going to go to discover i'm going to

861
00:31:19,440 --> 00:31:22,159
open up a search

862
00:31:20,399 --> 00:31:24,879
so the search i'm going to open up is

863
00:31:22,159 --> 00:31:28,320
processes making network connections

864
00:31:24,880 --> 00:31:30,240
so here is what the search is comprised

865
00:31:28,320 --> 00:31:32,399
of so i have an event code 3

866
00:31:30,240 --> 00:31:33,519
so that is specifically for processes

867
00:31:32,399 --> 00:31:37,760
with network connections

868
00:31:33,519 --> 00:31:40,399
in sysmon and it i am just going to

869
00:31:37,760 --> 00:31:42,240
for the sake of the search show process

870
00:31:40,399 --> 00:31:44,158
executable and event code

871
00:31:42,240 --> 00:31:46,320
that way in case we want to look at what

872
00:31:44,159 --> 00:31:47,360
the raw search data shows us we can take

873
00:31:46,320 --> 00:31:50,399
a look

874
00:31:47,360 --> 00:31:51,600
now now that i have only limited the

875
00:31:50,399 --> 00:31:55,120
events

876
00:31:51,600 --> 00:31:59,279
or in this case hits of just

877
00:31:55,120 --> 00:32:01,360
events with event code 3 i can save that

878
00:31:59,279 --> 00:32:02,799
i'll save that as processes making

879
00:32:01,360 --> 00:32:04,559
network connections

880
00:32:02,799 --> 00:32:05,679
and then what i'm going to do is i'm

881
00:32:04,559 --> 00:32:07,918
going to go back and i'm going to go to

882
00:32:05,679 --> 00:32:11,120
visualize

883
00:32:07,919 --> 00:32:13,120
so i have saved

884
00:32:11,120 --> 00:32:14,559
a visualization already but we're going

885
00:32:13,120 --> 00:32:16,639
to go through it together

886
00:32:14,559 --> 00:32:18,559
so i'm going to create a new

887
00:32:16,640 --> 00:32:20,240
visualization in a data table

888
00:32:18,559 --> 00:32:22,080
and then i'm going to click processes

889
00:32:20,240 --> 00:32:25,519
making network connections

890
00:32:22,080 --> 00:32:28,399
that way i can see there are 727 events

891
00:32:25,519 --> 00:32:29,519
where there are processes making network

892
00:32:28,399 --> 00:32:31,760
connections

893
00:32:29,519 --> 00:32:33,760
however they have collected so the first

894
00:32:31,760 --> 00:32:34,960
thing i'm going to do is split rows so

895
00:32:33,760 --> 00:32:36,640
split rows i want to

896
00:32:34,960 --> 00:32:38,159
click on terms and then i'm going to

897
00:32:36,640 --> 00:32:40,840
want i want to look for that field that

898
00:32:38,159 --> 00:32:44,640
we looked at earlier

899
00:32:40,840 --> 00:32:46,320
process executable

900
00:32:44,640 --> 00:32:47,919
and then i want to set up for five just

901
00:32:46,320 --> 00:32:50,080
for this and i want to split the table

902
00:32:47,919 --> 00:32:52,480
and i want to

903
00:32:50,080 --> 00:32:53,678
do columns actually i'm going to do our

904
00:32:52,480 --> 00:32:55,679
rows

905
00:32:53,679 --> 00:32:58,480
now columns will be fine and then i'll

906
00:32:55,679 --> 00:32:58,480
do terms again

907
00:32:58,960 --> 00:33:03,600
and then i want to have the agent

908
00:33:04,320 --> 00:33:10,158
name so that agent name is

909
00:33:07,519 --> 00:33:10,880
what is assigned by winlogbeat and is

910
00:33:10,159 --> 00:33:13,360
kept

911
00:33:10,880 --> 00:33:15,279
whenever it hits elasticsearch so i'm

912
00:33:13,360 --> 00:33:16,799
going to update that

913
00:33:15,279 --> 00:33:18,559
and here's what i have you know what i

914
00:33:16,799 --> 00:33:21,918
am going to keep it by rows

915
00:33:18,559 --> 00:33:24,559
all right so here's what we have

916
00:33:21,919 --> 00:33:25,679
we have century which is a with one of

917
00:33:24,559 --> 00:33:29,440
my hosts and then

918
00:33:25,679 --> 00:33:32,480
ms edge win 10. that's another one

919
00:33:29,440 --> 00:33:35,200
so i know that it looks like

920
00:33:32,480 --> 00:33:37,919
mattermost windows defender github

921
00:33:35,200 --> 00:33:40,159
desktop and service host hosts

922
00:33:37,919 --> 00:33:41,279
it looks like mattermost is the process

923
00:33:40,159 --> 00:33:42,080
that is making the most network

924
00:33:41,279 --> 00:33:45,840
connections

925
00:33:42,080 --> 00:33:49,519
on my host it looks like on

926
00:33:45,840 --> 00:33:50,240
ms edge110 it's service host so i could

927
00:33:49,519 --> 00:33:52,799
you know start

928
00:33:50,240 --> 00:33:55,039
filtering out for mountain most you know

929
00:33:52,799 --> 00:33:59,679
windows defender

930
00:33:55,039 --> 00:34:02,640
maybe zoom github desktop

931
00:33:59,679 --> 00:34:02,640
go to meeting

932
00:34:02,880 --> 00:34:06,960
and keep going that way and so as you

933
00:34:05,039 --> 00:34:08,560
can see there are a number of ways i can

934
00:34:06,960 --> 00:34:09,199
start filtering by this and i can even

935
00:34:08,560 --> 00:34:11,440
do this

936
00:34:09,199 --> 00:34:12,638
at the search level if i go back to

937
00:34:11,440 --> 00:34:15,679
discover

938
00:34:12,639 --> 00:34:19,599
and go by this so let's just say i'm

939
00:34:15,679 --> 00:34:22,240
looking for and not

940
00:34:19,599 --> 00:34:22,240
a message

941
00:34:22,800 --> 00:34:28,879
that contains anything what's the matter

942
00:34:26,079 --> 00:34:28,879
most in the name

943
00:34:32,719 --> 00:34:36,719
and it'll wipe everything out so if i

944
00:34:34,960 --> 00:34:39,520
save that

945
00:34:36,719 --> 00:34:41,520
save that and then i go back clear out

946
00:34:39,520 --> 00:34:46,079
these errors

947
00:34:41,520 --> 00:34:48,480
and then go back visualize

948
00:34:46,079 --> 00:34:49,760
and if i just get rid of all these so

949
00:34:48,480 --> 00:34:53,918
that it doesn't

950
00:34:49,760 --> 00:34:57,280
clog up my screen you'll notice

951
00:34:53,918 --> 00:34:59,279
that mattermost is nowhere to be seen so

952
00:34:57,280 --> 00:35:00,960
you can save these for later and i'm

953
00:34:59,280 --> 00:35:05,520
going to do that

954
00:35:00,960 --> 00:35:09,920
let's say hosts process

955
00:35:05,520 --> 00:35:12,560
making network connections

956
00:35:09,920 --> 00:35:13,520
and then i will save that and keep it

957
00:35:12,560 --> 00:35:17,119
for later

958
00:35:13,520 --> 00:35:18,079
it's just that simple okay so we are in

959
00:35:17,119 --> 00:35:20,640
the main menu

960
00:35:18,079 --> 00:35:22,640
of kibana and we've set up our stack

961
00:35:20,640 --> 00:35:24,879
we've ingested some logs

962
00:35:22,640 --> 00:35:26,560
and now we want to do some hunting so we

963
00:35:24,880 --> 00:35:27,599
go to discover

964
00:35:26,560 --> 00:35:30,078
and the first thing we're going to

965
00:35:27,599 --> 00:35:32,000
search is signs of rdp tumbling

966
00:35:30,079 --> 00:35:34,000
generally you're going to look for signs

967
00:35:32,000 --> 00:35:36,320
of two things existing

968
00:35:34,000 --> 00:35:37,119
in the logs one of which is signs that

969
00:35:36,320 --> 00:35:40,000
an ssh

970
00:35:37,119 --> 00:35:40,960
tunnel was created generally we can see

971
00:35:40,000 --> 00:35:44,079
this

972
00:35:40,960 --> 00:35:47,680
with various executions of plink

973
00:35:44,079 --> 00:35:50,480
and we can also see this with rdp

974
00:35:47,680 --> 00:35:51,839
traffic communicating over the loopback

975
00:35:50,480 --> 00:35:54,480
address space

976
00:35:51,839 --> 00:35:55,599
so if you want something to quickly

977
00:35:54,480 --> 00:35:57,839
search just to get

978
00:35:55,599 --> 00:35:58,880
you know maybe not the most efficient

979
00:35:57,839 --> 00:36:04,480
query time but

980
00:35:58,880 --> 00:36:07,520
you can look for 127.0.0.star

981
00:36:04,480 --> 00:36:11,599
and 33.89

982
00:36:07,520 --> 00:36:14,079
that way as long as these two

983
00:36:11,599 --> 00:36:14,800
entities exist in logs we can search for

984
00:36:14,079 --> 00:36:16,160
it

985
00:36:14,800 --> 00:36:17,920
so we're gonna search for the past 10

986
00:36:16,160 --> 00:36:18,560
years and it looks like we have a few

987
00:36:17,920 --> 00:36:21,119
hits

988
00:36:18,560 --> 00:36:23,119
so what i'm going to do is i'm going to

989
00:36:21,119 --> 00:36:24,720
hit command line in case we see an ssh

990
00:36:23,119 --> 00:36:26,240
channel being created and it looks like

991
00:36:24,720 --> 00:36:30,640
we see plink

992
00:36:26,240 --> 00:36:32,640
running and let's see the source ip

993
00:36:30,640 --> 00:36:34,240
and then this is the destination ip yep

994
00:36:32,640 --> 00:36:37,598
destination ip

995
00:36:34,240 --> 00:36:39,118
as well as destination port and source

996
00:36:37,599 --> 00:36:42,640
port

997
00:36:39,119 --> 00:36:46,560
so i'm going to move this over to

998
00:36:42,640 --> 00:36:46,560
near the source ip

999
00:36:46,800 --> 00:36:50,880
and so you can see an ssh tunnel being

1000
00:36:48,960 --> 00:36:52,960
created and it looks like there's going

1001
00:36:50,880 --> 00:36:53,920
to be some sort of callback

1002
00:36:52,960 --> 00:36:56,400
and it looks like this could be a

1003
00:36:53,920 --> 00:36:59,440
reverse connection to

1004
00:36:56,400 --> 00:37:02,880
um let's see 10 0

1005
00:36:59,440 --> 00:37:05,200
to 18. and there we have it you know

1006
00:37:02,880 --> 00:37:08,480
that's something easy you can search for

1007
00:37:05,200 --> 00:37:10,640
and if we wanted we could also

1008
00:37:08,480 --> 00:37:12,800
view the surrounding documents to see or

1009
00:37:10,640 --> 00:37:16,160
what around this time

1010
00:37:12,800 --> 00:37:18,560
might help us figure out um

1011
00:37:16,160 --> 00:37:20,240
you know what might have caused the

1012
00:37:18,560 --> 00:37:21,040
initial exploitation because at this

1013
00:37:20,240 --> 00:37:22,160
point

1014
00:37:21,040 --> 00:37:24,000
you know they're probably already

1015
00:37:22,160 --> 00:37:25,279
setting in for the post exploitation

1016
00:37:24,000 --> 00:37:26,800
stage

1017
00:37:25,280 --> 00:37:29,040
and trying to move laterally from pretty

1018
00:37:26,800 --> 00:37:29,920
much there and out all right so we'll go

1019
00:37:29,040 --> 00:37:34,400
from there

1020
00:37:29,920 --> 00:37:37,040
on to our next demo

1021
00:37:34,400 --> 00:37:38,800
we talked earlier about using scheduled

1022
00:37:37,040 --> 00:37:41,279
tasks for persistence

1023
00:37:38,800 --> 00:37:43,359
but i also failed to mention that

1024
00:37:41,280 --> 00:37:44,560
scheduled tasks can also be used for

1025
00:37:43,359 --> 00:37:46,000
privilege escalation that's what we're

1026
00:37:44,560 --> 00:37:49,119
going to look at now

1027
00:37:46,000 --> 00:37:52,320
so i have a search that says show me

1028
00:37:49,119 --> 00:37:56,320
show me any logs where uh the task name

1029
00:37:52,320 --> 00:37:58,400
exists and i set a field

1030
00:37:56,320 --> 00:38:00,800
uh i set a column to show me all the

1031
00:37:58,400 --> 00:38:02,400
task names that we have in here so

1032
00:38:00,800 --> 00:38:04,400
we'll also look at look at the event id

1033
00:38:02,400 --> 00:38:06,560
as well so i see you have a couple of

1034
00:38:04,400 --> 00:38:09,839
4698 events

1035
00:38:06,560 --> 00:38:11,759
4702 and i'm really concerned with these

1036
00:38:09,839 --> 00:38:14,078
4698 events

1037
00:38:11,760 --> 00:38:15,200
so i have four events so one of which is

1038
00:38:14,079 --> 00:38:16,960
full powers tasks

1039
00:38:15,200 --> 00:38:19,040
i don't know anything about that let's

1040
00:38:16,960 --> 00:38:19,839
look at orca update orchestrator i know

1041
00:38:19,040 --> 00:38:22,720
about that

1042
00:38:19,839 --> 00:38:23,599
add these three okay well let's take a

1043
00:38:22,720 --> 00:38:26,480
look here

1044
00:38:23,599 --> 00:38:28,079
so i have the subject user who created

1045
00:38:26,480 --> 00:38:31,839
the task

1046
00:38:28,079 --> 00:38:33,760
looks like it is local service let's

1047
00:38:31,839 --> 00:38:35,680
take a look at what the content says

1048
00:38:33,760 --> 00:38:37,119
so i'm usually concerned about what it's

1049
00:38:35,680 --> 00:38:40,319
executing so i see

1050
00:38:37,119 --> 00:38:44,400
exec the command

1051
00:38:40,320 --> 00:38:45,119
is referencing public users tools token

1052
00:38:44,400 --> 00:38:46,960
manip

1053
00:38:45,119 --> 00:38:48,400
so i assume that's token manipulation

1054
00:38:46,960 --> 00:38:50,880
and then it's tempting to execute full

1055
00:38:48,400 --> 00:38:52,160
powers.exe

1056
00:38:50,880 --> 00:38:53,599
well i don't know anything about that

1057
00:38:52,160 --> 00:38:55,440
per se so let's look at what else we

1058
00:38:53,599 --> 00:38:58,560
have up here so i'm going to look at

1059
00:38:55,440 --> 00:38:58,560
the principles

1060
00:38:58,640 --> 00:39:02,240
it tells us the local service account

1061
00:39:00,880 --> 00:39:04,400
and i'm going to look at these required

1062
00:39:02,240 --> 00:39:06,959
privileges real quick so i see

1063
00:39:04,400 --> 00:39:07,920
assigned primary token privilege audit

1064
00:39:06,960 --> 00:39:10,400
privilege

1065
00:39:07,920 --> 00:39:13,040
change notify create global privilege

1066
00:39:10,400 --> 00:39:16,320
impersonate privilege

1067
00:39:13,040 --> 00:39:19,599
and working side privilege so

1068
00:39:16,320 --> 00:39:21,359
i have a feeling this is malicious and

1069
00:39:19,599 --> 00:39:21,839
i'm sure if i was able to get it get my

1070
00:39:21,359 --> 00:39:24,078
hands

1071
00:39:21,839 --> 00:39:25,279
on this executable that might prove to

1072
00:39:24,079 --> 00:39:28,320
do that

1073
00:39:25,280 --> 00:39:31,359
the reason i believe that is that local

1074
00:39:28,320 --> 00:39:32,640
service accounts generally do not have

1075
00:39:31,359 --> 00:39:34,799
high privileges they have some

1076
00:39:32,640 --> 00:39:36,240
privileges but by design they are meant

1077
00:39:34,800 --> 00:39:38,480
to be restricted

1078
00:39:36,240 --> 00:39:39,359
when you add these privileges you start

1079
00:39:38,480 --> 00:39:43,119
enabling them

1080
00:39:39,359 --> 00:39:44,880
to do more so

1081
00:39:43,119 --> 00:39:46,400
if you can at least create a scheduled

1082
00:39:44,880 --> 00:39:48,240
task as local service maybe you can

1083
00:39:46,400 --> 00:39:52,480
start a process that will

1084
00:39:48,240 --> 00:39:55,520
require certain privileges to

1085
00:39:52,480 --> 00:39:57,359
enable and enable and elevate that user

1086
00:39:55,520 --> 00:39:58,880
to do more than it was originally

1087
00:39:57,359 --> 00:40:00,078
intended to do

1088
00:39:58,880 --> 00:40:03,200
so i know there's some privilege

1089
00:40:00,079 --> 00:40:06,480
escalation going on here but what about

1090
00:40:03,200 --> 00:40:07,680
um maybe some credential dumping so i

1091
00:40:06,480 --> 00:40:10,800
want to go over to

1092
00:40:07,680 --> 00:40:13,520
a different index i'm going to clear out

1093
00:40:10,800 --> 00:40:15,680
i'm just going to start fresh so i'm

1094
00:40:13,520 --> 00:40:17,280
going to give her my task name

1095
00:40:15,680 --> 00:40:19,839
and i'll get rid of this because this is

1096
00:40:17,280 --> 00:40:21,200
not in there

1097
00:40:19,839 --> 00:40:22,640
so i'm going to look for is what we

1098
00:40:21,200 --> 00:40:24,078
mentioned earlier so let's talk about an

1099
00:40:22,640 --> 00:40:28,400
image load

1100
00:40:24,079 --> 00:40:31,599
to false cli dot dll

1101
00:40:28,400 --> 00:40:34,800
so i see this maybe i'm looking for uh

1102
00:40:31,599 --> 00:40:36,800
vault cli is there

1103
00:40:34,800 --> 00:40:38,480
anything that exists in the logs and

1104
00:40:36,800 --> 00:40:41,520
there is

1105
00:40:38,480 --> 00:40:43,359
let's take a look what process

1106
00:40:41,520 --> 00:40:47,200
was it credentialed philippines so it

1107
00:40:43,359 --> 00:40:50,319
looks like powershell attempted to

1108
00:40:47,200 --> 00:40:53,118
load this now oftentimes this is

1109
00:40:50,319 --> 00:40:54,720
a bit more plentiful depending on what's

1110
00:40:53,119 --> 00:40:58,960
happening on the host

1111
00:40:54,720 --> 00:40:59,279
but i want to see the process id of this

1112
00:40:58,960 --> 00:41:00,800
so

1113
00:40:59,280 --> 00:41:02,160
i'm going to go up here i want to filter

1114
00:41:00,800 --> 00:41:04,400
for that value so we know that already

1115
00:41:02,160 --> 00:41:07,279
exists but i want to clear out

1116
00:41:04,400 --> 00:41:10,000
the image load and just look for the

1117
00:41:07,280 --> 00:41:10,000
process id

1118
00:41:10,400 --> 00:41:14,079
and it looks like we have a couple of

1119
00:41:11,920 --> 00:41:16,560
hits and

1120
00:41:14,079 --> 00:41:18,800
these appear to be let's see what kind

1121
00:41:16,560 --> 00:41:20,720
of event ids these are

1122
00:41:18,800 --> 00:41:23,920
so i have an event code let's just go to

1123
00:41:20,720 --> 00:41:23,919
the columns and see what we have

1124
00:41:25,359 --> 00:41:31,440
it's like a 1 12 and a 7. so let's just

1125
00:41:28,160 --> 00:41:31,440
start the one and see what we got

1126
00:41:31,760 --> 00:41:37,440
let's go to the command line and i just

1127
00:41:34,240 --> 00:41:37,439
like to see all these at once

1128
00:41:37,599 --> 00:41:42,240
well it looks like yeah it looks like

1129
00:41:40,240 --> 00:41:45,520
there was a download string

1130
00:41:42,240 --> 00:41:47,598
from the power supply repo to invoke me

1131
00:41:45,520 --> 00:41:50,000
me cats and dump the creds

1132
00:41:47,599 --> 00:41:52,000
and i have a feeling this may be an

1133
00:41:50,000 --> 00:41:55,680
image load

1134
00:41:52,000 --> 00:41:57,119
that we looked for earlier

1135
00:41:55,680 --> 00:42:03,839
so let's see if we can look at what

1136
00:41:57,119 --> 00:42:03,839
other images were loaded

1137
00:42:06,720 --> 00:42:13,520
so mpv client

1138
00:42:10,480 --> 00:42:16,160
okay here we go so sam lib okay so

1139
00:42:13,520 --> 00:42:18,240
that's for all the local creds as well

1140
00:42:16,160 --> 00:42:20,560
as about cli

1141
00:42:18,240 --> 00:42:21,439
looks like smart cards human interface

1142
00:42:20,560 --> 00:42:24,480
devices

1143
00:42:21,440 --> 00:42:27,280
and the crypt yellow all right so we

1144
00:42:24,480 --> 00:42:28,800
already know there's been activity of

1145
00:42:27,280 --> 00:42:30,319
privilege escalation as well as

1146
00:42:28,800 --> 00:42:32,079
credential dumping that may

1147
00:42:30,319 --> 00:42:34,160
potentially be used for privilege

1148
00:42:32,079 --> 00:42:37,359
escalation in the future maybe

1149
00:42:34,160 --> 00:42:40,720
for a user who has domain admin rights

1150
00:42:37,359 --> 00:42:42,720
on those hosts the last

1151
00:42:40,720 --> 00:42:44,879
three examples we're going to look at is

1152
00:42:42,720 --> 00:42:48,319
a combined

1153
00:42:44,880 --> 00:42:51,760
use of malicious uh execution of

1154
00:42:48,319 --> 00:42:55,359
powershell regis vr32

1155
00:42:51,760 --> 00:42:58,640
and mshta.exe

1156
00:42:55,359 --> 00:43:01,759
so what i'm attempting to look for

1157
00:42:58,640 --> 00:43:05,200
is maybe uh child

1158
00:43:01,760 --> 00:43:07,920
processes of powershell

1159
00:43:05,200 --> 00:43:08,720
but first i guess we better look at

1160
00:43:07,920 --> 00:43:12,160
maybe

1161
00:43:08,720 --> 00:43:14,560
just usage of mshd that you see so let's

1162
00:43:12,160 --> 00:43:17,920
look at message

1163
00:43:14,560 --> 00:43:17,920
and mshda

1164
00:43:19,119 --> 00:43:23,280
let's just see if it exists anywhere in

1165
00:43:20,800 --> 00:43:23,280
our logs

1166
00:43:23,359 --> 00:43:28,640
and it looks like we have quite a few so

1167
00:43:26,079 --> 00:43:29,920
we have some process creations 4688 and

1168
00:43:28,640 --> 00:43:33,680
we have some

1169
00:43:29,920 --> 00:43:35,040
registry edits 5158

1170
00:43:33,680 --> 00:43:36,879
let's see if i can remind myself what

1171
00:43:35,040 --> 00:43:37,599
that one is so it's a filtering platform

1172
00:43:36,880 --> 00:43:39,280
it looks like

1173
00:43:37,599 --> 00:43:41,839
mshta made some sort of network

1174
00:43:39,280 --> 00:43:41,839
connection

1175
00:43:42,560 --> 00:43:48,640
okay so we have any idea where

1176
00:43:46,400 --> 00:43:48,640
not

1177
00:43:50,720 --> 00:43:58,240
image load okay so

1178
00:43:55,040 --> 00:44:01,200
i say something to use a croj okay that

1179
00:43:58,240 --> 00:44:03,439
tells us a couple of things

1180
00:44:01,200 --> 00:44:06,000
okay so let's start looking at these

1181
00:44:03,440 --> 00:44:06,000
command lines

1182
00:44:07,440 --> 00:44:11,119
all right so doesn't that there's too

1183
00:44:08,880 --> 00:44:13,839
much available to us

1184
00:44:11,119 --> 00:44:16,400
maybe that's not the field we need let's

1185
00:44:13,839 --> 00:44:16,400
look at it

1186
00:44:17,680 --> 00:44:23,839
all right yep this is just a different

1187
00:44:20,640 --> 00:44:23,839
field we needed to use

1188
00:44:24,240 --> 00:44:27,279
and that's much better all right so

1189
00:44:25,440 --> 00:44:30,400
let's take a look so we see

1190
00:44:27,280 --> 00:44:32,400
cmd attempted the lodge calc uh there

1191
00:44:30,400 --> 00:44:37,839
were a couple of hda files put

1192
00:44:32,400 --> 00:44:37,839
in the startup folder looks like

1193
00:44:37,920 --> 00:44:41,599
an atomic test was ran

1194
00:44:42,400 --> 00:44:45,599
all right so this is probably the first

1195
00:44:43,839 --> 00:44:49,279
thing we want to look at so we look at

1196
00:44:45,599 --> 00:44:52,400
mshda is attempting to launch just some

1197
00:44:49,280 --> 00:44:53,119
raw javascript uh attempting to reach

1198
00:44:52,400 --> 00:44:55,200
out to

1199
00:44:53,119 --> 00:44:57,599
github user content red canary atomic

1200
00:44:55,200 --> 00:44:57,598
red team

1201
00:44:58,200 --> 00:45:05,200
t1059.001 so it looks like

1202
00:45:01,440 --> 00:45:07,599
the downloaded sct file

1203
00:45:05,200 --> 00:45:08,640
and then see a couple other things and

1204
00:45:07,599 --> 00:45:12,480
then we see yep

1205
00:45:08,640 --> 00:45:18,720
that process creation for mshga

1206
00:45:12,480 --> 00:45:20,640
exe and then yep execute and close

1207
00:45:18,720 --> 00:45:22,160
there you always see powershell

1208
00:45:20,640 --> 00:45:22,720
attempting to write host foreground

1209
00:45:22,160 --> 00:45:26,078
color

1210
00:45:22,720 --> 00:45:28,959
okay i wonder if the parent process was

1211
00:45:26,079 --> 00:45:31,760
mshda

1212
00:45:28,960 --> 00:45:35,040
yup parent process name msha so mshta

1213
00:45:31,760 --> 00:45:35,040
was even launched in powershell

1214
00:45:36,400 --> 00:45:39,040
back up here

1215
00:45:40,560 --> 00:45:44,720
keep going yeah i mean we obviously say

1216
00:45:43,359 --> 00:45:48,960
something has gone awry

1217
00:45:44,720 --> 00:45:52,240
and we see even msh launch cmd.exe

1218
00:45:48,960 --> 00:45:54,240
okay so that's definitely

1219
00:45:52,240 --> 00:45:56,240
one thing we can look at so maybe we can

1220
00:45:54,240 --> 00:46:00,000
start with the parent process because

1221
00:45:56,240 --> 00:46:05,040
i believe if we looked it looks like

1222
00:46:00,000 --> 00:46:05,040
parent the parent process was powershell

1223
00:46:05,440 --> 00:46:15,839
now let's see if we can get the parent

1224
00:46:08,960 --> 00:46:15,839
pid now i'm hoping

1225
00:46:20,560 --> 00:46:25,119
okay so that's the command line so let's

1226
00:46:23,839 --> 00:46:28,960
see if we can filter

1227
00:46:25,119 --> 00:46:28,960
for this nope not that

1228
00:46:36,640 --> 00:46:43,839
not that one sorry down

1229
00:46:47,920 --> 00:46:53,040
that's going through all the fields that

1230
00:46:49,040 --> 00:46:53,040
i don't need parent process name okay

1231
00:46:55,680 --> 00:46:59,200
well it looks like we're just gonna have

1232
00:46:57,040 --> 00:47:01,440
to start here and start and look for

1233
00:46:59,200 --> 00:47:01,439
that

1234
00:47:02,720 --> 00:47:06,879
and we'll just get rid of our query and

1235
00:47:04,480 --> 00:47:06,880
start there

1236
00:47:08,240 --> 00:47:11,520
now i don't generally recommend doing

1237
00:47:10,880 --> 00:47:14,000
this

1238
00:47:11,520 --> 00:47:15,119
just because you know i'm writing this

1239
00:47:14,000 --> 00:47:17,440
in a test environment

1240
00:47:15,119 --> 00:47:19,520
if you have you know hundreds of hosts

1241
00:47:17,440 --> 00:47:20,960
this may take a while

1242
00:47:19,520 --> 00:47:23,359
but it looks like we already see we

1243
00:47:20,960 --> 00:47:26,400
already get a couple of hits we have

1244
00:47:23,359 --> 00:47:28,558
invoke bloodhound yeah that's

1245
00:47:26,400 --> 00:47:29,920
remote download of sharphound into

1246
00:47:28,559 --> 00:47:31,680
memory

1247
00:47:29,920 --> 00:47:35,280
followed by an execution of the script i

1248
00:47:31,680 --> 00:47:38,399
would say that's definitely malicious

1249
00:47:35,280 --> 00:47:40,480
keep going we see there's a

1250
00:47:38,400 --> 00:47:42,000
power split attempting to be ran there's

1251
00:47:40,480 --> 00:47:44,400
that credential dump we looked at

1252
00:47:42,000 --> 00:47:44,400
earlier

1253
00:47:45,280 --> 00:47:47,920
invoke

1254
00:47:48,559 --> 00:47:53,440
bypass okay

1255
00:47:51,599 --> 00:47:54,640
now let's see if there's any because we

1256
00:47:53,440 --> 00:47:57,040
said we combined this

1257
00:47:54,640 --> 00:47:58,720
and let's see if there's anything where

1258
00:47:57,040 --> 00:48:06,160
reg spr32 is being

1259
00:47:58,720 --> 00:48:09,839
executed so message

1260
00:48:06,160 --> 00:48:11,040
just start like that and it looks like

1261
00:48:09,839 --> 00:48:15,279
we have three hits

1262
00:48:11,040 --> 00:48:18,000
so we have again an atomic red team test

1263
00:48:15,280 --> 00:48:18,720
where it's attempting to call an sct

1264
00:48:18,000 --> 00:48:22,000
file that

1265
00:48:18,720 --> 00:48:24,720
exists on the file system and then

1266
00:48:22,000 --> 00:48:24,720
we have

1267
00:48:25,200 --> 00:48:29,439
yeah https taking the call to a url on

1268
00:48:28,640 --> 00:48:35,040
github

1269
00:48:29,440 --> 00:48:41,760
as well as attempting to launch

1270
00:48:35,040 --> 00:48:41,759
cmd it's a little hunch regis pr 32

1271
00:48:41,920 --> 00:48:45,680
all right so we see already that there

1272
00:48:43,680 --> 00:48:46,640
is enough for us to work with to know

1273
00:48:45,680 --> 00:48:50,319
that

1274
00:48:46,640 --> 00:48:52,480
there is a uh power shell is being

1275
00:48:50,319 --> 00:48:56,880
utilized maliciously in the system

1276
00:48:52,480 --> 00:48:57,920
as well as mshda and regis vr32

1277
00:48:56,880 --> 00:49:00,559
all right so the last thing i want to

1278
00:48:57,920 --> 00:49:02,240
show you is the dashboards

1279
00:49:00,559 --> 00:49:03,760
that we can make from all the

1280
00:49:02,240 --> 00:49:04,720
accumulated safe searches that we've

1281
00:49:03,760 --> 00:49:07,280
done

1282
00:49:04,720 --> 00:49:08,480
so this is the hunting dashboard uh so

1283
00:49:07,280 --> 00:49:12,079
you can see we have

1284
00:49:08,480 --> 00:49:12,720
malicious use of regis vr32 let's see we

1285
00:49:12,079 --> 00:49:15,760
have

1286
00:49:12,720 --> 00:49:17,359
suspicious use of mshta we can see

1287
00:49:15,760 --> 00:49:19,839
that log over here that we looked at

1288
00:49:17,359 --> 00:49:23,680
earlier as well as

1289
00:49:19,839 --> 00:49:25,599
the use of any loopback addresses as

1290
00:49:23,680 --> 00:49:28,640
well as port 3389

1291
00:49:25,599 --> 00:49:32,640
we see that

1292
00:49:28,640 --> 00:49:34,879
see that in a command line as well and

1293
00:49:32,640 --> 00:49:36,000
just as a note this is these are not all

1294
00:49:34,880 --> 00:49:37,599
the same logs

1295
00:49:36,000 --> 00:49:39,839
um this is just from a simple search

1296
00:49:37,599 --> 00:49:41,839
that we saved and anytime you see this

1297
00:49:39,839 --> 00:49:42,720
being used in a log you can investigate

1298
00:49:41,839 --> 00:49:45,599
it pretty easily

1299
00:49:42,720 --> 00:49:47,520
and see okay you know what was imported

1300
00:49:45,599 --> 00:49:50,880
what was the image

1301
00:49:47,520 --> 00:49:52,880
and then we can also look at

1302
00:49:50,880 --> 00:49:54,079
this complex search we built earlier and

1303
00:49:52,880 --> 00:49:57,040
you can look at the

1304
00:49:54,079 --> 00:49:59,680
record of whatever's being used you can

1305
00:49:57,040 --> 00:50:02,800
also take a look at

1306
00:49:59,680 --> 00:50:06,960
the raw data that was acute

1307
00:50:02,800 --> 00:50:09,359
that we have from the powershell logs

1308
00:50:06,960 --> 00:50:13,119
now to quickly move over i'll show you

1309
00:50:09,359 --> 00:50:16,319
the filtering dashboard

1310
00:50:13,119 --> 00:50:20,160
now i built some of these searches in

1311
00:50:16,319 --> 00:50:21,920
another time but as you can see i have

1312
00:50:20,160 --> 00:50:24,078
host process and every connection so you

1313
00:50:21,920 --> 00:50:26,160
this can be filtered to say okay you

1314
00:50:24,079 --> 00:50:28,000
know maybe i want to add

1315
00:50:26,160 --> 00:50:29,359
processes with network connections in my

1316
00:50:28,000 --> 00:50:31,359
hunting dashboard

1317
00:50:29,359 --> 00:50:32,558
but you know maybe i can see okay i know

1318
00:50:31,359 --> 00:50:34,799
that windows defender

1319
00:50:32,559 --> 00:50:36,319
i can ignore that it hits 46 times maybe

1320
00:50:34,800 --> 00:50:37,839
not such a big deal

1321
00:50:36,319 --> 00:50:40,160
but then i can also see things like

1322
00:50:37,839 --> 00:50:42,000
sysmon i attempted to make a network

1323
00:50:40,160 --> 00:50:45,520
connection as well as service host

1324
00:50:42,000 --> 00:50:47,359
and then sih client and you can see the

1325
00:50:45,520 --> 00:50:48,160
most popular command lines which in this

1326
00:50:47,359 --> 00:50:50,078
case is

1327
00:50:48,160 --> 00:50:52,640
pretty clear out of out of all the hosts

1328
00:50:50,079 --> 00:50:54,559
that i have uh reporting back

1329
00:50:52,640 --> 00:50:56,160
on hosts with that command line is the

1330
00:50:54,559 --> 00:50:58,880
most popular

1331
00:50:56,160 --> 00:51:00,240
followed by none so we can probably

1332
00:50:58,880 --> 00:51:03,599
filter that out

1333
00:51:00,240 --> 00:51:06,799
and then the u.s notification

1334
00:51:03,599 --> 00:51:07,920
some nvidia stuff and then so on and so

1335
00:51:06,800 --> 00:51:10,079
forth

1336
00:51:07,920 --> 00:51:13,200
you can also filter by most popular

1337
00:51:10,079 --> 00:51:14,960
events so 4673

1338
00:51:13,200 --> 00:51:17,200
privilege requests and then you can also

1339
00:51:14,960 --> 00:51:18,559
see the most popular domains and you can

1340
00:51:17,200 --> 00:51:21,040
you know filter that out as well maybe

1341
00:51:18,559 --> 00:51:22,559
you want to ignore github.com

1342
00:51:21,040 --> 00:51:24,319
not exactly recommended because a lot of

1343
00:51:22,559 --> 00:51:27,680
open source security tools are

1344
00:51:24,319 --> 00:51:30,558
utilized at github

1345
00:51:27,680 --> 00:51:33,359
so that is the dashboards you can create

1346
00:51:30,559 --> 00:51:35,680
so you can get all the information

1347
00:51:33,359 --> 00:51:38,960
that you are looking for at a glance and

1348
00:51:35,680 --> 00:51:42,240
you can start filtering from there

1349
00:51:38,960 --> 00:51:43,119
all right so some resources that i can

1350
00:51:42,240 --> 00:51:46,000
provide

1351
00:51:43,119 --> 00:51:48,160
and at least show you guys for future

1352
00:51:46,000 --> 00:51:50,400
reading

1353
00:51:48,160 --> 00:51:53,200
tyler hudec at trustedsec he is the

1354
00:51:50,400 --> 00:51:55,920
practice lead for incident response

1355
00:51:53,200 --> 00:51:56,319
and does a lot of threat hunting as well

1356
00:51:55,920 --> 00:51:59,040
uh

1357
00:51:56,319 --> 00:52:00,800
this blog was very useful it came at a

1358
00:51:59,040 --> 00:52:02,960
very good time

1359
00:52:00,800 --> 00:52:04,319
to talk about what types of threat hunts

1360
00:52:02,960 --> 00:52:07,119
you can do

1361
00:52:04,319 --> 00:52:09,440
and what you might need to talk about

1362
00:52:07,119 --> 00:52:13,119
samir's evtx attacking

1363
00:52:09,440 --> 00:52:14,240
attack samples the logs for privilege

1364
00:52:13,119 --> 00:52:18,240
escalation rdp

1365
00:52:14,240 --> 00:52:20,720
tunneling red svr32

1366
00:52:18,240 --> 00:52:22,959
uh all of that was provided from his

1367
00:52:20,720 --> 00:52:25,759
repository by his permission

1368
00:52:22,960 --> 00:52:27,760
and he has a lot of great slide decks

1369
00:52:25,760 --> 00:52:30,160
and other repositories that

1370
00:52:27,760 --> 00:52:32,160
he is updating he's very busy and always

1371
00:52:30,160 --> 00:52:35,440
working on something

1372
00:52:32,160 --> 00:52:36,960
the lowbass project and atomic red team

1373
00:52:35,440 --> 00:52:39,440
are two projects i would encourage

1374
00:52:36,960 --> 00:52:41,200
everyone to go read and study on

1375
00:52:39,440 --> 00:52:42,880
if you want to do threat hunting or if

1376
00:52:41,200 --> 00:52:44,640
you just want to try and grow your

1377
00:52:42,880 --> 00:52:48,079
knowledge base

1378
00:52:44,640 --> 00:52:49,680
for detection building uh my twitter is

1379
00:52:48,079 --> 00:52:52,800
at the hacker 4chan

1380
00:52:49,680 --> 00:52:54,240
uh i am always very busy on there

1381
00:52:52,800 --> 00:52:55,920
it's either feast or famine i'm either

1382
00:52:54,240 --> 00:52:58,000
tweeting a lot or i'm tweeting or not

1383
00:52:55,920 --> 00:52:59,359
tweeting at all

1384
00:52:58,000 --> 00:53:02,079
but i want to talk about the hulk

1385
00:52:59,359 --> 00:53:05,640
project as well as my own project

1386
00:53:02,079 --> 00:53:08,640
elk hunt uh hulk is a

1387
00:53:05,640 --> 00:53:12,480
extremely versatile and

1388
00:53:08,640 --> 00:53:16,000
very creative and very useful

1389
00:53:12,480 --> 00:53:18,400
project for threat hunting

1390
00:53:16,000 --> 00:53:20,319
on the elk stack this project has been

1391
00:53:18,400 --> 00:53:24,000
in development for quite a while and it

1392
00:53:20,319 --> 00:53:27,680
has grown from

1393
00:53:24,000 --> 00:53:28,640
very early stages and it has come a very

1394
00:53:27,680 --> 00:53:32,078
long way

1395
00:53:28,640 --> 00:53:35,920
um it incorporates things like playbooks

1396
00:53:32,079 --> 00:53:37,760
uh if you've ever heard of mordor um

1397
00:53:35,920 --> 00:53:39,200
roberto and his brother are doing a lot

1398
00:53:37,760 --> 00:53:42,240
of great work over there and

1399
00:53:39,200 --> 00:53:45,919
are making a wonderful project

1400
00:53:42,240 --> 00:53:50,240
a shameless plug for elk hunt it is

1401
00:53:45,920 --> 00:53:53,680
and was inspired by the hulk project

1402
00:53:50,240 --> 00:53:54,160
but i wanted to try and try and strip

1403
00:53:53,680 --> 00:53:57,200
down

1404
00:53:54,160 --> 00:54:00,558
as much as i could but still keep

1405
00:53:57,200 --> 00:54:03,839
the bare bones of what makes health

1406
00:54:00,559 --> 00:54:07,760
so useful and that is the up stack

1407
00:54:03,839 --> 00:54:10,160
that is shipping and that is

1408
00:54:07,760 --> 00:54:11,520
filtering and trying to make use of

1409
00:54:10,160 --> 00:54:14,960
visualizers

1410
00:54:11,520 --> 00:54:18,640
and trying to offer

1411
00:54:14,960 --> 00:54:20,079
as many resources to people who want to

1412
00:54:18,640 --> 00:54:22,160
get started with threat hunting

1413
00:54:20,079 --> 00:54:24,000
in small environments but maybe who

1414
00:54:22,160 --> 00:54:25,920
don't have the resources or

1415
00:54:24,000 --> 00:54:27,119
knowledge to incorporate something like

1416
00:54:25,920 --> 00:54:30,480
hulk

1417
00:54:27,119 --> 00:54:33,520
hulk is turning uh into

1418
00:54:30,480 --> 00:54:35,599
a combined detection

1419
00:54:33,520 --> 00:54:37,200
and threat hunting platform that you

1420
00:54:35,599 --> 00:54:40,240
know incorporates a learning

1421
00:54:37,200 --> 00:54:42,078
mine does not i try and stick to the

1422
00:54:40,240 --> 00:54:44,078
philosophy of targeted threat hunting

1423
00:54:42,079 --> 00:54:45,839
and all that it has to offer

1424
00:54:44,079 --> 00:54:47,680
if you want to contribute or take a look

1425
00:54:45,839 --> 00:54:50,799
please encourage

1426
00:54:47,680 --> 00:54:51,279
i would highly encourage you to do so it

1427
00:54:50,799 --> 00:54:54,640
is

1428
00:54:51,280 --> 00:54:57,680
at a stable build right now and is

1429
00:54:54,640 --> 00:55:00,960
as simple as two powershell scripts

1430
00:54:57,680 --> 00:55:01,598
um please take a look uh thank you for

1431
00:55:00,960 --> 00:55:04,000
your time

1432
00:55:01,599 --> 00:55:05,839
i really appreciate it uh again my name

1433
00:55:04,000 --> 00:55:08,559
is brian george and this is hunt like

1434
00:55:05,839 --> 00:55:08,558
you mean it

