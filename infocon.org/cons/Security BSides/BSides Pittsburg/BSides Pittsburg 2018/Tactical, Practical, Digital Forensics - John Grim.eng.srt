1
00:00:00,000 --> 00:00:02,009
all right the black room is getting

2
00:00:02,009 --> 00:00:04,859
started this is John Grimm with Verizon

3
00:00:04,859 --> 00:00:06,240
he's gonna talk about tactical practical

4
00:00:06,240 --> 00:00:12,269
and digital forensics Thank You John can

5
00:00:12,269 --> 00:00:13,880
folks hear me all the way in the back

6
00:00:13,880 --> 00:00:17,430
good afternoon my name is John Grimm I'm

7
00:00:17,430 --> 00:00:19,770
with Verizon more specifically I'm with

8
00:00:19,770 --> 00:00:21,750
the Verizon threat research advisory

9
00:00:21,750 --> 00:00:23,730
Center the investigative response team

10
00:00:23,730 --> 00:00:26,789
and we do digital forensics on behalf of

11
00:00:26,789 --> 00:00:28,410
our external customers so I've been on

12
00:00:28,410 --> 00:00:31,050
the team since 2009 doing digital

13
00:00:31,050 --> 00:00:32,790
forensics I currently lead a team here

14
00:00:32,790 --> 00:00:35,520
in the Americas prior to that just to

15
00:00:35,520 --> 00:00:36,809
kind of give you an idea of where I come

16
00:00:36,809 --> 00:00:38,700
from I used to be a civilian with the

17
00:00:38,700 --> 00:00:41,340
army as well as a soldier with the army

18
00:00:41,340 --> 00:00:43,500
doing counterintelligence and cyber

19
00:00:43,500 --> 00:00:45,870
counterintelligence investigations so as

20
00:00:45,870 --> 00:00:48,270
I transitioned in 2009 to Verizon I

21
00:00:48,270 --> 00:00:50,430
brought my skillsets with me and I do

22
00:00:50,430 --> 00:00:52,680
cases for as I mentioned earlier our

23
00:00:52,680 --> 00:00:55,079
external customers so what I wanted to

24
00:00:55,079 --> 00:00:58,410
talk about today is a tactical practical

25
00:00:58,410 --> 00:01:00,989
approach to digital forensics I'm gonna

26
00:01:00,989 --> 00:01:03,449
talk about the 13 must-have tools and I

27
00:01:03,449 --> 00:01:05,729
know the title said 12 there was one

28
00:01:05,729 --> 00:01:07,140
more I wanted to squeeze in today's

29
00:01:07,140 --> 00:01:08,670
presentation because I just really

30
00:01:08,670 --> 00:01:11,520
needed to make sure it was included so I

31
00:01:11,520 --> 00:01:12,930
want to talk about tools that are

32
00:01:12,930 --> 00:01:15,000
open-source tools tools that you can use

33
00:01:15,000 --> 00:01:17,250
for your investigations for your

34
00:01:17,250 --> 00:01:20,790
investigative response purposes okay so

35
00:01:20,790 --> 00:01:23,310
this is the objective collect preserve

36
00:01:23,310 --> 00:01:27,330
parse analyze key data sources in an

37
00:01:27,330 --> 00:01:30,000
effective and efficient manner and I'll

38
00:01:30,000 --> 00:01:32,850
get more to that as we progress but I'll

39
00:01:32,850 --> 00:01:34,619
kind of hit home as to why we need to be

40
00:01:34,619 --> 00:01:36,540
effective and efficient okay because

41
00:01:36,540 --> 00:01:39,030
time is of the essence and doing so

42
00:01:39,030 --> 00:01:42,540
allow for tactical analysis incident

43
00:01:42,540 --> 00:01:45,979
Ries coping system triaging and fast and

44
00:01:45,979 --> 00:01:48,570
investigative resolution so for the raw

45
00:01:48,570 --> 00:01:50,159
data that we collect we want it to be

46
00:01:50,159 --> 00:01:52,560
relevant we want it to be fast and easy

47
00:01:52,560 --> 00:01:55,020
to collect for the system impact you

48
00:01:55,020 --> 00:01:57,000
want to make nominal exchange or

49
00:01:57,000 --> 00:01:58,950
transfer when we're using our tools and

50
00:01:58,950 --> 00:02:00,840
we want to make sure we minimize any

51
00:02:00,840 --> 00:02:03,180
disruption to the system and then for

52
00:02:03,180 --> 00:02:04,649
the data outputs we want to be

53
00:02:04,649 --> 00:02:06,689
relatively small in size with our data

54
00:02:06,689 --> 00:02:09,119
outputs and it once we want it to be

55
00:02:09,119 --> 00:02:11,580
easily reviewable in a format that we

56
00:02:11,580 --> 00:02:13,740
can look at right away

57
00:02:13,740 --> 00:02:15,210
so one of the things I want to caveat

58
00:02:15,210 --> 00:02:16,830
here is we're not going to be collecting

59
00:02:16,830 --> 00:02:18,060
a memory dump we're not going to be

60
00:02:18,060 --> 00:02:20,340
collecting a full disk image we can

61
00:02:20,340 --> 00:02:22,230
certainly do that but what we're looking

62
00:02:22,230 --> 00:02:24,630
here is to collect the image be able to

63
00:02:24,630 --> 00:02:26,670
parse it look at it right away and give

64
00:02:26,670 --> 00:02:29,370
answers back to the victim organization

65
00:02:29,370 --> 00:02:30,870
in terms of what we're seeing with that

66
00:02:30,870 --> 00:02:32,250
system okay

67
00:02:32,250 --> 00:02:34,020
in another approach you can certainly

68
00:02:34,020 --> 00:02:36,240
grab the memory dump grab the volatile

69
00:02:36,240 --> 00:02:38,610
data grab the full disk image right

70
00:02:38,610 --> 00:02:39,990
that's totally a different approach that

71
00:02:39,990 --> 00:02:41,550
you can take but it's gonna take a

72
00:02:41,550 --> 00:02:43,320
little bit more time to collect that and

73
00:02:43,320 --> 00:02:47,220
analyze that data so when I arrived on

74
00:02:47,220 --> 00:02:50,550
site I need to have answers fast some of

75
00:02:50,550 --> 00:02:52,380
the questions that are coming up

76
00:02:52,380 --> 00:02:54,840
initially when the investigation kicks

77
00:02:54,840 --> 00:02:58,410
off when was i breached how was access

78
00:02:58,410 --> 00:03:02,310
gained how was my data exfiltrated what

79
00:03:02,310 --> 00:03:04,860
Malheur was involved what else happened

80
00:03:04,860 --> 00:03:07,980
and just as importantly if not more when

81
00:03:07,980 --> 00:03:10,410
will you know these answers so here's

82
00:03:10,410 --> 00:03:12,030
the scenario a real simple scenario

83
00:03:12,030 --> 00:03:14,340
children a laptop belongs to a

84
00:03:14,340 --> 00:03:17,310
high-profile employee it's suspected of

85
00:03:17,310 --> 00:03:19,580
being accessed in sensitive data

86
00:03:19,580 --> 00:03:22,110
exfiltrated okay so for the parameters

87
00:03:22,110 --> 00:03:23,250
of this scenario I just kind of keep

88
00:03:23,250 --> 00:03:23,970
this in mind

89
00:03:23,970 --> 00:03:27,180
it's either malware or dual use tool

90
00:03:27,180 --> 00:03:28,830
related and when I talk about when I

91
00:03:28,830 --> 00:03:30,300
mentioned dual use tools I mean

92
00:03:30,300 --> 00:03:32,670
something like a remote access tool or

93
00:03:32,670 --> 00:03:34,290
something that's a legitimate tool

94
00:03:34,290 --> 00:03:36,600
that's used for illegitimate or

95
00:03:36,600 --> 00:03:39,510
unauthorized purposes one systems in

96
00:03:39,510 --> 00:03:42,360
scope Windows 7 or newer operating

97
00:03:42,360 --> 00:03:45,480
system it's a live system and it's not a

98
00:03:45,480 --> 00:03:48,180
virtual system Network logs are not

99
00:03:48,180 --> 00:03:48,930
available

100
00:03:48,930 --> 00:03:51,710
time is short storage is limited and

101
00:03:51,710 --> 00:03:54,090
most importantly you need to have admin

102
00:03:54,090 --> 00:03:57,090
privileges to run these tools ok so the

103
00:03:57,090 --> 00:03:58,860
fast 5 plus in answering those questions

104
00:03:58,860 --> 00:04:01,020
I just mentioned no free stuff couple

105
00:04:01,020 --> 00:04:02,910
slides ago we want to look at things

106
00:04:02,910 --> 00:04:04,980
like execution indicators of any of the

107
00:04:04,980 --> 00:04:06,690
applications that might be related to

108
00:04:06,690 --> 00:04:09,420
this particular investigation access

109
00:04:09,420 --> 00:04:11,550
vectors how did the threat actor get

110
00:04:11,550 --> 00:04:14,550
access to the system any involvements

111
00:04:14,550 --> 00:04:16,529
were accounts compromised on the system

112
00:04:16,529 --> 00:04:18,450
what level of privilege did those

113
00:04:18,450 --> 00:04:21,120
accounts have any relevant artifacts

114
00:04:21,120 --> 00:04:23,280
indicators a compromise that could be

115
00:04:23,280 --> 00:04:26,460
helpful with intel lookups as well as

116
00:04:26,460 --> 00:04:28,170
determining whether

117
00:04:28,170 --> 00:04:30,090
the threat actor has gained access to

118
00:04:30,090 --> 00:04:31,950
additional systems within the enterprise

119
00:04:31,950 --> 00:04:33,900
environments and then the security

120
00:04:33,900 --> 00:04:35,640
posture of the system and some other

121
00:04:35,640 --> 00:04:37,230
things that to the extent we can

122
00:04:37,230 --> 00:04:38,340
determine if there's been data

123
00:04:38,340 --> 00:04:41,220
exfiltration again we don't have bugs

124
00:04:41,220 --> 00:04:43,050
what's the incident timeline when did

125
00:04:43,050 --> 00:04:45,150
the breach first occur is it still

126
00:04:45,150 --> 00:04:47,850
ongoing and what are the aspects or the

127
00:04:47,850 --> 00:04:49,890
circumstances surrounding that data

128
00:04:49,890 --> 00:04:52,290
breach and finally we need to expand the

129
00:04:52,290 --> 00:04:54,630
scope so those questions that I

130
00:04:54,630 --> 00:04:56,790
mentioned earlier when breach translates

131
00:04:56,790 --> 00:04:58,530
rate to the incident timeline how

132
00:04:58,530 --> 00:05:01,770
accessed access vectors how exfiltrated

133
00:05:01,770 --> 00:05:04,980
data exfiltration what malware in the

134
00:05:04,980 --> 00:05:08,130
execution indicators what else involved

135
00:05:08,130 --> 00:05:10,770
accounts relevant artifacts security

136
00:05:10,770 --> 00:05:13,650
posture and expanded scope when resolved

137
00:05:13,650 --> 00:05:15,450
we got to get to that big question right

138
00:05:15,450 --> 00:05:18,840
there so whatever what I was I took

139
00:05:18,840 --> 00:05:20,820
these thirteen tools and I broke them

140
00:05:20,820 --> 00:05:23,460
down into four steps here as a process

141
00:05:23,460 --> 00:05:25,980
as a methodology to use these tools now

142
00:05:25,980 --> 00:05:28,080
in general we're doing we're gonna be

143
00:05:28,080 --> 00:05:30,000
collecting data we're gonna be parsing

144
00:05:30,000 --> 00:05:31,950
some of this data on the fly and for

145
00:05:31,950 --> 00:05:33,960
some of these outputs we're gonna have

146
00:05:33,960 --> 00:05:35,340
to parse a little bit later with some

147
00:05:35,340 --> 00:05:37,500
additional tools so generally speaking

148
00:05:37,500 --> 00:05:39,870
we're gonna go with step a capture that

149
00:05:39,870 --> 00:05:42,210
volatile data that data that's on the

150
00:05:42,210 --> 00:05:44,400
system that could disappear at any time

151
00:05:44,400 --> 00:05:47,340
because maybe a process stopped running

152
00:05:47,340 --> 00:05:48,990
or maybe the network connection is no

153
00:05:48,990 --> 00:05:50,850
longer there or maybe the operating

154
00:05:50,850 --> 00:05:52,800
system is running and is overwriting

155
00:05:52,800 --> 00:05:54,930
some of these artifacts or maybe the

156
00:05:54,930 --> 00:05:57,630
threat actors still in the system and is

157
00:05:57,630 --> 00:06:00,090
the leading artifacts so we want to

158
00:06:00,090 --> 00:06:02,340
capture those Network connections those

159
00:06:02,340 --> 00:06:04,770
running processes those user sessions

160
00:06:04,770 --> 00:06:07,290
and those loaded dynamic link libraries

161
00:06:07,290 --> 00:06:08,790
these are the things that are in memory

162
00:06:08,790 --> 00:06:10,770
now there's all kinds of other volatile

163
00:06:10,770 --> 00:06:12,150
data that you can collect as well but

164
00:06:12,150 --> 00:06:14,010
we're trying to focus here on tactical

165
00:06:14,010 --> 00:06:17,100
practical forensics step B live system

166
00:06:17,100 --> 00:06:20,010
audio editing windows events things that

167
00:06:20,010 --> 00:06:21,710
are being recorded in the event logs

168
00:06:21,710 --> 00:06:24,000
persistence mechanisms if there's

169
00:06:24,000 --> 00:06:26,580
malware on this system how is that

170
00:06:26,580 --> 00:06:28,730
malware maintaining its persistence and

171
00:06:28,730 --> 00:06:30,870
finally system audit and this will kind

172
00:06:30,870 --> 00:06:32,640
of give us a sense of the security of

173
00:06:32,640 --> 00:06:34,920
the system steps see you were going to

174
00:06:34,920 --> 00:06:37,410
collect some raw files those files are

175
00:06:37,410 --> 00:06:39,860
the master file table windows Street

176
00:06:39,860 --> 00:06:41,820
Windows prefetch and brow

177
00:06:41,820 --> 00:06:44,400
hippie and then step D we're gonna go

178
00:06:44,400 --> 00:06:46,320
ahead and parse those same four files

179
00:06:46,320 --> 00:06:47,250
the MFT

180
00:06:47,250 --> 00:06:50,250
registry prefetch as well as the browser

181
00:06:50,250 --> 00:06:52,440
history so this is what we're looking at

182
00:06:52,440 --> 00:06:55,920
four steps ABCD what are those thirteen

183
00:06:55,920 --> 00:06:57,900
tools to look at those artifacts that I

184
00:06:57,900 --> 00:07:00,210
just mentioned and more specifically how

185
00:07:00,210 --> 00:07:02,190
they map to that fast five that I was

186
00:07:02,190 --> 00:07:04,230
talking about earlier the execution

187
00:07:04,230 --> 00:07:06,570
indicators C access vectors involved

188
00:07:06,570 --> 00:07:08,730
accounts relevant artifacts in the

189
00:07:08,730 --> 00:07:11,400
security posture step a volatility

190
00:07:11,400 --> 00:07:14,610
capture so this tool is a tool that I've

191
00:07:14,610 --> 00:07:17,130
used it's a tool that's going to give us

192
00:07:17,130 --> 00:07:19,200
that that network activity or those

193
00:07:19,200 --> 00:07:20,910
network connections and it's called Kerr

194
00:07:20,910 --> 00:07:23,040
ports okay and it's a tool by near soft

195
00:07:23,040 --> 00:07:24,810
so when we're looking at network

196
00:07:24,810 --> 00:07:27,120
connections what we want to do is see

197
00:07:27,120 --> 00:07:30,090
all of those listening established

198
00:07:30,090 --> 00:07:31,740
closed or even undetermined

199
00:07:31,740 --> 00:07:34,200
communication links between systems okay

200
00:07:34,200 --> 00:07:36,300
and this information can be pulled from

201
00:07:36,300 --> 00:07:38,820
memory from volatile data so running

202
00:07:38,820 --> 00:07:40,260
this tool and I'll talk about this tool

203
00:07:40,260 --> 00:07:41,430
a little bit more in the next slide

204
00:07:41,430 --> 00:07:43,800
we're gonna get the process name we're

205
00:07:43,800 --> 00:07:45,720
gonna get the process identifier or the

206
00:07:45,720 --> 00:07:48,630
pid' the protocol the local socket the

207
00:07:48,630 --> 00:07:50,670
remote socket and that includes both the

208
00:07:50,670 --> 00:07:53,010
IP address and the port as well as the

209
00:07:53,010 --> 00:07:55,260
state of the connection so this first

210
00:07:55,260 --> 00:07:58,290
tool number one carports captures those

211
00:07:58,290 --> 00:08:01,260
tcp/ip connections to include those

212
00:08:01,260 --> 00:08:03,390
ports and I emphasize those ports

213
00:08:03,390 --> 00:08:05,130
because there are some other tools out

214
00:08:05,130 --> 00:08:06,660
there that will collect the network

215
00:08:06,660 --> 00:08:08,640
connections but you may not get the

216
00:08:08,640 --> 00:08:10,770
ports there's also some tools out there

217
00:08:10,770 --> 00:08:12,150
that will get them give you the ports

218
00:08:12,150 --> 00:08:13,650
but they won't give you some timestamps

219
00:08:13,650 --> 00:08:16,170
as well and I'll talk about that when I

220
00:08:16,170 --> 00:08:18,360
talk about the next the next tool PS

221
00:08:18,360 --> 00:08:21,450
lists so seaports dot exe also known as

222
00:08:21,450 --> 00:08:24,090
current ports simple command prompt tool

223
00:08:24,090 --> 00:08:26,910
that you can run and output to a CSV

224
00:08:26,910 --> 00:08:29,280
format okay so with all these tools that

225
00:08:29,280 --> 00:08:31,380
I'm talking about the outputs are either

226
00:08:31,380 --> 00:08:34,020
the raw file itself or it's going to be

227
00:08:34,020 --> 00:08:36,690
a CSV or txt output something that you

228
00:08:36,690 --> 00:08:40,590
can simply open up with a text editor

229
00:08:40,590 --> 00:08:43,200
notepad plus plus for example or with

230
00:08:43,200 --> 00:08:45,510
something like memos Excel to open up

231
00:08:45,510 --> 00:08:48,090
that CSV and go ahead and run filters on

232
00:08:48,090 --> 00:08:50,220
it okay so this is real simple you don't

233
00:08:50,220 --> 00:08:52,920
have to go out and get a commercial tool

234
00:08:52,920 --> 00:08:54,690
to be able to read these outputs you can

235
00:08:54,690 --> 00:08:55,120
see

236
00:08:55,120 --> 00:08:57,279
use some of these simple tools to to

237
00:08:57,279 --> 00:09:00,010
read them one of the things I also

238
00:09:00,010 --> 00:09:01,870
wanted to mention here is each of these

239
00:09:01,870 --> 00:09:04,060
tools can be run from the command line

240
00:09:04,060 --> 00:09:06,430
some of them have a GUI functionality

241
00:09:06,430 --> 00:09:08,260
but what we want to do is we want to

242
00:09:08,260 --> 00:09:10,060
make sure that we're light on the system

243
00:09:10,060 --> 00:09:12,339
the more complex the tool is the more

244
00:09:12,339 --> 00:09:15,790
fancy it is the more GUI like it is the

245
00:09:15,790 --> 00:09:17,980
more as an investigator you're stepping

246
00:09:17,980 --> 00:09:19,600
on that system and potentially pushing

247
00:09:19,600 --> 00:09:21,460
artifacts away from that system or out

248
00:09:21,460 --> 00:09:23,770
of memory okay so each one of these

249
00:09:23,770 --> 00:09:25,839
tools is is is run from the command

250
00:09:25,839 --> 00:09:29,080
prompt and then the benefit as well for

251
00:09:29,080 --> 00:09:30,339
that the command prompt is you can batch

252
00:09:30,339 --> 00:09:32,529
script these okay you can simply put all

253
00:09:32,529 --> 00:09:34,360
13 of these tools into a batch script

254
00:09:34,360 --> 00:09:36,279
and run that batch script that make your

255
00:09:36,279 --> 00:09:39,010
life simple so network connections this

256
00:09:39,010 --> 00:09:40,330
is just an example it's probably a

257
00:09:40,330 --> 00:09:42,010
little bit hard to see but this

258
00:09:42,010 --> 00:09:43,779
particular scenario was very similar to

259
00:09:43,779 --> 00:09:45,220
the current scenario that I'm talking

260
00:09:45,220 --> 00:09:47,770
about involve the laptop with network

261
00:09:47,770 --> 00:09:50,470
connections they're dual use tools that

262
00:09:50,470 --> 00:09:52,150
are being used by the thread actor and

263
00:09:52,150 --> 00:09:54,160
here what we're looking at is network

264
00:09:54,160 --> 00:09:57,279
connections for tcp/ip we can see the

265
00:09:57,279 --> 00:09:59,350
local port we can see the local address

266
00:09:59,350 --> 00:10:01,000
the remote port the remote address and

267
00:10:01,000 --> 00:10:03,010
the state of the connection but most

268
00:10:03,010 --> 00:10:04,900
importantly we can see a process here so

269
00:10:04,900 --> 00:10:07,720
we've got Team Viewer service ok and

270
00:10:07,720 --> 00:10:10,900
we've got a process ID of 1 for 0 0 so

271
00:10:10,900 --> 00:10:12,400
this is good to know we know that we

272
00:10:12,400 --> 00:10:14,260
have an established network connection

273
00:10:14,260 --> 00:10:16,839
we know that we have a process and if we

274
00:10:16,839 --> 00:10:18,070
did a little bit of research if we're

275
00:10:18,070 --> 00:10:19,450
not familiar with this tool we'll see

276
00:10:19,450 --> 00:10:21,339
that it is a remote access tool and

277
00:10:21,339 --> 00:10:23,920
we've got that pid' that process ID ok

278
00:10:23,920 --> 00:10:25,870
so this is that first tool that first

279
00:10:25,870 --> 00:10:28,510
must have current ports let's look at

280
00:10:28,510 --> 00:10:31,600
processes now the second tool is PS list

281
00:10:31,600 --> 00:10:33,940
this is a tool from microsoft's its

282
00:10:33,940 --> 00:10:36,550
internals ok and this is something when

283
00:10:36,550 --> 00:10:38,560
you run that tool you're gonna see an

284
00:10:38,560 --> 00:10:40,450
output that gives you the currently

285
00:10:40,450 --> 00:10:42,640
executing programs also known as running

286
00:10:42,640 --> 00:10:45,220
processes on the system this is Val data

287
00:10:45,220 --> 00:10:47,230
as well and we're gonna get an output in

288
00:10:47,230 --> 00:10:48,670
a table that's going to give us the

289
00:10:48,670 --> 00:10:51,010
process name that pid' that I refer to

290
00:10:51,010 --> 00:10:53,770
earlier with the previous tool CPU time

291
00:10:53,770 --> 00:10:57,250
elapsed time a process tree and other

292
00:10:57,250 --> 00:10:59,529
information so if we just run PS list

293
00:10:59,529 --> 00:11:01,990
which is available from this link right

294
00:11:01,990 --> 00:11:04,630
here in Microsoft tool written by mark

295
00:11:04,630 --> 00:11:07,930
russinovich will show those process and

296
00:11:07,930 --> 00:11:08,860
thread information

297
00:11:08,860 --> 00:11:10,930
that I mentioned again command prompt

298
00:11:10,930 --> 00:11:13,060
tool and we look at the outputs it's

299
00:11:13,060 --> 00:11:14,560
probably really hard to see but you're

300
00:11:14,560 --> 00:11:16,570
gonna see here that this isn't a table

301
00:11:16,570 --> 00:11:19,360
view okay the very left hand side is the

302
00:11:19,360 --> 00:11:22,240
process name the next column is going to

303
00:11:22,240 --> 00:11:25,720
give us the process ID so as we look

304
00:11:25,720 --> 00:11:27,040
through here and I kind of highlight it

305
00:11:27,040 --> 00:11:28,570
here we've we can see right away the

306
00:11:28,570 --> 00:11:30,580
TeamViewer is running as an active

307
00:11:30,580 --> 00:11:32,770
process and we already knew that but now

308
00:11:32,770 --> 00:11:34,780
look we see some other processes that

309
00:11:34,780 --> 00:11:36,310
are associated with TeamViewer as well

310
00:11:36,310 --> 00:11:37,210
okay

311
00:11:37,210 --> 00:11:40,420
we've also got time context or temporal

312
00:11:40,420 --> 00:11:42,280
context in the last two columns there

313
00:11:42,280 --> 00:11:43,720
that give us some timestamps to work

314
00:11:43,720 --> 00:11:45,460
with so if you remember one of those

315
00:11:45,460 --> 00:11:46,960
questions was when I was I first

316
00:11:46,960 --> 00:11:47,590
breached

317
00:11:47,590 --> 00:11:49,420
well now we have some time to work with

318
00:11:49,420 --> 00:11:52,030
and you know with my investigative

319
00:11:52,030 --> 00:11:54,190
knowledge I know that these times here

320
00:11:54,190 --> 00:11:56,260
are probably not the first instance of

321
00:11:56,260 --> 00:11:57,580
the breach but we at least have

322
00:11:57,580 --> 00:11:58,990
something to work with and we can work

323
00:11:58,990 --> 00:12:01,660
back in time to find when this tool was

324
00:12:01,660 --> 00:12:03,940
introduced to the system one of the

325
00:12:03,940 --> 00:12:05,500
things with PS lists is you've got an

326
00:12:05,500 --> 00:12:08,350
option to add a dash T to it so if we're

327
00:12:08,350 --> 00:12:10,990
on PS list tree we can see these

328
00:12:10,990 --> 00:12:13,240
processes in a tree view and the good

329
00:12:13,240 --> 00:12:15,280
advantage that we see here is not only

330
00:12:15,280 --> 00:12:18,100
do we have these processes listed but we

331
00:12:18,100 --> 00:12:19,870
have their association if there's any

332
00:12:19,870 --> 00:12:22,780
parent process if they're a child to a

333
00:12:22,780 --> 00:12:24,520
parent process we can see that

334
00:12:24,520 --> 00:12:26,110
relationship and we can kind of get a

335
00:12:26,110 --> 00:12:28,150
little bit more information or knowledge

336
00:12:28,150 --> 00:12:31,030
as to what's going on here is this being

337
00:12:31,030 --> 00:12:33,640
run by the from from or associated with

338
00:12:33,640 --> 00:12:37,750
CMD dot X Exe for example what other

339
00:12:37,750 --> 00:12:39,850
processes do we maybe want to look at in

340
00:12:39,850 --> 00:12:41,500
terms of the relationship with the ones

341
00:12:41,500 --> 00:12:43,780
that were interested in so this was

342
00:12:43,780 --> 00:12:45,430
number two on the list with PS list

343
00:12:45,430 --> 00:12:48,160
system turtles by Microsoft the third

344
00:12:48,160 --> 00:12:49,810
process or the third tool that I was

345
00:12:49,810 --> 00:12:52,540
wanted to to bring up here is actually

346
00:12:52,540 --> 00:12:54,580
was number thirteen on my list and I

347
00:12:54,580 --> 00:12:56,230
tried to put this presentation together

348
00:12:56,230 --> 00:12:58,030
without including it but in the end I

349
00:12:58,030 --> 00:13:00,300
decided it's best to include it because

350
00:13:00,300 --> 00:13:03,160
it's just such a rich tool it can really

351
00:13:03,160 --> 00:13:05,890
lead you right to the account if it's

352
00:13:05,890 --> 00:13:07,990
been a compromise and seeing which one

353
00:13:07,990 --> 00:13:10,270
you need to look at so logon sessions

354
00:13:10,270 --> 00:13:11,620
this is another system Eternals tool

355
00:13:11,620 --> 00:13:15,310
from Microsoft okay and it's something

356
00:13:15,310 --> 00:13:17,650
that has been around for for a number of

357
00:13:17,650 --> 00:13:20,230
years what it does is it gives you

358
00:13:20,230 --> 00:13:22,690
currently active logon sessions

359
00:13:22,690 --> 00:13:25,060
and associated running processes okay so

360
00:13:25,060 --> 00:13:27,760
if the threat actor is on the system

361
00:13:27,760 --> 00:13:29,950
you're gonna in it is currently logged

362
00:13:29,950 --> 00:13:31,210
in with an account that's been

363
00:13:31,210 --> 00:13:33,130
compromised not only you're gonna get

364
00:13:33,130 --> 00:13:35,620
that active session but you're also

365
00:13:35,620 --> 00:13:39,010
going to get how that account relates to

366
00:13:39,010 --> 00:13:40,690
any running processes so that's really

367
00:13:40,690 --> 00:13:42,430
key here because if you think about it

368
00:13:42,430 --> 00:13:44,890
the first two tools we we mentioned one

369
00:13:44,890 --> 00:13:46,390
was network connections and the second

370
00:13:46,390 --> 00:13:48,730
was processes we're not seeing anything

371
00:13:48,730 --> 00:13:50,920
yet tied to an account here this tool

372
00:13:50,920 --> 00:13:52,720
will give us that information now

373
00:13:52,720 --> 00:13:53,740
there's some tools I'm going to mention

374
00:13:53,740 --> 00:13:55,990
a little bit later on they kind of show

375
00:13:55,990 --> 00:13:58,270
us which accounts which which account in

376
00:13:58,270 --> 00:13:59,530
this particular situation have been

377
00:13:59,530 --> 00:14:01,180
compromised but this will get you right

378
00:14:01,180 --> 00:14:02,140
to the heart of the matter

379
00:14:02,140 --> 00:14:05,020
so logon sessions list currently active

380
00:14:05,020 --> 00:14:06,970
logon sessions there's various different

381
00:14:06,970 --> 00:14:09,970
options here plist processes running in

382
00:14:09,970 --> 00:14:11,230
the login session so you want to make

383
00:14:11,230 --> 00:14:12,610
sure you include that if you don't I'm

384
00:14:12,610 --> 00:14:14,770
gonna get those running processes you

385
00:14:14,770 --> 00:14:16,690
want to output to a simple output so I

386
00:14:16,690 --> 00:14:19,420
prefer here CSV output again you can

387
00:14:19,420 --> 00:14:21,250
open this up with Microsoft Excel and

388
00:14:21,250 --> 00:14:24,190
then you can accept the EULA now if you

389
00:14:24,190 --> 00:14:26,110
don't put that option in there for the

390
00:14:26,110 --> 00:14:27,760
system eternals tools to accept the EULA

391
00:14:27,760 --> 00:14:30,250
you're going to get a pop-up bubble that

392
00:14:30,250 --> 00:14:32,590
requires you to accept the EULA manually

393
00:14:32,590 --> 00:14:34,810
so I put this in here this switch

394
00:14:34,810 --> 00:14:36,340
because if you're putting a batch file

395
00:14:36,340 --> 00:14:38,110
together you want to make sure that you

396
00:14:38,110 --> 00:14:40,060
accept the EULA on-the-fly otherwise

397
00:14:40,060 --> 00:14:42,340
your batch file is gonna go ahead and

398
00:14:42,340 --> 00:14:44,320
stop until you accept the EULA

399
00:14:44,320 --> 00:14:48,130
okay so again command prompt tool and

400
00:14:48,130 --> 00:14:50,500
the outputs it's probably hard to see

401
00:14:50,500 --> 00:14:52,000
but I can tell you there's two logon

402
00:14:52,000 --> 00:14:54,610
sessions that are involved right here in

403
00:14:54,610 --> 00:14:55,840
addition to some other ones but these

404
00:14:55,840 --> 00:14:58,360
two look particularly suspicious okay

405
00:14:58,360 --> 00:15:01,000
number one and on the bottom here we can

406
00:15:01,000 --> 00:15:03,220
see the processes that are associated

407
00:15:03,220 --> 00:15:05,020
with this logon session okay and we can

408
00:15:05,020 --> 00:15:06,570
see that there's some TeamViewer

409
00:15:06,570 --> 00:15:09,700
processes as well as another dual use

410
00:15:09,700 --> 00:15:11,170
tool that could be something that we'd

411
00:15:11,170 --> 00:15:13,330
want to look into veracrypt okay so if

412
00:15:13,330 --> 00:15:14,440
you're familiar with veracrypt

413
00:15:14,440 --> 00:15:17,470
it's a way to encrypt content in a

414
00:15:17,470 --> 00:15:20,320
container or files it's something that's

415
00:15:20,320 --> 00:15:22,600
that's used legitimately it could be

416
00:15:22,600 --> 00:15:24,430
used legitimately by investigators but

417
00:15:24,430 --> 00:15:26,920
it could also be used illegitimately ran

418
00:15:26,920 --> 00:15:28,540
in and off an authorized manner by a

419
00:15:28,540 --> 00:15:30,010
threat actor so it might be something to

420
00:15:30,010 --> 00:15:30,600
look into

421
00:15:30,600 --> 00:15:33,130
furthermore what are these accounts that

422
00:15:33,130 --> 00:15:34,810
are associated what it takes it just

423
00:15:34,810 --> 00:15:36,130
turns out there's only one

424
00:15:36,130 --> 00:15:38,380
two sessions and the account name is

425
00:15:38,380 --> 00:15:39,370
Jake a hacker

426
00:15:39,370 --> 00:15:42,100
okay Jake ahck are all right so now we

427
00:15:42,100 --> 00:15:43,890
have a user account to look at right

428
00:15:43,890 --> 00:15:46,420
furthermore we've got the the security

429
00:15:46,420 --> 00:15:48,400
identifier for that user account which

430
00:15:48,400 --> 00:15:49,600
can be helpful if we're going to be

431
00:15:49,600 --> 00:15:51,400
doing a deeper dive forensics analysis

432
00:15:51,400 --> 00:15:53,770
of the disk as well as the event logs

433
00:15:53,770 --> 00:15:57,910
and we've also got some logon times for

434
00:15:57,910 --> 00:15:59,620
these posts both of these sessions for

435
00:15:59,620 --> 00:16:01,450
this user account and we've got some

436
00:16:01,450 --> 00:16:02,680
other metadata that could be helpful

437
00:16:02,680 --> 00:16:05,890
later on okay so in my mind I've got an

438
00:16:05,890 --> 00:16:09,010
account so in my mind what's you know

439
00:16:09,010 --> 00:16:10,360
the next thing I want to do is determine

440
00:16:10,360 --> 00:16:11,860
whether this is an administrator account

441
00:16:11,860 --> 00:16:15,850
so you may be able to tell that from the

442
00:16:15,850 --> 00:16:18,790
SID if it ends in - 500 for example or

443
00:16:18,790 --> 00:16:20,410
you may have to do a little bit more and

444
00:16:20,410 --> 00:16:21,760
I'll show you some other ways of

445
00:16:21,760 --> 00:16:23,830
determining what the accounts privileges

446
00:16:23,830 --> 00:16:27,100
are so number four this DLLs and this is

447
00:16:27,100 --> 00:16:28,750
the fourth one with the volatile data

448
00:16:28,750 --> 00:16:31,000
that I want to talk about dynamic link

449
00:16:31,000 --> 00:16:33,490
libraries okay in this tool is from

450
00:16:33,490 --> 00:16:35,110
system journals again a Microsoft tool

451
00:16:35,110 --> 00:16:37,210
and dll's if you're not familiar with

452
00:16:37,210 --> 00:16:38,710
them are modules executed by another

453
00:16:38,710 --> 00:16:41,950
application or by another DLL again

454
00:16:41,950 --> 00:16:43,990
these are these are DLL or loaded in

455
00:16:43,990 --> 00:16:46,240
memory okay they're not the actual DLL

456
00:16:46,240 --> 00:16:48,640
themselves or an image to the DLL so

457
00:16:48,640 --> 00:16:51,040
just keep that in mind because if you if

458
00:16:51,040 --> 00:16:52,870
you're gonna dump these from memory and

459
00:16:52,870 --> 00:16:53,830
you hash them it's going to be a

460
00:16:53,830 --> 00:16:55,750
different hash than the actual DLL that

461
00:16:55,750 --> 00:16:59,410
exists on disk so with this list dll's

462
00:16:59,410 --> 00:17:01,180
we'll get the process name in the pit

463
00:17:01,180 --> 00:17:03,550
we'll get the command line we'll get the

464
00:17:03,550 --> 00:17:06,010
application file path in the loaded DLL

465
00:17:06,010 --> 00:17:08,560
file paths so if you if you notice here

466
00:17:08,560 --> 00:17:10,540
the last three things that I mention are

467
00:17:10,540 --> 00:17:13,449
starting to tie artifacts back to disk

468
00:17:13,449 --> 00:17:14,470
okay

469
00:17:14,470 --> 00:17:16,839
so we're moving we're transitioning from

470
00:17:16,839 --> 00:17:19,540
volatile data to actual files on disk

471
00:17:19,540 --> 00:17:23,430
including those file paths so list dll's

472
00:17:23,430 --> 00:17:27,849
one of the things you can do is check

473
00:17:27,849 --> 00:17:30,700
the the su option or the switch and that

474
00:17:30,700 --> 00:17:33,160
will give you unsigned DLL so it'll give

475
00:17:33,160 --> 00:17:35,290
you a smaller list or a smaller output

476
00:17:35,290 --> 00:17:37,330
it'll take a little bit longer to

477
00:17:37,330 --> 00:17:39,670
generate so that may be helpful with

478
00:17:39,670 --> 00:17:41,380
your investigation in this particular

479
00:17:41,380 --> 00:17:42,760
case we're not going to use that switch

480
00:17:42,760 --> 00:17:44,110
we're just going to go ahead and accept

481
00:17:44,110 --> 00:17:47,350
the EULA command prompt and the output

482
00:17:47,350 --> 00:17:48,640
will look something like this

483
00:17:48,640 --> 00:17:49,160
so

484
00:17:49,160 --> 00:17:50,840
you remember earlier we had that pit

485
00:17:50,840 --> 00:17:53,060
that process ID for Team Viewer service

486
00:17:53,060 --> 00:17:56,150
here we've got the pit 1,400 so we can

487
00:17:56,150 --> 00:17:58,160
tie this back to some of those previous

488
00:17:58,160 --> 00:18:00,260
tools that we mentioned but furthermore

489
00:18:00,260 --> 00:18:02,210
now we can start looking at file paths

490
00:18:02,210 --> 00:18:05,090
on disk okay so now we've got the

491
00:18:05,090 --> 00:18:07,280
executable name right team TeamViewer

492
00:18:07,280 --> 00:18:10,370
service dot et we've got a whole listing

493
00:18:10,370 --> 00:18:12,170
of dll's that are associated with that

494
00:18:12,170 --> 00:18:14,420
so if you're familiar with dll's and I'm

495
00:18:14,420 --> 00:18:16,400
not a dll expert but I can scan through

496
00:18:16,400 --> 00:18:17,930
there and some of the things I would

497
00:18:17,930 --> 00:18:20,390
look for is is there any dll's that

498
00:18:20,390 --> 00:18:22,430
indicates some kind of network activity

499
00:18:22,430 --> 00:18:26,150
or network functionality encryption or

500
00:18:26,150 --> 00:18:28,340
decryption some of the other kind of

501
00:18:28,340 --> 00:18:29,810
things that typically would show up

502
00:18:29,810 --> 00:18:31,250
because that would start giving me an

503
00:18:31,250 --> 00:18:33,380
idea of what this tool this dual use

504
00:18:33,380 --> 00:18:34,880
tool does if I don't already know

505
00:18:34,880 --> 00:18:37,220
another thing to look at is the file

506
00:18:37,220 --> 00:18:40,010
paths here are these or any of these

507
00:18:40,010 --> 00:18:42,350
file paths suspicious now they all look

508
00:18:42,350 --> 00:18:43,580
like they're pretty normal to me

509
00:18:43,580 --> 00:18:45,590
they're under the windows system32 or

510
00:18:45,590 --> 00:18:47,000
sis wild directory but what if they're

511
00:18:47,000 --> 00:18:49,820
underneath a user accounts file path or

512
00:18:49,820 --> 00:18:51,260
what if they're underneath a temp file

513
00:18:51,260 --> 00:18:52,910
path that might be something to look

514
00:18:52,910 --> 00:18:53,740
into

515
00:18:53,740 --> 00:18:56,620
so this is loaded dynamic link libraries

516
00:18:56,620 --> 00:19:01,430
so what we have here is current ports PS

517
00:19:01,430 --> 00:19:04,040
lists logon sessions and lists dll's and

518
00:19:04,040 --> 00:19:05,690
that's going to get us network

519
00:19:05,690 --> 00:19:07,850
connections running processes user

520
00:19:07,850 --> 00:19:11,000
sessions as well as those loaded dll's

521
00:19:11,000 --> 00:19:14,510
so let's move to step B step B is

522
00:19:14,510 --> 00:19:17,120
information it's not as volatile but

523
00:19:17,120 --> 00:19:18,560
it's something that we want to get next

524
00:19:18,560 --> 00:19:19,790
as soon as possible and then we'll move

525
00:19:19,790 --> 00:19:21,650
into step C and D which is stuff that's

526
00:19:21,650 --> 00:19:25,280
more on disk and is you know less likely

527
00:19:25,280 --> 00:19:27,530
to chain as change is often as this

528
00:19:27,530 --> 00:19:29,810
things in step a and B so we want to

529
00:19:29,810 --> 00:19:31,310
prioritize things and make sure we cover

530
00:19:31,310 --> 00:19:33,980
volatile data and this stuff in step B

531
00:19:33,980 --> 00:19:35,480
and then we can get the stuff that's on

532
00:19:35,480 --> 00:19:38,450
disk a bit later so these four things

533
00:19:38,450 --> 00:19:41,240
that we want to look at are five six and

534
00:19:41,240 --> 00:19:43,640
seven tools windows events are the

535
00:19:43,640 --> 00:19:46,940
artifacts persistence mechanisms system

536
00:19:46,940 --> 00:19:49,940
audit okay and I'm sorry there's only

537
00:19:49,940 --> 00:19:53,030
three tools in this step and then we

538
00:19:53,030 --> 00:19:55,340
want to see how these map to those fast

539
00:19:55,340 --> 00:19:58,100
five plus so step B live system auditing

540
00:19:58,100 --> 00:20:01,520
PS log list this is a sysinternals tool

541
00:20:01,520 --> 00:20:02,809
as well and

542
00:20:02,809 --> 00:20:04,940
this will go ahead and collect the

543
00:20:04,940 --> 00:20:07,210
information that are in the system

544
00:20:07,210 --> 00:20:10,669
security and application event logs okay

545
00:20:10,669 --> 00:20:12,110
and if you're familiar with event

546
00:20:12,110 --> 00:20:13,610
logging nowadays with the modern

547
00:20:13,610 --> 00:20:15,440
operating systems of Windows

548
00:20:15,440 --> 00:20:17,749
there's plenty beyond these big three of

549
00:20:17,749 --> 00:20:19,220
event logs but typically for

550
00:20:19,220 --> 00:20:21,440
investigations these three are the ones

551
00:20:21,440 --> 00:20:23,120
that are going to give you the

552
00:20:23,120 --> 00:20:25,429
information that you need as as quickly

553
00:20:25,429 --> 00:20:28,669
as possible so with the EVT X format

554
00:20:28,669 --> 00:20:30,350
you're going to need to have a tool to

555
00:20:30,350 --> 00:20:32,629
open that either Windows itself or a

556
00:20:32,629 --> 00:20:34,669
third party tool but the good thing

557
00:20:34,669 --> 00:20:37,100
about PS log list is as we're collecting

558
00:20:37,100 --> 00:20:37,730
that data

559
00:20:37,730 --> 00:20:39,679
we're actually parsing it and putting it

560
00:20:39,679 --> 00:20:42,110
into a simple readable output in this

561
00:20:42,110 --> 00:20:43,970
particular case it's going to be a CSV

562
00:20:43,970 --> 00:20:46,840
form so that we can open it up with

563
00:20:46,840 --> 00:20:50,049
Microsoft Excel or you notepad plus plus

564
00:20:50,049 --> 00:20:52,549
so the contents and it all depends on

565
00:20:52,549 --> 00:20:54,049
the type of log but generally you're

566
00:20:54,049 --> 00:20:55,940
going to get a log name a source a date

567
00:20:55,940 --> 00:20:58,970
and time the event ID the user account

568
00:20:58,970 --> 00:21:00,740
associated with it in a general

569
00:21:00,740 --> 00:21:03,470
description so PS log list again it's a

570
00:21:03,470 --> 00:21:05,899
command line tool you're going to have

571
00:21:05,899 --> 00:21:09,200
to specify each time you run this the

572
00:21:09,200 --> 00:21:11,090
specific log that you want to collect in

573
00:21:11,090 --> 00:21:13,369
parse so that would be the security and

574
00:21:13,369 --> 00:21:15,200
then you'd run your application and

575
00:21:15,200 --> 00:21:16,669
you're on your system log okay to

576
00:21:16,669 --> 00:21:17,840
collect this would be three different

577
00:21:17,840 --> 00:21:20,119
times you're gonna have to do that so

578
00:21:20,119 --> 00:21:21,740
the output would look something like

579
00:21:21,740 --> 00:21:23,869
this and I simplified this for today's

580
00:21:23,869 --> 00:21:25,460
presentation I removed some of the

581
00:21:25,460 --> 00:21:27,710
columns but essentially here when we're

582
00:21:27,710 --> 00:21:30,019
looking at the system log we can see

583
00:21:30,019 --> 00:21:32,570
date and time stamps that's good with

584
00:21:32,570 --> 00:21:34,610
our timeline analysis but we can see the

585
00:21:34,610 --> 00:21:37,220
user account and here's that JK HCK our

586
00:21:37,220 --> 00:21:40,309
user account and we can see it's

587
00:21:40,309 --> 00:21:43,039
associated here on this particular time

588
00:21:43,039 --> 00:21:45,740
with TeamViewer okay and we can see the

589
00:21:45,740 --> 00:21:47,869
file path of TeamViewer and we can also

590
00:21:47,869 --> 00:21:49,429
see a little bit of persistence here it

591
00:21:49,429 --> 00:21:52,700
says auto start as well as the next line

592
00:21:52,700 --> 00:21:55,730
down here you can see this is very crypt

593
00:21:55,730 --> 00:21:57,110
and this is that other dual use tool

594
00:21:57,110 --> 00:21:59,119
that I was talking about we can also see

595
00:21:59,119 --> 00:22:01,190
here some persistence indications that

596
00:22:01,190 --> 00:22:03,169
it's a it's set to start up when the

597
00:22:03,169 --> 00:22:05,629
system starts ok so we've got a little

598
00:22:05,629 --> 00:22:07,309
bit more fidelity here in terms what

599
00:22:07,309 --> 00:22:09,289
we're seeing with these do yields dual

600
00:22:09,289 --> 00:22:10,850
use tools we're also seeing another

601
00:22:10,850 --> 00:22:12,980
evidence source that's confirming that

602
00:22:12,980 --> 00:22:14,990
this account is associated with this

603
00:22:14,990 --> 00:22:16,810
activity

604
00:22:16,810 --> 00:22:19,760
tool number six autoruns

605
00:22:19,760 --> 00:22:23,410
see this is sysinternals tool as well

606
00:22:23,410 --> 00:22:25,580
this is going to give us currently

607
00:22:25,580 --> 00:22:27,590
configured auto start applications so we

608
00:22:27,590 --> 00:22:29,330
did see some indications of persistence

609
00:22:29,330 --> 00:22:31,000
in the previous slide the previous tool

610
00:22:31,000 --> 00:22:33,860
this this tool will actually run against

611
00:22:33,860 --> 00:22:36,200
the live system and it will give us all

612
00:22:36,200 --> 00:22:38,780
the known to date depending on the

613
00:22:38,780 --> 00:22:41,060
version of auto starts known persistence

614
00:22:41,060 --> 00:22:43,190
locations or Auto Start locations that

615
00:22:43,190 --> 00:22:45,260
are out there this could be this could

616
00:22:45,260 --> 00:22:47,960
be anything from a registry entry to a

617
00:22:47,960 --> 00:22:50,240
file path to something that has to do

618
00:22:50,240 --> 00:22:53,900
with a BHO for your browser so this

619
00:22:53,900 --> 00:22:55,940
outputs going to give you various

620
00:22:55,940 --> 00:22:58,610
including services scheduled tasks and

621
00:22:58,610 --> 00:23:01,610
other things such as drivers dll's and

622
00:23:01,610 --> 00:23:04,730
whatnot so I ran out of runs and let me

623
00:23:04,730 --> 00:23:06,800
tell you real quick before I run this

624
00:23:06,800 --> 00:23:08,330
there's two versions of auto runs

625
00:23:08,330 --> 00:23:09,920
there's the GUI version which is just

626
00:23:09,920 --> 00:23:12,020
Auto runs in the version with the C

627
00:23:12,020 --> 00:23:13,880
after it which stands for command prompt

628
00:23:13,880 --> 00:23:16,460
a console is the one we want to run with

629
00:23:16,460 --> 00:23:19,460
the the command prompt okay so we can

630
00:23:19,460 --> 00:23:21,980
specify here to show all entries with

631
00:23:21,980 --> 00:23:24,530
the options we can specify here output

632
00:23:24,530 --> 00:23:27,020
the CSV format and then we can also

633
00:23:27,020 --> 00:23:29,120
verify signatures if we want and that's

634
00:23:29,120 --> 00:23:30,440
going to take a little bit more time but

635
00:23:30,440 --> 00:23:31,850
I recommend doing that because that

636
00:23:31,850 --> 00:23:33,920
could be helpful as well we're trying to

637
00:23:33,920 --> 00:23:35,840
determine the output and whether it's

638
00:23:35,840 --> 00:23:41,270
it's suspicious or not so here's just a

639
00:23:41,270 --> 00:23:44,210
snippet in CSV format of the autoruns

640
00:23:44,210 --> 00:23:46,460
output and you can see in the very left

641
00:23:46,460 --> 00:23:48,410
hand side we've got some timestamps here

642
00:23:48,410 --> 00:23:50,990
we've got the entry location each one of

643
00:23:50,990 --> 00:23:52,670
these is related to the Windows registry

644
00:23:52,670 --> 00:23:55,340
and you can see in red font here I've

645
00:23:55,340 --> 00:23:57,560
got TeamViewer and veracrypt highlighted

646
00:23:57,560 --> 00:24:00,800
okay and we can see the category of auto

647
00:24:00,800 --> 00:24:03,440
starts so this first one TeamViewer is a

648
00:24:03,440 --> 00:24:05,450
service and the second one that's

649
00:24:05,450 --> 00:24:07,750
highlighted there is a driver okay

650
00:24:07,750 --> 00:24:10,970
profile system-wide and then we've got a

651
00:24:10,970 --> 00:24:12,440
little bit of description the publisher

652
00:24:12,440 --> 00:24:14,690
and we've got the file path again that

653
00:24:14,690 --> 00:24:15,830
should match up with what we've seen

654
00:24:15,830 --> 00:24:18,080
already with for example this dll's

655
00:24:18,080 --> 00:24:19,880
output and then we can see the launch

656
00:24:19,880 --> 00:24:21,560
string so we've got a little bit more to

657
00:24:21,560 --> 00:24:24,380
look at now this is just a snippet of

658
00:24:24,380 --> 00:24:26,420
the autoruns output there's plenty of

659
00:24:26,420 --> 00:24:29,360
other things that came out from this so

660
00:24:29,360 --> 00:24:30,020
I

661
00:24:30,020 --> 00:24:31,190
you know encourage you if you haven't

662
00:24:31,190 --> 00:24:33,110
used this tool before play around with

663
00:24:33,110 --> 00:24:35,870
it look at it explore see what all it

664
00:24:35,870 --> 00:24:38,360
provides in terms of fidelity of auto

665
00:24:38,360 --> 00:24:43,460
start locations number seven tool went

666
00:24:43,460 --> 00:24:46,850
on it so this tool is a tool from Parma

667
00:24:46,850 --> 00:24:49,550
vac services called win audit you can

668
00:24:49,550 --> 00:24:50,990
download this as well and I have the

669
00:24:50,990 --> 00:24:53,150
link on the next slide this will give

670
00:24:53,150 --> 00:24:55,910
you a lot of information from an

671
00:24:55,910 --> 00:24:57,980
auditing standpoint that you can use for

672
00:24:57,980 --> 00:24:59,720
your investigation or for your incident

673
00:24:59,720 --> 00:25:02,180
response purposes a lot of the

674
00:25:02,180 --> 00:25:04,700
information here that's provided doubles

675
00:25:04,700 --> 00:25:06,080
up with some of the other tools that

676
00:25:06,080 --> 00:25:08,360
we've mentioned so if you're not able to

677
00:25:08,360 --> 00:25:10,070
run those other tools you can run this

678
00:25:10,070 --> 00:25:12,980
and it'll it'll it'll provide a for

679
00:25:12,980 --> 00:25:15,050
example a list of network connections a

680
00:25:15,050 --> 00:25:17,900
list of running processes but what I

681
00:25:17,900 --> 00:25:19,640
want to use this for is some other

682
00:25:19,640 --> 00:25:21,290
things and I'll get to that when I show

683
00:25:21,290 --> 00:25:24,380
you the example here so this will give a

684
00:25:24,380 --> 00:25:26,150
system overview they don't give us

685
00:25:26,150 --> 00:25:27,860
installed software without even having

686
00:25:27,860 --> 00:25:31,070
the disk image security settings it'll

687
00:25:31,070 --> 00:25:33,110
give us groups and users and as I

688
00:25:33,110 --> 00:25:34,580
mentioned earlier network settings and

689
00:25:34,580 --> 00:25:36,620
connections services some of the stuff

690
00:25:36,620 --> 00:25:40,490
that autoruns provided so here's the

691
00:25:40,490 --> 00:25:44,180
link here Permatex co uk here's the

692
00:25:44,180 --> 00:25:45,320
command prompt and you're probably

693
00:25:45,320 --> 00:25:47,420
wondering those options that's pretty

694
00:25:47,420 --> 00:25:50,300
crazy if you run the GUI version to win

695
00:25:50,300 --> 00:25:53,630
on it you have you have a menu that you

696
00:25:53,630 --> 00:25:56,120
can check what it what it'll run an

697
00:25:56,120 --> 00:25:58,880
audit for you ok and that menus got a

698
00:25:58,880 --> 00:26:01,430
couple dozen different options so these

699
00:26:01,430 --> 00:26:03,080
options here that I've strung together

700
00:26:03,080 --> 00:26:05,180
are the ones that I've found that are

701
00:26:05,180 --> 00:26:06,920
most useful for the forensic

702
00:26:06,920 --> 00:26:10,100
investigations that I do so anyways you

703
00:26:10,100 --> 00:26:11,780
can run this either command prompt or

704
00:26:11,780 --> 00:26:14,600
GUI this is just a simple output into

705
00:26:14,600 --> 00:26:16,880
CSV and what we can see here from this

706
00:26:16,880 --> 00:26:18,500
system audit again we haven't collected

707
00:26:18,500 --> 00:26:20,630
the disk or anything or any logs we can

708
00:26:20,630 --> 00:26:23,480
see that Windows Firewall an authorized

709
00:26:23,480 --> 00:26:26,000
application is TeamViewer remote control

710
00:26:26,000 --> 00:26:29,000
service ok so one of the things I would

711
00:26:29,000 --> 00:26:31,460
ask the victim organization is if I

712
00:26:31,460 --> 00:26:32,840
haven't already asked that question as

713
00:26:32,840 --> 00:26:34,640
do you run TeamViewer is that a tool you

714
00:26:34,640 --> 00:26:37,760
use if not you've got it running here

715
00:26:37,760 --> 00:26:41,450
and it's a service and someone with

716
00:26:41,450 --> 00:26:43,610
admin privileges had to to

717
00:26:43,610 --> 00:26:45,950
to authorize this or put this into play

718
00:26:45,950 --> 00:26:48,440
and then as we look down here we can see

719
00:26:48,440 --> 00:26:50,840
a list of the administrators and there's

720
00:26:50,840 --> 00:26:54,620
at JK h c KR so you know I'm pretty sure

721
00:26:54,620 --> 00:26:56,540
that this is probably not a legitimate

722
00:26:56,540 --> 00:26:58,429
account in fact the first time I'd see

723
00:26:58,429 --> 00:26:59,570
it I bring it up to the victim

724
00:26:59,570 --> 00:27:02,030
organization just to make sure so this

725
00:27:02,030 --> 00:27:03,650
definitely looks like it's something

726
00:27:03,650 --> 00:27:05,270
suspicious and if I haven't already

727
00:27:05,270 --> 00:27:07,280
determined that it was a minister a Turk

728
00:27:07,280 --> 00:27:09,530
ount I can see by virtue of went on it

729
00:27:09,530 --> 00:27:11,870
that it's labeled it as an administrator

730
00:27:11,870 --> 00:27:16,730
account okay so that's step B so that's

731
00:27:16,730 --> 00:27:19,370
PS log list our Windows event logs again

732
00:27:19,370 --> 00:27:22,370
those big three application pieces and

733
00:27:22,370 --> 00:27:25,490
security persistence mechanisms using

734
00:27:25,490 --> 00:27:28,160
system journals on a run C and then went

735
00:27:28,160 --> 00:27:30,679
on it to audit the system and get some a

736
00:27:30,679 --> 00:27:33,049
little bit more granularity in terms of

737
00:27:33,049 --> 00:27:34,790
what's going on on the system the

738
00:27:34,790 --> 00:27:37,970
security settings and whatnot so let's

739
00:27:37,970 --> 00:27:39,860
go and collect some things off of disk

740
00:27:39,860 --> 00:27:41,690
so this is step C and we're gonna use

741
00:27:41,690 --> 00:27:43,970
two tools to do this and I'll I'll show

742
00:27:43,970 --> 00:27:45,110
you what those tools are in a couple

743
00:27:45,110 --> 00:27:47,270
slides here well what we want to collect

744
00:27:47,270 --> 00:27:50,059
is the NTFS Master File table okay

745
00:27:50,059 --> 00:27:52,549
that's going to give us a listing of all

746
00:27:52,549 --> 00:27:54,559
of the files that are on that volume so

747
00:27:54,559 --> 00:27:57,290
keep in mind if you have various NTFS

748
00:27:57,290 --> 00:27:59,000
volumes you're gonna have two there's

749
00:27:59,000 --> 00:28:00,440
going to be an MFT and on each one of

750
00:28:00,440 --> 00:28:03,140
those right so typically the ones I'm

751
00:28:03,140 --> 00:28:06,260
interested in are the ones that have the

752
00:28:06,260 --> 00:28:08,480
MF T's that are on the same volume as

753
00:28:08,480 --> 00:28:10,429
the operating system okay but if you

754
00:28:10,429 --> 00:28:12,320
have other partitions in NTFS there's

755
00:28:12,320 --> 00:28:14,299
going to be separate and MFT so you're

756
00:28:14,299 --> 00:28:15,799
gonna have to grab those as well if

757
00:28:15,799 --> 00:28:17,090
that's part of the scope of your

758
00:28:17,090 --> 00:28:19,400
investigation so we want to grab the MFT

759
00:28:19,400 --> 00:28:20,600
because it's going to give us a list of

760
00:28:20,600 --> 00:28:21,890
files it's going to also give us

761
00:28:21,890 --> 00:28:24,020
timestamps it's also going to give us a

762
00:28:24,020 --> 00:28:25,760
little bit more information - in terms

763
00:28:25,760 --> 00:28:28,010
of those files we're gonna look at the

764
00:28:28,010 --> 00:28:29,780
Windows registry and grab those Windus

765
00:28:29,780 --> 00:28:32,660
tree high windows registry hives as well

766
00:28:32,660 --> 00:28:35,150
as the NT user dot files and the user

767
00:28:35,150 --> 00:28:36,770
class that files and I'll explain a

768
00:28:36,770 --> 00:28:38,929
little bit more about those later and

769
00:28:38,929 --> 00:28:40,340
we're gonna use a second tool to grab

770
00:28:40,340 --> 00:28:42,200
the Windows prefetch and then we're

771
00:28:42,200 --> 00:28:44,630
gonna grab the browser history and the

772
00:28:44,630 --> 00:28:45,950
wonderful thing about the tool that I'm

773
00:28:45,950 --> 00:28:47,210
gonna mention about the browser history

774
00:28:47,210 --> 00:28:50,230
is it's not just one type of browser

775
00:28:50,230 --> 00:28:52,250
history that it'll capture it'll capture

776
00:28:52,250 --> 00:28:54,950
the four main browsers that we tend to

777
00:28:54,950 --> 00:28:57,200
see nowadays either the Internet

778
00:28:57,200 --> 00:28:57,620
Explorer

779
00:28:57,620 --> 00:29:02,210
edge browser the Firefox the Safari or

780
00:29:02,210 --> 00:29:06,020
the Chrome browser okay so this is what

781
00:29:06,020 --> 00:29:06,920
we're gonna do we're gonna go ahead and

782
00:29:06,920 --> 00:29:09,710
collect and preserve those files those

783
00:29:09,710 --> 00:29:12,170
main files from disk now you're probably

784
00:29:12,170 --> 00:29:13,340
wondering why aren't we grabbing the

785
00:29:13,340 --> 00:29:15,290
windows event logs we can certainly do

786
00:29:15,290 --> 00:29:17,510
that but we've already parsed them with

787
00:29:17,510 --> 00:29:19,850
PS log list just you know probably if

788
00:29:19,850 --> 00:29:22,010
the bad script runs just seconds prior

789
00:29:22,010 --> 00:29:24,740
to this but you can certainly use these

790
00:29:24,740 --> 00:29:26,000
two tools I'm going to talk about to

791
00:29:26,000 --> 00:29:27,650
grab those event logs and you can

792
00:29:27,650 --> 00:29:29,630
certainly grab other files as well but

793
00:29:29,630 --> 00:29:31,910
just for the tactical practical of what

794
00:29:31,910 --> 00:29:33,710
we're doing these are the big files I

795
00:29:33,710 --> 00:29:36,530
want to grab off a disk so raw file

796
00:29:36,530 --> 00:29:39,620
collection number eight tool raw copy 64

797
00:29:39,620 --> 00:29:42,230
this is a 64-bit version of it this is a

798
00:29:42,230 --> 00:29:44,630
tool from Joakim Schmidt or schickt and

799
00:29:44,630 --> 00:29:46,970
you can download it from this link here

800
00:29:46,970 --> 00:29:50,870
a github link and it copies files to

801
00:29:50,870 --> 00:29:53,990
include inaccessible files off of NTFS

802
00:29:53,990 --> 00:29:56,809
volumes so if you've done forensics it's

803
00:29:56,809 --> 00:29:59,360
really you you've got to use a tool like

804
00:29:59,360 --> 00:30:02,030
ftk imager on a live system or something

805
00:30:02,030 --> 00:30:04,370
similar to be able to grab those system

806
00:30:04,370 --> 00:30:07,820
files like NTFS MFT okay otherwise

807
00:30:07,820 --> 00:30:10,910
you're gonna have to get an image of the

808
00:30:10,910 --> 00:30:13,580
disk and then go that way with with the

809
00:30:13,580 --> 00:30:15,920
image to pull out the files you need so

810
00:30:15,920 --> 00:30:17,660
the wonderful thing with raw copy with a

811
00:30:17,660 --> 00:30:19,850
live system we can go ahead and access

812
00:30:19,850 --> 00:30:22,940
that MFT and pull a copy of it off of

813
00:30:22,940 --> 00:30:25,790
the disk so it's a command prompt the

814
00:30:25,790 --> 00:30:27,559
one thing I just wanted to say about the

815
00:30:27,559 --> 00:30:30,590
MFT is it's number it's file number is

816
00:30:30,590 --> 00:30:35,270
zero so you need to specify zero to pull

817
00:30:35,270 --> 00:30:37,910
off the MFT with this raw copy if you're

818
00:30:37,910 --> 00:30:39,170
going to be pulling off any other files

819
00:30:39,170 --> 00:30:41,090
and you can just specify the file name

820
00:30:41,090 --> 00:30:46,250
and the file path so raw copy we're

821
00:30:46,250 --> 00:30:48,679
gonna use that to collect the master

822
00:30:48,679 --> 00:30:50,660
file table and then very similarly we're

823
00:30:50,660 --> 00:30:51,950
going to collect the Windows registry

824
00:30:51,950 --> 00:30:53,720
and if you're not familiar with the

825
00:30:53,720 --> 00:30:55,070
Windows registry what we're looking to

826
00:30:55,070 --> 00:30:57,770
collect is those four hives that are

827
00:30:57,770 --> 00:31:00,559
going to be on disk the Sam the security

828
00:31:00,559 --> 00:31:03,860
system and software hives and then I

829
00:31:03,860 --> 00:31:05,870
mentioned earlier the NT user dot files

830
00:31:05,870 --> 00:31:08,960
and the user class dot bat files so

831
00:31:08,960 --> 00:31:11,660
command prompt with raw copy is

832
00:31:11,660 --> 00:31:14,800
is simply specifying the path of that

833
00:31:14,800 --> 00:31:19,400
registry hive and then for the ant user

834
00:31:19,400 --> 00:31:22,910
debt and user class data its specifying

835
00:31:22,910 --> 00:31:24,860
the locations of those two debt files

836
00:31:24,860 --> 00:31:27,980
for that user account so your approach

837
00:31:27,980 --> 00:31:29,930
could be to just grab those specific

838
00:31:29,930 --> 00:31:32,570
files to that suspicious account JK

839
00:31:32,570 --> 00:31:34,760
hacker or you can just go ahead and grab

840
00:31:34,760 --> 00:31:36,740
all of the ant user debt and user class

841
00:31:36,740 --> 00:31:39,080
dat files for the other users just in

842
00:31:39,080 --> 00:31:41,300
case your scope expands but it's all up

843
00:31:41,300 --> 00:31:44,600
to you and the second to one mentioned

844
00:31:44,600 --> 00:31:46,640
is robocopy this comes with Microsoft's

845
00:31:46,640 --> 00:31:48,050
you can find it under the system32

846
00:31:48,050 --> 00:31:51,050
directory on your operating system your

847
00:31:51,050 --> 00:31:53,780
windows 7 or newer actually robocopy

848
00:31:53,780 --> 00:31:55,550
goes back in time so you can you know

849
00:31:55,550 --> 00:31:57,740
find it as well on previous versions of

850
00:31:57,740 --> 00:32:00,500
Windows there's some options here we

851
00:32:00,500 --> 00:32:02,330
want to copy all we also want to use the

852
00:32:02,330 --> 00:32:04,460
the logging function within there so

853
00:32:04,460 --> 00:32:06,470
here we're going to use robocopy to

854
00:32:06,470 --> 00:32:08,420
capture the Windows prefetch files and

855
00:32:08,420 --> 00:32:09,590
if you're not familiar with the prefetch

856
00:32:09,590 --> 00:32:12,140
files prefetching there's two types of

857
00:32:12,140 --> 00:32:13,910
prefetch files basically there's one for

858
00:32:13,910 --> 00:32:15,890
booting and one for applications you

859
00:32:15,890 --> 00:32:18,290
want to grab all of those dot PF files

860
00:32:18,290 --> 00:32:21,020
because these are artifacts and indicate

861
00:32:21,020 --> 00:32:23,780
if something has executed right

862
00:32:23,780 --> 00:32:25,850
the system's booted but also if an

863
00:32:25,850 --> 00:32:27,650
application is executed and you can get

864
00:32:27,650 --> 00:32:30,530
some some nice granularity from other

865
00:32:30,530 --> 00:32:32,420
prefetch files in terms of the history

866
00:32:32,420 --> 00:32:34,130
of that application and I'll talk about

867
00:32:34,130 --> 00:32:39,260
that in a few slides so we're gonna use

868
00:32:39,260 --> 00:32:42,020
raw copy and robocopy for the browser

869
00:32:42,020 --> 00:32:42,680
history

870
00:32:42,680 --> 00:32:45,260
so tool number seven and tool which

871
00:32:45,260 --> 00:32:47,090
which should be number eight robocopy

872
00:32:47,090 --> 00:32:50,570
and the reason why we got to do this is

873
00:32:50,570 --> 00:32:54,050
raw copy will grab the web cache v01 dot

874
00:32:54,050 --> 00:32:56,270
files for your internet explorer edge

875
00:32:56,270 --> 00:32:58,670
okay but we also want to get those

876
00:32:58,670 --> 00:33:01,940
unwritten browser events that haven't

877
00:33:01,940 --> 00:33:04,610
been included in the web cache files and

878
00:33:04,610 --> 00:33:07,760
those are those are log files okay so we

879
00:33:07,760 --> 00:33:09,710
need to use robocopy to grab those log

880
00:33:09,710 --> 00:33:11,450
files that's the latest browser data

881
00:33:11,450 --> 00:33:13,400
that just hasn't been written to the web

882
00:33:13,400 --> 00:33:16,880
cache v01 dot dat file so we need to use

883
00:33:16,880 --> 00:33:19,100
both a combination of raw copy and an

884
00:33:19,100 --> 00:33:21,830
accommodation or and with robocopy to

885
00:33:21,830 --> 00:33:24,890
get both of those sets of files there's

886
00:33:24,890 --> 00:33:25,789
a lot more to

887
00:33:25,789 --> 00:33:27,950
this and analyzing this I just wanted to

888
00:33:27,950 --> 00:33:30,200
point out that the tools can grab all

889
00:33:30,200 --> 00:33:32,419
the browser history that's been recorded

890
00:33:32,419 --> 00:33:37,100
for particular browser so mapping the 13

891
00:33:37,100 --> 00:33:41,090
must-haves to the fast 5o step a B and C

892
00:33:41,090 --> 00:33:43,609
we've done step C we've grabbed some of

893
00:33:43,609 --> 00:33:46,009
those disk files now we need to parse

894
00:33:46,009 --> 00:33:48,529
those disk files so this will be stools

895
00:33:48,529 --> 00:33:53,539
10 11 12 and 13 first thing let's go

896
00:33:53,539 --> 00:33:57,019
ahead and parse the MFT so a wonderful

897
00:33:57,019 --> 00:34:00,830
thing about a a volatile data parsing

898
00:34:00,830 --> 00:34:02,239
tool called volatility if you're not

899
00:34:02,239 --> 00:34:03,769
familiar with it it's got multiple

900
00:34:03,769 --> 00:34:06,710
plugins for parsing a memory dump you

901
00:34:06,710 --> 00:34:08,809
can also use one of these plugins called

902
00:34:08,809 --> 00:34:11,629
MFT parser to parse the MFT file itself

903
00:34:11,629 --> 00:34:14,780
okay I actually found that out by but

904
00:34:14,780 --> 00:34:17,089
just playing around with it and and sure

905
00:34:17,089 --> 00:34:18,319
enough you can actually use this

906
00:34:18,319 --> 00:34:21,069
volatility plugin to parse the MFT

907
00:34:21,069 --> 00:34:24,260
so we pulled that MFT off of the c

908
00:34:24,260 --> 00:34:25,819
volume in this particular case it had

909
00:34:25,819 --> 00:34:28,099
the operating system now what do we do

910
00:34:28,099 --> 00:34:30,109
with it well we can go ahead and run

911
00:34:30,109 --> 00:34:33,319
volatility MFT parser which is available

912
00:34:33,319 --> 00:34:35,379
at downloads that volatility

913
00:34:35,379 --> 00:34:38,839
foundation.org and parse that and get an

914
00:34:38,839 --> 00:34:40,940
output very similar to this so if you

915
00:34:40,940 --> 00:34:42,799
look at this and you can actually

916
00:34:42,799 --> 00:34:44,929
control the different types of outputs

917
00:34:44,929 --> 00:34:46,609
this one here I prefer this a table

918
00:34:46,609 --> 00:34:50,210
output that gives me each entry and and

919
00:34:50,210 --> 00:34:53,899
the MFT could be 10 10 20 30 or more

920
00:34:53,899 --> 00:34:55,940
megabytes in size you're going to be

921
00:34:55,940 --> 00:34:58,309
simplifying that raw file down to

922
00:34:58,309 --> 00:34:59,660
something that's human readable in a

923
00:34:59,660 --> 00:35:02,990
text file and here for example what I've

924
00:35:02,990 --> 00:35:04,579
got highlighted here is the TeamViewer

925
00:35:04,579 --> 00:35:09,140
setup.exe prefetch file okay so this

926
00:35:09,140 --> 00:35:11,240
tells me a couple things well it sounds

927
00:35:11,240 --> 00:35:12,619
like it's a setup file so this is

928
00:35:12,619 --> 00:35:14,390
probably the pre fetch that was used to

929
00:35:14,390 --> 00:35:17,000
initially set up TeamViewer right I

930
00:35:17,000 --> 00:35:18,410
don't want to make an assumption but I

931
00:35:18,410 --> 00:35:19,609
could probably make pretty educated

932
00:35:19,609 --> 00:35:20,930
guess and I'd have to double-check that

933
00:35:20,930 --> 00:35:23,359
and so it's it's actually a prefetch

934
00:35:23,359 --> 00:35:25,160
file so it tells me it ran at least one

935
00:35:25,160 --> 00:35:28,309
time ok and I can see some timestamps

936
00:35:28,309 --> 00:35:30,109
here I've got the file name attribute

937
00:35:30,109 --> 00:35:31,520
and I've got the standard information

938
00:35:31,520 --> 00:35:33,140
attribute timestamps

939
00:35:33,140 --> 00:35:35,089
okay so prefetch file it's not going to

940
00:35:35,089 --> 00:35:36,410
be really helpful if I'm looking for

941
00:35:36,410 --> 00:35:38,000
time stopping which is out of the scope

942
00:35:38,000 --> 00:35:38,960
of today

943
00:35:38,960 --> 00:35:40,520
but when you look at the MFT you can

944
00:35:40,520 --> 00:35:42,200
compare these timestamps to see if

945
00:35:42,200 --> 00:35:43,520
there's a difference and it could

946
00:35:43,520 --> 00:35:44,930
indicate that somebody's been time

947
00:35:44,930 --> 00:35:47,500
stomping the the date time stands for

948
00:35:47,500 --> 00:35:50,780
four files but here what I'm seeing here

949
00:35:50,780 --> 00:35:53,150
is I can add to my my time line here of

950
00:35:53,150 --> 00:35:56,060
activity when this prefetch file was

951
00:35:56,060 --> 00:35:57,619
first created could give me an

952
00:35:57,619 --> 00:35:59,720
indication of when it potentially first

953
00:35:59,720 --> 00:36:01,640
ran and some other information that

954
00:36:01,640 --> 00:36:05,089
modified as well as the access date okay

955
00:36:05,089 --> 00:36:06,589
so I'm gonna want to look at this

956
00:36:06,589 --> 00:36:08,540
prefetch file later on and dig into it

957
00:36:08,540 --> 00:36:09,920
and see what other artifacts I can pull

958
00:36:09,920 --> 00:36:13,520
out tool number eleven is read ripper

959
00:36:13,520 --> 00:36:16,040
this is a tool that can parse the

960
00:36:16,040 --> 00:36:19,520
Windows registry it's in terms of the

961
00:36:19,520 --> 00:36:20,780
Windows registry if you're not familiar

962
00:36:20,780 --> 00:36:22,490
with it there's four main hives so

963
00:36:22,490 --> 00:36:23,930
they're gonna be on disk they're gonna

964
00:36:23,930 --> 00:36:26,660
be the Sam security software and system

965
00:36:26,660 --> 00:36:28,609
and I mentioned earlier there's also the

966
00:36:28,609 --> 00:36:30,380
into user dot and user class dot dot

967
00:36:30,380 --> 00:36:33,530
files so this tool Red River from by

968
00:36:33,530 --> 00:36:36,290
harvan car Harlan Carvey is downloadable

969
00:36:36,290 --> 00:36:38,720
from github this will go ahead and parse

970
00:36:38,720 --> 00:36:40,369
those hives but you got to collect those

971
00:36:40,369 --> 00:36:42,890
highs first and you can use the command

972
00:36:42,890 --> 00:36:44,420
prompt version of this there's also a

973
00:36:44,420 --> 00:36:46,670
GUI version it's more like a framework

974
00:36:46,670 --> 00:36:48,440
so folks out there in the community have

975
00:36:48,440 --> 00:36:50,510
written various different plugins for

976
00:36:50,510 --> 00:36:52,960
red ripper and those are all

977
00:36:52,960 --> 00:36:56,510
downloadable from github as well so with

978
00:36:56,510 --> 00:36:57,859
the Red Nosed registry this is just an

979
00:36:57,859 --> 00:37:00,170
example the software hive in one of the

980
00:37:00,170 --> 00:37:02,510
plugins that ran this is the uninstall

981
00:37:02,510 --> 00:37:04,040
plugin this will give us a list of

982
00:37:04,040 --> 00:37:06,200
software that's on the system and here

983
00:37:06,200 --> 00:37:08,660
we can see the TeamViewer and we can see

984
00:37:08,660 --> 00:37:12,109
the veracrypt as listed within this

985
00:37:12,109 --> 00:37:15,109
Windows registry path right here ok and

986
00:37:15,109 --> 00:37:16,790
we've got some timestamps as well with

987
00:37:16,790 --> 00:37:18,950
both of these files so that's good to

988
00:37:18,950 --> 00:37:19,130
know

989
00:37:19,130 --> 00:37:22,880
let's go ahead and parse the NT user dot

990
00:37:22,880 --> 00:37:24,410
dot file and I'll show you example here

991
00:37:24,410 --> 00:37:27,410
here's the NT user dot dot file and this

992
00:37:27,410 --> 00:37:29,359
is the application compatibility Flags

993
00:37:29,359 --> 00:37:32,660
plugin and this is going to give us some

994
00:37:32,660 --> 00:37:35,990
information here for both team viewer as

995
00:37:35,990 --> 00:37:38,540
well as the veracrypt setup and we can

996
00:37:38,540 --> 00:37:40,339
see the file path that falls under that

997
00:37:40,339 --> 00:37:43,160
suspicious user account we've also got

998
00:37:43,160 --> 00:37:45,650
user assist down here in this plugin

999
00:37:45,650 --> 00:37:47,770
that was written is going to give us

1000
00:37:47,770 --> 00:37:51,559
user assist which is when a user's use

1001
00:37:51,559 --> 00:37:54,529
in Windows Explorer to run an executable

1002
00:37:54,529 --> 00:37:57,109
it's going to be recorded in here so

1003
00:37:57,109 --> 00:37:58,670
we're gonna see some more timestamps

1004
00:37:58,670 --> 00:37:59,839
here we've got veracrypt

1005
00:37:59,839 --> 00:38:03,259
we've also got veracrypt set up being in

1006
00:38:03,259 --> 00:38:05,930
a directory that's got downloads within

1007
00:38:05,930 --> 00:38:08,359
the file path so this is kind of like oh

1008
00:38:08,359 --> 00:38:10,160
this is right maybe this is where these

1009
00:38:10,160 --> 00:38:11,630
tools came from that's sounding like

1010
00:38:11,630 --> 00:38:13,819
it's coming from potentially the browser

1011
00:38:13,819 --> 00:38:17,719
so remember one of those big five things

1012
00:38:17,719 --> 00:38:19,729
that we're looking to solve as how did

1013
00:38:19,729 --> 00:38:22,099
these tools or the threat actor get into

1014
00:38:22,099 --> 00:38:24,079
the system so we might have a browser

1015
00:38:24,079 --> 00:38:25,670
thing going on right here but let's

1016
00:38:25,670 --> 00:38:27,410
let's let's hold off on that and parse

1017
00:38:27,410 --> 00:38:29,809
the browser here in a little bit so the

1018
00:38:29,809 --> 00:38:31,759
windows prefetch view this is going to

1019
00:38:31,759 --> 00:38:34,549
be tool number twelve and this is a tool

1020
00:38:34,549 --> 00:38:37,640
from near soft and the file path of the

1021
00:38:37,640 --> 00:38:39,969
prefetch is going to be C Windows

1022
00:38:39,969 --> 00:38:42,469
prefetch and then the executable file

1023
00:38:42,469 --> 00:38:46,099
name within the prefetch file okay so

1024
00:38:46,099 --> 00:38:47,479
when we look inside each one of these

1025
00:38:47,479 --> 00:38:49,400
prefetches will see the original egg

1026
00:38:49,400 --> 00:38:52,579
beautiful will see last run time see the

1027
00:38:52,579 --> 00:38:54,140
run counter how many times that

1028
00:38:54,140 --> 00:38:56,449
executable ran will see a listing of

1029
00:38:56,449 --> 00:38:58,429
dll's and then we'll see additional

1030
00:38:58,429 --> 00:38:59,869
things such as files and directories

1031
00:38:59,869 --> 00:39:03,469
used so win prefetch file available from

1032
00:39:03,469 --> 00:39:06,079
near softs and we're gonna output this

1033
00:39:06,079 --> 00:39:09,439
to CSV format again command prompt and

1034
00:39:09,439 --> 00:39:13,009
here's an output from that tool and you

1035
00:39:13,009 --> 00:39:16,009
can see here in red we've got various

1036
00:39:16,009 --> 00:39:19,999
different TeamViewer related files here

1037
00:39:19,999 --> 00:39:22,369
that are found in prefetch so it's

1038
00:39:22,369 --> 00:39:25,819
telling me that these executables ran at

1039
00:39:25,819 --> 00:39:28,069
least once okay but if you look at this

1040
00:39:28,069 --> 00:39:30,890
and if you remember PS list which was

1041
00:39:30,890 --> 00:39:32,449
tool number two we did see some

1042
00:39:32,449 --> 00:39:34,729
additional processes that look like they

1043
00:39:34,729 --> 00:39:36,979
were associated with TeamViewer two of

1044
00:39:36,979 --> 00:39:39,289
them started with T V we can see here

1045
00:39:39,289 --> 00:39:40,640
there's some prefetch files that look

1046
00:39:40,640 --> 00:39:42,229
like they correlate with those those

1047
00:39:42,229 --> 00:39:45,859
processes that were running the second

1048
00:39:45,859 --> 00:39:46,910
column here is the the original

1049
00:39:46,910 --> 00:39:50,390
executable and then the last run time

1050
00:39:50,390 --> 00:39:52,369
and then the run counter is gonna tell

1051
00:39:52,369 --> 00:39:55,189
us how many times that executable ran

1052
00:39:55,189 --> 00:39:58,849
and was recorded in this instance of

1053
00:39:58,849 --> 00:40:01,729
prefetch now someone could come in there

1054
00:40:01,729 --> 00:40:03,559
and clear out the prefetch and then the

1055
00:40:03,559 --> 00:40:05,190
prefetch files would would be

1056
00:40:05,190 --> 00:40:06,839
you later each time those executables

1057
00:40:06,839 --> 00:40:09,300
ran so keep that in mind that just

1058
00:40:09,300 --> 00:40:11,130
because this run count for example says

1059
00:40:11,130 --> 00:40:13,050
three doesn't mean that was the only

1060
00:40:13,050 --> 00:40:16,200
three times that this executable ran on

1061
00:40:16,200 --> 00:40:17,940
the system somebody could have cleared

1062
00:40:17,940 --> 00:40:19,619
out the original prefetch and it's

1063
00:40:19,619 --> 00:40:20,819
starting in the counter started all over

1064
00:40:20,819 --> 00:40:23,310
again the one thing I didn't mention is

1065
00:40:23,310 --> 00:40:24,450
you're probably wondering what these

1066
00:40:24,450 --> 00:40:26,369
alpha numerics are and the the second

1067
00:40:26,369 --> 00:40:28,589
half of the filename so the first half

1068
00:40:28,589 --> 00:40:31,260
of the PF or the prefetch file is going

1069
00:40:31,260 --> 00:40:32,910
to have the original executable name and

1070
00:40:32,910 --> 00:40:34,710
then these alpha numerics here are going

1071
00:40:34,710 --> 00:40:38,760
to give you it's basically gonna it's a

1072
00:40:38,760 --> 00:40:42,420
way of making the prefetch file unique

1073
00:40:42,420 --> 00:40:45,000
because the same executable could be in

1074
00:40:45,000 --> 00:40:46,980
on the system in multiple places in

1075
00:40:46,980 --> 00:40:49,859
multiple file paths and run from those

1076
00:40:49,859 --> 00:40:52,650
file paths so this alpha numeric here is

1077
00:40:52,650 --> 00:40:54,810
telling the it's it's a way that the

1078
00:40:54,810 --> 00:40:56,640
system can to determine where that

1079
00:40:56,640 --> 00:41:00,140
application ran from on the system for

1080
00:41:00,140 --> 00:41:02,490
kind of a clumsy way of explaining it

1081
00:41:02,490 --> 00:41:05,760
and down here we've also got veracrypt

1082
00:41:05,760 --> 00:41:07,410
looking like there's three different

1083
00:41:07,410 --> 00:41:09,119
files associated with that that ran in

1084
00:41:09,119 --> 00:41:12,750
the past two nor thirteen browsing

1085
00:41:12,750 --> 00:41:14,790
history view so this is another near

1086
00:41:14,790 --> 00:41:17,490
soft tool this particular example on

1087
00:41:17,490 --> 00:41:19,230
this show with Internet Explorer I

1088
00:41:19,230 --> 00:41:22,050
mentioned web cache v01 dot dat in the

1089
00:41:22,050 --> 00:41:25,290
past so this will actually parse the web

1090
00:41:25,290 --> 00:41:28,109
cache file it'll give you an output of

1091
00:41:28,109 --> 00:41:30,329
user profile the web browser the visit

1092
00:41:30,329 --> 00:41:33,800
time and date to visit count in the URL

1093
00:41:33,800 --> 00:41:36,869
so it's a command prompt tool the one

1094
00:41:36,869 --> 00:41:37,800
thing I wanted to point out and I

1095
00:41:37,800 --> 00:41:39,780
pointed this out earlier is it'll do

1096
00:41:39,780 --> 00:41:43,710
multiple opera browsers the Safari the

1097
00:41:43,710 --> 00:41:46,109
Firefox the internet explorer edge as

1098
00:41:46,109 --> 00:41:50,130
well as the chrome okay and the good

1099
00:41:50,130 --> 00:41:51,540
thing too is if you're running it

1100
00:41:51,540 --> 00:41:54,630
against the system it'll go ahead in

1101
00:41:54,630 --> 00:41:57,930
this particular example in parts the

1102
00:41:57,930 --> 00:41:59,310
different browsers

1103
00:41:59,310 --> 00:42:01,680
regardless of the browser you don't have

1104
00:42:01,680 --> 00:42:04,200
to specify that every time so here we

1105
00:42:04,200 --> 00:42:07,020
can see in this output that Jake a

1106
00:42:07,020 --> 00:42:11,310
hacker using Chrome was looking doing a

1107
00:42:11,310 --> 00:42:14,700
search on Google for veracrypt and then

1108
00:42:14,700 --> 00:42:16,200
he was also doing a search on Google

1109
00:42:16,200 --> 00:42:18,180
Google for Team Viewer and we've got

1110
00:42:18,180 --> 00:42:18,779
times

1111
00:42:18,779 --> 00:42:22,949
for that down here we've got some more

1112
00:42:22,949 --> 00:42:26,309
in browser activity by JK hacker with

1113
00:42:26,309 --> 00:42:28,140
chrome but sandwich Street in the middle

1114
00:42:28,140 --> 00:42:30,299
here is Internet Explorer so this is a

1115
00:42:30,299 --> 00:42:31,529
second browser that we're gonna have to

1116
00:42:31,529 --> 00:42:35,939
look at okay so coming to the end here

1117
00:42:35,939 --> 00:42:38,039
so mapping the 13 must-haves to the fast

1118
00:42:38,039 --> 00:42:42,949
5 we did four steps a B C and D 13 tools

1119
00:42:42,949 --> 00:42:45,900
within each of those steps that map to

1120
00:42:45,900 --> 00:42:47,279
the artifacts there in the middle column

1121
00:42:47,279 --> 00:42:50,039
and then these further map to those fast

1122
00:42:50,039 --> 00:42:52,319
five the execution indicators the access

1123
00:42:52,319 --> 00:42:54,059
vectors involved accounts relevant

1124
00:42:54,059 --> 00:42:57,299
artifacts and security posture one of

1125
00:42:57,299 --> 00:42:58,859
the final actions you want to take and

1126
00:42:58,859 --> 00:43:00,869
these are the output files here just

1127
00:43:00,869 --> 00:43:03,869
listed ABC and D is you want to go ahead

1128
00:43:03,869 --> 00:43:05,729
and hash those files so one of the

1129
00:43:05,729 --> 00:43:07,589
things you can use is Jessie corn blooms

1130
00:43:07,589 --> 00:43:10,229
md5 deep Jessie corn bloom and Simpson

1131
00:43:10,229 --> 00:43:12,689
Garfinkel I should say you can run md5

1132
00:43:12,689 --> 00:43:14,939
deep against all of those texts and CSV

1133
00:43:14,939 --> 00:43:16,619
outputs and the raw files that you

1134
00:43:16,619 --> 00:43:20,489
collected and have an output that gives

1135
00:43:20,489 --> 00:43:22,679
you all the md5 hashes those files that

1136
00:43:22,679 --> 00:43:26,009
you can store in your case notes so

1137
00:43:26,009 --> 00:43:28,319
takeaways the 13 must have tile tools

1138
00:43:28,319 --> 00:43:30,659
that I mentioned most of these are

1139
00:43:30,659 --> 00:43:33,479
either collecting and parsing and in the

1140
00:43:33,479 --> 00:43:35,669
case of raw robocopy and raw copy we're

1141
00:43:35,669 --> 00:43:37,529
just collecting we're gonna have to use

1142
00:43:37,529 --> 00:43:39,630
for other tools the MFT parser read rip

1143
00:43:39,630 --> 00:43:41,369
or wind prefetch for you and browsing

1144
00:43:41,369 --> 00:43:43,349
history view to go ahead and parse those

1145
00:43:43,349 --> 00:43:45,479
as you can see i'm highlighted here with

1146
00:43:45,479 --> 00:43:48,869
the text files and in cs5 is v files are

1147
00:43:48,869 --> 00:43:51,359
the output so again use notepad plus

1148
00:43:51,359 --> 00:43:53,159
plus or Microsoft Excel to open that up

1149
00:43:53,159 --> 00:43:55,169
and do your parsing your searching or

1150
00:43:55,169 --> 00:43:59,369
whatnot and then mapping these as well

1151
00:43:59,369 --> 00:44:01,499
to those fast fives as I mentioned

1152
00:44:01,499 --> 00:44:04,769
earlier the approach was execution

1153
00:44:04,769 --> 00:44:06,630
indicators access vectors involved

1154
00:44:06,630 --> 00:44:08,869
accounts relevant artifacts or I OCS

1155
00:44:08,869 --> 00:44:10,890
security posture data exfiltration

1156
00:44:10,890 --> 00:44:13,949
incident timeline and expanded scope so

1157
00:44:13,949 --> 00:44:15,719
incident timeline we can answer that

1158
00:44:15,719 --> 00:44:17,939
with right answer the question of when

1159
00:44:17,939 --> 00:44:20,369
breached access vectors how accessed

1160
00:44:20,369 --> 00:44:23,569
data exfiltration how exfiltrated

1161
00:44:23,569 --> 00:44:27,419
execution indicators what malware and we

1162
00:44:27,419 --> 00:44:28,859
can also answer those questions about

1163
00:44:28,859 --> 00:44:30,779
involved accounts the relevant artifacts

1164
00:44:30,779 --> 00:44:32,130
security posture and expand

1165
00:44:32,130 --> 00:44:35,910
scope and finally we can determine what

1166
00:44:35,910 --> 00:44:39,000
happened and resolve the in the actual

1167
00:44:39,000 --> 00:44:41,190
incident itself it brings me to the end

1168
00:44:41,190 --> 00:44:44,910
I know we're out of time so I'll go

1169
00:44:44,910 --> 00:44:46,140
ahead and I'll be here for the next few

1170
00:44:46,140 --> 00:44:47,880
minutes if anybody has any questions but

1171
00:44:47,880 --> 00:44:49,350
thank you very much for your time and

1172
00:44:49,350 --> 00:44:51,130
have a wonderful afternoon

1173
00:44:51,130 --> 00:44:59,699
[Applause]

