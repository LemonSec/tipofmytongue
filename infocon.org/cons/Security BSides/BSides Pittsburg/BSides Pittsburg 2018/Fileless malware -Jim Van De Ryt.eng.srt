1
00:00:00,089 --> 00:00:03,030
next we have Jim and he is going to talk

2
00:00:03,030 --> 00:00:04,740
about some current trends on living off

3
00:00:04,740 --> 00:00:07,319
the land and this is fireless malware

4
00:00:07,319 --> 00:00:18,180
let's give him a hand okay just making

5
00:00:18,180 --> 00:00:20,250
sure that mic one mic is off and the

6
00:00:20,250 --> 00:00:21,840
other one is on so otherwise gonna have

7
00:00:21,840 --> 00:00:26,250
some bad feedback too baby I been doing

8
00:00:26,250 --> 00:00:28,590
the cybersecurity or what yous called

9
00:00:28,590 --> 00:00:31,009
information security for about 18 years

10
00:00:31,009 --> 00:00:33,989
different work for customer done

11
00:00:33,989 --> 00:00:36,329
reseller done vendor currently worked

12
00:00:36,329 --> 00:00:38,550
for a vendor so just as a heads up this

13
00:00:38,550 --> 00:00:40,680
is very just informational about what's

14
00:00:40,680 --> 00:00:42,930
going on right now can you guys hear me

15
00:00:42,930 --> 00:00:49,280
okay so so so so okay there we go

16
00:00:49,280 --> 00:00:52,079
so we'll go through the agenda we'll

17
00:00:52,079 --> 00:00:53,640
just go through what typically

18
00:00:53,640 --> 00:00:56,010
traditional malware was concerned and

19
00:00:56,010 --> 00:00:59,550
now what's called fireless malware file

20
00:00:59,550 --> 00:01:02,340
is malware is kind of a BS industry term

21
00:01:02,340 --> 00:01:06,600
it's literally for whatever reason got

22
00:01:06,600 --> 00:01:09,659
tagged to be file as malware versus like

23
00:01:09,659 --> 00:01:11,790
once you're in an environment using

24
00:01:11,790 --> 00:01:13,080
tools that are already there

25
00:01:13,080 --> 00:01:17,009
aka living off the land okay so but if

26
00:01:17,009 --> 00:01:19,170
you research it you go to dark reading

27
00:01:19,170 --> 00:01:20,520
and you want to find out something about

28
00:01:20,520 --> 00:01:23,009
it or one of those other websites with

29
00:01:23,009 --> 00:01:25,619
good info files malware is what you look

30
00:01:25,619 --> 00:01:28,619
for okay so we'll go through a little

31
00:01:28,619 --> 00:01:32,130
bit of history some newer variants talk

32
00:01:32,130 --> 00:01:34,950
about what the current trend is for

33
00:01:34,950 --> 00:01:37,380
living off the land by attackers and

34
00:01:37,380 --> 00:01:39,329
that kind of detecting some of it from

35
00:01:39,329 --> 00:01:42,090
the current tool set that you have in

36
00:01:42,090 --> 00:01:46,200
your environment so of course you got to

37
00:01:46,200 --> 00:01:48,869
do the dictation Wikipedia definition

38
00:01:48,869 --> 00:01:53,579
here traditional where for most people

39
00:01:53,579 --> 00:01:56,659
think would be have a executable

40
00:01:56,659 --> 00:01:59,490
associated with it although fireless

41
00:01:59,490 --> 00:02:01,950
malware goes back quite far and then if

42
00:02:01,950 --> 00:02:05,850
you were in brian satirist talk before

43
00:02:05,850 --> 00:02:08,250
he talked about powershell and going all

44
00:02:08,250 --> 00:02:10,979
the way back to using VBS with the

45
00:02:10,979 --> 00:02:13,830
i-love-you virus i didn't quite go back

46
00:02:13,830 --> 00:02:17,310
that far in the history but 2001 so a

47
00:02:17,310 --> 00:02:19,680
couple year different but Philo's

48
00:02:19,680 --> 00:02:21,870
malware is literally usually defined by

49
00:02:21,870 --> 00:02:26,700
a few things okay no files usually it

50
00:02:26,700 --> 00:02:28,680
does one of a few things it exploits a

51
00:02:28,680 --> 00:02:30,480
vulnerability and that's what used to

52
00:02:30,480 --> 00:02:34,130
happen very frequently with you know

53
00:02:34,130 --> 00:02:37,740
that's why ids/ips was born and it would

54
00:02:37,740 --> 00:02:41,190
like advantage of a vulnerable operating

55
00:02:41,190 --> 00:02:44,280
system or application in fact that maybe

56
00:02:44,280 --> 00:02:47,400
reside in memory and that's quote file

57
00:02:47,400 --> 00:02:51,900
us or plant itself in the registry for

58
00:02:51,900 --> 00:02:54,860
persistence perhaps again quote file us

59
00:02:54,860 --> 00:02:57,570
so these kind of definitions are what

60
00:02:57,570 --> 00:03:01,050
make it quote file as malware if you

61
00:03:01,050 --> 00:03:03,270
guys have questions please don't wait to

62
00:03:03,270 --> 00:03:08,610
the end just raise your hand okay so I

63
00:03:08,610 --> 00:03:10,680
did some research on this actually when

64
00:03:10,680 --> 00:03:13,770
I started here here this company about

65
00:03:13,770 --> 00:03:15,630
six months ago I was told I had to be

66
00:03:15,630 --> 00:03:18,300
give a talk to 158 people at the North

67
00:03:18,300 --> 00:03:22,230
Texas Issa and I had to come up with the

68
00:03:22,230 --> 00:03:23,940
subject was relevant to what was

69
00:03:23,940 --> 00:03:26,760
happening in the industry today so I did

70
00:03:26,760 --> 00:03:29,040
some research and I come across this

71
00:03:29,040 --> 00:03:32,340
dark reading article published in

72
00:03:32,340 --> 00:03:35,070
December around file is malware I'm like

73
00:03:35,070 --> 00:03:37,560
what is Phi literally what is files

74
00:03:37,560 --> 00:03:39,390
malware was my question so I did a lot

75
00:03:39,390 --> 00:03:40,500
of research into it

76
00:03:40,500 --> 00:03:44,250
and dug into several sources and found

77
00:03:44,250 --> 00:03:46,140
out that there's some general consensus

78
00:03:46,140 --> 00:03:48,720
between 50 and 60 percent of all malware

79
00:03:48,720 --> 00:03:52,080
and 2017 and the key pieces ere is that

80
00:03:52,080 --> 00:03:54,930
the second half of the year was really

81
00:03:54,930 --> 00:03:57,000
when it took off and the only reason

82
00:03:57,000 --> 00:03:59,010
that file is malware quote files malware

83
00:03:59,010 --> 00:04:01,200
exists or living off the land is to

84
00:04:01,200 --> 00:04:04,560
evade detection so once you do get into

85
00:04:04,560 --> 00:04:06,540
an environment rather than downloading

86
00:04:06,540 --> 00:04:10,190
something that has an IOC hash match or

87
00:04:10,190 --> 00:04:13,860
command and control domain or URL that

88
00:04:13,860 --> 00:04:16,380
your current controls can catch or that

89
00:04:16,380 --> 00:04:18,149
you can Det detonate in and malware

90
00:04:18,149 --> 00:04:20,548
sandbox or whatever it might be it's

91
00:04:20,548 --> 00:04:22,530
just another way to get around current

92
00:04:22,530 --> 00:04:26,010
controls the key piece about that is is

93
00:04:26,010 --> 00:04:27,490
there's not a whole lot of IOC

94
00:04:27,490 --> 00:04:29,380
that are left behind if you ever use

95
00:04:29,380 --> 00:04:32,229
PowerShell or used this management

96
00:04:32,229 --> 00:04:34,810
instrumentation command line nothing

97
00:04:34,810 --> 00:04:37,930
really is left behind - fine unless you

98
00:04:37,930 --> 00:04:41,979
are watching it during it happening so

99
00:04:41,979 --> 00:04:43,479
we'll dig into a little bit of this this

100
00:04:43,479 --> 00:04:46,620
is the very very abridged history of

101
00:04:46,620 --> 00:04:51,729
file as malware so who can tell me why

102
00:04:51,729 --> 00:04:54,729
Code Red and back in 2001 is called Code

103
00:04:54,729 --> 00:05:03,819
Red yep yeah that's correct yeah

104
00:05:03,819 --> 00:05:06,909
actually yeah it was a company called AI

105
00:05:06,909 --> 00:05:09,130
partners back in the day that was a

106
00:05:09,130 --> 00:05:11,860
threat that Ike did a lot of antivirus D

107
00:05:11,860 --> 00:05:15,819
compilation and investigation on viral

108
00:05:15,819 --> 00:05:18,090
what was happening in the virus space

109
00:05:18,090 --> 00:05:21,310
the vulnerability exploitation that kind

110
00:05:21,310 --> 00:05:23,710
of thing and they actually named it this

111
00:05:23,710 --> 00:05:25,599
because they were drinking Code Red

112
00:05:25,599 --> 00:05:28,870
anyway it's one of the farthest back

113
00:05:28,870 --> 00:05:32,110
ones and Brian steer did bring up at the

114
00:05:32,110 --> 00:05:36,310
i-love-you virus which was VBS 2000 this

115
00:05:36,310 --> 00:05:38,530
about that same time there were a lot

116
00:05:38,530 --> 00:05:40,599
more scripting things that took

117
00:05:40,599 --> 00:05:42,789
advantage of a vulnerability not

118
00:05:42,789 --> 00:05:44,740
necessarily came in an email although I

119
00:05:44,740 --> 00:05:47,680
love you was one of the first ones with

120
00:05:47,680 --> 00:05:51,039
that said Code Red was an interesting

121
00:05:51,039 --> 00:05:53,469
thing because it was one of the first

122
00:05:53,469 --> 00:05:56,979
real worms out there that got loose what

123
00:05:56,979 --> 00:05:58,270
it would do is it would take advantage

124
00:05:58,270 --> 00:06:01,900
of a vulnerable iis server and back then

125
00:06:01,900 --> 00:06:03,639
they weren't behind a firewall

126
00:06:03,639 --> 00:06:06,039
oftentimes right on the internet without

127
00:06:06,039 --> 00:06:08,560
much protection and they would take

128
00:06:08,560 --> 00:06:11,229
advantage of that vulnerability and it

129
00:06:11,229 --> 00:06:14,099
would create 99 threads to exploit

130
00:06:14,099 --> 00:06:16,539
additional IP addresses on the internet

131
00:06:16,539 --> 00:06:19,389
so to spread itself to wherever it could

132
00:06:19,389 --> 00:06:22,000
find on the Internet and then it would

133
00:06:22,000 --> 00:06:24,880
deface the webpage boy we could just go

134
00:06:24,880 --> 00:06:26,259
back to the days when all you had to

135
00:06:26,259 --> 00:06:28,979
worry about web face to page web face

136
00:06:28,979 --> 00:06:33,219
webpage defacement I don't know if you

137
00:06:33,219 --> 00:06:35,620
guys remember back in the day when this

138
00:06:35,620 --> 00:06:38,529
this was one of the web face the web

139
00:06:38,529 --> 00:06:41,139
page to face mints was Air Tran

140
00:06:41,139 --> 00:06:44,949
Aaron had a plane go down and they with

141
00:06:44,949 --> 00:06:47,710
this somebody defaced her website and

142
00:06:47,710 --> 00:06:50,889
it's kind of I guess he the hacker humor

143
00:06:50,889 --> 00:06:53,199
at the time had two plane going down in

144
00:06:53,199 --> 00:06:55,120
flames and people on fire falling out of

145
00:06:55,120 --> 00:06:57,129
the plane so they tried to you know kill

146
00:06:57,129 --> 00:06:59,110
the brand or whatever it might be

147
00:06:59,110 --> 00:07:02,620
sequel slammer was a unique one I

148
00:07:02,620 --> 00:07:04,629
remember back in the day this one was

149
00:07:04,629 --> 00:07:08,349
almost impossible to stop was a concept

150
00:07:08,349 --> 00:07:12,159
at blackhat for a buffer overflow in

151
00:07:12,159 --> 00:07:15,520
Microsoft sequel and actually somebody

152
00:07:15,520 --> 00:07:19,750
used it and did something with it the

153
00:07:19,750 --> 00:07:21,430
unique part about it was is it was a one

154
00:07:21,430 --> 00:07:26,919
packet UDP attack and there's nothing I

155
00:07:26,919 --> 00:07:29,379
don't think today even still how are you

156
00:07:29,379 --> 00:07:31,870
gonna stop that there's no session even

157
00:07:31,870 --> 00:07:34,779
in ids/ips in one packet goes right by

158
00:07:34,779 --> 00:07:35,189
it

159
00:07:35,189 --> 00:07:39,339
so it's very difficult to stop but

160
00:07:39,339 --> 00:07:41,379
backed up here that I got off the

161
00:07:41,379 --> 00:07:43,060
internet said seventy-five thousand

162
00:07:43,060 --> 00:07:44,439
machines in ten minutes but it was

163
00:07:44,439 --> 00:07:46,270
actually every single machine that was

164
00:07:46,270 --> 00:07:48,009
vulnerable on the internet happened in

165
00:07:48,009 --> 00:07:52,449
under 11 minutes so very fast spreading

166
00:07:52,449 --> 00:07:54,520
worm so some of the fast faster

167
00:07:54,520 --> 00:07:55,539
spreading pieces

168
00:07:55,539 --> 00:07:57,279
now we're gonna fast forward because

169
00:07:57,279 --> 00:07:59,789
otherwise we'll be here all day

170
00:07:59,789 --> 00:08:04,300
so Pollux is a more modern still not

171
00:08:04,300 --> 00:08:07,300
really the most modern but more modern

172
00:08:07,300 --> 00:08:11,469
type of quote file as malware this one

173
00:08:11,469 --> 00:08:14,289
did use a vulnerability and you'll

174
00:08:14,289 --> 00:08:16,330
notice is we get newer and newer they're

175
00:08:16,330 --> 00:08:19,089
not using vulnerabilities to to get into

176
00:08:19,089 --> 00:08:22,389
the organization they're using more more

177
00:08:22,389 --> 00:08:24,250
along the lines of phishing emails and

178
00:08:24,250 --> 00:08:25,330
that type of thing to get in the

179
00:08:25,330 --> 00:08:28,240
organization but this one did exploit a

180
00:08:28,240 --> 00:08:30,580
remote privilege escalation

181
00:08:30,580 --> 00:08:33,820
vulnerability and the cool part about it

182
00:08:33,820 --> 00:08:35,740
was for the first time it used

183
00:08:35,740 --> 00:08:38,320
unreadable Unicode characters in the

184
00:08:38,320 --> 00:08:40,479
registry so why the registry could

185
00:08:40,479 --> 00:08:42,490
interpret it the humans could not and so

186
00:08:42,490 --> 00:08:44,709
it was a good way to hide itself

187
00:08:44,709 --> 00:08:47,589
also if you anytime you double clicked

188
00:08:47,589 --> 00:08:50,350
on a folder open a folder it would that

189
00:08:50,350 --> 00:08:51,670
was this one of its persistence

190
00:08:51,670 --> 00:08:54,660
mechanisms and also had a watchdog

191
00:08:54,660 --> 00:08:56,790
stuff that typical mallet where does

192
00:08:56,790 --> 00:09:00,690
today but this is one of the ones in the

193
00:09:00,690 --> 00:09:04,130
quote file is from aka registry entries

194
00:09:04,130 --> 00:09:06,779
that was what this is one of the first

195
00:09:06,779 --> 00:09:11,850
ones that did that you guys have

196
00:09:11,850 --> 00:09:13,920
probably seen this before before and

197
00:09:13,920 --> 00:09:17,670
somewhere there were screen lockers so

198
00:09:17,670 --> 00:09:20,220
copter copter started out as a screen

199
00:09:20,220 --> 00:09:23,370
locker and quotes care where to try and

200
00:09:23,370 --> 00:09:24,930
get people to give them you know enter

201
00:09:24,930 --> 00:09:26,250
some sort of money

202
00:09:26,250 --> 00:09:28,410
much like ransomware to unlock your

203
00:09:28,410 --> 00:09:32,640
screen copter has evolved it started out

204
00:09:32,640 --> 00:09:36,089
as a pretty normal this is almost all it

205
00:09:36,089 --> 00:09:39,269
did copter has actually really been used

206
00:09:39,269 --> 00:09:42,779
more recently and ransomware and there's

207
00:09:42,779 --> 00:09:45,870
a lot of updates that it's posing as

208
00:09:45,870 --> 00:09:49,769
update so for Chrome Firefox whatever it

209
00:09:49,769 --> 00:09:50,399
might be

210
00:09:50,399 --> 00:09:52,350
and for a while it was used for malvert

211
00:09:52,350 --> 00:09:54,480
izing so pretty flexible piece of quote

212
00:09:54,480 --> 00:09:58,230
file a soft malware out there it's still

213
00:09:58,230 --> 00:10:00,870
around today is ransomware and then

214
00:10:00,870 --> 00:10:05,160
let's fast forward to 2017 some of this

215
00:10:05,160 --> 00:10:08,399
we're starting to be developed in 2016

216
00:10:08,399 --> 00:10:10,800
and this is being used pretty

217
00:10:10,800 --> 00:10:12,390
extensively you'll notice one thing

218
00:10:12,390 --> 00:10:17,430
about every single one of these find one

219
00:10:17,430 --> 00:10:19,140
word that's the same in all four of

220
00:10:19,140 --> 00:10:21,270
these that's right

221
00:10:21,270 --> 00:10:23,940
living off the land what what is in the

222
00:10:23,940 --> 00:10:27,420
environment so another piece is is

223
00:10:27,420 --> 00:10:30,980
there's another word in three of them

224
00:10:30,980 --> 00:10:36,180
yeah macro evil macro well you know the

225
00:10:36,180 --> 00:10:39,089
idea here is that when you do you have a

226
00:10:39,089 --> 00:10:43,850
macro the compiled hash still looks like

227
00:10:43,850 --> 00:10:48,300
the word or Excel or whatever it is but

228
00:10:48,300 --> 00:10:50,279
the macro can contain some bad code in

229
00:10:50,279 --> 00:10:55,680
it and be launched so usually what these

230
00:10:55,680 --> 00:10:58,350
do is they come in as a map in the side

231
00:10:58,350 --> 00:11:00,779
of a macro they launch PowerShell into

232
00:11:00,779 --> 00:11:02,930
memory and then they do your dirty work

233
00:11:02,930 --> 00:11:05,160
unusually they get in by a phishing

234
00:11:05,160 --> 00:11:06,410
attack

235
00:11:06,410 --> 00:11:09,500
one of the interesting ones power wear

236
00:11:09,500 --> 00:11:13,880
is a really unique way to use PowerShell

237
00:11:13,880 --> 00:11:16,580
to encrypt the entire system for a quote

238
00:11:16,580 --> 00:11:17,380
ransomware

239
00:11:17,380 --> 00:11:21,620
this is not one usually used to encrypt

240
00:11:21,620 --> 00:11:23,300
and then ask for money

241
00:11:23,300 --> 00:11:25,790
it usually used to encrypt and make it

242
00:11:25,790 --> 00:11:28,700
forensic ly inaccessible because it is a

243
00:11:28,700 --> 00:11:31,580
script that's downloaded to encrypt the

244
00:11:31,580 --> 00:11:37,550
machine power where is as a result you

245
00:11:37,550 --> 00:11:39,380
know usually there's an anything left to

246
00:11:39,380 --> 00:11:42,350
pop up anything on the screen or send

247
00:11:42,350 --> 00:11:44,300
you an email or whatever to tell you

248
00:11:44,300 --> 00:11:46,700
that there give me to give me money to

249
00:11:46,700 --> 00:11:49,280
unencrypted your machine August was a

250
00:11:49,280 --> 00:11:51,530
unique one and this is a you know

251
00:11:51,530 --> 00:11:53,660
they're always trying to obfuscate the

252
00:11:53,660 --> 00:11:56,780
data whether it's base64 encoding used

253
00:11:56,780 --> 00:12:00,440
on the PowerShell with PowerShell or XOR

254
00:12:00,440 --> 00:12:02,360
encoding or whatever it might be or

255
00:12:02,360 --> 00:12:05,740
compression used a PowerShell byte array

256
00:12:05,740 --> 00:12:08,600
which PowerShell interprets just fine

257
00:12:08,600 --> 00:12:10,880
everything's good there but if you've

258
00:12:10,880 --> 00:12:13,850
ever looked at a byte array to the

259
00:12:13,850 --> 00:12:16,400
office gate that takes some considerable

260
00:12:16,400 --> 00:12:18,140
time to find out what the real command

261
00:12:18,140 --> 00:12:21,410
was so that was pretty unique parsed by

262
00:12:21,410 --> 00:12:27,830
which also if you did go to Brian was it

263
00:12:27,830 --> 00:12:28,910
cetera cetera

264
00:12:28,910 --> 00:12:32,000
yeah Duchin he also talked about posh by

265
00:12:32,000 --> 00:12:34,190
one of unique things about this one is

266
00:12:34,190 --> 00:12:37,310
it started using WMI we didn't see this

267
00:12:37,310 --> 00:12:39,800
a whole lot just the PowerShell is more

268
00:12:39,800 --> 00:12:41,720
is really ubiquitous and almost all

269
00:12:41,720 --> 00:12:43,100
Windows environments back to what I

270
00:12:43,100 --> 00:12:46,310
think it's Windows Server 2003 I think

271
00:12:46,310 --> 00:12:49,310
it is so that was that's what still is

272
00:12:49,310 --> 00:12:51,880
most commonly used with fireless malware

273
00:12:51,880 --> 00:12:55,280
but WMI is starting to pop up a lot more

274
00:12:55,280 --> 00:12:56,630
and we'll talk about that in a little

275
00:12:56,630 --> 00:13:00,340
bit any questions so far

276
00:13:00,370 --> 00:13:03,980
okay we'll go over why PowerShell is

277
00:13:03,980 --> 00:13:05,660
currently the tool of choice for living

278
00:13:05,660 --> 00:13:07,100
Elfland like we talked about it's

279
00:13:07,100 --> 00:13:10,370
everywhere it's generally trusted

280
00:13:10,370 --> 00:13:12,230
because used by sis admins to get the

281
00:13:12,230 --> 00:13:15,620
job done another one is is that it's

282
00:13:15,620 --> 00:13:17,570
easy to downgrade nobody's watching a

283
00:13:17,570 --> 00:13:19,730
downgrade of PowerShell

284
00:13:19,730 --> 00:13:22,550
version 3 and version 5 both have

285
00:13:22,550 --> 00:13:24,740
auditing capabilities and you can go get

286
00:13:24,740 --> 00:13:27,620
download there's a couple of guides

287
00:13:27,620 --> 00:13:30,949
turning on auditing to be able to audit

288
00:13:30,949 --> 00:13:32,709
for bad stuff happening in PowerShell

289
00:13:32,709 --> 00:13:35,720
but if the attacker downgrades into

290
00:13:35,720 --> 00:13:37,670
version 2 it wipes out auditing

291
00:13:37,670 --> 00:13:39,440
completely and that's usually one of the

292
00:13:39,440 --> 00:13:40,579
first things they'll do if they find

293
00:13:40,579 --> 00:13:41,750
version 3 or 5

294
00:13:41,750 --> 00:13:44,870
now you can't monitor the system to

295
00:13:44,870 --> 00:13:46,579
watch for the downgrade that's another

296
00:13:46,579 --> 00:13:50,449
thing you might want to do ok it's also

297
00:13:50,449 --> 00:13:51,320
stealthy

298
00:13:51,320 --> 00:13:53,500
it can load a couple of different ways

299
00:13:53,500 --> 00:13:55,940
load directly into memory as we talked

300
00:13:55,940 --> 00:13:58,790
about another pieces is the system

301
00:13:58,790 --> 00:14:03,110
automation DLL which is commonly used in

302
00:14:03,110 --> 00:14:04,820
environments does not even show up in

303
00:14:04,820 --> 00:14:06,740
task manager it's doesn't show up as a

304
00:14:06,740 --> 00:14:08,779
service so when it does load into memory

305
00:14:08,779 --> 00:14:11,300
even if you did a process listing it's

306
00:14:11,300 --> 00:14:12,949
not there and it's you know this is

307
00:14:12,949 --> 00:14:14,570
these are normal tools that your system

308
00:14:14,570 --> 00:14:16,399
is used ok this is not the bad guys

309
00:14:16,399 --> 00:14:18,500
doing anything awful what's your sir

310
00:14:18,500 --> 00:14:21,459
using what exists in the environment

311
00:14:21,459 --> 00:14:23,720
like we talked about doesn't leave many

312
00:14:23,720 --> 00:14:26,720
artifacts behind is encrypted between

313
00:14:26,720 --> 00:14:33,260
machines that's another piece and let me

314
00:14:33,260 --> 00:14:34,940
go ahead and through here real quick

315
00:14:34,940 --> 00:14:37,790
often off you skated in some way as a

316
00:14:37,790 --> 00:14:40,940
script can be a C script W script lots

317
00:14:40,940 --> 00:14:43,250
of different ways you can get PowerShell

318
00:14:43,250 --> 00:14:46,250
to do your bidding if you use an

319
00:14:46,250 --> 00:14:49,339
application whitelisting tool you know

320
00:14:49,339 --> 00:14:50,440
there's not a whole lot of granularity

321
00:14:50,440 --> 00:14:53,240
PowerShell runs or doesn't and I'm not a

322
00:14:53,240 --> 00:14:55,010
genius and application whitelisting

323
00:14:55,010 --> 00:14:57,079
tools so there might be some granularity

324
00:14:57,079 --> 00:15:00,760
in some products out there or solutions

325
00:15:00,760 --> 00:15:03,380
then the key pieces is just to avoid

326
00:15:03,380 --> 00:15:05,839
current controls if you think about it

327
00:15:05,839 --> 00:15:10,519
if I send a phishing email and it's

328
00:15:10,519 --> 00:15:12,560
embedded in a macro I dump it into

329
00:15:12,560 --> 00:15:15,800
memory you know that's obviously

330
00:15:15,800 --> 00:15:17,600
security awareness training that failed

331
00:15:17,600 --> 00:15:19,610
somebody double clicked on the macro

332
00:15:19,610 --> 00:15:22,610
enabled it dumped it into memory the key

333
00:15:22,610 --> 00:15:24,110
piece there is everything that

334
00:15:24,110 --> 00:15:26,209
PowerShell does that the command line is

335
00:15:26,209 --> 00:15:29,810
txt it's not downloading any executables

336
00:15:29,810 --> 00:15:32,390
that would normally be an IOC pickup

337
00:15:32,390 --> 00:15:33,100
from

338
00:15:33,100 --> 00:15:36,160
additional maybe maybe ids/ips maybe the

339
00:15:36,160 --> 00:15:39,520
firewall whatever it is even in a

340
00:15:39,520 --> 00:15:40,900
malware sandbox what are you going to

341
00:15:40,900 --> 00:15:42,250
detonate in the sandbox there's no

342
00:15:42,250 --> 00:15:45,880
executable it's text you know so isn't

343
00:15:45,880 --> 00:15:48,310
really something that is it's meant to

344
00:15:48,310 --> 00:15:51,580
avoid current controls and it's often

345
00:15:51,580 --> 00:15:54,880
overlooked you know because this happens

346
00:15:54,880 --> 00:15:56,410
it's been the reign of sister admins

347
00:15:56,410 --> 00:15:58,600
forever and it does a great job getting

348
00:15:58,600 --> 00:16:00,390
the operations part of the

349
00:16:00,390 --> 00:16:04,060
organization's work done and then the

350
00:16:04,060 --> 00:16:06,010
key piece here too is another one which

351
00:16:06,010 --> 00:16:08,020
is again this is where I'm showing you

352
00:16:08,020 --> 00:16:10,710
all stuff that we built to help us

353
00:16:10,710 --> 00:16:13,570
including these entire PowerShell

354
00:16:13,570 --> 00:16:15,070
frameworks and there's more out there

355
00:16:15,070 --> 00:16:17,740
but red teams have created these and for

356
00:16:17,740 --> 00:16:20,260
good I mean a lot of these ok I'm a

357
00:16:20,260 --> 00:16:22,780
field engineer I am NOT a reverser of

358
00:16:22,780 --> 00:16:25,900
Mauer I can float up PS attack and it's

359
00:16:25,900 --> 00:16:28,420
just a menuing system man I mean if I

360
00:16:28,420 --> 00:16:32,230
can do this anybody can okay

361
00:16:32,230 --> 00:16:35,650
I mean power sploit PowerShell Empire

362
00:16:35,650 --> 00:16:39,790
they're all super easy to use and so the

363
00:16:39,790 --> 00:16:42,580
bad guys of course you know it's easy to

364
00:16:42,580 --> 00:16:47,470
use why not use that too so why is it so

365
00:16:47,470 --> 00:16:50,080
popular now just because it avoids

366
00:16:50,080 --> 00:16:53,410
controls it avoids the risk of being

367
00:16:53,410 --> 00:16:55,420
caught the attacker doesn't want to be

368
00:16:55,420 --> 00:16:57,340
caught so it doesn't generate IOC s

369
00:16:57,340 --> 00:17:00,070
generally doesn't need IOC s to install

370
00:17:00,070 --> 00:17:03,640
or get there do do much of anything it's

371
00:17:03,640 --> 00:17:06,579
usually really flexible allows you to do

372
00:17:06,579 --> 00:17:08,890
many different things in the environment

373
00:17:08,890 --> 00:17:13,420
so if one thing you do fails so what go

374
00:17:13,420 --> 00:17:15,310
to back to the PlayBook do another one

375
00:17:15,310 --> 00:17:17,740
keep trying keep trying keep trying I'm

376
00:17:17,740 --> 00:17:19,750
not leaving any artifacts behind I'm not

377
00:17:19,750 --> 00:17:21,310
downloading executables

378
00:17:21,310 --> 00:17:23,829
I'm just trying new things that probably

379
00:17:23,829 --> 00:17:25,750
will go unnoticed if auditing isn't

380
00:17:25,750 --> 00:17:27,400
turned on or you don't have something

381
00:17:27,400 --> 00:17:31,270
monitored during it so let's talk about

382
00:17:31,270 --> 00:17:34,840
detecting fireless malware so there's

383
00:17:34,840 --> 00:17:37,300
some basics usually it's pretty abnormal

384
00:17:37,300 --> 00:17:39,550
for PowerShell to run out of the temp

385
00:17:39,550 --> 00:17:41,430
directory or anything of that nature

386
00:17:41,430 --> 00:17:44,140
this does happen fairly normally

387
00:17:44,140 --> 00:17:46,990
download and execute string

388
00:17:46,990 --> 00:17:49,179
so download string and execute but

389
00:17:49,179 --> 00:17:51,249
usually that with cyst admins when they

390
00:17:51,249 --> 00:17:53,259
do it they might download it but it

391
00:17:53,259 --> 00:17:54,700
takes a little while for them to execute

392
00:17:54,700 --> 00:17:56,769
if it's a bad guy it's almost download

393
00:17:56,769 --> 00:17:59,379
string and almost immediate execute if

394
00:17:59,379 --> 00:18:00,940
they do download something that it's

395
00:18:00,940 --> 00:18:05,230
file based oftentimes there's office

396
00:18:05,230 --> 00:18:08,860
keishon base64 X oaring compression

397
00:18:08,860 --> 00:18:12,940
something that nature and oftentimes if

398
00:18:12,940 --> 00:18:15,850
you if you don't have you don't normally

399
00:18:15,850 --> 00:18:19,659
use C script or W script etc any kind of

400
00:18:19,659 --> 00:18:21,429
scripting language for PowerShell you

401
00:18:21,429 --> 00:18:23,110
can talk to your sis have ins about this

402
00:18:23,110 --> 00:18:24,970
that's probably not your sis happens

403
00:18:24,970 --> 00:18:28,210
doing it ok so that's just another way

404
00:18:28,210 --> 00:18:32,529
to catch up if they are using the

405
00:18:32,529 --> 00:18:36,519
PowerShell automation DLL normally thank

406
00:18:36,519 --> 00:18:38,309
you so much for the ten minute warning

407
00:18:38,309 --> 00:18:43,869
it's almost beer bureau o'clock so and I

408
00:18:43,869 --> 00:18:45,850
know you I'm standing between you guys

409
00:18:45,850 --> 00:18:48,369
and beer so we've got a few more slides

410
00:18:48,369 --> 00:18:52,269
here if they are using the PowerShell

411
00:18:52,269 --> 00:18:56,019
automation DLL sysadmin czar you can ask

412
00:18:56,019 --> 00:18:59,740
them a not to use it or B use it under

413
00:18:59,740 --> 00:19:02,649
certain circumstances okay since it does

414
00:19:02,649 --> 00:19:05,320
not show up loads and memory does not

415
00:19:05,320 --> 00:19:07,570
show up in task manager it's not show up

416
00:19:07,570 --> 00:19:10,869
in the process listening you can also

417
00:19:10,869 --> 00:19:14,950
watch for persistence if a PowerShell

418
00:19:14,950 --> 00:19:19,690
script is using MSHDA or HTA that is not

419
00:19:19,690 --> 00:19:22,090
your sis Atman I can tell you that right

420
00:19:22,090 --> 00:19:22,509
now

421
00:19:22,509 --> 00:19:26,619
that is highly highly highly unlikely if

422
00:19:26,619 --> 00:19:28,869
they're using invoked expressions like

423
00:19:28,869 --> 00:19:31,899
for a framework for Metasploit not

424
00:19:31,899 --> 00:19:36,519
probably not your system at ok using

425
00:19:36,519 --> 00:19:38,499
javascript engines probably not your

426
00:19:38,499 --> 00:19:40,809
sister admin doing these are persistence

427
00:19:40,809 --> 00:19:43,720
mechanisms a lot of time ok so we're

428
00:19:43,720 --> 00:19:46,990
almost done here it's interesting those

429
00:19:46,990 --> 00:19:50,529
56 percent on average okay I did a lot

430
00:19:50,529 --> 00:19:51,999
of research on the web so I just took a

431
00:19:51,999 --> 00:19:55,149
bunch of articles and somewhere 48

432
00:19:55,149 --> 00:19:56,859
percent somewhere 60 some-odd percent

433
00:19:56,859 --> 00:19:59,710
somewhere 50 percent I came up with 56

434
00:19:59,710 --> 00:20:00,669
percent from

435
00:20:00,669 --> 00:20:05,859
full sources in 2017 and 2018 so far 60%

436
00:20:05,859 --> 00:20:07,840
which doesn't seem like a huge increase

437
00:20:07,840 --> 00:20:11,679
over file based malware but it's

438
00:20:11,679 --> 00:20:13,450
actually just shifting the playing field

439
00:20:13,450 --> 00:20:16,960
so PowerShell was all the rage in 2017

440
00:20:16,960 --> 00:20:19,059
and 2018 and I think that's why we had

441
00:20:19,059 --> 00:20:20,980
the advent of the mitre attack framework

442
00:20:20,980 --> 00:20:24,789
to February's ago so 16 ish months ago

443
00:20:24,789 --> 00:20:27,460
was around you know living off the land

444
00:20:27,460 --> 00:20:29,529
what people were doing internally once

445
00:20:29,529 --> 00:20:32,169
they do get in and we've seen a lot of

446
00:20:32,169 --> 00:20:34,450
uptick and you can google this it's all

447
00:20:34,450 --> 00:20:35,980
out there's all research I just did on

448
00:20:35,980 --> 00:20:36,720
the Internet

449
00:20:36,720 --> 00:20:38,409
WMI are windows management

450
00:20:38,409 --> 00:20:40,690
instrumentation seems to be the big one

451
00:20:40,690 --> 00:20:43,720
now because you guys are getting smarter

452
00:20:43,720 --> 00:20:45,850
you're turning on auditing for

453
00:20:45,850 --> 00:20:47,379
PowerShell version 3 and 5 you're

454
00:20:47,379 --> 00:20:49,059
monitoring but if it's being downgraded

455
00:20:49,059 --> 00:20:51,309
you're working with your sis admins

456
00:20:51,309 --> 00:20:53,080
about W script C script you know you

457
00:20:53,080 --> 00:20:55,210
getting smarter and so to evade

458
00:20:55,210 --> 00:20:56,970
detection they're just moving to another

459
00:20:56,970 --> 00:21:00,489
powerful tool in your environment to get

460
00:21:00,489 --> 00:21:04,119
the job done and you know who knows

461
00:21:04,119 --> 00:21:06,639
what's next maybe it's an old net cat

462
00:21:06,639 --> 00:21:08,320
maybe it's you know other things that

463
00:21:08,320 --> 00:21:10,239
reside on Windows that they're gonna

464
00:21:10,239 --> 00:21:12,419
start using but the idea here is is that

465
00:21:12,419 --> 00:21:15,220
this is a problem now that's a current

466
00:21:15,220 --> 00:21:18,820
trend I mean and it's not gone away so

467
00:21:18,820 --> 00:21:20,409
it's just something to be aware of this

468
00:21:20,409 --> 00:21:23,369
is an awareness type thing so that's it

469
00:21:23,369 --> 00:21:30,029
any questions yeah

470
00:21:35,860 --> 00:21:39,158
but you mentioned

471
00:21:40,820 --> 00:21:45,909
both correct

472
00:21:47,170 --> 00:21:51,010
as along looking at that process so

473
00:21:51,010 --> 00:21:53,820
something coming

474
00:22:03,210 --> 00:22:06,070
yeah if you're looking like tactics

475
00:22:06,070 --> 00:22:09,400
techniques and procedures TTP's I mean

476
00:22:09,400 --> 00:22:12,070
you have something to do that this is an

477
00:22:12,070 --> 00:22:13,780
easily these are much more easily

478
00:22:13,780 --> 00:22:17,710
stoppable okay since they don't generate

479
00:22:17,710 --> 00:22:21,100
really any artifacts that is why IO

480
00:22:21,100 --> 00:22:24,310
Caesar not not useless necessarily but

481
00:22:24,310 --> 00:22:27,460
just less much less use useful than

482
00:22:27,460 --> 00:22:31,590
normal so you're right

483
00:22:35,880 --> 00:22:39,630
exactly it's a being really catching

484
00:22:39,630 --> 00:22:41,830
people living off the land is all about

485
00:22:41,830 --> 00:22:43,120
tactics techniques and procedures

486
00:22:43,120 --> 00:22:46,150
generally monitoring that and being able

487
00:22:46,150 --> 00:22:48,700
to you know catch them doing it when

488
00:22:48,700 --> 00:22:54,690
they're doing it generally yes sir

489
00:23:08,320 --> 00:23:11,320
other

490
00:23:13,700 --> 00:23:15,960
yeah there are some since monitoring

491
00:23:15,960 --> 00:23:18,359
tools that you from Microsoft that in

492
00:23:18,359 --> 00:23:20,759
there third-party ones to you can you

493
00:23:20,759 --> 00:23:22,980
know use in your environment literally

494
00:23:22,980 --> 00:23:25,769
just to monitor version changes I will

495
00:23:25,769 --> 00:23:27,480
tell you that I've seen a couple

496
00:23:27,480 --> 00:23:30,149
customers distance is not a problem it's

497
00:23:30,149 --> 00:23:31,859
just sometimes sysadmin they don't want

498
00:23:31,859 --> 00:23:33,899
to modify their scripts so they will

499
00:23:33,899 --> 00:23:35,730
actually downgrade from version 3 or 5

500
00:23:35,730 --> 00:23:38,519
to version 2 to get it to run and then

501
00:23:38,519 --> 00:23:40,590
maybe upgrade it again so if you see

502
00:23:40,590 --> 00:23:41,999
that I'm where I'm going with this is

503
00:23:41,999 --> 00:23:45,899
we're all up or you know yeah it's it's

504
00:23:45,899 --> 00:23:47,309
just something to be aware but there are

505
00:23:47,309 --> 00:23:49,559
some monitoring tools you can use to do

506
00:23:49,559 --> 00:23:53,279
that today so it's another way of just

507
00:23:53,279 --> 00:23:56,009
you know keep an eye on things what's

508
00:23:56,009 --> 00:24:00,139
going on in my environment awareness

509
00:24:14,530 --> 00:24:19,990
their commands to debate well yes and no

510
00:24:19,990 --> 00:24:23,060
the whole reason obfuscation jeez

511
00:24:23,060 --> 00:24:25,700
logically is to evade detection of any

512
00:24:25,700 --> 00:24:30,560
kind of monitoring or auditing tool so

513
00:24:30,560 --> 00:24:32,600
if you use turn auditing on version 3 or

514
00:24:32,600 --> 00:24:34,880
5 you can monitor for obfuscation which

515
00:24:34,880 --> 00:24:38,000
usually you're said means don't use yes

516
00:24:38,000 --> 00:24:39,740
you could but the auditing would pick

517
00:24:39,740 --> 00:24:42,230
that up probably with you configure

518
00:24:42,230 --> 00:24:44,450
auditing correctly via some guides on

519
00:24:44,450 --> 00:24:47,090
the internet meaning like okay it does

520
00:24:47,090 --> 00:24:49,460
it does download string and execute in

521
00:24:49,460 --> 00:24:51,560
like one second that's pretty unusual

522
00:24:51,560 --> 00:24:54,860
for and that's this admin to do or you

523
00:24:54,860 --> 00:24:56,420
know a couple other things they're using

524
00:24:56,420 --> 00:25:00,170
utilizing MSHDA or HDA you know those

525
00:25:00,170 --> 00:25:03,200
kind of things in audit so but now

526
00:25:03,200 --> 00:25:07,690
that's a good question like yeah because

527
00:25:07,690 --> 00:25:11,020
things progress

528
00:25:18,010 --> 00:25:22,940
or uses as a lure yeah you aren't that's

529
00:25:22,940 --> 00:25:24,919
a quote on office gated section of the

530
00:25:24,919 --> 00:25:27,110
stuff is a lure thinking you've got them

531
00:25:27,110 --> 00:25:29,179
and then there might be something else

532
00:25:29,179 --> 00:25:32,539
it's a reference later that is actually

533
00:25:32,539 --> 00:25:37,789
the bad part yep I agree no you're right

534
00:25:37,789 --> 00:25:39,830
I mean it's a cyclical pattern seems to

535
00:25:39,830 --> 00:25:47,029
go up and down alright it's beer o'clock

536
00:25:47,029 --> 00:25:51,700
people thanks for your time

537
00:25:52,120 --> 00:25:54,409
[Applause]

