1
00:00:00,060 --> 00:00:03,030
so the next stocks gonna be starting now

2
00:00:03,030 --> 00:00:04,710
with Erin and Christian and I'll let

3
00:00:04,710 --> 00:00:05,819
them take it from here and tell us about

4
00:00:05,819 --> 00:00:11,670
some wormholes cool hello I'm Erin Chow

5
00:00:11,670 --> 00:00:14,280
mara and Christian rural Cohen we both

6
00:00:14,280 --> 00:00:16,020
work at secure works we both work in the

7
00:00:16,020 --> 00:00:18,449
counter thread unit which is notionally

8
00:00:18,449 --> 00:00:20,400
to threat research team but also threat

9
00:00:20,400 --> 00:00:22,769
operations I'd say Christian works on

10
00:00:22,769 --> 00:00:24,240
the special ops team and I work in the

11
00:00:24,240 --> 00:00:28,680
cyber Intel Center typically what that

12
00:00:28,680 --> 00:00:30,390
really means for me is most of the time

13
00:00:30,390 --> 00:00:32,910
I spend looking at malware or specific

14
00:00:32,910 --> 00:00:36,090
threat actors and threat groups but over

15
00:00:36,090 --> 00:00:39,690
the past year there's been a lot of our

16
00:00:39,690 --> 00:00:44,629
time that's been spent working on a few

17
00:00:44,629 --> 00:00:47,940
internet scale worms which has been

18
00:00:47,940 --> 00:00:51,480
really an odd occurrence in the past 10

19
00:00:51,480 --> 00:00:56,280
years it really sort of all started with

20
00:00:56,280 --> 00:01:02,300
this in April 2017 a group of online

21
00:01:02,300 --> 00:01:05,909
activists or personas of sorts released

22
00:01:05,909 --> 00:01:07,710
a whole bunch of tools that were

23
00:01:07,710 --> 00:01:11,369
notionally based from the NSA in that

24
00:01:11,369 --> 00:01:14,880
set of tools there were a handful of

25
00:01:14,880 --> 00:01:17,310
exploits which were were mobile most of

26
00:01:17,310 --> 00:01:20,939
these were based off of SMB exploits and

27
00:01:20,939 --> 00:01:22,770
vulnerabilities all of those were the

28
00:01:22,770 --> 00:01:27,360
eternal based tools but there were also

29
00:01:27,360 --> 00:01:30,630
some exploits and vulnerabilities and

30
00:01:30,630 --> 00:01:32,880
tool sets in there that were were mobile

31
00:01:32,880 --> 00:01:36,060
which were not based off of SMB but for

32
00:01:36,060 --> 00:01:37,530
some reason they were really picked up

33
00:01:37,530 --> 00:01:43,409
on so those were released in April 2017

34
00:01:43,409 --> 00:01:45,890
and Microsoft had previously released

35
00:01:45,890 --> 00:01:49,950
patches back in March 2017 so everybody

36
00:01:49,950 --> 00:01:51,390
patched right like we learned these

37
00:01:51,390 --> 00:01:54,210
lessons 10 years ago first with Ken well

38
00:01:54,210 --> 00:01:56,159
most recently with configure but

39
00:01:56,159 --> 00:01:57,899
previous to that with quite a few other

40
00:01:57,899 --> 00:02:00,450
worms that spread incredibly quickly

41
00:02:00,450 --> 00:02:05,250
across the internet well in May 2017 we

42
00:02:05,250 --> 00:02:09,090
found out that no a lot of people really

43
00:02:09,090 --> 00:02:11,819
didn't patch and there was this worm

44
00:02:11,819 --> 00:02:13,350
which started spreading and it was

45
00:02:13,350 --> 00:02:16,380
want to cry and it compromised a lot of

46
00:02:16,380 --> 00:02:19,350
hosts and got a lot of press play at

47
00:02:19,350 --> 00:02:21,780
least that we saw in the media which

48
00:02:21,780 --> 00:02:25,680
meant that I worked all weekend long

49
00:02:25,680 --> 00:02:28,860
and that what really kind of caught

50
00:02:28,860 --> 00:02:32,220
people's minds and really spread through

51
00:02:32,220 --> 00:02:34,230
the Zeke Geist was the fact that these

52
00:02:34,230 --> 00:02:37,500
were based off of and and this toll was

53
00:02:37,500 --> 00:02:40,380
spreading based off of an exploit in the

54
00:02:40,380 --> 00:02:43,050
the shadow brokers release which had

55
00:02:43,050 --> 00:02:47,430
been released a month earlier so when we

56
00:02:47,430 --> 00:02:48,990
started to really dig into this story

57
00:02:48,990 --> 00:02:52,230
though we found that that really wasn't

58
00:02:52,230 --> 00:02:56,580
what had happened there was a previous

59
00:02:56,580 --> 00:02:58,200
version of this worm which had started

60
00:02:58,200 --> 00:03:01,500
spreading in April 2017 and it had

61
00:03:01,500 --> 00:03:04,190
actually the version number 1.0 in it

62
00:03:04,190 --> 00:03:09,300
that worm only used stored credentials

63
00:03:09,300 --> 00:03:13,260
and input and create a list of

64
00:03:13,260 --> 00:03:14,700
credentials that were stored in the

65
00:03:14,700 --> 00:03:16,800
binary itself that it was trying against

66
00:03:16,800 --> 00:03:21,600
different open SMB servers if we took a

67
00:03:21,600 --> 00:03:24,060
step back a little further we found a

68
00:03:24,060 --> 00:03:27,240
previous version of the backdoor which

69
00:03:27,240 --> 00:03:30,290
was called W cry beta one a cry beta

70
00:03:30,290 --> 00:03:33,960
that version really didn't spread well

71
00:03:33,960 --> 00:03:34,890
at all

72
00:03:34,890 --> 00:03:36,390
and it looked like they were trying to

73
00:03:36,390 --> 00:03:38,340
spread it manually and via sphere fishes

74
00:03:38,340 --> 00:03:40,830
and so forth like that but taking a look

75
00:03:40,830 --> 00:03:43,020
at the source code brought us back to a

76
00:03:43,020 --> 00:03:46,920
whole set of other SMB based tools which

77
00:03:46,920 --> 00:03:51,300
had a North Korean Nexus in the same

78
00:03:51,300 --> 00:03:54,810
time frame there was a much more

79
00:03:54,810 --> 00:03:58,460
targeted compromise which used the same

80
00:03:58,460 --> 00:04:03,780
basic SMB worm technology and functions

81
00:04:03,780 --> 00:04:07,380
but it dropped to backdoor tools called

82
00:04:07,380 --> 00:04:10,140
alpha and C and Bravo and C at that

83
00:04:10,140 --> 00:04:15,750
organization and really that SMB worm

84
00:04:15,750 --> 00:04:18,060
was based off of this toast toast week

85
00:04:18,060 --> 00:04:20,399
named ramble which the North Koreans had

86
00:04:20,399 --> 00:04:23,260
been using since May 2015

87
00:04:23,260 --> 00:04:26,230
when we took a look at our data we were

88
00:04:26,230 --> 00:04:28,120
able to find these worms have been

89
00:04:28,120 --> 00:04:30,160
trying to be they were trying to spread

90
00:04:30,160 --> 00:04:33,220
these worms from way back in 2016 at

91
00:04:33,220 --> 00:04:36,430
least and nobody paid attention to it at

92
00:04:36,430 --> 00:04:38,230
all until it started to compromise

93
00:04:38,230 --> 00:04:41,800
people's sales kiosks but you know there

94
00:04:41,800 --> 00:04:43,630
was a lot of media impact from this

95
00:04:43,630 --> 00:04:46,990
there was a lot of questions about this

96
00:04:46,990 --> 00:04:49,690
but when we actually took our step back

97
00:04:49,690 --> 00:04:52,030
and looked at the organizations that we

98
00:04:52,030 --> 00:04:54,970
were managing their security for we had

99
00:04:54,970 --> 00:04:58,630
73 unique clients who had actual

100
00:04:58,630 --> 00:05:01,300
detections of this worm in their

101
00:05:01,300 --> 00:05:03,580
environment and that's out of a bit over

102
00:05:03,580 --> 00:05:05,680
4,000 different clients that we managed

103
00:05:05,680 --> 00:05:10,180
security for we had 399 total tickets in

104
00:05:10,180 --> 00:05:14,230
those 73 clients and we had 278 unique

105
00:05:14,230 --> 00:05:17,050
clients who requested information from

106
00:05:17,050 --> 00:05:19,780
us so the actual number of clients that

107
00:05:19,780 --> 00:05:21,580
were asking us information was much

108
00:05:21,580 --> 00:05:23,860
larger than the number of clients who

109
00:05:23,860 --> 00:05:26,650
were actually impacted when we really

110
00:05:26,650 --> 00:05:29,440
dug into it we also found that none of

111
00:05:29,440 --> 00:05:33,100
our clients had a true major impact none

112
00:05:33,100 --> 00:05:36,360
of their core resources or core

113
00:05:36,360 --> 00:05:39,820
information technology infrastructure

114
00:05:39,820 --> 00:05:42,100
was really impacted everything that was

115
00:05:42,100 --> 00:05:45,370
impacted were things like a computer

116
00:05:45,370 --> 00:05:47,290
over at a sales office and they had

117
00:05:47,290 --> 00:05:49,630
somehow they had a single internet

118
00:05:49,630 --> 00:05:51,400
access point that was completely open to

119
00:05:51,400 --> 00:05:54,400
the net things like that and then that's

120
00:05:54,400 --> 00:05:58,660
also why you saw a lot of ATM machines

121
00:05:58,660 --> 00:06:04,690
and display kiosks that were being

122
00:06:04,690 --> 00:06:06,700
compromised these were all hosts that

123
00:06:06,700 --> 00:06:10,540
had almost no let's say core business

124
00:06:10,540 --> 00:06:13,510
impact and inside an organization but

125
00:06:13,510 --> 00:06:16,630
you know we had a lot of hype around one

126
00:06:16,630 --> 00:06:19,630
a cry and a lot of hype around these SMB

127
00:06:19,630 --> 00:06:21,970
vulnerabilities that were out there so

128
00:06:21,970 --> 00:06:26,400
everyone's patched right

129
00:06:27,820 --> 00:06:33,520
a month later this happened and we found

130
00:06:33,520 --> 00:06:36,250
out or it started to look like nobody

131
00:06:36,250 --> 00:06:37,870
had applied these patches or a lot of

132
00:06:37,870 --> 00:06:39,520
really large organizations had not

133
00:06:39,520 --> 00:06:41,980
applied these patches so on June 28th

134
00:06:41,980 --> 00:06:47,350
2017 around 10:00 a.m. UTC we started to

135
00:06:47,350 --> 00:06:49,210
receive requests from a few

136
00:06:49,210 --> 00:06:52,060
organizations first based in Europe and

137
00:06:52,060 --> 00:06:56,740
then later based in US where they had a

138
00:06:56,740 --> 00:06:59,320
massive amounts of their systems

139
00:06:59,320 --> 00:07:02,410
compromised and all that Christian take

140
00:07:02,410 --> 00:07:06,640
it from here okay thank you so both of

141
00:07:06,640 --> 00:07:08,880
us have been involved in a handful of

142
00:07:08,880 --> 00:07:12,460
not Petra investigations and of those a

143
00:07:12,460 --> 00:07:14,470
lot of our clients were completely hosed

144
00:07:14,470 --> 00:07:18,040
I thought was important for us to bring

145
00:07:18,040 --> 00:07:21,190
you stories about this stories from the

146
00:07:21,190 --> 00:07:22,750
innocent response stories to how it

147
00:07:22,750 --> 00:07:24,130
happened how it could have been

148
00:07:24,130 --> 00:07:27,820
prevented but in order to do that I need

149
00:07:27,820 --> 00:07:29,440
to protect names of the innocent we can

150
00:07:29,440 --> 00:07:32,170
obviously give client data so I've

151
00:07:32,170 --> 00:07:36,010
created a fictitious company protect

152
00:07:36,010 --> 00:07:38,010
identities of these other organizations

153
00:07:38,010 --> 00:07:40,270
but this fictitious company everything

154
00:07:40,270 --> 00:07:41,530
that I given these stories actually

155
00:07:41,530 --> 00:07:43,210
happen these are actual facts they're

156
00:07:43,210 --> 00:07:46,090
not sensation alized these actually

157
00:07:46,090 --> 00:07:48,400
happened so the company that I'm

158
00:07:48,400 --> 00:07:50,860
presenting that I created I just call it

159
00:07:50,860 --> 00:07:53,080
a beach wear clothing manufacturer and

160
00:07:53,080 --> 00:07:59,520
retailer so presenting Seaside's

161
00:07:59,639 --> 00:08:04,930
that's Seaside's as in the sea you kind

162
00:08:04,930 --> 00:08:06,460
of have to question the credibility of a

163
00:08:06,460 --> 00:08:08,020
company based out of Pittsburgh that has

164
00:08:08,020 --> 00:08:16,389
a Sun in their logo so Seaside's they

165
00:08:16,389 --> 00:08:18,729
have about roughly a thousand hosts our

166
00:08:18,729 --> 00:08:21,039
window shop so they lost most of their

167
00:08:21,039 --> 00:08:24,580
host they'd already engaged a third

168
00:08:24,580 --> 00:08:26,530
party to start manually real building

169
00:08:26,530 --> 00:08:28,419
rebuilding these hosts so it's a long

170
00:08:28,419 --> 00:08:31,000
laborious process they called us in to

171
00:08:31,000 --> 00:08:33,549
help them out to determine well what

172
00:08:33,549 --> 00:08:36,208
actually happened how did we get

173
00:08:36,208 --> 00:08:38,649
impacted how do we prevent this from

174
00:08:38,649 --> 00:08:41,919
happening in the future so our first

175
00:08:41,919 --> 00:08:43,529
goal is was well let's work backwards

176
00:08:43,529 --> 00:08:46,209
let's find the earliest evidence of

177
00:08:46,209 --> 00:08:47,860
compromise because that's important

178
00:08:47,860 --> 00:08:49,510
because obviously they'll need to fix

179
00:08:49,510 --> 00:08:51,910
that determine the entry point to the

180
00:08:51,910 --> 00:08:53,320
environment and then determine how it

181
00:08:53,320 --> 00:08:54,519
was spread within the environment

182
00:08:54,519 --> 00:08:56,920
because you know fixing the introduction

183
00:08:56,920 --> 00:08:58,480
patient zero is one thing preventing

184
00:08:58,480 --> 00:09:00,279
something from spreading is another that

185
00:09:00,279 --> 00:09:03,459
the client needs to take care of so my

186
00:09:03,459 --> 00:09:06,760
initial thoughts was Ms 1701 zero

187
00:09:06,760 --> 00:09:09,220
eternal blue because the news had come

188
00:09:09,220 --> 00:09:12,060
out that not petrol uses this

189
00:09:12,060 --> 00:09:15,790
vulnerability so I asked the client hey

190
00:09:15,790 --> 00:09:16,959
are you guys patched fraternal glue and

191
00:09:16,959 --> 00:09:19,060
say no we patched it's not eternal blue

192
00:09:19,060 --> 00:09:22,000
so I'm like okay we're gonna have to dig

193
00:09:22,000 --> 00:09:23,520
further and investigate

194
00:09:23,520 --> 00:09:26,140
so starting point like I said the

195
00:09:26,140 --> 00:09:29,140
clients of window shop they were hosed

196
00:09:29,140 --> 00:09:32,200
so things as an investigator an instant

197
00:09:32,200 --> 00:09:33,520
responder that I am used to getting

198
00:09:33,520 --> 00:09:35,829
don't in it didn't exist domain

199
00:09:35,829 --> 00:09:36,970
controllers hosed

200
00:09:36,970 --> 00:09:39,790
no domain controller logs their sim was

201
00:09:39,790 --> 00:09:42,820
a window sim their sim hosed no data

202
00:09:42,820 --> 00:09:47,980
from their sim and by now the media has

203
00:09:47,980 --> 00:09:50,500
already reported on a few handful of

204
00:09:50,500 --> 00:09:52,630
companies that were completely and some

205
00:09:52,630 --> 00:09:53,980
of these were very large companies that

206
00:09:53,980 --> 00:09:56,529
not Petra affected their entire

207
00:09:56,529 --> 00:09:59,740
operations they were down and so I took

208
00:09:59,740 --> 00:10:01,060
this list and I provided to the client

209
00:10:01,060 --> 00:10:05,560
and client Luca listen said that one is

210
00:10:05,560 --> 00:10:07,720
one of her vendors and of course that

211
00:10:07,720 --> 00:10:09,699
got me thinking okay back to my mind I

212
00:10:09,699 --> 00:10:12,910
need to consider that the burner

213
00:10:12,910 --> 00:10:14,680
proof is still very low so I can't say

214
00:10:14,680 --> 00:10:17,770
yep this is what caused it but this is

215
00:10:17,770 --> 00:10:20,770
something that need to focus on so where

216
00:10:20,770 --> 00:10:24,310
do we start well fortunately we did have

217
00:10:24,310 --> 00:10:25,750
some logs there far away obviously

218
00:10:25,750 --> 00:10:27,790
weren't Windows boxes and so we pulled

219
00:10:27,790 --> 00:10:29,410
firewall logs and started analyzing

220
00:10:29,410 --> 00:10:31,330
those working our way backwards to the

221
00:10:31,330 --> 00:10:35,740
initial time of the infection and the

222
00:10:35,740 --> 00:10:39,160
logs as we figure it out showed a lot of

223
00:10:39,160 --> 00:10:41,920
SMB tracking traffic indicative of not

224
00:10:41,920 --> 00:10:44,860
Pecha great it just proves that you know

225
00:10:44,860 --> 00:10:46,300
we're just further supports that yes it

226
00:10:46,300 --> 00:10:48,300
is not Petra you got the splash screen

227
00:10:48,300 --> 00:10:50,950
you got the logs we know that so didn't

228
00:10:50,950 --> 00:10:53,800
really give us much more information one

229
00:10:53,800 --> 00:10:55,150
of the problems was visibility

230
00:10:55,150 --> 00:10:57,070
limitations the you know the their

231
00:10:57,070 --> 00:10:58,660
firewalls were placed only on certain

232
00:10:58,660 --> 00:11:01,530
locations through you know outgoing

233
00:11:01,530 --> 00:11:03,580
ingressing through outside the network

234
00:11:03,580 --> 00:11:07,780
VPNs they've had a ton of 24/7 VPNs to

235
00:11:07,780 --> 00:11:10,270
their third-party trust trusted third

236
00:11:10,270 --> 00:11:15,760
parties so it helped us a little but it

237
00:11:15,760 --> 00:11:16,720
didn't really give us the answers we

238
00:11:16,720 --> 00:11:17,080
need

239
00:11:17,080 --> 00:11:20,410
so the next step well we're gonna have

240
00:11:20,410 --> 00:11:22,900
to go to where the data we need and get

241
00:11:22,900 --> 00:11:24,940
it from there which means we're gonna

242
00:11:24,940 --> 00:11:27,510
have to rebuild and conduct forensics on

243
00:11:27,510 --> 00:11:29,860
things we think is a will contain this

244
00:11:29,860 --> 00:11:32,470
data things of evidentiary value so we

245
00:11:32,470 --> 00:11:34,630
determined we got an AV server let's do

246
00:11:34,630 --> 00:11:36,160
that let's rebuild the AV server

247
00:11:36,160 --> 00:11:40,050
you got a sim let's rebuild the sim and

248
00:11:40,050 --> 00:11:42,550
possibly any early affected computers

249
00:11:42,550 --> 00:11:45,460
from the firewall logs so we started

250
00:11:45,460 --> 00:11:47,530
doing this so those of you not familiar

251
00:11:47,530 --> 00:11:49,750
with not Petra does to a computer

252
00:11:49,750 --> 00:11:52,390
it literally rewrites the MBR the Master

253
00:11:52,390 --> 00:11:54,550
Boot Record so when it boots up it shows

254
00:11:54,550 --> 00:11:55,960
that splash screen like hey you've been

255
00:11:55,960 --> 00:11:58,720
owned send money to blah blah blah but

256
00:11:58,720 --> 00:12:01,240
it also tries to encrypt the first end

257
00:12:01,240 --> 00:12:04,300
amount bytes of your ma or your your

258
00:12:04,300 --> 00:12:06,490
master file table which is your table of

259
00:12:06,490 --> 00:12:09,130
context to the to the drive without that

260
00:12:09,130 --> 00:12:12,970
you can't actually rebuild and figure

261
00:12:12,970 --> 00:12:14,560
out where your files are that's all gone

262
00:12:14,560 --> 00:12:17,140
you need to basically carve data it's a

263
00:12:17,140 --> 00:12:18,910
forensic technique where we have to

264
00:12:18,910 --> 00:12:21,130
carve data and free or unallocated space

265
00:12:21,130 --> 00:12:24,040
whatever you call that but it's worth a

266
00:12:24,040 --> 00:12:26,470
try for us to recover the data because

267
00:12:26,470 --> 00:12:26,800
the

268
00:12:26,800 --> 00:12:31,389
were in this data so first thing we said

269
00:12:31,389 --> 00:12:33,279
is will rebuild the AV server it's very

270
00:12:33,279 --> 00:12:35,999
easy it's one workstation one drive and

271
00:12:35,999 --> 00:12:38,529
there's a tool we use to replace the MBR

272
00:12:38,529 --> 00:12:41,290
and fortunately the MFT was untouched by

273
00:12:41,290 --> 00:12:44,079
not petra I don't know why but through

274
00:12:44,079 --> 00:12:45,759
that the forensic software was able to

275
00:12:45,759 --> 00:12:47,739
rebuild the structure of the drive and

276
00:12:47,739 --> 00:12:51,040
then we were able to pull off AV logs

277
00:12:51,040 --> 00:12:53,889
however the AV logs was not a real

278
00:12:53,889 --> 00:12:56,499
benefit because AV didn't catch non

279
00:12:56,499 --> 00:12:57,579
pedra and stop it

280
00:12:57,579 --> 00:12:59,290
so there were no logs at that time there

281
00:12:59,290 --> 00:13:01,149
was no signature to stop the not Petra

282
00:13:01,149 --> 00:13:05,309
outbreak so AV logs now been to any good

283
00:13:05,309 --> 00:13:08,470
however these security event logs on

284
00:13:08,470 --> 00:13:11,470
that host was very fruitful what you see

285
00:13:11,470 --> 00:13:14,980
up there make sure I press the laser

286
00:13:14,980 --> 00:13:18,549
pointer is a snippet all made up by the

287
00:13:18,549 --> 00:13:21,850
way names domains made up everything

288
00:13:21,850 --> 00:13:23,980
else actual names domains and target

289
00:13:23,980 --> 00:13:27,670
servers was a pattern we saw of

290
00:13:27,670 --> 00:13:30,489
authentications these were five five two

291
00:13:30,489 --> 00:13:33,610
event IDs so for you event ID gurus

292
00:13:33,610 --> 00:13:35,290
you're probably thinking what's five

293
00:13:35,290 --> 00:13:39,790
five two five five two is a explicit

294
00:13:39,790 --> 00:13:41,740
login logging on trying to log on to

295
00:13:41,740 --> 00:13:43,389
another resource using different

296
00:13:43,389 --> 00:13:44,679
credentials than what you're logged on

297
00:13:44,679 --> 00:13:46,839
to that box it's like but isn't that 46

298
00:13:46,839 --> 00:13:50,319
48 or something it is for machines that

299
00:13:50,319 --> 00:13:53,769
are greater than Windows XP and 2008 or

300
00:13:53,769 --> 00:13:55,509
so on you're like wait a minute so that

301
00:13:55,509 --> 00:13:57,999
means this is a Windows XP rc1 box yes

302
00:13:57,999 --> 00:14:01,149
one of those that's a important point

303
00:14:01,149 --> 00:14:02,769
that I'm going to cover in a few other

304
00:14:02,769 --> 00:14:05,949
slides but basically this is logs

305
00:14:05,949 --> 00:14:08,019
indicative of not Petra trying to

306
00:14:08,019 --> 00:14:09,730
authenticate out to the rest of the

307
00:14:09,730 --> 00:14:13,269
environment from the AV log it's

308
00:14:13,269 --> 00:14:15,939
important data so I pulled this data and

309
00:14:15,939 --> 00:14:21,220
I mapped it like this and there were

310
00:14:21,220 --> 00:14:22,689
some interesting patterns I saw the

311
00:14:22,689 --> 00:14:25,629
domains the domain names and the

312
00:14:25,629 --> 00:14:28,329
accounts so one of the first things is I

313
00:14:28,329 --> 00:14:31,389
showed to our client do you recognize

314
00:14:31,389 --> 00:14:33,459
these domain names and the ones on the

315
00:14:33,459 --> 00:14:37,559
bottom yes that's our domain ET net

316
00:14:38,540 --> 00:14:40,460
do you recognize any of the names up top

317
00:14:40,460 --> 00:14:42,770
I don't recognize the domains but

318
00:14:42,770 --> 00:14:45,680
entropy that that's a company that is

319
00:14:45,680 --> 00:14:47,240
our vendor that's the one that was in

320
00:14:47,240 --> 00:14:49,310
the news that got impacted by not petrol

321
00:14:49,310 --> 00:14:52,430
whoa we got more data we're like okay

322
00:14:52,430 --> 00:14:53,510
this makes sense now

323
00:14:53,510 --> 00:14:56,290
we've now have a higher burden of

324
00:14:56,290 --> 00:14:59,360
evidence that we know where nan Petra

325
00:14:59,360 --> 00:14:59,990
came from

326
00:14:59,990 --> 00:15:05,210
perhaps we can dig and find more then it

327
00:15:05,210 --> 00:15:06,530
hit me it's like hey this is interesting

328
00:15:06,530 --> 00:15:08,390
you see a pattern of where this moved

329
00:15:08,390 --> 00:15:10,730
through we did some research on some of

330
00:15:10,730 --> 00:15:12,230
the domains like there's a domain called

331
00:15:12,230 --> 00:15:15,370
EMS you found out that it was actually a

332
00:15:15,370 --> 00:15:17,900
division of entropy or entropy tech

333
00:15:17,900 --> 00:15:20,720
called Enterprise marketing statistics

334
00:15:20,720 --> 00:15:21,890
and that's the other thing I didn't say

335
00:15:21,890 --> 00:15:23,660
is the client said yeah entropy is a

336
00:15:23,660 --> 00:15:25,910
trusted vendor we have a full-time

337
00:15:25,910 --> 00:15:27,590
connected VPN to their systems they

338
00:15:27,590 --> 00:15:30,920
provide a service they do statistical

339
00:15:30,920 --> 00:15:33,140
marketing and we use their product and

340
00:15:33,140 --> 00:15:34,880
of course it all makes sense now

341
00:15:34,880 --> 00:15:37,310
right EMS is actually a subdivision we

342
00:15:37,310 --> 00:15:40,060
look at looked it up on the web's called

343
00:15:40,060 --> 00:15:42,710
Enterprise marketing statistics East ATS

344
00:15:42,710 --> 00:15:44,450
is the actual name of the application

345
00:15:44,450 --> 00:15:47,270
that Seaside's uses okay so you can see

346
00:15:47,270 --> 00:15:49,430
kind of like a pattern of movement so I

347
00:15:49,430 --> 00:15:54,530
contacted Arin and basically said and if

348
00:15:54,530 --> 00:15:56,410
you look in this slide you can see the

349
00:15:56,410 --> 00:15:59,120
same set of user names being repeated

350
00:15:59,120 --> 00:16:01,250
over and over and over again in that

351
00:16:01,250 --> 00:16:03,650
same path so you looked at that and that

352
00:16:03,650 --> 00:16:05,900
that's kind of key to determining the

353
00:16:05,900 --> 00:16:08,180
path of the malware we call it a flight

354
00:16:08,180 --> 00:16:10,430
recorder erin look at the malware and

355
00:16:10,430 --> 00:16:12,410
basically validated that yes the malware

356
00:16:12,410 --> 00:16:14,390
passes on credential is that it captures

357
00:16:14,390 --> 00:16:16,820
first-in first-out so you could use that

358
00:16:16,820 --> 00:16:18,650
order and basically build the flight of

359
00:16:18,650 --> 00:16:20,960
not Petra determining where it initially

360
00:16:20,960 --> 00:16:22,310
came from which is kind of cool because

361
00:16:22,310 --> 00:16:23,690
you have not just patients are on your

362
00:16:23,690 --> 00:16:25,760
own environment but patients are all for

363
00:16:25,760 --> 00:16:29,780
that chain of the outbreak other

364
00:16:29,780 --> 00:16:31,670
interesting things what is these names

365
00:16:31,670 --> 00:16:35,000
of the users searched it on the web and

366
00:16:35,000 --> 00:16:37,040
found their LinkedIn accounts and said

367
00:16:37,040 --> 00:16:39,410
they work for entropy tech and I do

368
00:16:39,410 --> 00:16:44,950
blahhh there's also read you know

369
00:16:44,950 --> 00:16:48,520
looking at some of the names so Oksana

370
00:16:48,520 --> 00:16:51,140
you google that the first thing that

371
00:16:51,140 --> 00:16:51,980
comes up it's at you

372
00:16:51,980 --> 00:16:55,130
in your name we didn't talk about I'm

373
00:16:55,130 --> 00:16:56,930
sure you guys know the whole history

374
00:16:56,930 --> 00:16:58,420
about and I don't know that's something

375
00:16:58,420 --> 00:17:00,920
we probably should cover but the whole

376
00:17:00,920 --> 00:17:02,630
history of the nod Petra what has been

377
00:17:02,630 --> 00:17:04,869
reported in news I guess validated was

378
00:17:04,869 --> 00:17:07,569
originated out of the Ukraine

379
00:17:07,569 --> 00:17:10,119
possibly Russian government interference

380
00:17:10,119 --> 00:17:13,640
meddling in Ukraine it was related to

381
00:17:13,640 --> 00:17:16,160
the ME Doc's software which is a tax

382
00:17:16,160 --> 00:17:18,020
software that is very commonly used in

383
00:17:18,020 --> 00:17:20,319
the Ukraine it was back doored and

384
00:17:20,319 --> 00:17:22,310
Aaron's gonna cover that more in depth

385
00:17:22,310 --> 00:17:23,720
so I don't want to really steal his

386
00:17:23,720 --> 00:17:25,970
thunder but looking at the pattern that

387
00:17:25,970 --> 00:17:30,110
first user named crane Ian so it may be

388
00:17:30,110 --> 00:17:32,390
Ukrainian user I don't know the other

389
00:17:32,390 --> 00:17:35,960
user name so we're all South Asian so it

390
00:17:35,960 --> 00:17:37,460
makes sense regionally how maybe this

391
00:17:37,460 --> 00:17:39,920
mal removed I'm starting to build this

392
00:17:39,920 --> 00:17:45,830
picture but we know now entropy tech is

393
00:17:45,830 --> 00:17:49,850
patient zero for our client so next step

394
00:17:49,850 --> 00:17:52,370
we're going to rebuild the symbol we

395
00:17:52,370 --> 00:17:54,680
want to that was a little challenging

396
00:17:54,680 --> 00:17:56,780
because it was a raid like a twelve

397
00:17:56,780 --> 00:18:00,650
drive raid 5 and and from forensics we

398
00:18:00,650 --> 00:18:01,730
don't want to muck around with the

399
00:18:01,730 --> 00:18:04,040
drives unless we have a backup so we had

400
00:18:04,040 --> 00:18:06,080
to forensically image the drive to make

401
00:18:06,080 --> 00:18:09,020
sure we had a good drive and then we can

402
00:18:09,020 --> 00:18:10,400
play around and rebuild the MB are we

403
00:18:10,400 --> 00:18:14,090
able to rebuild the MBR MFT did exist so

404
00:18:14,090 --> 00:18:15,980
we could power up took a little work

405
00:18:15,980 --> 00:18:18,020
talk to the vendor to get their sims off

406
00:18:18,020 --> 00:18:20,960
we're back up and running but then we

407
00:18:20,960 --> 00:18:24,140
could do queries on the sim and we then

408
00:18:24,140 --> 00:18:27,670
identified the actual authentication

409
00:18:27,670 --> 00:18:31,820
into the application we call the e stats

410
00:18:31,820 --> 00:18:33,500
application the first authentication

411
00:18:33,500 --> 00:18:35,990
into the environment so now we have the

412
00:18:35,990 --> 00:18:38,710
server a patient zero within C sides and

413
00:18:38,710 --> 00:18:43,070
the authentication we then did forensics

414
00:18:43,070 --> 00:18:44,990
on that box so it's rebuild the MBR but

415
00:18:44,990 --> 00:18:46,490
the MFT was encrypted so we have to

416
00:18:46,490 --> 00:18:48,710
carve out event logs and then we found

417
00:18:48,710 --> 00:18:50,480
the first successful malware indication

418
00:18:50,480 --> 00:18:52,700
via PS exec so the sim basically had

419
00:18:52,700 --> 00:18:54,740
domain controller logs not as lofty not

420
00:18:54,740 --> 00:18:56,780
as detailed so we decided to do

421
00:18:56,780 --> 00:18:59,150
forensics to get more information so I'm

422
00:18:59,150 --> 00:19:01,910
going to do a very quick nice of the

423
00:19:01,910 --> 00:19:05,210
graphics play-by-play of what happened

424
00:19:05,210 --> 00:19:08,150
so as you can see here on the left this

425
00:19:08,150 --> 00:19:10,160
is the entropy Tech environment there

426
00:19:10,160 --> 00:19:14,560
was a 24/7 trusted VPN into Seaside's

427
00:19:14,560 --> 00:19:17,000
Seaside's had a separate domain for the

428
00:19:17,000 --> 00:19:20,620
East debts application called ET net

429
00:19:21,550 --> 00:19:24,440
when I looked in the firewall logs the

430
00:19:24,440 --> 00:19:26,840
interesting thing is I did not find any

431
00:19:26,840 --> 00:19:31,300
SMB port 139 or port 4 5 traffic

432
00:19:31,300 --> 00:19:33,710
connections immediately preceding the

433
00:19:33,710 --> 00:19:35,330
propagation and I'm thinking that that

434
00:19:35,330 --> 00:19:37,370
doesn't make sense because you know the

435
00:19:37,370 --> 00:19:41,630
malware traversed from entropy tech I

436
00:19:41,630 --> 00:19:43,790
should see a record add in the firewall

437
00:19:43,790 --> 00:19:46,460
so that was that was got me wondering

438
00:19:46,460 --> 00:19:49,760
but I did see a day prior there was a

439
00:19:49,760 --> 00:19:52,130
port 4 or 5 session initiated a day

440
00:19:52,130 --> 00:19:55,190
earlier so huh this possibly could be

441
00:19:55,190 --> 00:19:59,210
involved I don't know yet what I then

442
00:19:59,210 --> 00:20:02,060
saw is the actual propagation of the

443
00:20:02,060 --> 00:20:05,890
malware into the e stats applications

444
00:20:05,890 --> 00:20:07,820
interesting and interesting in love

445
00:20:07,820 --> 00:20:10,640
enough it only successfully

446
00:20:10,640 --> 00:20:15,440
authenticated and ran on one server at

447
00:20:15,440 --> 00:20:18,740
first at first exactly the raining

448
00:20:18,740 --> 00:20:21,020
servers within this application domain

449
00:20:21,020 --> 00:20:24,620
it tried to run with credentials but it

450
00:20:24,620 --> 00:20:25,670
failed because they would only use

451
00:20:25,670 --> 00:20:28,010
credentials it knew from entropy tech it

452
00:20:28,010 --> 00:20:29,710
didn't know when he seaside credentials

453
00:20:29,710 --> 00:20:31,880
so when you combine that with the fact

454
00:20:31,880 --> 00:20:37,310
that there was an active session and we

455
00:20:37,310 --> 00:20:39,860
validated through eventually through the

456
00:20:39,860 --> 00:20:42,350
analysis of the malware that not petrol

457
00:20:42,350 --> 00:20:44,440
utilizes and abuses active sessions

458
00:20:44,440 --> 00:20:47,180
right so it doesn't need to actually

459
00:20:47,180 --> 00:20:48,560
have a credential if you have an active

460
00:20:48,560 --> 00:20:50,210
session between two trusted environments

461
00:20:50,210 --> 00:20:52,280
not Petra will be able to use that to

462
00:20:52,280 --> 00:20:55,970
spread so huh that's that's really

463
00:20:55,970 --> 00:20:58,370
interesting really cool not cool

464
00:20:58,370 --> 00:21:00,490
depending on what side you're on

465
00:21:00,490 --> 00:21:03,130
then from the host that it initially

466
00:21:03,130 --> 00:21:07,730
compromised it's excessively compromised

467
00:21:07,730 --> 00:21:09,320
other environments within the e stats

468
00:21:09,320 --> 00:21:11,480
environment with a different credential

469
00:21:11,480 --> 00:21:14,150
so now it makes sense the reason why was

470
00:21:14,150 --> 00:21:15,770
that different credentials if you use an

471
00:21:15,770 --> 00:21:18,320
active session it didn't actually

472
00:21:18,320 --> 00:21:20,840
capture the credentials on the entropy

473
00:21:20,840 --> 00:21:24,409
tech side so for the most part w digest

474
00:21:24,409 --> 00:21:26,210
which is a clear text caching of

475
00:21:26,210 --> 00:21:29,360
credential has a clear text caching a

476
00:21:29,360 --> 00:21:34,809
bit ability to text sorry W digests

477
00:21:34,809 --> 00:21:38,059
cached his clear text passwords that was

478
00:21:38,059 --> 00:21:40,070
likely turned off on the entropy text

479
00:21:40,070 --> 00:21:42,500
side but because of that active session

480
00:21:42,500 --> 00:21:46,309
it was able to then infect this box our

481
00:21:46,309 --> 00:21:48,320
client environment because it was a

482
00:21:48,320 --> 00:21:51,980
older version it was 2008 not our c1 or

483
00:21:51,980 --> 00:21:55,399
I'm sorry 2003 there was no patch to

484
00:21:55,399 --> 00:21:57,830
turn off the caching of clear text

485
00:21:57,830 --> 00:22:01,580
passwords so not Petra was able to get

486
00:22:01,580 --> 00:22:04,129
an actual Seaside's credential the

487
00:22:04,129 --> 00:22:05,870
actual password and used to spread

488
00:22:05,870 --> 00:22:08,889
internally so you're thinking okay well

489
00:22:08,889 --> 00:22:12,200
this is in within a separate domain it

490
00:22:12,200 --> 00:22:15,100
should be contained with proper security

491
00:22:15,100 --> 00:22:17,360
segmentations yes it should be contained

492
00:22:17,360 --> 00:22:20,049
within only the e stats application

493
00:22:20,049 --> 00:22:23,539
however what happened was there was a

494
00:22:23,539 --> 00:22:27,889
successful not Petrov successfully able

495
00:22:27,889 --> 00:22:29,600
from one of the boxes to move to the

496
00:22:29,600 --> 00:22:30,980
rest of the environment and within

497
00:22:30,980 --> 00:22:32,899
seconds basically owned their entire

498
00:22:32,899 --> 00:22:35,840
network since opposed so how did that

499
00:22:35,840 --> 00:22:37,720
happen

500
00:22:37,720 --> 00:22:40,820
we found that the domain admin have

501
00:22:40,820 --> 00:22:43,009
logged on to one of the boxes now domain

502
00:22:43,009 --> 00:22:44,690
admin for the entire environment logged

503
00:22:44,690 --> 00:22:48,470
on to one of the boxes in the e stats

504
00:22:48,470 --> 00:22:53,059
application because W digest clear text

505
00:22:53,059 --> 00:22:55,700
password caching was an able not Petra

506
00:22:55,700 --> 00:22:57,559
was able to capture the domain admins

507
00:22:57,559 --> 00:22:59,419
credentials and spread across their

508
00:22:59,419 --> 00:23:02,509
entire environment this is an issue of

509
00:23:02,509 --> 00:23:04,820
domain trust and a poor implementation

510
00:23:04,820 --> 00:23:11,720
of domain trust within security so we

511
00:23:11,720 --> 00:23:14,480
know now how we know patient zero we

512
00:23:14,480 --> 00:23:16,279
know how the malware spread we know a

513
00:23:16,279 --> 00:23:19,100
lot about the miss configurations of

514
00:23:19,100 --> 00:23:22,070
security for this client that we can

515
00:23:22,070 --> 00:23:23,990
report to them but an interesting tidbit

516
00:23:23,990 --> 00:23:26,659
is like whoa who's this person who's

517
00:23:26,659 --> 00:23:28,890
Oxana be

518
00:23:28,890 --> 00:23:34,140
and it did a little web search and we

519
00:23:34,140 --> 00:23:38,510
found that there was a freelance site of

520
00:23:38,510 --> 00:23:40,290
freelance sites for people to go look

521
00:23:40,290 --> 00:23:42,540
for freelancers coders doing different

522
00:23:42,540 --> 00:23:43,890
things there was actually a profile

523
00:23:43,890 --> 00:23:46,290
called Oksana be of someone in the

524
00:23:46,290 --> 00:23:48,809
Ukraine who did very very niche work

525
00:23:48,809 --> 00:23:51,450
that was so related to type of work

526
00:23:51,450 --> 00:23:54,440
there we go

527
00:23:55,340 --> 00:23:59,130
such niche work that was related to

528
00:23:59,130 --> 00:24:02,100
entropy text type of work now obviously

529
00:24:02,100 --> 00:24:04,169
this is just loose information it's just

530
00:24:04,169 --> 00:24:08,190
a hunch but it makes sense when you look

531
00:24:08,190 --> 00:24:09,690
at the path of the malware think about

532
00:24:09,690 --> 00:24:11,100
the story is well it started in the

533
00:24:11,100 --> 00:24:13,650
Ukraine again this is just this is not

534
00:24:13,650 --> 00:24:16,080
actual this is more of a just thinking

535
00:24:16,080 --> 00:24:18,870
and a hunch but it follows a story and

536
00:24:18,870 --> 00:24:21,809
should be Tek hires contractors hard one

537
00:24:21,809 --> 00:24:24,179
crane and me dog software installed on

538
00:24:24,179 --> 00:24:25,799
their box connected with an HP tech

539
00:24:25,799 --> 00:24:28,679
environment and it spread from there it

540
00:24:28,679 --> 00:24:30,510
slowly worked its way getting entropy

541
00:24:30,510 --> 00:24:33,270
Tech employees credentials slowly

542
00:24:33,270 --> 00:24:34,620
working its way out until I got to the

543
00:24:34,620 --> 00:24:36,960
east at application and from there and

544
00:24:36,960 --> 00:24:39,330
moved over to our client it's pretty

545
00:24:39,330 --> 00:24:40,919
tricky how this thing moved but you

546
00:24:40,919 --> 00:24:42,540
think about it like there weren't a lot

547
00:24:42,540 --> 00:24:44,549
of businesses that completely got hosed

548
00:24:44,549 --> 00:24:46,470
by not Petra it's not like you know

549
00:24:46,470 --> 00:24:49,230
you're hearing like there's a good

550
00:24:49,230 --> 00:24:51,780
handful but maybe that's because it

551
00:24:51,780 --> 00:24:53,880
requires all these gates and steps to

552
00:24:53,880 --> 00:24:56,610
occur right this is pretty complex to

553
00:24:56,610 --> 00:24:58,890
happen but all these conditions existed

554
00:24:58,890 --> 00:25:01,650
in order for the not Petra to affect our

555
00:25:01,650 --> 00:25:08,100
client code so taking some of the good

556
00:25:08,100 --> 00:25:10,860
lessons in Christians story they're

557
00:25:10,860 --> 00:25:13,049
really that you should really take home

558
00:25:13,049 --> 00:25:15,750
from you is really to like evaluate both

559
00:25:15,750 --> 00:25:17,700
the network segmentation pieces but also

560
00:25:17,700 --> 00:25:19,500
the trust relationships you have with

561
00:25:19,500 --> 00:25:24,179
those external parties frequently those

562
00:25:24,179 --> 00:25:26,210
can be abused in ways that you can't

563
00:25:26,210 --> 00:25:31,290
really war game or envision when you're

564
00:25:31,290 --> 00:25:34,230
first setting those up the other

565
00:25:34,230 --> 00:25:36,360
takeaway there was in a lot of the

566
00:25:36,360 --> 00:25:38,040
organizations where we saw that not

567
00:25:38,040 --> 00:25:39,570
petia had

568
00:25:39,570 --> 00:25:42,330
catastrophic ly taking them down that

569
00:25:42,330 --> 00:25:44,910
happened within 50 minutes in one place

570
00:25:44,910 --> 00:25:47,100
it was pretty quick

571
00:25:47,100 --> 00:25:49,440
in other places it was within an hour as

572
00:25:49,440 --> 00:25:53,400
well it was if it's something that I

573
00:25:53,400 --> 00:25:55,260
don't think anyone has been looking at

574
00:25:55,260 --> 00:25:58,980
or building their defenses for until

575
00:25:58,980 --> 00:26:01,260
this past year but when we took a look

576
00:26:01,260 --> 00:26:03,540
at not petia itself what we really found

577
00:26:03,540 --> 00:26:07,320
out was that payload the way that it was

578
00:26:07,320 --> 00:26:09,510
pulled down was through a Trojan I zap

579
00:26:09,510 --> 00:26:11,750
Lakai Chinon the EM edocs

580
00:26:11,750 --> 00:26:16,170
statistics software and attacks attack

581
00:26:16,170 --> 00:26:18,570
submission software that update was

582
00:26:18,570 --> 00:26:21,540
truly pushed on June 22nd so what a lot

583
00:26:21,540 --> 00:26:23,850
of organizations had done was they

584
00:26:23,850 --> 00:26:26,100
pulled down that software tested that

585
00:26:26,100 --> 00:26:27,780
software made sure that it didn't cause

586
00:26:27,780 --> 00:26:29,580
any implement any problems with their

587
00:26:29,580 --> 00:26:31,800
implementation and they didn't see

588
00:26:31,800 --> 00:26:33,600
anything wrong with it but then the

589
00:26:33,600 --> 00:26:37,350
actual malicious payload was pushed six

590
00:26:37,350 --> 00:26:39,960
days later again on a Friday

591
00:26:39,960 --> 00:26:42,270
luckily which caused me to have to work

592
00:26:42,270 --> 00:26:46,710
all weekend again so before that they

593
00:26:46,710 --> 00:26:49,080
had pushed previous implementations of

594
00:26:49,080 --> 00:26:51,600
this back door within that Trojan high

595
00:26:51,600 --> 00:26:53,550
software first on May 15th and

596
00:26:53,550 --> 00:26:56,700
previously on April 14th but one of the

597
00:26:56,700 --> 00:27:00,060
biggest stories with this was afterwards

598
00:27:00,060 --> 00:27:02,730
there was a lot of marketing and a lot

599
00:27:02,730 --> 00:27:06,390
of press about another worm called bad

600
00:27:06,390 --> 00:27:10,230
rabbit but bad rabbit really almost

601
00:27:10,230 --> 00:27:12,360
didn't impact any of our clients at all

602
00:27:12,360 --> 00:27:15,690
what we saw there was that were that

603
00:27:15,690 --> 00:27:17,700
tool had three components one of them

604
00:27:17,700 --> 00:27:19,200
was that this concretion component

605
00:27:19,200 --> 00:27:21,330
another one was really just there to

606
00:27:21,330 --> 00:27:23,520
shut down and restart the hosts and then

607
00:27:23,520 --> 00:27:26,220
the third part was a worm component but

608
00:27:26,220 --> 00:27:28,770
it uses hard-coded credentials for the

609
00:27:28,770 --> 00:27:30,620
IPC dollar share in SMB

610
00:27:30,620 --> 00:27:35,340
the big difference with this backdoor

611
00:27:35,340 --> 00:27:37,110
versus the other backdoor in the other

612
00:27:37,110 --> 00:27:39,420
work and the reason why this didn't seem

613
00:27:39,420 --> 00:27:42,390
to spread quite so quickly was it didn't

614
00:27:42,390 --> 00:27:44,150
pass the credentials from host to host

615
00:27:44,150 --> 00:27:47,640
like not petia dead on the command line

616
00:27:47,640 --> 00:27:50,190
when it propagated through an SMB

617
00:27:50,190 --> 00:27:51,840
which meant that it didn't take

618
00:27:51,840 --> 00:27:53,250
credentials that were stolen from

619
00:27:53,250 --> 00:27:55,470
Christians computer to my computer to

620
00:27:55,470 --> 00:27:57,600
the next computer and move forward

621
00:27:57,600 --> 00:27:59,490
through all of the hosts that it could

622
00:27:59,490 --> 00:28:01,410
touch and those credentials could

623
00:28:01,410 --> 00:28:04,710
authenticate too so those were the

624
00:28:04,710 --> 00:28:07,530
stories that got the most press this

625
00:28:07,530 --> 00:28:10,560
past year but there were others worms

626
00:28:10,560 --> 00:28:12,060
that have been spreading and that have

627
00:28:12,060 --> 00:28:14,640
been being used which really had a much

628
00:28:14,640 --> 00:28:16,800
larger impact within our organizations

629
00:28:16,800 --> 00:28:18,720
in our and the organizations that we

630
00:28:18,720 --> 00:28:22,110
monitor the first one and the one that

631
00:28:22,110 --> 00:28:24,450
we see almost every single day is a

632
00:28:24,450 --> 00:28:27,030
motet emote it's really just a piece of

633
00:28:27,030 --> 00:28:28,650
software that's there to load other

634
00:28:28,650 --> 00:28:32,100
software on your computer it's really

635
00:28:32,100 --> 00:28:35,130
opportunistic cybercrime malware but

636
00:28:35,130 --> 00:28:36,930
what we've been seeing is they've been

637
00:28:36,930 --> 00:28:39,120
deploying this SMB spreader module with

638
00:28:39,120 --> 00:28:42,390
it and at first it was just purely mini

639
00:28:42,390 --> 00:28:44,250
cats based and that was first based up

640
00:28:44,250 --> 00:28:45,750
and that was first introduced back in

641
00:28:45,750 --> 00:28:50,010
July 2017 and then it started to get a

642
00:28:50,010 --> 00:28:52,230
little bit more press when in November

643
00:28:52,230 --> 00:28:55,440
2017 they introduced a variant of it

644
00:28:55,440 --> 00:28:57,540
which also used the eternal romance

645
00:28:57,540 --> 00:29:02,220
exploit in it the funny thing was when

646
00:29:02,220 --> 00:29:04,980
they added that eternal romance exploit

647
00:29:04,980 --> 00:29:08,100
to the worm they broke it and it only

648
00:29:08,100 --> 00:29:10,500
worked and it only successfully

649
00:29:10,500 --> 00:29:14,790
propagated within the local host that it

650
00:29:14,790 --> 00:29:16,770
had already compromised when it was

651
00:29:16,770 --> 00:29:18,690
trying to propagate to additional hosts

652
00:29:18,690 --> 00:29:20,880
it actually didn't drop its payload and

653
00:29:20,880 --> 00:29:23,790
didn't successfully propagate the other

654
00:29:23,790 --> 00:29:25,280
one that we've been seeing a lot of

655
00:29:25,280 --> 00:29:27,780
husband the trick bought SMB spreader

656
00:29:27,780 --> 00:29:30,510
and this first got a lot of press back

657
00:29:30,510 --> 00:29:34,260
in July 2017 as well but at that point

658
00:29:34,260 --> 00:29:37,110
all it was doing was trying to enumerate

659
00:29:37,110 --> 00:29:39,210
the credentials that it could see

660
00:29:39,210 --> 00:29:43,260
through SMB within your organization but

661
00:29:43,260 --> 00:29:45,810
then at some point and I'm not exactly

662
00:29:45,810 --> 00:29:47,910
sure when they introduced it they also

663
00:29:47,910 --> 00:29:50,400
added mini cats and the ability to

664
00:29:50,400 --> 00:29:52,590
scrape credentials through from

665
00:29:52,590 --> 00:29:57,950
plaintext into that worm those two worms

666
00:29:57,950 --> 00:30:00,690
they've not been deploying ransomware

667
00:30:00,690 --> 00:30:02,640
they've just been deploying themselves

668
00:30:02,640 --> 00:30:03,510
and other pieces of

669
00:30:03,510 --> 00:30:06,030
crime work but what's been interesting

670
00:30:06,030 --> 00:30:08,940
in what has been causing a lot of issues

671
00:30:08,940 --> 00:30:11,790
in organizations has been when those

672
00:30:11,790 --> 00:30:14,790
worms are spreading they're spreading so

673
00:30:14,790 --> 00:30:17,190
quickly and overwhelming to the main

674
00:30:17,190 --> 00:30:19,140
controllers and Active Directory systems

675
00:30:19,140 --> 00:30:21,720
within organizations that people are no

676
00:30:21,720 --> 00:30:23,970
longer able to authenticate to hosts and

677
00:30:23,970 --> 00:30:25,580
it results in a denial of service

678
00:30:25,580 --> 00:30:28,710
situation within these organizations and

679
00:30:28,710 --> 00:30:31,380
we've seen this a lot of you know in a

680
00:30:31,380 --> 00:30:36,480
lot of situations so how can

681
00:30:36,480 --> 00:30:38,610
organizations mitigate against these

682
00:30:38,610 --> 00:30:42,300
situations the first bit is yes you have

683
00:30:42,300 --> 00:30:46,800
solutely still need to patch so yeah

684
00:30:46,800 --> 00:30:48,330
we're not going to tell you anything

685
00:30:48,330 --> 00:30:50,550
here novel or new it's all fun in the

686
00:30:50,550 --> 00:30:52,410
nose right basic security hygiene

687
00:30:52,410 --> 00:30:54,750
repeated over and over and over and as

688
00:30:54,750 --> 00:30:56,760
you've seen in my example if it was just

689
00:30:56,760 --> 00:31:00,120
basic security hygiene implemented maybe

690
00:31:00,120 --> 00:31:01,770
just one or two gates would have been

691
00:31:01,770 --> 00:31:03,270
prevented and this wouldn't have had a

692
00:31:03,270 --> 00:31:06,930
major impact to our client so one of the

693
00:31:06,930 --> 00:31:08,400
things that I do and I work on as I do a

694
00:31:08,400 --> 00:31:09,450
lot of thought they've been over the

695
00:31:09,450 --> 00:31:11,340
last four years for secure works so I

696
00:31:11,340 --> 00:31:12,510
looked at a lot of environments and

697
00:31:12,510 --> 00:31:15,630
there's almost a correlation between how

698
00:31:15,630 --> 00:31:17,970
ugly and bad and dirty your environment

699
00:31:17,970 --> 00:31:19,470
is and what's just basic stuff that that

700
00:31:19,470 --> 00:31:21,480
client has implemented and when we do

701
00:31:21,480 --> 00:31:24,920
are after a threat hunting weed or our

702
00:31:24,920 --> 00:31:27,060
recommendations the top recommendations

703
00:31:27,060 --> 00:31:28,440
are basic stuff that you've heard over

704
00:31:28,440 --> 00:31:31,830
the last 10 years one of them get

705
00:31:31,830 --> 00:31:33,750
updated operating systems right it's

706
00:31:33,750 --> 00:31:37,110
2018 not 2008 you need to run supported

707
00:31:37,110 --> 00:31:39,000
operating systems in the case of our

708
00:31:39,000 --> 00:31:41,370
client if they had to support in

709
00:31:41,370 --> 00:31:43,830
operating systems they could have

710
00:31:43,830 --> 00:31:46,790
patched the W digest clear text caching

711
00:31:46,790 --> 00:31:49,140
interesting enough and this is a sure

712
00:31:49,140 --> 00:31:50,610
you guys are aware of this right the

713
00:31:50,610 --> 00:31:53,760
point of contact for our client was the

714
00:31:53,760 --> 00:31:54,990
security guy was like yeah I've been

715
00:31:54,990 --> 00:31:57,510
trying to get these updated for a while

716
00:31:57,510 --> 00:31:59,250
for years however there's backlash

717
00:31:59,250 --> 00:32:01,410
because this business area needs the

718
00:32:01,410 --> 00:32:03,150
software and there's like they don't

719
00:32:03,150 --> 00:32:04,890
make it anymore or they don't want to

720
00:32:04,890 --> 00:32:06,240
buy the newest version and they need it

721
00:32:06,240 --> 00:32:07,530
and I've been told to keep it running

722
00:32:07,530 --> 00:32:09,510
and I can't muck around with I don't

723
00:32:09,510 --> 00:32:11,280
even know like I have no idea what goes

724
00:32:11,280 --> 00:32:12,330
on there but I got to keep it running

725
00:32:12,330 --> 00:32:16,730
well this is what happens right

726
00:32:16,730 --> 00:32:23,190
interesting so eternal blue history of

727
00:32:23,190 --> 00:32:25,500
that is Microsoft actually took a highly

728
00:32:25,500 --> 00:32:27,330
unusual step in their own words and

729
00:32:27,330 --> 00:32:30,210
created a patch for unsupported the

730
00:32:30,210 --> 00:32:34,410
Windows XP and 2003 server so an ironic

731
00:32:34,410 --> 00:32:38,910
tidbit with Seaside's was even though

732
00:32:38,910 --> 00:32:39,930
they asked for this

733
00:32:39,930 --> 00:32:42,510
they were running server 2000 I'm not

734
00:32:42,510 --> 00:32:44,070
kidding they were running server 2000

735
00:32:44,070 --> 00:32:47,160
which there was no patch for those

736
00:32:47,160 --> 00:32:49,230
server 2000 belonging to a specific

737
00:32:49,230 --> 00:32:50,820
application that they needed up and

738
00:32:50,820 --> 00:32:52,470
running because their business one

739
00:32:52,470 --> 00:32:55,950
business needed it those got infected by

740
00:32:55,950 --> 00:32:59,400
not Petra but not Petra was not able to

741
00:32:59,400 --> 00:33:01,890
replace the MBR or encrypt the MFT

742
00:33:01,890 --> 00:33:03,870
so it's almost like saying security by

743
00:33:03,870 --> 00:33:05,820
obsolescent which is not the story I

744
00:33:05,820 --> 00:33:07,680
want to tell sorry it's not this the the

745
00:33:07,680 --> 00:33:10,500
message I want to say but it's just kind

746
00:33:10,500 --> 00:33:13,730
of ironic that that happened

747
00:33:14,090 --> 00:33:16,650
segmentation so segmentation we all know

748
00:33:16,650 --> 00:33:18,660
segmentation segmentation occurs on

749
00:33:18,660 --> 00:33:19,980
multiple levels we all familiar with

750
00:33:19,980 --> 00:33:22,350
network segmentation firewalls bla bla

751
00:33:22,350 --> 00:33:24,660
bla bla and would that help here

752
00:33:24,660 --> 00:33:26,700
somewhat I mean it was a trusted VPN

753
00:33:26,700 --> 00:33:29,070
connected that had SMB traffic already

754
00:33:29,070 --> 00:33:32,790
open right so you know it's Network

755
00:33:32,790 --> 00:33:34,500
segmentation may have not had worked

756
00:33:34,500 --> 00:33:37,920
properly there for this case the client

757
00:33:37,920 --> 00:33:40,800
had an open flat network and there were

758
00:33:40,800 --> 00:33:44,670
other sub there were other clients that

759
00:33:44,670 --> 00:33:47,340
shared the network other organizations

760
00:33:47,340 --> 00:33:48,660
that shared that network that were also

761
00:33:48,660 --> 00:33:50,550
impacted so segmentation definitely

762
00:33:50,550 --> 00:33:52,230
would have helped but segmentation goes

763
00:33:52,230 --> 00:33:56,040
beyond work domain segmentation you know

764
00:33:56,040 --> 00:33:57,150
segmenting your domains and from

765
00:33:57,150 --> 00:33:59,640
enforced and something called privileged

766
00:33:59,640 --> 00:34:02,100
access hardening which Erin is going to

767
00:34:02,100 --> 00:34:05,490
cover next yeah so what Christian was

768
00:34:05,490 --> 00:34:07,920
saying with network with segmentation is

769
00:34:07,920 --> 00:34:10,110
that in a lot of organizations I think

770
00:34:10,110 --> 00:34:11,940
they think that once they implement a

771
00:34:11,940 --> 00:34:14,250
firewall and set up that sort of policy

772
00:34:14,250 --> 00:34:16,080
between different parts of the network

773
00:34:16,080 --> 00:34:18,000
that their network has been segmented

774
00:34:18,000 --> 00:34:20,850
and what we've been seeing time and

775
00:34:20,850 --> 00:34:23,730
again at the top of this large

776
00:34:23,730 --> 00:34:26,668
infographic of sorts is an attacker

777
00:34:26,668 --> 00:34:28,739
comes in they just compromised a user

778
00:34:28,739 --> 00:34:31,050
workstation from that user workstation

779
00:34:31,050 --> 00:34:33,719
it's almost like clockwork we always see

780
00:34:33,719 --> 00:34:36,239
this where they just use mini cats they

781
00:34:36,239 --> 00:34:37,830
dump the clear text credentials from

782
00:34:37,830 --> 00:34:39,600
their the House of hashes that they can

783
00:34:39,600 --> 00:34:42,000
get access to and then they pass the

784
00:34:42,000 --> 00:34:44,340
hash from host to host a host that

785
00:34:44,340 --> 00:34:45,989
allows them to access the domain

786
00:34:45,989 --> 00:34:48,480
controller eventually because at some

787
00:34:48,480 --> 00:34:51,149
point a domain admin has logged into one

788
00:34:51,149 --> 00:34:52,469
of those hosts that they compromised

789
00:34:52,469 --> 00:34:55,350
they take that domain admins credential

790
00:34:55,350 --> 00:34:57,120
and they're able to use that to access

791
00:34:57,120 --> 00:34:59,400
every single host in the environment

792
00:34:59,400 --> 00:35:01,560
we've seen it in these automated worms

793
00:35:01,560 --> 00:35:04,830
like not patio we've also been seeing it

794
00:35:04,830 --> 00:35:07,620
in more targeted ransomware cases like

795
00:35:07,620 --> 00:35:09,480
the Sam Sam cases which have taken down

796
00:35:09,480 --> 00:35:12,330
other entire networks and then been

797
00:35:12,330 --> 00:35:17,070
ransom one-off Microsoft has introduced

798
00:35:17,070 --> 00:35:19,950
a new set of technology and I don't know

799
00:35:19,950 --> 00:35:21,420
how new this is anymore but it came with

800
00:35:21,420 --> 00:35:24,570
Windows 10 in essence and what that does

801
00:35:24,570 --> 00:35:27,330
is and and their recommendations are for

802
00:35:27,330 --> 00:35:29,370
you to use a privileged access

803
00:35:29,370 --> 00:35:31,500
workstation and that's the little red

804
00:35:31,500 --> 00:35:33,450
computer up in the corner and that

805
00:35:33,450 --> 00:35:35,790
privileged access workstation allows

806
00:35:35,790 --> 00:35:39,060
only that admin to create credentials on

807
00:35:39,060 --> 00:35:41,670
that host and then if that admin needs

808
00:35:41,670 --> 00:35:44,010
to have actual can only have one laptop

809
00:35:44,010 --> 00:35:47,970
or one workstation they have a virtual

810
00:35:47,970 --> 00:35:49,500
machine which they'll use for their

811
00:35:49,500 --> 00:35:54,090
actual user land life to access their

812
00:35:54,090 --> 00:35:56,160
email to go onto the web to look at

813
00:35:56,160 --> 00:35:59,610
sharepoint or whatever now taking an

814
00:35:59,610 --> 00:36:02,460
even larger step from that is to create

815
00:36:02,460 --> 00:36:05,340
this and it's truly a four tiered

816
00:36:05,340 --> 00:36:08,220
set of credentials but here it only

817
00:36:08,220 --> 00:36:09,960
shows the first three tiers which are

818
00:36:09,960 --> 00:36:11,580
based on your administrator credentials

819
00:36:11,580 --> 00:36:16,200
a tier 0 your domain admin will only

820
00:36:16,200 --> 00:36:18,180
live within tier 0 and only

821
00:36:18,180 --> 00:36:21,270
authenticated tier 0 that domain admin

822
00:36:21,270 --> 00:36:21,930
credential

823
00:36:21,930 --> 00:36:24,300
is not usable and not useful for

824
00:36:24,300 --> 00:36:28,740
accessing the next tier tier 1 is made

825
00:36:28,740 --> 00:36:33,350
up of your core workstations and your

826
00:36:33,350 --> 00:36:35,580
what's the term I'm looking for your

827
00:36:35,580 --> 00:36:37,770
your core workstations and your core and

828
00:36:37,770 --> 00:36:38,020
your

829
00:36:38,020 --> 00:36:41,470
core servers that put business-critical

830
00:36:41,470 --> 00:36:43,720
applications out there and that's

831
00:36:43,720 --> 00:36:45,430
separate from your domain controllers in

832
00:36:45,430 --> 00:36:48,700
your Active Directory administration so

833
00:36:48,700 --> 00:36:51,100
the credentials from tier zero which are

834
00:36:51,100 --> 00:36:53,200
Active Directory administrator

835
00:36:53,200 --> 00:36:56,220
credentials can't authenticate and can't

836
00:36:56,220 --> 00:36:59,200
administrate your work your your

837
00:36:59,200 --> 00:37:01,810
business critical servers the Tier one

838
00:37:01,810 --> 00:37:04,390
credentials have to stay on tier one

839
00:37:04,390 --> 00:37:06,520
they only access and they only

840
00:37:06,520 --> 00:37:08,650
authenticate to your business critical

841
00:37:08,650 --> 00:37:11,650
servers but then those credentials can't

842
00:37:11,650 --> 00:37:13,540
even access the workstations that your

843
00:37:13,540 --> 00:37:15,520
normal people are using and that's what

844
00:37:15,520 --> 00:37:18,250
makes up tier two tier two are your

845
00:37:18,250 --> 00:37:22,120
administrator credentials for your for

846
00:37:22,120 --> 00:37:25,420
your helpdesk and for your user

847
00:37:25,420 --> 00:37:27,850
workstation administrator staff those

848
00:37:27,850 --> 00:37:30,760
credentials stay there now in this and

849
00:37:30,760 --> 00:37:32,680
then the fourth tier which isn't shown

850
00:37:32,680 --> 00:37:35,260
in this image is made up of your normal

851
00:37:35,260 --> 00:37:38,560
user credentials using this model

852
00:37:38,560 --> 00:37:40,810
whenever an attacker compromises one of

853
00:37:40,810 --> 00:37:42,340
those workstations through a phishing

854
00:37:42,340 --> 00:37:45,900
email which happens every day everywhere

855
00:37:45,900 --> 00:37:48,490
when they try to scrape those

856
00:37:48,490 --> 00:37:50,890
credentials from memory they're no

857
00:37:50,890 --> 00:37:52,750
longer able to use those for anything

858
00:37:52,750 --> 00:37:54,610
other than accessing other people's

859
00:37:54,610 --> 00:37:56,770
workstations and other things on that

860
00:37:56,770 --> 00:37:59,290
tier if you're able to keep these things

861
00:37:59,290 --> 00:38:03,820
clear and clean like that so we strongly

862
00:38:03,820 --> 00:38:06,130
recommend that people move to this sort

863
00:38:06,130 --> 00:38:09,720
of model and that level of segmentation

864
00:38:09,720 --> 00:38:12,190
in almost all of the cases where we've

865
00:38:12,190 --> 00:38:13,690
been seeing entire organizations

866
00:38:13,690 --> 00:38:17,620
compromised and and put in terrible

867
00:38:17,620 --> 00:38:19,480
situations with ransomware but then

868
00:38:19,480 --> 00:38:21,460
previously with a lot of the apt style

869
00:38:21,460 --> 00:38:23,290
intrusions it was because there was

870
00:38:23,290 --> 00:38:26,140
usually a single admin which allowed you

871
00:38:26,140 --> 00:38:28,540
to authenticate and administrate all of

872
00:38:28,540 --> 00:38:30,790
the hosts and it was that shared admin

873
00:38:30,790 --> 00:38:33,310
account which the helpdesk used the

874
00:38:33,310 --> 00:38:36,400
server administrators used as well as

875
00:38:36,400 --> 00:38:39,130
the domain administrators used and they

876
00:38:39,130 --> 00:38:41,590
had a single password equally or you

877
00:38:41,590 --> 00:38:43,090
know a single set of credentials so once

878
00:38:43,090 --> 00:38:45,130
you get that hash to pass the hash

879
00:38:45,130 --> 00:38:48,550
across the organization so in summary

880
00:38:48,550 --> 00:38:50,850
the mitigations our patch absolutely

881
00:38:50,850 --> 00:38:53,400
we put those patches into place and this

882
00:38:53,400 --> 00:38:55,830
is pretty basic and pretty standard

883
00:38:55,830 --> 00:38:58,380
stuff we're not selling any special

884
00:38:58,380 --> 00:38:59,550
things but if you want to buy stuff you

885
00:38:59,550 --> 00:39:02,490
can buy stuff from us too but also

886
00:39:02,490 --> 00:39:04,560
segmentation which is way more than just

887
00:39:04,560 --> 00:39:07,530
firewalls and really includes your

888
00:39:07,530 --> 00:39:08,730
different separate Active Directory

889
00:39:08,730 --> 00:39:11,700
forst's but creating that privileged

890
00:39:11,700 --> 00:39:13,760
access workstation and tiered model

891
00:39:13,760 --> 00:39:18,390
really helps organizations improve your

892
00:39:18,390 --> 00:39:21,810
security posture plus disabling wmic

893
00:39:21,810 --> 00:39:26,610
where possible the W digests credentials

894
00:39:26,610 --> 00:39:29,610
and scraping those really is something

895
00:39:29,610 --> 00:39:31,740
that we see all the time there's there

896
00:39:31,740 --> 00:39:35,250
are a lot of single sign-on applications

897
00:39:35,250 --> 00:39:37,500
which require W digests to be running

898
00:39:37,500 --> 00:39:39,560
and actually require people to use that

899
00:39:39,560 --> 00:39:43,020
we understand that try to segment those

900
00:39:43,020 --> 00:39:44,730
organizations and those parts of your

901
00:39:44,730 --> 00:39:47,130
organization even more so than the rest

902
00:39:47,130 --> 00:39:50,430
of the organization yeah and if not

903
00:39:50,430 --> 00:39:52,620
privileged access workstations don't use

904
00:39:52,620 --> 00:39:54,750
a single account to administrate all of

905
00:39:54,750 --> 00:39:58,470
your hosts that is our presentation

906
00:39:58,470 --> 00:40:00,790
we've got four minutes I think

907
00:40:00,790 --> 00:40:08,960
[Applause]

