1
00:00:04,070 --> 00:00:06,680
hey everybody thanks for coming out this

2
00:00:06,680 --> 00:00:09,110
afternoon I am the last thing standing

3
00:00:09,110 --> 00:00:11,059
between you and the after party so I

4
00:00:11,059 --> 00:00:13,070
will make it really quick we're going to

5
00:00:13,070 --> 00:00:15,200
talk about mage cart and the risk of

6
00:00:15,200 --> 00:00:18,170
third party JavaScript in web

7
00:00:18,170 --> 00:00:22,880
applications so this is kind of the

8
00:00:22,880 --> 00:00:24,470
breakdown I'll tell you a little bit

9
00:00:24,470 --> 00:00:27,800
about myself talk about what third party

10
00:00:27,800 --> 00:00:30,230
JavaScript really means we'll talk about

11
00:00:30,230 --> 00:00:32,570
mage cart what that group of threat

12
00:00:32,570 --> 00:00:34,969
actors is all about what a content

13
00:00:34,969 --> 00:00:37,790
security policy is some challenges in

14
00:00:37,790 --> 00:00:39,500
implementing one and then we'll do a

15
00:00:39,500 --> 00:00:41,060
little bit of Q&A at the end

16
00:00:41,060 --> 00:00:46,100
assuming there's some time so I am a

17
00:00:46,100 --> 00:00:48,470
Pittsburgh native Columbus transplant

18
00:00:48,470 --> 00:00:51,320
that is very much what it felt like to

19
00:00:51,320 --> 00:00:53,480
move to Columbus I had to get a whole

20
00:00:53,480 --> 00:00:55,610
new set of eyeballs to look around

21
00:00:55,610 --> 00:00:58,040
things are a little different there and

22
00:00:58,040 --> 00:00:59,420
it's my one-year anniversary I actually

23
00:00:59,420 --> 00:01:03,440
moved there the day after b-sides last

24
00:01:03,440 --> 00:01:06,259
year so I'm I'm glad to be here again

25
00:01:06,259 --> 00:01:08,510
for sure and thanks to everyone from

26
00:01:08,510 --> 00:01:10,190
besides all the organizers and

27
00:01:10,190 --> 00:01:11,930
everything for putting on a great

28
00:01:11,930 --> 00:01:18,110
conference again this year so I'm a

29
00:01:18,110 --> 00:01:20,750
senior InfoSec architect at Dick's

30
00:01:20,750 --> 00:01:22,729
Sporting Goods I love mango packets

31
00:01:22,729 --> 00:01:24,979
sequel injection long walks on the stack

32
00:01:24,979 --> 00:01:28,640
I know 50 shades of InfoSec red blue

33
00:01:28,640 --> 00:01:30,830
purple orange I've seen them all in my

34
00:01:30,830 --> 00:01:33,770
career and I'm a little bit noisy I've

35
00:01:33,770 --> 00:01:36,290
done some speaking for sans besides

36
00:01:36,290 --> 00:01:40,100
Derby is e-squared some other places

37
00:01:40,100 --> 00:01:43,430
I'm a besides Pittsburgh to SOT 2017

38
00:01:43,430 --> 00:01:45,380
black and gold badge holder which is

39
00:01:45,380 --> 00:01:46,880
probably the greatest honor I've ever

40
00:01:46,880 --> 00:01:49,400
received in my life and none of this is

41
00:01:49,400 --> 00:01:51,740
horn Tooting or bragging time I'm just

42
00:01:51,740 --> 00:01:53,630
telling you all this because I've seen

43
00:01:53,630 --> 00:01:56,420
some things okay I've seen a lot of

44
00:01:56,420 --> 00:01:58,040
things some of those things cannot be

45
00:01:58,040 --> 00:02:03,619
unseen this is what it looks like to be

46
00:02:03,619 --> 00:02:05,270
an information security at Dick's

47
00:02:05,270 --> 00:02:08,780
Sporting Goods you know you're fighting

48
00:02:08,780 --> 00:02:10,908
invisible bad guys at the same time

49
00:02:10,908 --> 00:02:12,439
you're trying to live the brand be

50
00:02:12,439 --> 00:02:15,049
healthy and you know you're just trying

51
00:02:15,049 --> 00:02:16,909
to do your best and you just really

52
00:02:16,909 --> 00:02:17,720
don't know where these guys

53
00:02:17,720 --> 00:02:20,600
our but that's that's that's my life

54
00:02:20,600 --> 00:02:24,140
most days so let's talk about

55
00:02:24,140 --> 00:02:26,750
third-party JavaScript integrations what

56
00:02:26,750 --> 00:02:29,570
they are who uses them and why they're

57
00:02:29,570 --> 00:02:34,340
used so JavaScript third-party

58
00:02:34,340 --> 00:02:35,870
JavaScript is essentially JavaScript

59
00:02:35,870 --> 00:02:38,030
that's instructed to load into the users

60
00:02:38,030 --> 00:02:40,700
browser from a domain other than the

61
00:02:40,700 --> 00:02:44,990
source other than the origin so you know

62
00:02:44,990 --> 00:02:47,570
you can the your web page may say ok

63
00:02:47,570 --> 00:02:49,670
call out to this third party to load up

64
00:02:49,670 --> 00:02:52,700
some JavaScript and that might you know

65
00:02:52,700 --> 00:02:54,260
be something that you do for a number of

66
00:02:54,260 --> 00:02:56,750
reasons we'll get into that the trusted

67
00:02:56,750 --> 00:02:58,640
code and I put the question mark there's

68
00:02:58,640 --> 00:03:00,590
because that you know you don't really

69
00:03:00,590 --> 00:03:02,000
know it's trusted it's coming from a

70
00:03:02,000 --> 00:03:04,970
third party and and you don't really

71
00:03:04,970 --> 00:03:06,800
have any control over it because it's

72
00:03:06,800 --> 00:03:08,240
coming from a domain that you don't own

73
00:03:08,240 --> 00:03:11,540
and this is often referred to as tagging

74
00:03:11,540 --> 00:03:14,840
or tags by the industry or by the

75
00:03:14,840 --> 00:03:16,850
business so if you hear them talking

76
00:03:16,850 --> 00:03:18,620
about hey I want to put a new tag on the

77
00:03:18,620 --> 00:03:20,510
website this is what they're talking

78
00:03:20,510 --> 00:03:25,090
about so who wants to do this retail

79
00:03:25,090 --> 00:03:28,880
right here hospitality industry also

80
00:03:28,880 --> 00:03:31,760
uses a lot of JavaScript tagging you

81
00:03:31,760 --> 00:03:33,110
know so I'm talking about like hotels

82
00:03:33,110 --> 00:03:35,500
airlines those kind of folks

83
00:03:35,500 --> 00:03:38,959
entertainment industry Ticketmaster what

84
00:03:38,959 --> 00:03:40,670
is a big user of this and they actually

85
00:03:40,670 --> 00:03:42,650
got breached because of this and we'll

86
00:03:42,650 --> 00:03:43,940
talk about that a little bit more I

87
00:03:43,940 --> 00:03:46,040
mentioned Airlines and it's really any

88
00:03:46,040 --> 00:03:50,239
site that has an e comp residence or you

89
00:03:50,239 --> 00:03:52,310
know social media anybody can use

90
00:03:52,310 --> 00:03:54,530
third-party JavaScript and and you'd be

91
00:03:54,530 --> 00:03:55,940
surprised if you pulled up some of your

92
00:03:55,940 --> 00:03:58,190
favorite websites did a view source and

93
00:03:58,190 --> 00:03:59,690
looked at all the different domains that

94
00:03:59,690 --> 00:04:03,530
your browser is talking to so why why

95
00:04:03,530 --> 00:04:05,480
would we do this well marketing purpose

96
00:04:05,480 --> 00:04:08,989
is so you know I go to Amazon and I look

97
00:04:08,989 --> 00:04:11,180
at a product and you know suddenly that

98
00:04:11,180 --> 00:04:13,670
same product follows you around on every

99
00:04:13,670 --> 00:04:16,130
other website you visit so that's that's

100
00:04:16,130 --> 00:04:19,850
third-party JavaScript customer service

101
00:04:19,850 --> 00:04:22,040
is our customer experience a lot of

102
00:04:22,040 --> 00:04:25,280
times you know your your internal team

103
00:04:25,280 --> 00:04:27,260
might want to keep track of you know

104
00:04:27,260 --> 00:04:29,090
what your users are experiencing if it's

105
00:04:29,090 --> 00:04:30,570
a good experience bad experience

106
00:04:30,570 --> 00:04:32,070
there's actually a thing out there

107
00:04:32,070 --> 00:04:34,650
called session cam that watches every

108
00:04:34,650 --> 00:04:37,230
single click every single motion of the

109
00:04:37,230 --> 00:04:39,660
mouse to watch where your mouse hovers

110
00:04:39,660 --> 00:04:42,150
how long you spend hovering how long you

111
00:04:42,150 --> 00:04:44,160
spend typing into fields that sort of

112
00:04:44,160 --> 00:04:47,070
thing and that's all done with the

113
00:04:47,070 --> 00:04:49,250
third-party JavaScript integration

114
00:04:49,250 --> 00:04:52,020
social media you know you might want to

115
00:04:52,020 --> 00:04:55,230
have a like on Facebook thing on your

116
00:04:55,230 --> 00:04:58,020
web page or on your e-commerce site or

117
00:04:58,020 --> 00:04:59,970
something like that that's a third party

118
00:04:59,970 --> 00:05:02,880
JavaScript integration and tracking

119
00:05:02,880 --> 00:05:04,680
everybody loves to be tracked around the

120
00:05:04,680 --> 00:05:07,020
internet right so that's some of it and

121
00:05:07,020 --> 00:05:08,490
then sometimes it's just lazy

122
00:05:08,490 --> 00:05:12,000
development you know why would I rewrite

123
00:05:12,000 --> 00:05:14,580
this thing why reinvent the wheel if

124
00:05:14,580 --> 00:05:15,930
somebody else has already done it and

125
00:05:15,930 --> 00:05:17,910
they've posted in a github and I'll just

126
00:05:17,910 --> 00:05:19,350
call it from there what could go wrong

127
00:05:19,350 --> 00:05:23,000
right well we'll talk about that but

128
00:05:23,000 --> 00:05:25,800
everybody that's ever done this you know

129
00:05:25,800 --> 00:05:28,050
for whatever reason they give their

130
00:05:28,050 --> 00:05:29,880
given themselves high fives right they

131
00:05:29,880 --> 00:05:32,160
really think this is a great idea hey we

132
00:05:32,160 --> 00:05:34,050
just saved time hey we're tracking our

133
00:05:34,050 --> 00:05:36,150
users hey we don't have to do this stuff

134
00:05:36,150 --> 00:05:37,980
ourselves anymore so high fives all

135
00:05:37,980 --> 00:05:42,330
around for everybody right so let's talk

136
00:05:42,330 --> 00:05:45,270
about mage Kart so mage Kart is a loose

137
00:05:45,270 --> 00:05:48,330
term really defining a group of threat

138
00:05:48,330 --> 00:05:50,910
actors who are using this kind of stuff

139
00:05:50,910 --> 00:05:55,860
to steal data from from websites their

140
00:05:55,860 --> 00:05:57,480
techniques and motives are a little

141
00:05:57,480 --> 00:05:58,680
different but the goals are the same

142
00:05:58,680 --> 00:06:00,860
take control of the user's browser

143
00:06:00,860 --> 00:06:03,030
scrape whatever information is being

144
00:06:03,030 --> 00:06:05,190
typed in there and send it off to a

145
00:06:05,190 --> 00:06:08,010
domain that they control and I have to

146
00:06:08,010 --> 00:06:09,840
give a hat tip to risk IQ for their work

147
00:06:09,840 --> 00:06:12,600
here without what they've done this talk

148
00:06:12,600 --> 00:06:13,980
would not be possible they really

149
00:06:13,980 --> 00:06:16,860
brought mage cart delight and you know

150
00:06:16,860 --> 00:06:19,530
this thanks all goes to them all I'm

151
00:06:19,530 --> 00:06:20,760
doing is telling you what they already

152
00:06:20,760 --> 00:06:24,560
told everybody so what are they after

153
00:06:24,560 --> 00:06:27,210
initially it was credit card data they

154
00:06:27,210 --> 00:06:29,460
started out just you know getting into

155
00:06:29,460 --> 00:06:31,530
the users browser and looking for credit

156
00:06:31,530 --> 00:06:33,450
cards as they were being typed you know

157
00:06:33,450 --> 00:06:35,250
think of it as you know like a key

158
00:06:35,250 --> 00:06:38,160
logger that's just skimming data right

159
00:06:38,160 --> 00:06:39,840
out of the checkout page where people

160
00:06:39,840 --> 00:06:40,920
are putting their credit card number and

161
00:06:40,920 --> 00:06:41,809
their

162
00:06:41,809 --> 00:06:44,599
name and all that stuff then they

163
00:06:44,599 --> 00:06:47,539
started going after PII which of course

164
00:06:47,539 --> 00:06:49,309
why wouldn't you that's very valuable

165
00:06:49,309 --> 00:06:51,800
stuff too and the same same sort of

166
00:06:51,800 --> 00:06:53,839
thing a skimmer key logger that's

167
00:06:53,839 --> 00:06:57,469
running in the in the browser then they

168
00:06:57,469 --> 00:06:59,479
started taking login credentials and

169
00:06:59,479 --> 00:07:00,559
that works right

170
00:07:00,559 --> 00:07:02,479
why wouldn't she if you have control

171
00:07:02,479 --> 00:07:04,550
over the keyboard why wouldn't you take

172
00:07:04,550 --> 00:07:07,759
a username and password it's really

173
00:07:07,759 --> 00:07:10,279
anything valuable that submitted vo form

174
00:07:10,279 --> 00:07:13,180
that's what they're after

175
00:07:13,180 --> 00:07:15,949
so how did they do it there's a few

176
00:07:15,949 --> 00:07:19,400
different ways one is to compromise a

177
00:07:19,400 --> 00:07:21,560
third party whose job JavaScript tags

178
00:07:21,560 --> 00:07:24,860
are called out to thousands and

179
00:07:24,860 --> 00:07:28,129
thousands of customers and another way

180
00:07:28,129 --> 00:07:31,099
was is to actually compromise the

181
00:07:31,099 --> 00:07:33,199
website and then tamper with the

182
00:07:33,199 --> 00:07:34,729
JavaScript that's already on that

183
00:07:34,729 --> 00:07:38,659
website ultimately they're using their

184
00:07:38,659 --> 00:07:41,149
own JavaScript to send the data to a

185
00:07:41,149 --> 00:07:45,080
domain that they control and then profit

186
00:07:45,080 --> 00:07:48,020
right got a bunch of credit cards now go

187
00:07:48,020 --> 00:07:51,889
have fun so we'll talk about some of the

188
00:07:51,889 --> 00:07:55,219
breaches Ticketmaster those guys lost

189
00:07:55,219 --> 00:07:57,849
many millions something like 30 million

190
00:07:57,849 --> 00:08:00,860
credit cards and it was due to a

191
00:08:00,860 --> 00:08:03,409
third-party integration yeah I believe

192
00:08:03,409 --> 00:08:05,779
that the the integration they provided

193
00:08:05,779 --> 00:08:08,120
like a little pop-up window that said

194
00:08:08,120 --> 00:08:10,430
hey it looks like you're having a hard

195
00:08:10,430 --> 00:08:12,050
time ordering tickets do you need some

196
00:08:12,050 --> 00:08:13,580
help you know and that's actually coming

197
00:08:13,580 --> 00:08:16,719
from a third party of course and that

198
00:08:16,719 --> 00:08:18,949
that little JavaScript that did that

199
00:08:18,949 --> 00:08:21,469
little trick had some code in there that

200
00:08:21,469 --> 00:08:23,149
said okay when we get to the checkout

201
00:08:23,149 --> 00:08:25,789
page as the person starts typing you

202
00:08:25,789 --> 00:08:27,830
start scraping that data and send it off

203
00:08:27,830 --> 00:08:30,580
to this domain that we've registered and

204
00:08:30,580 --> 00:08:33,159
nobody's paying attention to

205
00:08:33,159 --> 00:08:35,419
then there was British Airways now

206
00:08:35,419 --> 00:08:36,889
British Airways was a little different

207
00:08:36,889 --> 00:08:38,089
because they actually compromised

208
00:08:38,089 --> 00:08:41,029
British Airways site and of course they

209
00:08:41,029 --> 00:08:43,159
didn't come clean on how that happened

210
00:08:43,159 --> 00:08:44,208
but obviously there was some

211
00:08:44,208 --> 00:08:46,100
vulnerability in the website the bad

212
00:08:46,100 --> 00:08:47,930
guys exploited it and they were able to

213
00:08:47,930 --> 00:08:50,269
replace JavaScript code that was already

214
00:08:50,269 --> 00:08:51,890
on British Airways site with their own

215
00:08:51,890 --> 00:08:54,120
and they used that too

216
00:08:54,120 --> 00:08:58,050
put their skimming keylogging code into

217
00:08:58,050 --> 00:09:01,649
the browser started out you know after

218
00:09:01,649 --> 00:09:04,470
those two came out that you know maybe

219
00:09:04,470 --> 00:09:06,689
we've had about 8,000 or so ecommerce

220
00:09:06,689 --> 00:09:08,519
deployments that were affected but then

221
00:09:08,519 --> 00:09:11,610
as risk got you dug deeper ended up more

222
00:09:11,610 --> 00:09:14,939
in the twenty thousand range and you

223
00:09:14,939 --> 00:09:16,620
know it was all ended up because the a

224
00:09:16,620 --> 00:09:18,149
lot of these third parties were

225
00:09:18,149 --> 00:09:20,189
compromised and these third parties had

226
00:09:20,189 --> 00:09:22,649
thousands and thousands of customers so

227
00:09:22,649 --> 00:09:24,209
all of those ecommerce sites were

228
00:09:24,209 --> 00:09:28,620
ultimately compromised some other types

229
00:09:28,620 --> 00:09:30,839
of attacks that can happen via

230
00:09:30,839 --> 00:09:33,720
third-party JavaScript crypto mining

231
00:09:33,720 --> 00:09:35,759
which gentleman before me was just

232
00:09:35,759 --> 00:09:38,850
talking about so if I'm a bad guy and I

233
00:09:38,850 --> 00:09:40,769
can put JavaScript in your browser I can

234
00:09:40,769 --> 00:09:42,540
put a coin miner in there and your

235
00:09:42,540 --> 00:09:44,249
computer is now doing work for me and

236
00:09:44,249 --> 00:09:46,920
thank you for your CPU cycles that is

237
00:09:46,920 --> 00:09:49,920
turning into real money ad where's

238
00:09:49,920 --> 00:09:52,559
another one to be able to insert maybe

239
00:09:52,559 --> 00:09:55,769
popup ads for a competitor which would

240
00:09:55,769 --> 00:09:57,779
be not good for us I don't want you

241
00:09:57,779 --> 00:10:00,449
going to Amazon if if you're shopping at

242
00:10:00,449 --> 00:10:04,079
Dick's Sporting Goods right and click

243
00:10:04,079 --> 00:10:06,649
jacking is another common situation

244
00:10:06,649 --> 00:10:08,939
where they're just trying to you know

245
00:10:08,939 --> 00:10:10,829
take steal your clicks and send you

246
00:10:10,829 --> 00:10:14,509
somewhere else so none of this is fine

247
00:10:14,509 --> 00:10:17,490
it's more like the the rolling dumpster

248
00:10:17,490 --> 00:10:20,790
fire and you know it all came really

249
00:10:20,790 --> 00:10:23,970
quick so you know this has evolved over

250
00:10:23,970 --> 00:10:26,009
the last year maybe a year and a half

251
00:10:26,009 --> 00:10:29,720
and it's it seems to be continuing so

252
00:10:29,720 --> 00:10:32,220
let's talk about what you can do to

253
00:10:32,220 --> 00:10:36,720
secure your site and that control is

254
00:10:36,720 --> 00:10:39,209
called a Content security policy so

255
00:10:39,209 --> 00:10:42,199
content security policy usually reserved

256
00:10:42,199 --> 00:10:45,779
referred to as a CSP it's essentially

257
00:10:45,779 --> 00:10:48,089
just an HTTP header that's sent from the

258
00:10:48,089 --> 00:10:51,240
server to the browser that defines which

259
00:10:51,240 --> 00:10:53,639
domains are trusted so which domains

260
00:10:53,639 --> 00:10:55,769
you're allowed to send data to if you

261
00:10:55,769 --> 00:10:57,629
have a good content security policy and

262
00:10:57,629 --> 00:10:59,610
a bad guy manages to get some bad

263
00:10:59,610 --> 00:11:02,579
JavaScript into the users browser the

264
00:11:02,579 --> 00:11:04,910
content security policy will prevent

265
00:11:04,910 --> 00:11:07,470
information from being sent to the dome

266
00:11:07,470 --> 00:11:10,050
that they control because the domain

267
00:11:10,050 --> 00:11:13,610
that they control isn't defined here

268
00:11:13,610 --> 00:11:16,110
this is the most basic content security

269
00:11:16,110 --> 00:11:18,270
policy and it says well you can run

270
00:11:18,270 --> 00:11:20,990
JavaScript from yourself and that's it

271
00:11:20,990 --> 00:11:23,100
well that's not gonna help you with

272
00:11:23,100 --> 00:11:24,750
third-party JavaScript integrations

273
00:11:24,750 --> 00:11:26,520
because you haven't defined any domains

274
00:11:26,520 --> 00:11:28,410
with this one but I love this one

275
00:11:28,410 --> 00:11:32,250
because it's super super secure so some

276
00:11:32,250 --> 00:11:34,770
other directives so this is how you

277
00:11:34,770 --> 00:11:37,500
might define Google and then maybe a

278
00:11:37,500 --> 00:11:39,900
trusted partner and you say okay well

279
00:11:39,900 --> 00:11:41,490
you can run scripts from the server

280
00:11:41,490 --> 00:11:44,790
itself from anything in Google and from

281
00:11:44,790 --> 00:11:48,240
my trusted partner com now when you

282
00:11:48,240 --> 00:11:50,010
start getting into the wild card type

283
00:11:50,010 --> 00:11:52,590
situations that gets a little dicey

284
00:11:52,590 --> 00:11:54,840
because that could maybe mean you know

285
00:11:54,840 --> 00:11:58,140
Google storage location if that red

286
00:11:58,140 --> 00:12:01,380
github that could be problematic there

287
00:12:01,380 --> 00:12:06,360
was a story about a guy who had he an

288
00:12:06,360 --> 00:12:08,850
attacker essentially took control over a

289
00:12:08,850 --> 00:12:11,670
github repository that can contain some

290
00:12:11,670 --> 00:12:14,600
code that a lot of people were using and

291
00:12:14,600 --> 00:12:16,980
the attacker just kind of asked the

292
00:12:16,980 --> 00:12:20,070
owner of the github repository hey I see

293
00:12:20,070 --> 00:12:21,120
that you're not doing any active

294
00:12:21,120 --> 00:12:23,190
development on this code anymore would

295
00:12:23,190 --> 00:12:24,870
you mind if I became the owner and the

296
00:12:24,870 --> 00:12:26,520
guy was just like oh yeah sure here you

297
00:12:26,520 --> 00:12:26,820
go

298
00:12:26,820 --> 00:12:29,130
and then the bad guy took over the the

299
00:12:29,130 --> 00:12:31,290
repo and did malicious things with it

300
00:12:31,290 --> 00:12:34,080
and affected a ton of sites so yeah

301
00:12:34,080 --> 00:12:38,750
don't just like implicitly trust github

302
00:12:38,780 --> 00:12:41,880
some other things so the frame ancestors

303
00:12:41,880 --> 00:12:44,070
this would essentially block

304
00:12:44,070 --> 00:12:45,030
clickjacking

305
00:12:45,030 --> 00:12:48,270
and that's actually like the same as

306
00:12:48,270 --> 00:12:51,120
x-frame options where you're defining

307
00:12:51,120 --> 00:12:54,390
who's allowed to do frame popups and and

308
00:12:54,390 --> 00:12:57,589
you know don't let anybody else do it

309
00:12:57,589 --> 00:13:00,930
some additional directives you you also

310
00:13:00,930 --> 00:13:03,390
have some things around style sheets so

311
00:13:03,390 --> 00:13:05,760
you want to also define who's allowed to

312
00:13:05,760 --> 00:13:08,070
serve up style sheets to the site and

313
00:13:08,070 --> 00:13:10,920
this is how you do that and then some

314
00:13:10,920 --> 00:13:12,750
other ones include object source where

315
00:13:12,750 --> 00:13:14,370
you're talking about plugins image

316
00:13:14,370 --> 00:13:17,339
source for images media source for audio

317
00:13:17,339 --> 00:13:19,500
and video and thanks to my colleague

318
00:13:19,500 --> 00:13:20,360
Antonia and

319
00:13:20,360 --> 00:13:23,000
Araki go out there he mentioned this

320
00:13:23,000 --> 00:13:24,560
connect source where you're actually

321
00:13:24,560 --> 00:13:26,450
defining network level you can do things

322
00:13:26,450 --> 00:13:29,720
like IP addresses in there so super

323
00:13:29,720 --> 00:13:31,850
super helpful to be able to lock things

324
00:13:31,850 --> 00:13:35,089
down but the good news is we can go even

325
00:13:35,089 --> 00:13:38,690
a little bit further because well what

326
00:13:38,690 --> 00:13:41,089
if one of my scripts got modified on my

327
00:13:41,089 --> 00:13:43,850
own website because my website was

328
00:13:43,850 --> 00:13:45,010
compromised

329
00:13:45,010 --> 00:13:47,540
well there's a thing called s RI and

330
00:13:47,540 --> 00:13:49,640
that stands for sub resource integrity

331
00:13:49,640 --> 00:13:52,160
and what it is is essentially a way for

332
00:13:52,160 --> 00:13:54,079
you to validate the integrity of a

333
00:13:54,079 --> 00:13:56,269
particular script using hashing

334
00:13:56,269 --> 00:13:59,450
algorithms so the server essentially

335
00:13:59,450 --> 00:14:01,190
sends the hash value for a particular

336
00:14:01,190 --> 00:14:03,980
script the hash is calculated on the

337
00:14:03,980 --> 00:14:06,310
client side and if things don't match up

338
00:14:06,310 --> 00:14:08,899
things don't execute if they do match up

339
00:14:08,899 --> 00:14:10,760
the script executes and you're good to

340
00:14:10,760 --> 00:14:14,209
go so it's a little difficult because as

341
00:14:14,209 --> 00:14:17,089
things as scripts change new versions

342
00:14:17,089 --> 00:14:20,360
come out that sort of stuff you know

343
00:14:20,360 --> 00:14:22,430
that could be problematic because if

344
00:14:22,430 --> 00:14:23,690
you're not keeping up with those hash

345
00:14:23,690 --> 00:14:25,760
values sent from the server side then

346
00:14:25,760 --> 00:14:27,709
things are going to blow up but it

347
00:14:27,709 --> 00:14:30,260
definitely gives you a way to make sure

348
00:14:30,260 --> 00:14:31,970
that the script that you're expecting to

349
00:14:31,970 --> 00:14:33,829
run in the user's browser is the script

350
00:14:33,829 --> 00:14:38,540
that you originally intended to run this

351
00:14:38,540 --> 00:14:41,480
is what that looks like in code you know

352
00:14:41,480 --> 00:14:45,440
you could see this the integrity field

353
00:14:45,440 --> 00:14:47,480
and that is just going to be the hash

354
00:14:47,480 --> 00:14:50,750
value that the server's calculated and

355
00:14:50,750 --> 00:14:52,550
then again the client side is going to

356
00:14:52,550 --> 00:14:54,470
calculate that same hash value and match

357
00:14:54,470 --> 00:14:56,360
the two up and if they match code

358
00:14:56,360 --> 00:15:01,519
executes and we're good to go so the bad

359
00:15:01,519 --> 00:15:03,709
guys are super sad because well data

360
00:15:03,709 --> 00:15:05,000
isn't going to be back to sent back to

361
00:15:05,000 --> 00:15:07,010
the servers that they control the

362
00:15:07,010 --> 00:15:10,190
scripts won't execute due to SR I clicks

363
00:15:10,190 --> 00:15:12,079
won't be jacked cryptos won't be mined

364
00:15:12,079 --> 00:15:14,570
redirects won't be redirected things

365
00:15:14,570 --> 00:15:16,519
will behave as you expected them to

366
00:15:16,519 --> 00:15:21,560
behave so this is kind of evolution of

367
00:15:21,560 --> 00:15:24,620
CSP for an organization you know you

368
00:15:24,620 --> 00:15:27,079
start off really kind of unev olve to

369
00:15:27,079 --> 00:15:29,149
know CSP and then you know you start to

370
00:15:29,149 --> 00:15:31,530
evolve a little bit you get a CSP

371
00:15:31,530 --> 00:15:34,560
and then eventually get CS p+ s RI and

372
00:15:34,560 --> 00:15:36,900
then ultimate is to have no JavaScript

373
00:15:36,900 --> 00:15:38,880
at all because javascript can be evil

374
00:15:38,880 --> 00:15:40,380
but of course that's never gonna happen

375
00:15:40,380 --> 00:15:44,640
so we might never get there so where do

376
00:15:44,640 --> 00:15:46,650
you put it we can put it in the

377
00:15:46,650 --> 00:15:48,840
application itself but that's probably a

378
00:15:48,840 --> 00:15:51,120
little too far down the stack so it's

379
00:15:51,120 --> 00:15:52,920
probably a little better to put it at

380
00:15:52,920 --> 00:15:55,380
the web server late layer define it at

381
00:15:55,380 --> 00:15:57,150
the web server let the web server handle

382
00:15:57,150 --> 00:15:58,890
inserting the header or you could do

383
00:15:58,890 --> 00:16:01,110
that in a load balancer or reverse proxy

384
00:16:01,110 --> 00:16:03,960
so that way you're guaranteed that the

385
00:16:03,960 --> 00:16:05,700
header will always get sent no matter

386
00:16:05,700 --> 00:16:08,790
what and it's never actually gonna have

387
00:16:08,790 --> 00:16:12,390
to come from the web server itself it

388
00:16:12,390 --> 00:16:13,560
could also come from your content

389
00:16:13,560 --> 00:16:15,110
delivery network which is essentially

390
00:16:15,110 --> 00:16:18,330
you know a proxy anything that can

391
00:16:18,330 --> 00:16:21,120
insert the header just get that header

392
00:16:21,120 --> 00:16:24,660
in there so some challenges around this

393
00:16:24,660 --> 00:16:27,870
technology the big one is maintenance so

394
00:16:27,870 --> 00:16:30,270
marketing teams tend to move very fast I

395
00:16:30,270 --> 00:16:32,730
know this firsthand they want to do

396
00:16:32,730 --> 00:16:35,490
things immediately right now and if they

397
00:16:35,490 --> 00:16:38,790
start inserting tags and they don't tell

398
00:16:38,790 --> 00:16:40,440
you about it the CSP isn't going to

399
00:16:40,440 --> 00:16:42,960
allow them to execute so you have to

400
00:16:42,960 --> 00:16:44,580
have somebody that's very in touch with

401
00:16:44,580 --> 00:16:46,920
what they're doing you know working with

402
00:16:46,920 --> 00:16:48,750
them side by side and if they're

403
00:16:48,750 --> 00:16:50,970
standing up a new domain that's that but

404
00:16:50,970 --> 00:16:52,770
the user browser needs to be talking out

405
00:16:52,770 --> 00:16:55,260
to you need to know that so the CSP can

406
00:16:55,260 --> 00:16:58,800
I be adjusted there's also the issue of

407
00:16:58,800 --> 00:17:02,130
tag piggybacking where a particular tag

408
00:17:02,130 --> 00:17:04,920
comes from an expected domain but then

409
00:17:04,920 --> 00:17:06,900
there's a bunch of tags that that thing

410
00:17:06,900 --> 00:17:08,939
calls out to that you can't see

411
00:17:08,939 --> 00:17:11,790
necessarily in the initial call so you

412
00:17:11,790 --> 00:17:13,859
know you really need almost a map from

413
00:17:13,859 --> 00:17:16,709
your tag vendors to say okay we're gonna

414
00:17:16,709 --> 00:17:18,750
you're if you call this domain or if

415
00:17:18,750 --> 00:17:20,970
you're using this particular tag yes

416
00:17:20,970 --> 00:17:23,040
it's gonna go to the first domain and

417
00:17:23,040 --> 00:17:23,970
then it's going to go to subsequent

418
00:17:23,970 --> 00:17:25,439
domains to make sure that those are all

419
00:17:25,439 --> 00:17:30,270
defined in the CSP browser support is a

420
00:17:30,270 --> 00:17:35,060
challenge and boo ie 11 bad Microsoft

421
00:17:35,060 --> 00:17:38,070
doesn't do great with CSP and I'll show

422
00:17:38,070 --> 00:17:40,320
you what that looks like just tread

423
00:17:40,320 --> 00:17:43,080
carefully you can break things if you

424
00:17:43,080 --> 00:17:44,820
don't do this right if you don't test it

425
00:17:44,820 --> 00:17:46,680
ahead of time you can cause some serious

426
00:17:46,680 --> 00:17:50,010
serious problems and potentially impact

427
00:17:50,010 --> 00:17:55,610
sales impact usability impact your job

428
00:17:55,610 --> 00:17:59,310
so this is a matrix that shows the the

429
00:17:59,310 --> 00:18:03,840
support for CSP the one at the top is is

430
00:18:03,840 --> 00:18:06,060
the latest version and you can see that

431
00:18:06,060 --> 00:18:09,150
Chrome and Firefox and Safari and edge

432
00:18:09,150 --> 00:18:13,410
are good to go but ie11 no dice does not

433
00:18:13,410 --> 00:18:18,360
support CSP same goes for CSP 1.0 so

434
00:18:18,360 --> 00:18:21,409
what IE

435
00:18:22,430 --> 00:18:25,860
supports is the actual header X content

436
00:18:25,860 --> 00:18:28,740
security policy now you would say okay

437
00:18:28,740 --> 00:18:30,450
well I'll just send both I'll send the

438
00:18:30,450 --> 00:18:32,430
content security policy header and I'll

439
00:18:32,430 --> 00:18:34,920
said the X content security header well

440
00:18:34,920 --> 00:18:37,020
that's a problem because some browsers

441
00:18:37,020 --> 00:18:39,030
if they see both they're not sure which

442
00:18:39,030 --> 00:18:40,620
one to go with and they just give up and

443
00:18:40,620 --> 00:18:44,670
both break so it's almost like you have

444
00:18:44,670 --> 00:18:46,140
to write a detection routine that says

445
00:18:46,140 --> 00:18:48,750
if I'm dealing with this browser then I

446
00:18:48,750 --> 00:18:51,150
send this header if I'm dealing with IE

447
00:18:51,150 --> 00:18:53,610
11 then I send this other header not

448
00:18:53,610 --> 00:18:58,440
ideal but as browsers die and that sort

449
00:18:58,440 --> 00:18:59,700
of thing hopefully this problem goes

450
00:18:59,700 --> 00:19:01,730
away

451
00:19:02,000 --> 00:19:05,730
so some tools for you the Google CSP

452
00:19:05,730 --> 00:19:10,710
evaluator is awesome it will tell you it

453
00:19:10,710 --> 00:19:12,660
will interpret a CSP from a particular

454
00:19:12,660 --> 00:19:15,480
website and give you all sorts of you

455
00:19:15,480 --> 00:19:18,450
know red marks or green marks or it will

456
00:19:18,450 --> 00:19:21,330
essentially interpret the CSP just as if

457
00:19:21,330 --> 00:19:23,580
Chrome would and that's very helpful

458
00:19:23,580 --> 00:19:25,230
from a testing standpoint you don't have

459
00:19:25,230 --> 00:19:28,110
to do that yourself CSP evaluator will

460
00:19:28,110 --> 00:19:31,560
do that for you it's free CSP is awesome

461
00:19:31,560 --> 00:19:35,400
is another great site they actually help

462
00:19:35,400 --> 00:19:38,700
you build a CSP you simply put in the

463
00:19:38,700 --> 00:19:41,220
domains and the type of data that is

464
00:19:41,220 --> 00:19:43,530
being sent from those domains and it'll

465
00:19:43,530 --> 00:19:46,760
build a real nice pretty CSP for you and

466
00:19:46,760 --> 00:19:51,390
free as in beer report you URI is a

467
00:19:51,390 --> 00:19:53,040
similar kind of thing it has some

468
00:19:53,040 --> 00:19:55,169
testing and some

469
00:19:55,169 --> 00:19:59,549
csb building capabilities and I would

470
00:19:59,549 --> 00:20:02,249
say that the master of all this stuff is

471
00:20:02,249 --> 00:20:04,169
a guy named Scott helm he's out of the

472
00:20:04,169 --> 00:20:07,080
UK he's got some really awesome blog

473
00:20:07,080 --> 00:20:09,539
posts about this particular issue and

474
00:20:09,539 --> 00:20:11,429
some challenges that you'll run into

475
00:20:11,429 --> 00:20:13,590
with s RI and and those kind of things

476
00:20:13,590 --> 00:20:15,720
so definitely check him out and all

477
00:20:15,720 --> 00:20:18,629
these resources can be accessed at this

478
00:20:18,629 --> 00:20:22,860
tiny GC so you know don't worry about

479
00:20:22,860 --> 00:20:24,029
having to Google too much you can just

480
00:20:24,029 --> 00:20:25,499
go there and I have links out to all

481
00:20:25,499 --> 00:20:27,590
this stuff

482
00:20:27,590 --> 00:20:31,019
so that was about 20 minutes does

483
00:20:31,019 --> 00:20:36,230
anybody have questions sir

484
00:20:55,250 --> 00:20:57,940
yeah

485
00:21:00,490 --> 00:21:02,950
yeah so the questions around unsafe

486
00:21:02,950 --> 00:21:05,350
inline which is a challenge it's where

487
00:21:05,350 --> 00:21:09,280
you have to define in the CSP year

488
00:21:09,280 --> 00:21:12,100
basically saying yes I'm going to have

489
00:21:12,100 --> 00:21:15,310
JavaScript inline in this page and your

490
00:21:15,310 --> 00:21:17,650
you must permit that so the the

491
00:21:17,650 --> 00:21:20,680
challenge is you know you're gonna ask

492
00:21:20,680 --> 00:21:22,270
you you have to ask your developers to

493
00:21:22,270 --> 00:21:24,430
not do that and to put the stuff outside

494
00:21:24,430 --> 00:21:28,810
you know the page and yeah it's a

495
00:21:28,810 --> 00:21:30,430
challenge for sure and and there are

496
00:21:30,430 --> 00:21:33,340
some commercial applications that that's

497
00:21:33,340 --> 00:21:34,810
just not possible because you're gonna

498
00:21:34,810 --> 00:21:37,780
have to go to like an IBM or some big

499
00:21:37,780 --> 00:21:41,050
company and ask you to do that it is a

500
00:21:41,050 --> 00:21:44,380
risk because same sort of situation if

501
00:21:44,380 --> 00:21:48,040
you have the an attacker who's able to

502
00:21:48,040 --> 00:21:50,800
compromise the site and then modify

503
00:21:50,800 --> 00:21:55,510
those web pages specifically then that

504
00:21:55,510 --> 00:21:57,750
codes gonna run and that's regardless of

505
00:21:57,750 --> 00:22:00,730
what's in the CSP if you have unsafe

506
00:22:00,730 --> 00:22:03,490
inline but with it hat you need a code

507
00:22:03,490 --> 00:22:04,990
rewrite that's the only way that you can

508
00:22:04,990 --> 00:22:07,510
you can really do anything about that

509
00:22:07,510 --> 00:22:15,720
unfortunately anybody else Ryan

510
00:22:21,030 --> 00:22:23,440
all right so you mentioned some

511
00:22:23,440 --> 00:22:26,770
challenges with implementing CSP it was

512
00:22:26,770 --> 00:22:28,570
just had it was curious if you were

513
00:22:28,570 --> 00:22:31,830
aware or knew of any plugins for like

514
00:22:31,830 --> 00:22:34,330
common content management systems like

515
00:22:34,330 --> 00:22:40,510
Joomla or it's the other one like Joomla

516
00:22:40,510 --> 00:22:43,930
like like those there any like plugins

517
00:22:43,930 --> 00:22:46,180
that help you with that I haven't seen

518
00:22:46,180 --> 00:22:47,860
anything like that specifically I know

519
00:22:47,860 --> 00:22:50,140
that there are some commercial vendors

520
00:22:50,140 --> 00:22:51,850
right now that are jumping on this

521
00:22:51,850 --> 00:22:55,240
because they smell money and I mean it's

522
00:22:55,240 --> 00:22:57,580
valid like you know it's difficult to

523
00:22:57,580 --> 00:23:02,440
have somebody it's difficult to have you

524
00:23:02,440 --> 00:23:04,150
know basically a full time seat resource

525
00:23:04,150 --> 00:23:07,540
laying around to modify CSP anytime

526
00:23:07,540 --> 00:23:10,900
marketing comes in so I do know of a

527
00:23:10,900 --> 00:23:13,990
couple vendors I'm not gonna name them

528
00:23:13,990 --> 00:23:15,550
because I you know don't really know if

529
00:23:15,550 --> 00:23:17,350
their solutions are great or not but

530
00:23:17,350 --> 00:23:19,270
when you talk about it offline if you do

531
00:23:19,270 --> 00:23:20,770
some googling and look for tag

532
00:23:20,770 --> 00:23:23,710
governance you'll get pushed a bunch of

533
00:23:23,710 --> 00:23:29,080
ads via JavaScript and and they you know

534
00:23:29,080 --> 00:23:31,030
they are attempting to do things like

535
00:23:31,030 --> 00:23:35,890
automate the actual detection of which

536
00:23:35,890 --> 00:23:38,429
tags are being called and then to

537
00:23:38,429 --> 00:23:41,020
essentially create the CSP on the fly

538
00:23:41,020 --> 00:23:45,370
for you so it's they're working on it

539
00:23:45,370 --> 00:23:47,860
but this is all you know that it's funny

540
00:23:47,860 --> 00:23:48,970
because this is this stuff has been

541
00:23:48,970 --> 00:23:50,890
around forever you know and people have

542
00:23:50,890 --> 00:23:52,450
been doing it forever but suddenly you

543
00:23:52,450 --> 00:23:53,650
get a bunch of bad guys that start

544
00:23:53,650 --> 00:23:55,960
exploiting it and it's like oh I guess

545
00:23:55,960 --> 00:23:57,940
we need a solution so we're a little bit

546
00:23:57,940 --> 00:24:00,190
behind the 8-ball there but there are

547
00:24:00,190 --> 00:24:04,710
some solutions out there great thank you

548
00:24:04,769 --> 00:24:07,949
anybody else

549
00:24:09,870 --> 00:24:13,770
okay well thank you very much if you

550
00:24:13,770 --> 00:24:15,450
want to reach out talk about some stuff

551
00:24:15,450 --> 00:24:18,090
a little more you know shoot the breeze

552
00:24:18,090 --> 00:24:19,470
you want to complain about JavaScript

553
00:24:19,470 --> 00:24:22,410
I'm all ears and thank you very much for

554
00:24:22,410 --> 00:24:24,200
coming I appreciate it

555
00:24:24,200 --> 00:24:31,359
[Applause]

