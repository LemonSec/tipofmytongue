1
00:00:04,050 --> 00:00:07,109
so get started with our next speaker so

2
00:00:07,109 --> 00:00:08,130
we have Justin in Forbes he'll be

3
00:00:08,130 --> 00:00:09,540
presenting on how to frustrate a

4
00:00:09,540 --> 00:00:11,820
penetration tester a little bit about

5
00:00:11,820 --> 00:00:13,799
Justin so Justin Forbes the team lead of

6
00:00:13,799 --> 00:00:15,840
the applied Network defense team at CMU

7
00:00:15,840 --> 00:00:18,449
/ SC isert he has been leading

8
00:00:18,449 --> 00:00:19,949
penetration testing team to the past

9
00:00:19,949 --> 00:00:22,170
five years targeting federal state local

10
00:00:22,170 --> 00:00:23,880
and critical infrastructure

11
00:00:23,880 --> 00:00:26,789
organizations Justin earned his master's

12
00:00:26,789 --> 00:00:27,960
in telecommunications from the

13
00:00:27,960 --> 00:00:30,119
University of Pittsburgh in 2010 and his

14
00:00:30,119 --> 00:00:31,890
bachelor's and Information Sciences in

15
00:00:31,890 --> 00:00:34,710
2008 his typical Primanti Brothers order

16
00:00:34,710 --> 00:00:36,960
is the ragin Cajun chicken sandwich and

17
00:00:36,960 --> 00:00:38,160
it's all I see light I'd say that's

18
00:00:38,160 --> 00:00:42,120
pretty solid combo if you ask me I'm

19
00:00:42,120 --> 00:00:44,250
with you let it go all right he

20
00:00:44,250 --> 00:00:45,149
said without further ado let's welcome

21
00:00:45,149 --> 00:00:53,370
mr. Justin thank you very much it's good

22
00:00:53,370 --> 00:00:55,739
to be here so this talk is gonna be

23
00:00:55,739 --> 00:00:58,079
about how to frustrate a penetration

24
00:00:58,079 --> 00:01:00,090
tester by doing the right thing

25
00:01:00,090 --> 00:01:01,070
security-wise

26
00:01:01,070 --> 00:01:03,809
pretty often when we're doing tests we

27
00:01:03,809 --> 00:01:06,420
end up just doing the same things over

28
00:01:06,420 --> 00:01:08,520
and over and for the past probably three

29
00:01:08,520 --> 00:01:11,369
years the same techniques have worked I

30
00:01:11,369 --> 00:01:13,079
would say 90% of the time and the

31
00:01:13,079 --> 00:01:15,329
organizations that we go to so I just

32
00:01:15,329 --> 00:01:16,679
want to run through a lot of those

33
00:01:16,679 --> 00:01:18,840
common techniques and ways that you can

34
00:01:18,840 --> 00:01:22,709
counter those first disclaimer all the

35
00:01:22,709 --> 00:01:23,789
statements that you're about to see our

36
00:01:23,789 --> 00:01:25,619
mind and mine alone they do not

37
00:01:25,619 --> 00:01:27,569
represent my employer they do not

38
00:01:27,569 --> 00:01:32,039
represent anyone around me don't

39
00:01:32,039 --> 00:01:33,329
implement anything I'm recommending

40
00:01:33,329 --> 00:01:35,759
without actually figuring out if it's

41
00:01:35,759 --> 00:01:38,029
going to affect the business first

42
00:01:38,029 --> 00:01:40,409
patchen's great but certain systems you

43
00:01:40,409 --> 00:01:42,389
should not just automatically patch so

44
00:01:42,389 --> 00:01:44,399
you want to make those decisions after

45
00:01:44,399 --> 00:01:47,609
consulting with the system owner I might

46
00:01:47,609 --> 00:01:49,799
swear I don't really know I'm gonna be

47
00:01:49,799 --> 00:01:51,599
telling some stories and there may be

48
00:01:51,599 --> 00:01:53,669
some swearing involved there's lots of

49
00:01:53,669 --> 00:01:55,709
memes so if you can't handle those you

50
00:01:55,709 --> 00:01:58,560
probably want to leave now and last

51
00:01:58,560 --> 00:02:01,049
disclaimer I'm very tired I actually

52
00:02:01,049 --> 00:02:02,999
just got in at 4 a.m. this morning

53
00:02:02,999 --> 00:02:05,009
because my flight from Chicago was super

54
00:02:05,009 --> 00:02:09,889
delayed so I have not had much sleep so

55
00:02:09,889 --> 00:02:13,110
continuation of my introduction so I am

56
00:02:13,110 --> 00:02:14,730
the team lead for the applied Network

57
00:02:14,730 --> 00:02:16,099
defense team at

58
00:02:16,099 --> 00:02:19,819
sei CMU cert we have a bit of a branding

59
00:02:19,819 --> 00:02:21,349
problem we don't really know who we are

60
00:02:21,349 --> 00:02:24,200
we're a little bit of everything I'm

61
00:02:24,200 --> 00:02:26,389
also now teaching the ethical

62
00:02:26,389 --> 00:02:29,510
penetration test testing class at CMU so

63
00:02:29,510 --> 00:02:32,810
if anyone is enrolling in the master's

64
00:02:32,810 --> 00:02:34,310
program there and wants to take that I

65
00:02:34,310 --> 00:02:38,319
will probably be a good teacher I hope

66
00:02:38,319 --> 00:02:39,620
so

67
00:02:39,620 --> 00:02:41,420
over the past five years I've been

68
00:02:41,420 --> 00:02:43,609
leading teams doing penetration testing

69
00:02:43,609 --> 00:02:47,930
I've done 50-plus assessments now all

70
00:02:47,930 --> 00:02:49,909
over the United States earlier this year

71
00:02:49,909 --> 00:02:53,150
I was in Hawaii I haven't been to Alaska

72
00:02:53,150 --> 00:02:54,680
yet but I really want to go so I'm

73
00:02:54,680 --> 00:02:55,939
hoping we get an assessment up there

74
00:02:55,939 --> 00:02:59,000
sometime soon it's been eight years of

75
00:02:59,000 --> 00:03:01,579
beard growth everyone always the most

76
00:03:01,579 --> 00:03:03,859
common question I get every restaurant I

77
00:03:03,859 --> 00:03:07,400
go to anywhere is I gotta ask how long

78
00:03:07,400 --> 00:03:08,209
has it been

79
00:03:08,209 --> 00:03:11,629
always worded that exact same way it

80
00:03:11,629 --> 00:03:14,120
happens everywhere and then the last

81
00:03:14,120 --> 00:03:15,859
point I'm still learning and failing

82
00:03:15,859 --> 00:03:18,739
every day without failures you don't

83
00:03:18,739 --> 00:03:20,509
really learn anything so it's important

84
00:03:20,509 --> 00:03:24,620
to embrace them so what is a penetration

85
00:03:24,620 --> 00:03:28,489
test there's a lot of people that have

86
00:03:28,489 --> 00:03:30,379
different opinions on what a penetration

87
00:03:30,379 --> 00:03:32,389
test is there are some organizations out

88
00:03:32,389 --> 00:03:35,599
there who create vulnerability scanners

89
00:03:35,599 --> 00:03:37,430
who consider themselves penetration

90
00:03:37,430 --> 00:03:39,470
testers because they go in and they run

91
00:03:39,470 --> 00:03:41,900
a vulnerability scanner and they have a

92
00:03:41,900 --> 00:03:44,239
rapport with five million items that you

93
00:03:44,239 --> 00:03:46,099
need to fix because those are issues in

94
00:03:46,099 --> 00:03:49,759
your organization I look at penetration

95
00:03:49,759 --> 00:03:52,669
testing as actually measuring the amount

96
00:03:52,669 --> 00:03:53,720
of risk that those vulnerabilities

97
00:03:53,720 --> 00:03:55,729
represent and also looking at how

98
00:03:55,729 --> 00:03:58,400
exploitable they are I've seen some

99
00:03:58,400 --> 00:04:00,049
penetration testing reports that are

100
00:04:00,049 --> 00:04:02,120
reporting on issues that are on a

101
00:04:02,120 --> 00:04:04,069
one-off machine that can't possibly

102
00:04:04,069 --> 00:04:06,500
compromise any data in the organization

103
00:04:06,500 --> 00:04:08,659
and it's just like why even write this

104
00:04:08,659 --> 00:04:11,090
down if it's not there's always going to

105
00:04:11,090 --> 00:04:13,759
be more pressing matters to deal with

106
00:04:13,759 --> 00:04:16,940
than a system that's just sitting in the

107
00:04:16,940 --> 00:04:19,130
corner and it's only job is to control a

108
00:04:19,130 --> 00:04:21,168
display board that's not something

109
00:04:21,168 --> 00:04:23,620
that's really worthwhile going after

110
00:04:23,620 --> 00:04:26,539
then there's also threat emulation which

111
00:04:26,539 --> 00:04:29,360
is sort of a step before what

112
00:04:29,360 --> 00:04:30,860
considered red teaming in my opinion

113
00:04:30,860 --> 00:04:33,229
that's where you're trying to emulate

114
00:04:33,229 --> 00:04:38,030
either nation-state attackers or any

115
00:04:38,030 --> 00:04:39,469
sort of malicious entities out there

116
00:04:39,469 --> 00:04:44,689
ransomware the crypto miners anyone that

117
00:04:44,689 --> 00:04:46,520
would be trying to compromise a system

118
00:04:46,520 --> 00:04:49,699
and do anything negative to it the big

119
00:04:49,699 --> 00:04:51,199
difference between threat emulation

120
00:04:51,199 --> 00:04:53,300
penetration testing and red teaming in

121
00:04:53,300 --> 00:04:56,449
my opinion is red teaming is really

122
00:04:56,449 --> 00:04:59,270
focused on the training component it's

123
00:04:59,270 --> 00:05:02,240
all about having a competent blue team

124
00:05:02,240 --> 00:05:05,539
that you're testing as a red teamer to

125
00:05:05,539 --> 00:05:07,520
make sure that they're able to detect

126
00:05:07,520 --> 00:05:10,279
and react to the actions you're taking

127
00:05:10,279 --> 00:05:13,430
without the training element then it's

128
00:05:13,430 --> 00:05:16,129
just threat emulation and not really a

129
00:05:16,129 --> 00:05:21,529
red teaming exercise so frustration is

130
00:05:21,529 --> 00:05:24,080
very good it's something that should be

131
00:05:24,080 --> 00:05:26,060
embraced it can be good and it can be

132
00:05:26,060 --> 00:05:29,210
bad a lot of times lately

133
00:05:29,210 --> 00:05:31,729
this presentation was spawned out of bad

134
00:05:31,729 --> 00:05:33,710
frustration and that bad frustration is

135
00:05:33,710 --> 00:05:36,589
every organization I go to does the same

136
00:05:36,589 --> 00:05:39,800
bad things and so it's rinse and repeat

137
00:05:39,800 --> 00:05:42,169
do the same penetration test over and

138
00:05:42,169 --> 00:05:45,620
over and report the same findings and no

139
00:05:45,620 --> 00:05:48,349
one seems to really be moving forward so

140
00:05:48,349 --> 00:05:50,750
I want to create good frustration I want

141
00:05:50,750 --> 00:05:53,569
organizations to address these issues so

142
00:05:53,569 --> 00:05:55,460
that I'm forced out of my comfort zone

143
00:05:55,460 --> 00:05:57,560
and have to actually push a little more

144
00:05:57,560 --> 00:05:59,449
come up with new techniques and tactics

145
00:05:59,449 --> 00:06:03,319
and do more than just run the same tools

146
00:06:03,319 --> 00:06:08,839
over and over again so the current state

147
00:06:08,839 --> 00:06:11,599
of penetration testing is basically get

148
00:06:11,599 --> 00:06:14,330
on a network and by lunchtime day one

149
00:06:14,330 --> 00:06:16,789
you have domain admin and then you're

150
00:06:16,789 --> 00:06:19,639
asking the organization well what is it

151
00:06:19,639 --> 00:06:21,319
you guys do so that we can actually show

152
00:06:21,319 --> 00:06:23,930
impact in this report and you get

153
00:06:23,930 --> 00:06:26,659
answers anywhere from nothing important

154
00:06:26,659 --> 00:06:30,949
to we control financial records for like

155
00:06:30,949 --> 00:06:35,089
20% of the world and the ones that say

156
00:06:35,089 --> 00:06:37,099
nothing important are always hilarious

157
00:06:37,099 --> 00:06:39,349
because it's they're running critical

158
00:06:39,349 --> 00:06:42,169
systems for local governments state

159
00:06:42,169 --> 00:06:43,429
governments

160
00:06:43,429 --> 00:06:45,889
one guy was lit we're like what's a

161
00:06:45,889 --> 00:06:47,689
critical system that you have here that

162
00:06:47,689 --> 00:06:49,459
people rely on he's like I really don't

163
00:06:49,459 --> 00:06:50,569
think anyone would notice if we went

164
00:06:50,569 --> 00:06:51,889
away I'm like you're the local

165
00:06:51,889 --> 00:06:53,479
government I think someone would notice

166
00:06:53,479 --> 00:06:57,499
like something would go wrong but he was

167
00:06:57,499 --> 00:06:59,300
also the head of security who did not

168
00:06:59,300 --> 00:07:01,279
have an internet connection at home so

169
00:07:01,279 --> 00:07:04,459
he was a little distant from the field

170
00:07:04,459 --> 00:07:09,349
so how do we get domain admins so easily

171
00:07:09,349 --> 00:07:10,159
all the time

172
00:07:10,159 --> 00:07:12,679
so there's a couple different techniques

173
00:07:12,679 --> 00:07:16,099
that we use that are fairly reliable and

174
00:07:16,099 --> 00:07:17,199
we're gonna go through each of them

175
00:07:17,199 --> 00:07:20,569
phishing lack of basic cyber hygiene is

176
00:07:20,569 --> 00:07:23,569
something that still shocks me to this

177
00:07:23,569 --> 00:07:25,240
day

178
00:07:25,240 --> 00:07:27,889
password hashes if you're dealing with a

179
00:07:27,889 --> 00:07:29,869
Active Directory environment password

180
00:07:29,869 --> 00:07:31,999
hashes are flying all over the place and

181
00:07:31,999 --> 00:07:33,349
a lot of people don't realize it and

182
00:07:33,349 --> 00:07:36,669
then there's a lot of Active Directory

183
00:07:36,669 --> 00:07:40,279
misconfigurations that we often take

184
00:07:40,279 --> 00:07:42,559
advantage of and it seems like every

185
00:07:42,559 --> 00:07:45,709
time we brief defenders about the issues

186
00:07:45,709 --> 00:07:47,360
they don't they're not even aware of the

187
00:07:47,360 --> 00:07:49,639
tooling we're using or that these issues

188
00:07:49,639 --> 00:07:55,159
are out there so phishing is one of

189
00:07:55,159 --> 00:07:58,159
those things that it always works I've

190
00:07:58,159 --> 00:08:01,039
not had a correction I've had one

191
00:08:01,039 --> 00:08:03,649
assessment out of that 50-plus where

192
00:08:03,649 --> 00:08:05,599
fishing didn't work and that was because

193
00:08:05,599 --> 00:08:07,759
it was a ten person organization and as

194
00:08:07,759 --> 00:08:09,439
soon as the first phishing email came in

195
00:08:09,439 --> 00:08:11,479
they stood up and everyone else was in

196
00:08:11,479 --> 00:08:12,649
the room and they said don't click on

197
00:08:12,649 --> 00:08:15,619
that that's really the only time fishing

198
00:08:15,619 --> 00:08:17,479
doesn't work if you're talking about a

199
00:08:17,479 --> 00:08:19,789
really large organization phishing is

200
00:08:19,789 --> 00:08:21,829
always gonna work there's just too many

201
00:08:21,829 --> 00:08:26,059
people and there's also what I like to

202
00:08:26,059 --> 00:08:27,349
call the super clicker

203
00:08:27,349 --> 00:08:30,259
and in every organization once you get

204
00:08:30,259 --> 00:08:32,870
over about 25 people there is one person

205
00:08:32,870 --> 00:08:34,669
who will click on anything that comes

206
00:08:34,669 --> 00:08:37,549
into their inbox doesn't matter what it

207
00:08:37,549 --> 00:08:40,818
is and really we can't blame them for

208
00:08:40,818 --> 00:08:42,469
that because a lot of people their job

209
00:08:42,469 --> 00:08:44,930
is to read email and react to it

210
00:08:44,930 --> 00:08:46,550
so they've been trained their whole time

211
00:08:46,550 --> 00:08:48,620
working they're like you have to read

212
00:08:48,620 --> 00:08:50,089
those emails you have to click on it

213
00:08:50,089 --> 00:08:51,769
find out what it's about and then do

214
00:08:51,769 --> 00:08:54,649
whatever it says and if a bad guy sends

215
00:08:54,649 --> 00:08:55,880
one and they do it they're just doing

216
00:08:55,880 --> 00:08:57,050
their job it's not

217
00:08:57,050 --> 00:08:59,490
it's not their fault that they got

218
00:08:59,490 --> 00:09:03,720
tricked so two of the main goals when we

219
00:09:03,720 --> 00:09:06,660
do phishing campaigns is we're either

220
00:09:06,660 --> 00:09:08,640
phishing to get credentials so that we

221
00:09:08,640 --> 00:09:10,920
can get into the environment or we're

222
00:09:10,920 --> 00:09:12,480
fishing to gain access to the

223
00:09:12,480 --> 00:09:15,450
environment a lot of times we focus more

224
00:09:15,450 --> 00:09:18,120
on gaining access but as more and more

225
00:09:18,120 --> 00:09:20,340
organizations are moving to the cloud

226
00:09:20,340 --> 00:09:24,840
using office 365 things like that just

227
00:09:24,840 --> 00:09:26,940
getting their credentials to be able to

228
00:09:26,940 --> 00:09:29,310
gain access to their inboxes their

229
00:09:29,310 --> 00:09:32,220
onedrive any of that stuff is actually

230
00:09:32,220 --> 00:09:34,020
more important than compromising the

231
00:09:34,020 --> 00:09:35,580
system that they're running it on

232
00:09:35,580 --> 00:09:37,680
because they may not even have a domain

233
00:09:37,680 --> 00:09:42,090
that they're tied into when fishing for

234
00:09:42,090 --> 00:09:45,270
access the testing of payloads it's

235
00:09:45,270 --> 00:09:48,330
really about figuring out what kind of

236
00:09:48,330 --> 00:09:50,400
environment you're getting into we've

237
00:09:50,400 --> 00:09:52,830
had organizations that are running still

238
00:09:52,830 --> 00:09:55,050
running Windows 7 throughout the entire

239
00:09:55,050 --> 00:09:58,130
organization and it is a much different

240
00:09:58,130 --> 00:10:00,240
phishing attack against a Windows 7

241
00:10:00,240 --> 00:10:02,700
system then Windows 10 with up-to-date

242
00:10:02,700 --> 00:10:06,000
Defender is actually really hard to get

243
00:10:06,000 --> 00:10:08,160
payloads working on I've tested a

244
00:10:08,160 --> 00:10:10,970
payload with a customer work just fine

245
00:10:10,970 --> 00:10:13,710
six hours later their definitions

246
00:10:13,710 --> 00:10:16,760
updated and that did not work anymore so

247
00:10:16,760 --> 00:10:19,080
moving to the newest stuff is definitely

248
00:10:19,080 --> 00:10:24,180
helpful so here's an example of a office

249
00:10:24,180 --> 00:10:28,320
365 credential stealing website so one

250
00:10:28,320 --> 00:10:30,660
of the big things to notice is you see

251
00:10:30,660 --> 00:10:33,420
the lock in the corner back in the day

252
00:10:33,420 --> 00:10:35,610
everyone all the training was look for

253
00:10:35,610 --> 00:10:37,110
the lock look for the lock if you see

254
00:10:37,110 --> 00:10:38,490
the lock then you know you're on a safe

255
00:10:38,490 --> 00:10:40,740
website well when let's encrypt came out

256
00:10:40,740 --> 00:10:42,570
that advice sort of went out the window

257
00:10:42,570 --> 00:10:46,880
and is no longer applicable every single

258
00:10:46,880 --> 00:10:49,140
infrastructure we set up when we conduct

259
00:10:49,140 --> 00:10:52,200
assessments is always fully SSL TLS

260
00:10:52,200 --> 00:10:53,760
encrypted with a let's encrypt

261
00:10:53,760 --> 00:10:56,730
certificate so everyone can get that

262
00:10:56,730 --> 00:10:58,850
every bad guy can get that and

263
00:10:58,850 --> 00:11:00,830
definitely even back in the day

264
00:11:00,830 --> 00:11:03,210
nation-states are well-funded actors

265
00:11:03,210 --> 00:11:04,890
could easily get those as well because

266
00:11:04,890 --> 00:11:08,100
it was just an additional cost but now

267
00:11:08,100 --> 00:11:10,220
there's not even any additional cost to

268
00:11:10,220 --> 00:11:15,110
it's free so how do you protect how do

269
00:11:15,110 --> 00:11:17,510
you protect those credentials one of the

270
00:11:17,510 --> 00:11:19,520
things that was in the previous talk

271
00:11:19,520 --> 00:11:23,210
that I agree with is password managers

272
00:11:23,210 --> 00:11:24,800
password managers are really good

273
00:11:24,800 --> 00:11:26,930
because they can identify the domain and

274
00:11:26,930 --> 00:11:28,970
they won't even give you the option to

275
00:11:28,970 --> 00:11:30,620
autofill because it's like that's not

276
00:11:30,620 --> 00:11:33,560
office 365 we're not gonna show your

277
00:11:33,560 --> 00:11:36,380
creds you are gonna still run into

278
00:11:36,380 --> 00:11:39,050
situations where if someone doesn't

279
00:11:39,050 --> 00:11:40,910
understand how that password manager

280
00:11:40,910 --> 00:11:42,260
works and they're just forced to use it

281
00:11:42,260 --> 00:11:44,420
they may copy and paste the credentials

282
00:11:44,420 --> 00:11:45,770
out of the password manager right into

283
00:11:45,770 --> 00:11:48,170
there that's always going to be an issue

284
00:11:48,170 --> 00:11:50,030
that one you really just got to stick

285
00:11:50,030 --> 00:11:52,040
with user education to get around that

286
00:11:52,040 --> 00:11:55,600
and then even with a password manager

287
00:11:55,600 --> 00:11:57,170
password manager should have

288
00:11:57,170 --> 00:12:00,080
multi-factor authentication and any

289
00:12:00,080 --> 00:12:03,290
internet facing login page for an

290
00:12:03,290 --> 00:12:04,850
organization should have multi-factor

291
00:12:04,850 --> 00:12:07,250
authentication if possible if it can't I

292
00:12:07,250 --> 00:12:10,190
highly recommend putting it behind a VPN

293
00:12:10,190 --> 00:12:14,060
that has multi-factor authentication we

294
00:12:14,060 --> 00:12:15,860
definitely see a lot of times on

295
00:12:15,860 --> 00:12:18,980
assessments customers that are still

296
00:12:18,980 --> 00:12:22,310
running with outlook web access just

297
00:12:22,310 --> 00:12:24,860
facing the Internet anyone can log in

298
00:12:24,860 --> 00:12:26,630
they have no multi-factor authentication

299
00:12:26,630 --> 00:12:29,090
on it so if we fish for credentials we

300
00:12:29,090 --> 00:12:30,830
can immediately just get right into

301
00:12:30,830 --> 00:12:33,380
their Outlook Web Access and start

302
00:12:33,380 --> 00:12:35,420
moving around looking at emails jumping

303
00:12:35,420 --> 00:12:40,700
into different users inboxes so this is

304
00:12:40,700 --> 00:12:44,390
an example of a phishing email that we

305
00:12:44,390 --> 00:12:48,170
use all the time and has great success I

306
00:12:48,170 --> 00:12:51,560
would say we get anywhere from 7 to 20

307
00:12:51,560 --> 00:12:53,780
percent click rate sending this phishing

308
00:12:53,780 --> 00:12:57,700
email with a link to a malicious payload

309
00:12:57,700 --> 00:13:01,250
we have run into some problems one time

310
00:13:01,250 --> 00:13:05,210
we fish an organization that was a union

311
00:13:05,210 --> 00:13:07,490
organization and because we were telling

312
00:13:07,490 --> 00:13:09,140
them to do something without getting

313
00:13:09,140 --> 00:13:12,260
authorization there were union

314
00:13:12,260 --> 00:13:14,810
grievances filed against management that

315
00:13:14,810 --> 00:13:17,000
it brought us in so that's one thing to

316
00:13:17,000 --> 00:13:18,110
watch out for when phishing

317
00:13:18,110 --> 00:13:20,390
organizations make sure you're not

318
00:13:20,390 --> 00:13:22,130
violating any Union rules when you send

319
00:13:22,130 --> 00:13:24,249
a phishing email

320
00:13:24,249 --> 00:13:27,410
so when you're when you're attaching

321
00:13:27,410 --> 00:13:30,499
payloads I say attaching payloads when

322
00:13:30,499 --> 00:13:32,329
you're linking payloads I don't know

323
00:13:32,329 --> 00:13:34,129
that anyone actually attaches payloads

324
00:13:34,129 --> 00:13:36,670
anymore because everyone knows that most

325
00:13:36,670 --> 00:13:38,899
mail filters are gonna scan those

326
00:13:38,899 --> 00:13:40,490
attachments and look for any malicious

327
00:13:40,490 --> 00:13:43,100
content within them it's way easier to

328
00:13:43,100 --> 00:13:45,379
just put a link and rely on their IDs so

329
00:13:45,379 --> 00:13:48,230
that's never gonna see anything to try

330
00:13:48,230 --> 00:13:50,180
and block it so a lot of the common

331
00:13:50,180 --> 00:13:53,180
payloads office macros still work anyone

332
00:13:53,180 --> 00:13:56,449
if you're targeting anyone in a the

333
00:13:56,449 --> 00:13:58,579
financial department odds are they have

334
00:13:58,579 --> 00:14:00,410
macros enabled because most of their

335
00:14:00,410 --> 00:14:04,189
workflow is macro based HTML

336
00:14:04,189 --> 00:14:06,709
applications HTA documents these are

337
00:14:06,709 --> 00:14:10,249
just heaven right now they work so well

338
00:14:10,249 --> 00:14:12,259
if an organization is using Internet

339
00:14:12,259 --> 00:14:15,139
Explorer it cuts out so many steps all

340
00:14:15,139 --> 00:14:16,610
they get is one prompt saying or you

341
00:14:16,610 --> 00:14:18,379
want sure you want to run this they

342
00:14:18,379 --> 00:14:21,639
click OK and we're off to the races

343
00:14:21,639 --> 00:14:24,860
there's also a whole set of scripts the

344
00:14:24,860 --> 00:14:27,249
living off the land binaries project

345
00:14:27,249 --> 00:14:32,110
tons of awesome built-in windows

346
00:14:32,110 --> 00:14:34,579
services and functions that can

347
00:14:34,579 --> 00:14:37,309
excellent execute payloads or you can

348
00:14:37,309 --> 00:14:40,249
even use some of them to pass hashes out

349
00:14:40,249 --> 00:14:42,499
by trying to authenticate to a server

350
00:14:42,499 --> 00:14:48,259
that you've stood up on the Internet so

351
00:14:48,259 --> 00:14:50,059
as far as stopping payloads there's a

352
00:14:50,059 --> 00:14:51,829
lot of different ways to go about this

353
00:14:51,829 --> 00:14:54,709
if you're running Windows 10 and some of

354
00:14:54,709 --> 00:14:57,589
the latent latest feature updates the

355
00:14:57,589 --> 00:14:59,540
attack surface reduction rules are

356
00:14:59,540 --> 00:15:02,809
really amazing because they stop office

357
00:15:02,809 --> 00:15:05,360
programs from spawning child processes

358
00:15:05,360 --> 00:15:08,389
so if someone's running so using a

359
00:15:08,389 --> 00:15:12,800
phishing payload that's a macro usually

360
00:15:12,800 --> 00:15:15,019
what's gonna happen is that Office

361
00:15:15,019 --> 00:15:16,550
document either Word or Excel

362
00:15:16,550 --> 00:15:18,709
sometimes even Microsoft Access files

363
00:15:18,709 --> 00:15:22,999
they're gonna execute a a macro that's

364
00:15:22,999 --> 00:15:26,120
going to spawn a either command C or

365
00:15:26,120 --> 00:15:29,029
PowerShell DX's child process underneath

366
00:15:29,029 --> 00:15:31,009
it with attack surface reduction turned

367
00:15:31,009 --> 00:15:33,259
on that's no longer possible so that

368
00:15:33,259 --> 00:15:35,480
helps mitigate a lot of those macro

369
00:15:35,480 --> 00:15:37,240
based attacks right

370
00:15:37,240 --> 00:15:39,890
another thing is changing file type

371
00:15:39,890 --> 00:15:42,920
associations so I said that H TAS are

372
00:15:42,920 --> 00:15:45,170
amazing they work all the time the

373
00:15:45,170 --> 00:15:47,480
reason they work so well is because HT a

374
00:15:47,480 --> 00:15:50,720
file types in Internet Explorer are

375
00:15:50,720 --> 00:15:54,130
automatically associated with the MSHDA

376
00:15:54,130 --> 00:15:55,940
executable so they're going to run

377
00:15:55,940 --> 00:15:58,340
automatically I have been to an

378
00:15:58,340 --> 00:15:59,840
organization before that actually

379
00:15:59,840 --> 00:16:02,960
associated HT a files with notepad so it

380
00:16:02,960 --> 00:16:04,730
just opened them up in notepad so that

381
00:16:04,730 --> 00:16:06,860
the user could view them and that

382
00:16:06,860 --> 00:16:09,770
immediately took out that whole swath of

383
00:16:09,770 --> 00:16:14,270
payloads that we typically use so you

384
00:16:14,270 --> 00:16:17,360
can push that out as a GPO once again

385
00:16:17,360 --> 00:16:19,010
one of the major things to first real

386
00:16:19,010 --> 00:16:21,380
figure out is find out if you're using

387
00:16:21,380 --> 00:16:23,270
HTA's within your organization before

388
00:16:23,270 --> 00:16:25,100
pushing that out because the last thing

389
00:16:25,100 --> 00:16:27,290
you want to do is push that out and find

390
00:16:27,290 --> 00:16:29,060
out that oh we just broke a bunch of

391
00:16:29,060 --> 00:16:31,940
stuff because I know that like when you

392
00:16:31,940 --> 00:16:34,310
download and install Chrome

393
00:16:34,310 --> 00:16:37,670
I believe they use an HT a little

394
00:16:37,670 --> 00:16:41,930
downloader program that they use but

395
00:16:41,930 --> 00:16:43,940
yeah you can push out a GPO you can

396
00:16:43,940 --> 00:16:46,340
modify the registry on individual

397
00:16:46,340 --> 00:16:52,460
systems so on to the lack of cyber

398
00:16:52,460 --> 00:16:55,580
hygiene so this is something that we see

399
00:16:55,580 --> 00:16:58,550
in large and small organizations there's

400
00:16:58,550 --> 00:17:00,470
just a lot of things that people are

401
00:17:00,470 --> 00:17:05,869
still not doing so a lot of people talk

402
00:17:05,869 --> 00:17:08,829
about the CIS security controls and

403
00:17:08,829 --> 00:17:11,990
everyone talks about penetration testing

404
00:17:11,990 --> 00:17:14,690
red teaming all these cool awesome

405
00:17:14,690 --> 00:17:16,280
things and guess what that's like the

406
00:17:16,280 --> 00:17:18,500
last step organizations should be doing

407
00:17:18,500 --> 00:17:21,109
a lot more before engaging in pen

408
00:17:21,109 --> 00:17:23,329
testing and red teaming and I don't

409
00:17:23,329 --> 00:17:25,640
think I've been to an organization that

410
00:17:25,640 --> 00:17:30,590
has mastered step numbers 1 & 2 people

411
00:17:30,590 --> 00:17:32,120
always have stuff on their network that

412
00:17:32,120 --> 00:17:33,860
they're like I have no idea where that

413
00:17:33,860 --> 00:17:37,340
is or what that is we actually scanned a

414
00:17:37,340 --> 00:17:40,340
network probably two years ago and I was

415
00:17:40,340 --> 00:17:41,930
like oh this must be a false positive

416
00:17:41,930 --> 00:17:43,340
because it says there's a Windows NT

417
00:17:43,340 --> 00:17:45,110
system on the network and there's no way

418
00:17:45,110 --> 00:17:46,760
you guys still have a Windows NT box on

419
00:17:46,760 --> 00:17:48,860
the network and the guys face just went

420
00:17:48,860 --> 00:17:50,270
goes white and he was like

421
00:17:50,270 --> 00:17:52,250
someone forgot to unplug that and he

422
00:17:52,250 --> 00:17:53,840
took us down to the basement and showed

423
00:17:53,840 --> 00:17:55,460
us where it was sitting there in their

424
00:17:55,460 --> 00:17:57,260
data center and I was like I can't

425
00:17:57,260 --> 00:18:00,230
believe this is still running but tons

426
00:18:00,230 --> 00:18:02,000
of organizations have no idea what's

427
00:18:02,000 --> 00:18:03,470
running on their network a lot of times

428
00:18:03,470 --> 00:18:05,679
when they bring us in to do pen testing

429
00:18:05,679 --> 00:18:08,750
the one of the key things they want is

430
00:18:08,750 --> 00:18:10,550
they want that nmap report showing all

431
00:18:10,550 --> 00:18:11,840
the systems that are on their network

432
00:18:11,840 --> 00:18:14,059
because they don't even know when you

433
00:18:14,059 --> 00:18:16,370
get a scope from a customer they're like

434
00:18:16,370 --> 00:18:18,950
do this whole slash 8 because I don't

435
00:18:18,950 --> 00:18:20,510
know what's out there and I want to find

436
00:18:20,510 --> 00:18:23,630
out and so we spend a lot of time just

437
00:18:23,630 --> 00:18:26,870
scanning empty swaths of network because

438
00:18:26,870 --> 00:18:28,070
they're not sure if something's there or

439
00:18:28,070 --> 00:18:33,980
not what was that I mean almost

440
00:18:33,980 --> 00:18:35,480
everything I'm mentioning in here people

441
00:18:35,480 --> 00:18:40,160
can do themselves but people get people

442
00:18:40,160 --> 00:18:41,540
pay for services so they don't have to

443
00:18:41,540 --> 00:18:43,400
do it I pay for someone to come and

444
00:18:43,400 --> 00:18:45,650
clean up my dog's poop because it's

445
00:18:45,650 --> 00:18:47,330
something I could do myself but I'd

446
00:18:47,330 --> 00:18:53,179
rather pay someone else to do it so one

447
00:18:53,179 --> 00:18:56,660
of the major issues we see with lack of

448
00:18:56,660 --> 00:18:59,090
cyber hygiene is people are putting

449
00:18:59,090 --> 00:19:01,460
stuff on the network without modifying

450
00:19:01,460 --> 00:19:02,840
the defaults at all they're just like

451
00:19:02,840 --> 00:19:04,340
plug that into the network and we're

452
00:19:04,340 --> 00:19:08,780
good to go like or one of the big

453
00:19:08,780 --> 00:19:11,710
problems of default installs are

454
00:19:11,710 --> 00:19:14,540
developers because they love to spin up

455
00:19:14,540 --> 00:19:19,100
CMS systems and web servers by just next

456
00:19:19,100 --> 00:19:20,840
next finish keep all the defaults I just

457
00:19:20,840 --> 00:19:22,100
want to make sure that this page is

458
00:19:22,100 --> 00:19:24,890
working ok it's working deploy it and

459
00:19:24,890 --> 00:19:28,280
forget to uninstall everything so now

460
00:19:28,280 --> 00:19:32,929
you've got ColdFusion whatever all of

461
00:19:32,929 --> 00:19:34,370
them are vulnerable to something because

462
00:19:34,370 --> 00:19:36,260
that's ColdFusion so it's now sitting on

463
00:19:36,260 --> 00:19:38,570
your network even though it isn't being

464
00:19:38,570 --> 00:19:41,059
used to host anything you see things

465
00:19:41,059 --> 00:19:43,910
like Jenkins Tomcat all these things

466
00:19:43,910 --> 00:19:45,470
with default credentials

467
00:19:45,470 --> 00:19:48,320
every time I search for a printer or

468
00:19:48,320 --> 00:19:51,380
network device Google automatically puts

469
00:19:51,380 --> 00:19:53,240
default password as the guests as to

470
00:19:53,240 --> 00:19:54,650
what I'm gonna search for because that's

471
00:19:54,650 --> 00:19:58,160
what I do is I get on a network I scan

472
00:19:58,160 --> 00:19:59,300
find everything that's out there

473
00:19:59,300 --> 00:20:03,330
anything that has an HTTP or HTTPS port

474
00:20:03,330 --> 00:20:05,160
I put into a tool like eyewitness or

475
00:20:05,160 --> 00:20:08,010
aqua tone and they go through and take

476
00:20:08,010 --> 00:20:10,740
screenshots of all of those pages then I

477
00:20:10,740 --> 00:20:12,390
go through each of those screenshots and

478
00:20:12,390 --> 00:20:14,730
I go okay what's this let's check see if

479
00:20:14,730 --> 00:20:17,220
default credentials work most of the

480
00:20:17,220 --> 00:20:20,400
time they do printers printers no one

481
00:20:20,400 --> 00:20:21,720
changes the default credentials on

482
00:20:21,720 --> 00:20:24,330
printers because they don't want to have

483
00:20:24,330 --> 00:20:26,160
to deal with telling someone what it is

484
00:20:26,160 --> 00:20:27,480
if there's a printer problem because

485
00:20:27,480 --> 00:20:29,540
printers are always causing problems

486
00:20:29,540 --> 00:20:32,130
I've actually gotten domain

487
00:20:32,130 --> 00:20:34,320
administrator from a printer because

488
00:20:34,320 --> 00:20:37,200
they had the printer tied into Active

489
00:20:37,200 --> 00:20:39,390
Directory with domain administrator

490
00:20:39,390 --> 00:20:41,490
credentials so that they could scan

491
00:20:41,490 --> 00:20:44,100
their documents to whoever's user folder

492
00:20:44,100 --> 00:20:45,720
they needed to so they had to give a

493
00:20:45,720 --> 00:20:47,610
domain administrator credentials it just

494
00:20:47,610 --> 00:20:50,400
made it so easy but once you go into the

495
00:20:50,400 --> 00:20:52,710
configuration you can then point it at a

496
00:20:52,710 --> 00:20:55,260
new IP address and test the connection

497
00:20:55,260 --> 00:20:58,860
and this one wasn't even sending a hash

498
00:20:58,860 --> 00:21:00,480
password it just sent clear text

499
00:21:00,480 --> 00:21:02,430
passwords so you just sniff traffic and

500
00:21:02,430 --> 00:21:04,110
here's clear text domain administrator

501
00:21:04,110 --> 00:21:06,930
credentials that one was a lot of fun

502
00:21:06,930 --> 00:21:08,340
because the customer was a jerk about

503
00:21:08,340 --> 00:21:09,990
everything like that Network access

504
00:21:09,990 --> 00:21:12,480
controls on so we were like how can you

505
00:21:12,480 --> 00:21:13,620
turn that off so we can plug in and

506
00:21:13,620 --> 00:21:14,760
start scanning and they were like you're

507
00:21:14,760 --> 00:21:17,100
the hackers figure it out so we just

508
00:21:17,100 --> 00:21:18,300
cloned one of their printers MAC

509
00:21:18,300 --> 00:21:20,010
addresses and got on the network

510
00:21:20,010 --> 00:21:22,950
and then we were like do you guys want

511
00:21:22,950 --> 00:21:25,170
an authenticated vulnerability scan as

512
00:21:25,170 --> 00:21:26,010
part of this because a lot of

513
00:21:26,010 --> 00:21:28,050
organizations don't have necessarily

514
00:21:28,050 --> 00:21:29,250
will give you an authenticated

515
00:21:29,250 --> 00:21:30,690
vulnerability scan it's yours to keep

516
00:21:30,690 --> 00:21:32,160
like we don't really do anything with it

517
00:21:32,160 --> 00:21:33,660
we don't use it as part of our attack

518
00:21:33,660 --> 00:21:35,670
path and they're like yeah that'd be

519
00:21:35,670 --> 00:21:37,050
good we're like okay like do you want to

520
00:21:37,050 --> 00:21:39,240
just type in the password that you want

521
00:21:39,240 --> 00:21:40,950
to use to authenticate for this scan and

522
00:21:40,950 --> 00:21:42,090
they're like no you guys are the hackers

523
00:21:42,090 --> 00:21:43,830
figure it out and so like five minutes

524
00:21:43,830 --> 00:21:45,600
later I was like oh we're doing that

525
00:21:45,600 --> 00:21:47,250
vulnerable that vulnerability scan with

526
00:21:47,250 --> 00:21:48,870
your domain admin creds so don't worry

527
00:21:48,870 --> 00:21:53,430
about it we got it and the last bullet

528
00:21:53,430 --> 00:21:56,250
point here we're always looking for

529
00:21:56,250 --> 00:21:57,650
systems like I was talking about earlier

530
00:21:57,650 --> 00:21:59,400
ColdFusion Jenkins

531
00:21:59,400 --> 00:22:02,040
Tomcat systems that can deploy and

532
00:22:02,040 --> 00:22:04,140
execute code and are usually running

533
00:22:04,140 --> 00:22:06,480
with very high privileges on the system

534
00:22:06,480 --> 00:22:09,330
so usually if we find one of these

535
00:22:09,330 --> 00:22:11,190
without credentials or with default

536
00:22:11,190 --> 00:22:14,160
credentials it's one step away from us

537
00:22:14,160 --> 00:22:16,360
fully compromising that system and then

538
00:22:16,360 --> 00:22:19,090
once we have system level access that

539
00:22:19,090 --> 00:22:21,010
enables things like stealing clear text

540
00:22:21,010 --> 00:22:23,019
passwords password hashes and moving

541
00:22:23,019 --> 00:22:24,010
around the network which we'll get into

542
00:22:24,010 --> 00:22:29,080
in a little bit so patching still an

543
00:22:29,080 --> 00:22:32,080
issue to this day in almost every

544
00:22:32,080 --> 00:22:35,830
organization a lot of organizations are

545
00:22:35,830 --> 00:22:38,019
starting to get Windows patching under

546
00:22:38,019 --> 00:22:40,090
control but they're still failing at a

547
00:22:40,090 --> 00:22:42,880
lot of other patching there's so many

548
00:22:42,880 --> 00:22:43,899
outdated

549
00:22:43,899 --> 00:22:47,140
I think I saw ESX for running recently

550
00:22:47,140 --> 00:22:50,049
mmm that's really old at this point and

551
00:22:50,049 --> 00:22:52,740
has a ton of vulnerabilities in it

552
00:22:52,740 --> 00:22:55,600
people don't really have a strategy for

553
00:22:55,600 --> 00:22:57,070
patching any of their Linux or UNIX

554
00:22:57,070 --> 00:23:01,720
systems still mainframes who patches

555
00:23:01,720 --> 00:23:03,909
their mainframe I haven't seen that very

556
00:23:03,909 --> 00:23:07,360
often and then we've seen some

557
00:23:07,360 --> 00:23:09,669
organizations that are actually they

558
00:23:09,669 --> 00:23:12,580
claim they're too big to patch I went

559
00:23:12,580 --> 00:23:15,850
into an organization and it was about a

560
00:23:15,850 --> 00:23:18,789
year after I'm a 17-10 and we scanned

561
00:23:18,789 --> 00:23:20,919
and looked around and we were like okay

562
00:23:20,919 --> 00:23:24,039
you have like 250 instances of systems

563
00:23:24,039 --> 00:23:25,990
vulnerable to MS 1710 and they're like

564
00:23:25,990 --> 00:23:28,539
but we're at 95% patch level so we're

565
00:23:28,539 --> 00:23:30,519
good like we just could you please take

566
00:23:30,519 --> 00:23:32,710
this critical down to a high because we

567
00:23:32,710 --> 00:23:34,659
can't get to the rest of them and I was

568
00:23:34,659 --> 00:23:38,380
like no that's your problem not mine

569
00:23:38,380 --> 00:23:41,500
like I can't imagine running an

570
00:23:41,500 --> 00:23:43,000
organization and just being like yeah

571
00:23:43,000 --> 00:23:44,889
we'll just let these vulnerable systems

572
00:23:44,889 --> 00:23:47,440
just float around and just call it a

573
00:23:47,440 --> 00:23:51,279
unsolvable problem and then the last

574
00:23:51,279 --> 00:23:54,519
point it's important to patch things

575
00:23:54,519 --> 00:23:56,380
like user workstations cuz they're gonna

576
00:23:56,380 --> 00:23:59,169
constantly be going out to websites

577
00:23:59,169 --> 00:24:01,139
they're gonna be getting emails any

578
00:24:01,139 --> 00:24:04,690
vulnerability that's within any of the

579
00:24:04,690 --> 00:24:07,299
browser's are critical to get patched on

580
00:24:07,299 --> 00:24:09,220
user workstations because they're at the

581
00:24:09,220 --> 00:24:11,220
most threat to being exploited by those

582
00:24:11,220 --> 00:24:14,620
your servers you want to patch them but

583
00:24:14,620 --> 00:24:16,090
it's not as critical to patch them right

584
00:24:16,090 --> 00:24:17,980
away because your server should not

585
00:24:17,980 --> 00:24:19,659
people shouldn't be browsing the

586
00:24:19,659 --> 00:24:21,760
internet from servers people do but they

587
00:24:21,760 --> 00:24:24,970
shouldn't so they're not as critical to

588
00:24:24,970 --> 00:24:27,730
patch right away but there are systems

589
00:24:27,730 --> 00:24:28,990
that you just can't patch there's

590
00:24:28,990 --> 00:24:30,190
industrial control so

591
00:24:30,190 --> 00:24:33,460
that are running on Windows XP and are

592
00:24:33,460 --> 00:24:35,889
unable to be patched and the key there

593
00:24:35,889 --> 00:24:37,799
is isolating them there's always

594
00:24:37,799 --> 00:24:40,480
multiple ways to solve problems in

595
00:24:40,480 --> 00:24:41,620
security I think that's one of the

596
00:24:41,620 --> 00:24:43,330
things that I love and I'm sure everyone

597
00:24:43,330 --> 00:24:46,350
else loves is its it's like a puzzle

598
00:24:46,350 --> 00:24:48,909
there's the the simple solution to just

599
00:24:48,909 --> 00:24:50,830
patch everything and then there's the

600
00:24:50,830 --> 00:24:53,169
more complicated solution of finding

601
00:24:53,169 --> 00:24:55,179
ways to secure that device without

602
00:24:55,179 --> 00:25:00,340
relying on patching and that's anything

603
00:25:00,340 --> 00:25:04,000
from firewalling it off to isolating it

604
00:25:04,000 --> 00:25:06,370
from the network completely on a air-gap

605
00:25:06,370 --> 00:25:09,639
network or just accepting the fact that

606
00:25:09,639 --> 00:25:11,460
there's always going to be risk and

607
00:25:11,460 --> 00:25:13,929
heavily monitoring that system so that

608
00:25:13,929 --> 00:25:15,730
when something does happen you're

609
00:25:15,730 --> 00:25:20,590
alerted and you can react quickly so one

610
00:25:20,590 --> 00:25:23,409
of the things we see very often we've

611
00:25:23,409 --> 00:25:25,120
seen organizations who have been hit

612
00:25:25,120 --> 00:25:28,230
with ransomware they've been hit with

613
00:25:28,230 --> 00:25:31,090
crypto miners or even just discs wipers

614
00:25:31,090 --> 00:25:34,840
and the first thing that happens is as

615
00:25:34,840 --> 00:25:37,000
we're seeing with Baltimore there's a

616
00:25:37,000 --> 00:25:38,559
massive increasing budget all of a

617
00:25:38,559 --> 00:25:40,210
sudden they're gonna go out and they're

618
00:25:40,210 --> 00:25:43,029
gonna buy everything they can they think

619
00:25:43,029 --> 00:25:44,799
that they're gonna be able to just buy

620
00:25:44,799 --> 00:25:46,779
security by putting a bunch of boxes out

621
00:25:46,779 --> 00:25:50,259
there and that's gonna help protect them

622
00:25:50,259 --> 00:25:52,960
but the reality is if you don't have the

623
00:25:52,960 --> 00:25:55,269
basics covered then the blinky blocks is

624
00:25:55,269 --> 00:25:57,730
they're not gonna do anything for you we

625
00:25:57,730 --> 00:26:00,220
had a customer we did that had gone

626
00:26:00,220 --> 00:26:02,409
through ransomware they'd recovered

627
00:26:02,409 --> 00:26:05,710
they'd spent millions and millions of

628
00:26:05,710 --> 00:26:08,710
dollars in order to secure their network

629
00:26:08,710 --> 00:26:10,960
almost every host every workstation in

630
00:26:10,960 --> 00:26:13,090
their environment was basically a

631
00:26:13,090 --> 00:26:15,879
malware analysis box they had multiple

632
00:26:15,879 --> 00:26:19,090
endpoint defense products on there all

633
00:26:19,090 --> 00:26:22,210
this stuff but they still like they were

634
00:26:22,210 --> 00:26:24,549
catching all the typical stuff our HTA's

635
00:26:24,549 --> 00:26:26,220
things like that we were getting caught

636
00:26:26,220 --> 00:26:29,169
but the problem was because they had so

637
00:26:29,169 --> 00:26:30,940
much stuff on there they increased their

638
00:26:30,940 --> 00:26:32,889
surface area that they're at risk of

639
00:26:32,889 --> 00:26:35,559
being attacked on and some of those

640
00:26:35,559 --> 00:26:37,299
security products required the

641
00:26:37,299 --> 00:26:40,450
installation of supporting software so

642
00:26:40,450 --> 00:26:42,549
every one of their work stations had

643
00:26:42,549 --> 00:26:43,200
Perl

644
00:26:43,200 --> 00:26:46,350
and Python installed on it so then we

645
00:26:46,350 --> 00:26:50,070
just used a payload based in Perl and we

646
00:26:50,070 --> 00:26:51,929
were just fine and they thought they

647
00:26:51,929 --> 00:26:53,010
thought for sure they had everything

648
00:26:53,010 --> 00:26:54,480
locked down they were like we're not

649
00:26:54,480 --> 00:26:56,460
seeing anything you guys are dead in

650
00:26:56,460 --> 00:26:58,110
your tracks and we were just like yeah

651
00:26:58,110 --> 00:27:00,090
your network was fully compromised again

652
00:27:00,090 --> 00:27:01,679
and if we wanted to could have put

653
00:27:01,679 --> 00:27:03,779
ransomware everywhere just like the last

654
00:27:03,779 --> 00:27:11,669
people no I mean the big sources of

655
00:27:11,669 --> 00:27:15,950
ransomware are gonna be HTA's

656
00:27:15,950 --> 00:27:18,960
executables that are then using some

657
00:27:18,960 --> 00:27:21,149
stuff we're gonna get into later like

658
00:27:21,149 --> 00:27:22,950
local administrator password issues a

659
00:27:22,950 --> 00:27:24,360
lot of times or what they're taking

660
00:27:24,360 --> 00:27:27,269
advantage of there are some take

661
00:27:27,269 --> 00:27:31,110
advantage of exploits like ms 1710 but

662
00:27:31,110 --> 00:27:34,409
those are more rare it's usually taking

663
00:27:34,409 --> 00:27:37,250
advantage of security misconfigurations

664
00:27:37,250 --> 00:27:40,080
we'll talk there's a another section on

665
00:27:40,080 --> 00:27:48,809
local administrator issues so it is

666
00:27:48,809 --> 00:27:50,880
interesting now that Microsoft actually

667
00:27:50,880 --> 00:27:53,029
has Python in the Microsoft Store

668
00:27:53,029 --> 00:27:56,580
there's a lot of stuff going on with the

669
00:27:56,580 --> 00:27:59,130
windows subsystem for Linux Python being

670
00:27:59,130 --> 00:28:02,190
like Microsoft is now the open source

671
00:28:02,190 --> 00:28:05,580
darling like they there's the era of

672
00:28:05,580 --> 00:28:07,380
Linux on the desktop is here thanks to

673
00:28:07,380 --> 00:28:11,190
Windows but it's gonna be interesting to

674
00:28:11,190 --> 00:28:14,789
see how attacker tactics develop based

675
00:28:14,789 --> 00:28:18,269
on that because I could see a having a

676
00:28:18,269 --> 00:28:20,460
Linux system within a Windows

677
00:28:20,460 --> 00:28:22,289
environment as an attacker sounds

678
00:28:22,289 --> 00:28:24,149
wonderful I would love to have a

679
00:28:24,149 --> 00:28:25,950
powershell one-liner on a compromised

680
00:28:25,950 --> 00:28:28,350
Windows system to download and install

681
00:28:28,350 --> 00:28:31,440
Kali right there on that box and hide

682
00:28:31,440 --> 00:28:33,269
the window and give me access to it so I

683
00:28:33,269 --> 00:28:36,360
can SSH into it then I can have all my

684
00:28:36,360 --> 00:28:38,100
tools on-site I don't have to worry

685
00:28:38,100 --> 00:28:41,820
about bringing stuff in so it's a lot of

686
00:28:41,820 --> 00:28:44,000
stuff that I think the research is very

687
00:28:44,000 --> 00:28:46,139
young on there hasn't been a whole lot

688
00:28:46,139 --> 00:28:48,029
especially because the windows subsystem

689
00:28:48,029 --> 00:28:51,389
for Linux just got a lot better in the

690
00:28:51,389 --> 00:28:53,250
latest feature update so you can now

691
00:28:53,250 --> 00:28:55,289
actually run and map whereas before you

692
00:28:55,289 --> 00:28:56,880
couldn't really enter

693
00:28:56,880 --> 00:29:00,300
with the network interfaces so I don't

694
00:29:00,300 --> 00:29:02,970
think pipe like I'm not aware of Python

695
00:29:02,970 --> 00:29:04,920
or Perl being used in ransomware attacks

696
00:29:04,920 --> 00:29:07,890
it's typically just standard windows

697
00:29:07,890 --> 00:29:11,390
execution of programs

698
00:29:12,440 --> 00:29:14,510
Stuxnet I'm not a hundred percent

699
00:29:14,510 --> 00:29:16,830
familiar on everything I mean that was

700
00:29:16,830 --> 00:29:18,840
targeting industrial control system and

701
00:29:18,840 --> 00:29:22,770
also was layered up with zero-day

702
00:29:22,770 --> 00:29:25,170
exploits so it's it's a bit of an

703
00:29:25,170 --> 00:29:28,640
outlier the standard ransomware is as

704
00:29:28,640 --> 00:29:30,930
complicated as it needs to be to get the

705
00:29:30,930 --> 00:29:36,210
job done and no more so as I was saying

706
00:29:36,210 --> 00:29:39,450
less it's less attack surface is huge

707
00:29:39,450 --> 00:29:41,640
some of these products just increase the

708
00:29:41,640 --> 00:29:43,530
amount of issues you're gonna have on

709
00:29:43,530 --> 00:29:45,870
your network you are deploying an

710
00:29:45,870 --> 00:29:47,520
endpoint agent to every one of your

711
00:29:47,520 --> 00:29:49,530
systems and guess what if that gets

712
00:29:49,530 --> 00:29:50,190
compromised

713
00:29:50,190 --> 00:29:52,230
I can now deploy code on every one of

714
00:29:52,230 --> 00:29:55,020
those endpoints as well if you're

715
00:29:55,020 --> 00:29:59,790
familiar with McAfee Z policy Ipoh we

716
00:29:59,790 --> 00:30:01,860
have used that to push code out to every

717
00:30:01,860 --> 00:30:03,630
single system checking in on that

718
00:30:03,630 --> 00:30:07,620
network in the last line there marketers

719
00:30:07,620 --> 00:30:09,870
are not security engineers so they'll

720
00:30:09,870 --> 00:30:11,610
tell you whatever you want to hear to

721
00:30:11,610 --> 00:30:14,160
make that sale but the reality is much

722
00:30:14,160 --> 00:30:17,100
different and just because something's

723
00:30:17,100 --> 00:30:19,470
capable of preventing certain attacks

724
00:30:19,470 --> 00:30:21,420
doesn't mean it's default configured

725
00:30:21,420 --> 00:30:26,010
steady state is able to that the guy who

726
00:30:26,010 --> 00:30:27,300
didn't have the internet that I was

727
00:30:27,300 --> 00:30:28,590
talking about earlier who's the head of

728
00:30:28,590 --> 00:30:30,990
security they had a very expensive

729
00:30:30,990 --> 00:30:33,300
product in their network but they didn't

730
00:30:33,300 --> 00:30:35,370
have the budget to afford training for

731
00:30:35,370 --> 00:30:38,610
it so they got it plugged in and then it

732
00:30:38,610 --> 00:30:39,840
just sat there and they didn't know what

733
00:30:39,840 --> 00:30:41,040
to do with it because no one was able to

734
00:30:41,040 --> 00:30:43,020
get trained on it so that's really just

735
00:30:43,020 --> 00:30:44,490
a waste of money at that point you're

736
00:30:44,490 --> 00:30:48,060
better off hiring a person as opposed to

737
00:30:48,060 --> 00:30:49,500
spending the money on a blinky box

738
00:30:49,500 --> 00:30:52,200
because a person can Google a person can

739
00:30:52,200 --> 00:30:54,120
go on github and pull down projects and

740
00:30:54,120 --> 00:30:56,370
look at implementing them the Box can't

741
00:30:56,370 --> 00:30:58,790
do any of that

742
00:31:02,220 --> 00:31:06,100
so some of the solutions for dealing

743
00:31:06,100 --> 00:31:10,149
with those problems a lot of times you

744
00:31:10,149 --> 00:31:13,029
need to let executives know that there's

745
00:31:13,029 --> 00:31:16,090
certain exploits like the blue keep one

746
00:31:16,090 --> 00:31:18,309
that's out there right now it's there's

747
00:31:18,309 --> 00:31:20,440
no POC that I'm aware of that's publicly

748
00:31:20,440 --> 00:31:22,210
available but it is a remotely

749
00:31:22,210 --> 00:31:26,830
exploitable RDP vulnerability and anyone

750
00:31:26,830 --> 00:31:29,830
who has first off don't put RDP on the

751
00:31:29,830 --> 00:31:31,720
Internet just don't do it put it behind

752
00:31:31,720 --> 00:31:34,389
a VPN and VP onion and then RDP but

753
00:31:34,389 --> 00:31:36,669
people have done that but you need to

754
00:31:36,669 --> 00:31:39,970
stress to executives management that

755
00:31:39,970 --> 00:31:42,789
this is a big deal because as soon as a

756
00:31:42,789 --> 00:31:45,639
public POC does come out if someone in

757
00:31:45,639 --> 00:31:48,720
your network in the network gets

758
00:31:48,720 --> 00:31:51,700
exploited with fishing or drive-by

759
00:31:51,700 --> 00:31:54,999
download anything like that every system

760
00:31:54,999 --> 00:31:56,799
inside the network that has that

761
00:31:56,799 --> 00:31:58,570
vulnerability still present is probably

762
00:31:58,570 --> 00:32:02,189
gonna get ransomware installed on it so

763
00:32:03,659 --> 00:32:06,159
when you're dealing with the systems

764
00:32:06,159 --> 00:32:09,460
that have default passwords and/or no

765
00:32:09,460 --> 00:32:11,619
passwords it's important that you have

766
00:32:11,619 --> 00:32:13,629
some sort of system validation process

767
00:32:13,629 --> 00:32:15,309
before anything can even be plugged into

768
00:32:15,309 --> 00:32:17,200
your network all of that configuration

769
00:32:17,200 --> 00:32:19,059
should be done before it's put on the

770
00:32:19,059 --> 00:32:21,100
network too often people are like okay

771
00:32:21,100 --> 00:32:22,990
let's get this on the network get it up

772
00:32:22,990 --> 00:32:24,070
and running and we'll worry about

773
00:32:24,070 --> 00:32:25,869
securing it later and later never

774
00:32:25,869 --> 00:32:28,539
happens it just sits there probably

775
00:32:28,539 --> 00:32:30,309
changes hands to the point where no one

776
00:32:30,309 --> 00:32:31,840
even knows who the system owner is there

777
00:32:31,840 --> 00:32:34,299
anymore and it's just a relic sitting

778
00:32:34,299 --> 00:32:36,909
there there's countless systems we've

779
00:32:36,909 --> 00:32:39,279
run into that as soon as we notified the

780
00:32:39,279 --> 00:32:40,720
POC they just went and turned it off

781
00:32:40,720 --> 00:32:41,710
because they were like oh yeah we don't

782
00:32:41,710 --> 00:32:42,879
even need that I don't know why that's

783
00:32:42,879 --> 00:32:48,519
still in our network and then if you

784
00:32:48,519 --> 00:32:51,100
want a guide to improving your cyber

785
00:32:51,100 --> 00:32:54,100
hygiene the CIS controls are an amazing

786
00:32:54,100 --> 00:32:56,559
first couple steps to get you going

787
00:32:56,559 --> 00:33:00,850
if you take care of the top five you're

788
00:33:00,850 --> 00:33:02,289
doing better than like 80% of the

789
00:33:02,289 --> 00:33:05,080
organization's I've seen in the last

790
00:33:05,080 --> 00:33:08,850
point hire people not boxes

791
00:33:09,160 --> 00:33:13,150
so password hashes this is an issue that

792
00:33:13,150 --> 00:33:17,590
has really become huge with ransomware

793
00:33:17,590 --> 00:33:19,210
because people are taking advantage of

794
00:33:19,210 --> 00:33:21,190
this to spread ransomware once they get

795
00:33:21,190 --> 00:33:24,880
inside an organization so here's just a

796
00:33:24,880 --> 00:33:26,710
quick rundown of some of the tools we

797
00:33:26,710 --> 00:33:29,460
use responder is our number one tool

798
00:33:29,460 --> 00:33:34,360
it's been winning us da on assessments

799
00:33:34,360 --> 00:33:36,370
for the past couple years really quickly

800
00:33:36,370 --> 00:33:39,760
I just was on an assessment this past

801
00:33:39,760 --> 00:33:42,730
week and respondent was really the only

802
00:33:42,730 --> 00:33:44,140
thing that was working because they had

803
00:33:44,140 --> 00:33:47,440
their patching under control they had a

804
00:33:47,440 --> 00:33:49,900
well segmented network so we actually

805
00:33:49,900 --> 00:33:51,610
were having a hard time moving around

806
00:33:51,610 --> 00:33:54,970
but responder was great at grabbing all

807
00:33:54,970 --> 00:33:57,310
of those hashes that were running around

808
00:33:57,310 --> 00:33:59,650
out there and their password policy was

809
00:33:59,650 --> 00:34:04,030
horrible so for those who don't know how

810
00:34:04,030 --> 00:34:06,910
responder works responder as the name

811
00:34:06,910 --> 00:34:09,969
implies responds so it sits on the

812
00:34:09,969 --> 00:34:11,620
network it stands up a bunch of

813
00:34:11,620 --> 00:34:14,320
different services and so by default

814
00:34:14,320 --> 00:34:16,270
it'll just sit on the network and just

815
00:34:16,270 --> 00:34:18,129
do analysis of what's going on around it

816
00:34:18,129 --> 00:34:20,830
but if anyone tries to connect to you on

817
00:34:20,830 --> 00:34:23,230
any of the port's that it's running like

818
00:34:23,230 --> 00:34:28,389
it's running SMB HTTP HTTP FTP SSH and

819
00:34:28,389 --> 00:34:30,429
it's just capturing any authentication

820
00:34:30,429 --> 00:34:32,469
requests that people make to it one time

821
00:34:32,469 --> 00:34:35,230
I was actually running nessus and

822
00:34:35,230 --> 00:34:38,320
responder on the same box and we had a

823
00:34:38,320 --> 00:34:40,780
guy with us on the team who was didn't

824
00:34:40,780 --> 00:34:42,010
typically work on the team he was just

825
00:34:42,010 --> 00:34:43,810
trying to like follow along and see how

826
00:34:43,810 --> 00:34:46,690
we work and he went to login to Nessus

827
00:34:46,690 --> 00:34:48,010
and I got all excited because all of a

828
00:34:48,010 --> 00:34:50,168
sudden I saw like new password captured

829
00:34:50,168 --> 00:34:51,460
and I was like awesome and I look and I

830
00:34:51,460 --> 00:34:53,230
was like who just put our necess

831
00:34:53,230 --> 00:34:55,060
password into responder because

832
00:34:55,060 --> 00:34:56,860
responder will grab any password you put

833
00:34:56,860 --> 00:34:58,630
into it and when you go to the HTTP site

834
00:34:58,630 --> 00:35:02,110
it's just a default login page so anyway

835
00:35:02,110 --> 00:35:04,090
responder once it's on the network it's

836
00:35:04,090 --> 00:35:05,650
running at services and then it's

837
00:35:05,650 --> 00:35:10,630
listening for requests for systems that

838
00:35:10,630 --> 00:35:13,560
aren't present in DNS so when you're

839
00:35:13,560 --> 00:35:16,330
requesting a share you're gonna ask the

840
00:35:16,330 --> 00:35:18,370
DNS server like hey who what's the IP

841
00:35:18,370 --> 00:35:19,900
for this year I want to go connect to it

842
00:35:19,900 --> 00:35:22,570
and get my files and the

843
00:35:22,570 --> 00:35:24,910
server says I don't know it's not in my

844
00:35:24,910 --> 00:35:26,530
records and I wasn't able to retrieve it

845
00:35:26,530 --> 00:35:27,880
from any of the records that I looked up

846
00:35:27,880 --> 00:35:31,840
so then your box goes okay let's use LL

847
00:35:31,840 --> 00:35:38,620
M&R link-local like it on the name link

848
00:35:38,620 --> 00:35:42,160
local multi name resolution multicast

849
00:35:42,160 --> 00:35:44,980
name resolution or NetBIOS name

850
00:35:44,980 --> 00:35:46,780
resolution and so what that's gonna do

851
00:35:46,780 --> 00:35:49,300
is it's gonna broadcast that to your

852
00:35:49,300 --> 00:35:51,460
local subnet on the broadcast address

853
00:35:51,460 --> 00:35:54,070
it's gonna go hey does anyone have this

854
00:35:54,070 --> 00:35:55,630
address because I'm really looking to

855
00:35:55,630 --> 00:35:58,270
connect to this share and responder sits

856
00:35:58,270 --> 00:35:59,800
on the network and goes yep that's me

857
00:35:59,800 --> 00:36:01,990
connect to me I've got your files and

858
00:36:01,990 --> 00:36:04,540
that person is gonna send an SMB request

859
00:36:04,540 --> 00:36:06,580
to mount that share and we're gonna get

860
00:36:06,580 --> 00:36:11,080
that password hash now the nice thing is

861
00:36:11,080 --> 00:36:13,420
once you grab that password hash there's

862
00:36:13,420 --> 00:36:14,920
a lot of different things you can do

863
00:36:14,920 --> 00:36:17,710
with it if the organization has SMB

864
00:36:17,710 --> 00:36:19,810
signing disabled you can just relay that

865
00:36:19,810 --> 00:36:21,220
password hash right along to another

866
00:36:21,220 --> 00:36:24,250
system so we'll set up responder we'll

867
00:36:24,250 --> 00:36:28,060
use either ntlm relay or multi relay and

868
00:36:28,060 --> 00:36:31,450
as soon as we get a password hash a lot

869
00:36:31,450 --> 00:36:33,130
of times we'll look to see if like the

870
00:36:33,130 --> 00:36:34,600
domain controller or file server

871
00:36:34,600 --> 00:36:36,310
somewhere where a couple users might

872
00:36:36,310 --> 00:36:40,060
have sessions or have SMB signing

873
00:36:40,060 --> 00:36:41,530
disabled and we'll try and relay

874
00:36:41,530 --> 00:36:44,530
password hashes over to them the other

875
00:36:44,530 --> 00:36:46,510
thing you now have this captured

876
00:36:46,510 --> 00:36:49,030
password hash so you can start cracking

877
00:36:49,030 --> 00:36:51,820
it if an organization has a password

878
00:36:51,820 --> 00:36:53,920
policy that enables them to have less

879
00:36:53,920 --> 00:36:56,740
than eight care eight characters or less

880
00:36:56,740 --> 00:36:58,630
like any character password in the

881
00:36:58,630 --> 00:37:01,300
entire space of possible passwords can

882
00:37:01,300 --> 00:37:03,940
be cracked in a day with a gpu-based

883
00:37:03,940 --> 00:37:06,790
password cracking rig a lot of

884
00:37:06,790 --> 00:37:09,160
organizations still don't even have a

885
00:37:09,160 --> 00:37:10,810
password policy requiring eight

886
00:37:10,810 --> 00:37:15,100
characters the one I was just at had no

887
00:37:15,100 --> 00:37:17,980
requirement on length so you could have

888
00:37:17,980 --> 00:37:20,290
any password I've seen a lot that are

889
00:37:20,290 --> 00:37:22,840
seven still some have had four

890
00:37:22,840 --> 00:37:25,600
characters which four characters I can

891
00:37:25,600 --> 00:37:27,460
run hash cat in a VM and crack that

892
00:37:27,460 --> 00:37:29,630
password

893
00:37:29,630 --> 00:37:33,440
so once you've gotten that that password

894
00:37:33,440 --> 00:37:35,930
and passed it around if you find a

895
00:37:35,930 --> 00:37:37,070
system where there a local administrator

896
00:37:37,070 --> 00:37:39,650
you have a system level privileges on

897
00:37:39,650 --> 00:37:41,750
that box which enables you to do all

898
00:37:41,750 --> 00:37:45,380
kinds of fun stuff so some of the ways

899
00:37:45,380 --> 00:37:47,720
to stop responder

900
00:37:47,720 --> 00:37:50,540
first off disable LM and r and NetBIOS

901
00:37:50,540 --> 00:37:53,360
name resolution their old protocols that

902
00:37:53,360 --> 00:37:55,250
you don't really need anymore

903
00:37:55,250 --> 00:37:57,740
if people are trying to connect to

904
00:37:57,740 --> 00:37:59,870
shares on your network it should be in

905
00:37:59,870 --> 00:38:02,330
your dns server if it's not people

906
00:38:02,330 --> 00:38:04,520
shouldn't be connecting to it

907
00:38:04,520 --> 00:38:07,940
enable SMB signing so SMB signing is

908
00:38:07,940 --> 00:38:10,670
great because then we can't relay that

909
00:38:10,670 --> 00:38:13,670
password and gain a connection it

910
00:38:13,670 --> 00:38:18,860
basically hashes the hash almost with

911
00:38:18,860 --> 00:38:21,560
each connection so that way it's a

912
00:38:21,560 --> 00:38:23,690
unique connection that we can't get in

913
00:38:23,690 --> 00:38:26,260
between and be in the middle of and then

914
00:38:26,260 --> 00:38:29,240
disabling ntlm is probably getting to be

915
00:38:29,240 --> 00:38:30,830
a good idea at this point we just had

916
00:38:30,830 --> 00:38:33,580
some major vulnerabilities in ntlm we're

917
00:38:33,580 --> 00:38:36,650
even enabling SMB signing didn't do

918
00:38:36,650 --> 00:38:39,070
anything because if you sent the right

919
00:38:39,070 --> 00:38:41,780
packet it was just like okay I'll skip

920
00:38:41,780 --> 00:38:44,360
that check and still let you relay this

921
00:38:44,360 --> 00:38:55,220
hash I mean it's it really he's asking

922
00:38:55,220 --> 00:38:58,160
if disabling ntlm has impact in a modern

923
00:38:58,160 --> 00:39:00,500
enterprise if you're able to do full

924
00:39:00,500 --> 00:39:02,450
Kerberos authentication for everything

925
00:39:02,450 --> 00:39:05,120
and not use ntlm then you're doing

926
00:39:05,120 --> 00:39:07,640
pretty good but you are gonna have some

927
00:39:07,640 --> 00:39:10,250
of those organizations that have legacy

928
00:39:10,250 --> 00:39:12,080
systems that don't fully support

929
00:39:12,080 --> 00:39:14,390
Kerberos authentication like I've still

930
00:39:14,390 --> 00:39:17,330
see Windows 2000 boxes out there that

931
00:39:17,330 --> 00:39:21,230
people are using because a lot of

932
00:39:21,230 --> 00:39:23,000
election infrastructure requires Windows

933
00:39:23,000 --> 00:39:25,430
2000 boxes because vendors don't upgrade

934
00:39:25,430 --> 00:39:27,850
stuff

935
00:39:30,700 --> 00:39:33,520
yeah exactly like if you are keeping

936
00:39:33,520 --> 00:39:35,860
your systems up-to-date and you're

937
00:39:35,860 --> 00:39:37,990
running a full windows 10 environment

938
00:39:37,990 --> 00:39:41,110
Server 2016 or above then you should be

939
00:39:41,110 --> 00:39:43,320
you should have no impact disabling ntlm

940
00:39:43,320 --> 00:39:45,850
the only issues are going to be

941
00:39:45,850 --> 00:39:48,450
depending on how you interact with

942
00:39:48,450 --> 00:39:52,260
printers printers sometimes they want

943
00:39:52,260 --> 00:39:56,110
old-school authentication so if you have

944
00:39:56,110 --> 00:39:58,030
printers that you're authenticating to

945
00:39:58,030 --> 00:40:00,370
that could be an issue and then there's

946
00:40:00,370 --> 00:40:03,220
there's a handful of legacy devices or

947
00:40:03,220 --> 00:40:06,100
older devices that maybe you have an old

948
00:40:06,100 --> 00:40:07,840
network attached storage device that

949
00:40:07,840 --> 00:40:10,150
isn't fully updated a lot of network

950
00:40:10,150 --> 00:40:11,530
attached or devices are still running

951
00:40:11,530 --> 00:40:16,240
SMB v1 so that's a disaster but you have

952
00:40:16,240 --> 00:40:20,350
that issue with old old stuff but that's

953
00:40:20,350 --> 00:40:22,690
why you really before disabling it you

954
00:40:22,690 --> 00:40:24,430
need to investigate and make sure you

955
00:40:24,430 --> 00:40:28,750
can disable it so test first and disable

956
00:40:28,750 --> 00:40:30,280
it on your own system before disabling

957
00:40:30,280 --> 00:40:31,660
it on a user system because the last

958
00:40:31,660 --> 00:40:35,520
thing you want to do is knock them out

959
00:40:36,030 --> 00:40:39,130
so there are additional things to

960
00:40:39,130 --> 00:40:41,230
consider that responder is capable of

961
00:40:41,230 --> 00:40:42,850
doing so

962
00:40:42,850 --> 00:40:47,170
ipv6 there's a great way to run a tool

963
00:40:47,170 --> 00:40:48,160
called man-in-the-middle

964
00:40:48,160 --> 00:40:51,160
ipv6 main in the middle six what it does

965
00:40:51,160 --> 00:40:55,420
is it spins up a ipv6 Network and gives

966
00:40:55,420 --> 00:40:58,240
Windows hosts on the same subnet ipv6

967
00:40:58,240 --> 00:41:00,310
addresses and says that I'm the DNS

968
00:41:00,310 --> 00:41:04,570
server Windows by default prioritizes

969
00:41:04,570 --> 00:41:07,990
ipv6 networks over ipv4 networks so now

970
00:41:07,990 --> 00:41:11,140
you get all those DNS requests first so

971
00:41:11,140 --> 00:41:13,660
if you want to tell them you're the

972
00:41:13,660 --> 00:41:14,920
system they're trying to connect to you

973
00:41:14,920 --> 00:41:18,220
can do that with ipv6 and that way you

974
00:41:18,220 --> 00:41:20,890
don't have to use El M&R or NetBIOS name

975
00:41:20,890 --> 00:41:23,080
resolution so if you don't have an ipv6

976
00:41:23,080 --> 00:41:24,940
Network it's probably a good idea to

977
00:41:24,940 --> 00:41:29,370
disable ipv6 on your Windows systems

978
00:41:32,920 --> 00:41:36,589
yeah exactly like a hands hands up in

979
00:41:36,589 --> 00:41:38,450
the room who's running internal ipv6

980
00:41:38,450 --> 00:41:44,809
right now that's why the memes there but

981
00:41:44,809 --> 00:41:47,799
so there's also W pad which is a

982
00:41:47,799 --> 00:41:52,519
automatic proxy configuration Windows

983
00:41:52,519 --> 00:41:54,440
has had problems with W pad for a very

984
00:41:54,440 --> 00:41:55,609
long time and there are still

985
00:41:55,609 --> 00:41:58,009
organizations that don't have all the

986
00:41:58,009 --> 00:42:00,859
updates so with W pad when a system

987
00:42:00,859 --> 00:42:02,299
connects to the network it's going to

988
00:42:02,299 --> 00:42:04,670
request from the DNS server the W pad

989
00:42:04,670 --> 00:42:06,739
configuration if the DNS server doesn't

990
00:42:06,739 --> 00:42:08,900
have a W pad configuration responder can

991
00:42:08,900 --> 00:42:11,420
say here's your W pad configuration now

992
00:42:11,420 --> 00:42:12,680
all your browsing sessions are coming

993
00:42:12,680 --> 00:42:15,049
through me and then anytime they go to

994
00:42:15,049 --> 00:42:16,999
access a resource I can pop up a

995
00:42:16,999 --> 00:42:19,759
password box and make them put in a

996
00:42:19,759 --> 00:42:23,269
password you can definitely take out a

997
00:42:23,269 --> 00:42:24,859
network with that configuration though

998
00:42:24,859 --> 00:42:27,049
so be careful with that one and then

999
00:42:27,049 --> 00:42:28,640
there's always good old-fashioned art

1000
00:42:28,640 --> 00:42:31,210
poisoning to get in between hosts and

1001
00:42:31,210 --> 00:42:36,469
force traffic through so Active

1002
00:42:36,469 --> 00:42:38,869
Directory misconfigurations there's a

1003
00:42:38,869 --> 00:42:41,059
ton of them we're gonna we're getting

1004
00:42:41,059 --> 00:42:42,650
low on time so I'm going to go through

1005
00:42:42,650 --> 00:42:45,859
this a little quickly so these are the

1006
00:42:45,859 --> 00:42:47,599
top tools that I'm using what I'm

1007
00:42:47,599 --> 00:42:48,890
evaluating someone's Active Directory

1008
00:42:48,890 --> 00:42:52,239
configuration bloodhound is amazing it's

1009
00:42:52,239 --> 00:42:54,769
probably the greatest defenders tool

1010
00:42:54,769 --> 00:42:57,890
that I only know of attackers using I

1011
00:42:57,890 --> 00:42:59,239
know very few defenders that are

1012
00:42:59,239 --> 00:43:02,269
actually using it but if I went into an

1013
00:43:02,269 --> 00:43:04,640
organization and they had run bloodhound

1014
00:43:04,640 --> 00:43:07,390
and trimmed out all of the ability to

1015
00:43:07,390 --> 00:43:10,729
get their domain admins like I would run

1016
00:43:10,729 --> 00:43:11,809
it and just be like what is going on

1017
00:43:11,809 --> 00:43:14,950
here I have been in an environment that

1018
00:43:14,950 --> 00:43:17,719
Microsoft themselves configured and it

1019
00:43:17,719 --> 00:43:19,369
was an absolute nightmare it was just

1020
00:43:19,369 --> 00:43:21,140
like there's no way to actually move

1021
00:43:21,140 --> 00:43:23,359
around in here because funny enough

1022
00:43:23,359 --> 00:43:24,920
Microsoft knows how to configure Active

1023
00:43:24,920 --> 00:43:29,539
Directory but it costs a pretty penny so

1024
00:43:29,539 --> 00:43:32,630
one of the big issues is users with

1025
00:43:32,630 --> 00:43:34,579
local administrator privileges

1026
00:43:34,579 --> 00:43:36,910
I've seen this went to an organization

1027
00:43:36,910 --> 00:43:40,400
giant financial organization and every

1028
00:43:40,400 --> 00:43:42,559
single user in there was a local admin I

1029
00:43:42,559 --> 00:43:43,759
was like what are you guys doing right

1030
00:43:43,759 --> 00:43:45,380
now and the security people were like

1031
00:43:45,380 --> 00:43:46,760
no but there's nothing we can do about

1032
00:43:46,760 --> 00:43:49,550
it because the users go to their

1033
00:43:49,550 --> 00:43:52,070
management and go I bring in 8 billion

1034
00:43:52,070 --> 00:43:54,740
dollars a quarter and I want to install

1035
00:43:54,740 --> 00:43:56,840
Spotify so give me my local admin access

1036
00:43:56,840 --> 00:43:58,850
and the manager says he brings in 8

1037
00:43:58,850 --> 00:44:00,980
million baby'll 8 billion yep

1038
00:44:00,980 --> 00:44:03,110
give him Spotify let's do it but there's

1039
00:44:03,110 --> 00:44:04,910
no reason that you don't just include

1040
00:44:04,910 --> 00:44:08,120
Spotify on your base image so that

1041
00:44:08,120 --> 00:44:09,650
everyone has it and then they don't need

1042
00:44:09,650 --> 00:44:11,900
to be a local administrator so a lot of

1043
00:44:11,900 --> 00:44:14,360
the reasons for people being local

1044
00:44:14,360 --> 00:44:15,860
administrator is just because you

1045
00:44:15,860 --> 00:44:17,690
haven't found the problem that they're

1046
00:44:17,690 --> 00:44:19,520
there they need local administrator

1047
00:44:19,520 --> 00:44:22,040
access to solve so figure out why they

1048
00:44:22,040 --> 00:44:27,950
need it and then get rid of it the same

1049
00:44:27,950 --> 00:44:29,660
local administrator account across

1050
00:44:29,660 --> 00:44:32,150
organizations you see this usually it's

1051
00:44:32,150 --> 00:44:34,100
split in two so there's one local

1052
00:44:34,100 --> 00:44:35,390
administrator account for servers

1053
00:44:35,390 --> 00:44:36,740
because they're all deployed from one

1054
00:44:36,740 --> 00:44:38,990
base image of a server operating system

1055
00:44:38,990 --> 00:44:41,420
and there's one local administrator

1056
00:44:41,420 --> 00:44:43,160
account across all user workstations

1057
00:44:43,160 --> 00:44:44,870
because they're using that same image

1058
00:44:44,870 --> 00:44:48,290
everywhere when this happens this is

1059
00:44:48,290 --> 00:44:50,900
where ransomware runs wild because as

1060
00:44:50,900 --> 00:44:54,020
soon as it gets a local administrator on

1061
00:44:54,020 --> 00:44:57,020
one box it's able to dump hashes or dump

1062
00:44:57,020 --> 00:44:59,150
clear tax credentials using mini cats or

1063
00:44:59,150 --> 00:45:02,420
any tool has the ability to dump hashes

1064
00:45:02,420 --> 00:45:04,670
like with Metasploit I use cobalt strike

1065
00:45:04,670 --> 00:45:07,070
all the time and once you get that hash

1066
00:45:07,070 --> 00:45:10,490
you can then use pass the hash to just

1067
00:45:10,490 --> 00:45:13,310
send that everywhere and you have system

1068
00:45:13,310 --> 00:45:16,280
level access on every box and ransomware

1069
00:45:16,280 --> 00:45:17,960
would definitely have a good time with

1070
00:45:17,960 --> 00:45:24,800
that so stopping lateral movement so

1071
00:45:24,800 --> 00:45:27,740
both of those issues enable attackers to

1072
00:45:27,740 --> 00:45:28,970
move laterally within the network

1073
00:45:28,970 --> 00:45:31,970
Microsoft has a tool called laps and

1074
00:45:31,970 --> 00:45:35,120
what it does is it sets a randomized

1075
00:45:35,120 --> 00:45:36,920
local administrator password and then

1076
00:45:36,920 --> 00:45:38,570
stores it within Active Directory

1077
00:45:38,570 --> 00:45:40,850
so that you can lock down who has rights

1078
00:45:40,850 --> 00:45:44,060
to access that password so you can give

1079
00:45:44,060 --> 00:45:45,650
the helpdesk local administrator

1080
00:45:45,650 --> 00:45:46,910
passwords if you have some reason to

1081
00:45:46,910 --> 00:45:48,260
give the loop and the helpdesk that

1082
00:45:48,260 --> 00:45:50,810
access but the nice thing is that it's

1083
00:45:50,810 --> 00:45:53,690
randomized and it can update on its own

1084
00:45:53,690 --> 00:45:56,150
and change the password often so that it

1085
00:45:56,150 --> 00:45:58,630
keeps rotating

1086
00:45:58,630 --> 00:46:01,060
disable remote local admin access

1087
00:46:01,060 --> 00:46:03,530
there's a lot of organizations that are

1088
00:46:03,530 --> 00:46:05,720
running it it's like why do you even

1089
00:46:05,720 --> 00:46:07,940
need remote local administrator access

1090
00:46:07,940 --> 00:46:10,190
there's no reason because everyone's

1091
00:46:10,190 --> 00:46:11,780
within one building if they have a

1092
00:46:11,780 --> 00:46:13,460
problem you just walk to their computer

1093
00:46:13,460 --> 00:46:15,680
and log in you don't need to be able to

1094
00:46:15,680 --> 00:46:17,240
enable someone to do it over the network

1095
00:46:17,240 --> 00:46:22,369
and then I've not been on a network that

1096
00:46:22,369 --> 00:46:23,720
I can think of where they actually

1097
00:46:23,720 --> 00:46:25,640
enabled the Windows Firewall but it's a

1098
00:46:25,640 --> 00:46:27,200
great way to stop people from moving

1099
00:46:27,200 --> 00:46:30,650
around users don't need to talk to other

1100
00:46:30,650 --> 00:46:33,410
users users need to talk to servers and

1101
00:46:33,410 --> 00:46:35,000
users need to talk to the Internet

1102
00:46:35,000 --> 00:46:37,880
sometimes but they don't have any reason

1103
00:46:37,880 --> 00:46:40,550
to talk to each other and so you

1104
00:46:40,550 --> 00:46:43,010
shouldn't have workstation one

1105
00:46:43,010 --> 00:46:44,660
connecting to an SMB share on

1106
00:46:44,660 --> 00:46:46,760
workstation to the SMB share should be

1107
00:46:46,760 --> 00:46:49,369
on your file server not on their system

1108
00:46:49,369 --> 00:46:51,770
so if you actually turn on the Windows

1109
00:46:51,770 --> 00:46:53,359
Firewall block users from talking to

1110
00:46:53,359 --> 00:46:56,780
each other correction I said I never saw

1111
00:46:56,780 --> 00:46:58,730
I saw it one time and I am now

1112
00:46:58,730 --> 00:47:00,290
remembering how much I hated it because

1113
00:47:00,290 --> 00:47:02,960
it was just like I can't move like fish

1114
00:47:02,960 --> 00:47:05,180
the user on the box and can't go

1115
00:47:05,180 --> 00:47:07,099
anywhere so you we were just locked in

1116
00:47:07,099 --> 00:47:10,970
place at that point there's a couple

1117
00:47:10,970 --> 00:47:13,250
other issues to look for in Active

1118
00:47:13,250 --> 00:47:13,700
Directory

1119
00:47:13,700 --> 00:47:16,640
so trusts are a big one I've seen

1120
00:47:16,640 --> 00:47:18,710
organizations mergers and acquisitions

1121
00:47:18,710 --> 00:47:20,750
create Active Directory nightmares

1122
00:47:20,750 --> 00:47:22,700
because what they do is they just they

1123
00:47:22,700 --> 00:47:24,230
take that other organization and they

1124
00:47:24,230 --> 00:47:26,180
just create a trust and just merge them

1125
00:47:26,180 --> 00:47:27,770
together and they're like all right good

1126
00:47:27,770 --> 00:47:31,450
to go and so you're inheriting any

1127
00:47:31,450 --> 00:47:33,920
attacker that's inside that network is

1128
00:47:33,920 --> 00:47:35,359
now inside your network that you've just

1129
00:47:35,359 --> 00:47:38,510
merged with and it becomes a nightmare

1130
00:47:38,510 --> 00:47:41,170
of actually figuring out who's where and

1131
00:47:41,170 --> 00:47:43,550
what the users are logged in where when

1132
00:47:43,550 --> 00:47:45,560
you run bloodhound you can actually map

1133
00:47:45,560 --> 00:47:47,210
the trust and you can get some really

1134
00:47:47,210 --> 00:47:48,260
interesting Maps with large

1135
00:47:48,260 --> 00:47:51,859
organizations and you can look for users

1136
00:47:51,859 --> 00:47:54,140
who are in foreign groups that are

1137
00:47:54,140 --> 00:47:55,730
logged into the network that you're

1138
00:47:55,730 --> 00:47:57,589
currently in which can create some

1139
00:47:57,589 --> 00:47:59,000
interesting things as well where you're

1140
00:47:59,000 --> 00:48:00,560
like wait where's this person coming

1141
00:48:00,560 --> 00:48:04,700
from DC sync and DC shadow so with me me

1142
00:48:04,700 --> 00:48:08,540
cats you can basically pretend to be a

1143
00:48:08,540 --> 00:48:10,369
domain controller and then ask the

1144
00:48:10,369 --> 00:48:11,750
domain controller for pass

1145
00:48:11,750 --> 00:48:14,690
hashes so as soon as we get like domain

1146
00:48:14,690 --> 00:48:17,000
admin we will DC sync a bunch of other

1147
00:48:17,000 --> 00:48:19,070
domain admins the enterprise admin just

1148
00:48:19,070 --> 00:48:21,110
to make sure we have access that's gonna

1149
00:48:21,110 --> 00:48:23,710
last for the entirety of the engagement

1150
00:48:23,710 --> 00:48:25,760
password policies as I was talking about

1151
00:48:25,760 --> 00:48:28,820
earlier organizations still have really

1152
00:48:28,820 --> 00:48:30,830
bad password policies if your password

1153
00:48:30,830 --> 00:48:32,990
is under 12 characters it's probably not

1154
00:48:32,990 --> 00:48:35,870
a good password complexity doesn't

1155
00:48:35,870 --> 00:48:36,320
matter

1156
00:48:36,320 --> 00:48:38,680
the latest guidance has proof said that

1157
00:48:38,680 --> 00:48:41,000
complexity is not important length is

1158
00:48:41,000 --> 00:48:43,970
important so the longer password you can

1159
00:48:43,970 --> 00:48:46,010
create the better if you have a legacy

1160
00:48:46,010 --> 00:48:47,120
environment you're gonna run into

1161
00:48:47,120 --> 00:48:54,050
problems if you use the Azure ad you can

1162
00:48:54,050 --> 00:48:56,660
create a 255 character password if

1163
00:48:56,660 --> 00:48:59,360
you're using Active Directory odds are

1164
00:48:59,360 --> 00:49:00,590
you can only have a 16 character

1165
00:49:00,590 --> 00:49:02,930
password because if you have legacy

1166
00:49:02,930 --> 00:49:04,820
systems they can't handle anything

1167
00:49:04,820 --> 00:49:07,760
longer than that my wife at her previous

1168
00:49:07,760 --> 00:49:10,100
job she actually set a secure password

1169
00:49:10,100 --> 00:49:12,350
because of being married to me and

1170
00:49:12,350 --> 00:49:14,630
security finally filtered down through

1171
00:49:14,630 --> 00:49:16,670
all my communication she set a super

1172
00:49:16,670 --> 00:49:19,610
secure password and completely destroyed

1173
00:49:19,610 --> 00:49:20,990
her account because the system couldn't

1174
00:49:20,990 --> 00:49:23,090
handle it and it truncated it and it

1175
00:49:23,090 --> 00:49:24,830
didn't even just truncate the end off it

1176
00:49:24,830 --> 00:49:26,690
truncated it some other way so that they

1177
00:49:26,690 --> 00:49:29,930
couldn't recover the password so gotta

1178
00:49:29,930 --> 00:49:31,490
look out for legacy systems that don't

1179
00:49:31,490 --> 00:49:34,010
support that type of author attend

1180
00:49:34,010 --> 00:49:38,600
ocation so key takeaways so security is

1181
00:49:38,600 --> 00:49:41,120
hard it's not simple we can't just flip

1182
00:49:41,120 --> 00:49:43,010
a light switch and say this network is

1183
00:49:43,010 --> 00:49:44,860
secure we're good to go

1184
00:49:44,860 --> 00:49:47,720
businesses don't care about security

1185
00:49:47,720 --> 00:49:49,340
because security doesn't make money

1186
00:49:49,340 --> 00:49:52,160
security costs money the key there's a

1187
00:49:52,160 --> 00:49:53,930
handful of security businesses the

1188
00:49:53,930 --> 00:49:55,550
security IPO market this year has been

1189
00:49:55,550 --> 00:49:57,980
very hot so there are businesses making

1190
00:49:57,980 --> 00:50:01,100
money on security but the majority of

1191
00:50:01,100 --> 00:50:04,160
businesses have another industry there

1192
00:50:04,160 --> 00:50:06,230
in outside of security they make cars

1193
00:50:06,230 --> 00:50:09,200
they make services anything like that

1194
00:50:09,200 --> 00:50:12,860
and the key with security is to just

1195
00:50:12,860 --> 00:50:14,330
keep moving forward too many

1196
00:50:14,330 --> 00:50:16,130
organizations and people just give up

1197
00:50:16,130 --> 00:50:18,260
they're like we're never gonna be secure

1198
00:50:18,260 --> 00:50:20,480
so why bother but you can move forward a

1199
00:50:20,480 --> 00:50:22,730
little bit every day make a couple small

1200
00:50:22,730 --> 00:50:24,800
changes and slowly work your way up

1201
00:50:24,800 --> 00:50:27,800
being a more secure organization who

1202
00:50:27,800 --> 00:50:29,900
wants a job who wants to be a pen tester

1203
00:50:29,900 --> 00:50:33,200
because I'm hiring so if you want to

1204
00:50:33,200 --> 00:50:35,090
talk to me in the vendor area I'll talk

1205
00:50:35,090 --> 00:50:36,170
to you in the vendor area no matter what

1206
00:50:36,170 --> 00:50:38,420
but if you want a job definitely talk to

1207
00:50:38,420 --> 00:50:41,030
me in the vendor area because we are

1208
00:50:41,030 --> 00:50:44,420
hiring at sei for penetration testers

1209
00:50:44,420 --> 00:50:46,460
especially if you want to do pen testing

1210
00:50:46,460 --> 00:50:47,990
and you have some developer experience

1211
00:50:47,990 --> 00:50:50,420
because we're also doing a lot of

1212
00:50:50,420 --> 00:50:52,250
development now and have some

1213
00:50:52,250 --> 00:50:53,630
interesting things we're working on and

1214
00:50:53,630 --> 00:50:55,550
would love to talk with you about that

1215
00:50:55,550 --> 00:50:59,300
I like to talk about security in general

1216
00:50:59,300 --> 00:51:00,410
so if you just want to talk about

1217
00:51:00,410 --> 00:51:04,370
security go ahead and reach out to me on

1218
00:51:04,370 --> 00:51:06,920
any of these social media and whatnots

1219
00:51:06,920 --> 00:51:11,800
and last but not least hack the planet

1220
00:51:11,800 --> 00:51:13,650
thank you

1221
00:51:13,650 --> 00:51:21,489
[Applause]

