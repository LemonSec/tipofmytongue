1
00:00:04,300 --> 00:00:06,700
all right we're gonna go ahead and get

2
00:00:06,700 --> 00:00:07,689
started

3
00:00:07,689 --> 00:00:10,389
so I'd like to introduce Greg Longo and

4
00:00:10,389 --> 00:00:13,840
Bryan Gardiner Greg is a senior threat

5
00:00:13,840 --> 00:00:18,670
analyst on the jasc special ops team

6
00:00:18,670 --> 00:00:20,830
with over a decade of cyber security

7
00:00:20,830 --> 00:00:22,810
experience in both the public and

8
00:00:22,810 --> 00:00:24,790
private sectors

9
00:00:24,790 --> 00:00:28,539
prior to joining jasc Greg was the

10
00:00:28,539 --> 00:00:30,400
global threat management lead at cabeza

11
00:00:30,400 --> 00:00:32,469
Rho and held a number of technical

12
00:00:32,469 --> 00:00:37,020
positions at cert pardon me one second

13
00:00:40,410 --> 00:00:46,450
sorry about that so where was I held a

14
00:00:46,450 --> 00:00:48,010
member or a number of technical

15
00:00:48,010 --> 00:00:50,710
positions at cert part of the software

16
00:00:50,710 --> 00:00:52,829
engineering Institute at Carnegie Mellon

17
00:00:52,829 --> 00:00:55,809
Greg has also been with US Air Force and

18
00:00:55,809 --> 00:00:58,120
National Guard since 2002 as a

19
00:00:58,120 --> 00:01:01,630
cyberspace operations officer and is

20
00:01:01,630 --> 00:01:04,709
currently the commander of the 166th

21
00:01:04,709 --> 00:01:08,499
communications flight along the way Greg

22
00:01:08,499 --> 00:01:10,749
has earned a Masters of Science degree

23
00:01:10,749 --> 00:01:12,670
from Carnegie Mellon along with a

24
00:01:12,670 --> 00:01:14,889
Bachelor of business administration from

25
00:01:14,889 --> 00:01:16,929
the University of Pittsburgh and a

26
00:01:16,929 --> 00:01:18,520
Master of Business Administration degree

27
00:01:18,520 --> 00:01:21,359
or degree from Wright State University

28
00:01:21,359 --> 00:01:23,709
Bryan has been a senior threat analyst

29
00:01:23,709 --> 00:01:26,979
on the jester special ops team Bryan has

30
00:01:26,979 --> 00:01:28,719
over eight years of experience in cyber

31
00:01:28,719 --> 00:01:31,179
security with previous positions which

32
00:01:31,179 --> 00:01:34,090
include vulnerability analyst and

33
00:01:34,090 --> 00:01:36,999
security engineer across both public and

34
00:01:36,999 --> 00:01:39,609
private sectors prior to Jeschke Bryan

35
00:01:39,609 --> 00:01:42,369
worked as a senior Incident Response

36
00:01:42,369 --> 00:01:47,319
analyst with IBM x-force iris Aetna and

37
00:01:47,319 --> 00:01:50,380
her as the information security adviser

38
00:01:50,380 --> 00:01:53,219
of the security data analytics team

39
00:01:53,219 --> 00:01:57,130
Bryan earned a Bachelors of Arts degree

40
00:01:57,130 --> 00:01:58,929
from the University of Pittsburgh and

41
00:01:58,929 --> 00:02:00,909
Master of Science degree from Carnegie

42
00:02:00,909 --> 00:02:03,909
Mellon University so with that being

43
00:02:03,909 --> 00:02:05,409
said I'll go ahead and turn it over to

44
00:02:05,409 --> 00:02:09,989
you guys and yeah let's rock and roll

45
00:02:09,989 --> 00:02:12,780
okay thank you anybody hear us okay

46
00:02:12,780 --> 00:02:16,270
excellent so thank you for Zach thank

47
00:02:16,270 --> 00:02:17,140
for having us out

48
00:02:17,140 --> 00:02:18,220
thank your buddy for showing up to this

49
00:02:18,220 --> 00:02:20,620
talk thread hunting out of the gate with

50
00:02:20,620 --> 00:02:22,720
Windows logs not a super creative title

51
00:02:22,720 --> 00:02:24,760
but I think you get the gist I know

52
00:02:24,760 --> 00:02:25,990
we're getting you right after lunch so

53
00:02:25,990 --> 00:02:28,270
the food comas gonna set in folks might

54
00:02:28,270 --> 00:02:29,740
be a couple beers in couple drinks in

55
00:02:29,740 --> 00:02:32,320
but appreciate you hanging with us we'll

56
00:02:32,320 --> 00:02:33,580
get through some early introductory

57
00:02:33,580 --> 00:02:35,320
material and then we'll really dig in

58
00:02:35,320 --> 00:02:38,640
some meat of the presentation here today

59
00:02:38,640 --> 00:02:42,040
so as Zack mentioned Brian and I both

60
00:02:42,040 --> 00:02:46,360
have spent some time in industry and as

61
00:02:46,360 --> 00:02:49,000
well as sort of the academia FFRDC land

62
00:02:49,000 --> 00:02:52,600
with CMU and the cert program so that

63
00:02:52,600 --> 00:02:54,910
means we know probably you know 50% of

64
00:02:54,910 --> 00:02:56,620
the people out here we've got some

65
00:02:56,620 --> 00:02:59,170
relationship with everybody but yeah

66
00:02:59,170 --> 00:03:02,380
we're excited to be here so you may be

67
00:03:02,380 --> 00:03:04,060
sitting there wondering why am I here

68
00:03:04,060 --> 00:03:06,340
how many folks real quick this is the

69
00:03:06,340 --> 00:03:08,490
only audience participation I'll ask for

70
00:03:08,490 --> 00:03:11,440
have active threat hunting programs

71
00:03:11,440 --> 00:03:15,700
within your organization's okay how many

72
00:03:15,700 --> 00:03:16,870
of you guys that are not doing

73
00:03:16,870 --> 00:03:18,040
throughout hunting have at least heard

74
00:03:18,040 --> 00:03:19,480
of threat hunting or understand the

75
00:03:19,480 --> 00:03:21,430
general concept of threat hunting good

76
00:03:21,430 --> 00:03:23,590
okay so for the most part pretty much

77
00:03:23,590 --> 00:03:27,010
everybody this is really meant to be an

78
00:03:27,010 --> 00:03:28,780
introductory talk so I want to make sure

79
00:03:28,780 --> 00:03:31,090
we set the stage for that right we're

80
00:03:31,090 --> 00:03:32,500
gonna get into some details about what

81
00:03:32,500 --> 00:03:33,700
you can do with Windows logs and things

82
00:03:33,700 --> 00:03:35,650
like that but we're really gonna start

83
00:03:35,650 --> 00:03:36,880
the very beginning laid a foundation

84
00:03:36,880 --> 00:03:39,430
talk about what threat hunting is why

85
00:03:39,430 --> 00:03:41,620
it's really a thing for organizations

86
00:03:41,620 --> 00:03:45,640
these days and then explain to folks how

87
00:03:45,640 --> 00:03:47,200
you can get started with minimal effort

88
00:03:47,200 --> 00:03:50,260
really using Windows logs which I'm

89
00:03:50,260 --> 00:03:52,240
guessing 99.9% of the folks out there

90
00:03:52,240 --> 00:03:53,590
have Windows logs in your environment

91
00:03:53,590 --> 00:03:55,060
you're probably already collecting those

92
00:03:55,060 --> 00:03:58,090
logs how do you make use of those in a

93
00:03:58,090 --> 00:04:02,650
threat hunting kind of capacity quick

94
00:04:02,650 --> 00:04:05,740
roadmap of where we're gonna go so we'll

95
00:04:05,740 --> 00:04:07,540
talk a little bit about you know again

96
00:04:07,540 --> 00:04:09,700
what is threat hunting why is it

97
00:04:09,700 --> 00:04:12,310
important why is it a thing what are the

98
00:04:12,310 --> 00:04:13,180
things you need to consider when you're

99
00:04:13,180 --> 00:04:14,709
building a threat hunting program how do

100
00:04:14,709 --> 00:04:16,209
you get started and then we'll really

101
00:04:16,209 --> 00:04:17,680
dive into the data Brian's going to go

102
00:04:17,680 --> 00:04:18,269
through

103
00:04:18,269 --> 00:04:22,199
a whole bunch of Windows logs that and a

104
00:04:22,199 --> 00:04:23,520
couple use cases that'll be really

105
00:04:23,520 --> 00:04:25,860
interesting there's a lot of graphics on

106
00:04:25,860 --> 00:04:28,590
the slides but hopefully these become

107
00:04:28,590 --> 00:04:30,030
available to folks afterwards and then

108
00:04:30,030 --> 00:04:31,470
you can reference those when you're back

109
00:04:31,470 --> 00:04:36,930
at your your organization's so before we

110
00:04:36,930 --> 00:04:38,490
get into what what thread hunting

111
00:04:38,490 --> 00:04:39,900
actually is and how you're gonna get

112
00:04:39,900 --> 00:04:41,639
started let's talk a little bit about

113
00:04:41,639 --> 00:04:45,720
like why thread hunting what why did

114
00:04:45,720 --> 00:04:48,419
this discipline come about what were the

115
00:04:48,419 --> 00:04:50,610
the revelations and the recognition that

116
00:04:50,610 --> 00:04:53,010
really drove this this new kind of thing

117
00:04:53,010 --> 00:04:55,949
in our in our field right and a lot of

118
00:04:55,949 --> 00:04:58,130
that comes back to the realization that

119
00:04:58,130 --> 00:05:00,419
the adversaries that we're up against

120
00:05:00,419 --> 00:05:03,210
are becoming increasingly advanced and

121
00:05:03,210 --> 00:05:06,539
sophisticated in what they're doing that

122
00:05:06,539 --> 00:05:08,880
our technology landscape is constantly

123
00:05:08,880 --> 00:05:11,070
evolving and what that means is that as

124
00:05:11,070 --> 00:05:13,289
we adopt new technology our attack

125
00:05:13,289 --> 00:05:15,630
surface is constantly expanding and

126
00:05:15,630 --> 00:05:17,669
we're always playing catch-up there it

127
00:05:17,669 --> 00:05:19,590
is an arms race between the defenders

128
00:05:19,590 --> 00:05:23,130
and the the adversaries but you know the

129
00:05:23,130 --> 00:05:24,539
cards aren't completely stacked against

130
00:05:24,539 --> 00:05:29,460
us as defenders and we'll explain why so

131
00:05:29,460 --> 00:05:31,470
this should resonate with most folks

132
00:05:31,470 --> 00:05:33,630
right there's you know out there new

133
00:05:33,630 --> 00:05:35,039
organizations I'm sure you've got some

134
00:05:35,039 --> 00:05:38,010
constellation of security controls those

135
00:05:38,010 --> 00:05:39,990
controls could be administrative or

136
00:05:39,990 --> 00:05:42,000
operational kinds of controls controls

137
00:05:42,000 --> 00:05:44,550
that are really driven by humans in the

138
00:05:44,550 --> 00:05:46,650
loop so think of your policies and your

139
00:05:46,650 --> 00:05:48,630
procedures and your separation of duties

140
00:05:48,630 --> 00:05:50,340
and and those kinds of things

141
00:05:50,340 --> 00:05:53,310
you also have technical controls so you

142
00:05:53,310 --> 00:05:55,560
know your firewall rules your proxy

143
00:05:55,560 --> 00:05:57,690
rules your ACLs two-factor

144
00:05:57,690 --> 00:05:58,949
authentication all these kinds of

145
00:05:58,949 --> 00:06:01,020
technical controls that are in place and

146
00:06:01,020 --> 00:06:02,490
those controls whether they're

147
00:06:02,490 --> 00:06:04,550
Administrative operational technical

148
00:06:04,550 --> 00:06:07,440
they exist on the spectrum of your

149
00:06:07,440 --> 00:06:10,320
endpoints and your network right so you

150
00:06:10,320 --> 00:06:11,970
put all these things these these things

151
00:06:11,970 --> 00:06:13,410
together and this is what you use to

152
00:06:13,410 --> 00:06:18,270
protect your organization's but the

153
00:06:18,270 --> 00:06:20,010
adversaries follow this notion of the

154
00:06:20,010 --> 00:06:21,210
cyber kill chain that lockheed-martin

155
00:06:21,210 --> 00:06:24,180
coined in 2011 everyone aware of the

156
00:06:24,180 --> 00:06:25,550
cyber kill chain

157
00:06:25,550 --> 00:06:28,280
pretty common right and so you've got

158
00:06:28,280 --> 00:06:30,229
these controls that are in place and I

159
00:06:30,229 --> 00:06:31,669
call those exploitable gaps because

160
00:06:31,669 --> 00:06:32,750
that's what the adversary is going to be

161
00:06:32,750 --> 00:06:35,720
targeting but these are the these are

162
00:06:35,720 --> 00:06:37,400
all the opportunities that the adversary

163
00:06:37,400 --> 00:06:40,550
has to define a hole in one of those

164
00:06:40,550 --> 00:06:42,229
those controls that you've put in place

165
00:06:42,229 --> 00:06:44,210
and at every stage along the kill chain

166
00:06:44,210 --> 00:06:45,590
that we have here whether it's recon

167
00:06:45,590 --> 00:06:47,960
weaponization delivery exploitation all

168
00:06:47,960 --> 00:06:50,210
along the line you're gonna have

169
00:06:50,210 --> 00:06:51,470
controls in place and there's gonna be

170
00:06:51,470 --> 00:06:52,970
opportunities for adversaries to

171
00:06:52,970 --> 00:06:54,530
discover vulnerabilities there and

172
00:06:54,530 --> 00:06:56,539
exploit those vulnerabilities right

173
00:06:56,539 --> 00:06:58,159
whether it's recon and you've got

174
00:06:58,159 --> 00:06:59,360
employees who are posting too much

175
00:06:59,360 --> 00:07:02,720
information on LinkedIn weaponization if

176
00:07:02,720 --> 00:07:03,919
they're grabbing stuff from your web

177
00:07:03,919 --> 00:07:05,419
sites and they're weaponizing PDF

178
00:07:05,419 --> 00:07:07,159
documents that you may be hosting out

179
00:07:07,159 --> 00:07:08,750
there are things like that there's all

180
00:07:08,750 --> 00:07:10,310
kinds of opportunities for the adversary

181
00:07:10,310 --> 00:07:11,720
to take advantage of the information

182
00:07:11,720 --> 00:07:16,069
that we have out there so Security's not

183
00:07:16,069 --> 00:07:18,560
a zero-sum game it's an overused analogy

184
00:07:18,560 --> 00:07:20,150
you may have used it yourself but the

185
00:07:20,150 --> 00:07:22,960
idea of defending a castle right

186
00:07:22,960 --> 00:07:26,449
defenders you know we operate sometimes

187
00:07:26,449 --> 00:07:30,110
within some artificially constrained

188
00:07:30,110 --> 00:07:32,870
bounds and I mentioned that you know the

189
00:07:32,870 --> 00:07:34,190
cards aren't completely stacked against

190
00:07:34,190 --> 00:07:35,990
us you know you hear the phrase or the

191
00:07:35,990 --> 00:07:38,539
saying that yeah as defenders we've got

192
00:07:38,539 --> 00:07:40,130
a tough job we got to defend this entire

193
00:07:40,130 --> 00:07:42,380
you know cyber key terrain that we have

194
00:07:42,380 --> 00:07:44,060
right we've got all these systems that

195
00:07:44,060 --> 00:07:45,469
we're trying to keep track of inventory

196
00:07:45,469 --> 00:07:47,270
that we can't wrap our arms around IT

197
00:07:47,270 --> 00:07:49,729
networks ot networks things like that

198
00:07:49,729 --> 00:07:51,949
and the adversary just needs to find one

199
00:07:51,949 --> 00:07:53,779
way to get in right and that's all they

200
00:07:53,779 --> 00:07:55,159
just need find one exploit that works

201
00:07:55,159 --> 00:07:56,419
and they're in meanwhile we've got

202
00:07:56,419 --> 00:07:58,759
defend all this stuff that's not exactly

203
00:07:58,759 --> 00:08:01,159
true right because as defenders we

204
00:08:01,159 --> 00:08:02,690
should have the upper hand and knowing

205
00:08:02,690 --> 00:08:03,979
our environment right

206
00:08:03,979 --> 00:08:06,830
i I do lista CLE we should understand

207
00:08:06,830 --> 00:08:09,229
what we have what's vulnerable what we

208
00:08:09,229 --> 00:08:10,880
need to protect how to protect it and

209
00:08:10,880 --> 00:08:12,979
the adversary yes they do need to find

210
00:08:12,979 --> 00:08:15,259
an exploit but they also need to put all

211
00:08:15,259 --> 00:08:17,630
the pieces together to get that exploit

212
00:08:17,630 --> 00:08:19,460
into your environment and to maintain

213
00:08:19,460 --> 00:08:21,710
some some form of stealth in order to

214
00:08:21,710 --> 00:08:23,120
carry out whatever it is they want to do

215
00:08:23,120 --> 00:08:24,800
right so they've got a pretty

216
00:08:24,800 --> 00:08:26,719
challenging job ahead of them too and as

217
00:08:26,719 --> 00:08:29,000
defenders we need to detect one thing

218
00:08:29,000 --> 00:08:30,919
along those lines right we need to we

219
00:08:30,919 --> 00:08:32,809
need to find the spear phishing email

220
00:08:32,809 --> 00:08:34,549
right or the piece of malware that's

221
00:08:34,549 --> 00:08:36,740
that's beaconing out 4c2 right or

222
00:08:36,740 --> 00:08:37,789
something

223
00:08:37,789 --> 00:08:39,409
and we're onto that adversary and then

224
00:08:39,409 --> 00:08:40,820
it becomes an IR engagement and an

225
00:08:40,820 --> 00:08:43,580
investigation from that point on so I

226
00:08:43,580 --> 00:08:45,080
wouldn't say that the card is a

227
00:08:45,080 --> 00:08:47,720
completely stacked against us it's it is

228
00:08:47,720 --> 00:08:50,510
a back and forth but you know as

229
00:08:50,510 --> 00:08:53,020
defenders we're not completely hamstrung

230
00:08:53,020 --> 00:08:55,700
so you know we put all the controls in

231
00:08:55,700 --> 00:08:58,940
place but when an attacker breaches your

232
00:08:58,940 --> 00:09:01,850
network the fundamental thing is your

233
00:09:01,850 --> 00:09:03,440
your controls have failed somewhere

234
00:09:03,440 --> 00:09:04,070
right

235
00:09:04,070 --> 00:09:05,540
you've got preventative controls that

236
00:09:05,540 --> 00:09:08,300
are in place and again think of you know

237
00:09:08,300 --> 00:09:09,680
those those technologies that are out

238
00:09:09,680 --> 00:09:13,340
there to stop an attack or stop a breach

239
00:09:13,340 --> 00:09:15,170
from actually happening from getting in

240
00:09:15,170 --> 00:09:17,780
the front door your email filters and

241
00:09:17,780 --> 00:09:19,190
your firewall rules and all those sorts

242
00:09:19,190 --> 00:09:20,390
of things right those are supposed to

243
00:09:20,390 --> 00:09:23,330
stop the adversary at the front door and

244
00:09:23,330 --> 00:09:26,030
then you've got detective controls you

245
00:09:26,030 --> 00:09:28,370
know so you're running a sim right and

246
00:09:28,370 --> 00:09:30,290
you've got other technology that should

247
00:09:30,290 --> 00:09:32,990
alert you when something does get in and

248
00:09:32,990 --> 00:09:36,740
fires off so an attacker gets in these

249
00:09:36,740 --> 00:09:38,330
controls have failed somewhere along the

250
00:09:38,330 --> 00:09:43,160
line the punchline to all of this is

251
00:09:43,160 --> 00:09:45,260
right that your controls will eventually

252
00:09:45,260 --> 00:09:46,730
fail right that's that's the environment

253
00:09:46,730 --> 00:09:48,260
that we're in now we're in this sort of

254
00:09:48,260 --> 00:09:50,870
realm of assumed breach kind of kind of

255
00:09:50,870 --> 00:09:53,840
world again which is sort of where we're

256
00:09:53,840 --> 00:09:55,400
threatening threat hunting kind of came

257
00:09:55,400 --> 00:09:58,610
from but your your your your controls

258
00:09:58,610 --> 00:10:00,470
will likely fail attackers will get in

259
00:10:00,470 --> 00:10:02,330
and apply stay there right average 12

260
00:10:02,330 --> 00:10:04,850
time for an attacker used to be in the

261
00:10:04,850 --> 00:10:08,360
mid 200 plus days I just read a recent

262
00:10:08,360 --> 00:10:09,770
report that that was down to just over a

263
00:10:09,770 --> 00:10:12,470
hundred days so good on us we're

264
00:10:12,470 --> 00:10:13,640
detecting the adversary a lot quicker

265
00:10:13,640 --> 00:10:15,890
but still that's you know over three

266
00:10:15,890 --> 00:10:17,660
months of an adversary in your network

267
00:10:17,660 --> 00:10:19,760
which gives them plenty of time to

268
00:10:19,760 --> 00:10:22,210
orient themselves to move laterally to

269
00:10:22,210 --> 00:10:25,700
move from you know their beachhead to a

270
00:10:25,700 --> 00:10:27,200
complete foothold to something else in

271
00:10:27,200 --> 00:10:29,270
your environment to do recon and get

272
00:10:29,270 --> 00:10:31,700
what they need so you know over 100 days

273
00:10:31,700 --> 00:10:33,620
is still a significant of all time that

274
00:10:33,620 --> 00:10:38,030
we're up against so now--so threat

275
00:10:38,030 --> 00:10:40,280
hunting you know again a lot of you guys

276
00:10:40,280 --> 00:10:41,810
are doing it pretty much everyone has

277
00:10:41,810 --> 00:10:45,260
heard of it it came about I'll you know

278
00:10:45,260 --> 00:10:48,710
a while ago over a decade ago or so and

279
00:10:48,710 --> 00:10:50,330
it's really started to pick up here in

280
00:10:50,330 --> 00:10:53,000
the last number of years so when we talk

281
00:10:53,000 --> 00:10:53,930
about threat hunting what are we

282
00:10:53,930 --> 00:10:56,150
actually talking about when folks get

283
00:10:56,150 --> 00:10:57,860
into it and you know we can think of

284
00:10:57,860 --> 00:11:02,120
endor hype for a lot of this is you know

285
00:11:02,120 --> 00:11:03,740
you've got a list of IP addresses or

286
00:11:03,740 --> 00:11:05,720
you've got a list of hashes and you

287
00:11:05,720 --> 00:11:07,340
start searching all your logs for that

288
00:11:07,340 --> 00:11:09,310
information for those indicators right

289
00:11:09,310 --> 00:11:12,610
indicator searching or indicator hunting

290
00:11:12,610 --> 00:11:14,600
it's not exactly what we're talking

291
00:11:14,600 --> 00:11:16,400
about when we talk about hunting threat

292
00:11:16,400 --> 00:11:18,200
hunting but it is an easy place to get

293
00:11:18,200 --> 00:11:18,770
started

294
00:11:18,770 --> 00:11:20,180
so we don't want to folks get confused

295
00:11:20,180 --> 00:11:21,980
and think okay so when I'm talking about

296
00:11:21,980 --> 00:11:23,780
hunting I'm talking about a malicious IP

297
00:11:23,780 --> 00:11:25,490
or a hash that now I just go off and

298
00:11:25,490 --> 00:11:27,020
search for in my environment we're

299
00:11:27,020 --> 00:11:28,610
looking for really more of detecting the

300
00:11:28,610 --> 00:11:30,800
adversaries behavior in our environment

301
00:11:30,800 --> 00:11:33,200
and not so much these these atomic

302
00:11:33,200 --> 00:11:36,890
indicator type things so as I mentioned

303
00:11:36,890 --> 00:11:39,920
you know the first reference that that

304
00:11:39,920 --> 00:11:41,450
you can find on the Internet tracing

305
00:11:41,450 --> 00:11:43,970
back threat hunting back in 2009

306
00:11:43,970 --> 00:11:46,610
you know the cyber

307
00:11:46,610 --> 00:11:48,470
defensive community for sure has really

308
00:11:48,470 --> 00:11:49,850
gained a lot from what's come out of the

309
00:11:49,850 --> 00:11:53,120
the DoD in the military some some

310
00:11:53,120 --> 00:11:55,340
friends at NSA in the vulnerability

311
00:11:55,340 --> 00:11:56,720
analysis and operations branch

312
00:11:56,720 --> 00:11:58,370
published this slide during a Red Team

313
00:11:58,370 --> 00:12:00,470
Blue Team presentation and this was sort

314
00:12:00,470 --> 00:12:02,090
of the first indication of this concept

315
00:12:02,090 --> 00:12:05,420
of hunt right and the idea of actively

316
00:12:05,420 --> 00:12:07,730
going out and searching for adversaries

317
00:12:07,730 --> 00:12:09,920
within your network so you know just a

318
00:12:09,920 --> 00:12:12,830
little tidbit interesting reading so

319
00:12:12,830 --> 00:12:14,810
what is hunting when we talk about it

320
00:12:14,810 --> 00:12:16,940
threat hunting is merely a means by

321
00:12:16,940 --> 00:12:19,040
which you as an analyst will

322
00:12:19,040 --> 00:12:21,980
deliberately and proactively go out to

323
00:12:21,980 --> 00:12:26,590
search for the presence of compromised

324
00:12:26,590 --> 00:12:28,910
malicious activity suspicious activity

325
00:12:28,910 --> 00:12:29,990
something that you don't want in your

326
00:12:29,990 --> 00:12:33,410
environment that's been missed by your

327
00:12:33,410 --> 00:12:36,410
existing security controls the easiest

328
00:12:36,410 --> 00:12:38,330
way to to think think of threat hunting

329
00:12:38,330 --> 00:12:40,340
in my mind is as sort of a form of

330
00:12:40,340 --> 00:12:44,300
proactive I are really you know you're

331
00:12:44,300 --> 00:12:45,740
taking it upon yourself to go off and

332
00:12:45,740 --> 00:12:47,900
find this this adversary that you're

333
00:12:47,900 --> 00:12:50,600
presuming is already in your network

334
00:12:50,600 --> 00:12:52,490
and is and it's taken a foothold and

335
00:12:52,490 --> 00:12:54,980
then it's retrospective obviously so you

336
00:12:54,980 --> 00:12:56,690
know you're not gonna go back over you

337
00:12:56,690 --> 00:12:58,370
know a year's worth of time likely but

338
00:12:58,370 --> 00:13:00,380
within the last 30 days or 45 days to

339
00:13:00,380 --> 00:13:02,420
look for a specific kind of behavior

340
00:13:02,420 --> 00:13:05,150
that you know the adversary exhibits is

341
00:13:05,150 --> 00:13:06,290
what we mean we talk about threat

342
00:13:06,290 --> 00:13:10,990
hunting so threat hunting is a

343
00:13:10,990 --> 00:13:15,590
hypothesis oriented process driven kind

344
00:13:15,590 --> 00:13:17,780
of activity what we've laid out is just

345
00:13:17,780 --> 00:13:19,970
five notional steps to the threat

346
00:13:19,970 --> 00:13:22,340
hunting process so starting out with a

347
00:13:22,340 --> 00:13:23,960
hypothesis something something that you

348
00:13:23,960 --> 00:13:25,700
want to find that's really the crux of

349
00:13:25,700 --> 00:13:27,590
threat hunting you've got an ID in mind

350
00:13:27,590 --> 00:13:29,390
this is what I'm gonna go search for and

351
00:13:29,390 --> 00:13:31,400
when I go off and look for that then you

352
00:13:31,400 --> 00:13:33,110
need to decide well based on what it is

353
00:13:33,110 --> 00:13:34,820
I want to look for what data do I need

354
00:13:34,820 --> 00:13:37,070
do I have that data how do I collect

355
00:13:37,070 --> 00:13:39,320
that data so you go through this sort of

356
00:13:39,320 --> 00:13:42,380
data analysis kind of phase then once

357
00:13:42,380 --> 00:13:43,370
you go off and you collect all those

358
00:13:43,370 --> 00:13:45,920
those pieces of data you're doing a

359
00:13:45,920 --> 00:13:48,170
validation of your hypothesis did I find

360
00:13:48,170 --> 00:13:50,420
the threat that I was looking for if not

361
00:13:50,420 --> 00:13:52,670
why not do they not exist or did I not

362
00:13:52,670 --> 00:13:53,960
look in the right place and it's sort of

363
00:13:53,960 --> 00:13:55,340
an iterative process we would continue

364
00:13:55,340 --> 00:13:56,720
to cycle back and make sure that you're

365
00:13:56,720 --> 00:13:58,580
looking at everything that you need to

366
00:13:58,580 --> 00:14:00,710
be looking at and then you'll always

367
00:14:00,710 --> 00:14:02,660
want to be improving upon that process

368
00:14:02,660 --> 00:14:07,340
so find ways to not conduct manual hunts

369
00:14:07,340 --> 00:14:10,070
over and over but can you automate can

370
00:14:10,070 --> 00:14:11,660
you improve upon what you're doing and

371
00:14:11,660 --> 00:14:13,160
finally you want to make sure that

372
00:14:13,160 --> 00:14:15,080
whatever it is that you have done

373
00:14:15,080 --> 00:14:16,670
through your head you're hunting

374
00:14:16,670 --> 00:14:18,680
engagement your hunting operation you

375
00:14:18,680 --> 00:14:20,930
have documented in some way some wiki or

376
00:14:20,930 --> 00:14:23,030
something so that you're able to retain

377
00:14:23,030 --> 00:14:24,590
that knowledge go back to it reference

378
00:14:24,590 --> 00:14:26,900
it in the future and build upon this

379
00:14:26,900 --> 00:14:28,670
sort of knowledge base that you've

380
00:14:28,670 --> 00:14:30,890
gained through hunting operations so how

381
00:14:30,890 --> 00:14:32,360
do you establish the hypothesis where we

382
00:14:32,360 --> 00:14:35,540
start miters done a tremendous amount of

383
00:14:35,540 --> 00:14:38,600
work in mapping attacker TTP's so the

384
00:14:38,600 --> 00:14:40,130
mitre attack framework is an awesome

385
00:14:40,130 --> 00:14:43,580
place to start a good reference for how

386
00:14:43,580 --> 00:14:45,530
adversaries have been known to operate

387
00:14:45,530 --> 00:14:48,290
environments their tactics their tools

388
00:14:48,290 --> 00:14:50,090
their techniques you know everything

389
00:14:50,090 --> 00:14:51,950
that they're doing this is an awesome

390
00:14:51,950 --> 00:14:54,240
reference

391
00:14:54,240 --> 00:14:56,620
but hunting is not an exact science and

392
00:14:56,620 --> 00:14:57,610
there's a lot of different approaches

393
00:14:57,610 --> 00:15:00,250
right so you could take the approach I

394
00:15:00,250 --> 00:15:02,920
know that I have windows logs so what

395
00:15:02,920 --> 00:15:04,540
can I find in Windows logs

396
00:15:04,540 --> 00:15:06,280
okay that's sort of more of a data

397
00:15:06,280 --> 00:15:07,840
centric or a data driven kind of

398
00:15:07,840 --> 00:15:09,280
approach right you've got a certain

399
00:15:09,280 --> 00:15:10,750
piece of data what can you find in that

400
00:15:10,750 --> 00:15:12,460
data or you can take another approach

401
00:15:12,460 --> 00:15:14,110
where you say I understand this

402
00:15:14,110 --> 00:15:15,850
particular adversary or I read a threat

403
00:15:15,850 --> 00:15:17,440
report and I know that they exhibit this

404
00:15:17,440 --> 00:15:19,120
kind of behavior so then you say well

405
00:15:19,120 --> 00:15:20,710
how do I detect that behavior and what

406
00:15:20,710 --> 00:15:22,270
logs do I need what logs do I need to go

407
00:15:22,270 --> 00:15:24,850
get and that's sort of a more of a

408
00:15:24,850 --> 00:15:27,460
threat Intel driven kind of approach

409
00:15:27,460 --> 00:15:29,200
right so you can look at it from a

410
00:15:29,200 --> 00:15:31,000
couple different perspectives what we're

411
00:15:31,000 --> 00:15:32,560
gonna talk about here or what we propose

412
00:15:32,560 --> 00:15:34,690
here is that most everybody has Windows

413
00:15:34,690 --> 00:15:37,300
logs so we're gonna do a combination of

414
00:15:37,300 --> 00:15:38,620
let's take those windows logs that we

415
00:15:38,620 --> 00:15:40,090
know you have that we know you can

416
00:15:40,090 --> 00:15:41,670
collect that we know you can go through

417
00:15:41,670 --> 00:15:43,960
let's map that against what we know

418
00:15:43,960 --> 00:15:46,090
about some adversaries like say you know

419
00:15:46,090 --> 00:15:48,280
schedule tasks as a persistence

420
00:15:48,280 --> 00:15:51,700
mechanism right pretty common so let's

421
00:15:51,700 --> 00:15:53,110
go through our windows logs and look for

422
00:15:53,110 --> 00:15:55,000
scheduled tasks right pretty low hanging

423
00:15:55,000 --> 00:15:56,980
fruit see what we can identify see if

424
00:15:56,980 --> 00:15:59,080
there's anything odd that stands out so

425
00:15:59,080 --> 00:16:00,550
that's a great place to start in this a

426
00:16:00,550 --> 00:16:01,810
lot of what Brian is gonna be talking

427
00:16:01,810 --> 00:16:09,250
through and so building a plan so once

428
00:16:09,250 --> 00:16:10,810
you've got all this stuff in mind then

429
00:16:10,810 --> 00:16:13,120
you need to build a plan right again

430
00:16:13,120 --> 00:16:14,680
going back to understanding the

431
00:16:14,680 --> 00:16:17,380
adversary understanding what data you

432
00:16:17,380 --> 00:16:19,150
have or can get access to whether it's

433
00:16:19,150 --> 00:16:20,680
from the endpoint whether it's from the

434
00:16:20,680 --> 00:16:22,480
network are there things that you can

435
00:16:22,480 --> 00:16:24,640
only detect on an endpoint what kind of

436
00:16:24,640 --> 00:16:25,990
adversary activity is gonna generate

437
00:16:25,990 --> 00:16:28,030
Network artifacts that you can then pull

438
00:16:28,030 --> 00:16:30,700
right and again what do you have what do

439
00:16:30,700 --> 00:16:32,770
you need to get you go through your hunt

440
00:16:32,770 --> 00:16:34,570
you do your investigation you do various

441
00:16:34,570 --> 00:16:37,360
kinds of analytics on that data you've

442
00:16:37,360 --> 00:16:39,250
got to do your interpretation of what it

443
00:16:39,250 --> 00:16:40,600
means right it's not always gonna be

444
00:16:40,600 --> 00:16:43,660
black and white cut and dry you're gonna

445
00:16:43,660 --> 00:16:45,580
have to interpret what you get back and

446
00:16:45,580 --> 00:16:47,410
whether or not that means something to

447
00:16:47,410 --> 00:16:49,270
you and your organization again kind of

448
00:16:49,270 --> 00:16:50,470
goes back to the idea that we as

449
00:16:50,470 --> 00:16:52,660
defenders do have the upper hand and

450
00:16:52,660 --> 00:16:54,250
that we have the best context of our

451
00:16:54,250 --> 00:16:55,960
environment right there's going to be

452
00:16:55,960 --> 00:16:57,550
some expert

453
00:16:57,550 --> 00:16:59,350
analysis or interpretation that you do

454
00:16:59,350 --> 00:17:01,120
with the data based on what you know the

455
00:17:01,120 --> 00:17:03,250
environment you may see things like

456
00:17:03,250 --> 00:17:05,170
TeamViewer in your environment right or

457
00:17:05,170 --> 00:17:07,960
remote access tools that might be

458
00:17:07,960 --> 00:17:09,280
suspicious it might be completely

459
00:17:09,280 --> 00:17:11,440
legitimate in another organization right

460
00:17:11,440 --> 00:17:13,599
so there's no blanket you know one size

461
00:17:13,599 --> 00:17:15,720
fits all if you find this this is bad

462
00:17:15,720 --> 00:17:18,220
but it becomes an iterative process that

463
00:17:18,220 --> 00:17:19,569
you learn more about your environment as

464
00:17:19,569 --> 00:17:20,680
you go through it and again the

465
00:17:20,680 --> 00:17:23,470
documentation of course so I'm gonna

466
00:17:23,470 --> 00:17:24,730
pass it over to Brian Brian's gonna talk

467
00:17:24,730 --> 00:17:26,560
to some windows logs and some some

468
00:17:26,560 --> 00:17:30,880
interesting use cases all right is

469
00:17:30,880 --> 00:17:31,960
everyone still awake

470
00:17:31,960 --> 00:17:33,910
good and Ear okay cuz I'm about to put

471
00:17:33,910 --> 00:17:37,540
you to sleep um so I'm just kidding

472
00:17:37,540 --> 00:17:40,690
data is awesome I've worked in a variety

473
00:17:40,690 --> 00:17:42,460
of different roles throughout my years

474
00:17:42,460 --> 00:17:44,290
here and really what you can get from

475
00:17:44,290 --> 00:17:45,910
that is a different perspective and

476
00:17:45,910 --> 00:17:48,340
thread hunting whether you're a sysadmin

477
00:17:48,340 --> 00:17:51,190
and you can only get Windows logs or you

478
00:17:51,190 --> 00:17:52,750
know whether you've got a full data Lake

479
00:17:52,750 --> 00:17:54,460
whole Hadoop stack and you're logging

480
00:17:54,460 --> 00:17:56,260
absolutely everything in here in that

481
00:17:56,260 --> 00:17:58,480
connected fridge you can really break

482
00:17:58,480 --> 00:18:00,280
down sort of where you want to be with

483
00:18:00,280 --> 00:18:01,660
your threat hunting you don't have to

484
00:18:01,660 --> 00:18:04,060
have all Network data all logging

485
00:18:04,060 --> 00:18:06,070
everything it can be very specific to

486
00:18:06,070 --> 00:18:07,390
your role at your company or the

487
00:18:07,390 --> 00:18:09,610
maturity of your company it just depends

488
00:18:09,610 --> 00:18:13,060
really what you have to work with so

489
00:18:13,060 --> 00:18:14,620
we're gonna talk about a couple of

490
00:18:14,620 --> 00:18:16,990
campaigns really quickly and then we'll

491
00:18:16,990 --> 00:18:18,820
dive into a bunch of the data that we

492
00:18:18,820 --> 00:18:22,450
need to do this stuff so Turla this

493
00:18:22,450 --> 00:18:25,330
one's awesome pretty much the reason I

494
00:18:25,330 --> 00:18:26,890
put this on here you can see it like

495
00:18:26,890 --> 00:18:28,270
they've done a lot of stuff with the

496
00:18:28,270 --> 00:18:29,860
military a lot of stuff with government

497
00:18:29,860 --> 00:18:31,720
entities but they've been switching

498
00:18:31,720 --> 00:18:34,090
recently to a lot of PowerShell based

499
00:18:34,090 --> 00:18:36,490
activity and this is absolutely nothing

500
00:18:36,490 --> 00:18:38,250
new everyone knows about PowerShell

501
00:18:38,250 --> 00:18:40,660
although I was blown away though that

502
00:18:40,660 --> 00:18:43,300
they are actually using the profile to

503
00:18:43,300 --> 00:18:45,520
maintain persistence I don't think I've

504
00:18:45,520 --> 00:18:46,540
seen that before

505
00:18:46,540 --> 00:18:48,700
but it's a really interesting technique

506
00:18:48,700 --> 00:18:51,280
of course their payload too is power

507
00:18:51,280 --> 00:18:53,860
Stallion and there's a really good

508
00:18:53,860 --> 00:18:55,750
article on this that you can read

509
00:18:55,750 --> 00:18:57,130
they'll give you a lot of the i/o sees

510
00:18:57,130 --> 00:18:58,510
you can really like dig into this

511
00:18:58,510 --> 00:18:59,980
tooling and kind of see what's occurring

512
00:18:59,980 --> 00:19:02,440
with that but the interesting point here

513
00:19:02,440 --> 00:19:04,660
is when you start to look at like these

514
00:19:04,660 --> 00:19:06,250
thread actors or these campaigns and

515
00:19:06,250 --> 00:19:07,480
sort of like the tooling that they're

516
00:19:07,480 --> 00:19:09,880
utilizing a lot of them have been go

517
00:19:09,880 --> 00:19:11,590
more and more and more open source like

518
00:19:11,590 --> 00:19:13,300
you're not seeing as much custom stuff

519
00:19:13,300 --> 00:19:15,220
you may from a couple of adversaries but

520
00:19:15,220 --> 00:19:17,200
a lot of this stuff is you can just go

521
00:19:17,200 --> 00:19:19,240
to github and pull it down and do work

522
00:19:19,240 --> 00:19:21,310
with that like it's pretty impressive

523
00:19:21,310 --> 00:19:24,970
and then this campaign Frankenstein this

524
00:19:24,970 --> 00:19:27,370
is my absolute favorite I think it's the

525
00:19:27,370 --> 00:19:29,050
funniest name in the world like I just

526
00:19:29,050 --> 00:19:30,700
imagined some like stock guy running

527
00:19:30,700 --> 00:19:32,740
into management being like oh my god

528
00:19:32,740 --> 00:19:34,240
we've been breached by Frankenstein in

529
00:19:34,240 --> 00:19:35,410
the management being like dude are you

530
00:19:35,410 --> 00:19:36,790
serious like is that Mary Shelley

531
00:19:36,790 --> 00:19:38,260
Frankenstein or what are you talking

532
00:19:38,260 --> 00:19:40,420
about I just think it's hilarious but

533
00:19:40,420 --> 00:19:41,980
one of the things that's really

534
00:19:41,980 --> 00:19:44,800
interesting about this group is that

535
00:19:44,800 --> 00:19:46,480
they've completely abandoned their own

536
00:19:46,480 --> 00:19:48,280
tooling they are going to get hub

537
00:19:48,280 --> 00:19:49,720
pulling down what everyone has already

538
00:19:49,720 --> 00:19:51,040
done they're taking that information

539
00:19:51,040 --> 00:19:53,110
tweaking it a little bit and utilizing

540
00:19:53,110 --> 00:19:54,700
that so like when you start talking

541
00:19:54,700 --> 00:19:57,250
about attribution like primarily one of

542
00:19:57,250 --> 00:19:58,510
the best ways you can do this to a

543
00:19:58,510 --> 00:20:00,640
threat group is you take apart the code

544
00:20:00,640 --> 00:20:01,780
of the tooling that they're utilizing

545
00:20:01,780 --> 00:20:03,970
and that's how you identify them so what

546
00:20:03,970 --> 00:20:05,020
are we going to say now like

547
00:20:05,020 --> 00:20:06,970
attributions harm joy it was defended

548
00:20:06,970 --> 00:20:08,800
like Empire like it's not gonna fly

549
00:20:08,800 --> 00:20:11,020
anymore so it's gonna start becoming a

550
00:20:11,020 --> 00:20:12,730
lot more interesting when you start to

551
00:20:12,730 --> 00:20:14,170
play the attribution game with some of

552
00:20:14,170 --> 00:20:16,570
this stuff and then all these tools to

553
00:20:16,570 --> 00:20:18,250
you can just go immediately like fruity

554
00:20:18,250 --> 00:20:20,530
c2 Empire they're out there you can

555
00:20:20,530 --> 00:20:22,750
start working with them and then the

556
00:20:22,750 --> 00:20:25,210
persistence mechanism here as well so

557
00:20:25,210 --> 00:20:27,160
they're utilizing win update so it's one

558
00:20:27,160 --> 00:20:28,510
of the scheduled tasks that they use

559
00:20:28,510 --> 00:20:30,300
this is really interesting as well

560
00:20:30,300 --> 00:20:32,350
nothing new something that's definitely

561
00:20:32,350 --> 00:20:34,240
out there but I just thought that this

562
00:20:34,240 --> 00:20:36,190
campaign was extremely interesting

563
00:20:36,190 --> 00:20:37,570
because they've actually broken away

564
00:20:37,570 --> 00:20:39,280
from custom tooling and they're just

565
00:20:39,280 --> 00:20:41,830
utilizing open source tools that are out

566
00:20:41,830 --> 00:20:43,410
there

567
00:20:43,410 --> 00:20:46,930
alright so now down to it required log

568
00:20:46,930 --> 00:20:48,970
sources almost everyone in here I'm

569
00:20:48,970 --> 00:20:52,210
assuming is a window shop so you have

570
00:20:52,210 --> 00:20:53,860
your default logging this is stuff that

571
00:20:53,860 --> 00:20:55,780
is turned on by default you have it

572
00:20:55,780 --> 00:20:57,760
everyone sees it everyone looks at it

573
00:20:57,760 --> 00:20:59,770
there's a ton of information within

574
00:20:59,770 --> 00:21:02,170
there I'm not gonna lie you can do a lot

575
00:21:02,170 --> 00:21:03,610
of stuff with that you detect lateral

576
00:21:03,610 --> 00:21:05,470
movement account creation etc there's a

577
00:21:05,470 --> 00:21:07,510
lot you can do with that what I'm more

578
00:21:07,510 --> 00:21:09,820
interested in is the actual advanced

579
00:21:09,820 --> 00:21:12,670
auditing and then the reason for this is

580
00:21:12,670 --> 00:21:16,720
a lot of this comes from probably doing

581
00:21:16,720 --> 00:21:19,390
IR for the past year and a half and my

582
00:21:19,390 --> 00:21:21,059
current position and just working

583
00:21:21,059 --> 00:21:22,409
companies and seeing sort of what

584
00:21:22,409 --> 00:21:24,679
they're doing I can think of one case

585
00:21:24,679 --> 00:21:27,389
where one company actually had these

586
00:21:27,389 --> 00:21:29,909
logs um just about every other company

587
00:21:29,909 --> 00:21:32,009
that I worked with didn't have any of

588
00:21:32,009 --> 00:21:34,470
this I know you're kind of probably

589
00:21:34,470 --> 00:21:36,389
thinking like well isn't there an EDR

590
00:21:36,389 --> 00:21:38,700
that picks up all this stuff there's a

591
00:21:38,700 --> 00:21:41,070
few out there that do but you still need

592
00:21:41,070 --> 00:21:42,509
this logging in your own environment

593
00:21:42,509 --> 00:21:44,269
there's a lot that you can do with this

594
00:21:44,269 --> 00:21:46,559
so the reasons for this advanced

595
00:21:46,559 --> 00:21:49,710
auditing it's really it's you know file

596
00:21:49,710 --> 00:21:52,399
this attacks PowerShell is everywhere

597
00:21:52,399 --> 00:21:54,029
living off the land

598
00:21:54,029 --> 00:21:56,549
persistence detection all of that stuff

599
00:21:56,549 --> 00:21:58,499
can be done with these logging sources

600
00:21:58,499 --> 00:21:59,490
implemented you don't need a

601
00:21:59,490 --> 00:22:01,289
million-dollar tool in your environment

602
00:22:01,289 --> 00:22:03,600
you have the tooling in there you just

603
00:22:03,600 --> 00:22:06,240
need a GPO change to set this up get the

604
00:22:06,240 --> 00:22:08,450
information flowing and I know -

605
00:22:08,450 --> 00:22:10,619
everyone's like oh man it's this month's

606
00:22:10,619 --> 00:22:11,999
like the hottest thing in the world it's

607
00:22:11,999 --> 00:22:14,610
sweet I love it but to be honest with

608
00:22:14,610 --> 00:22:16,080
you from what I've seen with this and

609
00:22:16,080 --> 00:22:17,720
the customers that have implemented it

610
00:22:17,720 --> 00:22:20,100
99% of them have just gone Swift

611
00:22:20,100 --> 00:22:22,230
security pull down do it no one looks at

612
00:22:22,230 --> 00:22:23,730
the configuration file no one

613
00:22:23,730 --> 00:22:25,379
understands that you know he just

614
00:22:25,379 --> 00:22:27,659
updated that but it's been a year how do

615
00:22:27,659 --> 00:22:29,100
you know he didn't leave something out

616
00:22:29,100 --> 00:22:31,080
that's able to get into your environment

617
00:22:31,080 --> 00:22:32,909
how is he understanding your environment

618
00:22:32,909 --> 00:22:34,919
better than you guys are so through

619
00:22:34,919 --> 00:22:36,899
doing this advanced logging there's a

620
00:22:36,899 --> 00:22:38,399
ton you can do this you can start

621
00:22:38,399 --> 00:22:40,049
building out the whitelist that you need

622
00:22:40,049 --> 00:22:42,240
to put into that configuration file for

623
00:22:42,240 --> 00:22:44,369
sis Mon so it's a really good beginner

624
00:22:44,369 --> 00:22:46,559
stuff to start there once you have this

625
00:22:46,559 --> 00:22:48,059
down you understand what's occurring in

626
00:22:48,059 --> 00:22:49,919
your environment then move to sis Mon

627
00:22:49,919 --> 00:22:51,690
then get the extra log and get all the

628
00:22:51,690 --> 00:22:53,190
additional functionality that you want

629
00:22:53,190 --> 00:22:55,379
once you understand you know where you

630
00:22:55,379 --> 00:22:59,340
live all right this is guaranteed

631
00:22:59,340 --> 00:23:01,049
I know people ask us all the freakin

632
00:23:01,049 --> 00:23:04,110
time volumes because data is expensive

633
00:23:04,110 --> 00:23:06,360
depending on how you have it so this is

634
00:23:06,360 --> 00:23:09,869
just baseline one month thousand

635
00:23:09,869 --> 00:23:11,639
machines solid Windows Enterprise

636
00:23:11,639 --> 00:23:13,710
environment this is kind of the numbers

637
00:23:13,710 --> 00:23:15,869
that you're looking at so four six eight

638
00:23:15,869 --> 00:23:18,299
eight process creation that's the

639
00:23:18,299 --> 00:23:21,419
biggest one it's 147 million logs keep

640
00:23:21,419 --> 00:23:24,090
in mind here they have failure enabled

641
00:23:24,090 --> 00:23:26,820
as well as command line logging so you

642
00:23:26,820 --> 00:23:28,499
could cut failure out of this you could

643
00:23:28,499 --> 00:23:31,169
reduce the volume you can get rid of

644
00:23:31,169 --> 00:23:33,890
4103 module logging for power

645
00:23:33,890 --> 00:23:35,960
and just utilized script lock logging

646
00:23:35,960 --> 00:23:37,490
there's ways around this you can play

647
00:23:37,490 --> 00:23:39,710
with this stuff but this is just kind of

648
00:23:39,710 --> 00:23:41,030
an understanding I just want to show

649
00:23:41,030 --> 00:23:42,920
everyone that you know you can work kind

650
00:23:42,920 --> 00:23:44,390
of within your budget turn on what you

651
00:23:44,390 --> 00:23:47,150
need to maybe just deploy out to the

652
00:23:47,150 --> 00:23:49,250
machines you deem critical kind of see

653
00:23:49,250 --> 00:23:51,080
how the logging flows and then go from

654
00:23:51,080 --> 00:23:55,340
there all right so this is the biggest

655
00:23:55,340 --> 00:23:58,549
thing um I just I don't know why

656
00:23:58,549 --> 00:24:00,620
environments don't have this like real

657
00:24:00,620 --> 00:24:02,059
quick show of hands who's logging this

658
00:24:02,059 --> 00:24:04,130
right now and knows like in their

659
00:24:04,130 --> 00:24:05,780
environment okay

660
00:24:05,780 --> 00:24:09,980
yeah that's okay um if there's one thing

661
00:24:09,980 --> 00:24:11,570
from this talk like you take away today

662
00:24:11,570 --> 00:24:14,270
it's just go implement this like put

663
00:24:14,270 --> 00:24:16,309
this in your environment and the key

664
00:24:16,309 --> 00:24:18,590
with this is you have to enable command

665
00:24:18,590 --> 00:24:22,190
line process auditing this essentially

666
00:24:22,190 --> 00:24:24,260
gives you the command line that is run

667
00:24:24,260 --> 00:24:25,910
for just about anything in your

668
00:24:25,910 --> 00:24:28,010
environment so if you think of process

669
00:24:28,010 --> 00:24:29,840
creation this is taking the actual

670
00:24:29,840 --> 00:24:31,250
process that's occurring in the

671
00:24:31,250 --> 00:24:33,799
environment if you run a command it's

672
00:24:33,799 --> 00:24:36,980
parent processes command XE command

673
00:24:36,980 --> 00:24:38,780
lines logged you have all of that there

674
00:24:38,780 --> 00:24:40,640
it is so rich for hunting it's

675
00:24:40,640 --> 00:24:43,100
ridiculous and even just looking to see

676
00:24:43,100 --> 00:24:44,510
you know like what administrators are

677
00:24:44,510 --> 00:24:45,860
doing like what's occurring in the

678
00:24:45,860 --> 00:24:48,830
environment it is definitely the event

679
00:24:48,830 --> 00:24:50,690
ID to ensure that you have within your

680
00:24:50,690 --> 00:24:54,559
environment um so I did this for all of

681
00:24:54,559 --> 00:24:56,929
them we're gonna go through a couple of

682
00:24:56,929 --> 00:24:58,790
event IDs but I put this on here so when

683
00:24:58,790 --> 00:25:01,309
we share the slides you know exactly

684
00:25:01,309 --> 00:25:03,290
where to go how to set this up the

685
00:25:03,290 --> 00:25:04,730
screen shot that it looks like when I

686
00:25:04,730 --> 00:25:06,160
was searching for some of this stuff

687
00:25:06,160 --> 00:25:08,990
it's kind of difficult to find like a

688
00:25:08,990 --> 00:25:10,850
good resource that has all of this and I

689
00:25:10,850 --> 00:25:12,110
know everyone's like go to Microsoft

690
00:25:12,110 --> 00:25:14,270
site they don't have everything really

691
00:25:14,270 --> 00:25:16,640
well laid out for advanced auditing I'll

692
00:25:16,640 --> 00:25:18,559
be the first to admit that so this is

693
00:25:18,559 --> 00:25:19,910
just a way you can come back look at the

694
00:25:19,910 --> 00:25:21,679
slides and be like give it to like your

695
00:25:21,679 --> 00:25:23,960
systems administrators look at it be

696
00:25:23,960 --> 00:25:26,390
like hey we need this GPO put in this is

697
00:25:26,390 --> 00:25:27,080
where you do it

698
00:25:27,080 --> 00:25:30,080
um this is what it looks like when

699
00:25:30,080 --> 00:25:33,500
you're within group policy and then this

700
00:25:33,500 --> 00:25:35,049
is the actual configuration file for

701
00:25:35,049 --> 00:25:37,790
enabling process creation four six eight

702
00:25:37,790 --> 00:25:39,320
eight so this is where like I have

703
00:25:39,320 --> 00:25:40,970
success and failure checked if you were

704
00:25:40,970 --> 00:25:43,370
worried about log volume you don't check

705
00:25:43,370 --> 00:25:45,530
failure here just run success go from

706
00:25:45,530 --> 00:25:46,510
there

707
00:25:46,510 --> 00:25:49,340
this is the actual command line

708
00:25:49,340 --> 00:25:51,559
configuration this is the most important

709
00:25:51,559 --> 00:25:54,080
piece to enabling this so you have to

710
00:25:54,080 --> 00:25:58,220
have this configured all right and then

711
00:25:58,220 --> 00:26:00,470
what you can do with it so just like

712
00:26:00,470 --> 00:26:01,910
searching through logs you're gonna

713
00:26:01,910 --> 00:26:03,770
start to see I hope oh yeah you guys can

714
00:26:03,770 --> 00:26:06,440
see that sweet you're gonna start to see

715
00:26:06,440 --> 00:26:07,820
command lines that are like really

716
00:26:07,820 --> 00:26:10,340
ridiculously interesting when you start

717
00:26:10,340 --> 00:26:12,440
running stuff like whether you're doing

718
00:26:12,440 --> 00:26:14,179
this in a home lab or you're in your

719
00:26:14,179 --> 00:26:16,160
environment you can start correlating

720
00:26:16,160 --> 00:26:17,510
all of this data start looking through

721
00:26:17,510 --> 00:26:19,220
it and see I mean this is a no-brainer

722
00:26:19,220 --> 00:26:21,830
you can immediately see the huge blob of

723
00:26:21,830 --> 00:26:23,660
off you station you can see like the -

724
00:26:23,660 --> 00:26:24,260
Sta

725
00:26:24,260 --> 00:26:26,480
the W one it's definitely an empire

726
00:26:26,480 --> 00:26:29,809
stager the no op like this is the power

727
00:26:29,809 --> 00:26:31,190
that you can get from it so by looking

728
00:26:31,190 --> 00:26:32,990
at that process command line if you have

729
00:26:32,990 --> 00:26:35,690
not enabled that with this logging you

730
00:26:35,690 --> 00:26:37,970
will not see this so like the log loses

731
00:26:37,970 --> 00:26:39,710
a lot of value immediately that's why

732
00:26:39,710 --> 00:26:41,299
it's so critical that you actually

733
00:26:41,299 --> 00:26:45,100
enable that so here's another one

734
00:26:45,100 --> 00:26:47,750
another malicious PowerShell this one's

735
00:26:47,750 --> 00:26:50,660
utilizing a service creation and then

736
00:26:50,660 --> 00:26:52,820
it's pointing to command exe power

737
00:26:52,820 --> 00:26:55,520
shells downloading stage another stager

738
00:26:55,520 --> 00:26:57,799
from an external IP so you're gonna

739
00:26:57,799 --> 00:26:59,090
start to see these types of malicious

740
00:26:59,090 --> 00:27:00,799
commands in your environment this is

741
00:27:00,799 --> 00:27:01,970
stuff that like you wouldn't normally

742
00:27:01,970 --> 00:27:04,549
ever be able to find I'm depending on

743
00:27:04,549 --> 00:27:05,929
like the tooling and the controls that

744
00:27:05,929 --> 00:27:07,970
you have in place this is free this is

745
00:27:07,970 --> 00:27:09,980
in Microsoft you can turn this on and do

746
00:27:09,980 --> 00:27:12,070
this immediately

747
00:27:12,070 --> 00:27:16,340
alright my other favorite one so I know

748
00:27:16,340 --> 00:27:18,200
there's a talk earlier this morning the

749
00:27:18,200 --> 00:27:20,240
guy went over this pretty well it's it's

750
00:27:20,240 --> 00:27:22,640
awesome how many people that are in here

751
00:27:22,640 --> 00:27:25,340
like offensively utilize this technique

752
00:27:25,340 --> 00:27:27,380
can you like raise your hands like for

753
00:27:27,380 --> 00:27:30,200
pentesting red teaming anything alright

754
00:27:30,200 --> 00:27:31,910
no one wants to give that away okay I'm

755
00:27:31,910 --> 00:27:33,740
telling you right now as a blue team er

756
00:27:33,740 --> 00:27:36,799
um start looking for this because it's

757
00:27:36,799 --> 00:27:38,660
just insane what you can do with this

758
00:27:38,660 --> 00:27:41,600
technique so the breakdown to this is

759
00:27:41,600 --> 00:27:44,570
any single user can run this this isn't

760
00:27:44,570 --> 00:27:46,100
you don't have to be an administrator to

761
00:27:46,100 --> 00:27:48,380
type this command out and run this we

762
00:27:48,380 --> 00:27:51,559
find it all of the time a really good

763
00:27:51,559 --> 00:27:53,360
example of this one of the customers

764
00:27:53,360 --> 00:27:55,790
I worked with we turned on four six

765
00:27:55,790 --> 00:27:58,130
eight eight we turned on the process

766
00:27:58,130 --> 00:27:59,240
command line log

767
00:27:59,240 --> 00:28:02,299
and what popped up is you can see on the

768
00:28:02,299 --> 00:28:05,179
bottom there the register 32 Exe it's

769
00:28:05,179 --> 00:28:07,520
like the second command line to the

770
00:28:07,520 --> 00:28:08,000
server

771
00:28:08,000 --> 00:28:11,630
ser whatever dot are you so that had

772
00:28:11,630 --> 00:28:13,789
been running in their environment on 15

773
00:28:13,789 --> 00:28:16,250
machines for over a year unchecked they

774
00:28:16,250 --> 00:28:18,740
had no idea what that is is actually a

775
00:28:18,740 --> 00:28:21,559
piece of a remnant from the old

776
00:28:21,559 --> 00:28:24,950
Andromeda campaign from 2017 so the

777
00:28:24,950 --> 00:28:27,350
domain was definitely blown but it's one

778
00:28:27,350 --> 00:28:29,029
of those things that they had no idea

779
00:28:29,029 --> 00:28:31,039
and yes they had an EDR they had all

780
00:28:31,039 --> 00:28:33,110
kinds of stuff it didn't relate any of

781
00:28:33,110 --> 00:28:34,520
this information until we started

782
00:28:34,520 --> 00:28:36,289
digging through the logs so it's one of

783
00:28:36,289 --> 00:28:38,149
those things that you really really need

784
00:28:38,149 --> 00:28:40,700
to enable this event ID start taking a

785
00:28:40,700 --> 00:28:42,230
look at it start seeing what's occurring

786
00:28:42,230 --> 00:28:43,429
you're gonna start to see probably

787
00:28:43,429 --> 00:28:45,049
remnants in your environment from past

788
00:28:45,049 --> 00:28:47,270
campaigns that you just didn't have the

789
00:28:47,270 --> 00:28:48,799
controls or the tooling in place to

790
00:28:48,799 --> 00:28:52,730
notice and the carbon black article is

791
00:28:52,730 --> 00:28:54,230
amazing on that it's a little bit dated

792
00:28:54,230 --> 00:28:55,850
but this is still a use technique we

793
00:28:55,850 --> 00:28:58,149
still find it all the time

794
00:28:58,149 --> 00:29:00,919
all right so other interesting behavior

795
00:29:00,919 --> 00:29:03,710
that you can do with this event ID this

796
00:29:03,710 --> 00:29:05,330
is a huge one in sans like if you take

797
00:29:05,330 --> 00:29:07,549
in like a forensics course there it's

798
00:29:07,549 --> 00:29:09,559
pretty much you can look at the process

799
00:29:09,559 --> 00:29:11,750
launch location so when you think about

800
00:29:11,750 --> 00:29:13,429
like Windows system processes you think

801
00:29:13,429 --> 00:29:16,010
of like CSR SS like service host L SAS

802
00:29:16,010 --> 00:29:19,039
winning it there's tons but like a

803
00:29:19,039 --> 00:29:21,080
really good way to check this is if

804
00:29:21,080 --> 00:29:23,330
those aren't running from system 32

805
00:29:23,330 --> 00:29:25,700
you've got an issue like if that's

806
00:29:25,700 --> 00:29:27,740
running from like app data temp or

807
00:29:27,740 --> 00:29:29,539
something like that there's definitely

808
00:29:29,539 --> 00:29:31,399
something occurring so you can write

809
00:29:31,399 --> 00:29:33,380
rules based on this to look at

810
00:29:33,380 --> 00:29:35,480
non-standard launch path locations it's

811
00:29:35,480 --> 00:29:36,919
immediate win you can see what's

812
00:29:36,919 --> 00:29:39,230
occurring right there um some of the

813
00:29:39,230 --> 00:29:40,399
other stuff you can do you can just

814
00:29:40,399 --> 00:29:42,020
start searching for command lines like

815
00:29:42,020 --> 00:29:44,840
known things that adversaries use red

816
00:29:44,840 --> 00:29:46,730
team uses or just want to see what's

817
00:29:46,730 --> 00:29:48,260
occurring within your own environment on

818
00:29:48,260 --> 00:29:51,230
the human I like it's that's been used a

819
00:29:51,230 --> 00:29:53,480
billion times but it's still a giveaway

820
00:29:53,480 --> 00:29:55,340
because you know who you are on your

821
00:29:55,340 --> 00:29:56,899
system if that's running your

822
00:29:56,899 --> 00:29:58,610
environment chances are someone

823
00:29:58,610 --> 00:30:00,350
shouldn't be there

824
00:30:00,350 --> 00:30:02,750
netstat same thing looking for listening

825
00:30:02,750 --> 00:30:05,870
ports open ports etc and then you're

826
00:30:05,870 --> 00:30:08,000
going to see stuff like this like the

827
00:30:08,000 --> 00:30:10,429
net services piece schedule there's a

828
00:30:10,429 --> 00:30:12,240
lot of bushes

829
00:30:12,240 --> 00:30:13,530
main lines that are out there that do a

830
00:30:13,530 --> 00:30:15,360
lot of different things that are pretty

831
00:30:15,360 --> 00:30:17,700
bad turning off all the firewall

832
00:30:17,700 --> 00:30:20,490
profiles and then just the large chunks

833
00:30:20,490 --> 00:30:21,960
of obvious gated code you don't have to

834
00:30:21,960 --> 00:30:23,220
know what the command line does but

835
00:30:23,220 --> 00:30:24,510
there's probably no one in your

836
00:30:24,510 --> 00:30:26,040
environment that's gonna run off you

837
00:30:26,040 --> 00:30:28,260
skated code that would just be weird it

838
00:30:28,260 --> 00:30:32,670
just wouldn't make sense okay so next of

839
00:30:32,670 --> 00:30:34,920
an ID four six nine eight scheduled

840
00:30:34,920 --> 00:30:38,550
tasks not as important as process

841
00:30:38,550 --> 00:30:40,740
creation but this is a huge one I mean

842
00:30:40,740 --> 00:30:42,809
how many adversaries how many campaigns

843
00:30:42,809 --> 00:30:45,240
and groups are out there that utilize

844
00:30:45,240 --> 00:30:47,400
scheduled tasks as a persistence

845
00:30:47,400 --> 00:30:49,559
mechanism how do you guys monitor those

846
00:30:49,559 --> 00:30:50,910
what do you look at do you have

847
00:30:50,910 --> 00:30:52,770
something that says like hey this was

848
00:30:52,770 --> 00:30:55,020
created our environment this is legit or

849
00:30:55,020 --> 00:30:57,030
this isn't there's tons of these out

850
00:30:57,030 --> 00:30:59,610
there um when you also enable some of

851
00:30:59,610 --> 00:31:02,820
these advanced audit policy rules will

852
00:31:02,820 --> 00:31:05,400
also enable a bunch of other event IDs

853
00:31:05,400 --> 00:31:07,410
within this so like you might have like

854
00:31:07,410 --> 00:31:10,559
scheduled tasks updated deleted etc I'm

855
00:31:10,559 --> 00:31:11,910
just talking about like the main one for

856
00:31:11,910 --> 00:31:13,710
now there's still a lot of other stuff

857
00:31:13,710 --> 00:31:15,360
that you can do with the residual task

858
00:31:15,360 --> 00:31:19,520
or event IDs that are created as well

859
00:31:19,790 --> 00:31:22,020
okay this is the same so I'm just gonna

860
00:31:22,020 --> 00:31:23,700
skip through these like if you wanted to

861
00:31:23,700 --> 00:31:25,559
after you could find exactly how to set

862
00:31:25,559 --> 00:31:27,809
these up and configure them and utilize

863
00:31:27,809 --> 00:31:29,130
them and it's the same thing here as

864
00:31:29,130 --> 00:31:32,490
well log volume uncheck failure if you

865
00:31:32,490 --> 00:31:36,809
want to have a little bit less so just

866
00:31:36,809 --> 00:31:39,600
go into mitre looking at like the actual

867
00:31:39,600 --> 00:31:41,490
TTP's that are in there you can see all

868
00:31:41,490 --> 00:31:44,010
of these groups every single one of them

869
00:31:44,010 --> 00:31:46,170
uses scheduled tasks for persistence if

870
00:31:46,170 --> 00:31:48,210
you are not monitoring scheduled task

871
00:31:48,210 --> 00:31:50,429
creation you are probably missing a

872
00:31:50,429 --> 00:31:52,350
massive chunk of this within your

873
00:31:52,350 --> 00:31:57,380
environment ok so here's another issue

874
00:31:57,380 --> 00:31:59,940
from previously I've done this before

875
00:31:59,940 --> 00:32:01,710
where you start looking for scheduled

876
00:32:01,710 --> 00:32:03,210
tasks when you're trying to find

877
00:32:03,210 --> 00:32:05,850
persistence and you go to the users

878
00:32:05,850 --> 00:32:08,220
computer this one's clean it only has

879
00:32:08,220 --> 00:32:09,630
like probably like eight but I've seen

880
00:32:09,630 --> 00:32:11,250
people that have hundreds and you're

881
00:32:11,250 --> 00:32:13,380
like oh my god I can never ever figure

882
00:32:13,380 --> 00:32:16,350
out what each one of these does that's a

883
00:32:16,350 --> 00:32:18,420
sort of a benefit to doing this and

884
00:32:18,420 --> 00:32:20,550
enabling this is if you have a time

885
00:32:20,550 --> 00:32:22,590
frame from some other indicator that's

886
00:32:22,590 --> 00:32:24,179
fired in your environment you can go

887
00:32:24,179 --> 00:32:25,130
back and look

888
00:32:25,130 --> 00:32:27,050
at that time frame in the logs for this

889
00:32:27,050 --> 00:32:29,420
that would be one way to do it the other

890
00:32:29,420 --> 00:32:31,670
one you're gonna have to probably start

891
00:32:31,670 --> 00:32:33,890
googling a lot of stuff or praying that

892
00:32:33,890 --> 00:32:35,300
there's information within the schedule

893
00:32:35,300 --> 00:32:37,670
tasks that they filled out where you can

894
00:32:37,670 --> 00:32:39,440
get that information and understand

895
00:32:39,440 --> 00:32:41,500
actually what's occurring with that task

896
00:32:41,500 --> 00:32:43,880
easiest way to do it would be like to

897
00:32:43,880 --> 00:32:45,320
look at the naming convention and be

898
00:32:45,320 --> 00:32:47,090
like oh this one's garbled it's you know

899
00:32:47,090 --> 00:32:49,190
30 characters uppercase lowercase that's

900
00:32:49,190 --> 00:32:51,380
probably not legit there's actually

901
00:32:51,380 --> 00:32:53,630
companies that do that so you you really

902
00:32:53,630 --> 00:32:55,010
have to kind of google around a little

903
00:32:55,010 --> 00:33:00,230
bit to do that alright so fin 7 this is

904
00:33:00,230 --> 00:33:04,220
like just a current example one of the

905
00:33:04,220 --> 00:33:06,680
the persistence mechanisms that they

906
00:33:06,680 --> 00:33:08,360
utilize is they do a double schedule

907
00:33:08,360 --> 00:33:10,100
tasks or an lnk file when it's

908
00:33:10,100 --> 00:33:12,020
downloaded so the first one that you're

909
00:33:12,020 --> 00:33:13,670
gonna see is Intel and then the second

910
00:33:13,670 --> 00:33:14,630
one that's what I talked about it's that

911
00:33:14,630 --> 00:33:17,270
garble II like eat I think it's 12

912
00:33:17,270 --> 00:33:18,740
characters actually uppercase and

913
00:33:18,740 --> 00:33:21,770
lowercase no numbers but you'll start to

914
00:33:21,770 --> 00:33:24,050
see this stuff you can start taking a

915
00:33:24,050 --> 00:33:25,790
look at these and if you start logging

916
00:33:25,790 --> 00:33:27,650
this what you could do is you could just

917
00:33:27,650 --> 00:33:32,060
do like a weekly task to do like maybe a

918
00:33:32,060 --> 00:33:34,100
count or a sort depending on the tooling

919
00:33:34,100 --> 00:33:35,780
that you have in your environment just

920
00:33:35,780 --> 00:33:37,400
list them out start looking at it just

921
00:33:37,400 --> 00:33:38,990
maybe look at the user who created it

922
00:33:38,990 --> 00:33:40,910
look at the naming and go from there

923
00:33:40,910 --> 00:33:42,590
it's definitely something you should be

924
00:33:42,590 --> 00:33:44,660
monitoring and taking a much closer look

925
00:33:44,660 --> 00:33:48,560
at this is the same thing with

926
00:33:48,560 --> 00:33:50,780
Frankenstein as before they utilize win

927
00:33:50,780 --> 00:33:52,940
update which I would never see if I was

928
00:33:52,940 --> 00:33:54,380
just looking through a massive massive

929
00:33:54,380 --> 00:33:57,020
list of them but it's the same thing

930
00:33:57,020 --> 00:33:58,670
like you really have to pay attention to

931
00:33:58,670 --> 00:34:00,050
these you really have to understand

932
00:34:00,050 --> 00:34:01,820
what's occurring in your environment and

933
00:34:01,820 --> 00:34:04,100
they're surprisingly there shouldn't be

934
00:34:04,100 --> 00:34:06,050
as many scheduled tasks created in a

935
00:34:06,050 --> 00:34:07,810
Windows environment as you would think

936
00:34:07,810 --> 00:34:10,399
like a massive massive enterprise you

937
00:34:10,399 --> 00:34:11,750
might see maybe a thousand a month

938
00:34:11,750 --> 00:34:13,820
depending on how your administrators do

939
00:34:13,820 --> 00:34:15,230
business within the environment it

940
00:34:15,230 --> 00:34:20,210
shouldn't be too too bad alright four

941
00:34:20,210 --> 00:34:24,469
six nine seven service creation so this

942
00:34:24,469 --> 00:34:26,570
is like I know people are gonna say it

943
00:34:26,570 --> 00:34:28,639
this is already in the logs this is in

944
00:34:28,639 --> 00:34:31,580
the system log 704 five by default it is

945
00:34:31,580 --> 00:34:34,399
but this is the way I rationalize this

946
00:34:34,399 --> 00:34:36,530
is it's like me living in Butler and my

947
00:34:36,530 --> 00:34:38,629
best friend in the South Hills we're

948
00:34:38,629 --> 00:34:40,248
making that friggin Drive like it

949
00:34:40,248 --> 00:34:41,929
doesn't matter he could be in California

950
00:34:41,929 --> 00:34:44,268
and be like the same thing it's getting

951
00:34:44,268 --> 00:34:47,029
somebody that's a security analyst or

952
00:34:47,029 --> 00:34:48,469
any kind of analysts in your company

953
00:34:48,469 --> 00:34:50,179
like how often do they dig into the

954
00:34:50,179 --> 00:34:52,039
system logs or the application logs it's

955
00:34:52,039 --> 00:34:54,889
like probably never so the reason that I

956
00:34:54,889 --> 00:34:57,349
really like this one is it forces you to

957
00:34:57,349 --> 00:34:58,489
look at it because now it's in the

958
00:34:58,489 --> 00:35:00,079
security log all of your tools are

959
00:35:00,079 --> 00:35:01,970
probably ingesting just the security log

960
00:35:01,970 --> 00:35:04,670
so you're gonna actually see it now but

961
00:35:04,670 --> 00:35:07,460
this is just with Windows 10 and up into

962
00:35:07,460 --> 00:35:13,519
there all right so same set up group

963
00:35:13,519 --> 00:35:15,289
policy same thing here you can also do

964
00:35:15,289 --> 00:35:17,839
failure I'd recommend just doing success

965
00:35:17,839 --> 00:35:22,160
for this so in the attack framework this

966
00:35:22,160 --> 00:35:24,769
is the same kind of deal you're gonna

967
00:35:24,769 --> 00:35:26,539
have execution and you're gonna have

968
00:35:26,539 --> 00:35:27,950
persistence it's utilized in two

969
00:35:27,950 --> 00:35:28,729
different ways

970
00:35:28,729 --> 00:35:30,890
so it's definitely worth taking a look

971
00:35:30,890 --> 00:35:32,390
at like if you ever heard of like the SC

972
00:35:32,390 --> 00:35:35,210
command this logs it this will show you

973
00:35:35,210 --> 00:35:38,839
that so this is just execution here this

974
00:35:38,839 --> 00:35:41,239
is persistence here I mean this is

975
00:35:41,239 --> 00:35:44,180
common all of the newest groups a lot of

976
00:35:44,180 --> 00:35:46,069
the older groups they're all utilizing

977
00:35:46,069 --> 00:35:47,690
this technique if you're not logging

978
00:35:47,690 --> 00:35:51,249
this you're definitely missing it all

979
00:35:51,249 --> 00:35:54,829
right so a quick example here so this is

980
00:35:54,829 --> 00:35:57,650
carbon at door I think I may have missed

981
00:35:57,650 --> 00:36:01,880
this up when I did it so it's what

982
00:36:01,880 --> 00:36:03,799
carbon act does is it takes a common

983
00:36:03,799 --> 00:36:05,180
service it just it's like Russian

984
00:36:05,180 --> 00:36:06,529
roulette it'll just take a common

985
00:36:06,529 --> 00:36:08,989
service name and it's gonna pin sis to

986
00:36:08,989 --> 00:36:11,210
it but I thought that it deleted the

987
00:36:11,210 --> 00:36:13,160
actual last character of the service and

988
00:36:13,160 --> 00:36:14,960
I think it does the first so this is

989
00:36:14,960 --> 00:36:18,259
backwards but you can see when services

990
00:36:18,259 --> 00:36:19,759
are actually created within a Windows

991
00:36:19,759 --> 00:36:21,170
environment you're gonna have this

992
00:36:21,170 --> 00:36:22,969
information you're gonna have the

993
00:36:22,969 --> 00:36:24,680
account name that created it and you can

994
00:36:24,680 --> 00:36:26,900
take a look at it a lot of times I'm not

995
00:36:26,900 --> 00:36:28,670
gonna lie these are gonna blend in so

996
00:36:28,670 --> 00:36:30,499
well that you're really gonna have to

997
00:36:30,499 --> 00:36:32,200
pay attention like just a letter off

998
00:36:32,200 --> 00:36:34,579
something of that nature sometimes

999
00:36:34,579 --> 00:36:37,130
though you will see just basic garbage

1000
00:36:37,130 --> 00:36:38,479
across there and you know that that's

1001
00:36:38,479 --> 00:36:39,979
probably gonna be a malicious process

1002
00:36:39,979 --> 00:36:43,058
that's running within your environment

1003
00:36:43,150 --> 00:36:45,130
all right

1004
00:36:45,130 --> 00:36:47,830
I hate talking about this everyone has

1005
00:36:47,830 --> 00:36:50,950
done this before but it just pains me so

1006
00:36:50,950 --> 00:36:54,070
much one customer in the past year and a

1007
00:36:54,070 --> 00:36:57,430
half has PowerShell logging enabled this

1008
00:36:57,430 --> 00:37:00,460
is a massive tool like for the blue team

1009
00:37:00,460 --> 00:37:02,530
for your offensive team for everybody

1010
00:37:02,530 --> 00:37:04,780
within the environment so real quickly

1011
00:37:04,780 --> 00:37:06,430
how many people actually have this

1012
00:37:06,430 --> 00:37:08,260
enabled and know that it's enabled in

1013
00:37:08,260 --> 00:37:12,190
their environment okay yeah this is

1014
00:37:12,190 --> 00:37:15,130
something you just have to do it look at

1015
00:37:15,130 --> 00:37:16,810
all of the tooling that's out there look

1016
00:37:16,810 --> 00:37:18,460
at all the presentations that you see it

1017
00:37:18,460 --> 00:37:20,770
like DEFCON everywhere how are you guys

1018
00:37:20,770 --> 00:37:22,510
catching this activity if you're not

1019
00:37:22,510 --> 00:37:24,520
logging PowerShell you're not catching

1020
00:37:24,520 --> 00:37:25,690
it so it's getting through your

1021
00:37:25,690 --> 00:37:27,790
environment this is the simplest logging

1022
00:37:27,790 --> 00:37:29,530
solution that you can put into play and

1023
00:37:29,530 --> 00:37:33,970
get wins immediately from so there is

1024
00:37:33,970 --> 00:37:35,830
volume issues with this as well this can

1025
00:37:35,830 --> 00:37:39,360
be super noisy so if you have to pick

1026
00:37:39,360 --> 00:37:42,220
pick script block logging this is the

1027
00:37:42,220 --> 00:37:44,290
log that you want you do not want to go

1028
00:37:44,290 --> 00:37:46,480
with module logging if volume is an

1029
00:37:46,480 --> 00:37:51,760
issue so script block logging freaking

1030
00:37:51,760 --> 00:37:54,070
awesome the best log that windows has

1031
00:37:54,070 --> 00:37:55,420
come up with in the past couple years

1032
00:37:55,420 --> 00:37:58,360
would be my opinion it captures pretty

1033
00:37:58,360 --> 00:38:00,700
much the full command and the contents

1034
00:38:00,700 --> 00:38:02,740
of the script it can do a little bit of

1035
00:38:02,740 --> 00:38:04,870
deification it might not necessarily

1036
00:38:04,870 --> 00:38:07,630
make the code readable to you but enough

1037
00:38:07,630 --> 00:38:08,890
where you can do something with it and

1038
00:38:08,890 --> 00:38:11,410
know that something is occurring on so

1039
00:38:11,410 --> 00:38:13,180
pretty much it shows who executed the

1040
00:38:13,180 --> 00:38:15,790
script when it was run regardless of how

1041
00:38:15,790 --> 00:38:20,160
PowerShell was executed it ends up here

1042
00:38:20,190 --> 00:38:24,010
set up same kind of deal that's where it

1043
00:38:24,010 --> 00:38:25,510
is in group policy this is where you

1044
00:38:25,510 --> 00:38:28,930
configure it and then examples empire

1045
00:38:28,930 --> 00:38:31,180
stager I mean everyone knows what Empire

1046
00:38:31,180 --> 00:38:33,640
is it's used by so many people so many

1047
00:38:33,640 --> 00:38:36,160
red team's adversaries actors whatever

1048
00:38:36,160 --> 00:38:38,410
it's there if you're not logging this

1049
00:38:38,410 --> 00:38:39,940
you are not catching this you're not

1050
00:38:39,940 --> 00:38:42,730
gonna see this occur so it's based on

1051
00:38:42,730 --> 00:38:45,220
like a listener stager and an agent the

1052
00:38:45,220 --> 00:38:47,470
key giveaway here for Empire it's the -

1053
00:38:47,470 --> 00:38:50,500
sta which means PowerShell is pretty

1054
00:38:50,500 --> 00:38:52,060
much in single threaded mode I still

1055
00:38:52,060 --> 00:38:54,010
have no freaking idea why they do that

1056
00:38:54,010 --> 00:38:56,590
if anyone knows come find me after and

1057
00:38:56,590 --> 00:38:57,670
tell me because PowerShell is

1058
00:38:57,670 --> 00:38:58,840
multi-threaded so I don't

1059
00:38:58,840 --> 00:39:01,540
know why they would do this but you're

1060
00:39:01,540 --> 00:39:03,310
gonna see like the no op for no profile

1061
00:39:03,310 --> 00:39:05,740
with the sta and then the W one that's a

1062
00:39:05,740 --> 00:39:07,450
dead giveaway for Empire in your

1063
00:39:07,450 --> 00:39:10,750
environment other interesting behavior

1064
00:39:10,750 --> 00:39:12,760
that you can do with this just start

1065
00:39:12,760 --> 00:39:15,670
looking at off you station nothing like

1066
00:39:15,670 --> 00:39:17,170
I said before should be obvious gated in

1067
00:39:17,170 --> 00:39:18,400
your environment unless like you've got

1068
00:39:18,400 --> 00:39:20,260
like a rogue coder going on or something

1069
00:39:20,260 --> 00:39:23,170
occurring that's very weird some of the

1070
00:39:23,170 --> 00:39:24,670
arguments you can look at there's a

1071
00:39:24,670 --> 00:39:28,240
excellent talk by Daniel Bohannon kind

1072
00:39:28,240 --> 00:39:30,100
of goes into this he did invoke

1073
00:39:30,100 --> 00:39:31,720
obfuscation and a few other tools as

1074
00:39:31,720 --> 00:39:34,110
well there's so many variants to this

1075
00:39:34,110 --> 00:39:36,700
but you can just start with the basics a

1076
00:39:36,700 --> 00:39:38,530
lot of people won't put the effort into

1077
00:39:38,530 --> 00:39:40,210
like completely off you skate this or

1078
00:39:40,210 --> 00:39:41,980
make it ridiculous where you can't read

1079
00:39:41,980 --> 00:39:44,020
it you can just look for no profile or

1080
00:39:44,020 --> 00:39:45,910
no op just see what occurs within there

1081
00:39:45,910 --> 00:39:49,390
and then set execution policy this is

1082
00:39:49,390 --> 00:39:52,900
not this is not a security control in

1083
00:39:52,900 --> 00:39:55,210
any freaking way all you have to do is

1084
00:39:55,210 --> 00:39:57,100
type dash bypass and you're through this

1085
00:39:57,100 --> 00:39:59,830
no matter what occurs so many companies

1086
00:39:59,830 --> 00:40:01,180
are like oh we'll just put that on and

1087
00:40:01,180 --> 00:40:01,660
we're good to go

1088
00:40:01,660 --> 00:40:04,060
no do script signing do something else

1089
00:40:04,060 --> 00:40:07,210
this will not work and it's a hell of a

1090
00:40:07,210 --> 00:40:08,890
good way to search like you can just

1091
00:40:08,890 --> 00:40:11,230
start typing - bypass look in your for

1092
00:40:11,230 --> 00:40:14,710
104 logs if that comes up I've seen it

1093
00:40:14,710 --> 00:40:16,750
before in companies where the admins

1094
00:40:16,750 --> 00:40:18,370
utilize it because they don't really

1095
00:40:18,370 --> 00:40:20,230
they didn't configure it appropriately

1096
00:40:20,230 --> 00:40:22,360
but generally in most environments when

1097
00:40:22,360 --> 00:40:24,220
you pull that up and that occurs it's

1098
00:40:24,220 --> 00:40:26,020
something bad it's it's not gonna be

1099
00:40:26,020 --> 00:40:28,480
anything good um and then the other

1100
00:40:28,480 --> 00:40:31,390
thing with this - is you can also if you

1101
00:40:31,390 --> 00:40:33,190
have four six eight eight involved like

1102
00:40:33,190 --> 00:40:35,530
the process creation and you're starting

1103
00:40:35,530 --> 00:40:36,850
to look at like the command lines like

1104
00:40:36,850 --> 00:40:38,290
one of the awesome things you can start

1105
00:40:38,290 --> 00:40:39,550
to do with that is you can break those

1106
00:40:39,550 --> 00:40:41,650
command lines down maybe just throw them

1107
00:40:41,650 --> 00:40:43,510
out into an Excel and look at the file

1108
00:40:43,510 --> 00:40:45,670
names that are being executed like it

1109
00:40:45,670 --> 00:40:48,760
may not be you know just a basic

1110
00:40:48,760 --> 00:40:50,170
powershell it might not be like bob's

1111
00:40:50,170 --> 00:40:52,570
powershell at ps1 like you're gonna see

1112
00:40:52,570 --> 00:40:53,920
blobs like this because they auto

1113
00:40:53,920 --> 00:40:55,780
generate them it's not gonna be

1114
00:40:55,780 --> 00:40:57,400
something named normally so that might

1115
00:40:57,400 --> 00:40:58,810
be another really good giveaway right

1116
00:40:58,810 --> 00:41:02,770
there alright module logging so this is

1117
00:41:02,770 --> 00:41:04,810
the one if you have volume issues do not

1118
00:41:04,810 --> 00:41:07,120
enable this it's not as robust as script

1119
00:41:07,120 --> 00:41:09,370
block logging in my opinion it's useful

1120
00:41:09,370 --> 00:41:12,110
but it's not as useful if you have the

1121
00:41:12,110 --> 00:41:14,270
all you do both you can do that so it's

1122
00:41:14,270 --> 00:41:16,190
pretty much pipeline execution details

1123
00:41:16,190 --> 00:41:19,300
get a little bit of the variable initial

1124
00:41:19,300 --> 00:41:22,520
initialization the problem with this one

1125
00:41:22,520 --> 00:41:24,440
is though you will not always get the

1126
00:41:24,440 --> 00:41:26,480
full script so you're gonna get pieces

1127
00:41:26,480 --> 00:41:27,650
of the script and you're not gonna

1128
00:41:27,650 --> 00:41:29,270
really understand kind of probably

1129
00:41:29,270 --> 00:41:30,620
everything that's occurring that's why I

1130
00:41:30,620 --> 00:41:32,390
always say go with script block logging

1131
00:41:32,390 --> 00:41:35,680
it just works much much better that way

1132
00:41:35,680 --> 00:41:38,810
all right set up group policy

1133
00:41:38,810 --> 00:41:41,570
configuration so this is one of the use

1134
00:41:41,570 --> 00:41:43,790
cases where I do utilize it for

1135
00:41:43,790 --> 00:41:46,520
PowerShell remoting so you've like NR PS

1136
00:41:46,520 --> 00:41:50,330
session you can utilize invoke WMI and

1137
00:41:50,330 --> 00:41:52,070
you have invoke command

1138
00:41:52,070 --> 00:41:54,920
so when PowerShell is pretty much using

1139
00:41:54,920 --> 00:41:57,320
remoting you have to utilize win RM for

1140
00:41:57,320 --> 00:41:59,540
this which if any system administrator

1141
00:41:59,540 --> 00:42:01,400
in your environment is using PowerShell

1142
00:42:01,400 --> 00:42:03,530
when RM is enabled already so you're

1143
00:42:03,530 --> 00:42:04,760
gonna see probably some of these

1144
00:42:04,760 --> 00:42:06,140
commands they may be just an

1145
00:42:06,140 --> 00:42:08,210
administrator doing his job or it may be

1146
00:42:08,210 --> 00:42:10,880
you know something malicious but well

1147
00:42:10,880 --> 00:42:13,100
you can see at the top is I think it's

1148
00:42:13,100 --> 00:42:14,540
like the very top you see like enter PS

1149
00:42:14,540 --> 00:42:16,040
session so sometimes what I'll do with

1150
00:42:16,040 --> 00:42:18,050
this is just if I find like an

1151
00:42:18,050 --> 00:42:20,060
interesting command lit or argument

1152
00:42:20,060 --> 00:42:22,040
that's run I'll search this first and

1153
00:42:22,040 --> 00:42:23,300
see if there's any hits and then I'll go

1154
00:42:23,300 --> 00:42:25,910
into a script LOC logging 4104 and pull

1155
00:42:25,910 --> 00:42:27,200
down the actual information that I'm

1156
00:42:27,200 --> 00:42:31,190
interested in um so here's another

1157
00:42:31,190 --> 00:42:33,770
example this is still the same Empire

1158
00:42:33,770 --> 00:42:35,600
stager this is kind of what you're gonna

1159
00:42:35,600 --> 00:42:37,790
see it's not as robust you're gonna get

1160
00:42:37,790 --> 00:42:41,090
partially I think most of the blob on

1161
00:42:41,090 --> 00:42:42,860
this one you'll get but not everything

1162
00:42:42,860 --> 00:42:47,780
in there ok so those are all of the

1163
00:42:47,780 --> 00:42:49,850
windows logs that most people do not

1164
00:42:49,850 --> 00:42:51,410
have enabled that's the stuff that you

1165
00:42:51,410 --> 00:42:53,360
need to enable in your environment I'm

1166
00:42:53,360 --> 00:42:55,340
telling you right now like it could save

1167
00:42:55,340 --> 00:42:58,010
a lot of money from a very expensive EDR

1168
00:42:58,010 --> 00:42:59,660
solution if you're a smaller a midsize

1169
00:42:59,660 --> 00:43:01,970
company turn those on first you can find

1170
00:43:01,970 --> 00:43:03,800
persistence that way you can find a lot

1171
00:43:03,800 --> 00:43:06,740
of bad that way before you move up so

1172
00:43:06,740 --> 00:43:08,870
basic thread hunting strategies with

1173
00:43:08,870 --> 00:43:12,980
this stuff once you have it I view a mix

1174
00:43:12,980 --> 00:43:14,690
of like statistical analysis and then

1175
00:43:14,690 --> 00:43:16,700
data analysis so what I look like the

1176
00:43:16,700 --> 00:43:17,960
biggest things is everyone's like oh

1177
00:43:17,960 --> 00:43:19,310
you've got a baseline your entire

1178
00:43:19,310 --> 00:43:21,080
environment well that's a lot of work

1179
00:43:21,080 --> 00:43:23,420
most people don't do that so you can

1180
00:43:23,420 --> 00:43:25,600
sort a lot of this stuff

1181
00:43:25,600 --> 00:43:27,220
if you look at like all the command

1182
00:43:27,220 --> 00:43:28,450
lines that are being run in your

1183
00:43:28,450 --> 00:43:30,250
environment or all the scheduled tasks

1184
00:43:30,250 --> 00:43:32,410
the highest numbered ones those are

1185
00:43:32,410 --> 00:43:34,300
going to be allowed that's probably

1186
00:43:34,300 --> 00:43:35,590
gonna be on every system in your

1187
00:43:35,590 --> 00:43:36,730
environment which is why it has the

1188
00:43:36,730 --> 00:43:39,550
highest count all the way down to you

1189
00:43:39,550 --> 00:43:41,260
know maybe like halfway in that list

1190
00:43:41,260 --> 00:43:43,360
that's probably your baseline for the

1191
00:43:43,360 --> 00:43:45,310
most part in your environment then you

1192
00:43:45,310 --> 00:43:46,600
have your outliers at the bottom that

1193
00:43:46,600 --> 00:43:48,220
are like one offs two offs those are the

1194
00:43:48,220 --> 00:43:49,630
ones you start looking at immediately

1195
00:43:49,630 --> 00:43:51,010
that's the stuff where it's like that

1196
00:43:51,010 --> 00:43:53,050
probably shouldn't be here it might be

1197
00:43:53,050 --> 00:43:54,730
interesting but that's where you're

1198
00:43:54,730 --> 00:43:56,560
gonna go with it so there's a lot you

1199
00:43:56,560 --> 00:43:58,360
can do this you know visualization as

1200
00:43:58,360 --> 00:44:00,370
well like if you have like a tableau

1201
00:44:00,370 --> 00:44:02,350
license or something you can throw all

1202
00:44:02,350 --> 00:44:04,630
of these weird logs into that and

1203
00:44:04,630 --> 00:44:06,310
visualize the data if that works for you

1204
00:44:06,310 --> 00:44:08,080
instead of staring it Splunk looking at

1205
00:44:08,080 --> 00:44:09,940
a white list the whole day you can look

1206
00:44:09,940 --> 00:44:11,830
at blobs that are color-coded and very

1207
00:44:11,830 --> 00:44:14,020
interesting I've pulled information out

1208
00:44:14,020 --> 00:44:16,720
of this especially with a sock where you

1209
00:44:16,720 --> 00:44:19,150
have a very large enterprise sock that's

1210
00:44:19,150 --> 00:44:20,500
may be spread across in a couple of

1211
00:44:20,500 --> 00:44:22,450
different countries and say you take a

1212
00:44:22,450 --> 00:44:24,370
look at like IP scanning like socks

1213
00:44:24,370 --> 00:44:25,660
always like I had nothing got through

1214
00:44:25,660 --> 00:44:27,850
closed it if you take all of the IP

1215
00:44:27,850 --> 00:44:30,160
scanning for a month from all of those

1216
00:44:30,160 --> 00:44:31,780
sock analysts and you put it into a

1217
00:44:31,780 --> 00:44:34,120
visualization you might start to bubble

1218
00:44:34,120 --> 00:44:35,860
up and say like hey this IP range is

1219
00:44:35,860 --> 00:44:37,210
hitting that country this country this

1220
00:44:37,210 --> 00:44:39,580
country at certain times and dates but

1221
00:44:39,580 --> 00:44:40,750
you're not gonna see that when every

1222
00:44:40,750 --> 00:44:42,190
single person's closing stuff and

1223
00:44:42,190 --> 00:44:43,570
they're not really communicating as to

1224
00:44:43,570 --> 00:44:45,460
what they're closing like your very

1225
00:44:45,460 --> 00:44:48,400
basic alerts can turn into very powerful

1226
00:44:48,400 --> 00:44:51,760
information and then Osen Greg you

1227
00:44:51,760 --> 00:44:53,410
mentioned this before you can still do

1228
00:44:53,410 --> 00:44:54,250
this kind of stuff

1229
00:44:54,250 --> 00:44:56,980
read affect report AT&T cybersecurity

1230
00:44:56,980 --> 00:44:59,620
which bought alienvault otx is still

1231
00:44:59,620 --> 00:45:02,530
free I hope for a lot longer but we'll

1232
00:45:02,530 --> 00:45:04,570
see virustotal you can go to

1233
00:45:04,570 --> 00:45:06,370
intelligence and get tons of information

1234
00:45:06,370 --> 00:45:09,220
out of that research lab like your home

1235
00:45:09,220 --> 00:45:10,660
your office whatever you guys like play

1236
00:45:10,660 --> 00:45:12,970
around with runn tools capture these

1237
00:45:12,970 --> 00:45:14,650
logs start trying to check that stuff at

1238
00:45:14,650 --> 00:45:16,870
work and then Twitter you can get a ton

1239
00:45:16,870 --> 00:45:21,550
of information from that so this is just

1240
00:45:21,550 --> 00:45:25,180
super quick this is Apache Zeppelin so

1241
00:45:25,180 --> 00:45:26,620
it's open source this is kind of one of

1242
00:45:26,620 --> 00:45:28,960
the ways that we hunt with all of our

1243
00:45:28,960 --> 00:45:31,270
data we throw it into here put this on

1244
00:45:31,270 --> 00:45:33,010
top you can do sequel sparks equal

1245
00:45:33,010 --> 00:45:34,960
Python etc whatever language you like

1246
00:45:34,960 --> 00:45:35,970
this is

1247
00:45:35,970 --> 00:45:38,580
a super basic sequel query and I was

1248
00:45:38,580 --> 00:45:40,859
just doing what I told you guys I was

1249
00:45:40,859 --> 00:45:42,690
counting all of the command lines in a

1250
00:45:42,690 --> 00:45:44,369
month actually no I was doing one day

1251
00:45:44,369 --> 00:45:47,070
because of the data size it's just

1252
00:45:47,070 --> 00:45:48,690
looking so I went immediately to the

1253
00:45:48,690 --> 00:45:49,980
bottom to the one offs and I'm just

1254
00:45:49,980 --> 00:45:51,599
scrolling up looking at those and seeing

1255
00:45:51,599 --> 00:45:53,190
there's anything interesting and you

1256
00:45:53,190 --> 00:45:54,510
immediately have the powershell with

1257
00:45:54,510 --> 00:45:56,910
like window style hidden etc etc and you

1258
00:45:56,910 --> 00:45:58,650
know that's not gonna be good but this

1259
00:45:58,650 --> 00:46:00,090
is one way that you can do it and you

1260
00:46:00,090 --> 00:46:02,460
can do this with so much data it doesn't

1261
00:46:02,460 --> 00:46:04,560
have to be you know command lines you

1262
00:46:04,560 --> 00:46:06,780
can do it with logging account creation

1263
00:46:06,780 --> 00:46:11,010
etc you do it with a lot of stuff so

1264
00:46:11,010 --> 00:46:12,810
here's another one this one is pretty

1265
00:46:12,810 --> 00:46:15,390
much service named doing the same thing

1266
00:46:15,390 --> 00:46:17,250
looking at services that are common

1267
00:46:17,250 --> 00:46:18,869
within the systems in your environment

1268
00:46:18,869 --> 00:46:20,940
and if you do this this is a really good

1269
00:46:20,940 --> 00:46:22,619
way as well to baseline the services

1270
00:46:22,619 --> 00:46:24,240
that are acceptable within your company

1271
00:46:24,240 --> 00:46:26,190
and then you're gonna start to see at

1272
00:46:26,190 --> 00:46:27,420
the bottom when you start going towards

1273
00:46:27,420 --> 00:46:28,980
those outliers those anomalies that are

1274
00:46:28,980 --> 00:46:29,970
down there you're gonna start seeing

1275
00:46:29,970 --> 00:46:32,180
weird names so you can see like the SVC

1276
00:46:32,180 --> 00:46:35,640
host assist doesn't really match the

1277
00:46:35,640 --> 00:46:37,050
other ones are numbered as well I'm not

1278
00:46:37,050 --> 00:46:39,930
sure why but it stands out it's somebody

1279
00:46:39,930 --> 00:46:41,730
to look into you can dig into that if

1280
00:46:41,730 --> 00:46:45,660
you have the logging um here's another

1281
00:46:45,660 --> 00:46:48,390
one as well so this one is just what I

1282
00:46:48,390 --> 00:46:50,820
told you guys just start basic you don't

1283
00:46:50,820 --> 00:46:52,349
have to go immediately and write this

1284
00:46:52,349 --> 00:46:54,390
crazy freaking reg X it's gonna match

1285
00:46:54,390 --> 00:46:56,550
everything in the world just start with

1286
00:46:56,550 --> 00:46:58,410
bypass look at that like is anyone

1287
00:46:58,410 --> 00:47:00,030
running that in your environment okay I

1288
00:47:00,030 --> 00:47:01,440
gotta go talk to Bob because he's

1289
00:47:01,440 --> 00:47:03,060
running bypassed every time he does like

1290
00:47:03,060 --> 00:47:04,890
a GPO push or something like that

1291
00:47:04,890 --> 00:47:06,960
you're still gonna find bad stuff you're

1292
00:47:06,960 --> 00:47:09,060
still probably gonna find stuff that's

1293
00:47:09,060 --> 00:47:10,710
occurring within your environment that's

1294
00:47:10,710 --> 00:47:12,630
expected but this could also be a

1295
00:47:12,630 --> 00:47:14,310
talking point to be like hey we need to

1296
00:47:14,310 --> 00:47:15,540
do a little bit more security around

1297
00:47:15,540 --> 00:47:18,599
PowerShell if people are running this um

1298
00:47:18,599 --> 00:47:22,200
and then the last one this is like the

1299
00:47:22,200 --> 00:47:23,460
funniest thing because you would never

1300
00:47:23,460 --> 00:47:25,200
expect this to actually occur in an

1301
00:47:25,200 --> 00:47:27,869
environment but it does sometimes people

1302
00:47:27,869 --> 00:47:29,520
are super freaking lazy and they won't

1303
00:47:29,520 --> 00:47:32,790
rename any cats this happens like I will

1304
00:47:32,790 --> 00:47:34,290
go into an environment that's brand-new

1305
00:47:34,290 --> 00:47:36,030
and still run this every time because

1306
00:47:36,030 --> 00:47:37,619
you never know like you can really just

1307
00:47:37,619 --> 00:47:39,150
pull one out and be like oh that was

1308
00:47:39,150 --> 00:47:39,720
awesome

1309
00:47:39,720 --> 00:47:42,450
but a little work in next time but yeah

1310
00:47:42,450 --> 00:47:44,160
it's the same kind of principle start

1311
00:47:44,160 --> 00:47:46,020
very basic like even if you feel like

1312
00:47:46,020 --> 00:47:48,150
uncomfortable like this should probably

1313
00:47:48,150 --> 00:47:49,119
never happen

1314
00:47:49,119 --> 00:47:50,920
you never know like you can get a win

1315
00:47:50,920 --> 00:47:53,049
out of the most basic search terms in

1316
00:47:53,049 --> 00:47:58,660
here one of the things that we wanted to

1317
00:47:58,660 --> 00:48:00,880
get to that we never ended up being I'll

1318
00:48:00,880 --> 00:48:02,259
put together for this presentation is a

1319
00:48:02,259 --> 00:48:03,640
little demonstration and some open

1320
00:48:03,640 --> 00:48:07,240
source tool information so as a poor

1321
00:48:07,240 --> 00:48:08,740
substitute we just threw this slide in

1322
00:48:08,740 --> 00:48:11,230
when it comes to Windows systems OS

1323
00:48:11,230 --> 00:48:13,450
query win log beat and system on in

1324
00:48:13,450 --> 00:48:15,549
addition to you know just native Windows

1325
00:48:15,549 --> 00:48:16,839
OS logging those are some good tools

1326
00:48:16,839 --> 00:48:17,980
that you might want to go out and take a

1327
00:48:17,980 --> 00:48:20,230
look at and then we've got tools that

1328
00:48:20,230 --> 00:48:21,940
also support the analysis the data so we

1329
00:48:21,940 --> 00:48:23,349
talked a lot about like you know how you

1330
00:48:23,349 --> 00:48:25,299
go about hunting what you can find and

1331
00:48:25,299 --> 00:48:26,710
all these windows logs that Brian went

1332
00:48:26,710 --> 00:48:28,390
through and we just kind of waved our

1333
00:48:28,390 --> 00:48:29,890
hand and basically said yeah you've got

1334
00:48:29,890 --> 00:48:31,329
access to all these logs and you've got

1335
00:48:31,329 --> 00:48:32,920
some platform where you can query these

1336
00:48:32,920 --> 00:48:35,349
logs and do you know the Apaches up one

1337
00:48:35,349 --> 00:48:37,240
kind of analytics and things like that

1338
00:48:37,240 --> 00:48:39,430
but there is some work that goes into

1339
00:48:39,430 --> 00:48:41,200
setting up those environments so you

1340
00:48:41,200 --> 00:48:44,170
know open source help hunter those are

1341
00:48:44,170 --> 00:48:45,519
some great platforms to go off and take

1342
00:48:45,519 --> 00:48:46,539
a look at and will give you an

1343
00:48:46,539 --> 00:48:48,069
environment sort of an complete

1344
00:48:48,069 --> 00:48:50,529
all-in-one package and some really great

1345
00:48:50,529 --> 00:48:52,509
work that those guys have done in the

1346
00:48:52,509 --> 00:48:54,549
community and around the open-source

1347
00:48:54,549 --> 00:48:58,690
threat hunting world so just some things

1348
00:48:58,690 --> 00:49:01,630
to take a look at so just wrapping

1349
00:49:01,630 --> 00:49:04,089
things up you know hopefully you got

1350
00:49:04,089 --> 00:49:05,650
something out of this presentation when

1351
00:49:05,650 --> 00:49:07,239
it comes to getting started with threat

1352
00:49:07,239 --> 00:49:08,349
hunting if you're not doing it already

1353
00:49:08,349 --> 00:49:10,210
Windows logs are a great place to start

1354
00:49:10,210 --> 00:49:12,249
obviously you've got to have you know

1355
00:49:12,249 --> 00:49:13,329
when you comes to building a program

1356
00:49:13,329 --> 00:49:16,450
people process technology alright so it

1357
00:49:16,450 --> 00:49:17,499
comes with the you know look at the

1358
00:49:17,499 --> 00:49:18,730
people you gotta have analysts that

1359
00:49:18,730 --> 00:49:20,049
actually know how to do this

1360
00:49:20,049 --> 00:49:21,730
analysts that can dedicate time to it

1361
00:49:21,730 --> 00:49:22,869
it's not something that you can just

1362
00:49:22,869 --> 00:49:24,339
take you know thirty minutes a day and

1363
00:49:24,339 --> 00:49:25,509
try and accomplish in any sort of

1364
00:49:25,509 --> 00:49:27,880
effective manner so wrap some analysts

1365
00:49:27,880 --> 00:49:29,799
around it spend some time on it you'll

1366
00:49:29,799 --> 00:49:31,779
you really see a return there make sure

1367
00:49:31,779 --> 00:49:34,119
you follow the process grab some data

1368
00:49:34,119 --> 00:49:35,230
start with Windows logs

1369
00:49:35,230 --> 00:49:37,569
easy place and and leverage some sort of

1370
00:49:37,569 --> 00:49:39,009
platform starting maybe with open source

1371
00:49:39,009 --> 00:49:42,160
just to get your hands dirty and with

1372
00:49:42,160 --> 00:49:43,329
that thank you very much for attending

1373
00:49:43,329 --> 00:49:45,839
appreciate

1374
00:49:49,110 --> 00:49:51,580
if you guys have any questions we'll be

1375
00:49:51,580 --> 00:49:53,530
sticking around you know you can ask us

1376
00:49:53,530 --> 00:49:54,940
now we got a couple minutes or just

1377
00:49:54,940 --> 00:49:57,630
catch us afterwards

