1
00:00:00,080 --> 00:00:01,839
hey everyone thanks for coming back

2
00:00:01,839 --> 00:00:04,319
after lunch i'd like to introduce phil

3
00:00:04,319 --> 00:00:06,000
holbrook he's a pen tester and he's

4
00:00:06,000 --> 00:00:06,960
gonna be talking about some really

5
00:00:06,960 --> 00:00:08,960
interesting modern fishing techniques

6
00:00:08,960 --> 00:00:10,559
involving calendaring and other cool

7
00:00:10,559 --> 00:00:12,400
stuff so please give a warm welcome to

8
00:00:12,400 --> 00:00:15,400
phil

9
00:00:18,320 --> 00:00:21,199
thank you good afternoon everybody um

10
00:00:21,199 --> 00:00:23,119
so as we uh said i'm going to be going

11
00:00:23,119 --> 00:00:24,560
over fishing with google calendars

12
00:00:24,560 --> 00:00:27,680
google docs at in no vnc basically weird

13
00:00:27,680 --> 00:00:30,080
fishing techniques for 2022.

14
00:00:30,080 --> 00:00:32,880
so a little bit about me hi i'm phil

15
00:00:32,880 --> 00:00:34,880
holbrook thank you for attending you can

16
00:00:34,880 --> 00:00:36,640
find me on twitter

17
00:00:36,640 --> 00:00:38,559
at flip zero you can find my blog at

18
00:00:38,559 --> 00:00:40,480
flipster.io i make no promises on

19
00:00:40,480 --> 00:00:42,480
updates on that blog or consistency or

20
00:00:42,480 --> 00:00:43,440
quality

21
00:00:43,440 --> 00:00:45,680
i make no promises on any of those um

22
00:00:45,680 --> 00:00:47,760
you can sign you find all the uh slides

23
00:00:47,760 --> 00:00:49,200
i have some bits of code some little

24
00:00:49,200 --> 00:00:50,719
tidbits and the github repo for this

25
00:00:50,719 --> 00:00:52,320
thing i posted it last night it should

26
00:00:52,320 --> 00:00:54,960
be up um so there will be bits of code

27
00:00:54,960 --> 00:00:56,800
on the screen don't stress about them

28
00:00:56,800 --> 00:00:59,359
i'm going to get a repo grab them later

29
00:00:59,359 --> 00:01:00,320
um

30
00:01:00,320 --> 00:01:02,160
yeah i'm a senior penetration tester for

31
00:01:02,160 --> 00:01:04,080
a company called shellman doing a

32
00:01:04,080 --> 00:01:05,760
variety of engagements anything from

33
00:01:05,760 --> 00:01:07,280
internals to web apps to mobile so we

34
00:01:07,280 --> 00:01:08,720
get into a bunch of stuff

35
00:01:08,720 --> 00:01:10,640
so what i'm focusing on today is fishing

36
00:01:10,640 --> 00:01:12,320
so let's dive right into google

37
00:01:12,320 --> 00:01:13,680
calendars

38
00:01:13,680 --> 00:01:15,040
so

39
00:01:15,040 --> 00:01:17,119
i started doing these campaigns after a

40
00:01:17,119 --> 00:01:18,799
co-worker had followed a run through the

41
00:01:18,799 --> 00:01:21,360
bhis had posted on setting up the google

42
00:01:21,360 --> 00:01:23,439
api account setting up a google api

43
00:01:23,439 --> 00:01:25,520
account to send calendar events as a

44
00:01:25,520 --> 00:01:27,600
form of phishing and you're just

45
00:01:27,600 --> 00:01:29,119
assuming you know you have to know that

46
00:01:29,119 --> 00:01:30,799
the client is going to be using google

47
00:01:30,799 --> 00:01:32,079
calendars to accept those events

48
00:01:32,079 --> 00:01:34,079
obviously but um

49
00:01:34,079 --> 00:01:35,520
i'm not going to do much of a deep dive

50
00:01:35,520 --> 00:01:37,600
into what that setup process looks like

51
00:01:37,600 --> 00:01:40,560
to getting the calendar invite running

52
00:01:40,560 --> 00:01:42,320
but i'm going to more focus on you the

53
00:01:42,320 --> 00:01:44,399
pretext and how we're kind of coercing

54
00:01:44,399 --> 00:01:46,079
people into doing things they should not

55
00:01:46,079 --> 00:01:47,520
be doing

56
00:01:47,520 --> 00:01:49,600
quick run through of what that setup

57
00:01:49,600 --> 00:01:51,439
looks like you're in a google account

58
00:01:51,439 --> 00:01:53,439
you're in gcp

59
00:01:53,439 --> 00:01:54,640
i'm going to fly right through this

60
00:01:54,640 --> 00:01:57,759
thing the video is in the github repo

61
00:01:57,759 --> 00:01:58,799
basically you're just setting up an

62
00:01:58,799 --> 00:02:00,240
account you're setting up an application

63
00:02:00,240 --> 00:02:01,600
within gcp

64
00:02:01,600 --> 00:02:03,040
i'm going to screw up scrubbing through

65
00:02:03,040 --> 00:02:05,119
the window as you do

66
00:02:05,119 --> 00:02:06,880
you're setting up an oauth client on it

67
00:02:06,880 --> 00:02:08,639
and then you're getting into oauth

68
00:02:08,639 --> 00:02:10,560
playground where

69
00:02:10,560 --> 00:02:12,640
you're authorizing the oauth playground

70
00:02:12,640 --> 00:02:14,400
to access your google calendar for the

71
00:02:14,400 --> 00:02:16,480
event for the account that you set up

72
00:02:16,480 --> 00:02:17,360
here

73
00:02:17,360 --> 00:02:19,520
so the end goal here once you scrub on

74
00:02:19,520 --> 00:02:21,840
through is getting to the end where we

75
00:02:21,840 --> 00:02:23,680
can pull an access token for another

76
00:02:23,680 --> 00:02:25,360
application to access your google

77
00:02:25,360 --> 00:02:26,319
calendar

78
00:02:26,319 --> 00:02:29,040
and send events as it so that's where uh

79
00:02:29,040 --> 00:02:31,840
ba bhis is tool mail sniper comes in and

80
00:02:31,840 --> 00:02:34,319
i'm gonna flip over to an attacker box

81
00:02:34,319 --> 00:02:36,400
for a little bit of a demonstration of

82
00:02:36,400 --> 00:02:38,400
what i was doing here so basically i've

83
00:02:38,400 --> 00:02:39,840
got mail sniper already loaded right

84
00:02:39,840 --> 00:02:41,760
into powershell

85
00:02:41,760 --> 00:02:43,599
and i've got a templated out command

86
00:02:43,599 --> 00:02:45,200
here which i'm going to put a big a bit

87
00:02:45,200 --> 00:02:47,440
big on the screen here in a second

88
00:02:47,440 --> 00:02:48,800
basically what we're doing is we're

89
00:02:48,800 --> 00:02:51,760
sending a calendar invite to myself and

90
00:02:51,760 --> 00:02:53,280
i'm just filling in that access token

91
00:02:53,280 --> 00:02:54,640
and a placeholder i had sitting in the

92
00:02:54,640 --> 00:02:56,879
in the command string and

93
00:02:56,879 --> 00:02:58,480
let that play out it'll just spit out

94
00:02:58,480 --> 00:02:59,920
one little line saying it and inject it

95
00:02:59,920 --> 00:03:02,319
into that that target calendar cool it

96
00:03:02,319 --> 00:03:04,560
should be on my target's calendar now

97
00:03:04,560 --> 00:03:06,000
flip over to my calendar sometimes it

98
00:03:06,000 --> 00:03:08,239
takes a refresh to show up we got a test

99
00:03:08,239 --> 00:03:10,080
meeting so cool we just sent a calendar

100
00:03:10,080 --> 00:03:13,840
invite from myself to myself not super

101
00:03:13,840 --> 00:03:14,879
interesting

102
00:03:14,879 --> 00:03:16,319
let's break down what exactly we just

103
00:03:16,319 --> 00:03:19,120
did here so this command for mail sniper

104
00:03:19,120 --> 00:03:20,640
basically what we're

105
00:03:20,640 --> 00:03:23,040
doing on parameters is you're sending

106
00:03:23,040 --> 00:03:24,560
the primary email that is the email

107
00:03:24,560 --> 00:03:26,080
you're sending as

108
00:03:26,080 --> 00:03:27,920
your token token we just pulled out of

109
00:03:27,920 --> 00:03:29,360
out of gcp

110
00:03:29,360 --> 00:03:31,040
targets this is just double quotes comma

111
00:03:31,040 --> 00:03:32,480
separated targets you can throw a ton of

112
00:03:32,480 --> 00:03:34,239
them in there i've done 100 or so at a

113
00:03:34,239 --> 00:03:36,799
time you can you can blow that thing out

114
00:03:36,799 --> 00:03:39,200
start time and time for the event uh

115
00:03:39,200 --> 00:03:42,239
title description location super simple

116
00:03:42,239 --> 00:03:43,680
so let's look at this calendar event

117
00:03:43,680 --> 00:03:45,280
that dropped onto my targets calendar

118
00:03:45,280 --> 00:03:48,159
here test meeting zoom link to follow

119
00:03:48,159 --> 00:03:50,720
it's sent from me to me this thing sucks

120
00:03:50,720 --> 00:03:52,239
there's nothing fun about this at all

121
00:03:52,239 --> 00:03:53,599
it's not spicy at all nobody's gonna

122
00:03:53,599 --> 00:03:54,959
click it

123
00:03:54,959 --> 00:03:57,120
let's add a little more fun to it i did

124
00:03:57,120 --> 00:03:58,799
want to note too

125
00:03:58,799 --> 00:04:00,560
by design of this whole thing that

126
00:04:00,560 --> 00:04:02,000
calendar event's already accepted it's

127
00:04:02,000 --> 00:04:03,840
going to alert 10 minutes before so no

128
00:04:03,840 --> 00:04:04,959
matter what you drop on somebody's

129
00:04:04,959 --> 00:04:06,480
calendar they're going to get notified

130
00:04:06,480 --> 00:04:08,480
of it so if there's there's a higher

131
00:04:08,480 --> 00:04:09,599
chance that somebody's going to notice

132
00:04:09,599 --> 00:04:10,720
that especially if they are living out

133
00:04:10,720 --> 00:04:12,879
of their google calendar day to day

134
00:04:12,879 --> 00:04:14,400
so here's a second iteration of this

135
00:04:14,400 --> 00:04:16,880
whole whole calendar event drop um for

136
00:04:16,880 --> 00:04:20,560
this one we register bsidespgh.ctf.com

137
00:04:20,560 --> 00:04:23,040
that is my domain now i will happily

138
00:04:23,040 --> 00:04:24,720
lose that one once we are done here but

139
00:04:24,720 --> 00:04:27,120
for the moment that is mine i need it um

140
00:04:27,120 --> 00:04:29,199
set up uh set up a google set it up set

141
00:04:29,199 --> 00:04:30,960
that domain up through a google account

142
00:04:30,960 --> 00:04:33,040
so that you can send us that domain and

143
00:04:33,040 --> 00:04:35,120
set up a junk email address for human

144
00:04:35,120 --> 00:04:39,040
resources or hr at besides pgh.ctf.com

145
00:04:39,040 --> 00:04:40,560
that's a mouthful i need to trim that at

146
00:04:40,560 --> 00:04:43,120
some point here

147
00:04:43,759 --> 00:04:46,320
so the the context here we're putting is

148
00:04:46,320 --> 00:04:47,680
we're just gonna drop a random calendar

149
00:04:47,680 --> 00:04:49,520
event on somebody's calendar saying hey

150
00:04:49,520 --> 00:04:51,120
you have an hr meeting it starts at nine

151
00:04:51,120 --> 00:04:52,560
o'clock in the morning

152
00:04:52,560 --> 00:04:54,400
join immediately discuss an incident

153
00:04:54,400 --> 00:04:57,199
that's all leave it nice and bland

154
00:04:57,199 --> 00:04:58,960
because then you're just like brimming

155
00:04:58,960 --> 00:05:00,639
with details what happened what's going

156
00:05:00,639 --> 00:05:02,639
on what did i do i'm going to click the

157
00:05:02,639 --> 00:05:05,440
zoom link because it's a zoom link not a

158
00:05:05,440 --> 00:05:07,600
zoom link it's an easy trick it's an

159
00:05:07,600 --> 00:05:09,840
easy trick to do people will look over

160
00:05:09,840 --> 00:05:11,039
it though you're all you see is your

161
00:05:11,039 --> 00:05:12,639
company at the beginning it's got the

162
00:05:12,639 --> 00:05:14,240
it's got the us and the thing you expect

163
00:05:14,240 --> 00:05:16,479
at the end so whatever so that's just a

164
00:05:16,479 --> 00:05:19,280
simple one that you can do um

165
00:05:19,280 --> 00:05:22,240
so the event now looks pretty good as

166
00:05:22,240 --> 00:05:24,160
opposed to what we started as the the

167
00:05:24,160 --> 00:05:26,000
downside of this one is

168
00:05:26,000 --> 00:05:27,520
if they click the link we can kick them

169
00:05:27,520 --> 00:05:29,759
to you know a super basic app that's

170
00:05:29,759 --> 00:05:31,360
just going to capture creds we can kick

171
00:05:31,360 --> 00:05:33,440
them to an evil engine x link something

172
00:05:33,440 --> 00:05:34,960
out of modlishka little little you know

173
00:05:34,960 --> 00:05:36,400
man in the middle it might get a session

174
00:05:36,400 --> 00:05:37,520
token to

175
00:05:37,520 --> 00:05:39,600
a one login session an octa session

176
00:05:39,600 --> 00:05:41,360
something interesting that may have more

177
00:05:41,360 --> 00:05:43,840
access you may also get somebody's like

178
00:05:43,840 --> 00:05:45,840
burner home zoom creds that they just

179
00:05:45,840 --> 00:05:47,680
gave you and now you have nothing

180
00:05:47,680 --> 00:05:49,600
so what would be really fun

181
00:05:49,600 --> 00:05:50,880
is if we could

182
00:05:50,880 --> 00:05:52,720
shell an endpoint using this whole this

183
00:05:52,720 --> 00:05:54,960
whole technique and transfer method of

184
00:05:54,960 --> 00:05:56,960
dropping events on people's calendars

185
00:05:56,960 --> 00:05:58,720
so that's what this second ver this now

186
00:05:58,720 --> 00:06:01,360
third iteration of this thing is

187
00:06:01,360 --> 00:06:03,039
changes the highlight so we're still

188
00:06:03,039 --> 00:06:05,199
we're still sending from hr at b sides

189
00:06:05,199 --> 00:06:07,199
same target start time end time i love

190
00:06:07,199 --> 00:06:08,960
doing nine in the morning nine in the

191
00:06:08,960 --> 00:06:10,479
morning to their

192
00:06:10,479 --> 00:06:12,720
their standard time wherever they're at

193
00:06:12,720 --> 00:06:13,919
you're kind of woozy you might be

194
00:06:13,919 --> 00:06:16,240
hungover you're not as likely to

195
00:06:16,240 --> 00:06:18,160
second-guess a weird link

196
00:06:18,160 --> 00:06:19,440
this time we targeted out where we're

197
00:06:19,440 --> 00:06:20,639
saying there's federal compliance

198
00:06:20,639 --> 00:06:22,720
requirement that required next steps and

199
00:06:22,720 --> 00:06:24,000
we give them some links to some google

200
00:06:24,000 --> 00:06:25,759
docs you need to review these steps to

201
00:06:25,759 --> 00:06:27,600
get these steps completed so now we're

202
00:06:27,600 --> 00:06:29,440
pushing them off to some further

203
00:06:29,440 --> 00:06:30,960
instructions to to give them something

204
00:06:30,960 --> 00:06:33,120
more more malicious to do

205
00:06:33,120 --> 00:06:36,160
so what we run for this campaign

206
00:06:36,160 --> 00:06:38,160
is something like these two google docs

207
00:06:38,160 --> 00:06:39,520
i've got up here

208
00:06:39,520 --> 00:06:40,400
again

209
00:06:40,400 --> 00:06:42,639
full credit to a previous colleague who

210
00:06:42,639 --> 00:06:44,080
set up this kind of format and worked in

211
00:06:44,080 --> 00:06:45,440
some of the really

212
00:06:45,440 --> 00:06:48,240
legal easy kind of scary language um

213
00:06:48,240 --> 00:06:50,479
basically what this google doc is

214
00:06:50,479 --> 00:06:52,000
stating and we're just telling the user

215
00:06:52,000 --> 00:06:54,720
a story right now of um

216
00:06:54,720 --> 00:06:56,319
there's an upcoming fedramp audit for

217
00:06:56,319 --> 00:06:58,639
the b-sides pgh ctf

218
00:06:58,639 --> 00:07:00,479
federal offering

219
00:07:00,479 --> 00:07:02,479
that's a lot so we're telling them that

220
00:07:02,479 --> 00:07:04,160
there's bad stuff going they think that

221
00:07:04,160 --> 00:07:06,479
there's compliance audit coming up um we

222
00:07:06,479 --> 00:07:08,000
give them a call to action saying that

223
00:07:08,000 --> 00:07:09,759
failure to complete these steps could

224
00:07:09,759 --> 00:07:11,360
result in high finding on the audit an

225
00:07:11,360 --> 00:07:12,880
appropriate action may be taken against

226
00:07:12,880 --> 00:07:13,680
you

227
00:07:13,680 --> 00:07:15,360
nobody wants to be that person that

228
00:07:15,360 --> 00:07:17,039
doesn't do something then causes a high

229
00:07:17,039 --> 00:07:18,479
finding on an audit but you also don't

230
00:07:18,479 --> 00:07:20,479
want to be the one that does too much

231
00:07:20,479 --> 00:07:21,759
and then you cause the high finding on

232
00:07:21,759 --> 00:07:24,639
the audit so it's a tough one uh the mac

233
00:07:24,639 --> 00:07:26,639
example here extremes instructs the user

234
00:07:26,639 --> 00:07:28,240
on how to open terminal via spotlight

235
00:07:28,240 --> 00:07:29,599
then tells them to copy and paste this

236
00:07:29,599 --> 00:07:31,280
curl command into their terminal and run

237
00:07:31,280 --> 00:07:33,039
it

238
00:07:33,039 --> 00:07:35,599
the curl command runs a uh all it does

239
00:07:35,599 --> 00:07:37,599
is pulls it pulls a remote script from

240
00:07:37,599 --> 00:07:39,280
my attacker box sitting out you know in

241
00:07:39,280 --> 00:07:40,880
like ec2 or wherever you want to host

242
00:07:40,880 --> 00:07:42,319
the thing

243
00:07:42,319 --> 00:07:44,639
it isn't readily malicious just looking

244
00:07:44,639 --> 00:07:46,080
at it if you've ever installed like home

245
00:07:46,080 --> 00:07:48,560
brew on a mac homebrews homepage has you

246
00:07:48,560 --> 00:07:50,160
install it just the same way it's one

247
00:07:50,160 --> 00:07:51,599
big gross curl command that then pipes

248
00:07:51,599 --> 00:07:52,960
into bash and it takes care of an

249
00:07:52,960 --> 00:07:55,199
install everything that is homebrew on

250
00:07:55,199 --> 00:07:57,759
your mac so it's not super malicious um

251
00:07:57,759 --> 00:08:00,000
i also always giggle at the the

252
00:08:00,000 --> 00:08:01,919
powershell encoded command example

253
00:08:01,919 --> 00:08:03,120
because that thing

254
00:08:03,120 --> 00:08:06,479
looks like hell that's terrifying but

255
00:08:06,479 --> 00:08:08,000
apparently that's just me that thinks

256
00:08:08,000 --> 00:08:10,319
that because people still run the thing

257
00:08:10,319 --> 00:08:11,199
so

258
00:08:11,199 --> 00:08:12,639
here's what that campaign actually looks

259
00:08:12,639 --> 00:08:14,960
like live so just to break down what

260
00:08:14,960 --> 00:08:16,400
we're looking at here

261
00:08:16,400 --> 00:08:18,000
top right terminal

262
00:08:18,000 --> 00:08:20,639
up yonder that is my ec2 box that's got

263
00:08:20,639 --> 00:08:22,240
just an apache web server sitting on it

264
00:08:22,240 --> 00:08:23,759
i'm just tailing the access logs right

265
00:08:23,759 --> 00:08:25,599
now so we can see any traffic coming

266
00:08:25,599 --> 00:08:27,759
back because we oh

267
00:08:27,759 --> 00:08:29,360
go back

268
00:08:29,360 --> 00:08:30,560
round two

269
00:08:30,560 --> 00:08:32,320
we're back to the attacker box on the

270
00:08:32,320 --> 00:08:34,240
left side you have my victim machine

271
00:08:34,240 --> 00:08:35,760
where the victim just ran that curl

272
00:08:35,760 --> 00:08:36,880
command

273
00:08:36,880 --> 00:08:38,240
it's a little small i'm going to put up

274
00:08:38,240 --> 00:08:40,080
a next next slide that kind of breaks it

275
00:08:40,080 --> 00:08:42,159
out more but all the script does right

276
00:08:42,159 --> 00:08:44,560
now is says hey i see you're a mac i'm

277
00:08:44,560 --> 00:08:46,800
configuring the environment we're gonna

278
00:08:46,800 --> 00:08:48,959
start doing some checks and whatever and

279
00:08:48,959 --> 00:08:50,399
we put on you know

280
00:08:50,399 --> 00:08:52,000
the song and dance of normal things are

281
00:08:52,000 --> 00:08:53,200
happening here

282
00:08:53,200 --> 00:08:54,880
you get a keychain access pop-up box

283
00:08:54,880 --> 00:08:56,160
saying it wants your admin password

284
00:08:56,160 --> 00:08:58,800
right now that's pretty standard for a

285
00:08:58,800 --> 00:09:00,959
mac user it's you know a lot of mac

286
00:09:00,959 --> 00:09:02,399
users are going to be local admins on

287
00:09:02,399 --> 00:09:04,000
this machine because it's

288
00:09:04,000 --> 00:09:05,760
just about miserable to not be an admin

289
00:09:05,760 --> 00:09:07,440
on your mac so

290
00:09:07,440 --> 00:09:09,200
um

291
00:09:09,200 --> 00:09:10,480
that's a pretty common thing you're

292
00:09:10,480 --> 00:09:11,920
gonna get so they'll probably just chuck

293
00:09:11,920 --> 00:09:13,600
their password right into it if you do

294
00:09:13,600 --> 00:09:15,200
notice it's not you know starring out

295
00:09:15,200 --> 00:09:17,120
the password there's a reason for that

296
00:09:17,120 --> 00:09:19,680
um that script will then run it says it

297
00:09:19,680 --> 00:09:21,680
runs its configs it's on a sleep right

298
00:09:21,680 --> 00:09:23,839
now for uh 10 seconds and then it just

299
00:09:23,839 --> 00:09:24,880
completes and says that everything's

300
00:09:24,880 --> 00:09:26,480
fine go ahead and close the window

301
00:09:26,480 --> 00:09:28,320
so i pulled the attacker box back up

302
00:09:28,320 --> 00:09:29,680
right at the end of that clip where we

303
00:09:29,680 --> 00:09:31,839
have this big gross blob of base64 that

304
00:09:31,839 --> 00:09:34,240
got posted back to my apache server

305
00:09:34,240 --> 00:09:35,519
so what just happened here what did this

306
00:09:35,519 --> 00:09:37,760
user just do

307
00:09:37,760 --> 00:09:39,440
code on screens this is gonna be great

308
00:09:39,440 --> 00:09:40,880
i'm sure it looks wonderful

309
00:09:40,880 --> 00:09:42,959
the left script is the very first script

310
00:09:42,959 --> 00:09:44,800
that this user called this script is

311
00:09:44,800 --> 00:09:46,480
total bs except for one line of it

312
00:09:46,480 --> 00:09:47,680
that's highlighted in bold right in the

313
00:09:47,680 --> 00:09:49,440
dead middle where it's basically just

314
00:09:49,440 --> 00:09:51,040
giving all of the song and dance it's

315
00:09:51,040 --> 00:09:52,160
saying that you're setting up the

316
00:09:52,160 --> 00:09:53,760
environment you're doing this and that

317
00:09:53,760 --> 00:09:55,200
everything's fine thank you for running

318
00:09:55,200 --> 00:09:56,560
this curl script

319
00:09:56,560 --> 00:09:57,839
dead center of it it's calling a

320
00:09:57,839 --> 00:09:59,920
secondary script so that's what's on the

321
00:09:59,920 --> 00:10:02,480
right side um on this one we give up the

322
00:10:02,480 --> 00:10:03,839
campaign at this point we'll be a little

323
00:10:03,839 --> 00:10:05,440
nice about it if there's blue team chase

324
00:10:05,440 --> 00:10:08,079
on the chasing us around um

325
00:10:08,079 --> 00:10:10,240
we'll say outright that if the this if

326
00:10:10,240 --> 00:10:11,760
you've landed on this page it's a an

327
00:10:11,760 --> 00:10:14,480
approved campaign please contact phil

328
00:10:14,480 --> 00:10:16,320
it won't always be phil it'll usually be

329
00:10:16,320 --> 00:10:17,680
like a point of contact for the company

330
00:10:17,680 --> 00:10:19,200
someone we're working with on the pen

331
00:10:19,200 --> 00:10:20,640
test

332
00:10:20,640 --> 00:10:23,279
a little more trustworthy not phil

333
00:10:23,279 --> 00:10:25,760
and then below i have a whole string of

334
00:10:25,760 --> 00:10:27,360
variables that are getting run on this

335
00:10:27,360 --> 00:10:29,600
user's machine right now so basically

336
00:10:29,600 --> 00:10:31,120
we're just stacking up any command i

337
00:10:31,120 --> 00:10:32,240
want to run on this machine i'm

338
00:10:32,240 --> 00:10:33,839
gathering the input for it

339
00:10:33,839 --> 00:10:36,240
stacking it into some variables and then

340
00:10:36,240 --> 00:10:38,160
bringing it all back and that that big

341
00:10:38,160 --> 00:10:40,160
gross post message you saw here

342
00:10:40,160 --> 00:10:42,240
number four this dialogue text osa

343
00:10:42,240 --> 00:10:44,560
script box that is just a big chunk of

344
00:10:44,560 --> 00:10:46,160
applescript that all it's doing is

345
00:10:46,160 --> 00:10:48,240
drawing that box it's drawing a text box

346
00:10:48,240 --> 00:10:50,720
in it it's telling it to have no uh

347
00:10:50,720 --> 00:10:52,640
character sitting in it already and then

348
00:10:52,640 --> 00:10:54,880
that last little bit for this system

349
00:10:54,880 --> 00:10:56,880
applications utilities keychain part is

350
00:10:56,880 --> 00:10:58,399
just pulling the icon for the actual

351
00:10:58,399 --> 00:10:59,920
keychain application it's in the same

352
00:10:59,920 --> 00:11:02,079
place on every mac so let's use it it

353
00:11:02,079 --> 00:11:04,800
looks all the better

354
00:11:05,200 --> 00:11:06,560
excuse me

355
00:11:06,560 --> 00:11:08,560
and finally in number five

356
00:11:08,560 --> 00:11:09,680
all those

357
00:11:09,680 --> 00:11:11,120
variables that we just pulled from that

358
00:11:11,120 --> 00:11:12,720
machine are all getting gathered into a

359
00:11:12,720 --> 00:11:15,120
single string variable and base 64

360
00:11:15,120 --> 00:11:16,800
encoded and then the whole thing gets

361
00:11:16,800 --> 00:11:19,519
curl posted back to my apache server so

362
00:11:19,519 --> 00:11:21,200
this is just a pile of x fill that we

363
00:11:21,200 --> 00:11:22,720
just got a user to run

364
00:11:22,720 --> 00:11:23,600
so

365
00:11:23,600 --> 00:11:25,680
what that looks like once we take it out

366
00:11:25,680 --> 00:11:27,680
and decode it again that's the blob that

367
00:11:27,680 --> 00:11:28,560
we got

368
00:11:28,560 --> 00:11:30,079
cyber chef in the background nothing

369
00:11:30,079 --> 00:11:32,480
fancy do a base64 double the code paste

370
00:11:32,480 --> 00:11:34,320
that blob in there and now we got all

371
00:11:34,320 --> 00:11:35,680
this beautiful information out of this

372
00:11:35,680 --> 00:11:37,839
user's machine we know the username that

373
00:11:37,839 --> 00:11:39,360
ran it we know the name of the hostname

374
00:11:39,360 --> 00:11:40,640
in the machine we know the build and

375
00:11:40,640 --> 00:11:42,079
various different little details will be

376
00:11:42,079 --> 00:11:43,760
nice and unique

377
00:11:43,760 --> 00:11:45,360
we also grabbed the b-side rules

378
00:11:45,360 --> 00:11:47,040
password that was put into that box into

379
00:11:47,040 --> 00:11:48,800
the keychain access box as well as some

380
00:11:48,800 --> 00:11:51,839
aws keys so this user just gave us a

381
00:11:51,839 --> 00:11:54,600
wonderful foothold into a potential

382
00:11:54,600 --> 00:11:57,040
environment so that's just a real

383
00:11:57,040 --> 00:11:59,360
slimmed down example also of what we can

384
00:11:59,360 --> 00:12:01,839
pull back i've done fancier versions of

385
00:12:01,839 --> 00:12:03,200
that where you do

386
00:12:03,200 --> 00:12:05,839
i did a third script one time where you

387
00:12:05,839 --> 00:12:08,320
fork it and have it do clipboard dumping

388
00:12:08,320 --> 00:12:10,320
basically and every five minutes it was

389
00:12:10,320 --> 00:12:11,680
just pasting the clipboard into a

390
00:12:11,680 --> 00:12:13,040
variable and then kicking it back to me

391
00:12:13,040 --> 00:12:14,560
with an identifier so i knew which

392
00:12:14,560 --> 00:12:16,320
machine it came from so you're basically

393
00:12:16,320 --> 00:12:17,760
key logging at that point and that thing

394
00:12:17,760 --> 00:12:19,680
was just forked and set to run for i

395
00:12:19,680 --> 00:12:21,600
think it's about to run for an hour and

396
00:12:21,600 --> 00:12:23,920
i got a ton of stuff back of that so i

397
00:12:23,920 --> 00:12:25,120
mean it's all about what the client's

398
00:12:25,120 --> 00:12:26,160
comfortable with obviously we're not

399
00:12:26,160 --> 00:12:27,519
going to go too aggressive without their

400
00:12:27,519 --> 00:12:29,680
approval but yeah that's just an example

401
00:12:29,680 --> 00:12:31,120
of what kind of data you can get back

402
00:12:31,120 --> 00:12:32,560
from people

403
00:12:32,560 --> 00:12:33,760
for the windows version of that whole

404
00:12:33,760 --> 00:12:34,880
script i cheaped out you get a

405
00:12:34,880 --> 00:12:36,720
screenshot of a powershell window all it

406
00:12:36,720 --> 00:12:38,320
does is it just says checking pc

407
00:12:38,320 --> 00:12:40,079
configuration it says it's complete

408
00:12:40,079 --> 00:12:41,760
close the window whatever and then the

409
00:12:41,760 --> 00:12:43,519
string you get back once it's decoded is

410
00:12:43,519 --> 00:12:45,680
just a hostname and who am i

411
00:12:45,680 --> 00:12:47,519
which was redundant in this case because

412
00:12:47,519 --> 00:12:49,279
the the who am i had the host name and

413
00:12:49,279 --> 00:12:51,040
machine in it that's what you get there

414
00:12:51,040 --> 00:12:53,279
from windows um points made though

415
00:12:53,279 --> 00:12:55,440
you're uh you're executing code at this

416
00:12:55,440 --> 00:12:57,279
point we're getting code execution on

417
00:12:57,279 --> 00:12:58,720
remote endpoints

418
00:12:58,720 --> 00:13:01,519
some people would say this is not that

419
00:13:01,519 --> 00:13:03,440
malicious you're not really emulating an

420
00:13:03,440 --> 00:13:06,720
active attack my edr av x-amount

421
00:13:06,720 --> 00:13:08,320
solution would detect it if it were

422
00:13:08,320 --> 00:13:09,440
malicious

423
00:13:09,440 --> 00:13:12,880
i disagree i would say that an active

424
00:13:12,880 --> 00:13:14,480
persistent attacker is going to scope

425
00:13:14,480 --> 00:13:16,079
out your environment to death and they

426
00:13:16,079 --> 00:13:17,440
will get this thing right and evade

427
00:13:17,440 --> 00:13:18,800
whatever control you got in place and

428
00:13:18,800 --> 00:13:19,680
they're still going to get that code

429
00:13:19,680 --> 00:13:21,360
execution so now they're still going to

430
00:13:21,360 --> 00:13:22,720
potentially land on an end user's

431
00:13:22,720 --> 00:13:24,240
machine and then go wherever they can

432
00:13:24,240 --> 00:13:25,760
from there

433
00:13:25,760 --> 00:13:27,680
so

434
00:13:27,680 --> 00:13:29,440
moving on to a little more fancy version

435
00:13:29,440 --> 00:13:30,720
of this this

436
00:13:30,720 --> 00:13:32,320
whole campaign i decided at some point

437
00:13:32,320 --> 00:13:34,000
that the curl command was too suspicious

438
00:13:34,000 --> 00:13:35,760
that's a little too weird

439
00:13:35,760 --> 00:13:37,440
let's over complicate it to death and

440
00:13:37,440 --> 00:13:39,839
say we're going to backdoor firefox and

441
00:13:39,839 --> 00:13:42,000
have users download that

442
00:13:42,000 --> 00:13:43,279
so

443
00:13:43,279 --> 00:13:45,839
let's make up a campaign here for this

444
00:13:45,839 --> 00:13:47,600
doc i'm telling the users that we're

445
00:13:47,600 --> 00:13:49,120
rolling out a federally optimized

446
00:13:49,120 --> 00:13:52,800
version of firefox

447
00:13:53,440 --> 00:13:55,839
the binary that they're clicking here

448
00:13:55,839 --> 00:13:58,880
i i reworked if you've ever used mythic

449
00:13:58,880 --> 00:14:01,120
c2 there's a dev out there i know his

450
00:14:01,120 --> 00:14:02,480
name's doom fist i have no idea who that

451
00:14:02,480 --> 00:14:03,760
person actually is

452
00:14:03,760 --> 00:14:04,720
um

453
00:14:04,720 --> 00:14:06,480
he made the super cool connector into

454
00:14:06,480 --> 00:14:09,440
mythic c2 where basically it just ties

455
00:14:09,440 --> 00:14:11,680
right in yanks a payload packages it up

456
00:14:11,680 --> 00:14:14,480
beautifully in a dmg a pdf he's got a

457
00:14:14,480 --> 00:14:16,160
whole ton of containers in there that do

458
00:14:16,160 --> 00:14:17,760
wonderful things

459
00:14:17,760 --> 00:14:19,519
it's all super cool it's a little

460
00:14:19,519 --> 00:14:21,519
aggressive for my use case here you know

461
00:14:21,519 --> 00:14:22,880
for what i really need to get out of

462
00:14:22,880 --> 00:14:23,920
people i just need to know whether they

463
00:14:23,920 --> 00:14:26,240
ran the command shelling all these boxes

464
00:14:26,240 --> 00:14:27,760
is super fun and all but clients don't

465
00:14:27,760 --> 00:14:29,600
usually appreciate it and it makes

466
00:14:29,600 --> 00:14:31,600
cleanup a little messy so trying to take

467
00:14:31,600 --> 00:14:33,519
a bit of a softer touch here

468
00:14:33,519 --> 00:14:36,240
so that's what this app fisher

469
00:14:36,240 --> 00:14:37,920
repo at the bottom

470
00:14:37,920 --> 00:14:40,240
top right is i wrote up that i just

471
00:14:40,240 --> 00:14:41,839
basically took his project ripped it

472
00:14:41,839 --> 00:14:43,920
pieces and pulled it down to where all

473
00:14:43,920 --> 00:14:45,279
it does is look for your applications

474
00:14:45,279 --> 00:14:47,680
folder if firefox is installed yanks it

475
00:14:47,680 --> 00:14:49,519
into a build directory it replaces the

476
00:14:49,519 --> 00:14:52,399
main firefox executable with my own uh

477
00:14:52,399 --> 00:14:53,839
crypt with my own

478
00:14:53,839 --> 00:14:55,680
shell script which all it is doing is

479
00:14:55,680 --> 00:14:57,600
just the same curl command it's all just

480
00:14:57,600 --> 00:14:59,839
nestled inside firefox and then at the

481
00:14:59,839 --> 00:15:01,519
end of it it also calls the actual

482
00:15:01,519 --> 00:15:04,079
firefox binary so as far as the user is

483
00:15:04,079 --> 00:15:05,519
concerned they just ran firefox they

484
00:15:05,519 --> 00:15:06,880
don't know all the nastiness that just

485
00:15:06,880 --> 00:15:08,959
happened background a downside of this

486
00:15:08,959 --> 00:15:10,560
whole situation is

487
00:15:10,560 --> 00:15:13,440
in doing so we broke signing on firefox

488
00:15:13,440 --> 00:15:14,279
and it's now going to have an

489
00:15:14,279 --> 00:15:17,199
unidentified developer pop-up come up

490
00:15:17,199 --> 00:15:18,399
as you know it normally wouldn't do that

491
00:15:18,399 --> 00:15:20,160
because it's firefox

492
00:15:20,160 --> 00:15:21,199
um

493
00:15:21,199 --> 00:15:22,639
it's worth saying too i stuck with using

494
00:15:22,639 --> 00:15:24,880
the dmg method of transfer just because

495
00:15:24,880 --> 00:15:26,560
i know like isos are kind of hot right

496
00:15:26,560 --> 00:15:28,399
now for evading av

497
00:15:28,399 --> 00:15:30,560
as far as macs go mac users download

498
00:15:30,560 --> 00:15:32,240
dmgs all the time it's pretty standard

499
00:15:32,240 --> 00:15:33,839
it's pretty normal it's pretty it's

500
00:15:33,839 --> 00:15:35,279
pretty safe it's going to get their fine

501
00:15:35,279 --> 00:15:36,639
so you just know it's going to land on

502
00:15:36,639 --> 00:15:39,040
the user's machine without any trouble

503
00:15:39,040 --> 00:15:41,120
back to the instructions so this is the

504
00:15:41,120 --> 00:15:43,360
google doc heavily cropped to try to

505
00:15:43,360 --> 00:15:45,519
make all this madness fit on one slide

506
00:15:45,519 --> 00:15:46,639
all we're doing is we're telling the

507
00:15:46,639 --> 00:15:48,720
user to download firefox from this link

508
00:15:48,720 --> 00:15:50,959
firefox fed from this link i have a

509
00:15:50,959 --> 00:15:54,240
github repo that is bsidespgh.ctf

510
00:15:54,240 --> 00:15:55,600
that is also mine

511
00:15:55,600 --> 00:15:57,360
can have that as well i want it for

512
00:15:57,360 --> 00:15:58,800
right now though

513
00:15:58,800 --> 00:16:00,800
that one's a really great idea that

514
00:16:00,800 --> 00:16:03,120
whenever you download that that firefox

515
00:16:03,120 --> 00:16:04,160
dmg

516
00:16:04,160 --> 00:16:06,480
you don't get you know a

517
00:16:06,480 --> 00:16:08,639
pop-up saying that this dmg is coming

518
00:16:08,639 --> 00:16:09,440
from

519
00:16:09,440 --> 00:16:12,399
sketchy domains with sketchydmgs.com

520
00:16:12,399 --> 00:16:14,240
it's coming from github it's fine it's

521
00:16:14,240 --> 00:16:16,160
trusted you run it just run the code

522
00:16:16,160 --> 00:16:17,759
from github it'll be okay

523
00:16:17,759 --> 00:16:20,720
and people do so it adds adds a level of

524
00:16:20,720 --> 00:16:22,800
trust to the whole thing further down

525
00:16:22,800 --> 00:16:24,160
through the steps that i gave them here

526
00:16:24,160 --> 00:16:27,519
i tell them not to copy firefox fed out

527
00:16:27,519 --> 00:16:29,839
to their applications folder like dmgs

528
00:16:29,839 --> 00:16:31,440
commonly tell you to do

529
00:16:31,440 --> 00:16:33,600
i do that for two reasons

530
00:16:33,600 --> 00:16:34,880
one i'm trying to be a little nice about

531
00:16:34,880 --> 00:16:36,000
the campaign that's aggressive and

532
00:16:36,000 --> 00:16:37,040
downloading malware on people's

533
00:16:37,040 --> 00:16:38,720
computers and make cleanup a little bit

534
00:16:38,720 --> 00:16:40,320
easier so that way all they should have

535
00:16:40,320 --> 00:16:42,880
to do is just kill firefox eject the dmg

536
00:16:42,880 --> 00:16:44,399
and chuck it in the trash

537
00:16:44,399 --> 00:16:46,079
done you're clean after that

538
00:16:46,079 --> 00:16:47,839
a second part of that is also just you

539
00:16:47,839 --> 00:16:49,600
know to avoid

540
00:16:49,600 --> 00:16:51,839
further detections if possible yeah

541
00:16:51,839 --> 00:16:54,320
that's a bit of a two-parter um the fun

542
00:16:54,320 --> 00:16:56,240
part of this campaign too since we broke

543
00:16:56,240 --> 00:16:58,160
the signing and verification

544
00:16:58,160 --> 00:17:00,160
i tell them right in the steps click

545
00:17:00,160 --> 00:17:01,680
cancel whenever you get the pop-up that

546
00:17:01,680 --> 00:17:03,759
says hey the developer is uh not you

547
00:17:03,759 --> 00:17:05,199
know we don't know who the developer is

548
00:17:05,199 --> 00:17:06,720
they're in parentheses you know it's

549
00:17:06,720 --> 00:17:08,000
apple's fault we're waiting on them to

550
00:17:08,000 --> 00:17:10,000
approve our certificate it'll be taken

551
00:17:10,000 --> 00:17:11,520
care of in a future release don't worry

552
00:17:11,520 --> 00:17:12,799
about it you're just setting

553
00:17:12,799 --> 00:17:14,240
expectations and as long as everything

554
00:17:14,240 --> 00:17:16,079
goes as you're telling them they're like

555
00:17:16,079 --> 00:17:17,679
yeah this is normal the sketchy google

556
00:17:17,679 --> 00:17:19,760
doc told me that was fine so

557
00:17:19,760 --> 00:17:21,039
it's probably fine

558
00:17:21,039 --> 00:17:22,000
so then you just tell them to right

559
00:17:22,000 --> 00:17:23,439
click open it they'll get the open thing

560
00:17:23,439 --> 00:17:25,520
skip past the developers unknown

561
00:17:25,520 --> 00:17:27,199
so for this one for the keychain prompt

562
00:17:27,199 --> 00:17:28,640
i tweaked it up a little bit and i say

563
00:17:28,640 --> 00:17:30,160
so i want your keychain password because

564
00:17:30,160 --> 00:17:32,960
we need admin for reasons then with no

565
00:17:32,960 --> 00:17:34,720
spaces i want you to add in your mfa

566
00:17:34,720 --> 00:17:39,039
token at the end from your one login app

567
00:17:39,360 --> 00:17:42,320
that one came out of a

568
00:17:42,320 --> 00:17:44,720
campaign where a client was using yubi

569
00:17:44,720 --> 00:17:47,120
keys everywhere and it took a minute for

570
00:17:47,120 --> 00:17:49,440
me to like dial it back and go

571
00:17:49,440 --> 00:17:51,280
well i mean ubi keys get lost they get

572
00:17:51,280 --> 00:17:52,640
broken they've got to have a backup

573
00:17:52,640 --> 00:17:54,559
method here one login they're using one

574
00:17:54,559 --> 00:17:56,720
login as a backup method so everybody's

575
00:17:56,720 --> 00:17:59,039
got one login and they're yubikey so

576
00:17:59,039 --> 00:18:00,320
just tell them not to use the yubikey i

577
00:18:00,320 --> 00:18:02,080
want your one login token

578
00:18:02,080 --> 00:18:03,520
again you're telling the user what to do

579
00:18:03,520 --> 00:18:04,799
they'll probably just do it it all seems

580
00:18:04,799 --> 00:18:07,520
normal kind of

581
00:18:07,520 --> 00:18:09,200
so then finally for the last step down

582
00:18:09,200 --> 00:18:10,480
here i give them something to do at the

583
00:18:10,480 --> 00:18:13,360
end to kind of close the loop

584
00:18:13,360 --> 00:18:14,720
we tell them that the application should

585
00:18:14,720 --> 00:18:16,960
launch if it doesn't make sure you hit

586
00:18:16,960 --> 00:18:18,320
that it failed button the relevant

587
00:18:18,320 --> 00:18:20,240
information will be gathered and sent to

588
00:18:20,240 --> 00:18:22,000
the development team again that's a

589
00:18:22,000 --> 00:18:24,240
two-parter we're trying to a

590
00:18:24,240 --> 00:18:25,840
give the user closure on the whole

591
00:18:25,840 --> 00:18:27,360
campaign it's done they're happy they

592
00:18:27,360 --> 00:18:28,559
feel like they did what they were told

593
00:18:28,559 --> 00:18:30,880
to do by sketchy google doc but also

594
00:18:30,880 --> 00:18:32,080
they're not going to open up a help desk

595
00:18:32,080 --> 00:18:34,640
ticket or report it to a sock saying hey

596
00:18:34,640 --> 00:18:36,160
what's this thing we were supposed to i

597
00:18:36,160 --> 00:18:37,440
did it and it's not working what are we

598
00:18:37,440 --> 00:18:39,039
doing here so hopefully keep it from

599
00:18:39,039 --> 00:18:40,840
getting burned too early too

600
00:18:40,840 --> 00:18:44,000
so again it's just a big pile of uh tell

601
00:18:44,000 --> 00:18:45,600
the users what to expect and they'll

602
00:18:45,600 --> 00:18:47,840
they'll usually follow you right along

603
00:18:47,840 --> 00:18:50,080
what that campaign looks like live is

604
00:18:50,080 --> 00:18:51,200
like this

605
00:18:51,200 --> 00:18:53,440
so here we got my target he's got lots

606
00:18:53,440 --> 00:18:55,039
of fun calendar events up because i

607
00:18:55,039 --> 00:18:56,240
didn't clear any of them before i took

608
00:18:56,240 --> 00:18:57,280
the video

609
00:18:57,280 --> 00:18:59,039
so he's got all stack of them here he's

610
00:18:59,039 --> 00:19:00,799
going to flip over to the google doc

611
00:19:00,799 --> 00:19:02,720
this is what the actual google doc looks

612
00:19:02,720 --> 00:19:04,000
like when it's not all blown out and

613
00:19:04,000 --> 00:19:06,320
cropped and

614
00:19:06,320 --> 00:19:08,320
i think i second-guess it like crazy i

615
00:19:08,320 --> 00:19:09,919
don't think it looks terrible but also

616
00:19:09,919 --> 00:19:11,679
it looks terrible so

617
00:19:11,679 --> 00:19:13,600
it's it's a tough one to justify but

618
00:19:13,600 --> 00:19:14,799
then user follows the steps he's

619
00:19:14,799 --> 00:19:17,200
downloading firefox fed hits allow on it

620
00:19:17,200 --> 00:19:18,799
to download it it did say it was coming

621
00:19:18,799 --> 00:19:20,880
from github.com so not somewhere sketchy

622
00:19:20,880 --> 00:19:23,280
weird run it

623
00:19:23,280 --> 00:19:24,400
should be able to right click and open

624
00:19:24,400 --> 00:19:25,120
it

625
00:19:25,120 --> 00:19:27,440
as soon as i previous me quit screwing

626
00:19:27,440 --> 00:19:28,720
around

627
00:19:28,720 --> 00:19:31,520
there you go get going me

628
00:19:31,520 --> 00:19:33,520
right click and open it pops up

629
00:19:33,520 --> 00:19:34,960
gatekeeper does say it's just got the

630
00:19:34,960 --> 00:19:37,280
mark of the web on it proceed as normal

631
00:19:37,280 --> 00:19:39,360
i want your i want your admin password i

632
00:19:39,360 --> 00:19:41,760
want your mfa token

633
00:19:41,760 --> 00:19:43,440
firefox opens

634
00:19:43,440 --> 00:19:46,160
nothing the sketchier so as far as users

635
00:19:46,160 --> 00:19:47,840
know it's it's it's there's nothing

636
00:19:47,840 --> 00:19:50,240
super malicious going on here just

637
00:19:50,240 --> 00:19:51,760
because we set all those expectations we

638
00:19:51,760 --> 00:19:53,200
kind of built the story

639
00:19:53,200 --> 00:19:53,919
and

640
00:19:53,919 --> 00:19:55,600
i i think it's a it's it's a weird

641
00:19:55,600 --> 00:19:57,760
campaign to do too where you're almost

642
00:19:57,760 --> 00:20:00,240
like if somebody trusts this thing

643
00:20:00,240 --> 00:20:02,240
it's got to be a really hacky i.t

644
00:20:02,240 --> 00:20:03,760
department or something that does weird

645
00:20:03,760 --> 00:20:06,080
stuff because like this is not a normal

646
00:20:06,080 --> 00:20:08,080
way to deploy an application and that's

647
00:20:08,080 --> 00:20:09,760
usually what i kind of much more

648
00:20:09,760 --> 00:20:12,080
professionally say as a remediation

649
00:20:12,080 --> 00:20:13,520
effort you know obviously user training

650
00:20:13,520 --> 00:20:15,760
don't run random code from random places

651
00:20:15,760 --> 00:20:17,120
think about these three things you know

652
00:20:17,120 --> 00:20:18,640
where'd this calendar event come from do

653
00:20:18,640 --> 00:20:20,720
i know this domain do i know this person

654
00:20:20,720 --> 00:20:22,720
you know the application is it is it

655
00:20:22,720 --> 00:20:24,640
expected have you been told about this

656
00:20:24,640 --> 00:20:26,400
at all has there been any internal

657
00:20:26,400 --> 00:20:28,080
communication that a federally optimized

658
00:20:28,080 --> 00:20:30,159
version of firefox is coming out

659
00:20:30,159 --> 00:20:32,159
sounds suspicious but you know people

660
00:20:32,159 --> 00:20:34,559
people do it so that's just a really

661
00:20:34,559 --> 00:20:37,360
weird way to to attack max max

662
00:20:37,360 --> 00:20:39,520
specifically and uh

663
00:20:39,520 --> 00:20:41,200
you can use the google calendar way to

664
00:20:41,200 --> 00:20:42,799
do it you can technically just send them

665
00:20:42,799 --> 00:20:44,640
the doc i've done that way too since

666
00:20:44,640 --> 00:20:46,960
google docs go through email perfectly

667
00:20:46,960 --> 00:20:48,159
fine i mean what's going to flag on a

668
00:20:48,159 --> 00:20:50,240
google doc link in an email so at least

669
00:20:50,240 --> 00:20:51,600
it's not just an evil engine x link

670
00:20:51,600 --> 00:20:52,799
that's going to get scanned to hell and

671
00:20:52,799 --> 00:20:54,559
then burned and then your campaign's

672
00:20:54,559 --> 00:20:57,200
torched in no time it's a google doc

673
00:20:57,200 --> 00:20:59,520
and it's one of those things that i know

674
00:20:59,520 --> 00:21:01,200
like bhis has reported the thing to

675
00:21:01,200 --> 00:21:03,280
death google don't care it's a feature

676
00:21:03,280 --> 00:21:05,600
they love it so that campaign's hanging

677
00:21:05,600 --> 00:21:06,559
around for a while i'm gonna keep

678
00:21:06,559 --> 00:21:08,080
running it until it gets until it gets

679
00:21:08,080 --> 00:21:10,159
boring in some way

680
00:21:10,159 --> 00:21:12,080
so

681
00:21:12,080 --> 00:21:14,159
i'll i'll pause there for a hot sec

682
00:21:14,159 --> 00:21:16,159
before i go into the second the second

683
00:21:16,159 --> 00:21:17,840
phishing vector i'ma talk about

684
00:21:17,840 --> 00:21:19,840
questions at all

685
00:21:19,840 --> 00:21:21,200
thoughts

686
00:21:21,200 --> 00:21:23,760
go for it

687
00:21:24,720 --> 00:21:27,200
have i tried this attack with microsoft

688
00:21:27,200 --> 00:21:29,760
specifically

689
00:21:29,760 --> 00:21:31,600
i did go down that road actually after

690
00:21:31,600 --> 00:21:33,200
uh the previous co-worker had set this

691
00:21:33,200 --> 00:21:34,240
whole thing up and i went there's got to

692
00:21:34,240 --> 00:21:35,280
be a way to send these things through

693
00:21:35,280 --> 00:21:38,400
calendar through you know 0365 in some

694
00:21:38,400 --> 00:21:40,240
way i went a couple rabbit holes deep on

695
00:21:40,240 --> 00:21:42,000
it i couldn't find a way to do it

696
00:21:42,000 --> 00:21:42,720
it's

697
00:21:42,720 --> 00:21:44,480
so no i'm not saying there's not a way

698
00:21:44,480 --> 00:21:46,240
but it'd be it'd be interesting to see

699
00:21:46,240 --> 00:21:47,360
for sure

700
00:21:47,360 --> 00:21:48,720
um

701
00:21:48,720 --> 00:21:50,240
so cool we're gonna go straight to the

702
00:21:50,240 --> 00:21:51,679
next one

703
00:21:51,679 --> 00:21:53,919
no vnc docker fishing

704
00:21:53,919 --> 00:21:56,000
this one's this one's a weird one this

705
00:21:56,000 --> 00:21:57,840
one it kind of leans more towards a

706
00:21:57,840 --> 00:22:00,640
hyper-targeted technical exercise at the

707
00:22:00,640 --> 00:22:03,120
end of the day and the first attempt i

708
00:22:03,120 --> 00:22:04,559
had at actually running this on a live

709
00:22:04,559 --> 00:22:06,960
client was meant with intense lag over

710
00:22:06,960 --> 00:22:08,640
the no bnc session

711
00:22:08,640 --> 00:22:10,640
i'm pretty sure that was an issue on

712
00:22:10,640 --> 00:22:12,480
their side because they had a lot of web

713
00:22:12,480 --> 00:22:13,919
filtering going on

714
00:22:13,919 --> 00:22:16,080
they were also not geographically really

715
00:22:16,080 --> 00:22:18,880
close at all to the region the ec2 box

716
00:22:18,880 --> 00:22:20,480
was sitting in

717
00:22:20,480 --> 00:22:22,080
so i haven't lost full hope on it yet

718
00:22:22,080 --> 00:22:22,960
especially after setting everything up

719
00:22:22,960 --> 00:22:24,720
for these slides and whatnot i kind of

720
00:22:24,720 --> 00:22:26,799
revisited and pruned it a little bit and

721
00:22:26,799 --> 00:22:28,480
i got it fancied up a little more so i

722
00:22:28,480 --> 00:22:29,760
don't know i might have to run this

723
00:22:29,760 --> 00:22:31,360
thing again in the future just to see

724
00:22:31,360 --> 00:22:33,600
see if i can get someone to do it

725
00:22:33,600 --> 00:22:35,039
but this whole setup is based off this

726
00:22:35,039 --> 00:22:36,799
article by uh mr doc's link to the

727
00:22:36,799 --> 00:22:38,960
bottom of the slide over here

728
00:22:38,960 --> 00:22:40,640
basically what he went through doing is

729
00:22:40,640 --> 00:22:42,240
he described how you would set up a

730
00:22:42,240 --> 00:22:44,080
single burner box

731
00:22:44,080 --> 00:22:48,000
with uh no vnc server setup on it and he

732
00:22:48,000 --> 00:22:50,080
would then hide as much in no bnc as

733
00:22:50,080 --> 00:22:51,600
possible so you don't really know you're

734
00:22:51,600 --> 00:22:53,360
looking in a vnc session

735
00:22:53,360 --> 00:22:54,799
and then uh

736
00:22:54,799 --> 00:22:57,520
you'd put a login page of whatever you

737
00:22:57,520 --> 00:23:00,000
want the target to log into up full

738
00:23:00,000 --> 00:23:02,799
screen in kiosk mode in firefox that way

739
00:23:02,799 --> 00:23:04,159
it's just looking it looks nice and

740
00:23:04,159 --> 00:23:06,159
clean there's no secondary url bars that

741
00:23:06,159 --> 00:23:07,280
you're like nested because you're in a

742
00:23:07,280 --> 00:23:08,480
vnc session

743
00:23:08,480 --> 00:23:10,960
in my random linux docker container

744
00:23:10,960 --> 00:23:13,520
so it's a really weird campaign to set

745
00:23:13,520 --> 00:23:15,360
up but basically the intended use case

746
00:23:15,360 --> 00:23:17,760
here is is you're going to send a user a

747
00:23:17,760 --> 00:23:20,480
link to your own browser kind of they're

748
00:23:20,480 --> 00:23:22,559
going to log into that browser

749
00:23:22,559 --> 00:23:24,640
once they've logged in you we have a

750
00:23:24,640 --> 00:23:26,320
bunch of options i can either just cut

751
00:23:26,320 --> 00:23:28,080
access the new vnc

752
00:23:28,080 --> 00:23:30,159
no longer let them externally access it

753
00:23:30,159 --> 00:23:31,760
i've still got it though so now i'm

754
00:23:31,760 --> 00:23:33,120
logged in as them and i can just take

755
00:23:33,120 --> 00:23:34,159
over their session on that docker

756
00:23:34,159 --> 00:23:35,760
container because they've logged in on

757
00:23:35,760 --> 00:23:36,480
it

758
00:23:36,480 --> 00:23:38,000
we can dump cookies out of that browser

759
00:23:38,000 --> 00:23:39,280
session i've played with a couple

760
00:23:39,280 --> 00:23:41,279
different ways to dump just dump cookies

761
00:23:41,279 --> 00:23:42,799
at disk i mean you can just throw a

762
00:23:42,799 --> 00:23:44,480
chrome extension in that'll take care of

763
00:23:44,480 --> 00:23:46,240
that for you no problem too

764
00:23:46,240 --> 00:23:47,600
or you can just filter them all through

765
00:23:47,600 --> 00:23:49,600
an hp proxy just log all the traffic

766
00:23:49,600 --> 00:23:50,799
grab the session tokens right out of

767
00:23:50,799 --> 00:23:52,159
that off you go go plug them into your

768
00:23:52,159 --> 00:23:53,840
own browser from there there's there's a

769
00:23:53,840 --> 00:23:55,039
bunch of different end games you can go

770
00:23:55,039 --> 00:23:56,559
with here

771
00:23:56,559 --> 00:23:58,559
um but this is all just kind of going

772
00:23:58,559 --> 00:24:00,559
over the the the transportation

773
00:24:00,559 --> 00:24:03,200
mechanism that is this this weird no vnc

774
00:24:03,200 --> 00:24:04,480
setup

775
00:24:04,480 --> 00:24:06,799
so let's uh what i'm going to talk about

776
00:24:06,799 --> 00:24:08,640
more on my side of this thing is is my

777
00:24:08,640 --> 00:24:10,880
efforts to take his idea scale it and

778
00:24:10,880 --> 00:24:12,400
then secure it and lock it down a little

779
00:24:12,400 --> 00:24:14,159
bit inside docker because whenever i

780
00:24:14,159 --> 00:24:15,679
first set his up i did it on a burner

781
00:24:15,679 --> 00:24:16,840
ec2

782
00:24:16,840 --> 00:24:18,400
and

783
00:24:18,400 --> 00:24:21,039
got out of the the kiosk mode in firefox

784
00:24:21,039 --> 00:24:24,000
and i was all sudden root in a random

785
00:24:24,000 --> 00:24:26,240
youtube ubuntu box and i know that's not

786
00:24:26,240 --> 00:24:26,960
good

787
00:24:26,960 --> 00:24:28,400
because i'm in like our pentest lab

788
00:24:28,400 --> 00:24:30,400
right now no i don't like this at all so

789
00:24:30,400 --> 00:24:31,520
we're gonna we're gonna contain this

790
00:24:31,520 --> 00:24:32,880
monster a little bit

791
00:24:32,880 --> 00:24:34,559
so here's what this thing looks like

792
00:24:34,559 --> 00:24:36,720
when it's deployed this is bone stock

793
00:24:36,720 --> 00:24:39,360
you pull down this ubuntu vnc xfce

794
00:24:39,360 --> 00:24:42,080
container and this is what you look at

795
00:24:42,080 --> 00:24:43,840
you navigate to

796
00:24:43,840 --> 00:24:46,320
the local listening port go to vnc.html

797
00:24:46,320 --> 00:24:47,919
you're looking at a login page users are

798
00:24:47,919 --> 00:24:49,440
supposed to click connect they'll get a

799
00:24:49,440 --> 00:24:50,880
password prompt if you set a password on

800
00:24:50,880 --> 00:24:53,200
it it's kind of basic it kind of sucks

801
00:24:53,200 --> 00:24:55,440
it's a little underwhelming so we go

802
00:24:55,440 --> 00:24:57,679
through a bunch of mr doc's steps here

803
00:24:57,679 --> 00:24:59,840
spruce it up a little more as we go so

804
00:24:59,840 --> 00:25:02,320
he did a cool thing just just a super

805
00:25:02,320 --> 00:25:03,840
obvious thing at the end of the day of

806
00:25:03,840 --> 00:25:05,600
doing the parameters right in the url

807
00:25:05,600 --> 00:25:06,720
bar for

808
00:25:06,720 --> 00:25:09,200
the auto connect the resize the password

809
00:25:09,200 --> 00:25:10,720
so that way whenever you give somebody

810
00:25:10,720 --> 00:25:12,559
the control link for this vnc session

811
00:25:12,559 --> 00:25:14,320
they click it they drop right into the

812
00:25:14,320 --> 00:25:15,120
window they're not going to click

813
00:25:15,120 --> 00:25:16,480
anything they don't even know it's a vnc

814
00:25:16,480 --> 00:25:19,279
session um we still have uh toolbars and

815
00:25:19,279 --> 00:25:20,559
what not popping up here and a little

816
00:25:20,559 --> 00:25:22,240
status bar up here so that's kind of a

817
00:25:22,240 --> 00:25:24,799
big giveaway so let's fix that

818
00:25:24,799 --> 00:25:27,120
so inside movie nc you can go through

819
00:25:27,120 --> 00:25:28,960
and you can do the title bar and the

820
00:25:28,960 --> 00:25:32,640
favicon through under that directory um

821
00:25:32,640 --> 00:25:35,919
there is the vnc.html and a ui.js they

822
00:25:35,919 --> 00:25:37,360
control all these things that are shown

823
00:25:37,360 --> 00:25:39,600
to the users so after tearing through

824
00:25:39,600 --> 00:25:40,960
those

825
00:25:40,960 --> 00:25:43,039
modify them so the toolbars are gone you

826
00:25:43,039 --> 00:25:45,120
get rid of status bar renamed the

827
00:25:45,120 --> 00:25:48,080
vnc.html to besides.html at least it's

828
00:25:48,080 --> 00:25:49,919
something expected at that point

829
00:25:49,919 --> 00:25:50,880
um

830
00:25:50,880 --> 00:25:52,880
if you want to try to replicate this

831
00:25:52,880 --> 00:25:55,440
madness i do have the ui.js and the

832
00:25:55,440 --> 00:25:56,799
inside of html that i've already got

833
00:25:56,799 --> 00:25:58,640
modified in the github repo for this

834
00:25:58,640 --> 00:26:00,400
whole thing so those are ready to go you

835
00:26:00,400 --> 00:26:01,679
can tinker with them still obviously but

836
00:26:01,679 --> 00:26:03,520
i just wanted to save somebody else that

837
00:26:03,520 --> 00:26:06,240
pain because

838
00:26:06,240 --> 00:26:07,520
this is the final product that i end up

839
00:26:07,520 --> 00:26:09,440
coming up with here which

840
00:26:09,440 --> 00:26:11,039
doesn't actually look bad full screen

841
00:26:11,039 --> 00:26:13,279
here um so we added a domain now let's

842
00:26:13,279 --> 00:26:14,960
put we tucked this thing back behind

843
00:26:14,960 --> 00:26:17,799
mimecast dash one dot b-sides

844
00:26:17,799 --> 00:26:21,200
pgh.ctf.com um also made the password at

845
00:26:21,200 --> 00:26:22,799
the very end of it more complex instead

846
00:26:22,799 --> 00:26:25,840
of just password so it looks a little

847
00:26:25,840 --> 00:26:27,679
str it's just a big blown out url in a

848
00:26:27,679 --> 00:26:31,440
bar so you may look over it

849
00:26:32,159 --> 00:26:35,120
what this thing looks like live

850
00:26:35,120 --> 00:26:37,200
is like this

851
00:26:37,200 --> 00:26:40,320
this is just my machine accessing this

852
00:26:40,320 --> 00:26:42,720
control link right away and it's super

853
00:26:42,720 --> 00:26:44,400
fast because i've already got the google

854
00:26:44,400 --> 00:26:46,159
sign in page set up in the docker

855
00:26:46,159 --> 00:26:47,840
container already ready to go so that

856
00:26:47,840 --> 00:26:48,799
way as soon as the user clicks it

857
00:26:48,799 --> 00:26:50,960
they're looking at that login page so

858
00:26:50,960 --> 00:26:53,679
it's super fast um

859
00:26:53,679 --> 00:26:55,520
whenever you're typing there's a

860
00:26:55,520 --> 00:26:57,760
noticeable lag it's a little bit it

861
00:26:57,760 --> 00:26:59,600
feels off there's a there's a there's

862
00:26:59,600 --> 00:27:01,279
there's a twitch of something feels

863
00:27:01,279 --> 00:27:02,960
wrong here

864
00:27:02,960 --> 00:27:05,200
there's also

865
00:27:05,200 --> 00:27:08,080
not a paste for some reason which is a

866
00:27:08,080 --> 00:27:10,080
problem because then now like people

867
00:27:10,080 --> 00:27:11,840
have you know their password managers

868
00:27:11,840 --> 00:27:13,039
they want to autofill and it's not going

869
00:27:13,039 --> 00:27:14,480
to work for some reason

870
00:27:14,480 --> 00:27:15,840
that i didn't notice till this morning

871
00:27:15,840 --> 00:27:17,440
when i did my run through that save

872
00:27:17,440 --> 00:27:19,760
login box that's on my docker container

873
00:27:19,760 --> 00:27:21,279
that's not my local firefox to stay

874
00:27:21,279 --> 00:27:23,600
logging box so that's a problem so that

875
00:27:23,600 --> 00:27:25,440
needs to stable too just in the final

876
00:27:25,440 --> 00:27:27,360
one i've got sitting out on docker hub

877
00:27:27,360 --> 00:27:29,039
right now but that's basically what that

878
00:27:29,039 --> 00:27:30,480
container looks like whenever we send it

879
00:27:30,480 --> 00:27:31,600
to a person

880
00:27:31,600 --> 00:27:32,559
uh

881
00:27:32,559 --> 00:27:34,720
nuts and bolts

882
00:27:34,720 --> 00:27:36,399
if you want to do this

883
00:27:36,399 --> 00:27:37,679
i

884
00:27:37,679 --> 00:27:39,120
commend you first of all because it's

885
00:27:39,120 --> 00:27:40,960
insane and i hope somebody follows this

886
00:27:40,960 --> 00:27:42,000
thing up and improves it and does

887
00:27:42,000 --> 00:27:43,520
something better than what i did here

888
00:27:43,520 --> 00:27:45,919
because i'm a mess but what i've got set

889
00:27:45,919 --> 00:27:47,919
up so far is you can pull that image off

890
00:27:47,919 --> 00:27:50,960
off a docker hub right now um to do this

891
00:27:50,960 --> 00:27:53,039
whole thing with multiple clients you

892
00:27:53,039 --> 00:27:54,960
got to set up an hd proxy at the front

893
00:27:54,960 --> 00:27:57,360
in front of it so that's what the second

894
00:27:57,360 --> 00:27:59,520
chunker down here is where you're just

895
00:27:59,520 --> 00:28:01,200
building a ubuntu box but you just got

896
00:28:01,200 --> 00:28:02,960
to put apache on it i've got an example

897
00:28:02,960 --> 00:28:05,039
of a vhost config that makes this

898
00:28:05,039 --> 00:28:07,760
madness work all proxy pretty well

899
00:28:07,760 --> 00:28:09,360
finally you're spinning up that actual

900
00:28:09,360 --> 00:28:11,120
no bnc container

901
00:28:11,120 --> 00:28:12,480
it's if you're not comfortable with

902
00:28:12,480 --> 00:28:15,279
docker i know i'm sure not um i got this

903
00:28:15,279 --> 00:28:17,600
much down where you're doing the you're

904
00:28:17,600 --> 00:28:20,240
exposing 6901 externally piping it to

905
00:28:20,240 --> 00:28:23,679
6901 internally name it user one this is

906
00:28:23,679 --> 00:28:26,240
the container that we're running after

907
00:28:26,240 --> 00:28:28,320
that's spun up you're then running

908
00:28:28,320 --> 00:28:30,320
firefox inside that container so we're

909
00:28:30,320 --> 00:28:32,880
telling you docker user one run for

910
00:28:32,880 --> 00:28:35,760
display one run firefox to this url in

911
00:28:35,760 --> 00:28:37,840
kiosk mode fork it

912
00:28:37,840 --> 00:28:38,799
exit

913
00:28:38,799 --> 00:28:41,360
so that sets up that docker container to

914
00:28:41,360 --> 00:28:45,840
be ready for a user to access it

915
00:28:46,080 --> 00:28:47,039
trying to

916
00:28:47,039 --> 00:28:49,360
give a little more visual to what this

917
00:28:49,360 --> 00:28:51,919
disgusting final product ends up being

918
00:28:51,919 --> 00:28:53,360
so the way i've got it set up right now

919
00:28:53,360 --> 00:28:55,159
for the b-sides

920
00:28:55,159 --> 00:28:58,159
pghctf.com domain i have three a records

921
00:28:58,159 --> 00:29:00,000
on it right now for mimecast one two and

922
00:29:00,000 --> 00:29:02,559
three all of those point to the the main

923
00:29:02,559 --> 00:29:05,200
domain they hit my http proxy and then

924
00:29:05,200 --> 00:29:08,159
they go down to docker user one it's

925
00:29:08,159 --> 00:29:09,520
user one also in the second one that

926
00:29:09,520 --> 00:29:12,080
should be user two and user three and

927
00:29:12,080 --> 00:29:13,520
then six nine oh one six ninety two

928
00:29:13,520 --> 00:29:14,960
scanner three so we're just routing all

929
00:29:14,960 --> 00:29:16,720
of this traffic and trying to coordinate

930
00:29:16,720 --> 00:29:18,240
it so we can have multiple of these

931
00:29:18,240 --> 00:29:20,159
instances running at one time so that's

932
00:29:20,159 --> 00:29:21,840
i wanted to at least show the the v host

933
00:29:21,840 --> 00:29:24,000
on the right side here where it's the

934
00:29:24,000 --> 00:29:25,760
same deal you just run a bunch of these

935
00:29:25,760 --> 00:29:28,720
in one big site configuration for apache

936
00:29:28,720 --> 00:29:31,760
where you're doing minecast one

937
00:29:31,760 --> 00:29:33,440
knows it needs to go to

938
00:29:33,440 --> 00:29:36,159
websocket 6901 it's important because no

939
00:29:36,159 --> 00:29:38,320
vnc works out of web sockets and then

940
00:29:38,320 --> 00:29:40,880
6901 for the localhost hp connection

941
00:29:40,880 --> 00:29:42,240
so all you would do is for then

942
00:29:42,240 --> 00:29:46,799
mimecast2 change it modcast 2 6902 6902

943
00:29:46,799 --> 00:29:48,320
however many more times you want to run

944
00:29:48,320 --> 00:29:49,360
this thing or how many people you want

945
00:29:49,360 --> 00:29:51,360
to try and get at one time

946
00:29:51,360 --> 00:29:52,320
so

947
00:29:52,320 --> 00:29:54,640
writing all of those docker commands the

948
00:29:54,640 --> 00:29:56,799
spin up let's say you want to attack 30

949
00:29:56,799 --> 00:29:57,840
clients

950
00:29:57,840 --> 00:29:59,760
that's all really gross

951
00:29:59,760 --> 00:30:02,880
i i before i started doing i started

952
00:30:02,880 --> 00:30:04,480
refining some of these slides earlier

953
00:30:04,480 --> 00:30:06,399
this week and i was going to commit some

954
00:30:06,399 --> 00:30:07,760
time to

955
00:30:07,760 --> 00:30:09,520
building a rapper script building some

956
00:30:09,520 --> 00:30:11,120
kind of little application something to

957
00:30:11,120 --> 00:30:13,919
make this deployment a little easier

958
00:30:13,919 --> 00:30:16,720
um i went with excel

959
00:30:16,720 --> 00:30:19,919
when i went with excel we now have excel

960
00:30:19,919 --> 00:30:21,360
which i'll

961
00:30:21,360 --> 00:30:24,559
show this disgusting pile of madness

962
00:30:24,559 --> 00:30:26,480
where this is the best idea i got cooked

963
00:30:26,480 --> 00:30:29,600
up right now so again i welcome anybody

964
00:30:29,600 --> 00:30:31,520
else's ideas or inputs on this thing

965
00:30:31,520 --> 00:30:34,000
where that looks horrible but basically

966
00:30:34,000 --> 00:30:35,360
all it's doing is just big old

967
00:30:35,360 --> 00:30:37,679
concatenate commands where i'm taking

968
00:30:37,679 --> 00:30:38,880
the variables that are going to change

969
00:30:38,880 --> 00:30:41,360
like the port number for 6901 down to

970
00:30:41,360 --> 00:30:42,799
six nine

971
00:30:42,799 --> 00:30:44,799
god i think that's a three four that's

972
00:30:44,799 --> 00:30:47,120
that's a little pixelated um you naming

973
00:30:47,120 --> 00:30:48,559
the container one through thirty four

974
00:30:48,559 --> 00:30:49,840
you join the whole thing at the end and

975
00:30:49,840 --> 00:30:52,799
then you just copy that whole pile of

976
00:30:52,799 --> 00:30:54,240
dockers

977
00:30:54,240 --> 00:30:55,760
paste values back into your working

978
00:30:55,760 --> 00:30:57,440
sheet so now we can at least prep this

979
00:30:57,440 --> 00:30:59,519
campaign for like a go live day that way

980
00:30:59,519 --> 00:31:00,320
you don't got to sit here and build

981
00:31:00,320 --> 00:31:02,240
these things manually i have separate

982
00:31:02,240 --> 00:31:03,679
sheets set up right now for them running

983
00:31:03,679 --> 00:31:05,039
the firefox command in all of these

984
00:31:05,039 --> 00:31:07,039
containers so then that way at least

985
00:31:07,039 --> 00:31:09,919
it's not too too terrible where day of

986
00:31:09,919 --> 00:31:11,279
you're trying to run this thing all you

987
00:31:11,279 --> 00:31:12,640
got to do is go grab your big pile of

988
00:31:12,640 --> 00:31:15,039
docker builds it'll make all of your

989
00:31:15,039 --> 00:31:16,640
containers and get them up and running

990
00:31:16,640 --> 00:31:18,640
give it a second for him to spin up go

991
00:31:18,640 --> 00:31:20,240
hammer all your docker firefoxes now

992
00:31:20,240 --> 00:31:22,080
firefox is open on whatever your login

993
00:31:22,080 --> 00:31:24,000
page is it's ready to go for clients to

994
00:31:24,000 --> 00:31:25,679
access them

995
00:31:25,679 --> 00:31:28,399
final sheet is the phishing urls um all

996
00:31:28,399 --> 00:31:30,960
i'm doing there is mimecast 1 through 34

997
00:31:30,960 --> 00:31:32,399
and then just joining them and there's

998
00:31:32,399 --> 00:31:34,000
all your fishing urls so however you

999
00:31:34,000 --> 00:31:35,840
want to get those to your users through

1000
00:31:35,840 --> 00:31:37,600
a script through a go fish however you

1001
00:31:37,600 --> 00:31:39,200
want to send send the links to people

1002
00:31:39,200 --> 00:31:40,480
that's the links you can just dropped

1003
00:31:40,480 --> 00:31:41,600
off to your users and they'll just be

1004
00:31:41,600 --> 00:31:43,120
able to hit it hop right into the vnc

1005
00:31:43,120 --> 00:31:46,480
session that we're looking at here

1006
00:31:46,480 --> 00:31:49,279
that's a lot of madness

1007
00:31:49,279 --> 00:31:51,600
let's get my mouse back over

1008
00:31:51,600 --> 00:31:53,679
here

1009
00:31:53,679 --> 00:31:55,519
final

1010
00:31:55,519 --> 00:31:57,600
wrap up so

1011
00:31:57,600 --> 00:32:01,279
uh issues with this whole thing

1012
00:32:01,279 --> 00:32:02,480
obviously you can break out of that

1013
00:32:02,480 --> 00:32:04,399
kiosk mode that one scared me after i

1014
00:32:04,399 --> 00:32:06,000
first set it up and i was running as

1015
00:32:06,000 --> 00:32:07,840
rude on that on that first machine and i

1016
00:32:07,840 --> 00:32:09,679
went okay so we're going to do

1017
00:32:09,679 --> 00:32:11,840
i'll dockerize it i'll make it kick the

1018
00:32:11,840 --> 00:32:13,360
kick the default user down to i think

1019
00:32:13,360 --> 00:32:14,960
it's like name is headless by default in

1020
00:32:14,960 --> 00:32:17,120
that docker container he's just a low

1021
00:32:17,120 --> 00:32:18,880
level nothing user all he can run is

1022
00:32:18,880 --> 00:32:21,039
firefox so i've tried to lock him down a

1023
00:32:21,039 --> 00:32:23,120
little bit i'll did some other steps to

1024
00:32:23,120 --> 00:32:24,799
like you white out the background inside

1025
00:32:24,799 --> 00:32:27,200
the vnc session hide the icons try to

1026
00:32:27,200 --> 00:32:29,120
tuck it away as best you can i had

1027
00:32:29,120 --> 00:32:31,039
played with theming the ubuntu a little

1028
00:32:31,039 --> 00:32:32,480
bit based on whether you know they have

1029
00:32:32,480 --> 00:32:34,799
macs or windows because i remember a

1030
00:32:34,799 --> 00:32:37,120
client staying saying specifically that

1031
00:32:37,120 --> 00:32:38,799
the mouse cursor looked weird as soon as

1032
00:32:38,799 --> 00:32:40,399
she went to like go put in the login

1033
00:32:40,399 --> 00:32:41,760
creds and i went

1034
00:32:41,760 --> 00:32:45,279
all right that can be worked with okay

1035
00:32:45,279 --> 00:32:46,559
that's a little weird but it's something

1036
00:32:46,559 --> 00:32:49,519
that could be improved here

1037
00:32:50,159 --> 00:32:51,840
resources this thing actually is not

1038
00:32:51,840 --> 00:32:55,200
that resource intensive i did a t3a and

1039
00:32:55,200 --> 00:32:57,360
ec2 and it ran 20-ish containers without

1040
00:32:57,360 --> 00:32:59,760
issue and we had a whole team of us

1041
00:32:59,760 --> 00:33:01,200
hammering it at one time chucking in

1042
00:33:01,200 --> 00:33:03,519
creds it seemed to work okay but that

1043
00:33:03,519 --> 00:33:04,799
was also with all of us with like a

1044
00:33:04,799 --> 00:33:07,519
direct vpn connection to our own lab so

1045
00:33:07,519 --> 00:33:09,840
it was a little a little bit of

1046
00:33:09,840 --> 00:33:12,480
variable there um future improvements

1047
00:33:12,480 --> 00:33:14,559
some logical form of automation because

1048
00:33:14,559 --> 00:33:16,799
this is horrible this is

1049
00:33:16,799 --> 00:33:18,640
not automated well and i i don't know

1050
00:33:18,640 --> 00:33:20,640
i'm just maybe being overly critical on

1051
00:33:20,640 --> 00:33:24,000
self but also it's not that clean so i i

1052
00:33:24,000 --> 00:33:25,600
want to work in some way to do some kind

1053
00:33:25,600 --> 00:33:27,039
of a helper script or something that

1054
00:33:27,039 --> 00:33:28,880
makes spinning this campaign a little

1055
00:33:28,880 --> 00:33:30,880
more friendly because it's about less

1056
00:33:30,880 --> 00:33:32,880
than friendly right now um password

1057
00:33:32,880 --> 00:33:34,720
manager compatibility like i said for

1058
00:33:34,720 --> 00:33:37,279
whatever reason no vnc does copy and

1059
00:33:37,279 --> 00:33:38,559
paste you can copy and paste in and out

1060
00:33:38,559 --> 00:33:39,840
of that thing

1061
00:33:39,840 --> 00:33:42,320
i don't know if i broke it in modifying

1062
00:33:42,320 --> 00:33:45,200
the uijs or html file that's entirely

1063
00:33:45,200 --> 00:33:46,880
possible i got to troubleshoot that i

1064
00:33:46,880 --> 00:33:48,240
want to figure out why the copy and

1065
00:33:48,240 --> 00:33:50,159
paste isn't working that i thought of it

1066
00:33:50,159 --> 00:33:51,519
this morning too when i did it dry run

1067
00:33:51,519 --> 00:33:53,840
of these slides where i know the hack

1068
00:33:53,840 --> 00:33:55,760
the box virtual machines whatever

1069
00:33:55,760 --> 00:33:57,760
they're using i mean i want to go see

1070
00:33:57,760 --> 00:33:58,960
what they're using now because i know

1071
00:33:58,960 --> 00:34:01,200
theirs are stellar and like the latency

1072
00:34:01,200 --> 00:34:02,640
is like zero and you can copy and paste

1073
00:34:02,640 --> 00:34:03,919
in and out of them and they work great

1074
00:34:03,919 --> 00:34:05,760
so that may be like a logical next step

1075
00:34:05,760 --> 00:34:06,880
in just you know basing this whole

1076
00:34:06,880 --> 00:34:08,960
container around whatever fanciness they

1077
00:34:08,960 --> 00:34:10,399
got going on and they may just have a

1078
00:34:10,399 --> 00:34:11,599
lot of bandwidth go in the machines and

1079
00:34:11,599 --> 00:34:12,960
that's why they run good i don't know

1080
00:34:12,960 --> 00:34:15,119
gonna chase that one um

1081
00:34:15,119 --> 00:34:16,639
finally just some firmly documented way

1082
00:34:16,639 --> 00:34:18,560
of dumping cookies i had a couple hair

1083
00:34:18,560 --> 00:34:20,560
brand ideas of doing

1084
00:34:20,560 --> 00:34:22,159
you know just a chrome or firefox

1085
00:34:22,159 --> 00:34:23,760
extension or something that would then

1086
00:34:23,760 --> 00:34:25,599
you know just dump to like a big bind

1087
00:34:25,599 --> 00:34:26,960
mount share for all the docker

1088
00:34:26,960 --> 00:34:28,560
containers and you could just watch like

1089
00:34:28,560 --> 00:34:30,639
hp log no one need to go look for fresh

1090
00:34:30,639 --> 00:34:31,679
cookies so you can just go plug them

1091
00:34:31,679 --> 00:34:33,359
into your own computer your own uh

1092
00:34:33,359 --> 00:34:34,639
session or something

1093
00:34:34,639 --> 00:34:36,480
i'm not sure i don't know i keep talking

1094
00:34:36,480 --> 00:34:37,760
myself in different directions on that

1095
00:34:37,760 --> 00:34:39,599
one and half the time you can just you

1096
00:34:39,599 --> 00:34:42,079
know throw evil gen x running on the

1097
00:34:42,079 --> 00:34:44,079
same machine push them all to that

1098
00:34:44,079 --> 00:34:45,359
instead of playing with like trying to

1099
00:34:45,359 --> 00:34:47,040
capture anything weird and then that

1100
00:34:47,040 --> 00:34:48,320
worked perfectly fine because now your

1101
00:34:48,320 --> 00:34:50,480
evil gen x link is not exposed and it's

1102
00:34:50,480 --> 00:34:52,320
stuck in this weird pile of darker

1103
00:34:52,320 --> 00:34:55,440
madness and it it'll still work though

1104
00:34:55,440 --> 00:34:57,599
so at least your your link is protected

1105
00:34:57,599 --> 00:34:58,880
at that point and you're not you know

1106
00:34:58,880 --> 00:35:00,240
too much of a risk to get burned from

1107
00:35:00,240 --> 00:35:03,119
there um that's basically what i had for

1108
00:35:03,119 --> 00:35:05,440
you guys today i have been phil i thank

1109
00:35:05,440 --> 00:35:07,520
you all very much for attending my talk

1110
00:35:07,520 --> 00:35:09,280
and i appreciate besides for letting me

1111
00:35:09,280 --> 00:35:11,359
ramble for 40 minutes very much

1112
00:35:11,359 --> 00:35:12,960
thank you very much everyone have a good

1113
00:35:12,960 --> 00:35:15,260
rest of your day

1114
00:35:15,260 --> 00:35:19,520
[Applause]

1115
00:35:19,520 --> 00:35:21,440
got 10 minutes for questions got 10

1116
00:35:21,440 --> 00:35:22,960
minutes for questions

1117
00:35:22,960 --> 00:35:24,800
oh god please

1118
00:35:24,800 --> 00:35:27,599
please let me free

1119
00:35:27,920 --> 00:35:29,839
nah anybody have any questions about

1120
00:35:29,839 --> 00:35:31,839
either of these uh mildly ridiculous

1121
00:35:31,839 --> 00:35:33,040
campaigns

1122
00:35:33,040 --> 00:35:35,520
how successful were they

1123
00:35:35,520 --> 00:35:37,520
for the novi and c1 or the for the

1124
00:35:37,520 --> 00:35:39,760
google calendar stuff or i guess either

1125
00:35:39,760 --> 00:35:41,119
so the google calendar one's super

1126
00:35:41,119 --> 00:35:43,760
successful that one runs really good uh

1127
00:35:43,760 --> 00:35:46,079
it seems i know for the for the firefox

1128
00:35:46,079 --> 00:35:48,160
fed version of it i got i got a lower

1129
00:35:48,160 --> 00:35:49,440
hit rate on that but i haven't batted

1130
00:35:49,440 --> 00:35:50,880
zero so

1131
00:35:50,880 --> 00:35:52,720
i'll take it it hits a hit

1132
00:35:52,720 --> 00:35:54,640
so yeah that one's kind of fun no vnc

1133
00:35:54,640 --> 00:35:56,720
one i gotta see yet i bailed out of that

1134
00:35:56,720 --> 00:35:58,560
one after the first client test with it

1135
00:35:58,560 --> 00:36:00,400
it was super laggy and i went okay this

1136
00:36:00,400 --> 00:36:02,480
is two beta i'm just gonna reel back to

1137
00:36:02,480 --> 00:36:04,079
something i know works and that's the

1138
00:36:04,079 --> 00:36:06,480
way i went with it instead so again

1139
00:36:06,480 --> 00:36:08,000
after after doing this prep for these

1140
00:36:08,000 --> 00:36:09,680
slides and everything it kind of it kind

1141
00:36:09,680 --> 00:36:11,040
of reignited a little bit and i went

1142
00:36:11,040 --> 00:36:12,720
okay this isn't that terrible i was able

1143
00:36:12,720 --> 00:36:14,640
to get spun back up and improved a

1144
00:36:14,640 --> 00:36:16,000
little bit i thought i thought getting

1145
00:36:16,000 --> 00:36:18,079
ssl working on the proxy like crazy for

1146
00:36:18,079 --> 00:36:19,680
some reason and then i did it again and

1147
00:36:19,680 --> 00:36:21,440
it just worked and i went okay so i was

1148
00:36:21,440 --> 00:36:22,800
just in a rabbit hole somewhere and it

1149
00:36:22,800 --> 00:36:24,480
worked the second time so i don't know

1150
00:36:24,480 --> 00:36:26,400
i'm gonna revisit that one again i'm

1151
00:36:26,400 --> 00:36:28,240
curious to run it and see if see if

1152
00:36:28,240 --> 00:36:30,000
people fall for it or not it's a weird

1153
00:36:30,000 --> 00:36:34,760
one for sure but uh yeah

1154
00:36:47,280 --> 00:36:48,320
so

1155
00:36:48,320 --> 00:36:50,079
question being

1156
00:36:50,079 --> 00:36:51,359
if

1157
00:36:51,359 --> 00:36:52,079
if

1158
00:36:52,079 --> 00:36:54,560
so like a company has a relatively

1159
00:36:54,560 --> 00:36:56,240
sketchy way of deploying things but then

1160
00:36:56,240 --> 00:36:57,680
we're coming in with an equally sketchy

1161
00:36:57,680 --> 00:36:59,440
way of deploying a malicious app or

1162
00:36:59,440 --> 00:37:01,680
something how do you best give them you

1163
00:37:01,680 --> 00:37:03,440
know feedback on what to improve is that

1164
00:37:03,440 --> 00:37:06,440
basically

1165
00:37:09,200 --> 00:37:10,320
i mean

1166
00:37:10,320 --> 00:37:11,839
you just have to set expectations really

1167
00:37:11,839 --> 00:37:13,119
it's the same deal with the with the

1168
00:37:13,119 --> 00:37:14,320
firefox fed one where you're telling

1169
00:37:14,320 --> 00:37:15,839
them it's going to say it's untrusted

1170
00:37:15,839 --> 00:37:17,680
hey this is malware but it's not malware

1171
00:37:17,680 --> 00:37:19,119
go ahead and run it

1172
00:37:19,119 --> 00:37:22,680
they might run it

1173
00:37:27,280 --> 00:37:29,040
so that one comes down to i mean it all

1174
00:37:29,040 --> 00:37:31,040
started at the google calendar invite or

1175
00:37:31,040 --> 00:37:32,960
this random google doc that they got

1176
00:37:32,960 --> 00:37:34,720
where'd that google doc come from do you

1177
00:37:34,720 --> 00:37:38,560
know this account is b sides pgh ctf.com

1178
00:37:38,560 --> 00:37:41,040
a domain you expect to receive i.t

1179
00:37:41,040 --> 00:37:43,040
deployment instructions from

1180
00:37:43,040 --> 00:37:45,040
probably not unless you're

1181
00:37:45,040 --> 00:37:47,520
the b-sides pgh ctf

1182
00:37:47,520 --> 00:37:49,200
maybe they'll fall for it let's give it

1183
00:37:49,200 --> 00:37:51,839
a try question mark

1184
00:37:51,839 --> 00:37:53,119
there's a bunch of indicators stuff like

1185
00:37:53,119 --> 00:37:54,160
that i mean

1186
00:37:54,160 --> 00:37:56,720
the the one i always fall back on too is

1187
00:37:56,720 --> 00:37:58,320
you're deploying an app in a federal

1188
00:37:58,320 --> 00:37:59,520
environment

1189
00:37:59,520 --> 00:38:01,200
do you don't question that at all

1190
00:38:01,200 --> 00:38:02,240
because you got an event on your

1191
00:38:02,240 --> 00:38:05,040
calendar wouldn't you like hit a hit an

1192
00:38:05,040 --> 00:38:07,440
i.t person hit a co-worker hit a is any

1193
00:38:07,440 --> 00:38:09,200
of this expected if you had a training

1194
00:38:09,200 --> 00:38:11,599
regarding this when you were accessing

1195
00:38:11,599 --> 00:38:12,880
the federal environment you're showing

1196
00:38:12,880 --> 00:38:14,079
how to do it for that company because

1197
00:38:14,079 --> 00:38:15,520
everyone does it you know their own

1198
00:38:15,520 --> 00:38:16,880
interesting way

1199
00:38:16,880 --> 00:38:18,720
this should be well out of the ordinary

1200
00:38:18,720 --> 00:38:20,560
as to what they were showing to do this

1201
00:38:20,560 --> 00:38:23,200
so i would say it's just a lot of

1202
00:38:23,200 --> 00:38:24,960
there's a lot of indications indicators

1203
00:38:24,960 --> 00:38:26,880
of sketchy here and if it's all way out

1204
00:38:26,880 --> 00:38:28,240
of the ordinary then you should probably

1205
00:38:28,240 --> 00:38:29,440
stop and go

1206
00:38:29,440 --> 00:38:31,760
maybe i'll ask somebody before i do this

1207
00:38:31,760 --> 00:38:33,680
yeah maybe i'll ask somebody so that's

1208
00:38:33,680 --> 00:38:34,880
basically where i would probably go with

1209
00:38:34,880 --> 00:38:38,640
that and any one of those options there

1210
00:38:38,640 --> 00:38:41,598
any other questions

1211
00:38:42,480 --> 00:38:45,640
go ahead

1212
00:38:49,760 --> 00:38:52,640
uh so does the calendar event evade a

1213
00:38:52,640 --> 00:38:55,200
i'm not sure what uh company said

1214
00:38:55,200 --> 00:38:57,200
co-fence uh

1215
00:38:57,200 --> 00:38:58,800
so it just like throws an alert on it or

1216
00:38:58,800 --> 00:39:00,160
something this is from an external

1217
00:39:00,160 --> 00:39:03,879
sender or something sketchy

1218
00:39:24,000 --> 00:39:25,760
so the question is basically you know

1219
00:39:25,760 --> 00:39:27,839
will will that calendar invite whole

1220
00:39:27,839 --> 00:39:29,760
setup get past you know an email defense

1221
00:39:29,760 --> 00:39:30,880
of some kind and then what is your

1222
00:39:30,880 --> 00:39:31,839
supposed to do with that thing once they

1223
00:39:31,839 --> 00:39:34,079
got it did they how do they report it

1224
00:39:34,079 --> 00:39:35,920
how did they acknowledge they saw it

1225
00:39:35,920 --> 00:39:38,240
it's bad i didn't do the bad thing

1226
00:39:38,240 --> 00:39:40,320
that's a tough one because

1227
00:39:40,320 --> 00:39:42,160
it's it's possible no matter what

1228
00:39:42,160 --> 00:39:44,000
through google right now through the api

1229
00:39:44,000 --> 00:39:45,599
it's not something a spam builder is

1230
00:39:45,599 --> 00:39:47,839
going to see there's not a report button

1231
00:39:47,839 --> 00:39:49,599
on there i do have a script that i

1232
00:39:49,599 --> 00:39:51,760
cooked up after uh

1233
00:39:51,760 --> 00:39:53,359
we had done i don't know maybe a hundred

1234
00:39:53,359 --> 00:39:54,880
or so people and then the question was

1235
00:39:54,880 --> 00:39:56,560
asked after of well i want all those

1236
00:39:56,560 --> 00:39:58,400
gone now and i went

1237
00:39:58,400 --> 00:39:59,920
yeah we should probably do that hang on

1238
00:39:59,920 --> 00:40:01,760
let me do that real quick and it took a

1239
00:40:01,760 --> 00:40:03,280
little tinker with the api but i got it

1240
00:40:03,280 --> 00:40:04,800
and he just does a quick run through and

1241
00:40:04,800 --> 00:40:05,920
it gets rid of all of them so we can

1242
00:40:05,920 --> 00:40:07,040
clean up the environment we're not

1243
00:40:07,040 --> 00:40:09,280
messing people's stuff up but yeah don't

1244
00:40:09,280 --> 00:40:10,720
there's not a good defense on that from

1245
00:40:10,720 --> 00:40:12,640
a product standpoint as far as i know i

1246
00:40:12,640 --> 00:40:14,720
mean it's i think i've the only

1247
00:40:14,720 --> 00:40:16,720
mitigation i've seen is people stop

1248
00:40:16,720 --> 00:40:18,319
using the google calendar they use

1249
00:40:18,319 --> 00:40:20,160
google workspace for email and whatnot

1250
00:40:20,160 --> 00:40:22,720
still but i guess they i don't know if

1251
00:40:22,720 --> 00:40:24,560
those people specifically had identified

1252
00:40:24,560 --> 00:40:26,319
an issue in the google calendar they had

1253
00:40:26,319 --> 00:40:27,520
something better they were using but

1254
00:40:27,520 --> 00:40:28,640
they just didn't use the google counter

1255
00:40:28,640 --> 00:40:30,240
they locked it out through the g suite

1256
00:40:30,240 --> 00:40:33,680
admin or google workspace admin yeah

1257
00:40:33,680 --> 00:40:36,480
any other questions

1258
00:40:36,560 --> 00:40:37,440
cool

1259
00:40:37,440 --> 00:40:38,880
shutting it down thank you very much

1260
00:40:38,880 --> 00:40:41,880
everybody

