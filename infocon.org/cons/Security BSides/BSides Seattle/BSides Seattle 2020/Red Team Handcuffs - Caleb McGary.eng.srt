1
00:00:02,290 --> 00:00:06,560
[Music]

2
00:00:06,560 --> 00:00:07,120
awesome

3
00:00:07,120 --> 00:00:09,040
thank you so hopefully everyone can see

4
00:00:09,040 --> 00:00:10,559
my screen and hopefully everyone can see

5
00:00:10,559 --> 00:00:11,280
me

6
00:00:11,280 --> 00:00:12,960
and we'll get started without too much

7
00:00:12,960 --> 00:00:17,920
to do

8
00:00:18,480 --> 00:00:19,840
all right cool so we're going to cover

9
00:00:19,840 --> 00:00:21,039
four main topics today i'm going to

10
00:00:21,039 --> 00:00:22,240
briefly introduce myself

11
00:00:22,240 --> 00:00:23,600
uh i will talk a little bit about our

12
00:00:23,600 --> 00:00:25,359
team uh some of the stuff we're doing in

13
00:00:25,359 --> 00:00:26,320
the village today

14
00:00:26,320 --> 00:00:27,519
and then we'll talk about what we're

15
00:00:27,519 --> 00:00:29,119
going to cover what a red team handcuff

16
00:00:29,119 --> 00:00:29,359
is

17
00:00:29,359 --> 00:00:32,720
and kind of the conclusion

18
00:00:32,960 --> 00:00:34,800
all right so first off to introduce

19
00:00:34,800 --> 00:00:36,719
myself my name is caleb mcgarry i am a

20
00:00:36,719 --> 00:00:38,239
red teamer at microsoft

21
00:00:38,239 --> 00:00:39,840
i have been with the company now for a

22
00:00:39,840 --> 00:00:42,480
few years i am on one of several red

23
00:00:42,480 --> 00:00:43,920
teams at microsoft so microsoft is a

24
00:00:43,920 --> 00:00:45,520
fairly large company we have

25
00:00:45,520 --> 00:00:47,360
i think four main red teams each one has

26
00:00:47,360 --> 00:00:49,600
a different area of expertise

27
00:00:49,600 --> 00:00:51,840
my team is responsible for what is known

28
00:00:51,840 --> 00:00:54,559
as edg

29
00:00:56,960 --> 00:00:58,879
uh edg as you can see on the screen

30
00:00:58,879 --> 00:01:01,120
stands for edge devices and gaming

31
00:01:01,120 --> 00:01:03,199
and the way i would explain it to people

32
00:01:03,199 --> 00:01:04,319
is if you think about like

33
00:01:04,319 --> 00:01:06,159
windows but nothing that is actually on

34
00:01:06,159 --> 00:01:07,520
the stuff that runs on your computer per

35
00:01:07,520 --> 00:01:08,720
se right

36
00:01:08,720 --> 00:01:10,720
so this includes things like windows

37
00:01:10,720 --> 00:01:12,640
update uh windows code sign

38
00:01:12,640 --> 00:01:14,720
all the build systems uh some of the

39
00:01:14,720 --> 00:01:16,479
other inherent security that gets baked

40
00:01:16,479 --> 00:01:17,200
in

41
00:01:17,200 --> 00:01:19,759
um stuff that's that's windows but you

42
00:01:19,759 --> 00:01:21,360
don't necessarily touch it right

43
00:01:21,360 --> 00:01:22,960
so there are some components that we

44
00:01:22,960 --> 00:01:24,799
touch that you may actually touch but

45
00:01:24,799 --> 00:01:27,119
not a ton of them with devices this

46
00:01:27,119 --> 00:01:28,479
includes everything that's devices

47
00:01:28,479 --> 00:01:30,240
related so say from manufacturing to

48
00:01:30,240 --> 00:01:31,759
deployment to you know the images that

49
00:01:31,759 --> 00:01:33,200
go on the surface book

50
00:01:33,200 --> 00:01:35,439
and with gaming my team is responsible

51
00:01:35,439 --> 00:01:37,360
for the entire stack

52
00:01:37,360 --> 00:01:39,920
so that includes all the studios that we

53
00:01:39,920 --> 00:01:41,840
own that includes xbox

54
00:01:41,840 --> 00:01:44,479
um anything that runs on the console um

55
00:01:44,479 --> 00:01:45,759
you know to assessing testing the

56
00:01:45,759 --> 00:01:46,880
hardware potentially to

57
00:01:46,880 --> 00:01:48,560
say figuring out how to cheat in a

58
00:01:48,560 --> 00:01:50,560
particular game to um going out and

59
00:01:50,560 --> 00:01:52,079
testing a third-party gaming studio that

60
00:01:52,079 --> 00:01:52,960
we've just acquired

61
00:01:52,960 --> 00:01:55,920
to check the security of them we are a

62
00:01:55,920 --> 00:01:57,280
relatively small team

63
00:01:57,280 --> 00:01:58,640
uh there are only eight of us and i

64
00:01:58,640 --> 00:02:00,560
think today most of us are actually

65
00:02:00,560 --> 00:02:02,399
present at the conference

66
00:02:02,399 --> 00:02:04,399
we are hanging out in the village

67
00:02:04,399 --> 00:02:06,079
serpent channel which i'll cover in a

68
00:02:06,079 --> 00:02:06,960
second

69
00:02:06,960 --> 00:02:08,800
uh please feel free to drop in you can

70
00:02:08,800 --> 00:02:10,399
talk to us directly and ask

71
00:02:10,399 --> 00:02:12,160
you know hey what's you know things like

72
00:02:12,160 --> 00:02:14,160
in your space or you know how is this

73
00:02:14,160 --> 00:02:14,560
done

74
00:02:14,560 --> 00:02:16,160
in potential at microsoft where possible

75
00:02:16,160 --> 00:02:17,840
we will try and share that information

76
00:02:17,840 --> 00:02:19,120
with you obviously there are going to be

77
00:02:19,120 --> 00:02:20,800
some things that we can't disclose

78
00:02:20,800 --> 00:02:23,040
but that's kind of the way life is at

79
00:02:23,040 --> 00:02:25,200
any major corporate company

80
00:02:25,200 --> 00:02:28,400
um i live in seattle i have two dogs one

81
00:02:28,400 --> 00:02:29,840
of which is featured on the screen up

82
00:02:29,840 --> 00:02:30,560
there

83
00:02:30,560 --> 00:02:32,480
and the other one is upstairs hopefully

84
00:02:32,480 --> 00:02:34,000
being quiet and should not interrupt my

85
00:02:34,000 --> 00:02:34,720
talk

86
00:02:34,720 --> 00:02:36,879
and i put my link in here you can ping

87
00:02:36,879 --> 00:02:38,239
me there if you have a question you want

88
00:02:38,239 --> 00:02:39,680
to reach out you want to try and connect

89
00:02:39,680 --> 00:02:41,040
just tell me where you're from say hey

90
00:02:41,040 --> 00:02:42,319
i'm from b side saddle so that way i

91
00:02:42,319 --> 00:02:45,280
actually know who you are

92
00:02:45,840 --> 00:02:48,319
all right so i mentioned earlier i think

93
00:02:48,319 --> 00:02:49,680
in the last

94
00:02:49,680 --> 00:02:51,280
like couple of minutes that we actually

95
00:02:51,280 --> 00:02:53,040
have a village or something going on

96
00:02:53,040 --> 00:02:54,319
here at beside seattle and i'm going to

97
00:02:54,319 --> 00:02:54,959
take a minute

98
00:02:54,959 --> 00:02:58,480
and talk a little bit about it so

99
00:02:58,480 --> 00:02:59,760
in the village serpent channel there is

100
00:02:59,760 --> 00:03:01,599
a pinned post and if you look at that

101
00:03:01,599 --> 00:03:04,360
pin post it will direct you to

102
00:03:04,360 --> 00:03:06,000
securitycenter.windows.com and it will

103
00:03:06,000 --> 00:03:08,080
give you a logged in a login

104
00:03:08,080 --> 00:03:09,840
username and a password that you can use

105
00:03:09,840 --> 00:03:12,239
to log in and what we have set up here

106
00:03:12,239 --> 00:03:12,879
is an

107
00:03:12,879 --> 00:03:15,360
enterprise md atp instance so mdhp

108
00:03:15,360 --> 00:03:17,440
stands for microsoft defender advanced

109
00:03:17,440 --> 00:03:20,560
protection i think they rebranded it

110
00:03:20,560 --> 00:03:22,800
recently to microsoft defender for

111
00:03:22,800 --> 00:03:23,599
endpoint so

112
00:03:23,599 --> 00:03:25,120
they changed the name as part of ignite

113
00:03:25,120 --> 00:03:27,280
a few weeks ago

114
00:03:27,280 --> 00:03:28,400
and in this environment we have

115
00:03:28,400 --> 00:03:29,840
onboarded a small domain so there's a

116
00:03:29,840 --> 00:03:31,680
couple of servers a couple of clients

117
00:03:31,680 --> 00:03:33,200
and we have done some activities within

118
00:03:33,200 --> 00:03:35,040
the environment right and

119
00:03:35,040 --> 00:03:36,640
uh there is the advanced hunting

120
00:03:36,640 --> 00:03:38,959
interface enabled so it will enable you

121
00:03:38,959 --> 00:03:40,959
if you log in and poke around to try and

122
00:03:40,959 --> 00:03:42,640
figure out exactly what we have done

123
00:03:42,640 --> 00:03:45,040
and how admittedly there are some things

124
00:03:45,040 --> 00:03:46,799
that are like extremely obvious so say

125
00:03:46,799 --> 00:03:48,400
hey accessing lsas right

126
00:03:48,400 --> 00:03:50,319
but there are some things that are a lot

127
00:03:50,319 --> 00:03:51,760
less obvious and so

128
00:03:51,760 --> 00:03:55,040
the goal of the i guess experience

129
00:03:55,040 --> 00:03:56,959
if i'm going to call it that is to see

130
00:03:56,959 --> 00:03:58,480
if you can figure out everything that we

131
00:03:58,480 --> 00:03:59,360
did

132
00:03:59,360 --> 00:04:00,879
using the hunting interface right

133
00:04:00,879 --> 00:04:02,159
admittedly you could drop some other

134
00:04:02,159 --> 00:04:04,159
form of forensic tools on the box and

135
00:04:04,159 --> 00:04:04,879
you could you know

136
00:04:04,879 --> 00:04:06,480
run some sort of analysis and say get me

137
00:04:06,480 --> 00:04:07,760
all the files that have changed between

138
00:04:07,760 --> 00:04:08,720
a and b

139
00:04:08,720 --> 00:04:11,680
and potentially detect us right away but

140
00:04:11,680 --> 00:04:12,560
that's a little bit

141
00:04:12,560 --> 00:04:15,840
less interesting so um take your time

142
00:04:15,840 --> 00:04:17,440
log in try and accomplish the challenge

143
00:04:17,440 --> 00:04:18,720
if you have any questions like i said

144
00:04:18,720 --> 00:04:20,160
we'll be in the channel and you can ask

145
00:04:20,160 --> 00:04:21,680
us about hey how's this feature work or

146
00:04:21,680 --> 00:04:23,600
was this you or did you do a b and c

147
00:04:23,600 --> 00:04:24,639
figure out

148
00:04:24,639 --> 00:04:25,600
see if you can figure out how we

149
00:04:25,600 --> 00:04:27,840
laterally move between systems um what

150
00:04:27,840 --> 00:04:29,120
sort of credentials an account we're

151
00:04:29,120 --> 00:04:29,919
using

152
00:04:29,919 --> 00:04:32,800
um i'm gonna put around and figure out

153
00:04:32,800 --> 00:04:33,440
what you can see

154
00:04:33,440 --> 00:04:34,960
um and then hit us up unfortunately we

155
00:04:34,960 --> 00:04:36,960
don't have any prizes um

156
00:04:36,960 --> 00:04:38,160
just by nature the way that we stood

157
00:04:38,160 --> 00:04:39,680
this up it isn't necessarily possible to

158
00:04:39,680 --> 00:04:40,560
do it in a

159
00:04:40,560 --> 00:04:43,919
a super awesome you know ctf manner but

160
00:04:43,919 --> 00:04:45,199
we do have a bunch of stuff there to

161
00:04:45,199 --> 00:04:45,919
poke at

162
00:04:45,919 --> 00:04:48,320
um it is somewhat unique and uh if you

163
00:04:48,320 --> 00:04:49,600
are successful in finding some of the

164
00:04:49,600 --> 00:04:51,120
more unique things we have turned on

165
00:04:51,120 --> 00:04:53,280
live response and so you can potentially

166
00:04:53,280 --> 00:04:55,199
recover a file off disk and then analyze

167
00:04:55,199 --> 00:04:56,320
it and then go from there

168
00:04:56,320 --> 00:04:59,600
right so swing by and uh

169
00:04:59,600 --> 00:05:02,800
give it a look cool so

170
00:05:02,800 --> 00:05:05,039
today's talk is a little bit unique it's

171
00:05:05,039 --> 00:05:06,000
different than most of the other

172
00:05:06,000 --> 00:05:07,520
conference talks that we give or that i

173
00:05:07,520 --> 00:05:08,639
have given and the fact that it's not

174
00:05:08,639 --> 00:05:10,880
necessarily a hardcore technical talk

175
00:05:10,880 --> 00:05:12,240
uh when we were thinking about what we

176
00:05:12,240 --> 00:05:13,759
wanted to present at b-sides this year

177
00:05:13,759 --> 00:05:14,880
we decided to talk

178
00:05:14,880 --> 00:05:16,160
about some of the challenges that we

179
00:05:16,160 --> 00:05:18,240
have in doing our job and so one of the

180
00:05:18,240 --> 00:05:19,840
main points that we have as part of our

181
00:05:19,840 --> 00:05:21,600
job are rules of engagement this is a

182
00:05:21,600 --> 00:05:23,280
fairly lengthy document with a lot of

183
00:05:23,280 --> 00:05:25,280
legalese that is written that every

184
00:05:25,280 --> 00:05:27,120
red teamer at microsoft has to sign when

185
00:05:27,120 --> 00:05:28,960
they come on board to do their job and

186
00:05:28,960 --> 00:05:29,919
the roes

187
00:05:29,919 --> 00:05:31,280
as i'm going to refer to them will

188
00:05:31,280 --> 00:05:32,960
differ between teams right

189
00:05:32,960 --> 00:05:35,039
so our talk um you should be aware is

190
00:05:35,039 --> 00:05:36,800
specific to us and it is specific to how

191
00:05:36,800 --> 00:05:38,320
we interact and do our work in the

192
00:05:38,320 --> 00:05:39,520
business right

193
00:05:39,520 --> 00:05:41,680
other companies consultants their you

194
00:05:41,680 --> 00:05:43,360
know major firms whatever

195
00:05:43,360 --> 00:05:44,800
may have different rules of engagement

196
00:05:44,800 --> 00:05:45,919
they have different limitations

197
00:05:45,919 --> 00:05:47,039
different restrictions

198
00:05:47,039 --> 00:05:49,759
um but these are ours and they force us

199
00:05:49,759 --> 00:05:51,520
to adapt and think

200
00:05:51,520 --> 00:05:52,800
differently in how we approach our

201
00:05:52,800 --> 00:05:55,520
statement of work right we have to

202
00:05:55,520 --> 00:05:58,000
do certain things differently than

203
00:05:58,000 --> 00:05:59,600
potentially a real attacker because we

204
00:05:59,600 --> 00:06:00,080
have to

205
00:06:00,080 --> 00:06:02,639
change the way in which we operate due

206
00:06:02,639 --> 00:06:03,759
to these restrictions that are

207
00:06:03,759 --> 00:06:05,680
inherently placed upon us

208
00:06:05,680 --> 00:06:07,600
and this talk today is going to be about

209
00:06:07,600 --> 00:06:09,199
what those restrictions are

210
00:06:09,199 --> 00:06:11,039
why they matter and then how we solve

211
00:06:11,039 --> 00:06:13,600
them and our goal is to be able to work

212
00:06:13,600 --> 00:06:14,880
around them in such a way that we can

213
00:06:14,880 --> 00:06:16,080
continue to do our work

214
00:06:16,080 --> 00:06:18,960
and say a happy path without any impacts

215
00:06:18,960 --> 00:06:20,080
and still have the business

216
00:06:20,080 --> 00:06:22,479
impact right so as a red team our

217
00:06:22,479 --> 00:06:23,919
primary responsibility is to be a

218
00:06:23,919 --> 00:06:25,440
sparring partner for our associated blue

219
00:06:25,440 --> 00:06:27,280
team which is known as fire

220
00:06:27,280 --> 00:06:30,160
um and then also help secure the

221
00:06:30,160 --> 00:06:31,199
business right we want to find

222
00:06:31,199 --> 00:06:32,560
vulnerabilities and bugs

223
00:06:32,560 --> 00:06:34,800
for the adversary does and then get them

224
00:06:34,800 --> 00:06:37,919
pushed out and get them fixed

225
00:06:37,919 --> 00:06:39,280
all right so we have our happy path

226
00:06:39,280 --> 00:06:41,039
scenario and this is how we would

227
00:06:41,039 --> 00:06:42,400
operate ideally if

228
00:06:42,400 --> 00:06:44,479
everything went right and we didn't have

229
00:06:44,479 --> 00:06:45,840
any interruptions challenges or

230
00:06:45,840 --> 00:06:47,600
limitations placed upon us right

231
00:06:47,600 --> 00:06:49,840
the team would get together uh generally

232
00:06:49,840 --> 00:06:51,199
since we're a small team

233
00:06:51,199 --> 00:06:52,880
this may involve the entire team or just

234
00:06:52,880 --> 00:06:55,120
a couple of the seniors on the team

235
00:06:55,120 --> 00:06:57,280
and we'll sit down and we'll say okay

236
00:06:57,280 --> 00:06:59,520
this is our scope we have edg

237
00:06:59,520 --> 00:07:00,960
these are the things that we consider

238
00:07:00,960 --> 00:07:02,560
high risks like

239
00:07:02,560 --> 00:07:03,919
hey there's a new console coming out

240
00:07:03,919 --> 00:07:05,759
this year we should probably have a look

241
00:07:05,759 --> 00:07:06,560
at it

242
00:07:06,560 --> 00:07:07,919
we should probably figure out how you

243
00:07:07,919 --> 00:07:09,759
know they're doing a b and c associated

244
00:07:09,759 --> 00:07:10,800
with that console

245
00:07:10,800 --> 00:07:13,919
if we can accomplish something unique

246
00:07:13,919 --> 00:07:15,440
let's schedule it in we'll designate

247
00:07:15,440 --> 00:07:17,039
some time whatever and we'll

248
00:07:17,039 --> 00:07:19,280
we'll decide what our goal is for that

249
00:07:19,280 --> 00:07:20,639
target

250
00:07:20,639 --> 00:07:22,720
um i mentioned the schedule so usually

251
00:07:22,720 --> 00:07:24,080
when we do a test and i'll reiterate

252
00:07:24,080 --> 00:07:25,840
this we have a set amount of time so we

253
00:07:25,840 --> 00:07:27,280
are definitely time boxed as part of the

254
00:07:27,280 --> 00:07:28,720
way that we do work

255
00:07:28,720 --> 00:07:30,400
and we'll calendar something in and say

256
00:07:30,400 --> 00:07:31,919
okay this is when we're going to do this

257
00:07:31,919 --> 00:07:34,240
task

258
00:07:37,919 --> 00:07:40,240
this is the fun part of the job um we

259
00:07:40,240 --> 00:07:41,280
get to do the test

260
00:07:41,280 --> 00:07:43,759
and this is honestly why i do the job i

261
00:07:43,759 --> 00:07:45,199
like connecting the pieces and figuring

262
00:07:45,199 --> 00:07:46,080
out all the dots and

263
00:07:46,080 --> 00:07:47,680
identifying the problem and then you

264
00:07:47,680 --> 00:07:49,039
know exploiting it and accomplishing the

265
00:07:49,039 --> 00:07:51,280
goal

266
00:07:51,520 --> 00:07:53,199
uh we then release the results so on our

267
00:07:53,199 --> 00:07:55,440
team uh the way it works is we have

268
00:07:55,440 --> 00:07:57,680
kind of a bug bar right so if we decide

269
00:07:57,680 --> 00:07:58,879
that you know something is going to be a

270
00:07:58,879 --> 00:08:00,080
bug it has to

271
00:08:00,080 --> 00:08:02,240
be considered a violation of the secure

272
00:08:02,240 --> 00:08:03,840
development lifecycle so there's policy

273
00:08:03,840 --> 00:08:04,400
there's

274
00:08:04,400 --> 00:08:06,080
rules and regulations that are out there

275
00:08:06,080 --> 00:08:08,639
and if we file a bug it has to violate

276
00:08:08,639 --> 00:08:10,080
one of those items so it has to be a

277
00:08:10,080 --> 00:08:12,080
technical bug we tend not to file

278
00:08:12,080 --> 00:08:14,560
say process bugs we file technical items

279
00:08:14,560 --> 00:08:15,520
um that would

280
00:08:15,520 --> 00:08:17,840
i guess be the equivalent of like a

281
00:08:17,840 --> 00:08:19,520
github issue against a project right

282
00:08:19,520 --> 00:08:21,199
we will open a technical bug like hey

283
00:08:21,199 --> 00:08:22,800
you have an integer overflow here

284
00:08:22,800 --> 00:08:24,879
and this impacts leads to remote code

285
00:08:24,879 --> 00:08:26,240
execution which leads to environment

286
00:08:26,240 --> 00:08:27,440
compromise which leads to you know

287
00:08:27,440 --> 00:08:29,680
whatever else that you need to fix

288
00:08:29,680 --> 00:08:31,759
so we file our bugs um and then we move

289
00:08:31,759 --> 00:08:32,799
on um

290
00:08:32,799 --> 00:08:34,320
we are involved in bug remediation to

291
00:08:34,320 --> 00:08:35,599
the extent that we will buy off on the

292
00:08:35,599 --> 00:08:36,719
customer solution but

293
00:08:36,719 --> 00:08:38,719
generally that's you know it's fairly

294
00:08:38,719 --> 00:08:40,240
light touch right the customer gets to

295
00:08:40,240 --> 00:08:41,599
look at the flaw they get to decide how

296
00:08:41,599 --> 00:08:42,719
they want to solve it and then they get

297
00:08:42,719 --> 00:08:43,039
to

298
00:08:43,039 --> 00:08:44,959
you know deal with it and ideally we

299
00:08:44,959 --> 00:08:46,240
would then go on to our next target and

300
00:08:46,240 --> 00:08:46,959
it would be

301
00:08:46,959 --> 00:08:49,200
um a kind of an open and closed process

302
00:08:49,200 --> 00:08:50,160
right

303
00:08:50,160 --> 00:08:52,800
now the challenge is that's not really

304
00:08:52,800 --> 00:08:55,120
how things work

305
00:08:55,120 --> 00:08:56,560
anyone that works for a major business

306
00:08:56,560 --> 00:08:59,120
knows that things are just different so

307
00:08:59,120 --> 00:09:01,839
let's go back to monday i will come to

308
00:09:01,839 --> 00:09:03,519
work and i start between say

309
00:09:03,519 --> 00:09:06,080
7 30 and 8 am and i fire up outlook

310
00:09:06,080 --> 00:09:08,000
which is my email client that i use

311
00:09:08,000 --> 00:09:10,080
and there's some email in there it says

312
00:09:10,080 --> 00:09:11,200
you know from someone that i may have

313
00:09:11,200 --> 00:09:12,640
never heard of somewhere in the company

314
00:09:12,640 --> 00:09:14,560
and they might not even be

315
00:09:14,560 --> 00:09:15,920
technically inside of our scope right

316
00:09:15,920 --> 00:09:17,279
but they just managed to find us because

317
00:09:17,279 --> 00:09:18,880
we're in the directory

318
00:09:18,880 --> 00:09:21,120
hey listen um we're pushing this product

319
00:09:21,120 --> 00:09:23,680
to market uh it goes out on thursday

320
00:09:23,680 --> 00:09:26,000
and uh i need this thing done and uh can

321
00:09:26,000 --> 00:09:26,800
you help me with it

322
00:09:26,800 --> 00:09:28,959
right and a lot of times those are going

323
00:09:28,959 --> 00:09:30,399
to be generic security questions that we

324
00:09:30,399 --> 00:09:32,800
can punt off to another team right so we

325
00:09:32,800 --> 00:09:34,800
in our organization do partner heavily

326
00:09:34,800 --> 00:09:36,160
with other security teams

327
00:09:36,160 --> 00:09:38,959
so um we have within like what i

328
00:09:38,959 --> 00:09:40,399
consider the serpent core there is a

329
00:09:40,399 --> 00:09:41,920
component pen test team they do code

330
00:09:41,920 --> 00:09:43,360
reviews appsec

331
00:09:43,360 --> 00:09:45,040
they are like a dedicated pen test team

332
00:09:45,040 --> 00:09:46,880
of specific components

333
00:09:46,880 --> 00:09:48,399
there is a threat modeling team a secure

334
00:09:48,399 --> 00:09:50,320
architecture and design team and they do

335
00:09:50,320 --> 00:09:51,839
that kind of service for our customers

336
00:09:51,839 --> 00:09:53,279
right and so a lot of times we can hand

337
00:09:53,279 --> 00:09:54,160
them

338
00:09:54,160 --> 00:09:55,680
hand the email person off to that

339
00:09:55,680 --> 00:09:58,000
customer but there might be cases where

340
00:09:58,000 --> 00:09:59,440
we're like okay

341
00:09:59,440 --> 00:10:01,600
it's probably merits getting looked at

342
00:10:01,600 --> 00:10:03,200
something that was a surprise

343
00:10:03,200 --> 00:10:05,920
and it fell through the cracks and so we

344
00:10:05,920 --> 00:10:07,200
have some challenges with this

345
00:10:07,200 --> 00:10:10,720
right so uh first what's the monitoring

346
00:10:10,720 --> 00:10:11,600
posture remember

347
00:10:11,600 --> 00:10:13,760
our job is to not just test the

348
00:10:13,760 --> 00:10:15,440
customer's environment but also to test

349
00:10:15,440 --> 00:10:16,640
the blue team's response within the

350
00:10:16,640 --> 00:10:18,240
environment and if there is something

351
00:10:18,240 --> 00:10:18,560
new

352
00:10:18,560 --> 00:10:19,680
and foreign they might not have any

353
00:10:19,680 --> 00:10:22,000
monitoring at all and

354
00:10:22,000 --> 00:10:23,680
that represents a significant risk right

355
00:10:23,680 --> 00:10:25,120
it might be better in that case to pump

356
00:10:25,120 --> 00:10:26,399
them off to the blue team and be like

357
00:10:26,399 --> 00:10:26,800
hey

358
00:10:26,800 --> 00:10:28,720
onboard the monitoring do a b and c and

359
00:10:28,720 --> 00:10:30,240
then come back at some future point in

360
00:10:30,240 --> 00:10:31,440
time and we will consider you as a

361
00:10:31,440 --> 00:10:32,640
service

362
00:10:32,640 --> 00:10:35,600
timeline um when the business comes to

363
00:10:35,600 --> 00:10:37,600
you with a request like this they don't

364
00:10:37,600 --> 00:10:39,360
uh give you the desired time it's

365
00:10:39,360 --> 00:10:41,200
usually like we're going to market on

366
00:10:41,200 --> 00:10:42,640
this date or we have this thing that

367
00:10:42,640 --> 00:10:44,160
needs to be done by here

368
00:10:44,160 --> 00:10:46,399
um and you have to adjust um and then

369
00:10:46,399 --> 00:10:47,839
the environment right

370
00:10:47,839 --> 00:10:50,560
microsoft nowadays uh is a very diverse

371
00:10:50,560 --> 00:10:52,240
environment right we have everything

372
00:10:52,240 --> 00:10:52,640
from

373
00:10:52,640 --> 00:10:55,120
say kubernetes with linux um i did a

374
00:10:55,120 --> 00:10:56,640
test on something that was that kind of

375
00:10:56,640 --> 00:10:57,760
environment recently

376
00:10:57,760 --> 00:10:59,440
down to say just you know straight

377
00:10:59,440 --> 00:11:02,000
regular windows you know.net

378
00:11:02,000 --> 00:11:04,880
a very microsoft stack um where on the

379
00:11:04,880 --> 00:11:06,000
other hand i might have something that

380
00:11:06,000 --> 00:11:06,959
is you know

381
00:11:06,959 --> 00:11:09,200
say perl kubernetes running in a

382
00:11:09,200 --> 00:11:10,959
container on linux somewhere

383
00:11:10,959 --> 00:11:14,240
um elsewhere within a data center and

384
00:11:14,240 --> 00:11:16,640
you know the developers that work for us

385
00:11:16,640 --> 00:11:18,720
have the ability to

386
00:11:18,720 --> 00:11:20,399
choose their technical stack right we

387
00:11:20,399 --> 00:11:22,240
don't prohibit what they can and can't

388
00:11:22,240 --> 00:11:22,880
use

389
00:11:22,880 --> 00:11:25,279
and so this environment may be very

390
00:11:25,279 --> 00:11:26,320
diverse it may be something that we're

391
00:11:26,320 --> 00:11:27,680
unfamiliar with and it may be something

392
00:11:27,680 --> 00:11:29,920
that we have to skill up rapidly on

393
00:11:29,920 --> 00:11:31,600
and this represents some challenges when

394
00:11:31,600 --> 00:11:33,680
it is our job to potentially compromise

395
00:11:33,680 --> 00:11:34,880
the environment and accomplish a goal

396
00:11:34,880 --> 00:11:36,320
within it

397
00:11:36,320 --> 00:11:38,079
and so the problem is that forces us to

398
00:11:38,079 --> 00:11:39,760
work rapidly right um

399
00:11:39,760 --> 00:11:41,360
and as anybody knows that when you're

400
00:11:41,360 --> 00:11:43,200
speeding um you have to sacrifice a

401
00:11:43,200 --> 00:11:44,480
little bit of control of the car when

402
00:11:44,480 --> 00:11:45,760
you're going down the freeway and so we

403
00:11:45,760 --> 00:11:47,200
have to sacrifice somewhat

404
00:11:47,200 --> 00:11:48,800
with what we can do when we have a very

405
00:11:48,800 --> 00:11:50,639
tight deadline in an environment that we

406
00:11:50,639 --> 00:11:51,760
may be unfamiliar with

407
00:11:51,760 --> 00:11:54,720
where the controls may not be perfect

408
00:11:54,720 --> 00:11:55,440
and so

409
00:11:55,440 --> 00:11:56,800
that's kind of where the handcuffs come

410
00:11:56,800 --> 00:11:58,720
in um because if they weren't present

411
00:11:58,720 --> 00:11:59,920
things might be a little bit easier

412
00:11:59,920 --> 00:12:01,839
things might be a little bit um

413
00:12:01,839 --> 00:12:03,519
less stressful and less strenuous for

414
00:12:03,519 --> 00:12:04,880
what we're trying to do

415
00:12:04,880 --> 00:12:06,880
it would be much more feasible for us to

416
00:12:06,880 --> 00:12:08,160
accomplish our goal if i didn't have

417
00:12:08,160 --> 00:12:10,000
some of these restrictions in place

418
00:12:10,000 --> 00:12:11,360
and the adversaries that we deal with

419
00:12:11,360 --> 00:12:12,880
and i will provide specific examples of

420
00:12:12,880 --> 00:12:13,200
these

421
00:12:13,200 --> 00:12:14,880
often don't have these limitations in

422
00:12:14,880 --> 00:12:16,480
place and so

423
00:12:16,480 --> 00:12:18,959
uh our job obviously is to potentially

424
00:12:18,959 --> 00:12:20,079
emulate an abstract it's not like the

425
00:12:20,079 --> 00:12:21,200
only thing that we're responsible for

426
00:12:21,200 --> 00:12:21,839
doing

427
00:12:21,839 --> 00:12:24,800
um but we need to do so in such a way uh

428
00:12:24,800 --> 00:12:25,680
where

429
00:12:25,680 --> 00:12:27,680
it's realistic enough that we are

430
00:12:27,680 --> 00:12:28,959
training the blue team but we're also

431
00:12:28,959 --> 00:12:30,480
providing the customer with what they're

432
00:12:30,480 --> 00:12:32,160
likely to experience

433
00:12:32,160 --> 00:12:35,519
when they are publicly exposed

434
00:12:37,519 --> 00:12:39,839
so handcuff will be the limitation that

435
00:12:39,839 --> 00:12:42,160
prevents us from doing that

436
00:12:42,160 --> 00:12:43,920
all right so without further ado we're

437
00:12:43,920 --> 00:12:46,079
kind of going to get into the first one

438
00:12:46,079 --> 00:12:48,480
so uh as a corporate red team right and

439
00:12:48,480 --> 00:12:50,000
we work for microsoft we have to be very

440
00:12:50,000 --> 00:12:52,240
careful about what resources we use

441
00:12:52,240 --> 00:12:54,639
um and so most of the time if you are

442
00:12:54,639 --> 00:12:55,760
attacking say a third party and the

443
00:12:55,760 --> 00:12:57,600
example i've got here is stuxnet right

444
00:12:57,600 --> 00:12:59,120
which was the major effort against the

445
00:12:59,120 --> 00:13:00,000
iranians that was

446
00:13:00,000 --> 00:13:01,680
largely done by the us and israel at the

447
00:13:01,680 --> 00:13:03,760
time and

448
00:13:03,760 --> 00:13:05,279
a modern malware author has the

449
00:13:05,279 --> 00:13:07,040
capability to use external resources

450
00:13:07,040 --> 00:13:08,320
that they may not have control over

451
00:13:08,320 --> 00:13:08,880
right

452
00:13:08,880 --> 00:13:11,680
um they can use shared vms they can use

453
00:13:11,680 --> 00:13:13,600
uh email accounts and machines in other

454
00:13:13,600 --> 00:13:15,120
countries where they

455
00:13:15,120 --> 00:13:17,200
don't really know what will happen right

456
00:13:17,200 --> 00:13:19,920
where they are at risk of exposure

457
00:13:19,920 --> 00:13:21,279
where the fact that they can get

458
00:13:21,279 --> 00:13:23,040
compromised is a risk that they're

459
00:13:23,040 --> 00:13:24,959
willing to accept

460
00:13:24,959 --> 00:13:27,200
um and obviously this does you know

461
00:13:27,200 --> 00:13:28,720
generate some risk to their effort

462
00:13:28,720 --> 00:13:30,959
to attack you know a certain entity but

463
00:13:30,959 --> 00:13:33,440
um because the world is

464
00:13:33,440 --> 00:13:34,639
like largely interconnected and

465
00:13:34,639 --> 00:13:36,079
everything is online in some way shape

466
00:13:36,079 --> 00:13:36,800
or form

467
00:13:36,800 --> 00:13:38,560
they have the ability to hide within you

468
00:13:38,560 --> 00:13:40,880
know um

469
00:13:40,880 --> 00:13:42,160
i guess the data and the traffic and the

470
00:13:42,160 --> 00:13:43,519
noise that's out there right so stocks

471
00:13:43,519 --> 00:13:44,880
now use some domain names and i've got

472
00:13:44,880 --> 00:13:46,079
them listed here

473
00:13:46,079 --> 00:13:48,000
um and they're they're relatively

474
00:13:48,000 --> 00:13:49,760
generic there isn't anything super

475
00:13:49,760 --> 00:13:51,519
like unique that you might think out

476
00:13:51,519 --> 00:13:52,639
about them you know there's a couple of

477
00:13:52,639 --> 00:13:53,360
dot orgs

478
00:13:53,360 --> 00:13:55,120
a couple of dot nets you know a couple

479
00:13:55,120 --> 00:13:56,639
of dot coms and they're just kind of a

480
00:13:56,639 --> 00:13:57,839
domain name and thousands of domain

481
00:13:57,839 --> 00:13:59,120
names get registered and used on a

482
00:13:59,120 --> 00:14:00,720
regular basis and

483
00:14:00,720 --> 00:14:02,720
nobody thinks anything of it they're

484
00:14:02,720 --> 00:14:04,079
words they're not

485
00:14:04,079 --> 00:14:05,680
relatively unique i mean there might be

486
00:14:05,680 --> 00:14:07,279
some reputation score that might say hey

487
00:14:07,279 --> 00:14:08,880
this thing is dangerous but that's

488
00:14:08,880 --> 00:14:10,079
really about it

489
00:14:10,079 --> 00:14:12,240
um and if someone were to potentially

490
00:14:12,240 --> 00:14:13,519
identify these and say hey they're part

491
00:14:13,519 --> 00:14:15,360
of a malware campaign

492
00:14:15,360 --> 00:14:17,519
um that challenges with attribution and

493
00:14:17,519 --> 00:14:18,959
so when you try and do this

494
00:14:18,959 --> 00:14:20,880
in our lab right if you log into village

495
00:14:20,880 --> 00:14:22,399
sherpa and you try and figure out where

496
00:14:22,399 --> 00:14:25,440
our c2 box actually is um because we we

497
00:14:25,440 --> 00:14:27,120
do have obviously an attack system that

498
00:14:27,120 --> 00:14:28,560
we use to compromise it that is not

499
00:14:28,560 --> 00:14:30,639
present in the lab um

500
00:14:30,639 --> 00:14:33,040
attribution is hard right and being able

501
00:14:33,040 --> 00:14:34,639
to do attribution concretely

502
00:14:34,639 --> 00:14:38,079
uh takes a lot of time and so

503
00:14:38,079 --> 00:14:40,240
an attacker a real one can afford to

504
00:14:40,240 --> 00:14:41,680
take that risk right

505
00:14:41,680 --> 00:14:43,440
whereas we as a microsoft red team

506
00:14:43,440 --> 00:14:45,360
definitely can't

507
00:14:45,360 --> 00:14:46,959
and the reason why we can't is because

508
00:14:46,959 --> 00:14:48,399
we are dealing with potentially very

509
00:14:48,399 --> 00:14:49,600
sensitive data

510
00:14:49,600 --> 00:14:52,480
and anytime i pop a system right and i

511
00:14:52,480 --> 00:14:54,160
exfiltrate some sort of evidence that i

512
00:14:54,160 --> 00:14:55,360
was on that box right

513
00:14:55,360 --> 00:14:56,800
even if it's like something as simple as

514
00:14:56,800 --> 00:14:59,040
a screenshot i am putting microsoft

515
00:14:59,040 --> 00:15:00,880
resources and microsoft systems at risk

516
00:15:00,880 --> 00:15:02,320
which means i have to maintain very

517
00:15:02,320 --> 00:15:03,920
concrete control over where that data

518
00:15:03,920 --> 00:15:04,639
goes

519
00:15:04,639 --> 00:15:07,440
um what happens to it and who sees it

520
00:15:07,440 --> 00:15:08,320
right

521
00:15:08,320 --> 00:15:10,000
if i get on the system and i decide to

522
00:15:10,000 --> 00:15:11,600
steal some data and i send it back to me

523
00:15:11,600 --> 00:15:12,880
and playing text over the internet and

524
00:15:12,880 --> 00:15:14,320
someone else is listening and they also

525
00:15:14,320 --> 00:15:15,440
intercept that data

526
00:15:15,440 --> 00:15:17,360
then i have just inadvertently exposed

527
00:15:17,360 --> 00:15:19,040
microsoft data to

528
00:15:19,040 --> 00:15:20,480
some third party and i have to figure

529
00:15:20,480 --> 00:15:22,320
out how to deal with that and so

530
00:15:22,320 --> 00:15:25,040
um that is a hard like problem to deal

531
00:15:25,040 --> 00:15:26,240
with right because the real attacker

532
00:15:26,240 --> 00:15:27,440
doesn't necessarily care if some third

533
00:15:27,440 --> 00:15:28,880
party may sniff the data that they're

534
00:15:28,880 --> 00:15:30,560
doing right they still get the data in

535
00:15:30,560 --> 00:15:32,000
the end yes it might be a little bit

536
00:15:32,000 --> 00:15:34,079
less valuable if it's say ip

537
00:15:34,079 --> 00:15:35,759
but they'll have a copy of it right and

538
00:15:35,759 --> 00:15:37,040
the person that sniffs it might not

539
00:15:37,040 --> 00:15:37,600
realize

540
00:15:37,600 --> 00:15:40,399
what happened um whereas i cannot even

541
00:15:40,399 --> 00:15:41,519
take the risk

542
00:15:41,519 --> 00:15:44,240
that someone might sniff it this puts

543
00:15:44,240 --> 00:15:45,680
some challenges on us because

544
00:15:45,680 --> 00:15:47,199
uh this means obviously i have to have a

545
00:15:47,199 --> 00:15:48,720
data store which is under our control so

546
00:15:48,720 --> 00:15:50,480
we have to host uh within azure

547
00:15:50,480 --> 00:15:52,079
or within our lab environment that we

548
00:15:52,079 --> 00:15:54,480
maintain on premises

549
00:15:54,480 --> 00:15:57,360
in redmond and because of that there is

550
00:15:57,360 --> 00:15:59,120
definitely going to be a traffic feed

551
00:15:59,120 --> 00:16:01,199
to our endpoints and our endpoints are

552
00:16:01,199 --> 00:16:02,639
obviously well known they have to be

553
00:16:02,639 --> 00:16:03,920
monitored they have to be controlled and

554
00:16:03,920 --> 00:16:05,120
the blue team immediately knows where

555
00:16:05,120 --> 00:16:05,920
they are

556
00:16:05,920 --> 00:16:07,920
and so if they see traffic going to and

557
00:16:07,920 --> 00:16:09,440
from a serpent endpoint from a potential

558
00:16:09,440 --> 00:16:10,000
box

559
00:16:10,000 --> 00:16:12,560
it is like hey we should go look at that

560
00:16:12,560 --> 00:16:14,880
we'll probably find them there

561
00:16:14,880 --> 00:16:16,240
and then the response might be different

562
00:16:16,240 --> 00:16:18,000
which isn't something that we want to

563
00:16:18,000 --> 00:16:18,560
have happen

564
00:16:18,560 --> 00:16:20,560
right we want to test the response

565
00:16:20,560 --> 00:16:22,160
process from end and actually challenge

566
00:16:22,160 --> 00:16:23,120
the blue team

567
00:16:23,120 --> 00:16:24,880
and and then it adds you know challenges

568
00:16:24,880 --> 00:16:26,639
for us too right because if we're doing

569
00:16:26,639 --> 00:16:28,160
anything unique or specific we have to

570
00:16:28,160 --> 00:16:30,720
have a way of tracking what we do

571
00:16:30,720 --> 00:16:32,320
and so the way we have chosen to deal

572
00:16:32,320 --> 00:16:33,519
with this internally on our end and i

573
00:16:33,519 --> 00:16:34,320
have a diagram

574
00:16:34,320 --> 00:16:35,759
uh in the next slide that we'll talk a

575
00:16:35,759 --> 00:16:36,959
little bit about how we implement this

576
00:16:36,959 --> 00:16:38,480
technically is we decided that we would

577
00:16:38,480 --> 00:16:38,959
implement

578
00:16:38,959 --> 00:16:40,959
encryption obviously end to end for any

579
00:16:40,959 --> 00:16:42,240
of our tooling um

580
00:16:42,240 --> 00:16:43,440
in order to allow us to route our

581
00:16:43,440 --> 00:16:45,360
traffic through specific um third-party

582
00:16:45,360 --> 00:16:46,320
endpoints

583
00:16:46,320 --> 00:16:47,680
and it's not just the traffic that we

584
00:16:47,680 --> 00:16:49,199
encrypt right we also encrypt the

585
00:16:49,199 --> 00:16:50,560
payload so if for some reason the

586
00:16:50,560 --> 00:16:51,199
traffic is

587
00:16:51,199 --> 00:16:54,240
broken right they still have to figure

588
00:16:54,240 --> 00:16:55,199
out how to

589
00:16:55,199 --> 00:16:58,000
uh crack and get the payload and this

590
00:16:58,000 --> 00:17:00,160
does add additional tooling overhead

591
00:17:00,160 --> 00:17:02,480
i'll be honest it's not easy there is a

592
00:17:02,480 --> 00:17:03,759
simple implementation that i'll talk

593
00:17:03,759 --> 00:17:05,919
about using nginx proxies but

594
00:17:05,919 --> 00:17:07,119
it is something that we had to figure

595
00:17:07,119 --> 00:17:08,880
out how to do because then i can choose

596
00:17:08,880 --> 00:17:09,679
to put

597
00:17:09,679 --> 00:17:12,000
um resources in areas outside of my

598
00:17:12,000 --> 00:17:13,760
control because i can guarantee that any

599
00:17:13,760 --> 00:17:15,280
sort of data that passes through them

600
00:17:15,280 --> 00:17:17,599
will never be able to be broken or

601
00:17:17,599 --> 00:17:18,959
taken by someone else that is an

602
00:17:18,959 --> 00:17:20,799
attacker right and then obviously the

603
00:17:20,799 --> 00:17:22,400
start and stop endpoints that have to be

604
00:17:22,400 --> 00:17:23,599
inside

605
00:17:23,599 --> 00:17:25,119
our network or a network that we are

606
00:17:25,119 --> 00:17:28,000
authorized to attack

607
00:17:28,000 --> 00:17:30,320
and so um let's let's think about this

608
00:17:30,320 --> 00:17:32,320
for a second you've got say the cloud

609
00:17:32,320 --> 00:17:33,520
right and you have your cloud hosting

610
00:17:33,520 --> 00:17:35,200
providers and they're out there and you

611
00:17:35,200 --> 00:17:35,679
know

612
00:17:35,679 --> 00:17:37,360
pick you know it doesn't and the reason

613
00:17:37,360 --> 00:17:38,559
why we like to use cloud hosting

614
00:17:38,559 --> 00:17:39,600
providers is because

615
00:17:39,600 --> 00:17:42,640
uh honestly um everything in the world

616
00:17:42,640 --> 00:17:44,320
talks to the cloud hosting providers

617
00:17:44,320 --> 00:17:45,840
and we actually have resources that are

618
00:17:45,840 --> 00:17:47,360
hosted in other cloud hosting providers

619
00:17:47,360 --> 00:17:48,480
so some of those third-party game

620
00:17:48,480 --> 00:17:49,360
studios i mentioned

621
00:17:49,360 --> 00:17:51,520
do not always use microsoft resources or

622
00:17:51,520 --> 00:17:53,039
assets right

623
00:17:53,039 --> 00:17:54,720
and so and then we have microsoft right

624
00:17:54,720 --> 00:17:56,320
so for this scenario let's assume that

625
00:17:56,320 --> 00:17:57,600
we are attacking a target that is

626
00:17:57,600 --> 00:17:59,039
internal to our company

627
00:17:59,039 --> 00:18:01,200
um and we have figured out a way to go

628
00:18:01,200 --> 00:18:03,039
in so our infrastructure is

629
00:18:03,039 --> 00:18:04,720
on the right and so it's the red server

630
00:18:04,720 --> 00:18:06,640
and that's going to be where say our c2

631
00:18:06,640 --> 00:18:08,320
runs in this or some sort of virtual

632
00:18:08,320 --> 00:18:10,320
machine or data store potentially

633
00:18:10,320 --> 00:18:11,600
where we'll actually store and control

634
00:18:11,600 --> 00:18:13,440
the artifacts right we'll obviously have

635
00:18:13,440 --> 00:18:14,080
a log server

636
00:18:14,080 --> 00:18:15,280
there we'll have a few other things that

637
00:18:15,280 --> 00:18:17,440
are set up in place um

638
00:18:17,440 --> 00:18:19,200
not just to log the actions that we as

639
00:18:19,200 --> 00:18:20,720
an operator take but we will actually

640
00:18:20,720 --> 00:18:22,480
log and record all the traffic

641
00:18:22,480 --> 00:18:24,640
um i think it's several different points

642
00:18:24,640 --> 00:18:26,080
as it goes in and out of the network so

643
00:18:26,080 --> 00:18:28,000
that way we can say if someone says

644
00:18:28,000 --> 00:18:29,919
you know did this bike get sent we have

645
00:18:29,919 --> 00:18:33,360
the capability to say yes it did

646
00:18:33,360 --> 00:18:35,039
um and let's say we figure out a way to

647
00:18:35,039 --> 00:18:36,640
get on that endpoint all right so

648
00:18:36,640 --> 00:18:38,320
um i send somebody a phishing email i

649
00:18:38,320 --> 00:18:39,760
include a binary they click the link

650
00:18:39,760 --> 00:18:41,360
because that's what people do

651
00:18:41,360 --> 00:18:43,679
and from there we then have a you know a

652
00:18:43,679 --> 00:18:44,960
connection from there

653
00:18:44,960 --> 00:18:46,320
um obviously this is going to go

654
00:18:46,320 --> 00:18:48,000
somewhere else in the cloud right and so

655
00:18:48,000 --> 00:18:49,679
the example i gave earlier using nginx

656
00:18:49,679 --> 00:18:50,960
pass-through proxies

657
00:18:50,960 --> 00:18:54,000
um is actually very simple and very easy

658
00:18:54,000 --> 00:18:54,559
to set up

659
00:18:54,559 --> 00:18:56,480
right so say we're encrypting data

660
00:18:56,480 --> 00:18:57,919
already and we're doing it

661
00:18:57,919 --> 00:19:00,080
using say open ssl so it is going to

662
00:19:00,080 --> 00:19:01,440
already be encrypted and i ship it off

663
00:19:01,440 --> 00:19:03,120
to an nginx passthrough proxy

664
00:19:03,120 --> 00:19:04,799
the nginx passthrough proxy will route

665
00:19:04,799 --> 00:19:06,640
it to a different load proxy and then it

666
00:19:06,640 --> 00:19:08,240
can run back down to us

667
00:19:08,240 --> 00:19:10,240
and so if someone is saying they

668
00:19:10,240 --> 00:19:11,520
compromise that server right

669
00:19:11,520 --> 00:19:13,120
and they decide to sniff the traffic

670
00:19:13,120 --> 00:19:14,720
that is coming to the nginx press to

671
00:19:14,720 --> 00:19:16,400
proxy it is already encrypted

672
00:19:16,400 --> 00:19:17,760
they won't have a way of doing anything

673
00:19:17,760 --> 00:19:19,520
with it and yes they might actually be

674
00:19:19,520 --> 00:19:21,039
watching on that server

675
00:19:21,039 --> 00:19:23,280
for potential weakness and they might

676
00:19:23,280 --> 00:19:24,559
potentially be able to redirect that

677
00:19:24,559 --> 00:19:26,000
traffic elsewhere but they can't decode

678
00:19:26,000 --> 00:19:26,640
the contents

679
00:19:26,640 --> 00:19:27,760
and therefore we're not going to put

680
00:19:27,760 --> 00:19:29,919
microsoft data at risk and then

681
00:19:29,919 --> 00:19:31,440
obviously we have multiple hops

682
00:19:31,440 --> 00:19:32,720
so we'll have two or more proxies

683
00:19:32,720 --> 00:19:35,520
chained up to send this traffic

684
00:19:35,520 --> 00:19:37,840
between them and the reason is our blue

685
00:19:37,840 --> 00:19:38,880
team is brilliant

686
00:19:38,880 --> 00:19:40,799
um they have long since figured that you

687
00:19:40,799 --> 00:19:42,080
know if they see traffic going to a

688
00:19:42,080 --> 00:19:43,120
specific endpoint

689
00:19:43,120 --> 00:19:44,720
they can say hey what else is talking to

690
00:19:44,720 --> 00:19:46,640
that specific endpoint oh hey it's

691
00:19:46,640 --> 00:19:47,600
serpent resources

692
00:19:47,600 --> 00:19:49,039
this is obviously going to be the red

693
00:19:49,039 --> 00:19:51,440
team and then once again that may change

694
00:19:51,440 --> 00:19:52,480
the response

695
00:19:52,480 --> 00:19:54,000
and that's not something that we want to

696
00:19:54,000 --> 00:19:56,799
do um and so we have multiple hops that

697
00:19:56,799 --> 00:19:58,480
forces them to say okay

698
00:19:58,480 --> 00:20:00,000
well we see traffic going to this cloud

699
00:20:00,000 --> 00:20:02,080
provider it looks anomalous

700
00:20:02,080 --> 00:20:03,679
or there was an alert on this box that

701
00:20:03,679 --> 00:20:05,360
caused us to look and see

702
00:20:05,360 --> 00:20:07,840
where the traffic was going but we don't

703
00:20:07,840 --> 00:20:09,039
necessarily see anything else that's

704
00:20:09,039 --> 00:20:10,320
talking to that same home point

705
00:20:10,320 --> 00:20:11,919
and so then they have to escalate and

706
00:20:11,919 --> 00:20:13,360
start the response process in a much

707
00:20:13,360 --> 00:20:14,559
more normal manner

708
00:20:14,559 --> 00:20:18,000
which is good all right this next one is

709
00:20:18,000 --> 00:20:19,600
kind of significant because it

710
00:20:19,600 --> 00:20:21,200
impacts a lot of the way things are

711
00:20:21,200 --> 00:20:22,559
working specifically now that we're in a

712
00:20:22,559 --> 00:20:24,559
pandemic and everybody is remote

713
00:20:24,559 --> 00:20:27,200
um obviously personal devices are out of

714
00:20:27,200 --> 00:20:28,400
scope for us right

715
00:20:28,400 --> 00:20:30,720
and this is you know for very good

716
00:20:30,720 --> 00:20:31,679
business reasons but

717
00:20:31,679 --> 00:20:32,960
common malware that is out there does

718
00:20:32,960 --> 00:20:34,240
not have this restriction right so one

719
00:20:34,240 --> 00:20:35,520
of the more common things that we're

720
00:20:35,520 --> 00:20:35,919
seeing

721
00:20:35,919 --> 00:20:37,520
specifically this year is hands-on

722
00:20:37,520 --> 00:20:39,360
keyboard operated ransomware so like

723
00:20:39,360 --> 00:20:40,880
ransomware will get on a system

724
00:20:40,880 --> 00:20:42,080
um it will report brackets and

725
00:20:42,080 --> 00:20:44,320
environment and it actually might get

726
00:20:44,320 --> 00:20:45,840
someone that is actively

727
00:20:45,840 --> 00:20:47,440
controlling it or potentially directing

728
00:20:47,440 --> 00:20:49,039
the spread of it or doing some sort of

729
00:20:49,039 --> 00:20:50,480
action as a result of that ransomware

730
00:20:50,480 --> 00:20:51,520
infection so you'll have hands on

731
00:20:51,520 --> 00:20:52,080
keyboard

732
00:20:52,080 --> 00:20:54,720
and that interaction can enable it

733
00:20:54,720 --> 00:20:56,240
potentially to cross identity domains

734
00:20:56,240 --> 00:20:57,440
across environments and to spread

735
00:20:57,440 --> 00:20:58,640
further

736
00:20:58,640 --> 00:21:00,880
and because this year more so than any

737
00:21:00,880 --> 00:21:02,000
other year when everybody

738
00:21:02,000 --> 00:21:04,240
is virtual uh you have a lot of personal

739
00:21:04,240 --> 00:21:05,679
devices that may be used to connect to

740
00:21:05,679 --> 00:21:07,679
corporate environments right people will

741
00:21:07,679 --> 00:21:09,360
connect to a virtual machine that has

742
00:21:09,360 --> 00:21:10,640
access to the corporate network and

743
00:21:10,640 --> 00:21:11,919
they'll inadvertently bridge

744
00:21:11,919 --> 00:21:13,200
you know between their personal device

745
00:21:13,200 --> 00:21:14,320
and the corporate network or they'll

746
00:21:14,320 --> 00:21:15,360
have a phone

747
00:21:15,360 --> 00:21:16,640
um that has like a two-factor

748
00:21:16,640 --> 00:21:18,480
authentication token on it and they'll

749
00:21:18,480 --> 00:21:19,440
use it to

750
00:21:19,440 --> 00:21:21,520
connect inside to the corporate network

751
00:21:21,520 --> 00:21:23,280
um but we can't

752
00:21:23,280 --> 00:21:24,720
go after them right that's a it's a

753
00:21:24,720 --> 00:21:26,640
personal device it's it's there are a

754
00:21:26,640 --> 00:21:27,760
lot of restrictions

755
00:21:27,760 --> 00:21:30,159
with regards to them and in many cases

756
00:21:30,159 --> 00:21:32,159
it it is against the law to be frank

757
00:21:32,159 --> 00:21:32,559
right

758
00:21:32,559 --> 00:21:34,400
now in our case we also intentionally

759
00:21:34,400 --> 00:21:35,600
choose not to ask for that kind of

760
00:21:35,600 --> 00:21:36,559
permission because it is

761
00:21:36,559 --> 00:21:38,000
it is possible that we could go back to

762
00:21:38,000 --> 00:21:39,280
our legal team and we could say hey can

763
00:21:39,280 --> 00:21:40,400
we figure out a way to do this

764
00:21:40,400 --> 00:21:42,880
but um we want to work in such a way

765
00:21:42,880 --> 00:21:43,520
that the

766
00:21:43,520 --> 00:21:45,360
employees or the organizations that we

767
00:21:45,360 --> 00:21:47,440
test have full trust in the red team

768
00:21:47,440 --> 00:21:47,919
right

769
00:21:47,919 --> 00:21:49,280
they need to know that if we're going to

770
00:21:49,280 --> 00:21:51,919
come in and we're going to own them

771
00:21:51,919 --> 00:21:54,480
we will do our best not to impact any

772
00:21:54,480 --> 00:21:56,559
one of them on a personal level right

773
00:21:56,559 --> 00:21:58,640
as a red teamer uh oftentimes you will

774
00:21:58,640 --> 00:22:00,559
get on someone's device right and it may

775
00:22:00,559 --> 00:22:02,080
be a work device but regardless you will

776
00:22:02,080 --> 00:22:03,600
occasionally see personal data there

777
00:22:03,600 --> 00:22:05,039
right someone might be paying bills from

778
00:22:05,039 --> 00:22:06,320
their work laptop or something and they

779
00:22:06,320 --> 00:22:07,039
might have

780
00:22:07,039 --> 00:22:09,440
you know oh they're buying a house and

781
00:22:09,440 --> 00:22:10,400
because of that they need to talk to

782
00:22:10,400 --> 00:22:11,600
benefits and they've got like a credit

783
00:22:11,600 --> 00:22:14,080
check application on their desktop

784
00:22:14,080 --> 00:22:16,799
and you need to not touch it right and

785
00:22:16,799 --> 00:22:17,679
you need to

786
00:22:17,679 --> 00:22:19,919
be sure that they will have a trust in

787
00:22:19,919 --> 00:22:21,200
you that even though they're doing that

788
00:22:21,200 --> 00:22:22,640
activity from a corporate device which

789
00:22:22,640 --> 00:22:24,559
may or may not be sanctioned

790
00:22:24,559 --> 00:22:25,840
that their data is secure and that

791
00:22:25,840 --> 00:22:27,039
you're not going to go invade their

792
00:22:27,039 --> 00:22:29,039
personal life right we don't want to

793
00:22:29,039 --> 00:22:31,440
uh go after them and so the way in which

794
00:22:31,440 --> 00:22:32,960
we deal this is kind of via an assumed

795
00:22:32,960 --> 00:22:34,000
breach scenario

796
00:22:34,000 --> 00:22:37,280
and uh this isn't always how we function

797
00:22:37,280 --> 00:22:38,400
with these things right

798
00:22:38,400 --> 00:22:40,159
so assume reach is the concept that you

799
00:22:40,159 --> 00:22:41,120
start from somewhere within the

800
00:22:41,120 --> 00:22:42,640
environment uh using some sort of

801
00:22:42,640 --> 00:22:44,000
permission level and you just assume

802
00:22:44,000 --> 00:22:45,679
that your perimeter is compromised

803
00:22:45,679 --> 00:22:47,919
now in our case we actually do crack the

804
00:22:47,919 --> 00:22:49,520
perimeter so we don't do it in every

805
00:22:49,520 --> 00:22:50,640
engagement but

806
00:22:50,640 --> 00:22:52,960
periodically so i'd say at least three

807
00:22:52,960 --> 00:22:54,080
times a year

808
00:22:54,080 --> 00:22:56,159
maybe like once a quarter or so we will

809
00:22:56,159 --> 00:22:57,919
go out and crack the perimeter right so

810
00:22:57,919 --> 00:22:59,840
it is our job to prove that

811
00:22:59,840 --> 00:23:01,840
that risk exists and then we can use

812
00:23:01,840 --> 00:23:03,360
that justification

813
00:23:03,360 --> 00:23:04,960
or other access that we get as a result

814
00:23:04,960 --> 00:23:07,039
of cracking the perimeter to work

815
00:23:07,039 --> 00:23:09,919
to maintain and assume breach posture um

816
00:23:09,919 --> 00:23:10,880
and generally for us

817
00:23:10,880 --> 00:23:12,960
right now um this is in the form of an

818
00:23:12,960 --> 00:23:14,960
unauthenticated network access

819
00:23:14,960 --> 00:23:16,960
uh to the large corporate environment

820
00:23:16,960 --> 00:23:19,039
right so um we don't start inside a

821
00:23:19,039 --> 00:23:19,600
specific

822
00:23:19,600 --> 00:23:22,159
identity domain we don't start with a

823
00:23:22,159 --> 00:23:23,600
privileged position anywhere and we

824
00:23:23,600 --> 00:23:25,120
don't use trusted insiders right and

825
00:23:25,120 --> 00:23:26,720
then once again is specific to our red

826
00:23:26,720 --> 00:23:27,760
team they don't

827
00:23:27,760 --> 00:23:29,360
go out and ask somebody to run malware

828
00:23:29,360 --> 00:23:30,960
in an environment for us

829
00:23:30,960 --> 00:23:34,159
um we will start unauthenticated just

830
00:23:34,159 --> 00:23:36,320
assume we have network access

831
00:23:36,320 --> 00:23:38,559
and uh prior to covid that was a lot you

832
00:23:38,559 --> 00:23:40,080
know that was that was very logical

833
00:23:40,080 --> 00:23:40,960
because

834
00:23:40,960 --> 00:23:44,559
um you know large corporate network 115

835
00:23:44,559 --> 00:23:45,919
000 of your closest friends are on the

836
00:23:45,919 --> 00:23:46,720
network

837
00:23:46,720 --> 00:23:48,720
uh it is entirely reasonable to assume

838
00:23:48,720 --> 00:23:50,080
that somebody will click the link even

839
00:23:50,080 --> 00:23:50,799
if you have

840
00:23:50,799 --> 00:23:52,240
reached the perimeter within the last

841
00:23:52,240 --> 00:23:53,840
few months that somebody will respond to

842
00:23:53,840 --> 00:23:55,840
efficient email and run malware right

843
00:23:55,840 --> 00:23:58,960
and when you have

844
00:23:58,960 --> 00:24:00,240
the amount of noise and traffic on your

845
00:24:00,240 --> 00:24:01,760
network of that size it becomes very

846
00:24:01,760 --> 00:24:03,679
hard for a blue team to stop and defend

847
00:24:03,679 --> 00:24:04,320
and

848
00:24:04,320 --> 00:24:06,320
prevent every single instance of it from

849
00:24:06,320 --> 00:24:08,080
uh infiltrating the network right

850
00:24:08,080 --> 00:24:09,360
so that made sense if we needed to

851
00:24:09,360 --> 00:24:10,960
impersonate someone we can contact hr

852
00:24:10,960 --> 00:24:11,600
and we could

853
00:24:11,600 --> 00:24:13,039
we could work on it now it's a little

854
00:24:13,039 --> 00:24:15,039
bit different when everybody is remote

855
00:24:15,039 --> 00:24:16,480
because the corporate network is largely

856
00:24:16,480 --> 00:24:18,799
just vpns between devices now

857
00:24:18,799 --> 00:24:21,520
but that same sort of principle still

858
00:24:21,520 --> 00:24:21,919
apply

859
00:24:21,919 --> 00:24:25,120
still applies right um but well that's

860
00:24:25,120 --> 00:24:25,679
the

861
00:24:25,679 --> 00:24:28,720
posture that we'll usually start with

862
00:24:28,720 --> 00:24:30,400
so inside the network impersonating

863
00:24:30,400 --> 00:24:32,480
someone but not necessarily

864
00:24:32,480 --> 00:24:36,080
a specific user in animation perform

865
00:24:40,240 --> 00:24:42,480
all right so the next major challenge

866
00:24:42,480 --> 00:24:43,520
that we have is

867
00:24:43,520 --> 00:24:45,840
that we have kind of a static tool set

868
00:24:45,840 --> 00:24:47,520
so we are a relatively small team so as

869
00:24:47,520 --> 00:24:48,240
i mentioned

870
00:24:48,240 --> 00:24:49,600
at the beginning there are only eight of

871
00:24:49,600 --> 00:24:51,440
us and one of them is a manager

872
00:24:51,440 --> 00:24:53,279
um and that leaves seven of us more or

873
00:24:53,279 --> 00:24:55,760
less to get our operations done

874
00:24:55,760 --> 00:24:58,400
and we are generally specialized in a

875
00:24:58,400 --> 00:25:00,000
variety of things so our team has

876
00:25:00,000 --> 00:25:02,159
what is known as a skills matrix and

877
00:25:02,159 --> 00:25:03,760
every person is required to fill it out

878
00:25:03,760 --> 00:25:06,000
once a year and so it's

879
00:25:06,000 --> 00:25:07,440
basically a list of the technologies

880
00:25:07,440 --> 00:25:09,120
that we need to know in order to do our

881
00:25:09,120 --> 00:25:09,679
job

882
00:25:09,679 --> 00:25:11,200
and you rate yourself on a scale of one

883
00:25:11,200 --> 00:25:12,720
to five that information is

884
00:25:12,720 --> 00:25:14,159
public so it shared with everybody else

885
00:25:14,159 --> 00:25:16,000
on the team and it is shared with the

886
00:25:16,000 --> 00:25:16,799
team lead

887
00:25:16,799 --> 00:25:18,480
and so we can then decide how to get

888
00:25:18,480 --> 00:25:19,919
training where our weaknesses are what

889
00:25:19,919 --> 00:25:21,279
we need to do you know who is going to

890
00:25:21,279 --> 00:25:22,799
be a specialist and whatever

891
00:25:22,799 --> 00:25:24,799
um but even then with that sort of

892
00:25:24,799 --> 00:25:27,760
layout we still have a very limited um

893
00:25:27,760 --> 00:25:30,000
resource capability right

894
00:25:30,000 --> 00:25:32,240
adversaries are not this case so in a

895
00:25:32,240 --> 00:25:33,840
prior life prior to working at microsoft

896
00:25:33,840 --> 00:25:35,600
i had the opportunity to work out east

897
00:25:35,600 --> 00:25:37,520
that is what was known as the cyber

898
00:25:37,520 --> 00:25:38,640
defense center

899
00:25:38,640 --> 00:25:40,000
in annapolis junction maryland which is

900
00:25:40,000 --> 00:25:42,080
right next to fort meade and there were

901
00:25:42,080 --> 00:25:43,840
a lot of teams that were there invested

902
00:25:43,840 --> 00:25:45,440
just right in particular tooling for the

903
00:25:45,440 --> 00:25:46,080
government

904
00:25:46,080 --> 00:25:48,320
say malware you know components used for

905
00:25:48,320 --> 00:25:49,440
security assessments

906
00:25:49,440 --> 00:25:51,120
you know stuff to do defensive work

907
00:25:51,120 --> 00:25:52,880
potentially and there were entire

908
00:25:52,880 --> 00:25:53,600
complexes

909
00:25:53,600 --> 00:25:55,120
of thousands and thousands of employees

910
00:25:55,120 --> 00:25:56,720
that worked at that place to accomplish

911
00:25:56,720 --> 00:25:58,240
a specific goal

912
00:25:58,240 --> 00:26:00,960
and because of this um if you're

913
00:26:00,960 --> 00:26:02,480
attempting to emulate say a nation state

914
00:26:02,480 --> 00:26:03,679
adversary you know a nation state

915
00:26:03,679 --> 00:26:05,440
adversary may have the capabilities to

916
00:26:05,440 --> 00:26:06,400
retool or

917
00:26:06,400 --> 00:26:08,400
at least modify a tool of someone else's

918
00:26:08,400 --> 00:26:09,679
right so they may not always use their

919
00:26:09,679 --> 00:26:10,640
own tooling

920
00:26:10,640 --> 00:26:12,880
um for every single engagement right

921
00:26:12,880 --> 00:26:14,320
they can basically start fresh from the

922
00:26:14,320 --> 00:26:14,960
ground dog

923
00:26:14,960 --> 00:26:16,240
they'll have those resources they can

924
00:26:16,240 --> 00:26:18,080
say okay we know that these indicators

925
00:26:18,080 --> 00:26:18,559
were

926
00:26:18,559 --> 00:26:21,840
happened we're burned here let's just

927
00:26:21,840 --> 00:26:22,960
start refresh right

928
00:26:22,960 --> 00:26:24,799
it may not always be that way but they

929
00:26:24,799 --> 00:26:26,880
have that capability

930
00:26:26,880 --> 00:26:29,120
in our case if we spend say three months

931
00:26:29,120 --> 00:26:30,640
developing say really cool malware

932
00:26:30,640 --> 00:26:31,679
framework a

933
00:26:31,679 --> 00:26:34,159
and we use it to do something you know

934
00:26:34,159 --> 00:26:35,760
we are impacted by that

935
00:26:35,760 --> 00:26:37,440
and so for us the cost to retool is

936
00:26:37,440 --> 00:26:39,679
relatively high right

937
00:26:39,679 --> 00:26:41,360
we may have to start refresh with their

938
00:26:41,360 --> 00:26:42,799
design we have to figure out how to get

939
00:26:42,799 --> 00:26:43,679
things done

940
00:26:43,679 --> 00:26:45,840
um you know and if the signature is

941
00:26:45,840 --> 00:26:47,919
tight good right so say that the blue

942
00:26:47,919 --> 00:26:49,360
team has figured out how to signature a

943
00:26:49,360 --> 00:26:50,960
specific tactic that we're using

944
00:26:50,960 --> 00:26:52,720
um say i'm doing some form of memory

945
00:26:52,720 --> 00:26:55,039
injection to dump tokens for

946
00:26:55,039 --> 00:26:56,880
you know something out of memory and

947
00:26:56,880 --> 00:26:58,240
they realize that i'm calling a

948
00:26:58,240 --> 00:26:59,840
particular api for that and that nothing

949
00:26:59,840 --> 00:27:01,200
else in the system should ever call this

950
00:27:01,200 --> 00:27:02,320
api and so they put us

951
00:27:02,320 --> 00:27:03,600
you know a detection in place and it

952
00:27:03,600 --> 00:27:05,360
becomes high fidelity detection

953
00:27:05,360 --> 00:27:07,600
um the time just to work around that

954
00:27:07,600 --> 00:27:08,799
right and i might only have to change

955
00:27:08,799 --> 00:27:10,320
one api within our tooling can still

956
00:27:10,320 --> 00:27:11,520
take a couple of days

957
00:27:11,520 --> 00:27:13,039
depending on what i need to do right so

958
00:27:13,039 --> 00:27:14,640
we do have a test environment where we

959
00:27:14,640 --> 00:27:16,320
can test things out and

960
00:27:16,320 --> 00:27:19,120
we maintain our own uh azure tenant

961
00:27:19,120 --> 00:27:21,360
right so we own serpent.dev

962
00:27:21,360 --> 00:27:23,600
and we do you know security testing

963
00:27:23,600 --> 00:27:24,799
there things before

964
00:27:24,799 --> 00:27:26,640
we use them against our targets for this

965
00:27:26,640 --> 00:27:29,039
reason but it still makes it relatively

966
00:27:29,039 --> 00:27:29,520
tough

967
00:27:29,520 --> 00:27:33,440
right um and obviously i have a set time

968
00:27:33,440 --> 00:27:35,120
in which i need to get something done

969
00:27:35,120 --> 00:27:36,799
and so the way we deal about this is on

970
00:27:36,799 --> 00:27:39,600
our team we have a very tight cadence

971
00:27:39,600 --> 00:27:41,360
for how we manage tool development and i

972
00:27:41,360 --> 00:27:42,960
know a lot of red teams tend

973
00:27:42,960 --> 00:27:46,799
not to um like really structured things

974
00:27:46,799 --> 00:27:48,000
they prefer much more free

975
00:27:48,000 --> 00:27:51,039
form and i very much understand why but

976
00:27:51,039 --> 00:27:52,880
because we have limited resources and we

977
00:27:52,880 --> 00:27:54,720
need to accomplish a lot

978
00:27:54,720 --> 00:27:57,840
um we have

979
00:27:57,840 --> 00:27:59,440
like a stand up and we operate in

980
00:27:59,440 --> 00:28:01,200
sprints and if you're going to build a

981
00:28:01,200 --> 00:28:01,679
tool

982
00:28:01,679 --> 00:28:03,440
someone is going to look at it and

983
00:28:03,440 --> 00:28:04,960
they're going to want to know

984
00:28:04,960 --> 00:28:06,960
you know what's the purpose and how what

985
00:28:06,960 --> 00:28:08,320
the impacts of it are and how it will

986
00:28:08,320 --> 00:28:09,200
work

987
00:28:09,200 --> 00:28:10,399
there are a couple other things we also

988
00:28:10,399 --> 00:28:12,240
try to do so i've mentioned one of them

989
00:28:12,240 --> 00:28:13,600
on the slide here that in the industry

990
00:28:13,600 --> 00:28:15,520
there is the concept of what is known as

991
00:28:15,520 --> 00:28:18,399
a silent alert

992
00:28:23,440 --> 00:28:26,080
so a silent alert is when there's

993
00:28:26,080 --> 00:28:27,840
something that triggers the detection

994
00:28:27,840 --> 00:28:29,600
that doesn't necessarily notify the user

995
00:28:29,600 --> 00:28:31,600
right and so a lot of our tooling is

996
00:28:31,600 --> 00:28:32,240
signatured

997
00:28:32,240 --> 00:28:33,760
in that way shape or form right this

998
00:28:33,760 --> 00:28:35,520
allows microsoft or the business to have

999
00:28:35,520 --> 00:28:36,480
some

1000
00:28:36,480 --> 00:28:40,000
uh form of control over what we do right

1001
00:28:40,000 --> 00:28:41,760
um they're able to say hey your tooling

1002
00:28:41,760 --> 00:28:43,120
is only on these systems it hasn't

1003
00:28:43,120 --> 00:28:44,559
leaked outside the company

1004
00:28:44,559 --> 00:28:46,080
there isn't anything that we need to be

1005
00:28:46,080 --> 00:28:47,520
worried about there isn't any sort of

1006
00:28:47,520 --> 00:28:49,360
response that we need to take

1007
00:28:49,360 --> 00:28:50,960
and this is important right it's not

1008
00:28:50,960 --> 00:28:53,600
like we tend not to use a ton of o-days

1009
00:28:53,600 --> 00:28:54,960
as part of our work but we may use

1010
00:28:54,960 --> 00:28:56,720
say an end day or we may use a security

1011
00:28:56,720 --> 00:28:58,720
weakness that is not publicly known

1012
00:28:58,720 --> 00:29:00,559
um as part of the work that we do and so

1013
00:29:00,559 --> 00:29:01,840
because of that we have to guarantee to

1014
00:29:01,840 --> 00:29:02,720
the company

1015
00:29:02,720 --> 00:29:04,880
um that that information will be secure

1016
00:29:04,880 --> 00:29:06,559
right and so our stuff does get

1017
00:29:06,559 --> 00:29:08,640
signature to an extent

1018
00:29:08,640 --> 00:29:10,559
and then with the ttps so which is tools

1019
00:29:10,559 --> 00:29:12,080
tactics and procedures that we use and i

1020
00:29:12,080 --> 00:29:13,679
don't have a screenshot of this here

1021
00:29:13,679 --> 00:29:15,279
but we maintain a really robust wiki

1022
00:29:15,279 --> 00:29:16,720
it's organized by the mitre attack

1023
00:29:16,720 --> 00:29:17,760
framework

1024
00:29:17,760 --> 00:29:20,799
um and when we have say a ttp there is a

1025
00:29:20,799 --> 00:29:21,600
time so

1026
00:29:21,600 --> 00:29:23,919
it gets created at you know date foo and

1027
00:29:23,919 --> 00:29:25,760
periodically it will get aged out and by

1028
00:29:25,760 --> 00:29:27,200
aged out i mean that we will hand that

1029
00:29:27,200 --> 00:29:29,360
exact same ttp in a script that will

1030
00:29:29,360 --> 00:29:30,720
you know perform that in some way shape

1031
00:29:30,720 --> 00:29:32,159
or form off to the blue team and we will

1032
00:29:32,159 --> 00:29:34,399
let them fully signature

1033
00:29:34,399 --> 00:29:36,799
um or at least make some effort at

1034
00:29:36,799 --> 00:29:38,240
stopping it right if their signature is

1035
00:29:38,240 --> 00:29:39,520
bad we'll continue to use it and we'll

1036
00:29:39,520 --> 00:29:41,120
let them know that it's bad

1037
00:29:41,120 --> 00:29:44,640
um but this forces us to innovate

1038
00:29:44,640 --> 00:29:46,960
on our own schedule right so we can say

1039
00:29:46,960 --> 00:29:48,880
hey all right we're doing this

1040
00:29:48,880 --> 00:29:52,080
i know within six months we should not

1041
00:29:52,080 --> 00:29:53,520
be able to do this

1042
00:29:53,520 --> 00:29:55,440
and therefore we will take actions a b

1043
00:29:55,440 --> 00:29:56,960
and c in order to solve this problem

1044
00:29:56,960 --> 00:29:57,679
potentially

1045
00:29:57,679 --> 00:29:59,919
right if there is a password sprayable

1046
00:29:59,919 --> 00:30:00,880
endpoint

1047
00:30:00,880 --> 00:30:02,960
um there's a periodic time where we'll

1048
00:30:02,960 --> 00:30:04,399
say password spread and then we'll be

1049
00:30:04,399 --> 00:30:05,840
like okay we need to get this reported

1050
00:30:05,840 --> 00:30:07,360
needs to be done you can't necessarily

1051
00:30:07,360 --> 00:30:08,559
sit on this

1052
00:30:08,559 --> 00:30:11,279
um and then for the team and i talked

1053
00:30:11,279 --> 00:30:12,640
about the skills matrix

1054
00:30:12,640 --> 00:30:14,480
earlier we're going to hire people that

1055
00:30:14,480 --> 00:30:16,399
can do development across a wide variety

1056
00:30:16,399 --> 00:30:17,840
of languages right we have a couple of

1057
00:30:17,840 --> 00:30:19,440
people that are experts in.net we have a

1058
00:30:19,440 --> 00:30:20,480
couple of people that are great at

1059
00:30:20,480 --> 00:30:21,520
python powershell

1060
00:30:21,520 --> 00:30:22,799
scripting et cetera and a couple of

1061
00:30:22,799 --> 00:30:24,720
people that do native code um c

1062
00:30:24,720 --> 00:30:26,960
c plus plus etc um and that are pretty

1063
00:30:26,960 --> 00:30:29,039
good at you know same memory stuff

1064
00:30:29,039 --> 00:30:30,559
and this allows us to somewhat spread

1065
00:30:30,559 --> 00:30:32,000
the workload of the tools development

1066
00:30:32,000 --> 00:30:32,960
that we need to do

1067
00:30:32,960 --> 00:30:36,000
um across the team because for

1068
00:30:36,000 --> 00:30:37,919
the different environments that we we

1069
00:30:37,919 --> 00:30:39,440
target and our i guess i think our team

1070
00:30:39,440 --> 00:30:41,120
among world teams is somewhat unique

1071
00:30:41,120 --> 00:30:42,960
that we have such a broad and diverse

1072
00:30:42,960 --> 00:30:44,159
environment because we have say the

1073
00:30:44,159 --> 00:30:45,440
gaming studios

1074
00:30:45,440 --> 00:30:48,240
and they use uh a lot of different

1075
00:30:48,240 --> 00:30:50,480
technologies under the sun

1076
00:30:50,480 --> 00:30:51,840
then this allows us to make sure that we

1077
00:30:51,840 --> 00:30:53,840
are able to cover them adequately

1078
00:30:53,840 --> 00:30:56,399
um and then obviously we'll do some

1079
00:30:56,399 --> 00:30:56,960
sorts of

1080
00:30:56,960 --> 00:30:58,559
uh occasionally we'll do periodic tests

1081
00:30:58,559 --> 00:30:59,760
to just make sure that things are still

1082
00:30:59,760 --> 00:31:01,200
working like i'll drop

1083
00:31:01,200 --> 00:31:04,240
my car to disk so icar is a file

1084
00:31:04,240 --> 00:31:05,760
that will flag a defender alert that

1085
00:31:05,760 --> 00:31:07,039
will trigger you know response

1086
00:31:07,039 --> 00:31:08,480
automatically and so we can use this to

1087
00:31:08,480 --> 00:31:09,279
make sure that

1088
00:31:09,279 --> 00:31:10,960
okay this is happening but our tool's

1089
00:31:10,960 --> 00:31:12,320
not being signature once again we do

1090
00:31:12,320 --> 00:31:13,760
this within our own test environment

1091
00:31:13,760 --> 00:31:15,840
that we have specifically stood up

1092
00:31:15,840 --> 00:31:19,360
for this purpose and uh we do run mdhp

1093
00:31:19,360 --> 00:31:20,720
in that that is the primary thing that

1094
00:31:20,720 --> 00:31:22,080
we use to check and see

1095
00:31:22,080 --> 00:31:24,799
um what triggers the detection right

1096
00:31:24,799 --> 00:31:26,720
this is not the only anti-malware engine

1097
00:31:26,720 --> 00:31:27,760
that we will face or that we may

1098
00:31:27,760 --> 00:31:29,039
potentially have to evade which is the

1099
00:31:29,039 --> 00:31:30,720
primary one that we test against right

1100
00:31:30,720 --> 00:31:33,840
so defender and mdhp and we do deploy

1101
00:31:33,840 --> 00:31:34,559
those

1102
00:31:34,559 --> 00:31:37,440
same tools that we uh use or work

1103
00:31:37,440 --> 00:31:39,039
against on our attack systems to make

1104
00:31:39,039 --> 00:31:42,000
sure that they are secure

1105
00:31:42,000 --> 00:31:43,360
um this is kind of an interesting one as

1106
00:31:43,360 --> 00:31:45,360
this is explicitly forbidden in our oes

1107
00:31:45,360 --> 00:31:46,960
and it is that basically we cannot

1108
00:31:46,960 --> 00:31:48,640
weaken the security of any system that

1109
00:31:48,640 --> 00:31:49,760
we get on

1110
00:31:49,760 --> 00:31:51,840
um and the way i believe it has worked

1111
00:31:51,840 --> 00:31:53,519
is that we have to maintain the same

1112
00:31:53,519 --> 00:31:55,200
posture for the security of the systems

1113
00:31:55,200 --> 00:31:56,640
that we compromise

1114
00:31:56,640 --> 00:32:00,240
as uh the same or greater

1115
00:32:00,240 --> 00:32:01,679
security posture of a system that we

1116
00:32:01,679 --> 00:32:03,519
compromised right um

1117
00:32:03,519 --> 00:32:05,279
and this is somewhat unique right

1118
00:32:05,279 --> 00:32:06,399
because it means there are certain

1119
00:32:06,399 --> 00:32:07,919
things that adversaries commonly do when

1120
00:32:07,919 --> 00:32:09,440
they get on a box that we cannot do

1121
00:32:09,440 --> 00:32:11,039
right so if you get on a box and you're

1122
00:32:11,039 --> 00:32:12,320
an actual attacker one of the first

1123
00:32:12,320 --> 00:32:13,200
things you're probably going to want to

1124
00:32:13,200 --> 00:32:14,960
do is turn off telemetry right

1125
00:32:14,960 --> 00:32:16,960
you don't want to allow login traffic to

1126
00:32:16,960 --> 00:32:18,399
show what you do afterwards after you

1127
00:32:18,399 --> 00:32:19,679
got on the system or at least you want

1128
00:32:19,679 --> 00:32:20,960
to have some sort of way

1129
00:32:20,960 --> 00:32:22,640
in guaranteeing that any action you take

1130
00:32:22,640 --> 00:32:24,480
on the system won't be locked so you

1131
00:32:24,480 --> 00:32:25,840
might trigger an exception you might say

1132
00:32:25,840 --> 00:32:27,440
hey don't note this data

1133
00:32:27,440 --> 00:32:28,559
you might turn off some sort of

1134
00:32:28,559 --> 00:32:31,120
defensive software maybe you'll route

1135
00:32:31,120 --> 00:32:32,720
audit events to null or something like

1136
00:32:32,720 --> 00:32:34,720
that so in that way shape or form

1137
00:32:34,720 --> 00:32:37,840
your actions aren't taken or stored we

1138
00:32:37,840 --> 00:32:39,200
can't do that right

1139
00:32:39,200 --> 00:32:41,679
um it's just not something that we have

1140
00:32:41,679 --> 00:32:43,200
the capability to do

1141
00:32:43,200 --> 00:32:46,799
um and it's explicitly forbidden and so

1142
00:32:46,799 --> 00:32:48,480
for us the reason why this matters is it

1143
00:32:48,480 --> 00:32:50,000
makes it uh harder

1144
00:32:50,000 --> 00:32:51,679
to actually emulate an actual attacker

1145
00:32:51,679 --> 00:32:53,360
right um

1146
00:32:53,360 --> 00:32:55,360
normal attackers would relatively easily

1147
00:32:55,360 --> 00:32:56,720
blind the blue team and a lot of

1148
00:32:56,720 --> 00:32:58,640
attacks against say anti-malware systems

1149
00:32:58,640 --> 00:32:59,679
that are out there will involve some

1150
00:32:59,679 --> 00:33:01,279
sort of denial of service some sort of

1151
00:33:01,279 --> 00:33:03,039
disabling of the system some sort of you

1152
00:33:03,039 --> 00:33:04,100
know um

1153
00:33:04,100 --> 00:33:05,200
[Music]

1154
00:33:05,200 --> 00:33:07,440
action which which prevents the system

1155
00:33:07,440 --> 00:33:08,559
from communicating back to

1156
00:33:08,559 --> 00:33:11,360
the endpoint um we can't really do that

1157
00:33:11,360 --> 00:33:12,640
right we're forbidden from doing such

1158
00:33:12,640 --> 00:33:14,080
things we have to make sure that our

1159
00:33:14,080 --> 00:33:15,760
binaries and the code that we run do not

1160
00:33:15,760 --> 00:33:17,120
trigger an alert in the first place

1161
00:33:17,120 --> 00:33:17,519
right

1162
00:33:17,519 --> 00:33:19,279
they might get logged right and a lot of

1163
00:33:19,279 --> 00:33:20,960
the stuff that we do do does get logged

1164
00:33:20,960 --> 00:33:22,559
and potentially generates an event

1165
00:33:22,559 --> 00:33:24,000
but it doesn't generate a high enough

1166
00:33:24,000 --> 00:33:26,000
fidelity event for it to trigger an

1167
00:33:26,000 --> 00:33:26,720
alert

1168
00:33:26,720 --> 00:33:30,000
um and this is just because we

1169
00:33:30,000 --> 00:33:31,760
have to make sure that the blue team has

1170
00:33:31,760 --> 00:33:33,120
a concrete

1171
00:33:33,120 --> 00:33:36,080
record or track of whatever we did um if

1172
00:33:36,080 --> 00:33:37,279
i find a system that say internet

1173
00:33:37,279 --> 00:33:38,640
exposed and i've got an example here

1174
00:33:38,640 --> 00:33:39,679
right so there's a system that's

1175
00:33:39,679 --> 00:33:41,360
internet exposed and say i successfully

1176
00:33:41,360 --> 00:33:42,880
brute force it get through the defenses

1177
00:33:42,880 --> 00:33:44,559
and i get onto the box right

1178
00:33:44,559 --> 00:33:48,000
um you know that i might

1179
00:33:48,000 --> 00:33:49,600
not be the only person on that system

1180
00:33:49,600 --> 00:33:50,880
right there might be someone else that

1181
00:33:50,880 --> 00:33:52,399
has brute force that and also gotten on

1182
00:33:52,399 --> 00:33:53,120
that system

1183
00:33:53,120 --> 00:33:54,640
yes i might have a better word list than

1184
00:33:54,640 --> 00:33:55,760
me because i know generally what

1185
00:33:55,760 --> 00:33:56,880
internal password patterns are

1186
00:33:56,880 --> 00:33:58,159
potentially for the team or the system

1187
00:33:58,159 --> 00:33:59,200
that i'm trying to brute force but

1188
00:33:59,200 --> 00:34:00,880
someone else may have figured it out

1189
00:34:00,880 --> 00:34:04,240
and i have to be confident that um i can

1190
00:34:04,240 --> 00:34:06,080
equivocally say what actions are mine

1191
00:34:06,080 --> 00:34:07,919
and what actions are not mine in the

1192
00:34:07,919 --> 00:34:10,560
event um that i am not the only person

1193
00:34:10,560 --> 00:34:11,280
on that box

1194
00:34:11,280 --> 00:34:13,040
right specifically for systems that are

1195
00:34:13,040 --> 00:34:14,800
exploitable the end day vulnerability

1196
00:34:14,800 --> 00:34:16,399
this is a risk right there are people

1197
00:34:16,399 --> 00:34:17,599
that are out there that reverse

1198
00:34:17,599 --> 00:34:18,719
microsoft patches

1199
00:34:18,719 --> 00:34:21,440
on a fairly regular basis um and so

1200
00:34:21,440 --> 00:34:22,399
that's something that we have to take

1201
00:34:22,399 --> 00:34:23,760
into account

1202
00:34:23,760 --> 00:34:24,639
the other one in the middle is the

1203
00:34:24,639 --> 00:34:27,040
customer data is a hard no so for all of

1204
00:34:27,040 --> 00:34:27,760
you

1205
00:34:27,760 --> 00:34:29,839
that use our products so first thank you

1206
00:34:29,839 --> 00:34:31,280
but understand that we do not touch your

1207
00:34:31,280 --> 00:34:32,239
data ever

1208
00:34:32,239 --> 00:34:34,800
and so if i'm testing say xbox and i

1209
00:34:34,800 --> 00:34:36,079
want to go see if i can

1210
00:34:36,079 --> 00:34:38,320
say compromise a specific account what

1211
00:34:38,320 --> 00:34:39,679
we will do is we will create an account

1212
00:34:39,679 --> 00:34:41,359
in advance so we will create an account

1213
00:34:41,359 --> 00:34:42,639
just like a regular user

1214
00:34:42,639 --> 00:34:43,918
um we'll run it through the process

1215
00:34:43,918 --> 00:34:45,520
everything get it onboarded it'll be an

1216
00:34:45,520 --> 00:34:46,719
account that we control that we know

1217
00:34:46,719 --> 00:34:47,199
about

1218
00:34:47,199 --> 00:34:48,480
and then we will go out and we will

1219
00:34:48,480 --> 00:34:49,918
target or compromise that specific

1220
00:34:49,918 --> 00:34:50,639
account

1221
00:34:50,639 --> 00:34:51,918
but we have to be careful that we don't

1222
00:34:51,918 --> 00:34:53,359
touch anyone else's account right you

1223
00:34:53,359 --> 00:34:54,639
don't want to trigger a privacy

1224
00:34:54,639 --> 00:34:56,719
you don't want to trigger customer data

1225
00:34:56,719 --> 00:34:59,359
exposure in any way shape or form

1226
00:34:59,359 --> 00:35:01,119
attackers don't have this problem right

1227
00:35:01,119 --> 00:35:02,160
they don't really care if they look at

1228
00:35:02,160 --> 00:35:03,680
your data or bob's data or whatever they

1229
00:35:03,680 --> 00:35:04,960
just care that they get the goal

1230
00:35:04,960 --> 00:35:07,200
right um they probably are more annoyed

1231
00:35:07,200 --> 00:35:08,880
if they see data that isn't relevant

1232
00:35:08,880 --> 00:35:11,200
than uh data that is potentially useful

1233
00:35:11,200 --> 00:35:12,160
for them

1234
00:35:12,160 --> 00:35:14,160
so because of this we've had to take um

1235
00:35:14,160 --> 00:35:16,800
some kind of unique approaches so

1236
00:35:16,800 --> 00:35:19,040
i mentioned that we're a tool

1237
00:35:19,040 --> 00:35:20,079
development team

1238
00:35:20,079 --> 00:35:21,359
and one of the things i think that is

1239
00:35:21,359 --> 00:35:23,040
unique about our red team at microsoft

1240
00:35:23,040 --> 00:35:23,839
is we are a

1241
00:35:23,839 --> 00:35:26,480
build it over a biox team and i think

1242
00:35:26,480 --> 00:35:27,839
that in general as part of the corporate

1243
00:35:27,839 --> 00:35:29,040
culture the company

1244
00:35:29,040 --> 00:35:30,560
we are an engineering company and so

1245
00:35:30,560 --> 00:35:31,839
people tend to want to build things

1246
00:35:31,839 --> 00:35:32,640
in-house

1247
00:35:32,640 --> 00:35:34,079
and you may have multiple different

1248
00:35:34,079 --> 00:35:35,280
copies of the same thing that has been

1249
00:35:35,280 --> 00:35:38,400
built multiple different times

1250
00:35:41,040 --> 00:35:44,160
but people will build it in-house right

1251
00:35:44,160 --> 00:35:45,680
rather than potentially purchase a

1252
00:35:45,680 --> 00:35:47,200
completely viable product that does that

1253
00:35:47,200 --> 00:35:49,359
thing successfully off the market

1254
00:35:49,359 --> 00:35:51,280
and we do use some cots products but

1255
00:35:51,280 --> 00:35:52,480
very very few

1256
00:35:52,480 --> 00:35:54,720
um and so because of that we have an

1257
00:35:54,720 --> 00:35:55,760
internal team restriction that our

1258
00:35:55,760 --> 00:35:56,800
tooling has to go through the same

1259
00:35:56,800 --> 00:35:58,160
release process that all internal

1260
00:35:58,160 --> 00:35:59,920
microsoft products have to do

1261
00:35:59,920 --> 00:36:02,160
um and that does include things like we

1262
00:36:02,160 --> 00:36:03,440
get our tooling code agreed by the

1263
00:36:03,440 --> 00:36:04,640
component pen test team

1264
00:36:04,640 --> 00:36:06,720
um we get our tooling threat model our

1265
00:36:06,720 --> 00:36:07,760
tooling has to perform

1266
00:36:07,760 --> 00:36:10,160
authentication at a specific level and

1267
00:36:10,160 --> 00:36:11,599
if there's a standard that deprecates

1268
00:36:11,599 --> 00:36:12,079
the use

1269
00:36:12,079 --> 00:36:14,000
of specific authentication so say you

1270
00:36:14,000 --> 00:36:15,920
know tls 1.0 is deprecated

1271
00:36:15,920 --> 00:36:17,119
our tooling cannot perform

1272
00:36:17,119 --> 00:36:18,800
authentication using that deprecated

1273
00:36:18,800 --> 00:36:20,560
standard either

1274
00:36:20,560 --> 00:36:22,000
um honestly it's kind of annoying at

1275
00:36:22,000 --> 00:36:23,760
times because it does require us to

1276
00:36:23,760 --> 00:36:26,000
potentially modernize or change things

1277
00:36:26,000 --> 00:36:27,440
and then make sure that our tooling is

1278
00:36:27,440 --> 00:36:29,280
up to the same standard that it needs to

1279
00:36:29,280 --> 00:36:30,560
be

1280
00:36:30,560 --> 00:36:33,359
um we love all our actions uh we try and

1281
00:36:33,359 --> 00:36:34,560
do this via automation as much as

1282
00:36:34,560 --> 00:36:35,040
possible

1283
00:36:35,040 --> 00:36:38,000
right so um every operator or when you

1284
00:36:38,000 --> 00:36:39,119
are on an engagement you will have a

1285
00:36:39,119 --> 00:36:40,560
dedicated attack system you'll have a

1286
00:36:40,560 --> 00:36:42,400
dedicated tissue system your actions and

1287
00:36:42,400 --> 00:36:43,760
activities that you take are supposed to

1288
00:36:43,760 --> 00:36:45,440
be from those systems

1289
00:36:45,440 --> 00:36:47,760
and we will collect all the actions and

1290
00:36:47,760 --> 00:36:49,359
activity that happens on those systems

1291
00:36:49,359 --> 00:36:50,960
and we store them for an extended period

1292
00:36:50,960 --> 00:36:51,680
of time

1293
00:36:51,680 --> 00:36:53,920
um and then the c2 obviously

1294
00:36:53,920 --> 00:36:55,680
automatically logs

1295
00:36:55,680 --> 00:36:57,040
all the commands anything that goes

1296
00:36:57,040 --> 00:36:58,720
through it traffic etc and this is

1297
00:36:58,720 --> 00:37:00,240
deployed within a specific network

1298
00:37:00,240 --> 00:37:01,520
environment that allows us to capture

1299
00:37:01,520 --> 00:37:03,359
all the traffic right

1300
00:37:03,359 --> 00:37:06,160
that's mandatory um we don't give it to

1301
00:37:06,160 --> 00:37:07,680
the blue team when it's done but we do

1302
00:37:07,680 --> 00:37:08,960
maintain that data

1303
00:37:08,960 --> 00:37:11,839
in the event that it's ever needed that

1304
00:37:11,839 --> 00:37:13,119
which brings me to the next point that

1305
00:37:13,119 --> 00:37:14,400
there is an internal deconfliction

1306
00:37:14,400 --> 00:37:15,839
process that is set up so the blue team

1307
00:37:15,839 --> 00:37:17,359
does have a way in the event that they

1308
00:37:17,359 --> 00:37:19,680
actually think that say something is

1309
00:37:19,680 --> 00:37:21,520
a real event of making sure that it

1310
00:37:21,520 --> 00:37:22,720
isn't the red team right

1311
00:37:22,720 --> 00:37:25,440
um they have to work for their mail it's

1312
00:37:25,440 --> 00:37:26,400
not just hey

1313
00:37:26,400 --> 00:37:27,760
was this the red team or hey what's this

1314
00:37:27,760 --> 00:37:29,680
not right they obviously have to

1315
00:37:29,680 --> 00:37:31,520
you know provide some sort of reasoning

1316
00:37:31,520 --> 00:37:33,280
data or potential signal for why they

1317
00:37:33,280 --> 00:37:34,160
believe it is a b

1318
00:37:34,160 --> 00:37:36,720
or c and we will respond within a timely

1319
00:37:36,720 --> 00:37:37,359
manner

1320
00:37:37,359 --> 00:37:39,760
likewise um going back to the example

1321
00:37:39,760 --> 00:37:41,119
from the previous slide if i brute force

1322
00:37:41,119 --> 00:37:42,640
an internet exposed endpoint i will

1323
00:37:42,640 --> 00:37:44,240
probably let the blue team know right

1324
00:37:44,240 --> 00:37:44,640
away

1325
00:37:44,640 --> 00:37:46,560
right that's a scenario where i would

1326
00:37:46,560 --> 00:37:48,400
not be comfortable saying that hey this

1327
00:37:48,400 --> 00:37:49,920
system has not been compromised by

1328
00:37:49,920 --> 00:37:51,760
someone else potentially right

1329
00:37:51,760 --> 00:37:53,760
and so if we find a vulnerability of the

1330
00:37:53,760 --> 00:37:55,520
sort that crosses an identity boundary

1331
00:37:55,520 --> 00:37:56,320
right so

1332
00:37:56,320 --> 00:37:58,000
um say i find a vulnerability that gets

1333
00:37:58,000 --> 00:38:00,079
me into like a code sign environment

1334
00:38:00,079 --> 00:38:03,200
um and it's significant i would

1335
00:38:03,200 --> 00:38:04,720
reach out i would say hey there's this

1336
00:38:04,720 --> 00:38:07,359
thing right we have a way of doing that

1337
00:38:07,359 --> 00:38:08,400
and i would let them follow their

1338
00:38:08,400 --> 00:38:09,920
standard incident response process to

1339
00:38:09,920 --> 00:38:11,440
make sure that

1340
00:38:11,440 --> 00:38:13,680
the system is not compromised and that

1341
00:38:13,680 --> 00:38:15,359
just allows the business to have that

1342
00:38:15,359 --> 00:38:16,880
kind of level of assurance that we are

1343
00:38:16,880 --> 00:38:18,320
the only people that are in an

1344
00:38:18,320 --> 00:38:19,119
environment

1345
00:38:19,119 --> 00:38:21,040
when we should be right that's never a

1346
00:38:21,040 --> 00:38:22,400
fun scenario to get somewhere and then

1347
00:38:22,400 --> 00:38:24,640
find out that you're not alone

1348
00:38:24,640 --> 00:38:26,640
um red teaming is one of the places

1349
00:38:26,640 --> 00:38:27,839
where you want to be the only guy in

1350
00:38:27,839 --> 00:38:28,480
space

1351
00:38:28,480 --> 00:38:29,760
you don't want to have other travelers

1352
00:38:29,760 --> 00:38:31,599
there with you

1353
00:38:31,599 --> 00:38:32,880
and i think this is the last major

1354
00:38:32,880 --> 00:38:34,960
limitation that we have and that is that

1355
00:38:34,960 --> 00:38:36,240
we're time boxed right

1356
00:38:36,240 --> 00:38:39,119
so most of our engagements happen from

1357
00:38:39,119 --> 00:38:39,520
uh

1358
00:38:39,520 --> 00:38:41,119
a max of 12 weeks so we have a max of

1359
00:38:41,119 --> 00:38:42,560
one quarter to do it and

1360
00:38:42,560 --> 00:38:44,240
resource wise well we can have as many

1361
00:38:44,240 --> 00:38:45,760
as seven people on the engagement

1362
00:38:45,760 --> 00:38:47,359
potentially eight our manager is

1363
00:38:47,359 --> 00:38:48,880
technical and he does lean in from time

1364
00:38:48,880 --> 00:38:50,560
to time which is awesome

1365
00:38:50,560 --> 00:38:53,359
um but we are time boxed right uh and an

1366
00:38:53,359 --> 00:38:55,119
adversary that comes against microsoft

1367
00:38:55,119 --> 00:38:56,720
um or an adversary that attacks a

1368
00:38:56,720 --> 00:38:58,640
specific property of ours

1369
00:38:58,640 --> 00:39:00,880
may have years to do this right um they

1370
00:39:00,880 --> 00:39:01,920
may be outside

1371
00:39:01,920 --> 00:39:04,400
you know the legal reach of uh our

1372
00:39:04,400 --> 00:39:05,520
company and they may just

1373
00:39:05,520 --> 00:39:06,960
literally wake up every morning and say

1374
00:39:06,960 --> 00:39:08,720
hey it's my job to come you know go do

1375
00:39:08,720 --> 00:39:09,839
microsoft

1376
00:39:09,839 --> 00:39:12,640
and uh whereas we have a very short

1377
00:39:12,640 --> 00:39:13,839
amount of time to learn about our

1378
00:39:13,839 --> 00:39:14,640
environment

1379
00:39:14,640 --> 00:39:17,200
um and then compromise the target right

1380
00:39:17,200 --> 00:39:18,720
and some of our shorter tests we might

1381
00:39:18,720 --> 00:39:19,920
only have like

1382
00:39:19,920 --> 00:39:22,480
two to four weeks right um it might be a

1383
00:39:22,480 --> 00:39:23,839
really rushed test or you know

1384
00:39:23,839 --> 00:39:25,359
we have to immediately go out and check

1385
00:39:25,359 --> 00:39:26,480
something because say there was an

1386
00:39:26,480 --> 00:39:27,280
incident there and

1387
00:39:27,280 --> 00:39:28,400
someone wants to you know see if there's

1388
00:39:28,400 --> 00:39:30,640
anything else there right and then there

1389
00:39:30,640 --> 00:39:32,160
are obviously going to be times when uh

1390
00:39:32,160 --> 00:39:33,280
we can't test right

1391
00:39:33,280 --> 00:39:36,560
so um it's october and the october 2020

1392
00:39:36,560 --> 00:39:38,400
windows update or windows

1393
00:39:38,400 --> 00:39:40,240
release is out uh now would probably be

1394
00:39:40,240 --> 00:39:41,680
a bad time for me to go test windows

1395
00:39:41,680 --> 00:39:42,000
update

1396
00:39:42,000 --> 00:39:43,680
doesn't mean that i couldn't test

1397
00:39:43,680 --> 00:39:45,680
windows update it just might be a bad

1398
00:39:45,680 --> 00:39:47,359
time for me to do it and

1399
00:39:47,359 --> 00:39:48,880
one of the things that i want to do is

1400
00:39:48,880 --> 00:39:50,400
maintain a friendly relationship with

1401
00:39:50,400 --> 00:39:51,839
the business so they don't get mad at me

1402
00:39:51,839 --> 00:39:54,839
and they will let me come and do the

1403
00:39:54,839 --> 00:39:57,839
testing

1404
00:39:59,200 --> 00:40:00,560
and so i'm going to delve into a little

1405
00:40:00,560 --> 00:40:01,599
bit more details this is one of the

1406
00:40:01,599 --> 00:40:02,640
cooler pieces of tooling that we've

1407
00:40:02,640 --> 00:40:03,200
written

1408
00:40:03,200 --> 00:40:04,720
and i think the next slide i have here

1409
00:40:04,720 --> 00:40:06,000
we'll talk a little bit in detail about

1410
00:40:06,000 --> 00:40:07,599
how the tooling works

1411
00:40:07,599 --> 00:40:09,520
and so remember how i mentioned our

1412
00:40:09,520 --> 00:40:10,960
assume breach mentality so one of the

1413
00:40:10,960 --> 00:40:12,800
things that we prefer to do is not have

1414
00:40:12,800 --> 00:40:13,280
to ask

1415
00:40:13,280 --> 00:40:16,079
for a user right or not have to say

1416
00:40:16,079 --> 00:40:16,640
start with an

1417
00:40:16,640 --> 00:40:18,000
authenticated network user somewhere

1418
00:40:18,000 --> 00:40:19,920
right that makes the test a little bit

1419
00:40:19,920 --> 00:40:23,200
um less realistic right so instead what

1420
00:40:23,200 --> 00:40:24,319
we'll try and do is

1421
00:40:24,319 --> 00:40:26,000
during the course of other tests all

1422
00:40:26,000 --> 00:40:27,680
right um occasionally you'll get into an

1423
00:40:27,680 --> 00:40:28,960
environment and you'll be like uh

1424
00:40:28,960 --> 00:40:31,359
this environment isn't super useful

1425
00:40:31,359 --> 00:40:32,640
we're not necessarily testing

1426
00:40:32,640 --> 00:40:34,319
this didn't land where we thought it 100

1427
00:40:34,319 --> 00:40:35,920
would land right you do plan things out

1428
00:40:35,920 --> 00:40:37,359
right you're not going to try and wander

1429
00:40:37,359 --> 00:40:38,960
you know across the entire

1430
00:40:38,960 --> 00:40:40,720
corporate environment or entire scope of

1431
00:40:40,720 --> 00:40:42,000
whatever you're testing

1432
00:40:42,000 --> 00:40:45,280
but sometimes you'll get some access

1433
00:40:45,280 --> 00:40:48,240
and it just doesn't make a ton of use we

1434
00:40:48,240 --> 00:40:49,760
will persist there right

1435
00:40:49,760 --> 00:40:52,880
um and we invest a significant amount of

1436
00:40:52,880 --> 00:40:53,280
time

1437
00:40:53,280 --> 00:40:55,680
into persisting there right so that way

1438
00:40:55,680 --> 00:40:56,720
if i ever need

1439
00:40:56,720 --> 00:40:58,480
to come back and test something that is

1440
00:40:58,480 --> 00:41:00,240
say one to two hops away from where we

1441
00:41:00,240 --> 00:41:01,200
are persisting

1442
00:41:01,200 --> 00:41:03,440
i can activate that persistence i can

1443
00:41:03,440 --> 00:41:05,040
then perform the actions

1444
00:41:05,040 --> 00:41:06,560
that i need to do in a much shorter

1445
00:41:06,560 --> 00:41:08,640
quicker manner and it forces the blue

1446
00:41:08,640 --> 00:41:09,680
team to have to hunt for that

1447
00:41:09,680 --> 00:41:10,720
persistence

1448
00:41:10,720 --> 00:41:14,079
off-band right this gives them something

1449
00:41:14,079 --> 00:41:15,680
to look for on a daily basis

1450
00:41:15,680 --> 00:41:17,440
right they might be specialized in

1451
00:41:17,440 --> 00:41:19,599
hunting in a particular environment so

1452
00:41:19,599 --> 00:41:21,040
say someone is specialized in hunting

1453
00:41:21,040 --> 00:41:22,640
within the gaming telemetry we might not

1454
00:41:22,640 --> 00:41:23,760
be testing gaming

1455
00:41:23,760 --> 00:41:26,560
um on any given day of the week but if

1456
00:41:26,560 --> 00:41:28,319
we are persisting with that environment

1457
00:41:28,319 --> 00:41:29,760
that person that's working there looking

1458
00:41:29,760 --> 00:41:31,440
at the telemetry probably has a signal

1459
00:41:31,440 --> 00:41:32,400
somewhere

1460
00:41:32,400 --> 00:41:33,760
where they can you know potentially find

1461
00:41:33,760 --> 00:41:35,680
us it might be hard for them to figure

1462
00:41:35,680 --> 00:41:36,640
out what it is

1463
00:41:36,640 --> 00:41:39,680
um but we intentionally choose to

1464
00:41:39,680 --> 00:41:41,839
persist and leave artifacts

1465
00:41:41,839 --> 00:41:45,680
in specific places um so that way we can

1466
00:41:45,680 --> 00:41:47,119
challenge our blue team and force them

1467
00:41:47,119 --> 00:41:48,480
to actually understand and make sure

1468
00:41:48,480 --> 00:41:49,680
that they have the coverage of the

1469
00:41:49,680 --> 00:41:51,599
telemetry that they need

1470
00:41:51,599 --> 00:41:54,720
obviously um there's automation involved

1471
00:41:54,720 --> 00:41:56,240
and this does require us to plan out our

1472
00:41:56,240 --> 00:41:57,520
engagement several cycles in advance

1473
00:41:57,520 --> 00:41:58,800
which you know obvious

1474
00:41:58,800 --> 00:42:00,079
doesn't always work as i mentioned

1475
00:42:00,079 --> 00:42:01,200
sometimes the business comes back and

1476
00:42:01,200 --> 00:42:02,720
says hey we need you to do a

1477
00:42:02,720 --> 00:42:04,079
um but if we have that persistence it

1478
00:42:04,079 --> 00:42:06,400
will work so the framework that we've

1479
00:42:06,400 --> 00:42:06,880
built

1480
00:42:06,880 --> 00:42:08,720
um is fairly simplistic so when we're

1481
00:42:08,720 --> 00:42:10,319
thinking about this

1482
00:42:10,319 --> 00:42:13,119
um it's been a couple years now before

1483
00:42:13,119 --> 00:42:14,400
we started building this

1484
00:42:14,400 --> 00:42:15,520
the idea being that we wanted to put

1485
00:42:15,520 --> 00:42:16,800
minimal effort into it right but we

1486
00:42:16,800 --> 00:42:17,680
wanted to have something that would

1487
00:42:17,680 --> 00:42:18,960
adequately enable us to

1488
00:42:18,960 --> 00:42:22,319
properly uh translate or talk to the

1489
00:42:22,319 --> 00:42:23,839
targets we're persistent on

1490
00:42:23,839 --> 00:42:26,160
and so in this diagram here i've got a

1491
00:42:26,160 --> 00:42:27,520
controller and a storage and so the

1492
00:42:27,520 --> 00:42:28,720
storage account you should think of as

1493
00:42:28,720 --> 00:42:30,400
something just like an azure blob right

1494
00:42:30,400 --> 00:42:32,800
uh you can use any storage uh of your

1495
00:42:32,800 --> 00:42:33,920
that your of your case right so

1496
00:42:33,920 --> 00:42:36,000
basically it just hosts some data

1497
00:42:36,000 --> 00:42:38,000
um in our case it will eventually host

1498
00:42:38,000 --> 00:42:39,599
an implant that we're going to send back

1499
00:42:39,599 --> 00:42:40,800
to our target right

1500
00:42:40,800 --> 00:42:42,400
and the controller once again fairly

1501
00:42:42,400 --> 00:42:44,640
simplistic um not a lot of ton of coding

1502
00:42:44,640 --> 00:42:45,599
skills required

1503
00:42:45,599 --> 00:42:47,920
um it just needs to talk to some

1504
00:42:47,920 --> 00:42:49,680
endpoints and manage things right

1505
00:42:49,680 --> 00:42:52,800
um and we use

1506
00:42:52,800 --> 00:42:55,359
uh a pattern in such a way that enables

1507
00:42:55,359 --> 00:42:56,480
us to

1508
00:42:56,480 --> 00:42:58,160
basically load it's called an observer

1509
00:42:58,160 --> 00:42:59,040
pattern for those of you that are

1510
00:42:59,040 --> 00:42:59,920
developers

1511
00:42:59,920 --> 00:43:02,319
um to load different um endpoints that

1512
00:43:02,319 --> 00:43:03,599
it needs to talk to and push data to

1513
00:43:03,599 --> 00:43:05,359
them but the controller is fairly simple

1514
00:43:05,359 --> 00:43:07,359
it just checks the key value pair

1515
00:43:07,359 --> 00:43:09,119
against a database and if so

1516
00:43:09,119 --> 00:43:10,960
it then grabs something from the storage

1517
00:43:10,960 --> 00:43:12,960
blob and i'll return it to that endpoint

1518
00:43:12,960 --> 00:43:15,760
where it needs to go um and then we've

1519
00:43:15,760 --> 00:43:17,040
got our targets the internets and

1520
00:43:17,040 --> 00:43:17,680
transports

1521
00:43:17,680 --> 00:43:19,599
so and the controller as i mentioned can

1522
00:43:19,599 --> 00:43:21,680
talk to the transports

1523
00:43:21,680 --> 00:43:23,599
so and our c2 is a separate entity

1524
00:43:23,599 --> 00:43:25,359
outside of this right so

1525
00:43:25,359 --> 00:43:27,920
um the c2 is a large investment right we

1526
00:43:27,920 --> 00:43:28,480
are not

1527
00:43:28,480 --> 00:43:30,160
the primary authors of the c2 that we

1528
00:43:30,160 --> 00:43:31,440
currently use at microsoft it is

1529
00:43:31,440 --> 00:43:32,800
developed by another team although we do

1530
00:43:32,800 --> 00:43:33,520
contribute

1531
00:43:33,520 --> 00:43:35,760
um there is largely one c2 that

1532
00:43:35,760 --> 00:43:37,760
everybody kind of contributes to that is

1533
00:43:37,760 --> 00:43:40,160
used by the red teams at microsoft um

1534
00:43:40,160 --> 00:43:41,599
but we are the primary authors of the

1535
00:43:41,599 --> 00:43:43,040
persistence tool set the reason why we

1536
00:43:43,040 --> 00:43:44,400
do this is say there is a change in the

1537
00:43:44,400 --> 00:43:45,280
c2

1538
00:43:45,280 --> 00:43:48,319
um that would require us to like reroll

1539
00:43:48,319 --> 00:43:50,000
the c2 completely right

1540
00:43:50,000 --> 00:43:51,440
hey there's a security bug in it you got

1541
00:43:51,440 --> 00:43:53,119
to blow it away got to build a new one

1542
00:43:53,119 --> 00:43:54,160
right you don't want to lose your

1543
00:43:54,160 --> 00:43:56,160
implants you don't want to have to deal

1544
00:43:56,160 --> 00:43:58,480
with you know regaining your positions

1545
00:43:58,480 --> 00:43:59,599
with an environment

1546
00:43:59,599 --> 00:44:01,119
and so the persistence framework is

1547
00:44:01,119 --> 00:44:02,720
built to maintain those positions in

1548
00:44:02,720 --> 00:44:03,680
such a way

1549
00:44:03,680 --> 00:44:05,040
that we can securely know what's going

1550
00:44:05,040 --> 00:44:06,960
on now

1551
00:44:06,960 --> 00:44:09,040
all right as i mentioned the storage is

1552
00:44:09,040 --> 00:44:10,560
basically going to hold

1553
00:44:10,560 --> 00:44:12,480
implants and an example here would be

1554
00:44:12,480 --> 00:44:14,000
one of our transports is azure active

1555
00:44:14,000 --> 00:44:15,119
directory

1556
00:44:15,119 --> 00:44:16,960
and almost any system in the world that

1557
00:44:16,960 --> 00:44:18,640
is say microsoft owned

1558
00:44:18,640 --> 00:44:20,079
will talk to azure active directory in

1559
00:44:20,079 --> 00:44:22,240
some way shape or form and you can look

1560
00:44:22,240 --> 00:44:23,760
up users within your directory

1561
00:44:23,760 --> 00:44:24,960
all right so assuming you're running

1562
00:44:24,960 --> 00:44:26,800
under the context of a specific user

1563
00:44:26,800 --> 00:44:28,240
uh you can look up a user and you can

1564
00:44:28,240 --> 00:44:29,520
look up their profile and you can look

1565
00:44:29,520 --> 00:44:30,880
up some strings that are associated with

1566
00:44:30,880 --> 00:44:31,680
that user like

1567
00:44:31,680 --> 00:44:34,720
properties right and um

1568
00:44:34,720 --> 00:44:36,400
there is a popular multimedia

1569
00:44:36,400 --> 00:44:38,319
application that is out there that um

1570
00:44:38,319 --> 00:44:40,800
has a small bootloader or i guess a

1571
00:44:40,800 --> 00:44:42,240
small loader application that runs on

1572
00:44:42,240 --> 00:44:43,599
startup if you log into your your

1573
00:44:43,599 --> 00:44:44,640
operating system

1574
00:44:44,640 --> 00:44:46,960
um to prepare it to load so that way it

1575
00:44:46,960 --> 00:44:48,640
doesn't take forever to boot

1576
00:44:48,640 --> 00:44:50,560
or the multimedia application doesn't

1577
00:44:50,560 --> 00:44:52,400
take forever to start up right

1578
00:44:52,400 --> 00:44:54,400
and this multimedia application um it

1579
00:44:54,400 --> 00:44:56,079
loads a font driver

1580
00:44:56,079 --> 00:44:58,480
and that font driver does not exist

1581
00:44:58,480 --> 00:44:59,520
right but

1582
00:44:59,520 --> 00:45:01,839
um because the it checks for it every

1583
00:45:01,839 --> 00:45:03,040
time windows boots

1584
00:45:03,040 --> 00:45:05,280
um it goes out and it looks to see if

1585
00:45:05,280 --> 00:45:06,079
it's there

1586
00:45:06,079 --> 00:45:08,720
if so it loads it if it doesn't it it

1587
00:45:08,720 --> 00:45:10,640
goes and loads some script right

1588
00:45:10,640 --> 00:45:12,160
and we know where that script is located

1589
00:45:12,160 --> 00:45:14,640
on disk and so we can change that script

1590
00:45:14,640 --> 00:45:16,079
or rather we have modified that script

1591
00:45:16,079 --> 00:45:17,280
in this case let's say

1592
00:45:17,280 --> 00:45:19,119
on one of our impacted boxes that runs

1593
00:45:19,119 --> 00:45:20,800
this application um

1594
00:45:20,800 --> 00:45:23,280
to check uh for a value in azure active

1595
00:45:23,280 --> 00:45:24,240
directory right

1596
00:45:24,240 --> 00:45:26,960
it's relatively normal it's most likely

1597
00:45:26,960 --> 00:45:29,280
going to be expected network traffic

1598
00:45:29,280 --> 00:45:32,000
there's no big red flag hey it's just

1599
00:45:32,000 --> 00:45:33,280
looking something up on azure active

1600
00:45:33,280 --> 00:45:34,480
directory via you know encrypted

1601
00:45:34,480 --> 00:45:35,760
connection whatever

1602
00:45:35,760 --> 00:45:38,079
it doesn't trigger any alerts by default

1603
00:45:38,079 --> 00:45:39,920
and what it does is it may go out and

1604
00:45:39,920 --> 00:45:41,200
look up for a user and it may check a

1605
00:45:41,200 --> 00:45:43,599
specific profile property

1606
00:45:43,599 --> 00:45:45,040
and then it will say is the profile

1607
00:45:45,040 --> 00:45:48,160
property signed if so

1608
00:45:48,160 --> 00:45:50,880
do something if not do nothing and it

1609
00:45:50,880 --> 00:45:52,160
comes time for us to

1610
00:45:52,160 --> 00:45:54,480
activate that persistence mechanism

1611
00:45:54,480 --> 00:45:55,760
right so we may have placed it on this

1612
00:45:55,760 --> 00:45:56,880
person's box

1613
00:45:56,880 --> 00:45:58,720
and it triggers maybe once a month so

1614
00:45:58,720 --> 00:46:00,079
when i talk about persistence here i'm

1615
00:46:00,079 --> 00:46:00,720
talking about

1616
00:46:00,720 --> 00:46:02,480
long-term persistence right we might

1617
00:46:02,480 --> 00:46:04,480
hide out in an environment for

1618
00:46:04,480 --> 00:46:07,200
months potentially as much as a couple

1619
00:46:07,200 --> 00:46:08,079
of years

1620
00:46:08,079 --> 00:46:09,520
before we decide to activate our

1621
00:46:09,520 --> 00:46:11,359
persistence mechanism right

1622
00:46:11,359 --> 00:46:12,720
now we're going to activate this

1623
00:46:12,720 --> 00:46:14,720
mechanism and so i'm going to go out

1624
00:46:14,720 --> 00:46:16,880
and my controller will reach out to

1625
00:46:16,880 --> 00:46:18,160
azure active directory

1626
00:46:18,160 --> 00:46:20,319
it will modify that a property on this

1627
00:46:20,319 --> 00:46:21,440
profile right so

1628
00:46:21,440 --> 00:46:23,200
it's a user that i created right so i

1629
00:46:23,200 --> 00:46:24,800
have the ability to update it

1630
00:46:24,800 --> 00:46:28,480
with say an encrypted or signed string

1631
00:46:28,480 --> 00:46:30,480
next time that person boots their

1632
00:46:30,480 --> 00:46:32,079
application will reach out

1633
00:46:32,079 --> 00:46:33,440
they'll retrieve that string of code

1634
00:46:33,440 --> 00:46:35,839
it'll say hey this is signed properly

1635
00:46:35,839 --> 00:46:37,280
can i decrypt it right because we've

1636
00:46:37,280 --> 00:46:38,960
baken a key

1637
00:46:38,960 --> 00:46:40,560
and our persistence mechanism that is

1638
00:46:40,560 --> 00:46:42,480
left on the client

1639
00:46:42,480 --> 00:46:44,640
and then it will execute it right and

1640
00:46:44,640 --> 00:46:45,760
what will happen is

1641
00:46:45,760 --> 00:46:48,319
we'll then ship an implant down to that

1642
00:46:48,319 --> 00:46:49,599
affected device right

1643
00:46:49,599 --> 00:46:51,760
so it'll reach out we'll retrieve

1644
00:46:51,760 --> 00:46:53,200
something from storage

1645
00:46:53,200 --> 00:46:55,599
and then get shipped down to the device

1646
00:46:55,599 --> 00:46:57,280
that implant will then call back

1647
00:46:57,280 --> 00:47:01,200
to our c2 and we are immediately active

1648
00:47:01,200 --> 00:47:03,599
um within the environment and we're

1649
00:47:03,599 --> 00:47:05,359
generating live traffic right to the c

1650
00:47:05,359 --> 00:47:05,760
tube

1651
00:47:05,760 --> 00:47:07,280
um because the implant obviously doesn't

1652
00:47:07,280 --> 00:47:09,119
call back like

1653
00:47:09,119 --> 00:47:10,640
on a monthly basis right it might call

1654
00:47:10,640 --> 00:47:12,240
back using a jitter

1655
00:47:12,240 --> 00:47:14,160
you know at most once an hour right

1656
00:47:14,160 --> 00:47:15,760
because operators need to do stuff they

1657
00:47:15,760 --> 00:47:17,599
need to have a much more

1658
00:47:17,599 --> 00:47:21,119
uh timely callback to work with the

1659
00:47:22,839 --> 00:47:24,160
device

1660
00:47:24,160 --> 00:47:25,839
and the code that runs on the targets or

1661
00:47:25,839 --> 00:47:28,079
the clients is often thrown away code

1662
00:47:28,079 --> 00:47:28,640
right

1663
00:47:28,640 --> 00:47:31,200
it does like two things and it has to do

1664
00:47:31,200 --> 00:47:32,160
these two things right

1665
00:47:32,160 --> 00:47:34,400
it has to make sure that the payloads

1666
00:47:34,400 --> 00:47:35,520
that get are signed

1667
00:47:35,520 --> 00:47:36,960
and that they are encrypted properly

1668
00:47:36,960 --> 00:47:38,240
right so it can decrypt them and then it

1669
00:47:38,240 --> 00:47:39,440
can validate the signature and then it

1670
00:47:39,440 --> 00:47:40,960
can then execute them so that way we can

1671
00:47:40,960 --> 00:47:42,480
be sure that any code that it executes

1672
00:47:42,480 --> 00:47:43,440
is from us

1673
00:47:43,440 --> 00:47:46,559
um and is you know under our control

1674
00:47:46,559 --> 00:47:48,079
but we invest time into figuring out how

1675
00:47:48,079 --> 00:47:50,160
to persist on devices that we get onto

1676
00:47:50,160 --> 00:47:51,359
um and a lot of times we make our

1677
00:47:51,359 --> 00:47:53,040
persistence specific to the environment

1678
00:47:53,040 --> 00:47:53,599
right

1679
00:47:53,599 --> 00:47:55,760
if i get on a web application um and i

1680
00:47:55,760 --> 00:47:57,200
notice it's running some sort of code at

1681
00:47:57,200 --> 00:47:58,960
startup and i can inject into it

1682
00:47:58,960 --> 00:48:00,160
i might choose to persist that way

1683
00:48:00,160 --> 00:48:02,000
whereas if i get on say

1684
00:48:02,000 --> 00:48:03,760
a linux box and i can add a cron job i

1685
00:48:03,760 --> 00:48:05,440
might choose to persist that way right

1686
00:48:05,440 --> 00:48:08,079
but we invest time into making um and we

1687
00:48:08,079 --> 00:48:09,359
have some components right

1688
00:48:09,359 --> 00:48:10,720
to make sure that these persistent

1689
00:48:10,720 --> 00:48:13,280
scripts run in a very specific manner

1690
00:48:13,280 --> 00:48:16,079
um and then the other portion so from

1691
00:48:16,079 --> 00:48:17,040
the transports

1692
00:48:17,040 --> 00:48:20,240
on all that is generic right um

1693
00:48:20,240 --> 00:48:21,520
i only need to write the stuff that

1694
00:48:21,520 --> 00:48:23,520
updates say if i'm using github as a

1695
00:48:23,520 --> 00:48:24,960
transport mechanism but i only need to

1696
00:48:24,960 --> 00:48:26,160
write the code that pushes stuff to

1697
00:48:26,160 --> 00:48:27,680
github or makes a change that the

1698
00:48:27,680 --> 00:48:29,440
persistence mechanism can check once and

1699
00:48:29,440 --> 00:48:30,880
i can reuse that

1700
00:48:30,880 --> 00:48:32,640
because that is outside the reach of my

1701
00:48:32,640 --> 00:48:34,720
blue team they can't signature that

1702
00:48:34,720 --> 00:48:35,119
right

1703
00:48:35,119 --> 00:48:36,559
because i'm using a different mechanism

1704
00:48:36,559 --> 00:48:38,640
to communicate

1705
00:48:38,640 --> 00:48:41,119
that they don't have control over and

1706
00:48:41,119 --> 00:48:42,800
that forces them to

1707
00:48:42,800 --> 00:48:45,119
always be hunting always be responding

1708
00:48:45,119 --> 00:48:45,920
and it lets us

1709
00:48:45,920 --> 00:48:48,240
start from within environments in an

1710
00:48:48,240 --> 00:48:49,040
assumed reach

1711
00:48:49,040 --> 00:48:50,480
mentality per se right because we've

1712
00:48:50,480 --> 00:48:51,680
popped in we've gotten our persistence

1713
00:48:51,680 --> 00:48:52,960
mechanism there once

1714
00:48:52,960 --> 00:48:56,559
um and they may have trouble finding it

1715
00:48:56,559 --> 00:48:58,400
so let's go back to our scenario at the

1716
00:48:58,400 --> 00:48:59,599
beginning where we were targeting

1717
00:48:59,599 --> 00:49:01,040
food right the customer came and said

1718
00:49:01,040 --> 00:49:03,839
hey can you do foo

1719
00:49:04,960 --> 00:49:06,559
assuming food was valuable we'll say yes

1720
00:49:06,559 --> 00:49:08,640
right um

1721
00:49:08,640 --> 00:49:11,599
and we might even have say

1722
00:49:11,599 --> 00:49:13,440
infrastructure already built right so

1723
00:49:13,440 --> 00:49:16,079
we use terraform heavily um so that we

1724
00:49:16,079 --> 00:49:17,520
can deploy all of our infrastructure you

1725
00:49:17,520 --> 00:49:18,160
know

1726
00:49:18,160 --> 00:49:20,640
um with like one or two clicks um we

1727
00:49:20,640 --> 00:49:21,680
might already have a persistence

1728
00:49:21,680 --> 00:49:23,359
mechanism that is one or two hops away

1729
00:49:23,359 --> 00:49:24,720
we might be able to activate it within

1730
00:49:24,720 --> 00:49:26,240
say the next week right because

1731
00:49:26,240 --> 00:49:27,200
the challenge with the persistent

1732
00:49:27,200 --> 00:49:29,520
mechanism persistent mechanisms is

1733
00:49:29,520 --> 00:49:30,000
they're not

1734
00:49:30,000 --> 00:49:33,839
always readily available to be activated

1735
00:49:33,839 --> 00:49:35,119
but it might only be one or two hops

1736
00:49:35,119 --> 00:49:37,040
away and so that will let us do a test

1737
00:49:37,040 --> 00:49:38,000
to the environment

1738
00:49:38,000 --> 00:49:40,559
um that can help us challenge our blue

1739
00:49:40,559 --> 00:49:41,040
team

1740
00:49:41,040 --> 00:49:42,240
right because they'll suddenly see some

1741
00:49:42,240 --> 00:49:43,520
signals start up they'll suddenly see

1742
00:49:43,520 --> 00:49:44,720
something potentially going against a

1743
00:49:44,720 --> 00:49:45,440
target

1744
00:49:45,440 --> 00:49:46,880
and we can evaluate the security of that

1745
00:49:46,880 --> 00:49:48,559
target in such a way

1746
00:49:48,559 --> 00:49:52,079
that they'll be challenged and

1747
00:49:52,079 --> 00:49:54,079
you know to wrap things up this largely

1748
00:49:54,079 --> 00:49:55,280
works because we have fairly tight

1749
00:49:55,280 --> 00:49:57,040
coordination with our blue team right

1750
00:49:57,040 --> 00:49:58,079
we have gone through the trouble of

1751
00:49:58,079 --> 00:49:59,680
sitting down with the blue team which

1752
00:49:59,680 --> 00:50:01,119
like i said is called fire in our place

1753
00:50:01,119 --> 00:50:02,640
and they are some of the best hunters i

1754
00:50:02,640 --> 00:50:04,240
have ever worked with and best forensics

1755
00:50:04,240 --> 00:50:05,440
people and

1756
00:50:05,440 --> 00:50:06,640
literally one of the best blue teams

1757
00:50:06,640 --> 00:50:08,319
i've ever had the privilege of working

1758
00:50:08,319 --> 00:50:09,200
against

1759
00:50:09,200 --> 00:50:12,000
um and they they know we're going to do

1760
00:50:12,000 --> 00:50:12,400
it

1761
00:50:12,400 --> 00:50:13,520
right they know that we have this sort

1762
00:50:13,520 --> 00:50:14,640
of building in place they know that we

1763
00:50:14,640 --> 00:50:15,760
have the sort of mechanism

1764
00:50:15,760 --> 00:50:17,040
they know that it's something that they

1765
00:50:17,040 --> 00:50:18,480
need to figure out how to deal with and

1766
00:50:18,480 --> 00:50:20,000
they are accepting of it right

1767
00:50:20,000 --> 00:50:22,720
and it lets us challenge them um and

1768
00:50:22,720 --> 00:50:24,079
continue to meet the business needs

1769
00:50:24,079 --> 00:50:25,280
without having to break our rules of

1770
00:50:25,280 --> 00:50:26,800
engagement right

1771
00:50:26,800 --> 00:50:29,599
which is pretty awesome

1772
00:50:30,960 --> 00:50:41,839
all right any questions

1773
00:51:34,800 --> 00:51:36,880
you

