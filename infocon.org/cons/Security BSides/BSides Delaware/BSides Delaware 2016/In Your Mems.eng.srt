1
00:00:09,740 --> 00:00:14,520
so good<font color="#E5E5E5"> afternoon everybody I my digital</font>

2
00:00:12,720 --> 00:00:16,380
flame this is in your MEMS windows

3
00:00:14,520 --> 00:00:18,419
memory<font color="#CCCCCC"> or Windows AV evasion using</font>

4
00:00:16,379 --> 00:00:21,599
memory techniques or in memory

5
00:00:18,420 --> 00:00:23,520
techniques so Who am I I my digital

6
00:00:21,600 --> 00:00:24,599
flame a penetration tester and digital

7
00:00:23,520 --> 00:00:27,689
friends analyst for a company called

8
00:00:24,599 --> 00:00:29,220
<font color="#E5E5E5">Essex tech I'm programmer a security</font>

9
00:00:27,690 --> 00:00:31,470
researcher in my<font color="#CCCCCC"> part-time and a</font>

10
00:00:29,220 --> 00:00:33,720
raspberry<font color="#CCCCCC"> pi enthusiast and I love</font>

11
00:00:31,470 --> 00:00:35,519
<font color="#CCCCCC">popping boxes hacking video games and</font>

12
00:00:33,720 --> 00:00:38,670
sending phishing emails especially those

13
00:00:35,520 --> 00:00:41,100
are really really really fun to do and

14
00:00:38,670 --> 00:00:45,600
Python his life best program language

15
00:00:41,100 --> 00:00:47,580
ever so feeling over what we're going to

16
00:00:45,600 --> 00:00:49,379
cover today<font color="#CCCCCC"> so the current weight of the</font>

17
00:00:47,580 --> 00:00:52,290
need to bypass antivirus why we want to

18
00:00:49,379 --> 00:00:53,640
<font color="#E5E5E5">do it the waves antivirus does catch mal</font>

19
00:00:52,290 --> 00:00:55,170
<font color="#E5E5E5">we're just going to go over how any of</font>

20
00:00:53,640 --> 00:00:57,000
ours does what it does so we get it

21
00:00:55,170 --> 00:00:59,549
understanding how we actually bypass any

22
00:00:57,000 --> 00:01:01,890
bars we're<font color="#E5E5E5"> going to go into current</font>

23
00:00:59,549 --> 00:01:04,260
bypass<font color="#CCCCCC"> processes and windows memory</font>

24
00:01:01,890 --> 00:01:07,680
injection also some of the API methods

25
00:01:04,260 --> 00:01:10,740
windows uses for that Amy trust and then

26
00:01:07,680 --> 00:01:12,990
be finally the AV bypass hi detected how

27
00:01:10,740 --> 00:01:15,179
you remediated and I'm going to<font color="#E5E5E5"> release</font>

28
00:01:12,990 --> 00:01:19,949
the source code to this exploit once I

29
00:01:15,180 --> 00:01:21,240
finish this talk so antivirus you might

30
00:01:19,950 --> 00:01:22,710
<font color="#E5E5E5">have seen</font><font color="#CCCCCC"> it you might</font><font color="#E5E5E5"> have used it a</font>

31
00:01:21,240 --> 00:01:24,570
lot of times on many of<font color="#E5E5E5"> the three</font>

32
00:01:22,710 --> 00:01:26,009
operating system platforms such as

33
00:01:24,570 --> 00:01:28,139
<font color="#CCCCCC">Windows and if you're a Windows user</font>

34
00:01:26,010 --> 00:01:30,120
your kind of grunt<font color="#E5E5E5"> you're like oh it's</font>

35
00:01:28,140 --> 00:01:32,010
you know have a necessity of life I need

36
00:01:30,120 --> 00:01:35,730
antivirus or else you know I'm screwed

37
00:01:32,010 --> 00:01:37,560
not always but then if you use Linux you

38
00:01:35,730 --> 00:01:41,160
like uh what's antivirus I don't<font color="#E5E5E5"> need</font>

39
00:01:37,560 --> 00:01:43,440
this what even the better thing is if

40
00:01:41,160 --> 00:01:45,750
you're on a Mac you're<font color="#E5E5E5"> like antivirus my</font>

41
00:01:43,440 --> 00:01:50,910
operating system<font color="#CCCCCC"> is super secure but</font>

42
00:01:45,750 --> 00:01:53,510
then this happens and you see but secure

43
00:01:50,910 --> 00:01:56,490
operating system doesn't need any virus

44
00:01:53,510 --> 00:01:58,950
so and<font color="#CCCCCC"> also with antivirus being so</font>

45
00:01:56,490 --> 00:02:00,720
effective how come this happens you<font color="#CCCCCC"> know</font>

46
00:01:58,950 --> 00:02:02,370
we have ransomware it's on the rise and

47
00:02:00,720 --> 00:02:04,380
we have computers getting affected by

48
00:02:02,370 --> 00:02:06,930
many different<font color="#E5E5E5"> types antivirus not just</font>

49
00:02:04,380 --> 00:02:08,549
<font color="#CCCCCC">0 days but different types of ransomware</font>

50
00:02:06,930 --> 00:02:10,289
we'd have ran swear that encrypts hard

51
00:02:08,550 --> 00:02:12,180
drives themselves and people still get

52
00:02:10,288 --> 00:02:16,379
affected<font color="#CCCCCC"> by the little things that a</font>

53
00:02:12,180 --> 00:02:18,930
virus apparently does not catch so why

54
00:02:16,379 --> 00:02:21,060
do<font color="#E5E5E5"> we need to bypass any of ours well</font>

55
00:02:18,930 --> 00:02:22,100
penetration testers need it red teamers

56
00:02:21,060 --> 00:02:24,140
need it

57
00:02:22,100 --> 00:02:26,450
and the bad guys need it now if you<font color="#CCCCCC"> ask</font>

58
00:02:24,140 --> 00:02:28,850
<font color="#CCCCCC">Google Images what bad hacker is</font>

59
00:02:26,450 --> 00:02:30,290
apparently he looks like that<font color="#E5E5E5"> I mean I</font>

60
00:02:28,850 --> 00:02:32,390
was going to dress like that but then I

61
00:02:30,290 --> 00:02:36,350
realized I could just cover my webcam i

62
00:02:32,390 --> 00:02:37,940
don't need the face mask but I<font color="#E5E5E5"> i might</font>

63
00:02:36,350 --> 00:02:40,850
<font color="#E5E5E5">need glove that's a good point I should</font>

64
00:02:37,940 --> 00:02:42,500
have bring those oh so why do<font color="#E5E5E5"> we want</font>

65
00:02:40,850 --> 00:02:44,239
<font color="#E5E5E5">about by passing a virus well</font><font color="#CCCCCC"> one it</font>

66
00:02:42,500 --> 00:02:45,800
saves us frustration you know if we're

67
00:02:44,240 --> 00:02:48,320
running you know Mimi cats was a very

68
00:02:45,800 --> 00:02:50,570
popular penetration testing app you know

69
00:02:48,320 --> 00:02:53,180
it's detected by any of ours so you know

70
00:02:50,570 --> 00:02:54,590
I mean I personally myself on and

71
00:02:53,180 --> 00:02:56,600
engagement turn off antivirus on a

72
00:02:54,590 --> 00:02:59,570
client's computer just so i can run<font color="#CCCCCC"> mimi</font>

73
00:02:56,600 --> 00:03:01,070
cats so you know to be<font color="#CCCCCC"> able to evade</font>

74
00:02:59,570 --> 00:03:04,160
that completely and not to worry about

75
00:03:01,070 --> 00:03:05,690
<font color="#CCCCCC">like editing something on clients</font>

76
00:03:04,160 --> 00:03:07,640
environment you know<font color="#CCCCCC"> I don't do that</font>

77
00:03:05,690 --> 00:03:09,590
<font color="#CCCCCC">anymore it also successful tillery</font>

78
00:03:07,640 --> 00:03:12,829
payloads you know<font color="#CCCCCC"> last thing I need is</font>

79
00:03:09,590 --> 00:03:14,540
an IDs or even just an H IDs a host

80
00:03:12,830 --> 00:03:16,310
intrusion detection system to be

81
00:03:14,540 --> 00:03:18,079
blocking anything I'm trying to run or

82
00:03:16,310 --> 00:03:20,510
I'm trying<font color="#CCCCCC"> to</font><font color="#E5E5E5"> compile code that you know</font>

83
00:03:18,080 --> 00:03:22,940
for some reason is flagged you know cuz

84
00:03:20,510 --> 00:03:24,920
its shell code or you know celibates<font color="#E5E5E5"> I</font>

85
00:03:22,940 --> 00:03:27,380
don't know<font color="#E5E5E5"> like a process hijack or</font>

86
00:03:24,920 --> 00:03:28,609
anything like that<font color="#E5E5E5"> and like I said</font>

87
00:03:27,380 --> 00:03:31,070
before it's better than turning off

88
00:03:28,610 --> 00:03:34,310
antivirus now granted you can easily<font color="#E5E5E5"> do</font>

89
00:03:31,070 --> 00:03:37,070
these<font color="#E5E5E5"> three simple steps what click the</font>

90
00:03:34,310 --> 00:03:39,470
taskbar to just click the little

91
00:03:37,070 --> 00:03:41,239
<font color="#CCCCCC">semantic icon or whatever AV I didn't</font>

92
00:03:39,470 --> 00:03:43,970
say Samantha whatever AV and click this

93
00:03:41,240 --> 00:03:45,470
disable antivirus protection but as you

94
00:03:43,970 --> 00:03:47,420
can see you<font color="#CCCCCC"> know</font><font color="#E5E5E5"> that causes a lot of</font>

95
00:03:45,470 --> 00:03:49,550
problems and myself personally have been

96
00:03:47,420 --> 00:03:51,170
getting kicked out of boxes because it

97
00:03:49,550 --> 00:03:53,510
has created a log event that admin has

98
00:03:51,170 --> 00:03:54,859
seen and they're like that's not right

99
00:03:53,510 --> 00:03:56,959
and I've got<font color="#CCCCCC"> shut out boxes before</font>

100
00:03:54,860 --> 00:03:58,790
that's something<font color="#CCCCCC"> I don't</font><font color="#E5E5E5"> want to do and</font>

101
00:03:56,960 --> 00:04:01,760
that a lot<font color="#CCCCCC"> of penetration testers don't</font>

102
00:03:58,790 --> 00:04:03,890
want to either so getting caught<font color="#E5E5E5"> by</font>

103
00:04:01,760 --> 00:04:07,220
<font color="#CCCCCC">universe so how does antivirus really</font>

104
00:04:03,890 --> 00:04:08,630
catch viruses so it works on signature

105
00:04:07,220 --> 00:04:10,190
detection and you think about<font color="#E5E5E5"> a</font>

106
00:04:08,630 --> 00:04:12,470
signature it's like a fingerprint of<font color="#CCCCCC"> any</font>

107
00:04:10,190 --> 00:04:14,690
<font color="#CCCCCC">virus just</font><font color="#E5E5E5"> sell people have fingerprints</font>

108
00:04:12,470 --> 00:04:17,630
that identify who they are anti virus or

109
00:04:14,690 --> 00:04:19,760
malware really has signatures of each

110
00:04:17,630 --> 00:04:21,858
individual variant and that's cool<font color="#CCCCCC"> and</font>

111
00:04:19,760 --> 00:04:23,539
all<font color="#CCCCCC"> it's based on the file content or</font>

112
00:04:21,858 --> 00:04:28,010
can be based<font color="#E5E5E5"> on the hash of the file and</font>

113
00:04:23,540 --> 00:04:29,660
how it<font color="#E5E5E5"> works is very simple so say we</font>

114
00:04:28,010 --> 00:04:30,950
have a file here and we<font color="#E5E5E5"> want to</font>

115
00:04:29,660 --> 00:04:32,930
determine if<font color="#E5E5E5"> it's malicious or not our</font>

116
00:04:30,950 --> 00:04:35,740
antivirus engine will compute a

117
00:04:32,930 --> 00:04:37,750
signature of it and it will compare it

118
00:04:35,740 --> 00:04:40,479
against the current the current current

119
00:04:37,750 --> 00:04:43,360
internal virus signature database and if

120
00:04:40,479 --> 00:04:46,030
it meets a signature matches all rights

121
00:04:43,360 --> 00:04:49,840
<font color="#CCCCCC">malicious let's get rid of it however it</font>

122
00:04:46,030 --> 00:04:53,318
<font color="#CCCCCC">doesn't it's not</font><font color="#E5E5E5"> it's a not malicious or</font>

123
00:04:49,840 --> 00:04:55,060
at least we think so and one of the

124
00:04:53,319 --> 00:04:56,979
<font color="#CCCCCC">while</font><font color="#E5E5E5"> con one of the issues I had</font>

125
00:04:55,060 --> 00:05:00,389
<font color="#E5E5E5">expected this PowerPoint really but also</font>

126
00:04:56,979 --> 00:05:02,860
proves the file content power power of

127
00:05:00,389 --> 00:05:04,389
antivirus is I'm going<font color="#E5E5E5"> to submit I'm</font>

128
00:05:02,860 --> 00:05:06,910
going<font color="#E5E5E5"> to send this put this PowerPoint</font>

129
00:05:04,389 --> 00:05:09,250
up on my website to download try to send

130
00:05:06,910 --> 00:05:10,780
try to send us an email to anybody the

131
00:05:09,250 --> 00:05:12,310
reason you cannot send this and I've

132
00:05:10,780 --> 00:05:14,500
actually<font color="#E5E5E5"> tried</font><font color="#CCCCCC"> to do this it gets</font>

133
00:05:12,310 --> 00:05:16,659
blocked because of the string right here

134
00:05:14,500 --> 00:05:19,389
and if anybody doesn't know if it's on

135
00:05:16,659 --> 00:05:21,370
the<font color="#E5E5E5"> board really but this is the</font><font color="#CCCCCC"> Eco the</font>

136
00:05:19,389 --> 00:05:23,620
<font color="#CCCCCC">aircar standard antivirus test file</font>

137
00:05:21,370 --> 00:05:25,060
basically<font color="#CCCCCC"> if you put this in right now</font>

138
00:05:23,620 --> 00:05:26,949
on notepad I mean it's kind of like

139
00:05:25,060 --> 00:05:28,810
impossible to type but have<font color="#E5E5E5"> you put this</font>

140
00:05:26,949 --> 00:05:30,400
in notepad and saved it it would

141
00:05:28,810 --> 00:05:32,229
<font color="#CCCCCC">actually come up as a virus it's not</font>

142
00:05:30,400 --> 00:05:34,270
really<font color="#CCCCCC"> like a malicious virus but this</font>

143
00:05:32,229 --> 00:05:37,990
is what vendors use a test to make sure

144
00:05:34,270 --> 00:05:39,729
their fire system is working well like I

145
00:05:37,990 --> 00:05:42,009
said<font color="#E5E5E5"> because this is in this PowerPoint</font>

146
00:05:39,729 --> 00:05:46,780
you<font color="#CCCCCC"> can't send it it thinks it's that</font>

147
00:05:42,009 --> 00:05:48,520
virus so other ways antivirus will catch

148
00:05:46,780 --> 00:05:50,590
you it does real time does current

149
00:05:48,520 --> 00:05:52,299
schedule scanning of malware and it also

150
00:05:50,590 --> 00:05:54,008
does real time scanning and real-time

151
00:05:52,300 --> 00:05:55,599
scanning is basically when<font color="#CCCCCC"> you try to</font>

152
00:05:54,009 --> 00:05:57,550
access a file you try to open up a word

153
00:05:55,599 --> 00:06:00,099
document whatever<font color="#E5E5E5"> we're trying</font><font color="#CCCCCC"> to run a</font>

154
00:05:57,550 --> 00:06:01,840
process it says hey before you get<font color="#E5E5E5"> that</font>

155
00:06:00,099 --> 00:06:04,599
person access let me look at this first

156
00:06:01,840 --> 00:06:07,179
and<font color="#E5E5E5"> it goes it scans it and then if it's</font>

157
00:06:04,599 --> 00:06:08,530
bad says no you can't open this as have

158
00:06:07,180 --> 00:06:10,659
you ever seen before trying<font color="#CCCCCC"> to open up</font>

159
00:06:08,530 --> 00:06:11,619
<font color="#E5E5E5">like any malware you know for testing or</font>

160
00:06:10,659 --> 00:06:12,909
something that you might not think as

161
00:06:11,620 --> 00:06:15,159
malicious and it blocks and this is hey

162
00:06:12,909 --> 00:06:16,659
you can't do<font color="#CCCCCC"> that</font><font color="#E5E5E5"> but if it's not</font>

163
00:06:15,159 --> 00:06:18,969
malicious it just let you open it you

164
00:06:16,659 --> 00:06:21,159
don't even notice it happening it's not

165
00:06:18,969 --> 00:06:22,960
<font color="#E5E5E5">as reliable as you think it is problem</font>

166
00:06:21,159 --> 00:06:26,020
is if there's<font color="#E5E5E5"> not a signature for that</font>

167
00:06:22,960 --> 00:06:28,568
antivirus or that malware I'm sorry then

168
00:06:26,020 --> 00:06:30,130
it won't get detected so basically<font color="#E5E5E5"> if</font>

169
00:06:28,569 --> 00:06:31,840
there's a new piece of<font color="#E5E5E5"> matter with it</font>

170
00:06:30,130 --> 00:06:34,389
<font color="#E5E5E5">just came out yesterday and your advisor</font>

171
00:06:31,840 --> 00:06:35,590
has not updated your signatures or you

172
00:06:34,389 --> 00:06:37,330
just didn't update your signatures

173
00:06:35,590 --> 00:06:40,979
because you didn't feel like it you're

174
00:06:37,330 --> 00:06:43,930
going to get infected really quickly

175
00:06:40,979 --> 00:06:45,849
there's also a feature that's very old

176
00:06:43,930 --> 00:06:47,830
in any of ours but it's really had not

177
00:06:45,849 --> 00:06:48,800
much use until now it's got a heuristic

178
00:06:47,830 --> 00:06:51,229
attention

179
00:06:48,800 --> 00:06:54,110
tection basically it detects the actions

180
00:06:51,229 --> 00:06:56,449
of processes so depending<font color="#E5E5E5"> on like what</font>

181
00:06:54,110 --> 00:06:59,300
it opens what it does it tries to see

182
00:06:56,449 --> 00:07:00,889
the process is acting malicious and<font color="#E5E5E5"> it's</font>

183
00:06:59,300 --> 00:07:02,750
kind of useful because you<font color="#E5E5E5"> don't need a</font>

184
00:07:00,889 --> 00:07:05,360
signature<font color="#E5E5E5"> to detect if that's a</font>

185
00:07:02,750 --> 00:07:07,389
malicious process if<font color="#E5E5E5"> this process is you</font>

186
00:07:05,360 --> 00:07:09,770
know I'm opening like 30 files at once

187
00:07:07,389 --> 00:07:11,360
<font color="#E5E5E5">alright that seems kind of weird when</font>

188
00:07:09,770 --> 00:07:14,448
does the process ever do that normally

189
00:07:11,360 --> 00:07:16,699
<font color="#E5E5E5">there are some</font><font color="#CCCCCC"> cases but it's better</font>

190
00:07:14,449 --> 00:07:19,069
method detection and it is fast response

191
00:07:16,699 --> 00:07:21,259
to emerging threats so if any bar serif

192
00:07:19,069 --> 00:07:23,120
of malware p smart comes out today and

193
00:07:21,259 --> 00:07:25,370
it does something that's commonly known

194
00:07:23,120 --> 00:07:27,169
as malicious her istic detection will

195
00:07:25,370 --> 00:07:28,879
lease say hey you know that's<font color="#E5E5E5"> malicious</font>

196
00:07:27,169 --> 00:07:32,299
<font color="#E5E5E5">let's stop that even though</font><font color="#CCCCCC"> i</font><font color="#E5E5E5"> don't have</font>

197
00:07:28,879 --> 00:07:33,949
a signature for it and<font color="#E5E5E5"> you</font><font color="#CCCCCC"> know like</font><font color="#E5E5E5"> i</font>

198
00:07:32,300 --> 00:07:36,349
said doesn't it also detects non

199
00:07:33,949 --> 00:07:39,889
signature-based malware or not listed as

200
00:07:36,349 --> 00:07:41,500
well and this<font color="#E5E5E5"> can be seen in a couple of</font>

201
00:07:39,889 --> 00:07:43,940
products<font color="#CCCCCC"> that have been out recently</font>

202
00:07:41,500 --> 00:07:45,289
malwarebytes has a new anti ransomware

203
00:07:43,940 --> 00:07:47,719
program and this is kind of<font color="#E5E5E5"> what i was</font>

204
00:07:45,289 --> 00:07:49,639
getting to with a 30<font color="#E5E5E5"> files open is that</font>

205
00:07:47,719 --> 00:07:52,009
<font color="#E5E5E5">this program doesn't have any signatures</font>

206
00:07:49,639 --> 00:07:54,889
for ransom we're all it does is says hey

207
00:07:52,009 --> 00:07:57,590
is process a opening a buttload of files

208
00:07:54,889 --> 00:07:59,779
if it is it's got to be ransomware let's

209
00:07:57,590 --> 00:08:02,659
at least stop it<font color="#E5E5E5"> or kill it and the same</font>

210
00:07:59,779 --> 00:08:03,979
<font color="#E5E5E5">thing</font><font color="#CCCCCC"> patrick</font><font color="#E5E5E5"> wordle a OS secure OS</font><font color="#CCCCCC"> X</font>

211
00:08:02,659 --> 00:08:06,500
security researcher also released a

212
00:08:03,979 --> 00:08:08,419
program called ransomware and it really

213
00:08:06,500 --> 00:08:10,069
does the same thing it doesn't<font color="#CCCCCC"> look at</font>

214
00:08:08,419 --> 00:08:12,049
the signature of each process and say

215
00:08:10,069 --> 00:08:14,150
hey is this malware is it not just hey

216
00:08:12,050 --> 00:08:15,770
is this process acting fishy there's

217
00:08:14,150 --> 00:08:18,080
something<font color="#E5E5E5"> weird about it and in the case</font>

218
00:08:15,770 --> 00:08:24,560
<font color="#CCCCCC">of ransomware is it opening a buttload</font>

219
00:08:18,080 --> 00:08:26,870
of files so<font color="#E5E5E5"> now we kind of know how</font>

220
00:08:24,560 --> 00:08:28,490
antivirus works there<font color="#E5E5E5"> is some ways</font>

221
00:08:26,870 --> 00:08:30,590
concurrently right now to bypass any

222
00:08:28,490 --> 00:08:32,299
bars one is<font color="#CCCCCC"> encoding an encryption or</font>

223
00:08:30,590 --> 00:08:34,039
encryption and if you<font color="#CCCCCC"> ever use</font>

224
00:08:32,299 --> 00:08:36,198
<font color="#CCCCCC">metasploit one of the options when you</font>

225
00:08:34,039 --> 00:08:37,819
generate a payload and<font color="#CCCCCC"> metasploit as you</font>

226
00:08:36,198 --> 00:08:39,799
can say hey what encoder should<font color="#E5E5E5"> i use</font>

227
00:08:37,820 --> 00:08:42,289
there's a couple ones like<font color="#CCCCCC"> XOR</font>

228
00:08:39,799 --> 00:08:44,810
polymorphic and basically what they do

229
00:08:42,289 --> 00:08:47,510
is they change the underlying machine

230
00:08:44,810 --> 00:08:49,459
code that it looks<font color="#CCCCCC"> like but your code</font>

231
00:08:47,510 --> 00:08:51,709
that you want<font color="#E5E5E5"> to run is exactly the same</font>

232
00:08:49,459 --> 00:08:53,719
so if you have I<font color="#E5E5E5"> don't know</font><font color="#CCCCCC"> shellcode</font>

233
00:08:51,709 --> 00:08:56,300
that shuts down the system really<font color="#E5E5E5"> simple</font>

234
00:08:53,720 --> 00:08:58,760
shellcode it will look different even if

235
00:08:56,300 --> 00:09:00,490
you use a different encoder which is the

236
00:08:58,760 --> 00:09:02,860
same thing<font color="#E5E5E5"> always and</font>

237
00:09:00,490 --> 00:09:04,420
I used<font color="#E5E5E5"> to work really really well what</font>

238
00:09:02,860 --> 00:09:06,100
the problem is signatures have caught up

239
00:09:04,420 --> 00:09:08,620
with them so any piece<font color="#CCCCCC"> of shell code</font>

240
00:09:06,100 --> 00:09:10,839
really even you<font color="#CCCCCC"> know the basic vine</font>

241
00:09:08,620 --> 00:09:11,950
shell will upload it to the virus<font color="#CCCCCC"> header</font>

242
00:09:10,839 --> 00:09:15,220
will come back with like 30 hits

243
00:09:11,950 --> 00:09:17,620
automatically you also<font color="#CCCCCC"> have loaders</font>

244
00:09:15,220 --> 00:09:20,740
they're commonly<font color="#E5E5E5"> used in ransomware that</font>

245
00:09:17,620 --> 00:09:22,660
a non malicious or<font color="#E5E5E5"> a non detective file</font>

246
00:09:20,740 --> 00:09:24,670
when we download to your system and your

247
00:09:22,660 --> 00:09:27,219
run and<font color="#E5E5E5"> it'll download the malware</font>

248
00:09:24,670 --> 00:09:29,860
without with<font color="#E5E5E5"> basically so it avoids</font>

249
00:09:27,220 --> 00:09:31,120
being detected by handles like by

250
00:09:29,860 --> 00:09:33,670
real-time scanning because you're<font color="#E5E5E5"> not</font>

251
00:09:31,120 --> 00:09:35,140
opening the file yourself a program is

252
00:09:33,670 --> 00:09:37,750
downloading it for you and<font color="#E5E5E5"> running it</font>

253
00:09:35,140 --> 00:09:40,750
now<font color="#CCCCCC"> can</font><font color="#E5E5E5"> get picked up so it's not super</font>

254
00:09:37,750 --> 00:09:43,240
successful but in New k in cases of<font color="#CCCCCC"> new</font>

255
00:09:40,750 --> 00:09:48,390
<font color="#E5E5E5">mauer like ransomware you know it's a</font>

256
00:09:43,240 --> 00:09:50,740
<font color="#E5E5E5">little bit easier</font><font color="#CCCCCC"> for them yes thank you</font>

257
00:09:48,390 --> 00:09:53,050
also custom written malware so<font color="#E5E5E5"> you're</font>

258
00:09:50,740 --> 00:09:55,000
<font color="#CCCCCC">zero days you know from like any other</font>

259
00:09:53,050 --> 00:09:57,099
country or even United States the NSA

260
00:09:55,000 --> 00:09:59,230
<font color="#CCCCCC">for example</font><font color="#E5E5E5"> anything that's not</font>

261
00:09:57,100 --> 00:10:01,870
mainstream<font color="#CCCCCC"> wassa fall into this category</font>

262
00:09:59,230 --> 00:10:04,000
it's not a real protection but it's one

263
00:10:01,870 --> 00:10:07,079
way to get around it by coding your own

264
00:10:04,000 --> 00:10:11,170
malware and then sending it<font color="#E5E5E5"> out as quick</font>

265
00:10:07,079 --> 00:10:13,329
as quick as<font color="#CCCCCC"> possible lastly the other</font>

266
00:10:11,170 --> 00:10:15,189
popular<font color="#E5E5E5"> veil framework the veil</font>

267
00:10:13,329 --> 00:10:18,699
framework actually has a lot of payloads

268
00:10:15,190 --> 00:10:20,410
including ones in<font color="#CCCCCC"> Python see go and</font>

269
00:10:18,700 --> 00:10:21,790
powershell and actually<font color="#CCCCCC"> you</font><font color="#E5E5E5"> can do</font>

270
00:10:20,410 --> 00:10:23,920
memory injection with as well which

271
00:10:21,790 --> 00:10:26,020
we'll get into soon<font color="#CCCCCC"> what it does allow</font>

272
00:10:23,920 --> 00:10:28,029
you to create undetectable executives so

273
00:10:26,020 --> 00:10:29,589
if you do<font color="#CCCCCC"> have a piece of malware that's</font>

274
00:10:28,029 --> 00:10:31,390
detectable you can't use the veil

275
00:10:29,589 --> 00:10:33,579
framework to encode it in a payload that

276
00:10:31,390 --> 00:10:39,610
<font color="#CCCCCC">will at least render somewhat</font>

277
00:10:33,579 --> 00:10:41,709
undetectable so we're going to what is

278
00:10:39,610 --> 00:10:43,690
memory injection so like I said veil

279
00:10:41,709 --> 00:10:45,819
framework does use memory injection so

280
00:10:43,690 --> 00:10:47,620
memory injunction<font color="#E5E5E5"> is the processor the</font>

281
00:10:45,820 --> 00:10:50,470
procedure<font color="#CCCCCC"> of adding your own code to a</font>

282
00:10:47,620 --> 00:10:52,300
current running process it's not<font color="#E5E5E5"> always</font>

283
00:10:50,470 --> 00:10:54,130
malicious as you might think it's

284
00:10:52,300 --> 00:10:56,620
actually used in a lot of PC modding

285
00:10:54,130 --> 00:10:59,439
programs debuggers window system

286
00:10:56,620 --> 00:11:02,250
processes do use<font color="#CCCCCC"> it and other extensions</font>

287
00:10:59,440 --> 00:11:05,680
the windows programs do use this as well

288
00:11:02,250 --> 00:11:07,660
it also allows<font color="#E5E5E5"> your your custom code to</font>

289
00:11:05,680 --> 00:11:09,760
run in<font color="#E5E5E5"> the same context as the process</font>

290
00:11:07,660 --> 00:11:13,150
<font color="#CCCCCC">that</font><font color="#E5E5E5"> injects into meaning of a process</font>

291
00:11:09,760 --> 00:11:13,930
<font color="#E5E5E5">is PID 1000 and you inject code into PID</font>

292
00:11:13,150 --> 00:11:16,449
<font color="#E5E5E5">1000</font>

293
00:11:13,930 --> 00:11:18,640
you are now PID<font color="#E5E5E5"> 1000 so you are now that</font>

294
00:11:16,450 --> 00:11:20,560
process<font color="#E5E5E5"> even</font><font color="#CCCCCC"> though you're not that</font>

295
00:11:18,640 --> 00:11:25,089
processes code you're your own custom

296
00:11:20,560 --> 00:11:27,640
code and basically this<font color="#CCCCCC"> is how the</font>

297
00:11:25,089 --> 00:11:29,410
memory injection works so i chose kalki

298
00:11:27,640 --> 00:11:32,770
XE<font color="#E5E5E5"> because besides Las Vegas this year</font>

299
00:11:29,410 --> 00:11:36,130
was actually their motto was popping

300
00:11:32,770 --> 00:11:38,439
calc exe since 2008 so I<font color="#E5E5E5"> thought it was</font>

301
00:11:36,130 --> 00:11:42,070
you<font color="#CCCCCC"> know kind of good to choose</font><font color="#E5E5E5"> kalki XE</font>

302
00:11:38,440 --> 00:11:44,820
so<font color="#CCCCCC"> we have our process proc to exe and</font>

303
00:11:42,070 --> 00:11:46,690
we have calc exe now you'll<font color="#E5E5E5"> notice that</font>

304
00:11:44,820 --> 00:11:49,209
including in the<font color="#E5E5E5"> instruction code you</font>

305
00:11:46,690 --> 00:11:51,040
have<font color="#CCCCCC"> a block of free space and every</font>

306
00:11:49,209 --> 00:11:53,079
<font color="#E5E5E5">windows process</font><font color="#CCCCCC"> leads on 32-bit systems</font>

307
00:11:51,040 --> 00:11:55,719
is given up to least four gigs of

308
00:11:53,080 --> 00:11:56,920
virtual located space not not to have

309
00:11:55,720 --> 00:12:02,140
that much<font color="#E5E5E5"> space and ram but it can</font>

310
00:11:56,920 --> 00:12:04,149
virtually allocate that much so what'll

311
00:12:02,140 --> 00:12:07,360
first happen is our process will call

312
00:12:04,149 --> 00:12:09,279
the windows api call process open to try

313
00:12:07,360 --> 00:12:13,450
to attempt to get a handle<font color="#CCCCCC"> to that</font>

314
00:12:09,279 --> 00:12:15,189
process and if<font color="#CCCCCC"> we have access rights we</font>

315
00:12:13,450 --> 00:12:17,260
will get one back and we will<font color="#CCCCCC"> get</font><font color="#E5E5E5"> a</font>

316
00:12:15,190 --> 00:12:20,880
handle to calculate and it's<font color="#E5E5E5"> basically a</font>

317
00:12:17,260 --> 00:12:23,950
pointer into memory where calc exe is

318
00:12:20,880 --> 00:12:26,680
next we're going to call virtual<font color="#CCCCCC"> okie X</font>

319
00:12:23,950 --> 00:12:29,350
what<font color="#E5E5E5"> this does it allows us to allocate</font>

320
00:12:26,680 --> 00:12:30,790
a space in memory from what we decide so

321
00:12:29,350 --> 00:12:32,740
if we<font color="#E5E5E5"> were like we want you know</font>

322
00:12:30,790 --> 00:12:34,719
thousand bytes in memory if we have a

323
00:12:32,740 --> 00:12:37,450
handle we have access rights we can do

324
00:12:34,720 --> 00:12:39,760
<font color="#E5E5E5">that so we call virtual look and we</font>

325
00:12:37,450 --> 00:12:41,860
create some space in the process so now

326
00:12:39,760 --> 00:12:43,810
we got this new free space and<font color="#CCCCCC"> we got</font>

327
00:12:41,860 --> 00:12:47,890
the handle to<font color="#CCCCCC"> the memory block given to</font>

328
00:12:43,810 --> 00:12:50,739
us and then we call right process memory

329
00:12:47,890 --> 00:12:53,380
and like the methods name is it allows

330
00:12:50,740 --> 00:12:55,480
us<font color="#E5E5E5"> to write our own code into this free</font>

331
00:12:53,380 --> 00:12:57,370
space of the process so now our own

332
00:12:55,480 --> 00:12:59,860
codes residing in somebody else's

333
00:12:57,370 --> 00:13:01,600
process and then we call create remote

334
00:12:59,860 --> 00:13:03,730
thread now here<font color="#E5E5E5"> is really where it all</font>

335
00:13:01,600 --> 00:13:05,560
happens great remote<font color="#E5E5E5"> threat now allows</font>

336
00:13:03,730 --> 00:13:08,320
us<font color="#CCCCCC"> to trigger our own code at the</font>

337
00:13:05,560 --> 00:13:10,569
instruction pointer of our new code in a

338
00:13:08,320 --> 00:13:12,279
new threat under that process basically

339
00:13:10,570 --> 00:13:14,620
<font color="#CCCCCC">what it means is now we can start our</font>

340
00:13:12,279 --> 00:13:17,800
own code under whatever the process

341
00:13:14,620 --> 00:13:21,339
<font color="#E5E5E5">kalki XE is running apps so once it</font>

342
00:13:17,800 --> 00:13:24,180
happens<font color="#E5E5E5"> kalki XE is now pwned we now are</font>

343
00:13:21,339 --> 00:13:26,110
running our own code under kalki XE and

344
00:13:24,180 --> 00:13:27,310
unless you're looking at it really

345
00:13:26,110 --> 00:13:29,020
<font color="#E5E5E5">closely you're not going to notice</font>

346
00:13:27,310 --> 00:13:34,000
that cocky XE is now doing something

347
00:13:29,020 --> 00:13:35,740
malicious now one important things in

348
00:13:34,000 --> 00:13:37,690
memory injection is that you need to

349
00:13:35,740 --> 00:13:40,540
have right to that process I can't just

350
00:13:37,690 --> 00:13:42,130
go<font color="#CCCCCC"> and inject into svchost.exe because I</font>

351
00:13:40,540 --> 00:13:43,959
feel<font color="#E5E5E5"> like I'm really cool doesn't</font><font color="#CCCCCC"> work</font>

352
00:13:42,130 --> 00:13:48,160
<font color="#CCCCCC">that way if I don't have access right so</font>

353
00:13:43,960 --> 00:13:50,320
that can't do it also mount does since

354
00:13:48,160 --> 00:13:52,569
<font color="#CCCCCC">it's</font><font color="#E5E5E5"> using malware any virus does pick</font>

355
00:13:50,320 --> 00:13:55,029
this up it's called<font color="#E5E5E5"> a process hijacker a</font>

356
00:13:52,570 --> 00:13:56,820
lot of common<font color="#E5E5E5"> in device products will</font>

357
00:13:55,029 --> 00:14:01,060
immediately red flag this like hey

358
00:13:56,820 --> 00:14:02,860
that's not possible the one benefit of

359
00:14:01,060 --> 00:14:04,359
it it does evade<font color="#CCCCCC"> real-time and file</font>

360
00:14:02,860 --> 00:14:06,400
scanning as there's<font color="#E5E5E5"> nothing written to</font>

361
00:14:04,360 --> 00:14:08,440
the<font color="#CCCCCC"> disk all this is happening in memory</font>

362
00:14:06,400 --> 00:14:10,779
<font color="#E5E5E5">so we're not making any changes anything</font>

363
00:14:08,440 --> 00:14:13,000
physically on this that can<font color="#E5E5E5"> be accessed</font>

364
00:14:10,779 --> 00:14:18,370
forensic<font color="#E5E5E5"> Lee except for</font><font color="#CCCCCC"> memory and we'll</font>

365
00:14:13,000 --> 00:14:20,320
get<font color="#E5E5E5"> to that so one of the ways you can</font>

366
00:14:18,370 --> 00:14:22,750
practice memory injection is with<font color="#E5E5E5"> Python</font>

367
00:14:20,320 --> 00:14:25,200
these two great books black hat<font color="#CCCCCC"> Python</font>

368
00:14:22,750 --> 00:14:28,089
and<font color="#CCCCCC"> grey hat</font><font color="#E5E5E5"> Python cover this in detail</font>

369
00:14:25,200 --> 00:14:30,370
and its really awesome the only

370
00:14:28,089 --> 00:14:32,470
<font color="#E5E5E5">downsides this is python has to be</font>

371
00:14:30,370 --> 00:14:34,660
installed<font color="#E5E5E5"> on air on the computer you're</font>

372
00:14:32,470 --> 00:14:36,400
targeting and<font color="#CCCCCC"> python 3</font><font color="#E5E5E5"> has a lot of</font>

373
00:14:34,660 --> 00:14:38,350
issues<font color="#CCCCCC"> with it I've tried</font><font color="#E5E5E5"> python3</font>

374
00:14:36,400 --> 00:14:41,430
personally and it does not work python

375
00:14:38,350 --> 00:14:44,130
2.7 is the best<font color="#E5E5E5"> one that works with this</font>

376
00:14:41,430 --> 00:14:47,890
you can't compile it for compatibility

377
00:14:44,130 --> 00:14:49,689
however one<font color="#CCCCCC"> of my</font><font color="#E5E5E5"> favorites wit ur</font>

378
00:14:47,890 --> 00:14:52,300
status<font color="#E5E5E5"> is the worst part about compiling</font>

379
00:14:49,690 --> 00:14:53,560
<font color="#CCCCCC">Python into Windows binaries apart when</font>

380
00:14:52,300 --> 00:14:57,130
you<font color="#E5E5E5"> get repeatedly punched in the throat</font>

381
00:14:53,560 --> 00:14:59,890
and I feel like<font color="#CCCCCC"> that is</font><font color="#E5E5E5"> really true and</font>

382
00:14:57,130 --> 00:15:02,980
compiling a Python executive<font color="#CCCCCC"> all its</font>

383
00:14:59,890 --> 00:15:05,380
kind of difficult I mean it works but it

384
00:15:02,980 --> 00:15:07,360
doesn't really<font color="#CCCCCC"> work super well you get</font>

385
00:15:05,380 --> 00:15:08,500
an exact you don't get just a single exe

386
00:15:07,360 --> 00:15:09,820
and<font color="#E5E5E5"> you're like okay cool i'm just going</font>

387
00:15:08,500 --> 00:15:12,070
to<font color="#E5E5E5"> email this and pop somebody's box</font>

388
00:15:09,820 --> 00:15:14,620
doesn't work you<font color="#E5E5E5"> get like nine files and</font>

389
00:15:12,070 --> 00:15:16,150
a zip file so<font color="#E5E5E5"> you have to email nine</font>

390
00:15:14,620 --> 00:15:17,950
files to your target like hey can<font color="#E5E5E5"> you</font>

391
00:15:16,150 --> 00:15:19,720
download these put them<font color="#E5E5E5"> in the same</font>

392
00:15:17,950 --> 00:15:22,930
directory for me and then just execute

393
00:15:19,720 --> 00:15:24,940
that one<font color="#E5E5E5"> that's right there thanks but</font>

394
00:15:22,930 --> 00:15:26,650
like and you can do it in a

395
00:15:24,940 --> 00:15:29,860
self-extracting archive so if you have

396
00:15:26,650 --> 00:15:31,180
like a<font color="#CCCCCC"> seven</font><font color="#E5E5E5"> zip sfx or use auto it</font>

397
00:15:29,860 --> 00:15:32,950
which is another program that allows you

398
00:15:31,180 --> 00:15:34,209
to<font color="#E5E5E5"> do something like this it doesn't</font>

399
00:15:32,950 --> 00:15:35,709
look<font color="#E5E5E5"> a little bit suspicious when</font><font color="#CCCCCC"> you</font>

400
00:15:34,209 --> 00:15:37,420
download extract a bunch of files to

401
00:15:35,709 --> 00:15:40,170
temp and then you know start executing<font color="#E5E5E5"> a</font>

402
00:15:37,420 --> 00:15:40,170
bunch of<font color="#E5E5E5"> stuff</font><font color="#CCCCCC"> from there</font>

403
00:15:40,649 --> 00:15:45,449
so one way to kind<font color="#E5E5E5"> of combat this is</font>

404
00:15:43,420 --> 00:15:47,889
called process local memory injection

405
00:15:45,449 --> 00:15:50,258
what this<font color="#E5E5E5"> does is injecting malicious</font>

406
00:15:47,889 --> 00:15:51,519
code into our own running process so

407
00:15:50,259 --> 00:15:53,470
we're not targeting somebody else we're

408
00:15:51,519 --> 00:15:56,350
targeting ourselves and it sounds kind

409
00:15:53,470 --> 00:15:58,809
of weird at first it's not detected as a

410
00:15:56,350 --> 00:16:01,209
process hijacker we do to the context

411
00:15:58,809 --> 00:16:03,339
meaning that since we're affecting our

412
00:16:01,209 --> 00:16:04,899
own process any viruses like hey you're

413
00:16:03,339 --> 00:16:07,809
not messing with anybody else I'll just

414
00:16:04,899 --> 00:16:09,399
let you alone and it's also<font color="#E5E5E5"> payload type</font>

415
00:16:07,809 --> 00:16:12,040
in the veil framework and actually this

416
00:16:09,399 --> 00:16:13,779
is one<font color="#CCCCCC"> of the main</font><font color="#E5E5E5"> processor shell code</font>

417
00:16:12,040 --> 00:16:17,529
injection vectors in the<font color="#E5E5E5"> veil framework</font>

418
00:16:13,779 --> 00:16:19,029
itself so this<font color="#E5E5E5"> is kind of a little</font>

419
00:16:17,529 --> 00:16:20,740
representation of how local memory

420
00:16:19,029 --> 00:16:23,139
injection works so you have<font color="#CCCCCC"> your own</font>

421
00:16:20,740 --> 00:16:25,240
stack here of your own process and you

422
00:16:23,139 --> 00:16:27,220
basically call the same functions that

423
00:16:25,240 --> 00:16:29,439
we called in our previous example you

424
00:16:27,220 --> 00:16:33,730
know open process braciola<font color="#CCCCCC"> x-rite</font>

425
00:16:29,439 --> 00:16:36,459
process memory and you know we can write

426
00:16:33,730 --> 00:16:38,319
on your coats here and then bang our

427
00:16:36,459 --> 00:16:40,029
<font color="#CCCCCC">process is now running malicious code</font>

428
00:16:38,319 --> 00:16:41,229
and you<font color="#E5E5E5"> think well wait a minute why</font>

429
00:16:40,029 --> 00:16:44,350
would<font color="#E5E5E5"> I want to run a malicious code in</font>

430
00:16:41,230 --> 00:16:47,860
<font color="#CCCCCC">my own process well one thing it does it</font>

431
00:16:44,350 --> 00:16:49,660
does evade AV and<font color="#E5E5E5"> I'll show you so this</font>

432
00:16:47,860 --> 00:16:51,370
for example is just me running with

433
00:16:49,660 --> 00:16:53,139
<font color="#CCCCCC">server so</font><font color="#E5E5E5"> I create up a ball i created a</font>

434
00:16:51,370 --> 00:16:54,459
box<font color="#CCCCCC"> that had a bunch of antibiotics</font>

435
00:16:53,139 --> 00:16:56,350
programs on it as much as I can<font color="#E5E5E5"> possibly</font>

436
00:16:54,459 --> 00:16:58,628
put on there without them failing or

437
00:16:56,350 --> 00:17:00,309
crash in the box so first of all I try

438
00:16:58,629 --> 00:17:02,529
to do meterpreter which is highly picked

439
00:17:00,309 --> 00:17:04,809
up by virus on every single antivirus

440
00:17:02,529 --> 00:17:07,089
program there<font color="#CCCCCC"> is so this is just</font><font color="#E5E5E5"> an</font>

441
00:17:04,809 --> 00:17:08,379
encoded meterpreter shell as you can<font color="#E5E5E5"> see</font>

442
00:17:07,089 --> 00:17:10,599
as soon as<font color="#CCCCCC"> I run it to pick up</font>

443
00:17:08,380 --> 00:17:16,240
immediately I get to not the ability to

444
00:17:10,599 --> 00:17:18,938
run it so now oh and this is<font color="#E5E5E5"> the virus</font>

445
00:17:16,240 --> 00:17:21,069
of scan of that file that I just ran

446
00:17:18,939 --> 00:17:25,600
just for kind of context and this how

447
00:17:21,069 --> 00:17:28,389
bad it is being detected so this is

448
00:17:25,599 --> 00:17:29,980
<font color="#E5E5E5">local injection so this code i'm going</font>

449
00:17:28,390 --> 00:17:32,799
to upload a github as well this is a

450
00:17:29,980 --> 00:17:34,870
<font color="#CCCCCC">python file that has shellcode for</font>

451
00:17:32,799 --> 00:17:36,850
immature peter shell inside of it and

452
00:17:34,870 --> 00:17:38,979
<font color="#CCCCCC">it's the same</font><font color="#E5E5E5"> boxer running Sam</font>

453
00:17:36,850 --> 00:17:41,620
antivirus programs so<font color="#E5E5E5"> I'm gonna go ahead</font>

454
00:17:38,980 --> 00:17:43,840
and I ran it so I'm objecting code in my

455
00:17:41,620 --> 00:17:46,479
<font color="#E5E5E5">own process and I go over to my cali box</font>

456
00:17:43,840 --> 00:17:49,360
and<font color="#CCCCCC"> i get at ER burnin show my antivirus</font>

457
00:17:46,480 --> 00:17:53,520
did not pick<font color="#CCCCCC"> that up at all so</font><font color="#E5E5E5"> i'm now</font>

458
00:17:49,360 --> 00:17:53,520
running meterpreter session freely

459
00:17:54,090 --> 00:18:00,730
now the one caveat to that is I will say

460
00:17:57,610 --> 00:18:02,889
semantics which is one of<font color="#E5E5E5"> the virus</font>

461
00:18:00,730 --> 00:18:04,540
products that we did test does have a

462
00:18:02,890 --> 00:18:07,000
very good firewall that does pick up

463
00:18:04,540 --> 00:18:09,510
meterpreter no matter what so even if

464
00:18:07,000 --> 00:18:12,130
you use HTTPS or you use bond she'll

465
00:18:09,510 --> 00:18:14,050
reverse shell anything it will pick<font color="#CCCCCC"> it</font>

466
00:18:12,130 --> 00:18:15,490
up that's the one caveat the only one

467
00:18:14,050 --> 00:18:16,930
that was<font color="#CCCCCC"> able</font><font color="#E5E5E5"> to pick</font><font color="#CCCCCC"> it up but</font><font color="#E5E5E5"> once we</font>

468
00:18:15,490 --> 00:18:21,370
<font color="#CCCCCC">disable</font><font color="#E5E5E5"> the semantic fire we're going to</font>

469
00:18:16,930 --> 00:18:23,380
<font color="#E5E5E5">get past that so</font><font color="#CCCCCC"> what</font><font color="#E5E5E5"> does local</font>

470
00:18:21,370 --> 00:18:25,600
injection work well like I said before

471
00:18:23,380 --> 00:18:27,280
we're not touching any other process in

472
00:18:25,600 --> 00:18:28,990
memory at all so any Barse is like hey

473
00:18:27,280 --> 00:18:30,910
cool no matter what anybody you're

474
00:18:28,990 --> 00:18:33,550
messing with yourself and also<font color="#E5E5E5"> this does</font>

475
00:18:30,910 --> 00:18:37,300
happen processes do do this themselves

476
00:18:33,550 --> 00:18:39,399
does happen naturally and also anti

477
00:18:37,300 --> 00:18:41,470
virus doesn't actually scan memory of

478
00:18:39,400 --> 00:18:43,240
many processes at all there's only<font color="#E5E5E5"> a</font>

479
00:18:41,470 --> 00:18:49,600
couple that do scan it and a<font color="#E5E5E5"> lot of this</font>

480
00:18:43,240 --> 00:18:52,570
isn't picked up now why local injection

481
00:18:49,600 --> 00:18:55,060
sucks the reason it kind of sucks is

482
00:18:52,570 --> 00:18:57,340
you're still running your<font color="#CCCCCC"> own process so</font>

483
00:18:55,060 --> 00:19:00,520
if you download a file that's stupid

484
00:18:57,340 --> 00:19:01,899
file Exe and it does this stupid file

485
00:19:00,520 --> 00:19:03,910
actually<font color="#E5E5E5"> still running on your system</font>

486
00:19:01,900 --> 00:19:06,310
that<font color="#E5E5E5"> might be even doing</font><font color="#CCCCCC"> Melissa stuff</font>

487
00:19:03,910 --> 00:19:08,860
so as soon<font color="#E5E5E5"> as you do something malicious</font>

488
00:19:06,310 --> 00:19:11,139
like you migrate<font color="#E5E5E5"> meterpreter or I don't</font>

489
00:19:08,860 --> 00:19:13,060
know you try<font color="#E5E5E5"> to do an</font><font color="#CCCCCC"> LS</font><font color="#E5E5E5"> a dump and dump</font>

490
00:19:11,140 --> 00:19:14,920
like hatches from windows or dump

491
00:19:13,060 --> 00:19:16,179
credentials or anything like that it's

492
00:19:14,920 --> 00:19:18,160
going<font color="#CCCCCC"> to</font><font color="#E5E5E5"> pick it up</font><font color="#CCCCCC"> and soon say hey</font>

493
00:19:16,180 --> 00:19:19,960
wait<font color="#E5E5E5"> a minute that doesn't seem</font><font color="#CCCCCC"> right</font>

494
00:19:18,160 --> 00:19:22,240
and your file is going to get deleted

495
00:19:19,960 --> 00:19:24,550
and your shells going so basically it

496
00:19:22,240 --> 00:19:32,140
<font color="#E5E5E5">works really well but the execution is</font>

497
00:19:24,550 --> 00:19:35,470
<font color="#CCCCCC">not really there so this is base this is</font>

498
00:19:32,140 --> 00:19:37,360
because<font color="#CCCCCC"> of</font><font color="#E5E5E5"> AV heuristic detection and I</font>

499
00:19:35,470 --> 00:19:39,160
kind of went over a little bit what it

500
00:19:37,360 --> 00:19:41,620
<font color="#E5E5E5">really looks at what the process is</font>

501
00:19:39,160 --> 00:19:43,990
doing so<font color="#E5E5E5"> there's a known process is it a</font>

502
00:19:41,620 --> 00:19:45,760
system process is it explorer.exe is a

503
00:19:43,990 --> 00:19:48,190
reg out of the exit is<font color="#E5E5E5"> that no</font><font color="#CCCCCC"> Pat exe</font>

504
00:19:45,760 --> 00:19:51,430
is<font color="#E5E5E5"> who's the user running is a system</font>

505
00:19:48,190 --> 00:19:53,950
running it is<font color="#E5E5E5"> NT at the network service</font>

506
00:19:51,430 --> 00:19:56,830
running it is Bob running it you know is

507
00:19:53,950 --> 00:19:58,420
<font color="#E5E5E5">Joe running it also the execute path so</font>

508
00:19:56,830 --> 00:20:00,100
you know where's Explorer running from

509
00:19:58,420 --> 00:20:01,090
where<font color="#CCCCCC"> Skov who is running</font><font color="#E5E5E5"> from where is</font>

510
00:20:00,100 --> 00:20:03,490
no pattern

511
00:20:01,090 --> 00:20:05,290
and<font color="#CCCCCC"> it also looks at network connections</font>

512
00:20:03,490 --> 00:20:07,420
made I mean you know if you have

513
00:20:05,290 --> 00:20:10,600
notepad.exe having a network connection

514
00:20:07,420 --> 00:20:13,510
out to I don't know China that does kind

515
00:20:10,600 --> 00:20:14,530
of look suspicious I mean notepad does

516
00:20:13,510 --> 00:20:16,060
even connect<font color="#CCCCCC"> to anything on the network</font>

517
00:20:14,530 --> 00:20:19,240
so that already does look suspicious

518
00:20:16,060 --> 00:20:25,030
already and its really level as threat

519
00:20:19,240 --> 00:20:26,470
intelligence as well so for<font color="#E5E5E5"> example I</font>

520
00:20:25,030 --> 00:20:30,190
have a bunch of<font color="#E5E5E5"> processes on this board</font>

521
00:20:26,470 --> 00:20:32,380
so there's a couple process on here that

522
00:20:30,190 --> 00:20:34,810
<font color="#E5E5E5">are completely not good they're</font>

523
00:20:32,380 --> 00:20:36,310
malicious just by looking at what the

524
00:20:34,810 --> 00:20:37,690
information<font color="#CCCCCC"> I gave you can you think</font><font color="#E5E5E5"> you</font>

525
00:20:36,310 --> 00:20:47,980
could spot any process that I'm

526
00:20:37,690 --> 00:20:50,770
RELIGIOUS so if you<font color="#E5E5E5"> got these two you</font>

527
00:20:47,980 --> 00:20:53,320
got them right notepad never runs<font color="#CCCCCC"> a</font>

528
00:20:50,770 --> 00:20:55,180
system and the funny thing<font color="#CCCCCC"> is a lot of</font>

529
00:20:53,320 --> 00:20:56,980
pen testers will actually start notepad

530
00:20:55,180 --> 00:20:59,950
from interpreter and migrate into it and

531
00:20:56,980 --> 00:21:01,720
that's<font color="#E5E5E5"> what you'll see this from as well</font>

532
00:20:59,950 --> 00:21:03,580
<font color="#E5E5E5">this one looks really suspicious I mean</font>

533
00:21:01,720 --> 00:21:05,920
a lot<font color="#CCCCCC"> of malware does do that</font><font color="#E5E5E5"> where it</font>

534
00:21:03,580 --> 00:21:08,350
drops a file that looks like it has the

535
00:21:05,920 --> 00:21:10,990
same name of<font color="#E5E5E5"> a common windows process</font>

536
00:21:08,350 --> 00:21:12,820
such as svchost and then when you go<font color="#E5E5E5"> an</font>

537
00:21:10,990 --> 00:21:15,160
<font color="#E5E5E5">attached manager you don't see the exact</font>

538
00:21:12,820 --> 00:21:17,139
executable path like oh that's fine you

539
00:21:15,160 --> 00:21:19,030
know<font color="#CCCCCC"> I got scoped us running not a big</font>

540
00:21:17,140 --> 00:21:23,170
deal but<font color="#CCCCCC"> it's running from the temp</font>

541
00:21:19,030 --> 00:21:25,389
directory so<font color="#E5E5E5"> basically going back over</font>

542
00:21:23,170 --> 00:21:27,790
<font color="#E5E5E5">it you know</font><font color="#CCCCCC"> as you</font><font color="#E5E5E5"> can see process path</font>

543
00:21:25,390 --> 00:21:30,370
skill host is never located in temp it's

544
00:21:27,790 --> 00:21:31,750
<font color="#E5E5E5">always in C windows system32 and you</font>

545
00:21:30,370 --> 00:21:39,280
have no pads running a system which

546
00:21:31,750 --> 00:21:41,260
never happens so maybe<font color="#CCCCCC"> windows API is</font>

547
00:21:39,280 --> 00:21:44,050
are also called checked by antivirus as

548
00:21:41,260 --> 00:21:46,750
well so anti virus does is look at<font color="#E5E5E5"> API</font>

549
00:21:44,050 --> 00:21:48,520
calls that you make and it checks the

550
00:21:46,750 --> 00:21:51,730
context to see if<font color="#CCCCCC"> that looks malicious</font>

551
00:21:48,520 --> 00:21:53,800
and what I mean<font color="#CCCCCC"> by context is this so if</font>

552
00:21:51,730 --> 00:21:56,170
you have windward exe which is the

553
00:21:53,800 --> 00:21:58,950
process name for<font color="#E5E5E5"> microsoft word and it</font>

554
00:21:56,170 --> 00:22:01,090
tries to<font color="#E5E5E5"> open a handle to windward</font>

555
00:21:58,950 --> 00:22:03,160
microsoft word so<font color="#CCCCCC"> it's opening</font><font color="#E5E5E5"> a handle</font>

556
00:22:01,090 --> 00:22:07,870
to itself you think antivirus is gonna

557
00:22:03,160 --> 00:22:09,610
let that happen it is this is opening

558
00:22:07,870 --> 00:22:11,889
handle to itself it's like<font color="#CCCCCC"> okay whatever</font>

559
00:22:09,610 --> 00:22:14,709
<font color="#E5E5E5">you can do that so now we have our</font>

560
00:22:11,890 --> 00:22:17,110
process called now proc exe

561
00:22:14,710 --> 00:22:19,480
it tries<font color="#CCCCCC"> to open up a handle to windward</font>

562
00:22:17,110 --> 00:22:23,110
again<font color="#CCCCCC"> I think antivirus gonna let that</font>

563
00:22:19,480 --> 00:22:25,570
happen that would be<font color="#CCCCCC"> nope it's</font><font color="#E5E5E5"> not gonna</font>

564
00:22:23,110 --> 00:22:27,189
<font color="#E5E5E5">happen what that's a process hijacker</font>

565
00:22:25,570 --> 00:22:29,139
right there they're saying okay you want

566
00:22:27,190 --> 00:22:33,010
to<font color="#E5E5E5"> inject memory into windward we're not</font>

567
00:22:29,140 --> 00:22:37,510
gonna let you do that now we have run

568
00:22:33,010 --> 00:22:39,940
dll 32 then it once to open up a handle

569
00:22:37,510 --> 00:22:43,059
to windward exe you think this will<font color="#CCCCCC"> be</font>

570
00:22:39,940 --> 00:22:45,220
allowed if you said yes you<font color="#CCCCCC"> are right</font>

571
00:22:43,059 --> 00:22:48,010
the reason being is this a system

572
00:22:45,220 --> 00:22:49,690
process it's<font color="#E5E5E5"> like hey this is system</font>

573
00:22:48,010 --> 00:22:51,309
<font color="#E5E5E5">it's obviously does this so why would I</font>

574
00:22:49,690 --> 00:22:56,169
disallow it from doing<font color="#E5E5E5"> what's supposed</font>

575
00:22:51,309 --> 00:22:59,110
to<font color="#E5E5E5"> do so in going over really quickly</font>

576
00:22:56,169 --> 00:23:00,610
before<font color="#E5E5E5"> we get in to the exploit the API</font>

577
00:22:59,110 --> 00:23:02,199
calls these are some of the impact calls

578
00:23:00,610 --> 00:23:04,270
that are actually monitored by<font color="#E5E5E5"> ourself</font>

579
00:23:02,200 --> 00:23:06,429
<font color="#E5E5E5">and these are the ones that actually can</font>

580
00:23:04,270 --> 00:23:07,899
do the most damage so we have create

581
00:23:06,429 --> 00:23:09,970
remote thread which i use my earlier

582
00:23:07,899 --> 00:23:11,590
examples and<font color="#CCCCCC"> then like I said</font><font color="#E5E5E5"> it allows</font>

583
00:23:09,970 --> 00:23:13,870
you to create a thread in another

584
00:23:11,590 --> 00:23:15,689
process that is not yours I mean or it

585
00:23:13,870 --> 00:23:18,158
can be your process if you want it to<font color="#E5E5E5"> be</font>

586
00:23:15,690 --> 00:23:21,220
antique rate 30 X this is the beauty of

587
00:23:18,159 --> 00:23:22,419
<font color="#E5E5E5">Microsoft we're here people this funk</font>

588
00:23:21,220 --> 00:23:25,419
this<font color="#E5E5E5"> method is not documented anywhere</font>

589
00:23:22,419 --> 00:23:27,279
and any of<font color="#CCCCCC"> Microsoft's documentation</font>

590
00:23:25,419 --> 00:23:29,980
it's not and it's<font color="#E5E5E5"> actually the most</font>

591
00:23:27,279 --> 00:23:32,590
affected the best<font color="#E5E5E5"> working method for</font>

592
00:23:29,980 --> 00:23:35,020
doing memory injection and<font color="#CCCCCC"> write calling</font>

593
00:23:32,590 --> 00:23:36,970
an antique writ empty crate<font color="#CCCCCC"> 30x does the</font>

594
00:23:35,020 --> 00:23:39,129
same thing as great remote thread except

595
00:23:36,970 --> 00:23:41,799
<font color="#E5E5E5">for some reason</font><font color="#CCCCCC"> antique create 30x works</font>

596
00:23:39,130 --> 00:23:44,320
on 64-bit systems and it doesn't work or

597
00:23:41,799 --> 00:23:46,210
create more threat does<font color="#CCCCCC"> not but it's</font>

598
00:23:44,320 --> 00:23:49,000
also undocumented so I have no idea<font color="#E5E5E5"> why</font>

599
00:23:46,210 --> 00:23:50,279
Microsoft did that right<font color="#CCCCCC"> parts is memory</font>

600
00:23:49,000 --> 00:23:52,179
but<font color="#E5E5E5"> I also use them a preview sample</font>

601
00:23:50,279 --> 00:23:54,730
like I said<font color="#E5E5E5"> it allows you to write</font>

602
00:23:52,179 --> 00:23:56,770
<font color="#E5E5E5">content to process memory I need</font><font color="#CCCCCC"> an open</font>

603
00:23:54,730 --> 00:23:58,840
process I've also used for open a handle

604
00:23:56,770 --> 00:24:00,908
this<font color="#E5E5E5"> one's a little bit a new one this</font>

605
00:23:58,840 --> 00:24:03,340
is used in<font color="#E5E5E5"> mature / a little bit its</font>

606
00:24:00,909 --> 00:24:05,289
<font color="#E5E5E5">load library a and you can also have</font>

607
00:24:03,340 --> 00:24:06,879
load library w what i use a on<font color="#E5E5E5"> this</font>

608
00:24:05,289 --> 00:24:08,770
example and basically when<font color="#E5E5E5"> you call that</font>

609
00:24:06,880 --> 00:24:10,779
you call it with a dll path and allows

610
00:24:08,770 --> 00:24:13,179
you to load any dll into your current

611
00:24:10,779 --> 00:24:17,620
process and we're going to<font color="#E5E5E5"> use that</font><font color="#CCCCCC"> in</font>

612
00:24:13,179 --> 00:24:19,450
one of our<font color="#E5E5E5"> examples so back to</font><font color="#CCCCCC"> our one</font>

613
00:24:17,620 --> 00:24:21,699
example where we talked about context is

614
00:24:19,450 --> 00:24:24,730
that we notice that run dll was allowed

615
00:24:21,700 --> 00:24:27,159
to open a handle to windward and that's

616
00:24:24,730 --> 00:24:28,690
because<font color="#E5E5E5"> of a be trust JV inherently</font>

617
00:24:27,159 --> 00:24:31,210
trusts system files

618
00:24:28,690 --> 00:24:32,350
and the reason<font color="#E5E5E5"> being a 2008 I can't</font>

619
00:24:31,210 --> 00:24:34,690
mention the vendor but<font color="#E5E5E5"> if you go to the</font>

620
00:24:32,350 --> 00:24:37,179
<font color="#E5E5E5">link you can look it up this vendor had</font>

621
00:24:34,690 --> 00:24:39,610
a signature that<font color="#E5E5E5"> detected a</font><font color="#CCCCCC"> windows</font>

622
00:24:37,180 --> 00:24:41,620
native program as malware I don't like

623
00:24:39,610 --> 00:24:43,659
okay what's the big deal<font color="#CCCCCC"> in that we</font>

624
00:24:41,620 --> 00:24:45,729
detected it deleted a critical system

625
00:24:43,660 --> 00:24:47,110
file and everybody that was like oh I'm

626
00:24:45,730 --> 00:24:48,430
cleaning malware my system could no

627
00:24:47,110 --> 00:24:51,699
longer boot their operating system

628
00:24:48,430 --> 00:24:54,460
anymore so to prevent that AV does

629
00:24:51,700 --> 00:24:56,500
prevent you prevent system processes and

630
00:24:54,460 --> 00:24:59,350
<font color="#E5E5E5">maybe data files especially because it</font>

631
00:24:56,500 --> 00:25:01,450
gotta save itself from being malware so

632
00:24:59,350 --> 00:25:02,800
it's like hey if you know explorers

633
00:25:01,450 --> 00:25:05,230
trying to do something malicious but

634
00:25:02,800 --> 00:25:07,419
it's just opening a handle or it's

635
00:25:05,230 --> 00:25:10,900
writing memory<font color="#E5E5E5"> okay that's fine</font><font color="#CCCCCC"> whatever</font>

636
00:25:07,420 --> 00:25:13,840
I don't<font color="#CCCCCC"> care so orphan evening program</font>

637
00:25:10,900 --> 00:25:16,900
file is doing it as well summary leads

638
00:25:13,840 --> 00:25:18,399
us to our exploit so you know right now

639
00:25:16,900 --> 00:25:19,930
as you can see we<font color="#CCCCCC"> have a couple of</font>

640
00:25:18,400 --> 00:25:21,760
<font color="#CCCCCC">things</font><font color="#E5E5E5"> that in combination could kind of</font>

641
00:25:19,930 --> 00:25:23,170
work together so we have memory

642
00:25:21,760 --> 00:25:25,420
injection that<font color="#E5E5E5"> could hide our code</font>

643
00:25:23,170 --> 00:25:26,710
currently we can only do<font color="#CCCCCC"> it in our</font>

644
00:25:25,420 --> 00:25:29,680
current process we're thinking okay

645
00:25:26,710 --> 00:25:32,550
whatever that's cool but also<font color="#E5E5E5"> AV has an</font>

646
00:25:29,680 --> 00:25:34,750
inherent trust in system processes and

647
00:25:32,550 --> 00:25:37,870
actions my system<font color="#CCCCCC"> processes</font><font color="#E5E5E5"> are trusted</font>

648
00:25:34,750 --> 00:25:39,490
<font color="#E5E5E5">all right so really</font><font color="#CCCCCC"> all we need is a</font>

649
00:25:37,870 --> 00:25:41,530
system process that can run our

650
00:25:39,490 --> 00:25:43,750
malicious code for us<font color="#CCCCCC"> all at</font><font color="#E5E5E5"> the same</font>

651
00:25:41,530 --> 00:25:46,629
time<font color="#E5E5E5"> looking like</font><font color="#CCCCCC"> a system process and</font>

652
00:25:43,750 --> 00:25:55,690
acting<font color="#E5E5E5"> like a system process so and our</font>

653
00:25:46,630 --> 00:25:58,530
answer is before is run dll<font color="#E5E5E5"> 32 XD so and</font>

654
00:25:55,690 --> 00:26:01,420
just<font color="#CCCCCC"> to on our next exploit I</font><font color="#E5E5E5"> had to use</font>

655
00:25:58,530 --> 00:26:04,210
bind tcp just because matter<font color="#CCCCCC"> per was</font>

656
00:26:01,420 --> 00:26:07,030
having issues<font color="#E5E5E5"> my example the one good</font>

657
00:26:04,210 --> 00:26:10,120
<font color="#E5E5E5">thing is is I tried to generate a bind</font>

658
00:26:07,030 --> 00:26:12,160
tcp exe to show you how if<font color="#E5E5E5"> AV will pick</font>

659
00:26:10,120 --> 00:26:14,560
it<font color="#E5E5E5"> up I couldn't even copy it over to my</font>

660
00:26:12,160 --> 00:26:16,600
vm that's how bad it picked it up as

661
00:26:14,560 --> 00:26:18,850
soon<font color="#E5E5E5"> as I copied it or even touched it</font>

662
00:26:16,600 --> 00:26:20,830
it was like nope you can't do that so

663
00:26:18,850 --> 00:26:24,959
that's how<font color="#E5E5E5"> easily the code we're about</font>

664
00:26:20,830 --> 00:26:24,960
to run is being<font color="#E5E5E5"> picked up by any virus</font>

665
00:26:26,460 --> 00:26:30,370
so and<font color="#E5E5E5"> I have sysinternals open in the</font>

666
00:26:29,230 --> 00:26:31,960
background they can't see it very well

667
00:26:30,370 --> 00:26:33,399
but I sysinternals open in the

668
00:26:31,960 --> 00:26:36,550
background that's going to show my

669
00:26:33,400 --> 00:26:39,690
connection so right now why doesn't

670
00:26:36,550 --> 00:26:39,690
quality so bad

671
00:26:41,970 --> 00:26:52,779
he fix<font color="#CCCCCC"> it sorry</font><font color="#E5E5E5"> about that guys I don't</font>

672
00:26:46,509 --> 00:26:58,149
know why it looks really crappy<font color="#CCCCCC"> I look a</font>

673
00:26:52,779 --> 00:27:00,159
little better so we got our compiled exe

674
00:26:58,149 --> 00:27:02,289
over here so now we notice we clicked it

675
00:27:00,159 --> 00:27:06,129
in<font color="#CCCCCC"> a</font><font color="#E5E5E5"> ramp nothing happened our process</font>

676
00:27:02,289 --> 00:27:08,109
<font color="#E5E5E5">closed so i'm sitting</font><font color="#CCCCCC"> here waiting I got</font>

677
00:27:06,129 --> 00:27:09,789
over my box my cali box and look at<font color="#E5E5E5"> that</font>

678
00:27:08,109 --> 00:27:12,249
I got a bunch are I got a reverse shell

679
00:27:09,789 --> 00:27:13,899
open completely even though antivirus

680
00:27:12,249 --> 00:27:16,450
was in the system did not pick it up at

681
00:27:13,899 --> 00:27:17,979
<font color="#E5E5E5">all so in the greatest thing I look</font>

682
00:27:16,450 --> 00:27:19,960
where I'm running as and I don't know if

683
00:27:17,980 --> 00:27:23,169
you can<font color="#E5E5E5"> see it but I infected the</font>

684
00:27:19,960 --> 00:27:25,869
antivirus process so my code infected

685
00:27:23,169 --> 00:27:27,369
antivirus so not<font color="#CCCCCC"> only am i running shell</font>

686
00:27:25,869 --> 00:27:29,759
on detecting the system actually

687
00:27:27,369 --> 00:27:32,139
infected the own area virus product and

688
00:27:29,759 --> 00:27:34,749
honestly I did not deliberately attack

689
00:27:32,139 --> 00:27:36,699
the antivirus process but I thought it

690
00:27:34,749 --> 00:27:45,549
was kind of ironic that any virus was

691
00:27:36,700 --> 00:27:48,460
now doing my bidding no well because the

692
00:27:45,549 --> 00:27:50,080
fact I'm well because I'm<font color="#CCCCCC"> housing it a V</font>

693
00:27:48,460 --> 00:27:52,989
process it wouldn't know if I was housed

694
00:27:50,080 --> 00:27:59,199
in like I don't know uh java update

695
00:27:52,989 --> 00:28:06,929
scheduler yeah when do that so that's my

696
00:27:59,200 --> 00:28:09,489
video comes up so what<font color="#CCCCCC"> happened what oh</font>

697
00:28:06,929 --> 00:28:11,019
there it goes it doesn't<font color="#CCCCCC"> i think i</font>

698
00:28:09,489 --> 00:28:13,239
infected the projector I might've did

699
00:28:11,019 --> 00:28:15,789
that by accident so what<font color="#CCCCCC"> happened so</font>

700
00:28:13,239 --> 00:28:18,700
what do we do that allowed us to get to

701
00:28:15,789 --> 00:28:21,369
where we are now so our main process

702
00:28:18,700 --> 00:28:23,889
takes itself and dumps it into a dll

703
00:28:21,369 --> 00:28:25,678
into the temp directory and that<font color="#E5E5E5"> DLL</font>

704
00:28:23,889 --> 00:28:29,080
contains our shell code and instructions

705
00:28:25,679 --> 00:28:32,200
to do its next job which what it does is

706
00:28:29,080 --> 00:28:34,779
it gets<font color="#E5E5E5"> launched by run deal a 32 so my</font>

707
00:28:32,200 --> 00:28:39,940
main process<font color="#CCCCCC"> hall is run d low 32 with</font>

708
00:28:34,779 --> 00:28:44,139
our drop or drop dll and now our<font color="#E5E5E5"> process</font>

709
00:28:39,940 --> 00:28:46,179
<font color="#CCCCCC">is now running as run dll 32 so our dll</font>

710
00:28:44,139 --> 00:28:48,699
now enumerates all running processes and

711
00:28:46,179 --> 00:28:49,960
it's like okay I want that<font color="#E5E5E5"> one so we</font>

712
00:28:48,700 --> 00:28:51,210
pick a process that's not going to make

713
00:28:49,960 --> 00:28:52,980
the<font color="#E5E5E5"> system crash which</font>

714
00:28:51,210 --> 00:28:55,440
I have done<font color="#E5E5E5"> that I blue screen to box a</font>

715
00:28:52,980 --> 00:28:56,760
couple<font color="#E5E5E5"> times and testing this but once</font>

716
00:28:55,440 --> 00:28:58,440
we pick our process that meets our

717
00:28:56,760 --> 00:29:00,750
recommendations we're going<font color="#E5E5E5"> to inject</font>

718
00:28:58,440 --> 00:29:03,600
shellcode into it and because we are

719
00:29:00,750 --> 00:29:05,130
running as rundll32 antivirus doesn't

720
00:29:03,600 --> 00:29:07,830
pick it<font color="#E5E5E5"> up it says okay you want to do</font>

721
00:29:05,130 --> 00:29:10,320
<font color="#E5E5E5">that go go ahead and then the shellcode</font>

722
00:29:07,830 --> 00:29:12,360
runs so in a little<font color="#E5E5E5"> graph because</font>

723
00:29:10,320 --> 00:29:16,439
<font color="#CCCCCC">they're kind of step-by-step this is we</font>

724
00:29:12,360 --> 00:29:20,699
create a dll file we call run deal of 32

725
00:29:16,440 --> 00:29:22,289
to execute that file our file then

726
00:29:20,700 --> 00:29:25,620
enumerates all processes and it picks

727
00:29:22,289 --> 00:29:27,179
out a specific process and then we

728
00:29:25,620 --> 00:29:29,370
inject code into it and then start are

729
00:29:27,179 --> 00:29:31,080
malicious right and then we now have

730
00:29:29,370 --> 00:29:35,100
malware on your machine without being

731
00:29:31,080 --> 00:29:36,899
detected<font color="#CCCCCC"> and as a bonus video I'm not</font><font color="#E5E5E5"> I</font>

732
00:29:35,100 --> 00:29:38,760
i don't i'm<font color="#CCCCCC"> not supposed to call</font><font color="#E5E5E5"> ops for</font>

733
00:29:36,899 --> 00:29:40,199
the antivirus matters but<font color="#E5E5E5"> if any of you</font>

734
00:29:38,760 --> 00:29:42,149
guys heard of<font color="#CCCCCC"> Microsoft</font><font color="#E5E5E5"> Emmett the</font>

735
00:29:40,200 --> 00:29:43,860
<font color="#E5E5E5">enhanced mitigation experience toolkit</font>

736
00:29:42,149 --> 00:29:45,689
it's<font color="#E5E5E5"> supposed to detect from buffer</font>

737
00:29:43,860 --> 00:29:47,549
overflows and injections and a lot<font color="#CCCCCC"> of</font>

738
00:29:45,690 --> 00:29:50,340
things for<font color="#CCCCCC"> Windows and it's constantly</font>

739
00:29:47,549 --> 00:29:57,270
updated problem is I<font color="#E5E5E5"> test it this</font>

740
00:29:50,340 --> 00:29:58,559
morning and we wrote a bypass it it's

741
00:29:57,270 --> 00:30:01,260
our little bonus videos we have<font color="#CCCCCC"> Emmett</font>

742
00:29:58,559 --> 00:30:02,970
here running and we have our code again

743
00:30:01,260 --> 00:30:04,408
so let's run our code this time again

744
00:30:02,970 --> 00:30:07,380
with Emmett running in the background

745
00:30:04,409 --> 00:30:10,110
all right<font color="#CCCCCC"> when foreground really and</font>

746
00:30:07,380 --> 00:30:17,640
you'll notice<font color="#CCCCCC"> once it takes</font><font color="#E5E5E5"> a couple</font>

747
00:30:10,110 --> 00:30:19,770
seconds to load that goes so you notice

748
00:30:17,640 --> 00:30:21,840
we fected powershell the powershell

749
00:30:19,770 --> 00:30:24,899
process that was running we now infected

750
00:30:21,840 --> 00:30:27,840
that and now I have<font color="#CCCCCC"> another reverse</font>

751
00:30:24,899 --> 00:30:29,639
shell in the system completely bypassing

752
00:30:27,840 --> 00:30:30,629
all technical controls put in place to

753
00:30:29,640 --> 00:30:32,870
<font color="#E5E5E5">prevent something like this from</font>

754
00:30:30,630 --> 00:30:32,870
happening

755
00:30:40,520 --> 00:30:45,180
so incompatibility I did test this on

756
00:30:43,350 --> 00:30:47,280
numerous version windows I kind of said

757
00:30:45,180 --> 00:30:50,820
screw windows 8 because who really uses

758
00:30:47,280 --> 00:30:52,920
windows 8 my main test bed was windows 7

759
00:30:50,820 --> 00:30:54,419
it works fine and I also test it on

760
00:30:52,920 --> 00:30:55,920
<font color="#E5E5E5">Windows NT even though i don't</font><font color="#CCCCCC"> know if</font>

761
00:30:54,420 --> 00:31:02,220
anybody really<font color="#E5E5E5"> likes Windows 10 either</font>

762
00:30:55,920 --> 00:31:04,140
and worked on winter sent as well so now

763
00:31:02,220 --> 00:31:05,520
we get to detection and prevention so

764
00:31:04,140 --> 00:31:11,880
how can we detect this it's actually

765
00:31:05,520 --> 00:31:13,950
<font color="#CCCCCC">very hard</font><font color="#E5E5E5"> no have you caught it nope so</font>

766
00:31:11,880 --> 00:31:15,830
detection one of the ways<font color="#E5E5E5"> we can detect</font>

767
00:31:13,950 --> 00:31:18,510
it is<font color="#E5E5E5"> I use a program called red line</font>

768
00:31:15,830 --> 00:31:19,889
redline it does analysis<font color="#CCCCCC"> of memory</font>

769
00:31:18,510 --> 00:31:21,300
currently running it has to dump it

770
00:31:19,890 --> 00:31:24,330
first and you can use it<font color="#E5E5E5"> to analyze</font>

771
00:31:21,300 --> 00:31:25,980
memory red line did see it in there so

772
00:31:24,330 --> 00:31:27,870
if you do a red line installed on your

773
00:31:25,980 --> 00:31:29,640
machines it will pick it<font color="#E5E5E5"> up not directly</font>

774
00:31:27,870 --> 00:31:30,719
in real time which you will be<font color="#CCCCCC"> able to</font>

775
00:31:29,640 --> 00:31:34,350
delete the text something like this

776
00:31:30,720 --> 00:31:37,020
<font color="#E5E5E5">going on volatility the volatility and</font>

777
00:31:34,350 --> 00:31:39,840
after<font color="#E5E5E5"> kind of action you know process so</font>

778
00:31:37,020 --> 00:31:42,000
if i happen to be dumping memory of the

779
00:31:39,840 --> 00:31:43,620
host as i was doing this exploit then

780
00:31:42,000 --> 00:31:46,050
volatility would definitely work i would

781
00:31:43,620 --> 00:31:47,550
<font color="#CCCCCC">have to</font><font color="#E5E5E5"> run I don't have to tell look</font>

782
00:31:46,050 --> 00:31:49,740
for injects in volatility but I can

783
00:31:47,550 --> 00:31:51,270
<font color="#E5E5E5">definitely see that and any memory don't</font>

784
00:31:49,740 --> 00:31:53,250
really to take would be<font color="#CCCCCC"> able</font><font color="#E5E5E5"> to see this</font>

785
00:31:51,270 --> 00:31:56,639
<font color="#E5E5E5">because this</font><font color="#CCCCCC"> is really a memory only</font>

786
00:31:53,250 --> 00:31:58,050
thing prevention how can we prevent

787
00:31:56,640 --> 00:31:59,370
something this for happening how can we

788
00:31:58,050 --> 00:32:01,110
prevent someone even getting affected

789
00:31:59,370 --> 00:32:03,060
<font color="#E5E5E5">like this one thing we can do we can</font>

790
00:32:01,110 --> 00:32:04,740
flag the dll itself or the loader is

791
00:32:03,060 --> 00:32:06,780
infected now this<font color="#E5E5E5"> isn't a permanent</font>

792
00:32:04,740 --> 00:32:08,880
solution as one little code change

793
00:32:06,780 --> 00:32:10,830
little bite immediately will change the

794
00:32:08,880 --> 00:32:12,450
signature these two files and you know

795
00:32:10,830 --> 00:32:15,240
we're just doing it all over again it's

796
00:32:12,450 --> 00:32:16,980
<font color="#E5E5E5">like cat</font><font color="#CCCCCC"> and mouse one thing we could do</font>

797
00:32:15,240 --> 00:32:19,740
<font color="#E5E5E5">with</font><font color="#CCCCCC"> windows to bolster security in</font>

798
00:32:16,980 --> 00:32:22,290
itself we could force<font color="#CCCCCC"> dll's to be signed</font>

799
00:32:19,740 --> 00:32:24,330
to have to run so I<font color="#E5E5E5"> couldn't run a deal</font>

800
00:32:22,290 --> 00:32:26,940
out or injected yellow<font color="#CCCCCC"> into a process</font>

801
00:32:24,330 --> 00:32:28,889
unless it was<font color="#E5E5E5"> signed by an appropriate</font>

802
00:32:26,940 --> 00:32:30,330
signing vendor and this would prevent

803
00:32:28,890 --> 00:32:32,400
you know a lot<font color="#CCCCCC"> of these attacks are</font>

804
00:32:30,330 --> 00:32:34,139
happening now state-sponsored you know

805
00:32:32,400 --> 00:32:36,570
would maybe have the money to buy<font color="#E5E5E5"> CA to</font>

806
00:32:34,140 --> 00:32:38,790
do this but you<font color="#E5E5E5"> know Joe Blow that wants</font>

807
00:32:36,570 --> 00:32:41,310
to infect you with ransomware won't have

808
00:32:38,790 --> 00:32:42,330
the money to do that we can also disable

809
00:32:41,310 --> 00:32:43,800
loading<font color="#CCCCCC"> dll's from non-program</font>

810
00:32:42,330 --> 00:32:45,990
directories<font color="#E5E5E5"> I think that's the</font><font color="#CCCCCC"> most</font>

811
00:32:43,800 --> 00:32:49,050
important one I loaded this dll from 10

812
00:32:45,990 --> 00:32:50,880
I don't see a real<font color="#E5E5E5"> reason</font><font color="#CCCCCC"> to load dll's</font>

813
00:32:49,050 --> 00:32:52,530
from temp ever there's no real<font color="#CCCCCC"> reason to</font>

814
00:32:50,880 --> 00:32:53,030
do that and<font color="#E5E5E5"> if you do</font><font color="#CCCCCC"> it's kind of bat</font>

815
00:32:52,530 --> 00:32:56,000
program

816
00:32:53,030 --> 00:32:58,399
d la should only be loaded from see

817
00:32:56,000 --> 00:33:01,190
windows system32<font color="#E5E5E5"> or CSIS while 64 or</font>

818
00:32:58,400 --> 00:33:03,230
<font color="#E5E5E5">windows just while 64 or the Program</font>

819
00:33:01,190 --> 00:33:05,300
Files records that's it shouldn't be

820
00:33:03,230 --> 00:33:07,250
loading from your tent file from your

821
00:33:05,300 --> 00:33:08,570
app data roaming it should<font color="#E5E5E5"> just be</font>

822
00:33:07,250 --> 00:33:10,970
loaded from those directories and

823
00:33:08,570 --> 00:33:13,280
prevent some like this because we'd also

824
00:33:10,970 --> 00:33:15,590
we don't<font color="#E5E5E5"> need admin access to run this</font>

825
00:33:13,280 --> 00:33:18,379
exploit in order for us to be able<font color="#E5E5E5"> to</font>

826
00:33:15,590 --> 00:33:20,780
drop a dll into windows system32 we need

827
00:33:18,380 --> 00:33:22,220
<font color="#E5E5E5">the admin rights so at least would you</font>

828
00:33:20,780 --> 00:33:24,740
know control our surface area just<font color="#E5E5E5"> a</font>

829
00:33:22,220 --> 00:33:26,240
little bit that way unless we happen to

830
00:33:24,740 --> 00:33:28,790
find administrator not granted that's

831
00:33:26,240 --> 00:33:30,230
even worse but it would<font color="#E5E5E5"> lower the normal</font>

832
00:33:28,790 --> 00:33:33,200
users from being<font color="#E5E5E5"> able to be excellent</font>

833
00:33:30,230 --> 00:33:35,990
about<font color="#E5E5E5"> it second or the last one really</font>

834
00:33:33,200 --> 00:33:37,340
<font color="#E5E5E5">is a big one as well run run gala</font><font color="#CCCCCC"> 32</font>

835
00:33:35,990 --> 00:33:39,950
specify that the allows the running

836
00:33:37,340 --> 00:33:42,230
application this one is kind of<font color="#E5E5E5"> big if</font>

837
00:33:39,950 --> 00:33:44,030
you ever open up windows 7 and<font color="#E5E5E5"> you open</font>

838
00:33:42,230 --> 00:33:46,100
up a photo in windows photo viewer it

839
00:33:44,030 --> 00:33:47,750
says run dll 32 it doesn't actually<font color="#E5E5E5"> say</font>

840
00:33:46,100 --> 00:33:50,060
windows photo viewer<font color="#E5E5E5"> because windows</font>

841
00:33:47,750 --> 00:33:52,340
photo viewer is a dll it's not a actual

842
00:33:50,060 --> 00:33:55,550
program and that's kind of one of<font color="#E5E5E5"> the</font>

843
00:33:52,340 --> 00:33:57,199
problems is that when you run a dll you

844
00:33:55,550 --> 00:33:59,750
only see<font color="#E5E5E5"> your on dl l 32 you don't see</font>

845
00:33:57,200 --> 00:34:01,070
the program that's behind it or the dll

846
00:33:59,750 --> 00:34:04,160
that's behind it really controlling the

847
00:34:01,070 --> 00:34:08,230
show so if we had it run dll so that way

848
00:34:04,160 --> 00:34:12,020
it says<font color="#CCCCCC"> i don't</font><font color="#E5E5E5"> know temp dll or dll</font>

849
00:34:08,230 --> 00:34:13,880
1579 dll is running and you be<font color="#E5E5E5"> like</font><font color="#CCCCCC"> okay</font>

850
00:34:12,020 --> 00:34:15,710
that's<font color="#E5E5E5"> kind of</font><font color="#CCCCCC"> weird that's a weird name</font>

851
00:34:13,880 --> 00:34:18,260
for yellow that shouldn't be running or

852
00:34:15,710 --> 00:34:20,210
if you have like shell32.dll is running

853
00:34:18,260 --> 00:34:21,560
then maybe you know you can see kind<font color="#E5E5E5"> of</font>

854
00:34:20,210 --> 00:34:24,139
what's running on your computer instead

855
00:34:21,560 --> 00:34:25,790
of just five processes of run dll 32

856
00:34:24,139 --> 00:34:31,399
running and you not knowing what's

857
00:34:25,790 --> 00:34:34,070
actually there lastly once i finish this

858
00:34:31,399 --> 00:34:36,350
<font color="#CCCCCC">i'm going</font><font color="#E5E5E5"> to post</font><font color="#CCCCCC"> the code to github</font>

859
00:34:34,070 --> 00:34:38,120
it's it says currently but<font color="#E5E5E5"> I don't have</font>

860
00:34:36,350 --> 00:34:39,949
<font color="#E5E5E5">the chance right this moment to post it</font>

861
00:34:38,120 --> 00:34:42,380
<font color="#E5E5E5">but once I will I post the Python code I</font>

862
00:34:39,949 --> 00:34:43,969
don't post the C code<font color="#E5E5E5"> I'm removing the</font>

863
00:34:42,380 --> 00:34:46,429
<font color="#E5E5E5">shell code on it just to prevent myself</font>

864
00:34:43,969 --> 00:34:49,310
from liability but feel free<font color="#E5E5E5"> to put your</font>

865
00:34:46,429 --> 00:34:50,780
<font color="#E5E5E5">own shell code in it I don't care you</font>

866
00:34:49,310 --> 00:34:54,168
can also get<font color="#E5E5E5"> more information to</font><font color="#CCCCCC"> cut my</font>

867
00:34:50,780 --> 00:34:57,050
links at the<font color="#E5E5E5"> link right</font><font color="#CCCCCC"> there IDF La eme</font>

868
00:34:54,168 --> 00:34:59,270
<font color="#E5E5E5">/ iy m it'll take it to a page that has</font>

869
00:34:57,050 --> 00:35:02,680
a link to github and the links<font color="#CCCCCC"> that i</font>

870
00:34:59,270 --> 00:35:02,680
put in<font color="#E5E5E5"> previously on the other slides</font>

871
00:35:02,800 --> 00:35:06,520
and actually I've read a little bit fast

872
00:35:04,930 --> 00:35:15,609
so does anybody have any questions I

873
00:35:06,520 --> 00:35:17,500
know it's kind of a lot good now i'm

874
00:35:15,610 --> 00:35:19,150
using pi<font color="#E5E5E5"> txc I mean I</font><font color="#CCCCCC"> don't know what</font>

875
00:35:17,500 --> 00:35:26,500
that person was using I mean I thought

876
00:35:19,150 --> 00:35:31,030
<font color="#E5E5E5">it was</font><font color="#CCCCCC"> really fun it's</font><font color="#E5E5E5"> uh but yeah oh</font>

877
00:35:26,500 --> 00:35:32,920
you can't do that that's a good<font color="#E5E5E5"> idea</font>

878
00:35:31,030 --> 00:35:35,470
<font color="#E5E5E5">okay I didn't know that thank you off</font>

879
00:35:32,920 --> 00:35:42,220
the off the talk to you after write that

880
00:35:35,470 --> 00:35:50,080
down any other questions good

881
00:35:42,220 --> 00:35:53,589
yeah I mean I could but I don't want to

882
00:35:50,080 --> 00:35:55,750
you know yeah I<font color="#E5E5E5"> mean basically a great</font>

883
00:35:53,590 --> 00:35:59,140
number of AV products and I've tested

884
00:35:55,750 --> 00:36:00,640
have not picked this up so you know<font color="#E5E5E5"> I</font>

885
00:35:59,140 --> 00:36:01,900
mean there's antivirus products I don't

886
00:36:00,640 --> 00:36:03,759
even know this<font color="#E5E5E5"> probably ones like in not</font>

887
00:36:01,900 --> 00:36:05,980
even in English just like there's<font color="#E5E5E5"> like</font>

888
00:36:03,760 --> 00:36:07,150
fifty thousand browser so there I mean

889
00:36:05,980 --> 00:36:08,800
<font color="#E5E5E5">the maybe one that picks it up but</font>

890
00:36:07,150 --> 00:36:19,060
everything I've tested the average

891
00:36:08,800 --> 00:36:20,349
nothing so any other questions yeah it's

892
00:36:19,060 --> 00:36:28,180
a<font color="#CCCCCC"> windows only tool it's I think it's</font>

893
00:36:20,349 --> 00:36:29,770
made by fire I yeah and<font color="#CCCCCC"> a questions cool</font>

894
00:36:28,180 --> 00:36:32,129
<font color="#E5E5E5">appreciate you guys for listening thank</font>

895
00:36:29,770 --> 00:36:32,130
you very much

