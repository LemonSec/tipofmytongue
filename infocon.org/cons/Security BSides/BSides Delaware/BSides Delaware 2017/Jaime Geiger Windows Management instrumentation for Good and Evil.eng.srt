1
00:00:12,290 --> 00:00:17,599
<font color="#CCCCCC">all</font><font color="#E5E5E5"> right well I'm gonna</font><font color="#CCCCCC"> get started</font>

2
00:00:15,400 --> 00:00:19,400
<font color="#E5E5E5">thank you everybody for</font><font color="#CCCCCC"> coming</font>

3
00:00:17,600 --> 00:00:20,869
this talk is<font color="#CCCCCC"> on windows management</font>

4
00:00:19,400 --> 00:00:22,820
instrumentation if you're not here<font color="#CCCCCC"> for</font>

5
00:00:20,869 --> 00:00:24,590
this talk<font color="#E5E5E5"> then I won't be offended if</font>

6
00:00:22,820 --> 00:00:27,820
<font color="#CCCCCC">you get up and go but I hope you are</font>

7
00:00:24,590 --> 00:00:27,820
here<font color="#CCCCCC"> for this talk so thanks for coming</font>

8
00:00:27,830 --> 00:00:30,589
so if you're gonna take<font color="#E5E5E5"> a picture one</font>

9
00:00:29,420 --> 00:00:32,150
slide actually<font color="#E5E5E5"> take a picture of this</font>

10
00:00:30,590 --> 00:00:33,230
<font color="#E5E5E5">one cuz this is actually where the link</font>

11
00:00:32,150 --> 00:00:35,030
to the<font color="#E5E5E5"> slides so</font><font color="#CCCCCC"> if you want these</font>

12
00:00:33,230 --> 00:00:37,040
slides for<font color="#E5E5E5"> later</font><font color="#CCCCCC"> I'll let you guys take</font>

13
00:00:35,030 --> 00:00:38,330
<font color="#CCCCCC">a picture</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> that real</font><font color="#E5E5E5"> quick these</font>

14
00:00:37,040 --> 00:00:40,250
<font color="#E5E5E5">slides</font><font color="#CCCCCC"> are gonna</font><font color="#E5E5E5"> be posted with the</font>

15
00:00:38,330 --> 00:00:41,660
video I hope<font color="#E5E5E5"> as well so if you find this</font>

16
00:00:40,250 --> 00:00:42,170
on<font color="#CCCCCC"> YouTube you'll be able to get to the</font>

17
00:00:41,660 --> 00:00:44,300
slides

18
00:00:42,170 --> 00:00:47,239
I'll keep it up it has<font color="#CCCCCC"> a</font><font color="#E5E5E5"> couple videos</font>

19
00:00:44,300 --> 00:00:48,470
in it embedded<font color="#E5E5E5"> for the demos but I'll be</font>

20
00:00:47,239 --> 00:00:51,400
trying<font color="#E5E5E5"> to do some of those demos live</font>

21
00:00:48,470 --> 00:00:51,400
and I'll be showing<font color="#E5E5E5"> some of them</font>

22
00:00:51,560 --> 00:00:58,530
so our<font color="#E5E5E5"> agenda for</font><font color="#CCCCCC"> this talk how quick</font>

23
00:00:54,960 --> 00:01:00,020
hello world about<font color="#CCCCCC"> WMI</font><font color="#E5E5E5"> using it for evil</font>

24
00:00:58,530 --> 00:01:04,019
<font color="#E5E5E5">and then using</font><font color="#CCCCCC"> it for good</font>

25
00:01:00,020 --> 00:01:05,370
so hello world hi<font color="#E5E5E5"> I'm Jamie</font><font color="#CCCCCC"> or root</font>

26
00:01:04,019 --> 00:01:06,210
hopefully with<font color="#E5E5E5"> that with a prompt like</font>

27
00:01:05,370 --> 00:01:09,600
<font color="#E5E5E5">that</font>

28
00:01:06,210 --> 00:01:12,240
I am jgeiger I'm on Twitter<font color="#CCCCCC"> I tweet</font>

29
00:01:09,600 --> 00:01:15,210
<font color="#CCCCCC">about things follow me if you like</font>

30
00:01:12,240 --> 00:01:17,850
one<font color="#E5E5E5"> boat I n as my website I blog about</font>

31
00:01:15,210 --> 00:01:19,770
computer<font color="#CCCCCC"> stuff</font><font color="#E5E5E5"> security things to said</font>

32
00:01:17,850 --> 00:01:21,720
<font color="#CCCCCC">men cool tricks I haven't found anywhere</font>

33
00:01:19,770 --> 00:01:23,280
else<font color="#CCCCCC"> that I had to dig through I'm an IT</font>

34
00:01:21,720 --> 00:01:24,600
manager<font color="#E5E5E5"> for my company and I also do</font>

35
00:01:23,280 --> 00:01:26,190
some<font color="#CCCCCC"> security work</font><font color="#E5E5E5"> and development as</font>

36
00:01:24,600 --> 00:01:27,210
well<font color="#CCCCCC"> I love</font><font color="#E5E5E5"> teaching and that's</font><font color="#CCCCCC"> why</font><font color="#E5E5E5"> I</font>

37
00:01:26,190 --> 00:01:29,729
love speaking at these kinds of things

38
00:01:27,210 --> 00:01:32,210
<font color="#E5E5E5">there's gonna be only spongebob gifts</font><font color="#CCCCCC"> in</font>

39
00:01:29,729 --> 00:01:32,210
<font color="#E5E5E5">this by</font><font color="#CCCCCC"> the way</font>

40
00:01:32,490 --> 00:01:36,810
so who are<font color="#CCCCCC"> you</font><font color="#E5E5E5"> guys so I'm gonna do a</font>

41
00:01:34,260 --> 00:01:38,159
<font color="#E5E5E5">couple raise your hands in this how</font><font color="#CCCCCC"> many</font>

42
00:01:36,810 --> 00:01:40,770
<font color="#E5E5E5">people do we</font><font color="#CCCCCC"> have that</font><font color="#E5E5E5"> a herd of</font><font color="#CCCCCC"> WMI</font>

43
00:01:38,159 --> 00:01:42,300
before<font color="#CCCCCC"> know what it is have you have you</font>

44
00:01:40,770 --> 00:01:43,470
used it<font color="#E5E5E5"> in an engagement in a red team</font>

45
00:01:42,300 --> 00:01:45,179
engagement<font color="#E5E5E5"> okay</font>

46
00:01:43,470 --> 00:01:47,700
have<font color="#E5E5E5"> used it in a blue team sense or in</font>

47
00:01:45,180 --> 00:01:50,310
defense<font color="#E5E5E5"> okay cool</font>

48
00:01:47,700 --> 00:01:52,409
I need power shell programmers

49
00:01:50,310 --> 00:01:54,570
couple<font color="#CCCCCC"> alright so there's gonna be</font><font color="#E5E5E5"> a lot</font>

50
00:01:52,409 --> 00:01:55,950
of<font color="#E5E5E5"> PowerShell stuff</font><font color="#CCCCCC"> we're gonna go</font>

51
00:01:54,570 --> 00:01:58,100
through<font color="#CCCCCC"> that I'll step through it if you</font>

52
00:01:55,950 --> 00:02:02,039
have questions<font color="#CCCCCC"> or I'm talking</font><font color="#E5E5E5"> too fast</font>

53
00:01:58,100 --> 00:02:03,809
<font color="#CCCCCC">please</font><font color="#E5E5E5"> tell me because that's we're all</font>

54
00:02:02,039 --> 00:02:04,890
here to<font color="#CCCCCC"> learn</font><font color="#E5E5E5"> if you have a question I</font>

55
00:02:03,810 --> 00:02:07,500
guarantee you<font color="#E5E5E5"> someone else in the room</font>

56
00:02:04,890 --> 00:02:08,519
has<font color="#E5E5E5"> that</font><font color="#CCCCCC"> question please ask or find me</font>

57
00:02:07,500 --> 00:02:10,410
afterwards if<font color="#CCCCCC"> you</font><font color="#E5E5E5"> don't feel</font><font color="#CCCCCC"> comfortable</font>

58
00:02:08,519 --> 00:02:14,730
that's totally fine

59
00:02:10,410 --> 00:02:16,049
<font color="#E5E5E5">what is this WMI thing well stands</font><font color="#CCCCCC"> for</font>

60
00:02:14,730 --> 00:02:18,299
windows management instrumentation like

61
00:02:16,050 --> 00:02:20,280
you saw<font color="#E5E5E5"> in the first slide and</font><font color="#CCCCCC"> it's</font>

62
00:02:18,300 --> 00:02:22,710
based on this<font color="#CCCCCC"> web-based enterprise</font>

63
00:02:20,280 --> 00:02:24,780
management<font color="#E5E5E5"> standard it's a big standard</font>

64
00:02:22,710 --> 00:02:29,220
that was put out<font color="#E5E5E5"> by a group for IT</font>

65
00:02:24,780 --> 00:02:31,100
management<font color="#E5E5E5"> for data</font><font color="#CCCCCC"> collection which is</font>

66
00:02:29,220 --> 00:02:33,120
awesome<font color="#CCCCCC"> so we'll learn more about that</font>

67
00:02:31,100 --> 00:02:35,700
<font color="#CCCCCC">it's based on</font><font color="#E5E5E5"> this common information</font>

68
00:02:33,120 --> 00:02:37,170
model which is an object-oriented model

69
00:02:35,700 --> 00:02:38,339
how many<font color="#E5E5E5"> uh you know have any program</font>

70
00:02:37,170 --> 00:02:39,780
<font color="#E5E5E5">object-oriented programmers in here</font><font color="#CCCCCC"> do</font>

71
00:02:38,340 --> 00:02:42,360
any Java programmers or anybody<font color="#CCCCCC"> like</font>

72
00:02:39,780 --> 00:02:44,190
that C++<font color="#CCCCCC"> okay</font><font color="#E5E5E5"> so I'll go</font><font color="#CCCCCC"> through what</font>

73
00:02:42,360 --> 00:02:45,870
<font color="#E5E5E5">object-oriented means those of you who</font>

74
00:02:44,190 --> 00:02:47,730
are not programmers<font color="#E5E5E5"> in the next couple</font>

75
00:02:45,870 --> 00:02:51,090
<font color="#CCCCCC">slides but will</font><font color="#E5E5E5"> learn about this</font><font color="#CCCCCC"> CI M</font>

76
00:02:47,730 --> 00:02:53,280
thing what is<font color="#E5E5E5"> WI basically it's an</font>

77
00:02:51,090 --> 00:02:55,650
interface to interact<font color="#E5E5E5"> with objects on</font>

78
00:02:53,280 --> 00:02:57,300
<font color="#CCCCCC">Windows and the really important bullet</font>

79
00:02:55,650 --> 00:02:58,680
<font color="#E5E5E5">at the bottom there is it's available on</font>

80
00:02:57,300 --> 00:03:00,750
every version<font color="#E5E5E5"> of Windows since</font><font color="#CCCCCC"> Windows</font>

81
00:02:58,680 --> 00:03:03,360
2000 so it makes it<font color="#E5E5E5"> a</font><font color="#CCCCCC"> very powerful tool</font>

82
00:03:00,750 --> 00:03:05,370
<font color="#E5E5E5">to go all the way up from Windows 2000</font>

83
00:03:03,360 --> 00:03:08,790
which you should not be<font color="#E5E5E5"> running to</font>

84
00:03:05,370 --> 00:03:11,670
current Windows Server 2016 or Windows

85
00:03:08,790 --> 00:03:12,780
10 and it's<font color="#E5E5E5"> remotely accessible which is</font>

86
00:03:11,670 --> 00:03:13,950
really<font color="#CCCCCC"> awesome</font><font color="#E5E5E5"> when</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> learn some of</font>

87
00:03:12,780 --> 00:03:15,390
the<font color="#E5E5E5"> things you can do with it</font><font color="#CCCCCC"> you'll</font>

88
00:03:13,950 --> 00:03:17,160
learn<font color="#CCCCCC"> that it being remotely accessible</font>

89
00:03:15,390 --> 00:03:18,809
<font color="#CCCCCC">it might not necessarily</font><font color="#E5E5E5"> be</font><font color="#CCCCCC"> the best</font>

90
00:03:17,160 --> 00:03:20,170
<font color="#E5E5E5">thing or it's great if you're on the red</font>

91
00:03:18,810 --> 00:03:22,450
<font color="#E5E5E5">team</font>

92
00:03:20,170 --> 00:03:25,299
so what is this common information model

93
00:03:22,450 --> 00:03:27,220
it's basically a model it's a standard

94
00:03:25,300 --> 00:03:29,650
the document is very long I've read some

95
00:03:27,220 --> 00:03:33,640
of it<font color="#E5E5E5"> it's very dry but it breaks</font><font color="#CCCCCC"> down</font>

96
00:03:29,650 --> 00:03:36,430
into defining<font color="#E5E5E5"> how to represent anything</font>

97
00:03:33,640 --> 00:03:39,720
within a computer<font color="#E5E5E5"> system and so</font><font color="#CCCCCC"> WMI is</font>

98
00:03:36,430 --> 00:03:42,040
<font color="#E5E5E5">like Microsoft's implementation of this</font>

99
00:03:39,720 --> 00:03:43,300
<font color="#E5E5E5">web-based standard in the common</font>

100
00:03:42,040 --> 00:03:45,880
information model we're<font color="#CCCCCC"> gonna go through</font>

101
00:03:43,300 --> 00:03:47,380
so the components you have<font color="#E5E5E5"> which I'm</font>

102
00:03:45,880 --> 00:03:49,000
<font color="#E5E5E5">going to go through</font><font color="#CCCCCC"> each one of them our</font>

103
00:03:47,380 --> 00:03:50,890
namespaces classes instances properties

104
00:03:49,000 --> 00:03:52,510
methods<font color="#E5E5E5"> events and event consumers so I</font>

105
00:03:50,890 --> 00:03:55,200
have a<font color="#E5E5E5"> slide for each one of these so</font>

106
00:03:52,510 --> 00:03:55,200
we'll go<font color="#CCCCCC"> through</font><font color="#E5E5E5"> them now</font>

107
00:03:56,340 --> 00:04:02,629
a namespace<font color="#E5E5E5"> is a collection of classes</font>

108
00:04:00,260 --> 00:04:04,069
and you can have sub namespaces and<font color="#E5E5E5"> all</font>

109
00:04:02,629 --> 00:04:05,359
<font color="#E5E5E5">these things I'm gonna show this</font>

110
00:04:04,069 --> 00:04:07,599
visually at the end of the kind of

111
00:04:05,360 --> 00:04:09,230
explanation of this<font color="#CCCCCC"> so don't worry about</font>

112
00:04:07,599 --> 00:04:11,090
<font color="#E5E5E5">visualizing it in your head right now</font>

113
00:04:09,230 --> 00:04:14,000
<font color="#E5E5E5">they all exist under this thing called</font>

114
00:04:11,090 --> 00:04:16,579
<font color="#CCCCCC">root</font><font color="#E5E5E5"> so there's the</font><font color="#CCCCCC"> default namespace</font>

115
00:04:14,000 --> 00:04:19,519
which<font color="#E5E5E5"> is roots in v2</font><font color="#CCCCCC"> common information</font>

116
00:04:16,579 --> 00:04:20,570
model<font color="#CCCCCC"> too and then we have another</font><font color="#E5E5E5"> one</font>

117
00:04:19,519 --> 00:04:23,570
<font color="#CCCCCC">that we're gonna worry about</font><font color="#E5E5E5"> which is</font>

118
00:04:20,570 --> 00:04:26,020
root subscription so keep<font color="#E5E5E5"> that in the</font>

119
00:04:23,570 --> 00:04:26,020
back<font color="#E5E5E5"> of your head</font>

120
00:04:26,110 --> 00:04:29,879
like I said<font color="#CCCCCC"> these namespaces</font><font color="#E5E5E5"> are</font>

121
00:04:27,310 --> 00:04:32,680
<font color="#E5E5E5">collection of classes and classes are</font>

122
00:04:29,879 --> 00:04:35,050
basically the definitions of some type

123
00:04:32,680 --> 00:04:37,120
of<font color="#E5E5E5"> object</font><font color="#CCCCCC"> a perfect example is</font><font color="#E5E5E5"> a user</font>

124
00:04:35,050 --> 00:04:39,879
<font color="#E5E5E5">account on the machine</font><font color="#CCCCCC"> so you'll have</font><font color="#E5E5E5"> a</font>

125
00:04:37,120 --> 00:04:42,159
user<font color="#E5E5E5"> account class it'll have properties</font>

126
00:04:39,879 --> 00:04:46,060
which are key<font color="#CCCCCC"> value pairs so it'll</font><font color="#E5E5E5"> have</font>

127
00:04:42,159 --> 00:04:49,060
a account name<font color="#E5E5E5"> or a user ID</font><font color="#CCCCCC"> or an</font><font color="#E5E5E5"> S ID</font>

128
00:04:46,060 --> 00:04:52,479
<font color="#E5E5E5">and then a value to</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> the values</font>

129
00:04:49,060 --> 00:04:54,580
actually<font color="#E5E5E5"> are put</font><font color="#CCCCCC"> into instances</font><font color="#E5E5E5"> so you</font>

130
00:04:52,479 --> 00:04:56,650
say<font color="#E5E5E5"> here I have these properties</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> I</font>

131
00:04:54,580 --> 00:04:59,080
can fill out<font color="#E5E5E5"> I'll create an instance</font><font color="#CCCCCC"> of</font>

132
00:04:56,650 --> 00:05:01,688
this class<font color="#E5E5E5"> and</font><font color="#CCCCCC"> that is administrator</font>

133
00:04:59,080 --> 00:05:03,789
with the<font color="#CCCCCC"> S ID</font><font color="#E5E5E5"> whatever and their home</font>

134
00:05:01,689 --> 00:05:06,879
directory or whatever kind<font color="#E5E5E5"> of attributes</font>

135
00:05:03,789 --> 00:05:08,620
that<font color="#E5E5E5"> class has it can have methods which</font>

136
00:05:06,879 --> 00:05:11,110
is also<font color="#E5E5E5"> cool so the one that I'm going</font>

137
00:05:08,620 --> 00:05:13,270
<font color="#CCCCCC">to be talking about a lot is win32</font>

138
00:05:11,110 --> 00:05:15,370
process which is a class that represents

139
00:05:13,270 --> 00:05:18,938
<font color="#E5E5E5">every process on the system but I can</font>

140
00:05:15,370 --> 00:05:20,979
query<font color="#E5E5E5"> this</font><font color="#CCCCCC"> WMI interface for processes</font>

141
00:05:18,939 --> 00:05:23,500
on the<font color="#CCCCCC"> system so as process ID</font><font color="#E5E5E5"> process</font>

142
00:05:20,979 --> 00:05:25,360
name<font color="#CCCCCC"> who</font><font color="#E5E5E5"> it's running as and it also has</font>

143
00:05:23,500 --> 00:05:27,580
methods<font color="#E5E5E5"> like create or terminate and</font>

144
00:05:25,360 --> 00:05:29,770
create as a great<font color="#E5E5E5"> method for attackers</font>

145
00:05:27,580 --> 00:05:33,180
<font color="#CCCCCC">we'll get it</font><font color="#E5E5E5"> out later many of</font><font color="#CCCCCC"> these</font>

146
00:05:29,770 --> 00:05:33,180
properties<font color="#E5E5E5"> can be strings integers</font>

147
00:05:34,950 --> 00:05:39,300
<font color="#CCCCCC">how do</font><font color="#E5E5E5"> we talk to</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> thing it's</font>

148
00:05:36,870 --> 00:05:42,270
basically a database<font color="#CCCCCC"> of</font><font color="#E5E5E5"> information that</font>

149
00:05:39,300 --> 00:05:43,830
we<font color="#E5E5E5"> have and then we</font><font color="#CCCCCC"> can act on</font><font color="#E5E5E5"> so if you</font>

150
00:05:42,270 --> 00:05:46,260
<font color="#CCCCCC">guys how many sequel how many people</font>

151
00:05:43,830 --> 00:05:48,359
have done sequel before<font color="#CCCCCC"> eco queries okay</font>

152
00:05:46,260 --> 00:05:51,330
so for<font color="#E5E5E5"> those familiar with it this will</font>

153
00:05:48,360 --> 00:05:53,690
look<font color="#CCCCCC"> familiar if you're not it's fairly</font>

154
00:05:51,330 --> 00:05:56,969
easy<font color="#E5E5E5"> to follow so you're selecting from</font>

155
00:05:53,690 --> 00:05:59,640
the table or the object to type the

156
00:05:56,970 --> 00:06:01,920
class win32 user account<font color="#CCCCCC"> we're disabled</font>

157
00:05:59,640 --> 00:06:03,510
equals false<font color="#E5E5E5"> so you're looking for</font><font color="#CCCCCC"> all</font>

158
00:06:01,920 --> 00:06:04,680
<font color="#CCCCCC">of the enabled user accounts</font><font color="#E5E5E5"> this query</font>

159
00:06:03,510 --> 00:06:06,840
is going<font color="#CCCCCC"> to return you a bunch of</font>

160
00:06:04,680 --> 00:06:08,440
objects<font color="#CCCCCC"> that are all the enabled user</font>

161
00:06:06,840 --> 00:06:10,060
accounts on the system

162
00:06:08,440 --> 00:06:12,100
<font color="#E5E5E5">what can we</font><font color="#CCCCCC"> use to interface with</font><font color="#E5E5E5"> this</font>

163
00:06:10,060 --> 00:06:14,800
<font color="#E5E5E5">well a couple different</font><font color="#CCCCCC"> things</font><font color="#E5E5E5"> there's a</font>

164
00:06:12,100 --> 00:06:17,080
<font color="#CCCCCC">command-line</font><font color="#E5E5E5"> tool called wmic</font><font color="#CCCCCC"> that can</font>

165
00:06:14,800 --> 00:06:19,210
be used<font color="#CCCCCC"> I think it exists on Windows</font>

166
00:06:17,080 --> 00:06:20,919
2000<font color="#CCCCCC"> and we can</font><font color="#E5E5E5"> correct me if I'm</font><font color="#CCCCCC"> wrong</font>

167
00:06:19,210 --> 00:06:22,479
on<font color="#CCCCCC"> that one</font><font color="#E5E5E5"> but this one is is the most</font>

168
00:06:20,920 --> 00:06:26,380
<font color="#E5E5E5">reliable tool</font><font color="#CCCCCC"> because it's on most</font>

169
00:06:22,480 --> 00:06:28,420
<font color="#CCCCCC">platforms WMI</font><font color="#E5E5E5"> Explorer which is a front</font>

170
00:06:26,380 --> 00:06:31,270
<font color="#CCCCCC">end which I have a demo of</font><font color="#E5E5E5"> the next</font>

171
00:06:28,420 --> 00:06:32,650
slide<font color="#E5E5E5"> so you guys can kind of see how</font>

172
00:06:31,270 --> 00:06:34,690
our shell which would be focusing on to

173
00:06:32,650 --> 00:06:37,030
create and<font color="#CCCCCC"> access classes later in the</font>

174
00:06:34,690 --> 00:06:40,270
presentation<font color="#CCCCCC"> you can access it</font><font color="#E5E5E5"> from the</font>

175
00:06:37,030 --> 00:06:43,090
windows<font color="#E5E5E5"> API</font><font color="#CCCCCC"> programming c-sharp C++ C</font>

176
00:06:40,270 --> 00:06:44,169
and then there's tons of<font color="#E5E5E5"> other interface</font>

177
00:06:43,090 --> 00:06:47,260
to<font color="#E5E5E5"> this like I said</font><font color="#CCCCCC"> this has been around</font>

178
00:06:44,170 --> 00:06:48,520
<font color="#E5E5E5">for so long but it's adapt been adapted</font>

179
00:06:47,260 --> 00:06:49,840
<font color="#CCCCCC">to so many</font><font color="#E5E5E5"> different</font><font color="#CCCCCC"> languages those are</font>

180
00:06:48,520 --> 00:06:52,799
just<font color="#E5E5E5"> three that I looked up there's tons</font>

181
00:06:49,840 --> 00:06:52,799
<font color="#E5E5E5">more that actually has</font>

182
00:06:55,550 --> 00:07:01,760
<font color="#CCCCCC">this</font><font color="#E5E5E5"> WMI</font><font color="#CCCCCC"> explorer demo</font><font color="#E5E5E5"> that'll talk</font>

183
00:06:57,650 --> 00:07:03,409
through real quick<font color="#CCCCCC"> I'll</font><font color="#E5E5E5"> explain what</font>

184
00:07:01,760 --> 00:07:05,510
what it's<font color="#CCCCCC"> actually showing so you don't</font>

185
00:07:03,410 --> 00:07:06,860
have<font color="#E5E5E5"> to squint so you're going you go</font>

186
00:07:05,510 --> 00:07:08,870
under the root<font color="#E5E5E5"> namespace this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> roots</font>

187
00:07:06,860 --> 00:07:10,880
in<font color="#E5E5E5"> b2 and you can see there's all of</font>

188
00:07:08,870 --> 00:07:15,380
these different<font color="#CCCCCC"> classes so win32 account</font>

189
00:07:10,880 --> 00:07:17,900
when<font color="#E5E5E5"> 32s ID</font><font color="#CCCCCC"> win32 process win32 binary</font>

190
00:07:15,380 --> 00:07:19,900
<font color="#CCCCCC">all this stuff so all this is each one</font>

191
00:07:17,900 --> 00:07:23,560
<font color="#CCCCCC">of</font><font color="#E5E5E5"> these is a class that you can query</font>

192
00:07:19,900 --> 00:07:25,580
so current time it has information on

193
00:07:23,560 --> 00:07:27,020
number of<font color="#E5E5E5"> fans that are connected this</font>

194
00:07:25,580 --> 00:07:28,609
<font color="#E5E5E5">is an AWS machine so there's no fans</font>

195
00:07:27,020 --> 00:07:31,099
<font color="#CCCCCC">connected directly</font><font color="#E5E5E5"> to this virtual</font>

196
00:07:28,610 --> 00:07:33,110
machine<font color="#CCCCCC"> but the user groups</font><font color="#E5E5E5"> this is</font><font color="#CCCCCC"> a</font>

197
00:07:31,100 --> 00:07:34,760
<font color="#E5E5E5">specific example the one that kind of is</font>

198
00:07:33,110 --> 00:07:36,110
more understandable<font color="#E5E5E5"> this is user groups</font>

199
00:07:34,760 --> 00:07:39,230
this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> the administrator group</font><font color="#E5E5E5"> and you</font>

200
00:07:36,110 --> 00:07:42,410
can<font color="#CCCCCC"> see all of the information that this</font>

201
00:07:39,230 --> 00:07:46,070
offers so like I said<font color="#E5E5E5"> this says domain</font>

202
00:07:42,410 --> 00:07:48,050
name description s ID so<font color="#E5E5E5"> yeah zoomed in</font>

203
00:07:46,070 --> 00:07:50,750
<font color="#CCCCCC">here for you</font>

204
00:07:48,050 --> 00:07:53,030
so you can see that the<font color="#E5E5E5"> group is the</font>

205
00:07:50,750 --> 00:07:54,379
name is<font color="#E5E5E5"> administrator</font><font color="#CCCCCC"> ASID</font><font color="#E5E5E5"> the local</font>

206
00:07:53,030 --> 00:07:56,448
account<font color="#E5E5E5"> or whether it's local account or</font>

207
00:07:54,379 --> 00:07:57,800
<font color="#E5E5E5">not so it has a ton of information so</font>

208
00:07:56,449 --> 00:07:59,539
<font color="#E5E5E5">this is just one of those many</font><font color="#CCCCCC"> things</font>

209
00:07:57,800 --> 00:08:01,009
and<font color="#E5E5E5"> you saw how long that list was huge</font>

210
00:07:59,539 --> 00:08:02,950
<font color="#CCCCCC">so there's tons information career</font><font color="#E5E5E5"> from</font>

211
00:08:01,009 --> 00:08:04,900
this

212
00:08:02,950 --> 00:08:07,500
and like I<font color="#CCCCCC"> said these are inheritable so</font>

213
00:08:04,900 --> 00:08:13,870
this inherits from<font color="#E5E5E5"> the win32 account</font>

214
00:08:07,500 --> 00:08:16,060
group else<font color="#CCCCCC"> uh-oh I will skip over that</font>

215
00:08:13,870 --> 00:08:17,050
<font color="#E5E5E5">the rest of that one but like I</font><font color="#CCCCCC"> said</font>

216
00:08:16,060 --> 00:08:18,130
this is what<font color="#E5E5E5"> the interface looks</font><font color="#CCCCCC"> like</font>

217
00:08:17,050 --> 00:08:20,350
and<font color="#E5E5E5"> this allows you to run through and</font>

218
00:08:18,130 --> 00:08:22,630
query everything<font color="#CCCCCC"> you have your</font>

219
00:08:20,350 --> 00:08:24,990
namespaces in this panel you<font color="#CCCCCC"> can</font>

220
00:08:22,630 --> 00:08:27,400
enumerate<font color="#E5E5E5"> these are your classes and</font>

221
00:08:24,990 --> 00:08:30,670
then you'll actually<font color="#E5E5E5"> be able</font><font color="#CCCCCC"> to go and</font>

222
00:08:27,400 --> 00:08:33,159
view instances of classes<font color="#E5E5E5"> inside here</font>

223
00:08:30,670 --> 00:08:34,750
<font color="#E5E5E5">and</font><font color="#CCCCCC"> you can check out what properties</font>

224
00:08:33,159 --> 00:08:36,370
they<font color="#CCCCCC"> have like I said I don't expect you</font>

225
00:08:34,750 --> 00:08:37,870
<font color="#E5E5E5">guys to be able to squint and see this</font>

226
00:08:36,370 --> 00:08:39,340
<font color="#E5E5E5">but you</font><font color="#CCCCCC"> can see all the</font><font color="#E5E5E5"> properties they</font>

227
00:08:37,870 --> 00:08:41,280
<font color="#CCCCCC">have and what types they are</font><font color="#E5E5E5"> and you</font><font color="#CCCCCC"> can</font>

228
00:08:39,340 --> 00:08:45,790
also see all the<font color="#E5E5E5"> methods they have I</font>

229
00:08:41,280 --> 00:08:50,230
believe the<font color="#E5E5E5"> demo lays out the process</font>

230
00:08:45,790 --> 00:08:53,939
class<font color="#E5E5E5"> so you can see the methods create</font>

231
00:08:50,230 --> 00:08:53,940
and terminate of the process class

232
00:08:55,730 --> 00:09:01,460
<font color="#E5E5E5">okay</font>

233
00:08:57,750 --> 00:09:01,460
<font color="#E5E5E5">and so far what this thing is yes</font>

234
00:09:04,850 --> 00:09:09,579
<font color="#CCCCCC">I know it's just when 32</font>

235
00:09:09,980 --> 00:09:12,350
pretty sure<font color="#CCCCCC"> there's historical</font><font color="#E5E5E5"> reasons</font>

236
00:09:11,150 --> 00:09:13,730
for<font color="#E5E5E5"> that it's like probably one of their</font>

237
00:09:12,350 --> 00:09:15,530
last worries or<font color="#E5E5E5"> I just changing the date</font>

238
00:09:13,730 --> 00:09:18,910
like the database names but yeah that<font color="#E5E5E5"> is</font>

239
00:09:15,530 --> 00:09:18,910
true yep

240
00:09:20,480 --> 00:09:25,329
that<font color="#E5E5E5"> okay so yes sir</font>

241
00:09:30,860 --> 00:09:32,920
you

242
00:09:34,720 --> 00:09:38,200
you can look at the parent process<font color="#E5E5E5"> ID</font>

243
00:09:36,670 --> 00:09:39,670
<font color="#E5E5E5">but on</font><font color="#CCCCCC"> Windows</font><font color="#E5E5E5"> that's not really</font>

244
00:09:38,200 --> 00:09:41,620
<font color="#E5E5E5">reliable that our functions to actually</font>

245
00:09:39,670 --> 00:09:44,819
change the parent<font color="#CCCCCC"> process ID</font><font color="#E5E5E5"> look into</font>

246
00:09:41,620 --> 00:09:44,820
<font color="#E5E5E5">that if you haven't it's really cool</font>

247
00:09:45,520 --> 00:09:50,319
you<font color="#CCCCCC"> can absolutely</font><font color="#E5E5E5"> based on what the</font>

248
00:09:47,380 --> 00:09:52,570
<font color="#E5E5E5">system gives you for information</font><font color="#CCCCCC"> you can</font>

249
00:09:50,320 --> 00:09:54,580
you<font color="#E5E5E5"> can do your</font><font color="#CCCCCC"> best whatever the system</font>

250
00:09:52,570 --> 00:09:57,280
<font color="#E5E5E5">gives you like that's if you open task</font>

251
00:09:54,580 --> 00:09:58,690
manager<font color="#CCCCCC"> it'll have</font><font color="#E5E5E5"> the same list it's</font>

252
00:09:57,280 --> 00:09:59,860
the same<font color="#E5E5E5"> information so these are this</font>

253
00:09:58,690 --> 00:10:01,810
<font color="#CCCCCC">is like</font><font color="#E5E5E5"> an alternative is a great</font>

254
00:09:59,860 --> 00:10:04,710
alternative<font color="#E5E5E5"> API the query stuff with</font>

255
00:10:01,810 --> 00:10:08,699
that's common throughout<font color="#E5E5E5"> all</font><font color="#CCCCCC"> windows</font>

256
00:10:04,710 --> 00:10:08,700
<font color="#CCCCCC">bill to</font><font color="#E5E5E5"> Windows 2000</font>

257
00:10:11,910 --> 00:10:16,949
sure<font color="#E5E5E5"> about that one you might have</font><font color="#CCCCCC"> to</font>

258
00:10:13,610 --> 00:10:18,420
hook<font color="#E5E5E5"> something for that</font>

259
00:10:16,950 --> 00:10:20,610
there are tools<font color="#CCCCCC"> to do that and this</font><font color="#E5E5E5"> is</font>

260
00:10:18,420 --> 00:10:22,589
<font color="#E5E5E5">internal sweet so I'm gonna do a quick</font>

261
00:10:20,610 --> 00:10:24,210
overview<font color="#CCCCCC"> of the kind of what</font><font color="#E5E5E5"> this how to</font>

262
00:10:22,590 --> 00:10:26,070
interact<font color="#E5E5E5"> with this in PowerShell</font><font color="#CCCCCC"> some</font>

263
00:10:24,210 --> 00:10:27,120
one of these things doesn't<font color="#E5E5E5"> work on the</font>

264
00:10:26,070 --> 00:10:29,450
most recent version of PowerShell I

265
00:10:27,120 --> 00:10:32,460
tried but<font color="#E5E5E5"> just just</font><font color="#CCCCCC"> a heads up for</font><font color="#E5E5E5"> that</font>

266
00:10:29,450 --> 00:10:36,030
<font color="#E5E5E5">so your best friend at for examining</font>

267
00:10:32,460 --> 00:10:38,460
<font color="#E5E5E5">this is gonna be get</font><font color="#CCCCCC"> WMI object you can</font>

268
00:10:36,030 --> 00:10:41,189
specify the<font color="#CCCCCC"> namespace which is default</font>

269
00:10:38,460 --> 00:10:43,860
routes<font color="#E5E5E5"> in V to the class and then the</font>

270
00:10:41,190 --> 00:10:45,750
filter<font color="#E5E5E5"> to get objects these quick -</font>

271
00:10:43,860 --> 00:10:47,160
query and -<font color="#E5E5E5"> filter will not work for</font>

272
00:10:45,750 --> 00:10:52,070
<font color="#CCCCCC">some</font><font color="#E5E5E5"> reason it's broken in PowerShell</font>

273
00:10:47,160 --> 00:10:54,000
<font color="#E5E5E5">it's documented</font><font color="#CCCCCC"> online but you can</font><font color="#E5E5E5"> use</font>

274
00:10:52,070 --> 00:10:56,760
PowerShell filters which you'll see

275
00:10:54,000 --> 00:10:58,680
<font color="#E5E5E5">later to filter stuff out you can use</font><font color="#CCCCCC"> a</font>

276
00:10:56,760 --> 00:11:01,920
you can use<font color="#E5E5E5"> the list command to list the</font>

277
00:10:58,680 --> 00:11:03,420
classes in a<font color="#E5E5E5"> namespace</font><font color="#CCCCCC"> I want to see all</font>

278
00:11:01,920 --> 00:11:04,650
of them in<font color="#E5E5E5"> routes in B - and watch it</font>

279
00:11:03,420 --> 00:11:06,990
scrolled all the way down the<font color="#CCCCCC"> screen I'm</font>

280
00:11:04,650 --> 00:11:10,370
gonna get the<font color="#E5E5E5"> same result as this window</font>

281
00:11:06,990 --> 00:11:10,370
<font color="#E5E5E5">where I have classes</font><font color="#CCCCCC"> here</font>

282
00:11:10,500 --> 00:11:15,780
invoke<font color="#CCCCCC"> WMI method</font><font color="#E5E5E5"> so those those methods</font>

283
00:11:13,980 --> 00:11:18,600
<font color="#CCCCCC">we talked</font><font color="#E5E5E5"> about earlier where you can</font>

284
00:11:15,780 --> 00:11:23,520
maybe<font color="#CCCCCC"> create or terminate a process you</font>

285
00:11:18,600 --> 00:11:24,270
can do remotely or locally<font color="#CCCCCC"> you need</font>

286
00:11:23,520 --> 00:11:25,710
credentials<font color="#CCCCCC"> you need administrator</font>

287
00:11:24,270 --> 00:11:26,220
<font color="#CCCCCC">credentials so it's not just wide open</font>

288
00:11:25,710 --> 00:11:28,020
to<font color="#CCCCCC"> the world</font>

289
00:11:26,220 --> 00:11:29,430
but that's something<font color="#CCCCCC"> you can you can</font>

290
00:11:28,020 --> 00:11:31,199
<font color="#E5E5E5">play with and if you're not familiar</font>

291
00:11:29,430 --> 00:11:32,520
<font color="#E5E5E5">with</font><font color="#CCCCCC"> PowerShell</font><font color="#E5E5E5"> to get help with these</font>

292
00:11:31,200 --> 00:11:35,130
commands you just have help<font color="#E5E5E5"> and in the</font>

293
00:11:32,520 --> 00:11:37,380
command<font color="#E5E5E5"> so it's really really nice so</font>

294
00:11:35,130 --> 00:11:39,950
set<font color="#CCCCCC"> WMI instance</font><font color="#E5E5E5"> you can create</font><font color="#CCCCCC"> new</font>

295
00:11:37,380 --> 00:11:42,570
instances<font color="#E5E5E5"> of classes for certain things</font>

296
00:11:39,950 --> 00:11:43,950
<font color="#E5E5E5">one and such</font><font color="#CCCCCC"> we'll</font><font color="#E5E5E5"> talk about creating</font>

297
00:11:42,570 --> 00:11:45,430
classes<font color="#E5E5E5"> and actually do some of</font><font color="#CCCCCC"> that</font>

298
00:11:43,950 --> 00:11:47,830
later

299
00:11:45,430 --> 00:11:48,790
remove<font color="#CCCCCC"> WMI object</font><font color="#E5E5E5"> be careful with this</font>

300
00:11:47,830 --> 00:11:51,010
<font color="#CCCCCC">one you can actually</font><font color="#E5E5E5"> remove whole</font>

301
00:11:48,790 --> 00:11:52,390
classes and then mess up anything that's

302
00:11:51,010 --> 00:11:54,220
querying it so if you remove the win32

303
00:11:52,390 --> 00:11:55,449
process class<font color="#E5E5E5"> it's probably not good</font>

304
00:11:54,220 --> 00:11:58,680
because<font color="#E5E5E5"> anything looking for processes</font>

305
00:11:55,450 --> 00:11:58,680
will be<font color="#CCCCCC"> that yeah</font><font color="#E5E5E5"> was it</font>

306
00:12:02,170 --> 00:12:04,229
<font color="#CCCCCC">I</font>

307
00:12:04,990 --> 00:12:07,660
<font color="#E5E5E5">I'm not a hundred percent sure about</font>

308
00:12:06,399 --> 00:12:09,520
<font color="#E5E5E5">that</font><font color="#CCCCCC"> and that would</font><font color="#E5E5E5"> be good to look into</font>

309
00:12:07,660 --> 00:12:12,610
<font color="#CCCCCC">I don't I would hope that it wouldn't</font>

310
00:12:09,520 --> 00:12:15,390
delete them off file but

311
00:12:12,610 --> 00:12:17,400
<font color="#E5E5E5">Ranger things have happened</font><font color="#CCCCCC"> on Windows</font>

312
00:12:15,390 --> 00:12:19,319
<font color="#E5E5E5">registered</font><font color="#CCCCCC"> WMI event</font><font color="#E5E5E5"> you can</font><font color="#CCCCCC"> actually</font>

313
00:12:17,400 --> 00:12:21,840
register local events to monitor for in

314
00:12:19,320 --> 00:12:24,000
a local PowerShell console<font color="#E5E5E5"> there's a way</font>

315
00:12:21,840 --> 00:12:26,760
to do that persistently what we'll talk

316
00:12:24,000 --> 00:12:28,560
<font color="#CCCCCC">about later</font><font color="#E5E5E5"> and you can actually also</font>

317
00:12:26,760 --> 00:12:32,880
interface<font color="#CCCCCC"> with these common information</font>

318
00:12:28,560 --> 00:12:35,489
model objects directly<font color="#E5E5E5"> this is how you</font>

319
00:12:32,880 --> 00:12:36,990
would<font color="#E5E5E5"> interface with them remotely</font>

320
00:12:35,490 --> 00:12:39,300
you'll have to start up<font color="#E5E5E5"> a sim session</font>

321
00:12:36,990 --> 00:12:41,070
<font color="#CCCCCC">you can</font><font color="#E5E5E5"> do these this command get</font>

322
00:12:39,300 --> 00:12:42,569
command<font color="#E5E5E5"> - now</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> sim star and that will</font>

323
00:12:41,070 --> 00:12:43,620
eat you all the commands for sim<font color="#E5E5E5"> I'm not</font>

324
00:12:42,570 --> 00:12:44,700
gonna be talking<font color="#CCCCCC"> about those those</font>

325
00:12:43,620 --> 00:12:48,080
series of commands we're only going to

326
00:12:44,700 --> 00:12:48,080
<font color="#E5E5E5">need the ones up</font><font color="#CCCCCC"> here</font>

327
00:12:48,730 --> 00:12:56,119
<font color="#CCCCCC">a</font><font color="#E5E5E5"> basic powershell demo</font>

328
00:12:51,889 --> 00:12:58,220
<font color="#CCCCCC">this says get command</font><font color="#E5E5E5"> - noun</font><font color="#CCCCCC"> WMI star</font>

329
00:12:56,119 --> 00:12:59,480
<font color="#E5E5E5">and then you can see get to be my object</font>

330
00:12:58,220 --> 00:13:01,670
invoked of a method you can see that

331
00:12:59,480 --> 00:13:06,609
these commands exist<font color="#E5E5E5"> so we're gonna try</font>

332
00:13:01,670 --> 00:13:09,759
<font color="#CCCCCC">to query for</font><font color="#E5E5E5"> a class win32 process and</font>

333
00:13:06,609 --> 00:13:14,749
then we're going<font color="#E5E5E5"> to say question mark</font>

334
00:13:09,759 --> 00:13:16,160
property process name -<font color="#CCCCCC"> EQ PowerShell</font>

335
00:13:14,749 --> 00:13:17,239
that you see so we're gonna I'm<font color="#E5E5E5"> running</font>

336
00:13:16,160 --> 00:13:18,709
PowerShell I know that process<font color="#CCCCCC"> is</font>

337
00:13:17,239 --> 00:13:20,389
running so I'm just querying for

338
00:13:18,709 --> 00:13:22,118
<font color="#E5E5E5">PowerShell</font><font color="#CCCCCC"> that exe I'm sorry if this is</font>

339
00:13:20,389 --> 00:13:25,009
<font color="#CCCCCC">hard to see the lighting sort of weird</font>

340
00:13:22,119 --> 00:13:26,779
<font color="#E5E5E5">so you can see that this Scott returned</font>

341
00:13:25,009 --> 00:13:28,970
this object got returned<font color="#E5E5E5"> and it has a</font>

342
00:13:26,779 --> 00:13:30,319
process<font color="#E5E5E5"> name PowerShell</font><font color="#CCCCCC"> - exe and we can</font>

343
00:13:28,970 --> 00:13:30,980
interact<font color="#CCCCCC"> with that object</font><font color="#E5E5E5"> by setting it</font>

344
00:13:30,319 --> 00:13:33,108
<font color="#E5E5E5">to a variable</font>

345
00:13:30,980 --> 00:13:35,119
this becomes a PowerShell object<font color="#E5E5E5"> so</font>

346
00:13:33,109 --> 00:13:36,439
we're set it to the process<font color="#CCCCCC"> - I we</font><font color="#E5E5E5"> can</font>

347
00:13:35,119 --> 00:13:38,359
<font color="#E5E5E5">just check out the process name it's got</font>

348
00:13:36,439 --> 00:13:40,040
<font color="#E5E5E5">the attribute process name and then we</font>

349
00:13:38,359 --> 00:13:41,419
can also check out<font color="#CCCCCC"> all the properties</font>

350
00:13:40,040 --> 00:13:44,299
<font color="#CCCCCC">that has to offer by just querying the</font>

351
00:13:41,419 --> 00:13:47,300
<font color="#E5E5E5">PowerShell object and see all this data</font>

352
00:13:44,299 --> 00:13:48,769
<font color="#E5E5E5">you have from this interface</font>

353
00:13:47,300 --> 00:13:50,179
like I said<font color="#CCCCCC"> these slides will be up</font><font color="#E5E5E5"> and</font>

354
00:13:48,769 --> 00:13:53,410
the<font color="#E5E5E5"> videos are</font><font color="#CCCCCC"> embedded so you can check</font>

355
00:13:50,179 --> 00:13:53,410
<font color="#E5E5E5">them out look closer</font>

356
00:13:57,170 --> 00:14:01,370
<font color="#E5E5E5">okay so</font>

357
00:14:00,140 --> 00:14:02,630
kind<font color="#CCCCCC"> of had an interruption to</font><font color="#E5E5E5"> talk</font>

358
00:14:01,370 --> 00:14:04,459
about<font color="#E5E5E5"> PowerShell and interacting with</font>

359
00:14:02,630 --> 00:14:06,439
<font color="#CCCCCC">this thing in PowerShell I haven't</font>

360
00:14:04,459 --> 00:14:07,489
<font color="#CCCCCC">covered the</font><font color="#E5E5E5"> rest of the parts of the</font>

361
00:14:06,440 --> 00:14:08,839
common information model that are

362
00:14:07,490 --> 00:14:11,930
defined that I'm<font color="#E5E5E5"> talking</font><font color="#CCCCCC"> about in this</font>

363
00:14:08,839 --> 00:14:14,089
slide<font color="#E5E5E5"> set so where it gets really</font>

364
00:14:11,930 --> 00:14:16,699
<font color="#CCCCCC">interesting is you can</font><font color="#E5E5E5"> have events</font>

365
00:14:14,089 --> 00:14:20,300
<font color="#E5E5E5">filters consumers and then binders so</font>

366
00:14:16,700 --> 00:14:22,940
essentially you<font color="#E5E5E5"> have these</font><font color="#CCCCCC"> classes that</font>

367
00:14:20,300 --> 00:14:24,680
can fire events<font color="#E5E5E5"> there there's win32</font>

368
00:14:22,940 --> 00:14:28,399
process start trace<font color="#E5E5E5"> so that'll fire an</font>

369
00:14:24,680 --> 00:14:29,660
event<font color="#E5E5E5"> whenever a process starts</font><font color="#CCCCCC"> and so</font>

370
00:14:28,399 --> 00:14:32,899
you can query for<font color="#CCCCCC"> that and then do</font>

371
00:14:29,660 --> 00:14:34,939
actions based on that so<font color="#E5E5E5"> these filters</font>

372
00:14:32,899 --> 00:14:37,459
you<font color="#E5E5E5"> have to write a filter to query for</font>

373
00:14:34,940 --> 00:14:38,899
<font color="#E5E5E5">these things</font><font color="#CCCCCC"> and they're in wql that</font>

374
00:14:37,459 --> 00:14:41,810
language we talked about before that SQL

375
00:14:38,899 --> 00:14:43,279
familiar thing<font color="#E5E5E5"> so if we want to know if</font>

376
00:14:41,810 --> 00:14:44,689
we want an event to fire<font color="#E5E5E5"> whenever an</font>

377
00:14:43,279 --> 00:14:46,339
instance<font color="#CCCCCC"> does command prompt pops up</font>

378
00:14:44,690 --> 00:14:50,149
maybe this is just a contrived example

379
00:14:46,339 --> 00:14:52,399
but<font color="#E5E5E5"> you can say</font><font color="#CCCCCC"> select star from win32</font>

380
00:14:50,149 --> 00:14:54,589
process<font color="#E5E5E5"> start trace within</font><font color="#CCCCCC"> 5 so every</font>

381
00:14:52,399 --> 00:14:56,750
five seconds check for<font color="#E5E5E5"> this thing where</font>

382
00:14:54,589 --> 00:14:58,459
process<font color="#E5E5E5"> name equals cmd.exe</font><font color="#CCCCCC"> and then it</font>

383
00:14:56,750 --> 00:15:00,980
will fire in it<font color="#E5E5E5"> your event filter will</font>

384
00:14:58,459 --> 00:15:02,180
fire and you can query<font color="#E5E5E5"> for</font><font color="#CCCCCC"> that and do</font>

385
00:15:00,980 --> 00:15:04,399
something<font color="#E5E5E5"> based on that</font><font color="#CCCCCC"> and we'll talk</font>

386
00:15:02,180 --> 00:15:06,229
about what more can what actions we<font color="#CCCCCC"> can</font>

387
00:15:04,399 --> 00:15:08,320
actually do<font color="#E5E5E5"> these consumers in a couple</font>

388
00:15:06,230 --> 00:15:08,320
slides

389
00:15:08,700 --> 00:15:11,910
<font color="#CCCCCC">Zoomers basically act on</font><font color="#E5E5E5"> these events</font>

390
00:15:10,410 --> 00:15:16,500
<font color="#CCCCCC">when you bind</font><font color="#E5E5E5"> them together with a</font>

391
00:15:11,910 --> 00:15:19,920
filter<font color="#CCCCCC"> to</font><font color="#E5E5E5"> consumer binder</font><font color="#CCCCCC"> and you can</font>

392
00:15:16,500 --> 00:15:21,810
run commands you can<font color="#E5E5E5"> send emails you can</font>

393
00:15:19,920 --> 00:15:24,620
<font color="#E5E5E5">write to logs</font><font color="#CCCCCC"> so you can see where that</font>

394
00:15:21,810 --> 00:15:24,619
can<font color="#E5E5E5"> kind of a useful</font>

395
00:15:24,850 --> 00:15:30,100
and all<font color="#E5E5E5"> of these like I said you can</font>

396
00:15:27,639 --> 00:15:31,959
have subclasses<font color="#CCCCCC"> you can have a parent</font>

397
00:15:30,100 --> 00:15:33,250
class and then a child<font color="#CCCCCC"> clashers inherits</font>

398
00:15:31,959 --> 00:15:35,888
all that's its attributes and<font color="#E5E5E5"> you can</font>

399
00:15:33,250 --> 00:15:37,389
extend it so just an<font color="#CCCCCC"> example</font><font color="#E5E5E5"> of that</font><font color="#CCCCCC"> all</font>

400
00:15:35,889 --> 00:15:40,420
event consumers<font color="#E5E5E5"> that we're going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> talk</font>

401
00:15:37,389 --> 00:15:42,850
about<font color="#E5E5E5"> in this presentation are subs or</font>

402
00:15:40,420 --> 00:15:45,719
parent or<font color="#E5E5E5"> child's of children of the</font>

403
00:15:42,850 --> 00:15:45,720
event consumer<font color="#CCCCCC"> class</font>

404
00:15:46,860 --> 00:15:52,290
go into like actually using<font color="#CCCCCC"> an example</font>

405
00:15:49,650 --> 00:15:57,470
<font color="#E5E5E5">of these in a sec here</font><font color="#CCCCCC"> so this</font><font color="#E5E5E5"> is just</font>

406
00:15:52,290 --> 00:16:00,180
<font color="#CCCCCC">the overview and now using WMI for evil</font>

407
00:15:57,470 --> 00:16:02,520
so we're<font color="#E5E5E5"> here to attack stuff</font><font color="#CCCCCC"> if you're</font>

408
00:16:00,180 --> 00:16:04,349
<font color="#E5E5E5">here to attack stuff this is great</font><font color="#CCCCCC"> these</font>

409
00:16:02,520 --> 00:16:07,500
<font color="#E5E5E5">methods have actually been used out</font><font color="#CCCCCC"> in</font>

410
00:16:04,350 --> 00:16:10,710
the wild<font color="#CCCCCC"> right so apt</font><font color="#E5E5E5"> 29 the Russians</font>

411
00:16:07,500 --> 00:16:12,460
anybody here<font color="#CCCCCC"> that dnc hack</font><font color="#E5E5E5"> recently</font>

412
00:16:10,710 --> 00:16:17,200
right

413
00:16:12,460 --> 00:16:18,460
<font color="#CCCCCC">Yeah right this guy gets</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> so the</font><font color="#E5E5E5"> guys</font>

414
00:16:17,200 --> 00:16:20,050
some of<font color="#CCCCCC"> the some of the</font><font color="#E5E5E5"> breaches</font>

415
00:16:18,460 --> 00:16:21,400
actually use this<font color="#CCCCCC"> back</font><font color="#E5E5E5"> door</font><font color="#CCCCCC"> so this is</font>

416
00:16:20,050 --> 00:16:24,400
<font color="#E5E5E5">being used out in the wild by real</font>

417
00:16:21,400 --> 00:16:26,980
adversaries<font color="#E5E5E5"> so there's this root</font>

418
00:16:24,400 --> 00:16:30,430
subscription namespace<font color="#CCCCCC"> that</font><font color="#E5E5E5"> allows you</font>

419
00:16:26,980 --> 00:16:32,500
to<font color="#CCCCCC"> create</font><font color="#E5E5E5"> special event consumers so if</font>

420
00:16:30,430 --> 00:16:34,329
you can if you<font color="#CCCCCC"> can read these</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> see</font>

421
00:16:32,500 --> 00:16:35,590
that they might be very useful<font color="#CCCCCC"> command</font>

422
00:16:34,330 --> 00:16:38,320
line event consumer allows you to

423
00:16:35,590 --> 00:16:41,280
actually<font color="#E5E5E5"> run things on a command line so</font>

424
00:16:38,320 --> 00:16:43,420
<font color="#E5E5E5">execute arbitrary code as</font><font color="#CCCCCC"> a system user</font>

425
00:16:41,280 --> 00:16:46,449
<font color="#E5E5E5">active script event consumer will</font><font color="#CCCCCC"> iater</font>

426
00:16:43,420 --> 00:16:48,310
<font color="#CCCCCC">on</font><font color="#E5E5E5"> VB script or JavaScript also useful a</font>

427
00:16:46,450 --> 00:16:50,110
log file event consumer allows you to

428
00:16:48,310 --> 00:16:52,209
write<font color="#E5E5E5"> to a log file</font><font color="#CCCCCC"> when that happens</font><font color="#E5E5E5"> so</font>

429
00:16:50,110 --> 00:16:54,430
useful for<font color="#CCCCCC"> blue teamers if</font><font color="#E5E5E5"> you're I'm</font>

430
00:16:52,210 --> 00:16:57,370
<font color="#CCCCCC">using this method</font><font color="#E5E5E5"> NT event log consumer</font>

431
00:16:54,430 --> 00:16:58,510
<font color="#E5E5E5">right to the event log or then SMTP</font>

432
00:16:57,370 --> 00:17:00,910
event consumer which allow you<font color="#E5E5E5"> to send</font>

433
00:16:58,510 --> 00:17:04,180
an email you<font color="#CCCCCC"> can do</font><font color="#E5E5E5"> mix-and-match these</font>

434
00:17:00,910 --> 00:17:06,250
you can use<font color="#E5E5E5"> them together so the apt</font><font color="#CCCCCC"> 29</font>

435
00:17:04,180 --> 00:17:08,410
file<font color="#CCCCCC"> lists</font><font color="#E5E5E5"> backdoor essentially what it</font>

436
00:17:06,250 --> 00:17:11,050
<font color="#E5E5E5">did was it registered an event filter</font>

437
00:17:08,410 --> 00:17:13,270
that queried win32 local time and it

438
00:17:11,050 --> 00:17:16,990
said<font color="#E5E5E5"> every Monday Tuesday Thursday</font>

439
00:17:13,270 --> 00:17:20,230
<font color="#CCCCCC">Friday and</font><font color="#E5E5E5"> Saturday at</font><font color="#CCCCCC"> 11:30 3 a.m.</font>

440
00:17:16,990 --> 00:17:22,480
local time run this thing and it

441
00:17:20,230 --> 00:17:23,920
<font color="#E5E5E5">essentially would it registered a</font>

442
00:17:22,480 --> 00:17:26,650
command<font color="#CCCCCC"> LED event consumer to run this</font>

443
00:17:23,920 --> 00:17:29,680
crazy<font color="#CCCCCC"> encoded</font><font color="#E5E5E5"> PowerShell script that</font>

444
00:17:26,650 --> 00:17:32,770
would go<font color="#E5E5E5"> and get</font><font color="#CCCCCC"> ducey to exfiltrate</font>

445
00:17:29,680 --> 00:17:34,720
data<font color="#CCCCCC"> get commands grab arbitrary</font>

446
00:17:32,770 --> 00:17:39,240
executables<font color="#CCCCCC"> whatever the operators</font>

447
00:17:34,720 --> 00:17:41,580
wanted so this will run

448
00:17:39,240 --> 00:17:43,940
on a schedule<font color="#E5E5E5"> which is great great for</font>

449
00:17:41,580 --> 00:17:43,939
<font color="#E5E5E5">attackers</font>

450
00:17:44,870 --> 00:17:48,350
interval<font color="#CCCCCC"> back</font><font color="#E5E5E5"> doors</font><font color="#CCCCCC"> if you want a</font>

451
00:17:46,520 --> 00:17:51,020
persistent<font color="#CCCCCC"> call back that</font><font color="#E5E5E5"> calls back</font><font color="#CCCCCC"> you</font>

452
00:17:48,350 --> 00:17:51,949
know every 15 seconds you can do this

453
00:17:51,020 --> 00:17:54,950
<font color="#E5E5E5">thing</font><font color="#CCCCCC"> called an interval timer</font>

454
00:17:51,950 --> 00:17:57,140
instruction class and then you can

455
00:17:54,950 --> 00:17:59,360
<font color="#E5E5E5">create this and</font><font color="#CCCCCC"> it'll fire a what's</font>

456
00:17:57,140 --> 00:18:01,820
called<font color="#CCCCCC"> a timer event every however many</font>

457
00:17:59,360 --> 00:18:05,000
milliseconds you<font color="#E5E5E5"> would like</font>

458
00:18:01,820 --> 00:18:06,919
<font color="#E5E5E5">but then in your</font><font color="#CCCCCC"> event filter you say</font>

459
00:18:05,000 --> 00:18:08,600
select<font color="#CCCCCC"> star from timer event within 15</font>

460
00:18:06,920 --> 00:18:11,570
where timer ID equals whatever your

461
00:18:08,600 --> 00:18:15,110
timer name is and what<font color="#E5E5E5"> that will do is</font>

462
00:18:11,570 --> 00:18:17,570
will allow you to<font color="#E5E5E5"> run an event consumer</font>

463
00:18:15,110 --> 00:18:18,979
<font color="#E5E5E5">you bind a consumer to</font><font color="#CCCCCC"> this you</font>

464
00:18:17,570 --> 00:18:21,169
<font color="#E5E5E5">basically have a scheduled task that</font>

465
00:18:18,980 --> 00:18:22,820
runs every<font color="#E5E5E5"> X milliseconds you can</font>

466
00:18:21,170 --> 00:18:24,740
execute commands<font color="#E5E5E5"> you can</font><font color="#CCCCCC"> use</font><font color="#E5E5E5"> power you</font>

467
00:18:22,820 --> 00:18:26,510
can<font color="#E5E5E5"> use the full power of PowerShell and</font>

468
00:18:24,740 --> 00:18:29,360
you can<font color="#E5E5E5"> grab things from</font><font color="#CCCCCC"> the internet</font>

469
00:18:26,510 --> 00:18:31,670
<font color="#CCCCCC">and execute them</font><font color="#E5E5E5"> you can upload files</font>

470
00:18:29,360 --> 00:18:33,830
<font color="#E5E5E5">you can I don't know nuke the whole</font>

471
00:18:31,670 --> 00:18:35,180
system if you like<font color="#E5E5E5"> every 15 seconds I</font>

472
00:18:33,830 --> 00:18:36,830
guess<font color="#CCCCCC"> I'd only if you only do that once</font>

473
00:18:35,180 --> 00:18:37,970
<font color="#E5E5E5">or something like nuking the system you</font>

474
00:18:36,830 --> 00:18:39,679
probably<font color="#CCCCCC"> wanna use an absolute timer</font>

475
00:18:37,970 --> 00:18:44,930
instruction which<font color="#E5E5E5"> will execute at a</font>

476
00:18:39,680 --> 00:18:48,040
specific<font color="#CCCCCC"> point</font><font color="#E5E5E5"> in time</font><font color="#CCCCCC"> only once so fire</font>

477
00:18:44,930 --> 00:18:48,040
at a specific time

478
00:18:49,130 --> 00:18:54,440
<font color="#E5E5E5">that's pretty cool</font><font color="#CCCCCC"> I have a demo of that</font>

479
00:18:51,070 --> 00:18:56,270
it works these<font color="#E5E5E5"> were all failing to like</font>

480
00:18:54,440 --> 00:18:59,540
start last night<font color="#E5E5E5"> so I'm happy that it</font>

481
00:18:56,270 --> 00:19:01,730
<font color="#CCCCCC">actually works so what's up on the</font>

482
00:18:59,540 --> 00:19:04,730
screen<font color="#CCCCCC"> right now it's the command is set</font>

483
00:19:01,730 --> 00:19:06,170
-<font color="#CCCCCC"> w mi instance -</font><font color="#E5E5E5"> name space root</font>

484
00:19:04,730 --> 00:19:07,880
subscription so like I said<font color="#CCCCCC"> we have to</font>

485
00:19:06,170 --> 00:19:09,890
act in<font color="#CCCCCC"> that</font><font color="#E5E5E5"> space to create that</font>

486
00:19:07,880 --> 00:19:12,500
specific consumer<font color="#CCCCCC"> we're gonna create</font>

487
00:19:09,890 --> 00:19:14,150
<font color="#CCCCCC">ourselves a class</font><font color="#E5E5E5"> a sub an instance of</font>

488
00:19:12,500 --> 00:19:18,620
the interval timer instruction class

489
00:19:14,150 --> 00:19:19,970
with the parameters<font color="#CCCCCC"> timer ID equals I</font>

490
00:19:18,620 --> 00:19:22,520
timer and then the interval between

491
00:19:19,970 --> 00:19:24,290
<font color="#E5E5E5">events is</font><font color="#CCCCCC"> 15 thousand which</font><font color="#E5E5E5"> is 15</font>

492
00:19:22,520 --> 00:19:26,740
seconds<font color="#CCCCCC"> 30</font><font color="#E5E5E5"> 15 seconds we're gonna fire</font>

493
00:19:24,290 --> 00:19:26,740
this event

494
00:19:27,800 --> 00:19:30,800
there we go that's<font color="#CCCCCC"> the resolution is</font>

495
00:19:28,910 --> 00:19:34,270
<font color="#E5E5E5">better on that now alright so we're</font>

496
00:19:30,800 --> 00:19:36,129
gonna do that<font color="#E5E5E5"> it created successfully</font>

497
00:19:34,270 --> 00:19:38,860
the next thing we have<font color="#E5E5E5"> to do is register</font>

498
00:19:36,130 --> 00:19:41,770
an event filter and<font color="#E5E5E5"> I am copying and</font>

499
00:19:38,860 --> 00:19:43,179
pasting these we have to register an

500
00:19:41,770 --> 00:19:46,240
event filter I know that's hard to<font color="#E5E5E5"> see I</font>

501
00:19:43,180 --> 00:19:48,460
apologize<font color="#CCCCCC"> which</font><font color="#E5E5E5"> basically does what I</font>

502
00:19:46,240 --> 00:19:50,400
said on<font color="#E5E5E5"> the slide here the last slide</font>

503
00:19:48,460 --> 00:19:53,230
which<font color="#E5E5E5"> was select star from timer event</font>

504
00:19:50,400 --> 00:19:55,540
within 15 so query every 15<font color="#E5E5E5"> seconds for</font>

505
00:19:53,230 --> 00:19:57,970
this event<font color="#E5E5E5"> where the timer ID equals</font><font color="#CCCCCC"> I</font>

506
00:19:55,540 --> 00:20:00,850
timer<font color="#E5E5E5"> so this event filter is going to</font>

507
00:19:57,970 --> 00:20:03,690
essentially<font color="#CCCCCC"> rabb that event that</font><font color="#E5E5E5"> every</font>

508
00:20:00,850 --> 00:20:03,689
<font color="#E5E5E5">15-second event</font>

509
00:20:04,480 --> 00:20:09,999
<font color="#E5E5E5">so we'll register that real quick</font><font color="#CCCCCC"> and in</font>

510
00:20:08,019 --> 00:20:11,320
the<font color="#E5E5E5"> final the the next thing you have</font><font color="#CCCCCC"> to</font>

511
00:20:09,999 --> 00:20:12,940
<font color="#E5E5E5">do is register a consumer so this is the</font>

512
00:20:11,320 --> 00:20:16,720
part<font color="#E5E5E5"> you haven't seen yet</font><font color="#CCCCCC"> the consumer</font>

513
00:20:12,940 --> 00:20:18,249
<font color="#E5E5E5">is actually a simple command line script</font>

514
00:20:16,720 --> 00:20:19,659
so<font color="#CCCCCC"> you set</font><font color="#E5E5E5"> the command line template for</font>

515
00:20:18,249 --> 00:20:21,700
<font color="#E5E5E5">this command line event consumer to</font>

516
00:20:19,659 --> 00:20:24,460
message star hello world

517
00:20:21,700 --> 00:20:25,570
I am<font color="#CCCCCC"> WM I and so</font><font color="#E5E5E5"> I</font><font color="#CCCCCC"> paste</font><font color="#E5E5E5"> that in just to</font>

518
00:20:24,460 --> 00:20:27,549
show<font color="#CCCCCC"> you what that's</font><font color="#E5E5E5"> actually</font><font color="#CCCCCC"> gonna do</font>

519
00:20:25,570 --> 00:20:29,789
when<font color="#E5E5E5"> this thing runs so it's gonna pop</font>

520
00:20:27,549 --> 00:20:32,200
<font color="#E5E5E5">up a</font><font color="#CCCCCC"> message box</font><font color="#E5E5E5"> on the screen</font><font color="#CCCCCC"> very very</font>

521
00:20:29,789 --> 00:20:35,529
<font color="#E5E5E5">non functional example for somebody</font>

522
00:20:32,200 --> 00:20:36,549
<font color="#E5E5E5">that's gonna be</font><font color="#CCCCCC"> attacking but you're</font>

523
00:20:35,529 --> 00:20:37,570
definitely gonna be able<font color="#E5E5E5"> to put whatever</font>

524
00:20:36,549 --> 00:20:39,519
<font color="#CCCCCC">you want there you can</font><font color="#E5E5E5"> write like</font><font color="#CCCCCC"> I said</font>

525
00:20:37,570 --> 00:20:41,168
run<font color="#E5E5E5"> PowerShell commands then bind them</font>

526
00:20:39,519 --> 00:20:43,179
together with<font color="#E5E5E5"> this filter</font><font color="#CCCCCC"> to consumer</font>

527
00:20:41,169 --> 00:20:44,710
binding that gets<font color="#E5E5E5"> created</font><font color="#CCCCCC"> and then</font>

528
00:20:43,179 --> 00:20:47,769
within a<font color="#CCCCCC"> couple seconds here we'll see</font>

529
00:20:44,710 --> 00:20:50,109
it pop up it'll be<font color="#E5E5E5"> checking for</font><font color="#CCCCCC"> it will</font>

530
00:20:47,769 --> 00:20:53,649
see the message<font color="#E5E5E5"> pop</font><font color="#CCCCCC"> up and it's actually</font>

531
00:20:50,109 --> 00:20:56,649
<font color="#E5E5E5">run from an elevated elevated context</font>

532
00:20:53,649 --> 00:20:58,149
and so if you go into the WMI<font color="#CCCCCC"> Explorer</font>

533
00:20:56,649 --> 00:21:00,070
you can<font color="#E5E5E5"> see that the event consumer was</font>

534
00:20:58,149 --> 00:21:02,929
created as a command line event consumer

535
00:21:00,070 --> 00:21:04,790
with the command message star hello

536
00:21:02,930 --> 00:21:06,990
<font color="#CCCCCC">the event filter was created with our</font>

537
00:21:04,790 --> 00:21:08,700
query

538
00:21:06,990 --> 00:21:10,500
it's still it's<font color="#CCCCCC"> still up coming up</font>

539
00:21:08,700 --> 00:21:12,600
<font color="#CCCCCC">closer to consumer binding was created</font>

540
00:21:10,500 --> 00:21:14,640
with the<font color="#E5E5E5"> two names of our filter and</font>

541
00:21:12,600 --> 00:21:16,860
consumer and then the interval timer

542
00:21:14,640 --> 00:21:19,230
instruction that fires every 15 seconds

543
00:21:16,860 --> 00:21:22,439
was created as<font color="#E5E5E5"> well</font><font color="#CCCCCC"> I have a scripture</font>

544
00:21:19,230 --> 00:21:24,840
above that you can<font color="#E5E5E5"> schedule things from</font>

545
00:21:22,440 --> 00:21:27,540
this<font color="#CCCCCC"> and you know I know people will</font>

546
00:21:24,840 --> 00:21:29,909
check scheduled tasks<font color="#CCCCCC"> I know people will</font>

547
00:21:27,540 --> 00:21:31,830
check their run keys and things like

548
00:21:29,910 --> 00:21:33,240
that<font color="#CCCCCC"> and typical</font><font color="#E5E5E5"> persistence locations</font>

549
00:21:31,830 --> 00:21:35,280
<font color="#E5E5E5">but this is something that</font><font color="#CCCCCC"> people don't</font>

550
00:21:33,240 --> 00:21:37,830
really think<font color="#E5E5E5"> about how many how</font><font color="#CCCCCC"> many</font>

551
00:21:35,280 --> 00:21:40,410
<font color="#CCCCCC">people in</font><font color="#E5E5E5"> here</font><font color="#CCCCCC"> like run security for</font>

552
00:21:37,830 --> 00:21:42,810
their infrastructures<font color="#CCCCCC"> all right do you</font>

553
00:21:40,410 --> 00:21:47,930
guys<font color="#E5E5E5"> check for WMI stuff you guys</font>

554
00:21:42,810 --> 00:21:50,440
specifically<font color="#E5E5E5"> check in your so</font>

555
00:21:47,930 --> 00:21:50,440
yes

556
00:21:53,589 --> 00:21:57,019
autoruns does catch this yes<font color="#E5E5E5"> so if</font>

557
00:21:56,059 --> 00:21:58,369
you're<font color="#CCCCCC"> running but</font><font color="#E5E5E5"> that's on a host</font>

558
00:21:57,019 --> 00:22:01,489
<font color="#CCCCCC">BioSpace if you're running a massive a</font>

559
00:21:58,369 --> 00:22:02,749
massive infrastructure you know you're

560
00:22:01,489 --> 00:22:05,239
<font color="#E5E5E5">not gonna notice one host that</font><font color="#CCCCCC"> gets</font>

561
00:22:02,749 --> 00:22:10,899
infected<font color="#E5E5E5"> with this most</font><font color="#CCCCCC"> likely it's it's</font>

562
00:22:05,239 --> 00:22:10,899
definitely<font color="#CCCCCC"> tough so it's interesting</font>

563
00:22:10,930 --> 00:22:15,400
there's that<font color="#E5E5E5"> another evil thing I saw</font>

564
00:22:13,180 --> 00:22:16,450
this when<font color="#E5E5E5"> I put this talk together</font><font color="#CCCCCC"> I saw</font>

565
00:22:15,400 --> 00:22:17,710
this tweet and I couldn't help but

566
00:22:16,450 --> 00:22:18,640
include it<font color="#E5E5E5"> but Matt graver is a</font>

567
00:22:17,710 --> 00:22:20,440
<font color="#CCCCCC">PowerShell</font><font color="#E5E5E5"> wizard</font>

568
00:22:18,640 --> 00:22:24,520
he's a<font color="#E5E5E5"> Windows</font><font color="#CCCCCC"> Wizard he's a good dude</font>

569
00:22:20,440 --> 00:22:26,170
<font color="#E5E5E5">and he's he</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> there's this tool sim</font>

570
00:22:24,520 --> 00:22:28,950
sweep that's on the good end but you can

571
00:22:26,170 --> 00:22:31,390
<font color="#CCCCCC">actually recover</font><font color="#E5E5E5"> BitLocker keys from</font><font color="#CCCCCC"> WMI</font>

572
00:22:28,950 --> 00:22:35,110
which is terrifying<font color="#E5E5E5"> like this is your</font>

573
00:22:31,390 --> 00:22:37,450
drive encryption<font color="#E5E5E5"> key like so that's</font>

574
00:22:35,110 --> 00:22:39,580
that's the impact<font color="#E5E5E5"> of this right you can</font>

575
00:22:37,450 --> 00:22:41,950
<font color="#E5E5E5">schedule tasks you can query</font><font color="#CCCCCC"> for</font>

576
00:22:39,580 --> 00:22:43,270
information it's great for recon<font color="#E5E5E5"> and you</font>

577
00:22:41,950 --> 00:22:45,550
can also recover<font color="#E5E5E5"> things like the</font>

578
00:22:43,270 --> 00:22:48,280
BitLocker key password the BitLocker

579
00:22:45,550 --> 00:22:49,389
password which is<font color="#E5E5E5"> for those of you who</font>

580
00:22:48,280 --> 00:22:54,100
aren't<font color="#E5E5E5"> familiar with BitLocker it's</font>

581
00:22:49,390 --> 00:22:56,950
<font color="#CCCCCC">Drive Encryption</font><font color="#E5E5E5"> or Windows that's huge</font>

582
00:22:54,100 --> 00:23:01,290
like I said<font color="#E5E5E5"> you need local admin to get</font>

583
00:22:56,950 --> 00:23:01,290
this information<font color="#E5E5E5"> but</font>

584
00:23:02,480 --> 00:23:05,080
<font color="#CCCCCC">remise this happen</font>

585
00:23:06,970 --> 00:23:11,799
so usually<font color="#CCCCCC"> WMI for good I think that's</font>

586
00:23:10,269 --> 00:23:14,440
<font color="#CCCCCC">my</font><font color="#E5E5E5"> favorite</font><font color="#CCCCCC"> gift in the entire world I</font>

587
00:23:11,799 --> 00:23:15,970
don't<font color="#CCCCCC"> know</font><font color="#E5E5E5"> some stuff I couldn't just</font>

588
00:23:14,440 --> 00:23:18,330
give you guys the evil without<font color="#E5E5E5"> the good</font>

589
00:23:15,970 --> 00:23:18,330
hello

590
00:23:24,630 --> 00:23:26,690
you

591
00:23:33,779 --> 00:23:38,830
all the all this stuff has to<font color="#E5E5E5"> be created</font>

592
00:23:36,129 --> 00:23:41,889
<font color="#E5E5E5">from a</font><font color="#CCCCCC"> straighter context but</font><font color="#E5E5E5"> it can be</font>

593
00:23:38,830 --> 00:23:46,139
<font color="#E5E5E5">done so remotely</font><font color="#CCCCCC"> if you have port 135</font>

594
00:23:41,889 --> 00:23:46,139
open which is

595
00:23:47,160 --> 00:23:50,940
that's like support that people<font color="#CCCCCC"> usually</font>

596
00:23:48,480 --> 00:23:52,260
leave<font color="#E5E5E5"> alone on</font><font color="#CCCCCC"> Windows networks</font>

597
00:23:50,940 --> 00:23:54,480
<font color="#E5E5E5">so I've been able to do this you</font><font color="#CCCCCC"> have to</font>

598
00:23:52,260 --> 00:23:58,080
<font color="#E5E5E5">have I think</font><font color="#CCCCCC"> RPC has to be unfiltered</font>

599
00:23:54,480 --> 00:23:59,220
<font color="#E5E5E5">inbound and then also the windows</font><font color="#CCCCCC"> that</font>

600
00:23:58,080 --> 00:24:00,240
<font color="#CCCCCC">manages that automatically</font><font color="#E5E5E5"> in this</font>

601
00:23:59,220 --> 00:24:01,770
you're running some<font color="#E5E5E5"> other sort</font><font color="#CCCCCC"> of other</font>

602
00:24:00,240 --> 00:24:02,820
firewall<font color="#E5E5E5"> on</font><font color="#CCCCCC"> a Windows network you're</font>

603
00:24:01,770 --> 00:24:03,900
gonna allow those ports<font color="#E5E5E5"> because that's</font>

604
00:24:02,820 --> 00:24:06,480
what I eat like<font color="#E5E5E5"> the main domain</font>

605
00:24:03,900 --> 00:24:07,710
<font color="#E5E5E5">controller we used to talk via</font><font color="#CCCCCC"> RPC and</font>

606
00:24:06,480 --> 00:24:09,240
<font color="#CCCCCC">point map</font><font color="#E5E5E5"> and stuff</font>

607
00:24:07,710 --> 00:24:10,980
so it's the same kinds of ports that

608
00:24:09,240 --> 00:24:12,960
<font color="#E5E5E5">Active Directory uses so if they</font>

609
00:24:10,980 --> 00:24:14,220
<font color="#CCCCCC">compromised and I'm pretty sure you can</font>

610
00:24:12,960 --> 00:24:17,770
log into this with a domain<font color="#E5E5E5"> admin</font>

611
00:24:14,220 --> 00:24:21,960
account<font color="#CCCCCC"> if you get it so</font>

612
00:24:17,770 --> 00:24:26,410
or certain<font color="#E5E5E5"> groups certain</font><font color="#CCCCCC"> Commission's</font>

613
00:24:21,960 --> 00:24:28,630
<font color="#CCCCCC">all right</font><font color="#E5E5E5"> so I've looked I've spent a</font>

614
00:24:26,410 --> 00:24:31,420
lot<font color="#E5E5E5"> of time in this tool just looking</font>

615
00:24:28,630 --> 00:24:33,910
<font color="#E5E5E5">for things that</font><font color="#CCCCCC"> are cool</font><font color="#E5E5E5"> to go through</font>

616
00:24:31,420 --> 00:24:36,520
and and one<font color="#CCCCCC"> of the things that I</font><font color="#E5E5E5"> found</font>

617
00:24:33,910 --> 00:24:38,980
<font color="#E5E5E5">was actually Windows Defender has</font><font color="#CCCCCC"> a WMI</font>

618
00:24:36,520 --> 00:24:40,870
interface<font color="#E5E5E5"> so you can use this for good</font>

619
00:24:38,980 --> 00:24:42,970
things<font color="#E5E5E5"> so it's at the namespace root</font>

620
00:24:40,870 --> 00:24:45,850
Microsoft Security client<font color="#CCCCCC"> there's a</font>

621
00:24:42,970 --> 00:24:47,620
malware class<font color="#E5E5E5"> so I don't know if you</font>

622
00:24:45,850 --> 00:24:51,399
guys can see you will be<font color="#CCCCCC"> able</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> see</font>

623
00:24:47,620 --> 00:24:56,189
this but security client and then

624
00:24:51,400 --> 00:24:56,190
malware we can actually<font color="#E5E5E5"> pull</font><font color="#CCCCCC"> up</font>

625
00:24:56,999 --> 00:25:01,560
<font color="#CCCCCC">just as here</font>

626
00:24:58,919 --> 00:25:03,570
our instances of

627
00:25:01,560 --> 00:25:07,139
oh there we go<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> every</font><font color="#CCCCCC"> time it</font>

628
00:25:03,570 --> 00:25:09,389
detects a threat it'll actually register

629
00:25:07,140 --> 00:25:11,220
<font color="#CCCCCC">in WMI so you can</font><font color="#E5E5E5"> query</font>

630
00:25:09,390 --> 00:25:13,290
so these are all<font color="#E5E5E5"> and you can tell how</font>

631
00:25:11,220 --> 00:25:14,190
many<font color="#CCCCCC"> times</font><font color="#E5E5E5"> I tested this demo</font><font color="#CCCCCC"> because</font>

632
00:25:13,290 --> 00:25:15,500
that's the<font color="#CCCCCC"> number of</font><font color="#E5E5E5"> times</font><font color="#CCCCCC"> that tested</font>

633
00:25:14,190 --> 00:25:19,500
the SEM

634
00:25:15,500 --> 00:25:21,600
so you can get notified when malware<font color="#CCCCCC"> SEC</font>

635
00:25:19,500 --> 00:25:23,850
<font color="#CCCCCC">did I mean like I said</font><font color="#E5E5E5"> that's kind of a</font>

636
00:25:21,600 --> 00:25:25,439
not so useful example but think<font color="#E5E5E5"> about</font>

637
00:25:23,850 --> 00:25:26,760
whenever Windows Defender<font color="#CCCCCC"> to</font><font color="#E5E5E5"> text</font>

638
00:25:25,440 --> 00:25:29,130
<font color="#CCCCCC">something which Windows Defender is</font>

639
00:25:26,760 --> 00:25:30,480
<font color="#E5E5E5">actually fairly decent these days better</font>

640
00:25:29,130 --> 00:25:32,809
than like old<font color="#CCCCCC"> Windows security</font>

641
00:25:30,480 --> 00:25:35,250
<font color="#E5E5E5">protection used to be which was nothing</font>

642
00:25:32,809 --> 00:25:36,510
if you fire if you fire an<font color="#CCCCCC"> event you can</font>

643
00:25:35,250 --> 00:25:38,490
run a quarantine script you<font color="#E5E5E5"> can run a</font>

644
00:25:36,510 --> 00:25:39,809
data collection script<font color="#CCCCCC"> they think of the</font>

645
00:25:38,490 --> 00:25:41,070
possibilities<font color="#E5E5E5"> there was like as soon as</font>

646
00:25:39,809 --> 00:25:43,168
when<font color="#E5E5E5"> you defend Windows Defender catches</font>

647
00:25:41,070 --> 00:25:45,450
something<font color="#E5E5E5"> you can get the state system</font>

648
00:25:43,169 --> 00:25:46,620
state<font color="#E5E5E5"> they can't so you have it at that</font>

649
00:25:45,450 --> 00:25:49,200
that<font color="#E5E5E5"> snapshot at that state of time</font>

650
00:25:46,620 --> 00:25:50,520
<font color="#E5E5E5">that's pretty neat so you can get</font>

651
00:25:49,200 --> 00:25:53,690
notified you can use that<font color="#E5E5E5"> same event</font>

652
00:25:50,520 --> 00:25:55,889
<font color="#E5E5E5">filter consumer trick</font>

653
00:25:53,690 --> 00:25:58,730
actually query<font color="#E5E5E5"> for</font><font color="#CCCCCC"> this and then do</font>

654
00:25:55,890 --> 00:25:58,730
<font color="#E5E5E5">something based on it</font>

655
00:26:04,080 --> 00:26:11,169
you can so<font color="#E5E5E5"> you can you can</font><font color="#CCCCCC"> do whatever</font>

656
00:26:08,560 --> 00:26:13,000
you like<font color="#E5E5E5"> whatever</font><font color="#CCCCCC"> a PowerShell</font><font color="#E5E5E5"> script</font>

657
00:26:11,170 --> 00:26:15,010
can do or<font color="#E5E5E5"> whatever a VB script can do</font>

658
00:26:13,000 --> 00:26:18,250
<font color="#E5E5E5">you can fire in</font><font color="#CCCCCC"> response to this so</font>

659
00:26:15,010 --> 00:26:20,350
collect data<font color="#E5E5E5"> or whatever</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> essentially</font>

660
00:26:18,250 --> 00:26:23,160
<font color="#E5E5E5">what this</font><font color="#CCCCCC"> is doing is I</font><font color="#E5E5E5"> wish the</font>

661
00:26:20,350 --> 00:26:23,159
resolution would up

662
00:26:24,200 --> 00:26:30,140
HD there we go<font color="#CCCCCC"> alright so</font><font color="#E5E5E5"> essentially</font>

663
00:26:27,650 --> 00:26:31,880
here we're<font color="#CCCCCC"> creating its how</font><font color="#E5E5E5"> can possible</font>

664
00:26:30,140 --> 00:26:35,480
to see I'll read it<font color="#E5E5E5"> off to you so</font>

665
00:26:31,880 --> 00:26:39,740
<font color="#E5E5E5">essentially we're creating a an event</font>

666
00:26:35,480 --> 00:26:43,040
filter that queries<font color="#E5E5E5"> the root Microsoft</font>

667
00:26:39,740 --> 00:26:45,290
<font color="#E5E5E5">security client namespace and says</font>

668
00:26:43,040 --> 00:26:47,030
<font color="#CCCCCC">alright whenever an instance creation</font>

669
00:26:45,290 --> 00:26:48,800
event<font color="#CCCCCC"> fire select star from instance</font>

670
00:26:47,030 --> 00:26:50,389
creation event which is an event that

671
00:26:48,800 --> 00:26:53,360
<font color="#E5E5E5">fires whenever an instance of any class</font>

672
00:26:50,390 --> 00:26:55,520
in that namespace<font color="#E5E5E5"> is created and the</font>

673
00:26:53,360 --> 00:26:58,040
target instance<font color="#E5E5E5"> is a malware is the</font>

674
00:26:55,520 --> 00:27:00,879
class type malware we're gonna fire

675
00:26:58,040 --> 00:27:02,960
we're gonna we're<font color="#CCCCCC"> gonna meet</font><font color="#E5E5E5"> this filter</font>

676
00:27:00,880 --> 00:27:05,570
so we'll register it under the root

677
00:27:02,960 --> 00:27:09,390
subscription namespace

678
00:27:05,570 --> 00:27:11,129
<font color="#CCCCCC">we'll register</font><font color="#E5E5E5"> a consumer for this which</font>

679
00:27:09,390 --> 00:27:12,330
in this example like I said we're<font color="#CCCCCC"> just</font>

680
00:27:11,130 --> 00:27:13,320
going to do<font color="#E5E5E5"> something simple which we're</font>

681
00:27:12,330 --> 00:27:15,419
going<font color="#E5E5E5"> to pop up a little message that</font>

682
00:27:13,320 --> 00:27:18,360
<font color="#CCCCCC">says hey you have malware at this</font>

683
00:27:15,420 --> 00:27:21,210
directory<font color="#E5E5E5"> and it's this user launched it</font>

684
00:27:18,360 --> 00:27:25,250
<font color="#E5E5E5">and the severe area is this the Windows</font>

685
00:27:21,210 --> 00:27:25,250
Defender severity ID<font color="#E5E5E5"> is blank</font>

686
00:27:25,410 --> 00:27:28,920
<font color="#CCCCCC">I'll</font><font color="#E5E5E5"> register that as a</font><font color="#CCCCCC"> command line</font>

687
00:27:27,030 --> 00:27:31,399
event consumer like we did before<font color="#E5E5E5"> with</font>

688
00:27:28,920 --> 00:27:33,589
the malicious part

689
00:27:31,399 --> 00:27:35,330
and then finally you bind them both

690
00:27:33,589 --> 00:27:38,589
together<font color="#E5E5E5"> with a filter</font><font color="#CCCCCC"> to consumer</font>

691
00:27:35,330 --> 00:27:38,589
binding<font color="#CCCCCC"> that</font><font color="#E5E5E5"> was created successfully</font>

692
00:27:39,910 --> 00:27:46,000
as an attacker will go and<font color="#E5E5E5"> will unzip</font>

693
00:27:43,450 --> 00:27:47,919
<font color="#E5E5E5">mini cats so we know that's going to get</font>

694
00:27:46,000 --> 00:27:50,530
caught that's<font color="#CCCCCC"> Windows defenders in that</font>

695
00:27:47,919 --> 00:27:52,210
<font color="#E5E5E5">as that it's a tool to dump</font><font color="#CCCCCC"> passwords</font>

696
00:27:50,530 --> 00:27:53,500
out of<font color="#CCCCCC"> memory</font><font color="#E5E5E5"> and other things</font>

697
00:27:52,210 --> 00:27:56,800
credentials<font color="#E5E5E5"> out of memory so we can see</font>

698
00:27:53,500 --> 00:27:58,930
that Windows<font color="#CCCCCC"> Defender did find it</font>

699
00:27:56,800 --> 00:28:03,330
and then in a couple<font color="#CCCCCC"> seconds here there</font>

700
00:27:58,930 --> 00:28:03,330
<font color="#E5E5E5">will be a notification that will run</font>

701
00:28:03,580 --> 00:28:10,149
showing that<font color="#CCCCCC"> our filter worked you can</font>

702
00:28:06,730 --> 00:28:12,250
see pops up a message that says malware

703
00:28:10,150 --> 00:28:15,310
<font color="#CCCCCC">@c users</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> ministers desktop</font><font color="#E5E5E5"> me me</font>

704
00:28:12,250 --> 00:28:17,230
cats<font color="#E5E5E5"> win32 me me dirt</font><font color="#CCCCCC"> sis</font><font color="#E5E5E5"> which is the</font>

705
00:28:15,310 --> 00:28:19,300
driver for<font color="#CCCCCC"> mini cats</font><font color="#E5E5E5"> that uses</font><font color="#CCCCCC"> don't</font>

706
00:28:17,230 --> 00:28:21,130
memory and then from<font color="#CCCCCC"> administrator</font>

707
00:28:19,300 --> 00:28:22,810
severity for you can<font color="#E5E5E5"> take the</font>

708
00:28:21,130 --> 00:28:24,130
<font color="#E5E5E5">information from that class and feed it</font>

709
00:28:22,810 --> 00:28:26,379
<font color="#CCCCCC">into whatever scripts</font><font color="#E5E5E5"> you're running on</font>

710
00:28:24,130 --> 00:28:28,780
the command line<font color="#E5E5E5"> in response to this you</font>

711
00:28:26,380 --> 00:28:31,390
can say you<font color="#E5E5E5"> know hey we have this</font>

712
00:28:28,780 --> 00:28:32,710
<font color="#E5E5E5">malware this information collection</font>

713
00:28:31,390 --> 00:28:36,700
script that we're<font color="#E5E5E5"> supposed to run when</font>

714
00:28:32,710 --> 00:28:38,080
the system detects malware<font color="#E5E5E5"> perfect feed</font>

715
00:28:36,700 --> 00:28:40,780
the information to it tell<font color="#CCCCCC"> it</font><font color="#E5E5E5"> where the</font>

716
00:28:38,080 --> 00:28:43,689
malware<font color="#E5E5E5"> is and then you can you know set</font>

717
00:28:40,780 --> 00:28:45,610
fire off an alert to you can also do

718
00:28:43,690 --> 00:28:47,290
event event logs<font color="#E5E5E5"> to so you can fire up</font>

719
00:28:45,610 --> 00:28:49,090
an alert I'm sure collecting<font color="#E5E5E5"> central</font>

720
00:28:47,290 --> 00:28:51,720
logs and monitoring<font color="#E5E5E5"> you can fire</font><font color="#CCCCCC"> that</font>

721
00:28:49,090 --> 00:28:53,679
<font color="#CCCCCC">off as well I'm fairly certain that</font>

722
00:28:51,720 --> 00:28:56,610
called Windows Defender already<font color="#E5E5E5"> writes</font>

723
00:28:53,680 --> 00:28:58,360
in an event<font color="#E5E5E5"> log but just to the kind of</font>

724
00:28:56,610 --> 00:29:01,219
possibilities<font color="#E5E5E5"> of what you can do you can</font>

725
00:28:58,360 --> 00:29:03,469
send an email as<font color="#CCCCCC"> well</font><font color="#E5E5E5"> at the description</font>

726
00:29:01,220 --> 00:29:05,929
<font color="#E5E5E5">you know exactly</font><font color="#CCCCCC"> which user</font><font color="#E5E5E5"> is trying to</font>

727
00:29:03,470 --> 00:29:07,450
infect<font color="#E5E5E5"> your machines</font>

728
00:29:05,929 --> 00:29:12,409
when Windows Defender catches it and

729
00:29:07,450 --> 00:29:14,840
anybody can develop and make interfaces

730
00:29:12,409 --> 00:29:16,159
for<font color="#CCCCCC"> WMI so another nd I'm not sure which</font>

731
00:29:14,840 --> 00:29:17,600
if there are any antivirus providers

732
00:29:16,159 --> 00:29:22,779
that<font color="#E5E5E5"> are</font><font color="#CCCCCC"> doing this but they can provide</font>

733
00:29:17,600 --> 00:29:22,779
<font color="#E5E5E5">an interface to this if they would like</font>

734
00:29:24,200 --> 00:29:28,610
you can see<font color="#E5E5E5"> go through and it's</font><font color="#CCCCCC"> any WMI</font>

735
00:29:26,389 --> 00:29:30,529
<font color="#CCCCCC">explorer</font><font color="#E5E5E5"> you can see you know all the</font>

736
00:29:28,610 --> 00:29:32,240
information<font color="#CCCCCC"> the path and</font><font color="#E5E5E5"> all all the</font>

737
00:29:30,529 --> 00:29:33,710
stuff<font color="#CCCCCC"> that gives you category ID</font><font color="#E5E5E5"> gives</font>

738
00:29:32,240 --> 00:29:36,110
you the threat ID it gives you the

739
00:29:33,710 --> 00:29:39,470
threat name<font color="#E5E5E5"> the</font><font color="#CCCCCC"> domain it was on the</font>

740
00:29:36,110 --> 00:29:40,668
time it was<font color="#CCCCCC"> executed</font><font color="#E5E5E5"> you know</font><font color="#CCCCCC"> the action</font>

741
00:29:39,470 --> 00:29:42,320
<font color="#E5E5E5">that was taken against it</font>

742
00:29:40,669 --> 00:29:44,149
it gives you all this<font color="#CCCCCC"> information that</font>

743
00:29:42,320 --> 00:29:46,210
<font color="#E5E5E5">you can use</font><font color="#CCCCCC"> and siphon off somewhere</font>

744
00:29:44,149 --> 00:29:46,209
else

745
00:29:50,760 --> 00:29:55,929
there's a tool<font color="#CCCCCC"> called</font><font color="#E5E5E5"> sim sweep</font>

746
00:29:54,100 --> 00:29:58,209
which essentially it's an open-source

747
00:29:55,929 --> 00:30:00,370
<font color="#CCCCCC">PowerShell project that was mentioned</font>

748
00:29:58,210 --> 00:30:01,870
<font color="#CCCCCC">earlier to grab the BitLocker keys</font><font color="#E5E5E5"> but</font>

749
00:30:00,370 --> 00:30:02,918
if you're a blue team<font color="#E5E5E5"> or if you have</font>

750
00:30:01,870 --> 00:30:05,439
running<font color="#CCCCCC"> an environment</font><font color="#E5E5E5"> you have</font><font color="#CCCCCC"> this</font>

751
00:30:02,919 --> 00:30:07,990
open<font color="#CCCCCC"> why</font><font color="#E5E5E5"> why would you</font><font color="#CCCCCC"> not use it for a</font>

752
00:30:05,440 --> 00:30:09,490
fur<font color="#E5E5E5"> collection on your host to see if</font>

753
00:30:07,990 --> 00:30:11,650
anything's wrong<font color="#E5E5E5"> there's a wealth of</font>

754
00:30:09,490 --> 00:30:12,580
information<font color="#E5E5E5"> there you can go and like I</font>

755
00:30:11,650 --> 00:30:15,490
<font color="#CCCCCC">said you can correct collect this stuff</font>

756
00:30:12,580 --> 00:30:17,678
<font color="#E5E5E5">remotely so sim suite will allow you is</font>

757
00:30:15,490 --> 00:30:19,630
it's designed<font color="#CCCCCC"> to</font><font color="#E5E5E5"> you be used at a</font><font color="#CCCCCC"> large</font>

758
00:30:17,679 --> 00:30:22,120
<font color="#CCCCCC">scale</font><font color="#E5E5E5"> enterprise in a</font><font color="#CCCCCC"> large scale</font>

759
00:30:19,630 --> 00:30:23,740
enterprise<font color="#CCCCCC"> with many many Windows</font>

760
00:30:22,120 --> 00:30:25,149
machines<font color="#E5E5E5"> so you can use this to collect</font>

761
00:30:23,740 --> 00:30:28,450
<font color="#E5E5E5">forensics data if you know something's</font>

762
00:30:25,150 --> 00:30:31,049
<font color="#E5E5E5">wrong</font><font color="#CCCCCC"> you can use this to just generally</font>

763
00:30:28,450 --> 00:30:34,210
query stuff<font color="#E5E5E5"> if you're curious to collect</font>

764
00:30:31,049 --> 00:30:36,820
<font color="#CCCCCC">it's it's on github</font><font color="#E5E5E5"> contribute if you</font>

765
00:30:34,210 --> 00:30:38,110
can you know PowerShell<font color="#CCCCCC"> it's a great</font>

766
00:30:36,820 --> 00:30:41,230
tool for threat hunting<font color="#CCCCCC"> Incident</font>

767
00:30:38,110 --> 00:30:42,729
<font color="#CCCCCC">Response because you know gathering that</font>

768
00:30:41,230 --> 00:30:46,090
<font color="#E5E5E5">much information off hundreds and</font>

769
00:30:42,730 --> 00:30:47,200
hundreds of<font color="#E5E5E5"> machines</font><font color="#CCCCCC"> is a tough task but</font>

770
00:30:46,090 --> 00:30:49,530
if you can do it<font color="#CCCCCC"> all remotely with a</font>

771
00:30:47,200 --> 00:30:49,530
click of button

772
00:30:53,630 --> 00:30:59,750
<font color="#E5E5E5">how do you find and stop this register a</font>

773
00:30:58,190 --> 00:31:03,020
consumer filter to tell you if there are

774
00:30:59,750 --> 00:31:04,430
<font color="#E5E5E5">any</font><font color="#CCCCCC"> new consumers created so if someone</font>

775
00:31:03,020 --> 00:31:06,080
malicious is trying to persist using

776
00:31:04,430 --> 00:31:07,790
this method<font color="#E5E5E5"> you can</font><font color="#CCCCCC"> use that instance</font>

777
00:31:06,080 --> 00:31:09,560
creation<font color="#CCCCCC"> event thing we did before with</font>

778
00:31:07,790 --> 00:31:11,899
the<font color="#E5E5E5"> malware class you can say hey if</font>

779
00:31:09,560 --> 00:31:15,800
anybody registers one of these<font color="#E5E5E5"> tell me</font>

780
00:31:11,900 --> 00:31:17,810
<font color="#E5E5E5">about it or delete it</font><font color="#CCCCCC"> probably tell you</font>

781
00:31:15,800 --> 00:31:19,850
<font color="#E5E5E5">about it so you know where the there's a</font>

782
00:31:17,810 --> 00:31:21,610
leak in<font color="#CCCCCC"> your infrastructure</font><font color="#E5E5E5"> or if</font>

783
00:31:19,850 --> 00:31:24,800
somebody's<font color="#CCCCCC"> trying to do something nasty</font>

784
00:31:21,610 --> 00:31:26,510
just delete them<font color="#E5E5E5"> all and make sure there</font>

785
00:31:24,800 --> 00:31:28,520
are none there there are<font color="#E5E5E5"> legitimate uses</font>

786
00:31:26,510 --> 00:31:30,470
for<font color="#E5E5E5"> this I will tell you</font><font color="#CCCCCC"> that the</font><font color="#E5E5E5"> Amazon</font>

787
00:31:28,520 --> 00:31:33,460
<font color="#E5E5E5">machine that I spun up for this demo for</font>

788
00:31:30,470 --> 00:31:37,310
the the recorded demos<font color="#E5E5E5"> for this they all</font>

789
00:31:33,460 --> 00:31:40,430
have at least one registered event

790
00:31:37,310 --> 00:31:41,810
consumer filter<font color="#CCCCCC"> and binder so this is a</font>

791
00:31:40,430 --> 00:31:43,510
real<font color="#E5E5E5"> thing that people use</font><font color="#CCCCCC"> sometimes</font>

792
00:31:41,810 --> 00:31:45,980
make sure you're<font color="#E5E5E5"> not deleting anything</font>

793
00:31:43,510 --> 00:31:47,540
important<font color="#E5E5E5"> off your system</font><font color="#CCCCCC"> I don't</font>

794
00:31:45,980 --> 00:31:49,730
<font color="#CCCCCC">remember</font><font color="#E5E5E5"> what it was for but it was</font>

795
00:31:47,540 --> 00:31:51,889
something

796
00:31:49,730 --> 00:31:54,770
<font color="#CCCCCC">I have the command in the slide show</font>

797
00:31:51,890 --> 00:31:55,760
notes<font color="#E5E5E5"> I forget what it is I didn't feel</font>

798
00:31:54,770 --> 00:31:57,200
like<font color="#CCCCCC"> pasting it in here</font><font color="#E5E5E5"> because it's</font>

799
00:31:55,760 --> 00:31:59,180
<font color="#E5E5E5">kind of like if you're curious go check</font>

800
00:31:57,200 --> 00:32:00,620
<font color="#CCCCCC">out</font><font color="#E5E5E5"> the slides</font><font color="#CCCCCC"> but there is a way to</font>

801
00:31:59,180 --> 00:32:02,780
turn<font color="#E5E5E5"> on verbose login for this it's off</font>

802
00:32:00,620 --> 00:32:04,550
by default<font color="#CCCCCC"> which</font><font color="#E5E5E5"> house getting</font><font color="#CCCCCC"> to so the</font>

803
00:32:02,780 --> 00:32:07,129
logging the verbose logging I think the

804
00:32:04,550 --> 00:32:09,080
<font color="#E5E5E5">the log file that I after doing</font><font color="#CCCCCC"> all the</font>

805
00:32:07,130 --> 00:32:10,880
demos<font color="#E5E5E5"> I looked at the log file and it</font>

806
00:32:09,080 --> 00:32:13,340
was like<font color="#CCCCCC"> 20 lines long</font><font color="#E5E5E5"> didn't have a</font>

807
00:32:10,880 --> 00:32:14,990
single<font color="#E5E5E5"> command that I ran in it you'll</font>

808
00:32:13,340 --> 00:32:17,540
see<font color="#E5E5E5"> the access for it especially</font><font color="#CCCCCC"> if you</font>

809
00:32:14,990 --> 00:32:21,020
<font color="#E5E5E5">run it remotely you'll see</font><font color="#CCCCCC"> successful</font>

810
00:32:17,540 --> 00:32:23,750
<font color="#CCCCCC">login ID 46 24 which is the successful</font>

811
00:32:21,020 --> 00:32:28,100
<font color="#E5E5E5">login ID for Windows event logs but</font><font color="#CCCCCC"> type</font>

812
00:32:23,750 --> 00:32:29,270
<font color="#CCCCCC">3 network</font><font color="#E5E5E5"> I'm pretty sure other things</font>

813
00:32:28,100 --> 00:32:30,709
are gonna fire<font color="#CCCCCC"> that but</font><font color="#E5E5E5"> for</font>

814
00:32:29,270 --> 00:32:31,940
<font color="#E5E5E5">administrator accounts that shouldn't be</font>

815
00:32:30,710 --> 00:32:35,170
<font color="#E5E5E5">firing all that often</font><font color="#CCCCCC"> unless you're</font>

816
00:32:31,940 --> 00:32:37,760
<font color="#CCCCCC">doing a lot</font><font color="#E5E5E5"> of remote activity normally</font>

817
00:32:35,170 --> 00:32:39,910
or standard infrastructure I don't think

818
00:32:37,760 --> 00:32:39,910
that's

819
00:32:40,120 --> 00:32:46,600
always audit<font color="#CCCCCC"> your admin accounts I don't</font>

820
00:32:43,150 --> 00:32:48,820
have that's something that's huge<font color="#CCCCCC"> I mean</font>

821
00:32:46,600 --> 00:32:50,199
<font color="#CCCCCC">you're normally your your admins should</font>

822
00:32:48,820 --> 00:32:51,610
be performing<font color="#E5E5E5"> I've been tasks with their</font>

823
00:32:50,200 --> 00:32:53,830
admin account and then have a separate

824
00:32:51,610 --> 00:32:56,590
account to check their email<font color="#CCCCCC"> I know I</font>

825
00:32:53,830 --> 00:32:58,000
like below it<font color="#E5E5E5"> recently I think someone</font>

826
00:32:56,590 --> 00:33:00,189
<font color="#E5E5E5">was running one as an admin and checking</font>

827
00:32:58,000 --> 00:33:02,740
their email like<font color="#CCCCCC"> they got popped</font><font color="#E5E5E5"> that</font>

828
00:33:00,190 --> 00:33:05,590
happens so make sure you audit<font color="#E5E5E5"> your</font>

829
00:33:02,740 --> 00:33:07,450
<font color="#E5E5E5">inmate accounts who has access</font><font color="#CCCCCC"> I know</font>

830
00:33:05,590 --> 00:33:10,679
your CEO wants domain admin but<font color="#E5E5E5"> receipt</font>

831
00:33:07,450 --> 00:33:10,680
partly doesn't need domain admin

832
00:33:11,450 --> 00:33:15,620
yeah so checking<font color="#E5E5E5"> for stuff with</font>

833
00:33:13,790 --> 00:33:18,350
sysinternals tools that<font color="#CCCCCC"> autoruns will</font>

834
00:33:15,620 --> 00:33:20,360
catch<font color="#E5E5E5"> this</font><font color="#CCCCCC"> and if if you try to run</font>

835
00:33:18,350 --> 00:33:22,280
PowerShell<font color="#CCCCCC"> you explicitly try to run</font>

836
00:33:20,360 --> 00:33:24,699
PowerShell<font color="#E5E5E5"> just PowerShell and then of</font>

837
00:33:22,280 --> 00:33:28,730
commands in<font color="#CCCCCC"> Auto runs will come up</font><font color="#E5E5E5"> red</font>

838
00:33:24,700 --> 00:33:29,390
which<font color="#CCCCCC"> is a big</font><font color="#E5E5E5"> big alert</font><font color="#CCCCCC"> so definitely</font>

839
00:33:28,730 --> 00:33:32,270
check<font color="#E5E5E5"> that out</font>

840
00:33:29,390 --> 00:33:34,990
<font color="#CCCCCC">Auto runs is a great tool finds things</font>

841
00:33:32,270 --> 00:33:38,680
that<font color="#CCCCCC"> run automatically</font><font color="#E5E5E5"> on your system or</font>

842
00:33:34,990 --> 00:33:42,410
pretty much any place registry

843
00:33:38,680 --> 00:33:45,590
directories<font color="#CCCCCC"> WMI all that stuff</font>

844
00:33:42,410 --> 00:33:47,450
I'm a bit under but that's<font color="#E5E5E5"> okay regular</font>

845
00:33:45,590 --> 00:33:49,429
references<font color="#E5E5E5"> check out this</font><font color="#CCCCCC"> presentation</font>

846
00:33:47,450 --> 00:33:51,590
itself<font color="#CCCCCC"> I can go back</font><font color="#E5E5E5"> to the first slide</font>

847
00:33:49,430 --> 00:33:53,630
to<font color="#CCCCCC"> give you the link to</font><font color="#E5E5E5"> it if you'd like</font>

848
00:33:51,590 --> 00:33:55,040
to grab<font color="#E5E5E5"> it the bitly link to it if you</font>

849
00:33:53,630 --> 00:33:57,080
<font color="#CCCCCC">want to grab that</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> check out the</font>

850
00:33:55,040 --> 00:33:58,340
slides<font color="#E5E5E5"> they're open to view all the</font>

851
00:33:57,080 --> 00:33:59,840
<font color="#E5E5E5">demos are on there</font>

852
00:33:58,340 --> 00:34:00,980
with<font color="#E5E5E5"> the direct link and also embedded</font>

853
00:33:59,840 --> 00:34:03,500
<font color="#E5E5E5">they said they weren't working</font><font color="#CCCCCC"> at all</font>

854
00:34:00,980 --> 00:34:04,730
last night embedded so<font color="#E5E5E5"> I'm some for some</font>

855
00:34:03,500 --> 00:34:07,190
reason things started working better

856
00:34:04,730 --> 00:34:08,210
when I gave my<font color="#CCCCCC"> presentation definitely</font>

857
00:34:07,190 --> 00:34:10,220
<font color="#CCCCCC">check out all these resources this</font><font color="#E5E5E5"> is</font>

858
00:34:08,210 --> 00:34:13,940
<font color="#E5E5E5">how I learned about this these were</font>

859
00:34:10,219 --> 00:34:15,649
great great helps the apt<font color="#E5E5E5"> 29 stuff has</font>

860
00:34:13,940 --> 00:34:18,050
there's a great write-up<font color="#E5E5E5"> on that I I did</font>

861
00:34:15,650 --> 00:34:22,400
<font color="#E5E5E5">this</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> skip I practice scheduling these</font>

862
00:34:18,050 --> 00:34:25,220
things in C++ there's a way to do<font color="#E5E5E5"> that</font>

863
00:34:22,400 --> 00:34:28,340
and some<font color="#E5E5E5"> sample code on</font><font color="#CCCCCC"> my on my</font><font color="#E5E5E5"> blog 1</font>

864
00:34:25,219 --> 00:34:30,409
by n if<font color="#CCCCCC"> you want to go there and then</font>

865
00:34:28,340 --> 00:34:32,330
<font color="#E5E5E5">the monitor malware script which</font><font color="#CCCCCC"> is on</font>

866
00:34:30,409 --> 00:34:33,859
github<font color="#CCCCCC"> it's</font><font color="#E5E5E5"> on the gist so you can grab</font>

867
00:34:32,330 --> 00:34:37,340
it<font color="#E5E5E5"> and in the</font><font color="#CCCCCC"> sims sweep repository</font>

868
00:34:33,860 --> 00:34:39,460
check that out grab it

869
00:34:37,340 --> 00:34:41,300
<font color="#CCCCCC">I said I'm a bit under but that's</font><font color="#E5E5E5"> okay</font><font color="#CCCCCC"> I</font>

870
00:34:39,460 --> 00:34:42,860
recorded my demos less<font color="#CCCCCC"> when I gave this</font>

871
00:34:41,300 --> 00:34:45,560
I did these the<font color="#E5E5E5"> demos all live but I was</font>

872
00:34:42,860 --> 00:34:49,090
paranoid this time so<font color="#CCCCCC"> show me</font>

873
00:34:45,560 --> 00:34:49,090
so questions from anybody

874
00:34:49,760 --> 00:34:53,080
pretty good hello

875
00:34:53,280 --> 00:34:55,429
what

876
00:34:56,570 --> 00:34:58,900
<font color="#E5E5E5">what</font>

877
00:34:59,220 --> 00:35:06,480
I think I'm not<font color="#E5E5E5"> 100% sure which version</font>

878
00:35:03,270 --> 00:35:08,520
the WMI commands were added in<font color="#CCCCCC"> I want to</font>

879
00:35:06,480 --> 00:35:11,040
say anything beyond<font color="#E5E5E5"> PowerShell 3 you're</font>

880
00:35:08,520 --> 00:35:13,230
perfectly<font color="#CCCCCC"> safe but that's</font><font color="#E5E5E5"> the case for</font>

881
00:35:11,040 --> 00:35:16,080
<font color="#CCCCCC">most stuff</font><font color="#E5E5E5"> I'd have to look into that</font>

882
00:35:13,230 --> 00:35:18,180
<font color="#E5E5E5">more closely</font><font color="#CCCCCC"> when in doubt you can</font><font color="#E5E5E5"> use</font>

883
00:35:16,080 --> 00:35:20,370
wmic<font color="#CCCCCC"> and wmic will allow you to</font><font color="#E5E5E5"> do all</font>

884
00:35:18,180 --> 00:35:23,940
<font color="#CCCCCC">the same things and it's on it should</font><font color="#E5E5E5"> be</font>

885
00:35:20,370 --> 00:35:26,100
<font color="#CCCCCC">on</font><font color="#E5E5E5"> everything since 2000 Windows 2000 so</font>

886
00:35:23,940 --> 00:35:27,870
our<font color="#E5E5E5"> shells nice it allows you</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> work</font>

887
00:35:26,100 --> 00:35:30,690
with objects very<font color="#E5E5E5"> nicely but it's</font>

888
00:35:27,870 --> 00:35:34,040
<font color="#CCCCCC">definitely uh</font><font color="#E5E5E5"> you can do it with wmic or</font>

889
00:35:30,690 --> 00:35:34,040
in<font color="#CCCCCC"> c++ with the windows api</font>

890
00:35:40,490 --> 00:35:46,620
that's a that's<font color="#CCCCCC"> a good point so I had</font><font color="#E5E5E5"> my</font>

891
00:35:44,280 --> 00:35:49,020
demos have like select blank within<font color="#CCCCCC"> our</font>

892
00:35:46,620 --> 00:35:51,060
select star from blank within<font color="#CCCCCC"> 5 within</font>

893
00:35:49,020 --> 00:35:52,530
15<font color="#E5E5E5"> don't do that if you're gonna run</font>

894
00:35:51,060 --> 00:35:54,810
this if you're gonna run<font color="#E5E5E5"> these normally</font>

895
00:35:52,530 --> 00:35:56,850
do them don't do them anything<font color="#E5E5E5"> under 30</font>

896
00:35:54,810 --> 00:35:58,529
because<font color="#E5E5E5"> that's querying this thing over</font>

897
00:35:56,850 --> 00:35:59,819
<font color="#CCCCCC">and over and over</font><font color="#E5E5E5"> again that's</font>

898
00:35:58,530 --> 00:36:03,800
<font color="#E5E5E5">definitely not something you want</font><font color="#CCCCCC"> to do</font>

899
00:35:59,820 --> 00:36:03,800
on a regular regular basis

900
00:36:04,690 --> 00:36:08,890
and he said there's some some versions

901
00:36:07,630 --> 00:36:12,060
that<font color="#E5E5E5"> will cause a few spikes just</font>

902
00:36:08,890 --> 00:36:12,060
regardless right

903
00:36:12,670 --> 00:36:16,530
particular<font color="#E5E5E5"> okay Oh watch out for</font><font color="#CCCCCC"> that</font>

904
00:36:14,619 --> 00:36:19,900
test<font color="#E5E5E5"> this if you're</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> deploy</font><font color="#CCCCCC"> it</font>

905
00:36:16,530 --> 00:36:22,530
that's with anything get a<font color="#E5E5E5"> question and</font>

906
00:36:19,900 --> 00:36:22,530
do your question

907
00:36:30,490 --> 00:36:32,549
you

908
00:36:34,980 --> 00:36:38,840
<font color="#CCCCCC">I don't I don't think</font>

909
00:36:36,890 --> 00:36:41,000
wmic has that capability<font color="#CCCCCC"> I think it just</font>

910
00:36:38,840 --> 00:36:42,290
<font color="#E5E5E5">specified computer name and then you can</font>

911
00:36:41,000 --> 00:36:45,520
specify user name and password<font color="#CCCCCC"> and allow</font>

912
00:36:42,290 --> 00:36:45,520
you<font color="#E5E5E5"> to execute stuff</font>

913
00:36:45,960 --> 00:36:50,640
I know<font color="#E5E5E5"> PowerShell will allow you to do</font>

914
00:36:48,390 --> 00:36:52,069
it but I'm almost 100% sure that<font color="#CCCCCC"> you can</font>

915
00:36:50,640 --> 00:36:54,810
do it with wmic

916
00:36:52,070 --> 00:36:56,730
<font color="#E5E5E5">so as I covered before I think I skipped</font>

917
00:36:54,810 --> 00:37:00,480
over<font color="#E5E5E5"> that part actually</font><font color="#CCCCCC"> you can run this</font>

918
00:36:56,730 --> 00:37:01,950
via normal<font color="#E5E5E5"> PowerShell remoting</font><font color="#CCCCCC"> either</font>

919
00:37:00,480 --> 00:37:04,410
the non-encrypted or the<font color="#E5E5E5"> encrypted</font>

920
00:37:01,950 --> 00:37:07,710
<font color="#CCCCCC">version you can also</font><font color="#E5E5E5"> run it over port</font>

921
00:37:04,410 --> 00:37:10,649
135<font color="#CCCCCC"> I have a challenge that I'm running</font>

922
00:37:07,710 --> 00:37:12,270
<font color="#E5E5E5">for my company</font><font color="#CCCCCC"> that one of the problems</font>

923
00:37:10,650 --> 00:37:15,210
<font color="#E5E5E5">you literally have</font><font color="#CCCCCC"> to connect to</font><font color="#E5E5E5"> it's</font>

924
00:37:12,270 --> 00:37:16,350
<font color="#E5E5E5">just</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> 135 open and then RPC that's</font>

925
00:37:15,210 --> 00:37:18,790
the only port open and you can

926
00:37:16,350 --> 00:37:21,509
compromise the<font color="#E5E5E5"> host completely</font>

927
00:37:18,790 --> 00:37:21,509
<font color="#CCCCCC">regal</font>

928
00:37:22,070 --> 00:37:26,490
with credit<font color="#E5E5E5"> secret but</font><font color="#CCCCCC"> that is somewhere</font>

929
00:37:25,100 --> 00:37:28,650
<font color="#CCCCCC">else</font>

930
00:37:26,490 --> 00:37:32,220
hopefully nobody that's on that

931
00:37:28,650 --> 00:37:34,760
challenge<font color="#CCCCCC"> what yeah</font><font color="#E5E5E5"> okay</font><font color="#CCCCCC"> anyone</font><font color="#E5E5E5"> else</font>

932
00:37:32,220 --> 00:37:34,759
<font color="#E5E5E5">have you questions</font>

933
00:37:35,180 --> 00:37:38,919
yes<font color="#E5E5E5"> I can do that yeah please</font>

934
00:37:41,640 --> 00:37:47,089
you're gonna take a picture<font color="#E5E5E5"> one slide</font><font color="#CCCCCC"> is</font>

935
00:37:44,490 --> 00:37:47,089
<font color="#CCCCCC">to</font><font color="#E5E5E5"> be the one</font>

936
00:37:47,670 --> 00:37:51,270
because this<font color="#E5E5E5"> has the link</font><font color="#CCCCCC"> we'll try</font><font color="#E5E5E5"> to</font>

937
00:37:49,950 --> 00:37:53,450
put<font color="#CCCCCC"> the link up on</font><font color="#E5E5E5"> the YouTube</font><font color="#CCCCCC"> video as</font>

938
00:37:51,270 --> 00:37:53,450
well

939
00:37:55,180 --> 00:38:00,710
the slides

940
00:37:56,940 --> 00:38:00,710
<font color="#E5E5E5">check that out follow me on Twitter</font>

941
00:38:05,509 --> 00:38:07,569
you

942
00:38:08,700 --> 00:38:15,089
I'm not sure if there's a way to do

943
00:38:11,010 --> 00:38:18,900
specific like<font color="#E5E5E5"> disabling specific methods</font>

944
00:38:15,089 --> 00:38:23,310
<font color="#CCCCCC">if you disable WMI as a whole your</font>

945
00:38:18,900 --> 00:38:25,020
system will<font color="#E5E5E5"> not function so I think it's</font>

946
00:38:23,310 --> 00:38:27,000
kind<font color="#CCCCCC"> of an all-or-none kind of thing if</font>

947
00:38:25,020 --> 00:38:29,579
you have that admin access<font color="#CCCCCC"> you</font><font color="#E5E5E5"> have</font>

948
00:38:27,000 --> 00:38:31,020
access<font color="#CCCCCC"> to that port like kind of</font><font color="#E5E5E5"> game</font>

949
00:38:29,579 --> 00:38:33,829
<font color="#E5E5E5">over if somebody wants to</font><font color="#CCCCCC"> use it and</font><font color="#E5E5E5"> you</font>

950
00:38:31,020 --> 00:38:33,829
<font color="#CCCCCC">don't have a good egress filtering</font>

951
00:38:34,560 --> 00:38:37,110
but if<font color="#CCCCCC"> you someone has</font><font color="#E5E5E5"> your admin</font>

952
00:38:36,000 --> 00:38:40,730
password you've got bigger<font color="#CCCCCC"> issues than</font>

953
00:38:37,110 --> 00:38:40,730
<font color="#CCCCCC">that one host I think</font>

954
00:38:42,010 --> 00:38:45,670
<font color="#CCCCCC">alright anybody else</font>

955
00:38:44,320 --> 00:38:46,900
<font color="#CCCCCC">I think you get so</font><font color="#E5E5E5"> much for coming I</font>

956
00:38:45,670 --> 00:38:48,970
really<font color="#E5E5E5"> appreciate it hopefully it was</font>

957
00:38:46,900 --> 00:38:52,000
<font color="#E5E5E5">informative for you and you can use it</font>

958
00:38:48,970 --> 00:38:53,740
<font color="#E5E5E5">in some way in your jobs and tell people</font>

959
00:38:52,000 --> 00:38:55,030
<font color="#CCCCCC">about</font><font color="#E5E5E5"> it</font>

960
00:38:53,740 --> 00:38:59,468
<font color="#E5E5E5">Thanks</font>

961
00:38:55,030 --> 00:38:59,469
[Applause]

