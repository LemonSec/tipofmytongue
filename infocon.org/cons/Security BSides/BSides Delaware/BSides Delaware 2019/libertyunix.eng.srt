1
00:00:02,520 --> 00:00:06,630
all right so I'll give a shorter

2
00:00:04,800 --> 00:00:08,280
introduction to myself we'll talk about

3
00:00:06,630 --> 00:00:10,290
the basics at ble we'll talk about its

4
00:00:08,280 --> 00:00:11,668
architecture a bunch of different tools

5
00:00:10,290 --> 00:00:13,258
and examples of how you can mess around

6
00:00:11,669 --> 00:00:14,940
with the protocol or get to learn better

7
00:00:13,259 --> 00:00:16,710
and then as always with these

8
00:00:14,940 --> 00:00:18,869
conferences here to answer any and all

9
00:00:16,710 --> 00:00:20,099
questions and your feedback also if you

10
00:00:18,869 --> 00:00:22,529
think I said something wrong or you have

11
00:00:20,099 --> 00:00:23,240
a better fact about something pull me

12
00:00:22,529 --> 00:00:25,220
out please

13
00:00:23,240 --> 00:00:27,448
so again a little bit about myself

14
00:00:25,220 --> 00:00:29,698
during the 9 to 5 on the red team

15
00:00:27,449 --> 00:00:31,439
analyst at Vanguard I'm outside of that

16
00:00:29,699 --> 00:00:33,780
I again teach at Drexel University in

17
00:00:31,439 --> 00:00:34,830
their cybersecurity College in their

18
00:00:33,780 --> 00:00:36,150
Engineering College they have an

19
00:00:34,830 --> 00:00:37,710
informatics cool so I'm kind of all over

20
00:00:36,150 --> 00:00:39,989
the place you could have me for

21
00:00:37,710 --> 00:00:41,910
forensics intro to cyber all that

22
00:00:39,990 --> 00:00:43,320
different stuff outside of all the zeros

23
00:00:41,910 --> 00:00:45,269
and ones I'm also the coach of the

24
00:00:43,320 --> 00:00:47,100
Women's National Team that picture on

25
00:00:45,270 --> 00:00:49,110
the left is the women's USA inline

26
00:00:47,100 --> 00:00:50,730
hockey team they've won the past three

27
00:00:49,110 --> 00:00:54,170
World Championships back to back to back

28
00:00:50,730 --> 00:00:56,430
give them a quick round of applause I

29
00:00:54,170 --> 00:00:58,680
have the easiest job in the world I just

30
00:00:56,430 --> 00:01:00,269
open the door and say next right it's

31
00:00:58,680 --> 00:01:01,890
pretty straightforward if you're in the

32
00:01:00,270 --> 00:01:04,140
Philadelphia area and you're looking for

33
00:01:01,890 --> 00:01:05,459
a meet-up that does some hands-on

34
00:01:04,140 --> 00:01:07,170
learning and you're trying to be curious

35
00:01:05,459 --> 00:01:09,509
there's a meet-up at Drexel called the

36
00:01:07,170 --> 00:01:11,399
security shell I mean a couple other

37
00:01:09,509 --> 00:01:13,859
people manage that and run that and our

38
00:01:11,399 --> 00:01:15,600
whole purpose is to get conferences and

39
00:01:13,859 --> 00:01:17,100
information like this but disseminated a

40
00:01:15,600 --> 00:01:19,499
little bit quicker to maybe a smaller

41
00:01:17,100 --> 00:01:21,089
audience on a monthly scale instead of

42
00:01:19,499 --> 00:01:23,460
something you got to wait a quarter for

43
00:01:21,090 --> 00:01:25,200
our b-sides for what chief Learning

44
00:01:23,460 --> 00:01:27,538
Officer means is I play my bass in a

45
00:01:25,200 --> 00:01:29,520
line I show people stuff so not really

46
00:01:27,539 --> 00:01:31,530
that impressive one of the first things

47
00:01:29,520 --> 00:01:32,999
I came across when looking at Bluetooth

48
00:01:31,530 --> 00:01:34,530
Low Energy is what's the difference

49
00:01:32,999 --> 00:01:36,479
between what we've been calling

50
00:01:34,530 --> 00:01:38,999
Bluetooth for you know five six seven

51
00:01:36,479 --> 00:01:41,369
years etc and what's this smart ready

52
00:01:38,999 --> 00:01:43,289
and what's Bluetooth smart so very

53
00:01:41,369 --> 00:01:44,670
simply your regular Bluetooth is for

54
00:01:43,289 --> 00:01:46,679
what we call or what we will call

55
00:01:44,670 --> 00:01:48,869
enriched data so large amounts of

56
00:01:46,679 --> 00:01:50,880
information like a VoIP call or your

57
00:01:48,869 --> 00:01:53,639
Spotify playlist things of that extent

58
00:01:50,880 --> 00:01:55,829
Bluetooth smart ready is a device that

59
00:01:53,639 --> 00:01:57,749
can have enriched data like those calls

60
00:01:55,829 --> 00:02:00,029
but it can also be a thing it can it can

61
00:01:57,749 --> 00:02:02,310
mesh network it can create a cluster of

62
00:02:00,030 --> 00:02:04,799
other ble devices and it can so it's got

63
00:02:02,310 --> 00:02:05,880
both abilities and then blue to smart is

64
00:02:04,799 --> 00:02:07,799
they've completely dropped the

65
00:02:05,880 --> 00:02:10,109
traditional Bluetooth protocol and they

66
00:02:07,799 --> 00:02:12,810
are only ble that's Bluetooth Low Energy

67
00:02:10,110 --> 00:02:14,110
that's where the smart idea comms comes

68
00:02:12,810 --> 00:02:15,730
from

69
00:02:14,110 --> 00:02:17,440
what's the point of Bluetooth Low Energy

70
00:02:15,730 --> 00:02:19,570
what's it why is it different than

71
00:02:17,440 --> 00:02:21,520
Bluetooth with the introduction and the

72
00:02:19,570 --> 00:02:24,100
scalability of Internet of Things we

73
00:02:21,520 --> 00:02:25,780
needed a protocol that wasn't ZigBee is

74
00:02:24,100 --> 00:02:28,510
that's probably the worst IOT protocol

75
00:02:25,780 --> 00:02:30,220
it was ever written we're starting to

76
00:02:28,510 --> 00:02:31,989
wean off a ZigBee because that was

77
00:02:30,220 --> 00:02:34,060
popular before ble there wasn't an

78
00:02:31,990 --> 00:02:36,480
alternative in the 2.4 gigahertz

79
00:02:34,060 --> 00:02:39,190
spectrum so we had the ZigBee Alliance

80
00:02:36,480 --> 00:02:41,859
but now we have boa it's optimized for

81
00:02:39,190 --> 00:02:44,470
low-power again it's in that 2.4

82
00:02:41,860 --> 00:02:46,240
gigahertz is M band so if you have your

83
00:02:44,470 --> 00:02:49,330
hack RF for different tools that's where

84
00:02:46,240 --> 00:02:51,250
you have a tuned tool into simple state

85
00:02:49,330 --> 00:02:53,530
one-off interactions so again not a lot

86
00:02:51,250 --> 00:02:55,780
of informations getting sent is the door

87
00:02:53,530 --> 00:02:58,390
open is the door closed what's my blood

88
00:02:55,780 --> 00:03:00,040
pressure what's my insulin count a lot

89
00:02:58,390 --> 00:03:01,089
of these smart diabetic and insulin

90
00:03:00,040 --> 00:03:03,280
pumps are using ble

91
00:03:01,090 --> 00:03:05,470
to talk from the sensor that's in the

92
00:03:03,280 --> 00:03:07,060
patient up to the pump to then relay

93
00:03:05,470 --> 00:03:08,859
what sugar should be or insulin excuse

94
00:03:07,060 --> 00:03:12,400
me should be put back into that patient

95
00:03:08,860 --> 00:03:14,230
body so 2.4 versus 5 you'll see

96
00:03:12,400 --> 00:03:15,850
different versions of the ble protocol

97
00:03:14,230 --> 00:03:19,690
with everything that's just grown in its

98
00:03:15,850 --> 00:03:21,609
maturity of both security and speed

99
00:03:19,690 --> 00:03:24,609
so here's a quick example kind of how we

100
00:03:21,610 --> 00:03:26,590
scaled from 4.0 up to 5 you can see that

101
00:03:24,610 --> 00:03:28,000
throughput has gotten a lot better some

102
00:03:26,590 --> 00:03:30,610
of the things that's introduced with 5

103
00:03:28,000 --> 00:03:32,860
that will be utilized by the industry is

104
00:03:30,610 --> 00:03:35,350
the beacon concept so we can now track

105
00:03:32,860 --> 00:03:37,510
individuals in our stores and see if

106
00:03:35,350 --> 00:03:41,560
Susan spent a certain amount of time at

107
00:03:37,510 --> 00:03:43,149
this aisle maybe Susan is expecting put

108
00:03:41,560 --> 00:03:45,070
an actual incident where someone sent

109
00:03:43,150 --> 00:03:46,390
baby formula the sewing because they use

110
00:03:45,070 --> 00:03:48,070
some of these tools and thought they

111
00:03:46,390 --> 00:03:49,239
were marketing correctly and the

112
00:03:48,070 --> 00:03:51,910
individual wound up having a miscarriage

113
00:03:49,240 --> 00:03:53,470
and sued the company who sent them the

114
00:03:51,910 --> 00:03:56,020
letter because it was you know after the

115
00:03:53,470 --> 00:03:57,880
fact and they didn't like that though

116
00:03:56,020 --> 00:03:59,770
it's used a lot in stores it's used a

117
00:03:57,880 --> 00:04:01,450
lot in things one of the things that I

118
00:03:59,770 --> 00:04:01,900
wanted to find when I was first studying

119
00:04:01,450 --> 00:04:03,850
Billy

120
00:04:01,900 --> 00:04:05,800
is how do I bring it back to like the

121
00:04:03,850 --> 00:04:08,079
tcp/ip right I came from a network

122
00:04:05,800 --> 00:04:10,360
background and a network engineer so

123
00:04:08,080 --> 00:04:13,330
what are we calling this l2 cap and what

124
00:04:10,360 --> 00:04:14,890
is that at my layer 3 network level all

125
00:04:13,330 --> 00:04:17,140
right so that's basically its IP address

126
00:04:14,890 --> 00:04:18,159
I can I can visualize that and you start

127
00:04:17,140 --> 00:04:20,140
to work your way and we'll do this

128
00:04:18,160 --> 00:04:21,820
throughout the presentation up the stack

129
00:04:20,140 --> 00:04:23,440
and you will correlate with what's

130
00:04:21,820 --> 00:04:27,210
actually happening from a tcp/ip

131
00:04:23,440 --> 00:04:27,210
standpoint or the OSI model

132
00:04:27,780 --> 00:04:32,280
so BOE has two different types of

133
00:04:29,880 --> 00:04:34,800
channels there's an advertising channel

134
00:04:32,280 --> 00:04:37,200
hey I'm a device at least someone

135
00:04:34,800 --> 00:04:39,270
connected me here's how long I'll wait

136
00:04:37,200 --> 00:04:41,580
for a connection things like that and

137
00:04:39,270 --> 00:04:43,469
then once you make a connection there's

138
00:04:41,580 --> 00:04:45,690
then the data channel and one of the

139
00:04:43,470 --> 00:04:47,400
interesting things about BOE is that it

140
00:04:45,690 --> 00:04:51,780
has a lot of different data channels to

141
00:04:47,400 --> 00:04:54,539
choose from so in the red there's 37 38

142
00:04:51,780 --> 00:04:56,760
and 39 are the advertising channels

143
00:04:54,540 --> 00:04:59,670
everything else in this spectrum is

144
00:04:56,760 --> 00:05:01,469
meant for data to be transferred what's

145
00:04:59,670 --> 00:05:03,780
interesting about this is if you look at

146
00:05:01,470 --> 00:05:05,100
like 802 11 you need one of the things

147
00:05:03,780 --> 00:05:07,169
you go into your router and say like

148
00:05:05,100 --> 00:05:08,669
this is channel 11 for argument you

149
00:05:07,169 --> 00:05:09,870
would change the router to channel 6

150
00:05:08,669 --> 00:05:11,729
because you can notice that everyone in

151
00:05:09,870 --> 00:05:14,490
your neighborhood is using channel 11

152
00:05:11,730 --> 00:05:15,390
you want to get less interference with

153
00:05:14,490 --> 00:05:17,940
Bluetooth Low Energy

154
00:05:15,390 --> 00:05:20,039
all these frequency channels or a fair

155
00:05:17,940 --> 00:05:22,380
game it's up to the engineer in their

156
00:05:20,040 --> 00:05:24,600
code to specify Al they're gonna hop

157
00:05:22,380 --> 00:05:26,159
around these channels so during that

158
00:05:24,600 --> 00:05:28,860
connection request that we talked about

159
00:05:26,160 --> 00:05:31,200
that the advertising channel does will

160
00:05:28,860 --> 00:05:32,729
be some information about what channels

161
00:05:31,200 --> 00:05:36,030
are gonna be used what algorithm are we

162
00:05:32,729 --> 00:05:38,490
gonna use to hop so again in device

163
00:05:36,030 --> 00:05:39,989
discovery we're advertising The Voice is

164
00:05:38,490 --> 00:05:42,060
looking to be covered then we have a

165
00:05:39,990 --> 00:05:44,729
scanner this is your phone you know

166
00:05:42,060 --> 00:05:47,130
Bluetooth low-energy device's nearby and

167
00:05:44,729 --> 00:05:49,110
you have a whole list of tiles and Mart

168
00:05:47,130 --> 00:05:51,719
locks and all these watches now Apple's

169
00:05:49,110 --> 00:05:53,790
a large list or though all the wearables

170
00:05:51,720 --> 00:05:55,260
and what you're looking for

171
00:05:53,790 --> 00:05:58,110
when you're trying to assess a Bluetooth

172
00:05:55,260 --> 00:05:59,640
device is this connection request is

173
00:05:58,110 --> 00:06:01,050
what's in that connection request and we

174
00:05:59,640 --> 00:06:03,390
have a screen shot of one of the packets

175
00:06:01,050 --> 00:06:05,790
is all the information that you're gonna

176
00:06:03,390 --> 00:06:08,130
need to then follow that device again

177
00:06:05,790 --> 00:06:10,380
across all these channels is it's not

178
00:06:08,130 --> 00:06:11,760
going to just do one two and three one

179
00:06:10,380 --> 00:06:15,000
two and three it's got to hop around and

180
00:06:11,760 --> 00:06:16,620
that's specified in the code itself so

181
00:06:15,000 --> 00:06:18,210
again from a device connection

182
00:06:16,620 --> 00:06:21,419
standpoint we have the advertisers who

183
00:06:18,210 --> 00:06:23,580
accept the initiate the request from the

184
00:06:21,419 --> 00:06:25,530
scanner and then the master who was

185
00:06:23,580 --> 00:06:27,150
originally the scanner that doesn't

186
00:06:25,530 --> 00:06:29,219
sound like anything until you view this

187
00:06:27,150 --> 00:06:30,599
picture picture does a pretty good job

188
00:06:29,220 --> 00:06:33,240
of kind of visualizing what I just

189
00:06:30,600 --> 00:06:35,040
described we have the initial scanning

190
00:06:33,240 --> 00:06:36,419
and then the initiation we have the

191
00:06:35,040 --> 00:06:38,250
advertising going on at the same time

192
00:06:36,419 --> 00:06:40,590
and when both these slaves and masters

193
00:06:38,250 --> 00:06:41,580
come together they create a connection

194
00:06:40,590 --> 00:06:43,229
request one pack

195
00:06:41,580 --> 00:06:45,449
gets sent to the other device and then

196
00:06:43,229 --> 00:06:48,090
they'll start to send data on that data

197
00:06:45,449 --> 00:06:51,300
Channel you may see an advertising

198
00:06:48,090 --> 00:06:52,859
request on channel 37 and then a data

199
00:06:51,300 --> 00:06:55,169
channel happens somewhere else so if

200
00:06:52,860 --> 00:06:56,550
you've ever used the uber tooth and you

201
00:06:55,169 --> 00:06:58,349
go you know you're looking at the uber

202
00:06:56,550 --> 00:07:00,120
tooth documentation 101 one of the first

203
00:06:58,349 --> 00:07:02,550
thing it says when you try to look at a

204
00:07:00,120 --> 00:07:04,830
connection is to use the tack F flag so

205
00:07:02,550 --> 00:07:07,500
you'll deliver to tack F and then your

206
00:07:04,830 --> 00:07:09,240
device that means follow was so a Bluth

207
00:07:07,500 --> 00:07:11,189
what uber tooth doing is it's listening

208
00:07:09,240 --> 00:07:12,960
for one of these advertising requests

209
00:07:11,189 --> 00:07:14,639
picking out the channel hopping

210
00:07:12,960 --> 00:07:16,620
algorithm and then it's going to follow

211
00:07:14,639 --> 00:07:18,569
the device along its communication and

212
00:07:16,620 --> 00:07:21,500
hopefully catch read and writes to and

213
00:07:18,569 --> 00:07:23,420
from the ble devices

214
00:07:21,500 --> 00:07:25,250
that's what it looks at visually if you

215
00:07:23,420 --> 00:07:28,160
want understanding how one piece of

216
00:07:25,250 --> 00:07:30,290
communication again hopping across all

217
00:07:28,160 --> 00:07:31,970
these channels this is again this is

218
00:07:30,290 --> 00:07:34,430
time correlation part of the frequency

219
00:07:31,970 --> 00:07:35,720
so you can see the orange link the green

220
00:07:34,430 --> 00:07:38,360
link and the blue link are all different

221
00:07:35,720 --> 00:07:41,180
conversations they're all happening on a

222
00:07:38,360 --> 00:07:43,040
2.4 gigahertz spectrum they're all ble

223
00:07:41,180 --> 00:07:44,570
connections one of the questions I get

224
00:07:43,040 --> 00:07:47,720
asked a lot is how do they not run into

225
00:07:44,570 --> 00:07:49,640
each other how do I join this band and

226
00:07:47,720 --> 00:07:51,770
then not bounce off orange every time or

227
00:07:49,640 --> 00:07:54,349
run into it right how do we not have an

228
00:07:51,770 --> 00:07:56,479
IP address conflict if technically

229
00:07:54,350 --> 00:07:57,740
there's no DHCP server right that's

230
00:07:56,480 --> 00:08:00,050
handing out these addresses for all

231
00:07:57,740 --> 00:08:01,850
these rogue ble devices how do they mesh

232
00:08:00,050 --> 00:08:04,340
without running into each other that's

233
00:08:01,850 --> 00:08:06,080
what we'll call an access address the

234
00:08:04,340 --> 00:08:07,940
access address is what the ble device

235
00:08:06,080 --> 00:08:10,400
broadcast as part of that connection

236
00:08:07,940 --> 00:08:12,440
request that when you join this channel

237
00:08:10,400 --> 00:08:13,909
and start hopping you know what devices

238
00:08:12,440 --> 00:08:16,250
to talk to because you're only talking

239
00:08:13,910 --> 00:08:19,010
to that access address or that

240
00:08:16,250 --> 00:08:20,210
quote-unquote IP address if you dig back

241
00:08:19,010 --> 00:08:21,650
into the slides again I'll make them

242
00:08:20,210 --> 00:08:23,450
available if you want it to take this

243
00:08:21,650 --> 00:08:25,340
home and dig into it it's that slide

244
00:08:23,450 --> 00:08:32,840
that showed you the comparison of ble to

245
00:08:25,340 --> 00:08:35,539
the TCP stack so one of the things I try

246
00:08:32,840 --> 00:08:37,789
to teach myself as if I was an engineer

247
00:08:35,539 --> 00:08:39,380
with zero knowledge right so what would

248
00:08:37,789 --> 00:08:41,299
I do is a low-level engineer and I was

249
00:08:39,380 --> 00:08:43,070
tasked with the project that make this

250
00:08:41,299 --> 00:08:45,500
ble device happen or make it ble

251
00:08:43,070 --> 00:08:47,090
smartlock one of the papers I came

252
00:08:45,500 --> 00:08:49,370
across and one of the things I started

253
00:08:47,090 --> 00:08:50,810
to realize before I even discovered the

254
00:08:49,370 --> 00:08:52,460
advertising channels and things like

255
00:08:50,810 --> 00:08:54,800
that is only certain channels are used

256
00:08:52,460 --> 00:08:56,960
by ble devices so one of my main

257
00:08:54,800 --> 00:08:59,599
questions well how do we determine said

258
00:08:56,960 --> 00:09:03,230
channels versus advertising data that's

259
00:08:59,600 --> 00:09:04,850
right anyone ever heard of MATLAB right

260
00:09:03,230 --> 00:09:06,470
so it's the engineering software there's

261
00:09:04,850 --> 00:09:08,089
a lot of really advanced simulation so

262
00:09:06,470 --> 00:09:10,010
that's one of the things quote-unquote I

263
00:09:08,089 --> 00:09:12,410
leveraged in reverse engineering I was

264
00:09:10,010 --> 00:09:14,540
looking at MATLAB and I asked MATLAB and

265
00:09:12,410 --> 00:09:16,250
all their documentation where is your

266
00:09:14,540 --> 00:09:19,219
101 on creating Bluetooth Low Energy

267
00:09:16,250 --> 00:09:20,660
devices this is a screenshot from MATLAB

268
00:09:19,220 --> 00:09:23,000
and kind of how they walk you through

269
00:09:20,660 --> 00:09:25,310
creating a device and as you can see we

270
00:09:23,000 --> 00:09:27,950
specify an Access address and then we

271
00:09:25,310 --> 00:09:29,660
specify channels used so these are the

272
00:09:27,950 --> 00:09:31,400
channels that the device will hop around

273
00:09:29,660 --> 00:09:32,990
during its communication but that's

274
00:09:31,400 --> 00:09:34,520
totally up to the developer at the time

275
00:09:32,990 --> 00:09:34,710
of developing what channels are used so

276
00:09:34,520 --> 00:09:36,630
it's

277
00:09:34,710 --> 00:09:38,100
not going to be once I find out how one

278
00:09:36,630 --> 00:09:39,750
device hops they're all gonna hop the

279
00:09:38,100 --> 00:09:40,980
same that's part of it

280
00:09:39,750 --> 00:09:42,780
even the thought of following a

281
00:09:40,980 --> 00:09:44,310
Bluetooth low-energy device is you have

282
00:09:42,780 --> 00:09:45,839
to connect you have to grab the

283
00:09:44,310 --> 00:09:48,119
connection request first and then all

284
00:09:45,840 --> 00:09:49,290
the sub of quench all packets are able

285
00:09:48,120 --> 00:09:52,470
to be followed but without that

286
00:09:49,290 --> 00:09:54,420
information you're kind of stuck

287
00:09:52,470 --> 00:09:56,040
so again what's in this connection

288
00:09:54,420 --> 00:09:58,410
request we've been talking about it

289
00:09:56,040 --> 00:10:01,230
wave latency which is very interesting

290
00:09:58,410 --> 00:10:03,839
how often should I listen you may catch

291
00:10:01,230 --> 00:10:05,430
a device writing to one device and in

292
00:10:03,839 --> 00:10:07,379
that connection request packet it says I

293
00:10:05,430 --> 00:10:09,329
wake up every 30 minutes and check in

294
00:10:07,379 --> 00:10:11,220
now you know if you're gonna write to

295
00:10:09,329 --> 00:10:12,540
that device if it's outside of that 30

296
00:10:11,220 --> 00:10:14,399
minute window it's never going to accept

297
00:10:12,540 --> 00:10:16,290
your information you only listens at

298
00:10:14,399 --> 00:10:18,779
that interval you have to plan your

299
00:10:16,290 --> 00:10:21,120
attack around it another interesting one

300
00:10:18,779 --> 00:10:23,399
is the supervision time out what's the

301
00:10:21,120 --> 00:10:25,350
max time between two receives data

302
00:10:23,399 --> 00:10:27,959
packets before I consider the connection

303
00:10:25,350 --> 00:10:30,060
lost so if you go and send the unlock

304
00:10:27,959 --> 00:10:31,500
command from your phone to your door is

305
00:10:30,060 --> 00:10:34,109
your door sitting there waiting for

306
00:10:31,500 --> 00:10:36,209
another seven minutes and potential

307
00:10:34,110 --> 00:10:38,220
another unlock code and could I replay

308
00:10:36,209 --> 00:10:40,560
that same code back and what it worked

309
00:10:38,220 --> 00:10:42,480
we have a video of a smart lock where we

310
00:10:40,560 --> 00:10:45,439
do that exact thing we we captured in

311
00:10:42,480 --> 00:10:48,269
the lab someone unlocking the device and

312
00:10:45,439 --> 00:10:49,439
then we were able to then replay it so

313
00:10:48,269 --> 00:10:50,519
it's a very important part you might

314
00:10:49,439 --> 00:10:53,569
want to remember it for later

315
00:10:50,519 --> 00:10:55,980
once you get connected from the BOE

316
00:10:53,569 --> 00:10:57,509
connection request you're now starting

317
00:10:55,980 --> 00:11:00,600
to transfer information so you need to

318
00:10:57,509 --> 00:11:02,430
have a process to do that in bluetooth

319
00:11:00,600 --> 00:11:05,380
we call that the gap or the generic

320
00:11:02,430 --> 00:11:07,810
access profile

321
00:11:05,380 --> 00:11:09,160
again its job in the beginning when

322
00:11:07,810 --> 00:11:12,099
you're just broadcasting it will handle

323
00:11:09,160 --> 00:11:14,680
the broadcast requests it will initially

324
00:11:12,100 --> 00:11:16,450
get you connected with beer peers and

325
00:11:14,680 --> 00:11:18,640
will also establish a secure connection

326
00:11:16,450 --> 00:11:19,660
which we know is device pairing so

327
00:11:18,640 --> 00:11:21,670
there's a couple ways that the Vice

328
00:11:19,660 --> 00:11:23,020
param there's just works this works is

329
00:11:21,670 --> 00:11:25,240
when you click the ble device and you

330
00:11:23,020 --> 00:11:27,010
just get connected sometimes there's a

331
00:11:25,240 --> 00:11:29,020
passcode repeat the code that's on my

332
00:11:27,010 --> 00:11:30,310
screen into this device or you know

333
00:11:29,020 --> 00:11:32,050
you're joining your phone to your car is

334
00:11:30,310 --> 00:11:33,699
what you see on your cars informatics

335
00:11:32,050 --> 00:11:38,050
system the same as your phone that's

336
00:11:33,700 --> 00:11:40,390
part of handling the profile itself so

337
00:11:38,050 --> 00:11:42,760
the gap has some other roles again we

338
00:11:40,390 --> 00:11:44,080
talked about it being a broadcaster one

339
00:11:42,760 --> 00:11:46,240
of the main differences we mentioned

340
00:11:44,080 --> 00:11:48,520
between Bluetooth and boa is its ability

341
00:11:46,240 --> 00:11:49,870
to mesh network so think of IOT in the

342
00:11:48,520 --> 00:11:51,730
storefront where we want to lay a bunch

343
00:11:49,870 --> 00:11:54,100
of beacons and sensors down and have

344
00:11:51,730 --> 00:11:55,690
them all be able to relay back that's

345
00:11:54,100 --> 00:11:56,980
what we call central and then we have

346
00:11:55,690 --> 00:11:59,350
devices that connect to that your

347
00:11:56,980 --> 00:12:00,760
peripherals and then an observer it's

348
00:11:59,350 --> 00:12:05,080
just someone who's looking for that

349
00:12:00,760 --> 00:12:06,490
advertising data so again words visual

350
00:12:05,080 --> 00:12:08,230
words digital is kind of how the

351
00:12:06,490 --> 00:12:10,150
presentation will work here's what it

352
00:12:08,230 --> 00:12:12,070
would look like if the red circle was

353
00:12:10,150 --> 00:12:14,260
the central hub and we'll say target and

354
00:12:12,070 --> 00:12:15,820
then all our other sensors were put

355
00:12:14,260 --> 00:12:17,710
throughout the store they will mesh

356
00:12:15,820 --> 00:12:19,210
network themselves and they will altima

357
00:12:17,710 --> 00:12:21,650
Lehrer port back to the hub or the

358
00:12:19,210 --> 00:12:23,770
master itself

359
00:12:21,650 --> 00:12:25,520
so we mentioned a little bit about gap

360
00:12:23,770 --> 00:12:29,390
handling security

361
00:12:25,520 --> 00:12:31,490
so in BOE security there's devices known

362
00:12:29,390 --> 00:12:32,840
as characteristics basically that's what

363
00:12:31,490 --> 00:12:35,180
you're reading and writing from a BOE

364
00:12:32,840 --> 00:12:37,340
device these characteristics when a

365
00:12:35,180 --> 00:12:38,930
client or someone tries to access a

366
00:12:37,340 --> 00:12:41,150
characteristic what's called the

367
00:12:38,930 --> 00:12:43,609
security access manager would require

368
00:12:41,150 --> 00:12:45,050
you again is it just works is it a pin

369
00:12:43,610 --> 00:12:46,550
there's different methods of

370
00:12:45,050 --> 00:12:48,410
authenticating and encrypting that

371
00:12:46,550 --> 00:12:51,620
Bluetooth communication but that's

372
00:12:48,410 --> 00:12:54,260
what's gonna happen at the gap level now

373
00:12:51,620 --> 00:12:55,700
we have a secure connection we have an

374
00:12:54,260 --> 00:12:57,439
access address we know what channels

375
00:12:55,700 --> 00:13:00,530
were hopping now what are we gonna write

376
00:12:57,440 --> 00:13:03,110
to and why that's what we call the

377
00:13:00,530 --> 00:13:04,730
generic attribute protocol the attribute

378
00:13:03,110 --> 00:13:08,030
protocol itself is how the information

379
00:13:04,730 --> 00:13:09,850
gets moved to and from and then the GATT

380
00:13:08,030 --> 00:13:11,720
is what it's called is actually what's

381
00:13:09,850 --> 00:13:13,670
formatting the information it's your

382
00:13:11,720 --> 00:13:15,710
organizer at your syntax it's things of

383
00:13:13,670 --> 00:13:17,780
that extent so when you establish a

384
00:13:15,710 --> 00:13:20,060
connection to a ble device you wanna

385
00:13:17,780 --> 00:13:21,890
numerate all its characteristics or what

386
00:13:20,060 --> 00:13:24,619
is its GATT profiles that are available

387
00:13:21,890 --> 00:13:27,350
and you'll find things like uu IDs which

388
00:13:24,620 --> 00:13:29,120
is a uniquely identify device or a

389
00:13:27,350 --> 00:13:30,800
characteristic that you can write to

390
00:13:29,120 --> 00:13:32,330
there's different roles is this

391
00:13:30,800 --> 00:13:34,280
something that I can read this is

392
00:13:32,330 --> 00:13:36,260
something I can read and write and then

393
00:13:34,280 --> 00:13:37,939
there's your permissions so am I allowed

394
00:13:36,260 --> 00:13:40,510
to read and write after or before

395
00:13:37,940 --> 00:13:43,130
authentication when you look at the GATT

396
00:13:40,510 --> 00:13:45,230
some of them have SIG's which is special

397
00:13:43,130 --> 00:13:47,060
interest groups if you make an insulin

398
00:13:45,230 --> 00:13:47,690
pump or a heart monitor something to

399
00:13:47,060 --> 00:13:49,250
that extent

400
00:13:47,690 --> 00:13:50,960
there will be an institution that

401
00:13:49,250 --> 00:13:53,090
standardizes how you communicate that

402
00:13:50,960 --> 00:13:54,680
information within the gap profile

403
00:13:53,090 --> 00:13:57,790
itself and you might hear that referred

404
00:13:54,680 --> 00:13:57,790
to again as a cig

405
00:13:59,550 --> 00:14:02,810
that so I get double

406
00:14:03,760 --> 00:14:08,439
we go though the GAT again uses that

407
00:14:06,340 --> 00:14:10,600
attribute protocol it transports and

408
00:14:08,440 --> 00:14:12,520
organizes the data the server is going

409
00:14:10,600 --> 00:14:14,290
to receive that request then the

410
00:14:12,520 --> 00:14:16,210
response back again after a secure

411
00:14:14,290 --> 00:14:17,949
connection has been made the client is

412
00:14:16,210 --> 00:14:20,110
basically doing service discovery and

413
00:14:17,950 --> 00:14:23,650
acquires attributes about the server

414
00:14:20,110 --> 00:14:27,130
itself so what's inside that packet that

415
00:14:23,650 --> 00:14:28,180
gets passed that has this information so

416
00:14:27,130 --> 00:14:30,550
again we talked about how its

417
00:14:28,180 --> 00:14:32,380
encapsulated with this add header and

418
00:14:30,550 --> 00:14:36,160
then the app data most of the

419
00:14:32,380 --> 00:14:37,870
information that you replay is this this

420
00:14:36,160 --> 00:14:40,180
is the the read command and the write

421
00:14:37,870 --> 00:14:42,130
command to unlock the lock or will

422
00:14:40,180 --> 00:14:43,660
demonstrate the potential of getting

423
00:14:42,130 --> 00:14:46,180
meterpreter session because someone's

424
00:14:43,660 --> 00:14:47,380
using a Bluetooth keyboard this is where

425
00:14:46,180 --> 00:14:52,180
you're going to put the information that

426
00:14:47,380 --> 00:14:54,490
you're sending in that request again how

427
00:14:52,180 --> 00:14:57,010
does the cat organize the data there's a

428
00:14:54,490 --> 00:14:58,630
handle so where am i writing - what's

429
00:14:57,010 --> 00:15:00,970
the attribute address you might hear it

430
00:14:58,630 --> 00:15:03,430
refer to it what type of it is this a

431
00:15:00,970 --> 00:15:04,900
service again not all of them are gonna

432
00:15:03,430 --> 00:15:06,219
have things to interact you may just

433
00:15:04,900 --> 00:15:08,050
need to read something you may again

434
00:15:06,220 --> 00:15:09,790
just be reading the heart rate you may

435
00:15:08,050 --> 00:15:11,469
be reading the insulin level very small

436
00:15:09,790 --> 00:15:13,810
amounts of information what's the

437
00:15:11,470 --> 00:15:16,540
profile is it vendor persistent and

438
00:15:13,810 --> 00:15:18,219
their specific excuse me what value does

439
00:15:16,540 --> 00:15:20,260
the information have is it data is it

440
00:15:18,220 --> 00:15:21,610
just metadata and then again what

441
00:15:20,260 --> 00:15:22,960
permissions do you have are you allowed

442
00:15:21,610 --> 00:15:24,730
to read write if the information

443
00:15:22,960 --> 00:15:27,280
encrypted to the require authentication

444
00:15:24,730 --> 00:15:31,290
that's how the cat is going to handle

445
00:15:27,280 --> 00:15:34,620
data organization inside that packet

446
00:15:31,290 --> 00:15:36,719
this is what it would look like

447
00:15:34,620 --> 00:15:38,250
we would have the attribute handle where

448
00:15:36,720 --> 00:15:40,470
are we writing to what type of attribute

449
00:15:38,250 --> 00:15:42,980
what's its value and then what's its

450
00:15:40,470 --> 00:15:42,980
permission

451
00:15:43,580 --> 00:15:49,160
101 into the protocol how you would talk

452
00:15:46,100 --> 00:15:50,900
to and from a device next we'll talk

453
00:15:49,160 --> 00:15:52,880
about all the things you'll want on your

454
00:15:50,900 --> 00:15:55,370
workstation you want to play around with

455
00:15:52,880 --> 00:15:57,110
ble devices

456
00:15:55,370 --> 00:15:59,620
just the part where everyone takes the

457
00:15:57,110 --> 00:15:59,620
screen shot

458
00:16:03,100 --> 00:16:07,030
slide is on my LinkedIn if you reach out

459
00:16:05,380 --> 00:16:08,890
to my email that I'll leave at the end I

460
00:16:07,030 --> 00:16:11,079
have it on github things of that extent

461
00:16:08,890 --> 00:16:14,110
I I make these presentations that share

462
00:16:11,080 --> 00:16:16,500
them I've heard a hundred people say you

463
00:16:14,110 --> 00:16:18,760
can get this stuff working in VMs I've

464
00:16:16,500 --> 00:16:21,820
scratched that I would prefer a

465
00:16:18,760 --> 00:16:23,020
dedicated Linux machine I just don't see

466
00:16:21,820 --> 00:16:24,790
the peripherals handing off the

467
00:16:23,020 --> 00:16:26,920
information dealing with all the the

468
00:16:24,790 --> 00:16:29,860
headache of VMware or VirtualBox

469
00:16:26,920 --> 00:16:33,270
I have a system 76 laptop it runs you

470
00:16:29,860 --> 00:16:36,430
boon to you know troll me for that but

471
00:16:33,270 --> 00:16:38,410
it's it's a dedicated wireless testing

472
00:16:36,430 --> 00:16:41,050
rig it's got all my SDR tools I know

473
00:16:38,410 --> 00:16:42,610
everything's gonna be stable you can

474
00:16:41,050 --> 00:16:44,050
have Kali Linux if you want and there's

475
00:16:42,610 --> 00:16:46,390
a really cool command to give yourself

476
00:16:44,050 --> 00:16:48,130
the whole arsenal that Kali has to offer

477
00:16:46,390 --> 00:16:49,900
I'll definitely get a cup of coffee

478
00:16:48,130 --> 00:16:52,870
where this is happening but if you do

479
00:16:49,900 --> 00:16:55,090
apt-get install Kali Linux tak and then

480
00:16:52,870 --> 00:16:56,680
tab complete it it'll be what's called

481
00:16:55,090 --> 00:16:58,270
the Kali Linux top 10 which is the top

482
00:16:56,680 --> 00:17:00,430
10 tools and things that people use in

483
00:16:58,270 --> 00:17:01,720
Kali winix there's Kali Linux SDR which

484
00:17:00,430 --> 00:17:03,310
would give you everything you would need

485
00:17:01,720 --> 00:17:05,890
to use a hack RF for a blade or F

486
00:17:03,310 --> 00:17:07,569
there's Kali Linux wireless or there's

487
00:17:05,890 --> 00:17:09,940
Kali Linux all which just gives you

488
00:17:07,569 --> 00:17:12,550
every possible tool that Kali Linux

489
00:17:09,940 --> 00:17:16,360
could have to offer but I specifically

490
00:17:12,550 --> 00:17:18,310
download is in the middle o kismet I use

491
00:17:16,359 --> 00:17:20,260
it my house and there's a great talk I'm

492
00:17:18,310 --> 00:17:21,909
gonna definitely check out to see if

493
00:17:20,260 --> 00:17:24,160
there's anything I can add to my system

494
00:17:21,910 --> 00:17:26,200
but I use kismet as my house as my IDs

495
00:17:24,160 --> 00:17:28,180
what kismet is really good at is setting

496
00:17:26,200 --> 00:17:30,970
a baseline of known devices and then

497
00:17:28,180 --> 00:17:32,620
trillionaire alerts on anything new so

498
00:17:30,970 --> 00:17:34,150
you lay down kismet you give it a month

499
00:17:32,620 --> 00:17:35,919
of learning of what your environment is

500
00:17:34,150 --> 00:17:37,600
and then you check it once you know

501
00:17:35,920 --> 00:17:40,360
every other week when I have some free

502
00:17:37,600 --> 00:17:42,040
time and there's a new ble device I'll

503
00:17:40,360 --> 00:17:45,010
look at the alerts and then I can go

504
00:17:42,040 --> 00:17:46,050
explore that device further if I own it

505
00:17:45,010 --> 00:17:49,750
right

506
00:17:46,050 --> 00:17:51,610
but Ghat tool we talked about reading

507
00:17:49,750 --> 00:17:54,070
and writing to these GATT services and

508
00:17:51,610 --> 00:17:56,199
need it to be a tool that lets you just

509
00:17:54,070 --> 00:17:57,760
simply connect to a ble device and then

510
00:17:56,200 --> 00:17:59,740
rewrite whatever you captured in

511
00:17:57,760 --> 00:18:02,890
Wireshark right to it we have a video

512
00:17:59,740 --> 00:18:05,830
demoing that a better cap very useful

513
00:18:02,890 --> 00:18:08,380
tool you can use this tool to again to

514
00:18:05,830 --> 00:18:10,510
inject keystrokes into an operating

515
00:18:08,380 --> 00:18:12,100
system that's using a wireless ble

516
00:18:10,510 --> 00:18:16,210
keyboard we have a video that

517
00:18:12,100 --> 00:18:16,939
demonstrates that the HCI tool think of

518
00:18:16,210 --> 00:18:20,720
that like a ping

519
00:18:16,940 --> 00:18:22,940
sweet or boa you can run HCI tool le s

520
00:18:20,720 --> 00:18:25,370
scan and it will just start a numerating

521
00:18:22,940 --> 00:18:27,080
the BOE advertising channels and print

522
00:18:25,370 --> 00:18:28,850
you out all the MAC addresses that are

523
00:18:27,080 --> 00:18:30,679
currently beaconing or available for

524
00:18:28,850 --> 00:18:34,550
connection will see watches you'll see

525
00:18:30,680 --> 00:18:36,890
tiles see things you may seek Evo Evo's

526
00:18:34,550 --> 00:18:38,419
a smart lock so be that you might be

527
00:18:36,890 --> 00:18:41,930
near a home or something to that extent

528
00:18:38,420 --> 00:18:43,250
all these tools and everything you put

529
00:18:41,930 --> 00:18:45,050
in the Wireshark for just a little bit

530
00:18:43,250 --> 00:18:47,750
easier digestion and filtering and

531
00:18:45,050 --> 00:18:49,879
things of that extent jacket is a tool

532
00:18:47,750 --> 00:18:52,670
that lets you Auto exploit the BOA

533
00:18:49,880 --> 00:18:54,260
keyboard so you can use jacket to walk

534
00:18:52,670 --> 00:18:56,450
around with some modified hardware and

535
00:18:54,260 --> 00:18:58,400
if it's spots of BOE keyboard it will

536
00:18:56,450 --> 00:19:01,310
send a ducky script to that device for

537
00:18:58,400 --> 00:19:03,160
it to execute if you're not familiar

538
00:19:01,310 --> 00:19:05,780
with a ducky script it's basically

539
00:19:03,160 --> 00:19:07,700
automating human keystrokes in a text

540
00:19:05,780 --> 00:19:08,870
file and can type a heck of a lot faster

541
00:19:07,700 --> 00:19:10,930
than you'd be able to get to the

542
00:19:08,870 --> 00:19:14,389
terminal and do yourself

543
00:19:10,930 --> 00:19:16,280
eatle jack is a great tool it uses two

544
00:19:14,390 --> 00:19:18,530
really cheap pieces of hardware known as

545
00:19:16,280 --> 00:19:20,480
BBC micro bits you see there on the

546
00:19:18,530 --> 00:19:22,460
right and what it does is it allow it's

547
00:19:20,480 --> 00:19:24,200
a full man-in-the-middle framework for a

548
00:19:22,460 --> 00:19:26,570
Bluetooth attack where you can spin up a

549
00:19:24,200 --> 00:19:27,950
rogue GATT server and get those

550
00:19:26,570 --> 00:19:29,870
connection requests and get that

551
00:19:27,950 --> 00:19:31,760
information and then forward on to the

552
00:19:29,870 --> 00:19:33,050
drone or the thing or whatever you're

553
00:19:31,760 --> 00:19:35,810
taking a look at from a research

554
00:19:33,050 --> 00:19:38,000
standpoint I was told to make a special

555
00:19:35,810 --> 00:19:40,550
shot out the blue Hydra for anyone

556
00:19:38,000 --> 00:19:42,440
that's good to do the Wireless CTF this

557
00:19:40,550 --> 00:19:44,659
is a tool that will let you track a BOE

558
00:19:42,440 --> 00:19:46,070
device so you can feed it a Mac and you

559
00:19:44,660 --> 00:19:48,020
can walk around looking for the Fox

560
00:19:46,070 --> 00:19:50,300
you'll get a ding ding from your laptop

561
00:19:48,020 --> 00:19:51,560
if you're close enough the blue hide is

562
00:19:50,300 --> 00:19:55,100
a very useful tool if you're gonna do

563
00:19:51,560 --> 00:19:56,600
the wireless CTF hardware standpoint you

564
00:19:55,100 --> 00:19:59,689
have your uber tooth one and your

565
00:19:56,600 --> 00:20:02,149
armboard ble card your uber tooth one is

566
00:19:59,690 --> 00:20:04,190
a spectrum analyzer and listener it's

567
00:20:02,150 --> 00:20:06,620
not meant to send and receive that is

568
00:20:04,190 --> 00:20:08,330
your capture device you're onboard ble

569
00:20:06,620 --> 00:20:09,889
card or if you bought a third party on

570
00:20:08,330 --> 00:20:11,030
one that you plugged in that would be

571
00:20:09,890 --> 00:20:14,600
what you're gonna send a lot of the

572
00:20:11,030 --> 00:20:16,580
commands from a rooted device or just

573
00:20:14,600 --> 00:20:19,280
developer mode on an Android phone what

574
00:20:16,580 --> 00:20:21,139
that allows you to do is write read and

575
00:20:19,280 --> 00:20:22,760
write to the thing that you want to test

576
00:20:21,140 --> 00:20:24,260
and then from your phone you can pull

577
00:20:22,760 --> 00:20:26,390
the peak app directly off and get

578
00:20:24,260 --> 00:20:28,340
whatever you sent from your phone in

579
00:20:26,390 --> 00:20:30,080
clear text before it hit the encryption

580
00:20:28,340 --> 00:20:30,740
phase or anything so if you wanted to

581
00:20:30,080 --> 00:20:32,928
see what was Ash

582
00:20:30,740 --> 00:20:35,059
being sent to the IOT device you would

583
00:20:32,929 --> 00:20:37,040
turn on for Android example developer

584
00:20:35,059 --> 00:20:38,360
mode and you would turn on HCI snoot and

585
00:20:37,040 --> 00:20:40,159
then you would mess around with the

586
00:20:38,360 --> 00:20:41,899
thing for a half-hour and then you would

587
00:20:40,160 --> 00:20:43,610
connect to it with the Android debugging

588
00:20:41,900 --> 00:20:45,440
bridge and you would pull off the peek

589
00:20:43,610 --> 00:20:46,909
app to your local workstation and you'd

590
00:20:45,440 --> 00:20:48,440
open up Wireshark and you would have

591
00:20:46,910 --> 00:20:51,410
that conversation from your phone to the

592
00:20:48,440 --> 00:20:54,020
thing right there in front of you the

593
00:20:51,410 --> 00:20:56,300
logitech unifying receiver that is the

594
00:20:54,020 --> 00:20:57,590
little plugin that's got the star on it

595
00:20:56,300 --> 00:21:00,530
that says I'll work with anything

596
00:20:57,590 --> 00:21:03,020
Logitech there is a piece of research

597
00:21:00,530 --> 00:21:04,730
called Mouse Jack where you can flash

598
00:21:03,020 --> 00:21:07,129
that with custom firmware that again

599
00:21:04,730 --> 00:21:12,020
will send those ducky scripts to any ble

600
00:21:07,130 --> 00:21:14,590
device that you spot ESP 32 is a 2.4

601
00:21:12,020 --> 00:21:17,720
gigahertz wireless and Bluetooth

602
00:21:14,590 --> 00:21:19,428
microcontroller that you can flash with

603
00:21:17,720 --> 00:21:21,200
a Bluetooth low-energy capture the flag

604
00:21:19,429 --> 00:21:23,150
and we have all the instructions later

605
00:21:21,200 --> 00:21:24,530
in the slides and then again we talked

606
00:21:23,150 --> 00:21:26,420
about the micro bits you're gonna use

607
00:21:24,530 --> 00:21:29,270
them with beetle Jack and create this

608
00:21:26,420 --> 00:21:31,370
man-in-the-middle environment or a ble

609
00:21:29,270 --> 00:21:33,620
so with all those tools on your

610
00:21:31,370 --> 00:21:35,178
workstation how do you go about doing it

611
00:21:33,620 --> 00:21:36,320
I kind of broke it in the form simple

612
00:21:35,179 --> 00:21:38,420
phases

613
00:21:36,320 --> 00:21:41,330
sniffing reconnaissance so what's in my

614
00:21:38,420 --> 00:21:43,309
proximity and can I actively listen or

615
00:21:41,330 --> 00:21:45,050
passively listen for someone creating an

616
00:21:43,309 --> 00:21:46,970
active connection because what I'm gonna

617
00:21:45,050 --> 00:21:49,460
get out of that is that connection

618
00:21:46,970 --> 00:21:51,200
request and then I'm gonna start

619
00:21:49,460 --> 00:21:53,150
capturing because once I hit again tack

620
00:21:51,200 --> 00:21:55,070
F and my uber tooth I'm gonna follow

621
00:21:53,150 --> 00:21:57,470
across all these different frequency

622
00:21:55,070 --> 00:22:00,409
hopping channels and that access address

623
00:21:57,470 --> 00:22:01,820
now I look in Wireshark most of the time

624
00:22:00,410 --> 00:22:03,679
and these ble devices they're not

625
00:22:01,820 --> 00:22:06,320
encrypted there's no office occasionally

626
00:22:03,679 --> 00:22:09,679
information most sophisticated I've seen

627
00:22:06,320 --> 00:22:12,919
with some basics before stuff but that's

628
00:22:09,679 --> 00:22:14,990
that and I just take exploitation but

629
00:22:12,920 --> 00:22:16,400
it's basically just replaying a lot of

630
00:22:14,990 --> 00:22:18,080
the attacks I've seen is getting that

631
00:22:16,400 --> 00:22:20,090
information and once you know that value

632
00:22:18,080 --> 00:22:22,189
you may even be able to permutate that

633
00:22:20,090 --> 00:22:24,260
value enough where when you replay you

634
00:22:22,190 --> 00:22:25,970
can get some execution or the device to

635
00:22:24,260 --> 00:22:29,059
do something

636
00:22:25,970 --> 00:22:31,730
so the first video is going to be us

637
00:22:29,059 --> 00:22:32,990
setting up the uber tooth to listen is

638
00:22:31,730 --> 00:22:37,220
there some things you gotta do in pop

639
00:22:32,990 --> 00:22:38,809
star we talked about you can pop on uber

640
00:22:37,220 --> 00:22:40,909
tus website but again I always think

641
00:22:38,809 --> 00:22:43,759
it's good to show people so we have to

642
00:22:40,909 --> 00:22:46,549
make a attempt space because basically

643
00:22:43,759 --> 00:22:48,440
for us to push traffic so what I did is

644
00:22:46,549 --> 00:22:49,908
I just created a temp space and now what

645
00:22:48,440 --> 00:22:54,169
I'm going to go in the Wireshark and do

646
00:22:49,909 --> 00:22:56,509
is I'm going to add an interface there

647
00:22:54,169 --> 00:22:58,549
it is when you add this interface it's

648
00:22:56,509 --> 00:23:00,230
there's an option for pipes I'm gonna

649
00:22:58,549 --> 00:23:02,179
point it to that pipe I just create it

650
00:23:00,230 --> 00:23:05,899
in the terminal right before this so

651
00:23:02,179 --> 00:23:08,509
temp last pipe now I have a pipe I have

652
00:23:05,899 --> 00:23:10,340
Wireshark listening to said pipe by

653
00:23:08,509 --> 00:23:11,509
selecting it and clicking start but

654
00:23:10,340 --> 00:23:13,389
there's no traffic because again I

655
00:23:11,509 --> 00:23:16,399
haven't told the blue or the uber tooth

656
00:23:13,389 --> 00:23:19,158
try to follow a connection and to push

657
00:23:16,399 --> 00:23:21,399
all that traffic or taxi through my temp

658
00:23:19,159 --> 00:23:21,399
space

659
00:23:21,419 --> 00:23:25,619
and now I push it and now you see things

660
00:23:24,059 --> 00:23:28,499
on the screen and now when we come back

661
00:23:25,619 --> 00:23:30,658
all you're seeing is advertising packets

662
00:23:28,499 --> 00:23:32,879
because we haven't caught a connection

663
00:23:30,659 --> 00:23:34,109
request yet we haven't got the

664
00:23:32,879 --> 00:23:36,149
information that's gonna allow us to

665
00:23:34,109 --> 00:23:38,189
start hopping accordingly bought with

666
00:23:36,149 --> 00:23:41,279
enough patience and enough of joining

667
00:23:38,190 --> 00:23:51,779
your device to and from you'll get this

668
00:23:41,279 --> 00:23:53,789
guy it's it's latency how long do I need

669
00:23:51,779 --> 00:23:55,349
to wait or when can I next connect to

670
00:23:53,789 --> 00:23:57,809
this device and once you grab that

671
00:23:55,349 --> 00:23:59,458
packet Wireshark will start following it

672
00:23:57,809 --> 00:24:01,589
across these frequency channels that

673
00:23:59,459 --> 00:24:05,039
it's hopping and you'll start to see the

674
00:24:01,589 --> 00:24:11,339
attribute protocol be used to write this

675
00:24:05,039 --> 00:24:14,999
is a capture these values could be

676
00:24:11,339 --> 00:24:17,070
replayed change the color the argument I

677
00:24:14,999 --> 00:24:18,629
got back from the vendor was who cares

678
00:24:17,070 --> 00:24:20,729
if someone can remotely change the color

679
00:24:18,629 --> 00:24:25,769
there's no real risk so what we did is

680
00:24:20,729 --> 00:24:27,779
we plug 10 of them into a switch let's

681
00:24:25,769 --> 00:24:29,369
start a breaker of the outlet strip I

682
00:24:27,779 --> 00:24:31,649
was a brownout

683
00:24:29,369 --> 00:24:33,029
it's not about data one of my researches

684
00:24:31,649 --> 00:24:36,899
and the IOT is not about getting

685
00:24:33,029 --> 00:24:38,969
information about that nobody hits the

686
00:24:36,899 --> 00:24:40,320
water meters now for Philadelphia they

687
00:24:38,969 --> 00:24:42,419
wear ZigBee they're in the process of

688
00:24:40,320 --> 00:24:51,418
upgrading them the ble so now we can

689
00:24:42,419 --> 00:24:54,329
cause actual so start to listen for when

690
00:24:51,419 --> 00:24:56,489
it writes to certain handles so this is

691
00:24:54,329 --> 00:24:59,639
a really sophisticated smart lock so we

692
00:24:56,489 --> 00:25:03,359
have my password you know 1 2 3 4 5 6 7

693
00:24:59,639 --> 00:25:07,949
8 and I wrote it in the I wrote it to

694
00:25:03,359 --> 00:25:09,989
the handle X 0 0 to D and then the next

695
00:25:07,950 --> 00:25:12,779
thing you write is to a different handle

696
00:25:09,989 --> 00:25:14,999
and you write a 1 so what did we do in

697
00:25:12,779 --> 00:25:16,019
the lab is we took that same lock again

698
00:25:14,999 --> 00:25:19,049
this is built off of someone else's

699
00:25:16,019 --> 00:25:20,399
research this wasn't I discovered it's

700
00:25:19,049 --> 00:25:22,619
called the quick lock if you want to

701
00:25:20,399 --> 00:25:24,839
research it I believe in this DEFCON 24

702
00:25:22,619 --> 00:25:26,789
the talk is hacking Bluetooth locks from

703
00:25:24,839 --> 00:25:28,349
a quarter-mile away that was what

704
00:25:26,789 --> 00:25:30,959
inspired some of my research that that

705
00:25:28,349 --> 00:25:33,649
gentleman did a really good job that

706
00:25:30,959 --> 00:25:35,180
github is here all the

707
00:25:33,650 --> 00:25:37,580
tools that he made out of the research

708
00:25:35,180 --> 00:25:39,140
on what we have in the video demoed as

709
00:25:37,580 --> 00:25:44,060
you can see we started with gat tool

710
00:25:39,140 --> 00:25:45,950
tech boy which means I want to be in mac

711
00:25:44,060 --> 00:25:48,590
address and once it highlights blue I

712
00:25:45,950 --> 00:25:51,230
know that I have a BOE connection that's

713
00:25:48,590 --> 00:25:52,580
valid I can do a character write request

714
00:25:51,230 --> 00:25:55,640
so I'm gonna write a character to an

715
00:25:52,580 --> 00:25:59,830
attribute handle and what you're gonna

716
00:25:55,640 --> 00:25:59,830
see if it wants to work

717
00:26:06,040 --> 00:26:08,100
you

718
00:26:08,799 --> 00:26:13,549
the character right request to that

719
00:26:12,019 --> 00:26:16,340
handle that it was expecting the

720
00:26:13,549 --> 00:26:17,479
password and this was version 2 of the

721
00:26:16,340 --> 00:26:20,149
vulnerability where they sent the

722
00:26:17,479 --> 00:26:20,869
password twice that was their fixed for

723
00:26:20,149 --> 00:26:24,099
version 1

724
00:26:20,869 --> 00:26:24,099
they just doubled it

725
00:26:25,530 --> 00:26:30,899
then we come back we write to that other

726
00:26:27,690 --> 00:26:32,940
handle just a zero and one which means

727
00:26:30,900 --> 00:26:34,500
after you have authenticate you now have

728
00:26:32,940 --> 00:26:36,590
the ability to write to that handle and

729
00:26:34,500 --> 00:26:38,700
with that becomes unlocking the device

730
00:26:36,590 --> 00:26:40,470
again that's that your telnet

731
00:26:38,700 --> 00:26:42,780
vulnerability of Bluetooth I call it

732
00:26:40,470 --> 00:26:44,520
it's very simple it's fun to get started

733
00:26:42,780 --> 00:26:45,810
with and if you're interested it's just

734
00:26:44,520 --> 00:26:47,850
called quick lock and they're still

735
00:26:45,810 --> 00:26:50,159
available in Amazon but you can buy one

736
00:26:47,850 --> 00:26:51,600
and have some fun but one of the

737
00:26:50,160 --> 00:26:53,400
questions I got asked when doing my

738
00:26:51,600 --> 00:26:56,129
research when I was pen testing at the

739
00:26:53,400 --> 00:26:57,450
time is my managing consultant was like

740
00:26:56,130 --> 00:26:59,280
this is all cool but I need you to

741
00:26:57,450 --> 00:27:01,380
weaponize this like it show me how this

742
00:26:59,280 --> 00:27:02,639
can be used on a pen test I love what

743
00:27:01,380 --> 00:27:04,440
you do in your basement and nerding out

744
00:27:02,640 --> 00:27:08,280
but this needs to translate it's what

745
00:27:04,440 --> 00:27:10,200
you do so here comes better cap and this

746
00:27:08,280 --> 00:27:11,879
was funny this device right here you

747
00:27:10,200 --> 00:27:14,760
can't see in the screenshot is my

748
00:27:11,880 --> 00:27:16,470
logitech it's the number one Logitech

749
00:27:14,760 --> 00:27:17,820
keyboard it's got the noise cushions at

750
00:27:16,470 --> 00:27:20,400
the bottom he's shaking his head like

751
00:27:17,820 --> 00:27:22,169
yeah that's why everyone uses it that's

752
00:27:20,400 --> 00:27:23,610
the one I was gonna test I didn't

753
00:27:22,170 --> 00:27:24,690
realize that like half my neighborhood

754
00:27:23,610 --> 00:27:27,449
was good to be vulnerable there's like

755
00:27:24,690 --> 00:27:29,000
20 other hid devices that I could have

756
00:27:27,450 --> 00:27:32,480
been just getting shells on everybody

757
00:27:29,000 --> 00:27:35,070
but we keep it kosher we keep it ethical

758
00:27:32,480 --> 00:27:36,780
but one of the things you can do is

759
00:27:35,070 --> 00:27:39,060
again you can sniff because some of the

760
00:27:36,780 --> 00:27:40,649
ones that are so bad Microsoft they'll

761
00:27:39,060 --> 00:27:42,899
just send it in clear text you can get

762
00:27:40,650 --> 00:27:46,020
keystroke for keystroke what the

763
00:27:42,900 --> 00:27:51,000
person's typing where you can inject so

764
00:27:46,020 --> 00:27:54,150
to inject we use a tool again jacket the

765
00:27:51,000 --> 00:27:56,240
reason I used jacket over beetle or

766
00:27:54,150 --> 00:28:00,120
excuse me better cap is because you can

767
00:27:56,240 --> 00:28:01,800
get jacket to work on like an Arduino

768
00:28:00,120 --> 00:28:03,899
level hardware and make it like a really

769
00:28:01,800 --> 00:28:06,090
small piece of hardware and it just sits

770
00:28:03,900 --> 00:28:08,130
in your back pocket and all it has on

771
00:28:06,090 --> 00:28:13,679
the SD card is the ducky script and you

772
00:28:08,130 --> 00:28:15,120
set it to auto porn so every time and

773
00:28:13,680 --> 00:28:16,800
that's one of the things before I ran

774
00:28:15,120 --> 00:28:18,929
this I'd have to do a survey for the

775
00:28:16,800 --> 00:28:21,060
client be like alright this is just your

776
00:28:18,930 --> 00:28:22,470
building these are just your devices

777
00:28:21,060 --> 00:28:24,659
because the moment I start walking your

778
00:28:22,470 --> 00:28:26,040
campus I can't get yelled at because I

779
00:28:24,660 --> 00:28:27,690
got shell on the third floor which

780
00:28:26,040 --> 00:28:29,730
wasn't their business we had to make

781
00:28:27,690 --> 00:28:32,880
sure that they own the right space but

782
00:28:29,730 --> 00:28:35,640
once you get to that type of setup you

783
00:28:32,880 --> 00:28:37,200
can have so right here you can see and

784
00:28:35,640 --> 00:28:37,440
excuse the nine Red Bulls that I was

785
00:28:37,200 --> 00:28:39,720
doing

786
00:28:37,440 --> 00:28:42,750
film this video yes you'll see when I

787
00:28:39,720 --> 00:28:44,669
start the bottom of my screen is jacket

788
00:28:42,750 --> 00:28:46,919
finding a device and then here's my

789
00:28:44,669 --> 00:28:49,490
Windows laptop so we're gonna have some

790
00:28:46,919 --> 00:28:49,490
fun with that

791
00:28:54,600 --> 00:28:56,659
you

792
00:28:58,190 --> 00:29:02,210
so just again coupe quick proof of

793
00:29:00,500 --> 00:29:03,770
concept but you can have that ducky

794
00:29:02,210 --> 00:29:06,550
script do anything I just had it you

795
00:29:03,770 --> 00:29:06,550
know bring up a cab

796
00:29:11,120 --> 00:29:15,620
so build your own CPF we went over all

797
00:29:13,490 --> 00:29:19,669
the tools maybe you don't have a ble

798
00:29:15,620 --> 00:29:21,018
device the ESP 32 is this cheapest $12

799
00:29:19,669 --> 00:29:23,269
if you go to wish key there are these

800
00:29:21,019 --> 00:29:24,740
others you know microelectronic sites so

801
00:29:23,269 --> 00:29:26,779
it's not a expensive piece of hardware

802
00:29:24,740 --> 00:29:28,909
to get your hands on you can flash it

803
00:29:26,779 --> 00:29:32,659
with the firmware and then you have a

804
00:29:28,909 --> 00:29:35,509
nice capture the flag for yourself so

805
00:29:32,659 --> 00:29:37,759
there's two different ones the BOE CTF

806
00:29:35,509 --> 00:29:39,259
this first one is kind of your 101 so if

807
00:29:37,759 --> 00:29:40,580
you're just getting started you're gonna

808
00:29:39,259 --> 00:29:42,679
have a lot of fun with that one

809
00:29:40,580 --> 00:29:44,269
some of the flags for that one is hey

810
00:29:42,679 --> 00:29:46,519
write to this handle and then listen for

811
00:29:44,269 --> 00:29:48,590
the response or write to this handle a

812
00:29:46,519 --> 00:29:50,299
hundred times and at the 101 response

813
00:29:48,590 --> 00:29:52,580
you'll get the flag and then there's one

814
00:29:50,299 --> 00:29:55,369
that's a little more advanced he calls

815
00:29:52,580 --> 00:29:56,899
the the OE CTF infinity but again you

816
00:29:55,369 --> 00:29:59,418
can complete all this with just better

817
00:29:56,899 --> 00:30:01,428
cap gap tool and HDI tool so you don't

818
00:29:59,419 --> 00:30:03,139
even if the uber tooth is out of your

819
00:30:01,429 --> 00:30:04,309
budget for the time being I know it's an

820
00:30:03,139 --> 00:30:06,139
expensive piece of hardware it's a

821
00:30:04,309 --> 00:30:08,149
little over 100 bucks you could jump

822
00:30:06,139 --> 00:30:11,800
into learning right out of the gate with

823
00:30:08,149 --> 00:30:14,110
you know $30.00 investment

824
00:30:11,800 --> 00:30:15,550
so you could connect to the the capture

825
00:30:14,110 --> 00:30:18,340
the flag and you could get all the UU

826
00:30:15,550 --> 00:30:19,659
ids and that tool is good for writing

827
00:30:18,340 --> 00:30:21,220
but it doesn't do a good job of

828
00:30:19,660 --> 00:30:22,990
enumerate and actually looking at the

829
00:30:21,220 --> 00:30:25,390
services like something like better cat

830
00:30:22,990 --> 00:30:27,880
would so here's the CTF when you connect

831
00:30:25,390 --> 00:30:30,310
to it a better cat so listen to me for

832
00:30:27,880 --> 00:30:32,650
multiple notifications list of this

833
00:30:30,310 --> 00:30:34,480
handle for a single indication so

834
00:30:32,650 --> 00:30:36,970
they'll be all the different flags that

835
00:30:34,480 --> 00:30:40,090
you have to read to and then the first

836
00:30:36,970 --> 00:30:42,150
one is how you check your score

837
00:30:40,090 --> 00:30:45,100
so if you wrote with gat tool to that

838
00:30:42,150 --> 00:30:46,750
address and you wrote that information

839
00:30:45,100 --> 00:30:48,219
and you read it it would tell you how

840
00:30:46,750 --> 00:30:51,190
many flags you've submitted at the time

841
00:30:48,220 --> 00:30:53,770
of completing the CTF you want to start

842
00:30:51,190 --> 00:30:56,190
it over unplug it plug it back in

843
00:30:53,770 --> 00:30:58,900
reboots you can go back to hacking a

844
00:30:56,190 --> 00:31:01,890
really good way to get started super

845
00:30:58,900 --> 00:31:01,890
useful super cheap

846
00:31:03,580 --> 00:31:09,449
I had and thanks for coming out

847
00:31:05,350 --> 00:31:09,449
questions concerns boos comments

848
00:31:14,179 --> 00:31:16,240
you

849
00:31:16,740 --> 00:31:18,800
you

850
00:31:19,389 --> 00:31:21,449
you

851
00:31:29,440 --> 00:31:33,640
so it can be randomized it could be

852
00:31:31,900 --> 00:31:36,700
hard-coded but it's gonna be something

853
00:31:33,640 --> 00:31:38,200
that's specified the engineering side or

854
00:31:36,700 --> 00:31:40,420
at least in the connection requests side

855
00:31:38,200 --> 00:31:43,210
not something that user side you would

856
00:31:40,420 --> 00:31:45,400
be able to manipulate or healthy but

857
00:31:43,210 --> 00:31:46,810
there has been research into spoofing it

858
00:31:45,400 --> 00:31:48,580
right like when I make a rogue device

859
00:31:46,810 --> 00:31:50,020
could I mimic the access address and get

860
00:31:48,580 --> 00:31:52,270
all that information before forwarding

861
00:31:50,020 --> 00:31:55,530
it that becomes a proximity based attack

862
00:31:52,270 --> 00:31:55,530
just like any wire in the back

863
00:32:02,450 --> 00:32:04,510
you

864
00:32:10,580 --> 00:32:15,000
100% so the I Triple E is gonna have

865
00:32:13,290 --> 00:32:18,000
everything that gets you up to the GATT

866
00:32:15,000 --> 00:32:19,740
later and then from GATT up is API calls

867
00:32:18,000 --> 00:32:22,200
and murders and how they want to serve

868
00:32:19,740 --> 00:32:23,940
the information up but from one to four

869
00:32:22,200 --> 00:32:25,650
you're looking at it from the tcp/ip

870
00:32:23,940 --> 00:32:27,300
standpoint you're gonna find those

871
00:32:25,650 --> 00:32:28,680
information from I Triple E that's gonna

872
00:32:27,300 --> 00:32:31,290
be the certification body that says

873
00:32:28,680 --> 00:32:32,640
here's the standard and then everything

874
00:32:31,290 --> 00:32:34,800
else is up to the api's and the

875
00:32:32,640 --> 00:32:36,720
developers because you only get to that

876
00:32:34,800 --> 00:32:37,860
point that's that's hard-coded basically

877
00:32:36,720 --> 00:32:41,240
that's how it works

878
00:32:37,860 --> 00:32:41,240
then you interact with the API

879
00:32:49,140 --> 00:32:51,200
you

880
00:32:56,720 --> 00:33:00,380
yeah so one of the things that's really

881
00:32:58,310 --> 00:33:01,879
bad when is when you go I want my device

882
00:33:00,380 --> 00:33:03,200
to connect really quick and I don't want

883
00:33:01,880 --> 00:33:06,369
to wait for information so we're only

884
00:33:03,200 --> 00:33:10,109
going to use three data Channel

885
00:33:06,369 --> 00:33:10,109
and that they're going to use piece

886
00:33:12,820 --> 00:33:17,049
sweet spot seems to be seven

887
00:33:15,460 --> 00:33:19,149
channels is what I traditionally figured

888
00:33:17,049 --> 00:33:20,889
out is what use anything up or below I

889
00:33:19,149 --> 00:33:22,809
can't speak to whether that's more or

890
00:33:20,890 --> 00:33:24,370
less secure because once you have the

891
00:33:22,809 --> 00:33:26,139
connection request you have that ability

892
00:33:24,370 --> 00:33:28,510
to follow there's no matter how many

893
00:33:26,140 --> 00:33:30,279
channels right but then it becomes I was

894
00:33:28,510 --> 00:33:31,690
saying this earlier like tying playscore

895
00:33:30,279 --> 00:33:33,730
am i listening at the right time in the

896
00:33:31,690 --> 00:33:35,289
right place when the information said

897
00:33:33,730 --> 00:33:36,669
that's what's such a pain in the butt

898
00:33:35,289 --> 00:33:38,830
about tracking these device you have to

899
00:33:36,669 --> 00:33:41,049
be very patient you know you may write a

900
00:33:38,830 --> 00:33:42,149
hundred times and just by the luck of it

901
00:33:41,049 --> 00:33:44,980
you didn't you didn't get there whatever

902
00:33:42,149 --> 00:33:47,379
tooth followed him jump to that channel

903
00:33:44,980 --> 00:33:49,299
when you went over here and wrote it's a

904
00:33:47,380 --> 00:33:51,790
very interesting protocol to buy the

905
00:33:49,299 --> 00:33:54,150
reverse engineer

906
00:33:51,790 --> 00:33:54,149
else

907
00:33:55,010 --> 00:33:57,070
you

908
00:33:59,120 --> 00:34:03,570
yeah so right out of the gate your

909
00:34:01,320 --> 00:34:05,040
standard Bluetooth le card is said to

910
00:34:03,570 --> 00:34:08,370
have a hundred and fifty meters of

911
00:34:05,040 --> 00:34:10,800
approximate I haven't dubbed into like

912
00:34:08,370 --> 00:34:12,089
the antenna like the yagi like from the

913
00:34:10,800 --> 00:34:13,290
wireless standpoint right I've done the

914
00:34:12,090 --> 00:34:14,820
wireless engagements when I'm in my car

915
00:34:13,290 --> 00:34:16,980
and the Auggie's pointed at the building

916
00:34:14,820 --> 00:34:18,929
I haven't gone down that rabbit hole

917
00:34:16,980 --> 00:34:20,969
from a far distance the only but that

918
00:34:18,929 --> 00:34:22,409
talk I mentioned hacking Bluetooth from

919
00:34:20,969 --> 00:34:24,899
a quarter-mile away I'm fairly certain

920
00:34:22,409 --> 00:34:25,379
he did hook his uber tooth or some other

921
00:34:24,899 --> 00:34:27,989
BOE

922
00:34:25,379 --> 00:34:29,310
hardware device to a you know a cantenna

923
00:34:27,989 --> 00:34:33,259
or something to that extent

924
00:34:29,310 --> 00:34:33,259
and was able to extend his distance

925
00:34:34,840 --> 00:34:38,190
right well thank you I'll give you back

926
00:34:36,739 --> 00:34:46,158
the rest of your conference

927
00:34:38,190 --> 00:34:46,159
[Applause]

