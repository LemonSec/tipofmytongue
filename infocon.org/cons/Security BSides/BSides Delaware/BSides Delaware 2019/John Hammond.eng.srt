1
00:00:04,910 --> 00:00:10,850
already good morning hey you guys doing

2
00:00:08,138 --> 00:00:13,760
well read this is cool well thank you

3
00:00:10,850 --> 00:00:15,289
come and hang out come to my talk I

4
00:00:13,760 --> 00:00:16,910
don't I don't like to say like coming to

5
00:00:15,289 --> 00:00:18,980
my talk because that's under the premise

6
00:00:16,910 --> 00:00:20,750
that I actually succeed in delivering

7
00:00:18,980 --> 00:00:22,490
the talk to you so thanks for coming to

8
00:00:20,750 --> 00:00:26,000
hang out that's that's really the better

9
00:00:22,490 --> 00:00:29,750
move this is a poor man's penetration

10
00:00:26,000 --> 00:00:32,028
test or automating the manual it is

11
00:00:29,750 --> 00:00:33,890
titled that way intentionally because

12
00:00:32,029 --> 00:00:37,269
this is kind of a cheesy trick or

13
00:00:33,890 --> 00:00:41,600
technique that your mileage may vary

14
00:00:37,269 --> 00:00:43,550
with right I'll have a little showcase

15
00:00:41,600 --> 00:00:45,859
or demo or try to I'll give it a vessel

16
00:00:43,550 --> 00:00:48,288
or some means to actually showcase what

17
00:00:45,859 --> 00:00:49,969
this thing is but if you want to use

18
00:00:48,289 --> 00:00:52,100
this in a real like all enterprise

19
00:00:49,969 --> 00:00:53,420
network big scale thing again I can't

20
00:00:52,100 --> 00:00:55,039
promise or tell you everything that

21
00:00:53,420 --> 00:00:58,909
might be particularly handy I think it's

22
00:00:55,039 --> 00:00:59,719
a simple unique thing we just dive into

23
00:00:58,909 --> 00:01:01,750
it yeah

24
00:00:59,719 --> 00:01:04,599
automate the manual

25
00:01:01,750 --> 00:01:09,390
so first of all obligatory introductory

26
00:01:04,599 --> 00:01:12,580
slide hi I'm John Hammond during the day

27
00:01:09,390 --> 00:01:15,580
my day job is a Red Team cyber operator

28
00:01:12,580 --> 00:01:17,080
so supposed to be pentesting and

29
00:01:15,580 --> 00:01:20,320
offensive security and cool stuff like

30
00:01:17,080 --> 00:01:21,970
that previously I was a cyber security

31
00:01:20,320 --> 00:01:24,100
instructor with the Department of

32
00:01:21,970 --> 00:01:26,260
Defense cyber training academy now I'm

33
00:01:24,100 --> 00:01:29,229
with the defense Threat Reduction agency

34
00:01:26,260 --> 00:01:31,390
so gubby military sort of stuff but the

35
00:01:29,230 --> 00:01:33,729
instructor side was a lot of fun and I

36
00:01:31,390 --> 00:01:35,890
hope helped with this sort of thing

37
00:01:33,729 --> 00:01:39,429
hopefully I can keep you guys awake and

38
00:01:35,890 --> 00:01:40,960
we'll see if I end up asking you any

39
00:01:39,430 --> 00:01:42,729
questions or like hey this is a

40
00:01:40,960 --> 00:01:45,820
rhetorical thing like I want you to

41
00:01:42,729 --> 00:01:46,420
answer but forgive me if that's stupid

42
00:01:45,820 --> 00:01:48,429
or annoying

43
00:01:46,420 --> 00:01:51,070
that's just my instructor side coming

44
00:01:48,430 --> 00:01:53,920
out at night in my free time I like to

45
00:01:51,070 --> 00:01:55,720
do some capture the flag stuff I

46
00:01:53,920 --> 00:01:57,880
actually have a capture the flag event

47
00:01:55,720 --> 00:02:00,700
that's running happening right now here

48
00:01:57,880 --> 00:02:04,660
for b-sides Delaware that's been online

49
00:02:00,700 --> 00:02:05,250
since the start of yesterday and it's

50
00:02:04,660 --> 00:02:07,840
seemingly

51
00:02:05,250 --> 00:02:09,610
kinda nice and kind of fun if you guys

52
00:02:07,840 --> 00:02:11,940
want to play that's online accessible

53
00:02:09,610 --> 00:02:15,519
anywhere it's just that H digital i/o

54
00:02:11,940 --> 00:02:18,390
link and they'll be able to buy some

55
00:02:15,519 --> 00:02:20,100
challenges some good stuff

56
00:02:18,390 --> 00:02:22,649
with that with that cybersecurity

57
00:02:20,100 --> 00:02:25,350
capsule flag flare I like you a lot of

58
00:02:22,650 --> 00:02:27,360
war games over the wire hack the box

59
00:02:25,350 --> 00:02:29,910
some training exercises stuff like that

60
00:02:27,360 --> 00:02:31,830
and I have a cheesy YouTube channel to

61
00:02:29,910 --> 00:02:35,060
showcase some of those like videos or

62
00:02:31,830 --> 00:02:35,060
walkthroughs or guys to do that

63
00:02:36,890 --> 00:02:42,170
you

64
00:02:38,599 --> 00:02:44,119
here's an agenda here's what I hope we

65
00:02:42,170 --> 00:02:47,298
can talk about and there are a lot of

66
00:02:44,120 --> 00:02:49,790
you so we'll see how we do first I want

67
00:02:47,299 --> 00:02:51,170
to kind of propose hack the box you guys

68
00:02:49,790 --> 00:02:53,989
heard of that I need you guys play like

69
00:02:51,170 --> 00:02:57,230
hack the Box stuff cool I want to use

70
00:02:53,989 --> 00:02:59,329
that as a driver and vessel really what

71
00:02:57,230 --> 00:03:00,590
I'm gonna showcase here first of all

72
00:02:59,329 --> 00:03:03,560
because it gives us a really good like

73
00:03:00,590 --> 00:03:06,200
means to get some quick remote code

74
00:03:03,560 --> 00:03:08,030
execution I'm quick easy alright we're

75
00:03:06,200 --> 00:03:10,129
on a box we've got a victim we've got a

76
00:03:08,030 --> 00:03:13,939
target we can interact and flip and play

77
00:03:10,129 --> 00:03:16,340
with then obviously that's done with a

78
00:03:13,939 --> 00:03:18,078
reverse shell most often so I'll

79
00:03:16,340 --> 00:03:19,760
showcase how we can okay just quick get

80
00:03:18,079 --> 00:03:21,919
a call back now we're working with the

81
00:03:19,760 --> 00:03:26,298
machine will stabilize it and then I

82
00:03:21,919 --> 00:03:29,389
want to get into XT e and that is really

83
00:03:26,299 --> 00:03:32,359
the premise of really kind of what this

84
00:03:29,389 --> 00:03:34,400
talk is using that small utility that

85
00:03:32,359 --> 00:03:35,900
can help us automate some of the

86
00:03:34,400 --> 00:03:39,010
interactions that we have with our

87
00:03:35,900 --> 00:03:41,209
computer and that victim or that target

88
00:03:39,010 --> 00:03:42,978
get to that when it comes but we'll talk

89
00:03:41,209 --> 00:03:44,599
about some regular pen test stuffs you

90
00:03:42,979 --> 00:03:46,280
will talk about enumeration we'll talk

91
00:03:44,599 --> 00:03:48,108
about exfiltration a little bit of

92
00:03:46,280 --> 00:03:51,229
examples for persistence what you could

93
00:03:48,109 --> 00:03:53,750
do I wanted to throw in some lateral

94
00:03:51,229 --> 00:03:57,109
movement it'd be cool to throw in some

95
00:03:53,750 --> 00:03:59,329
privilege escalation but we have so much

96
00:03:57,109 --> 00:04:02,060
time hopefully we can still make this

97
00:03:59,329 --> 00:04:05,269
worthwhile and obviously there's more

98
00:04:02,060 --> 00:04:06,829
you can do I leave it to you there's any

99
00:04:05,269 --> 00:04:08,870
kind of homework or extracurricular

100
00:04:06,829 --> 00:04:12,280
you're on the move for will open it for

101
00:04:08,870 --> 00:04:12,280
questions and if you want to reach me

102
00:04:12,900 --> 00:04:15,319
all good

103
00:04:16,940 --> 00:04:23,930
so

104
00:04:18,480 --> 00:04:23,930
box right what is this what am i doing

105
00:04:25,540 --> 00:04:30,130
to answer whatever

106
00:04:28,180 --> 00:04:32,289
IP address for a machine bashed and

107
00:04:30,130 --> 00:04:34,180
that's a retired machine so you might

108
00:04:32,289 --> 00:04:35,199
need that VIP account to be able to

109
00:04:34,180 --> 00:04:38,800
reach it or play with it

110
00:04:35,199 --> 00:04:40,690
it's a Linux machine that's really going

111
00:04:38,800 --> 00:04:43,570
to be my target kind of my scope for

112
00:04:40,690 --> 00:04:45,370
this talk Linux machines I'm running a

113
00:04:43,570 --> 00:04:48,460
Linux machine I'm on Ubuntu right now

114
00:04:45,370 --> 00:04:51,669
just Ubuntu 1904 I know hey normally

115
00:04:48,460 --> 00:04:53,680
we'd want to just use Kali I tend to do

116
00:04:51,669 --> 00:04:56,740
stuff from my hosts which may be good

117
00:04:53,680 --> 00:04:58,180
and bad but it one two will be handy for

118
00:04:56,740 --> 00:04:59,259
our repositories and some of the tools

119
00:04:58,180 --> 00:05:02,050
and techniques we're just going to grab

120
00:04:59,259 --> 00:05:04,389
real quick so all I've done is added

121
00:05:02,050 --> 00:05:06,009
that bash machine give it a quick domain

122
00:05:04,389 --> 00:05:09,550
name threw it into my etcetera host file

123
00:05:06,009 --> 00:05:12,780
so I can use bash htb to get to the

124
00:05:09,550 --> 00:05:12,780
machine real quick

125
00:05:14,029 --> 00:05:18,979
you will need to of course be using an

126
00:05:16,369 --> 00:05:21,349
Open VPN key to get in there so you make

127
00:05:18,979 --> 00:05:23,179
that connection make sure you can

128
00:05:21,349 --> 00:05:26,839
connect to it and you'll see hack the

129
00:05:23,179 --> 00:05:28,299
box on its web page here and there is

130
00:05:26,839 --> 00:05:30,860
that bash machine if you guys are

131
00:05:28,299 --> 00:05:31,818
interested or have you guys does anyone

132
00:05:30,860 --> 00:05:34,699
that has already compromised this

133
00:05:31,819 --> 00:05:36,999
machine is it totally easy or new for

134
00:05:34,699 --> 00:05:36,999
anyone

135
00:05:41,890 --> 00:05:45,659
the access code to get into hack the box

136
00:05:46,800 --> 00:05:54,300
yes yeah the VPN key if you need to on

137
00:05:51,930 --> 00:05:56,940
the left hand side there's an access tab

138
00:05:54,300 --> 00:05:59,419
that will let you download those VPN key

139
00:05:56,940 --> 00:05:59,419
connections

140
00:06:01,820 --> 00:06:10,180
has anyone done this Bosch machine

141
00:06:03,650 --> 00:06:10,179
before okay okay whatever no worries

142
00:06:11,639 --> 00:06:17,100
- machine is simple

143
00:06:14,700 --> 00:06:19,170
on their front-facing web page you know

144
00:06:17,100 --> 00:06:21,630
you do your typical and Matt scan to see

145
00:06:19,170 --> 00:06:23,490
what ports and services are open for ATS

146
00:06:21,630 --> 00:06:25,650
open so you've got apache or nginx

147
00:06:23,490 --> 00:06:27,150
running some webserver that says hey

148
00:06:25,650 --> 00:06:30,960
we've got a blog for you

149
00:06:27,150 --> 00:06:34,679
and there's PHP bash there's some nifty

150
00:06:30,960 --> 00:06:37,409
utility that this developer has created

151
00:06:34,680 --> 00:06:41,100
that helps a lot with pen testing and

152
00:06:37,410 --> 00:06:43,860
that it's just a simple web shell what

153
00:06:41,100 --> 00:06:45,960
you could do and more of the route to

154
00:06:43,860 --> 00:06:47,760
compromise the machine is do some more

155
00:06:45,960 --> 00:06:49,650
enumeration okay can i brute force

156
00:06:47,760 --> 00:06:52,170
directories on that website can I run

157
00:06:49,650 --> 00:06:55,650
dirt Buster or go Buster or any of those

158
00:06:52,170 --> 00:06:57,930
things and you'll find one dev board

159
00:06:55,650 --> 00:07:00,929
slash dev like oh maybe the developer

160
00:06:57,930 --> 00:07:04,380
left some things on this machine and you

161
00:07:00,930 --> 00:07:07,610
can see that PHP bash actual script and

162
00:07:04,380 --> 00:07:07,610
utility that you left on there

163
00:07:07,710 --> 00:07:10,549
show you that here

164
00:07:11,759 --> 00:07:20,849
this PHP bash script is an interactive

165
00:07:16,229 --> 00:07:24,508
web show I could run LS or ID or Who am

166
00:07:20,849 --> 00:07:26,909
I or anything I wanted to it just

167
00:07:24,509 --> 00:07:30,720
immediately gave me code execution on

168
00:07:26,910 --> 00:07:34,080
the machine so super simple maybe not

169
00:07:30,720 --> 00:07:37,139
immediately applicable to real world but

170
00:07:34,080 --> 00:07:38,669
a fine example and that's all the

171
00:07:37,139 --> 00:07:41,030
premise of this talk does that work is

172
00:07:38,669 --> 00:07:41,030
that cool

173
00:07:44,210 --> 00:07:49,698
so if we had some code execution on that

174
00:07:47,180 --> 00:07:53,389
box just simply granted to us by that

175
00:07:49,699 --> 00:07:55,100
web shell what would we want to do maybe

176
00:07:53,389 --> 00:07:57,710
it's best to get a reverse shell or some

177
00:07:55,100 --> 00:07:59,000
better use of it than just that web

178
00:07:57,710 --> 00:08:02,388
shell there are a lot of different ways

179
00:07:59,000 --> 00:08:04,070
you could do this the language that you

180
00:08:02,389 --> 00:08:06,350
choose for a reverse shell can be

181
00:08:04,070 --> 00:08:08,930
anything that you actually have access

182
00:08:06,350 --> 00:08:12,949
to if this is the Linux machine running

183
00:08:08,930 --> 00:08:15,889
- maybe it has netcat use probably has

184
00:08:12,949 --> 00:08:18,680
Python we could use it's on a web server

185
00:08:15,889 --> 00:08:20,630
but we could use PHP if it will evaluate

186
00:08:18,680 --> 00:08:23,660
that and we know that it's doing that

187
00:08:20,630 --> 00:08:25,280
right now we actually see a directory

188
00:08:23,660 --> 00:08:28,190
that we have rightt access in that

189
00:08:25,280 --> 00:08:29,570
uploads directory we could highlight

190
00:08:28,190 --> 00:08:31,130
that and say oh maybe that's maybe

191
00:08:29,570 --> 00:08:33,340
that's a location target we can move

192
00:08:31,130 --> 00:08:33,340
into

193
00:08:37,309 --> 00:08:43,429
have you guys seen the pen test monkey

194
00:08:40,039 --> 00:08:45,920
reverse shell cheat sheet

195
00:08:43,429 --> 00:08:48,310
it's an awesome resource you guys

196
00:08:45,920 --> 00:08:48,310
haven't seen

197
00:08:52,140 --> 00:08:54,470
awesome

198
00:08:55,050 --> 00:08:59,339
pentas monkey reverse shell cheat sheet

199
00:08:56,940 --> 00:09:03,180
if you're just google reverse shell

200
00:08:59,339 --> 00:09:05,100
cheat sheet you can pull this up again

201
00:09:03,180 --> 00:09:06,989
the syntax for different languages to

202
00:09:05,100 --> 00:09:07,770
actually get that reverse shell call

203
00:09:06,990 --> 00:09:10,380
back to you

204
00:09:07,770 --> 00:09:12,300
Barry's right depending if you're in

205
00:09:10,380 --> 00:09:14,100
bash or you're in Perl and Python or in

206
00:09:12,300 --> 00:09:16,800
Ruby or whatever the case may be but

207
00:09:14,100 --> 00:09:20,160
this cheat sheet gives you small super

208
00:09:16,800 --> 00:09:23,660
simple and compress one-liners you just

209
00:09:20,160 --> 00:09:23,660
copy and paste and slap right in

210
00:09:25,900 --> 00:09:32,650
I had been a gold with this for a little

211
00:09:29,380 --> 00:09:36,189
bit or some reason netcat wasn't coming

212
00:09:32,650 --> 00:09:38,370
out we could do the PHP web shell but

213
00:09:36,190 --> 00:09:41,800
the Python one seemed to work best so

214
00:09:38,370 --> 00:09:45,130
let's try that you do of course need a

215
00:09:41,800 --> 00:09:46,540
listener on your own machine cally or a

216
00:09:45,130 --> 00:09:48,670
bun to somebody actually just stand by

217
00:09:46,540 --> 00:09:53,069
and catch that shell that comes back to

218
00:09:48,670 --> 00:09:53,069
you so let's jam with that

219
00:09:57,760 --> 00:09:59,819
you

220
00:10:06,920 --> 00:10:11,709
what am I doing here see it sorry

221
00:10:12,360 --> 00:10:18,080
yeah yeah what are those arguments do

222
00:10:15,090 --> 00:10:18,080
you guys know off the top of your head

223
00:10:20,780 --> 00:10:26,980
I like to use n because it says don't

224
00:10:23,930 --> 00:10:29,839
deal with domain names sometimes in some

225
00:10:26,980 --> 00:10:32,440
exercise environments we had we would

226
00:10:29,840 --> 00:10:32,440
try and pull

227
00:10:32,540 --> 00:10:36,740
some virtual machines that just had the

228
00:10:35,060 --> 00:10:39,040
wrong IP address and things were way way

229
00:10:36,740 --> 00:10:39,040
broke

230
00:10:39,510 --> 00:10:43,110
I'm just gonna modify this a little bit

231
00:10:41,040 --> 00:10:44,520
so I can grab my IP address in here

232
00:10:43,110 --> 00:10:46,410
because we do need a supply of course

233
00:10:44,520 --> 00:10:48,890
our act the location the port that we're

234
00:10:46,410 --> 00:10:48,890
going to use

235
00:10:50,820 --> 00:10:56,970
I like to use 9001

236
00:10:54,170 --> 00:10:59,329
greater than nine thousand

237
00:10:56,970 --> 00:10:59,330
the joke

238
00:11:01,529 --> 00:11:05,610
laughs that in and ideally fingers

239
00:11:03,689 --> 00:11:10,430
crossed we've got a shell on that box oh

240
00:11:05,610 --> 00:11:12,689
I could run things like LS and ID

241
00:11:10,430 --> 00:11:16,128
interact with it the same way that I

242
00:11:12,689 --> 00:11:16,129
would a regular show

243
00:11:16,940 --> 00:11:20,720
and that's what we want to do as we're

244
00:11:18,950 --> 00:11:23,220
pen testers we're doing that thing we're

245
00:11:20,720 --> 00:11:25,860
offering on that machine

246
00:11:23,220 --> 00:11:29,360
but this is kind of janky you guys

247
00:11:25,860 --> 00:11:32,629
working with the reverse shell for right

248
00:11:29,360 --> 00:11:37,220
off the bat you might be trying to use

249
00:11:32,629 --> 00:11:39,019
some commands maybe you had a typo like

250
00:11:37,220 --> 00:11:41,389
OLS tak something and you move your

251
00:11:39,019 --> 00:11:43,189
arrow keys back to modify that or you

252
00:11:41,389 --> 00:11:45,920
want to hit up arrow to go to your

253
00:11:43,189 --> 00:11:47,868
history or maybe you want to catch some

254
00:11:45,920 --> 00:11:49,610
of the files that are in the current

255
00:11:47,869 --> 00:11:55,899
directory but your tab autocomplete

256
00:11:49,610 --> 00:11:55,899
doesn't work it's annoying and silly so

257
00:11:57,680 --> 00:12:01,250
you do that every single time you've got

258
00:11:59,960 --> 00:12:03,290
your reverse shell connection now you

259
00:12:01,250 --> 00:12:06,550
move on the same technique some of you

260
00:12:03,290 --> 00:12:09,740
might know to stabilize that shell and

261
00:12:06,550 --> 00:12:11,810
you do that every single time

262
00:12:09,740 --> 00:12:13,940
you get on a machine usually if you're

263
00:12:11,810 --> 00:12:15,109
on Linux you want a stable shell you

264
00:12:13,940 --> 00:12:19,850
guys know this magic trick

265
00:12:15,110 --> 00:12:22,279
Python open up a PTY spawned in bash and

266
00:12:19,850 --> 00:12:27,470
you hit control Z bring yourself back to

267
00:12:22,279 --> 00:12:29,750
your host stty raw - echo sets your

268
00:12:27,470 --> 00:12:30,890
terminal in raw mode so keystrokes are

269
00:12:29,750 --> 00:12:33,589
happening immediately there's no

270
00:12:30,890 --> 00:12:35,120
buffering it won't echo that out your

271
00:12:33,589 --> 00:12:39,040
foreground to get back into your reverse

272
00:12:35,120 --> 00:12:42,490
shell and then you set a terminal

273
00:12:39,040 --> 00:12:42,490
environment variable

274
00:12:44,100 --> 00:12:49,170
this every single time so I thought in

275
00:12:47,310 --> 00:12:50,670
myself like well this is dumb it's it's

276
00:12:49,170 --> 00:12:53,189
just a little bit it's just like four

277
00:12:50,670 --> 00:12:54,599
lines of code right but if I miss type

278
00:12:53,190 --> 00:12:56,100
I'm gonna have to use the arrow key

279
00:12:54,600 --> 00:12:57,600
again and that's gonna break everything

280
00:12:56,100 --> 00:12:59,530
and I'll hit control-c and I'll lose my

281
00:12:57,600 --> 00:13:02,630
shell

282
00:12:59,530 --> 00:13:04,420
how can I automate that

283
00:13:02,630 --> 00:13:06,800
the problem is we can't write a script

284
00:13:04,420 --> 00:13:08,939
because it's a new machine that we just

285
00:13:06,800 --> 00:13:10,469
broke into

286
00:13:08,940 --> 00:13:13,140
you'd be writing the same thing we

287
00:13:10,470 --> 00:13:15,200
literally do the act we do that exact

288
00:13:13,140 --> 00:13:15,199
thing

289
00:13:16,430 --> 00:13:22,010
bond that up real quick just so

290
00:13:19,470 --> 00:13:22,010
we're following along

291
00:13:26,540 --> 00:13:28,599
you

292
00:13:28,900 --> 00:13:33,939
they don't fudge this

293
00:13:31,880 --> 00:13:33,939
you

294
00:13:34,889 --> 00:13:36,949
you

295
00:13:41,560 --> 00:13:49,420
okay now I can tab autocomplete things

296
00:13:45,720 --> 00:13:52,149
now I can use the up and down ease to

297
00:13:49,420 --> 00:13:56,279
have my history I can hit ctrl C and I

298
00:13:52,149 --> 00:13:56,279
won't accidentally kill my fragile shell

299
00:13:56,750 --> 00:14:01,269
that's nice for us

300
00:13:59,139 --> 00:14:03,129
the issue is how can we do this every

301
00:14:01,269 --> 00:14:05,170
time without having to have to type that

302
00:14:03,129 --> 00:14:05,619
stupid thing over and over and over

303
00:14:05,170 --> 00:14:09,219
again

304
00:14:05,619 --> 00:14:11,259
so that's the premise of xt e and again

305
00:14:09,220 --> 00:14:14,889
this is cheesy let's see what you guys

306
00:14:11,259 --> 00:14:19,480
think xt e is a tool that comes with x

307
00:14:14,889 --> 00:14:22,329
automation and it's essentially letting

308
00:14:19,480 --> 00:14:24,399
you use your mouse and keyboard in a

309
00:14:22,329 --> 00:14:26,138
programmatic or scripted way so it's

310
00:14:24,399 --> 00:14:28,269
like you type that can me that you type

311
00:14:26,139 --> 00:14:30,609
the keys on the keyboard but you didn't

312
00:14:28,269 --> 00:14:33,519
really you had your program do that it's

313
00:14:30,609 --> 00:14:38,230
like the visual basic script send keys

314
00:14:33,519 --> 00:14:39,910
then you guys know that old one so if

315
00:14:38,230 --> 00:14:41,379
you're on a bun too if you have it in

316
00:14:39,910 --> 00:14:44,230
your package managers you can sudo apt

317
00:14:41,379 --> 00:14:48,009
install X automation and then to get a

318
00:14:44,230 --> 00:14:50,379
simple string it's X to e STR and the

319
00:14:48,009 --> 00:14:52,079
string you want to type you can hit keys

320
00:14:50,379 --> 00:14:55,119
like the Enter key you can even hit

321
00:14:52,079 --> 00:14:58,059
control keys or shift keys or alt keys

322
00:14:55,119 --> 00:15:01,749
or super keys and you can kind of blend

323
00:14:58,059 --> 00:15:05,649
them with a keydown and keyup to maybe

324
00:15:01,749 --> 00:15:07,720
use a ctrl L or a control C or send

325
00:15:05,649 --> 00:15:10,110
those signals that we might want in our

326
00:15:07,720 --> 00:15:10,110
terminal

327
00:15:17,380 --> 00:15:24,649
xee string LS it's automatically there

328
00:15:21,790 --> 00:15:27,170
as if I were to type it

329
00:15:24,649 --> 00:15:29,439
ride that xte return or any of those

330
00:15:27,170 --> 00:15:29,439
cases

331
00:15:31,580 --> 00:15:36,180
might hit the enter key that me maybe

332
00:15:33,050 --> 00:15:38,029
might not see you at that speed

333
00:15:36,180 --> 00:15:41,870
those are some small primitives that

334
00:15:38,029 --> 00:15:41,870
maybe we could build out

335
00:15:43,570 --> 00:15:46,110
scripting

336
00:15:47,520 --> 00:15:52,300
I've got a shebang line up front it was

337
00:15:50,339 --> 00:15:53,920
a shell script

338
00:15:52,300 --> 00:15:56,140
just defining some functions some

339
00:15:53,920 --> 00:15:58,540
convenience things that I might be able

340
00:15:56,140 --> 00:16:01,590
to pull down and use later another

341
00:15:58,540 --> 00:16:01,589
scripts or other code

342
00:16:02,240 --> 00:16:05,740
what does that command function do

343
00:16:07,490 --> 00:16:10,810
that dollar sign one

344
00:16:11,510 --> 00:16:15,100
that's the argument to that function

345
00:16:15,459 --> 00:16:22,209
type that wait just a half a second and

346
00:16:18,689 --> 00:16:24,040
run it if we're in the shell same thing

347
00:16:22,209 --> 00:16:26,529
with control maybe we take an argument

348
00:16:24,040 --> 00:16:30,189
control owl or control Z you whatever we

349
00:16:26,529 --> 00:16:32,230
wanted to and then we'd send that right

350
00:16:30,189 --> 00:16:34,990
along

351
00:16:32,230 --> 00:16:38,190
small right simple kind of cheesy maybe

352
00:16:34,990 --> 00:16:38,190
it'll work for us maybe that'd be cool

353
00:16:40,600 --> 00:16:46,420
oh I have that in my functions Sh script

354
00:16:44,260 --> 00:16:47,020
that totally looks bad when I print it

355
00:16:46,420 --> 00:16:49,860
out sorry

356
00:16:47,020 --> 00:16:49,860
that's a mess

357
00:16:51,610 --> 00:16:56,070
like it run command ID

358
00:16:56,449 --> 00:17:01,998
it runs which is weird it's like a

359
00:16:58,669 --> 00:17:04,879
regular bash script but it bridges the

360
00:17:01,999 --> 00:17:07,760
gap between me running it on my actual

361
00:17:04,880 --> 00:17:12,079
computer and inside the reverse shell on

362
00:17:07,760 --> 00:17:16,010
the target computer so I could command

363
00:17:12,079 --> 00:17:20,119
LS I could control L it'll clear the

364
00:17:16,010 --> 00:17:23,619
screen for me roll C you can see that

365
00:17:20,119 --> 00:17:23,619
keystrokes automated for me

366
00:17:23,939 --> 00:17:28,850
for small primitives but now we could

367
00:17:26,789 --> 00:17:31,190
probably expand to something cool like

368
00:17:28,850 --> 00:17:34,699
just that simple technique of

369
00:17:31,190 --> 00:17:34,700
stabilizing our shell

370
00:17:38,910 --> 00:17:47,550
so here's a stabilized shell Sh script

371
00:17:42,450 --> 00:17:50,570
first thing I do is source what is that

372
00:17:47,550 --> 00:17:50,570
why do I use source

373
00:17:54,580 --> 00:17:56,639
you

374
00:17:59,340 --> 00:18:03,480
yep president working directory with

375
00:18:01,889 --> 00:18:05,370
some command substitution tells me where

376
00:18:03,480 --> 00:18:08,460
I am right now with all my other code

377
00:18:05,370 --> 00:18:12,500
that source command why wouldn't I just

378
00:18:08,460 --> 00:18:15,100
run like dot slash functions that Sh

379
00:18:12,500 --> 00:18:15,100
maybe

380
00:18:15,600 --> 00:18:21,389
yeah if I were to just dot slash

381
00:18:19,140 --> 00:18:23,580
functions on Sh it's gonna be in its own

382
00:18:21,390 --> 00:18:26,610
little bash encapsulated cage and I'm

383
00:18:23,580 --> 00:18:28,260
not happening in the current nope the

384
00:18:26,610 --> 00:18:30,449
source will run that in the current

385
00:18:28,260 --> 00:18:34,550
scope so I can actually use that command

386
00:18:30,450 --> 00:18:34,550
function with that control function

387
00:18:34,610 --> 00:18:40,519
I've got my little magic trick the

388
00:18:37,909 --> 00:18:44,000
Python using that command function so it

389
00:18:40,519 --> 00:18:48,010
types it out runs it Rosie as TTY

390
00:18:44,000 --> 00:18:48,010
Ramaiah Seco FG

391
00:18:48,210 --> 00:18:51,260
same recipe as before right

392
00:18:53,750 --> 00:19:00,040
you guys have any thoughts

393
00:18:56,420 --> 00:19:00,040
is there so anything weird about this

394
00:19:03,040 --> 00:19:05,100
you

395
00:19:05,270 --> 00:19:07,330
you

396
00:19:08,660 --> 00:19:12,830
that's a hope

397
00:19:10,970 --> 00:19:15,060
you

398
00:19:12,830 --> 00:19:17,340
one thing that I'm actually curious

399
00:19:15,060 --> 00:19:20,850
about now is it how can I run this

400
00:19:17,340 --> 00:19:21,899
script dot slash stabilized shell is

401
00:19:20,850 --> 00:19:23,730
that's gonna have to run on my machine

402
00:19:21,900 --> 00:19:26,430
that's where it lives but it's not going

403
00:19:23,730 --> 00:19:29,000
to have the focus of inside of the

404
00:19:26,430 --> 00:19:29,000
reverse shell

405
00:19:31,429 --> 00:19:36,339
I'm gonna have to focus what window I'm

406
00:19:33,499 --> 00:19:36,339
actually working in

407
00:19:38,759 --> 00:19:44,750
as I could run

408
00:19:40,530 --> 00:19:44,750
stabilized shell but

409
00:19:44,950 --> 00:19:50,710
stabilize my own show I need that to

410
00:19:47,020 --> 00:19:55,000
actually happen for the reversal let me

411
00:19:50,710 --> 00:19:56,440
uh kind of continue that

412
00:19:55,000 --> 00:19:59,950
so the solution that I want to present

413
00:19:56,440 --> 00:20:03,670
or at least an option is that utility

414
00:19:59,950 --> 00:20:05,890
called quake it's a terminal that's all

415
00:20:03,670 --> 00:20:08,140
it is it's a small simple a little

416
00:20:05,890 --> 00:20:10,390
terminal emulator

417
00:20:08,140 --> 00:20:12,880
interesting thing is that it's a little

418
00:20:10,390 --> 00:20:14,800
heads-up display like it'll just kind of

419
00:20:12,880 --> 00:20:17,140
pop up at the top whenever you invoke it

420
00:20:14,800 --> 00:20:20,580
and no way you can toggle whether or not

421
00:20:17,140 --> 00:20:20,580
that terminal is visible or not

422
00:20:20,790 --> 00:20:25,100
whether or not you want to use it

423
00:20:23,390 --> 00:20:27,260
so if you were to install quake you

424
00:20:25,100 --> 00:20:29,149
could modify some of the keyboard

425
00:20:27,260 --> 00:20:31,190
settings that actually allow you to

426
00:20:29,150 --> 00:20:34,100
invoke the wake and bring it up have

427
00:20:31,190 --> 00:20:35,900
that heads-up display terminal shown you

428
00:20:34,100 --> 00:20:38,230
can toggle with a simple keystroke to

429
00:20:35,900 --> 00:20:38,230
hide it

430
00:20:38,280 --> 00:20:43,500
small utility but kind of handy and now

431
00:20:41,490 --> 00:20:48,840
if we could actually use that keyboard

432
00:20:43,500 --> 00:20:52,200
shortcut what's to stop us with xte run

433
00:20:48,840 --> 00:20:53,879
the script on our host I'd wake suddenly

434
00:20:52,200 --> 00:20:57,140
take the focus of our reverse shell and

435
00:20:53,880 --> 00:20:57,140
run that as needed

436
00:20:59,780 --> 00:21:05,149
well I set up my keyboard keystroke for

437
00:21:01,880 --> 00:21:07,360
Quake eyes shift to return so just real

438
00:21:05,150 --> 00:21:11,360
quick here's a terminal and a new scope

439
00:21:07,360 --> 00:21:12,500
but I could work with and run I can open

440
00:21:11,360 --> 00:21:15,559
and close that as needed

441
00:21:12,500 --> 00:21:18,530
so if inside of our functions that Sh

442
00:21:15,559 --> 00:21:22,190
script we made a simple as hi quake put

443
00:21:18,530 --> 00:21:25,549
it away run that key ship return shift

444
00:21:22,190 --> 00:21:27,190
enter and every time we had a script

445
00:21:25,549 --> 00:21:28,700
that were to actually do something

446
00:21:27,190 --> 00:21:31,429
useful for us

447
00:21:28,700 --> 00:21:33,470
stabilize a shell we could just hide

448
00:21:31,429 --> 00:21:37,270
quake before we do anything so it'll hop

449
00:21:33,470 --> 00:21:37,270
back to the focus of our reversal

450
00:21:45,679 --> 00:21:51,740
if I can get another quick reverse shell

451
00:21:49,289 --> 00:21:51,740
for us

452
00:21:57,639 --> 00:21:59,699
you

453
00:22:06,430 --> 00:22:12,340
okay so now if I just had a reverse

454
00:22:09,910 --> 00:22:14,830
shell and I've created this stabilized

455
00:22:12,340 --> 00:22:19,409
shell script it will automatically type

456
00:22:14,830 --> 00:22:19,409
all those keys for us super simple

457
00:22:20,620 --> 00:22:26,169
I shall immediately hide wake run those

458
00:22:23,050 --> 00:22:29,080
commands and I'm just left at a new

459
00:22:26,170 --> 00:22:31,870
prompt where I have my tab complete

460
00:22:29,080 --> 00:22:34,860
where I have my command history right

461
00:22:31,870 --> 00:22:37,830
don't accidentally kill my shell

462
00:22:34,860 --> 00:22:39,750
that's kind of small kind of simple all

463
00:22:37,830 --> 00:22:44,389
we've really done is just bridge the gap

464
00:22:39,750 --> 00:22:48,860
between our host machine and the victim

465
00:22:44,390 --> 00:22:48,860
but what more could we do with that

466
00:22:50,350 --> 00:22:55,570
to step back and automate getting the

467
00:22:53,260 --> 00:22:56,950
reverse shell maybe that's a hiccup

468
00:22:55,570 --> 00:22:58,539
maybe you're like oh I have to know what

469
00:22:56,950 --> 00:23:00,660
my IP address is currently I need to

470
00:22:58,539 --> 00:23:03,010
know what port I'm gonna actually use

471
00:23:00,660 --> 00:23:06,929
sometimes that's stupid and annoying too

472
00:23:03,010 --> 00:23:06,929
like I've done this however many times

473
00:23:08,320 --> 00:23:14,480
we just have those ingredients with our

474
00:23:11,380 --> 00:23:17,659
shell with our shell script

475
00:23:14,480 --> 00:23:20,989
we need our IP address our attacker our

476
00:23:17,659 --> 00:23:24,470
victim or our packing machine we need

477
00:23:20,989 --> 00:23:26,660
that port that we want to listen on

478
00:23:24,470 --> 00:23:27,980
we can just carve that information out

479
00:23:26,660 --> 00:23:31,100
you guys might normally use like

480
00:23:27,980 --> 00:23:34,520
ifconfig right or IP at or all that

481
00:23:31,100 --> 00:23:37,399
gives you a bunch of output this regular

482
00:23:34,520 --> 00:23:39,170
expression gobbledygook will parse that

483
00:23:37,400 --> 00:23:42,320
out and just grab only your IP address

484
00:23:39,170 --> 00:23:44,740
in this case I'm using ton zero as my

485
00:23:42,320 --> 00:23:44,740
interface

486
00:23:44,840 --> 00:23:48,260
you might need to adjust that or change

487
00:23:47,120 --> 00:23:51,408
that for whatever you actually might be

488
00:23:48,260 --> 00:23:55,158
using and in bash I can just get a

489
00:23:51,409 --> 00:23:57,590
random high port by taking random and

490
00:23:55,159 --> 00:24:00,520
adding some numbers to it random I think

491
00:23:57,590 --> 00:24:03,709
goes from 0 to like 32,000 or something

492
00:24:00,520 --> 00:24:07,750
so I just amped up a 3000 after that so

493
00:24:03,710 --> 00:24:07,750
we know we're in a clear port range

494
00:24:10,690 --> 00:24:19,580
we have the exact same problem of focus

495
00:24:15,830 --> 00:24:21,350
to try and run a reverse shell maybe I

496
00:24:19,580 --> 00:24:24,350
wanted to spawn a new window a new

497
00:24:21,350 --> 00:24:26,480
terminal that would capture that reverse

498
00:24:24,350 --> 00:24:28,459
shell and catch it for me but we need to

499
00:24:26,480 --> 00:24:32,510
be able to switch back to our actual

500
00:24:28,460 --> 00:24:35,960
code execution vantage point so you can

501
00:24:32,510 --> 00:24:37,029
just make a small alt-tab function nice

502
00:24:35,960 --> 00:24:41,600
and easy

503
00:24:37,029 --> 00:24:43,190
literally exactly that it alt-tab and

504
00:24:41,600 --> 00:24:45,320
next to you will let you do that nice

505
00:24:43,190 --> 00:24:48,940
and easy for you

506
00:24:45,320 --> 00:24:48,939
which windows a small sample

507
00:24:50,990 --> 00:24:55,970
we could use that functionality again we

508
00:24:53,990 --> 00:24:58,220
know how we can grab our IP address in

509
00:24:55,970 --> 00:25:00,980
the scope of our own host scope of our

510
00:24:58,220 --> 00:25:04,040
attacker machine quickly grab a port to

511
00:25:00,980 --> 00:25:06,620
use I'd wake because maybe we use that

512
00:25:04,040 --> 00:25:08,120
to invoke it and I like to use

513
00:25:06,620 --> 00:25:09,739
terminator because that way I can split

514
00:25:08,120 --> 00:25:12,659
my screen as needed to if I need to do

515
00:25:09,740 --> 00:25:16,620
some other operations

516
00:25:12,660 --> 00:25:20,310
give it just a little bit catch run my

517
00:25:16,620 --> 00:25:22,800
netcat listener switch back to the

518
00:25:20,310 --> 00:25:25,440
context of the actual RCE vector and

519
00:25:22,800 --> 00:25:27,919
maybe you could slap in that reverse

520
00:25:25,440 --> 00:25:27,920
shell code

521
00:25:28,190 --> 00:25:32,360
and now you can use those variables the

522
00:25:30,650 --> 00:25:33,800
Bosch figured out for you you don't have

523
00:25:32,360 --> 00:25:35,780
to hand jam it in like I did at the

524
00:25:33,800 --> 00:25:38,930
beginning of the talk again super super

525
00:25:35,780 --> 00:25:41,899
small but maybe that will speed you up

526
00:25:38,930 --> 00:25:44,480
some of the real things

527
00:25:41,900 --> 00:25:48,650
I notice this has a little bit of a

528
00:25:44,480 --> 00:25:50,950
gimmick and limitation xte typing a

529
00:25:48,650 --> 00:25:53,240
really really really long string

530
00:25:50,950 --> 00:25:54,710
maybe it'll miss some characters so I

531
00:25:53,240 --> 00:25:57,650
haven't had as much success with the

532
00:25:54,710 --> 00:26:02,920
Python means but the netcat one is

533
00:25:57,650 --> 00:26:05,420
pretty simple and that's just the syntax

534
00:26:02,920 --> 00:26:07,690
from pen test monkey that reverse shell

535
00:26:05,420 --> 00:26:07,690
she she

536
00:26:08,200 --> 00:26:11,859
and I've also moved the IP address

537
00:26:10,029 --> 00:26:13,570
variable just grabbing that setting it I

538
00:26:11,859 --> 00:26:15,789
move that into the function status age

539
00:26:13,570 --> 00:26:17,230
because that might be handy for us we're

540
00:26:15,789 --> 00:26:18,340
probably going to end up using that and

541
00:26:17,230 --> 00:26:21,840
just about everything that we would

542
00:26:18,340 --> 00:26:21,840
build out but now we have a small

543
00:26:27,450 --> 00:26:31,590
I would expect in some cases you might

544
00:26:30,210 --> 00:26:33,870
be able to grab it and just throw it

545
00:26:31,590 --> 00:26:36,000
into the actual vector on the machine

546
00:26:33,870 --> 00:26:38,820
that you're working with that Python one

547
00:26:36,000 --> 00:26:40,290
because it takes so long to type or X to

548
00:26:38,820 --> 00:26:43,860
e to type with it sometimes it doesn't

549
00:26:40,290 --> 00:26:46,770
work as well if I had code execution

550
00:26:43,860 --> 00:26:48,899
already in this case this is again just

551
00:26:46,770 --> 00:26:52,110
an educational proof of concept bear

552
00:26:48,900 --> 00:26:54,540
with me if I were to run that netcat

553
00:26:52,110 --> 00:26:56,820
reverse shell I would pop up a new

554
00:26:54,540 --> 00:26:59,220
window grab the listener wait for the

555
00:26:56,820 --> 00:27:02,689
connection and just in that other window

556
00:26:59,220 --> 00:27:02,690
now I have a new show

557
00:27:02,900 --> 00:27:05,890
automate that capability

558
00:27:09,920 --> 00:27:11,980
you

559
00:27:12,230 --> 00:27:18,190
we've got some stuff built small tiny

560
00:27:15,470 --> 00:27:20,470
things that might speed us up

561
00:27:18,190 --> 00:27:22,210
how could we take that further how could

562
00:27:20,470 --> 00:27:25,450
we do real cool pen tests up with that

563
00:27:22,210 --> 00:27:28,780
like meterpreter has that nice upload

564
00:27:25,450 --> 00:27:30,670
and download functionality but in a

565
00:27:28,780 --> 00:27:33,700
regular reverse shell kind of doing it

566
00:27:30,670 --> 00:27:35,820
by hand you don't have that nice and

567
00:27:33,700 --> 00:27:35,820
easy

568
00:27:35,860 --> 00:27:40,320
we can build it now so we've got a

569
00:27:38,830 --> 00:27:42,790
reverse shell connection kind of

570
00:27:40,320 --> 00:27:44,830
packaged in a small script some poor

571
00:27:42,790 --> 00:27:47,170
man's means same thing with stabilizing

572
00:27:44,830 --> 00:27:49,560
our shell now what else could we do on

573
00:27:47,170 --> 00:27:49,560
that box

574
00:27:49,910 --> 00:27:55,420
have you guys seen the enum utility

575
00:27:56,350 --> 00:28:00,060
trying to sprinkle in some resources for

576
00:27:58,000 --> 00:28:01,410
you

577
00:28:00,060 --> 00:28:06,530
this is the script you can find on

578
00:28:01,410 --> 00:28:06,530
github it's a little bash script

579
00:28:07,440 --> 00:28:11,360
we'll just do simple checks on the

580
00:28:10,130 --> 00:28:13,559
machine

581
00:28:11,360 --> 00:28:15,330
what's the hostname what's the kernel

582
00:28:13,559 --> 00:28:16,740
version what operating system is this is

583
00:28:15,330 --> 00:28:18,330
it connected to anything else what

584
00:28:16,740 --> 00:28:22,470
processes are running what services are

585
00:28:18,330 --> 00:28:25,439
there etc it's that rough so it would be

586
00:28:22,470 --> 00:28:28,140
cool is this is another thing on your

587
00:28:25,440 --> 00:28:30,360
checklist every time I get in a box I

588
00:28:28,140 --> 00:28:34,730
run this thing cool if we could just

589
00:28:30,360 --> 00:28:34,729
automate that run through it

590
00:28:37,380 --> 00:28:41,850
course we need to get lynnium on the

591
00:28:39,929 --> 00:28:44,960
machine

592
00:28:41,850 --> 00:28:49,320
how do you guys normally transfer files

593
00:28:44,960 --> 00:28:53,030
between your host and your target as how

594
00:28:49,320 --> 00:28:53,030
many tried-and-true procedures

595
00:28:53,880 --> 00:28:58,830
that was awesome I heard a few protocols

596
00:28:56,250 --> 00:29:04,640
just thrown out I thought I heard SFTP

597
00:28:58,830 --> 00:29:07,770
if you've got that W get ya

598
00:29:04,640 --> 00:29:09,720
Carola just to download stuff

599
00:29:07,770 --> 00:29:12,029
the raw bare-bones stuff is just using

600
00:29:09,720 --> 00:29:14,130
netcat again right if you can if you've

601
00:29:12,029 --> 00:29:16,080
got some of those outbound connections

602
00:29:14,130 --> 00:29:21,029
available to you again I get suspended

603
00:29:16,080 --> 00:29:23,270
disbelief if we could create something

604
00:29:21,029 --> 00:29:26,120
that will grab our ports our power

605
00:29:23,270 --> 00:29:29,600
attacking IP address we already know

606
00:29:26,120 --> 00:29:32,399
maybe take a file name on our machine

607
00:29:29,600 --> 00:29:35,699
it'll listener reading in from that file

608
00:29:32,399 --> 00:29:39,989
that we specified and then automate on

609
00:29:35,700 --> 00:29:43,020
the actual reverse shell pulling that

610
00:29:39,990 --> 00:29:46,730
down quick and simple upload

611
00:29:43,020 --> 00:29:46,730
functionality putting that together

612
00:29:47,460 --> 00:29:53,190
that tack q is for net cat

613
00:29:51,130 --> 00:29:53,190
you

614
00:29:57,029 --> 00:30:02,369
you know when it hits an end-of-file

615
00:29:59,329 --> 00:30:04,889
yeah and a file that says wait however

616
00:30:02,369 --> 00:30:06,299
many seconds wait zero seconds so once

617
00:30:04,889 --> 00:30:09,359
you see the end of file just close it

618
00:30:06,299 --> 00:30:11,959
down we don't need that anymore quick on

619
00:30:09,359 --> 00:30:11,958
the fly

620
00:30:12,820 --> 00:30:16,799
what is a dev s hm

621
00:30:20,470 --> 00:30:23,760
yeah sure memory

622
00:30:24,150 --> 00:30:28,920
to hide on a target or analytics machine

623
00:30:26,790 --> 00:30:31,370
maybe some quick spaces you got four

624
00:30:28,920 --> 00:30:35,450
slash temp that's always world writable

625
00:30:31,370 --> 00:30:35,449
it also have def s hm

626
00:30:46,150 --> 00:30:49,150
No

627
00:30:50,980 --> 00:30:54,890
yeah yeah

628
00:30:52,490 --> 00:30:56,420
that was awesome I hope I hope you're in

629
00:30:54,890 --> 00:30:59,110
the back just jamming through the CTF

630
00:30:56,420 --> 00:31:02,110
right now that was awesome

631
00:30:59,110 --> 00:31:02,110
cool

632
00:31:04,309 --> 00:31:08,928
any thoughts or questions on that simple

633
00:31:06,380 --> 00:31:11,450
technique that's just netcat right but

634
00:31:08,929 --> 00:31:14,150
we could use something with HTTP I heard

635
00:31:11,450 --> 00:31:17,960
W get we could do something with SMB we

636
00:31:14,150 --> 00:31:20,659
could use in packet help W get takes a

637
00:31:17,960 --> 00:31:22,760
little bit more work right let's set up

638
00:31:20,659 --> 00:31:26,270
a terminator or another terminal shell

639
00:31:22,760 --> 00:31:27,830
for us that's got a working directory

640
00:31:26,270 --> 00:31:29,480
where we currently are because we

641
00:31:27,830 --> 00:31:32,210
probably want to upload a file that it's

642
00:31:29,480 --> 00:31:35,929
just relative to us real quick and I'm

643
00:31:32,210 --> 00:31:38,419
going to use that Python simple HTTP

644
00:31:35,929 --> 00:31:42,559
server as you see that one often Python

645
00:31:38,419 --> 00:31:46,150
to tack M is the capital S simple

646
00:31:42,559 --> 00:31:48,610
Apple HTTP capital S server on Python 3

647
00:31:46,150 --> 00:31:51,770
which we all need to migrate to now

648
00:31:48,610 --> 00:31:54,129
2020s common Python 3 we need to use

649
00:31:51,770 --> 00:31:56,980
HTTP server

650
00:31:54,130 --> 00:31:59,370
and specify a quick and easy random port

651
00:31:56,980 --> 00:31:59,370
for us

652
00:32:01,760 --> 00:32:07,950
machine

653
00:32:03,670 --> 00:32:07,950
get that down put it in debits hm

654
00:32:10,059 --> 00:32:16,658
but the poor man's means maybe we could

655
00:32:14,950 --> 00:32:18,669
have something to actually specify and

656
00:32:16,659 --> 00:32:21,759
we really want to put it in dentists hm

657
00:32:18,669 --> 00:32:24,399
we should let the scripts allow the user

658
00:32:21,759 --> 00:32:27,450
to choose where they want to put it's

659
00:32:24,399 --> 00:32:27,449
just an example

660
00:32:29,830 --> 00:32:36,990
what's that alt-tab control see the very

661
00:32:33,430 --> 00:32:36,990
very bottom can you tell what I'm doing

662
00:32:37,890 --> 00:32:40,800
I'm gonna switch back to that other

663
00:32:39,300 --> 00:32:42,470
Terminator that I just open and close

664
00:32:40,800 --> 00:32:45,280
that down

665
00:32:42,470 --> 00:32:45,280
I don't need it

666
00:32:49,509 --> 00:32:55,179
now that we have that small upload

667
00:32:52,730 --> 00:32:55,179
primitive

668
00:32:55,370 --> 00:33:01,429
push Lenny numb over there make it

669
00:32:58,130 --> 00:33:04,100
executable run the thing pipe it to T so

670
00:33:01,430 --> 00:33:05,900
I get some output so I want that log

671
00:33:04,100 --> 00:33:06,860
file I really want to know what it is

672
00:33:05,900 --> 00:33:08,150
and I want it I don't want to have to

673
00:33:06,860 --> 00:33:10,899
deal with running that again sometimes

674
00:33:08,150 --> 00:33:10,900
it takes a long time

675
00:33:12,050 --> 00:33:18,490
and now we have that file but we need to

676
00:33:16,040 --> 00:33:18,490
download it

677
00:33:22,890 --> 00:33:26,920
I realize when I

678
00:33:25,360 --> 00:33:29,010
needed to download something that

679
00:33:26,920 --> 00:33:31,030
running out of just a quick local

680
00:33:29,010 --> 00:33:32,920
present working directory you've seen

681
00:33:31,030 --> 00:33:36,100
that variable over and over again it's

682
00:33:32,920 --> 00:33:37,870
tough to know where you want it to

683
00:33:36,100 --> 00:33:39,610
download to because you probably want it

684
00:33:37,870 --> 00:33:41,530
in your current working directory and if

685
00:33:39,610 --> 00:33:44,649
you have a project set up for that

686
00:33:41,530 --> 00:33:46,809
target well then you don't want to have

687
00:33:44,650 --> 00:33:47,920
all these other simple shell scripts

688
00:33:46,809 --> 00:33:49,320
that we've been building in there with

689
00:33:47,920 --> 00:33:52,030
that because you might have multiple

690
00:33:49,320 --> 00:33:54,340
projects you're playing hack to blocks

691
00:33:52,030 --> 00:33:56,320
just again that educational sense you've

692
00:33:54,340 --> 00:33:57,790
got a folder for different machines it's

693
00:33:56,320 --> 00:34:00,939
stupid to have all those duplicates

694
00:33:57,790 --> 00:34:04,178
there so I thought let's move these

695
00:34:00,940 --> 00:34:07,150
small tools into an actual location

696
00:34:04,179 --> 00:34:08,859
that's that could be their home that can

697
00:34:07,150 --> 00:34:11,290
be their actual place to live and put

698
00:34:08,859 --> 00:34:13,960
that in our path so I use just opt I

699
00:34:11,290 --> 00:34:16,989
like to put my tools and opt and PMP for

700
00:34:13,960 --> 00:34:18,800
poor man's pen test I add that to my

701
00:34:16,989 --> 00:34:23,989
path

702
00:34:18,800 --> 00:34:26,419
put that in my - RC file and quick clue

703
00:34:23,989 --> 00:34:28,009
Jing some take these together because we

704
00:34:26,418 --> 00:34:30,080
ran that source command and all those

705
00:34:28,010 --> 00:34:33,070
scripts we just have to change that real

706
00:34:30,080 --> 00:34:33,069
quick if you were tinkering

707
00:34:33,219 --> 00:34:38,279
and let's bring them all into their home

708
00:34:35,830 --> 00:34:38,279
that hops

709
00:34:40,120 --> 00:34:43,350
now we can run them

710
00:34:43,940 --> 00:34:49,810
that dot slash because it's no longer in

711
00:34:47,030 --> 00:34:52,650
our current directory

712
00:34:49,810 --> 00:34:52,650
that was part of that path

713
00:34:54,690 --> 00:34:58,790
see my upload file and that cat in there

714
00:35:03,520 --> 00:35:07,440
so our download file

715
00:35:09,310 --> 00:35:13,630
that's another little gimmick and gets

716
00:35:10,750 --> 00:35:15,880
to it because it needs to know the

717
00:35:13,630 --> 00:35:19,930
reverse shell the target machine needs

718
00:35:15,880 --> 00:35:23,730
to know our IP address and we don't have

719
00:35:19,930 --> 00:35:23,730
a good means to tell it that

720
00:35:24,400 --> 00:35:29,829
when a when do we need to run commands

721
00:35:26,229 --> 00:35:32,339
on it so I supplied that really has

722
00:35:29,829 --> 00:35:32,339
another argument

723
00:35:33,420 --> 00:35:38,660
or did I P address will be the targets

724
00:35:36,390 --> 00:35:41,000
IP right

725
00:35:38,660 --> 00:35:43,190
10:10 68 in the case of this Bosch

726
00:35:41,000 --> 00:35:50,319
machine the filename that we actually

727
00:35:43,190 --> 00:35:50,319
want to pull on that it'll come to us

728
00:35:53,020 --> 00:35:56,970
what is that pack w

729
00:36:00,990 --> 00:36:06,439
I was struggling with this one because

730
00:36:04,440 --> 00:36:09,290
it does the exact same thing as tack cue

731
00:36:06,440 --> 00:36:14,690
seemingly but in the other direction

732
00:36:09,290 --> 00:36:14,690
tack cue was working yeah

733
00:36:17,910 --> 00:36:23,089
we for just a second grab it spit it to

734
00:36:20,610 --> 00:36:23,090
another file

735
00:36:27,050 --> 00:36:29,110
you

736
00:36:29,869 --> 00:36:34,480
okay

737
00:36:32,200 --> 00:36:36,308
now we again have small simple

738
00:36:34,480 --> 00:36:39,780
poor-man's primitives to do some of that

739
00:36:36,309 --> 00:36:39,780
quick and easy stuff that we might need

740
00:36:40,049 --> 00:36:44,339
else though now that we've got that

741
00:36:42,479 --> 00:36:46,140
download capability Oh we'd let's just

742
00:36:44,339 --> 00:36:48,839
grab its entry password real quick right

743
00:36:46,140 --> 00:36:50,400
off the bat let's check out the services

744
00:36:48,839 --> 00:36:53,249
let's see if there's any directories in

745
00:36:50,400 --> 00:36:55,890
the home what other users might have

746
00:36:53,249 --> 00:36:58,678
some sensitive files that maybe we can

747
00:36:55,890 --> 00:37:02,308
read right we haven't moved out of that

748
00:36:58,679 --> 00:37:04,369
dub-dub-dub data user in our example

749
00:37:02,309 --> 00:37:06,920
right now

750
00:37:04,369 --> 00:37:11,019
maybe some log files and I see a

751
00:37:06,920 --> 00:37:11,019
patchi's access log or error log

752
00:37:11,400 --> 00:37:16,339
are there any SSH keys that I could just

753
00:37:13,499 --> 00:37:19,910
up and read grab that pull that down

754
00:37:16,339 --> 00:37:19,910
figuration files etc

755
00:37:22,260 --> 00:37:30,050
got milk Blagh and basic Linux or the

756
00:37:26,820 --> 00:37:30,050
distillation enumeration

757
00:37:30,450 --> 00:37:34,770
or resources

758
00:37:32,790 --> 00:37:37,079
this one isn't an automated script an

759
00:37:34,770 --> 00:37:38,970
automated tool like Lenny num is but if

760
00:37:37,079 --> 00:37:40,410
you're scraping the bottom of the barrel

761
00:37:38,970 --> 00:37:42,868
you're like man I don't know what to do

762
00:37:40,410 --> 00:37:45,328
I can't find a foothold it's worth it to

763
00:37:42,869 --> 00:37:48,230
look through this little showcase the

764
00:37:45,329 --> 00:37:48,230
hand jam commands

765
00:37:50,690 --> 00:37:53,530
processes etcetera

766
00:37:55,150 --> 00:38:00,670
that link is a log milk again Google

767
00:37:58,870 --> 00:38:03,120
simply got milk Linux privilege

768
00:38:00,670 --> 00:38:03,120
escalation

769
00:38:07,360 --> 00:38:09,420
you

770
00:38:10,700 --> 00:38:15,750
but that's not all right there

771
00:38:14,190 --> 00:38:18,930
things that maybe we've learned about in

772
00:38:15,750 --> 00:38:19,380
our pen testing journeyman projectory in

773
00:38:18,930 --> 00:38:21,330
growth

774
00:38:19,380 --> 00:38:24,470
what if shellshock is in there what's

775
00:38:21,330 --> 00:38:24,470
that you guys seen that one

776
00:38:26,400 --> 00:38:31,250
which is like let you run code through

777
00:38:28,740 --> 00:38:34,009
some environment variable

778
00:38:31,250 --> 00:38:35,510
UID binaries

779
00:38:34,010 --> 00:38:40,510
things that will take the privileges of

780
00:38:35,510 --> 00:38:40,510
another process track those down

781
00:38:40,990 --> 00:38:44,430
lynnie Nam will do that

782
00:38:44,780 --> 00:38:49,580
Tandi for us PS aux checking out

783
00:38:47,210 --> 00:38:52,520
processes netstat and again there's

784
00:38:49,580 --> 00:38:53,990
another utility similar to Lenina the

785
00:38:52,520 --> 00:38:56,270
Linux projector that you could totally

786
00:38:53,990 --> 00:38:59,259
check that out with as well that one is

787
00:38:56,270 --> 00:38:59,259
a known as a Python script

788
00:39:05,150 --> 00:39:10,970
so we could automate

789
00:39:08,480 --> 00:39:11,960
can offer our numeration automated the

790
00:39:10,970 --> 00:39:13,790
reverse shell we've automated

791
00:39:11,960 --> 00:39:15,290
stabilizing that shell we've automated

792
00:39:13,790 --> 00:39:17,080
pulling and downloading some files

793
00:39:15,290 --> 00:39:21,580
putting stuff on there

794
00:39:17,080 --> 00:39:21,580
spit that Linux proof checker on there

795
00:39:26,960 --> 00:39:31,640
and one

796
00:39:32,150 --> 00:39:36,410
if we know what machine our machine

797
00:39:34,640 --> 00:39:38,359
we're working with what our attacking

798
00:39:36,410 --> 00:39:41,770
machine is maybe we could generate SSH

799
00:39:38,360 --> 00:39:46,370
keys real quick throw those on the box

800
00:39:41,770 --> 00:39:48,910
again your mileage may vary I thought

801
00:39:46,370 --> 00:39:48,910
you would do this

802
00:39:49,110 --> 00:39:53,120
to take advantage of some of that code

803
00:39:50,550 --> 00:39:56,870
that we've written through other things

804
00:39:53,120 --> 00:39:56,870
having an SSH key

805
00:39:58,150 --> 00:40:01,410
use ssh-keygen

806
00:40:01,890 --> 00:40:06,120
Tec F to create that file already no

807
00:40:03,930 --> 00:40:08,940
password and that that's that tak half

808
00:40:06,120 --> 00:40:11,220
an empty string

809
00:40:08,940 --> 00:40:12,690
and I was lazy I just threw yes why in

810
00:40:11,220 --> 00:40:15,290
there so I would overwrite stuff while I

811
00:40:12,690 --> 00:40:15,290
was testing

812
00:40:17,190 --> 00:40:22,890
and this is when our upload file

813
00:40:20,730 --> 00:40:25,500
limitation of not choosing the directory

814
00:40:22,890 --> 00:40:27,660
that might get in the way because it'll

815
00:40:25,500 --> 00:40:30,089
automatically put it in Devas HM for us

816
00:40:27,660 --> 00:40:33,410
we would have to okay actually take the

817
00:40:30,089 --> 00:40:33,410
contents and move it ourselves

818
00:40:34,630 --> 00:40:41,340
that's that dog SSH authorized keys

819
00:40:38,730 --> 00:40:44,660
even we actually have right access to

820
00:40:41,340 --> 00:40:47,910
some users as a seiche key but we might

821
00:40:44,660 --> 00:40:49,350
we were able to do that enumeration with

822
00:40:47,910 --> 00:40:51,649
Lin enum and find a foothold in another

823
00:40:49,350 --> 00:40:51,650
account

824
00:40:54,620 --> 00:40:57,370
thoughts on that one

825
00:40:57,869 --> 00:41:02,930
how do you guys like to do persistence

826
00:40:59,759 --> 00:41:02,930
or do you

827
00:41:05,840 --> 00:41:10,200
violence

828
00:41:07,390 --> 00:41:10,200
it was always answer

829
00:41:12,290 --> 00:41:14,350
you

830
00:41:20,310 --> 00:41:22,970
cool

831
00:41:25,240 --> 00:41:29,770
Rufe don't want to leave any artifacts

832
00:41:27,750 --> 00:41:31,540
maybe it'd be nice to have something

833
00:41:29,770 --> 00:41:34,030
like this that will automatically clear

834
00:41:31,540 --> 00:41:36,220
the logs for you or wipe your

835
00:41:34,030 --> 00:41:38,160
fingerprints we could totally scale that

836
00:41:36,220 --> 00:41:41,279
out why not

837
00:41:38,160 --> 00:41:42,839
maybe if you're on a new target you

838
00:41:41,279 --> 00:41:45,930
don't want to write that code over and

839
00:41:42,839 --> 00:41:47,549
over again that's kind of why I thought

840
00:41:45,930 --> 00:41:50,788
this would be a neat trick oh this would

841
00:41:47,549 --> 00:41:53,989
be a neat technique having a cron job I

842
00:41:50,789 --> 00:41:57,089
use a simple thing I set this variable F

843
00:41:53,989 --> 00:41:58,950
the stupid name doesn't not doesn't help

844
00:41:57,089 --> 00:42:00,390
us at all but maybe that's a file name

845
00:41:58,950 --> 00:42:03,868
maybe that's a folder I'm gonna use it

846
00:42:00,390 --> 00:42:07,848
as both I use an ellipses there a dot

847
00:42:03,869 --> 00:42:07,849
dot dot what do you think I use that

848
00:42:13,610 --> 00:42:17,840
yeah sure that's that works for me quick

849
00:42:15,530 --> 00:42:20,180
and easy to type in I like the first

850
00:42:17,840 --> 00:42:22,990
period does that mean it's going to be a

851
00:42:20,180 --> 00:42:22,990
hidden file

852
00:42:23,030 --> 00:42:28,370
and when you have an LS tack la output

853
00:42:25,580 --> 00:42:30,470
you always see a period a period period

854
00:42:28,370 --> 00:42:30,980
for the current directory and the parent

855
00:42:30,470 --> 00:42:33,529
directory

856
00:42:30,980 --> 00:42:36,290
maybe this will just maybe that'll sneak

857
00:42:33,530 --> 00:42:38,260
under someone's radar there's an extra

858
00:42:36,290 --> 00:42:41,980
period period period I don't care

859
00:42:38,260 --> 00:42:41,980
stupid but it might work

860
00:42:42,380 --> 00:42:48,950
and I make a little bash script where I

861
00:42:44,870 --> 00:42:52,210
include that reverse shell syntax with

862
00:42:48,950 --> 00:42:52,210
my IP address in port

863
00:42:53,450 --> 00:42:56,049
so

864
00:42:57,110 --> 00:43:02,840
I'm able to use these variables IP

865
00:42:59,360 --> 00:43:05,410
import when with the command function

866
00:43:02,840 --> 00:43:08,920
they're running within the context of

867
00:43:05,410 --> 00:43:08,920
the target

868
00:43:12,430 --> 00:43:18,200
we've got IP import already pulled in

869
00:43:15,410 --> 00:43:23,660
from functions on Sh we know the scope

870
00:43:18,200 --> 00:43:26,089
but if we're typing out with xt e that

871
00:43:23,660 --> 00:43:28,759
whole command how come it's not typing

872
00:43:26,090 --> 00:43:31,090
literally dollar sign IP in dollar sign

873
00:43:28,760 --> 00:43:31,090
port

874
00:43:34,040 --> 00:43:38,560
sing that up so let me just let me just

875
00:43:35,900 --> 00:43:38,560
give you the answer

876
00:43:39,000 --> 00:43:44,640
actual variable expansion within that

877
00:43:41,640 --> 00:43:48,868
string double quotes are going to

878
00:43:44,640 --> 00:43:52,200
evaluate that variable value before xte

879
00:43:48,869 --> 00:43:56,460
types it out so that way we have a quick

880
00:43:52,200 --> 00:43:59,549
means of handling our target this is our

881
00:43:56,460 --> 00:44:01,530
IP address this is our port that way we

882
00:43:59,550 --> 00:44:03,690
can use variables like that even though

883
00:44:01,530 --> 00:44:06,020
it's in the context or running on that

884
00:44:03,690 --> 00:44:06,020
other machine

885
00:44:09,900 --> 00:44:16,880
you've been quick crontab runs a reverse

886
00:44:13,440 --> 00:44:16,880
shell every five minutes

887
00:44:17,850 --> 00:44:23,339
I think there are other user cron tabs

888
00:44:20,190 --> 00:44:26,340
right I think it's like bar spool their

889
00:44:23,340 --> 00:44:28,170
username this one you might need a heavy

890
00:44:26,340 --> 00:44:31,520
gun you might already need to be root -

891
00:44:28,170 --> 00:44:31,520
right - Petra crontab

892
00:44:33,740 --> 00:44:39,589
or we could do other things like a

893
00:44:35,810 --> 00:44:42,290
divine shell maybe that's something that

894
00:44:39,589 --> 00:44:44,900
might be worth while there are plenty of

895
00:44:42,290 --> 00:44:46,970
other means of persistence these are

896
00:44:44,900 --> 00:44:49,010
some use cases and these are some means

897
00:44:46,970 --> 00:44:50,270
to just whip that out so you don't have

898
00:44:49,010 --> 00:44:52,990
to deal with remembering it you've

899
00:44:50,270 --> 00:44:52,990
already got it written

900
00:44:57,910 --> 00:45:00,839
what do you guys think

901
00:45:02,720 --> 00:45:05,959
anything for me

902
00:45:07,290 --> 00:45:09,350
you

903
00:45:09,460 --> 00:45:13,380
you last

904
00:45:11,099 --> 00:45:15,599
spoke here at besides Delaware so thanks

905
00:45:13,380 --> 00:45:17,519
for letting me come hang out again the

906
00:45:15,599 --> 00:45:20,339
talk was the 10 steps to build and lead

907
00:45:17,519 --> 00:45:22,618
cybersecurity or CTF team and I'd like

908
00:45:20,339 --> 00:45:25,890
to play CTF and that was a super or like

909
00:45:22,619 --> 00:45:29,249
high level soft talk like inspire people

910
00:45:25,890 --> 00:45:30,629
encourage people do good things but I

911
00:45:29,249 --> 00:45:33,078
wanted like let's do a technical talk

912
00:45:30,630 --> 00:45:36,779
let's do stuff that's on the keyboard oh

913
00:45:33,079 --> 00:45:40,220
my slides are literally bash code I hope

914
00:45:36,779 --> 00:45:40,220
that was okay I hope that was so cool

915
00:45:40,519 --> 00:45:47,819
I'm like github github forward slash

916
00:45:44,430 --> 00:45:49,558
Sean Hammond there is a poor-man's pen

917
00:45:47,819 --> 00:45:52,549
test repository where you can grab all

918
00:45:49,559 --> 00:45:55,529
this code I still need to add to read me

919
00:45:52,549 --> 00:45:58,019
but all that code is in there if you

920
00:45:55,529 --> 00:46:00,710
want it for some reason and the slides

921
00:45:58,019 --> 00:46:00,709
are in there as well

922
00:46:05,400 --> 00:46:07,460
you

923
00:46:07,850 --> 00:46:10,630
Thanks

924
00:46:11,520 --> 00:46:17,350
yeah

925
00:46:13,930 --> 00:46:18,819
yeah I hope that again it's kludgy and

926
00:46:17,350 --> 00:46:20,380
weird because you're using xte

927
00:46:18,820 --> 00:46:22,660
which sounds like a baby thing but

928
00:46:20,380 --> 00:46:24,730
because you have that fine

929
00:46:22,660 --> 00:46:26,529
comb as to what you want to run and

930
00:46:24,730 --> 00:46:29,400
you're so automating it with just I'm

931
00:46:26,530 --> 00:46:32,940
literally typing the command but not

932
00:46:29,400 --> 00:46:32,940
maybe that helps

933
00:46:38,350 --> 00:46:40,410
you

934
00:46:42,400 --> 00:46:44,460
you

935
00:46:47,820 --> 00:46:49,880
you

936
00:46:50,270 --> 00:46:57,830
pythons simple HTTP server is only HTTP

937
00:46:55,060 --> 00:47:00,770
you need to deal with some open ssl

938
00:46:57,830 --> 00:47:04,240
command and all that nonsense to quickly

939
00:47:00,770 --> 00:47:06,830
spin up a HTTP server there's

940
00:47:04,240 --> 00:47:08,868
documentation and guides to do it off

941
00:47:06,830 --> 00:47:13,490
the top of my head I hate open SSL

942
00:47:08,869 --> 00:47:16,150
syntax no the risk there is good

943
00:47:13,490 --> 00:47:16,149
question thank you

944
00:47:19,530 --> 00:47:23,060
any other thoughts I'm yours yeah

945
00:47:25,960 --> 00:47:28,020
you

946
00:47:34,470 --> 00:47:41,459
right and that is a limitation right

947
00:47:39,240 --> 00:47:45,379
because we have the communication of our

948
00:47:41,460 --> 00:47:48,270
machine to the target we don't have

949
00:47:45,380 --> 00:47:52,109
communication from the target back to us

950
00:47:48,270 --> 00:47:54,700
we can't see from our shell the command

951
00:47:52,109 --> 00:47:56,259
output on that side

952
00:47:54,700 --> 00:48:00,899
without visibly looking at it with

953
00:47:56,260 --> 00:48:00,900
eyeballs so that's a programmatic hiccup

954
00:48:01,070 --> 00:48:05,450
again disclaimer your mileage may vary

955
00:48:03,110 --> 00:48:08,680
but maybe a technique just spit stuff

956
00:48:05,450 --> 00:48:08,680
there you got a test

957
00:48:13,190 --> 00:48:17,019
even thought you guys stay awake we do

958
00:48:16,640 --> 00:48:20,910
we do

959
00:48:17,019 --> 00:48:27,209
job alright sweet thank you

960
00:48:20,910 --> 00:48:32,129
[Applause]

961
00:48:27,209 --> 00:48:32,129
we were right on time I think

