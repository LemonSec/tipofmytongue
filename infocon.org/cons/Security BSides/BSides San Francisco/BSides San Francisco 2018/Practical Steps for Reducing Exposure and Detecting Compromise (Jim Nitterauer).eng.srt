1
00:00:03,620 --> 00:00:06,740
[Music]

2
00:00:19,670 --> 00:00:28,790
great<font color="#E5E5E5"> conference so this is my</font><font color="#CCCCCC"> promise</font>

3
00:00:22,820 --> 00:00:30,560
for<font color="#E5E5E5"> today so first things we have to</font>

4
00:00:28,790 --> 00:00:33,080
<font color="#E5E5E5">have</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> two definitions so we're all on</font>

5
00:00:30,560 --> 00:00:35,690
<font color="#CCCCCC">the same page</font><font color="#E5E5E5"> what is a recursive DNS</font>

6
00:00:33,080 --> 00:00:38,120
resolver<font color="#E5E5E5"> recursive resolver is one that</font>

7
00:00:35,690 --> 00:00:39,920
answers questions for clients<font color="#E5E5E5"> it's not</font>

8
00:00:38,120 --> 00:00:41,540
authoritative it queries<font color="#CCCCCC"> route and</font>

9
00:00:39,920 --> 00:00:44,030
authoritative servers<font color="#E5E5E5"> and caches the</font>

10
00:00:41,540 --> 00:00:46,879
<font color="#E5E5E5">answers for the clients</font><font color="#CCCCCC"> an authoritative</font>

11
00:00:44,030 --> 00:00:49,129
server is one that hosts zone records

12
00:00:46,879 --> 00:00:51,349
and provides answers<font color="#E5E5E5"> for recursive</font>

13
00:00:49,129 --> 00:00:53,210
<font color="#E5E5E5">resolvers</font><font color="#CCCCCC"> and authoritative server</font>

14
00:00:51,350 --> 00:00:55,400
<font color="#E5E5E5">usually has to be registered</font><font color="#CCCCCC"> with a</font>

15
00:00:53,210 --> 00:00:58,390
domain registrar to let the world know

16
00:00:55,400 --> 00:01:01,909
that that domain<font color="#CCCCCC"> at that server or that</font>

17
00:00:58,390 --> 00:01:05,030
authoritative server is able<font color="#CCCCCC"> to serve up</font>

18
00:01:01,909 --> 00:01:06,470
records for a particular<font color="#CCCCCC"> TLD and there's</font>

19
00:01:05,030 --> 00:01:08,320
a nice little<font color="#E5E5E5"> article from umbrella</font>

20
00:01:06,470 --> 00:01:11,170
there if you want to learn more about

21
00:01:08,320 --> 00:01:15,500
recursive and authoritative<font color="#E5E5E5"> nameservers</font>

22
00:01:11,170 --> 00:01:17,030
so if we want<font color="#CCCCCC"> to look</font><font color="#E5E5E5"> at the</font><font color="#CCCCCC"> detail</font>

23
00:01:15,500 --> 00:01:18,710
<font color="#CCCCCC">overview</font><font color="#E5E5E5"> of how DNS works</font>

24
00:01:17,030 --> 00:01:20,900
<font color="#CCCCCC">Sly's getting cut off a little bit</font><font color="#E5E5E5"> there</font>

25
00:01:18,710 --> 00:01:22,789
sorry<font color="#CCCCCC"> about that there's only eight</font>

26
00:01:20,900 --> 00:01:24,770
different steps in a DNS<font color="#E5E5E5"> query so</font>

27
00:01:22,790 --> 00:01:27,140
there's probably<font color="#E5E5E5"> no room for</font><font color="#CCCCCC"> anything to</font>

28
00:01:24,770 --> 00:01:31,940
ever go wrong right<font color="#E5E5E5"> works every time all</font>

29
00:01:27,140 --> 00:01:34,010
the time right well not really<font color="#E5E5E5"> so I'm</font>

30
00:01:31,940 --> 00:01:35,300
gonna<font color="#E5E5E5"> talk</font><font color="#CCCCCC"> about some exploits and</font>

31
00:01:34,010 --> 00:01:37,640
vulnerabilities in DNS I'm gonna

32
00:01:35,300 --> 00:01:39,830
categorize them<font color="#E5E5E5"> based on the CIA triad</font>

33
00:01:37,640 --> 00:01:41,870
<font color="#CCCCCC">this is something that most security</font>

34
00:01:39,830 --> 00:01:43,340
practitioners<font color="#CCCCCC"> recognize</font><font color="#E5E5E5"> and I'm doing</font>

35
00:01:41,870 --> 00:01:45,470
this<font color="#E5E5E5"> just so</font><font color="#CCCCCC"> that you</font><font color="#E5E5E5"> can go back to</font>

36
00:01:43,340 --> 00:01:47,630
<font color="#E5E5E5">your company</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> say hey these kinds of</font>

37
00:01:45,470 --> 00:01:50,570
things fit into our<font color="#E5E5E5"> risk model for this</font>

38
00:01:47,630 --> 00:01:52,460
and here is why<font color="#CCCCCC"> these</font><font color="#E5E5E5"> exploits could be</font>

39
00:01:50,570 --> 00:01:54,800
<font color="#E5E5E5">categorized in many categories I'm just</font>

40
00:01:52,460 --> 00:01:57,080
doing it<font color="#CCCCCC"> the way I did just to</font><font color="#E5E5E5"> make it</font><font color="#CCCCCC"> a</font>

41
00:01:54,800 --> 00:01:58,940
<font color="#E5E5E5">little bit simpler but first of the</font>

42
00:01:57,080 --> 00:02:01,220
<font color="#E5E5E5">exploits we're gonna look at is actually</font>

43
00:01:58,940 --> 00:02:03,950
<font color="#E5E5E5">exploits against confidentiality these</font>

44
00:02:01,220 --> 00:02:06,260
are the kinds of exploits where DNS can

45
00:02:03,950 --> 00:02:08,810
be used to<font color="#E5E5E5"> basically exfiltrate data</font>

46
00:02:06,260 --> 00:02:11,090
from<font color="#E5E5E5"> your</font><font color="#CCCCCC"> network</font><font color="#E5E5E5"> the first of the</font>

47
00:02:08,810 --> 00:02:12,769
things that we see and we<font color="#CCCCCC"> actually see</font>

48
00:02:11,090 --> 00:02:15,650
this in<font color="#E5E5E5"> our DNS all the time data</font>

49
00:02:12,769 --> 00:02:18,799
exfiltration via<font color="#E5E5E5"> DNS this is an example</font>

50
00:02:15,650 --> 00:02:21,190
<font color="#CCCCCC">just from</font><font color="#E5E5E5"> a log graph but basically what</font>

51
00:02:18,799 --> 00:02:24,980
<font color="#E5E5E5">you see here is the domain at the bottom</font>

52
00:02:21,190 --> 00:02:27,680
that's<font color="#E5E5E5"> right here by my</font><font color="#CCCCCC"> this domain here</font>

53
00:02:24,980 --> 00:02:31,100
is the domain that's actually legitimate

54
00:02:27,680 --> 00:02:32,750
this part here<font color="#E5E5E5"> is the data that's being</font>

55
00:02:31,100 --> 00:02:35,660
exfiltrated

56
00:02:32,750 --> 00:02:37,760
this section<font color="#CCCCCC"> so if you saw in DNS you</font>

57
00:02:35,660 --> 00:02:40,940
might see a ton of lookups for these

58
00:02:37,760 --> 00:02:43,850
this domain with a subdomain that varies

59
00:02:40,940 --> 00:02:45,230
across all of the lookups<font color="#CCCCCC"> and that's</font>

60
00:02:43,850 --> 00:02:45,799
what you're<font color="#E5E5E5"> seeing in the histogram</font>

61
00:02:45,230 --> 00:02:48,049
there

62
00:02:45,800 --> 00:02:50,390
it's<font color="#E5E5E5"> basically what happens is the</font>

63
00:02:48,050 --> 00:02:53,750
malware<font color="#E5E5E5"> will take strip data off of</font><font color="#CCCCCC"> your</font>

64
00:02:50,390 --> 00:02:55,369
drive<font color="#CCCCCC"> encode it in some way break up</font>

65
00:02:53,750 --> 00:02:59,000
<font color="#CCCCCC">that encoded</font><font color="#E5E5E5"> data</font><font color="#CCCCCC"> and send it</font><font color="#E5E5E5"> through</font>

66
00:02:55,370 --> 00:03:00,290
DNS to a<font color="#E5E5E5"> DNS resolver these resolvers</font>

67
00:02:59,000 --> 00:03:01,760
are legitimate resolvers they have

68
00:03:00,290 --> 00:03:03,739
legitimate name servers and<font color="#E5E5E5"> the answer</font>

69
00:03:01,760 --> 00:03:05,570
with legitimate answers<font color="#CCCCCC"> the</font><font color="#E5E5E5"> only thing</font>

70
00:03:03,740 --> 00:03:07,459
they do at the other end is they re a

71
00:03:05,570 --> 00:03:11,810
granade the data<font color="#E5E5E5"> that they've taken</font><font color="#CCCCCC"> from</font>

72
00:03:07,459 --> 00:03:13,670
your network<font color="#E5E5E5"> the second thing we see in</font>

73
00:03:11,810 --> 00:03:17,630
<font color="#E5E5E5">DNS exploits</font><font color="#CCCCCC"> our botnet command and</font>

74
00:03:13,670 --> 00:03:21,190
control<font color="#E5E5E5"> this is an</font><font color="#CCCCCC"> example of how botnet</font>

75
00:03:17,630 --> 00:03:24,170
command control information<font color="#E5E5E5"> can be</font>

76
00:03:21,190 --> 00:03:25,880
encoded inside a<font color="#CCCCCC"> DNS</font><font color="#E5E5E5"> text record but it</font>

77
00:03:24,170 --> 00:03:27,829
could be done<font color="#E5E5E5"> in any kind of record this</font>

78
00:03:25,880 --> 00:03:28,310
<font color="#E5E5E5">is really a DNS tunnel it</font><font color="#CCCCCC"> is a two-way</font>

79
00:03:27,830 --> 00:03:30,440
street

80
00:03:28,310 --> 00:03:33,110
<font color="#E5E5E5">so what we see</font><font color="#CCCCCC"> here is a compromised</font>

81
00:03:30,440 --> 00:03:36,739
machine or<font color="#CCCCCC"> device would send out DNS</font>

82
00:03:33,110 --> 00:03:38,060
requests to a DNS<font color="#E5E5E5"> resolver botnet</font>

83
00:03:36,739 --> 00:03:40,610
command control the botnet command

84
00:03:38,060 --> 00:03:42,980
control would take that<font color="#E5E5E5"> command</font><font color="#CCCCCC"> and send</font>

85
00:03:40,610 --> 00:03:44,840
back data to the requester<font color="#E5E5E5"> but that</font>

86
00:03:42,980 --> 00:03:47,720
actual data would be<font color="#E5E5E5"> the command that's</font>

87
00:03:44,840 --> 00:03:50,180
<font color="#E5E5E5">supposed to be</font><font color="#CCCCCC"> executed</font><font color="#E5E5E5"> on the</font><font color="#CCCCCC"> infected</font>

88
00:03:47,720 --> 00:03:53,209
or compromised machine<font color="#E5E5E5"> these are often</font>

89
00:03:50,180 --> 00:03:56,120
<font color="#E5E5E5">very difficult to detect</font><font color="#CCCCCC"> because you</font>

90
00:03:53,209 --> 00:03:57,890
can't<font color="#CCCCCC"> always see</font><font color="#E5E5E5"> the domain names that</font>

91
00:03:56,120 --> 00:03:59,720
they're using<font color="#E5E5E5"> to do this button and</font>

92
00:03:57,890 --> 00:04:01,279
command and control<font color="#E5E5E5"> and</font><font color="#CCCCCC"> the next thing</font>

93
00:03:59,720 --> 00:04:02,329
we see<font color="#E5E5E5"> a lot of times with that or</font>

94
00:04:01,280 --> 00:04:04,640
<font color="#E5E5E5">something called domain generation</font>

95
00:04:02,329 --> 00:04:05,720
<font color="#E5E5E5">algorithms and what this is this is</font>

96
00:04:04,640 --> 00:04:10,369
something<font color="#E5E5E5"> that</font><font color="#CCCCCC"> a lot of malware has</font>

97
00:04:05,720 --> 00:04:15,290
<font color="#E5E5E5">built in to basically obfuscate DNS it'd</font>

98
00:04:10,370 --> 00:04:18,530
be really<font color="#CCCCCC"> easy</font><font color="#E5E5E5"> to find rogue DNS in your</font>

99
00:04:15,290 --> 00:04:20,120
logs and<font color="#E5E5E5"> in your</font><font color="#CCCCCC"> dns lookups</font><font color="#E5E5E5"> if the</font>

100
00:04:18,529 --> 00:04:22,039
malware we're only<font color="#E5E5E5"> doing those kinds of</font>

101
00:04:20,120 --> 00:04:24,169
<font color="#E5E5E5">dns lookups so what the malware does is</font>

102
00:04:22,040 --> 00:04:26,960
it creates<font color="#E5E5E5"> these random domain</font>

103
00:04:24,169 --> 00:04:29,659
generations<font color="#E5E5E5"> and</font><font color="#CCCCCC"> since</font><font color="#E5E5E5"> DNS lookups for</font>

104
00:04:26,960 --> 00:04:31,190
these out to your network<font color="#E5E5E5"> problem is</font>

105
00:04:29,660 --> 00:04:34,010
they never resolved they come<font color="#E5E5E5"> back as an</font>

106
00:04:31,190 --> 00:04:36,550
X domain<font color="#E5E5E5"> but you see them as normal DNS</font>

107
00:04:34,010 --> 00:04:38,479
lookups<font color="#E5E5E5"> going through your network</font>

108
00:04:36,550 --> 00:04:40,789
<font color="#E5E5E5">problem is what they do is are you doing</font>

109
00:04:38,479 --> 00:04:42,500
<font color="#CCCCCC">this to obfuscate the real botnet</font>

110
00:04:40,789 --> 00:04:45,070
command and control domain so that<font color="#CCCCCC"> you</font>

111
00:04:42,500 --> 00:04:48,280
don't see them<font color="#CCCCCC"> so easily</font><font color="#E5E5E5"> in your DNS</font>

112
00:04:45,070 --> 00:04:50,560
<font color="#E5E5E5">look ups this is an example malware</font>

113
00:04:48,280 --> 00:04:52,229
<font color="#CCCCCC">writers don't always do</font><font color="#E5E5E5"> things correctly</font>

114
00:04:50,560 --> 00:04:54,970
<font color="#E5E5E5">so you can use this to your advantage</font>

115
00:04:52,230 --> 00:04:58,120
<font color="#CCCCCC">this</font><font color="#E5E5E5"> is an example of some of</font><font color="#CCCCCC"> these</font><font color="#E5E5E5"> DGA</font>

116
00:04:54,970 --> 00:05:01,180
domains<font color="#CCCCCC"> that</font><font color="#E5E5E5"> they forgot</font><font color="#CCCCCC"> to make fit the</font>

117
00:04:58,120 --> 00:05:02,950
<font color="#CCCCCC">employed qualified domain name format</font>

118
00:05:01,180 --> 00:05:05,680
and they stick<font color="#E5E5E5"> out like a sore thumb</font><font color="#CCCCCC"> in</font>

119
00:05:02,950 --> 00:05:09,940
<font color="#E5E5E5">DNS who are able to see these in our DNS</font>

120
00:05:05,680 --> 00:05:12,250
<font color="#E5E5E5">logs and mitigate them accordingly the</font>

121
00:05:09,940 --> 00:05:13,750
last exploit that<font color="#CCCCCC"> we see against</font>

122
00:05:12,250 --> 00:05:15,670
confidentiality this is something<font color="#E5E5E5"> I</font>

123
00:05:13,750 --> 00:05:17,020
talked about<font color="#E5E5E5"> at Def Con</font><font color="#CCCCCC"> most people</font>

124
00:05:15,670 --> 00:05:20,140
aren't<font color="#CCCCCC"> aware</font><font color="#E5E5E5"> that this information is</font>

125
00:05:17,020 --> 00:05:24,729
<font color="#E5E5E5">out there</font><font color="#CCCCCC"> but the e DNS</font><font color="#E5E5E5"> zero option</font>

126
00:05:20,140 --> 00:05:28,419
codes are ways in which vendors can use

127
00:05:24,730 --> 00:05:31,630
<font color="#CCCCCC">DNS extended options to send</font><font color="#E5E5E5"> data back</font>

128
00:05:28,420 --> 00:05:34,030
<font color="#E5E5E5">and forth through DNS that doesn't mean</font>

129
00:05:31,630 --> 00:05:36,760
<font color="#E5E5E5">that they're all legitimate queries</font>

130
00:05:34,030 --> 00:05:41,349
going out the<font color="#CCCCCC"> evildoers can use these</font>

131
00:05:36,760 --> 00:05:43,840
options<font color="#CCCCCC"> as well</font><font color="#E5E5E5"> there's 65535 options</font>

132
00:05:41,350 --> 00:05:47,230
that you can<font color="#E5E5E5"> use most of them are</font>

133
00:05:43,840 --> 00:05:49,750
<font color="#CCCCCC">unassigned some are assigned for example</font>

134
00:05:47,230 --> 00:05:51,940
if you use<font color="#E5E5E5"> Open DNS for the Umbrella</font>

135
00:05:49,750 --> 00:05:53,440
product<font color="#E5E5E5"> you would see this in your DNS</font>

136
00:05:51,940 --> 00:05:57,850
lookups going from a machine<font color="#E5E5E5"> that has</font>

137
00:05:53,440 --> 00:05:59,530
<font color="#E5E5E5">this client installed on it and this can</font>

138
00:05:57,850 --> 00:06:02,710
also be<font color="#E5E5E5"> used</font><font color="#CCCCCC"> to exfiltrate data from</font>

139
00:05:59,530 --> 00:06:04,690
your<font color="#CCCCCC"> network and</font><font color="#E5E5E5"> basically eliminate or</font>

140
00:06:02,710 --> 00:06:07,140
put out<font color="#E5E5E5"> data that you may or</font><font color="#CCCCCC"> may not</font>

141
00:06:04,690 --> 00:06:10,450
expect to be<font color="#CCCCCC"> leaving your network</font>

142
00:06:07,140 --> 00:06:11,830
<font color="#CCCCCC">alright get</font><font color="#E5E5E5"> this right here there we go</font>

143
00:06:10,450 --> 00:06:14,950
<font color="#CCCCCC">alright so now we're a look at some</font>

144
00:06:11,830 --> 00:06:17,289
exploits against<font color="#E5E5E5"> DNS integrity one of</font>

145
00:06:14,950 --> 00:06:20,020
the most<font color="#CCCCCC"> well known ones</font><font color="#E5E5E5"> my screens not</font>

146
00:06:17,290 --> 00:06:22,630
showing the whole screen there is<font color="#E5E5E5"> DNS</font>

147
00:06:20,020 --> 00:06:25,450
cache poisoning<font color="#E5E5E5"> this was first talked</font>

148
00:06:22,630 --> 00:06:28,390
<font color="#E5E5E5">about</font><font color="#CCCCCC"> in Def Con of blackhat talked by</font>

149
00:06:25,450 --> 00:06:30,190
Dan Kaminsky back in 2008 the talk was

150
00:06:28,390 --> 00:06:33,099
entitled<font color="#E5E5E5"> it's the end of the cache as we</font>

151
00:06:30,190 --> 00:06:34,570
know it<font color="#CCCCCC"> since what this exploit</font>

152
00:06:33,100 --> 00:06:38,470
basically you could flood a DNS server

153
00:06:34,570 --> 00:06:39,880
<font color="#CCCCCC">with responses quicker than the DNS</font>

154
00:06:38,470 --> 00:06:42,130
servers that were supposed to respond to

155
00:06:39,880 --> 00:06:45,430
<font color="#E5E5E5">that DNS and flood the cache with</font>

156
00:06:42,130 --> 00:06:47,830
incorrect information<font color="#E5E5E5"> this is no longer</font>

157
00:06:45,430 --> 00:06:49,750
<font color="#E5E5E5">much of an exploit because most DNS</font>

158
00:06:47,830 --> 00:06:52,270
servers have been<font color="#E5E5E5"> fixed so</font><font color="#CCCCCC"> that these</font>

159
00:06:49,750 --> 00:06:53,530
kinds<font color="#CCCCCC"> of attacks are less</font><font color="#E5E5E5"> likely to</font>

160
00:06:52,270 --> 00:06:58,000
happen they're much harder<font color="#CCCCCC"> to do</font><font color="#E5E5E5"> but</font>

161
00:06:53,530 --> 00:06:58,770
they still can and do happen<font color="#CCCCCC"> a variation</font>

162
00:06:58,000 --> 00:07:01,440
on this

163
00:06:58,770 --> 00:07:02,698
<font color="#CCCCCC">TAC actually there's an article</font><font color="#E5E5E5"> here</font><font color="#CCCCCC"> if</font>

164
00:07:01,440 --> 00:07:04,020
you want to<font color="#E5E5E5"> look at this</font><font color="#CCCCCC"> that's in the</font>

165
00:07:02,699 --> 00:07:06,660
slide deck and<font color="#E5E5E5"> I'll put this</font><font color="#CCCCCC"> up on</font><font color="#E5E5E5"> the</font>

166
00:07:04,020 --> 00:07:09,210
<font color="#E5E5E5">schedule when I'm done</font><font color="#CCCCCC"> this article here</font>

167
00:07:06,660 --> 00:07:12,050
talks a<font color="#E5E5E5"> great deal about these</font><font color="#CCCCCC"> DNS</font>

168
00:07:09,210 --> 00:07:13,948
vulnerabilities with<font color="#E5E5E5"> the cache poisoning</font>

169
00:07:12,050 --> 00:07:16,080
<font color="#E5E5E5">one of the things we've been seeing a</font>

170
00:07:13,949 --> 00:07:20,400
<font color="#E5E5E5">lot lately</font><font color="#CCCCCC"> are</font><font color="#E5E5E5"> these DNS rebinding</font>

171
00:07:16,080 --> 00:07:21,840
attacks<font color="#E5E5E5"> they first started out as people</font>

172
00:07:20,400 --> 00:07:23,729
visiting malicious websites through

173
00:07:21,840 --> 00:07:26,219
phishing emails whatever<font color="#CCCCCC"> drive-by</font>

174
00:07:23,729 --> 00:07:27,449
downloads through adware<font color="#E5E5E5"> they would get</font>

175
00:07:26,220 --> 00:07:29,340
directed<font color="#CCCCCC"> to a website</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> would</font>

176
00:07:27,449 --> 00:07:32,759
download<font color="#E5E5E5"> JavaScript that JavaScript</font>

177
00:07:29,340 --> 00:07:34,229
would then go and attack your local

178
00:07:32,759 --> 00:07:36,150
router they did this<font color="#E5E5E5"> on home routers at</font>

179
00:07:34,229 --> 00:07:37,859
first<font color="#E5E5E5"> well when people don't set their</font>

180
00:07:36,150 --> 00:07:39,719
usernames and passwords on these<font color="#CCCCCC"> routers</font>

181
00:07:37,860 --> 00:07:41,759
the routers then have their DNS change

182
00:07:39,720 --> 00:07:44,580
so that<font color="#E5E5E5"> you know everything going out of</font>

183
00:07:41,759 --> 00:07:46,409
that<font color="#E5E5E5"> network uses the malicious actors</font>

184
00:07:44,580 --> 00:07:48,359
DNS server<font color="#E5E5E5"> instead</font><font color="#CCCCCC"> of the one</font><font color="#E5E5E5"> that they</font>

185
00:07:46,409 --> 00:07:50,969
would<font color="#E5E5E5"> think they should be using so</font>

186
00:07:48,360 --> 00:07:53,130
these of these attacks have gotten more

187
00:07:50,970 --> 00:07:55,229
sophisticated<font color="#E5E5E5"> now and we can actually</font>

188
00:07:53,130 --> 00:07:57,300
see attacks happening where there's DNS

189
00:07:55,229 --> 00:07:59,460
rebinding combined with cross-site

190
00:07:57,300 --> 00:08:02,940
request forgeries<font color="#E5E5E5"> that allow an attacker</font>

191
00:07:59,460 --> 00:08:05,698
to basically through<font color="#E5E5E5"> DNS send one DNS</font>

192
00:08:02,940 --> 00:08:07,590
request back to<font color="#CCCCCC"> the client</font><font color="#E5E5E5"> change the</font>

193
00:08:05,699 --> 00:08:11,599
second<font color="#E5E5E5"> request send it back quickly to</font>

194
00:08:07,590 --> 00:08:14,008
the client and are<font color="#CCCCCC"> able to tunnel there</font>

195
00:08:11,599 --> 00:08:15,690
<font color="#E5E5E5">have a reverse shell</font><font color="#CCCCCC"> basically through</font>

196
00:08:14,009 --> 00:08:17,219
the<font color="#CCCCCC"> client browser</font><font color="#E5E5E5"> that's infected</font>

197
00:08:15,690 --> 00:08:19,199
through<font color="#E5E5E5"> these rebinding attacks so it's</font>

198
00:08:17,219 --> 00:08:22,919
really really something<font color="#CCCCCC"> you have</font><font color="#E5E5E5"> to look</font>

199
00:08:19,199 --> 00:08:25,050
out<font color="#CCCCCC"> for on your networks another exploit</font>

200
00:08:22,919 --> 00:08:26,219
for<font color="#E5E5E5"> DNS is man the middle attacks you</font>

201
00:08:25,050 --> 00:08:28,319
hear about these right this is why you

202
00:08:26,219 --> 00:08:30,599
don't browse Wi-Fi<font color="#CCCCCC"> in the coffee shops</font>

203
00:08:28,319 --> 00:08:32,789
but this is<font color="#E5E5E5"> possible on wired networks</font>

204
00:08:30,599 --> 00:08:35,159
as well<font color="#CCCCCC"> any compromised machine on a</font>

205
00:08:32,789 --> 00:08:37,979
wired network could<font color="#E5E5E5"> initiate an ARP</font>

206
00:08:35,159 --> 00:08:40,890
poisoning<font color="#E5E5E5"> cat attack and redirect either</font>

207
00:08:37,979 --> 00:08:42,899
your client machine to a different

208
00:08:40,890 --> 00:08:45,420
router<font color="#CCCCCC"> that's one way of doing</font><font color="#E5E5E5"> it but</font>

209
00:08:42,899 --> 00:08:48,450
what if the<font color="#CCCCCC"> attack were something like</font>

210
00:08:45,420 --> 00:08:51,089
<font color="#E5E5E5">this it networks compromised that the</font>

211
00:08:48,450 --> 00:08:53,190
ARP figures out which the MAC<font color="#CCCCCC"> address</font>

212
00:08:51,089 --> 00:08:55,770
goes<font color="#CCCCCC"> to your</font><font color="#E5E5E5"> DNS servers on your network</font>

213
00:08:53,190 --> 00:08:58,350
they are poison your machines on the

214
00:08:55,770 --> 00:09:00,569
network<font color="#CCCCCC"> to send DNS requests</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> a rogue</font>

215
00:08:58,350 --> 00:09:02,940
machine on the network<font color="#CCCCCC"> or something else</font>

216
00:09:00,570 --> 00:09:04,950
<font color="#CCCCCC">machine off the network and now they've</font>

217
00:09:02,940 --> 00:09:09,029
<font color="#E5E5E5">taken your DNS and redirected it in a</font>

218
00:09:04,950 --> 00:09:11,279
way<font color="#CCCCCC"> that you may not</font><font color="#E5E5E5"> be able to catch so</font>

219
00:09:09,029 --> 00:09:12,749
these things<font color="#E5E5E5"> can</font><font color="#CCCCCC"> be very very dangerous</font>

220
00:09:11,279 --> 00:09:14,639
if you're<font color="#E5E5E5"> not sure</font>

221
00:09:12,749 --> 00:09:17,699
if you don't have<font color="#CCCCCC"> things mitigations in</font>

222
00:09:14,639 --> 00:09:19,649
place to stop<font color="#CCCCCC"> them this is an</font>

223
00:09:17,699 --> 00:09:22,439
interesting<font color="#E5E5E5"> one</font><font color="#CCCCCC"> that came up</font><font color="#E5E5E5"> last year I</font>

224
00:09:19,649 --> 00:09:25,110
think in July<font color="#CCCCCC"> Matthew Bryant posted an</font>

225
00:09:22,439 --> 00:09:27,748
<font color="#CCCCCC">article about taking</font><font color="#E5E5E5"> over a name server</font>

226
00:09:25,110 --> 00:09:29,879
TLD<font color="#E5E5E5"> this is a kind of an interesting</font>

227
00:09:27,749 --> 00:09:31,429
<font color="#E5E5E5">attack</font><font color="#CCCCCC"> actually the gist the</font><font color="#E5E5E5"> post</font>

228
00:09:29,879 --> 00:09:33,929
centered around the fact that the<font color="#CCCCCC"> io</font>

229
00:09:31,429 --> 00:09:36,179
top-level domain<font color="#E5E5E5"> had authoritative</font>

230
00:09:33,929 --> 00:09:37,439
<font color="#E5E5E5">nameservers those name</font><font color="#CCCCCC"> servers in the</font>

231
00:09:36,179 --> 00:09:40,170
delegation chain one of the domains

232
00:09:37,439 --> 00:09:42,420
<font color="#E5E5E5">expired so he could go register that</font>

233
00:09:40,170 --> 00:09:45,029
domain<font color="#E5E5E5"> name you see where I'm going</font><font color="#CCCCCC"> with</font>

234
00:09:42,420 --> 00:09:46,860
this so<font color="#E5E5E5"> now he owned the domain for the</font>

235
00:09:45,029 --> 00:09:50,189
<font color="#CCCCCC">top-level</font><font color="#E5E5E5"> name server</font><font color="#CCCCCC"> for the top-level</font>

236
00:09:46,860 --> 00:09:53,459
domain<font color="#CCCCCC"> for</font><font color="#E5E5E5"> IO so every</font><font color="#CCCCCC"> domain that was</font>

237
00:09:50,189 --> 00:09:55,410
whatever<font color="#CCCCCC"> dot IO was sending DNS lookups</font>

238
00:09:53,459 --> 00:09:57,268
to<font color="#E5E5E5"> his name servers to resolve who the</font>

239
00:09:55,410 --> 00:09:59,999
name servers were for all of the rest<font color="#CCCCCC"> of</font>

240
00:09:57,269 --> 00:10:03,749
the dot IO name servers<font color="#E5E5E5"> this could be</font>

241
00:09:59,999 --> 00:10:05,910
very<font color="#E5E5E5"> very bad</font><font color="#CCCCCC"> all he had to do was send</font>

242
00:10:03,749 --> 00:10:08,489
back name servers one his<font color="#E5E5E5"> name server</font>

243
00:10:05,910 --> 00:10:11,189
and<font color="#E5E5E5"> then set a really long TTL and over</font>

244
00:10:08,489 --> 00:10:12,869
time<font color="#E5E5E5"> everybody in the IOT LD would be</font>

245
00:10:11,189 --> 00:10:15,118
using his<font color="#E5E5E5"> name servers to do their</font>

246
00:10:12,869 --> 00:10:17,189
lookups<font color="#CCCCCC"> and ignoring</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> rest in the</font>

247
00:10:15,119 --> 00:10:20,519
tree<font color="#E5E5E5"> so</font><font color="#CCCCCC"> he would effectively have taken</font>

248
00:10:17,189 --> 00:10:22,889
<font color="#E5E5E5">over that</font><font color="#CCCCCC"> whole IOT LD</font><font color="#E5E5E5"> he didn't do it</font>

249
00:10:20,519 --> 00:10:24,389
<font color="#CCCCCC">because</font><font color="#E5E5E5"> he was not out to do that but</font>

250
00:10:22,889 --> 00:10:25,860
<font color="#E5E5E5">that's what can happen</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> this can</font>

251
00:10:24,389 --> 00:10:28,470
happen<font color="#E5E5E5"> at any level in the domain tree</font>

252
00:10:25,860 --> 00:10:32,069
so for example if your domain

253
00:10:28,470 --> 00:10:33,720
<font color="#E5E5E5">mydomain.com has three different name</font>

254
00:10:32,069 --> 00:10:35,998
servers authoritative<font color="#E5E5E5"> name servers</font>

255
00:10:33,720 --> 00:10:38,429
through three different<font color="#CCCCCC"> domains and one</font>

256
00:10:35,999 --> 00:10:40,139
of those<font color="#E5E5E5"> domains expires and somebody</font>

257
00:10:38,429 --> 00:10:42,269
<font color="#E5E5E5">finds out it expires and</font><font color="#CCCCCC"> BRE registers</font>

258
00:10:40,139 --> 00:10:45,259
that<font color="#E5E5E5"> domain</font><font color="#CCCCCC"> and takes</font><font color="#E5E5E5"> over that name</font>

259
00:10:42,269 --> 00:10:47,699
server<font color="#E5E5E5"> how would you know this happened</font>

260
00:10:45,259 --> 00:10:50,309
who monitors their name server

261
00:10:47,699 --> 00:10:54,290
registrations for the name servers on

262
00:10:50,309 --> 00:10:57,410
their domains probably<font color="#E5E5E5"> nobody</font><font color="#CCCCCC"> all right</font>

263
00:10:54,290 --> 00:10:59,129
<font color="#E5E5E5">you might want to think about doing that</font>

264
00:10:57,410 --> 00:11:01,429
<font color="#E5E5E5">one of</font><font color="#CCCCCC"> the other</font><font color="#E5E5E5"> things</font><font color="#CCCCCC"> that we see</font>

265
00:10:59,129 --> 00:11:04,709
<font color="#CCCCCC">through DNS this is kind of</font><font color="#E5E5E5"> a secondary</font>

266
00:11:01,429 --> 00:11:07,829
<font color="#CCCCCC">add-on</font><font color="#E5E5E5"> DNS is probably the key factor in</font>

267
00:11:04,709 --> 00:11:09,899
ransomware attacks these domain

268
00:11:07,829 --> 00:11:11,399
generation algorithms are used<font color="#E5E5E5"> again I</font>

269
00:11:09,899 --> 00:11:13,049
said<font color="#E5E5E5"> obvious gate domains but they also</font>

270
00:11:11,399 --> 00:11:15,540
generate domains that<font color="#E5E5E5"> are legitimate</font>

271
00:11:13,049 --> 00:11:18,059
through a different<font color="#E5E5E5"> set of commands or</font><font color="#CCCCCC"> a</font>

272
00:11:15,540 --> 00:11:21,389
different set<font color="#CCCCCC"> of criteria within</font><font color="#E5E5E5"> the</font>

273
00:11:18,059 --> 00:11:24,389
malware this ransomware then makes<font color="#CCCCCC"> dns</font>

274
00:11:21,389 --> 00:11:26,309
called back and sends data via these DNS

275
00:11:24,389 --> 00:11:29,850
calls back to<font color="#E5E5E5"> the master</font>

276
00:11:26,309 --> 00:11:33,868
<font color="#E5E5E5">commanding control center so DNS can be</font>

277
00:11:29,850 --> 00:11:37,139
used in many many<font color="#CCCCCC"> cases</font><font color="#E5E5E5"> to mitigate or</font>

278
00:11:33,869 --> 00:11:39,689
stop<font color="#E5E5E5"> cryptolocker and other ransomware</font>

279
00:11:37,139 --> 00:11:41,999
type infections by simply<font color="#CCCCCC"> locking down a</font>

280
00:11:39,689 --> 00:11:44,009
computer or<font color="#E5E5E5"> device so</font><font color="#CCCCCC"> that it cannot</font>

281
00:11:41,999 --> 00:11:45,779
query DNS servers other than ones that

282
00:11:44,009 --> 00:11:47,850
are<font color="#E5E5E5"> approved</font><font color="#CCCCCC"> I want to go over that</font><font color="#E5E5E5"> here</font>

283
00:11:45,779 --> 00:11:51,480
<font color="#CCCCCC">a little</font><font color="#E5E5E5"> bit when we</font><font color="#CCCCCC"> talk about</font><font color="#E5E5E5"> ways</font><font color="#CCCCCC"> to</font>

284
00:11:47,850 --> 00:11:53,399
secure your DNS<font color="#CCCCCC"> the third type of DNS</font>

285
00:11:51,480 --> 00:11:56,069
attacks<font color="#E5E5E5"> we see are attacks against</font>

286
00:11:53,399 --> 00:11:57,509
availability so the first one we used to

287
00:11:56,069 --> 00:11:59,160
see a<font color="#CCCCCC"> lot of we don't see so much of</font>

288
00:11:57,509 --> 00:12:01,920
<font color="#E5E5E5">this</font><font color="#CCCCCC"> anymore where DNS flood attacks</font>

289
00:11:59,160 --> 00:12:04,379
<font color="#E5E5E5">where somebody would just simply roll up</font>

290
00:12:01,920 --> 00:12:06,479
<font color="#E5E5E5">a few VMs just start pounding a DNS</font>

291
00:12:04,379 --> 00:12:08,100
server with requests more requests<font color="#E5E5E5"> than</font>

292
00:12:06,480 --> 00:12:10,559
<font color="#E5E5E5">the DNS server could handle the DNS</font>

293
00:12:08,100 --> 00:12:14,040
server<font color="#E5E5E5"> would quit</font><font color="#CCCCCC"> and I so a few years</font>

294
00:12:10,559 --> 00:12:15,809
ago<font color="#E5E5E5"> in 2015 playboy announced that they</font>

295
00:12:14,040 --> 00:12:18,209
were changing<font color="#E5E5E5"> content of their</font><font color="#CCCCCC"> magazine</font>

296
00:12:15,809 --> 00:12:20,040
there were a few people<font color="#CCCCCC"> on the internet</font>

297
00:12:18,209 --> 00:12:22,378
<font color="#E5E5E5">that were I was guess you would say</font>

298
00:12:20,040 --> 00:12:24,238
cyber protesting and they initiated a

299
00:12:22,379 --> 00:12:26,189
flood attack against<font color="#CCCCCC"> Ultra DNS</font><font color="#E5E5E5"> and took</font>

300
00:12:24,239 --> 00:12:27,389
them<font color="#E5E5E5"> down for</font><font color="#CCCCCC"> four hours and I don't</font>

301
00:12:26,189 --> 00:12:30,389
know if you know who else<font color="#E5E5E5"> Ultra DNS</font>

302
00:12:27,389 --> 00:12:32,999
hosted at that time<font color="#E5E5E5"> Microsoft Outlook</font>

303
00:12:30,389 --> 00:12:34,470
<font color="#E5E5E5">com a couple other domains they were out</font>

304
00:12:32,999 --> 00:12:36,179
<font color="#E5E5E5">for about four</font><font color="#CCCCCC"> hours in afternoon on</font>

305
00:12:34,470 --> 00:12:39,990
that day<font color="#E5E5E5"> it wasn't</font><font color="#CCCCCC"> a pleasant</font><font color="#E5E5E5"> day for</font>

306
00:12:36,179 --> 00:12:42,449
<font color="#E5E5E5">anybody that was hosting any DNS attacks</font>

307
00:12:39,990 --> 00:12:45,629
we see more on DNS now our DNS

308
00:12:42,449 --> 00:12:47,969
amplification attacks<font color="#E5E5E5"> these are very</font>

309
00:12:45,629 --> 00:12:50,129
effective<font color="#E5E5E5"> because</font><font color="#CCCCCC"> you can take a</font><font color="#E5E5E5"> very</font>

310
00:12:47,970 --> 00:12:53,129
small DNS request most DNS requests<font color="#E5E5E5"> are</font>

311
00:12:50,129 --> 00:12:55,350
50 60<font color="#CCCCCC"> bytes</font><font color="#E5E5E5"> hit a resolver with a</font>

312
00:12:53,129 --> 00:12:58,049
request<font color="#E5E5E5"> for</font><font color="#CCCCCC"> a very long</font><font color="#E5E5E5"> record a text</font>

313
00:12:55,350 --> 00:12:59,850
record and a record right<font color="#E5E5E5"> then then</font>

314
00:12:58,049 --> 00:13:01,769
spoof the IP address it's a UDP

315
00:12:59,850 --> 00:13:04,199
connection so you<font color="#E5E5E5"> can put any IP address</font>

316
00:13:01,769 --> 00:13:05,910
you want<font color="#E5E5E5"> in the UDP packet and</font><font color="#CCCCCC"> then the</font>

317
00:13:04,199 --> 00:13:08,248
DNS<font color="#E5E5E5"> server that receives a request will</font>

318
00:13:05,910 --> 00:13:10,410
send the request back to<font color="#CCCCCC"> the IP that's</font>

319
00:13:08,249 --> 00:13:14,069
in the header<font color="#E5E5E5"> not the machine</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> the</font>

320
00:13:10,410 --> 00:13:16,079
<font color="#E5E5E5">Senate so on a 200 bit network you could</font>

321
00:13:14,069 --> 00:13:18,299
generate<font color="#E5E5E5"> a 12 gigabit attack against</font>

322
00:13:16,079 --> 00:13:20,878
<font color="#E5E5E5">somebody with one computer so if you</font>

323
00:13:18,299 --> 00:13:23,879
<font color="#E5E5E5">wanted to you could spread this out</font>

324
00:13:20,879 --> 00:13:26,339
across<font color="#E5E5E5"> a botnet</font><font color="#CCCCCC"> Network moriah networks</font>

325
00:13:23,879 --> 00:13:29,819
<font color="#E5E5E5">something like that and generate tera</font>

326
00:13:26,339 --> 00:13:31,949
bits of attack with<font color="#CCCCCC"> only Giga bits</font><font color="#E5E5E5"> of</font>

327
00:13:29,819 --> 00:13:33,509
connectivity<font color="#E5E5E5"> the problem in these kinds</font>

328
00:13:31,949 --> 00:13:35,699
of attacks<font color="#E5E5E5"> is our two victim right the</font>

329
00:13:33,509 --> 00:13:37,889
one that's reflecting the attack the DNS

330
00:13:35,699 --> 00:13:39,390
server and<font color="#E5E5E5"> then the</font><font color="#CCCCCC"> endpoint is actually</font>

331
00:13:37,889 --> 00:13:42,020
receiving<font color="#E5E5E5"> the attack</font>

332
00:13:39,390 --> 00:13:44,730
<font color="#E5E5E5">these things are easy to detect</font>

333
00:13:42,020 --> 00:13:48,000
<font color="#E5E5E5">sometimes not so easy to mitigate but</font>

334
00:13:44,730 --> 00:13:50,160
this<font color="#E5E5E5"> this graphic here</font><font color="#CCCCCC"> shows an attack</font>

335
00:13:48,000 --> 00:13:51,900
<font color="#CCCCCC">that was happening</font><font color="#E5E5E5"> that's the domain</font>

336
00:13:50,160 --> 00:13:56,250
there<font color="#E5E5E5"> it was in a record that was</font>

337
00:13:51,900 --> 00:13:58,470
<font color="#E5E5E5">getting sent</font><font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> gonna</font><font color="#CCCCCC"> said</font><font color="#E5E5E5"> any record</font>

338
00:13:56,250 --> 00:14:00,510
was getting sent and over here we<font color="#E5E5E5"> have</font>

339
00:13:58,470 --> 00:14:02,160
some rules in place<font color="#CCCCCC"> to</font><font color="#E5E5E5"> block that</font><font color="#CCCCCC"> and we</font>

340
00:14:00,510 --> 00:14:03,750
could<font color="#E5E5E5"> actually tell from our rules we're</font>

341
00:14:02,160 --> 00:14:05,819
<font color="#CCCCCC">actually blocking</font><font color="#E5E5E5"> all of those attacks</font>

342
00:14:03,750 --> 00:14:11,360
<font color="#CCCCCC">--is that came in so we</font><font color="#E5E5E5"> just chose not</font>

343
00:14:05,820 --> 00:14:13,830
<font color="#E5E5E5">to play so how did</font><font color="#CCCCCC"> we mitigate</font>

344
00:14:11,360 --> 00:14:16,050
<font color="#E5E5E5">amplification attacks well DNS servers</font>

345
00:14:13,830 --> 00:14:18,210
were then equipped with this<font color="#E5E5E5"> option</font>

346
00:14:16,050 --> 00:14:19,500
<font color="#E5E5E5">where</font><font color="#CCCCCC"> you could tell a DNS server</font><font color="#E5E5E5"> that</font>

347
00:14:18,210 --> 00:14:22,230
<font color="#E5E5E5">if certain types of records were</font>

348
00:14:19,500 --> 00:14:25,650
requested of that DNS server you the DNS

349
00:14:22,230 --> 00:14:27,030
server would respond with<font color="#E5E5E5"> a TCP reply in</font>

350
00:14:25,650 --> 00:14:28,620
other words it would<font color="#E5E5E5"> say I'll answer</font>

351
00:14:27,030 --> 00:14:32,310
<font color="#CCCCCC">that question but you got to</font><font color="#E5E5E5"> ask that</font>

352
00:14:28,620 --> 00:14:35,250
question on TCP not UDP so<font color="#CCCCCC"> anybody's</font>

353
00:14:32,310 --> 00:14:37,020
initiating an attack won't typically

354
00:14:35,250 --> 00:14:40,830
answer<font color="#E5E5E5"> because they don't want to see</font>

355
00:14:37,020 --> 00:14:44,730
that<font color="#E5E5E5"> two-way handshake go between them</font>

356
00:14:40,830 --> 00:14:47,340
and the DNS server<font color="#E5E5E5"> so this is great it</font>

357
00:14:44,730 --> 00:14:48,990
eliminates amplification attacks not so

358
00:14:47,340 --> 00:14:51,920
great because<font color="#E5E5E5"> now it</font><font color="#CCCCCC"> opens up a</font><font color="#E5E5E5"> whole</font>

359
00:14:48,990 --> 00:14:54,090
other vector for an attack<font color="#E5E5E5"> through DNS</font>

360
00:14:51,920 --> 00:14:57,199
malicious client can still spoof the IP

361
00:14:54,090 --> 00:15:01,320
address of<font color="#E5E5E5"> the source IP in a TCP packet</font>

362
00:14:57,200 --> 00:15:05,790
send a syn packet to a DNS<font color="#CCCCCC"> server on 453</font>

363
00:15:01,320 --> 00:15:07,380
TCP with the<font color="#CCCCCC"> targets IP in it</font><font color="#E5E5E5"> and then</font>

364
00:15:05,790 --> 00:15:09,689
what will<font color="#CCCCCC"> happen</font><font color="#E5E5E5"> is let's say it's my</font>

365
00:15:07,380 --> 00:15:14,250
<font color="#E5E5E5">DNS server</font><font color="#CCCCCC"> it'll send back the data back</font>

366
00:15:09,690 --> 00:15:16,140
to<font color="#E5E5E5"> the target IP as a syn ACK</font><font color="#CCCCCC"> there's a</font>

367
00:15:14,250 --> 00:15:18,600
target<font color="#E5E5E5"> does the target</font><font color="#CCCCCC"> IP ever respond</font>

368
00:15:16,140 --> 00:15:19,580
<font color="#E5E5E5">it doesn't respond right so my server</font>

369
00:15:18,600 --> 00:15:22,500
sits there and waits

370
00:15:19,580 --> 00:15:24,390
<font color="#E5E5E5">well the malicious guy sends me hundreds</font>

371
00:15:22,500 --> 00:15:26,010
<font color="#CCCCCC">of thousands of</font><font color="#E5E5E5"> these packets suddenly</font>

372
00:15:24,390 --> 00:15:27,449
now I'm initiating<font color="#CCCCCC"> a syn ACK attack</font>

373
00:15:26,010 --> 00:15:28,170
against the target that<font color="#CCCCCC"> I don't even</font>

374
00:15:27,450 --> 00:15:30,540
<font color="#E5E5E5">know who they are</font>

375
00:15:28,170 --> 00:15:32,490
so you have to be very careful when

376
00:15:30,540 --> 00:15:36,120
<font color="#E5E5E5">you're looking at mitigations and DNS</font>

377
00:15:32,490 --> 00:15:37,920
and<font color="#E5E5E5"> how things how</font><font color="#CCCCCC"> you mitigate certain</font>

378
00:15:36,120 --> 00:15:39,390
types<font color="#CCCCCC"> of attacks</font><font color="#E5E5E5"> because</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> mitigation</font>

379
00:15:37,920 --> 00:15:42,839
for one attack could open you up to

380
00:15:39,390 --> 00:15:45,330
<font color="#E5E5E5">other kinds</font><font color="#CCCCCC"> of attacks</font><font color="#E5E5E5"> the last attack</font>

381
00:15:42,840 --> 00:15:47,640
that we see on<font color="#E5E5E5"> availability are what I</font>

382
00:15:45,330 --> 00:15:51,180
call malformed packets<font color="#E5E5E5"> typically if you</font>

383
00:15:47,640 --> 00:15:52,380
see malformed packets in your<font color="#CCCCCC"> DNS</font><font color="#E5E5E5"> this</font>

384
00:15:51,180 --> 00:15:53,130
is an indication<font color="#E5E5E5"> that somebody's</font>

385
00:15:52,380 --> 00:15:54,840
<font color="#CCCCCC">tunnelling some</font>

386
00:15:53,130 --> 00:15:56,970
thing through DNS on your network<font color="#E5E5E5"> and</font>

387
00:15:54,840 --> 00:15:58,620
<font color="#E5E5E5">you really need to investigate which</font>

388
00:15:56,970 --> 00:16:00,660
device on your network is<font color="#E5E5E5"> doing this</font>

389
00:15:58,620 --> 00:16:02,820
because<font color="#CCCCCC"> there should never</font><font color="#E5E5E5"> be more than</font>

390
00:16:00,660 --> 00:16:04,620
<font color="#E5E5E5">a few mile form packets on DNS coming</font>

391
00:16:02,820 --> 00:16:07,400
through your<font color="#E5E5E5"> network</font><font color="#CCCCCC"> unfortunately the</font>

392
00:16:04,620 --> 00:16:12,000
only<font color="#E5E5E5"> way to get at these is through</font>

393
00:16:07,400 --> 00:16:15,870
<font color="#CCCCCC">packet capture and Wireshark so all</font>

394
00:16:12,000 --> 00:16:17,430
<font color="#CCCCCC">right</font><font color="#E5E5E5"> so we looked at I saw this on a</font>

395
00:16:15,870 --> 00:16:19,620
tweet the<font color="#CCCCCC"> other week</font><font color="#E5E5E5"> and I thought this</font>

396
00:16:17,430 --> 00:16:21,030
<font color="#E5E5E5">was appropriate</font><font color="#CCCCCC"> for the talk so I put it</font>

397
00:16:19,620 --> 00:16:23,640
in there<font color="#CCCCCC"> so now I've talked about</font><font color="#E5E5E5"> the</font>

398
00:16:21,030 --> 00:16:27,110
OSI model and cats in the<font color="#CCCCCC"> same slide so</font>

399
00:16:23,640 --> 00:16:30,000
I<font color="#E5E5E5"> think I get bonus points</font><font color="#CCCCCC"> for that</font><font color="#E5E5E5"> so</font>

400
00:16:27,110 --> 00:16:31,650
so I put this<font color="#E5E5E5"> up here</font><font color="#CCCCCC"> not</font><font color="#E5E5E5"> because we</font>

401
00:16:30,000 --> 00:16:33,240
want to memorize the OSI model but think

402
00:16:31,650 --> 00:16:35,610
in terms of<font color="#CCCCCC"> the OSI model when you're</font>

403
00:16:33,240 --> 00:16:37,110
trying<font color="#E5E5E5"> to figure out ways</font><font color="#CCCCCC"> to mitigate</font>

404
00:16:35,610 --> 00:16:39,240
<font color="#E5E5E5">attacks all right where are we going to</font>

405
00:16:37,110 --> 00:16:41,010
gather<font color="#E5E5E5"> data what kinds of</font><font color="#CCCCCC"> information</font>

406
00:16:39,240 --> 00:16:43,140
can we<font color="#E5E5E5"> get at these various layers and</font>

407
00:16:41,010 --> 00:16:46,130
what kinds of mitigating<font color="#CCCCCC"> controls can we</font>

408
00:16:43,140 --> 00:16:49,140
put in place<font color="#CCCCCC"> for these different layers</font>

409
00:16:46,130 --> 00:16:50,790
<font color="#E5E5E5">so now I'm going to talk</font><font color="#CCCCCC"> about some of</font>

410
00:16:49,140 --> 00:16:52,530
the things<font color="#CCCCCC"> that you can do from</font><font color="#E5E5E5"> a DNS</font>

411
00:16:50,790 --> 00:16:53,969
<font color="#CCCCCC">perspective</font><font color="#E5E5E5"> and you're not going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> get</font>

412
00:16:52,530 --> 00:16:55,230
<font color="#E5E5E5">all these down but what I'm going</font><font color="#CCCCCC"> to do</font>

413
00:16:53,970 --> 00:16:58,560
is I'm gonna put a<font color="#E5E5E5"> couple of blog posts</font>

414
00:16:55,230 --> 00:17:00,390
<font color="#CCCCCC">out at tripwire and peer list</font><font color="#E5E5E5"> and I'll</font>

415
00:16:58,560 --> 00:17:01,770
document all<font color="#CCCCCC"> of the stuff and give you</font>

416
00:17:00,390 --> 00:17:05,459
much more<font color="#E5E5E5"> detail because</font><font color="#CCCCCC"> we really don't</font>

417
00:17:01,770 --> 00:17:06,900
have a ton of time today to do that so

418
00:17:05,459 --> 00:17:08,550
what I want to<font color="#E5E5E5"> do is just go</font><font color="#CCCCCC"> over them</font>

419
00:17:06,900 --> 00:17:09,300
one<font color="#CCCCCC"> of the</font><font color="#E5E5E5"> things that you can do with</font>

420
00:17:08,550 --> 00:17:12,030
your firewalls

421
00:17:09,300 --> 00:17:13,379
how many restrict outside DNS servers in

422
00:17:12,030 --> 00:17:16,199
other words do you<font color="#E5E5E5"> allow your firewall</font>

423
00:17:13,380 --> 00:17:18,839
to let your internal clients query any

424
00:17:16,199 --> 00:17:22,890
DNS<font color="#E5E5E5"> server on the Internet not a good</font>

425
00:17:18,839 --> 00:17:24,810
idea<font color="#CCCCCC"> right why malware on a machine can</font>

426
00:17:22,890 --> 00:17:26,280
query a DNS server<font color="#CCCCCC"> aside</font><font color="#E5E5E5"> from anything</font>

427
00:17:24,810 --> 00:17:27,958
that's<font color="#CCCCCC"> on a network</font><font color="#E5E5E5"> card or network</font>

428
00:17:26,280 --> 00:17:30,300
device on<font color="#E5E5E5"> your machine it can query DNS</font>

429
00:17:27,959 --> 00:17:33,780
directly<font color="#E5E5E5"> so what you want to do ideally</font>

430
00:17:30,300 --> 00:17:37,770
<font color="#E5E5E5">is restrict where DNS can get through</font>

431
00:17:33,780 --> 00:17:40,170
<font color="#CCCCCC">your firewall</font><font color="#E5E5E5"> so what we do is in our</font>

432
00:17:37,770 --> 00:17:41,970
case we use<font color="#E5E5E5"> Active Directory or Active</font>

433
00:17:40,170 --> 00:17:43,890
Directory servers<font color="#CCCCCC"> or the cache servers</font>

434
00:17:41,970 --> 00:17:46,140
the resolvers for<font color="#E5E5E5"> our internal clients</font>

435
00:17:43,890 --> 00:17:48,360
<font color="#E5E5E5">and only those servers can get out to</font>

436
00:17:46,140 --> 00:17:50,940
the<font color="#E5E5E5"> internet and only</font><font color="#CCCCCC"> to specific</font><font color="#E5E5E5"> DNS</font>

437
00:17:48,360 --> 00:17:53,040
servers to do the lookups<font color="#E5E5E5"> right so we</font>

438
00:17:50,940 --> 00:17:56,640
use a<font color="#E5E5E5"> security filtering service our own</font>

439
00:17:53,040 --> 00:17:57,899
and then<font color="#CCCCCC"> we don't</font><font color="#E5E5E5"> forward to</font><font color="#CCCCCC"> route and</font>

440
00:17:56,640 --> 00:18:02,130
I'll tell you why about that and the

441
00:17:57,900 --> 00:18:05,760
second here firewall should also inspect

442
00:18:02,130 --> 00:18:07,950
DNS traffic<font color="#E5E5E5"> so would you ever accept a</font>

443
00:18:05,760 --> 00:18:10,920
DNS request<font color="#E5E5E5"> coming in that didn't</font>

444
00:18:07,950 --> 00:18:12,750
originate<font color="#E5E5E5"> on</font><font color="#CCCCCC"> the inside no right so you</font>

445
00:18:10,920 --> 00:18:14,280
want to<font color="#CCCCCC"> ensure statefulness on your</font>

446
00:18:12,750 --> 00:18:16,320
firewalls do not allow<font color="#CCCCCC"> DNS from the</font>

447
00:18:14,280 --> 00:18:20,070
outside to come<font color="#E5E5E5"> back in that will</font>

448
00:18:16,320 --> 00:18:20,490
prevent those DNS spoofing attacks from

449
00:18:20,070 --> 00:18:25,800
happening

450
00:18:20,490 --> 00:18:27,900
<font color="#CCCCCC">I lost my mouse your</font><font color="#E5E5E5"> mouse so firewall</font>

451
00:18:25,800 --> 00:18:31,080
should also be configured<font color="#E5E5E5"> to rate limit</font>

452
00:18:27,900 --> 00:18:32,970
DNS queries so that if your outbound

453
00:18:31,080 --> 00:18:34,560
<font color="#E5E5E5">machine</font><font color="#CCCCCC"> lets a machine gets infected</font><font color="#E5E5E5"> and</font>

454
00:18:32,970 --> 00:18:36,570
wants to start<font color="#CCCCCC"> participating in a DNS</font>

455
00:18:34,560 --> 00:18:38,100
amplification attack if you don't rate

456
00:18:36,570 --> 00:18:40,080
limit the outbound queries on your

457
00:18:38,100 --> 00:18:50,610
network<font color="#E5E5E5"> you could be participating in</font>

458
00:18:40,080 --> 00:18:51,960
those<font color="#E5E5E5"> attacks</font><font color="#CCCCCC"> and not even know it</font><font color="#E5E5E5"> so</font>

459
00:18:50,610 --> 00:18:54,199
the other thing<font color="#CCCCCC"> we also</font><font color="#E5E5E5"> need to look at</font>

460
00:18:51,960 --> 00:18:56,940
is what<font color="#CCCCCC"> we can do in Active Directory</font>

461
00:18:54,200 --> 00:18:58,890
<font color="#CCCCCC">and our Active Directory servers we use</font>

462
00:18:56,940 --> 00:19:01,170
our secure server filtering<font color="#CCCCCC"> service you</font>

463
00:18:58,890 --> 00:19:03,330
may use other services<font color="#CCCCCC"> but in our case</font>

464
00:19:01,170 --> 00:19:05,970
in Active Directory DNS<font color="#E5E5E5"> you're able to</font>

465
00:19:03,330 --> 00:19:07,620
forward<font color="#E5E5E5"> DNS requests so your Active</font>

466
00:19:05,970 --> 00:19:08,940
Directory<font color="#E5E5E5"> will service all the requests</font>

467
00:19:07,620 --> 00:19:11,129
<font color="#CCCCCC">that it knows how</font><font color="#E5E5E5"> to handle internally</font>

468
00:19:08,940 --> 00:19:12,840
and then forward the<font color="#CCCCCC"> other requests out</font>

469
00:19:11,130 --> 00:19:14,610
to the<font color="#CCCCCC"> internet if you don't set up</font>

470
00:19:12,840 --> 00:19:16,679
forwarders on your Active Directory

471
00:19:14,610 --> 00:19:18,840
server it will<font color="#E5E5E5"> use the</font><font color="#CCCCCC"> route servers to</font>

472
00:19:16,680 --> 00:19:21,600
answer those queries<font color="#CCCCCC"> just a normal DNS</font>

473
00:19:18,840 --> 00:19:23,610
query in our case we're<font color="#CCCCCC"> using our</font>

474
00:19:21,600 --> 00:19:25,350
filtering servers so what we have done

475
00:19:23,610 --> 00:19:27,330
is we've turned off forwarding to<font color="#CCCCCC"> route</font>

476
00:19:25,350 --> 00:19:28,969
so if you're using some sort of<font color="#E5E5E5"> DNS</font>

477
00:19:27,330 --> 00:19:31,740
filtering<font color="#E5E5E5"> service why would you do this</font>

478
00:19:28,970 --> 00:19:35,280
<font color="#E5E5E5">you would rather fail safe than fail</font>

479
00:19:31,740 --> 00:19:36,990
open<font color="#CCCCCC"> right so what</font><font color="#E5E5E5"> can</font><font color="#CCCCCC"> happen if you are</font>

480
00:19:35,280 --> 00:19:39,178
using a filtering service<font color="#E5E5E5"> and forwarding</font>

481
00:19:36,990 --> 00:19:40,650
to those and somebody realizes that<font color="#E5E5E5"> by</font>

482
00:19:39,179 --> 00:19:42,600
sniffing traffic on your network what

483
00:19:40,650 --> 00:19:43,170
are they<font color="#E5E5E5"> going to do they're going to</font>

484
00:19:42,600 --> 00:19:45,540
block

485
00:19:43,170 --> 00:19:47,490
active access to those DNS servers right

486
00:19:45,540 --> 00:19:50,159
because they want your<font color="#CCCCCC"> security for your</font>

487
00:19:47,490 --> 00:19:52,850
DNS to fail<font color="#E5E5E5"> if you</font><font color="#CCCCCC"> have your</font><font color="#E5E5E5"> forwarders</font>

488
00:19:50,160 --> 00:19:54,600
set to forward<font color="#E5E5E5"> on fail to the</font><font color="#CCCCCC"> route</font>

489
00:19:52,850 --> 00:19:55,830
<font color="#CCCCCC">they're not going</font><font color="#E5E5E5"> to block the root</font>

490
00:19:54,600 --> 00:19:56,879
servers the<font color="#E5E5E5"> root servers are going to</font>

491
00:19:55,830 --> 00:19:59,310
work and they're<font color="#E5E5E5"> going to answer for</font>

492
00:19:56,880 --> 00:20:01,170
anything<font color="#E5E5E5"> so any</font><font color="#CCCCCC"> DNS will get resolved so</font>

493
00:19:59,310 --> 00:20:03,480
you will have no<font color="#E5E5E5"> level of security</font><font color="#CCCCCC"> if</font>

494
00:20:01,170 --> 00:20:06,900
that<font color="#E5E5E5"> DNS gets blocked</font><font color="#CCCCCC"> you would rather</font>

495
00:20:03,480 --> 00:20:09,870
fail<font color="#E5E5E5"> closed and fail open the other</font>

496
00:20:06,900 --> 00:20:11,550
<font color="#E5E5E5">thing we look at is on</font><font color="#CCCCCC"> Group Policy</font><font color="#E5E5E5"> we</font>

497
00:20:09,870 --> 00:20:13,139
make sure<font color="#E5E5E5"> that we set group</font><font color="#CCCCCC"> policy so</font>

498
00:20:11,550 --> 00:20:15,570
that<font color="#E5E5E5"> people cannot change the network</font>

499
00:20:13,140 --> 00:20:18,059
settings on their network cards<font color="#CCCCCC"> I no</font>

500
00:20:15,570 --> 00:20:20,309
mean<font color="#E5E5E5"> evil bad me right</font>

501
00:20:18,059 --> 00:20:23,059
we don't want them saying<font color="#E5E5E5"> old and it</font>

502
00:20:20,309 --> 00:20:25,710
works slow I'm gonna change the 8.8.8.8

503
00:20:23,059 --> 00:20:27,979
<font color="#CCCCCC">rye that new cool DNS server</font><font color="#E5E5E5"> we don't</font>

504
00:20:25,710 --> 00:20:30,899
want that happening<font color="#CCCCCC"> so</font><font color="#E5E5E5"> we lock them down</font>

505
00:20:27,979 --> 00:20:32,639
<font color="#E5E5E5">we take it even one</font><font color="#CCCCCC"> step further</font><font color="#E5E5E5"> we push</font>

506
00:20:30,899 --> 00:20:36,418
firewall rules out to every device on

507
00:20:32,639 --> 00:20:39,209
<font color="#E5E5E5">the</font><font color="#CCCCCC"> network that says you cannot query</font>

508
00:20:36,419 --> 00:20:41,609
anything but<font color="#E5E5E5"> our approved list of DNS</font>

509
00:20:39,210 --> 00:20:43,080
servers from<font color="#E5E5E5"> that device</font><font color="#CCCCCC"> so remember</font>

510
00:20:41,609 --> 00:20:45,570
earlier<font color="#CCCCCC"> I told</font><font color="#E5E5E5"> you what malware can do</font>

511
00:20:43,080 --> 00:20:48,239
right<font color="#E5E5E5"> a lot of malware is written so</font>

512
00:20:45,570 --> 00:20:51,599
that<font color="#E5E5E5"> it will first try the DNS that's on</font>

513
00:20:48,239 --> 00:20:53,849
whatever network<font color="#CCCCCC"> devices on your device</font>

514
00:20:51,599 --> 00:20:55,678
<font color="#E5E5E5">that's infected that doesn't work it's</font>

515
00:20:53,849 --> 00:20:57,619
going<font color="#E5E5E5"> to query directly to some DNS</font>

516
00:20:55,679 --> 00:21:01,200
<font color="#E5E5E5">server that's pre coded in the malware</font>

517
00:20:57,619 --> 00:21:03,658
so if you by blocking DNS<font color="#CCCCCC"> to anywhere</font>

518
00:21:01,200 --> 00:21:05,669
<font color="#E5E5E5">but your local Active Directory servers</font>

519
00:21:03,659 --> 00:21:08,190
<font color="#E5E5E5">block</font><font color="#CCCCCC"> those DNS requests from</font><font color="#E5E5E5"> that</font>

520
00:21:05,669 --> 00:21:10,259
malware<font color="#E5E5E5"> that malware can't make direct</font>

521
00:21:08,190 --> 00:21:11,729
calls out<font color="#CCCCCC"> to the internet so that's</font>

522
00:21:10,259 --> 00:21:14,659
<font color="#CCCCCC">something you really want</font><font color="#E5E5E5"> to consider</font>

523
00:21:11,729 --> 00:21:18,419
<font color="#CCCCCC">when you're when you're dealing</font><font color="#E5E5E5"> with</font>

524
00:21:14,659 --> 00:21:20,039
group policy<font color="#E5E5E5"> there's some links on here</font>

525
00:21:18,419 --> 00:21:21,509
and what I'm<font color="#E5E5E5"> going to do is I'm going to</font>

526
00:21:20,039 --> 00:21:26,099
write<font color="#CCCCCC"> all this up a</font><font color="#E5E5E5"> little bit more in</font>

527
00:21:21,509 --> 00:21:28,679
detail again<font color="#E5E5E5"> on a couple of blogs so the</font>

528
00:21:26,099 --> 00:21:30,960
other thing I recommend<font color="#E5E5E5"> for DNS</font>

529
00:21:28,679 --> 00:21:32,700
resolution is that you separate your

530
00:21:30,960 --> 00:21:34,919
<font color="#E5E5E5">recursive and authoritative functions</font>

531
00:21:32,700 --> 00:21:38,039
<font color="#CCCCCC">all</font><font color="#E5E5E5"> right so if you're using how many</font>

532
00:21:34,919 --> 00:21:41,460
how<font color="#E5E5E5"> many of you use Active Directory DNS</font>

533
00:21:38,039 --> 00:21:44,129
for authoritative DNS on the public

534
00:21:41,460 --> 00:21:48,149
<font color="#CCCCCC">Internet you don't have to raise your</font>

535
00:21:44,129 --> 00:21:50,488
hand if you do that your homework is to

536
00:21:48,149 --> 00:21:53,488
<font color="#E5E5E5">not do that anymore</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> would be a very</font>

537
00:21:50,489 --> 00:21:55,049
<font color="#E5E5E5">bad thing all right because if somebody</font>

538
00:21:53,489 --> 00:21:57,059
can compromise<font color="#CCCCCC"> that DNS server they can</font>

539
00:21:55,049 --> 00:21:58,918
get access<font color="#E5E5E5"> to every zone on your</font>

540
00:21:57,059 --> 00:22:00,839
internal network<font color="#CCCCCC"> and that's</font><font color="#E5E5E5"> not a very</font>

541
00:21:58,919 --> 00:22:02,609
<font color="#E5E5E5">good thing so separate your recursive</font>

542
00:22:00,839 --> 00:22:04,200
<font color="#E5E5E5">and authoritative functions what we</font>

543
00:22:02,609 --> 00:22:06,359
recommend is that you use<font color="#CCCCCC"> your Active</font>

544
00:22:04,200 --> 00:22:08,339
Directory servers those Active Directory

545
00:22:06,359 --> 00:22:10,889
servers query some sort of internal

546
00:22:08,339 --> 00:22:13,499
cache servers<font color="#CCCCCC"> I would recommend</font><font color="#E5E5E5"> setting</font>

547
00:22:10,889 --> 00:22:16,019
up a pool of<font color="#E5E5E5"> unbound servers it's a</font>

548
00:22:13,499 --> 00:22:17,639
great<font color="#E5E5E5"> caching server has</font><font color="#CCCCCC"> pre-emptive</font>

549
00:22:16,019 --> 00:22:19,379
caching<font color="#CCCCCC"> you can put some rules in</font><font color="#E5E5E5"> it</font>

550
00:22:17,639 --> 00:22:22,080
that will block<font color="#E5E5E5"> certain kinds of</font>

551
00:22:19,379 --> 00:22:24,599
malicious<font color="#E5E5E5"> IPs it's a very good middleman</font>

552
00:22:22,080 --> 00:22:27,269
<font color="#CCCCCC">and then let</font><font color="#E5E5E5"> only those unbound servers</font>

553
00:22:24,599 --> 00:22:29,369
<font color="#E5E5E5">out to the</font><font color="#CCCCCC"> internet for</font><font color="#E5E5E5"> DNS that</font><font color="#CCCCCC"> way you</font>

554
00:22:27,269 --> 00:22:30,690
can<font color="#E5E5E5"> control everything and you'll see</font>

555
00:22:29,369 --> 00:22:31,740
where<font color="#CCCCCC"> I'm going with this</font><font color="#E5E5E5"> when we talk</font>

556
00:22:30,690 --> 00:22:34,160
about<font color="#E5E5E5"> how</font>

557
00:22:31,740 --> 00:22:36,660
we're going to log<font color="#CCCCCC"> that information</font>

558
00:22:34,160 --> 00:22:37,920
again I would employ the firewall rules

559
00:22:36,660 --> 00:22:40,830
on the edge<font color="#E5E5E5"> that we discussed earlier</font>

560
00:22:37,920 --> 00:22:42,150
<font color="#CCCCCC">and</font><font color="#E5E5E5"> I we do something on</font><font color="#CCCCCC"> our network and</font>

561
00:22:40,830 --> 00:22:44,399
<font color="#E5E5E5">you may or may</font><font color="#CCCCCC"> not agree with this but</font>

562
00:22:42,150 --> 00:22:46,380
<font color="#CCCCCC">we</font><font color="#E5E5E5"> and I'll explain why we do it we</font>

563
00:22:44,400 --> 00:22:51,059
enforce a standard TTL of<font color="#E5E5E5"> five minutes</font>

564
00:22:46,380 --> 00:22:52,950
on every<font color="#CCCCCC"> dns request okay there's a</font>

565
00:22:51,059 --> 00:22:55,320
method<font color="#CCCCCC"> to this right so</font><font color="#E5E5E5"> the assumption</font>

566
00:22:52,950 --> 00:22:57,480
is if somebody compromises your<font color="#E5E5E5"> DNS</font>

567
00:22:55,320 --> 00:22:59,939
record<font color="#E5E5E5"> checked a record that's bad into</font>

568
00:22:57,480 --> 00:23:00,690
your DNS cache<font color="#CCCCCC"> once they do that what</font>

569
00:22:59,940 --> 00:23:02,220
<font color="#E5E5E5">are they going to do they're going to</font>

570
00:23:00,690 --> 00:23:03,450
set a really long TTL because they don't

571
00:23:02,220 --> 00:23:05,610
want you<font color="#CCCCCC"> to look that up</font><font color="#E5E5E5"> again they want</font>

572
00:23:03,450 --> 00:23:07,770
that<font color="#E5E5E5"> to be persistent in DNS so by</font>

573
00:23:05,610 --> 00:23:09,659
<font color="#E5E5E5">setting your TTL</font><font color="#CCCCCC"> s</font><font color="#E5E5E5"> to always be five</font>

574
00:23:07,770 --> 00:23:11,129
minutes<font color="#CCCCCC"> on your</font><font color="#E5E5E5"> DNS server the DNS</font>

575
00:23:09,660 --> 00:23:12,809
server<font color="#E5E5E5"> won't honor anything over five</font>

576
00:23:11,130 --> 00:23:14,970
minutes<font color="#CCCCCC"> and it</font><font color="#E5E5E5"> will go back</font><font color="#CCCCCC"> and refresh</font>

577
00:23:12,809 --> 00:23:16,710
from the<font color="#E5E5E5"> root or wherever it's supposed</font>

578
00:23:14,970 --> 00:23:18,780
<font color="#E5E5E5">to do these lookups</font><font color="#CCCCCC"> so that means if you</font>

579
00:23:16,710 --> 00:23:21,360
<font color="#CCCCCC">have some</font><font color="#E5E5E5"> sort of rogue DNS in your</font>

580
00:23:18,780 --> 00:23:22,800
cache it's only going<font color="#E5E5E5"> to persist</font><font color="#CCCCCC"> for at</font>

581
00:23:21,360 --> 00:23:24,409
<font color="#E5E5E5">most five minutes or ten</font><font color="#CCCCCC"> minutes or</font>

582
00:23:22,800 --> 00:23:27,510
<font color="#CCCCCC">whatever that</font><font color="#E5E5E5"> number is that</font><font color="#CCCCCC"> you said</font>

583
00:23:24,410 --> 00:23:29,580
our<font color="#E5E5E5"> last thing that I</font><font color="#CCCCCC"> recommend</font><font color="#E5E5E5"> is</font>

584
00:23:27,510 --> 00:23:31,260
monitor<font color="#CCCCCC"> the crap out of</font><font color="#E5E5E5"> your DNS and</font>

585
00:23:29,580 --> 00:23:34,290
I'll show<font color="#E5E5E5"> you some tricks</font><font color="#CCCCCC"> on how to</font><font color="#E5E5E5"> do</font>

586
00:23:31,260 --> 00:23:36,120
that for authoritative<font color="#E5E5E5"> DNS for your</font>

587
00:23:34,290 --> 00:23:37,500
domains right<font color="#CCCCCC"> they're important you want</font>

588
00:23:36,120 --> 00:23:39,300
your<font color="#E5E5E5"> websites up you want their MX</font>

589
00:23:37,500 --> 00:23:43,679
records up<font color="#E5E5E5"> you don't want them to go</font>

590
00:23:39,300 --> 00:23:51,290
<font color="#E5E5E5">down what happened on it was October 26</font>

591
00:23:43,679 --> 00:23:56,550
1916 anybody<font color="#E5E5E5"> remember or 2016 I'm sorry</font>

592
00:23:51,290 --> 00:23:59,550
<font color="#E5E5E5">say it's euro</font><font color="#CCCCCC"> H yeah so dine</font><font color="#E5E5E5"> DNS was</font>

593
00:23:56,550 --> 00:24:05,340
taken<font color="#E5E5E5"> down so the</font><font color="#CCCCCC"> backstory on that this</font>

594
00:23:59,550 --> 00:24:07,379
was a<font color="#E5E5E5"> gamer that was on</font><font color="#CCCCCC"> Xbox he'd gotten</font>

595
00:24:05,340 --> 00:24:10,350
violated terms of services account was

596
00:24:07,380 --> 00:24:12,150
<font color="#E5E5E5">terminated early</font><font color="#CCCCCC"> June July something</font>

597
00:24:10,350 --> 00:24:13,889
like that saved up his<font color="#CCCCCC"> money running</font>

598
00:24:12,150 --> 00:24:15,740
some time of<font color="#E5E5E5"> the botnet network and said</font>

599
00:24:13,890 --> 00:24:17,370
<font color="#E5E5E5">screw you</font><font color="#CCCCCC"> Xbox I'm gonna</font><font color="#E5E5E5"> take you down</font>

600
00:24:15,740 --> 00:24:20,309
<font color="#CCCCCC">that's what he did</font>

601
00:24:17,370 --> 00:24:22,770
unfortunately<font color="#CCCCCC"> nine hosts</font><font color="#E5E5E5"> Xbox Twitter</font>

602
00:24:20,309 --> 00:24:24,678
some Facebook domains<font color="#E5E5E5"> a whole bunch of</font>

603
00:24:22,770 --> 00:24:30,059
other pretty important and<font color="#E5E5E5"> pretty</font>

604
00:24:24,679 --> 00:24:31,500
heavily<font color="#E5E5E5"> trafficked domains so the lesson</font>

605
00:24:30,059 --> 00:24:32,970
learned<font color="#E5E5E5"> that day was don't put your</font>

606
00:24:31,500 --> 00:24:35,550
authoritative nameservers with one

607
00:24:32,970 --> 00:24:37,890
provider<font color="#E5E5E5"> okay if</font><font color="#CCCCCC"> you're if it's that</font>

608
00:24:35,550 --> 00:24:40,320
important that your site stays up get

609
00:24:37,890 --> 00:24:43,200
multiple<font color="#CCCCCC"> providers use providers</font><font color="#E5E5E5"> that</font>

610
00:24:40,320 --> 00:24:45,720
support any caste and any caste

611
00:24:43,200 --> 00:24:47,580
basically is simply advertising

612
00:24:45,720 --> 00:24:50,340
the same<font color="#E5E5E5"> ip block from multiple</font>

613
00:24:47,580 --> 00:24:52,408
<font color="#CCCCCC">locations taller</font><font color="#E5E5E5"> connected peers</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> that</font>

614
00:24:50,340 --> 00:24:53,009
you have<font color="#E5E5E5"> multiple sites with the same</font><font color="#CCCCCC"> IP</font>

615
00:24:52,409 --> 00:24:55,409
<font color="#CCCCCC">address</font>

616
00:24:53,009 --> 00:24:57,779
BGP<font color="#E5E5E5"> routing figures out the best route</font>

617
00:24:55,409 --> 00:25:00,029
to<font color="#E5E5E5"> that site so</font><font color="#CCCCCC"> you might get</font><font color="#E5E5E5"> an</font>

618
00:24:57,779 --> 00:25:03,389
isolated outage but you won't take down

619
00:25:00,029 --> 00:25:05,519
your<font color="#E5E5E5"> whole site</font><font color="#CCCCCC"> if you're using</font><font color="#E5E5E5"> any</font><font color="#CCCCCC"> cast</font>

620
00:25:03,389 --> 00:25:08,399
routing to get your data<font color="#CCCCCC"> out to</font><font color="#E5E5E5"> the</font>

621
00:25:05,519 --> 00:25:10,500
<font color="#CCCCCC">internet I would</font><font color="#E5E5E5"> routinely validate all</font>

622
00:25:08,399 --> 00:25:13,649
of your name server<font color="#E5E5E5"> domain registrations</font>

623
00:25:10,500 --> 00:25:15,870
<font color="#CCCCCC">do that</font><font color="#E5E5E5"> on a regular basis</font><font color="#CCCCCC"> ok the Whois</font>

624
00:25:13,649 --> 00:25:18,600
stuff sometimes it's hidden<font color="#E5E5E5"> and with the</font>

625
00:25:15,870 --> 00:25:19,979
<font color="#CCCCCC">gdpr</font><font color="#E5E5E5"> coming down it's probably</font><font color="#CCCCCC"> gonna get</font>

626
00:25:18,600 --> 00:25:21,418
harder to find<font color="#E5E5E5"> that</font><font color="#CCCCCC"> information you</font>

627
00:25:19,980 --> 00:25:26,009
might<font color="#E5E5E5"> have to subscribe to the</font><font color="#CCCCCC"> service</font>

628
00:25:21,419 --> 00:25:27,299
<font color="#E5E5E5">to do that but know who owns the domains</font>

629
00:25:26,009 --> 00:25:29,490
that<font color="#CCCCCC"> you're using for your name servers</font>

630
00:25:27,299 --> 00:25:31,710
<font color="#E5E5E5">when they're registered when they expire</font>

631
00:25:29,490 --> 00:25:33,600
<font color="#E5E5E5">and make sure the IP addresses</font><font color="#CCCCCC"> that</font>

632
00:25:31,710 --> 00:25:35,879
<font color="#E5E5E5">those were solved to don't change on a</font>

633
00:25:33,600 --> 00:25:38,279
regular<font color="#E5E5E5"> basis so set up some monitoring</font>

634
00:25:35,879 --> 00:25:41,399
to monitor those<font color="#E5E5E5"> also I would monitor</font>

635
00:25:38,279 --> 00:25:43,830
for their uptime their latency and test

636
00:25:41,399 --> 00:25:45,840
for correct resolution<font color="#CCCCCC"> some of the</font>

637
00:25:43,830 --> 00:25:48,658
things you<font color="#E5E5E5"> can use site 24/7 works well</font>

638
00:25:45,840 --> 00:25:50,939
web metrics<font color="#E5E5E5"> PRTG is a good internal</font>

639
00:25:48,659 --> 00:25:53,519
monitoring<font color="#E5E5E5"> tool that you can</font><font color="#CCCCCC"> use but</font><font color="#E5E5E5"> all</font>

640
00:25:50,940 --> 00:25:56,220
of those will<font color="#CCCCCC"> will work well and I would</font>

641
00:25:53,519 --> 00:25:58,590
<font color="#E5E5E5">probably your website's important retain</font>

642
00:25:56,220 --> 00:26:00,360
some sort of DDoS mitigation service

643
00:25:58,590 --> 00:26:04,259
with your<font color="#E5E5E5"> DNS if you can do that be can</font>

644
00:26:00,360 --> 00:26:06,330
afford to do<font color="#CCCCCC"> that as a service provider</font>

645
00:26:04,259 --> 00:26:08,419
again<font color="#E5E5E5"> your your IPS that you put out</font><font color="#CCCCCC"> in</font>

646
00:26:06,330 --> 00:26:11,129
the public<font color="#E5E5E5"> should be used with</font><font color="#CCCCCC"> any cast</font>

647
00:26:08,419 --> 00:26:12,809
<font color="#CCCCCC">in our case we use multiple machines</font>

648
00:26:11,129 --> 00:26:15,330
behind<font color="#E5E5E5"> load-balanced VIPs throughout</font>

649
00:26:12,809 --> 00:26:17,700
data centers all over<font color="#E5E5E5"> the world</font><font color="#CCCCCC"> in our</font>

650
00:26:15,330 --> 00:26:19,769
<font color="#E5E5E5">case we</font><font color="#CCCCCC"> also use</font><font color="#E5E5E5"> some load balancer</font>

651
00:26:17,700 --> 00:26:23,279
rules to filter all<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the incoming</font>

652
00:26:19,769 --> 00:26:25,049
requests for<font color="#E5E5E5"> DNS so we have DNS cache</font>

653
00:26:23,279 --> 00:26:26,460
<font color="#E5E5E5">VIPs that</font><font color="#CCCCCC"> are open to</font><font color="#E5E5E5"> the world anybody</font>

654
00:26:25,049 --> 00:26:28,799
can<font color="#E5E5E5"> query them you can query them if you</font>

655
00:26:26,460 --> 00:26:31,080
want<font color="#E5E5E5"> to but you can't query them too</font>

656
00:26:28,799 --> 00:26:33,720
much that<font color="#E5E5E5"> makes any sense</font><font color="#CCCCCC"> if you were to</font>

657
00:26:31,080 --> 00:26:36,570
<font color="#E5E5E5">hit a DNS cache server our cache server</font>

658
00:26:33,720 --> 00:26:38,519
and started<font color="#E5E5E5"> hitting it with</font><font color="#CCCCCC"> 10 any</font>

659
00:26:36,570 --> 00:26:39,750
requests in a second we<font color="#E5E5E5"> would say yeah</font>

660
00:26:38,519 --> 00:26:41,279
we don't<font color="#E5E5E5"> like that that's</font><font color="#CCCCCC"> not cool</font>

661
00:26:39,750 --> 00:26:43,950
there's no reason you<font color="#CCCCCC"> have to</font><font color="#E5E5E5"> look up</font>

662
00:26:41,279 --> 00:26:45,389
<font color="#E5E5E5">the same domain within any request</font><font color="#CCCCCC"> 10</font>

663
00:26:43,950 --> 00:26:45,919
times in a second something's<font color="#E5E5E5"> not right</font>

664
00:26:45,389 --> 00:26:48,719
here

665
00:26:45,919 --> 00:26:50,490
so we put these<font color="#E5E5E5"> rules in place that</font>

666
00:26:48,720 --> 00:26:52,679
limit by the type of<font color="#E5E5E5"> record</font><font color="#CCCCCC"> the source</font>

667
00:26:50,490 --> 00:26:55,440
the domain etc we're able<font color="#CCCCCC"> to put rules</font>

668
00:26:52,679 --> 00:26:56,940
<font color="#E5E5E5">in place to</font><font color="#CCCCCC"> keep that keep that in line</font>

669
00:26:55,440 --> 00:26:58,409
and we can<font color="#CCCCCC"> monitor those and adjust</font>

670
00:26:56,940 --> 00:26:59,520
those limits based on<font color="#E5E5E5"> what we see from</font>

671
00:26:58,409 --> 00:27:01,620
<font color="#E5E5E5">our customers</font>

672
00:26:59,520 --> 00:27:03,629
so we've talked<font color="#E5E5E5"> about</font><font color="#CCCCCC"> some things about</font>

673
00:27:01,620 --> 00:27:06,239
security how do we know what to look<font color="#E5E5E5"> for</font>

674
00:27:03,630 --> 00:27:07,460
in our security<font color="#E5E5E5"> right without insight</font>

675
00:27:06,240 --> 00:27:11,340
into what's<font color="#CCCCCC"> happening</font>

676
00:27:07,460 --> 00:27:13,350
it's all kind of pointless<font color="#E5E5E5"> so and the</font>

677
00:27:11,340 --> 00:27:15,899
<font color="#E5E5E5">problem becomes</font><font color="#CCCCCC"> when we really really</font>

678
00:27:13,350 --> 00:27:18,209
need data<font color="#E5E5E5"> it's usually when we're trying</font>

679
00:27:15,900 --> 00:27:20,490
to drink out<font color="#CCCCCC"> of a firehose right</font><font color="#E5E5E5"> you</font>

680
00:27:18,210 --> 00:27:22,260
know you know what's hit the fan<font color="#CCCCCC"> things</font>

681
00:27:20,490 --> 00:27:23,970
aren't working<font color="#CCCCCC"> we have to figure this</font>

682
00:27:22,260 --> 00:27:25,320
<font color="#E5E5E5">out people are barking at us the</font>

683
00:27:23,970 --> 00:27:27,120
Internet's down<font color="#E5E5E5"> the Internet's</font><font color="#CCCCCC"> down the</font>

684
00:27:25,320 --> 00:27:27,659
world's coming to<font color="#E5E5E5"> an end</font><font color="#CCCCCC"> what are we</font>

685
00:27:27,120 --> 00:27:32,219
gonna do

686
00:27:27,660 --> 00:27:34,140
<font color="#CCCCCC">it's DNS right</font><font color="#E5E5E5"> so what we do is we use a</font>

687
00:27:32,220 --> 00:27:35,670
variety<font color="#E5E5E5"> of different logging tools in</font>

688
00:27:34,140 --> 00:27:37,200
our case we use<font color="#CCCCCC"> grey log but there's a</font>

689
00:27:35,670 --> 00:27:39,360
good number<font color="#E5E5E5"> of them out there</font><font color="#CCCCCC"> that will</font>

690
00:27:37,200 --> 00:27:42,630
<font color="#E5E5E5">work just as well</font><font color="#CCCCCC"> how lovely is a</font>

691
00:27:39,360 --> 00:27:44,219
cloud-based service<font color="#CCCCCC"> bunk works well</font><font color="#E5E5E5"> kiwi</font>

692
00:27:42,630 --> 00:27:46,820
not so much<font color="#E5E5E5"> but that's a syslog server</font>

693
00:27:44,220 --> 00:27:49,410
<font color="#CCCCCC">which is great</font><font color="#E5E5E5"> for grabbing syslog data</font>

694
00:27:46,820 --> 00:27:53,040
but what we do<font color="#E5E5E5"> is we set up ways that we</font>

695
00:27:49,410 --> 00:27:55,140
can actually import<font color="#E5E5E5"> the data and see if</font>

696
00:27:53,040 --> 00:27:57,510
I can tell you what this this is here

697
00:27:55,140 --> 00:28:00,390
<font color="#E5E5E5">this is</font><font color="#CCCCCC"> actually one of our our ad</font>

698
00:27:57,510 --> 00:28:02,850
servers export logs<font color="#E5E5E5"> how many of you have</font>

699
00:28:00,390 --> 00:28:07,170
<font color="#E5E5E5">ever looked at Microsoft's</font><font color="#CCCCCC"> 80 DNS debug</font>

700
00:28:02,850 --> 00:28:10,469
logs<font color="#E5E5E5"> they're beautiful aren't they yeah</font>

701
00:28:07,170 --> 00:28:13,470
they're terrible so what we did is

702
00:28:10,470 --> 00:28:17,309
there's some tricks you<font color="#CCCCCC"> can</font><font color="#E5E5E5"> do in</font>

703
00:28:13,470 --> 00:28:19,770
PowerShell you can tell the 80 DNS

704
00:28:17,309 --> 00:28:22,260
server to<font color="#E5E5E5"> rotate the logs then we use</font>

705
00:28:19,770 --> 00:28:24,900
something called<font color="#E5E5E5"> NX log to ship those</font>

706
00:28:22,260 --> 00:28:27,330
logs to a<font color="#CCCCCC"> gray log</font><font color="#E5E5E5"> server and then we</font>

707
00:28:24,900 --> 00:28:29,280
wrote a custom<font color="#E5E5E5"> Java input for those to</font>

708
00:28:27,330 --> 00:28:31,470
<font color="#E5E5E5">break up I don't know if you can see on</font>

709
00:28:29,280 --> 00:28:33,270
here the fields<font color="#E5E5E5"> all the field names are</font>

710
00:28:31,470 --> 00:28:35,490
over here<font color="#E5E5E5"> on the side</font><font color="#CCCCCC"> but these</font>

711
00:28:33,270 --> 00:28:37,679
correspond to all the data that's<font color="#E5E5E5"> in the</font>

712
00:28:35,490 --> 00:28:39,390
Microsoft debug logs<font color="#E5E5E5"> so we can actually</font>

713
00:28:37,679 --> 00:28:41,850
go back<font color="#CCCCCC"> and</font><font color="#E5E5E5"> look on our network and we</font>

714
00:28:39,390 --> 00:28:43,260
can<font color="#E5E5E5"> look at things like how many action</font>

715
00:28:41,850 --> 00:28:45,689
domains are we getting how many<font color="#E5E5E5"> failed</font>

716
00:28:43,260 --> 00:28:47,520
domain lookups<font color="#E5E5E5"> do we see any domains</font>

717
00:28:45,690 --> 00:28:49,350
that<font color="#E5E5E5"> are being looked up an inordinate</font>

718
00:28:47,520 --> 00:28:52,520
number of times those sorts of things

719
00:28:49,350 --> 00:28:55,860
are able<font color="#CCCCCC"> to</font><font color="#E5E5E5"> be seen through these logs</font>

720
00:28:52,520 --> 00:28:57,389
so what kinds of<font color="#CCCCCC"> things do we</font><font color="#E5E5E5"> log we log</font>

721
00:28:55,860 --> 00:29:00,240
all<font color="#E5E5E5"> of our internal cache servers or</font>

722
00:28:57,390 --> 00:29:05,580
<font color="#E5E5E5">unbound servers you can what</font><font color="#CCCCCC"> we use for</font>

723
00:29:00,240 --> 00:29:07,470
<font color="#CCCCCC">that is packet beat</font><font color="#E5E5E5"> so there's elastic</font>

724
00:29:05,580 --> 00:29:09,899
<font color="#CCCCCC">search has a thing called</font><font color="#E5E5E5"> beats and</font>

725
00:29:07,470 --> 00:29:11,580
there's a<font color="#E5E5E5"> bunch of different types of</font>

726
00:29:09,900 --> 00:29:13,170
input outputs<font color="#E5E5E5"> that</font><font color="#CCCCCC"> you can use to</font>

727
00:29:11,580 --> 00:29:15,629
basically<font color="#CCCCCC"> log</font><font color="#E5E5E5"> shippers</font>

728
00:29:13,170 --> 00:29:18,510
and packet beats is one that you<font color="#E5E5E5"> can set</font>

729
00:29:15,630 --> 00:29:20,970
up<font color="#E5E5E5"> the ship DNS data off of</font><font color="#CCCCCC"> a server</font>

730
00:29:18,510 --> 00:29:24,150
<font color="#E5E5E5">directly to some remote source</font><font color="#CCCCCC"> they're</font>

731
00:29:20,970 --> 00:29:25,740
basically log routers and you<font color="#E5E5E5"> enable</font>

732
00:29:24,150 --> 00:29:28,740
this input<font color="#E5E5E5"> on</font><font color="#CCCCCC"> gray log which has a</font><font color="#E5E5E5"> built</font>

733
00:29:25,740 --> 00:29:30,540
<font color="#E5E5E5">in in gesture for the packet</font><font color="#CCCCCC"> feed data</font>

734
00:29:28,740 --> 00:29:32,370
<font color="#E5E5E5">and you can actually see the data in</font>

735
00:29:30,540 --> 00:29:34,379
<font color="#E5E5E5">gray log see what's happening on</font><font color="#CCCCCC"> your</font>

736
00:29:32,370 --> 00:29:36,989
servers the cool thing<font color="#CCCCCC"> about it is</font><font color="#E5E5E5"> you</font>

737
00:29:34,380 --> 00:29:39,860
<font color="#E5E5E5">can set alerts</font><font color="#CCCCCC"> gray log has some</font><font color="#E5E5E5"> things</font>

738
00:29:36,990 --> 00:29:42,090
where you can import different<font color="#E5E5E5"> kinds of</font>

739
00:29:39,860 --> 00:29:43,709
reputation<font color="#CCCCCC"> lists so you can see if</font>

740
00:29:42,090 --> 00:29:45,780
certain IPAs are being hit certain

741
00:29:43,710 --> 00:29:50,130
domain names that sort of thing<font color="#E5E5E5"> and set</font>

742
00:29:45,780 --> 00:29:53,580
alerts on them<font color="#E5E5E5"> also what we monitor our</font>

743
00:29:50,130 --> 00:29:55,680
changes to<font color="#E5E5E5"> DNS zones right how many</font>

744
00:29:53,580 --> 00:30:00,689
<font color="#CCCCCC">people monitor those changes on your DNS</font>

745
00:29:55,680 --> 00:30:01,860
servers on<font color="#E5E5E5"> your primary zones right how</font>

746
00:30:00,690 --> 00:30:03,660
do you<font color="#E5E5E5"> know if somebody's gone in and</font>

747
00:30:01,860 --> 00:30:05,399
made a<font color="#CCCCCC"> change to that zone reloaded in</font>

748
00:30:03,660 --> 00:30:07,770
DNS how do you know your DNS is serving

749
00:30:05,400 --> 00:30:09,510
up what it's supposed<font color="#E5E5E5"> to serve up if you</font>

750
00:30:07,770 --> 00:30:11,820
don't log these changes there's no way

751
00:30:09,510 --> 00:30:14,370
to really tell<font color="#E5E5E5"> what's</font><font color="#CCCCCC"> happening we also</font>

752
00:30:11,820 --> 00:30:16,879
<font color="#E5E5E5">log device login attempts on Cisco</font>

753
00:30:14,370 --> 00:30:19,409
devices<font color="#E5E5E5"> some other things we also do</font>

754
00:30:16,880 --> 00:30:21,660
<font color="#E5E5E5">failed</font><font color="#CCCCCC"> ad</font><font color="#E5E5E5"> login attempts and this is</font>

755
00:30:19,410 --> 00:30:23,220
kind<font color="#CCCCCC"> of an aside but</font><font color="#E5E5E5"> I was talking</font><font color="#CCCCCC"> to</font>

756
00:30:21,660 --> 00:30:24,870
Dave Kennedy<font color="#E5E5E5"> about this one day and he</font>

757
00:30:23,220 --> 00:30:26,640
said one<font color="#CCCCCC"> of the best things</font><font color="#E5E5E5"> you can do</font>

758
00:30:24,870 --> 00:30:28,350
in your Active Directory<font color="#CCCCCC"> you go and</font>

759
00:30:26,640 --> 00:30:30,960
<font color="#E5E5E5">create a domain admin account on your</font>

760
00:30:28,350 --> 00:30:32,760
Active Directory server give it a hunk

761
00:30:30,960 --> 00:30:35,190
and<font color="#E5E5E5"> long password and promptly forget</font>

762
00:30:32,760 --> 00:30:37,740
<font color="#E5E5E5">the</font><font color="#CCCCCC"> password never</font><font color="#E5E5E5"> log into that machine</font>

763
00:30:35,190 --> 00:30:39,600
or any<font color="#CCCCCC"> machine with that</font><font color="#E5E5E5"> account go to</font>

764
00:30:37,740 --> 00:30:43,830
<font color="#E5E5E5">your ad controllers and the</font><font color="#CCCCCC"> event log</font>

765
00:30:39,600 --> 00:30:45,179
<font color="#E5E5E5">your failed logins there's a specific ID</font>

766
00:30:43,830 --> 00:30:47,490
that<font color="#CCCCCC"> you can look in and</font><font color="#E5E5E5"> look</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> that</font>

767
00:30:45,180 --> 00:30:49,020
<font color="#E5E5E5">domain look for</font><font color="#CCCCCC"> that username</font><font color="#E5E5E5"> if you see</font>

768
00:30:47,490 --> 00:30:52,740
that<font color="#CCCCCC"> username pop</font><font color="#E5E5E5"> up in a log that</font>

769
00:30:49,020 --> 00:30:53,910
<font color="#CCCCCC">failed</font><font color="#E5E5E5"> you've got trouble</font><font color="#CCCCCC"> alright but</font>

770
00:30:52,740 --> 00:30:55,470
<font color="#E5E5E5">that's just a quick</font><font color="#CCCCCC"> way that you can</font>

771
00:30:53,910 --> 00:30:56,760
<font color="#E5E5E5">actually secure an ad server to make</font>

772
00:30:55,470 --> 00:30:59,010
sure that<font color="#E5E5E5"> you can see if somebody's</font>

773
00:30:56,760 --> 00:31:04,080
trying<font color="#CCCCCC"> root force attempts to get into</font>

774
00:30:59,010 --> 00:31:07,170
your network so how do we ship logs<font color="#E5E5E5"> our</font>

775
00:31:04,080 --> 00:31:08,370
logs are shipped we use an<font color="#E5E5E5"> X log and we</font>

776
00:31:07,170 --> 00:31:10,580
use packet<font color="#CCCCCC"> beats but these are some</font>

777
00:31:08,370 --> 00:31:15,270
<font color="#E5E5E5">other log shippers that you could use to</font>

778
00:31:10,580 --> 00:31:17,669
<font color="#CCCCCC">ship data this is an example</font><font color="#E5E5E5"> of how we</font>

779
00:31:15,270 --> 00:31:19,830
analyze some of<font color="#E5E5E5"> our logs</font><font color="#CCCCCC"> remember I was</font>

780
00:31:17,670 --> 00:31:21,270
telling<font color="#E5E5E5"> you about the different error</font>

781
00:31:19,830 --> 00:31:23,490
codes that you<font color="#CCCCCC"> can get</font><font color="#E5E5E5"> out of Microsoft</font>

782
00:31:21,270 --> 00:31:26,310
debug logs<font color="#CCCCCC"> so you can see them all up</font>

783
00:31:23,490 --> 00:31:27,180
here<font color="#E5E5E5"> there's some useful information</font>

784
00:31:26,310 --> 00:31:28,740
<font color="#CCCCCC">there</font><font color="#E5E5E5"> you can see</font>

785
00:31:27,180 --> 00:31:30,570
what<font color="#CCCCCC"> annex domains are happening what</font>

786
00:31:28,740 --> 00:31:32,630
kinds of<font color="#E5E5E5"> servers are failing on the</font>

787
00:31:30,570 --> 00:31:35,939
other end<font color="#CCCCCC"> all</font><font color="#E5E5E5"> of that sort of thing</font>

788
00:31:32,630 --> 00:31:37,770
<font color="#E5E5E5">gray logs pretty quick</font><font color="#CCCCCC"> it analyzing this</font>

789
00:31:35,940 --> 00:31:39,690
<font color="#E5E5E5">stuff and you want to see a demo I could</font>

790
00:31:37,770 --> 00:31:41,850
show<font color="#E5E5E5"> you a whole bunch of information</font>

791
00:31:39,690 --> 00:31:44,400
<font color="#E5E5E5">I'll let you see how we work with</font><font color="#CCCCCC"> our</font>

792
00:31:41,850 --> 00:31:46,649
<font color="#E5E5E5">stuff internally I can't show you</font><font color="#CCCCCC"> that</font>

793
00:31:44,400 --> 00:31:49,050
here<font color="#CCCCCC"> in</font><font color="#E5E5E5"> public but I can show it to you</font>

794
00:31:46,650 --> 00:31:50,880
privately<font color="#E5E5E5"> this is just a heat map that</font>

795
00:31:49,050 --> 00:31:52,649
shows you<font color="#E5E5E5"> where DNS queries are</font>

796
00:31:50,880 --> 00:31:57,150
originating around the globe<font color="#E5E5E5"> or one of</font>

797
00:31:52,650 --> 00:31:58,440
our services<font color="#CCCCCC"> and our one of the last</font>

798
00:31:57,150 --> 00:32:00,420
things that<font color="#E5E5E5"> we have to learn how</font><font color="#CCCCCC"> to do</font>

799
00:31:58,440 --> 00:32:03,720
to be able<font color="#E5E5E5"> to monitor DNS is learn how</font>

800
00:32:00,420 --> 00:32:06,000
<font color="#E5E5E5">to read packet captures so when you're</font>

801
00:32:03,720 --> 00:32:06,900
capturing packets you can<font color="#E5E5E5"> use TCP dump</font>

802
00:32:06,000 --> 00:32:08,700
or Wireshark

803
00:32:06,900 --> 00:32:11,970
<font color="#CCCCCC">I would</font><font color="#E5E5E5"> definitely recommend you use an</font>

804
00:32:08,700 --> 00:32:13,560
input filter<font color="#E5E5E5"> for TCP dump or Wireshark</font>

805
00:32:11,970 --> 00:32:16,110
so you're not<font color="#CCCCCC"> capturing all the traffic</font>

806
00:32:13,560 --> 00:32:18,480
on given machine<font color="#E5E5E5"> but in this case what</font>

807
00:32:16,110 --> 00:32:19,590
this<font color="#E5E5E5"> shows</font><font color="#CCCCCC"> here this is a little bit</font>

808
00:32:18,480 --> 00:32:22,950
interesting<font color="#CCCCCC"> you probably didn't know</font>

809
00:32:19,590 --> 00:32:25,830
this<font color="#E5E5E5"> was happening but this is a Google</font>

810
00:32:22,950 --> 00:32:29,100
a query from<font color="#E5E5E5"> a DNS server to Google</font>

811
00:32:25,830 --> 00:32:32,310
looking up Google<font color="#E5E5E5"> comm are you say</font>

812
00:32:29,100 --> 00:32:35,040
<font color="#E5E5E5">anything weird in this DNS packet this</font>

813
00:32:32,310 --> 00:32:38,040
section<font color="#E5E5E5"> right here this is in the e DNS</font>

814
00:32:35,040 --> 00:32:41,149
zero options this<font color="#CCCCCC"> is option eight it's</font>

815
00:32:38,040 --> 00:32:43,830
called client subnet and right here is

816
00:32:41,150 --> 00:32:46,320
the way an IP address<font color="#CCCCCC"> the</font><font color="#E5E5E5"> person making</font>

817
00:32:43,830 --> 00:32:48,870
the<font color="#E5E5E5"> request so you can be in a network</font>

818
00:32:46,320 --> 00:32:51,389
<font color="#E5E5E5">thinking you're completely hidden</font><font color="#CCCCCC"> from</font>

819
00:32:48,870 --> 00:32:53,879
the<font color="#E5E5E5"> world and your DNS server upstream</font>

820
00:32:51,390 --> 00:32:56,400
supports e DNS<font color="#CCCCCC"> client subnet</font><font color="#E5E5E5"> and the IP</font>

821
00:32:53,880 --> 00:32:57,930
address of your LAN port is passed<font color="#E5E5E5"> every</font>

822
00:32:56,400 --> 00:32:59,310
DNS server in the query chain so<font color="#E5E5E5"> you</font>

823
00:32:57,930 --> 00:33:01,350
have to kind of<font color="#E5E5E5"> know what's going on in</font>

824
00:32:59,310 --> 00:33:03,750
your<font color="#E5E5E5"> DNS</font><font color="#CCCCCC"> the point of this is that you</font>

825
00:33:01,350 --> 00:33:05,790
<font color="#CCCCCC">have to examine</font><font color="#E5E5E5"> packet captures to be</font>

826
00:33:03,750 --> 00:33:09,780
able<font color="#CCCCCC"> to</font><font color="#E5E5E5"> see what's</font><font color="#CCCCCC"> going</font><font color="#E5E5E5"> on in in your</font>

827
00:33:05,790 --> 00:33:12,659
network<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is a list</font><font color="#E5E5E5"> of which the</font>

828
00:33:09,780 --> 00:33:14,790
tools that we use<font color="#CCCCCC"> again I</font><font color="#E5E5E5"> just put this</font>

829
00:33:12,660 --> 00:33:17,040
on a slide<font color="#E5E5E5"> here</font><font color="#CCCCCC"> so you can see what they</font>

830
00:33:14,790 --> 00:33:19,980
are<font color="#E5E5E5"> one</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the best places</font><font color="#CCCCCC"> to go to look</font>

831
00:33:17,040 --> 00:33:22,920
<font color="#E5E5E5">up for DNS amplification attacks is this</font>

832
00:33:19,980 --> 00:33:24,480
link over<font color="#CCCCCC"> here</font><font color="#E5E5E5"> this honeypot site he</font>

833
00:33:22,920 --> 00:33:26,700
does a<font color="#CCCCCC"> pretty good</font><font color="#E5E5E5"> job</font><font color="#CCCCCC"> of catching</font><font color="#E5E5E5"> them</font>

834
00:33:24,480 --> 00:33:28,440
<font color="#E5E5E5">we</font><font color="#CCCCCC"> actually report</font><font color="#E5E5E5"> to him sometimes we</font>

835
00:33:26,700 --> 00:33:30,030
catch<font color="#E5E5E5"> them before he does but it's a</font>

836
00:33:28,440 --> 00:33:32,100
good list of<font color="#E5E5E5"> what domains you should</font>

837
00:33:30,030 --> 00:33:35,580
<font color="#E5E5E5">never see in your DNS or you should be</font>

838
00:33:32,100 --> 00:33:38,230
<font color="#E5E5E5">blocking and with that I think</font><font color="#CCCCCC"> my time</font>

839
00:33:35,580 --> 00:33:39,939
<font color="#CCCCCC">is probably up five</font><font color="#E5E5E5"> minutes early but</font>

840
00:33:38,230 --> 00:33:42,369
if you have any questions feel free to

841
00:33:39,940 --> 00:33:45,369
ask<font color="#CCCCCC"> I will be</font><font color="#E5E5E5"> around I'm happy to talk</font>

842
00:33:42,369 --> 00:33:47,769
<font color="#E5E5E5">about D&S show you any demos I can</font>

843
00:33:45,369 --> 00:33:50,609
answer any<font color="#E5E5E5"> questions you know that was a</font>

844
00:33:47,769 --> 00:33:54,129
lot of<font color="#E5E5E5"> information</font><font color="#CCCCCC"> but if you have any</font>

845
00:33:50,609 --> 00:33:57,029
questions<font color="#E5E5E5"> sure I'm gonna get away from</font>

846
00:33:54,129 --> 00:33:57,029
<font color="#CCCCCC">get away from</font><font color="#E5E5E5"> the light</font>

847
00:33:58,950 --> 00:34:03,940
man I either did a<font color="#E5E5E5"> really terrible</font><font color="#CCCCCC"> job</font>

848
00:34:01,359 --> 00:34:06,820
<font color="#E5E5E5">and put you to sleep or you all got</font>

849
00:34:03,940 --> 00:34:08,449
everything down<font color="#E5E5E5"> good deal well thanks</font>

850
00:34:06,820 --> 00:34:12,199
for<font color="#E5E5E5"> attending</font>

851
00:34:08,449 --> 00:34:12,199
[Applause]

