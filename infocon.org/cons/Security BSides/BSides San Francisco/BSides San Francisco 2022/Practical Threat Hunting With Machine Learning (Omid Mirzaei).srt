1
00:00:00,000 --> 00:00:04,480
our next speaker will be ahmed mirzay

2
00:00:06,480 --> 00:00:07,520
ahmed

3
00:00:07,520 --> 00:00:08,480
is a

4
00:00:08,480 --> 00:00:10,880
senior security data scientist

5
00:00:10,880 --> 00:00:14,080
on protection teams at elastic

6
00:00:14,080 --> 00:00:15,440
and

7
00:00:15,440 --> 00:00:18,880
today he is going to talk us about

8
00:00:18,880 --> 00:00:20,800
practical threat hunting with machine

9
00:00:20,800 --> 00:00:24,640
learning take it away thank you

10
00:00:25,920 --> 00:00:27,599
uh hello everyone

11
00:00:27,599 --> 00:00:29,199
uh

12
00:00:29,199 --> 00:00:31,359
i'm very glad we're back to in person

13
00:00:31,359 --> 00:00:34,399
events gradually uh

14
00:00:34,399 --> 00:00:36,880
i usually love to have eye contact with

15
00:00:36,880 --> 00:00:39,200
the audience but i can't see you very

16
00:00:39,200 --> 00:00:40,079
well

17
00:00:40,079 --> 00:00:42,879
but that's fine

18
00:00:43,680 --> 00:00:44,640
yeah

19
00:00:44,640 --> 00:00:47,360
so uh i thought now that we are in an

20
00:00:47,360 --> 00:00:50,879
amc theater uh having this thing maybe a

21
00:00:50,879 --> 00:00:52,399
good idea

22
00:00:52,399 --> 00:00:53,360
uh

23
00:00:53,360 --> 00:00:56,160
so this talk was uh initially planned to

24
00:00:56,160 --> 00:00:58,800
be given by my colleague craig but

25
00:00:58,800 --> 00:01:00,320
unfortunately he couldn't make it for

26
00:01:00,320 --> 00:01:02,800
personal reasons

27
00:01:02,800 --> 00:01:04,400
that's why i'm here

28
00:01:04,400 --> 00:01:06,159
very glad

29
00:01:06,159 --> 00:01:08,400
craig has been active in cyber security

30
00:01:08,400 --> 00:01:10,799
for several years

31
00:01:10,799 --> 00:01:12,799
especially in threat hunting

32
00:01:12,799 --> 00:01:15,040
he's been the chief security architect

33
00:01:15,040 --> 00:01:16,320
and a principal

34
00:01:16,320 --> 00:01:19,439
at several security uh startups

35
00:01:19,439 --> 00:01:22,080
uh myself i've been active

36
00:01:22,080 --> 00:01:24,080
in cyber security for more than a decade

37
00:01:24,080 --> 00:01:27,200
most recently in android security

38
00:01:27,200 --> 00:01:29,119
mobile and desktop malware analysis

39
00:01:29,119 --> 00:01:30,640
reverse engineering

40
00:01:30,640 --> 00:01:34,240
and applied machine learning in security

41
00:01:34,240 --> 00:01:35,520
so

42
00:01:35,520 --> 00:01:37,680
today i'm going to be talking about

43
00:01:37,680 --> 00:01:39,119
practical

44
00:01:39,119 --> 00:01:42,079
threat hunting with machine learning

45
00:01:42,079 --> 00:01:44,798
hope you enjoy

46
00:01:45,439 --> 00:01:47,520
so

47
00:01:47,520 --> 00:01:49,040
right off the bat

48
00:01:49,040 --> 00:01:50,880
why should we use machine learning for

49
00:01:50,880 --> 00:01:52,320
threat hunting right this is the

50
00:01:52,320 --> 00:01:54,640
question that we may ask ourselves in

51
00:01:54,640 --> 00:01:56,880
many application

52
00:01:56,880 --> 00:01:58,399
contexts that we want to apply machine

53
00:01:58,399 --> 00:02:00,719
learning to these days

54
00:02:00,719 --> 00:02:02,479
you may say i'm not going to apply

55
00:02:02,479 --> 00:02:04,399
machine learning

56
00:02:04,399 --> 00:02:07,280
to to hand threads and i don't have any

57
00:02:07,280 --> 00:02:09,360
plans to do it in the near future

58
00:02:09,360 --> 00:02:11,920
in that case uh i want to correct myself

59
00:02:11,920 --> 00:02:13,599
why should i use

60
00:02:13,599 --> 00:02:15,040
machine learning for

61
00:02:15,040 --> 00:02:16,640
threat hunting right

62
00:02:16,640 --> 00:02:19,440
so uh i personally i'm opposed to

63
00:02:19,440 --> 00:02:20,800
applying machine learning to any

64
00:02:20,800 --> 00:02:24,480
application context blindly

65
00:02:24,640 --> 00:02:27,840
however it's a a really good tool it's

66
00:02:27,840 --> 00:02:29,599
an additional tool that we have in our

67
00:02:29,599 --> 00:02:31,599
toolbox for solving problems it's a

68
00:02:31,599 --> 00:02:34,640
valuable tool an additional tool for

69
00:02:34,640 --> 00:02:36,959
you know finding threats

70
00:02:36,959 --> 00:02:40,080
where conventional methods uh cannot do

71
00:02:40,080 --> 00:02:41,760
well

72
00:02:41,760 --> 00:02:44,319
it's also very good at automating and

73
00:02:44,319 --> 00:02:45,440
scaling

74
00:02:45,440 --> 00:02:46,560
existing

75
00:02:46,560 --> 00:02:50,280
threat hunting techniques

76
00:02:51,040 --> 00:02:52,239
so

77
00:02:52,239 --> 00:02:54,560
the two questions that are often being

78
00:02:54,560 --> 00:02:55,440
asked

79
00:02:55,440 --> 00:02:58,480
uh in threat hunting are one how are we

80
00:02:58,480 --> 00:03:01,440
gonna make sure uh we don't you know tr

81
00:03:01,440 --> 00:03:03,920
uh trade alert fatigue for anomaly

82
00:03:03,920 --> 00:03:05,599
fatigue because these two are kind of

83
00:03:05,599 --> 00:03:07,200
interrelated

84
00:03:07,200 --> 00:03:09,920
and the other one is how is this new

85
00:03:09,920 --> 00:03:11,519
approach based on machine learning

86
00:03:11,519 --> 00:03:13,440
different from things like stack ranking

87
00:03:13,440 --> 00:03:15,920
or outlier detection running really

88
00:03:15,920 --> 00:03:17,280
large queries

89
00:03:17,280 --> 00:03:18,800
right

90
00:03:18,800 --> 00:03:20,720
so uh

91
00:03:20,720 --> 00:03:23,519
these are the two things that uh

92
00:03:23,519 --> 00:03:26,480
they are often being asked

93
00:03:26,480 --> 00:03:28,319
we do have machine learning jobs at

94
00:03:28,319 --> 00:03:31,200
elastic that are running continuously in

95
00:03:31,200 --> 00:03:33,680
what we call a bucket intervals which

96
00:03:33,680 --> 00:03:36,159
are literally literally time intervals

97
00:03:36,159 --> 00:03:39,599
sometimes you know 15 minutes uh or 60

98
00:03:39,599 --> 00:03:41,280
minutes depending on which one gives us

99
00:03:41,280 --> 00:03:43,200
the best results

100
00:03:43,200 --> 00:03:44,319
uh

101
00:03:44,319 --> 00:03:46,720
and then uh

102
00:03:46,720 --> 00:03:49,920
with respect to or in terms of uh

103
00:03:49,920 --> 00:03:51,920
what do we do to make sure we don't get

104
00:03:51,920 --> 00:03:53,760
too much output

105
00:03:53,760 --> 00:03:55,920
right uh

106
00:03:55,920 --> 00:03:57,040
so

107
00:03:57,040 --> 00:04:00,439
excuse me

108
00:04:02,720 --> 00:04:04,879
uh

109
00:04:04,879 --> 00:04:07,360
we've done a lot of work uh at elastic

110
00:04:07,360 --> 00:04:10,480
on that uh so we have something called

111
00:04:10,480 --> 00:04:11,280
uh

112
00:04:11,280 --> 00:04:14,640
data feeds which are literally uh you

113
00:04:14,640 --> 00:04:16,720
know the other feed queries we call them

114
00:04:16,720 --> 00:04:17,759
elastic

115
00:04:17,759 --> 00:04:19,918
search queries uh

116
00:04:19,918 --> 00:04:22,960
uh at in there they're basically input

117
00:04:22,960 --> 00:04:26,080
the models these elastic search queries

118
00:04:26,080 --> 00:04:29,520
we we measure uh you know

119
00:04:29,520 --> 00:04:32,320
signal to noise ratio and then we put

120
00:04:32,320 --> 00:04:34,560
exceptions on those alerts and then we

121
00:04:34,560 --> 00:04:38,080
try to exclude those uh before you know

122
00:04:38,080 --> 00:04:39,759
inputting those queries

123
00:04:39,759 --> 00:04:41,280
to the models

124
00:04:41,280 --> 00:04:45,040
so kind of you know pre-filtering

125
00:04:45,040 --> 00:04:47,600
uh so this is the way we do it

126
00:04:47,600 --> 00:04:48,639
uh

127
00:04:48,639 --> 00:04:50,560
the other thing we do is some sort of

128
00:04:50,560 --> 00:04:53,600
multivariate correlation so

129
00:04:53,600 --> 00:04:55,360
uh we are

130
00:04:55,360 --> 00:04:57,280
joining machine learning alerts at

131
00:04:57,280 --> 00:04:59,919
elastic with other types of alerts uh we

132
00:04:59,919 --> 00:05:03,840
get uh for example uh malware detection

133
00:05:03,840 --> 00:05:07,440
alerts or you know uh conventional uh

134
00:05:07,440 --> 00:05:09,759
alerts search or query based alerts

135
00:05:09,759 --> 00:05:12,240
behavioral alerts we're merging all that

136
00:05:12,240 --> 00:05:14,800
together and one thing we have found is

137
00:05:14,800 --> 00:05:17,120
that when two or more of these detection

138
00:05:17,120 --> 00:05:19,520
pipelines agree that something is

139
00:05:19,520 --> 00:05:22,720
malicious or suspicious then confidence

140
00:05:22,720 --> 00:05:24,960
tends to go way up

141
00:05:24,960 --> 00:05:26,320
and uh

142
00:05:26,320 --> 00:05:28,400
another thing that we have done recently

143
00:05:28,400 --> 00:05:31,120
is clustering alerts based on risk score

144
00:05:31,120 --> 00:05:32,960
host and user risk score and this is

145
00:05:32,960 --> 00:05:35,280
something that we are still working on

146
00:05:35,280 --> 00:05:39,120
and then there is a blog post uh

147
00:05:39,120 --> 00:05:42,080
that is really great explains how we're

148
00:05:42,080 --> 00:05:44,560
doing this stuff at elastic and it

149
00:05:44,560 --> 00:05:46,479
basically walks you through some of the

150
00:05:46,479 --> 00:05:48,479
functions i really recommend looking at

151
00:05:48,479 --> 00:05:52,639
this you know uh blog post

152
00:05:52,720 --> 00:05:56,479
so this is a summary of uh what we do

153
00:05:56,479 --> 00:05:58,880
in terms of you know

154
00:05:58,880 --> 00:06:02,560
machine learning based anomaly detection

155
00:06:02,560 --> 00:06:04,440
and

156
00:06:04,440 --> 00:06:06,400
then uh

157
00:06:06,400 --> 00:06:08,560
after this summary uh let's dive right

158
00:06:08,560 --> 00:06:12,160
into some uh examples uh some uh case

159
00:06:12,160 --> 00:06:13,199
studies

160
00:06:13,199 --> 00:06:15,600
uh that can be divided into three main

161
00:06:15,600 --> 00:06:18,080
categories those uh

162
00:06:18,080 --> 00:06:21,520
uh that are using endpoint data uh those

163
00:06:21,520 --> 00:06:23,840
that are using network data and then

164
00:06:23,840 --> 00:06:26,960
those that are using uh cloud api audit

165
00:06:26,960 --> 00:06:28,639
logs

166
00:06:28,639 --> 00:06:31,280
so let's start with this uh cases

167
00:06:31,280 --> 00:06:33,360
studies that are using

168
00:06:33,360 --> 00:06:36,240
endpoint data

169
00:06:36,639 --> 00:06:39,120
these are some of the jobs that we have

170
00:06:39,120 --> 00:06:40,639
at elastic

171
00:06:40,639 --> 00:06:42,960
that are using endpoint data

172
00:06:42,960 --> 00:06:45,759
so we have something around 64 different

173
00:06:45,759 --> 00:06:49,120
machine learning jobs uh that are

174
00:06:49,120 --> 00:06:51,039
you know using a

175
00:06:51,039 --> 00:06:53,599
endpoint data running

176
00:06:53,599 --> 00:06:57,120
process uh from the endpoints

177
00:06:57,120 --> 00:06:58,880
those properties for example we are

178
00:06:58,880 --> 00:07:02,240
looking for rare processes uh rare path

179
00:07:02,240 --> 00:07:04,720
process creation like you know

180
00:07:04,720 --> 00:07:06,880
parent-child relationships

181
00:07:06,880 --> 00:07:09,759
uh and then uh

182
00:07:09,759 --> 00:07:11,520
we have another job which is pretty good

183
00:07:11,520 --> 00:07:13,199
at finding uh

184
00:07:13,199 --> 00:07:15,840
uh you know obfuscated powershell script

185
00:07:15,840 --> 00:07:18,560
block content

186
00:07:19,199 --> 00:07:20,720
so

187
00:07:20,720 --> 00:07:23,520
the point is that rare processes are not

188
00:07:23,520 --> 00:07:26,560
always uh anomalies right

189
00:07:26,560 --> 00:07:27,440
uh

190
00:07:27,440 --> 00:07:30,400
so we not only should be looking for

191
00:07:30,400 --> 00:07:31,680
processes

192
00:07:31,680 --> 00:07:33,039
i'm really hot

193
00:07:33,039 --> 00:07:35,039
uh i don't know

194
00:07:35,039 --> 00:07:38,319
uh it's okay uh we not only should be

195
00:07:38,319 --> 00:07:40,960
looking for processes in a single host

196
00:07:40,960 --> 00:07:44,000
but across the entire host population

197
00:07:44,000 --> 00:07:47,520
right so that's why we have a separate

198
00:07:47,520 --> 00:07:48,800
uh

199
00:07:48,800 --> 00:07:50,879
job looking for rare processes in a

200
00:07:50,879 --> 00:07:53,759
single host and then another job looking

201
00:07:53,759 --> 00:07:55,840
for rare processes across the entire

202
00:07:55,840 --> 00:07:58,639
host fleet or host population

203
00:07:58,639 --> 00:08:02,080
uh right so uh

204
00:08:02,080 --> 00:08:04,319
you may say uh

205
00:08:04,319 --> 00:08:06,400
we have some you know application types

206
00:08:06,400 --> 00:08:09,440
out there that manifest rare processes

207
00:08:09,440 --> 00:08:12,720
occasionally uh for example

208
00:08:12,720 --> 00:08:15,199
finance applications they run processes

209
00:08:15,199 --> 00:08:17,599
that manifest once per month or once per

210
00:08:17,599 --> 00:08:20,159
quarter

211
00:08:20,720 --> 00:08:21,759
so

212
00:08:21,759 --> 00:08:24,160
if you find a rare process in something

213
00:08:24,160 --> 00:08:27,039
like a finance server that could be sort

214
00:08:27,039 --> 00:08:30,240
of uninteresting however if you find a

215
00:08:30,240 --> 00:08:32,399
rare process in something like a domain

216
00:08:32,399 --> 00:08:34,159
controller or

217
00:08:34,159 --> 00:08:37,440
ada dns server or exchange server

218
00:08:37,440 --> 00:08:39,679
you know at least the plain vanilla

219
00:08:39,679 --> 00:08:41,519
versions of those tend to have less

220
00:08:41,519 --> 00:08:43,039
behavioral

221
00:08:43,039 --> 00:08:45,600
variance or spread so finding a rare

222
00:08:45,600 --> 00:08:47,920
process in those

223
00:08:47,920 --> 00:08:48,800
things

224
00:08:48,800 --> 00:08:50,720
could be more interesting and of a

225
00:08:50,720 --> 00:08:53,360
higher priority

226
00:08:53,360 --> 00:08:54,399
uh

227
00:08:54,399 --> 00:08:55,200
so

228
00:08:55,200 --> 00:08:58,000
the first case of study is this one uh

229
00:08:58,000 --> 00:09:00,240
we were working on our detection methods

230
00:09:00,240 --> 00:09:02,800
for a campaign called nobelium back in

231
00:09:02,800 --> 00:09:04,640
may 2021

232
00:09:04,640 --> 00:09:06,240
and this is a campaign that has been

233
00:09:06,240 --> 00:09:08,480
active for a while so

234
00:09:08,480 --> 00:09:10,640
we kicked off a high priority project to

235
00:09:10,640 --> 00:09:13,040
make sure we're actually able to you

236
00:09:13,040 --> 00:09:15,279
know detect this campaign and what we

237
00:09:15,279 --> 00:09:17,040
found was

238
00:09:17,040 --> 00:09:18,240
uh

239
00:09:18,240 --> 00:09:20,080
we were able to detect this campaign

240
00:09:20,080 --> 00:09:22,000
using some of the unsupervised machine

241
00:09:22,000 --> 00:09:24,320
learning jobs and alerts

242
00:09:24,320 --> 00:09:25,600
uh

243
00:09:25,600 --> 00:09:27,920
even without any prior knowledge about

244
00:09:27,920 --> 00:09:29,839
what the iocs uh

245
00:09:29,839 --> 00:09:31,600
look like or what the behaviors look

246
00:09:31,600 --> 00:09:33,360
like at that time

247
00:09:33,360 --> 00:09:34,720
so uh

248
00:09:34,720 --> 00:09:37,040
this is the first case study

249
00:09:37,040 --> 00:09:38,399
and then

250
00:09:38,399 --> 00:09:41,120
we got a couple of detection on this uh

251
00:09:41,120 --> 00:09:42,959
to the techno belly and we got a couple

252
00:09:42,959 --> 00:09:45,360
of detection it was not only one

253
00:09:45,360 --> 00:09:48,160
one was we had an activity from an

254
00:09:48,160 --> 00:09:51,279
unusual you know working directory

255
00:09:51,279 --> 00:09:53,680
and in you know well regulated

256
00:09:53,680 --> 00:09:55,760
environment or a windows environment for

257
00:09:55,760 --> 00:09:57,839
example with heavy security policies

258
00:09:57,839 --> 00:10:01,200
it's sometimes unusual for users to be

259
00:10:01,200 --> 00:10:03,440
you know running things uh from their

260
00:10:03,440 --> 00:10:05,760
profile directories

261
00:10:05,760 --> 00:10:09,200
so uh so we found uh

262
00:10:09,200 --> 00:10:11,120
one detection was related to this

263
00:10:11,120 --> 00:10:14,399
another job uh found a network activity

264
00:10:14,399 --> 00:10:16,720
from an unusual process name

265
00:10:16,720 --> 00:10:17,760
right

266
00:10:17,760 --> 00:10:19,760
which was calling over the net talking

267
00:10:19,760 --> 00:10:21,680
over the network so basically it was

268
00:10:21,680 --> 00:10:23,760
connected to the stock was talking uh on

269
00:10:23,760 --> 00:10:27,360
the network uh so that job this was the

270
00:10:27,360 --> 00:10:30,160
second detection that we got

271
00:10:30,160 --> 00:10:33,160
uh

272
00:10:35,040 --> 00:10:37,519
as far as other possibilities we found

273
00:10:37,519 --> 00:10:39,279
uh other things that were interesting

274
00:10:39,279 --> 00:10:42,000
for example we found a very you know

275
00:10:42,000 --> 00:10:45,279
strange uh dll name in the one of the

276
00:10:45,279 --> 00:10:47,680
samples when we detonated it

277
00:10:47,680 --> 00:10:48,480
uh

278
00:10:48,480 --> 00:10:50,000
and

279
00:10:50,000 --> 00:10:52,720
you know anomalous dll

280
00:10:52,720 --> 00:10:55,360
activity or dls name sometimes could be

281
00:10:55,360 --> 00:10:58,079
interesting and fruitful however uh you

282
00:10:58,079 --> 00:11:00,240
know it's gonna be a little bit more

283
00:11:00,240 --> 00:11:03,360
difficult because as you may know we

284
00:11:03,360 --> 00:11:06,000
have just a huge number of dll loads

285
00:11:06,000 --> 00:11:09,279
right uh so dll names uh

286
00:11:09,279 --> 00:11:10,880
they're gonna tend to have more

287
00:11:10,880 --> 00:11:13,279
cardinality more uniqueness you're going

288
00:11:13,279 --> 00:11:14,480
to see

289
00:11:14,480 --> 00:11:17,440
many you know dll names both in a single

290
00:11:17,440 --> 00:11:21,920
host and across the entire host fleet

291
00:11:21,920 --> 00:11:22,800
so

292
00:11:22,800 --> 00:11:24,320
you know dls

293
00:11:24,320 --> 00:11:26,800
activity is good but you got to find the

294
00:11:26,800 --> 00:11:29,440
anomalous dealer activities or rare dll

295
00:11:29,440 --> 00:11:30,640
activities

296
00:11:30,640 --> 00:11:32,880
so

297
00:11:32,959 --> 00:11:35,440
another thing that was interesting is

298
00:11:35,440 --> 00:11:38,000
beacon activity if you can find

299
00:11:38,000 --> 00:11:39,360
beaconing

300
00:11:39,360 --> 00:11:42,240
then you can possibly detect and block

301
00:11:42,240 --> 00:11:44,079
attacks at the very earliest stages and

302
00:11:44,079 --> 00:11:45,519
this is something that we're working on

303
00:11:45,519 --> 00:11:47,360
recently

304
00:11:47,360 --> 00:11:49,040
uh

305
00:11:49,040 --> 00:11:49,920
so

306
00:11:49,920 --> 00:11:52,399
this was the most notable example or

307
00:11:52,399 --> 00:11:54,320
cases study that

308
00:11:54,320 --> 00:11:57,920
we actually use endpoint data uh running

309
00:11:57,920 --> 00:12:00,079
process we use basically the properties

310
00:12:00,079 --> 00:12:01,279
of the running processes on the

311
00:12:01,279 --> 00:12:03,839
endpoints uh and then

312
00:12:03,839 --> 00:12:06,720
uh the second uh series of cases studies

313
00:12:06,720 --> 00:12:09,040
that i want to discuss are

314
00:12:09,040 --> 00:12:13,519
those that are using network data right

315
00:12:13,519 --> 00:12:15,360
so uh

316
00:12:15,360 --> 00:12:18,160
in the network realm as you can see you

317
00:12:18,160 --> 00:12:19,760
know one of the

318
00:12:19,760 --> 00:12:22,480
uh very worthy and interesting things

319
00:12:22,480 --> 00:12:24,959
that you can do is to plot it

320
00:12:24,959 --> 00:12:26,959
geographically right

321
00:12:26,959 --> 00:12:30,320
so you can do this you can digest the

322
00:12:30,320 --> 00:12:31,760
results in a

323
00:12:31,760 --> 00:12:33,680
relatively short time and it's a simple

324
00:12:33,680 --> 00:12:36,639
technique so i really recommend this

325
00:12:36,639 --> 00:12:38,639
plotted geographically

326
00:12:38,639 --> 00:12:40,320
uh

327
00:12:40,320 --> 00:12:42,959
and you know uh these jobs as you can

328
00:12:42,959 --> 00:12:43,839
see

329
00:12:43,839 --> 00:12:45,200
the jobs that we have machine

330
00:12:45,200 --> 00:12:47,040
learning-based jobs that are using

331
00:12:47,040 --> 00:12:49,680
network uh data they're looking for

332
00:12:49,680 --> 00:12:52,480
things like unusual destination country

333
00:12:52,480 --> 00:12:55,360
unusual spikes in you know network

334
00:12:55,360 --> 00:12:57,760
traffic and network denies

335
00:12:57,760 --> 00:13:00,240
and uh especially the first one is

336
00:13:00,240 --> 00:13:02,959
looking at unusual spikes in network

337
00:13:02,959 --> 00:13:04,880
traffic to a particular

338
00:13:04,880 --> 00:13:06,639
country

339
00:13:06,639 --> 00:13:08,480
so these are the things that

340
00:13:08,480 --> 00:13:10,000
part of the things that we are relying

341
00:13:10,000 --> 00:13:12,560
on that are using network data

342
00:13:12,560 --> 00:13:15,200
to detect threats

343
00:13:15,200 --> 00:13:17,839
uh let's have a look at the cases study

344
00:13:17,839 --> 00:13:18,800
here

345
00:13:18,800 --> 00:13:21,760
this is actually what you can see here

346
00:13:21,760 --> 00:13:24,079
is a couple of detections that that we

347
00:13:24,079 --> 00:13:26,959
got uh that were based on uh you know

348
00:13:26,959 --> 00:13:30,079
unusual spikes in traffic to a

349
00:13:30,079 --> 00:13:33,360
particular country destination country

350
00:13:33,360 --> 00:13:35,360
if you look at the typical column this

351
00:13:35,360 --> 00:13:38,079
is a column that actually shows what the

352
00:13:38,079 --> 00:13:41,279
typical you know uh network traffic

353
00:13:41,279 --> 00:13:43,360
should be the size in terms of so and

354
00:13:43,360 --> 00:13:45,279
what the actual should be and the

355
00:13:45,279 --> 00:13:47,839
description shows how far

356
00:13:47,839 --> 00:13:49,519
that actual was

357
00:13:49,519 --> 00:13:51,839
from the typical

358
00:13:51,839 --> 00:13:53,680
so

359
00:13:53,680 --> 00:13:55,839
what's great about our

360
00:13:55,839 --> 00:13:58,240
machine learning jobs overall is we're

361
00:13:58,240 --> 00:14:01,680
not giving any numbers to our jobs right

362
00:14:01,680 --> 00:14:04,160
so we're not for example saying uh show

363
00:14:04,160 --> 00:14:05,199
me

364
00:14:05,199 --> 00:14:08,000
or alert when for example the network

365
00:14:08,000 --> 00:14:11,279
volumes uh volume goes above 10 000

366
00:14:11,279 --> 00:14:13,360
flows per hour we're not giving any

367
00:14:13,360 --> 00:14:15,120
static number and everything is kind of

368
00:14:15,120 --> 00:14:16,800
dynamic

369
00:14:16,800 --> 00:14:19,120
so our machine learning jobs can find

370
00:14:19,120 --> 00:14:21,199
peaks and troughs that are not only

371
00:14:21,199 --> 00:14:23,360
peaks and troughs but those that are

372
00:14:23,360 --> 00:14:25,600
unusual for the

373
00:14:25,600 --> 00:14:28,240
network that the incident is you know

374
00:14:28,240 --> 00:14:30,480
actually taking place

375
00:14:30,480 --> 00:14:31,519
uh

376
00:14:31,519 --> 00:14:33,199
so

377
00:14:33,199 --> 00:14:35,600
these are uh the

378
00:14:35,600 --> 00:14:38,880
part of the things that we do uh and uh

379
00:14:38,880 --> 00:14:41,120
the this cases study

380
00:14:41,120 --> 00:14:44,320
uh we found these uh basically where we

381
00:14:44,320 --> 00:14:47,279
were better testing one of our network

382
00:14:47,279 --> 00:14:49,279
anomaly detection jobs

383
00:14:49,279 --> 00:14:51,519
and what we found was actually a malware

384
00:14:51,519 --> 00:14:54,079
instance that was getting stopped at the

385
00:14:54,079 --> 00:14:56,079
border firewall

386
00:14:56,079 --> 00:14:58,480
and it was trying to get out and connect

387
00:14:58,480 --> 00:15:01,279
to its c2 and as you can see the c2 was

388
00:15:01,279 --> 00:15:03,120
in a country that we didn't have a

389
00:15:03,120 --> 00:15:06,320
relationship with yeah and so uh it was

390
00:15:06,320 --> 00:15:08,240
a good catcher fine

391
00:15:08,240 --> 00:15:09,600
uh

392
00:15:09,600 --> 00:15:12,240
but you may criticize

393
00:15:12,240 --> 00:15:15,519
that you know a geographic detection

394
00:15:15,519 --> 00:15:18,240
relying on destination country is not a

395
00:15:18,240 --> 00:15:21,680
good way to detect threats and i agree

396
00:15:21,680 --> 00:15:24,000
uh because basically threat actors can

397
00:15:24,000 --> 00:15:27,600
evade you know very easily by just not

398
00:15:27,600 --> 00:15:29,600
being a geographic anomaly

399
00:15:29,600 --> 00:15:32,800
in other words uh you may get hit by an

400
00:15:32,800 --> 00:15:34,959
attack from a place that you cannot

401
00:15:34,959 --> 00:15:36,959
imagine right maybe an attack from even

402
00:15:36,959 --> 00:15:38,399
your own country

403
00:15:38,399 --> 00:15:41,199
so uh

404
00:15:41,199 --> 00:15:42,560
uh

405
00:15:42,560 --> 00:15:46,000
this is a case of study where one of our

406
00:15:46,000 --> 00:15:48,079
machine learning jobs

407
00:15:48,079 --> 00:15:51,120
could detect the sunburst c2

408
00:15:51,120 --> 00:15:52,639
right

409
00:15:52,639 --> 00:15:53,519
and

410
00:15:53,519 --> 00:15:55,120
the way we did it

411
00:15:55,120 --> 00:15:58,079
uh was not through geographic anomaly

412
00:15:58,079 --> 00:15:59,600
right uh

413
00:15:59,600 --> 00:16:01,759
so because this was not a geographic uh

414
00:16:01,759 --> 00:16:04,800
anomaly in this case uh so what we did

415
00:16:04,800 --> 00:16:07,040
was we leveraged a job that was looking

416
00:16:07,040 --> 00:16:09,120
for dns tunneling

417
00:16:09,120 --> 00:16:11,600
uh and this is something that we

418
00:16:11,600 --> 00:16:13,440
actually adopted from one of our

419
00:16:13,440 --> 00:16:16,639
customers or users uh that they you know

420
00:16:16,639 --> 00:16:18,639
they were using this and they like to

421
00:16:18,639 --> 00:16:21,680
use this looking for really really high

422
00:16:21,680 --> 00:16:23,759
apparent relationship you know between

423
00:16:23,759 --> 00:16:25,759
parent and child domain names in dns

424
00:16:25,759 --> 00:16:29,120
events so we adopted that we

425
00:16:29,120 --> 00:16:30,959
we adopted that into a machine learning

426
00:16:30,959 --> 00:16:34,880
job and we could detect the sunburst uh

427
00:16:34,880 --> 00:16:38,639
c2 uh basically in this case there was a

428
00:16:38,639 --> 00:16:40,720
domain uh

429
00:16:40,720 --> 00:16:43,120
a dga domain generation algorithm in

430
00:16:43,120 --> 00:16:44,079
place

431
00:16:44,079 --> 00:16:47,120
uh and there was just you know a lot of

432
00:16:47,120 --> 00:16:51,440
uh child processes for one parent sorry

433
00:16:51,440 --> 00:16:54,639
child domain names for one parent domain

434
00:16:54,639 --> 00:16:56,000
uh

435
00:16:56,000 --> 00:16:57,519
and that's why

436
00:16:57,519 --> 00:17:00,000
we could detect this right so in this

437
00:17:00,000 --> 00:17:04,000
case we didn't rely on uh geo geography

438
00:17:04,000 --> 00:17:05,599
we will leverage a different technique

439
00:17:05,599 --> 00:17:09,359
which was looking at dns tunneling

440
00:17:09,359 --> 00:17:11,599
and

441
00:17:12,480 --> 00:17:15,119
so it was a notable example for

442
00:17:15,119 --> 00:17:16,880
uh

443
00:17:16,880 --> 00:17:19,119
the detections that we got using network

444
00:17:19,119 --> 00:17:20,240
data

445
00:17:20,240 --> 00:17:21,039
now

446
00:17:21,039 --> 00:17:23,039
the most uh probably the most

447
00:17:23,039 --> 00:17:25,359
interesting part is uh

448
00:17:25,359 --> 00:17:28,319
detections that are using cloud api uh

449
00:17:28,319 --> 00:17:30,480
audit logs because you know we are

450
00:17:30,480 --> 00:17:32,320
moving towards

451
00:17:32,320 --> 00:17:37,120
using cloud more and more uh right uh so

452
00:17:37,120 --> 00:17:39,919
let's have a look at the case studies uh

453
00:17:39,919 --> 00:17:41,840
or let's have a look at the detections

454
00:17:41,840 --> 00:17:43,120
that per se

455
00:17:43,120 --> 00:17:45,280
that we got using uh

456
00:17:45,280 --> 00:17:48,480
cloud api audit logs

457
00:17:48,480 --> 00:17:50,640
so

458
00:17:51,200 --> 00:17:53,280
machine learning

459
00:17:53,280 --> 00:17:56,400
anomaly detection could also be used as

460
00:17:56,400 --> 00:17:59,679
a go-to technology in the cloud space

461
00:17:59,679 --> 00:18:01,679
but you know the cloud domain is a

462
00:18:01,679 --> 00:18:03,840
little bit uh different we have virtual

463
00:18:03,840 --> 00:18:07,039
machines we have virtual servers uh we

464
00:18:07,039 --> 00:18:08,720
have containers that run operating

465
00:18:08,720 --> 00:18:10,799
systems and they you know they kind of

466
00:18:10,799 --> 00:18:11,600
like

467
00:18:11,600 --> 00:18:16,160
look like virtual servers uh but

468
00:18:16,160 --> 00:18:17,919
you know cloud world

469
00:18:17,919 --> 00:18:20,160
is different uh we have

470
00:18:20,160 --> 00:18:21,039
a

471
00:18:21,039 --> 00:18:23,840
kind of services that basically don't

472
00:18:23,840 --> 00:18:26,160
traverse virtual networks right they are

473
00:18:26,160 --> 00:18:27,760
not accessible

474
00:18:27,760 --> 00:18:30,160
from virtual networks that your virtual

475
00:18:30,160 --> 00:18:33,360
servers on are on right

476
00:18:33,360 --> 00:18:35,600
so there are a number of services that

477
00:18:35,600 --> 00:18:37,679
don't traverse the virtual networks you

478
00:18:37,679 --> 00:18:40,799
cannot observe them using you know

479
00:18:40,799 --> 00:18:42,880
for example virtual

480
00:18:42,880 --> 00:18:45,200
you know uh firewalls intrusion

481
00:18:45,200 --> 00:18:47,120
detection system looking at the flow

482
00:18:47,120 --> 00:18:49,919
logs uh you cannot observe them by any

483
00:18:49,919 --> 00:18:51,760
of these means

484
00:18:51,760 --> 00:18:54,000
so uh

485
00:18:54,000 --> 00:18:54,799
uh

486
00:18:54,799 --> 00:18:57,679
this is uh the way we do it uh the

487
00:18:57,679 --> 00:19:00,480
machine learning jobs uh and you know

488
00:19:00,480 --> 00:19:03,120
cloud incidents uh another aspect is

489
00:19:03,120 --> 00:19:06,240
that they often lack clear evidence or

490
00:19:06,240 --> 00:19:09,039
uh you know indicators of misuse

491
00:19:09,039 --> 00:19:12,960
uh so it's very hard sometimes

492
00:19:12,960 --> 00:19:14,799
to find out

493
00:19:14,799 --> 00:19:17,840
based on this cloud api auto logs

494
00:19:17,840 --> 00:19:18,960
and

495
00:19:18,960 --> 00:19:20,480
the other thing the other important

496
00:19:20,480 --> 00:19:22,960
thing is the difference between normal

497
00:19:22,960 --> 00:19:25,200
user activity

498
00:19:25,200 --> 00:19:28,400
and you know a hijacked user context

499
00:19:28,400 --> 00:19:30,480
involved in a malicious or suspicious

500
00:19:30,480 --> 00:19:33,520
activity is often a matter of nuance

501
00:19:33,520 --> 00:19:38,080
uh i will explain about this later more

502
00:19:38,080 --> 00:19:39,919
uh

503
00:19:39,919 --> 00:19:42,240
i hope you understood that part of the

504
00:19:42,240 --> 00:19:44,080
you know virtual servers because that

505
00:19:44,080 --> 00:19:45,760
was uh very important like there are

506
00:19:45,760 --> 00:19:48,480
some services that you cannot basically

507
00:19:48,480 --> 00:19:50,640
observe or monitor right

508
00:19:50,640 --> 00:19:52,240
because they don't traverse the virtual

509
00:19:52,240 --> 00:19:53,760
networks

510
00:19:53,760 --> 00:19:56,480
uh so there are a lot of services in

511
00:19:56,480 --> 00:19:58,960
there uh and there is actually this

512
00:19:58,960 --> 00:20:01,520
attack matrix for cloud techniques

513
00:20:01,520 --> 00:20:04,080
uh and the overwhelming majority of

514
00:20:04,080 --> 00:20:07,039
these techniques uh you know are related

515
00:20:07,039 --> 00:20:10,400
to credential access uh

516
00:20:10,400 --> 00:20:13,679
you know in the cloud incident world

517
00:20:13,679 --> 00:20:14,799
uh

518
00:20:14,799 --> 00:20:17,440
there are cases i mean there are

519
00:20:17,440 --> 00:20:19,120
most of the times there are many cases

520
00:20:19,120 --> 00:20:20,960
where we're talking about credential

521
00:20:20,960 --> 00:20:23,679
access right so we're looking at cases

522
00:20:23,679 --> 00:20:26,400
where somebody has obtained a set of

523
00:20:26,400 --> 00:20:29,520
valid credentials and they're basically

524
00:20:29,520 --> 00:20:31,440
trying to impersonate a user they're

525
00:20:31,440 --> 00:20:33,039
trying to persisting in the control

526
00:20:33,039 --> 00:20:35,200
plane they're trying to use services in

527
00:20:35,200 --> 00:20:37,679
the control plane right to achieve their

528
00:20:37,679 --> 00:20:38,640
goals

529
00:20:38,640 --> 00:20:40,480
so uh

530
00:20:40,480 --> 00:20:42,720
yeah

531
00:20:43,039 --> 00:20:45,520
so let's have a look at the

532
00:20:45,520 --> 00:20:47,840
uh at some some of the cases studies

533
00:20:47,840 --> 00:20:50,880
that uh we had using cloud

534
00:20:50,880 --> 00:20:53,280
api logs

535
00:20:53,280 --> 00:20:55,520
uh

536
00:20:55,520 --> 00:20:56,559
you know

537
00:20:56,559 --> 00:20:58,559
this is uh one of the incidents that we

538
00:20:58,559 --> 00:21:01,679
could detect uh it is the one one of

539
00:21:01,679 --> 00:21:05,280
them from 2016. uh there are several

540
00:21:05,280 --> 00:21:07,280
similar incidents out there in public

541
00:21:07,280 --> 00:21:10,240
records but this is uh one example

542
00:21:10,240 --> 00:21:11,120
and

543
00:21:11,120 --> 00:21:13,280
there were actually many dimensions to

544
00:21:13,280 --> 00:21:15,840
this but there was a very significant

545
00:21:15,840 --> 00:21:18,640
and interesting you know cloud aspect or

546
00:21:18,640 --> 00:21:21,919
dimension to this uh incident

547
00:21:21,919 --> 00:21:24,480
that i decided to talk about and that

548
00:21:24,480 --> 00:21:27,440
aspect was related to the exfiltration

549
00:21:27,440 --> 00:21:29,360
method all right

550
00:21:29,360 --> 00:21:30,960
uh

551
00:21:30,960 --> 00:21:31,919
so

552
00:21:31,919 --> 00:21:32,880
you know

553
00:21:32,880 --> 00:21:33,919
the ex

554
00:21:33,919 --> 00:21:36,000
the exfiltration method was kind of

555
00:21:36,000 --> 00:21:38,480
novel at the time and it was something

556
00:21:38,480 --> 00:21:40,799
that i'm not sure that many people had

557
00:21:40,799 --> 00:21:42,320
thought about doing

558
00:21:42,320 --> 00:21:44,480
uh once uh

559
00:21:44,480 --> 00:21:47,200
you know a user got access to a virtual

560
00:21:47,200 --> 00:21:50,880
account uh it can actually use supported

561
00:21:50,880 --> 00:21:53,120
functionality to share snapshots of the

562
00:21:53,120 --> 00:21:55,840
virtual servers uh with you know other

563
00:21:55,840 --> 00:21:58,799
cloud accounts so so this was the

564
00:21:58,799 --> 00:22:01,760
novelty of that once uh they accessed a

565
00:22:01,760 --> 00:22:03,520
cloud account they they were using that

566
00:22:03,520 --> 00:22:05,280
supported functionality to share the

567
00:22:05,280 --> 00:22:06,559
snapshots with

568
00:22:06,559 --> 00:22:08,799
with an account which was under the

569
00:22:08,799 --> 00:22:10,880
attacker's control right kind of

570
00:22:10,880 --> 00:22:14,559
forklift data back uh to the uh cloud

571
00:22:14,559 --> 00:22:18,639
account that was under attackers control

572
00:22:18,880 --> 00:22:20,400
and uh

573
00:22:20,400 --> 00:22:22,400
this is uh

574
00:22:22,400 --> 00:22:25,679
how it looks like when you know someone

575
00:22:25,679 --> 00:22:27,600
shares a snapshot

576
00:22:27,600 --> 00:22:30,799
of a virtual server with an account

577
00:22:30,799 --> 00:22:34,799
and this is uh actually one of the cases

578
00:22:34,799 --> 00:22:37,200
where you will see somebody else's

579
00:22:37,200 --> 00:22:38,799
account right because

580
00:22:38,799 --> 00:22:41,039
this is the account number that this was

581
00:22:41,039 --> 00:22:42,480
shared with

582
00:22:42,480 --> 00:22:44,080
uh

583
00:22:44,080 --> 00:22:45,520
so

584
00:22:45,520 --> 00:22:46,799
here uh

585
00:22:46,799 --> 00:22:49,760
is what you can see related to that

586
00:22:49,760 --> 00:22:52,480
yeah the font is not that much good but

587
00:22:52,480 --> 00:22:54,720
uh

588
00:22:54,720 --> 00:22:57,360
yeah this is one example

589
00:22:57,360 --> 00:23:00,320
the other one was this case study where

590
00:23:00,320 --> 00:23:01,919
somebody was

591
00:23:01,919 --> 00:23:03,120
trying to

592
00:23:03,120 --> 00:23:05,600
bounce through a service called a web

593
00:23:05,600 --> 00:23:08,640
application firewall or wav service

594
00:23:08,640 --> 00:23:10,640
right so

595
00:23:10,640 --> 00:23:13,520
they could bounce or pivot through this

596
00:23:13,520 --> 00:23:16,080
web service in order to get another

597
00:23:16,080 --> 00:23:19,120
service called the metadata service

598
00:23:19,120 --> 00:23:19,919
and the

599
00:23:19,919 --> 00:23:22,640
metadata service is a is an information

600
00:23:22,640 --> 00:23:25,440
service in cloud accounts where virtual

601
00:23:25,440 --> 00:23:28,400
servers or you know virtual accounts

602
00:23:28,400 --> 00:23:30,880
can ask questions about you know

603
00:23:30,880 --> 00:23:33,200
themselves and get answers

604
00:23:33,200 --> 00:23:36,640
uh sometimes virtual servers can you

605
00:23:36,640 --> 00:23:37,520
know

606
00:23:37,520 --> 00:23:40,080
interrogate this metadata service

607
00:23:40,080 --> 00:23:42,960
and ask temporary credentials to you

608
00:23:42,960 --> 00:23:44,960
know authenticate a different service

609
00:23:44,960 --> 00:23:46,720
depending on the roles that is assigned

610
00:23:46,720 --> 00:23:48,799
to them so this is another thing that

611
00:23:48,799 --> 00:23:51,360
they can do now

612
00:23:51,360 --> 00:23:53,200
in this case the study

613
00:23:53,200 --> 00:23:55,360
somebody

614
00:23:55,360 --> 00:23:56,960
was you know

615
00:23:56,960 --> 00:23:59,840
able to bounce through this web service

616
00:23:59,840 --> 00:24:02,320
interrogate the metadata service and

617
00:24:02,320 --> 00:24:05,200
then you know grab the credential out of

618
00:24:05,200 --> 00:24:07,919
that service and then that credential

619
00:24:07,919 --> 00:24:10,080
was actually actually accessible from

620
00:24:10,080 --> 00:24:12,240
outside of the cloud so they were able

621
00:24:12,240 --> 00:24:15,279
to log in right uh and then they were

622
00:24:15,279 --> 00:24:17,679
able to access that cloud account and

623
00:24:17,679 --> 00:24:21,840
they were uh able uh to access the data

624
00:24:21,840 --> 00:24:24,880
that was stored uh in a data store

625
00:24:24,880 --> 00:24:27,760
called s3 i'll talk about that method

626
00:24:27,760 --> 00:24:30,240
list buckets if you uh

627
00:24:30,240 --> 00:24:31,919
if you're not familiar this is basically

628
00:24:31,919 --> 00:24:34,000
a method that you can enumerate a data

629
00:24:34,000 --> 00:24:37,679
store uh like s3 for example

630
00:24:37,679 --> 00:24:40,400
so uh

631
00:24:40,799 --> 00:24:41,679
so

632
00:24:41,679 --> 00:24:44,640
we have something around uh five

633
00:24:44,640 --> 00:24:46,640
different machine learning jobs

634
00:24:46,640 --> 00:24:47,600
right

635
00:24:47,600 --> 00:24:48,480
uh

636
00:24:48,480 --> 00:24:51,840
so these jobs are

637
00:24:51,840 --> 00:24:55,279
looking for uh you know

638
00:24:55,279 --> 00:24:58,320
things like rare method or rare call to

639
00:24:58,320 --> 00:25:00,880
methods rare requests for for a

640
00:25:00,880 --> 00:25:02,960
particular cloud user

641
00:25:02,960 --> 00:25:05,120
they're looking for

642
00:25:05,120 --> 00:25:08,559
you know a rare city or rare country for

643
00:25:08,559 --> 00:25:10,240
an api method

644
00:25:10,240 --> 00:25:13,120
they're looking for rare spikes in error

645
00:25:13,120 --> 00:25:15,440
messages or outliers in error messages

646
00:25:15,440 --> 00:25:18,159
because what we've found is if somebody

647
00:25:18,159 --> 00:25:21,760
has a shell on a virtual server right

648
00:25:21,760 --> 00:25:23,559
and if they're running a

649
00:25:23,559 --> 00:25:26,320
post-exploitation framework like bark to

650
00:25:26,320 --> 00:25:28,960
pivot through the control plane or you

651
00:25:28,960 --> 00:25:30,480
know

652
00:25:30,480 --> 00:25:33,840
to possibly move laterally among virtual

653
00:25:33,840 --> 00:25:37,360
servers then uh it will you know just

654
00:25:37,360 --> 00:25:38,480
create a

655
00:25:38,480 --> 00:25:40,960
burst of error messages and access

656
00:25:40,960 --> 00:25:43,200
authentication denied messages so

657
00:25:43,200 --> 00:25:46,480
looking at this is also pretty useful

658
00:25:46,480 --> 00:25:48,799
the spikes in error messages the other

659
00:25:48,799 --> 00:25:51,120
thing is a rare error

660
00:25:51,120 --> 00:25:51,919
so

661
00:25:51,919 --> 00:25:55,039
rare error has kind of observability

662
00:25:55,039 --> 00:25:58,000
implication use cases uh

663
00:25:58,000 --> 00:26:00,880
and what we have found is rare error

664
00:26:00,880 --> 00:26:03,760
sometimes will predict eminence cloud

665
00:26:03,760 --> 00:26:06,240
service failure meaning that a cloud

666
00:26:06,240 --> 00:26:10,320
service uh is likely going to degrade or

667
00:26:10,320 --> 00:26:12,400
you know break down in the next few

668
00:26:12,400 --> 00:26:14,559
minutes so looking at this is also

669
00:26:14,559 --> 00:26:15,840
helpful

670
00:26:15,840 --> 00:26:18,080
uh

671
00:26:18,159 --> 00:26:20,240
uh but you know

672
00:26:20,240 --> 00:26:22,960
detecting anomalous commands or or

673
00:26:22,960 --> 00:26:26,000
methods uh because we're looking for

674
00:26:26,000 --> 00:26:27,919
anomalous commands to basically

675
00:26:27,919 --> 00:26:30,480
basically kind of uh

676
00:26:30,480 --> 00:26:33,520
detect especially credential access uh

677
00:26:33,520 --> 00:26:36,000
in the cloud domain uh because like i

678
00:26:36,000 --> 00:26:38,000
said the credential access it was was

679
00:26:38,000 --> 00:26:40,159
one of the most uh you know popular

680
00:26:40,159 --> 00:26:41,760
things that you see

681
00:26:41,760 --> 00:26:42,799
uh

682
00:26:42,799 --> 00:26:44,320
so

683
00:26:44,320 --> 00:26:46,640
the challenge in detecting anomalous

684
00:26:46,640 --> 00:26:49,360
commands is sometimes these commands are

685
00:26:49,360 --> 00:26:52,640
using are being used by you know uh

686
00:26:52,640 --> 00:26:55,520
other operations or even sre users or

687
00:26:55,520 --> 00:26:57,679
developers that are actually you know

688
00:26:57,679 --> 00:27:00,240
doing some breakfast or they're you know

689
00:27:00,240 --> 00:27:02,320
maybe troubleshooting something

690
00:27:02,320 --> 00:27:05,279
so uh it's not that much easy to detect

691
00:27:05,279 --> 00:27:08,799
uh anomalous commands let's take the

692
00:27:08,799 --> 00:27:11,120
least bucket that you saw earlier

693
00:27:11,120 --> 00:27:13,200
as an example

694
00:27:13,200 --> 00:27:15,679
so if you remember the threat actor in

695
00:27:15,679 --> 00:27:18,240
that case study persisting uh with the

696
00:27:18,240 --> 00:27:20,720
compromise credentials uh

697
00:27:20,720 --> 00:27:22,799
was using this command the list buckets

698
00:27:22,799 --> 00:27:25,120
to enumerate that data store which was

699
00:27:25,120 --> 00:27:27,039
s3 in that case

700
00:27:27,039 --> 00:27:27,760
so

701
00:27:27,760 --> 00:27:30,960
this method right in a even in a very

702
00:27:30,960 --> 00:27:35,039
small cloud account is often being used

703
00:27:35,039 --> 00:27:37,840
too much for us to try to alert on it on

704
00:27:37,840 --> 00:27:40,720
this so it's not easy for us to detect

705
00:27:40,720 --> 00:27:41,760
that

706
00:27:41,760 --> 00:27:45,120
even in a medium-sized cloud account you

707
00:27:45,120 --> 00:27:46,399
know

708
00:27:46,399 --> 00:27:48,960
this we can do maybe tens of thousands

709
00:27:48,960 --> 00:27:52,640
calls to this method on a monthly basis

710
00:27:52,640 --> 00:27:56,399
so it's very hard to you know uh detect

711
00:27:56,399 --> 00:27:59,520
uh anomalous uh commands

712
00:27:59,520 --> 00:28:02,640
uh now the other thing is that we not

713
00:28:02,640 --> 00:28:05,919
only should detect these things

714
00:28:05,919 --> 00:28:07,200
but we should

715
00:28:07,200 --> 00:28:10,240
kind of be able to identify suspicious

716
00:28:10,240 --> 00:28:12,799
or malicious user activity meaning

717
00:28:12,799 --> 00:28:13,760
uh

718
00:28:13,760 --> 00:28:17,200
we should be able to identify when

719
00:28:17,200 --> 00:28:18,559
the cases

720
00:28:18,559 --> 00:28:20,559
where these methods are being called

721
00:28:20,559 --> 00:28:23,520
from a hijacked or illegitimate user

722
00:28:23,520 --> 00:28:25,520
context so this is more important than

723
00:28:25,520 --> 00:28:28,720
the first one i would say

724
00:28:28,840 --> 00:28:31,600
uh let's have a look at some cases

725
00:28:31,600 --> 00:28:34,640
studies now that are specifically uh you

726
00:28:34,640 --> 00:28:37,279
know related to to the topics that i

727
00:28:37,279 --> 00:28:38,399
discuss

728
00:28:38,399 --> 00:28:41,679
uh you can see here uh a detection that

729
00:28:41,679 --> 00:28:45,600
we got in this case uh it was a user uh

730
00:28:45,600 --> 00:28:48,240
calling this method it was craig in this

731
00:28:48,240 --> 00:28:51,440
case list buckets to enumerate

732
00:28:51,440 --> 00:28:54,720
a data store this is not a method

733
00:28:54,720 --> 00:28:56,559
that

734
00:28:56,559 --> 00:28:59,760
you know is is used by this user a lot

735
00:28:59,760 --> 00:29:02,960
so it's kind of very anomalous and rare

736
00:29:02,960 --> 00:29:05,919
so we could detect uh that right

737
00:29:05,919 --> 00:29:06,799
uh

738
00:29:06,799 --> 00:29:08,720
and we could alert on that and then we

739
00:29:08,720 --> 00:29:11,919
can simply go and ask the user why

740
00:29:11,919 --> 00:29:14,000
you know are you calling this method so

741
00:29:14,000 --> 00:29:16,880
this is uh one thing that we can do

742
00:29:16,880 --> 00:29:19,120
uh

743
00:29:19,600 --> 00:29:21,840
now

744
00:29:22,080 --> 00:29:24,080
there are some methods that are

745
00:29:24,080 --> 00:29:26,720
especially important right not all

746
00:29:26,720 --> 00:29:28,240
methods are

747
00:29:28,240 --> 00:29:29,760
important

748
00:29:29,760 --> 00:29:31,679
but there are some methods that are more

749
00:29:31,679 --> 00:29:32,720
important

750
00:29:32,720 --> 00:29:34,960
privilege methods identity and access

751
00:29:34,960 --> 00:29:38,720
management methods or you know

752
00:29:39,279 --> 00:29:41,919
sensitive methods these methods are not

753
00:29:41,919 --> 00:29:44,880
being called by normal users uh

754
00:29:44,880 --> 00:29:46,320
a lot right

755
00:29:46,320 --> 00:29:47,360
uh

756
00:29:47,360 --> 00:29:50,000
i mean developers can call these methods

757
00:29:50,000 --> 00:29:53,039
or sre users may call these methods to

758
00:29:53,039 --> 00:29:55,120
troubleshoot something maybe or or doing

759
00:29:55,120 --> 00:29:58,559
some breakfast but whenever you see a

760
00:29:58,559 --> 00:30:01,360
call to a sensitive method or a call to

761
00:30:01,360 --> 00:30:03,600
a privileged method from you know an

762
00:30:03,600 --> 00:30:06,559
unusual user context then that could be

763
00:30:06,559 --> 00:30:08,399
you know an indicator of you know

764
00:30:08,399 --> 00:30:10,320
something fishy is going on

765
00:30:10,320 --> 00:30:13,120
uh and

766
00:30:13,200 --> 00:30:14,240
and then

767
00:30:14,240 --> 00:30:16,960
these are all other methods or examples

768
00:30:16,960 --> 00:30:19,840
uh here you can see the first option

769
00:30:19,840 --> 00:30:22,080
the first method is shared snapshot

770
00:30:22,080 --> 00:30:23,039
volume

771
00:30:23,039 --> 00:30:25,840
created this is a method that has never

772
00:30:25,840 --> 00:30:28,240
called by this user before it's very

773
00:30:28,240 --> 00:30:31,840
rare right so we could detect that using

774
00:30:31,840 --> 00:30:33,840
one of our machine learning jobs

775
00:30:33,840 --> 00:30:35,919
and then the other one is ron instances

776
00:30:35,919 --> 00:30:38,320
now this is very uh very interesting

777
00:30:38,320 --> 00:30:40,720
because you know many cloud accounts

778
00:30:40,720 --> 00:30:41,919
they are

779
00:30:41,919 --> 00:30:44,080
really you know automated or at least

780
00:30:44,080 --> 00:30:47,360
controlled by automation so it's very

781
00:30:47,360 --> 00:30:49,279
strange for

782
00:30:49,279 --> 00:30:52,799
you know users to log into a let's say

783
00:30:52,799 --> 00:30:54,880
virtual uh

784
00:30:54,880 --> 00:30:57,440
server and run a virtual machine and run

785
00:30:57,440 --> 00:30:59,120
things manually

786
00:30:59,120 --> 00:31:01,360
so uh

787
00:31:01,360 --> 00:31:03,519
when you see this thing it's a very

788
00:31:03,519 --> 00:31:06,480
strong indicator

789
00:31:08,559 --> 00:31:10,720
so

790
00:31:11,600 --> 00:31:13,679
more privileged methods

791
00:31:13,679 --> 00:31:15,360
like assume role

792
00:31:15,360 --> 00:31:17,440
for example have also

793
00:31:17,440 --> 00:31:19,039
you know featured in a number of threat

794
00:31:19,039 --> 00:31:21,279
models and scenarios as well

795
00:31:21,279 --> 00:31:23,360
and you know these privileged and

796
00:31:23,360 --> 00:31:26,159
sensitive methods uh should not be

797
00:31:26,159 --> 00:31:29,039
coming from unusual geo locations or

798
00:31:29,039 --> 00:31:31,360
countries either so we should

799
00:31:31,360 --> 00:31:34,159
take that into account as well

800
00:31:34,159 --> 00:31:36,480
uh

801
00:31:36,559 --> 00:31:38,960
and then

802
00:31:39,200 --> 00:31:41,600
same thing for this method console login

803
00:31:41,600 --> 00:31:44,640
what you can see here is just a

804
00:31:44,640 --> 00:31:47,279
a login a console login by a user called

805
00:31:47,279 --> 00:31:48,880
uh craig again

806
00:31:48,880 --> 00:31:51,519
uh right uh and

807
00:31:51,519 --> 00:31:52,559
we could

808
00:31:52,559 --> 00:31:54,080
we could detect this

809
00:31:54,080 --> 00:31:55,679
uh and

810
00:31:55,679 --> 00:31:57,679
you know we can do the same thing for

811
00:31:57,679 --> 00:32:00,000
authentication events or login events

812
00:32:00,000 --> 00:32:02,320
and we have had pretty good results uh

813
00:32:02,320 --> 00:32:06,159
plotting you know uh

814
00:32:06,159 --> 00:32:09,279
source anomalies or geographic anomalies

815
00:32:09,279 --> 00:32:11,919
uh like

816
00:32:12,080 --> 00:32:14,399
let's return back to the metadata

817
00:32:14,399 --> 00:32:17,039
service that i discussed earlier uh this

818
00:32:17,039 --> 00:32:19,519
is a very important service and it was

819
00:32:19,519 --> 00:32:22,320
uh an ingredient of the second case

820
00:32:22,320 --> 00:32:24,399
study right if you remember i want to

821
00:32:24,399 --> 00:32:25,840
review again

822
00:32:25,840 --> 00:32:27,760
in that case the study the threat actor

823
00:32:27,760 --> 00:32:29,279
was trying to

824
00:32:29,279 --> 00:32:31,360
p-vote or bounce through a web service

825
00:32:31,360 --> 00:32:33,760
and get to the service in order to you

826
00:32:33,760 --> 00:32:36,399
know grab or extract some credential out

827
00:32:36,399 --> 00:32:38,399
of the service in order to be able to

828
00:32:38,399 --> 00:32:40,799
log in back access that account and then

829
00:32:40,799 --> 00:32:41,679
you know

830
00:32:41,679 --> 00:32:43,840
enumerate the data that was stored on

831
00:32:43,840 --> 00:32:45,279
that account

832
00:32:45,279 --> 00:32:47,600
so uh

833
00:32:47,600 --> 00:32:50,000
so metadata service is very important

834
00:32:50,000 --> 00:32:52,880
it's uh it's used programmatically and

835
00:32:52,880 --> 00:32:56,720
it's used a lot right uh so

836
00:32:56,720 --> 00:32:58,240
cloud access

837
00:32:58,240 --> 00:33:00,159
management services can call this

838
00:33:00,159 --> 00:33:01,760
service uh

839
00:33:01,760 --> 00:33:03,440
automation that is developed and

840
00:33:03,440 --> 00:33:05,440
instrumented by users can call to this

841
00:33:05,440 --> 00:33:08,240
service and many other services may call

842
00:33:08,240 --> 00:33:11,840
this service you know all day long

843
00:33:11,840 --> 00:33:14,960
now how can we uh you know

844
00:33:14,960 --> 00:33:17,200
detect uh

845
00:33:17,200 --> 00:33:20,320
anomalies or threats uh that are related

846
00:33:20,320 --> 00:33:21,279
thank you

847
00:33:21,279 --> 00:33:22,880
uh to this service

848
00:33:22,880 --> 00:33:26,240
we can rely on two things a rare process

849
00:33:26,240 --> 00:33:27,039
name

850
00:33:27,039 --> 00:33:30,159
uh that are calling this service so rare

851
00:33:30,159 --> 00:33:32,880
processes that are calling this service

852
00:33:32,880 --> 00:33:36,320
or rare user context or rare username

853
00:33:36,320 --> 00:33:39,120
that is calling this service right

854
00:33:39,120 --> 00:33:41,120
these are the two ways that we can kind

855
00:33:41,120 --> 00:33:42,399
of detect those

856
00:33:42,399 --> 00:33:43,440
threats

857
00:33:43,440 --> 00:33:46,080
now i want to show you examples of each

858
00:33:46,080 --> 00:33:49,200
of these scenarios so

859
00:33:49,200 --> 00:33:52,720
what you see here is actually a user

860
00:33:52,720 --> 00:33:57,039
uh uh sorry a process right uh let me go

861
00:33:57,039 --> 00:33:58,320
back just

862
00:33:58,320 --> 00:34:00,240
we're gonna look at the at an example

863
00:34:00,240 --> 00:34:02,080
for the first thing a rare process

864
00:34:02,080 --> 00:34:04,720
calling this metadata service so in this

865
00:34:04,720 --> 00:34:08,000
case it's curl right a user is trying to

866
00:34:08,000 --> 00:34:10,239
uh interrogate the method as a service

867
00:34:10,239 --> 00:34:13,359
using this uh curl by hand

868
00:34:13,359 --> 00:34:16,239
and this is uh really unusual uh you may

869
00:34:16,239 --> 00:34:18,480
ask why because you know

870
00:34:18,480 --> 00:34:20,800
it's a fully automated and regulated

871
00:34:20,800 --> 00:34:23,040
environment where where these users are

872
00:34:23,040 --> 00:34:25,839
working on so it's really unusual uh you

873
00:34:25,839 --> 00:34:30,159
know for them to do this by hand uh

874
00:34:30,159 --> 00:34:32,480
and

875
00:34:32,480 --> 00:34:35,280
the second one is an unusually unusual

876
00:34:35,280 --> 00:34:37,918
user context or unusual user calling to

877
00:34:37,918 --> 00:34:39,119
this service

878
00:34:39,119 --> 00:34:41,599
uh in this uh case uh you know it's a

879
00:34:41,599 --> 00:34:44,079
user called craig uh

880
00:34:44,079 --> 00:34:46,719
he he doesn't normally do this and have

881
00:34:46,719 --> 00:34:50,000
no reason to the to do this so yeah this

882
00:34:50,000 --> 00:34:53,918
is the a case study for the second

883
00:34:53,918 --> 00:34:56,079
the second item

884
00:34:56,079 --> 00:34:58,320
uh

885
00:34:58,800 --> 00:34:59,599
now

886
00:34:59,599 --> 00:35:00,839
in terms of

887
00:35:00,839 --> 00:35:04,240
uh future directions and road ahead

888
00:35:04,240 --> 00:35:05,520
uh

889
00:35:05,520 --> 00:35:07,440
there are several things that we're

890
00:35:07,440 --> 00:35:10,320
doing right now uh i think craig has

891
00:35:10,320 --> 00:35:12,800
more than 700 unsupervised machine

892
00:35:12,800 --> 00:35:14,880
learning jobs uh

893
00:35:14,880 --> 00:35:17,119
in development at the moment

894
00:35:17,119 --> 00:35:18,400
uh

895
00:35:18,400 --> 00:35:21,280
and he has done some work uh on

896
00:35:21,280 --> 00:35:24,160
detecting uh you know

897
00:35:24,160 --> 00:35:26,640
threats and low beam activities

898
00:35:26,640 --> 00:35:28,880
especially living off the land activity

899
00:35:28,880 --> 00:35:31,440
and those hard to find things using on

900
00:35:31,440 --> 00:35:33,599
supervised machine learning models

901
00:35:33,599 --> 00:35:36,000
uh and then uh he's done some work and

902
00:35:36,000 --> 00:35:38,079
plan to do more uh

903
00:35:38,079 --> 00:35:41,680
i may involve in this uh indeed uh on

904
00:35:41,680 --> 00:35:45,280
you know risk clustering and then alert

905
00:35:45,280 --> 00:35:48,160
clustering multivariate correlation you

906
00:35:48,160 --> 00:35:51,200
know combining or joining uh

907
00:35:51,200 --> 00:35:52,640
these machine learning alerts with

908
00:35:52,640 --> 00:35:54,880
conventional alerts behavior alerts and

909
00:35:54,880 --> 00:35:57,359
other types of alerts that we have

910
00:35:57,359 --> 00:35:58,880
uh

911
00:35:58,880 --> 00:35:59,599
so

912
00:35:59,599 --> 00:36:01,440
yeah these are the uh

913
00:36:01,440 --> 00:36:03,599
things that we plan to do or we are

914
00:36:03,599 --> 00:36:05,280
doing right now

915
00:36:05,280 --> 00:36:06,960
uh

916
00:36:06,960 --> 00:36:10,640
and this is kind of the summary of uh

917
00:36:10,640 --> 00:36:13,680
how we we do it at elastic uh to the

918
00:36:13,680 --> 00:36:15,760
tech threats if you have any questions

919
00:36:15,760 --> 00:36:19,040
uh i can maybe answer uh them generally

920
00:36:19,040 --> 00:36:21,119
if you have more specific questions

921
00:36:21,119 --> 00:36:23,280
maybe you can shoot craig uh an email

922
00:36:23,280 --> 00:36:26,280
directly

923
00:36:36,320 --> 00:36:37,520
no problem

924
00:36:37,520 --> 00:36:40,520
yeah

925
00:36:41,599 --> 00:36:46,920
any other questions or i don't know

926
00:37:00,000 --> 00:37:02,000
okay

927
00:37:02,000 --> 00:37:03,290
thank you

928
00:37:03,290 --> 00:37:09,550
[Applause]

