1
00:00:00,080 --> 00:00:03,840
okay it's 1 30 and we have

2
00:00:03,840 --> 00:00:06,160
two amazing speakers here

3
00:00:06,160 --> 00:00:07,200
avi

4
00:00:07,200 --> 00:00:08,960
and ryan

5
00:00:08,960 --> 00:00:11,440
um they have been uh they worked in

6
00:00:11,440 --> 00:00:14,080
tesser i believe and also our

7
00:00:14,080 --> 00:00:16,960
security researchers of malware

8
00:00:16,960 --> 00:00:19,680
so that should be fun um

9
00:00:19,680 --> 00:00:20,480
and

10
00:00:20,480 --> 00:00:21,680
uh

11
00:00:21,680 --> 00:00:24,000
it's a cobalt strike

12
00:00:24,000 --> 00:00:25,680
beacon type right

13
00:00:25,680 --> 00:00:28,840
implementation re-implementation

14
00:00:28,840 --> 00:00:32,000
okay here you go we're here to explain

15
00:00:32,000 --> 00:00:34,480
about it so

16
00:00:34,480 --> 00:00:36,239
okay cool so hi everybody we're very

17
00:00:36,239 --> 00:00:38,239
excited to be here um welcome to the

18
00:00:38,239 --> 00:00:40,399
rise of the vermillion crossbar from

19
00:00:40,399 --> 00:00:42,480
kabul strike beacon targeting linux and

20
00:00:42,480 --> 00:00:43,520
windows

21
00:00:43,520 --> 00:00:45,200
this talk is based on a research we

22
00:00:45,200 --> 00:00:47,520
conducted during august

23
00:00:47,520 --> 00:00:49,440
august 21.

24
00:00:49,440 --> 00:00:51,280
i'm avigil i'm a product manager at

25
00:00:51,280 --> 00:00:53,600
inteser before that i was part of the

26
00:00:53,600 --> 00:00:56,160
research team and i focused on malware

27
00:00:56,160 --> 00:00:58,559
analysis and threat hunting

28
00:00:58,559 --> 00:01:00,640
thank you very much i'm ryan i'm a

29
00:01:00,640 --> 00:01:02,079
researcher with

30
00:01:02,079 --> 00:01:04,720
in telser on the previous rules i was a

31
00:01:04,720 --> 00:01:07,040
security engineer on the researcher and

32
00:01:07,040 --> 00:01:08,320
anomalies

33
00:01:08,320 --> 00:01:10,000
threat research team

34
00:01:10,000 --> 00:01:11,280
first we

35
00:01:11,280 --> 00:01:12,400
agenda

36
00:01:12,400 --> 00:01:13,840
of what we're going to be talking about

37
00:01:13,840 --> 00:01:15,360
today so

38
00:01:15,360 --> 00:01:18,400
um cobalt strike itself because um

39
00:01:18,400 --> 00:01:19,840
this is really the popularity of this

40
00:01:19,840 --> 00:01:22,720
tale is why a vermilion strike has come

41
00:01:22,720 --> 00:01:26,080
about so a bit of background around that

42
00:01:26,080 --> 00:01:27,360
is good to

43
00:01:27,360 --> 00:01:30,159
uh understand then avi is going to talk

44
00:01:30,159 --> 00:01:31,200
about the

45
00:01:31,200 --> 00:01:34,079
uh the linux malware frat landscape so

46
00:01:34,079 --> 00:01:35,920
you know why is linux being targeted and

47
00:01:35,920 --> 00:01:38,560
who is targeting that

48
00:01:38,560 --> 00:01:40,159
and then we're going to talk about

49
00:01:40,159 --> 00:01:41,840
vermilion strike

50
00:01:41,840 --> 00:01:44,079
in sort of more detail itself so the

51
00:01:44,079 --> 00:01:46,880
background and then uh sort of brief

52
00:01:46,880 --> 00:01:49,200
technical uh analysis of some of the

53
00:01:49,200 --> 00:01:50,560
code

54
00:01:50,560 --> 00:01:52,479
that's inside at hand

55
00:01:52,479 --> 00:01:54,000
and then there's some stuff that we can

56
00:01:54,000 --> 00:01:56,240
actually learn from that and we'll chat

57
00:01:56,240 --> 00:01:57,840
about that and then we'll wrap up the

58
00:01:57,840 --> 00:02:02,000
talk as well at about 25 minutes

59
00:02:02,000 --> 00:02:04,799
so what is cobalt strike and

60
00:02:04,799 --> 00:02:06,799
um if you look at kind of the website or

61
00:02:06,799 --> 00:02:08,800
the marketing material it says it's

62
00:02:08,800 --> 00:02:10,959
software for adversary simulations and

63
00:02:10,959 --> 00:02:13,280
team uh operations

64
00:02:13,280 --> 00:02:14,720
if that doesn't really clear it up for

65
00:02:14,720 --> 00:02:16,959
you um the way i'd freeze it is that

66
00:02:16,959 --> 00:02:19,840
it's a malware framework um and it

67
00:02:19,840 --> 00:02:21,599
doesn't include just like the actual

68
00:02:21,599 --> 00:02:23,599
malware payload itself but

69
00:02:23,599 --> 00:02:25,200
the like command and control

70
00:02:25,200 --> 00:02:27,599
infrastructure around it comes with it

71
00:02:27,599 --> 00:02:29,599
and clients the sort of generate

72
00:02:29,599 --> 00:02:32,000
payloads and also it's basically the

73
00:02:32,000 --> 00:02:34,239
fill capabilities you would need in the

74
00:02:34,239 --> 00:02:38,160
simulating adversary stuff

75
00:02:38,160 --> 00:02:41,040
so the components inside it there's the

76
00:02:41,040 --> 00:02:42,080
bacon

77
00:02:42,080 --> 00:02:43,599
and

78
00:02:43,599 --> 00:02:45,599
the bacon comes in two parts there's a

79
00:02:45,599 --> 00:02:48,160
stager and then there's the full back

80
00:02:48,160 --> 00:02:50,560
door what the stager is it's usually a

81
00:02:50,560 --> 00:02:52,400
small piece of shell code that will

82
00:02:52,400 --> 00:02:54,879
reach out to a c2 server and then it'll

83
00:02:54,879 --> 00:02:57,519
download the main back door execute that

84
00:02:57,519 --> 00:02:59,360
in memory so well

85
00:02:59,360 --> 00:03:01,840
not every attack uses a stager you can

86
00:03:01,840 --> 00:03:03,120
have something just go straight in with

87
00:03:03,120 --> 00:03:05,680
the back door but it's slightly easier

88
00:03:05,680 --> 00:03:07,519
to detect

89
00:03:07,519 --> 00:03:09,360
there are things called loaders

90
00:03:09,360 --> 00:03:11,280
and what loaders are is

91
00:03:11,280 --> 00:03:13,040
there's just a huge amount of like code

92
00:03:13,040 --> 00:03:16,400
snippets or scripts that you can take as

93
00:03:16,400 --> 00:03:18,640
a loader and that will either execute a

94
00:03:18,640 --> 00:03:20,959
stager or a back door

95
00:03:20,959 --> 00:03:22,800
not sort of to help you

96
00:03:22,800 --> 00:03:23,680
um

97
00:03:23,680 --> 00:03:25,440
then there's the team server which i'll

98
00:03:25,440 --> 00:03:27,280
say somebody else just the whole command

99
00:03:27,280 --> 00:03:28,560
and control

100
00:03:28,560 --> 00:03:30,560
infrastructure a cobalt strike

101
00:03:30,560 --> 00:03:32,799
and you log into the team server using

102
00:03:32,799 --> 00:03:34,560
the client and then the clients what you

103
00:03:34,560 --> 00:03:36,239
see in the screenshot there and that's

104
00:03:36,239 --> 00:03:38,239
where you generate your payloads from

105
00:03:38,239 --> 00:03:40,159
so that's in short and sort of a couple

106
00:03:40,159 --> 00:03:43,440
trick looks like at like a high level

107
00:03:43,440 --> 00:03:46,400
um it's very very popular so it is

108
00:03:46,400 --> 00:03:48,959
um you know it has great features hard

109
00:03:48,959 --> 00:03:51,920
to detect often in memory payloads

110
00:03:51,920 --> 00:03:54,319
pretty easy to configure swap out c2s

111
00:03:54,319 --> 00:03:55,760
things like that

112
00:03:55,760 --> 00:03:58,080
for payloads and say no

113
00:03:58,080 --> 00:03:59,439
basically whatever target you're trying

114
00:03:59,439 --> 00:04:01,280
to go for you can

115
00:04:01,280 --> 00:04:02,959
get the quite a lot of payloads to

116
00:04:02,959 --> 00:04:05,439
handle each specific uh case

117
00:04:05,439 --> 00:04:07,840
um command control is handled you know

118
00:04:07,840 --> 00:04:09,360
everything's encrypted and all you don't

119
00:04:09,360 --> 00:04:11,680
really need to implement that yourself

120
00:04:11,680 --> 00:04:12,560
um

121
00:04:12,560 --> 00:04:16,399
and i say hard to uh attribute and more

122
00:04:16,399 --> 00:04:17,759
so the reason for that is that there are

123
00:04:17,759 --> 00:04:19,759
now so many people using cobalt strike

124
00:04:19,759 --> 00:04:22,079
that it creates a bit of a spartacus

125
00:04:22,079 --> 00:04:24,160
effect you know where you can't really

126
00:04:24,160 --> 00:04:26,840
tell out of the noise who exactly this

127
00:04:26,840 --> 00:04:30,080
is so here are the intended users of

128
00:04:30,080 --> 00:04:32,320
cobalt strike

129
00:04:32,320 --> 00:04:34,720
the real intended users are red teams

130
00:04:34,720 --> 00:04:36,240
and you know

131
00:04:36,240 --> 00:04:38,639
red teams will get a licensed version

132
00:04:38,639 --> 00:04:40,560
from the maintainers and they'll use

133
00:04:40,560 --> 00:04:42,479
that to simulate the attacks on their

134
00:04:42,479 --> 00:04:44,320
company and then what they learned from

135
00:04:44,320 --> 00:04:46,080
those attacks they can patch

136
00:04:46,080 --> 00:04:47,520
those vulnerabilities

137
00:04:47,520 --> 00:04:50,160
but unfortunately we also have what is

138
00:04:50,160 --> 00:04:51,919
uh adversaries

139
00:04:51,919 --> 00:04:54,720
that use a cobalt strike as well

140
00:04:54,720 --> 00:04:57,040
and um

141
00:04:57,040 --> 00:04:59,280
you what they will get is not a licensed

142
00:04:59,280 --> 00:05:01,120
version usually but a cracked version

143
00:05:01,120 --> 00:05:02,479
that they'll get online and then use

144
00:05:02,479 --> 00:05:03,360
them

145
00:05:03,360 --> 00:05:05,919
in cyber uh operations

146
00:05:05,919 --> 00:05:07,919
where do they get it from

147
00:05:07,919 --> 00:05:09,919
well quite simply every time there's

148
00:05:09,919 --> 00:05:11,280
like a new version of kobold strike

149
00:05:11,280 --> 00:05:12,240
released

150
00:05:12,240 --> 00:05:13,759
honestly within like a matter of weeks

151
00:05:13,759 --> 00:05:15,759
or sometimes even days there'll be a

152
00:05:15,759 --> 00:05:17,680
cracked version online

153
00:05:17,680 --> 00:05:20,560
and you can get this like on github

154
00:05:20,560 --> 00:05:22,479
pretty easily or and it wouldn't

155
00:05:22,479 --> 00:05:24,560
surprise me if it's on sort of dark web

156
00:05:24,560 --> 00:05:26,000
markets or stuff that you could over

157
00:05:26,000 --> 00:05:28,080
tour as well

158
00:05:28,080 --> 00:05:29,680
um

159
00:05:29,680 --> 00:05:32,400
so it's been in the news a lot and

160
00:05:32,400 --> 00:05:34,160
honestly you don't really need to go far

161
00:05:34,160 --> 00:05:36,080
you can just do a sort of google search

162
00:05:36,080 --> 00:05:38,080
and you'll see many things like this

163
00:05:38,080 --> 00:05:40,720
it's been used by scrub kitties up to

164
00:05:40,720 --> 00:05:43,440
uh nation state sponsored trad actors

165
00:05:43,440 --> 00:05:44,720
you know and you get news stories like

166
00:05:44,720 --> 00:05:46,479
that like european diplomats being

167
00:05:46,479 --> 00:05:48,880
targeted with it and all it's

168
00:05:48,880 --> 00:05:50,479
really i could have replaced these with

169
00:05:50,479 --> 00:05:52,639
like a 100 different news stories it's

170
00:05:52,639 --> 00:05:54,800
all over the place really

171
00:05:54,800 --> 00:05:55,600
um

172
00:05:55,600 --> 00:05:57,360
what's the history between uh behind

173
00:05:57,360 --> 00:05:59,840
cobalt strike on using it for linux

174
00:05:59,840 --> 00:06:00,960
officially

175
00:06:00,960 --> 00:06:03,039
there is none so

176
00:06:03,039 --> 00:06:04,720
the maintainers of couple strike help

177
00:06:04,720 --> 00:06:06,479
systems release the blog a couple years

178
00:06:06,479 --> 00:06:08,479
back busy saying like this is a windows

179
00:06:08,479 --> 00:06:10,960
only payload but it really doesn't stop

180
00:06:10,960 --> 00:06:12,400
a few um

181
00:06:12,400 --> 00:06:14,240
smart sort of programmers you know

182
00:06:14,240 --> 00:06:17,039
creating a linux based payload for that

183
00:06:17,039 --> 00:06:17,840
so

184
00:06:17,840 --> 00:06:19,520
notable examples there's one called

185
00:06:19,520 --> 00:06:22,639
geekin and it uses golang to implement

186
00:06:22,639 --> 00:06:24,960
beacon and you can have elf

187
00:06:24,960 --> 00:06:26,479
payload to that

188
00:06:26,479 --> 00:06:28,400
um there's another one called cross c2

189
00:06:28,400 --> 00:06:29,520
framework

190
00:06:29,520 --> 00:06:32,639
and then like really funny was there was

191
00:06:32,639 --> 00:06:35,600
someone on twitter had managed to run

192
00:06:35,600 --> 00:06:37,360
the windows version of beacon and linux

193
00:06:37,360 --> 00:06:38,960
using a wine

194
00:06:38,960 --> 00:06:40,240
emulator

195
00:06:40,240 --> 00:06:41,600
so i did so

196
00:06:41,600 --> 00:06:43,280
i think it kind of half works

197
00:06:43,280 --> 00:06:44,319
there

198
00:06:44,319 --> 00:06:45,280
um

199
00:06:45,280 --> 00:06:48,000
so until you help me for market

200
00:06:48,000 --> 00:06:49,360
thanks

201
00:06:49,360 --> 00:06:51,199
okay cool so now that we have some

202
00:06:51,199 --> 00:06:53,360
background about cobble strike

203
00:06:53,360 --> 00:06:55,440
um let's talk about the linux

204
00:06:55,440 --> 00:06:57,520
um malware threat landscape and this

205
00:06:57,520 --> 00:06:59,520
will help us to connect all the duct

206
00:06:59,520 --> 00:07:01,360
dots together

207
00:07:01,360 --> 00:07:02,400
so

208
00:07:02,400 --> 00:07:04,319
the linux market share the desktop world

209
00:07:04,319 --> 00:07:06,319
is really really low it's approximately

210
00:07:06,319 --> 00:07:07,680
two percent

211
00:07:07,680 --> 00:07:09,680
however the situation is quite the

212
00:07:09,680 --> 00:07:11,840
opposite um when speaking about cloud

213
00:07:11,840 --> 00:07:14,160
servers where linux is the predominant

214
00:07:14,160 --> 00:07:15,680
operation system

215
00:07:15,680 --> 00:07:17,759
which makes sense because of the of the

216
00:07:17,759 --> 00:07:19,280
nature of it

217
00:07:19,280 --> 00:07:21,759
however this really affects the linux um

218
00:07:21,759 --> 00:07:24,160
maori fit landscape is because we see

219
00:07:24,160 --> 00:07:27,039
many many coin miners and botnets

220
00:07:27,039 --> 00:07:27,840
okay

221
00:07:27,840 --> 00:07:30,080
um which again makes sense because they

222
00:07:30,080 --> 00:07:32,400
are designed to take advantage of

223
00:07:32,400 --> 00:07:35,039
computing powers and

224
00:07:35,039 --> 00:07:37,919
the attackers behind of these malware

225
00:07:37,919 --> 00:07:39,919
they just want to spread to as many

226
00:07:39,919 --> 00:07:43,280
victims as possible okay so these

227
00:07:43,280 --> 00:07:45,680
malware usually are not targeted now we

228
00:07:45,680 --> 00:07:48,319
also see ransomware which are usually

229
00:07:48,319 --> 00:07:50,879
targeted and delivered to file hosting

230
00:07:50,879 --> 00:07:55,360
servers such as qnup and ransom

231
00:07:55,360 --> 00:07:58,800
and vmware esxi servers

232
00:07:58,800 --> 00:08:01,520
which can refer to ransom ex which was a

233
00:08:01,520 --> 00:08:02,800
quite popular

234
00:08:02,800 --> 00:08:05,680
like a few months ago

235
00:08:05,919 --> 00:08:07,360
and

236
00:08:07,360 --> 00:08:08,479
lastly

237
00:08:08,479 --> 00:08:10,479
less populated let's say frequently

238
00:08:10,479 --> 00:08:12,960
documented are backdoors

239
00:08:12,960 --> 00:08:15,440
which are targeted and usually the

240
00:08:15,440 --> 00:08:17,919
adversaries behind these backdoors are

241
00:08:17,919 --> 00:08:20,560
nation state

242
00:08:20,879 --> 00:08:23,680
now the nation state that historically

243
00:08:23,680 --> 00:08:25,199
been documenting

244
00:08:25,199 --> 00:08:26,800
targeting linux

245
00:08:26,800 --> 00:08:30,400
are russia north korea and china now an

246
00:08:30,400 --> 00:08:32,640
interesting fact here is that

247
00:08:32,640 --> 00:08:35,039
most of the tools most of the linux

248
00:08:35,039 --> 00:08:37,519
malware that was

249
00:08:37,519 --> 00:08:40,880
developed by nation state has at least

250
00:08:40,880 --> 00:08:43,279
one other version that targets other

251
00:08:43,279 --> 00:08:46,440
operation systems so for example we have

252
00:08:46,440 --> 00:08:50,560
apt-29 in russia which have the wellness

253
00:08:50,560 --> 00:08:52,839
malware that targets both linux and

254
00:08:52,839 --> 00:08:55,120
windows uh

255
00:08:55,120 --> 00:08:57,120
for north korea we have the lazaros

256
00:08:57,120 --> 00:09:00,640
group um they have decals the targets

257
00:09:00,640 --> 00:09:02,320
linux windows

258
00:09:02,320 --> 00:09:03,680
and mac

259
00:09:03,680 --> 00:09:05,839
and also they have a manuscript that we

260
00:09:05,839 --> 00:09:09,519
found targeting linux and windows

261
00:09:09,519 --> 00:09:12,160
and for china we have the winter group

262
00:09:12,160 --> 00:09:14,560
they have backdoors for linux and

263
00:09:14,560 --> 00:09:18,080
windows and also the blacktech group

264
00:09:18,080 --> 00:09:21,040
they have ts cookie and pleid both of

265
00:09:21,040 --> 00:09:23,519
which were first discovered targeting

266
00:09:23,519 --> 00:09:24,959
windows

267
00:09:24,959 --> 00:09:26,560
and after a while they were found

268
00:09:26,560 --> 00:09:29,599
targeting linux as well

269
00:09:30,240 --> 00:09:32,240
cool so we have some background about

270
00:09:32,240 --> 00:09:34,080
coba strike we have some background

271
00:09:34,080 --> 00:09:36,320
about linux malware let's connect all

272
00:09:36,320 --> 00:09:38,399
the dots together and talk about our

273
00:09:38,399 --> 00:09:40,080
research

274
00:09:40,080 --> 00:09:43,040
so one day we got this set um for a file

275
00:09:43,040 --> 00:09:45,360
an elf file

276
00:09:45,360 --> 00:09:47,360
from our thread hunting tool and we

277
00:09:47,360 --> 00:09:49,120
uploaded it to our system which is

278
00:09:49,120 --> 00:09:51,120
integer analyzer

279
00:09:51,120 --> 00:09:53,680
um and from the analysis we saw three

280
00:09:53,680 --> 00:09:55,279
interesting things

281
00:09:55,279 --> 00:09:57,760
okay this screenshot is taken from our

282
00:09:57,760 --> 00:10:00,959
platform which is integer

283
00:10:01,120 --> 00:10:03,760
so the first thing that we saw which is

284
00:10:03,760 --> 00:10:05,760
super interesting

285
00:10:05,760 --> 00:10:08,079
again this is an elf sample

286
00:10:08,079 --> 00:10:10,800
and it shares strings with cobble strike

287
00:10:10,800 --> 00:10:13,120
now as ryan mentioned before

288
00:10:13,120 --> 00:10:15,920
there is no official version of colbert

289
00:10:15,920 --> 00:10:19,200
strike for linux okay so this was by its

290
00:10:19,200 --> 00:10:21,360
own very very interesting

291
00:10:21,360 --> 00:10:23,200
uh second of all

292
00:10:23,200 --> 00:10:25,600
um the file shared

293
00:10:25,600 --> 00:10:26,399
like

294
00:10:26,399 --> 00:10:27,360
about

295
00:10:27,360 --> 00:10:28,880
94

296
00:10:28,880 --> 00:10:32,160
um of previously unseen code okay so the

297
00:10:32,160 --> 00:10:34,160
code that we see here that is marked as

298
00:10:34,160 --> 00:10:35,279
vermilion

299
00:10:35,279 --> 00:10:36,399
um

300
00:10:36,399 --> 00:10:38,320
it the screenshot was taken after we

301
00:10:38,320 --> 00:10:40,160
marked the code okay i'll i'll just

302
00:10:40,160 --> 00:10:42,480
explain a bit about integer

303
00:10:42,480 --> 00:10:44,959
so um integer has a really really big

304
00:10:44,959 --> 00:10:47,360
database containing trusted and

305
00:10:47,360 --> 00:10:49,120
malicious code

306
00:10:49,120 --> 00:10:51,519
now every file that is uploaded to our

307
00:10:51,519 --> 00:10:55,200
system is divided into chunks of code

308
00:10:55,200 --> 00:10:57,839
and compared against our database

309
00:10:57,839 --> 00:11:00,800
so the fact that the file had a very

310
00:11:00,800 --> 00:11:03,040
very large percentage of previously

311
00:11:03,040 --> 00:11:04,560
unseen code

312
00:11:04,560 --> 00:11:07,120
is a huge indicator that this file might

313
00:11:07,120 --> 00:11:10,160
be written from scratch

314
00:11:10,720 --> 00:11:12,320
and lastly

315
00:11:12,320 --> 00:11:15,760
we saw network related capabilities um

316
00:11:15,760 --> 00:11:17,279
such as

317
00:11:17,279 --> 00:11:19,279
resolve dns um

318
00:11:19,279 --> 00:11:21,600
socket stuff and so on which was

319
00:11:21,600 --> 00:11:23,760
again really interesting all those

320
00:11:23,760 --> 00:11:26,480
things together

321
00:11:27,440 --> 00:11:30,480
so in virustotal it had zero detections

322
00:11:30,480 --> 00:11:32,079
um which is not really a decision

323
00:11:32,079 --> 00:11:34,079
differentiator when speaking of linux

324
00:11:34,079 --> 00:11:36,480
malware and we'll talk about that um

325
00:11:36,480 --> 00:11:37,519
later

326
00:11:37,519 --> 00:11:40,079
however the name of the binary was

327
00:11:40,079 --> 00:11:41,440
was a bit odd

328
00:11:41,440 --> 00:11:44,959
um x11 jtk now x11 is a graphical

329
00:11:44,959 --> 00:11:47,600
environment for unix and jtk widget

330
00:11:47,600 --> 00:11:50,720
libraries now it makes sense each x11

331
00:11:50,720 --> 00:11:53,760
jtk they come together however when

332
00:11:53,760 --> 00:11:56,639
searching for the exact binary name in

333
00:11:56,639 --> 00:11:58,880
google and in virustotal

334
00:11:58,880 --> 00:12:02,079
we got no results

335
00:12:03,040 --> 00:12:05,519
another interesting thing that

336
00:12:05,519 --> 00:12:07,920
this file got triggered by our rules

337
00:12:07,920 --> 00:12:10,480
written by florian ross detecting

338
00:12:10,480 --> 00:12:12,480
corporal strike which kind of aligns

339
00:12:12,480 --> 00:12:14,079
with the string we use that we've seen

340
00:12:14,079 --> 00:12:16,800
an integer platform

341
00:12:16,800 --> 00:12:18,959
so all of this together made us really

342
00:12:18,959 --> 00:12:21,279
really happy as researchers because we

343
00:12:21,279 --> 00:12:22,639
know that we have something really

344
00:12:22,639 --> 00:12:24,399
interesting in our hands

345
00:12:24,399 --> 00:12:26,959
and uh we started to dive deeper

346
00:12:26,959 --> 00:12:29,439
technically

347
00:12:30,000 --> 00:12:33,279
okay so um just sort of dive deeper into

348
00:12:33,279 --> 00:12:35,600
the file let's just jump straight in

349
00:12:35,600 --> 00:12:37,360
they give a macro sort of high level

350
00:12:37,360 --> 00:12:40,800
view when vermilion is executed

351
00:12:40,800 --> 00:12:42,160
it will demonize itself in the

352
00:12:42,160 --> 00:12:43,440
background

353
00:12:43,440 --> 00:12:45,600
it'll then

354
00:12:45,600 --> 00:12:48,800
decode its configuration import rsa key

355
00:12:48,800 --> 00:12:51,360
that later uses for encryption it'll

356
00:12:51,360 --> 00:12:52,959
fingerprint the machine and it'll start

357
00:12:52,959 --> 00:12:55,680
the c2 loop which is largely what

358
00:12:55,680 --> 00:12:57,399
coupled strike does since just a

359
00:12:57,399 --> 00:12:59,200
re-implementation of that

360
00:12:59,200 --> 00:13:01,360
so for the configuration

361
00:13:01,360 --> 00:13:03,839
um simple zor cipher

362
00:13:03,839 --> 00:13:06,639
hack 69 which is quite a common uh value

363
00:13:06,639 --> 00:13:07,839
used might be

364
00:13:07,839 --> 00:13:10,160
the default for one of the versions of

365
00:13:10,160 --> 00:13:11,440
cobblestrike

366
00:13:11,440 --> 00:13:13,440
and what's quite interesting is since

367
00:13:13,440 --> 00:13:14,240
it's

368
00:13:14,240 --> 00:13:16,160
the exact same configuration as you saw

369
00:13:16,160 --> 00:13:18,320
like the arrow rules headphones you can

370
00:13:18,320 --> 00:13:20,880
use some cobblestrike configuration

371
00:13:20,880 --> 00:13:22,959
parsers and it'll handle it completely

372
00:13:22,959 --> 00:13:24,639
fine even though it's sitting inside of

373
00:13:24,639 --> 00:13:26,480
an elf file

374
00:13:26,480 --> 00:13:28,480
and you can still see is that the

375
00:13:28,480 --> 00:13:30,959
windows artifacts still exist in the

376
00:13:30,959 --> 00:13:33,120
linux version so as we're talking about

377
00:13:33,120 --> 00:13:34,639
before once you start seeing stuff

378
00:13:34,639 --> 00:13:36,560
that's for windows but inside and health

379
00:13:36,560 --> 00:13:38,000
file you know if you're really looking

380
00:13:38,000 --> 00:13:40,079
for a red flag for what is a suspicious

381
00:13:40,079 --> 00:13:42,880
well that's probably quite a good one

382
00:13:42,880 --> 00:13:45,839
a highlight just in the top there that

383
00:13:45,839 --> 00:13:46,639
is

384
00:13:46,639 --> 00:13:48,720
the c2

385
00:13:48,720 --> 00:13:52,079
or so there are multiple c2s configured

386
00:13:52,079 --> 00:13:53,760
for the file

387
00:13:53,760 --> 00:13:54,560
um

388
00:13:54,560 --> 00:13:56,480
so when it fingerprints the machine

389
00:13:56,480 --> 00:13:58,240
very simply collect stuff like the

390
00:13:58,240 --> 00:14:00,720
process id kernel version

391
00:14:00,720 --> 00:14:02,959
network on the user

392
00:14:02,959 --> 00:14:05,600
piece that all together in a big string

393
00:14:05,600 --> 00:14:07,600
and then encrypt that and then have that

394
00:14:07,600 --> 00:14:10,000
staged strategy for being sent off to

395
00:14:10,000 --> 00:14:11,519
the c2

396
00:14:11,519 --> 00:14:13,519
for command control

397
00:14:13,519 --> 00:14:17,279
it is dns in his tdp but primarily dns

398
00:14:17,279 --> 00:14:18,720
that's that's what it

399
00:14:18,720 --> 00:14:20,399
goes for at the start

400
00:14:20,399 --> 00:14:22,880
um and the commands are received over

401
00:14:22,880 --> 00:14:25,680
address and the tax records so attacks

402
00:14:25,680 --> 00:14:27,680
as if the c2 wants to send sort of

403
00:14:27,680 --> 00:14:31,199
information down that that will decode

404
00:14:31,199 --> 00:14:33,680
that and then run the

405
00:14:33,680 --> 00:14:35,040
command for it

406
00:14:35,040 --> 00:14:36,399
what was also really interesting was

407
00:14:36,399 --> 00:14:38,320
that there was code inside the file for

408
00:14:38,320 --> 00:14:41,519
icmp communication but there was no way

409
00:14:41,519 --> 00:14:43,440
they actually got that so

410
00:14:43,440 --> 00:14:45,600
it's either a feature that's still in

411
00:14:45,600 --> 00:14:47,839
development or else they went to develop

412
00:14:47,839 --> 00:14:49,680
it and then just kind of like kind of

413
00:14:49,680 --> 00:14:51,360
dropped it so

414
00:14:51,360 --> 00:14:53,120
pretty interesting

415
00:14:53,120 --> 00:14:55,360
when it came to commands

416
00:14:55,360 --> 00:14:58,480
it can change the directory it can list

417
00:14:58,480 --> 00:15:00,560
the present working directory

418
00:15:00,560 --> 00:15:03,600
list files in your directory it can

419
00:15:03,600 --> 00:15:06,880
write the file send the file to the c2

420
00:15:06,880 --> 00:15:09,279
execute a command or it can even get a

421
00:15:09,279 --> 00:15:11,680
summary of the minded disks

422
00:15:11,680 --> 00:15:13,920
for the machine

423
00:15:13,920 --> 00:15:15,040
so

424
00:15:15,040 --> 00:15:16,320
you know looking in this sort of

425
00:15:16,320 --> 00:15:18,480
grabbing some ioc stuff from the

426
00:15:18,480 --> 00:15:20,639
configuration you know you start to try

427
00:15:20,639 --> 00:15:22,480
to pivot you know we fully understand

428
00:15:22,480 --> 00:15:23,920
what the file does

429
00:15:23,920 --> 00:15:24,639
so

430
00:15:24,639 --> 00:15:25,680
whenever

431
00:15:25,680 --> 00:15:26,639
we

432
00:15:26,639 --> 00:15:29,839
pivoted on the c2 address or the two of

433
00:15:29,839 --> 00:15:32,240
them there what we found was

434
00:15:32,240 --> 00:15:34,959
a windows stager file that reached out

435
00:15:34,959 --> 00:15:37,120
to the same one and when we actually ran

436
00:15:37,120 --> 00:15:39,680
that stager file it used powershell to

437
00:15:39,680 --> 00:15:42,560
download and execute

438
00:15:42,560 --> 00:15:44,720
a payload in memory and then we found

439
00:15:44,720 --> 00:15:46,560
out what that payload was was the

440
00:15:46,560 --> 00:15:49,440
windows version of vermilion strike

441
00:15:49,440 --> 00:15:50,639
and

442
00:15:50,639 --> 00:15:51,680
what was

443
00:15:51,680 --> 00:15:53,600
pretty funny was that it had been

444
00:15:53,600 --> 00:15:56,639
detected back in 2019 so it was you know

445
00:15:56,639 --> 00:15:58,639
a few years later and there was a tweet

446
00:15:58,639 --> 00:16:00,480
from silas cutter it was a sort of

447
00:16:00,480 --> 00:16:02,399
interesting code strike sample and

448
00:16:02,399 --> 00:16:04,399
turned out to be that vermilion strike

449
00:16:04,399 --> 00:16:05,360
one

450
00:16:05,360 --> 00:16:08,079
the functionality it's largely the same

451
00:16:08,079 --> 00:16:09,600
so if you look at one of the functions

452
00:16:09,600 --> 00:16:11,440
on the left it's done on itself and then

453
00:16:11,440 --> 00:16:14,000
on the right the windows

454
00:16:14,000 --> 00:16:16,800
version of vermilion so this is the code

455
00:16:16,800 --> 00:16:18,480
in the configuration

456
00:16:18,480 --> 00:16:20,079
so from like a graphical higher level

457
00:16:20,079 --> 00:16:21,680
it's pretty much the same as what's

458
00:16:21,680 --> 00:16:24,079
going on you're able to use the cmc too

459
00:16:24,079 --> 00:16:28,239
for all the the systems

460
00:16:28,399 --> 00:16:30,959
in the wild

461
00:16:31,440 --> 00:16:35,120
so we partnered up with mccoffee

462
00:16:35,120 --> 00:16:36,720
enterprise atr

463
00:16:36,720 --> 00:16:39,680
we provided them iocs and they queried

464
00:16:39,680 --> 00:16:41,920
it against their telemetry

465
00:16:41,920 --> 00:16:45,360
and the results were quite interesting

466
00:16:45,360 --> 00:16:48,240
we saw that vermilion strike

467
00:16:48,240 --> 00:16:50,880
actively targeted high-profile companies

468
00:16:50,880 --> 00:16:53,680
around the world this includes advisory

469
00:16:53,680 --> 00:16:56,639
companies financial institutions i.t

470
00:16:56,639 --> 00:16:59,680
government agency um and telecom now

471
00:16:59,680 --> 00:17:02,079
with that being said um it was still

472
00:17:02,079 --> 00:17:04,480
specific okay we didn't see many many

473
00:17:04,480 --> 00:17:06,880
samples and we didn't see many many

474
00:17:06,880 --> 00:17:09,360
victims

475
00:17:09,760 --> 00:17:12,400
so as for attribution

476
00:17:12,400 --> 00:17:14,959
we know that this is a backdoor

477
00:17:14,959 --> 00:17:17,760
we know that it's written from scratch

478
00:17:17,760 --> 00:17:20,640
we know that it targets both windows and

479
00:17:20,640 --> 00:17:22,959
linux

480
00:17:22,959 --> 00:17:23,760
and

481
00:17:23,760 --> 00:17:26,000
it was found in live attacks around the

482
00:17:26,000 --> 00:17:28,079
world but yet targeted

483
00:17:28,079 --> 00:17:29,440
now

484
00:17:29,440 --> 00:17:32,559
based on historical knowledge we can

485
00:17:32,559 --> 00:17:34,799
assess with high probability that

486
00:17:34,799 --> 00:17:37,840
vermilion strike was developed by a high

487
00:17:37,840 --> 00:17:40,080
profile adversary

488
00:17:40,080 --> 00:17:43,360
specifically probably a nation state

489
00:17:43,360 --> 00:17:45,360
however we couldn't

490
00:17:45,360 --> 00:17:49,199
attribute it to a specific one

491
00:17:50,400 --> 00:17:51,360
so

492
00:17:51,360 --> 00:17:53,919
the windows version of vermilion strike

493
00:17:53,919 --> 00:17:55,200
got

494
00:17:55,200 --> 00:17:57,919
a nice amount of detections by security

495
00:17:57,919 --> 00:17:59,760
vendors in virustotal

496
00:17:59,760 --> 00:18:02,160
but the linux version got none

497
00:18:02,160 --> 00:18:03,760
although it had string reviews with

498
00:18:03,760 --> 00:18:06,880
global strike and it triggered er rules

499
00:18:06,880 --> 00:18:09,039
which i think are probably

500
00:18:09,039 --> 00:18:10,160
publicly

501
00:18:10,160 --> 00:18:12,080
available

502
00:18:12,080 --> 00:18:14,880
and this raises the question of why

503
00:18:14,880 --> 00:18:16,400
linux malware

504
00:18:16,400 --> 00:18:18,960
fly under the radar

505
00:18:18,960 --> 00:18:20,799
let me show you this screenshot taken

506
00:18:20,799 --> 00:18:24,640
from ubuntu's official website

507
00:18:24,640 --> 00:18:26,000
it has

508
00:18:26,000 --> 00:18:28,640
the title do i need antivirus software

509
00:18:28,640 --> 00:18:31,520
and i marked two sentences

510
00:18:31,520 --> 00:18:32,799
first sentence

511
00:18:32,799 --> 00:18:35,600
anti-virus software does exist for linux

512
00:18:35,600 --> 00:18:38,000
but you probably don't need to use it

513
00:18:38,000 --> 00:18:39,360
second

514
00:18:39,360 --> 00:18:42,400
whatever the reason linux viruses are so

515
00:18:42,400 --> 00:18:44,720
rare that you don't really need to worry

516
00:18:44,720 --> 00:18:47,039
about them at the moment

517
00:18:47,039 --> 00:18:48,080
so

518
00:18:48,080 --> 00:18:50,160
this misconception

519
00:18:50,160 --> 00:18:52,400
leads to low demand for linux and

520
00:18:52,400 --> 00:18:53,840
malware detection

521
00:18:53,840 --> 00:18:54,799
which

522
00:18:54,799 --> 00:18:56,799
shifts away security vendors from

523
00:18:56,799 --> 00:18:59,600
spending time and resources

524
00:18:59,600 --> 00:19:01,679
on linux detection

525
00:19:01,679 --> 00:19:04,559
which leads to these scenarios

526
00:19:04,559 --> 00:19:06,160
this is a

527
00:19:06,160 --> 00:19:07,840
mirai sample

528
00:19:07,840 --> 00:19:09,679
mirai is one of the most

529
00:19:09,679 --> 00:19:13,120
popular botnets around targeting linux

530
00:19:13,120 --> 00:19:14,720
it has many variant

531
00:19:14,720 --> 00:19:17,679
variants its source code was released

532
00:19:17,679 --> 00:19:20,320
publicly a while back

533
00:19:20,320 --> 00:19:23,679
and the developer of this sample added a

534
00:19:23,679 --> 00:19:26,400
spice of sophistication and obfuscated

535
00:19:26,400 --> 00:19:28,400
some functions and strings and this is

536
00:19:28,400 --> 00:19:30,480
the result none of the security vendors

537
00:19:30,480 --> 00:19:33,919
in virustotal detected it

538
00:19:34,480 --> 00:19:37,600
and i find this really really disturbing

539
00:19:37,600 --> 00:19:38,480
and

540
00:19:38,480 --> 00:19:40,400
this is one of the takeaways from our

541
00:19:40,400 --> 00:19:41,760
talk is that

542
00:19:41,760 --> 00:19:43,919
we really should um

543
00:19:43,919 --> 00:19:45,280
spend time

544
00:19:45,280 --> 00:19:48,160
with detecting linux malware we should

545
00:19:48,160 --> 00:19:51,919
it is it is around okay and integer is

546
00:19:51,919 --> 00:19:53,760
rapidly uh

547
00:19:53,760 --> 00:19:55,600
posting blogs about it and we're going

548
00:19:55,600 --> 00:19:58,320
to post another research very very soon

549
00:19:58,320 --> 00:19:59,600
i think

550
00:19:59,600 --> 00:20:01,280
two or three or

551
00:20:01,280 --> 00:20:03,918
so yeah

552
00:20:05,039 --> 00:20:07,280
okay

553
00:20:07,280 --> 00:20:08,559
so um

554
00:20:08,559 --> 00:20:10,960
sort of as sort of wrap up you know how

555
00:20:10,960 --> 00:20:13,440
would you protect yourself um

556
00:20:13,440 --> 00:20:15,760
against the vermilion strike

557
00:20:15,760 --> 00:20:18,000
um for the windows version

558
00:20:18,000 --> 00:20:21,280
it's a memory only payload so you see

559
00:20:21,280 --> 00:20:22,240
you have to make sure that you have

560
00:20:22,240 --> 00:20:23,760
antivirus or

561
00:20:23,760 --> 00:20:24,799
uh

562
00:20:24,799 --> 00:20:27,039
edr even like a endpoint scanner it's

563
00:20:27,039 --> 00:20:29,039
able to get that in memory

564
00:20:29,039 --> 00:20:30,480
um

565
00:20:30,480 --> 00:20:32,480
or you can

566
00:20:32,480 --> 00:20:34,080
you can get it by the stager as well so

567
00:20:34,080 --> 00:20:36,720
the stager we found it was also a unique

568
00:20:36,720 --> 00:20:38,880
code so we're pretty happy to say that

569
00:20:38,880 --> 00:20:40,720
if that stager is there then you're

570
00:20:40,720 --> 00:20:42,559
probably infected with vermilion strike

571
00:20:42,559 --> 00:20:43,440
as well

572
00:20:43,440 --> 00:20:45,760
um the linux version a way more simple

573
00:20:45,760 --> 00:20:47,360
there's no stager for that that can be

574
00:20:47,360 --> 00:20:48,720
found on desk

575
00:20:48,720 --> 00:20:49,600
um

576
00:20:49,600 --> 00:20:51,360
some of the cobbled strike

577
00:20:51,360 --> 00:20:53,440
methods for detection you can use that

578
00:20:53,440 --> 00:20:55,520
for vermilion strike as well

579
00:20:55,520 --> 00:20:57,840
and um

580
00:20:57,840 --> 00:20:59,760
you know and we saw that with like the

581
00:20:59,760 --> 00:21:02,080
arrow rules and all and you can also get

582
00:21:02,080 --> 00:21:04,400
it uh by the network since

583
00:21:04,400 --> 00:21:06,240
it's communicating in the background

584
00:21:06,240 --> 00:21:09,280
with a couple strike c2 you know those

585
00:21:09,280 --> 00:21:12,000
sort of uh other methods will work as

586
00:21:12,000 --> 00:21:13,039
well

587
00:21:13,039 --> 00:21:13,919
um

588
00:21:13,919 --> 00:21:16,559
for protections for the future really

589
00:21:16,559 --> 00:21:19,520
it's uh well so for cobblestrike itself

590
00:21:19,520 --> 00:21:22,000
it will probably remain quite a big um

591
00:21:22,000 --> 00:21:23,200
frat

592
00:21:23,200 --> 00:21:25,200
uh for the windows space i could still

593
00:21:25,200 --> 00:21:26,400
be in minty and there's still new

594
00:21:26,400 --> 00:21:28,480
versions coming out and then cracks like

595
00:21:28,480 --> 00:21:30,240
following that pretty soon after you can

596
00:21:30,240 --> 00:21:32,320
get that online and it still seems to

597
00:21:32,320 --> 00:21:33,760
work pretty well

598
00:21:33,760 --> 00:21:34,960
so it does

599
00:21:34,960 --> 00:21:37,440
um vermilion strike is a bit hard to say

600
00:21:37,440 --> 00:21:39,120
as we find you know

601
00:21:39,120 --> 00:21:41,440
the code for the windows version hadn't

602
00:21:41,440 --> 00:21:42,840
changed since

603
00:21:42,840 --> 00:21:45,600
2019 it hadn't affected too many people

604
00:21:45,600 --> 00:21:48,320
but it was still active when we found it

605
00:21:48,320 --> 00:21:50,559
so it's been going for a few years

606
00:21:50,559 --> 00:21:52,640
and they haven't been detected so why

607
00:21:52,640 --> 00:21:54,159
not a couple more

608
00:21:54,159 --> 00:21:55,760
um but one thing we are pretty certain

609
00:21:55,760 --> 00:21:58,080
is that the cross-platform malware will

610
00:21:58,080 --> 00:22:00,880
uh continue and we see quite a lot

611
00:22:00,880 --> 00:22:02,240
especially you know with the rise of

612
00:22:02,240 --> 00:22:03,679
cloud and all

613
00:22:03,679 --> 00:22:05,919
um the incentive for

614
00:22:05,919 --> 00:22:08,799
targeting both windows and linux

615
00:22:08,799 --> 00:22:10,320
is still there

616
00:22:10,320 --> 00:22:12,480
and what that always says thank you very

617
00:22:12,480 --> 00:22:14,400
much and if anyone has any questions

618
00:22:14,400 --> 00:22:17,330
that's the qr code for the blog there

619
00:22:17,330 --> 00:22:23,039
[Applause]

620
00:22:25,840 --> 00:22:29,120
okay thank you abby and ryan um

621
00:22:29,120 --> 00:22:31,039
we got a few minutes for questions

622
00:22:31,039 --> 00:22:33,200
questions anybody

623
00:22:33,200 --> 00:22:35,440
anyone

624
00:22:35,440 --> 00:22:37,679
okay well i have a question i guess real

625
00:22:37,679 --> 00:22:38,559
quick

626
00:22:38,559 --> 00:22:41,600
um so clam av

627
00:22:41,600 --> 00:22:44,559
could that detect it

628
00:22:46,000 --> 00:22:49,120
it's on linux

629
00:22:51,600 --> 00:22:52,400
and

630
00:22:52,400 --> 00:22:53,919
okay we need to test it i don't know

631
00:22:53,919 --> 00:22:56,000
yeah put a signature for uh clam av on

632
00:22:56,000 --> 00:22:57,840
that i mean from from moving forward

633
00:22:57,840 --> 00:23:00,720
yeah of course um

634
00:23:00,720 --> 00:23:03,840
okay cool cool yeah i love linux

635
00:23:03,840 --> 00:23:05,919
backwards and forwards so they would see

636
00:23:05,919 --> 00:23:10,240
that on servers right yeah

637
00:23:10,559 --> 00:23:13,520
uh aws probably okay so anybody

638
00:23:13,520 --> 00:23:16,400
questions beyond me

639
00:23:16,400 --> 00:23:19,039
all right well um thank you very much

640
00:23:19,039 --> 00:23:21,200
for your time and i really do appreciate

641
00:23:21,200 --> 00:23:23,200
you sharing your knowledge so

642
00:23:23,200 --> 00:23:24,799
let's give it a round of applause for

643
00:23:24,799 --> 00:23:26,159
these folks

644
00:23:26,159 --> 00:23:27,919
awesome awesome

645
00:23:27,919 --> 00:23:29,110
thank you

646
00:23:29,110 --> 00:23:32,199
[Applause]

