1
00:00:00,160 --> 00:00:02,879
we have uh eric here from lemonshark he

2
00:00:02,879 --> 00:00:04,960
is a security consultant with a

3
00:00:04,960 --> 00:00:07,600
technical background

4
00:00:07,600 --> 00:00:09,280
uh he has handled security topics like

5
00:00:09,280 --> 00:00:10,240
uh

6
00:00:10,240 --> 00:00:12,320
cnn sock purple team pen testing and

7
00:00:12,320 --> 00:00:13,920
compliance he's going to be speaking

8
00:00:13,920 --> 00:00:16,400
with us today about some ransomware

9
00:00:16,400 --> 00:00:19,919
issues should be a lot of fun

10
00:00:20,160 --> 00:00:21,520
okay then

11
00:00:21,520 --> 00:00:23,600
hi everyone

12
00:00:23,600 --> 00:00:25,519
welcome to my talk

13
00:00:25,519 --> 00:00:27,519
and it's good to be here and really

14
00:00:27,519 --> 00:00:29,599
fantastic to be in a beautiful city like

15
00:00:29,599 --> 00:00:30,480
this

16
00:00:30,480 --> 00:00:32,640
and i've already seen and like the

17
00:00:32,640 --> 00:00:34,480
atmosphere around the open mindedness

18
00:00:34,480 --> 00:00:35,840
and everything

19
00:00:35,840 --> 00:00:37,760
so it's very good and also to see

20
00:00:37,760 --> 00:00:39,760
everyone here in person

21
00:00:39,760 --> 00:00:41,040
now

22
00:00:41,040 --> 00:00:43,200
my name is eric i work for lemon shark

23
00:00:43,200 --> 00:00:45,440
which is a cyber security consultancy

24
00:00:45,440 --> 00:00:47,600
company am i particularly interested in

25
00:00:47,600 --> 00:00:49,039
topics like

26
00:00:49,039 --> 00:00:51,199
the offensive kind of security and the

27
00:00:51,199 --> 00:00:52,879
defense kind of security that is really

28
00:00:52,879 --> 00:00:54,399
my game

29
00:00:54,399 --> 00:00:57,600
and let's have a look at the

30
00:00:57,600 --> 00:00:58,960
today's

31
00:00:58,960 --> 00:01:01,440
agenda

32
00:01:02,800 --> 00:01:04,000
there we go

33
00:01:04,000 --> 00:01:05,680
so we're going to expect today we're

34
00:01:05,680 --> 00:01:07,760
going to have a look at ransomware

35
00:01:07,760 --> 00:01:09,920
what's going to be the topic a little

36
00:01:09,920 --> 00:01:12,240
bit delicate we're going to look at the

37
00:01:12,240 --> 00:01:14,080
history of ransomware we have some

38
00:01:14,080 --> 00:01:16,560
ransomware examples and we're going to

39
00:01:16,560 --> 00:01:19,680
do a demonstration of a ransomware

40
00:01:19,680 --> 00:01:23,119
attack what to do before and after

41
00:01:23,119 --> 00:01:25,840
and i would like to summarize

42
00:01:25,840 --> 00:01:28,720
with how to prepare for an attack

43
00:01:28,720 --> 00:01:30,799
as a

44
00:01:30,799 --> 00:01:32,320
key

45
00:01:32,320 --> 00:01:34,000
to close with okay

46
00:01:34,000 --> 00:01:37,040
so let's move on to

47
00:01:37,280 --> 00:01:39,840
the recent ransomware campaigns now back

48
00:01:39,840 --> 00:01:43,240
in 2017

49
00:01:43,360 --> 00:01:46,079
there was this big attack by wannacry

50
00:01:46,079 --> 00:01:49,280
which had a lot of companies a lot of

51
00:01:49,280 --> 00:01:51,200
impact and damages from

52
00:01:51,200 --> 00:01:52,840
for instance

53
00:01:52,840 --> 00:01:55,119
also fedex

54
00:01:55,119 --> 00:01:58,000
companies and in holland

55
00:01:58,000 --> 00:01:59,600
we had also in

56
00:01:59,600 --> 00:02:02,799
rotterdam there were a lot of victims

57
00:02:02,799 --> 00:02:05,040
and to move on with that the

58
00:02:05,040 --> 00:02:06,719
ransomware

59
00:02:06,719 --> 00:02:08,959
campaign started also to increase and

60
00:02:08,959 --> 00:02:10,878
even there were

61
00:02:10,878 --> 00:02:13,520
not only compiles companies were victim

62
00:02:13,520 --> 00:02:17,360
but also hospitals for instance

63
00:02:17,360 --> 00:02:20,640
so there weren't really any ethical or

64
00:02:20,640 --> 00:02:24,080
other morals um

65
00:02:24,080 --> 00:02:25,840
as an objection to attack those

66
00:02:25,840 --> 00:02:27,840
companies as well and to give another

67
00:02:27,840 --> 00:02:29,680
idea about the impact for instance there

68
00:02:29,680 --> 00:02:32,480
was an attack on colonial pipeline

69
00:02:32,480 --> 00:02:34,959
and could you imagine how it would be

70
00:02:34,959 --> 00:02:38,879
without gas or even without water so the

71
00:02:38,879 --> 00:02:41,920
impact started to increase as well

72
00:02:41,920 --> 00:02:43,360
and then we had a

73
00:02:43,360 --> 00:02:44,640
an attack

74
00:02:44,640 --> 00:02:46,400
on the cassia

75
00:02:46,400 --> 00:02:48,879
software which is being used to manage

76
00:02:48,879 --> 00:02:50,400
other companies

77
00:02:50,400 --> 00:02:52,160
i.t infrastructure

78
00:02:52,160 --> 00:02:54,239
and that was attacked with the supply

79
00:02:54,239 --> 00:02:56,480
chain attacked by their evil

80
00:02:56,480 --> 00:02:58,480
and in that way

81
00:02:58,480 --> 00:03:00,000
they were able to

82
00:03:00,000 --> 00:03:02,239
basically to destabilize a lot of

83
00:03:02,239 --> 00:03:05,440
companies well the

84
00:03:05,440 --> 00:03:08,720
code the decryption key was accidentally

85
00:03:08,720 --> 00:03:11,040
disclosed that was the good news and

86
00:03:11,040 --> 00:03:12,959
some of them were eventually being

87
00:03:12,959 --> 00:03:14,959
caught as well

88
00:03:14,959 --> 00:03:17,280
now in holland we had

89
00:03:17,280 --> 00:03:19,120
the media marked under attack by

90
00:03:19,120 --> 00:03:22,000
ransomware it was in 2021

91
00:03:22,000 --> 00:03:24,080
and mediamark is a big retail company

92
00:03:24,080 --> 00:03:25,760
with a lot of locations

93
00:03:25,760 --> 00:03:26,879
and to

94
00:03:26,879 --> 00:03:28,879
give an estimate about the damage

95
00:03:28,879 --> 00:03:30,799
the cash registers were completely

96
00:03:30,799 --> 00:03:32,239
offline and people were not able to

97
00:03:32,239 --> 00:03:33,920
return their goods anymore so you can

98
00:03:33,920 --> 00:03:36,640
have idea about the impact there as well

99
00:03:36,640 --> 00:03:38,640
and recently we had an attack on

100
00:03:38,640 --> 00:03:40,319
microsoft company

101
00:03:40,319 --> 00:03:43,680
by lapses and they were even able to

102
00:03:43,680 --> 00:03:45,760
exfiltrate some of

103
00:03:45,760 --> 00:03:48,480
of their code

104
00:03:48,480 --> 00:03:50,319
now

105
00:03:50,319 --> 00:03:52,159
ransomware well

106
00:03:52,159 --> 00:03:54,159
maybe you know what it is

107
00:03:54,159 --> 00:03:55,920
and for the ones who don't

108
00:03:55,920 --> 00:03:58,640
it's a digital hostage situation and

109
00:03:58,640 --> 00:03:59,599
only

110
00:03:59,599 --> 00:04:01,280
by means of encryption

111
00:04:01,280 --> 00:04:03,680
and your files are only being released

112
00:04:03,680 --> 00:04:06,080
after paying a certain amount of

113
00:04:06,080 --> 00:04:09,280
cryptocurrency which usually is bitcoin

114
00:04:09,280 --> 00:04:11,760
now how does this encryption

115
00:04:11,760 --> 00:04:12,560
work

116
00:04:12,560 --> 00:04:15,360
well this is a picture of asymmetric

117
00:04:15,360 --> 00:04:17,680
encryption you have a public key and you

118
00:04:17,680 --> 00:04:19,759
have a private key

119
00:04:19,759 --> 00:04:20,798
and

120
00:04:20,798 --> 00:04:22,960
what that can basically do

121
00:04:22,960 --> 00:04:25,600
because asymmetric encryption can be

122
00:04:25,600 --> 00:04:27,120
very slow

123
00:04:27,120 --> 00:04:29,120
therefore the attacker will first

124
00:04:29,120 --> 00:04:30,880
encrypt everything with a symmetric

125
00:04:30,880 --> 00:04:32,240
algorithm

126
00:04:32,240 --> 00:04:33,840
and then the symmetric key will then be

127
00:04:33,840 --> 00:04:34,960
encrypted

128
00:04:34,960 --> 00:04:36,160
with the

129
00:04:36,160 --> 00:04:38,560
asymmetric algorithm so that is a form

130
00:04:38,560 --> 00:04:40,960
of hybrid encryption and in that way the

131
00:04:40,960 --> 00:04:42,720
attacker will benefit

132
00:04:42,720 --> 00:04:44,960
from basically two of the

133
00:04:44,960 --> 00:04:48,320
properties of encryption

134
00:04:48,400 --> 00:04:50,800
now we're going to look into some runs

135
00:04:50,800 --> 00:04:52,880
away history and you're able to see it

136
00:04:52,880 --> 00:04:55,280
started 1990 well that's not entirely

137
00:04:55,280 --> 00:04:56,400
true

138
00:04:56,400 --> 00:04:58,960
the first ransomware attack

139
00:04:58,960 --> 00:05:02,800
was done before that already in the 80s

140
00:05:02,800 --> 00:05:05,039
and that was done by someone who just

141
00:05:05,039 --> 00:05:07,680
distributed software on floppy drives to

142
00:05:07,680 --> 00:05:10,400
people who installed it and after that

143
00:05:10,400 --> 00:05:14,479
their computer restarted automatically

144
00:05:14,479 --> 00:05:16,720
they were confronted with a message in

145
00:05:16,720 --> 00:05:18,720
order to well you want to use my

146
00:05:18,720 --> 00:05:20,720
software you need to pay a certain

147
00:05:20,720 --> 00:05:22,479
amount and you can put money in an

148
00:05:22,479 --> 00:05:24,080
envelope and send it to me and then you

149
00:05:24,080 --> 00:05:25,840
can use my software well

150
00:05:25,840 --> 00:05:27,520
that was joseph poplar was in the 80s

151
00:05:27,520 --> 00:05:29,840
that was basically the first digital way

152
00:05:29,840 --> 00:05:32,560
of extortion ever

153
00:05:32,560 --> 00:05:34,639
and there were also non

154
00:05:34,639 --> 00:05:36,800
forms of digital extortion for instance

155
00:05:36,800 --> 00:05:38,960
the screen lockers and

156
00:05:38,960 --> 00:05:39,840
the

157
00:05:39,840 --> 00:05:42,320
pop-ups you had in the browser message

158
00:05:42,320 --> 00:05:45,919
there was an fbi announcement

159
00:05:45,919 --> 00:05:47,520
you need to pay an amount of money

160
00:05:47,520 --> 00:05:49,440
otherwise you would be reported to the

161
00:05:49,440 --> 00:05:51,039
authorities it was totally fake you

162
00:05:51,039 --> 00:05:52,400
could click it away

163
00:05:52,400 --> 00:05:54,720
but you could imagine some people didn't

164
00:05:54,720 --> 00:05:57,039
like that

165
00:05:57,039 --> 00:05:59,199
and next

166
00:05:59,199 --> 00:06:01,280
the ransomware got more advanced in

167
00:06:01,280 --> 00:06:04,400
terms of introducing bitcoin as a

168
00:06:04,400 --> 00:06:06,960
method of payment that was done by

169
00:06:06,960 --> 00:06:08,479
cryptolocker

170
00:06:08,479 --> 00:06:10,400
also they included

171
00:06:10,400 --> 00:06:12,720
uh remote extrajons like the zeus

172
00:06:12,720 --> 00:06:15,120
banking trojans for instance

173
00:06:15,120 --> 00:06:18,400
and then the ransomware group started to

174
00:06:18,400 --> 00:06:20,639
increase we had for instance server

175
00:06:20,639 --> 00:06:23,840
tesla crypt pecha and not petya

176
00:06:23,840 --> 00:06:27,759
and the big wannacry attack over there

177
00:06:27,759 --> 00:06:29,360
and then what happened

178
00:06:29,360 --> 00:06:32,160
the ransomware also started to get more

179
00:06:32,160 --> 00:06:35,039
advanced in a way to

180
00:06:35,039 --> 00:06:37,360
get the most out of the extortion by

181
00:06:37,360 --> 00:06:40,240
exfiltrating sensitive information

182
00:06:40,240 --> 00:06:42,240
but also trying to move lateral and

183
00:06:42,240 --> 00:06:45,600
effect other systems like being done by

184
00:06:45,600 --> 00:06:48,960
mace for instance

185
00:06:48,960 --> 00:06:51,120
okay now

186
00:06:51,120 --> 00:06:52,240
and then there were a lot of other

187
00:06:52,240 --> 00:06:53,759
species and

188
00:06:53,759 --> 00:06:56,400
like lapses we have seen already

189
00:06:56,400 --> 00:06:58,479
now i want to move on to the next

190
00:06:58,479 --> 00:07:00,639
figure and this is taken from friar's

191
00:07:00,639 --> 00:07:01,759
total

192
00:07:01,759 --> 00:07:04,960
and 20 000 won and back then grand crab

193
00:07:04,960 --> 00:07:07,360
was the top dog

194
00:07:07,360 --> 00:07:08,639
having the most

195
00:07:08,639 --> 00:07:10,960
infection worldwide now the thing about

196
00:07:10,960 --> 00:07:12,800
grand crab is

197
00:07:12,800 --> 00:07:15,039
they are probably retired

198
00:07:15,039 --> 00:07:16,880
they're not seen anymore

199
00:07:16,880 --> 00:07:18,800
and it's only effective

200
00:07:18,800 --> 00:07:23,360
in russia or ukraine for some reason

201
00:07:23,360 --> 00:07:25,759
okay

202
00:07:26,080 --> 00:07:29,520
here we have a code example of wannacry

203
00:07:29,520 --> 00:07:31,599
and do notice here

204
00:07:31,599 --> 00:07:35,120
there is a reindeer algorithm being used

205
00:07:35,120 --> 00:07:37,120
which is an advanced encryption standard

206
00:07:37,120 --> 00:07:39,840
so a way of semantic encryption

207
00:07:39,840 --> 00:07:41,520
and the other code example i have is

208
00:07:41,520 --> 00:07:43,039
from

209
00:07:43,039 --> 00:07:45,440
eternal romance and that is an exploit

210
00:07:45,440 --> 00:07:49,280
being used basically to infect via smb

211
00:07:49,280 --> 00:07:51,120
network shares

212
00:07:51,120 --> 00:07:53,840
as part of the attack

213
00:07:53,840 --> 00:07:56,000
now we have all these elements

214
00:07:56,000 --> 00:07:57,680
like for instance

215
00:07:57,680 --> 00:08:00,160
the one who is doing the negotiation

216
00:08:00,160 --> 00:08:02,240
providing the software doing the fishing

217
00:08:02,240 --> 00:08:03,440
attacks

218
00:08:03,440 --> 00:08:06,080
all kinds of elements you put them in a

219
00:08:06,080 --> 00:08:08,000
bowl and you stir it and then you have

220
00:08:08,000 --> 00:08:10,840
the end result which is ransomware as a

221
00:08:10,840 --> 00:08:13,520
service and it is just

222
00:08:13,520 --> 00:08:15,840
a way an ecosystem

223
00:08:15,840 --> 00:08:16,800
to

224
00:08:16,800 --> 00:08:19,039
have basically the best

225
00:08:19,039 --> 00:08:21,199
possible way of extortion to generate as

226
00:08:21,199 --> 00:08:24,840
much money as possible and the thing is

227
00:08:24,840 --> 00:08:27,599
also they've gotten so big

228
00:08:27,599 --> 00:08:29,120
because the

229
00:08:29,120 --> 00:08:30,240
currency

230
00:08:30,240 --> 00:08:33,279
in bitcoin was uh increasing in the time

231
00:08:33,279 --> 00:08:35,039
and they benefit from that also they

232
00:08:35,039 --> 00:08:36,240
were able to

233
00:08:36,240 --> 00:08:38,799
expand their businesses

234
00:08:38,799 --> 00:08:41,679
so very lucrative way in order to earn

235
00:08:41,679 --> 00:08:45,680
earn not good work but

236
00:08:46,240 --> 00:08:48,480
to uh benefit from it

237
00:08:48,480 --> 00:08:51,360
so here we have a ransomware kill chain

238
00:08:51,360 --> 00:08:54,240
which looks uh quite similar like a

239
00:08:54,240 --> 00:08:56,480
cyber kill chain basically it starts

240
00:08:56,480 --> 00:08:58,880
with an infection a delivery a phishing

241
00:08:58,880 --> 00:09:00,240
email

242
00:09:00,240 --> 00:09:02,320
then there is a reverse connection being

243
00:09:02,320 --> 00:09:05,200
made with a c2c a connection for

244
00:09:05,200 --> 00:09:07,200
instance cobalt strike then the attacker

245
00:09:07,200 --> 00:09:09,200
full control over the system

246
00:09:09,200 --> 00:09:11,120
then the encryption will start generate

247
00:09:11,120 --> 00:09:13,279
public and private key and during the

248
00:09:13,279 --> 00:09:15,360
encryption the private key will remain

249
00:09:15,360 --> 00:09:17,680
on the attacker server

250
00:09:17,680 --> 00:09:19,920
and then when the files are encrypted

251
00:09:19,920 --> 00:09:21,200
the

252
00:09:21,200 --> 00:09:24,720
instructions are left behind how to pay

253
00:09:24,720 --> 00:09:26,720
to release the files

254
00:09:26,720 --> 00:09:28,800
now when it's happened on a single

255
00:09:28,800 --> 00:09:31,519
workstation or on a server or it could

256
00:09:31,519 --> 00:09:33,279
be also a network attached system for

257
00:09:33,279 --> 00:09:34,399
instance

258
00:09:34,399 --> 00:09:36,240
now we classified it as an attack type

259
00:09:36,240 --> 00:09:37,760
one

260
00:09:37,760 --> 00:09:40,399
and when there are more devices involved

261
00:09:40,399 --> 00:09:42,160
for instance the attacker has a foothold

262
00:09:42,160 --> 00:09:43,760
on the system and wants to

263
00:09:43,760 --> 00:09:46,160
try to move lateral and actual rate

264
00:09:46,160 --> 00:09:48,640
sensitive information and

265
00:09:48,640 --> 00:09:51,600
also try to cover the traces remove and

266
00:09:51,600 --> 00:09:54,080
destroy the or encrypt the backups

267
00:09:54,080 --> 00:09:55,600
then we call that a

268
00:09:55,600 --> 00:09:57,440
attack type 2

269
00:09:57,440 --> 00:10:00,160
form of attack

270
00:10:00,640 --> 00:10:03,040
now what we're going to do today

271
00:10:03,040 --> 00:10:04,800
is we're going to

272
00:10:04,800 --> 00:10:08,240
deliver a phishing email to the victim

273
00:10:08,240 --> 00:10:10,959
the victim will actually fall into that

274
00:10:10,959 --> 00:10:15,920
catch debate and click on the attachment

275
00:10:16,160 --> 00:10:18,000
then the malware dropper kicks in we

276
00:10:18,000 --> 00:10:20,320
have a full hole on the system

277
00:10:20,320 --> 00:10:22,480
later on we're going to raise our

278
00:10:22,480 --> 00:10:24,240
privileges

279
00:10:24,240 --> 00:10:25,920
in order to

280
00:10:25,920 --> 00:10:28,320
see if there are any more credentials we

281
00:10:28,320 --> 00:10:30,240
can collect

282
00:10:30,240 --> 00:10:31,120
and

283
00:10:31,120 --> 00:10:33,360
when it's been done we're going to try

284
00:10:33,360 --> 00:10:36,640
to move lateral to eventually encrypt

285
00:10:36,640 --> 00:10:40,720
this domain console right here

286
00:10:41,839 --> 00:10:44,079
so i would just advise

287
00:10:44,079 --> 00:10:47,839
to sit back and relax

288
00:10:48,800 --> 00:10:50,560
and watch the show

289
00:10:50,560 --> 00:10:52,399
but before we're going to start

290
00:10:52,399 --> 00:10:54,880
i would like to point out that

291
00:10:54,880 --> 00:10:57,200
the delivery is being done by a

292
00:10:57,200 --> 00:10:58,480
powerpoint

293
00:10:58,480 --> 00:11:00,560
presentation and i would like to point

294
00:11:00,560 --> 00:11:02,880
out it's not the same presentation i've

295
00:11:02,880 --> 00:11:05,440
used to submit to this clock it's for

296
00:11:05,440 --> 00:11:08,560
demonstration purposes only

297
00:11:08,560 --> 00:11:10,560
okay

298
00:11:10,560 --> 00:11:11,600
now here

299
00:11:11,600 --> 00:11:16,640
i'm going to type a phishing email

300
00:11:18,399 --> 00:11:21,839
and do notice also my poor

301
00:11:21,839 --> 00:11:23,760
english writing

302
00:11:23,760 --> 00:11:25,360
and that could be just part of a social

303
00:11:25,360 --> 00:11:27,920
nearing way of attack because the victim

304
00:11:27,920 --> 00:11:30,720
might expect some email about from a

305
00:11:30,720 --> 00:11:33,279
dutch guy

306
00:11:38,399 --> 00:11:40,720
and next i only have to send this email

307
00:11:40,720 --> 00:11:43,839
to the victim

308
00:11:47,440 --> 00:11:51,600
and the victim has received the email

309
00:11:53,279 --> 00:11:55,120
and notice hey

310
00:11:55,120 --> 00:11:57,760
i might have an attachment here i want

311
00:11:57,760 --> 00:12:00,399
to have a look at

312
00:12:04,560 --> 00:12:06,160
so next

313
00:12:06,160 --> 00:12:07,440
it seems that it's a powerpoint

314
00:12:07,440 --> 00:12:08,880
presentation

315
00:12:08,880 --> 00:12:10,720
but the content is disabled so the

316
00:12:10,720 --> 00:12:14,320
victim enables the content here

317
00:12:17,680 --> 00:12:19,760
and then it seems

318
00:12:19,760 --> 00:12:22,079
the attacker has already started a

319
00:12:22,079 --> 00:12:24,560
reverse shell in the background or a

320
00:12:24,560 --> 00:12:27,040
listener in order to wait for a review

321
00:12:27,040 --> 00:12:29,040
show coming in

322
00:12:29,040 --> 00:12:30,720
and when that happened here now the

323
00:12:30,720 --> 00:12:34,320
attacker has foothold on that system

324
00:12:34,320 --> 00:12:36,399
okay now we're going to

325
00:12:36,399 --> 00:12:38,959
in the next phase going to look for

326
00:12:38,959 --> 00:12:41,360
privilege escalation

327
00:12:41,360 --> 00:12:43,040
so what the detector will do next is

328
00:12:43,040 --> 00:12:46,240
first listen on the network

329
00:12:46,240 --> 00:12:48,240
by using

330
00:12:48,240 --> 00:12:50,959
a responder

331
00:12:51,440 --> 00:12:53,839
and it's just looking for all kinds of

332
00:12:53,839 --> 00:12:56,240
events on the network

333
00:12:56,240 --> 00:12:57,360
and just

334
00:12:57,360 --> 00:13:00,639
accidentally the victim can browse for a

335
00:13:00,639 --> 00:13:03,760
particular server and maybe make a typo

336
00:13:03,760 --> 00:13:05,200
but in the meanwhile

337
00:13:05,200 --> 00:13:06,800
in the background some kind of

338
00:13:06,800 --> 00:13:10,639
negotiation is already going on

339
00:13:11,519 --> 00:13:13,600
and the attacker will benefit from that

340
00:13:13,600 --> 00:13:15,600
by catching

341
00:13:15,600 --> 00:13:19,519
that negotiation and catching the hash

342
00:13:19,680 --> 00:13:22,160
and when the attacker has the hash he is

343
00:13:22,160 --> 00:13:23,279
able to

344
00:13:23,279 --> 00:13:27,760
decrypt it and get the user's password

345
00:13:29,360 --> 00:13:31,120
so the next thing what the attacker will

346
00:13:31,120 --> 00:13:35,760
do is try to see if there is a way to

347
00:13:35,760 --> 00:13:38,959
elevate his permissions

348
00:13:38,959 --> 00:13:41,839
so in this case the attacker will upload

349
00:13:41,839 --> 00:13:44,079
a certain kind of script

350
00:13:44,079 --> 00:13:47,040
to the victim machine

351
00:13:47,040 --> 00:13:49,120
which will retrieve

352
00:13:49,120 --> 00:13:50,639
a particular

353
00:13:50,639 --> 00:13:53,600
registry key what the victim

354
00:13:53,600 --> 00:13:55,279
has set

355
00:13:55,279 --> 00:13:56,880
without knowing

356
00:13:56,880 --> 00:13:57,920
enabling

357
00:13:57,920 --> 00:13:59,519
automated logon

358
00:13:59,519 --> 00:14:01,839
well it's not a very smart thing to do

359
00:14:01,839 --> 00:14:03,839
because when that happens

360
00:14:03,839 --> 00:14:05,440
the password

361
00:14:05,440 --> 00:14:07,440
is in clear text

362
00:14:07,440 --> 00:14:09,600
and we have also now the local admin

363
00:14:09,600 --> 00:14:11,600
password

364
00:14:11,600 --> 00:14:13,279
so next

365
00:14:13,279 --> 00:14:15,519
we are still connected with a regular

366
00:14:15,519 --> 00:14:17,760
user account to the shell so what we're

367
00:14:17,760 --> 00:14:19,440
going to do next is put the shell in the

368
00:14:19,440 --> 00:14:21,040
background

369
00:14:21,040 --> 00:14:23,040
and going to upgrade it by using a

370
00:14:23,040 --> 00:14:26,319
certain kind of exploit

371
00:14:28,720 --> 00:14:31,839
when that's been done

372
00:14:33,040 --> 00:14:35,279
we should now have

373
00:14:35,279 --> 00:14:37,279
elevated rights

374
00:14:37,279 --> 00:14:41,120
on our existing interpreter shell

375
00:14:41,760 --> 00:14:44,240
and we are now a administrator on the

376
00:14:44,240 --> 00:14:47,519
system so now we are already have more

377
00:14:47,519 --> 00:14:50,079
possibilities in order to advance our

378
00:14:50,079 --> 00:14:52,399
attack

379
00:14:54,240 --> 00:14:56,880
so next what we're going to do is

380
00:14:56,880 --> 00:14:58,800
use the credentials we found the

381
00:14:58,800 --> 00:15:01,279
password and our elevated missions and

382
00:15:01,279 --> 00:15:03,199
going to use that to

383
00:15:03,199 --> 00:15:04,720
explore the shortest path to domain

384
00:15:04,720 --> 00:15:06,959
controller domain admin and see

385
00:15:06,959 --> 00:15:09,040
if we can get everything together to

386
00:15:09,040 --> 00:15:10,639
create

387
00:15:10,639 --> 00:15:12,720
a ticket and log on to the main control

388
00:15:12,720 --> 00:15:16,240
to deploy our malware

389
00:15:17,680 --> 00:15:18,880
so first

390
00:15:18,880 --> 00:15:21,279
we're going to

391
00:15:21,279 --> 00:15:23,760
upload

392
00:15:24,079 --> 00:15:26,240
sharpount

393
00:15:26,240 --> 00:15:28,560
sharpound will collect for us the

394
00:15:28,560 --> 00:15:30,880
information we need

395
00:15:30,880 --> 00:15:32,560
to find the short path to the main

396
00:15:32,560 --> 00:15:35,119
controller

397
00:15:36,079 --> 00:15:40,199
so we're going to execute it

398
00:15:42,959 --> 00:15:44,399
and then sharp hound will collect all

399
00:15:44,399 --> 00:15:47,360
the information we'll need

400
00:15:47,839 --> 00:15:49,120
and once it's been done we're going to

401
00:15:49,120 --> 00:15:50,880
start bloodhound and the bloodhound

402
00:15:50,880 --> 00:15:53,680
server will consume all of the sharpness

403
00:15:53,680 --> 00:15:56,480
information to map out the network so we

404
00:15:56,480 --> 00:15:58,240
able to see what the shortest path will

405
00:15:58,240 --> 00:16:01,440
be to the domain controller

406
00:16:02,880 --> 00:16:04,720
so that happens here click on shortest

407
00:16:04,720 --> 00:16:07,040
path

408
00:16:07,680 --> 00:16:10,639
and notice here we've got the full

409
00:16:10,639 --> 00:16:12,720
attack

410
00:16:12,720 --> 00:16:15,040
path to the domain admin right here we

411
00:16:15,040 --> 00:16:19,199
can use to attack the domain controller

412
00:16:20,000 --> 00:16:21,199
okay

413
00:16:21,199 --> 00:16:24,560
so when it's been done the next thing we

414
00:16:24,560 --> 00:16:27,440
need is to create a ticket

415
00:16:27,440 --> 00:16:28,639
and therefore

416
00:16:28,639 --> 00:16:32,480
we need also the kerberos hash of the

417
00:16:32,480 --> 00:16:34,320
service count which runs under the main

418
00:16:34,320 --> 00:16:35,600
controller

419
00:16:35,600 --> 00:16:38,800
we've collected right here

420
00:16:41,120 --> 00:16:44,959
now we're going to bump into the shell

421
00:16:44,959 --> 00:16:47,040
and we're going to start mimikats

422
00:16:47,040 --> 00:16:49,680
because we also need the antelope hashes

423
00:16:49,680 --> 00:16:51,600
to combine with the kerberos hash to

424
00:16:51,600 --> 00:16:53,440
make our ticket

425
00:16:53,440 --> 00:16:54,959
to be able to log on to the domain

426
00:16:54,959 --> 00:16:57,518
controller

427
00:17:01,759 --> 00:17:05,399
when that's been done

428
00:17:06,880 --> 00:17:09,520
we combine that information

429
00:17:09,520 --> 00:17:11,199
we have a ticket now

430
00:17:11,199 --> 00:17:13,599
to create the ticket is now put into

431
00:17:13,599 --> 00:17:15,359
memory and the only thing we have to do

432
00:17:15,359 --> 00:17:17,760
now is to remote connect to the domain

433
00:17:17,760 --> 00:17:22,000
controller and just deploy the malware

434
00:17:29,600 --> 00:17:32,480
and it's happening right here

435
00:17:32,480 --> 00:17:35,039
so see we already have a connection we

436
00:17:35,039 --> 00:17:36,160
have the host name of the domain

437
00:17:36,160 --> 00:17:37,679
controller

438
00:17:37,679 --> 00:17:40,720
we are administrator

439
00:17:41,120 --> 00:17:42,799
and now we're going to

440
00:17:42,799 --> 00:17:44,799
upload

441
00:17:44,799 --> 00:17:47,120
the malware which is executing the

442
00:17:47,120 --> 00:17:50,080
ransomware for us

443
00:17:53,039 --> 00:17:55,760
and there we go

444
00:17:56,400 --> 00:17:57,919
and now we only have to

445
00:17:57,919 --> 00:17:59,039
execute

446
00:17:59,039 --> 00:18:01,120
the file we just uploaded

447
00:18:01,120 --> 00:18:04,719
sorry about my typing here by the way

448
00:18:10,720 --> 00:18:12,480
and do notice

449
00:18:12,480 --> 00:18:14,880
we've got a grand crab ransomware

450
00:18:14,880 --> 00:18:16,799
infection now going on this domain

451
00:18:16,799 --> 00:18:17,760
console

452
00:18:17,760 --> 00:18:18,799
oh dear

453
00:18:18,799 --> 00:18:21,039
what we have to do now

454
00:18:21,039 --> 00:18:24,080
well if we got a infection like this

455
00:18:24,080 --> 00:18:26,799
it can be too late obviously but we want

456
00:18:26,799 --> 00:18:29,280
to prevent it's going to spread even

457
00:18:29,280 --> 00:18:31,039
further but before

458
00:18:31,039 --> 00:18:33,520
we even know there is an infection going

459
00:18:33,520 --> 00:18:35,039
on

460
00:18:35,039 --> 00:18:37,679
there are ways in order to

461
00:18:37,679 --> 00:18:40,720
look for indicators which can lead to an

462
00:18:40,720 --> 00:18:42,160
infection and that is what we're going

463
00:18:42,160 --> 00:18:44,799
to do with a seam system security event

464
00:18:44,799 --> 00:18:46,799
monitoring we're going to do some threat

465
00:18:46,799 --> 00:18:50,080
hunting on certain indicators of attack

466
00:18:50,080 --> 00:18:51,440
which could lead to a ransomware

467
00:18:51,440 --> 00:18:53,919
infection

468
00:18:53,919 --> 00:18:56,000
so basically that happens as follows is

469
00:18:56,000 --> 00:18:58,000
that you have all your pyramid devices

470
00:18:58,000 --> 00:18:59,440
here on the network like the firewalls

471
00:18:59,440 --> 00:19:01,919
and proxy server email gateway and they

472
00:19:01,919 --> 00:19:04,799
are sending over their logs to a sim

473
00:19:04,799 --> 00:19:05,840
system

474
00:19:05,840 --> 00:19:07,840
which is here

475
00:19:07,840 --> 00:19:09,440
and all the bad things are happening

476
00:19:09,440 --> 00:19:11,520
here and also inside the network are

477
00:19:11,520 --> 00:19:13,600
being captured in the log files

478
00:19:13,600 --> 00:19:16,160
and eventually collected and now we're

479
00:19:16,160 --> 00:19:17,919
going to just to browse through all

480
00:19:17,919 --> 00:19:20,000
these log files by doing queries

481
00:19:20,000 --> 00:19:22,480
in order to

482
00:19:22,480 --> 00:19:24,720
filter the information we need

483
00:19:24,720 --> 00:19:27,440
to see if there is really a ransomware

484
00:19:27,440 --> 00:19:30,160
attack going on

485
00:19:30,160 --> 00:19:32,480
and we start here by just one and simple

486
00:19:32,480 --> 00:19:34,880
query

487
00:19:34,880 --> 00:19:37,440
to see if there is a particular file

488
00:19:37,440 --> 00:19:39,440
extension on our system

489
00:19:39,440 --> 00:19:42,320
which could be related to a ransomware

490
00:19:42,320 --> 00:19:43,520
indication

491
00:19:43,520 --> 00:19:45,840
and do notice i think there are quite a

492
00:19:45,840 --> 00:19:48,160
lot of dot log files

493
00:19:48,160 --> 00:19:50,480
already being found here

494
00:19:50,480 --> 00:19:52,400
so that's our first type of evidence we

495
00:19:52,400 --> 00:19:54,160
have found

496
00:19:54,160 --> 00:19:55,679
next we're going to look for some

497
00:19:55,679 --> 00:19:58,320
ransomware nodes

498
00:19:58,320 --> 00:20:00,559
and basically it's the same idea

499
00:20:00,559 --> 00:20:03,440
we're on a query

500
00:20:04,400 --> 00:20:08,000
we gather all the information in there

501
00:20:08,480 --> 00:20:10,960
and if i'm correct i already

502
00:20:10,960 --> 00:20:14,720
noticed here some decrypt.txt which

503
00:20:14,720 --> 00:20:17,200
is enough evidence to

504
00:20:17,200 --> 00:20:19,120
actually

505
00:20:19,120 --> 00:20:23,520
confirm that it's a ransomware infection

506
00:20:23,600 --> 00:20:25,200
and next we're going to run another

507
00:20:25,200 --> 00:20:26,480
query

508
00:20:26,480 --> 00:20:30,799
and we're going to examine if there is

509
00:20:30,799 --> 00:20:33,760
um some evidence about malicious

510
00:20:33,760 --> 00:20:36,640
software being used between

511
00:20:36,640 --> 00:20:38,080
machines there was a connection right

512
00:20:38,080 --> 00:20:40,799
here and there was mimikats being used

513
00:20:40,799 --> 00:20:42,240
here so

514
00:20:42,240 --> 00:20:45,280
that us our third type of evidence we

515
00:20:45,280 --> 00:20:49,039
needed to start in our investigation

516
00:20:49,039 --> 00:20:51,360
well basically there are a lot more

517
00:20:51,360 --> 00:20:52,880
indicators of attack

518
00:20:52,880 --> 00:20:57,120
and for instance we also could look for

519
00:20:57,120 --> 00:21:00,000
event log here

520
00:21:00,240 --> 00:21:01,280
usually

521
00:21:01,280 --> 00:21:03,039
part of an attack is that the event lock

522
00:21:03,039 --> 00:21:04,880
is going to be cleared to

523
00:21:04,880 --> 00:21:06,480
make sure there is no

524
00:21:06,480 --> 00:21:09,039
evidence what could relate to an attack

525
00:21:09,039 --> 00:21:11,039
and that is something we can include in

526
00:21:11,039 --> 00:21:12,720
our searches as well

527
00:21:12,720 --> 00:21:14,880
in our example we used a powerpoint file

528
00:21:14,880 --> 00:21:16,799
and the file type can also be included

529
00:21:16,799 --> 00:21:19,039
in the search if necessary

530
00:21:19,039 --> 00:21:21,600
and also

531
00:21:21,600 --> 00:21:23,760
part of an attack usually sharp hound is

532
00:21:23,760 --> 00:21:25,120
used very low

533
00:21:25,120 --> 00:21:27,280
very often there is also something we

534
00:21:27,280 --> 00:21:29,600
can include here as well

535
00:21:29,600 --> 00:21:32,960
and not even in this picture

536
00:21:32,960 --> 00:21:34,000
usually

537
00:21:34,000 --> 00:21:36,720
the attacker will try to disable

538
00:21:36,720 --> 00:21:41,600
antivirus software in order to not being

539
00:21:41,919 --> 00:21:44,400
mitigated from the attack and

540
00:21:44,400 --> 00:21:46,400
particularly real-time monitoring and

541
00:21:46,400 --> 00:21:48,559
that could be included as well

542
00:21:48,559 --> 00:21:51,120
in the search if necessary there are

543
00:21:51,120 --> 00:21:53,520
tons more of indicators which can put in

544
00:21:53,520 --> 00:21:56,000
the searches but these are particularly

545
00:21:56,000 --> 00:21:59,840
interesting for our investigation

546
00:22:00,000 --> 00:22:03,600
now what we have seen now basically is a

547
00:22:03,600 --> 00:22:05,360
red team exercise

548
00:22:05,360 --> 00:22:08,080
with an offensive kind of game

549
00:22:08,080 --> 00:22:10,559
like the fishing attack and the way

550
00:22:10,559 --> 00:22:13,919
distributing the the malicious payload

551
00:22:13,919 --> 00:22:16,640
and you have seen the blue team

552
00:22:16,640 --> 00:22:19,679
looking for threat hunting in order to

553
00:22:19,679 --> 00:22:22,640
mitigate and build up the defenses

554
00:22:22,640 --> 00:22:26,240
and it's a very good thing to do also

555
00:22:26,240 --> 00:22:28,320
when you want to practice those kind of

556
00:22:28,320 --> 00:22:29,280
things

557
00:22:29,280 --> 00:22:30,799
and you want to make sure

558
00:22:30,799 --> 00:22:33,120
that if a ransomware ever

559
00:22:33,120 --> 00:22:34,240
hits your

560
00:22:34,240 --> 00:22:36,159
company or infrastructure that you are

561
00:22:36,159 --> 00:22:37,760
prepared for it by doing these kind of

562
00:22:37,760 --> 00:22:40,559
exercises

563
00:22:40,559 --> 00:22:42,960
so that is also a part to

564
00:22:42,960 --> 00:22:45,039
how to prepare for this

565
00:22:45,039 --> 00:22:46,720
well first obviously

566
00:22:46,720 --> 00:22:48,799
without backups it's going to be very

567
00:22:48,799 --> 00:22:51,200
hard to go to a previous state so i

568
00:22:51,200 --> 00:22:53,520
would definitely advise to have offline

569
00:22:53,520 --> 00:22:57,360
or a write protected backup

570
00:22:57,600 --> 00:22:58,720
of course

571
00:22:58,720 --> 00:23:01,360
macros in my opinion should be always

572
00:23:01,360 --> 00:23:05,280
disabled unless explicitly necessary

573
00:23:05,280 --> 00:23:07,280
with a good reason obviously

574
00:23:07,280 --> 00:23:09,440
email attachments should be scanned

575
00:23:09,440 --> 00:23:10,240
and

576
00:23:10,240 --> 00:23:13,120
even removed from the email if they are

577
00:23:13,120 --> 00:23:15,520
malicious

578
00:23:15,520 --> 00:23:17,360
basically doing this kind of threat

579
00:23:17,360 --> 00:23:18,720
hunting

580
00:23:18,720 --> 00:23:20,640
with the seam system

581
00:23:20,640 --> 00:23:24,320
and edr is very handy to do but

582
00:23:24,320 --> 00:23:27,520
edr is something that is not

583
00:23:27,520 --> 00:23:29,520
very convenient an extra addition on the

584
00:23:29,520 --> 00:23:33,120
endpoint and here for not so long but it

585
00:23:33,120 --> 00:23:35,360
would be definitely

586
00:23:35,360 --> 00:23:38,240
wise to include it as well but

587
00:23:38,240 --> 00:23:40,960
i would say it's not a silver bullet

588
00:23:40,960 --> 00:23:44,799
but it takes some of the pain away

589
00:23:44,880 --> 00:23:46,960
obviously the segmentation

590
00:23:46,960 --> 00:23:48,559
will prevent

591
00:23:48,559 --> 00:23:51,039
any way of

592
00:23:51,039 --> 00:23:52,720
lateral movement

593
00:23:52,720 --> 00:23:54,880
and simulation attacks firewall drills

594
00:23:54,880 --> 00:23:57,440
red teaming and routine

595
00:23:57,440 --> 00:23:59,760
i would advise to do as well now if you

596
00:23:59,760 --> 00:24:01,039
don't know that

597
00:24:01,039 --> 00:24:02,960
it could be still the case there is a

598
00:24:02,960 --> 00:24:06,080
risk that backup is overwritten malware

599
00:24:06,080 --> 00:24:08,720
is being run somewhere and always yeah

600
00:24:08,720 --> 00:24:10,720
also people will just make mistakes by

601
00:24:10,720 --> 00:24:12,720
accidentally clicking on an email

602
00:24:12,720 --> 00:24:15,440
without a malicious payload

603
00:24:15,440 --> 00:24:16,480
and

604
00:24:16,480 --> 00:24:18,159
during a ransomware infection it can

605
00:24:18,159 --> 00:24:20,000
happen that some systems are not

606
00:24:20,000 --> 00:24:21,760
reachable anymore there is panic and

607
00:24:21,760 --> 00:24:23,360
then you need to fall back on your

608
00:24:23,360 --> 00:24:25,679
procedure and playbooks and if there's a

609
00:24:25,679 --> 00:24:26,720
gap

610
00:24:26,720 --> 00:24:28,640
in this playbook then you can also run

611
00:24:28,640 --> 00:24:30,799
into trouble

612
00:24:30,799 --> 00:24:33,760
so therefore we just have to assume we

613
00:24:33,760 --> 00:24:34,640
are

614
00:24:34,640 --> 00:24:35,679
always

615
00:24:35,679 --> 00:24:38,559
um infected with malicious files uh

616
00:24:38,559 --> 00:24:40,159
there has always been

617
00:24:40,159 --> 00:24:41,679
mistakes will always be made and

618
00:24:41,679 --> 00:24:43,279
vulnerabilities will

619
00:24:43,279 --> 00:24:44,960
be exploited and if you take all these

620
00:24:44,960 --> 00:24:46,880
things in account then you're better

621
00:24:46,880 --> 00:24:50,400
prepared for a attack

622
00:24:51,120 --> 00:24:54,559
so to summarize my takeaways again

623
00:24:54,559 --> 00:24:56,320
mention the backups

624
00:24:56,320 --> 00:24:58,840
very important to have these right

625
00:24:58,840 --> 00:25:01,360
protected or offline

626
00:25:01,360 --> 00:25:03,919
and do practice cyber resilience by

627
00:25:03,919 --> 00:25:06,000
executing patching because the most

628
00:25:06,000 --> 00:25:07,760
ransomware

629
00:25:07,760 --> 00:25:10,799
species and types

630
00:25:11,520 --> 00:25:15,039
abuse the existing vulnerabilities

631
00:25:15,039 --> 00:25:17,760
zero-day vulnerability into a

632
00:25:17,760 --> 00:25:20,559
ransom attack is very rare

633
00:25:20,559 --> 00:25:22,000
what about cloud

634
00:25:22,000 --> 00:25:23,840
yeah well cloud is a multi-tenant

635
00:25:23,840 --> 00:25:25,600
environment

636
00:25:25,600 --> 00:25:26,400
so

637
00:25:26,400 --> 00:25:27,679
even

638
00:25:27,679 --> 00:25:29,840
if you have an attack on your end as a

639
00:25:29,840 --> 00:25:32,159
cloud customer and it spreads to maybe

640
00:25:32,159 --> 00:25:33,600
to one of your neighbors

641
00:25:33,600 --> 00:25:35,360
you might get

642
00:25:35,360 --> 00:25:37,039
held against liable

643
00:25:37,039 --> 00:25:37,760
so

644
00:25:37,760 --> 00:25:39,840
therefore the stakes are even higher but

645
00:25:39,840 --> 00:25:42,400
on the other end there are also security

646
00:25:42,400 --> 00:25:44,880
tools like for instance security hub and

647
00:25:44,880 --> 00:25:47,520
cloudtrail or defender atp available in

648
00:25:47,520 --> 00:25:49,200
order to

649
00:25:49,200 --> 00:25:51,360
mitigate those attacks better so that's

650
00:25:51,360 --> 00:25:54,000
the other side

651
00:25:54,480 --> 00:25:56,480
obviously implement incident response

652
00:25:56,480 --> 00:25:57,919
and make sure

653
00:25:57,919 --> 00:26:00,240
there are no gaps in your documentation

654
00:26:00,240 --> 00:26:02,640
and everything is up to date

655
00:26:02,640 --> 00:26:06,320
and document and learn from each drill

656
00:26:06,320 --> 00:26:08,799
or attack

657
00:26:08,799 --> 00:26:10,720
and you can might

658
00:26:10,720 --> 00:26:12,480
all these things can take some of the

659
00:26:12,480 --> 00:26:15,039
pain away but in my opinion you should

660
00:26:15,039 --> 00:26:17,840
combine everything to apply

661
00:26:17,840 --> 00:26:19,919
security in depth

662
00:26:19,919 --> 00:26:23,279
so these were my key takeaways

663
00:26:23,279 --> 00:26:24,320
and i want to thank you for your

664
00:26:24,320 --> 00:26:27,039
attention and i'm happy to answer any

665
00:26:27,039 --> 00:26:28,080
question

666
00:26:28,080 --> 00:26:31,240
thank you

