1
00:00:02,570 --> 00:00:09,940
okay that's going now that that's that

2
00:00:07,549 --> 00:00:09,940
other way

3
00:00:10,400 --> 00:00:18,140
quick intro about myself mashaallah taco

4
00:00:15,279 --> 00:00:22,040
been working in incident response for a

5
00:00:18,140 --> 00:00:26,200
while hope you use now being for a while

6
00:00:22,040 --> 00:00:28,399
with Salesforce she said before that

7
00:00:26,200 --> 00:00:33,079
wasn't a part of the Commonwealth Bank

8
00:00:28,399 --> 00:00:36,500
of Australia flown all the way from

9
00:00:33,079 --> 00:00:39,620
Sydney and show you adjust for this hope

10
00:00:36,500 --> 00:00:43,670
you learn something out of this hope you

11
00:00:39,620 --> 00:00:45,550
enjoy this a bit about the presentation

12
00:00:43,670 --> 00:00:49,190
itself

13
00:00:45,550 --> 00:00:50,989
why exactly how I come up with this and

14
00:00:49,190 --> 00:00:57,890
what's the purpose operator why I'm

15
00:00:50,990 --> 00:01:00,890
trying to share with you be for smaller

16
00:00:57,890 --> 00:01:04,280
teams particularly in smaller companies

17
00:01:00,890 --> 00:01:06,800
or where the resources are not not

18
00:01:04,280 --> 00:01:13,040
really available for what the security

19
00:01:06,800 --> 00:01:17,060
teams to really spend time and money on

20
00:01:13,040 --> 00:01:19,159
sort of intelligence struggle with with

21
00:01:17,060 --> 00:01:21,680
scaling their their day-to-day

22
00:01:19,159 --> 00:01:24,830
operations to a point where they've got

23
00:01:21,680 --> 00:01:31,549
something built up that can readily be

24
00:01:24,830 --> 00:01:33,440
used every day and the front one of main

25
00:01:31,549 --> 00:01:36,650
reasons I came up with this thing a

26
00:01:33,440 --> 00:01:41,479
couple of years back was to I liked

27
00:01:36,650 --> 00:01:43,159
building things on my own for for a very

28
00:01:41,479 --> 00:01:48,350
simple reason because when you're

29
00:01:43,159 --> 00:01:51,280
building stuff yourself it really is

30
00:01:48,350 --> 00:01:54,140
very relevant to what you do there today

31
00:01:51,280 --> 00:01:55,909
rather than going out there and buying a

32
00:01:54,140 --> 00:01:58,939
product or buying a service from someone

33
00:01:55,909 --> 00:02:00,650
which is more generic for obvious

34
00:01:58,939 --> 00:02:05,479
reasons they're caring to a lot of

35
00:02:00,650 --> 00:02:08,750
people this way you can really unity

36
00:02:05,479 --> 00:02:11,900
into a point where it's very relevant to

37
00:02:08,750 --> 00:02:15,319
what you do every day so that's that's

38
00:02:11,900 --> 00:02:16,430
basically the brief intro to the to the

39
00:02:15,319 --> 00:02:19,488
actual as

40
00:02:16,430 --> 00:02:26,239
detection and the other reason why why

41
00:02:19,489 --> 00:02:29,709
I'm like besides he's always found these

42
00:02:26,239 --> 00:02:32,209
lights conferences very helpful in

43
00:02:29,709 --> 00:02:34,159
trying to get some stuff that I can

44
00:02:32,209 --> 00:02:36,590
literally use straight away so it's

45
00:02:34,159 --> 00:02:38,959
basically coming here learn stuff from

46
00:02:36,590 --> 00:02:42,409
other people go back and start using it

47
00:02:38,959 --> 00:02:44,689
straight away in a very very specific to

48
00:02:42,409 --> 00:02:45,858
my role most of the times so that's

49
00:02:44,689 --> 00:02:48,138
that's one of the reasons I really like

50
00:02:45,859 --> 00:02:51,349
and the only only thing that I asking

51
00:02:48,139 --> 00:02:54,620
you is try to share as much as you can

52
00:02:51,349 --> 00:02:56,720
basically the more we share with each

53
00:02:54,620 --> 00:02:59,470
other in the community that the stronger

54
00:02:56,720 --> 00:03:02,209
we get the faster we learn things and

55
00:02:59,470 --> 00:03:05,870
collaboration really helps it has helped

56
00:03:02,209 --> 00:03:07,879
me a lot in the past and I really

57
00:03:05,870 --> 00:03:11,870
appreciate it if everyone keeps this

58
00:03:07,879 --> 00:03:20,149
window now before this turns into a TED

59
00:03:11,870 --> 00:03:23,829
talk let's get into it but control what

60
00:03:20,150 --> 00:03:23,829
we will see in this presentation

61
00:03:24,609 --> 00:03:32,599
specifically looking at binaries

62
00:03:27,919 --> 00:03:35,000
malicious binaries and trying to get

63
00:03:32,599 --> 00:03:37,010
usable information out of it it is very

64
00:03:35,000 --> 00:03:39,310
important especially if you're working a

65
00:03:37,010 --> 00:03:41,720
small team you don't have time and

66
00:03:39,310 --> 00:03:44,870
moreso times you're really easy doing

67
00:03:41,720 --> 00:03:47,090
stuff I think it's very important that

68
00:03:44,870 --> 00:03:51,620
you come up with a few techniques of

69
00:03:47,090 --> 00:03:54,590
your own we can going very fast grab all

70
00:03:51,620 --> 00:03:58,250
the usable stuff from the binaries for

71
00:03:54,590 --> 00:04:02,889
example and use them to protect your

72
00:03:58,250 --> 00:04:06,139
organization this can get sued by

73
00:04:02,889 --> 00:04:11,180
targeting some very specific functions

74
00:04:06,139 --> 00:04:12,739
and once you've got that you can use all

75
00:04:11,180 --> 00:04:15,199
the information that gets tracked and

76
00:04:12,739 --> 00:04:19,310
put it into some sort of a database or

77
00:04:15,199 --> 00:04:22,250
thread and tell database basically that

78
00:04:19,310 --> 00:04:24,280
you can build over time and you can keep

79
00:04:22,250 --> 00:04:26,860
using that as anyone needed

80
00:04:24,280 --> 00:04:28,419
mmm all of that information that you

81
00:04:26,860 --> 00:04:31,240
gather can be used to build profiles

82
00:04:28,420 --> 00:04:34,210
which once you've got them to a point

83
00:04:31,240 --> 00:04:36,280
where they're pretty easy to use you can

84
00:04:34,210 --> 00:04:39,280
literally give them off the front line

85
00:04:36,280 --> 00:04:41,820
teams your swap teams or whoever you

86
00:04:39,280 --> 00:04:46,030
know do it does the first first first

87
00:04:41,820 --> 00:04:49,540
response and obviously once you've got

88
00:04:46,030 --> 00:04:51,250
something in place you can then share it

89
00:04:49,540 --> 00:04:58,690
with the daughter organization different

90
00:04:51,250 --> 00:05:00,250
teams and go from there what of my

91
00:04:58,690 --> 00:05:02,830
slides are pretty pretty boring I

92
00:05:00,250 --> 00:05:04,450
haven't got any funny pictures or

93
00:05:02,830 --> 00:05:06,729
anything in there so I apologize for

94
00:05:04,450 --> 00:05:07,930
that but that times up probably even

95
00:05:06,730 --> 00:05:10,960
bleeds through them because I haven't

96
00:05:07,930 --> 00:05:14,050
got a lot of time but definitely feel

97
00:05:10,960 --> 00:05:16,120
free to contact me after or get in touch

98
00:05:14,050 --> 00:05:18,850
with maintain or something like that and

99
00:05:16,120 --> 00:05:22,270
now we're very happy to continue the

100
00:05:18,850 --> 00:05:25,060
discussions when you're looking at and

101
00:05:22,270 --> 00:05:27,039
by the way this is I'm just picking on

102
00:05:25,060 --> 00:05:30,190
some examples real world examples but

103
00:05:27,040 --> 00:05:32,890
it's quite easily can be applied to a

104
00:05:30,190 --> 00:05:34,600
lot of different things as well so don't

105
00:05:32,890 --> 00:05:36,550
think it's specific to what what you see

106
00:05:34,600 --> 00:05:37,750
here it's just the techniques and once

107
00:05:36,550 --> 00:05:40,300
you've got those techniques you can

108
00:05:37,750 --> 00:05:42,840
scale them to two different levels and

109
00:05:40,300 --> 00:05:47,710
you can even court into different

110
00:05:42,840 --> 00:05:49,719
different types of attacks looking for

111
00:05:47,710 --> 00:05:53,080
malicious through malicious boundaries

112
00:05:49,720 --> 00:05:55,870
for example what we need to know before

113
00:05:53,080 --> 00:05:58,630
we can use that or building a profiles

114
00:05:55,870 --> 00:06:00,760
or database or whatever we're trying to

115
00:05:58,630 --> 00:06:02,950
achieve the theatre connection

116
00:06:00,760 --> 00:06:06,610
information is very important so that

117
00:06:02,950 --> 00:06:09,729
you know where all the traffic in might

118
00:06:06,610 --> 00:06:13,000
end up you can use some things like

119
00:06:09,729 --> 00:06:16,120
cookies to give you specific techniques

120
00:06:13,000 --> 00:06:18,550
that are being used by malware IP

121
00:06:16,120 --> 00:06:21,520
addresses ports pretty self-explanatory

122
00:06:18,550 --> 00:06:25,780
where you can build a list of why piece

123
00:06:21,520 --> 00:06:27,810
or a period of time where you can keep

124
00:06:25,780 --> 00:06:31,630
reusing explore at least some time

125
00:06:27,810 --> 00:06:34,450
stealth techniques again is things you

126
00:06:31,630 --> 00:06:36,240
can you can document and whenever you

127
00:06:34,450 --> 00:06:37,810
see those same techniques being used

128
00:06:36,240 --> 00:06:39,550
different fair

129
00:06:37,810 --> 00:06:42,520
you can you can you can sort of make a

130
00:06:39,550 --> 00:06:44,470
connection there that there's some sort

131
00:06:42,520 --> 00:06:45,609
of code reuse happening or something

132
00:06:44,470 --> 00:06:49,900
collaboration between different

133
00:06:45,610 --> 00:06:51,490
different mal electricity anti detection

134
00:06:49,900 --> 00:06:54,280
techniques again is a very common one

135
00:06:51,490 --> 00:06:57,630
and encryption as well because a lot of

136
00:06:54,280 --> 00:06:59,739
malware nowadays uses encryption to

137
00:06:57,630 --> 00:07:03,100
decrypt the data before they send it

138
00:06:59,740 --> 00:07:04,870
back to their they see to thousands by

139
00:07:03,100 --> 00:07:07,450
knowing what type of encryption for

140
00:07:04,870 --> 00:07:10,110
example I you can start building a

141
00:07:07,450 --> 00:07:10,110
profile as well

142
00:07:11,080 --> 00:07:17,890
now narrowing it down getting to getting

143
00:07:15,669 --> 00:07:20,740
to a point where you really start

144
00:07:17,890 --> 00:07:23,770
focusing on specific things to get get

145
00:07:20,740 --> 00:07:26,230
started these are some of the things you

146
00:07:23,770 --> 00:07:30,310
can target for example modules and

147
00:07:26,230 --> 00:07:33,280
specifically functions API calls just

148
00:07:30,310 --> 00:07:38,979
for just for the sole purpose of

149
00:07:33,280 --> 00:07:40,359
building some sort of database some of

150
00:07:38,979 --> 00:07:43,659
the common modules that we can target

151
00:07:40,360 --> 00:07:47,290
that that I like targeting the to get

152
00:07:43,660 --> 00:07:50,050
information really really fast when on

153
00:07:47,290 --> 00:07:52,950
it is one of them it will give you all

154
00:07:50,050 --> 00:07:55,419
of this all of these stuff that you can

155
00:07:52,950 --> 00:07:57,849
extract out of the binaries and then put

156
00:07:55,419 --> 00:08:01,570
it into some sort of database for for

157
00:07:57,850 --> 00:08:07,270
use later on or to distribute it to tier

158
00:08:01,570 --> 00:08:10,240
teams a quick example of what you can

159
00:08:07,270 --> 00:08:13,000
actually get by for an example

160
00:08:10,240 --> 00:08:16,539
targeting one of those functions which

161
00:08:13,000 --> 00:08:19,210
is in this case internet open basically

162
00:08:16,539 --> 00:08:23,289
looking at that trying to see what will

163
00:08:19,210 --> 00:08:25,840
be loaded there in these these

164
00:08:23,289 --> 00:08:30,630
screenshots if you follow from one to

165
00:08:25,840 --> 00:08:33,159
two three you can see the source will be

166
00:08:30,630 --> 00:08:38,039
filled up at some point as you execute

167
00:08:33,159 --> 00:08:40,539
it with in this case in the user agent

168
00:08:38,039 --> 00:08:43,210
all of this stuff is pretty easy to

169
00:08:40,539 --> 00:08:46,600
track once you've got it and you can

170
00:08:43,210 --> 00:08:48,820
keep building it into your database for

171
00:08:46,600 --> 00:08:50,650
that particular family as you can see

172
00:08:48,820 --> 00:08:53,650
here the second argument of the actual

173
00:08:50,650 --> 00:08:58,329
function is supplying one of the CTO

174
00:08:53,650 --> 00:09:02,199
addresses before we go further just a

175
00:08:58,330 --> 00:09:03,580
quick example right just an example if

176
00:09:02,200 --> 00:09:06,630
you dealing if you're in a salt

177
00:09:03,580 --> 00:09:09,400
situation and you're dealing with a a

178
00:09:06,630 --> 00:09:12,339
malware campaign a new malware campaign

179
00:09:09,400 --> 00:09:14,620
for example e usually what will happen

180
00:09:12,339 --> 00:09:16,780
is it will come through as the first

181
00:09:14,620 --> 00:09:21,970
protocol would be some sort of document

182
00:09:16,780 --> 00:09:25,959
or usually the first page malware that's

183
00:09:21,970 --> 00:09:29,470
get dropped onto your computer will be

184
00:09:25,959 --> 00:09:31,900
executed at that point it will go ahead

185
00:09:29,470 --> 00:09:33,640
and try to get the second second stage

186
00:09:31,900 --> 00:09:34,720
or the final payload which is the actual

187
00:09:33,640 --> 00:09:38,560
malware

188
00:09:34,720 --> 00:09:40,839
most of most of our teams struggle with

189
00:09:38,560 --> 00:09:47,020
that situation where they've got this

190
00:09:40,839 --> 00:09:50,010
first stage malware but the focus is on

191
00:09:47,020 --> 00:09:52,810
getting that downloader

192
00:09:50,010 --> 00:09:55,380
URI and then blocking it most of the

193
00:09:52,810 --> 00:10:00,250
time and a lot of things end up using

194
00:09:55,380 --> 00:10:02,860
sandboxes for cloud-based Sam boxes and

195
00:10:00,250 --> 00:10:04,690
stuff but the problem with that usually

196
00:10:02,860 --> 00:10:07,720
is that level of control you've got on

197
00:10:04,690 --> 00:10:09,839
those send offs is very minimal and

198
00:10:07,720 --> 00:10:13,030
usually what happens is if they're got

199
00:10:09,839 --> 00:10:15,730
say for example five different you are

200
00:10:13,030 --> 00:10:18,189
eyes in there the first one executes and

201
00:10:15,730 --> 00:10:20,350
goes out and tries to fetch the second

202
00:10:18,190 --> 00:10:22,800
stage or the final payload and that's

203
00:10:20,350 --> 00:10:26,890
the only URI you capture and a lot of

204
00:10:22,800 --> 00:10:30,359
frontline teams sort of grab that and

205
00:10:26,890 --> 00:10:33,760
take that as the main chain block it and

206
00:10:30,360 --> 00:10:37,390
it's it's pretty useless really that the

207
00:10:33,760 --> 00:10:41,040
whole exercise because the entire

208
00:10:37,390 --> 00:10:44,410
campaign will have multiple your eyes

209
00:10:41,040 --> 00:10:47,949
multiple different downloaders for the

210
00:10:44,410 --> 00:10:49,839
product for just in one campaign and if

211
00:10:47,950 --> 00:10:51,310
we're just looking at one of those your

212
00:10:49,839 --> 00:10:53,890
eye for the second stage download or

213
00:10:51,310 --> 00:10:56,530
blocking it it's not going to do much

214
00:10:53,890 --> 00:10:58,480
real at that point in time either you

215
00:10:56,530 --> 00:11:00,459
know you've got your own hand boxing and

216
00:10:58,480 --> 00:11:01,690
while in which you completely control

217
00:11:00,459 --> 00:11:04,390
and you're able to

218
00:11:01,690 --> 00:11:08,740
trigger it multiple times and capture

219
00:11:04,390 --> 00:11:10,900
everything but even then it's really not

220
00:11:08,740 --> 00:11:12,700
that much use because what you really

221
00:11:10,900 --> 00:11:16,300
want to be focusing on is the second or

222
00:11:12,700 --> 00:11:18,790
the final stage payload which requires

223
00:11:16,300 --> 00:11:21,729
human beings basically because you'll

224
00:11:18,790 --> 00:11:26,500
have to go in there and manually extract

225
00:11:21,730 --> 00:11:29,230
the entire c2 list and more than malware

226
00:11:26,500 --> 00:11:31,600
today come loaded with things right look

227
00:11:29,230 --> 00:11:34,060
the latest example the latest sample of

228
00:11:31,600 --> 00:11:37,600
fimo tactical rabbit would have anywhere

229
00:11:34,060 --> 00:11:39,599
between 45 to 60 IP addresses for c2

230
00:11:37,600 --> 00:11:43,240
connections and

231
00:11:39,600 --> 00:11:46,030
any sandboxing environment if not

232
00:11:43,240 --> 00:11:50,200
controlled completely will not even give

233
00:11:46,030 --> 00:11:53,860
you anything so just a quick intro about

234
00:11:50,200 --> 00:11:55,750
that before we move on and also keep in

235
00:11:53,860 --> 00:11:59,170
mind on our touch this on this letter on

236
00:11:55,750 --> 00:12:01,750
once I finish as well the goal here

237
00:11:59,170 --> 00:12:04,689
really is to automate all of this in the

238
00:12:01,750 --> 00:12:05,440
end we should be able to understand it

239
00:12:04,690 --> 00:12:08,080
completely

240
00:12:05,440 --> 00:12:10,090
once we've understood it the goal is to

241
00:12:08,080 --> 00:12:14,140
automate all of it so that we don't have

242
00:12:10,090 --> 00:12:15,730
to manually do it all the time but to do

243
00:12:14,140 --> 00:12:17,110
that to get to that stage it's very

244
00:12:15,730 --> 00:12:22,060
important we understand what's happened

245
00:12:17,110 --> 00:12:24,910
he this is another function we can

246
00:12:22,060 --> 00:12:27,640
target and this is once you've got a

247
00:12:24,910 --> 00:12:29,530
list of these functions to target you

248
00:12:27,640 --> 00:12:32,290
can literally do it within minutes and

249
00:12:29,530 --> 00:12:34,689
it will work pretty much all the time

250
00:12:32,290 --> 00:12:36,610
HTTP or one request you can see again

251
00:12:34,690 --> 00:12:38,620
it's the similar situation like the

252
00:12:36,610 --> 00:12:40,290
slide before you can look at the

253
00:12:38,620 --> 00:12:43,060
arguments the source and the destination

254
00:12:40,290 --> 00:12:44,740
look at the memory dump of it and just

255
00:12:43,060 --> 00:12:47,410
wait for it to execute and you will

256
00:12:44,740 --> 00:12:49,630
completely load everything that's that's

257
00:12:47,410 --> 00:12:51,430
in the argument that's put on putting

258
00:12:49,630 --> 00:12:53,470
the argument by the malware offer and

259
00:12:51,430 --> 00:12:55,930
you should be able to look at it in the

260
00:12:53,470 --> 00:12:57,820
memory dump and also on the stack so if

261
00:12:55,930 --> 00:12:59,859
you look at the memory down fast you can

262
00:12:57,820 --> 00:13:02,260
see the actual get request is forming

263
00:12:59,860 --> 00:13:04,720
now and you can read the entire request

264
00:13:02,260 --> 00:13:07,270
there once you've got that happening in

265
00:13:04,720 --> 00:13:09,220
the membrane over there on the blue side

266
00:13:07,270 --> 00:13:14,439
you can see the same thing will end up

267
00:13:09,220 --> 00:13:15,310
in the stack as well this is another

268
00:13:14,440 --> 00:13:17,470
function

269
00:13:15,310 --> 00:13:20,349
into the queer URL this basically will

270
00:13:17,470 --> 00:13:23,459
put the IP address and the entire URL

271
00:13:20,350 --> 00:13:28,120
structure together just before that

272
00:13:23,459 --> 00:13:29,768
reaches out to the e to the C - and this

273
00:13:28,120 --> 00:13:32,769
is where it all comes together so

274
00:13:29,769 --> 00:13:37,319
internet canonicalize URL is where you

275
00:13:32,769 --> 00:13:41,019
can see the entire URL now formed with

276
00:13:37,319 --> 00:13:42,969
the HTTP and everything in there and the

277
00:13:41,019 --> 00:13:44,649
other thing you can see clearly is now

278
00:13:42,970 --> 00:13:51,389
that has been passed on to the first

279
00:13:44,649 --> 00:13:54,310
argument this is again something that's

280
00:13:51,389 --> 00:13:56,259
interesting because if you look at the

281
00:13:54,310 --> 00:13:59,589
actual argument the second argument in

282
00:13:56,259 --> 00:14:02,410
there you should be able to see a cookie

283
00:13:59,589 --> 00:14:03,759
value which is literally all the

284
00:14:02,410 --> 00:14:06,730
information that the malware has

285
00:14:03,759 --> 00:14:09,100
extracted from the computer encrypted it

286
00:14:06,730 --> 00:14:14,199
and is about to send it back to the C -

287
00:14:09,100 --> 00:14:16,120
well it will be decrypted once you've

288
00:14:14,199 --> 00:14:19,209
got stuff like that and that's again

289
00:14:16,120 --> 00:14:22,300
just an example you can document that in

290
00:14:19,209 --> 00:14:26,709
all threat Intel database and attribute

291
00:14:22,300 --> 00:14:28,540
it to a specific malware family and you

292
00:14:26,709 --> 00:14:30,758
basically bit-by-bit just building your

293
00:14:28,540 --> 00:14:33,879
database to a point where it gets really

294
00:14:30,759 --> 00:14:35,800
interesting and very useful from a

295
00:14:33,879 --> 00:14:38,019
threat Intel point of view these are

296
00:14:35,800 --> 00:14:41,170
some of the other modules that that I

297
00:14:38,019 --> 00:14:43,000
like to target these are pretty obvious

298
00:14:41,170 --> 00:14:48,969
what they do basically just before it

299
00:14:43,000 --> 00:14:50,470
downloads the payload this is again an

300
00:14:48,970 --> 00:14:52,180
interesting one because it's like I said

301
00:14:50,470 --> 00:14:54,699
most of the malware have started using

302
00:14:52,180 --> 00:14:59,170
the encryption to communicate back to

303
00:14:54,699 --> 00:15:01,420
the city servers now this is a subset of

304
00:14:59,170 --> 00:15:04,180
the the routine for encryption

305
00:15:01,420 --> 00:15:05,279
so basically we're targeting the add the

306
00:15:04,180 --> 00:15:08,758
p32

307
00:15:05,279 --> 00:15:11,860
module and all the functions below there

308
00:15:08,759 --> 00:15:16,029
we can see what kind of encryption the

309
00:15:11,860 --> 00:15:17,680
Mellow is using how that is important

310
00:15:16,029 --> 00:15:20,920
for why that is important for us is

311
00:15:17,680 --> 00:15:23,349
because for example just an example off

312
00:15:20,920 --> 00:15:25,630
the top of my head if you look at a

313
00:15:23,350 --> 00:15:28,040
malware family which has been using rc4

314
00:15:25,630 --> 00:15:32,210
for encryption before and so

315
00:15:28,040 --> 00:15:34,490
starts to use a yes you've got a big

316
00:15:32,210 --> 00:15:36,860
leap there for Ted Intel point of view

317
00:15:34,490 --> 00:15:41,360
and once you capture that information

318
00:15:36,860 --> 00:15:44,960
and put it in your database you've got a

319
00:15:41,360 --> 00:15:49,310
big big bullet in your new profile for

320
00:15:44,960 --> 00:15:52,730
that malware family these these slides

321
00:15:49,310 --> 00:15:55,250
are just us going through the complete

322
00:15:52,730 --> 00:15:58,040
encryption module based on the functions

323
00:15:55,250 --> 00:16:00,530
that are shown before and as you can see

324
00:15:58,040 --> 00:16:03,319
this is this is pretty standard so the

325
00:16:00,530 --> 00:16:05,689
only thing one of the most important

326
00:16:03,320 --> 00:16:15,200
things that you can grab out of this is

327
00:16:05,690 --> 00:16:19,970
the type of encryption being used so as

328
00:16:15,200 --> 00:16:21,890
you can see here this function CP hash

329
00:16:19,970 --> 00:16:25,340
data and just just say with me there for

330
00:16:21,890 --> 00:16:27,080
a sec we need to know the CSP that's

331
00:16:25,340 --> 00:16:29,210
being used here the cryptographic

332
00:16:27,080 --> 00:16:33,110
service provider and as you can see the

333
00:16:29,210 --> 00:16:36,500
RSA head up an argument to so we we know

334
00:16:33,110 --> 00:16:38,720
that this is this malware is using an

335
00:16:36,500 --> 00:16:44,390
RSA public key for encryption the

336
00:16:38,720 --> 00:16:45,650
private key obviously is at the c2 and

337
00:16:44,390 --> 00:16:49,520
this is just going through the routine

338
00:16:45,650 --> 00:16:51,530
completing it the last bit of course is

339
00:16:49,520 --> 00:16:55,640
destroying the hash that was first

340
00:16:51,530 --> 00:16:57,110
created but you can it this is what it

341
00:16:55,640 --> 00:16:59,800
should look like in the end where you

342
00:16:57,110 --> 00:17:02,920
can see all of the tar up there ends up

343
00:16:59,800 --> 00:17:05,510
encrypted and if you look closely

344
00:17:02,920 --> 00:17:08,389
encrypted pitties the cookie value we

345
00:17:05,510 --> 00:17:12,940
saw earlier and this is what you would

346
00:17:08,390 --> 00:17:16,490
see if you were for example monitoring

347
00:17:12,940 --> 00:17:18,620
the C to communication on say Wireshark

348
00:17:16,490 --> 00:17:20,120
or something like that so you you've got

349
00:17:18,619 --> 00:17:23,149
the best the only thing you'll see

350
00:17:20,119 --> 00:17:24,020
everything we've seen before we start

351
00:17:23,150 --> 00:17:26,870
that your loss

352
00:17:24,020 --> 00:17:29,540
you won't have access to it's very

353
00:17:26,869 --> 00:17:30,080
helpful in understanding how it actually

354
00:17:29,540 --> 00:17:32,629
works

355
00:17:30,080 --> 00:17:34,730
because now we actually know what CSP is

356
00:17:32,630 --> 00:17:37,760
using what type of encryption is being

357
00:17:34,730 --> 00:17:41,270
used nope we can also see what is being

358
00:17:37,760 --> 00:17:43,790
encrypted but the trick to that is

359
00:17:41,270 --> 00:17:45,470
once you got to the point where you know

360
00:17:43,790 --> 00:17:49,690
the exact functions that you want to

361
00:17:45,470 --> 00:17:54,110
target you can start focusing on the

362
00:17:49,690 --> 00:17:56,960
copy function which would give you the

363
00:17:54,110 --> 00:17:58,939
source address of the memory of all the

364
00:17:56,960 --> 00:18:01,160
stuff that is about to be encrypted and

365
00:17:58,940 --> 00:18:03,920
will also give you the destination

366
00:18:01,160 --> 00:18:06,380
address of where it will end up after

367
00:18:03,920 --> 00:18:09,050
its mean encrypted so that's that's

368
00:18:06,380 --> 00:18:10,220
useful to see what kind of encryption

369
00:18:09,050 --> 00:18:13,159
happened

370
00:18:10,220 --> 00:18:15,920
create process is a very simple function

371
00:18:13,160 --> 00:18:18,470
that pretty much everyone knows about

372
00:18:15,920 --> 00:18:21,170
once you've targeted this everything

373
00:18:18,470 --> 00:18:22,970
that will be created will will you will

374
00:18:21,170 --> 00:18:25,550
be able to see it for example in this

375
00:18:22,970 --> 00:18:29,240
malware you can see it's changing

376
00:18:25,550 --> 00:18:31,510
firewall rules so basically you probably

377
00:18:29,240 --> 00:18:33,650
can't breed it down there but it's

378
00:18:31,510 --> 00:18:36,890
literally just opening up the firewall

379
00:18:33,650 --> 00:18:40,400
for it for the malware to allow

380
00:18:36,890 --> 00:18:42,710
connections back this is another example

381
00:18:40,400 --> 00:18:44,900
of a different man where same thing

382
00:18:42,710 --> 00:18:46,670
create process we've targeted that we

383
00:18:44,900 --> 00:18:48,590
know that it's opening up our shell once

384
00:18:46,670 --> 00:18:51,230
it's called PowerShell people run other

385
00:18:48,590 --> 00:18:53,929
commands other processes on the computer

386
00:18:51,230 --> 00:18:56,960
again this is all the stuff that we can

387
00:18:53,930 --> 00:18:58,910
take documented and store in database

388
00:18:56,960 --> 00:19:02,960
we're building all the intelligence

389
00:18:58,910 --> 00:19:07,220
around these Melo families but the NSA

390
00:19:02,960 --> 00:19:09,740
API you can use it in a twisted kind of

391
00:19:07,220 --> 00:19:12,830
a way to to to see what's happening and

392
00:19:09,740 --> 00:19:14,960
again just an example in this case email

393
00:19:12,830 --> 00:19:17,810
is reaching out to a geo plugin dotnet

394
00:19:14,960 --> 00:19:19,220
they've got a plug-in in there that what

395
00:19:17,810 --> 00:19:21,260
it literally does down down at the

396
00:19:19,220 --> 00:19:23,240
bottom what it really does is goes out

397
00:19:21,260 --> 00:19:26,240
to Matt's mind and you have the IP of

398
00:19:23,240 --> 00:19:28,040
the Machine this is one of the most

399
00:19:26,240 --> 00:19:30,200
common techniques used by malware

400
00:19:28,040 --> 00:19:33,379
authors to to learn where their victims

401
00:19:30,200 --> 00:19:36,440
are and then from there on it's the

402
00:19:33,380 --> 00:19:38,920
possibilities are there's quite a few

403
00:19:36,440 --> 00:19:41,090
different possibilities where you can

404
00:19:38,920 --> 00:19:42,710
well if you if you're a Russian for

405
00:19:41,090 --> 00:19:46,189
example you don't want to target Russia

406
00:19:42,710 --> 00:19:48,710
you can do that or you basically can

407
00:19:46,190 --> 00:19:51,650
geo target through all your victims for

408
00:19:48,710 --> 00:19:53,660
the entire campaign but then again we we

409
00:19:51,650 --> 00:19:54,740
literally just attacked we literally

410
00:19:53,660 --> 00:19:59,679
just target that

411
00:19:54,740 --> 00:20:04,419
ticular DLL there and we've got the

412
00:19:59,679 --> 00:20:07,279
result white file is another one this

413
00:20:04,419 --> 00:20:09,020
particular slide probably not that

414
00:20:07,279 --> 00:20:11,330
useful because the encryptions already

415
00:20:09,020 --> 00:20:14,629
happened by this point I'm ice more so

416
00:20:11,330 --> 00:20:17,240
to just demonstrate once we've targeted

417
00:20:14,630 --> 00:20:19,220
this particular function we can see

418
00:20:17,240 --> 00:20:22,159
everything that has been written by the

419
00:20:19,220 --> 00:20:24,620
process to the to the disk and this is

420
00:20:22,159 --> 00:20:27,799
just an example of a ransom note being

421
00:20:24,620 --> 00:20:31,418
written and this is just before it

422
00:20:27,799 --> 00:20:31,418
actually gets written to your disk

423
00:20:32,799 --> 00:20:37,190
gathering intelligence so this is this

424
00:20:35,659 --> 00:20:39,860
is the second part of the presentation

425
00:20:37,190 --> 00:20:43,370
where yes we've done all of this we know

426
00:20:39,860 --> 00:20:45,979
the basic list of function that we want

427
00:20:43,370 --> 00:20:48,379
to target every time we we're looking at

428
00:20:45,980 --> 00:20:50,149
a binary once we've got all of that

429
00:20:48,380 --> 00:20:53,659
stuff what else is there that we can

430
00:20:50,149 --> 00:20:57,110
actually extract out of it and be a

431
00:20:53,659 --> 00:20:58,789
little bit more creative and use it to

432
00:20:57,110 --> 00:21:02,270
build our profiles which can then be

433
00:20:58,789 --> 00:21:08,450
used by body by our teams and front

434
00:21:02,270 --> 00:21:09,799
lines in this example again we targeted

435
00:21:08,450 --> 00:21:14,059
functions that we've talked about before

436
00:21:09,799 --> 00:21:17,658
but you can see that it's reaching out

437
00:21:14,059 --> 00:21:23,178
to that IP there which is running a

438
00:21:17,659 --> 00:21:26,450
script and by copying hoping the actual

439
00:21:23,179 --> 00:21:30,110
URL in there putting it in an actual

440
00:21:26,450 --> 00:21:34,100
browser we can see how they are creating

441
00:21:30,110 --> 00:21:37,010
an ID specific to your machine this is

442
00:21:34,100 --> 00:21:40,309
the ID that will be used to identify the

443
00:21:37,010 --> 00:21:42,649
victim by the male actor later on where

444
00:21:40,309 --> 00:21:44,090
they can go okay and they've got

445
00:21:42,649 --> 00:21:46,158
thousands of this by the time they're

446
00:21:44,090 --> 00:21:49,370
done with the campaign right and this is

447
00:21:46,159 --> 00:21:51,220
how they will identify for example if

448
00:21:49,370 --> 00:21:54,379
they're if they're asking for ransom

449
00:21:51,220 --> 00:21:56,419
payments this is a way of identifying

450
00:21:54,380 --> 00:22:00,140
where is it coming from so that they can

451
00:21:56,419 --> 00:22:06,020
unlock that the interesting bit here is

452
00:22:00,140 --> 00:22:08,200
not just a mechanism but if you go bit

453
00:22:06,020 --> 00:22:09,908
further you

454
00:22:08,200 --> 00:22:11,889
able to just from all the information we

455
00:22:09,909 --> 00:22:14,889
extracted on the binary the hard-coded

456
00:22:11,889 --> 00:22:19,000
in front information from there we can

457
00:22:14,889 --> 00:22:25,539
reach to the the admin panel for the

458
00:22:19,000 --> 00:22:27,130
campaign so this is literally what the

459
00:22:25,539 --> 00:22:29,850
guy who was running the campaign on the

460
00:22:27,130 --> 00:22:34,299
other end he's using to track his

461
00:22:29,850 --> 00:22:35,980
effectiveness once he's logged in there

462
00:22:34,299 --> 00:22:38,379
he will be able to see all his victims

463
00:22:35,980 --> 00:22:41,679
she will be able to say all of his IDs

464
00:22:38,380 --> 00:22:46,120
that he's created for the victims and

465
00:22:41,679 --> 00:22:48,279
also all the private Keys and it's

466
00:22:46,120 --> 00:22:51,510
pretty comprehensive the way it's been

467
00:22:48,279 --> 00:22:54,809
set up so that they can run a campaign

468
00:22:51,510 --> 00:23:00,970
really really effectively now

469
00:22:54,809 --> 00:23:02,740
hypothetically at this point in time not

470
00:23:00,970 --> 00:23:06,299
that anyone will do that

471
00:23:02,740 --> 00:23:09,580
not that we would do that but we can

472
00:23:06,299 --> 00:23:13,620
hypothetically run just a simple

473
00:23:09,580 --> 00:23:18,658
Nessus can on that right and you will

474
00:23:13,620 --> 00:23:24,070
find a lot of stuff if you were to do it

475
00:23:18,659 --> 00:23:26,490
the access you could get and a lot of

476
00:23:24,070 --> 00:23:30,399
these things are built pretty solidly

477
00:23:26,490 --> 00:23:38,110
but ironically the security of them is

478
00:23:30,399 --> 00:23:41,370
pretty low yeah so basically the the

479
00:23:38,110 --> 00:23:44,309
potential there is quite quite

480
00:23:41,370 --> 00:23:47,799
unbelievable once you get to this point

481
00:23:44,309 --> 00:23:49,570
now again not that you do it but if you

482
00:23:47,799 --> 00:23:53,190
were to do with and she were to get

483
00:23:49,570 --> 00:23:59,439
access to this the stuff that she would

484
00:23:53,190 --> 00:24:04,000
see will be interested or basically

485
00:23:59,440 --> 00:24:04,929
you'll have all the properties so if he

486
00:24:04,000 --> 00:24:07,659
were to do it

487
00:24:04,929 --> 00:24:10,809
not that you would you would be able to

488
00:24:07,659 --> 00:24:14,429
basically completely decrypt the entire

489
00:24:10,809 --> 00:24:16,690
campaign and we were talking Parana

490
00:24:14,429 --> 00:24:20,620
thousands hundreds of thousands of

491
00:24:16,690 --> 00:24:21,990
computers but more importantly you can

492
00:24:20,620 --> 00:24:25,179
you can

493
00:24:21,990 --> 00:24:27,400
well-known technical side see how these

494
00:24:25,180 --> 00:24:31,180
things actually operate use that

495
00:24:27,400 --> 00:24:33,850
information and build something very

496
00:24:31,180 --> 00:24:37,720
specific to that campaign which can use

497
00:24:33,850 --> 00:24:39,959
for as long as these things are there

498
00:24:37,720 --> 00:24:47,140
which will be there for a long time

499
00:24:39,960 --> 00:24:50,770
not that you would do that another tool

500
00:24:47,140 --> 00:24:52,180
that I use quite often is show them and

501
00:24:50,770 --> 00:24:55,030
you see it a lot of the stuff that I've

502
00:24:52,180 --> 00:24:58,330
used here is three open source or very

503
00:24:55,030 --> 00:25:01,629
cheap so showdown is free to use and you

504
00:24:58,330 --> 00:25:03,909
can do a lot for your talent but every

505
00:25:01,630 --> 00:25:06,190
now and then I think it's a black black

506
00:25:03,910 --> 00:25:07,930
father sale they do every year where you

507
00:25:06,190 --> 00:25:10,990
can get a lifetime membership for five

508
00:25:07,930 --> 00:25:13,000
dollars which if you haven't got it I

509
00:25:10,990 --> 00:25:16,150
mean might as well that's the puffy in a

510
00:25:13,000 --> 00:25:18,400
bit definitely get it once you've got it

511
00:25:16,150 --> 00:25:19,990
you can you get API access you get I

512
00:25:18,400 --> 00:25:21,910
think you get ap access with free

513
00:25:19,990 --> 00:25:23,740
accounts as well but the number of

514
00:25:21,910 --> 00:25:27,850
queries you can run is a lot more with

515
00:25:23,740 --> 00:25:32,970
with a paid subscription just like these

516
00:25:27,850 --> 00:25:35,919
we quickly had a look at on short and

517
00:25:32,970 --> 00:25:38,530
once you move into shorter show down

518
00:25:35,920 --> 00:25:41,230
territory a lot of interesting things

519
00:25:38,530 --> 00:25:46,360
start coming up which we'll have a quick

520
00:25:41,230 --> 00:25:49,480
look at very soon so the ports be some

521
00:25:46,360 --> 00:25:52,419
of it is pretty obvious some of it is

522
00:25:49,480 --> 00:25:54,550
useful in the sense that when you start

523
00:25:52,420 --> 00:25:57,390
building a profile and I'm talking about

524
00:25:54,550 --> 00:25:59,860
hundreds of IPs over a period of time

525
00:25:57,390 --> 00:26:05,970
you'll start seeing similarities there

526
00:25:59,860 --> 00:26:09,760
and why is that important I'll show you

527
00:26:05,970 --> 00:26:12,010
so here's here's the thing hi a lot of

528
00:26:09,760 --> 00:26:14,980
this infrastructure you see used by

529
00:26:12,010 --> 00:26:17,200
these campaigns for the final stage no

530
00:26:14,980 --> 00:26:19,870
we don't care about them macro based or

531
00:26:17,200 --> 00:26:21,760
Dockers and JavaScript and all that this

532
00:26:19,870 --> 00:26:24,850
is the actual binary action happen one

533
00:26:21,760 --> 00:26:27,100
in the end of them in their campaigns a

534
00:26:24,850 --> 00:26:29,800
lot of this infrastructure when you

535
00:26:27,100 --> 00:26:31,689
start looking at it at scale once you've

536
00:26:29,800 --> 00:26:34,710
been working on these techniques for a

537
00:26:31,690 --> 00:26:37,049
while and you built a bit of a database

538
00:26:34,710 --> 00:26:41,370
and then you look at those in this sense

539
00:26:37,049 --> 00:26:45,000
you'll start seeing similarities most of

540
00:26:41,370 --> 00:26:47,850
this infrastructure for example being

541
00:26:45,000 --> 00:26:50,610
used for this particular campaign has

542
00:26:47,850 --> 00:26:53,699
this in common so all those that was

543
00:26:50,610 --> 00:26:57,120
being used for distributing this final

544
00:26:53,700 --> 00:26:59,730
payload have this vulnerability in

545
00:26:57,120 --> 00:27:02,250
common so it starts to build a really

546
00:26:59,730 --> 00:27:05,309
really clear picture as to what's really

547
00:27:02,250 --> 00:27:06,659
happening behind the scenes obviously

548
00:27:05,309 --> 00:27:09,840
they're not paying for the service

549
00:27:06,659 --> 00:27:12,299
they're just using these most probably

550
00:27:09,840 --> 00:27:14,340
not not the same actors but they're

551
00:27:12,299 --> 00:27:16,580
leasing these from some other actor

552
00:27:14,340 --> 00:27:18,809
who's already popped these based on

553
00:27:16,580 --> 00:27:21,330
vulnerabilities that you can see and

554
00:27:18,809 --> 00:27:23,279
once you start building this profile

555
00:27:21,330 --> 00:27:25,500
you'll see similarities are pretty

556
00:27:23,279 --> 00:27:28,500
pretty scary they're they're always the

557
00:27:25,500 --> 00:27:30,179
same role ability a lot of times you'll

558
00:27:28,500 --> 00:27:32,669
see a lot of fun ability but there will

559
00:27:30,179 --> 00:27:36,960
be a couple that are there common across

560
00:27:32,669 --> 00:27:42,000
the entire infrastructure now this is

561
00:27:36,960 --> 00:27:44,490
the VT graph tool and this is where it

562
00:27:42,000 --> 00:27:48,450
gets really interesting from a point

563
00:27:44,490 --> 00:27:51,210
that where we actually manually doing

564
00:27:48,450 --> 00:27:53,760
that bit instead of doing it every time

565
00:27:51,210 --> 00:27:56,240
we can literally just grab a couple of

566
00:27:53,760 --> 00:27:59,580
them not worry about the other sixty

567
00:27:56,240 --> 00:28:02,429
chuck it in there start expanding on

568
00:27:59,580 --> 00:28:04,500
that and I think with a free account you

569
00:28:02,429 --> 00:28:07,409
probably limited but if you've got a

570
00:28:04,500 --> 00:28:11,010
paid account which don't think is a lot

571
00:28:07,409 --> 00:28:14,070
considering what you get out of it you

572
00:28:11,010 --> 00:28:16,640
can expand and scale on so this is just

573
00:28:14,070 --> 00:28:19,168
a few seconds of work once you've got it

574
00:28:16,640 --> 00:28:24,390
why is this interesting and why is this

575
00:28:19,169 --> 00:28:27,659
useful because of this you can literally

576
00:28:24,390 --> 00:28:30,240
download the entire hash list for the

577
00:28:27,659 --> 00:28:32,789
entire campaign and this will take you

578
00:28:30,240 --> 00:28:36,029
just a few seconds so we've come from

579
00:28:32,789 --> 00:28:40,529
point where our frontline teams were

580
00:28:36,029 --> 00:28:43,470
focusing on downloader dropper type

581
00:28:40,529 --> 00:28:46,270
malware which is pretty like you

582
00:28:43,470 --> 00:28:48,160
know a couple of your eyes in there

583
00:28:46,270 --> 00:28:49,660
doesn't helps anyone there's thousands

584
00:28:48,160 --> 00:28:52,540
of them you block a couple on your

585
00:28:49,660 --> 00:28:54,190
perimeter they go to the other way the

586
00:28:52,540 --> 00:28:56,040
campaign itself will have hundreds of

587
00:28:54,190 --> 00:28:58,900
emails with completely different links

588
00:28:56,040 --> 00:29:02,649
we've gone from there to the final

589
00:28:58,900 --> 00:29:07,480
payload the actual malicious binary we

590
00:29:02,650 --> 00:29:10,060
brought we grabbed one IP C 2 IP from

591
00:29:07,480 --> 00:29:13,090
there chucked it in there and we

592
00:29:10,060 --> 00:29:16,540
literally were very close to grabbing

593
00:29:13,090 --> 00:29:20,169
the entire campaign and from experience

594
00:29:16,540 --> 00:29:25,480
these campaigns sort of laughed anywhere

595
00:29:20,170 --> 00:29:28,600
between 40 48 to 72 72 hours and that's

596
00:29:25,480 --> 00:29:29,640
a really really good result for such a

597
00:29:28,600 --> 00:29:32,740
short period of time

598
00:29:29,640 --> 00:29:35,080
and once you've automated this it will

599
00:29:32,740 --> 00:29:38,680
take just a couple of minutes so you've

600
00:29:35,080 --> 00:29:41,320
literally taken all of that work shut

601
00:29:38,680 --> 00:29:43,060
that out automated it brought the whole

602
00:29:41,320 --> 00:29:45,070
time frame down to a couple of minutes

603
00:29:43,060 --> 00:29:47,409
and it's happening in the background all

604
00:29:45,070 --> 00:29:50,500
the time and this will take care of the

605
00:29:47,410 --> 00:29:55,780
entire campaigns for at least a couple

606
00:29:50,500 --> 00:29:58,630
of days it doesn't change you can also

607
00:29:55,780 --> 00:30:00,340
download the IPS so you don't have to go

608
00:29:58,630 --> 00:30:03,120
and download different samples from the

609
00:30:00,340 --> 00:30:06,520
same campaign to cover that entire thing

610
00:30:03,120 --> 00:30:08,469
just keep scaling it and you'll see

611
00:30:06,520 --> 00:30:10,180
you'll see that you can get pretty much

612
00:30:08,470 --> 00:30:13,600
the entire campaign hundreds of IPs

613
00:30:10,180 --> 00:30:15,670
within a few seconds and if you blocked

614
00:30:13,600 --> 00:30:17,350
it you can pretty much just move on at

615
00:30:15,670 --> 00:30:20,710
that point and do something else other

616
00:30:17,350 --> 00:30:23,320
than you know spending time on this a

617
00:30:20,710 --> 00:30:25,780
lot of people ask at this point hey how

618
00:30:23,320 --> 00:30:29,020
much you're blocking your IPS what if

619
00:30:25,780 --> 00:30:34,330
you block some stuff that's actually

620
00:30:29,020 --> 00:30:35,980
legit so we've demonstrated before in a

621
00:30:34,330 --> 00:30:36,970
couple of slides that most of this

622
00:30:35,980 --> 00:30:40,960
infrastructure is pretty vulnerable

623
00:30:36,970 --> 00:30:45,010
anyway - I want my users to be visiting

624
00:30:40,960 --> 00:30:48,850
those servers within the next 42 hours

625
00:30:45,010 --> 00:30:52,750
even if by any mistake I've done that

626
00:30:48,850 --> 00:30:56,520
the actual the actual binary being

627
00:30:52,750 --> 00:30:58,410
served is not malicious but really I

628
00:30:56,520 --> 00:31:01,589
Pauline care that point on

629
00:30:58,410 --> 00:31:01,589
[Music]

630
00:31:02,289 --> 00:31:07,059
and is if you see I don't know if you

631
00:31:04,900 --> 00:31:09,820
can see but one of the IPS is actually

632
00:31:07,059 --> 00:31:13,539
highlighted so this is the same IP from

633
00:31:09,820 --> 00:31:16,030
the same sample that we looked at but we

634
00:31:13,539 --> 00:31:17,650
were able to grab it manually and as you

635
00:31:16,030 --> 00:31:20,289
can see without actually having to go

636
00:31:17,650 --> 00:31:23,200
through the entire sample entire binary

637
00:31:20,289 --> 00:31:24,549
and manually grabbing everything it's

638
00:31:23,200 --> 00:31:29,580
already there

639
00:31:24,549 --> 00:31:31,090
that's just like between is 30 seconds

640
00:31:29,580 --> 00:31:33,520
paint it

641
00:31:31,090 --> 00:31:35,980
once you've scaled it to the max this is

642
00:31:33,520 --> 00:31:38,799
something what the entire campaign looks

643
00:31:35,980 --> 00:31:42,789
like at this point I'm pretty pretty

644
00:31:38,799 --> 00:31:45,039
confident I can give it to my second

645
00:31:42,789 --> 00:31:48,070
option of wherever does that blocking

646
00:31:45,039 --> 00:31:51,760
and all that low quality stuff move on

647
00:31:48,070 --> 00:31:54,490
and this literally takes not more than a

648
00:31:51,760 --> 00:31:56,350
few minutes get this is the big we're

649
00:31:54,490 --> 00:32:05,789
pretty much done grabbing the entire

650
00:31:56,350 --> 00:32:08,289
content yeah expand it all the way now

651
00:32:05,789 --> 00:32:11,110
automation is another thing that we're

652
00:32:08,289 --> 00:32:13,840
pretty big at my my place of work

653
00:32:11,110 --> 00:32:19,270
because we're a software company we've

654
00:32:13,840 --> 00:32:20,830
got access to a lot of Engineers once

655
00:32:19,270 --> 00:32:23,530
you've done your research once you've

656
00:32:20,830 --> 00:32:25,809
actually done the hard work at that

657
00:32:23,530 --> 00:32:27,250
point in time I firmly believe that you

658
00:32:25,809 --> 00:32:28,809
should be able to automate it there's no

659
00:32:27,250 --> 00:32:32,289
point keep repeating the same thing over

660
00:32:28,809 --> 00:32:34,120
again every time how do you automate it

661
00:32:32,289 --> 00:32:36,158
there's many ways and this is just an

662
00:32:34,120 --> 00:32:40,239
example you I'm sure will come up with

663
00:32:36,159 --> 00:32:43,900
better ways of doing it this is a really

664
00:32:40,240 --> 00:32:46,900
simple thing a very simple yeah our

665
00:32:43,900 --> 00:32:48,549
template on Morris total as you can see

666
00:32:46,900 --> 00:32:50,650
I literally just grabbed a few strings

667
00:32:48,549 --> 00:32:52,780
put it in there you can put in different

668
00:32:50,650 --> 00:32:54,400
stuff in there other than strings make

669
00:32:52,780 --> 00:32:57,460
it really specific to that that

670
00:32:54,400 --> 00:32:59,049
particular family but this is just an

671
00:32:57,460 --> 00:33:01,659
example once you've done this it's

672
00:32:59,049 --> 00:33:03,960
pretty specific the only thing that can

673
00:33:01,659 --> 00:33:07,570
happen other than getting the same exact

674
00:33:03,960 --> 00:33:10,360
binary every time is someone reusing the

675
00:33:07,570 --> 00:33:12,490
code and changing it a little bit to

676
00:33:10,360 --> 00:33:15,000
create a new handle but it'll still be

677
00:33:12,490 --> 00:33:15,000
very similar

678
00:33:15,610 --> 00:33:22,179
this is just based on my rules a quick

679
00:33:19,480 --> 00:33:23,950
retro hunt so basically if you come in

680
00:33:22,180 --> 00:33:26,440
the morning the campaign started last

681
00:33:23,950 --> 00:33:29,530
last night you can do it for the last 12

682
00:33:26,440 --> 00:33:31,870
hours we have everything in there give

683
00:33:29,530 --> 00:33:34,120
it to your team that does all the

684
00:33:31,870 --> 00:33:35,860
blocking and stuff and move on at that

685
00:33:34,120 --> 00:33:39,520
point I'm don't and don't spend any more

686
00:33:35,860 --> 00:33:43,330
time alone you have the option of

687
00:33:39,520 --> 00:33:45,820
downloading the top 25 or top hundred or

688
00:33:43,330 --> 00:33:49,230
whatever basically you cover the entire

689
00:33:45,820 --> 00:33:51,490
campaign and you have the option of

690
00:33:49,230 --> 00:33:56,770
grabbing all these different formats

691
00:33:51,490 --> 00:33:59,920
just another example this time we picked

692
00:33:56,770 --> 00:34:00,940
Rick Bach as you can see doing all the

693
00:33:59,920 --> 00:34:03,040
stuff we did before

694
00:34:00,940 --> 00:34:05,860
while we're analyzing the actual binary

695
00:34:03,040 --> 00:34:09,639
you can grab a couple of c2 in from a c2

696
00:34:05,860 --> 00:34:11,409
ip's there and expand and scale pretty

697
00:34:09,639 --> 00:34:15,129
much in the similar fashion and you get

698
00:34:11,409 --> 00:34:16,750
everything in there again we've got all

699
00:34:15,130 --> 00:34:18,520
of that stuff very interesting to see

700
00:34:16,750 --> 00:34:20,409
how they're actually serving the buyers

701
00:34:18,520 --> 00:34:23,100
this is something that you'll put in

702
00:34:20,409 --> 00:34:27,279
your second tell database so you can

703
00:34:23,100 --> 00:34:30,730
profile them that's pretty much it

704
00:34:27,280 --> 00:34:32,620
before I finish off a quick note on how

705
00:34:30,730 --> 00:34:36,070
to automate it because a lot of people

706
00:34:32,620 --> 00:34:37,989
come afterwards and ask me that sounds

707
00:34:36,070 --> 00:34:40,450
pretty cool but how do we do it starting

708
00:34:37,989 --> 00:34:42,129
from the reverse engineering part and

709
00:34:40,449 --> 00:34:44,799
going all the way to threaten tell I'll

710
00:34:42,130 --> 00:34:48,300
quickly give you an example of how I do

711
00:34:44,800 --> 00:34:51,250
it you can use that or you can change it

712
00:34:48,300 --> 00:34:53,770
basically there are ways of automating

713
00:34:51,250 --> 00:34:56,650
the reverse engineering bits you can

714
00:34:53,770 --> 00:34:59,380
write plugins in Ollie for example or if

715
00:34:56,650 --> 00:35:01,630
you feel like we just use wind evil

716
00:34:59,380 --> 00:35:04,270
where you can literally set conditional

717
00:35:01,630 --> 00:35:06,790
breakpoints and keep it going and print

718
00:35:04,270 --> 00:35:10,390
all the output using mana or just to win

719
00:35:06,790 --> 00:35:14,770
debug into text files you can pass those

720
00:35:10,390 --> 00:35:19,259
text files using your API so you can you

721
00:35:14,770 --> 00:35:22,390
can you can check them on virustotal

722
00:35:19,260 --> 00:35:25,540
whatever hits you get based on that you

723
00:35:22,390 --> 00:35:28,690
can either create rules that you can say

724
00:35:25,540 --> 00:35:30,040
or you can literally just program it in

725
00:35:28,690 --> 00:35:32,140
a way where it's downloading everything

726
00:35:30,040 --> 00:35:35,200
that I showed you to download by itself

727
00:35:32,140 --> 00:35:38,500
once it's all done you can then the

728
00:35:35,200 --> 00:35:41,950
output you can and a put all the scripts

729
00:35:38,500 --> 00:35:44,200
on github from here this point on you

730
00:35:41,950 --> 00:35:45,819
can grab there and for example if you

731
00:35:44,200 --> 00:35:48,370
company's already using a threat Intel

732
00:35:45,820 --> 00:35:50,460
platform like Fred connect or otx or

733
00:35:48,370 --> 00:35:52,990
something you can pause those files

734
00:35:50,460 --> 00:35:55,570
threaten that has published their own

735
00:35:52,990 --> 00:35:59,709
api's and photo documentation on how to

736
00:35:55,570 --> 00:36:01,720
parse it once you download it all that

737
00:35:59,710 --> 00:36:04,300
stuff onto your box you can pass it

738
00:36:01,720 --> 00:36:06,580
using your third Intel platforms format

739
00:36:04,300 --> 00:36:08,920
and literally upload all of those

740
00:36:06,580 --> 00:36:11,049
indicators into your account from that

741
00:36:08,920 --> 00:36:16,420
point on if you've got integration with

742
00:36:11,050 --> 00:36:19,950
your scene or Splunk the scripts are

743
00:36:16,420 --> 00:36:23,290
bought on on github are working with

744
00:36:19,950 --> 00:36:25,240
fred connect and Splunk so basically you

745
00:36:23,290 --> 00:36:27,100
can pause all the rest of dump it in

746
00:36:25,240 --> 00:36:28,660
thread connect in your community once

747
00:36:27,100 --> 00:36:31,060
it's all there you can link it up with

748
00:36:28,660 --> 00:36:33,460
Splunk and if you never see any heat on

749
00:36:31,060 --> 00:36:35,410
that on your spark instance you can take

750
00:36:33,460 --> 00:36:38,200
actions and again if you've got an

751
00:36:35,410 --> 00:36:40,210
automatic automation engine there once

752
00:36:38,200 --> 00:36:43,870
you get a hit on this plunk you can take

753
00:36:40,210 --> 00:36:46,390
actions on it so basically it's possible

754
00:36:43,870 --> 00:36:48,549
to automate the entire process of where

755
00:36:46,390 --> 00:36:51,730
we started from up until when we finish

756
00:36:48,550 --> 00:36:53,860
and the only thing you need to do is

757
00:36:51,730 --> 00:36:56,500
every now and then check in for changes

758
00:36:53,860 --> 00:36:59,920
in the actual code and incorporate that

759
00:36:56,500 --> 00:37:02,760
back into your interest rates and that's

760
00:36:59,920 --> 00:37:04,630
pretty much it that's the conclusion

761
00:37:02,760 --> 00:37:10,170
conclusion is pretty much everything I

762
00:37:04,630 --> 00:37:10,170
just talked about and thank you and

763
00:37:15,750 --> 00:37:20,680
if you need any references the first

764
00:37:19,510 --> 00:37:23,710
three are pretty obvious

765
00:37:20,680 --> 00:37:25,328
these ones are detailed articles that

766
00:37:23,710 --> 00:37:26,980
are published you literally put my name

767
00:37:25,329 --> 00:37:29,470
and the name of the family in front of

768
00:37:26,980 --> 00:37:32,799
it and you'll you'll get a hit on Google

769
00:37:29,470 --> 00:37:47,399
on the actual detailed articles any

770
00:37:32,799 --> 00:37:49,990
questions yep just like with spice I

771
00:37:47,400 --> 00:37:52,660
agree with you though you've written and

772
00:37:49,990 --> 00:37:58,209
using doesn't make any difference

773
00:37:52,660 --> 00:38:00,578
have you throwing a little try to

774
00:37:58,210 --> 00:38:04,859
encourage them to medically softly make

775
00:38:00,579 --> 00:38:04,859
assessments themselves by saying the

776
00:38:05,400 --> 00:38:12,280
malware or sophistication this can even

777
00:38:09,190 --> 00:38:14,950
get them sort of realized the person

778
00:38:12,280 --> 00:38:24,549
right the identification of the training

779
00:38:14,950 --> 00:38:28,000
code are they yes there is there is big

780
00:38:24,549 --> 00:38:29,829
and I used to actually want you to talk

781
00:38:28,000 --> 00:38:31,630
about it with internally with my teams

782
00:38:29,829 --> 00:38:33,819
they used to have a section on the code

783
00:38:31,630 --> 00:38:35,500
reuse that's really helpful because you

784
00:38:33,819 --> 00:38:36,970
can see the similarities between you

785
00:38:35,500 --> 00:38:38,530
know there's only one good malware

786
00:38:36,970 --> 00:38:40,089
written four years ago and then

787
00:38:38,530 --> 00:38:42,490
everyone's just latched on to it pretty

788
00:38:40,089 --> 00:38:45,160
much and every now and then you see some

789
00:38:42,490 --> 00:38:46,959
leak source codes and a lot of people

790
00:38:45,160 --> 00:38:48,490
use that as well the only reason I

791
00:38:46,960 --> 00:38:49,839
haven't boddyhm in there now is because

792
00:38:48,490 --> 00:38:52,058
there are pretty solid products are

793
00:38:49,839 --> 00:38:56,380
available out there that do it for you

794
00:38:52,059 --> 00:39:00,460
basically it's much faster and then the

795
00:38:56,380 --> 00:39:02,680
entire sort of healing has been to make

796
00:39:00,460 --> 00:39:04,750
it really simple for the front lines you

797
00:39:02,680 --> 00:39:06,640
don't need to be a reverse engineer to

798
00:39:04,750 --> 00:39:09,250
do all of this stuff as long as we do

799
00:39:06,640 --> 00:39:11,259
the work and we give you exact things

800
00:39:09,250 --> 00:39:13,210
for example all those functions just

801
00:39:11,260 --> 00:39:16,119
talk at them you get you get to this

802
00:39:13,210 --> 00:39:17,290
point which is pretty advanced but to

803
00:39:16,119 --> 00:39:19,660
answer your question yeah that's that's

804
00:39:17,290 --> 00:39:22,720
definitely there the other thing we try

805
00:39:19,660 --> 00:39:24,368
to do is let you guys sort of explore a

806
00:39:22,720 --> 00:39:26,859
bit more Neil definitely find a lot more

807
00:39:24,369 --> 00:39:29,099
things different things than I have in

808
00:39:26,859 --> 00:39:29,098
the past

809
00:39:29,170 --> 00:39:35,090
and then quick story for example

810
00:39:31,430 --> 00:39:37,279
sometimes I I I once found a piece of

811
00:39:35,090 --> 00:39:39,290
code that was using very similar code

812
00:39:37,280 --> 00:39:41,030
that I'd seen before and when I looked

813
00:39:39,290 --> 00:39:43,550
more and more into it it was a really

814
00:39:41,030 --> 00:39:44,000
complex setting that layered it pretty

815
00:39:43,550 --> 00:39:46,910
good

816
00:39:44,000 --> 00:39:51,050
I found a scribe handle in there which

817
00:39:46,910 --> 00:39:53,180
belonged to an actor I'd see before and

818
00:39:51,050 --> 00:39:55,760
he was tracked all the way back to

819
00:39:53,180 --> 00:39:57,859
Turkey I think memory but yeah that kind

820
00:39:55,760 --> 00:39:58,450
of stuff you definitely won so I really

821
00:39:57,860 --> 00:40:00,950
good point

822
00:39:58,450 --> 00:40:18,799
just have a look at it see what else you

823
00:40:00,950 --> 00:40:20,540
can see Excel yeah look it's it's one of

824
00:40:18,800 --> 00:40:23,030
those things right I try to keep it very

825
00:40:20,540 --> 00:40:25,670
generic too because most of this is

826
00:40:23,030 --> 00:40:27,760
stuff that I can do it at my home I

827
00:40:25,670 --> 00:40:30,380
don't need the might of my

828
00:40:27,760 --> 00:40:32,360
billion-dollar company to accomplish all

829
00:40:30,380 --> 00:40:34,990
this right because not everyone has the

830
00:40:32,360 --> 00:40:37,940
same resources so it's literally like

831
00:40:34,990 --> 00:40:39,049
just a quick G sheet for example where

832
00:40:37,940 --> 00:40:42,800
you've got different tabs for different

833
00:40:39,050 --> 00:40:44,660
families works but yeah if you've got

834
00:40:42,800 --> 00:40:49,010
some platforming which is more complex

835
00:40:44,660 --> 00:40:50,680
and more expensive it'll be better Excel

836
00:40:49,010 --> 00:40:53,510
works fine because at the end of the day

837
00:40:50,680 --> 00:40:56,149
you just need to be able to do a quick

838
00:40:53,510 --> 00:40:58,760
cat on that tried or quit sorry a quick

839
00:40:56,150 --> 00:40:59,980
grip on it and see if you've seen

840
00:40:58,760 --> 00:41:04,370
something like that before

841
00:40:59,980 --> 00:41:09,160
CSP is work fine sorry sorry for her

842
00:41:04,370 --> 00:41:09,160
really basic and favorite yeah it works

843
00:41:26,170 --> 00:41:31,240
now it's just of a particular sample or

844
00:41:28,790 --> 00:41:31,240
a family

845
00:41:41,230 --> 00:41:46,520
I'd like to say you really depends on my

846
00:41:43,730 --> 00:41:49,960
daughters when they come to stop me for

847
00:41:46,520 --> 00:41:52,579
doing stuff but I think there's no real

848
00:41:49,960 --> 00:41:56,630
set in stone so everything really

849
00:41:52,579 --> 00:41:58,819
but what really works good is if you if

850
00:41:56,630 --> 00:42:00,980
you track it based on time but may

851
00:41:58,819 --> 00:42:02,890
experience is of seeing most campaigns

852
00:42:00,980 --> 00:42:05,780
last 48 hours before they start changing

853
00:42:02,890 --> 00:42:09,109
so if you are doing a retro you can go

854
00:42:05,780 --> 00:42:10,970
back 48 hours then most problem give me

855
00:42:09,109 --> 00:42:13,310
the entire thing and the final fail or

856
00:42:10,970 --> 00:42:15,919
the actual list of like these procedures

857
00:42:13,310 --> 00:42:17,720
they don't change that much because they

858
00:42:15,920 --> 00:42:20,300
don't really need to I if they've got

859
00:42:17,720 --> 00:42:24,109
like a hundred IPS they'll don't do the

860
00:42:20,300 --> 00:42:26,690
job for the next two days so it's a bit

861
00:42:24,109 --> 00:42:32,060
of a hidden mist pop yeah time is what

862
00:42:26,690 --> 00:42:33,710
I'll go for okay cool thanks guys if you

863
00:42:32,060 --> 00:42:35,000
ever end up in Australia please give me

864
00:42:33,710 --> 00:42:38,119
give me a shout

865
00:42:35,000 --> 00:42:41,119
join me on LinkedIn we're doing a/b

866
00:42:38,119 --> 00:42:43,339
slides in Sydney on 7th of September

867
00:42:41,119 --> 00:42:46,520
this year nice time to be in Sydney

868
00:42:43,339 --> 00:42:48,589
springtime everyone's invited if you do

869
00:42:46,520 --> 00:42:52,540
end up there let me know I'll definitely

870
00:42:48,589 --> 00:42:52,540
show you around so thanks again

871
00:42:52,880 --> 00:42:55,969
[Applause]

