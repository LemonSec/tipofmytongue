1
00:00:02,570 --> 00:00:08,840
so my name's ed Williams I'm here to

2
00:00:05,210 --> 00:00:11,870
talk about how we look to piss off an

3
00:00:08,840 --> 00:00:14,599
apt effectively when I talk about an ATP

4
00:00:11,870 --> 00:00:17,360
I mean nation-states organized crimes

5
00:00:14,599 --> 00:00:19,279
read teams or any sort of sophisticated

6
00:00:17,360 --> 00:00:22,250
attack that's going to test the breadth

7
00:00:19,279 --> 00:00:24,380
and the depth of your organization so

8
00:00:22,250 --> 00:00:26,349
here's a little bit about me um if you

9
00:00:24,380 --> 00:00:30,290
haven't already guessed I'm from Wales

10
00:00:26,349 --> 00:00:32,570
the other two yeah and no sheep jokes

11
00:00:30,290 --> 00:00:34,160
either from there on that as well as the

12
00:00:32,570 --> 00:00:38,450
red team that's how I see a red team in

13
00:00:34,160 --> 00:00:40,699
a nation-state yeah interesting facts

14
00:00:38,450 --> 00:00:41,840
about me I've got twins and I have been

15
00:00:40,700 --> 00:00:43,280
an art in the Bollywood film

16
00:00:41,840 --> 00:00:47,450
I almost said Hollywood but a Bollywood

17
00:00:43,280 --> 00:00:50,780
film and I got an IMDB page and as you

18
00:00:47,450 --> 00:00:54,140
can see there the phone was described as

19
00:00:50,780 --> 00:00:55,730
an insult to cinema so the the the

20
00:00:54,140 --> 00:00:58,820
obvious thing for me used to crack on

21
00:00:55,730 --> 00:01:03,199
with pen testing so when we talk about

22
00:00:58,820 --> 00:01:04,759
apt we're looking at the enemy and who

23
00:01:03,200 --> 00:01:07,130
do we consider the enemy to be and what

24
00:01:04,759 --> 00:01:09,860
what are they doing so I got to two

25
00:01:07,130 --> 00:01:13,610
courts here that I see so sanzu in his

26
00:01:09,860 --> 00:01:15,650
latest book on Amazon describe the the

27
00:01:13,610 --> 00:01:17,540
enemy as somebody who doesn't look at

28
00:01:15,650 --> 00:01:20,479
the risk register prior to attack and

29
00:01:17,540 --> 00:01:23,810
this actually is my favourites sort of

30
00:01:20,479 --> 00:01:25,280
poster subculture poster that I think

31
00:01:23,810 --> 00:01:27,380
explains exactly what the hacker

32
00:01:25,280 --> 00:01:30,320
mentality is and when you're looking to

33
00:01:27,380 --> 00:01:32,149
get into an environment or system these

34
00:01:30,320 --> 00:01:33,679
are the guys that you need to emulate

35
00:01:32,150 --> 00:01:35,600
and these are the guys that you need

36
00:01:33,680 --> 00:01:38,900
trying to stop simply performing a pen

37
00:01:35,600 --> 00:01:40,158
test and it's 2016 box that's not gonna

38
00:01:38,900 --> 00:01:42,380
get you very far you need to look at the

39
00:01:40,159 --> 00:01:44,090
edge cases the corners where that entry

40
00:01:42,380 --> 00:01:45,979
system is still around or the Windows

41
00:01:44,090 --> 00:01:49,610
2000 box or whatever it's so bear that

42
00:01:45,979 --> 00:01:50,990
in mind so I'm sure we're all aware the

43
00:01:49,610 --> 00:01:52,369
cyber kill chain I'm not gonna spend a

44
00:01:50,990 --> 00:01:54,020
huge amount of time that you break the

45
00:01:52,369 --> 00:01:55,729
chain and it should make your life

46
00:01:54,020 --> 00:01:57,560
easier doesn't always work like that in

47
00:01:55,729 --> 00:01:59,689
reality but that's that's how it should

48
00:01:57,560 --> 00:02:03,140
be and and how we look to get things

49
00:01:59,689 --> 00:02:06,169
done so one observation I've got and

50
00:02:03,140 --> 00:02:08,598
I've made over 1213 years of pen testing

51
00:02:06,170 --> 00:02:10,999
red teaming is zero days don't actually

52
00:02:08,598 --> 00:02:12,828
cause a PT's to succeed it's normally

53
00:02:10,999 --> 00:02:15,379
pop sec and technical debt

54
00:02:12,829 --> 00:02:16,220
and it's things like this where you got

55
00:02:15,379 --> 00:02:18,500
four

56
00:02:16,220 --> 00:02:22,640
fat thaw in these days in my instance

57
00:02:18,500 --> 00:02:25,340
running as an administrator whose sequel

58
00:02:22,640 --> 00:02:27,170
so you got sequel service running as

59
00:02:25,340 --> 00:02:29,960
domain admin that we see all the time

60
00:02:27,170 --> 00:02:31,309
that I've seen for the last 12 years and

61
00:02:29,960 --> 00:02:33,170
I'll probably see for another 12 years

62
00:02:31,310 --> 00:02:36,650
so don't do that because it's just

63
00:02:33,170 --> 00:02:39,890
really easy for us so how do we actually

64
00:02:36,650 --> 00:02:42,350
start to piss off an apt you've already

65
00:02:39,890 --> 00:02:44,450
seen this this pyramid of pain diagrams

66
00:02:42,350 --> 00:02:46,970
I won't go into too much detail but

67
00:02:44,450 --> 00:02:49,160
effectively you got tactical challenges

68
00:02:46,970 --> 00:02:50,930
and what I call strategical behavioral

69
00:02:49,160 --> 00:02:54,440
challenges so what you really need to do

70
00:02:50,930 --> 00:02:56,720
is as an attacker to to model an atan

71
00:02:54,440 --> 00:02:59,990
ATP you need to be looking at TTP's and

72
00:02:56,720 --> 00:03:01,550
tools and then when you're defending you

73
00:02:59,990 --> 00:03:02,720
need to be looking at stopping those

74
00:03:01,550 --> 00:03:04,100
tools and those behaviors

75
00:03:02,720 --> 00:03:05,990
it's the behaviors that you're really

76
00:03:04,100 --> 00:03:07,640
looking at so it's laughter movement

77
00:03:05,990 --> 00:03:08,990
credit dumping and those type of things

78
00:03:07,640 --> 00:03:12,350
but I highly recommend you read the

79
00:03:08,990 --> 00:03:13,700
article it's really good so again

80
00:03:12,350 --> 00:03:15,230
there's been a lot of talk about attack

81
00:03:13,700 --> 00:03:16,730
mic so I'm not going to consider on that

82
00:03:15,230 --> 00:03:18,440
but this is something that I contribute

83
00:03:16,730 --> 00:03:20,480
to and I'm involved in because it is

84
00:03:18,440 --> 00:03:22,010
really really useful I recommend that if

85
00:03:20,480 --> 00:03:23,959
you haven't had a look at it hopefully

86
00:03:22,010 --> 00:03:26,269
it get involved and I'm trying to

87
00:03:23,960 --> 00:03:28,700
interpret where you can so where do we

88
00:03:26,270 --> 00:03:30,470
begin when we're looking to piss off an

89
00:03:28,700 --> 00:03:32,030
apt or actually get into an environment

90
00:03:30,470 --> 00:03:34,430
you always begin at the beginning just

91
00:03:32,030 --> 00:03:36,560
always always int I always say to open

92
00:03:34,430 --> 00:03:38,000
source intelligence looking at stuff on

93
00:03:36,560 --> 00:03:40,640
the internet the dark web but or

94
00:03:38,000 --> 00:03:42,710
whatever it might be how do we do that

95
00:03:40,640 --> 00:03:44,089
how do we mitigate that then we do a lot

96
00:03:42,710 --> 00:03:46,790
laugh through the reducing X to

97
00:03:44,090 --> 00:03:48,080
invisibility seems kind of obvious don't

98
00:03:46,790 --> 00:03:50,450
run things that you don't need to run

99
00:03:48,080 --> 00:03:52,100
and run with limited privileges and just

100
00:03:50,450 --> 00:03:53,989
lock everything down because much to do

101
00:03:52,100 --> 00:03:55,280
can again easy said they're done and

102
00:03:53,990 --> 00:03:56,780
I'll go on to a little bit of an in

103
00:03:55,280 --> 00:04:00,709
detail but those are the high-level

104
00:03:56,780 --> 00:04:02,420
premises it's really important to to

105
00:04:00,709 --> 00:04:05,990
social media all the things so getting

106
00:04:02,420 --> 00:04:08,480
email addresses subdomain Discovery's

107
00:04:05,990 --> 00:04:12,530
release further how many times I've

108
00:04:08,480 --> 00:04:15,049
compromised an environment via you 80 or

109
00:04:12,530 --> 00:04:17,630
test or some sort of BPM it only knows

110
00:04:15,050 --> 00:04:19,970
is there and then pivoting into so what

111
00:04:17,630 --> 00:04:21,380
is really important so you really need

112
00:04:19,970 --> 00:04:24,950
to get a good handle on what you've got

113
00:04:21,380 --> 00:04:26,780
externally facing childern again I'm

114
00:04:24,950 --> 00:04:31,090
sure every aware of children

115
00:04:26,780 --> 00:04:31,090
people know where that port is mini-quiz

116
00:04:31,540 --> 00:04:38,990
476 tcp nobody Cisco's smart install so

117
00:04:37,910 --> 00:04:39,590
that's really bad if you go that on the

118
00:04:38,990 --> 00:04:41,810
Internet

119
00:04:39,590 --> 00:04:45,049
don't do that because there'll be

120
00:04:41,810 --> 00:04:47,480
nation-states looking to to get at you

121
00:04:45,050 --> 00:04:49,340
and stop things running on your

122
00:04:47,480 --> 00:04:52,930
infrastructure so make sure you know

123
00:04:49,340 --> 00:04:54,140
what's hitting what's internet facing

124
00:04:52,930 --> 00:04:56,270
again

125
00:04:54,140 --> 00:04:58,159
we see things like this all the time I

126
00:04:56,270 --> 00:04:59,780
checked this number this morning and

127
00:04:58,160 --> 00:05:02,060
it's absolutely accurate so there's

128
00:04:59,780 --> 00:05:04,309
still SMB over 2 million SMB services

129
00:05:02,060 --> 00:05:07,190
listening on the Internet which again

130
00:05:04,310 --> 00:05:08,630
isn't meant book so don't do that one a

131
00:05:07,190 --> 00:05:13,130
cry for example this is a classic

132
00:05:08,630 --> 00:05:15,500
example that again RDP so we saw CV 2000

133
00:05:13,130 --> 00:05:18,050
1907 knowing just two or three weeks ago

134
00:05:15,500 --> 00:05:20,030
that looks really nasty that's going to

135
00:05:18,050 --> 00:05:23,919
turn over a lot of people so anything

136
00:05:20,030 --> 00:05:26,750
RDP related get that off the internet

137
00:05:23,919 --> 00:05:33,950
can anybody spot the for shoes without

138
00:05:26,750 --> 00:05:36,350
RDP screen anybody so user name

139
00:05:33,950 --> 00:05:39,310
enumeration obviously Windows updates

140
00:05:36,350 --> 00:05:41,780
but on right now top bottom left even

141
00:05:39,310 --> 00:05:43,640
default user name admin and there's some

142
00:05:41,780 --> 00:05:45,880
FTP user which is probably going to be

143
00:05:43,640 --> 00:05:47,690
carnage so it's just that is just

144
00:05:45,880 --> 00:05:49,640
something that's going to be easily

145
00:05:47,690 --> 00:05:51,500
ownable or for somebody who's looking to

146
00:05:49,640 --> 00:05:53,380
concentrate on your environment so make

147
00:05:51,500 --> 00:05:55,790
sure you know what you've got out there

148
00:05:53,380 --> 00:05:57,800
so you can also really useful when you

149
00:05:55,790 --> 00:05:58,960
look into determine cloud services I

150
00:05:57,800 --> 00:06:01,790
love Oh

151
00:05:58,960 --> 00:06:03,560
365 love smashing through that I get a

152
00:06:01,790 --> 00:06:05,030
lot of joy through that so if you're

153
00:06:03,560 --> 00:06:09,229
looking to work out if they're using all

154
00:06:05,030 --> 00:06:10,700
365 saw with DNS MX records tax records

155
00:06:09,229 --> 00:06:14,390
will give you if they use a G suite are

156
00:06:10,700 --> 00:06:17,419
on 365 I'll talk a little bit later Aden

157
00:06:14,390 --> 00:06:19,219
and how we get into or 365 and how good

158
00:06:17,419 --> 00:06:21,620
it is the key not speaking yesterday

159
00:06:19,220 --> 00:06:23,780
mentioned that over 365 there's a lot

160
00:06:21,620 --> 00:06:25,910
for you and it does in terms of security

161
00:06:23,780 --> 00:06:28,659
but it also gives you quite a big attack

162
00:06:25,910 --> 00:06:31,070
surface that you can leverage

163
00:06:28,660 --> 00:06:32,210
so there's typical ante smoothing

164
00:06:31,070 --> 00:06:35,360
techniques that you probably need to be

165
00:06:32,210 --> 00:06:37,669
aware of SPF DK and D mark so you can

166
00:06:35,360 --> 00:06:39,140
stop spoofing emails also those checks

167
00:06:37,669 --> 00:06:39,680
for that as well so I definitely

168
00:06:39,140 --> 00:06:43,960
recommend

169
00:06:39,680 --> 00:06:45,860
do that I'm still on the OS int phase

170
00:06:43,960 --> 00:06:47,239
looking at whatever Doc's and

171
00:06:45,860 --> 00:06:49,220
organizations got this is this is my

172
00:06:47,240 --> 00:06:50,780
organization and they've got loads of

173
00:06:49,220 --> 00:06:51,830
Doc's out there and some of them will

174
00:06:50,780 --> 00:06:54,799
give you a clue as to what we're running

175
00:06:51,830 --> 00:06:57,469
internally so you can then look at a kit

176
00:06:54,800 --> 00:07:00,139
yawn and drive your fishing through that

177
00:06:57,470 --> 00:07:01,509
vector so how do we actually get in and

178
00:07:00,139 --> 00:07:04,729
how do you stop people from getting

179
00:07:01,509 --> 00:07:07,940
fishing believe it or not is still like

180
00:07:04,729 --> 00:07:09,800
shooting fish in a barrel macros still

181
00:07:07,940 --> 00:07:11,270
very popular and successful you might

182
00:07:09,800 --> 00:07:11,720
not believe me but there was this report

183
00:07:11,270 --> 00:07:15,020
from

184
00:07:11,720 --> 00:07:16,460
ncsc admittedly September 2018 but the

185
00:07:15,020 --> 00:07:19,639
numbers are pretty startling and pretty

186
00:07:16,460 --> 00:07:22,340
frightening even mature organizations

187
00:07:19,639 --> 00:07:26,419
still struggle with these type of things

188
00:07:22,340 --> 00:07:28,310
so it's not as hard as it might seem I

189
00:07:26,419 --> 00:07:30,169
don't know there's a lot of blue team as

190
00:07:28,310 --> 00:07:32,750
you would argue against me but the

191
00:07:30,169 --> 00:07:34,099
numbers of the numbers at the moment are

192
00:07:32,750 --> 00:07:36,590
the methods that we use and the really

193
00:07:34,099 --> 00:07:40,669
successful so HTA files

194
00:07:36,590 --> 00:07:42,409
HTF isles by HTML or well ii a little

195
00:07:40,669 --> 00:07:44,780
bit noisier and a little bit more

196
00:07:42,410 --> 00:07:46,490
obvious but if somebody's immature and

197
00:07:44,780 --> 00:07:48,679
they're gonna get gonna get knocked over

198
00:07:46,490 --> 00:07:52,099
with that dde was really popular

199
00:07:48,680 --> 00:07:54,380
probably 18 months two years ago still

200
00:07:52,099 --> 00:07:57,949
see that has been really useful as a

201
00:07:54,380 --> 00:08:00,409
release will attack vector another

202
00:07:57,949 --> 00:08:02,659
example ence machines were SMS fishing

203
00:08:00,409 --> 00:08:05,990
so imagine everybody's got a Ford of

204
00:08:02,659 --> 00:08:07,400
some description and have its pre not

205
00:08:05,990 --> 00:08:11,000
that difficult to get his phone number

206
00:08:07,400 --> 00:08:12,739
so sending an SMS malicious SMS we can

207
00:08:11,000 --> 00:08:14,030
leverage a lot of attack vectors through

208
00:08:12,740 --> 00:08:18,199
that where this credential are looking

209
00:08:14,030 --> 00:08:21,109
to corrupt the underlying form switching

210
00:08:18,199 --> 00:08:27,110
very popular social media who hasn't got

211
00:08:21,110 --> 00:08:29,120
a social media account no that's good so

212
00:08:27,110 --> 00:08:31,639
social media fishing also very popular

213
00:08:29,120 --> 00:08:33,469
same as any other sort of phishing

214
00:08:31,639 --> 00:08:36,740
attack but we still use it and it's

215
00:08:33,469 --> 00:08:38,750
still very successful harder to do

216
00:08:36,740 --> 00:08:42,260
watering hole type attacks you need to

217
00:08:38,750 --> 00:08:44,330
only the sort of third party so there's

218
00:08:42,260 --> 00:08:46,730
legal stuff around that but you need to

219
00:08:44,330 --> 00:08:48,470
bear that in mind to stop an apt and to

220
00:08:46,730 --> 00:08:52,800
stop the bad guys because because they

221
00:08:48,470 --> 00:08:56,309
will do that third party exploits

222
00:08:52,800 --> 00:08:57,449
so flash classically and anything asks

223
00:08:56,309 --> 00:08:59,209
this running like that but just don't

224
00:08:57,449 --> 00:09:01,550
run flash is my advice

225
00:08:59,209 --> 00:09:05,248
browsers there was a really pernicious

226
00:09:01,550 --> 00:09:06,959
Firefox CV that I saw yesterday that of

227
00:09:05,249 --> 00:09:08,040
really bad so we'd be looking at sort of

228
00:09:06,959 --> 00:09:10,309
leveraging those type things moving

229
00:09:08,040 --> 00:09:12,629
forwards and we normally typically

230
00:09:10,309 --> 00:09:14,850
fingerprint a browser through with user

231
00:09:12,629 --> 00:09:17,040
agent I know you can sort of spoof in

232
00:09:14,850 --> 00:09:19,019
that but generally we get a lot of

233
00:09:17,040 --> 00:09:21,118
success from identifying user agents and

234
00:09:19,019 --> 00:09:24,869
leveraging if they're running some sort

235
00:09:21,119 --> 00:09:27,600
of outdated browser and then again back

236
00:09:24,869 --> 00:09:29,970
to or 365 login login portal clones

237
00:09:27,600 --> 00:09:32,249
people love people left very familiar

238
00:09:29,970 --> 00:09:37,739
with all 365 and we get a lot of success

239
00:09:32,249 --> 00:09:42,149
from who who is running office 365 who

240
00:09:37,739 --> 00:09:44,100
isn't the same that's not the same okay

241
00:09:42,149 --> 00:09:46,439
but that makes sense if you're not

242
00:09:44,100 --> 00:09:52,980
running it is it G suite or something

243
00:09:46,439 --> 00:09:55,079
similar so password spraying again

244
00:09:52,980 --> 00:09:57,509
another really useful method of how we

245
00:09:55,079 --> 00:10:01,579
how we get in and this is from cert us

246
00:09:57,509 --> 00:10:04,619
and as you see there classic method

247
00:10:01,579 --> 00:10:06,299
username enumeration via any method and

248
00:10:04,619 --> 00:10:09,269
then just spraying them for week creds

249
00:10:06,299 --> 00:10:11,730
again office 365 is is really good at

250
00:10:09,269 --> 00:10:13,649
that and then once you get in download

251
00:10:11,730 --> 00:10:15,389
the gal we blow the restless and then

252
00:10:13,649 --> 00:10:17,040
you kick off again then but the beauty

253
00:10:15,389 --> 00:10:19,259
about kicking off again is you're in a

254
00:10:17,040 --> 00:10:21,269
trusted mailbox so if you come into my

255
00:10:19,259 --> 00:10:22,649
trusted mailboxes a lot you can then do

256
00:10:21,269 --> 00:10:25,529
to leverage yourself into the

257
00:10:22,649 --> 00:10:28,889
environment off to another another pivot

258
00:10:25,529 --> 00:10:32,549
point and there's the the reference

259
00:10:28,889 --> 00:10:37,439
format so Microsoft and others they do

260
00:10:32,549 --> 00:10:39,540
offer a lot of sort of empty hacking

261
00:10:37,439 --> 00:10:41,368
things for one of that expression for

262
00:10:39,540 --> 00:10:44,490
example anti-phishing they've got some

263
00:10:41,369 --> 00:10:47,480
some machine learning around that

264
00:10:44,490 --> 00:10:50,309
mailbox intelligence and safe links

265
00:10:47,480 --> 00:10:52,319
smart lock out so that uses again

266
00:10:50,309 --> 00:10:54,209
machine learning algorithms to spot

267
00:10:52,319 --> 00:10:55,498
unusual sign activity to say you're

268
00:10:54,209 --> 00:10:56,969
signing in from somewhere that you don't

269
00:10:55,499 --> 00:11:00,059
know me sign in from that will flag and

270
00:10:56,970 --> 00:11:02,999
then you can work off that flag MFA

271
00:11:00,059 --> 00:11:05,160
obviously because I say in some some of

272
00:11:02,999 --> 00:11:08,120
the newer things by imposters lists is a

273
00:11:05,160 --> 00:11:11,910
really useful I'd recommend you

274
00:11:08,120 --> 00:11:13,440
but the reality is those things are 100%

275
00:11:11,910 --> 00:11:15,420
accurate and we've been in situations

276
00:11:13,440 --> 00:11:17,190
and environments where were able to

277
00:11:15,420 --> 00:11:18,750
compromise even when some of those are

278
00:11:17,190 --> 00:11:21,150
turned on but not everybody turns these

279
00:11:18,750 --> 00:11:25,260
features on or is in aware of them and

280
00:11:21,150 --> 00:11:27,660
they're not perfect so this was the safe

281
00:11:25,260 --> 00:11:28,860
link spacecraft bypass I think it's

282
00:11:27,660 --> 00:11:32,100
probably about a year ago where you were

283
00:11:28,860 --> 00:11:34,560
able to just by using a base rife hit RF

284
00:11:32,100 --> 00:11:36,150
you could basically amalgamated the two

285
00:11:34,560 --> 00:11:37,829
together they would just fly through any

286
00:11:36,150 --> 00:11:40,650
any issue so you just need to be really

287
00:11:37,830 --> 00:11:42,030
mindful that one thing isn't going to

288
00:11:40,650 --> 00:11:45,209
stop somebody from getting into your

289
00:11:42,030 --> 00:11:47,670
environment so what really starts to

290
00:11:45,210 --> 00:11:50,100
piss them off passwords I would argue

291
00:11:47,670 --> 00:11:51,000
making your passwords difficult whatever

292
00:11:50,100 --> 00:11:55,740
that means

293
00:11:51,000 --> 00:11:57,720
NIST in 2017 released a latent a new

294
00:11:55,740 --> 00:12:01,140
version of their guidance and their

295
00:11:57,720 --> 00:12:02,550
guidance is eight character minimum up

296
00:12:01,140 --> 00:12:04,830
to 64 or greater

297
00:12:02,550 --> 00:12:07,140
it doesn't differentiate between non

298
00:12:04,830 --> 00:12:09,030
admins and admins so by that guidance

299
00:12:07,140 --> 00:12:11,870
alone you would get domain admins

300
00:12:09,030 --> 00:12:13,890
elevate character that don't do that

301
00:12:11,870 --> 00:12:15,960
some form of dictionary to disallow

302
00:12:13,890 --> 00:12:17,580
common passwords so there's a number of

303
00:12:15,960 --> 00:12:19,620
tools you can get in both Windows and

304
00:12:17,580 --> 00:12:22,740
UNIX that will stop you from creating a

305
00:12:19,620 --> 00:12:24,570
password a password one or some common

306
00:12:22,740 --> 00:12:25,890
words that you should only use for

307
00:12:24,570 --> 00:12:28,950
example your organisation's name so

308
00:12:25,890 --> 00:12:31,110
don't do that and now all printing

309
00:12:28,950 --> 00:12:33,480
characters including spaces and so you

310
00:12:31,110 --> 00:12:36,000
just see basically increasing the key

311
00:12:33,480 --> 00:12:37,800
space don't have a password of a space

312
00:12:36,000 --> 00:12:38,940
because that's not a very good idea even

313
00:12:37,800 --> 00:12:40,079
though it'd be difficult to see it when

314
00:12:38,940 --> 00:12:42,350
you actually crack it this has happened

315
00:12:40,080 --> 00:12:45,990
to me before

316
00:12:42,350 --> 00:12:47,640
throttling and so not lock out the

317
00:12:45,990 --> 00:12:51,630
throttling so just just monitoring

318
00:12:47,640 --> 00:12:53,670
what's going on I'm probably most most

319
00:12:51,630 --> 00:12:56,310
interesting from my perspective is nor

320
00:12:53,670 --> 00:12:58,140
require my password exploration so don't

321
00:12:56,310 --> 00:13:01,760
change your password once you get a good

322
00:12:58,140 --> 00:13:03,870
password stick to it and don't change it

323
00:13:01,760 --> 00:13:05,280
so this was relatively new and I don't

324
00:13:03,870 --> 00:13:07,080
see a lot of organizations doing that

325
00:13:05,280 --> 00:13:09,089
and the NCC have actually done the same

326
00:13:07,080 --> 00:13:11,310
thing and recommended that get a good

327
00:13:09,090 --> 00:13:12,660
password keep it unique but there's no

328
00:13:11,310 --> 00:13:14,790
there's no need to change it was long as

329
00:13:12,660 --> 00:13:17,880
you cycle it and put a zero on at the

330
00:13:14,790 --> 00:13:18,990
end of it and then the solvus recently

331
00:13:17,880 --> 00:13:22,950
saw makeup and

332
00:13:18,990 --> 00:13:24,990
and spotted from ad security that cloud

333
00:13:22,950 --> 00:13:26,459
Azur cloud stuff is now increasing their

334
00:13:24,990 --> 00:13:29,670
past their maximum password so that's

335
00:13:26,459 --> 00:13:31,859
that's really good really positive so

336
00:13:29,670 --> 00:13:34,170
what is frustrating is when you see

337
00:13:31,860 --> 00:13:34,680
things like this frustrating for two

338
00:13:34,170 --> 00:13:36,810
reasons

339
00:13:34,680 --> 00:13:39,359
one is there's an issue with that and

340
00:13:36,810 --> 00:13:46,079
secondly it's it's mfa can they be spot

341
00:13:39,360 --> 00:13:49,230
why is that not a good idea for MFA so

342
00:13:46,080 --> 00:13:52,589
it's using SMS as the second factor or

343
00:13:49,230 --> 00:13:54,660
the multiple factor SMS is not a good

344
00:13:52,589 --> 00:13:56,670
idea for a second factor so I wouldn't

345
00:13:54,660 --> 00:13:59,880
recommend it there's a number of tricks

346
00:13:56,670 --> 00:14:01,050
you can do about swing phones and it's

347
00:13:59,880 --> 00:14:04,170
not that difficult do we've actually

348
00:14:01,050 --> 00:14:05,729
done it on a few sites and few tests so

349
00:14:04,170 --> 00:14:07,709
I semester the second fact is dead so

350
00:14:05,730 --> 00:14:09,120
wherever you see that probably raise an

351
00:14:07,709 --> 00:14:10,380
issue and there was something that I

352
00:14:09,120 --> 00:14:11,910
spotted on moneybox

353
00:14:10,380 --> 00:14:15,120
a while ago when TSP customers were

354
00:14:11,910 --> 00:14:17,279
being hit by something very similar so

355
00:14:15,120 --> 00:14:20,940
on to mobile my favorite things office

356
00:14:17,279 --> 00:14:22,950
365 so Trust trusted sac did a really

357
00:14:20,940 --> 00:14:25,649
good blog post probably two or three

358
00:14:22,950 --> 00:14:27,360
weeks ago where they mapped a number of

359
00:14:25,649 --> 00:14:29,370
different attack factors for office 365

360
00:14:27,360 --> 00:14:32,760
the first and the best ones where a

361
00:14:29,370 --> 00:14:35,520
single URL will give you the identify if

362
00:14:32,760 --> 00:14:37,380
it is using all 365 then you can kick on

363
00:14:35,520 --> 00:14:39,990
again so where you see here the

364
00:14:37,380 --> 00:14:42,060
namespace type if that's managed that

365
00:14:39,990 --> 00:14:43,890
then is using office 365 if it's

366
00:14:42,060 --> 00:14:46,770
federated then obviously federated ad

367
00:14:43,890 --> 00:14:48,899
and unknown is doesn't exist and doesn't

368
00:14:46,770 --> 00:14:52,319
exist in this moment so that's Amazon no

369
00:14:48,899 --> 00:14:54,839
surprise and then then you can start to

370
00:14:52,320 --> 00:14:57,140
enumerate user names and office 365 this

371
00:14:54,839 --> 00:15:01,680
is a really nice combination here so 200

372
00:14:57,140 --> 00:15:03,510
you're in which makes sense a 401 so you

373
00:15:01,680 --> 00:15:05,729
got a valid username and password then

374
00:15:03,510 --> 00:15:08,100
that means it doesn't require to a face

375
00:15:05,730 --> 00:15:10,260
so you can just password spray that 403

376
00:15:08,100 --> 00:15:13,140
valid username good password but you do

377
00:15:10,260 --> 00:15:15,300
need to FA so if the two FA is SMS and

378
00:15:13,140 --> 00:15:17,399
you can you start to do that or look at

379
00:15:15,300 --> 00:15:18,870
something else and then 404 then it's an

380
00:15:17,399 --> 00:15:20,910
invalid username so you can just grab

381
00:15:18,870 --> 00:15:22,770
one of the many user name lists on the

382
00:15:20,910 --> 00:15:24,750
internet and just spray that against

383
00:15:22,770 --> 00:15:28,980
office 365 get a list the user names and

384
00:15:24,750 --> 00:15:31,910
then go again then exchange web services

385
00:15:28,980 --> 00:15:36,140
or legacy services so

386
00:15:31,910 --> 00:15:38,540
the o365 portland may require two fa but

387
00:15:36,140 --> 00:15:41,510
exchange web services doesn't always so

388
00:15:38,540 --> 00:15:43,040
from your base client you can attempt to

389
00:15:41,510 --> 00:15:44,689
connect so you've got credentials

390
00:15:43,040 --> 00:15:46,670
username password and then that will

391
00:15:44,690 --> 00:15:49,190
bypass any two fa requirement and it's

392
00:15:46,670 --> 00:15:52,550
quite simple URL so you just need to to

393
00:15:49,190 --> 00:15:54,260
map that and manage it so if you see two

394
00:15:52,550 --> 00:15:55,640
fa on the portal doesn't necessarily

395
00:15:54,260 --> 00:16:00,290
mean that it's gonna be two fa for these

396
00:15:55,640 --> 00:16:03,939
next services so property fa again I saw

397
00:16:00,290 --> 00:16:06,560
this fairly recently Google apparently

398
00:16:03,940 --> 00:16:09,230
their eighty five thousand ploys hadn't

399
00:16:06,560 --> 00:16:12,650
been attacked and that is from their

400
00:16:09,230 --> 00:16:15,020
them using a hardware key saw that

401
00:16:12,650 --> 00:16:16,490
obviously even if is half true that is

402
00:16:15,020 --> 00:16:19,550
obviously a good step forward and I

403
00:16:16,490 --> 00:16:22,490
definitely recommend that do that for

404
00:16:19,550 --> 00:16:25,640
your organization so removing technical

405
00:16:22,490 --> 00:16:27,590
debt so once we get into an organization

406
00:16:25,640 --> 00:16:29,420
one way of stopping us from doing

407
00:16:27,590 --> 00:16:31,580
anything is is removing the stuff that's

408
00:16:29,420 --> 00:16:33,680
easy to do not go over into pool so

409
00:16:31,580 --> 00:16:35,210
again the enemy does not check your risk

410
00:16:33,680 --> 00:16:37,640
register prior to attacking so make sure

411
00:16:35,210 --> 00:16:40,100
you are actually getting rid of that

412
00:16:37,640 --> 00:16:41,500
Windows 2000 box or that 2003 box or

413
00:16:40,100 --> 00:16:43,820
even two hours late box these days

414
00:16:41,500 --> 00:16:45,260
that's the main join because that is the

415
00:16:43,820 --> 00:16:48,400
thing that the bad guys gonna look I'm

416
00:16:45,260 --> 00:16:50,210
not gonna bother with the 2016 boxes

417
00:16:48,400 --> 00:16:52,579
admittedly this can be really difficult

418
00:16:50,210 --> 00:16:54,620
in large complex environments if you got

419
00:16:52,580 --> 00:16:56,960
legacy kit mainframes is for hundreds

420
00:16:54,620 --> 00:16:58,250
and things and 0's is again it can be

421
00:16:56,960 --> 00:16:59,270
difficult that's going to be somewhere

422
00:16:58,250 --> 00:17:02,390
that the bad guys are going to look to

423
00:16:59,270 --> 00:17:04,310
attack the next thing that's really

424
00:17:02,390 --> 00:17:07,099
important I think is is how it is being

425
00:17:04,310 --> 00:17:10,069
mature and being mature response is

426
00:17:07,099 --> 00:17:12,889
assuming you've reached so John Lambert

427
00:17:10,069 --> 00:17:15,139
Microsoft has got an excellent sort of

428
00:17:12,890 --> 00:17:17,540
sentence around this and how you can

429
00:17:15,140 --> 00:17:19,520
look to defend defenders thinkin lists

430
00:17:17,540 --> 00:17:22,188
and attackers thinking graphs so what

431
00:17:19,520 --> 00:17:23,689
that actually means is and you've got a

432
00:17:22,189 --> 00:17:25,610
domain controller that probably the bad

433
00:17:23,689 --> 00:17:26,600
guy want to go after why go after the

434
00:17:25,609 --> 00:17:29,050
domain controller that might be really

435
00:17:26,599 --> 00:17:32,330
lockdown we just go after Bob who admins

436
00:17:29,050 --> 00:17:34,780
the DC he's probably not his workstation

437
00:17:32,330 --> 00:17:38,300
is probably not a lot than will station

438
00:17:34,780 --> 00:17:40,010
and I see the end user device or the

439
00:17:38,300 --> 00:17:42,050
workstation this is the battleground

440
00:17:40,010 --> 00:17:45,530
so that is one of my kids pointing again

441
00:17:42,050 --> 00:17:47,450
at another one so it's really important

442
00:17:45,530 --> 00:17:48,500
that's concentrate on the end-users

443
00:17:47,450 --> 00:17:50,930
advice because that if somebody's coming

444
00:17:48,500 --> 00:17:53,330
external to in to take it around on a

445
00:17:50,930 --> 00:17:56,090
desktop so making sure that you can you

446
00:17:53,330 --> 00:17:57,980
can lock that desktop down once somebody

447
00:17:56,090 --> 00:17:59,480
does get foot told onto an end-user

448
00:17:57,980 --> 00:18:02,150
devices there's probably gonna be one or

449
00:17:59,480 --> 00:18:04,250
two things that happens they're gonna

450
00:18:02,150 --> 00:18:07,100
look to do situational awareness and the

451
00:18:04,250 --> 00:18:09,440
numeric rads so patching if there's any

452
00:18:07,100 --> 00:18:11,240
aunty exploit mitigations on there just

453
00:18:09,440 --> 00:18:13,630
the general level of hardening where the

454
00:18:11,240 --> 00:18:17,060
lapses on there he met back in the day

455
00:18:13,630 --> 00:18:18,770
when casting firewall rules and general

456
00:18:17,060 --> 00:18:20,419
or games you are logging tapes is really

457
00:18:18,770 --> 00:18:21,950
good stuff so that's the type of stuff

458
00:18:20,420 --> 00:18:24,860
you would look for when you situational

459
00:18:21,950 --> 00:18:26,630
awareness on a box or you gonna

460
00:18:24,860 --> 00:18:29,000
enumerate the local horse and then

461
00:18:26,630 --> 00:18:30,500
spread to the network so so maybe you're

462
00:18:29,000 --> 00:18:32,240
gonna do some elzar cruise to the d c--

463
00:18:30,500 --> 00:18:34,490
maybe they run some net commands to see

464
00:18:32,240 --> 00:18:38,110
see the domain users or anything like

465
00:18:34,490 --> 00:18:41,930
that so it's trying to reduce that scope

466
00:18:38,110 --> 00:18:44,780
so how did you stop that you had the end

467
00:18:41,930 --> 00:18:45,220
user device it's pretty pretty simple

468
00:18:44,780 --> 00:18:47,360
really

469
00:18:45,220 --> 00:18:50,510
so what you need to do is you new things

470
00:18:47,360 --> 00:18:54,110
like laps is every running laps here ya

471
00:18:50,510 --> 00:18:56,180
know maybe you need whitelisting a blog

472
00:18:54,110 --> 00:18:59,990
so make sure they can't run any sort of

473
00:18:56,180 --> 00:19:02,750
any commands msbuild so - till we seen

474
00:18:59,990 --> 00:19:04,670
their net all command those type of

475
00:19:02,750 --> 00:19:05,840
things powershell both versions so make

476
00:19:04,670 --> 00:19:07,700
sure you you're really locking those

477
00:19:05,840 --> 00:19:08,570
things now and what's really important

478
00:19:07,700 --> 00:19:10,130
the things that we don't see often

479
00:19:08,570 --> 00:19:11,990
enough horse-based firewalls

480
00:19:10,130 --> 00:19:13,580
there's probably no reason why desktops

481
00:19:11,990 --> 00:19:15,200
need to communicate with one another by

482
00:19:13,580 --> 00:19:17,240
SMB so you can probably lock that down

483
00:19:15,200 --> 00:19:19,520
that'll stop some lateral movement and

484
00:19:17,240 --> 00:19:21,350
then be really understanding of data

485
00:19:19,520 --> 00:19:22,490
flows and then looked a lot of fat down

486
00:19:21,350 --> 00:19:24,649
so you've got some form of micro

487
00:19:22,490 --> 00:19:26,030
segregation which does make it really

488
00:19:24,650 --> 00:19:27,260
hard for an attacker because once they

489
00:19:26,030 --> 00:19:28,550
if they can't really get out of that

490
00:19:27,260 --> 00:19:30,260
little share this can be really hard for

491
00:19:28,550 --> 00:19:31,580
them to to get what they actually want

492
00:19:30,260 --> 00:19:35,000
which would be probably some form of

493
00:19:31,580 --> 00:19:36,590
data some phone credential and logging

494
00:19:35,000 --> 00:19:38,300
as well we can viewed a lot of stuff

495
00:19:36,590 --> 00:19:40,340
what system on and which is a great tool

496
00:19:38,300 --> 00:19:42,139
and highly recommend using it but make

497
00:19:40,340 --> 00:19:45,409
sure you are logging and pushing those

498
00:19:42,140 --> 00:19:47,590
logs off properly if you do get onto a

499
00:19:45,410 --> 00:19:51,080
box one of my favorite things to do is

500
00:19:47,590 --> 00:19:54,678
kerberos thing so effectively as a

501
00:19:51,080 --> 00:19:57,379
domain user you can query the the

502
00:19:54,679 --> 00:19:59,060
Kerberos service ETA TCP and get a load

503
00:19:57,380 --> 00:20:00,760
of SPS

504
00:19:59,060 --> 00:20:03,139
and that poorly they're pulling

505
00:20:00,760 --> 00:20:05,390
encrypted so you can decrypt them easier

506
00:20:03,140 --> 00:20:08,330
than rather than having to and to go

507
00:20:05,390 --> 00:20:10,790
through the pain of getting onto the d

508
00:20:08,330 --> 00:20:11,810
c-- and then dropping in tds and that's

509
00:20:10,790 --> 00:20:15,320
the tool I wrote that does some of that

510
00:20:11,810 --> 00:20:17,690
but there's some detailer living off the

511
00:20:15,320 --> 00:20:19,399
land so that is in my house and I think

512
00:20:17,690 --> 00:20:23,210
it's grants house was he over there

513
00:20:19,400 --> 00:20:25,130
right yeah so living off the land it's

514
00:20:23,210 --> 00:20:27,830
not a new technique a lot of people talk

515
00:20:25,130 --> 00:20:30,350
about it Oh a the bad guys then the less

516
00:20:27,830 --> 00:20:32,480
likely to upload tools or malware what

517
00:20:30,350 --> 00:20:34,429
they're gonna do is use inbuilt tools so

518
00:20:32,480 --> 00:20:36,800
what you need to do is lock that down so

519
00:20:34,430 --> 00:20:38,360
they could use PowerShell WMI even the

520
00:20:36,800 --> 00:20:41,180
net tools or anything that's going to

521
00:20:38,360 --> 00:20:43,550
spread their sort of persistence I'm

522
00:20:41,180 --> 00:20:45,170
including BMS build which is something

523
00:20:43,550 --> 00:20:48,230
that we use a lot of in our organization

524
00:20:45,170 --> 00:20:50,060
unser to tell again and it's another

525
00:20:48,230 --> 00:20:52,670
example of living off the land it's just

526
00:20:50,060 --> 00:20:55,790
it's a very simple way of just dropping

527
00:20:52,670 --> 00:20:57,350
some creds using inbuilt tools so

528
00:20:55,790 --> 00:20:59,060
there's some red keys that you just do

529
00:20:57,350 --> 00:21:00,320
and then that will give you the the

530
00:20:59,060 --> 00:21:02,120
hives and you can push them off to your

531
00:21:00,320 --> 00:21:06,020
box and then you can crack them so

532
00:21:02,120 --> 00:21:06,709
that's again really simple so effect IDs

533
00:21:06,020 --> 00:21:08,720
again

534
00:21:06,710 --> 00:21:11,300
the earlier the gorilla talked spoke

535
00:21:08,720 --> 00:21:12,770
about system on and logging and things

536
00:21:11,300 --> 00:21:16,129
like that so it's it's really

537
00:21:12,770 --> 00:21:18,410
recommended that you do use and you do

538
00:21:16,130 --> 00:21:20,810
collect appropriate event IDs from my

539
00:21:18,410 --> 00:21:23,480
experience people either log nothing or

540
00:21:20,810 --> 00:21:25,460
log everything and neither of them are

541
00:21:23,480 --> 00:21:26,780
particularly good doesn't help you when

542
00:21:25,460 --> 00:21:29,750
you're trying to work with a customer to

543
00:21:26,780 --> 00:21:32,480
say okay we got a privilege did you see

544
00:21:29,750 --> 00:21:36,620
us doing XYZ and there's a yes or no or

545
00:21:32,480 --> 00:21:37,730
maybe cleanup and covering tracks so

546
00:21:36,620 --> 00:21:40,070
this is something that would definitely

547
00:21:37,730 --> 00:21:41,330
recommend people monitor for and if you

548
00:21:40,070 --> 00:21:43,250
can see in that particularly well but

549
00:21:41,330 --> 00:21:46,189
but when you clear all the event logs

550
00:21:43,250 --> 00:21:49,010
that in itself creates a service one one

551
00:21:46,190 --> 00:21:51,530
zero to clear of head logs so so either

552
00:21:49,010 --> 00:21:53,300
dog do that if you are getting into an

553
00:21:51,530 --> 00:21:56,540
environment because this is pretty

554
00:21:53,300 --> 00:21:59,419
obvious I think I know you can see that

555
00:21:56,540 --> 00:22:00,860
there and the the other thing is these

556
00:21:59,420 --> 00:22:03,260
tools like memory cards now are getting

557
00:22:00,860 --> 00:22:05,270
quite efficient at stopping event logs

558
00:22:03,260 --> 00:22:06,590
and then not logging what's going on so

559
00:22:05,270 --> 00:22:08,540
you just need to be mindful of that but

560
00:22:06,590 --> 00:22:09,830
if you do see one one zero two there's

561
00:22:08,540 --> 00:22:12,320
that see no reason why anybody should be

562
00:22:09,830 --> 00:22:16,010
clear in their event logs

563
00:22:12,320 --> 00:22:18,860
you can see other other things that need

564
00:22:16,010 --> 00:22:21,590
to be monitored local group changes so

565
00:22:18,860 --> 00:22:23,000
there's two events for that so typically

566
00:22:21,590 --> 00:22:25,189
if you do get on to a box and you get

567
00:22:23,000 --> 00:22:27,860
some sort of privilege you might want to

568
00:22:25,190 --> 00:22:29,540
create a user for persistence well

569
00:22:27,860 --> 00:22:31,340
that's easier to be easily flag up so

570
00:22:29,540 --> 00:22:35,480
make sure you do that and there's that

571
00:22:31,340 --> 00:22:37,370
there's some event IDs for that laughter

572
00:22:35,480 --> 00:22:39,020
look out movement make sure you're

573
00:22:37,370 --> 00:22:40,310
monitoring for that this is it's a

574
00:22:39,020 --> 00:22:42,260
couple of different ways to do it

575
00:22:40,310 --> 00:22:43,790
there's LDAP and there's SMB Susan make

576
00:22:42,260 --> 00:22:47,360
sure you monitor both of those that

577
00:22:43,790 --> 00:22:48,500
makes it really hard to if somebody does

578
00:22:47,360 --> 00:22:50,270
get into your vironment they are going

579
00:22:48,500 --> 00:22:52,160
to need to move somewhere and they're

580
00:22:50,270 --> 00:22:53,810
unlikely to land on DC if they did

581
00:22:52,160 --> 00:22:55,490
that'd be really bad

582
00:22:53,810 --> 00:22:58,159
make sure you looking for application

583
00:22:55,490 --> 00:23:01,220
crashes for example if we're using flash

584
00:22:58,160 --> 00:23:02,330
a flash exploit that's going to crash in

585
00:23:01,220 --> 00:23:04,730
a crash the app so you need to make sure

586
00:23:02,330 --> 00:23:07,790
you doing that service installation for

587
00:23:04,730 --> 00:23:10,250
example PS exec creates a service when

588
00:23:07,790 --> 00:23:12,170
you run it or my tradecraft doesn't

589
00:23:10,250 --> 00:23:13,970
involve PS exact but some people do so

590
00:23:12,170 --> 00:23:16,130
make sure you if you do use it

591
00:23:13,970 --> 00:23:18,830
be aware that it is creating an event

592
00:23:16,130 --> 00:23:20,390
and then monitor for that event and

593
00:23:18,830 --> 00:23:25,159
that's just an example and from us-cert

594
00:23:20,390 --> 00:23:26,990
with some TTP's that I mentioned earlier

595
00:23:25,160 --> 00:23:28,880
pastor spraying SSM being a domain

596
00:23:26,990 --> 00:23:33,350
controller so that's got quite a few

597
00:23:28,880 --> 00:23:35,240
events but ones if we don't use SMB then

598
00:23:33,350 --> 00:23:37,399
do you manage it so you can use new

599
00:23:35,240 --> 00:23:39,230
zelda to queerly the DC to get to get

600
00:23:37,400 --> 00:23:41,030
information on that again as an event

601
00:23:39,230 --> 00:23:42,880
that you need to monitor so be mindful

602
00:23:41,030 --> 00:23:45,620
of those things

603
00:23:42,880 --> 00:23:47,660
Kerberos logging so that that is quite

604
00:23:45,620 --> 00:23:48,770
complicated and it can get really noisy

605
00:23:47,660 --> 00:23:50,780
so you need to be mindful that if

606
00:23:48,770 --> 00:23:54,050
somebody is doing some Kerberos based

607
00:23:50,780 --> 00:23:55,700
attacks you can't really need to to trim

608
00:23:54,050 --> 00:23:57,260
that down and to keep a really close eye

609
00:23:55,700 --> 00:23:59,110
because it because it will get noisy so

610
00:23:57,260 --> 00:24:02,390
needs to be needs to be managed somehow

611
00:23:59,110 --> 00:24:03,949
you know is this person should they be

612
00:24:02,390 --> 00:24:05,180
doing this Kerberos traffic at this

613
00:24:03,950 --> 00:24:08,900
point in time you need a bit of

614
00:24:05,180 --> 00:24:10,460
intelligence around that so some some

615
00:24:08,900 --> 00:24:12,440
advice and some of the things that I

616
00:24:10,460 --> 00:24:14,600
think are release well from my

617
00:24:12,440 --> 00:24:16,490
perspective as a pen tester that I don't

618
00:24:14,600 --> 00:24:19,580
see enough of people actually understand

619
00:24:16,490 --> 00:24:22,250
the network you know it's quite easy now

620
00:24:19,580 --> 00:24:23,780
to spin up a box with I know two

621
00:24:22,250 --> 00:24:25,370
thousand or three just as a test box

622
00:24:23,780 --> 00:24:29,360
with sequel on it so make

623
00:24:25,370 --> 00:24:31,280
you understand that - I understand have

624
00:24:29,360 --> 00:24:32,840
data flows around you network if you

625
00:24:31,280 --> 00:24:34,070
don't understand of data poses around

626
00:24:32,840 --> 00:24:37,100
your network you're not going to be able

627
00:24:34,070 --> 00:24:38,689
to micro segment it correctly or not you

628
00:24:37,100 --> 00:24:40,669
just to put some rails around it that'll

629
00:24:38,690 --> 00:24:42,680
make it a lot harder for people inside

630
00:24:40,670 --> 00:24:45,770
and external to be able to cross

631
00:24:42,680 --> 00:24:47,780
boundaries I'm really concentrate on

632
00:24:45,770 --> 00:24:48,980
TTP's and behaviors I think that's

633
00:24:47,780 --> 00:24:50,300
really key is the one thing you should

634
00:24:48,980 --> 00:24:52,250
probably if you can take out of here is

635
00:24:50,300 --> 00:24:54,260
is make sure you're not looking at his

636
00:24:52,250 --> 00:24:56,990
hashes you're looking at what people do

637
00:24:54,260 --> 00:24:58,730
whether it's and tread dumping or moving

638
00:24:56,990 --> 00:25:00,260
laterally or I'm trying to break out

639
00:24:58,730 --> 00:25:01,730
another environment or something like

640
00:25:00,260 --> 00:25:04,280
that so those are the behaviors that

641
00:25:01,730 --> 00:25:05,660
links back then to make their attack so

642
00:25:04,280 --> 00:25:07,010
so have a good look at I know a lot of

643
00:25:05,660 --> 00:25:11,120
people spoken about if it is really

644
00:25:07,010 --> 00:25:12,650
worth looking up so I definitely can see

645
00:25:11,120 --> 00:25:14,059
a lot of this people not raising their

646
00:25:12,650 --> 00:25:16,280
domain functional level I'm not getting

647
00:25:14,059 --> 00:25:19,129
the benefits out of it so again in a

648
00:25:16,280 --> 00:25:21,260
very recent engagement I saw they were

649
00:25:19,130 --> 00:25:22,730
running a couple of DC 2016 but the

650
00:25:21,260 --> 00:25:25,010
domain functional level was domain was

651
00:25:22,730 --> 00:25:29,030
Windows 2003 so they're not getting the

652
00:25:25,010 --> 00:25:32,480
enhanced benefits of running the latest

653
00:25:29,030 --> 00:25:35,000
versions in their DC so some of the

654
00:25:32,480 --> 00:25:36,350
things that you do get Windows 2008 you

655
00:25:35,000 --> 00:25:39,140
get find very passive policies when you

656
00:25:36,350 --> 00:25:40,969
upgrade the domain functional level last

657
00:25:39,140 --> 00:25:42,470
interactive login information that is

658
00:25:40,970 --> 00:25:46,280
gold that's you really must release for

659
00:25:42,470 --> 00:25:48,260
information Windows 2012 r2 you get

660
00:25:46,280 --> 00:25:50,990
protected users you can put somebody in

661
00:25:48,260 --> 00:25:53,059
protected users group and then there may

662
00:25:50,990 --> 00:25:54,980
because then isn't as effective and

663
00:25:53,059 --> 00:25:56,450
there's a lot of authentication policies

664
00:25:54,980 --> 00:26:00,040
that comes from lifting a domain

665
00:25:56,450 --> 00:26:02,650
functional level excuse me

666
00:26:00,040 --> 00:26:05,659
something I don't see enough of I

667
00:26:02,650 --> 00:26:08,900
probably not likely to see privileged

668
00:26:05,660 --> 00:26:11,570
access workstations so pause is the

669
00:26:08,900 --> 00:26:14,200
Microsoft version of it so it's just

670
00:26:11,570 --> 00:26:16,879
really having a lock down Windows

671
00:26:14,200 --> 00:26:18,530
environment that you can only do what

672
00:26:16,880 --> 00:26:20,000
you supposed to do on it again it sounds

673
00:26:18,530 --> 00:26:23,928
like common sense but we just don't see

674
00:26:20,000 --> 00:26:26,179
a lot of it or stopped the domain admin

675
00:26:23,929 --> 00:26:27,440
subscription unbend root on standard

676
00:26:26,179 --> 00:26:29,110
workstations again we see a lot of that

677
00:26:27,440 --> 00:26:32,510
so you know he's really if you can

678
00:26:29,110 --> 00:26:33,800
minimize the privilege usage and then

679
00:26:32,510 --> 00:26:36,590
lock everything down you're gonna be in

680
00:26:33,800 --> 00:26:39,139
a really good state and then the

681
00:26:36,590 --> 00:26:40,760
ultimate goal which again I've never

682
00:26:39,140 --> 00:26:42,770
she's seen and I've only heard of two or

683
00:26:40,760 --> 00:26:45,080
three environments in the world is red

684
00:26:42,770 --> 00:26:48,860
forest environment so this is a window

685
00:26:45,080 --> 00:26:50,990
specific thing basically you splits your

686
00:26:48,860 --> 00:26:52,760
environment into tears and you can't

687
00:26:50,990 --> 00:26:55,550
cross the boundaries very easily you

688
00:26:52,760 --> 00:26:57,140
meet and specific machines to be able to

689
00:26:55,550 --> 00:26:59,360
get to the next level and then again to

690
00:26:57,140 --> 00:27:01,640
the next level so your tea is zero I can

691
00:26:59,360 --> 00:27:04,550
be your domain admins tier 1 server

692
00:27:01,640 --> 00:27:06,650
admins and then tier 2 venez workstation

693
00:27:04,550 --> 00:27:09,580
admins so again I've not actually seen

694
00:27:06,650 --> 00:27:12,830
this in in the wild has anybody seen it

695
00:27:09,580 --> 00:27:13,250
Neil so that more than I thought that's

696
00:27:12,830 --> 00:27:17,689
correct

697
00:27:13,250 --> 00:27:20,450
I want a square but what is again really

698
00:27:17,690 --> 00:27:22,610
important and I mentioned it earlier is

699
00:27:20,450 --> 00:27:24,290
is not looking so much of the tactical

700
00:27:22,610 --> 00:27:25,909
but more the strategical and the

701
00:27:24,290 --> 00:27:28,580
behaviors of what people actually do

702
00:27:25,910 --> 00:27:30,890
because that's gonna stop people like me

703
00:27:28,580 --> 00:27:34,310
and the bad guys from getting in and

704
00:27:30,890 --> 00:27:37,430
doing really bad things so in my

705
00:27:34,310 --> 00:27:38,720
conclusion get the basics done even

706
00:27:37,430 --> 00:27:40,310
though they are really hard to do cross

707
00:27:38,720 --> 00:27:41,510
everything if you get the basics then

708
00:27:40,310 --> 00:27:43,820
you're gonna be in a really good a

709
00:27:41,510 --> 00:27:45,770
really good place you know we see a lot

710
00:27:43,820 --> 00:27:48,139
of organisations spending a lot of money

711
00:27:45,770 --> 00:27:49,940
on really expensive boxes but don't

712
00:27:48,140 --> 00:27:52,100
really get to the nub of the situation

713
00:27:49,940 --> 00:27:53,900
and I was patching passwords and

714
00:27:52,100 --> 00:27:55,280
policies you get those sorted you're

715
00:27:53,900 --> 00:27:57,500
gonna raise the bar significally it's

716
00:27:55,280 --> 00:27:59,180
going really hard then to do so anything

717
00:27:57,500 --> 00:28:02,810
meaningful in that environment and they

718
00:27:59,180 --> 00:28:03,890
as make sure that that not one they just

719
00:28:02,810 --> 00:28:05,450
don't do one thing it just blows

720
00:28:03,890 --> 00:28:07,250
everything up make sure that you've got

721
00:28:05,450 --> 00:28:08,720
privilege separation you've got a

722
00:28:07,250 --> 00:28:10,040
segregation and all those type of good

723
00:28:08,720 --> 00:28:12,350
things because it just makes it really

724
00:28:10,040 --> 00:28:13,790
hard if it's really hard you can then

725
00:28:12,350 --> 00:28:16,189
get your detection linear response to

726
00:28:13,790 --> 00:28:18,050
kick in and catch the person whether is

727
00:28:16,190 --> 00:28:19,730
in turn like so and I think something

728
00:28:18,050 --> 00:28:22,250
that sort of slightly overlooked is

729
00:28:19,730 --> 00:28:24,080
availability visibility and reaction if

730
00:28:22,250 --> 00:28:25,310
you can see what's going on then you can

731
00:28:24,080 --> 00:28:26,990
do something about it and then how

732
00:28:25,310 --> 00:28:29,090
quickly you react to that thing is

733
00:28:26,990 --> 00:28:30,470
really important so make sure you get

734
00:28:29,090 --> 00:28:32,120
the visibility well it's through system

735
00:28:30,470 --> 00:28:33,770
on or logging or just some of the event

736
00:28:32,120 --> 00:28:36,310
IDs that I mentioned I think that'd be a

737
00:28:33,770 --> 00:28:41,050
really good place to start and that's it

738
00:28:36,310 --> 00:28:41,050
does anybody got any questions on that

739
00:28:42,730 --> 00:28:49,419
no no questions oh that one

740
00:28:47,840 --> 00:28:52,369
[Music]

741
00:28:49,419 --> 00:28:53,840
so now the PowerShell has probably been

742
00:28:52,369 --> 00:28:56,529
picked up a little bit more by EDR

743
00:28:53,840 --> 00:28:59,658
products products yeah

744
00:28:56,529 --> 00:29:03,049
what would a PT's laughs red team's be

745
00:28:59,659 --> 00:29:05,779
moving to a little bit of C sharp net so

746
00:29:03,049 --> 00:29:08,509
so msbuild sir you tell you can do all

747
00:29:05,779 --> 00:29:09,710
those things so it's the same in I hate

748
00:29:08,509 --> 00:29:11,269
the word indicators but it's the same

749
00:29:09,710 --> 00:29:12,379
indicators you're looking at but you

750
00:29:11,269 --> 00:29:14,629
just you just need a good lockdown

751
00:29:12,379 --> 00:29:16,939
environment if you can't run now msbuild

752
00:29:14,629 --> 00:29:18,289
sir you tell any of those things it's

753
00:29:16,940 --> 00:29:20,509
gonna it's gonna be hard to compile your

754
00:29:18,289 --> 00:29:22,639
code and run it so it's those type of

755
00:29:20,509 --> 00:29:23,840
sites but that's going to change and

756
00:29:22,639 --> 00:29:28,840
that'll be something else that'll be

757
00:29:23,840 --> 00:29:28,840
really hard any other questions

758
00:29:29,649 --> 00:29:34,508
nope No thank you very much that's a

759
00:29:32,330 --> 00:29:34,509
rate

