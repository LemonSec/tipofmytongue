1
00:00:00,030 --> 00:00:04,470
can you can you<font color="#CCCCCC"> hear</font><font color="#E5E5E5"> me in the back I</font>

2
00:00:02,270 --> 00:00:06,330
give me a thumbs up<font color="#E5E5E5"> if you can't hear</font><font color="#CCCCCC"> me</font>

3
00:00:04,470 --> 00:00:09,450
<font color="#CCCCCC">hi nice thank you sorry about</font><font color="#E5E5E5"> that guys</font>

4
00:00:06,330 --> 00:00:14,070
<font color="#CCCCCC">that happens normally when there is a</font>

5
00:00:09,450 --> 00:00:16,410
video involved right<font color="#E5E5E5"> so welcome to the</font>

6
00:00:14,070 --> 00:00:18,600
<font color="#CCCCCC">presentation it's</font><font color="#E5E5E5"> about transfer</font>

7
00:00:16,410 --> 00:00:21,270
encoding<font color="#CCCCCC"> chunked for fun and profit</font><font color="#E5E5E5"> and</font>

8
00:00:18,600 --> 00:00:26,400
<font color="#E5E5E5">web shells I'm not answer and</font><font color="#CCCCCC"> I've</font>

9
00:00:21,270 --> 00:00:27,720
worked for<font color="#E5E5E5"> the guy</font><font color="#CCCCCC"> it's a karma</font><font color="#E5E5E5"> I'm</font>

10
00:00:26,400 --> 00:00:29,820
<font color="#E5E5E5">gonna do a brief introduction about me</font>

11
00:00:27,720 --> 00:00:33,149
<font color="#E5E5E5">not too long as well</font><font color="#CCCCCC"> so it's not in</font>

12
00:00:29,820 --> 00:00:35,750
<font color="#CCCCCC">security in 1998 when</font><font color="#E5E5E5"> a friend sent me</font>

13
00:00:33,149 --> 00:00:37,680
<font color="#CCCCCC">over mirc</font><font color="#E5E5E5"> an executable</font>

14
00:00:35,750 --> 00:00:40,079
<font color="#CCCCCC">something-something and then you click</font>

15
00:00:37,680 --> 00:00:42,719
<font color="#CCCCCC">it and your cd-rom tray opens so there</font>

16
00:00:40,079 --> 00:00:44,190
was back orifice and if you know what

17
00:00:42,719 --> 00:00:45,989
I'm talking about<font color="#E5E5E5"> that you know panic</font>

18
00:00:44,190 --> 00:00:48,239
and this is interesting and then I got

19
00:00:45,989 --> 00:00:50,578
<font color="#E5E5E5">into security more interested in it but</font>

20
00:00:48,239 --> 00:00:52,468
as I was<font color="#E5E5E5"> doing</font><font color="#CCCCCC"> more research</font><font color="#E5E5E5"> and back</font>

21
00:00:50,579 --> 00:00:55,949
then in Italy security wasn't<font color="#E5E5E5"> really a</font>

22
00:00:52,469 --> 00:00:57,510
job was mostly firewalls<font color="#CCCCCC"> and where I</font>

23
00:00:55,949 --> 00:01:00,149
lived in<font color="#E5E5E5"> small town in northern</font><font color="#CCCCCC"> Italy</font>

24
00:00:57,510 --> 00:01:02,099
there wasn't really much<font color="#E5E5E5"> security jobs</font>

25
00:01:00,149 --> 00:01:04,830
<font color="#E5E5E5">and that the more</font><font color="#CCCCCC"> I dug into it</font><font color="#E5E5E5"> the more</font>

26
00:01:02,100 --> 00:01:06,659
<font color="#E5E5E5">I realized that I couldn't do that there</font>

27
00:01:04,830 --> 00:01:10,020
was I was really<font color="#E5E5E5"> you know like</font><font color="#CCCCCC"> Aleph</font>

28
00:01:06,659 --> 00:01:12,030
<font color="#E5E5E5">zero or no buffer overflow exploit ation</font>

29
00:01:10,020 --> 00:01:13,289
and<font color="#E5E5E5"> so like about my</font><font color="#CCCCCC"> head and I kept</font>

30
00:01:12,030 --> 00:01:16,140
telling<font color="#CCCCCC"> myself I'm</font><font color="#E5E5E5"> never gonna be able</font>

31
00:01:13,290 --> 00:01:18,240
to<font color="#E5E5E5"> do this I'm not</font><font color="#CCCCCC"> good enough and</font><font color="#E5E5E5"> then</font>

32
00:01:16,140 --> 00:01:20,880
life happens<font color="#E5E5E5"> and then move on</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> then</font>

33
00:01:18,240 --> 00:01:23,399
move country and then<font color="#CCCCCC"> I've got jobs in</font>

34
00:01:20,880 --> 00:01:25,970
medical robotics I got you know studying

35
00:01:23,400 --> 00:01:28,409
neuroscience and<font color="#E5E5E5"> all this stuff and then</font>

36
00:01:25,970 --> 00:01:30,150
at some<font color="#E5E5E5"> point I was like</font><font color="#CCCCCC"> okay maybe I</font>

37
00:01:28,409 --> 00:01:32,100
should try me<font color="#E5E5E5"> I was into management</font><font color="#CCCCCC"> and</font>

38
00:01:30,150 --> 00:01:34,140
then<font color="#CCCCCC"> my my boss said look you can still</font>

39
00:01:32,100 --> 00:01:36,449
do something technical so I got back

40
00:01:34,140 --> 00:01:41,430
<font color="#E5E5E5">into security you know kind of</font><font color="#CCCCCC"> 15 years</font>

41
00:01:36,450 --> 00:01:43,890
<font color="#E5E5E5">later and and then I met my</font><font color="#CCCCCC"> old boss at</font>

42
00:01:41,430 --> 00:01:46,140
<font color="#CCCCCC">pentest know now say karma who believed</font>

43
00:01:43,890 --> 00:01:48,960
in<font color="#CCCCCC"> me and hired</font><font color="#E5E5E5"> me as a developer so I</font>

44
00:01:46,140 --> 00:01:52,200
<font color="#E5E5E5">started as a developer and then kept his</font>

45
00:01:48,960 --> 00:01:54,059
word<font color="#E5E5E5"> and and maybe become a let him let</font>

46
00:01:52,200 --> 00:01:54,540
<font color="#CCCCCC">me become a pen tester</font><font color="#E5E5E5"> and that's what I</font>

47
00:01:54,060 --> 00:01:57,689
do now

48
00:01:54,540 --> 00:01:59,969
so if he wasn't<font color="#E5E5E5"> for him I wouldn't</font><font color="#CCCCCC"> be</font>

49
00:01:57,689 --> 00:02:02,339
<font color="#E5E5E5">here today for</font><font color="#CCCCCC"> just for myself</font><font color="#E5E5E5"> I</font>

50
00:01:59,969 --> 00:02:05,100
wouldn't be believing that I<font color="#E5E5E5"> could do</font>

51
00:02:02,340 --> 00:02:07,350
this<font color="#E5E5E5"> so I hope this might help somebody</font>

52
00:02:05,100 --> 00:02:09,100
else out<font color="#E5E5E5"> there</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> things was</font><font color="#CCCCCC"> not good</font>

53
00:02:07,350 --> 00:02:12,130
<font color="#CCCCCC">enough because</font><font color="#E5E5E5"> those things</font>

54
00:02:09,100 --> 00:02:14,530
happen and in the end is just<font color="#E5E5E5"> Google or</font>

55
00:02:12,130 --> 00:02:14,799
research and then time<font color="#CCCCCC"> times parent</font><font color="#E5E5E5"> into</font>

56
00:02:14,530 --> 00:02:17,410
it

57
00:02:14,800 --> 00:02:20,710
anyway enough about this<font color="#E5E5E5"> let's talk</font>

58
00:02:17,410 --> 00:02:21,760
<font color="#CCCCCC">about what we're gonna do first a thanks</font>

59
00:02:20,710 --> 00:02:23,770
word from our sponsor

60
00:02:21,760 --> 00:02:25,780
so thanks to well first of<font color="#E5E5E5"> all the</font>

61
00:02:23,770 --> 00:02:29,050
community<font color="#E5E5E5"> because you voted</font><font color="#CCCCCC"> me to be</font>

62
00:02:25,780 --> 00:02:31,660
here today<font color="#E5E5E5"> and again coming from where I</font>

63
00:02:29,050 --> 00:02:33,840
come<font color="#CCCCCC"> from that's my first technical talk</font>

64
00:02:31,660 --> 00:02:37,180
<font color="#CCCCCC">at</font><font color="#E5E5E5"> a technical conference like this and</font>

65
00:02:33,840 --> 00:02:39,340
in what's not my native language<font color="#CCCCCC"> so to</font>

66
00:02:37,180 --> 00:02:41,710
me just to be<font color="#E5E5E5"> here today is a massive</font>

67
00:02:39,340 --> 00:02:44,350
achievement and that's thank<font color="#E5E5E5"> you very</font>

68
00:02:41,710 --> 00:02:47,440
much for reporting for this talk

69
00:02:44,350 --> 00:02:49,290
secondly thanks to Sam<font color="#E5E5E5"> who is here in</font>

70
00:02:47,440 --> 00:02:51,579
<font color="#E5E5E5">the audience</font><font color="#CCCCCC"> they had a research that</font>

71
00:02:49,290 --> 00:02:54,010
<font color="#CCCCCC">coded up the prototype of</font><font color="#E5E5E5"> this tool</font>

72
00:02:51,580 --> 00:02:57,340
we're going<font color="#CCCCCC"> to</font><font color="#E5E5E5"> show later during the red</font>

73
00:02:54,010 --> 00:02:58,959
<font color="#E5E5E5">team engagement yes we owned them</font><font color="#CCCCCC"> the</font>

74
00:02:57,340 --> 00:03:01,240
initial work<font color="#CCCCCC"> was really really</font><font color="#E5E5E5"> good and</font>

75
00:02:58,960 --> 00:03:03,370
then I ended<font color="#CCCCCC"> up developing this</font><font color="#E5E5E5"> further</font>

76
00:03:01,240 --> 00:03:05,950
and giving me feature parity with other

77
00:03:03,370 --> 00:03:09,040
tools<font color="#CCCCCC"> as a kerr-mcgee</font><font color="#E5E5E5"> for while</font>

78
00:03:05,950 --> 00:03:11,470
believing<font color="#E5E5E5"> in me and let me take time to</font>

79
00:03:09,040 --> 00:03:14,620
do to continue<font color="#E5E5E5"> and finish this research</font>

80
00:03:11,470 --> 00:03:17,980
over<font color="#CCCCCC"> a long period of time on and off</font>

81
00:03:14,620 --> 00:03:20,650
<font color="#E5E5E5">between jobs</font><font color="#CCCCCC"> - now that's</font><font color="#E5E5E5"> the main tool</font>

82
00:03:17,980 --> 00:03:22,840
that I<font color="#E5E5E5"> used for inspiration and well</font>

83
00:03:20,650 --> 00:03:25,720
<font color="#CCCCCC">then stock for flow</font><font color="#E5E5E5"> - because there's</font>

84
00:03:22,840 --> 00:03:27,580
<font color="#E5E5E5">nothing like you know going and reading</font>

85
00:03:25,720 --> 00:03:30,550
some vulnerable code examples<font color="#E5E5E5"> I'll just</font>

86
00:03:27,580 --> 00:03:35,350
do this in whatever<font color="#E5E5E5"> and you click no no</font>

87
00:03:30,550 --> 00:03:38,350
Bronk<font color="#CCCCCC"> anyway so that's that's</font><font color="#E5E5E5"> what we</font>

88
00:03:35,350 --> 00:03:42,519
<font color="#CCCCCC">are</font><font color="#E5E5E5"> yes</font><font color="#CCCCCC"> is it only</font><font color="#E5E5E5"> paint and you're</font>

89
00:03:38,350 --> 00:03:43,930
<font color="#E5E5E5">welcome so we have the the evil evil</font>

90
00:03:42,520 --> 00:03:46,090
hacker in there without<font color="#CCCCCC"> a</font><font color="#E5E5E5"> hoodie this</font>

91
00:03:43,930 --> 00:03:47,860
time<font color="#E5E5E5"> because it's summer</font><font color="#CCCCCC"> go</font><font color="#E5E5E5"> to the</font>

92
00:03:46,090 --> 00:03:50,380
<font color="#CCCCCC">internet tries to get through</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> firewall</font>

93
00:03:47,860 --> 00:03:52,570
to<font color="#CCCCCC"> a web server where a web shell has</font>

94
00:03:50,380 --> 00:03:54,040
<font color="#E5E5E5">been implanted doesn't matter how this</font>

95
00:03:52,570 --> 00:03:56,470
<font color="#CCCCCC">works out there</font><font color="#E5E5E5"> file upload whatever</font>

96
00:03:54,040 --> 00:03:59,459
<font color="#E5E5E5">we're trying to get behind the web shell</font>

97
00:03:56,470 --> 00:04:02,859
<font color="#E5E5E5">we weren't trying to get to the target</font>

98
00:03:59,460 --> 00:04:05,320
<font color="#E5E5E5">but</font><font color="#CCCCCC"> the web server has</font><font color="#E5E5E5"> no outbound</font>

99
00:04:02,860 --> 00:04:07,230
connectivity so you know it might be a

100
00:04:05,320 --> 00:04:10,989
proxy<font color="#E5E5E5"> we haven't found it might be</font>

101
00:04:07,230 --> 00:04:14,619
whatever<font color="#E5E5E5"> just cannot go out</font><font color="#CCCCCC"> okay so</font>

102
00:04:10,990 --> 00:04:17,910
that's what we're gonna get<font color="#E5E5E5"> and this is</font>

103
00:04:14,620 --> 00:04:20,168
<font color="#E5E5E5">how so what trying to do is to get</font>

104
00:04:17,910 --> 00:04:20,750
bi-directional communications with the

105
00:04:20,168 --> 00:04:23,780
<font color="#E5E5E5">back</font>

106
00:04:20,750 --> 00:04:25,730
and<font color="#E5E5E5"> target or be able</font><font color="#CCCCCC"> to exceed trade</font>

107
00:04:23,780 --> 00:04:29,539
data and if we can you know get a<font color="#E5E5E5"> shell</font>

108
00:04:25,730 --> 00:04:32,030
<font color="#E5E5E5">because life is better with shells</font><font color="#CCCCCC"> tuna</font>

109
00:04:29,540 --> 00:04:33,380
is as I said this tool<font color="#E5E5E5"> it's quite mature</font>

110
00:04:32,030 --> 00:04:36,409
<font color="#CCCCCC">it does the job</font>

111
00:04:33,380 --> 00:04:38,450
<font color="#E5E5E5">thunders TCP connections</font><font color="#CCCCCC"> it works it was</font>

112
00:04:36,410 --> 00:04:40,640
fine<font color="#E5E5E5"> except you know in our conditions</font>

113
00:04:38,450 --> 00:04:44,150
that we're<font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> see evidence of why so</font>

114
00:04:40,640 --> 00:04:46,250
the way it<font color="#CCCCCC"> works again</font><font color="#E5E5E5"> paint</font><font color="#CCCCCC"> tuna has a</font>

115
00:04:44,150 --> 00:04:48,710
client<font color="#CCCCCC"> and a web shell so the client</font>

116
00:04:46,250 --> 00:04:52,610
connects<font color="#E5E5E5"> to</font><font color="#CCCCCC"> the web shell over HTTP</font><font color="#E5E5E5"> and</font>

117
00:04:48,710 --> 00:04:54,650
then the client<font color="#E5E5E5"> opens support locally</font><font color="#CCCCCC"> in</font>

118
00:04:52,610 --> 00:04:56,360
<font color="#E5E5E5">this case for for for</font><font color="#CCCCCC"> for the web shell</font>

119
00:04:54,650 --> 00:05:00,320
is<font color="#E5E5E5"> in started to go to</font><font color="#CCCCCC"> three three eight</font>

120
00:04:56,360 --> 00:05:03,200
<font color="#CCCCCC">nine so at a chaotic opens RDP client to</font>

121
00:05:00,320 --> 00:05:05,390
port for for for<font color="#CCCCCC"> for locally data goes</font>

122
00:05:03,200 --> 00:05:11,030
through<font color="#CCCCCC"> you</font><font color="#E5E5E5"> get an RDP connection with a</font>

123
00:05:05,390 --> 00:05:15,050
target<font color="#E5E5E5"> win</font><font color="#CCCCCC"> except</font><font color="#E5E5E5"> that's that's how it</font>

124
00:05:11,030 --> 00:05:17,900
works but behind<font color="#E5E5E5"> the scenes</font><font color="#CCCCCC"> tuna there's</font>

125
00:05:15,050 --> 00:05:20,150
a poll request<font color="#CCCCCC"> so there's a continuous</font>

126
00:05:17,900 --> 00:05:22,280
request for data so you can<font color="#E5E5E5"> if you</font>

127
00:05:20,150 --> 00:05:23,870
imagine data from the RDP server which

128
00:05:22,280 --> 00:05:27,140
<font color="#E5E5E5">was on</font><font color="#CCCCCC"> this side from the RDP server</font>

129
00:05:23,870 --> 00:05:29,990
<font color="#E5E5E5">going back to the client then it needs</font>

130
00:05:27,140 --> 00:05:31,789
to<font color="#E5E5E5"> go you know it's buffered at the web</font>

131
00:05:29,990 --> 00:05:34,190
server and then<font color="#E5E5E5"> the client goes and gets</font>

132
00:05:31,790 --> 00:05:36,830
have you got data<font color="#E5E5E5"> there we go so there's</font>

133
00:05:34,190 --> 00:05:38,870
<font color="#CCCCCC">a lot a</font><font color="#E5E5E5"> small delay and this causes a</font>

134
00:05:36,830 --> 00:05:41,590
<font color="#CCCCCC">lot of requests in response</font><font color="#E5E5E5"> traffic</font>

135
00:05:38,870 --> 00:05:45,530
<font color="#CCCCCC">basically which can get suspicious</font>

136
00:05:41,590 --> 00:05:47,570
<font color="#CCCCCC">personally perhaps throttling</font><font color="#E5E5E5"> there is</font>

137
00:05:45,530 --> 00:05:50,119
like<font color="#E5E5E5"> you know something didn't go to</font>

138
00:05:47,570 --> 00:05:50,840
numbers just too too<font color="#CCCCCC"> slow so how do we</font>

139
00:05:50,120 --> 00:05:54,770
solve this problem

140
00:05:50,840 --> 00:05:56,630
well now<font color="#CCCCCC"> our directive are still to</font>

141
00:05:54,770 --> 00:05:57,979
avoid polling right that's this<font color="#CCCCCC"> is</font><font color="#E5E5E5"> the</font>

142
00:05:56,630 --> 00:06:00,790
keep on<font color="#E5E5E5"> let's try to avoid polling</font>

143
00:05:57,979 --> 00:06:03,740
continuance request in response polling

144
00:06:00,790 --> 00:06:05,419
the question that we had as<font color="#E5E5E5"> we service</font>

145
00:06:03,740 --> 00:06:08,270
is polling<font color="#E5E5E5"> really necessary to get</font>

146
00:06:05,419 --> 00:06:11,030
server to client data this is over HTTP

147
00:06:08,270 --> 00:06:13,520
and if you think about<font color="#E5E5E5"> WebSockets you</font>

148
00:06:11,030 --> 00:06:15,140
know for chats there is a case where the

149
00:06:13,520 --> 00:06:15,500
server<font color="#E5E5E5"> has a send data back to the</font>

150
00:06:15,140 --> 00:06:17,840
client

151
00:06:15,500 --> 00:06:19,550
<font color="#E5E5E5">the problem with WebSockets</font><font color="#CCCCCC"> well not a</font>

152
00:06:17,840 --> 00:06:22,460
<font color="#CCCCCC">problem like the issue we had is not</font>

153
00:06:19,550 --> 00:06:25,490
always<font color="#E5E5E5"> enabled and is maybe</font><font color="#CCCCCC"> not</font>

154
00:06:22,460 --> 00:06:28,729
supported and we<font color="#E5E5E5"> talk</font><font color="#CCCCCC"> about legacy</font>

155
00:06:25,490 --> 00:06:30,260
systems<font color="#E5E5E5"> who still uses ie6 well if you</font>

156
00:06:28,729 --> 00:06:32,419
don't<font color="#CCCCCC"> really red teaming engagement</font>

157
00:06:30,260 --> 00:06:35,060
<font color="#E5E5E5">you know there is always one server</font>

158
00:06:32,420 --> 00:06:37,850
somewhere<font color="#E5E5E5"> forgotten running stuff from</font>

159
00:06:35,060 --> 00:06:39,230
the 90s<font color="#E5E5E5"> in Java Enterprise whatever and</font>

160
00:06:37,850 --> 00:06:40,940
<font color="#CCCCCC">that that's</font><font color="#E5E5E5"> what we're targeting so we</font>

161
00:06:39,230 --> 00:06:43,940
can't rely on anything<font color="#E5E5E5"> that requires</font>

162
00:06:40,940 --> 00:06:45,290
admin access to install like you know a

163
00:06:43,940 --> 00:06:48,070
library or<font color="#E5E5E5"> something because you</font><font color="#CCCCCC"> had</font>

164
00:06:45,290 --> 00:06:52,430
admin access then we will be here right

165
00:06:48,070 --> 00:06:57,650
<font color="#CCCCCC">so HTTP basics</font><font color="#E5E5E5"> I think this is</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> well</font>

166
00:06:52,430 --> 00:07:00,980
anyway<font color="#CCCCCC"> HTTP basics</font><font color="#E5E5E5"> at the most basic</font>

167
00:06:57,650 --> 00:07:02,750
level<font color="#E5E5E5"> in a response the server tells the</font>

168
00:07:00,980 --> 00:07:06,290
client<font color="#CCCCCC"> I'm gonna send you four bytes of</font>

169
00:07:02,750 --> 00:07:07,880
data that<font color="#E5E5E5"> our client client knows to</font>

170
00:07:06,290 --> 00:07:09,860
read<font color="#CCCCCC"> four wise goes away happy</font>

171
00:07:07,880 --> 00:07:12,710
everybody's happy<font color="#CCCCCC"> connection is closed</font>

172
00:07:09,860 --> 00:07:13,310
or kept alive for<font color="#CCCCCC"> more HTTP</font><font color="#E5E5E5"> requests and</font>

173
00:07:12,710 --> 00:07:15,680
<font color="#E5E5E5">response</font>

174
00:07:13,310 --> 00:07:17,840
<font color="#E5E5E5">I've seen service like I think</font><font color="#CCCCCC"> bits</font><font color="#E5E5E5"> talk</font>

175
00:07:15,680 --> 00:07:20,120
sometimes doesn't really like<font color="#E5E5E5"> analyze to</font>

176
00:07:17,840 --> 00:07:22,700
you and gives you<font color="#CCCCCC"> more or less data not</font>

177
00:07:20,120 --> 00:07:23,750
<font color="#E5E5E5">now but this is meant to be you</font><font color="#CCCCCC"> know</font>

178
00:07:22,700 --> 00:07:27,740
this<font color="#E5E5E5"> is the lanterns meant to be</font>

179
00:07:23,750 --> 00:07:30,040
arriving<font color="#CCCCCC"> so there is</font><font color="#E5E5E5"> another way</font><font color="#CCCCCC"> to do</font>

180
00:07:27,740 --> 00:07:33,770
this<font color="#CCCCCC"> it's called a transfer encoding</font>

181
00:07:30,040 --> 00:07:37,520
chunked transfer encoding<font color="#E5E5E5"> and basically</font>

182
00:07:33,770 --> 00:07:40,400
the server sends data<font color="#E5E5E5"> in chunks and it</font>

183
00:07:37,520 --> 00:07:43,760
chunks<font color="#E5E5E5"> each chunk has its length as a</font>

184
00:07:40,400 --> 00:07:46,099
hex<font color="#CCCCCC"> value on</font><font color="#E5E5E5"> top so it's this case first</font>

185
00:07:43,760 --> 00:07:49,010
chunk is<font color="#E5E5E5"> 4 bytes second chunk</font><font color="#CCCCCC"> five bytes</font>

186
00:07:46,100 --> 00:07:52,970
<font color="#E5E5E5">third chunk 15 bytes last chunk zero</font>

187
00:07:49,010 --> 00:07:53,930
bytes newline end of data<font color="#E5E5E5"> that's it so</font>

188
00:07:52,970 --> 00:07:56,840
<font color="#E5E5E5">it's used for when you don't know the</font>

189
00:07:53,930 --> 00:08:00,020
<font color="#CCCCCC">length so you as a client you can start</font>

190
00:07:56,840 --> 00:08:03,080
<font color="#CCCCCC">reading data without having to wait for</font>

191
00:08:00,020 --> 00:08:06,190
<font color="#CCCCCC">the entire</font><font color="#E5E5E5"> data to come and I hope you</font>

192
00:08:03,080 --> 00:08:08,659
you're seeing what I'm going with<font color="#E5E5E5"> this</font>

193
00:08:06,190 --> 00:08:11,660
let's<font color="#E5E5E5"> talk about chunky chunky tuna so</font>

194
00:08:08,660 --> 00:08:17,320
chunky tuna<font color="#CCCCCC"> does just that</font><font color="#E5E5E5"> it's a web</font>

195
00:08:11,660 --> 00:08:21,230
shell the server side is JSP PHP and net

196
00:08:17,320 --> 00:08:23,330
<font color="#E5E5E5">as native as I could make it really all</font>

197
00:08:21,230 --> 00:08:26,930
the<font color="#E5E5E5"> remote data comes in through the</font>

198
00:08:23,330 --> 00:08:31,130
same HTTP response so client talks to

199
00:08:26,930 --> 00:08:33,289
server<font color="#CCCCCC"> so</font><font color="#E5E5E5"> you know 200</font><font color="#CCCCCC"> ok this</font>

200
00:08:31,130 --> 00:08:36,679
connection stays open<font color="#E5E5E5"> data continues to</font>

201
00:08:33,289 --> 00:08:39,439
<font color="#CCCCCC">come from</font><font color="#E5E5E5"> the server side</font><font color="#CCCCCC"> to the client</font>

202
00:08:36,679 --> 00:08:43,069
side right

203
00:08:39,440 --> 00:08:46,960
chunky tuna has<font color="#E5E5E5"> three modes</font><font color="#CCCCCC"> Connect</font>

204
00:08:43,070 --> 00:08:50,660
<font color="#E5E5E5">listen and execution and the connect one</font>

205
00:08:46,960 --> 00:08:52,720
pretty<font color="#E5E5E5"> much</font><font color="#CCCCCC"> like a like tuna</font><font color="#E5E5E5"> so in this</font>

206
00:08:50,660 --> 00:08:56,420
case you know<font color="#E5E5E5"> we</font><font color="#CCCCCC"> open our connection</font>

207
00:08:52,720 --> 00:08:58,550
from<font color="#E5E5E5"> the attacker</font><font color="#CCCCCC"> to the</font><font color="#E5E5E5"> client port</font>

208
00:08:56,420 --> 00:09:02,660
<font color="#E5E5E5">four four four four locally not just for</font>

209
00:08:58,550 --> 00:09:05,060
for over HTTP<font color="#CCCCCC"> TCP is encapsulated in</font>

210
00:09:02,660 --> 00:09:07,219
HTTP<font color="#E5E5E5"> and then it goes</font><font color="#CCCCCC"> to the target on</font>

211
00:09:05,060 --> 00:09:14,359
port 80<font color="#CCCCCC"> and every response for the</font>

212
00:09:07,220 --> 00:09:16,870
target comes back as a chunk<font color="#CCCCCC"> now let's</font>

213
00:09:14,360 --> 00:09:19,550
see if this works

214
00:09:16,870 --> 00:09:22,960
yes fingers crossed oops

215
00:09:19,550 --> 00:09:22,959
that's way too big

216
00:09:25,280 --> 00:09:30,130
<font color="#CCCCCC">now mustard let's go</font>

217
00:09:30,720 --> 00:09:33,380
<font color="#E5E5E5">Jackie</font>

218
00:09:33,520 --> 00:09:39,399
so on the<font color="#CCCCCC"> right hand side</font><font color="#E5E5E5"> please work</font>

219
00:09:36,370 --> 00:09:42,040
<font color="#CCCCCC">hey and right hand side you can see this</font>

220
00:09:39,399 --> 00:09:46,480
is a darker container of a<font color="#CCCCCC"> tongue cut</font>

221
00:09:42,040 --> 00:09:49,029
basic<font color="#CCCCCC"> talker</font><font color="#E5E5E5"> no modifications down here</font>

222
00:09:46,480 --> 00:09:50,950
you have<font color="#CCCCCC"> the target server</font><font color="#E5E5E5"> on the back</font>

223
00:09:49,029 --> 00:09:53,589
<font color="#E5E5E5">end you know the server that</font><font color="#CCCCCC"> you need to</font>

224
00:09:50,950 --> 00:09:56,620
connect to<font color="#E5E5E5"> and then on the left</font><font color="#CCCCCC"> hand</font>

225
00:09:53,589 --> 00:10:01,480
side<font color="#E5E5E5"> dark obviously is the attacker</font>

226
00:09:56,620 --> 00:10:04,029
<font color="#E5E5E5">launching chunky tuna on top and then</font><font color="#CCCCCC"> on</font>

227
00:10:01,480 --> 00:10:07,209
the<font color="#CCCCCC"> bottom will have the attackers</font>

228
00:10:04,029 --> 00:10:11,380
console<font color="#E5E5E5"> so this this server here runs</font>

229
00:10:07,209 --> 00:10:14,050
<font color="#E5E5E5">open beta</font><font color="#CCCCCC"> SSH server</font><font color="#E5E5E5"> and Apache the demo</font>

230
00:10:11,380 --> 00:10:16,660
page<font color="#E5E5E5"> imagine this this is behind the</font>

231
00:10:14,050 --> 00:10:19,620
firewall<font color="#CCCCCC"> you don't see this</font><font color="#E5E5E5"> so I now</font>

232
00:10:16,660 --> 00:10:22,300
launch chunky tuna

233
00:10:19,620 --> 00:10:23,800
when chalky tuna starts<font color="#E5E5E5"> I have to tell</font>

234
00:10:22,300 --> 00:10:27,459
<font color="#E5E5E5">it which port to listen to so in this</font>

235
00:10:23,800 --> 00:10:29,589
case is listening<font color="#E5E5E5"> to port 4 4 4 4 and</font>

236
00:10:27,459 --> 00:10:33,390
then is<font color="#E5E5E5"> going to connect to the internal</font>

237
00:10:29,589 --> 00:10:36,370
IP of<font color="#CCCCCC"> the</font><font color="#E5E5E5"> web server on port 80 it's</font>

238
00:10:33,390 --> 00:10:39,610
ready<font color="#E5E5E5"> I'm gonna connect when I connect</font>

239
00:10:36,370 --> 00:10:40,870
chunky tuna then talks<font color="#E5E5E5"> to the web to</font><font color="#CCCCCC"> the</font>

240
00:10:39,610 --> 00:10:43,270
<font color="#CCCCCC">backend and here we go</font>

241
00:10:40,870 --> 00:10:45,130
this is<font color="#E5E5E5"> the</font><font color="#CCCCCC"> back-end web</font><font color="#E5E5E5"> server that</font>

242
00:10:43,270 --> 00:10:46,750
<font color="#CCCCCC">because it's</font><font color="#E5E5E5"> in terminal is behind the</font>

243
00:10:45,130 --> 00:10:48,880
firewall<font color="#CCCCCC"> I can put your adventures here</font>

244
00:10:46,750 --> 00:10:51,640
and nobody's gonna notice<font color="#CCCCCC"> right no evil</font>

245
00:10:48,880 --> 00:10:53,050
hackers gonna not notice that<font color="#E5E5E5"> so now</font>

246
00:10:51,640 --> 00:10:57,329
<font color="#E5E5E5">that we have</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> credentials we can</font>

247
00:10:53,050 --> 00:10:59,589
connect<font color="#E5E5E5"> to port 22 of the remote target</font>

248
00:10:57,329 --> 00:11:02,739
connection<font color="#E5E5E5"> is established I'm gonna do</font>

249
00:10:59,589 --> 00:11:05,260
just<font color="#E5E5E5"> SSH</font><font color="#CCCCCC"> to block low so I'm connecting</font>

250
00:11:02,740 --> 00:11:08,079
locally and my<font color="#E5E5E5"> SSH connection is going</font>

251
00:11:05,260 --> 00:11:11,860
to go<font color="#E5E5E5"> as an HTTP request and response</font>

252
00:11:08,079 --> 00:11:13,599
<font color="#E5E5E5">single one same same response and all</font>

253
00:11:11,860 --> 00:11:15,910
the<font color="#CCCCCC"> traffic comes back and now I have</font>

254
00:11:13,600 --> 00:11:17,620
interactive web shell<font color="#E5E5E5"> this is</font><font color="#CCCCCC"> there's no</font>

255
00:11:15,910 --> 00:11:19,540
polling here there's no outbound

256
00:11:17,620 --> 00:11:22,779
connectivity just like imagine a

257
00:11:19,540 --> 00:11:24,849
firewall that<font color="#CCCCCC"> prevents the server to</font>

258
00:11:22,779 --> 00:11:26,950
connect outwards now<font color="#E5E5E5"> I'm trying to find</font>

259
00:11:24,850 --> 00:11:30,480
<font color="#E5E5E5">the IP but doctor doesn't</font><font color="#CCCCCC"> have IP</font><font color="#E5E5E5"> config</font>

260
00:11:26,950 --> 00:11:30,480
<font color="#CCCCCC">I've configured</font><font color="#E5E5E5"> whatever doesn't matter</font>

261
00:11:30,600 --> 00:11:34,709
<font color="#E5E5E5">now back to the main presentation</font>

262
00:11:35,300 --> 00:11:38,530
<font color="#E5E5E5">why</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> this</font>

263
00:11:45,339 --> 00:11:49,310
presentation<font color="#E5E5E5"> here we go okay hope that's</font>

264
00:11:48,529 --> 00:11:51,560
that's all clear

265
00:11:49,310 --> 00:11:53,959
pretty simple chunk you<font color="#CCCCCC"> tuned in listen</font>

266
00:11:51,560 --> 00:11:56,329
mode<font color="#E5E5E5"> does something</font><font color="#CCCCCC"> similar so in this</font>

267
00:11:53,959 --> 00:11:59,599
case we have a target<font color="#CCCCCC"> that we</font><font color="#E5E5E5"> have some</font>

268
00:11:56,329 --> 00:12:01,339
degree<font color="#CCCCCC"> of control</font><font color="#E5E5E5"> on you know it's a you</font>

269
00:11:59,600 --> 00:12:03,529
<font color="#CCCCCC">sent us can</font><font color="#E5E5E5"> be emailed that</font><font color="#CCCCCC"> since he</font>

270
00:12:01,339 --> 00:12:05,060
tells<font color="#CCCCCC"> people to you know click this link</font>

271
00:12:03,529 --> 00:12:08,269
and but they can't go outside so the

272
00:12:05,060 --> 00:12:09,829
link<font color="#E5E5E5"> sends them internally xxe whatever</font>

273
00:12:08,269 --> 00:12:11,209
you want the<font color="#E5E5E5"> target you have something</font>

274
00:12:09,829 --> 00:12:13,099
on<font color="#E5E5E5"> the target and you need to</font><font color="#CCCCCC"> actual</font>

275
00:12:11,209 --> 00:12:15,050
<font color="#E5E5E5">trade data</font><font color="#CCCCCC"> data</font><font color="#E5E5E5"> is going to come back as</font>

276
00:12:13,100 --> 00:12:18,860
<font color="#CCCCCC">chunk</font><font color="#E5E5E5"> again there's no connection</font>

277
00:12:15,050 --> 00:12:20,899
initiated from the the web shell outside

278
00:12:18,860 --> 00:12:25,130
<font color="#CCCCCC">of bound</font><font color="#E5E5E5"> everything goes in from the</font>

279
00:12:20,899 --> 00:12:27,920
same HTTP<font color="#E5E5E5"> and response and guess what it</font>

280
00:12:25,130 --> 00:12:30,040
is a demo which<font color="#CCCCCC"> is going to</font><font color="#E5E5E5"> go horribly</font>

281
00:12:27,920 --> 00:12:30,040
wrong

282
00:12:32,370 --> 00:12:40,860
you know listen<font color="#E5E5E5"> okay okay</font>

283
00:12:37,199 --> 00:12:42,660
same as before<font color="#CCCCCC"> docker container doctor</font>

284
00:12:40,860 --> 00:12:47,399
container this<font color="#CCCCCC"> is</font><font color="#E5E5E5"> you've all seen this</font>

285
00:12:42,660 --> 00:12:49,350
<font color="#CCCCCC">before so again the idea is that I'm</font>

286
00:12:47,399 --> 00:12:51,540
<font color="#E5E5E5">trying to exchange rate data so I have</font>

287
00:12:49,350 --> 00:12:58,199
some<font color="#CCCCCC"> degree of control over my target</font>

288
00:12:51,540 --> 00:13:01,019
server now all of those tools<font color="#E5E5E5"> the docker</font>

289
00:12:58,199 --> 00:13:03,120
container the images<font color="#E5E5E5"> the testing scripts</font>

290
00:13:01,019 --> 00:13:05,749
<font color="#E5E5E5">everything is already on github</font><font color="#CCCCCC"> so go</font>

291
00:13:03,120 --> 00:13:09,209
<font color="#E5E5E5">play with it</font><font color="#CCCCCC"> oil means test it locally</font>

292
00:13:05,749 --> 00:13:11,459
<font color="#CCCCCC">now we go the the</font><font color="#E5E5E5"> attacker console the</font>

293
00:13:09,209 --> 00:13:15,449
attacker launch launches chunky tuna<font color="#E5E5E5"> and</font>

294
00:13:11,459 --> 00:13:17,339
then when it's ready<font color="#CCCCCC"> I'm gonna open</font>

295
00:13:15,449 --> 00:13:19,529
another control and then go on<font color="#E5E5E5"> till</font><font color="#CCCCCC"> you</font>

296
00:13:17,339 --> 00:13:21,930
<font color="#E5E5E5">get to</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> target</font><font color="#CCCCCC"> server and then do</font>

297
00:13:19,529 --> 00:13:24,300
something<font color="#E5E5E5"> over there now you will see</font>

298
00:13:21,930 --> 00:13:27,420
that<font color="#E5E5E5"> at some point the window in the top</font>

299
00:13:24,300 --> 00:13:29,040
left is going<font color="#E5E5E5"> to timeout</font><font color="#CCCCCC"> main</font><font color="#E5E5E5"> reason is</font>

300
00:13:27,420 --> 00:13:31,889
that because<font color="#E5E5E5"> we don't</font><font color="#CCCCCC"> want to bind the</font>

301
00:13:29,040 --> 00:13:34,410
port<font color="#E5E5E5"> so in this case the remote web</font>

302
00:13:31,889 --> 00:13:36,089
shell is binding to<font color="#CCCCCC"> a port port one two</font>

303
00:13:34,410 --> 00:13:37,350
<font color="#CCCCCC">three four five and</font><font color="#E5E5E5"> we don't want to</font>

304
00:13:36,089 --> 00:13:38,490
support<font color="#CCCCCC"> a bib</font><font color="#E5E5E5"> on forever this if</font>

305
00:13:37,350 --> 00:13:39,839
something<font color="#CCCCCC"> goes wrong so there's a</font>

306
00:13:38,490 --> 00:13:41,790
<font color="#E5E5E5">timeout that if nothing happens just</font>

307
00:13:39,839 --> 00:13:45,779
<font color="#E5E5E5">dies and</font><font color="#CCCCCC"> kills the connection and frees</font>

308
00:13:41,790 --> 00:13:48,290
the port<font color="#E5E5E5"> the magic of reuse address so</font>

309
00:13:45,779 --> 00:13:50,699
the attacker is preparing<font color="#E5E5E5"> net cut</font>

310
00:13:48,290 --> 00:13:52,860
<font color="#CCCCCC">listening on local port</font><font color="#E5E5E5"> four four four</font>

311
00:13:50,699 --> 00:13:55,439
<font color="#E5E5E5">four on the attacker machine type into</font>

312
00:13:52,860 --> 00:13:56,850
<font color="#E5E5E5">to tower chunky</font><font color="#CCCCCC"> tune is running now I'm</font>

313
00:13:55,439 --> 00:13:58,469
<font color="#E5E5E5">gonna pretend I have this command</font>

314
00:13:56,850 --> 00:14:03,720
<font color="#E5E5E5">execution on a remote server with no</font>

315
00:13:58,470 --> 00:14:05,809
outbound connectivity big<font color="#CCCCCC"> this</font><font color="#E5E5E5"> is on the</font>

316
00:14:03,720 --> 00:14:08,850
target system<font color="#E5E5E5"> okay so the target system</font>

317
00:14:05,809 --> 00:14:11,249
<font color="#CCCCCC">I'm gonna start</font><font color="#E5E5E5"> our getting to the</font>

318
00:14:08,850 --> 00:14:13,499
docker container<font color="#CCCCCC"> okay so I'm now on the</font>

319
00:14:11,249 --> 00:14:14,939
target system<font color="#CCCCCC"> and as I said something is</font>

320
00:14:13,499 --> 00:14:16,529
going to<font color="#CCCCCC"> happen so I had</font><font color="#E5E5E5"> controlled some</font>

321
00:14:14,939 --> 00:14:20,849
commands happen I'm gonna<font color="#E5E5E5"> use power just</font>

322
00:14:16,529 --> 00:14:25,949
<font color="#E5E5E5">because it's easy to see so it's gonna</font>

323
00:14:20,850 --> 00:14:28,679
be piped where it is<font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> go this is</font>

324
00:14:25,949 --> 00:14:31,529
<font color="#E5E5E5">the internal port of the web server so</font>

325
00:14:28,679 --> 00:14:33,660
<font color="#CCCCCC">the</font><font color="#E5E5E5"> the web server is listening you know</font>

326
00:14:31,529 --> 00:14:35,429
<font color="#E5E5E5">an internal network</font><font color="#CCCCCC"> dmz whatever it is</font>

327
00:14:33,660 --> 00:14:38,560
so the assumption<font color="#E5E5E5"> is that the target can</font>

328
00:14:35,429 --> 00:14:42,290
talk to the internal web server

329
00:14:38,560 --> 00:14:45,699
by some misconfigured<font color="#CCCCCC"> federal rule</font><font color="#E5E5E5"> and</font>

330
00:14:42,290 --> 00:14:48,459
then I'm gonna just<font color="#CCCCCC"> tar the entire EDC</font>

331
00:14:45,700 --> 00:14:52,220
<font color="#CCCCCC">directory</font><font color="#E5E5E5"> again no advantage</font><font color="#CCCCCC"> ability</font><font color="#E5E5E5"> is</font>

332
00:14:48,460 --> 00:14:54,080
initiated and then you'll see the

333
00:14:52,220 --> 00:14:56,540
connection happening<font color="#E5E5E5"> after a while I</font>

334
00:14:54,080 --> 00:14:58,760
stopped it and then when you go in the

335
00:14:56,540 --> 00:15:00,949
attacker console<font color="#CCCCCC"> you see you have the</font>

336
00:14:58,760 --> 00:15:07,720
entire<font color="#CCCCCC"> e.t.c directory transferred with</font>

337
00:15:00,950 --> 00:15:07,720
<font color="#CCCCCC">northbound</font><font color="#E5E5E5"> connectivity win now</font>

338
00:15:11,260 --> 00:15:17,210
chunky tuna and tuna<font color="#CCCCCC"> I'm gonna like skip</font>

339
00:15:14,030 --> 00:15:20,839
forward a bit on those<font color="#CCCCCC"> there's</font><font color="#E5E5E5"> not like</font>

340
00:15:17,210 --> 00:15:22,400
the questions<font color="#E5E5E5"> from this later but it's</font>

341
00:15:20,840 --> 00:15:24,920
basically feature parity<font color="#CCCCCC"> junkie tuna</font>

342
00:15:22,400 --> 00:15:26,959
supports proxy<font color="#CCCCCC"> use</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> soft</font><font color="#E5E5E5"> proxy for</font>

343
00:15:24,920 --> 00:15:28,699
local communication<font color="#E5E5E5"> I use TCP ports</font>

344
00:15:26,960 --> 00:15:32,240
<font color="#E5E5E5">pretty much the same thing</font><font color="#CCCCCC"> but we have</font>

345
00:15:28,700 --> 00:15:35,600
<font color="#CCCCCC">reverse connections now the challenges</font>

346
00:15:32,240 --> 00:15:38,450
<font color="#E5E5E5">about development is many was</font>

347
00:15:35,600 --> 00:15:41,480
interesting<font color="#E5E5E5"> mainly because I'm trying to</font>

348
00:15:38,450 --> 00:15:42,200
<font color="#E5E5E5">push languages designed for web into</font>

349
00:15:41,480 --> 00:15:45,110
something else

350
00:15:42,200 --> 00:15:47,480
especially PHP<font color="#E5E5E5"> so you know you end up</font>

351
00:15:45,110 --> 00:15:49,910
googling so much you get lost and you

352
00:15:47,480 --> 00:15:51,710
find you actually<font color="#E5E5E5"> find</font><font color="#CCCCCC"> people asking the</font>

353
00:15:49,910 --> 00:15:54,620
same question you<font color="#E5E5E5"> know</font><font color="#CCCCCC"> 10 years ago and</font>

354
00:15:51,710 --> 00:15:56,360
no answer<font color="#CCCCCC"> like where is it</font>

355
00:15:54,620 --> 00:15:57,650
I even<font color="#CCCCCC"> found my own questions like I got</font>

356
00:15:56,360 --> 00:15:59,150
it back<font color="#E5E5E5"> into this like</font><font color="#CCCCCC"> 6 months later</font>

357
00:15:57,650 --> 00:16:01,160
<font color="#CCCCCC">and they're like oh that's a very good</font>

358
00:15:59,150 --> 00:16:03,189
question that's my own question that

359
00:16:01,160 --> 00:16:06,980
nobody<font color="#CCCCCC"> answered that I cannot seriously</font>

360
00:16:03,190 --> 00:16:09,200
<font color="#E5E5E5">they're still there actually anyway the</font>

361
00:16:06,980 --> 00:16:11,930
good things<font color="#E5E5E5"> POSIX is awesome if you have</font>

362
00:16:09,200 --> 00:16:13,460
any problem<font color="#E5E5E5"> maybe every new new file new</font>

363
00:16:11,930 --> 00:16:15,800
things today in<font color="#E5E5E5"> computer science has</font>

364
00:16:13,460 --> 00:16:21,920
been<font color="#CCCCCC"> solved</font><font color="#E5E5E5"> in the</font><font color="#CCCCCC"> 70s by some you</font><font color="#E5E5E5"> know</font>

365
00:16:15,800 --> 00:16:23,810
<font color="#E5E5E5">great beer guy and implemented later JSP</font>

366
00:16:21,920 --> 00:16:25,459
turn out to be quite<font color="#E5E5E5"> close to the</font><font color="#CCCCCC"> metal</font>

367
00:16:23,810 --> 00:16:27,349
<font color="#E5E5E5">which</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> ironic because it's meant to be</font>

368
00:16:25,460 --> 00:16:29,540
<font color="#CCCCCC">platform independent</font><font color="#E5E5E5"> and yet it has</font>

369
00:16:27,350 --> 00:16:33,380
native streams threads everything I need

370
00:16:29,540 --> 00:16:35,990
<font color="#E5E5E5">out</font><font color="#CCCCCC"> of the</font><font color="#E5E5E5"> box wonderful as I said</font>

371
00:16:33,380 --> 00:16:37,670
pushing web stuff into this was was fun

372
00:16:35,990 --> 00:16:40,130
was challenging and I<font color="#CCCCCC"> basically not</font>

373
00:16:37,670 --> 00:16:40,849
learned a lot because I wanted this to

374
00:16:40,130 --> 00:16:42,590
<font color="#CCCCCC">be you know</font>

375
00:16:40,850 --> 00:16:44,210
agnostic from server<font color="#CCCCCC"> configuration so a</font>

376
00:16:42,590 --> 00:16:45,740
<font color="#E5E5E5">lot of</font><font color="#CCCCCC"> things I tried</font><font color="#E5E5E5"> to do the answer</font>

377
00:16:44,210 --> 00:16:48,650
were like oh yeah just enabled this in

378
00:16:45,740 --> 00:16:50,960
<font color="#CCCCCC">Bob config like yeah but I need</font><font color="#E5E5E5"> admin so</font>

379
00:16:48,650 --> 00:16:53,170
really can't<font color="#E5E5E5"> so</font><font color="#CCCCCC"> there</font><font color="#E5E5E5"> are some design</font>

380
00:16:50,960 --> 00:16:55,670
<font color="#CCCCCC">decisions that have</font><font color="#E5E5E5"> to make</font>

381
00:16:53,170 --> 00:16:57,620
<font color="#CCCCCC">Python generators like</font><font color="#E5E5E5"> I used</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> a</font>

382
00:16:55,670 --> 00:17:00,050
Python<font color="#CCCCCC"> developer Python generators are</font>

383
00:16:57,620 --> 00:17:02,060
awesome not<font color="#E5E5E5"> very known not very well</font>

384
00:17:00,050 --> 00:17:04,280
known<font color="#E5E5E5"> but it's like a function that</font><font color="#CCCCCC"> you</font>

385
00:17:02,060 --> 00:17:06,168
<font color="#CCCCCC">can</font><font color="#E5E5E5"> it returns data</font><font color="#CCCCCC"> Midway</font><font color="#E5E5E5"> and then</font><font color="#CCCCCC"> when</font>

386
00:17:04,280 --> 00:17:09,349
you call it<font color="#E5E5E5"> again it starts from where I</font>

387
00:17:06,169 --> 00:17:10,970
was left and so you can<font color="#E5E5E5"> read chunks like</font>

388
00:17:09,349 --> 00:17:12,770
<font color="#E5E5E5">literally by calling the function I will</font>

389
00:17:10,970 --> 00:17:14,630
<font color="#CCCCCC">keep</font><font color="#E5E5E5"> polling and so they will keep</font>

390
00:17:12,770 --> 00:17:17,990
reading the chunk from the stream it's

391
00:17:14,630 --> 00:17:21,439
really really wonderful<font color="#E5E5E5"> let's talk about</font>

392
00:17:17,990 --> 00:17:24,260
<font color="#E5E5E5">PHP a bit</font><font color="#CCCCCC"> up a bit of a</font><font color="#E5E5E5"> grudge against</font>

393
00:17:21,439 --> 00:17:27,740
PHP again<font color="#E5E5E5"> not the opinion of my my</font>

394
00:17:24,260 --> 00:17:28,280
employer but it sucks it's like it does

395
00:17:27,740 --> 00:17:30,950
the job

396
00:17:28,280 --> 00:17:33,020
but it makes you write bad code<font color="#CCCCCC"> it</font><font color="#E5E5E5"> it</font>

397
00:17:30,950 --> 00:17:34,910
has such limitations that<font color="#E5E5E5"> you</font><font color="#CCCCCC"> end</font><font color="#E5E5E5"> up</font>

398
00:17:33,020 --> 00:17:38,690
doing<font color="#E5E5E5"> something bad</font>

399
00:17:34,910 --> 00:17:41,299
for example<font color="#CCCCCC"> long a while ago</font><font color="#E5E5E5"> people put</font>

400
00:17:38,690 --> 00:17:43,190
like a user ID as a cookie<font color="#E5E5E5"> and if you</font>

401
00:17:41,299 --> 00:17:45,830
<font color="#E5E5E5">change that that you</font><font color="#CCCCCC"> could access other</font>

402
00:17:43,190 --> 00:17:48,440
<font color="#CCCCCC">people sessions</font><font color="#E5E5E5"> it becomes session are a</font>

403
00:17:45,830 --> 00:17:51,290
<font color="#E5E5E5">file on disk</font><font color="#CCCCCC"> so PHP native is sequential</font>

404
00:17:48,440 --> 00:17:52,580
<font color="#CCCCCC">you can't access this you know different</font>

405
00:17:51,290 --> 00:17:53,418
data<font color="#CCCCCC"> is</font><font color="#E5E5E5"> a same user will the same</font>

406
00:17:52,580 --> 00:17:55,730
session cookie

407
00:17:53,419 --> 00:17:57,799
it just queues up things so<font color="#E5E5E5"> unless you</font>

408
00:17:55,730 --> 00:18:00,140
implement memcache<font color="#E5E5E5"> which makes more code</font>

409
00:17:57,799 --> 00:18:01,610
more prone to<font color="#E5E5E5"> errors it does like all</font>

410
00:18:00,140 --> 00:18:02,950
those<font color="#E5E5E5"> things persistent connections</font>

411
00:18:01,610 --> 00:18:08,389
<font color="#E5E5E5">aren't really persistent</font>

412
00:18:02,950 --> 00:18:12,710
<font color="#CCCCCC">really PHP has no threads which you know</font>

413
00:18:08,390 --> 00:18:14,150
they have<font color="#CCCCCC"> been</font><font color="#E5E5E5"> around since 67 so I was</font>

414
00:18:12,710 --> 00:18:17,510
kind of annoying not having<font color="#E5E5E5"> being able</font>

415
00:18:14,150 --> 00:18:19,909
to<font color="#E5E5E5"> have like a clean heartbeat pull a</font>

416
00:18:17,510 --> 00:18:23,210
loop to<font color="#E5E5E5"> keep</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> alive</font><font color="#CCCCCC"> a fully</font>

417
00:18:19,909 --> 00:18:24,770
<font color="#E5E5E5">documented API bad examples mistakes you</font>

418
00:18:23,210 --> 00:18:26,120
can't do<font color="#E5E5E5"> this one way but</font><font color="#CCCCCC"> if you</font><font color="#E5E5E5"> do it</font>

419
00:18:24,770 --> 00:18:27,889
doesn't<font color="#E5E5E5"> work in the next</font><font color="#CCCCCC"> version of PHP</font>

420
00:18:26,120 --> 00:18:31,370
so you have<font color="#CCCCCC"> like to</font><font color="#E5E5E5"> have</font><font color="#CCCCCC"> exceptional</font>

421
00:18:27,890 --> 00:18:32,840
<font color="#E5E5E5">code so the basically</font><font color="#CCCCCC"> went you</font><font color="#E5E5E5"> know like</font>

422
00:18:31,370 --> 00:18:34,699
you start coding<font color="#CCCCCC"> in</font><font color="#E5E5E5"> Python and then you</font>

423
00:18:32,840 --> 00:18:36,918
get<font color="#E5E5E5"> you get you know you learn you learn</font>

424
00:18:34,700 --> 00:18:38,600
the HTTP spec and then<font color="#E5E5E5"> you go like JSP</font>

425
00:18:36,919 --> 00:18:40,010
<font color="#E5E5E5">SP</font><font color="#CCCCCC"> X and then you</font><font color="#E5E5E5"> get</font><font color="#CCCCCC"> a PHP</font><font color="#E5E5E5"> and you go</font>

426
00:18:38,600 --> 00:18:44,418
back<font color="#CCCCCC"> no come on</font><font color="#E5E5E5"> like this is just</font>

427
00:18:40,010 --> 00:18:47,780
frustrating<font color="#E5E5E5"> the ugly design decisions</font>

428
00:18:44,419 --> 00:18:49,520
<font color="#E5E5E5">also dotnet and PHP cannot read the body</font>

429
00:18:47,780 --> 00:18:54,290
of a chunk like on the<font color="#E5E5E5"> transferred</font><font color="#CCCCCC"> it</font>

430
00:18:49,520 --> 00:18:57,500
this means that<font color="#CCCCCC"> unlike JSP were</font><font color="#E5E5E5"> this the</font>

431
00:18:54,290 --> 00:19:00,230
<font color="#E5E5E5">server-side can read the chunks from the</font>

432
00:18:57,500 --> 00:19:03,580
input from the client as they come in<font color="#CCCCCC"> in</font>

433
00:19:00,230 --> 00:19:06,070
PHP<font color="#CCCCCC"> end of net</font><font color="#E5E5E5"> not</font><font color="#CCCCCC"> really</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> at issue</font>

434
00:19:03,580 --> 00:19:09,730
you post for each data coming in from

435
00:19:06,070 --> 00:19:10,689
<font color="#CCCCCC">the client if not a loop</font><font color="#E5E5E5"> because if</font>

436
00:19:09,730 --> 00:19:12,220
there is<font color="#CCCCCC"> no data if you don't type</font>

437
00:19:10,690 --> 00:19:14,440
anything in your in your<font color="#E5E5E5"> shell and</font><font color="#CCCCCC"> you</font>

438
00:19:12,220 --> 00:19:17,980
don't get any<font color="#CCCCCC"> posts sent so it's</font><font color="#E5E5E5"> not</font>

439
00:19:14,440 --> 00:19:21,010
optimal but<font color="#E5E5E5"> it does the job</font><font color="#CCCCCC"> and then</font>

440
00:19:17,980 --> 00:19:22,660
there<font color="#CCCCCC"> are like issue such as.net takes a</font>

441
00:19:21,010 --> 00:19:24,129
while to<font color="#E5E5E5"> warm up I don't</font><font color="#CCCCCC"> know how to</font>

442
00:19:22,660 --> 00:19:26,500
<font color="#E5E5E5">describe it like you see</font><font color="#CCCCCC"> that if you</font>

443
00:19:24,130 --> 00:19:28,510
<font color="#CCCCCC">look at the code there's a bunch of code</font>

444
00:19:26,500 --> 00:19:30,010
<font color="#CCCCCC">that tries to connect to</font><font color="#E5E5E5"> get a cookie</font>

445
00:19:28,510 --> 00:19:33,310
back and takes a<font color="#CCCCCC"> few seconds to get a</font>

446
00:19:30,010 --> 00:19:35,379
<font color="#E5E5E5">cookie</font><font color="#CCCCCC"> from</font><font color="#E5E5E5"> a web server why but if you</font>

447
00:19:33,310 --> 00:19:39,370
do in PHP<font color="#E5E5E5"> you get</font><font color="#CCCCCC"> twelve cookies okay</font>

448
00:19:35,380 --> 00:19:41,350
why<font color="#CCCCCC"> I</font><font color="#E5E5E5"> is workers you know</font><font color="#CCCCCC"> hogs resources</font>

449
00:19:39,370 --> 00:19:43,120
<font color="#CCCCCC">they're as much</font><font color="#E5E5E5"> of time outside to do so</font>

450
00:19:41,350 --> 00:19:45,040
<font color="#E5E5E5">there are a bunch of you know trying to</font>

451
00:19:43,120 --> 00:19:47,590
make this work in three languages<font color="#E5E5E5"> it</font>

452
00:19:45,040 --> 00:19:52,389
wasn't as clean as I wish it<font color="#CCCCCC"> could have</font>

453
00:19:47,590 --> 00:19:53,490
<font color="#CCCCCC">been</font><font color="#E5E5E5"> and there's a bug in is where this</font>

454
00:19:52,390 --> 00:19:55,870
is weird

455
00:19:53,490 --> 00:20:00,580
everything works<font color="#E5E5E5"> but the first message</font>

456
00:19:55,870 --> 00:20:04,330
takes 112 seconds to be read by<font color="#E5E5E5"> IAS and</font>

457
00:20:00,580 --> 00:20:07,240
<font color="#CCCCCC">send today to the target only the first</font>

458
00:20:04,330 --> 00:20:11,699
one and I have a<font color="#CCCCCC"> perfect</font><font color="#E5E5E5"> concept with</font>

459
00:20:07,240 --> 00:20:16,810
with<font color="#E5E5E5"> curve and the most basic aspx page</font>

460
00:20:11,700 --> 00:20:21,340
<font color="#E5E5E5">Cheers now last thing let's talk</font><font color="#CCCCCC"> about</font>

461
00:20:16,810 --> 00:20:23,560
web shells<font color="#E5E5E5"> so if user web shell this is</font>

462
00:20:21,340 --> 00:20:25,389
<font color="#CCCCCC">a typical Cali one you drop the web</font>

463
00:20:23,560 --> 00:20:27,750
shell you execute with it you know your

464
00:20:25,390 --> 00:20:30,940
command parameter is part of the<font color="#E5E5E5"> request</font>

465
00:20:27,750 --> 00:20:33,100
<font color="#E5E5E5">it does system</font><font color="#CCCCCC"> exec and</font><font color="#E5E5E5"> then it prints</font>

466
00:20:30,940 --> 00:20:35,290
<font color="#E5E5E5">out the output</font><font color="#CCCCCC"> boring right</font>

467
00:20:33,100 --> 00:20:37,449
yes you<font color="#CCCCCC"> proved</font><font color="#E5E5E5"> you proven code execution</font>

468
00:20:35,290 --> 00:20:40,450
but<font color="#CCCCCC"> a we can do</font><font color="#E5E5E5"> better than that</font>

469
00:20:37,450 --> 00:20:42,400
so if you want to do nicely<font color="#E5E5E5"> some a</font>

470
00:20:40,450 --> 00:20:44,710
slightly better<font color="#CCCCCC"> bug shell you might have</font>

471
00:20:42,400 --> 00:20:47,170
a<font color="#CCCCCC"> metric but</font><font color="#E5E5E5"> your payload dropped</font><font color="#CCCCCC"> onto</font>

472
00:20:44,710 --> 00:20:49,030
<font color="#CCCCCC">the</font><font color="#E5E5E5"> web store</font><font color="#CCCCCC"> down loaded and maybe like</font>

473
00:20:47,170 --> 00:20:51,070
executed<font color="#E5E5E5"> on memory</font><font color="#CCCCCC"> whatever it is and</font>

474
00:20:49,030 --> 00:20:54,070
then executed except this<font color="#E5E5E5"> require</font>

475
00:20:51,070 --> 00:20:56,110
<font color="#E5E5E5">support going out so again that's not</font>

476
00:20:54,070 --> 00:20:59,409
<font color="#CCCCCC">boring interactive but you have outbound</font>

477
00:20:56,110 --> 00:21:01,060
connectivity now<font color="#E5E5E5"> what if we try it from</font>

478
00:20:59,410 --> 00:21:04,360
<font color="#E5E5E5">a quarry you know transfer encoding</font>

479
00:21:01,060 --> 00:21:07,389
<font color="#E5E5E5">chunked question mark</font><font color="#CCCCCC"> it turns out it</font>

480
00:21:04,360 --> 00:21:08,679
<font color="#CCCCCC">works really really well</font><font color="#E5E5E5"> and again no</font>

481
00:21:07,390 --> 00:21:11,200
one connectivity and you can use

482
00:21:08,680 --> 00:21:13,360
<font color="#E5E5E5">real-time</font><font color="#CCCCCC"> input/output basically from</font>

483
00:21:11,200 --> 00:21:19,019
the remote shell and

484
00:21:13,360 --> 00:21:21,059
this is gonna be the last demo which is

485
00:21:19,019 --> 00:21:24,669
yep

486
00:21:21,059 --> 00:21:29,249
<font color="#E5E5E5">okay simpler setup you can see this</font>

487
00:21:24,669 --> 00:21:29,249
<font color="#E5E5E5">pretty much yeah</font><font color="#CCCCCC"> it's good</font>

488
00:21:30,659 --> 00:21:36,309
so on the top right and<font color="#E5E5E5"> side we have T G</font>

489
00:21:34,200 --> 00:21:39,360
just<font color="#CCCCCC"> the</font><font color="#E5E5E5"> web server</font><font color="#CCCCCC"> there's no target</font>

490
00:21:36,309 --> 00:21:41,739
<font color="#E5E5E5">behind it so we're on chunky tuna</font>

491
00:21:39,360 --> 00:21:44,258
<font color="#E5E5E5">against a web server and we tell</font><font color="#CCCCCC"> it to</font>

492
00:21:41,739 --> 00:21:48,100
<font color="#CCCCCC">execute a command command is going to be</font>

493
00:21:44,259 --> 00:21:49,869
you<font color="#CCCCCC"> know being SH</font><font color="#E5E5E5"> and then once the</font>

494
00:21:48,100 --> 00:21:52,658
<font color="#E5E5E5">command once the chunk even is ready we</font>

495
00:21:49,869 --> 00:21:54,100
can<font color="#E5E5E5"> connect to the local port so we just</font>

496
00:21:52,659 --> 00:21:55,659
<font color="#CCCCCC">connect into chunky</font><font color="#E5E5E5"> tuna and locally</font>

497
00:21:54,100 --> 00:21:59,649
that's going to<font color="#CCCCCC"> tell me the connection</font>

498
00:21:55,659 --> 00:22:00,580
<font color="#CCCCCC">and then we're gonna have a shell and</font>

499
00:21:59,649 --> 00:22:04,508
<font color="#E5E5E5">that's what's going</font><font color="#CCCCCC"> to happen right now</font>

500
00:22:00,580 --> 00:22:07,299
so we connect locally and then that's it

501
00:22:04,509 --> 00:22:11,429
<font color="#CCCCCC">we</font><font color="#E5E5E5"> have a shell</font><font color="#CCCCCC"> no outbound connectivity</font>

502
00:22:07,299 --> 00:22:13,389
and this interactive<font color="#E5E5E5"> show and that's</font>

503
00:22:11,429 --> 00:22:16,509
that's<font color="#CCCCCC"> pretty much it there are</font><font color="#E5E5E5"> a couple</font>

504
00:22:13,389 --> 00:22:18,340
<font color="#E5E5E5">of clarifications later but as a fully</font>

505
00:22:16,509 --> 00:22:21,100
functional work shell with<font color="#CCCCCC"> no you</font><font color="#E5E5E5"> no</font>

506
00:22:18,340 --> 00:22:22,899
<font color="#E5E5E5">need for a full upholding loop so just</font>

507
00:22:21,100 --> 00:22:27,459
I'm going<font color="#E5E5E5"> to show you the next slide in</font>

508
00:22:22,899 --> 00:22:31,600
fact<font color="#E5E5E5"> what's going to happen this</font><font color="#CCCCCC"> is a</font>

509
00:22:27,460 --> 00:22:34,690
<font color="#CCCCCC">war</font><font color="#E5E5E5"> shark dump so you can see the red is</font>

510
00:22:31,600 --> 00:22:36,399
the client the blue is the web shell so

511
00:22:34,690 --> 00:22:40,059
the client sends<font color="#E5E5E5"> a command and the</font>

512
00:22:36,399 --> 00:22:43,119
response is as a chunk of length 2 of 8

513
00:22:40,059 --> 00:22:45,879
which<font color="#E5E5E5"> I'd notice it has but</font><font color="#CCCCCC"> that's the</font>

514
00:22:43,119 --> 00:22:47,259
immediate<font color="#E5E5E5"> response and data comes in</font><font color="#CCCCCC"> I</font>

515
00:22:45,879 --> 00:22:48,759
can type you know she<font color="#CCCCCC"> opened this and</font>

516
00:22:47,259 --> 00:22:51,129
run<font color="#CCCCCC"> netcat you can type on</font><font color="#E5E5E5"> the server</font>

517
00:22:48,759 --> 00:22:55,869
side and<font color="#E5E5E5"> then you get data back right</font>

518
00:22:51,129 --> 00:22:57,869
away<font color="#E5E5E5"> without any any delay basically so</font>

519
00:22:55,869 --> 00:23:01,809
yes<font color="#E5E5E5"> we can have interactive web shells</font>

520
00:22:57,869 --> 00:23:04,359
<font color="#E5E5E5">it had to be a meme somewhere so anyway</font>

521
00:23:01,809 --> 00:23:08,408
in conclusion<font color="#E5E5E5"> there's a blog post that's</font>

522
00:23:04,359 --> 00:23:11,970
what chunky tuna does<font color="#E5E5E5"> and that's all for</font>

523
00:23:08,409 --> 00:23:11,970
<font color="#E5E5E5">me thank you</font><font color="#CCCCCC"> very much</font>

524
00:23:12,420 --> 00:23:15,939
[Applause]

