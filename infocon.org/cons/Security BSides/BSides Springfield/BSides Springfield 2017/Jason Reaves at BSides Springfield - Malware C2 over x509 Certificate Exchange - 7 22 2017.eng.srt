1
00:00:06,320 --> 00:00:12,759
[Music]

2
00:00:19,430 --> 00:00:25,080
so<font color="#CCCCCC"> now receipt or x.509 search exchange</font>

3
00:00:23,070 --> 00:00:26,789
<font color="#E5E5E5">so that's a lot</font><font color="#CCCCCC"> of things to say I'm</font>

4
00:00:25,080 --> 00:00:29,070
basically<font color="#E5E5E5"> talking</font><font color="#CCCCCC"> about data infill</font>

5
00:00:26,789 --> 00:00:33,719
exfil over a certificate as opposed to

6
00:00:29,070 --> 00:00:36,090
HTTP traffic<font color="#CCCCCC"> so an HTTP</font><font color="#E5E5E5"> request the</font>

7
00:00:33,719 --> 00:00:37,890
certs been exchanged but no HTTP request

8
00:00:36,090 --> 00:00:40,440
<font color="#CCCCCC">has</font><font color="#E5E5E5"> actually been made and you</font><font color="#CCCCCC"> can</font>

9
00:00:37,890 --> 00:00:45,090
transmit protocol<font color="#E5E5E5"> over</font><font color="#CCCCCC"> X 4 9 because of</font>

10
00:00:40,440 --> 00:00:47,968
extensions<font color="#CCCCCC"> a little bit about me I used</font>

11
00:00:45,090 --> 00:00:49,530
<font color="#E5E5E5">20</font><font color="#CCCCCC"> Jackanory number of years ago I now</font>

12
00:00:47,969 --> 00:00:53,910
work at<font color="#CCCCCC"> Fidelis</font><font color="#E5E5E5"> cyber security</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> the</font>

13
00:00:49,530 --> 00:00:55,710
<font color="#CCCCCC">DC primarily focuses a reverse</font>

14
00:00:53,910 --> 00:00:58,169
engineering and development<font color="#E5E5E5"> around like</font>

15
00:00:55,710 --> 00:00:59,670
automation frameworks my primary<font color="#E5E5E5"> focus</font>

16
00:00:58,170 --> 00:01:01,230
is dead of structures<font color="#CCCCCC"> and algorithms not</font>

17
00:00:59,670 --> 00:01:04,229
really my primary focus but more like my

18
00:01:01,230 --> 00:01:05,970
interest<font color="#E5E5E5"> I guess</font><font color="#CCCCCC"> you could</font><font color="#E5E5E5"> say I used to</font>

19
00:01:04,229 --> 00:01:07,979
run<font color="#CCCCCC"> dire tracker back when Dyer was</font>

20
00:01:05,970 --> 00:01:11,340
still a thing and there's my<font color="#CCCCCC"> Twitter</font>

21
00:01:07,979 --> 00:01:12,330
handle<font color="#E5E5E5"> and my email</font><font color="#CCCCCC"> so for my email this</font>

22
00:01:11,340 --> 00:01:15,330
is gonna be a<font color="#CCCCCC"> pretty quick Homer's</font>

23
00:01:12,330 --> 00:01:17,460
pretty quick presentation<font color="#CCCCCC"> the code piece</font>

24
00:01:15,330 --> 00:01:19,970
I'm gonna kind<font color="#E5E5E5"> of fly through I'll show</font>

25
00:01:17,460 --> 00:01:22,350
<font color="#CCCCCC">some highlights if you want the code</font>

26
00:01:19,970 --> 00:01:24,270
email me and I'll send<font color="#CCCCCC"> you</font><font color="#E5E5E5"> the whole</font>

27
00:01:22,350 --> 00:01:26,009
code I'm not gonna post<font color="#E5E5E5"> it on github</font>

28
00:01:24,270 --> 00:01:28,649
<font color="#E5E5E5">because I've never seen this used in</font>

29
00:01:26,009 --> 00:01:34,229
malware and I don't<font color="#E5E5E5"> really want to post</font>

30
00:01:28,650 --> 00:01:36,210
it<font color="#CCCCCC"> Healthcare</font><font color="#E5E5E5"> all right yeah so</font>

31
00:01:34,229 --> 00:01:38,759
primarily<font color="#E5E5E5"> the</font><font color="#CCCCCC"> reason that I created this</font>

32
00:01:36,210 --> 00:01:41,009
presentation<font color="#E5E5E5"> was</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> highlight the fact</font>

33
00:01:38,759 --> 00:01:43,470
that cybersecurity<font color="#E5E5E5"> is mostly proact or</font>

34
00:01:41,009 --> 00:01:45,600
mostly reactive as opposed to proactive

35
00:01:43,470 --> 00:01:49,320
<font color="#CCCCCC">and that's just because</font><font color="#E5E5E5"> we primarily</font>

36
00:01:45,600 --> 00:01:51,479
<font color="#E5E5E5">deal with defense right</font><font color="#CCCCCC"> that's changed a</font>

37
00:01:49,320 --> 00:01:54,479
lot over the years<font color="#CCCCCC"> so the recent</font><font color="#E5E5E5"> shift</font>

38
00:01:51,479 --> 00:01:56,280
being exploit developers pen testers red

39
00:01:54,479 --> 00:01:59,640
teaming<font color="#CCCCCC"> I think is what most people call</font>

40
00:01:56,280 --> 00:02:01,590
it<font color="#E5E5E5"> has really kind of played a bigger</font>

41
00:01:59,640 --> 00:02:05,009
part over the years and I consider<font color="#CCCCCC"> that</font>

42
00:02:01,590 --> 00:02:06,570
more proactive<font color="#CCCCCC"> reactive is I think</font>

43
00:02:05,009 --> 00:02:08,669
<font color="#CCCCCC">primarily</font><font color="#E5E5E5"> because most of the people</font>

44
00:02:06,570 --> 00:02:11,489
that come<font color="#CCCCCC"> into</font><font color="#E5E5E5"> cyber</font><font color="#CCCCCC"> security come from</font>

45
00:02:08,669 --> 00:02:13,049
<font color="#E5E5E5">IR forensics type backgrounds and they</font>

46
00:02:11,489 --> 00:02:16,020
always deal with<font color="#E5E5E5"> stuff after</font>

47
00:02:13,050 --> 00:02:17,790
it's kind of the<font color="#CCCCCC"> nature of the beast so</font>

48
00:02:16,020 --> 00:02:20,850
<font color="#CCCCCC">I ma'am our researcher I also have</font>

49
00:02:17,790 --> 00:02:23,370
exploitation experience so I relate the

50
00:02:20,850 --> 00:02:25,440
fact<font color="#CCCCCC"> that I saw this happen due to my</font>

51
00:02:23,370 --> 00:02:27,660
exploitation experience<font color="#CCCCCC"> I don't write</font>

52
00:02:25,440 --> 00:02:30,750
exploits<font color="#CCCCCC"> I'm not really very good</font><font color="#E5E5E5"> at it</font>

53
00:02:27,660 --> 00:02:32,220
<font color="#CCCCCC">I primarily focused with malware</font><font color="#E5E5E5"> but</font>

54
00:02:30,750 --> 00:02:34,980
<font color="#E5E5E5">just the fact that I've</font><font color="#CCCCCC"> cross-trained</font>

55
00:02:32,220 --> 00:02:37,050
<font color="#E5E5E5">has helped my mind kind of see those</font>

56
00:02:34,980 --> 00:02:42,119
<font color="#E5E5E5">holes and those potential gaps and then</font>

57
00:02:37,050 --> 00:02:43,770
kind of create these<font color="#CCCCCC"> situations</font><font color="#E5E5E5"> so the</font>

58
00:02:42,120 --> 00:02:46,470
<font color="#E5E5E5">story</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> this happened I was probably</font>

59
00:02:43,770 --> 00:02:47,850
<font color="#E5E5E5">looking at</font><font color="#CCCCCC"> Vetrov Autec</font><font color="#E5E5E5"> has a</font><font color="#CCCCCC"> DGA</font><font color="#E5E5E5"> when</font>

60
00:02:46,470 --> 00:02:50,640
they added<font color="#E5E5E5"> the DGA and they used to</font><font color="#CCCCCC"> be</font>

61
00:02:47,850 --> 00:02:54,810
HTTP traffic they started looking<font color="#E5E5E5"> at</font><font color="#CCCCCC"> a</font>

62
00:02:50,640 --> 00:02:56,489
specific extension in the cert and what

63
00:02:54,810 --> 00:02:58,980
they were<font color="#E5E5E5"> doing was they</font><font color="#CCCCCC"> were taking the</font>

64
00:02:56,490 --> 00:03:01,440
data<font color="#E5E5E5"> and they were encoding it and I</font>

65
00:02:58,980 --> 00:03:03,239
thought<font color="#E5E5E5"> that</font><font color="#CCCCCC"> they were</font><font color="#E5E5E5"> passing data over</font>

66
00:03:01,440 --> 00:03:05,010
<font color="#E5E5E5">this earth</font><font color="#CCCCCC"> turns</font><font color="#E5E5E5"> out I was wrong they</font>

67
00:03:03,240 --> 00:03:06,690
were just checking<font color="#CCCCCC"> a hash they were</font><font color="#E5E5E5"> just</font>

68
00:03:05,010 --> 00:03:10,620
making sure that that hash was related

69
00:03:06,690 --> 00:03:12,630
to<font color="#E5E5E5"> their their real c2 but it got me</font>

70
00:03:10,620 --> 00:03:14,400
interested in what<font color="#E5E5E5"> this extension meant</font>

71
00:03:12,630 --> 00:03:17,239
<font color="#E5E5E5">it's a subject key identifier so I went</font>

72
00:03:14,400 --> 00:03:19,560
<font color="#E5E5E5">to the I googled</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> went to the</font>

73
00:03:17,239 --> 00:03:22,290
specifications and read what it said

74
00:03:19,560 --> 00:03:24,150
<font color="#E5E5E5">which you can read here</font><font color="#CCCCCC"> the if you have</font>

75
00:03:22,290 --> 00:03:26,850
any exploitation experience reading

76
00:03:24,150 --> 00:03:30,090
stuff like this you<font color="#CCCCCC"> pick up on some buzz</font>

77
00:03:26,850 --> 00:03:31,799
words right like this<font color="#E5E5E5"> is a string</font>

78
00:03:30,090 --> 00:03:35,880
extension it can take two possible

79
00:03:31,800 --> 00:03:37,920
<font color="#CCCCCC">values the the in sentence the use of</font>

80
00:03:35,880 --> 00:03:40,530
this hex string is strongly<font color="#E5E5E5"> discouraged</font>

81
00:03:37,920 --> 00:03:42,899
<font color="#E5E5E5">they don't have any guidelines for how</font>

82
00:03:40,530 --> 00:03:45,390
<font color="#E5E5E5">big or</font><font color="#CCCCCC"> small</font><font color="#E5E5E5"> it should be you</font><font color="#CCCCCC"> can put</font>

83
00:03:42,900 --> 00:03:46,920
whatever you want in there it's supposed

84
00:03:45,390 --> 00:03:48,950
to be a hash but it doesn't have<font color="#E5E5E5"> to be a</font>

85
00:03:46,920 --> 00:03:51,809
hash length<font color="#E5E5E5"> there's all these things</font>

86
00:03:48,950 --> 00:03:53,459
<font color="#E5E5E5">that they that they don't specify in</font>

87
00:03:51,810 --> 00:03:55,200
their specifications and it leaves<font color="#E5E5E5"> you</font>

88
00:03:53,459 --> 00:03:57,390
<font color="#CCCCCC">open to this</font><font color="#E5E5E5"> kind of exploitation</font>

89
00:03:55,200 --> 00:03:58,470
<font color="#E5E5E5">mindset of how you can use</font><font color="#CCCCCC"> it for</font>

90
00:03:57,390 --> 00:04:02,160
<font color="#E5E5E5">something other</font><font color="#CCCCCC"> than its intended</font>

91
00:03:58,470 --> 00:04:03,570
<font color="#E5E5E5">purpose which I go over here so we have</font>

92
00:04:02,160 --> 00:04:05,130
a field<font color="#CCCCCC"> like hold arbitrary information</font>

93
00:04:03,570 --> 00:04:07,400
so we're into it<font color="#CCCCCC"> things that came to</font>

94
00:04:05,130 --> 00:04:09,750
<font color="#E5E5E5">mind exploitation data</font><font color="#CCCCCC"> exfil data infill</font>

95
00:04:07,400 --> 00:04:14,010
since I do with my malware that's

96
00:04:09,750 --> 00:04:16,709
malware<font color="#CCCCCC"> see - so for a proof of concept</font>

97
00:04:14,010 --> 00:04:18,779
which<font color="#CCCCCC"> was what I went</font><font color="#E5E5E5"> to next</font><font color="#CCCCCC"> I wanted</font>

98
00:04:16,709 --> 00:04:20,730
<font color="#E5E5E5">to automatically create search they</font>

99
00:04:18,779 --> 00:04:22,890
could<font color="#E5E5E5"> hold this arbitrary data</font><font color="#CCCCCC"> I wanted</font>

100
00:04:20,730 --> 00:04:27,010
<font color="#E5E5E5">to create a server</font><font color="#CCCCCC"> that I could</font><font color="#E5E5E5"> then</font>

101
00:04:22,890 --> 00:04:28,960
talk<font color="#CCCCCC"> to you with a bot and I</font><font color="#E5E5E5"> wanted to</font>

102
00:04:27,010 --> 00:04:31,530
have the<font color="#CCCCCC"> bot</font><font color="#E5E5E5"> code write the code</font><font color="#CCCCCC"> to</font>

103
00:04:28,960 --> 00:04:33,370
retrieve the data<font color="#E5E5E5"> but I put this</font>

104
00:04:31,530 --> 00:04:35,169
specification<font color="#E5E5E5"> that I didn't want it</font><font color="#CCCCCC"> to</font>

105
00:04:33,370 --> 00:04:37,720
actually<font color="#E5E5E5"> perform an HTTP request</font><font color="#CCCCCC"> so it</font>

106
00:04:35,170 --> 00:04:40,710
does<font color="#CCCCCC"> a head</font><font color="#E5E5E5"> request and then we'll get</font>

107
00:04:37,720 --> 00:04:43,120
into why it<font color="#E5E5E5"> doesn't do the head request</font>

108
00:04:40,710 --> 00:04:45,190
so generation<font color="#CCCCCC"> is pretty easy this is</font>

109
00:04:43,120 --> 00:04:49,780
straight out of<font color="#E5E5E5"> Google how to generate</font>

110
00:04:45,190 --> 00:04:54,310
<font color="#CCCCCC">assert or a key right so it's three</font>

111
00:04:49,780 --> 00:04:57,669
commands<font color="#E5E5E5"> it's nothing really fancy this</font>

112
00:04:54,310 --> 00:05:00,220
<font color="#CCCCCC">is a</font><font color="#E5E5E5"> Python script I wrote up but it</font>

113
00:04:57,670 --> 00:05:02,110
<font color="#CCCCCC">pretty much just takes your cert and</font><font color="#E5E5E5"> I</font>

114
00:05:00,220 --> 00:05:04,420
got like<font color="#E5E5E5"> a</font><font color="#CCCCCC"> past write of stupid</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> a</font>

115
00:05:02,110 --> 00:05:06,280
config dot txt<font color="#CCCCCC"> they can figure that txt</font>

116
00:05:04,420 --> 00:05:09,670
is what I consider<font color="#CCCCCC"> my</font><font color="#E5E5E5"> banker config for</font>

117
00:05:06,280 --> 00:05:11,890
my fake bought and this Python script

118
00:05:09,670 --> 00:05:14,440
can run at any time<font color="#CCCCCC"> take the the script</font>

119
00:05:11,890 --> 00:05:17,260
or take the config<font color="#E5E5E5"> and code it stick it</font>

120
00:05:14,440 --> 00:05:21,219
in this extensions CNF file there at the

121
00:05:17,260 --> 00:05:24,450
bottom<font color="#CCCCCC"> and then it generates a cert</font>

122
00:05:21,220 --> 00:05:24,450
<font color="#E5E5E5">that's kind of hard to see isn't it</font>

123
00:05:24,630 --> 00:05:29,020
anyway<font color="#E5E5E5"> so</font><font color="#CCCCCC"> it generates</font><font color="#E5E5E5"> the cert using</font>

124
00:05:27,490 --> 00:05:31,180
the extensions<font color="#E5E5E5"> and it does it in real</font>

125
00:05:29,020 --> 00:05:32,590
time<font color="#E5E5E5"> so I can't use that cert and</font>

126
00:05:31,180 --> 00:05:34,810
something like<font color="#CCCCCC"> a</font><font color="#E5E5E5"> patchy</font><font color="#CCCCCC"> because it loads</font>

127
00:05:32,590 --> 00:05:36,520
it in memory<font color="#CCCCCC"> you have to have the key I</font>

128
00:05:34,810 --> 00:05:38,169
can't change it in memory<font color="#CCCCCC"> I</font><font color="#E5E5E5"> would have</font>

129
00:05:36,520 --> 00:05:43,450
to<font color="#E5E5E5"> create like a module and</font><font color="#CCCCCC"> Apache</font><font color="#E5E5E5"> to</font>

130
00:05:38,169 --> 00:05:45,310
bypass their security<font color="#E5E5E5"> so instead I'm</font>

131
00:05:43,450 --> 00:05:47,169
<font color="#E5E5E5">gonna skip actually so instead I</font><font color="#CCCCCC"> create</font>

132
00:05:45,310 --> 00:05:48,940
a server which is<font color="#E5E5E5"> the Python server</font>

133
00:05:47,169 --> 00:05:50,950
<font color="#CCCCCC">waits for incoming</font><font color="#E5E5E5"> connections</font><font color="#CCCCCC"> over</font>

134
00:05:48,940 --> 00:05:54,460
where the port I specify and serves<font color="#E5E5E5"> up</font>

135
00:05:50,950 --> 00:05:59,020
the<font color="#E5E5E5"> cert from disk so the last line of</font>

136
00:05:54,460 --> 00:06:01,180
<font color="#E5E5E5">my</font><font color="#CCCCCC"> previous script</font><font color="#E5E5E5"> is a open open ssl</font>

137
00:05:59,020 --> 00:06:03,460
RSA<font color="#CCCCCC"> i'm</font><font color="#E5E5E5"> basically stripping the password</font>

138
00:06:01,180 --> 00:06:05,860
off of the key that way my<font color="#CCCCCC"> Python script</font>

139
00:06:03,460 --> 00:06:08,979
can use the key with the cert in real

140
00:06:05,860 --> 00:06:10,300
time<font color="#E5E5E5"> from disk and I don't have to load</font>

141
00:06:08,980 --> 00:06:13,419
<font color="#CCCCCC">it</font><font color="#E5E5E5"> in memory with Apache or something</font>

142
00:06:10,300 --> 00:06:15,490
like<font color="#CCCCCC"> that</font><font color="#E5E5E5"> for retrieving the data</font><font color="#CCCCCC"> as</font>

143
00:06:13,419 --> 00:06:16,900
please is pretty straightforward<font color="#CCCCCC"> if</font>

144
00:06:15,490 --> 00:06:18,280
you've ever looked<font color="#E5E5E5"> at like anything off</font>

145
00:06:16,900 --> 00:06:19,810
most<font color="#E5E5E5"> of this code came from him that's</font>

146
00:06:18,280 --> 00:06:22,659
<font color="#CCCCCC">the end with the exception of the</font>

147
00:06:19,810 --> 00:06:24,490
<font color="#E5E5E5">callback</font><font color="#CCCCCC"> but this is</font><font color="#E5E5E5"> pretty</font><font color="#CCCCCC"> much</font><font color="#E5E5E5"> just</font>

148
00:06:22,660 --> 00:06:28,810
making a head request<font color="#E5E5E5"> so it's making</font>

149
00:06:24,490 --> 00:06:30,460
HTTP head<font color="#CCCCCC"> request so the magic happens</font>

150
00:06:28,810 --> 00:06:33,669
with a callback<font color="#CCCCCC"> and I had to do</font>

151
00:06:30,460 --> 00:06:35,409
something some<font color="#E5E5E5"> really deep kind of</font>

152
00:06:33,669 --> 00:06:37,030
finding of this<font color="#CCCCCC"> specific</font><font color="#E5E5E5"> callback</font>

153
00:06:35,410 --> 00:06:38,500
because<font color="#CCCCCC"> I've never</font><font color="#E5E5E5"> seen</font><font color="#CCCCCC"> before maybe</font><font color="#E5E5E5"> if</font>

154
00:06:37,030 --> 00:06:39,659
<font color="#CCCCCC">you're</font><font color="#E5E5E5"> developer you've heard of it</font>

155
00:06:38,500 --> 00:06:41,520
<font color="#E5E5E5">before</font>

156
00:06:39,660 --> 00:06:43,320
basically<font color="#E5E5E5"> this callback function when</font>

157
00:06:41,520 --> 00:06:45,210
you<font color="#E5E5E5"> set</font><font color="#CCCCCC"> it up when you make a request if</font>

158
00:06:43,320 --> 00:06:48,270
sits there and you can tell<font color="#E5E5E5"> it to wait</font>

159
00:06:45,210 --> 00:06:49,500
for a specific status of the request<font color="#E5E5E5"> so</font>

160
00:06:48,270 --> 00:06:51,210
the HDP request is<font color="#E5E5E5"> going to go out</font>

161
00:06:49,500 --> 00:06:53,640
you're<font color="#E5E5E5"> going to do</font><font color="#CCCCCC"> a cert exchange all</font>

162
00:06:51,210 --> 00:06:56,430
these different steps are laid<font color="#E5E5E5"> out and</font>

163
00:06:53,640 --> 00:06:58,349
<font color="#E5E5E5">MSDN this one is not some sort I can</font>

164
00:06:56,430 --> 00:07:01,970
tell it's<font color="#E5E5E5"> internet status sending</font>

165
00:06:58,350 --> 00:07:04,440
<font color="#E5E5E5">request basically this status happens</font>

166
00:07:01,970 --> 00:07:07,530
after the sir exchanged but before the

167
00:07:04,440 --> 00:07:09,390
HTTP head request is actually<font color="#E5E5E5"> sent so at</font>

168
00:07:07,530 --> 00:07:10,859
that point<font color="#E5E5E5"> I have access to</font><font color="#CCCCCC"> this</font>

169
00:07:09,390 --> 00:07:13,380
<font color="#E5E5E5">certificate so you see at the bottom</font>

170
00:07:10,860 --> 00:07:17,100
there<font color="#CCCCCC"> I parse out the subject key</font>

171
00:07:13,380 --> 00:07:22,050
identifier<font color="#CCCCCC"> I decode it using I think</font>

172
00:07:17,100 --> 00:07:25,740
<font color="#E5E5E5">ixora long and then I I I pranked a</font>

173
00:07:22,050 --> 00:07:27,720
screen so<font color="#CCCCCC"> we'll I'll</font><font color="#E5E5E5"> show here so this</font>

174
00:07:25,740 --> 00:07:29,730
<font color="#E5E5E5">is a bot kind of in the bug mode I've</font>

175
00:07:27,720 --> 00:07:33,480
told it to connect to<font color="#E5E5E5"> my Python server</font>

176
00:07:29,730 --> 00:07:35,850
<font color="#E5E5E5">and then I've set up all these things to</font>

177
00:07:33,480 --> 00:07:38,190
kind of print out all the statuses<font color="#CCCCCC"> right</font>

178
00:07:35,850 --> 00:07:41,430
so<font color="#E5E5E5"> internet open success it's be open</font><font color="#CCCCCC"> so</font>

179
00:07:38,190 --> 00:07:43,350
<font color="#CCCCCC">this</font><font color="#E5E5E5"> entered a set option and then all</font>

180
00:07:41,430 --> 00:07:45,570
the subject parameters and then you see

181
00:07:43,350 --> 00:07:47,850
there the TV data at the bottom is the

182
00:07:45,570 --> 00:07:50,070
data from the subject key identifier

183
00:07:47,850 --> 00:07:51,660
field<font color="#E5E5E5"> and then I decode it and print it</font>

184
00:07:50,070 --> 00:07:54,300
out and it's basically<font color="#E5E5E5"> kind of like a</font>

185
00:07:51,660 --> 00:07:58,140
<font color="#CCCCCC">Baker Trojan config right I'm telling it</font>

186
00:07:54,300 --> 00:08:00,210
to steal from Gmail Yahoo Amazon<font color="#E5E5E5"> doing</font>

187
00:07:58,140 --> 00:08:01,830
<font color="#E5E5E5">whatever form grabbing cookies theft or</font>

188
00:08:00,210 --> 00:08:06,989
whatever<font color="#E5E5E5"> and then I'm telling it the</font><font color="#CCCCCC"> web</font>

189
00:08:01,830 --> 00:08:11,580
inject Gmail with a div around stupid so

190
00:08:06,990 --> 00:08:13,320
very kind<font color="#E5E5E5"> of demonstration purposes so</font>

191
00:08:11,580 --> 00:08:14,820
here's the traffic all you see is tell

192
00:08:13,320 --> 00:08:17,190
<font color="#E5E5E5">us you don't see an HTTP</font><font color="#CCCCCC"> request</font>

193
00:08:14,820 --> 00:08:19,310
<font color="#E5E5E5">actually go out so yeah Wireshark at the</font>

194
00:08:17,190 --> 00:08:22,400
top filter at the front at<font color="#E5E5E5"> the bottom</font>

195
00:08:19,310 --> 00:08:24,480
<font color="#CCCCCC">well you see they connect</font><font color="#E5E5E5"> and fiddler</font>

196
00:08:22,400 --> 00:08:29,729
but you know you<font color="#CCCCCC"> don't</font><font color="#E5E5E5"> actually see any</font>

197
00:08:24,480 --> 00:08:33,570
HTTP<font color="#E5E5E5"> requests so how did the tech this</font>

198
00:08:29,730 --> 00:08:36,210
<font color="#E5E5E5">right so when I saw this and I</font><font color="#CCCCCC"> thought</font>

199
00:08:33,570 --> 00:08:38,280
of<font color="#CCCCCC"> it</font><font color="#E5E5E5"> I created the POC and I went to</font>

200
00:08:36,210 --> 00:08:40,469
<font color="#E5E5E5">our developers I was like to make sure</font>

201
00:08:38,280 --> 00:08:42,150
<font color="#E5E5E5">we could detect it but how do you</font>

202
00:08:40,469 --> 00:08:44,610
<font color="#E5E5E5">actually detect this you either have to</font>

203
00:08:42,150 --> 00:08:48,390
parse out at all the<font color="#E5E5E5"> data inside</font><font color="#CCCCCC"> x.509</font>

204
00:08:44,610 --> 00:08:51,390
which there's a lot<font color="#E5E5E5"> and potentially as</font>

205
00:08:48,390 --> 00:08:53,250
we'll see<font color="#CCCCCC"> in the next</font><font color="#E5E5E5"> slide</font><font color="#CCCCCC"> kind</font><font color="#E5E5E5"> of an</font>

206
00:08:51,390 --> 00:08:56,910
<font color="#E5E5E5">arbitrary amount unless you</font>

207
00:08:53,250 --> 00:08:58,920
code<font color="#CCCCCC"> Senate you have a so</font><font color="#E5E5E5"> you can detect</font>

208
00:08:56,910 --> 00:09:00,750
<font color="#E5E5E5">it that</font><font color="#CCCCCC"> you see</font><font color="#E5E5E5"> either the the IP is</font>

209
00:08:58,920 --> 00:09:02,880
malicious<font color="#CCCCCC"> or you're pulling out data</font>

210
00:09:00,750 --> 00:09:04,380
from the x.509 certificate<font color="#E5E5E5"> and you're</font>

211
00:09:02,880 --> 00:09:07,080
saying<font color="#CCCCCC"> that the subject can identify are</font>

212
00:09:04,380 --> 00:09:08,460
in the specs<font color="#E5E5E5"> says it should be a hash so</font>

213
00:09:07,080 --> 00:09:11,280
you can check the length<font color="#E5E5E5"> and say this</font>

214
00:09:08,460 --> 00:09:12,660
isn't<font color="#E5E5E5"> a hash length</font><font color="#CCCCCC"> but then there's you</font>

215
00:09:11,280 --> 00:09:15,390
know<font color="#E5E5E5"> you start thinking</font><font color="#CCCCCC"> of ways to get</font>

216
00:09:12,660 --> 00:09:17,040
<font color="#CCCCCC">around</font><font color="#E5E5E5"> that well then I can just have</font><font color="#CCCCCC"> my</font>

217
00:09:15,390 --> 00:09:19,410
<font color="#CCCCCC">bot talk to me</font><font color="#E5E5E5"> until it hits an</font><font color="#CCCCCC"> end</font>

218
00:09:17,040 --> 00:09:24,839
marker<font color="#E5E5E5"> so I can just keep sending hash</font>

219
00:09:19,410 --> 00:09:26,400
<font color="#E5E5E5">length data segments back these are some</font>

220
00:09:24,840 --> 00:09:30,390
kind<font color="#CCCCCC"> of interesting things I observed</font><font color="#E5E5E5"> I</font>

221
00:09:26,400 --> 00:09:31,740
<font color="#E5E5E5">was going through</font><font color="#CCCCCC"> oh so they open SSL</font>

222
00:09:30,390 --> 00:09:34,949
version I<font color="#E5E5E5"> add which</font><font color="#CCCCCC"> is zero point</font><font color="#E5E5E5"> nine</font>

223
00:09:31,740 --> 00:09:37,680
point eight<font color="#CCCCCC"> zah</font><font color="#E5E5E5"> on my Mac I didn't see a</font>

224
00:09:34,950 --> 00:09:40,770
limit on<font color="#E5E5E5"> how big I could make an</font>

225
00:09:37,680 --> 00:09:44,550
<font color="#E5E5E5">extension so I made one pretty like</font>

226
00:09:40,770 --> 00:09:46,530
crazy long<font color="#E5E5E5"> and I loaded it up</font><font color="#CCCCCC"> with</font>

227
00:09:44,550 --> 00:09:49,370
Apache<font color="#E5E5E5"> so another interesting</font><font color="#CCCCCC"> thing</font>

228
00:09:46,530 --> 00:09:51,630
Apache will gladly load a ginormous

229
00:09:49,370 --> 00:09:54,150
<font color="#E5E5E5">certificate and serve it back to you</font>

230
00:09:51,630 --> 00:09:56,370
open<font color="#E5E5E5"> SSL will then connect to that</font>

231
00:09:54,150 --> 00:09:58,770
Apache server and attempt<font color="#CCCCCC"> to parse it in</font>

232
00:09:56,370 --> 00:10:00,860
memory<font color="#CCCCCC"> and crash</font><font color="#E5E5E5"> because it runs out of</font>

233
00:09:58,770 --> 00:10:04,980
<font color="#E5E5E5">memory</font>

234
00:10:00,860 --> 00:10:06,510
Microsoft<font color="#E5E5E5"> 10</font><font color="#CCCCCC"> 64-bit on my VM</font><font color="#E5E5E5"> actually</font>

235
00:10:04,980 --> 00:10:08,040
doesn't I<font color="#CCCCCC"> don't know if it reads all of</font>

236
00:10:06,510 --> 00:10:09,360
it so I didn't deep dive you'd have to

237
00:10:08,040 --> 00:10:13,410
go pretty<font color="#E5E5E5"> deep to figure out exactly</font>

238
00:10:09,360 --> 00:10:14,970
what it's<font color="#CCCCCC"> doing</font><font color="#E5E5E5"> but it doesn't</font><font color="#CCCCCC"> did I</font>

239
00:10:13,410 --> 00:10:17,400
didn't have access<font color="#E5E5E5"> to</font><font color="#CCCCCC"> all the</font><font color="#E5E5E5"> data it</font>

240
00:10:14,970 --> 00:10:19,230
had a hard limit<font color="#E5E5E5"> on what it gave</font><font color="#CCCCCC"> me</font><font color="#E5E5E5"> so</font>

241
00:10:17,400 --> 00:10:29,459
it<font color="#E5E5E5"> probably has a limit on what it is</font>

242
00:10:19,230 --> 00:10:35,250
<font color="#E5E5E5">expecting to see from</font><font color="#CCCCCC"> an extension yeah</font>

243
00:10:29,460 --> 00:10:37,290
how's it any questions I'll put my own

244
00:10:35,250 --> 00:10:39,990
<font color="#E5E5E5">like I said if you want the proof of</font>

245
00:10:37,290 --> 00:10:42,410
concept code<font color="#E5E5E5"> you can email me and I'll</font>

246
00:10:39,990 --> 00:10:42,410
<font color="#E5E5E5">send it</font><font color="#CCCCCC"> to you</font>

247
00:10:45,110 --> 00:11:07,519
I think you'd have<font color="#E5E5E5"> to</font><font color="#CCCCCC"> tome</font><font color="#E5E5E5"> it for when</font>

248
00:11:06,380 --> 00:11:09,950
<font color="#CCCCCC">you generate</font><font color="#E5E5E5"> it has to be when you</font>

249
00:11:07,519 --> 00:11:14,029
generate<font color="#E5E5E5"> it now I don't know exactly</font><font color="#CCCCCC"> how</font>

250
00:11:09,950 --> 00:11:15,620
the certificate authority stuff works so

251
00:11:14,029 --> 00:11:17,600
I know if you have a CSR you can

252
00:11:15,620 --> 00:11:19,010
generate a certificate<font color="#CCCCCC"> so if let's</font>

253
00:11:17,600 --> 00:11:20,029
encrypt gives you the CSR you can

254
00:11:19,010 --> 00:11:21,529
<font color="#E5E5E5">probably generate but I don't think they</font>

255
00:11:20,029 --> 00:11:23,329
do that<font color="#CCCCCC"> even just generate</font><font color="#E5E5E5"> because you</font>

256
00:11:21,529 --> 00:11:25,040
<font color="#E5E5E5">always have to for let's encrypt you</font>

257
00:11:23,329 --> 00:11:26,420
always<font color="#CCCCCC"> after</font><font color="#E5E5E5"> updating right so you</font>

258
00:11:25,040 --> 00:11:58,219
always have to<font color="#E5E5E5"> you always get us to hear</font>

259
00:11:26,420 --> 00:12:00,050
<font color="#E5E5E5">from them yeah you're doing it so</font><font color="#CCCCCC"> for</font>

260
00:11:58,220 --> 00:12:01,579
exfil purposes and I didn't really touch

261
00:12:00,050 --> 00:12:02,990
on it much I<font color="#CCCCCC"> just kind of mentioned</font><font color="#E5E5E5"> it</font>

262
00:12:01,579 --> 00:12:06,349
<font color="#E5E5E5">because I was trying to create a proof</font>

263
00:12:02,990 --> 00:12:08,870
of<font color="#CCCCCC"> concept for it if you pivoted in a</font>

264
00:12:06,350 --> 00:12:10,579
local network<font color="#CCCCCC"> to your</font><font color="#E5E5E5"> HTTP server which</font>

265
00:12:08,870 --> 00:12:14,899
is what I would<font color="#CCCCCC"> do as an attacker</font><font color="#E5E5E5"> and</font>

266
00:12:10,579 --> 00:12:16,870
then tried to overwrite your cert to

267
00:12:14,899 --> 00:12:18,620
send<font color="#E5E5E5"> data so we're talking about</font><font color="#CCCCCC"> like</font>

268
00:12:16,870 --> 00:12:19,970
<font color="#E5E5E5">what's the thing that happened not</font><font color="#CCCCCC"> so</font>

269
00:12:18,620 --> 00:12:22,310
long ago they had like image files in

270
00:12:19,970 --> 00:12:24,230
the the web server and<font color="#E5E5E5"> then</font><font color="#CCCCCC"> the they</font>

271
00:12:22,310 --> 00:12:26,029
were infected<font color="#E5E5E5"> and so</font><font color="#CCCCCC"> the bad</font><font color="#E5E5E5"> guys were</font>

272
00:12:24,230 --> 00:12:28,010
like hitting web servers<font color="#E5E5E5"> for</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> text</font>

273
00:12:26,029 --> 00:12:29,810
<font color="#CCCCCC">pool if you did something similar to</font>

274
00:12:28,010 --> 00:12:34,220
that<font color="#E5E5E5"> with your HTTP server it's going</font><font color="#CCCCCC"> to</font>

275
00:12:29,810 --> 00:12:41,859
<font color="#E5E5E5">exist in memory so you would have</font><font color="#CCCCCC"> to</font>

276
00:12:34,220 --> 00:12:41,860
find that<font color="#CCCCCC"> in</font><font color="#E5E5E5"> memory and edit it I think</font>

277
00:12:43,680 --> 00:12:49,229
and<font color="#E5E5E5"> I that may be possible if you always</font>

278
00:12:46,740 --> 00:12:51,660
<font color="#CCCCCC">use the exact</font><font color="#E5E5E5"> same amount of data but</font>

279
00:12:49,230 --> 00:12:53,220
<font color="#E5E5E5">then how do you control</font><font color="#CCCCCC"> I guess you'd</font>

280
00:12:51,660 --> 00:13:39,540
only<font color="#CCCCCC"> have so much data block you can</font>

281
00:12:53,220 --> 00:13:42,749
<font color="#CCCCCC">echo</font><font color="#E5E5E5"> you could use it yeah</font><font color="#CCCCCC"> I haven't</font>

282
00:13:39,540 --> 00:13:44,339
<font color="#E5E5E5">seen anybody do it and if I might like I</font>

283
00:13:42,749 --> 00:13:48,149
said my primary<font color="#E5E5E5"> focus</font><font color="#CCCCCC"> was the fact that</font>

284
00:13:44,339 --> 00:13:50,429
I thought<font color="#CCCCCC"> that</font><font color="#E5E5E5"> if your defense product</font>

285
00:13:48,149 --> 00:13:53,699
or your security product was looking at

286
00:13:50,429 --> 00:13:55,800
URLs the<font color="#E5E5E5"> only way to block that would be</font>

287
00:13:53,699 --> 00:13:59,339
to parse the data and see that<font color="#CCCCCC"> it's</font>

288
00:13:55,800 --> 00:14:01,050
<font color="#E5E5E5">anomalous or detect it by IP since</font>

289
00:13:59,339 --> 00:14:15,449
there's no HTTP<font color="#E5E5E5"> request you can't really</font>

290
00:14:01,050 --> 00:14:18,599
do anything maybe if<font color="#CCCCCC"> you're man in the</font>

291
00:14:15,449 --> 00:14:20,029
milling everything like what do<font color="#E5E5E5"> you if</font>

292
00:14:18,600 --> 00:14:24,149
you're not man in the middle<font color="#E5E5E5"> in your</font>

293
00:14:20,029 --> 00:14:25,379
network<font color="#E5E5E5"> what do you see</font><font color="#CCCCCC"> I know most</font>

294
00:14:24,149 --> 00:14:31,470
corporations<font color="#E5E5E5"> are going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> man in the</font>

295
00:14:25,379 --> 00:14:33,149
<font color="#E5E5E5">middle of it oh yeah</font><font color="#CCCCCC"> from</font><font color="#E5E5E5"> the endpoint</font>

296
00:14:31,470 --> 00:14:35,639
<font color="#E5E5E5">so everything changes in the endpoint</font>

297
00:14:33,149 --> 00:14:37,670
<font color="#E5E5E5">endpoints</font><font color="#CCCCCC"> alert a lot of the good stuff</font>

298
00:14:35,639 --> 00:14:37,670
comes

299
00:14:41,340 --> 00:14:46,510
<font color="#E5E5E5">so if your man in the milling it yeah</font>

300
00:14:43,630 --> 00:14:47,920
you'd see the<font color="#CCCCCC"> tos kickoff and you</font>

301
00:14:46,510 --> 00:14:53,319
wouldn't see<font color="#E5E5E5"> an HTTP</font><font color="#CCCCCC"> request</font>

302
00:14:47,920 --> 00:14:55,839
so is that<font color="#CCCCCC"> bad no always only it's</font>

303
00:14:53,320 --> 00:14:58,780
<font color="#E5E5E5">always bad what if I go to http</font>

304
00:14:55,840 --> 00:15:00,970
google.com and<font color="#E5E5E5"> I just don't get a good</font>

305
00:14:58,780 --> 00:15:02,770
resolution<font color="#CCCCCC"> they're updating the website</font>

306
00:15:00,970 --> 00:15:04,720
<font color="#E5E5E5">and I just click the tab</font><font color="#CCCCCC"> closed or</font>

307
00:15:02,770 --> 00:15:06,490
<font color="#CCCCCC">something like</font><font color="#E5E5E5"> at what point</font><font color="#CCCCCC"> does the</font>

308
00:15:04,720 --> 00:15:08,980
request<font color="#E5E5E5"> actually go through and</font><font color="#CCCCCC"> not go</font>

309
00:15:06,490 --> 00:15:13,870
<font color="#E5E5E5">through you'd get some false</font><font color="#CCCCCC"> positives</font>

310
00:15:08,980 --> 00:15:16,300
there probably yeah for expo purposes

311
00:15:13,870 --> 00:15:20,560
it's kind of odd so you could use<font color="#E5E5E5"> it if</font>

312
00:15:16,300 --> 00:15:22,120
a<font color="#E5E5E5"> malicious guy</font><font color="#CCCCCC"> so if you had internal</font>

313
00:15:20,560 --> 00:15:24,219
stuff set up<font color="#E5E5E5"> and you were looking for</font>

314
00:15:22,120 --> 00:15:27,430
<font color="#CCCCCC">BOTS</font><font color="#E5E5E5"> talking to other BOTS internally</font>

315
00:15:24,220 --> 00:15:28,750
which not a<font color="#E5E5E5"> lot</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> people do there's</font>

316
00:15:27,430 --> 00:15:32,140
some security you could get<font color="#E5E5E5"> around with</font>

317
00:15:28,750 --> 00:15:35,290
<font color="#E5E5E5">by doing that it like from one bot to</font>

318
00:15:32,140 --> 00:15:36,280
<font color="#CCCCCC">the other blog as</font><font color="#E5E5E5"> well the</font><font color="#CCCCCC"> situation</font>

319
00:15:35,290 --> 00:15:38,079
that that would<font color="#E5E5E5"> arise there that would</font>

320
00:15:36,280 --> 00:15:39,339
be<font color="#CCCCCC"> a pretty</font><font color="#E5E5E5"> advanced actor and very</font>

321
00:15:38,080 --> 00:15:44,110
specific to<font color="#E5E5E5"> your network they've already</font>

322
00:15:39,340 --> 00:15:46,440
been<font color="#E5E5E5"> there for a while any other</font>

323
00:15:44,110 --> 00:15:46,440
questions

324
00:15:56,880 --> 00:16:27,960
[Music]

