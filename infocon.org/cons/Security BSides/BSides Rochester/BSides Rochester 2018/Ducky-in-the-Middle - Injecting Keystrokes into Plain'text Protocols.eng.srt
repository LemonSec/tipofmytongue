1
00:00:15,139 --> 00:00:20,609
<font color="#E5E5E5">all right</font><font color="#CCCCCC"> my name is</font><font color="#E5E5E5"> Esteban title of my</font>

2
00:00:19,020 --> 00:00:22,919
talk is<font color="#CCCCCC"> called ducky in the middle</font>

3
00:00:20,609 --> 00:00:25,740
injecting keystrokes<font color="#E5E5E5"> into</font><font color="#CCCCCC"> plain text</font>

4
00:00:22,920 --> 00:00:28,590
protocols<font color="#CCCCCC"> so I work as a penetration</font>

5
00:00:25,740 --> 00:00:31,799
tester<font color="#E5E5E5"> for a company called coal fire</font><font color="#CCCCCC"> we</font>

6
00:00:28,590 --> 00:00:34,309
do all<font color="#CCCCCC"> sorts of security</font><font color="#E5E5E5"> stuff</font><font color="#CCCCCC"> I blog</font>

7
00:00:31,800 --> 00:00:37,410
and do some<font color="#CCCCCC"> security research on my own</font>

8
00:00:34,309 --> 00:00:39,419
<font color="#CCCCCC">so basically what</font><font color="#E5E5E5"> this talk</font><font color="#CCCCCC"> is about</font><font color="#E5E5E5"> so</font>

9
00:00:37,410 --> 00:00:42,148
the title<font color="#E5E5E5"> itself is a reference</font><font color="#CCCCCC"> to the</font>

10
00:00:39,420 --> 00:00:45,090
USB rubber ducky<font color="#CCCCCC"> which is a pen test</font>

11
00:00:42,149 --> 00:00:46,680
tool that I'll show<font color="#CCCCCC"> in a video and the</font>

12
00:00:45,090 --> 00:00:50,219
<font color="#E5E5E5">whole focus is on exploiting</font>

13
00:00:46,680 --> 00:00:53,160
<font color="#E5E5E5">applications that can do two things so</font>

14
00:00:50,219 --> 00:00:55,289
they can<font color="#E5E5E5"> send keystrokes to</font><font color="#CCCCCC"> a machine as</font>

15
00:00:53,160 --> 00:00:56,940
part of<font color="#E5E5E5"> the protocol and also that they</font>

16
00:00:55,289 --> 00:00:59,969
aren't<font color="#CCCCCC"> protected with any sort of</font>

17
00:00:56,940 --> 00:01:02,129
<font color="#CCCCCC">encryption</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> this research began for</font>

18
00:00:59,969 --> 00:01:04,439
<font color="#CCCCCC">me just with curiosity of how some of</font>

19
00:01:02,129 --> 00:01:07,170
<font color="#E5E5E5">these applications worked so I wanted to</font>

20
00:01:04,438 --> 00:01:09,360
dig into them a little<font color="#CCCCCC"> bit</font><font color="#E5E5E5"> so if you've</font>

21
00:01:07,170 --> 00:01:12,750
<font color="#E5E5E5">never seen a USB rubber ducky</font><font color="#CCCCCC"> this is it</font>

22
00:01:09,360 --> 00:01:17,340
<font color="#E5E5E5">right here so you have I see use video</font>

23
00:01:12,750 --> 00:01:20,610
playing nope here we go<font color="#E5E5E5"> so it's a little</font>

24
00:01:17,340 --> 00:01:22,409
<font color="#E5E5E5">USB thing you plug it in it</font><font color="#CCCCCC"> emulates a</font>

25
00:01:20,610 --> 00:01:24,630
keyboard<font color="#E5E5E5"> and then you can just open the</font>

26
00:01:22,409 --> 00:01:28,049
command prompt<font color="#CCCCCC"> this right here</font><font color="#E5E5E5"> is a</font>

27
00:01:24,630 --> 00:01:29,970
<font color="#E5E5E5">Metasploit</font><font color="#CCCCCC"> web delivery payload</font><font color="#E5E5E5"> but you</font>

28
00:01:28,049 --> 00:01:33,780
could basically do<font color="#CCCCCC"> anything you can</font><font color="#E5E5E5"> but</font>

29
00:01:29,970 --> 00:01:35,548
<font color="#E5E5E5">you could do with keyboard so when it</font>

30
00:01:33,780 --> 00:01:37,979
comes to analyzing protocols you don't

31
00:01:35,549 --> 00:01:40,740
really<font color="#E5E5E5"> need a</font><font color="#CCCCCC"> lot of tools</font><font color="#E5E5E5"> to do this</font>

32
00:01:37,979 --> 00:01:43,079
you can pretty much use<font color="#E5E5E5"> Wireshark most</font>

33
00:01:40,740 --> 00:01:46,110
of the time and for my analysis I use

34
00:01:43,079 --> 00:01:47,610
mostly Wireshark<font color="#CCCCCC"> if you haven't used</font>

35
00:01:46,110 --> 00:01:50,579
Wireshark before it's a protocol

36
00:01:47,610 --> 00:01:52,470
analyzer<font color="#CCCCCC"> and you can do deep inspection</font>

37
00:01:50,579 --> 00:01:56,158
of a bunch of<font color="#CCCCCC"> different protocols it has</font>

38
00:01:52,470 --> 00:01:59,189
parsers<font color="#E5E5E5"> for all sorts of</font><font color="#CCCCCC"> things you can</font>

39
00:01:56,159 --> 00:02:00,840
capture and analyze live or<font color="#CCCCCC"> you can do</font>

40
00:01:59,189 --> 00:02:04,110
<font color="#E5E5E5">it from a</font><font color="#CCCCCC"> pcap or a packet capture</font>

41
00:02:00,840 --> 00:02:07,680
<font color="#E5E5E5">that's already saved a disk it runs on</font>

42
00:02:04,110 --> 00:02:10,860
Linux Windows Mac<font color="#E5E5E5"> you can do lots</font><font color="#CCCCCC"> of</font>

43
00:02:07,680 --> 00:02:12,180
<font color="#E5E5E5">filtering and it's totally free so if</font>

44
00:02:10,860 --> 00:02:13,590
<font color="#E5E5E5">you haven't seen Wireshark here it is</font>

45
00:02:12,180 --> 00:02:17,010
<font color="#E5E5E5">top you have the</font>

46
00:02:13,590 --> 00:02:18,630
it's middle you have the breakdown of

47
00:02:17,010 --> 00:02:22,019
the<font color="#CCCCCC"> different headers and</font><font color="#E5E5E5"> then you have</font>

48
00:02:18,630 --> 00:02:24,380
the raw bytes at the bottom so the first

49
00:02:22,020 --> 00:02:27,630
concept<font color="#CCCCCC"> that we need to understand is</font>

50
00:02:24,380 --> 00:02:30,780
TCP session hijacking<font color="#E5E5E5"> which is basically</font>

51
00:02:27,630 --> 00:02:33,840
taking<font color="#CCCCCC"> over an existing</font><font color="#E5E5E5"> TCP session and</font>

52
00:02:30,780 --> 00:02:35,970
in<font color="#E5E5E5"> order to do that to take</font><font color="#CCCCCC"> over a TCP</font>

53
00:02:33,840 --> 00:02:38,970
session you need<font color="#E5E5E5"> to know what the</font>

54
00:02:35,970 --> 00:02:42,150
<font color="#E5E5E5">sequence number</font><font color="#CCCCCC"> is and most</font><font color="#E5E5E5"> of the time</font>

55
00:02:38,970 --> 00:02:44,190
<font color="#E5E5E5">nowadays this is completely</font><font color="#CCCCCC"> random but a</font>

56
00:02:42,150 --> 00:02:46,500
long time<font color="#E5E5E5"> ago it wasn't and if you've</font>

57
00:02:44,190 --> 00:02:49,769
ever read<font color="#CCCCCC"> about the mid Nick attack</font>

58
00:02:46,500 --> 00:02:51,360
<font color="#E5E5E5">where he used TCP hijacking</font><font color="#CCCCCC"> to</font>

59
00:02:49,769 --> 00:02:52,830
compromise the<font color="#CCCCCC"> system of one of the</font>

60
00:02:51,360 --> 00:02:54,870
people<font color="#CCCCCC"> investigating him it's a really</font>

61
00:02:52,830 --> 00:02:57,780
<font color="#E5E5E5">good read and I would recommend checking</font>

62
00:02:54,870 --> 00:02:59,970
<font color="#E5E5E5">that out</font><font color="#CCCCCC"> but if it's not</font><font color="#E5E5E5"> possible</font><font color="#CCCCCC"> to</font>

63
00:02:57,780 --> 00:03:01,830
<font color="#CCCCCC">just guess the number you can still</font>

64
00:02:59,970 --> 00:03:04,349
sniff it if you have a man<font color="#E5E5E5"> in the middle</font>

65
00:03:01,830 --> 00:03:06,150
position<font color="#CCCCCC"> so there's a lot</font><font color="#E5E5E5"> of different</font>

66
00:03:04,349 --> 00:03:08,760
ways<font color="#CCCCCC"> that you</font><font color="#E5E5E5"> can get man in the middle</font>

67
00:03:06,150 --> 00:03:11,940
but ARP spoofing is probably the most

68
00:03:08,760 --> 00:03:20,310
simple<font color="#CCCCCC"> and common one I think I lost</font>

69
00:03:11,940 --> 00:03:22,200
<font color="#E5E5E5">video</font><font color="#CCCCCC"> okay so</font><font color="#E5E5E5"> TCP hijacking has been</font>

70
00:03:20,310 --> 00:03:25,620
<font color="#E5E5E5">around for a while</font><font color="#CCCCCC"> it's been around</font>

71
00:03:22,200 --> 00:03:27,839
basically<font color="#E5E5E5"> as</font><font color="#CCCCCC"> long as TCP has there's</font>

72
00:03:25,620 --> 00:03:31,260
some older tools that can<font color="#E5E5E5"> facilitate</font>

73
00:03:27,840 --> 00:03:34,950
this like Shai Jack and hunt or some of

74
00:03:31,260 --> 00:03:37,260
the ones I found and<font color="#E5E5E5"> TCP hijacking can't</font>

75
00:03:34,950 --> 00:03:39,780
really be prevented<font color="#CCCCCC"> if the attacker has</font>

76
00:03:37,260 --> 00:03:42,899
made in the<font color="#E5E5E5"> middle but you can stop the</font>

77
00:03:39,780 --> 00:03:45,269
impact from<font color="#E5E5E5"> it by encrypting the data</font>

78
00:03:42,900 --> 00:03:47,730
<font color="#E5E5E5">that's being communicated</font><font color="#CCCCCC"> or just you</font>

79
00:03:45,269 --> 00:03:50,910
<font color="#E5E5E5">know using a message digest or hashing</font>

80
00:03:47,730 --> 00:03:53,160
for integrity<font color="#E5E5E5"> checks</font><font color="#CCCCCC"> so right here</font>

81
00:03:50,910 --> 00:03:56,430
here's a demo it's kind<font color="#E5E5E5"> of busy but this</font>

82
00:03:53,160 --> 00:03:58,889
is a TCP hijacking attack<font color="#E5E5E5"> on the right I</font>

83
00:03:56,430 --> 00:04:01,470
have a<font color="#E5E5E5"> tow net client on the</font><font color="#CCCCCC"> Left I have</font>

84
00:03:58,889 --> 00:04:03,180
a<font color="#CCCCCC"> tonot server</font><font color="#E5E5E5"> in the middle I have Kali</font>

85
00:04:01,470 --> 00:04:06,510
Linux which is<font color="#E5E5E5"> the man in the middle</font>

86
00:04:03,180 --> 00:04:08,790
<font color="#CCCCCC">enter cap</font><font color="#E5E5E5"> running it on the top for the</font>

87
00:04:06,510 --> 00:04:12,149
ARP spoofing and at the<font color="#E5E5E5"> bottom is hunt</font>

88
00:04:08,790 --> 00:04:13,709
<font color="#E5E5E5">for the</font><font color="#CCCCCC"> TCP hijacking so all the actions</font>

89
00:04:12,150 --> 00:04:18,630
so<font color="#CCCCCC"> to speak happens down at the bottom</font>

90
00:04:13,709 --> 00:04:20,608
<font color="#E5E5E5">so</font><font color="#CCCCCC"> I have man in</font><font color="#E5E5E5"> the middle</font><font color="#CCCCCC"> and I'm kind</font>

91
00:04:18,630 --> 00:04:22,289
<font color="#CCCCCC">of messing around here</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> a second</font><font color="#E5E5E5"> but</font>

92
00:04:20,608 --> 00:04:23,909
<font color="#E5E5E5">you can't</font><font color="#CCCCCC"> read the text but it</font><font color="#E5E5E5"> will say</font>

93
00:04:22,289 --> 00:04:26,640
you've taken over<font color="#CCCCCC"> the</font><font color="#E5E5E5"> connection and</font>

94
00:04:23,909 --> 00:04:27,420
once I take over that<font color="#CCCCCC"> connection I'll be</font>

95
00:04:26,640 --> 00:04:31,469
able<font color="#E5E5E5"> to start</font>

96
00:04:27,420 --> 00:04:34,770
typing<font color="#CCCCCC"> into</font><font color="#E5E5E5"> the callee system and those</font>

97
00:04:31,470 --> 00:04:38,670
commands will then be<font color="#CCCCCC"> sent to the telnet</font>

98
00:04:34,770 --> 00:04:40,740
server<font color="#CCCCCC"> so I</font><font color="#E5E5E5"> basically jump in the middle</font>

99
00:04:38,670 --> 00:04:44,100
of this existing connection and then I

100
00:04:40,740 --> 00:04:45,780
can<font color="#E5E5E5"> start modifying files on the telnet</font>

101
00:04:44,100 --> 00:04:48,240
server so if you look all the<font color="#CCCCCC"> way to the</font>

102
00:04:45,780 --> 00:04:50,780
<font color="#E5E5E5">left in the temp directory and the file</font>

103
00:04:48,240 --> 00:04:53,760
explorer<font color="#CCCCCC"> I just created a temporary file</font>

104
00:04:50,780 --> 00:04:55,380
<font color="#CCCCCC">so and I did that just by jumping in the</font>

105
00:04:53,760 --> 00:04:59,280
<font color="#CCCCCC">middle of an existing connection without</font>

106
00:04:55,380 --> 00:05:01,950
breaking it<font color="#CCCCCC"> so TCP hijacking is pretty</font>

107
00:04:59,280 --> 00:05:03,450
cool<font color="#E5E5E5"> but when you're attacking</font><font color="#CCCCCC"> something</font>

108
00:05:01,950 --> 00:05:05,039
most<font color="#E5E5E5"> of the time you don't really need</font>

109
00:05:03,450 --> 00:05:08,159
<font color="#CCCCCC">to use this technique</font><font color="#E5E5E5"> because there's</font>

110
00:05:05,040 --> 00:05:10,410
easier techniques available<font color="#E5E5E5"> for example</font>

111
00:05:08,160 --> 00:05:12,600
like telnet<font color="#E5E5E5"> it's much easier just</font><font color="#CCCCCC"> to</font>

112
00:05:10,410 --> 00:05:14,940
sniff<font color="#E5E5E5"> out the telnet credentials but it</font>

113
00:05:12,600 --> 00:05:17,880
is to actually<font color="#CCCCCC"> perform a TCP hijack and</font>

114
00:05:14,940 --> 00:05:19,320
then<font color="#E5E5E5"> also you can get the real client</font>

115
00:05:17,880 --> 00:05:21,780
server out of<font color="#E5E5E5"> sync and they will break</font>

116
00:05:19,320 --> 00:05:23,460
their connection so all the protocols

117
00:05:21,780 --> 00:05:26,309
I'm going to talk<font color="#E5E5E5"> about from here on</font>

118
00:05:23,460 --> 00:05:28,770
they can be<font color="#CCCCCC"> TCP hijacked</font><font color="#E5E5E5"> but I'm going</font>

119
00:05:26,310 --> 00:05:32,280
to<font color="#E5E5E5"> attack them</font><font color="#CCCCCC"> in other ways other</font><font color="#E5E5E5"> than</font>

120
00:05:28,770 --> 00:05:34,260
TCP hijacking<font color="#CCCCCC"> so the first one is VNC</font>

121
00:05:32,280 --> 00:05:36,390
<font color="#CCCCCC">you've probably heard of</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> probably</font>

122
00:05:34,260 --> 00:05:39,150
<font color="#CCCCCC">used</font><font color="#E5E5E5"> it and you use it to remotely</font>

123
00:05:36,390 --> 00:05:41,520
control another computer<font color="#E5E5E5"> uses this</font>

124
00:05:39,150 --> 00:05:43,940
protocol called<font color="#CCCCCC"> rfb which</font><font color="#E5E5E5"> is pretty old</font>

125
00:05:41,520 --> 00:05:46,859
and doesn't<font color="#E5E5E5"> have any</font><font color="#CCCCCC"> encryption built in</font>

126
00:05:43,940 --> 00:05:49,620
the<font color="#CCCCCC"> author authentication scheme uses</font>

127
00:05:46,860 --> 00:05:52,230
<font color="#CCCCCC">DES which is a very old</font><font color="#E5E5E5"> and deprecated</font>

128
00:05:49,620 --> 00:05:53,670
cipher<font color="#CCCCCC"> and</font><font color="#E5E5E5"> also the passwords are</font>

129
00:05:52,230 --> 00:05:56,340
typically truncated to<font color="#CCCCCC"> eight characters</font>

130
00:05:53,670 --> 00:05:57,780
<font color="#CCCCCC">and what that means for us is</font><font color="#E5E5E5"> that if</font>

131
00:05:56,340 --> 00:06:00,570
<font color="#CCCCCC">you're brute-forcing this you will</font>

132
00:05:57,780 --> 00:06:02,130
pretty<font color="#E5E5E5"> much find any key regardless of</font>

133
00:06:00,570 --> 00:06:07,770
what it is<font color="#E5E5E5"> just because</font><font color="#CCCCCC"> the key space</font>

134
00:06:02,130 --> 00:06:09,210
and<font color="#E5E5E5"> cipher are very small so VNC that</font>

135
00:06:07,770 --> 00:06:11,880
when the server<font color="#E5E5E5"> is</font><font color="#CCCCCC"> running it has a</font>

136
00:06:09,210 --> 00:06:14,909
password<font color="#E5E5E5"> file</font><font color="#CCCCCC"> to connect to it</font><font color="#E5E5E5"> this</font>

137
00:06:11,880 --> 00:06:16,170
password<font color="#E5E5E5"> is</font><font color="#CCCCCC"> also encrypted</font><font color="#E5E5E5"> with DES</font><font color="#CCCCCC"> but</font>

138
00:06:14,910 --> 00:06:18,720
it doesn't<font color="#E5E5E5"> even matter that's encrypted</font>

139
00:06:16,170 --> 00:06:21,060
<font color="#E5E5E5">at all because</font><font color="#CCCCCC"> all of these VNC</font>

140
00:06:18,720 --> 00:06:23,370
passwords are encrypted with the<font color="#E5E5E5"> same</font>

141
00:06:21,060 --> 00:06:24,750
static key so if you just look in<font color="#E5E5E5"> the</font>

142
00:06:23,370 --> 00:06:27,510
<font color="#E5E5E5">source code and many of these VNC</font>

143
00:06:24,750 --> 00:06:29,130
clients you can get that static key and

144
00:06:27,510 --> 00:06:31,530
you can decrypt the password if you<font color="#E5E5E5"> can</font>

145
00:06:29,130 --> 00:06:35,750
<font color="#E5E5E5">access it either in the registry or on</font>

146
00:06:31,530 --> 00:06:38,609
the<font color="#E5E5E5"> file system so this is what a VNC</font>

147
00:06:35,750 --> 00:06:40,770
stream looks like on the wire<font color="#E5E5E5"> so this is</font>

148
00:06:38,610 --> 00:06:43,259
Wireshark<font color="#CCCCCC"> at the</font>

149
00:06:40,770 --> 00:06:45,210
<font color="#E5E5E5">you can see the protocol negotiation</font><font color="#CCCCCC"> the</font>

150
00:06:43,259 --> 00:06:47,400
server will<font color="#E5E5E5"> send a challenge</font><font color="#CCCCCC"> the client</font>

151
00:06:45,210 --> 00:06:50,039
will send a response<font color="#E5E5E5"> which is both based</font>

152
00:06:47,400 --> 00:06:52,378
off of<font color="#E5E5E5"> the password and then once the</font>

153
00:06:50,039 --> 00:06:54,900
connection starts<font color="#E5E5E5"> you can start sending</font>

154
00:06:52,379 --> 00:06:57,000
keystrokes or<font color="#E5E5E5"> mouse movements or screen</font>

155
00:06:54,900 --> 00:06:59,219
updates<font color="#CCCCCC"> so here I have some keystrokes</font>

156
00:06:57,000 --> 00:07:01,560
and you can very<font color="#CCCCCC"> easily</font><font color="#E5E5E5"> see it it says</font>

157
00:06:59,220 --> 00:07:03,659
<font color="#CCCCCC">test</font><font color="#E5E5E5"> and if you</font><font color="#CCCCCC"> look at the bytes</font>

158
00:07:01,560 --> 00:07:06,090
they're actually<font color="#CCCCCC"> just</font><font color="#E5E5E5"> regular old ASCII</font>

159
00:07:03,659 --> 00:07:07,979
<font color="#CCCCCC">so it's just from Wireshark you don't</font>

160
00:07:06,090 --> 00:07:11,940
have to do anything fancy<font color="#CCCCCC"> - sniff out</font>

161
00:07:07,979 --> 00:07:13,590
the keystrokes<font color="#CCCCCC"> so there's a couple other</font>

162
00:07:11,940 --> 00:07:15,389
<font color="#E5E5E5">tools if you don't want to use Wireshark</font>

163
00:07:13,590 --> 00:07:17,520
<font color="#CCCCCC">there's</font><font color="#E5E5E5"> this one called B and C key</font>

164
00:07:15,389 --> 00:07:19,380
<font color="#E5E5E5">logger</font><font color="#CCCCCC"> you can</font><font color="#E5E5E5"> just run it against</font><font color="#CCCCCC"> the</font>

165
00:07:17,520 --> 00:07:21,690
<font color="#CCCCCC">peach cap</font><font color="#E5E5E5"> and it will just extract all</font>

166
00:07:19,380 --> 00:07:26,699
the<font color="#E5E5E5"> keystrokes</font><font color="#CCCCCC"> there's another tool</font>

167
00:07:21,690 --> 00:07:28,440
<font color="#CCCCCC">called Foss</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> V&C</font><font color="#E5E5E5"> cracking</font><font color="#CCCCCC"> like I</font><font color="#E5E5E5"> said</font>

168
00:07:26,699 --> 00:07:30,330
<font color="#CCCCCC">before des an</font><font color="#E5E5E5"> egg</font><font color="#CCCCCC"> character so</font><font color="#E5E5E5"> you can</font>

169
00:07:28,440 --> 00:07:32,599
pretty much<font color="#E5E5E5"> always crack it there's a</font>

170
00:07:30,330 --> 00:07:35,370
tool called<font color="#E5E5E5"> VNC crack that's pretty fast</font>

171
00:07:32,599 --> 00:07:36,659
<font color="#CCCCCC">cain and abel can sniff and crack these</font>

172
00:07:35,370 --> 00:07:38,879
<font color="#CCCCCC">handshakes as well which is another</font>

173
00:07:36,659 --> 00:07:42,750
really<font color="#E5E5E5"> old tool that you can run on</font>

174
00:07:38,879 --> 00:07:44,699
<font color="#CCCCCC">Windows so once you are</font><font color="#E5E5E5"> able</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> crack</font>

175
00:07:42,750 --> 00:07:46,889
this handshake<font color="#CCCCCC"> you'll get the plaintext</font>

176
00:07:44,699 --> 00:07:50,280
password and then<font color="#CCCCCC"> you</font><font color="#E5E5E5"> can just connect</font>

177
00:07:46,889 --> 00:07:52,560
<font color="#CCCCCC">to VNC</font><font color="#E5E5E5"> and just control</font><font color="#CCCCCC"> the screen</font>

178
00:07:50,280 --> 00:07:53,818
remotely<font color="#E5E5E5"> but if you don't want to go and</font>

179
00:07:52,560 --> 00:07:56,219
<font color="#CCCCCC">start moving</font><font color="#E5E5E5"> the mouse around and</font>

180
00:07:53,819 --> 00:07:58,949
<font color="#E5E5E5">clicking on stuff you</font><font color="#CCCCCC"> can use Metasploit</font>

181
00:07:56,219 --> 00:08:01,349
to perform a tap and attack very similar

182
00:07:58,949 --> 00:08:02,729
to what a USB rubber ducky does it'll

183
00:08:01,349 --> 00:08:05,250
open<font color="#CCCCCC"> the command prompt and start</font>

184
00:08:02,729 --> 00:08:08,430
entering keystrokes<font color="#E5E5E5"> so</font><font color="#CCCCCC"> right here I have</font>

185
00:08:05,250 --> 00:08:11,159
on the left<font color="#CCCCCC"> a Windows 7 box</font><font color="#E5E5E5"> and on the</font>

186
00:08:08,430 --> 00:08:15,349
<font color="#E5E5E5">right Kali Linux running</font><font color="#CCCCCC"> Metasploit and</font>

187
00:08:11,159 --> 00:08:15,349
when I run this module you'll see<font color="#CCCCCC"> I</font>

188
00:08:15,440 --> 00:08:21,719
<font color="#E5E5E5">think it's going there we go so we run</font>

189
00:08:19,050 --> 00:08:24,060
it it opens the command prompt starts

190
00:08:21,719 --> 00:08:26,039
<font color="#E5E5E5">putting in text</font><font color="#CCCCCC"> superfast and then</font>

191
00:08:24,060 --> 00:08:28,469
you'll see a<font color="#E5E5E5"> meterpreter shell pop back</font>

192
00:08:26,039 --> 00:08:30,719
on<font color="#E5E5E5"> the kali linux box so probably about</font>

193
00:08:28,469 --> 00:08:34,679
<font color="#CCCCCC">2 seconds you can use that to pop a</font>

194
00:08:30,719 --> 00:08:37,020
shell<font color="#CCCCCC"> the next application i want to</font>

195
00:08:34,679 --> 00:08:38,909
talk<font color="#CCCCCC"> about is called hippo remote so</font>

196
00:08:37,020 --> 00:08:41,968
this is<font color="#E5E5E5"> something that</font><font color="#CCCCCC"> i came</font><font color="#E5E5E5"> across as</font>

197
00:08:38,909 --> 00:08:44,010
a Mac user and<font color="#E5E5E5"> it was a tool but you</font>

198
00:08:41,969 --> 00:08:47,520
could use your iPhone and<font color="#E5E5E5"> basically turn</font>

199
00:08:44,010 --> 00:08:50,399
it into a trackpad<font color="#CCCCCC"> or you could use</font><font color="#E5E5E5"> it</font>

200
00:08:47,520 --> 00:08:52,170
as<font color="#E5E5E5"> like an external keyboard as well it</font>

201
00:08:50,399 --> 00:08:54,420
<font color="#E5E5E5">also boasted features like being a</font>

202
00:08:52,170 --> 00:08:54,930
password manager<font color="#CCCCCC"> it was</font><font color="#E5E5E5"> really</font><font color="#CCCCCC"> popular</font>

203
00:08:54,420 --> 00:08:56,839
right<font color="#CCCCCC"> now</font>

204
00:08:54,930 --> 00:08:59,099
it looks like it's no<font color="#E5E5E5"> longer maintained</font>

205
00:08:56,840 --> 00:09:02,880
<font color="#CCCCCC">but there was like quite a</font><font color="#E5E5E5"> few downloads</font>

206
00:08:59,100 --> 00:09:04,110
<font color="#CCCCCC">when I downloaded it so here's a little</font>

207
00:09:02,880 --> 00:09:08,189
<font color="#E5E5E5">video of how it works I'm just gonna</font>

208
00:09:04,110 --> 00:09:11,100
skip<font color="#CCCCCC"> it for time</font><font color="#E5E5E5"> but so when it comes to</font>

209
00:09:08,190 --> 00:09:13,140
the implementation<font color="#E5E5E5"> on Windows you're</font>

210
00:09:11,100 --> 00:09:15,210
basically just using<font color="#E5E5E5"> a VNC client that's</font>

211
00:09:13,140 --> 00:09:17,580
forked off of<font color="#CCCCCC"> Ultra</font><font color="#E5E5E5"> B and C and if</font>

212
00:09:15,210 --> 00:09:19,560
you're using it<font color="#E5E5E5"> on Linux it's you just</font>

213
00:09:17,580 --> 00:09:21,750
use whatever<font color="#CCCCCC"> VNC</font><font color="#E5E5E5"> version you have on</font>

214
00:09:19,560 --> 00:09:23,550
Linux<font color="#E5E5E5"> but if you're using it on Mac it</font>

215
00:09:21,750 --> 00:09:25,440
has its own app that they developed

216
00:09:23,550 --> 00:09:28,410
called hippo<font color="#E5E5E5"> connect and that's what I'm</font>

217
00:09:25,440 --> 00:09:30,330
<font color="#E5E5E5">going to focus on so with hippo</font><font color="#CCCCCC"> connect</font>

218
00:09:28,410 --> 00:09:33,780
it has some problems<font color="#CCCCCC"> so for the password</font>

219
00:09:30,330 --> 00:09:36,210
<font color="#E5E5E5">storage</font><font color="#CCCCCC"> it stores it with inside a</font><font color="#E5E5E5"> P</font>

220
00:09:33,780 --> 00:09:40,470
<font color="#E5E5E5">list within the launch</font><font color="#CCCCCC"> naman or launch</font>

221
00:09:36,210 --> 00:09:43,470
agent so on Mac launch<font color="#CCCCCC"> Damons and launch</font>

222
00:09:40,470 --> 00:09:46,170
agents are what are used<font color="#E5E5E5"> to persistently</font>

223
00:09:43,470 --> 00:09:49,590
like run applications when you boot up

224
00:09:46,170 --> 00:09:51,810
or<font color="#CCCCCC"> log in and inside that</font><font color="#E5E5E5"> P list</font><font color="#CCCCCC"> the</font>

225
00:09:49,590 --> 00:09:54,060
password is there for the server<font color="#E5E5E5"> but</font>

226
00:09:51,810 --> 00:09:56,160
it's not encrypted<font color="#E5E5E5"> at all</font><font color="#CCCCCC"> and what's</font>

227
00:09:54,060 --> 00:09:58,650
worse about<font color="#CCCCCC"> it is those plist files are</font>

228
00:09:56,160 --> 00:10:00,510
completely world readable<font color="#E5E5E5"> so even if you</font>

229
00:09:58,650 --> 00:10:02,250
were to<font color="#E5E5E5"> log in</font><font color="#CCCCCC"> to a Mac with a guest</font>

230
00:10:00,510 --> 00:10:04,770
account<font color="#CCCCCC"> which should really</font><font color="#E5E5E5"> have no</font>

231
00:10:02,250 --> 00:10:06,930
permissions<font color="#E5E5E5"> you could go read this</font><font color="#CCCCCC"> plist</font>

232
00:10:04,770 --> 00:10:08,970
file get the password and then when

233
00:10:06,930 --> 00:10:10,170
<font color="#E5E5E5">someone else logged in you</font><font color="#CCCCCC"> can start</font>

234
00:10:08,970 --> 00:10:12,750
using you could start injecting

235
00:10:10,170 --> 00:10:15,180
keystrokes<font color="#E5E5E5"> and the program also runs as</font>

236
00:10:12,750 --> 00:10:17,640
<font color="#E5E5E5">root</font><font color="#CCCCCC"> which I didn't</font><font color="#E5E5E5"> find any like but</font>

237
00:10:15,180 --> 00:10:19,380
buffer overflow or anything but<font color="#E5E5E5"> that's</font>

238
00:10:17,640 --> 00:10:22,140
like a good candidate for some<font color="#E5E5E5"> privilege</font>

239
00:10:19,380 --> 00:10:25,140
escalation as well so here's<font color="#E5E5E5"> the P list</font>

240
00:10:22,140 --> 00:10:26,760
<font color="#CCCCCC">in red here there's the relevant portion</font>

241
00:10:25,140 --> 00:10:29,100
where<font color="#CCCCCC"> it shows the password so it's</font>

242
00:10:26,760 --> 00:10:30,990
<font color="#E5E5E5">super</font><font color="#CCCCCC"> easy</font><font color="#E5E5E5"> but if you can gain access</font>

243
00:10:29,100 --> 00:10:36,000
this file you can find that password<font color="#E5E5E5"> to</font>

244
00:10:30,990 --> 00:10:38,460
connect<font color="#CCCCCC"> so just like the protocol itself</font>

245
00:10:36,000 --> 00:10:41,430
is pretty<font color="#E5E5E5"> much like VNC uses the same</font>

246
00:10:38,460 --> 00:10:43,910
VNC<font color="#E5E5E5"> authentication scheme</font><font color="#CCCCCC"> you can</font><font color="#E5E5E5"> you</font>

247
00:10:41,430 --> 00:10:48,030
can send keystrokes and mouse movements

248
00:10:43,910 --> 00:10:50,310
<font color="#CCCCCC">so here's the Wireshark TCP stream</font><font color="#E5E5E5"> you</font>

249
00:10:48,030 --> 00:10:53,910
<font color="#E5E5E5">can see JSON here</font><font color="#CCCCCC"> this server</font>

250
00:10:50,310 --> 00:10:55,500
identifying itself handshake response

251
00:10:53,910 --> 00:10:59,010
and then the keystroke or mouse

252
00:10:55,500 --> 00:11:03,480
movements<font color="#E5E5E5"> so right here I created a tool</font>

253
00:10:59,010 --> 00:11:05,370
to exploit this protocol and the first

254
00:11:03,480 --> 00:11:07,590
part<font color="#E5E5E5"> I made was to just monitor</font><font color="#CCCCCC"> the</font>

255
00:11:05,370 --> 00:11:09,160
keystrokes<font color="#CCCCCC"> so if you have man in the</font>

256
00:11:07,590 --> 00:11:12,279
<font color="#E5E5E5">middle between</font>

257
00:11:09,160 --> 00:11:13,868
the iPhone<font color="#E5E5E5"> and the</font><font color="#CCCCCC"> system</font><font color="#E5E5E5"> you can start</font>

258
00:11:12,279 --> 00:11:15,790
sniffing out the keystrokes as they get

259
00:11:13,869 --> 00:11:19,180
<font color="#E5E5E5">sent so right here this tool is called</font>

260
00:11:15,790 --> 00:11:20,980
<font color="#E5E5E5">angry hippo</font><font color="#CCCCCC"> and we can see the</font><font color="#E5E5E5"> handshake</font>

261
00:11:19,180 --> 00:11:23,050
come across the screen and<font color="#E5E5E5"> then we'll</font>

262
00:11:20,980 --> 00:11:25,240
start<font color="#E5E5E5"> seeing the keystrokes being sent</font>

263
00:11:23,050 --> 00:11:30,969
<font color="#E5E5E5">once they start typing on the iPhone</font>

264
00:11:25,240 --> 00:11:32,619
keyboard<font color="#E5E5E5"> so the good part is cracking</font>

265
00:11:30,970 --> 00:11:34,899
handshakes because once you get<font color="#E5E5E5"> that</font>

266
00:11:32,619 --> 00:11:36,639
password<font color="#CCCCCC"> then you</font><font color="#E5E5E5"> can start</font><font color="#CCCCCC"> doing</font>

267
00:11:34,899 --> 00:11:40,449
whatever you want not<font color="#CCCCCC"> just sniffing out</font>

268
00:11:36,639 --> 00:11:44,040
what the person<font color="#CCCCCC"> is doing so we sniff and</font>

269
00:11:40,449 --> 00:11:47,170
we can get the challenge<font color="#E5E5E5"> and response</font>

270
00:11:44,040 --> 00:11:49,360
<font color="#E5E5E5">and then once you feed both of those two</font>

271
00:11:47,170 --> 00:11:52,420
angry hippo<font color="#E5E5E5"> with the crack option and</font>

272
00:11:49,360 --> 00:11:56,139
supply a word list<font color="#CCCCCC"> it can figure out the</font>

273
00:11:52,420 --> 00:11:58,509
<font color="#CCCCCC">plaintext password I ran this against</font>

274
00:11:56,139 --> 00:12:00,670
the rocky word list that<font color="#E5E5E5"> comes</font><font color="#CCCCCC"> built</font>

275
00:11:58,509 --> 00:12:02,740
<font color="#CCCCCC">into Kali and it</font><font color="#E5E5E5"> took me about five</font>

276
00:12:00,670 --> 00:12:05,410
minutes<font color="#E5E5E5"> to</font><font color="#CCCCCC"> get through the</font><font color="#E5E5E5"> entire word</font>

277
00:12:02,740 --> 00:12:07,300
list<font color="#CCCCCC"> and this</font><font color="#E5E5E5"> is just a single threaded</font>

278
00:12:05,410 --> 00:12:09,459
Python script so if you use<font color="#E5E5E5"> something</font>

279
00:12:07,300 --> 00:12:11,139
like VNC crack and just<font color="#E5E5E5"> fed these</font>

280
00:12:09,459 --> 00:12:13,809
handshakes in you<font color="#E5E5E5"> could probably crack</font>

281
00:12:11,139 --> 00:12:16,839
<font color="#E5E5E5">much faster with</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> so pretty much</font>

282
00:12:13,809 --> 00:12:19,149
always crackable so the fun part is once

283
00:12:16,839 --> 00:12:21,189
you crack<font color="#CCCCCC"> that handshake and then you</font>

284
00:12:19,149 --> 00:12:22,749
get<font color="#E5E5E5"> the password and at this point you</font>

285
00:12:21,189 --> 00:12:25,420
<font color="#E5E5E5">don't know you no longer need to have</font>

286
00:12:22,749 --> 00:12:29,290
<font color="#E5E5E5">that man in the middle position so I'll</font>

287
00:12:25,420 --> 00:12:31,628
use<font color="#E5E5E5"> angry hippo to start sending</font>

288
00:12:29,290 --> 00:12:33,879
keystrokes to<font color="#E5E5E5"> my Mac so on the right we</font>

289
00:12:31,629 --> 00:12:36,189
have Kali on the left the Mac and we're

290
00:12:33,879 --> 00:12:39,519
gonna start sending<font color="#E5E5E5"> keystrokes to the</font>

291
00:12:36,189 --> 00:12:44,498
system so we'll start up<font color="#E5E5E5"> a netcat</font>

292
00:12:39,519 --> 00:12:46,540
listener<font color="#E5E5E5"> we run angry hippo and then</font>

293
00:12:44,499 --> 00:12:48,730
real quick<font color="#CCCCCC"> you see a flash what just</font>

294
00:12:46,540 --> 00:12:50,439
<font color="#CCCCCC">happened</font><font color="#E5E5E5"> there was I</font><font color="#CCCCCC"> opened up spotlight</font>

295
00:12:48,730 --> 00:12:53,470
<font color="#E5E5E5">typed in the terminal</font><font color="#CCCCCC"> brought up the</font>

296
00:12:50,439 --> 00:12:56,349
terminal<font color="#E5E5E5"> put a one-liner for</font><font color="#CCCCCC"> a reverse</font>

297
00:12:53,470 --> 00:12:58,660
shell<font color="#CCCCCC"> then closed out of the</font><font color="#E5E5E5"> terminal so</font>

298
00:12:56,350 --> 00:12:59,980
it happens very fast so if someone were

299
00:12:58,660 --> 00:13:01,360
<font color="#CCCCCC">to fall victim of</font><font color="#E5E5E5"> this attack it's</font>

300
00:12:59,980 --> 00:13:03,730
likely that<font color="#CCCCCC"> they wouldn't even</font><font color="#E5E5E5"> notice</font>

301
00:13:01,360 --> 00:13:06,610
what happened<font color="#E5E5E5"> so here's a slowed</font><font color="#CCCCCC"> down</font>

302
00:13:03,730 --> 00:13:08,589
<font color="#CCCCCC">version of it and you can see once the</font>

303
00:13:06,610 --> 00:13:11,230
<font color="#CCCCCC">attack runs you'll see spotlight open</font>

304
00:13:08,589 --> 00:13:14,740
terminal being typed out and then you'll

305
00:13:11,230 --> 00:13:17,889
see a just<font color="#E5E5E5"> a regular one-liner for</font><font color="#CCCCCC"> a</font>

306
00:13:14,740 --> 00:13:19,839
reverse<font color="#CCCCCC"> shell typed in it will</font><font color="#E5E5E5"> back</font>

307
00:13:17,889 --> 00:13:22,799
<font color="#E5E5E5">around the process and then it closes</font>

308
00:13:19,839 --> 00:13:22,799
<font color="#CCCCCC">out the terminal window</font>

309
00:13:24,320 --> 00:13:30,890
so like<font color="#E5E5E5"> most things on Mac they use</font>

310
00:13:27,440 --> 00:13:33,260
Bonjour<font color="#CCCCCC"> which is</font><font color="#E5E5E5"> Apple's implementation</font>

311
00:13:30,890 --> 00:13:35,960
<font color="#E5E5E5">of the</font><font color="#CCCCCC"> zero config protocol</font><font color="#E5E5E5"> and it's</font>

312
00:13:33,260 --> 00:13:38,360
super useful for<font color="#CCCCCC"> all sorts of things but</font>

313
00:13:35,960 --> 00:13:40,880
<font color="#E5E5E5">especially for attackers</font><font color="#CCCCCC"> because it will</font>

314
00:13:38,360 --> 00:13:42,110
broadcast<font color="#CCCCCC"> out</font><font color="#E5E5E5"> whatever services are</font>

315
00:13:40,880 --> 00:13:43,730
running<font color="#E5E5E5"> on that system</font>

316
00:13:42,110 --> 00:13:46,339
so right here I'm<font color="#E5E5E5"> using an application</font>

317
00:13:43,730 --> 00:13:48,350
<font color="#CCCCCC">called bonjour browser</font><font color="#E5E5E5"> and I can see</font>

318
00:13:46,339 --> 00:13:53,630
that hippo remote is running and I<font color="#E5E5E5"> can</font>

319
00:13:48,350 --> 00:13:55,250
see the<font color="#CCCCCC"> hostname the IP and the port so</font>

320
00:13:53,630 --> 00:13:58,070
if you're worried about<font color="#E5E5E5"> this happening</font>

321
00:13:55,250 --> 00:13:59,570
to you if you<font color="#E5E5E5"> use hippo remote you know</font>

322
00:13:58,070 --> 00:14:02,839
you probably<font color="#CCCCCC"> don't want to</font><font color="#E5E5E5"> use the the</font>

323
00:13:59,570 --> 00:14:05,350
<font color="#E5E5E5">VNC option or the hippo remote app just</font>

324
00:14:02,839 --> 00:14:09,410
because they're all<font color="#CCCCCC"> vulnerable to this</font>

325
00:14:05,350 --> 00:14:11,120
<font color="#CCCCCC">the screen</font><font color="#E5E5E5"> sharing functionality in Mac</font>

326
00:14:09,410 --> 00:14:14,000
OS is a little bit better<font color="#E5E5E5"> because</font>

327
00:14:11,120 --> 00:14:14,959
<font color="#E5E5E5">everything is encrypted</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> you usually</font>

328
00:14:14,000 --> 00:14:18,020
don't<font color="#E5E5E5"> have</font><font color="#CCCCCC"> to worry about</font><font color="#E5E5E5"> this now</font>

329
00:14:14,959 --> 00:14:20,180
<font color="#CCCCCC">because that</font><font color="#E5E5E5"> hippo app isn't really</font>

330
00:14:18,020 --> 00:14:23,089
maintained<font color="#CCCCCC"> anymore so it's probably just</font>

331
00:14:20,180 --> 00:14:24,739
time to<font color="#E5E5E5"> stop using it if you did so the</font>

332
00:14:23,089 --> 00:14:26,839
last application<font color="#CCCCCC"> I want</font><font color="#E5E5E5"> to talk about</font>

333
00:14:24,740 --> 00:14:29,870
with synergy so synergy is a bit more

334
00:14:26,839 --> 00:14:32,570
<font color="#E5E5E5">popular and the way it works is it's a</font>

335
00:14:29,870 --> 00:14:35,390
mouse and<font color="#E5E5E5"> keyboard</font><font color="#CCCCCC"> sharing software</font><font color="#E5E5E5"> so</font>

336
00:14:32,570 --> 00:14:37,700
if you had say a Linux<font color="#E5E5E5"> box a Windows box</font>

337
00:14:35,390 --> 00:14:39,439
and a Mac system you could use the same

338
00:14:37,700 --> 00:14:41,690
mouse and keyboard to kind of pan across

339
00:14:39,440 --> 00:14:45,370
all of<font color="#E5E5E5"> your different screens seamlessly</font>

340
00:14:41,690 --> 00:14:48,440
<font color="#E5E5E5">so it's</font><font color="#CCCCCC"> actually</font><font color="#E5E5E5"> really good</font><font color="#CCCCCC"> software</font>

341
00:14:45,370 --> 00:14:50,390
<font color="#E5E5E5">when I got it there was two versions</font>

342
00:14:48,440 --> 00:14:52,459
there was a basic<font color="#CCCCCC"> edition in a Pro</font>

343
00:14:50,390 --> 00:14:54,949
<font color="#CCCCCC">Edition and what you got when you</font>

344
00:14:52,459 --> 00:14:57,859
<font color="#E5E5E5">upgraded to pro was you got</font><font color="#CCCCCC"> SSL</font>

345
00:14:54,950 --> 00:14:59,779
encryption<font color="#CCCCCC"> but</font><font color="#E5E5E5"> the basic didn't have any</font>

346
00:14:57,860 --> 00:15:02,510
encryption<font color="#E5E5E5"> at all so that's what I</font>

347
00:14:59,779 --> 00:15:05,779
focused on<font color="#E5E5E5"> since I've done my research</font>

348
00:15:02,510 --> 00:15:09,079
on this<font color="#CCCCCC"> and released the tool</font><font color="#E5E5E5"> synergy</font>

349
00:15:05,779 --> 00:15:10,970
now a synergy<font color="#CCCCCC"> two with two versions</font><font color="#E5E5E5"> that</font>

350
00:15:09,079 --> 00:15:14,660
are both encrypted<font color="#E5E5E5"> so I don't know if</font>

351
00:15:10,970 --> 00:15:16,400
they knew about<font color="#E5E5E5"> my exploit</font><font color="#CCCCCC"> but now if</font>

352
00:15:14,660 --> 00:15:18,490
<font color="#CCCCCC">you download the</font><font color="#E5E5E5"> latest version</font><font color="#CCCCCC"> of</font>

353
00:15:16,400 --> 00:15:20,720
synergy it'll be<font color="#E5E5E5"> encrypted either way</font>

354
00:15:18,490 --> 00:15:22,130
<font color="#CCCCCC">that's just kind of a breakdown</font><font color="#E5E5E5"> of some</font>

355
00:15:20,720 --> 00:15:25,670
of the<font color="#E5E5E5"> changes between the two</font><font color="#CCCCCC"> versions</font>

356
00:15:22,130 --> 00:15:28,610
I'll skip<font color="#E5E5E5"> that video so monitoring</font>

357
00:15:25,670 --> 00:15:31,550
keystrokes very similar to the others<font color="#CCCCCC"> if</font>

358
00:15:28,610 --> 00:15:34,700
you've ever used scape<font color="#E5E5E5"> II within</font><font color="#CCCCCC"> Python</font>

359
00:15:31,550 --> 00:15:37,010
it's super<font color="#E5E5E5"> easy</font><font color="#CCCCCC"> for packet monitoring</font>

360
00:15:34,700 --> 00:15:39,590
manipulation<font color="#E5E5E5"> so here with just</font><font color="#CCCCCC"> nine</font>

361
00:15:37,010 --> 00:15:41,930
lines<font color="#E5E5E5"> if</font><font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> man-in-the-middle</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> can</font>

362
00:15:39,590 --> 00:15:43,990
sniff out<font color="#CCCCCC"> all the</font><font color="#E5E5E5"> keystrokes that</font><font color="#CCCCCC"> are</font>

363
00:15:41,930 --> 00:15:46,760
sent with<font color="#E5E5E5"> synergy</font>

364
00:15:43,990 --> 00:15:48,350
so with hijacking it's a little bit

365
00:15:46,760 --> 00:15:51,140
different than the other ones the other

366
00:15:48,350 --> 00:15:53,600
<font color="#E5E5E5">ones I used a man I'm in the middle</font>

367
00:15:51,140 --> 00:15:55,880
attack<font color="#E5E5E5"> to capture the handshake and then</font>

368
00:15:53,600 --> 00:15:59,510
crack it<font color="#CCCCCC"> but synergy doesn't use</font>

369
00:15:55,880 --> 00:16:02,720
passwords<font color="#E5E5E5"> it what it</font><font color="#CCCCCC"> does is the client</font>

370
00:15:59,510 --> 00:16:05,720
will actually configure what server they

371
00:16:02,720 --> 00:16:08,060
want to talk<font color="#E5E5E5"> to and that's the only real</font>

372
00:16:05,720 --> 00:16:09,860
form of authentication<font color="#CCCCCC"> and the client</font>

373
00:16:08,060 --> 00:16:11,900
will initiate the<font color="#E5E5E5"> communication first</font>

374
00:16:09,860 --> 00:16:15,140
with the server<font color="#CCCCCC"> but the server will be</font>

375
00:16:11,900 --> 00:16:17,120
the one<font color="#E5E5E5"> sending the commands</font><font color="#CCCCCC"> so they</font>

376
00:16:15,140 --> 00:16:19,970
have<font color="#E5E5E5"> this functionality built in call it</font>

377
00:16:17,120 --> 00:16:22,370
<font color="#E5E5E5">Auto config which uses</font><font color="#CCCCCC"> Bonjour to</font>

378
00:16:19,970 --> 00:16:25,100
basically<font color="#E5E5E5"> go out and find a synergy</font>

379
00:16:22,370 --> 00:16:26,930
server<font color="#CCCCCC"> so if you're on</font><font color="#E5E5E5"> the network and</font>

380
00:16:25,100 --> 00:16:29,750
<font color="#E5E5E5">you</font><font color="#CCCCCC"> have a</font><font color="#E5E5E5"> malicious server running</font>

381
00:16:26,930 --> 00:16:31,640
it'll<font color="#E5E5E5"> just identify that as a synergy</font>

382
00:16:29,750 --> 00:16:33,650
server and automatically connect to<font color="#E5E5E5"> it</font>

383
00:16:31,640 --> 00:16:37,189
<font color="#E5E5E5">so here we're gonna do is we have the</font>

384
00:16:33,650 --> 00:16:39,530
client on the left<font color="#CCCCCC"> the malicious server</font>

385
00:16:37,190 --> 00:16:41,480
<font color="#E5E5E5">in the middle and then</font><font color="#CCCCCC"> PowerShell Empire</font>

386
00:16:39,530 --> 00:16:44,120
running on the right to catch the shell

387
00:16:41,480 --> 00:16:46,400
that we're gonna pop so right here we

388
00:16:44,120 --> 00:16:49,100
got Empire running<font color="#E5E5E5"> we run the tool it's</font>

389
00:16:46,400 --> 00:16:51,470
called dissonance<font color="#CCCCCC"> it starts up the</font><font color="#E5E5E5"> rogue</font>

390
00:16:49,100 --> 00:16:54,470
<font color="#E5E5E5">synergy server the client clicks</font><font color="#CCCCCC"> Auto</font>

391
00:16:51,470 --> 00:16:56,090
<font color="#E5E5E5">config it'll quickly find the server I</font>

392
00:16:54,470 --> 00:16:57,890
<font color="#CCCCCC">have running</font><font color="#E5E5E5"> and then it would</font><font color="#CCCCCC"> just</font>

393
00:16:56,090 --> 00:17:00,260
start accepting keystroke commands so

394
00:16:57,890 --> 00:17:03,740
right here command prompt<font color="#CCCCCC"> I start</font><font color="#E5E5E5"> typing</font>

395
00:17:00,260 --> 00:17:06,800
characters this<font color="#CCCCCC"> is a one-liner to pop</font>

396
00:17:03,740 --> 00:17:11,589
<font color="#E5E5E5">reverse</font><font color="#CCCCCC"> shell in PowerShell</font><font color="#E5E5E5"> so we'll see</font>

397
00:17:06,800 --> 00:17:14,180
the agent<font color="#E5E5E5"> callback on the right there so</font>

398
00:17:11,589 --> 00:17:15,560
there's another way to do<font color="#E5E5E5"> it too so more</font>

399
00:17:14,180 --> 00:17:18,560
<font color="#E5E5E5">likely than not if you actually</font>

400
00:17:15,560 --> 00:17:21,050
<font color="#E5E5E5">encounter synergy</font><font color="#CCCCCC"> on a network</font><font color="#E5E5E5"> it'll</font>

401
00:17:18,560 --> 00:17:23,690
already be associated<font color="#E5E5E5"> a client will</font>

402
00:17:21,050 --> 00:17:25,970
already be associated<font color="#E5E5E5"> with</font><font color="#CCCCCC"> the server</font><font color="#E5E5E5"> so</font>

403
00:17:23,690 --> 00:17:29,270
for attacking<font color="#E5E5E5"> we want to basically jump</font>

404
00:17:25,970 --> 00:17:32,120
in the<font color="#E5E5E5"> middle of that connection</font><font color="#CCCCCC"> so what</font>

405
00:17:29,270 --> 00:17:35,540
we can do is we can assume the IP of the

406
00:17:32,120 --> 00:17:38,929
<font color="#CCCCCC">real server we can</font><font color="#E5E5E5"> ARP spoof</font><font color="#CCCCCC"> the client</font>

407
00:17:35,540 --> 00:17:41,149
into banking the bad IRP now goes to<font color="#CCCCCC"> us</font>

408
00:17:38,930 --> 00:17:43,730
<font color="#E5E5E5">and then whenever a connection and</font>

409
00:17:41,150 --> 00:17:45,830
synergy breaks it'll automatically try

410
00:17:43,730 --> 00:17:47,690
to re-establish that connection<font color="#CCCCCC"> so once</font>

411
00:17:45,830 --> 00:17:48,559
the connection breaks<font color="#E5E5E5"> it'll connect back</font>

412
00:17:47,690 --> 00:17:50,840
to<font color="#CCCCCC"> my</font>

413
00:17:48,559 --> 00:17:53,600
malicious server<font color="#E5E5E5"> because that's how it's</font>

414
00:17:50,840 --> 00:17:55,820
<font color="#CCCCCC">designed to work so</font><font color="#E5E5E5"> right here we have</font>

415
00:17:53,600 --> 00:17:58,699
<font color="#E5E5E5">the client again</font><font color="#CCCCCC"> we have the real server</font>

416
00:17:55,820 --> 00:18:00,799
that has an active<font color="#E5E5E5"> connection and on the</font>

417
00:17:58,700 --> 00:18:02,960
right we have<font color="#E5E5E5"> the rogue server and the</font>

418
00:18:00,799 --> 00:18:05,480
<font color="#CCCCCC">command/ctrl</font><font color="#E5E5E5"> server which is</font><font color="#CCCCCC"> PowerShell</font>

419
00:18:02,960 --> 00:18:09,169
<font color="#CCCCCC">Empire again so you can't really</font><font color="#E5E5E5"> read</font>

420
00:18:05,480 --> 00:18:10,159
the messages but you'll see<font color="#CCCCCC"> all first</font>

421
00:18:09,169 --> 00:18:12,470
all sniff

422
00:18:10,159 --> 00:18:15,110
<font color="#E5E5E5">Bonjour traffic to find out where the</font>

423
00:18:12,470 --> 00:18:18,019
server is<font color="#E5E5E5"> what its IP is and it also</font>

424
00:18:15,110 --> 00:18:20,120
sniff out where the client is so I'll

425
00:18:18,019 --> 00:18:22,610
have the IP address of<font color="#E5E5E5"> both of those so</font>

426
00:18:20,120 --> 00:18:24,498
I know who to spoof so on the right I'm

427
00:18:22,610 --> 00:18:29,059
<font color="#E5E5E5">just selecting</font><font color="#CCCCCC"> the IP addresses that I</font>

428
00:18:24,499 --> 00:18:32,269
found by<font color="#E5E5E5"> using Bonjour</font><font color="#CCCCCC"> this is if config</font>

429
00:18:29,059 --> 00:18:35,869
I assume the IP of<font color="#CCCCCC"> the real synergy</font>

430
00:18:32,269 --> 00:18:37,820
server<font color="#E5E5E5"> then I run an ARP spoof against</font>

431
00:18:35,869 --> 00:18:40,820
the<font color="#E5E5E5"> client to convince it</font><font color="#CCCCCC"> that I'm the</font>

432
00:18:37,820 --> 00:18:42,889
server and then I will run<font color="#E5E5E5"> the</font>

433
00:18:40,820 --> 00:18:45,019
dissonance tool with the payload of my

434
00:18:42,889 --> 00:18:47,360
choosing<font color="#CCCCCC"> so right now the connection is</font>

435
00:18:45,019 --> 00:18:49,759
<font color="#E5E5E5">broken between the two but as soon as I</font>

436
00:18:47,360 --> 00:18:53,559
start this server up it'll automatically

437
00:18:49,759 --> 00:18:56,539
connect and start accepting keystrokes

438
00:18:53,559 --> 00:18:58,668
and again command prompt<font color="#E5E5E5"> just start</font>

439
00:18:56,539 --> 00:19:04,730
spraying keystrokes<font color="#E5E5E5"> and then it pops a</font>

440
00:18:58,669 --> 00:19:07,159
reverse<font color="#CCCCCC"> shell</font><font color="#E5E5E5"> with PowerShell</font><font color="#CCCCCC"> Empire so</font>

441
00:19:04,730 --> 00:19:09,559
if you like synergy<font color="#E5E5E5"> because I do like it</font>

442
00:19:07,159 --> 00:19:11,809
<font color="#CCCCCC">I would</font><font color="#E5E5E5"> recommend if you're using</font>

443
00:19:09,559 --> 00:19:15,049
synergy one basic you should upgrade to

444
00:19:11,809 --> 00:19:19,850
pro or use synergy<font color="#CCCCCC"> 2 or if you're going</font>

445
00:19:15,049 --> 00:19:21,619
<font color="#E5E5E5">you know across you know networks and</font>

446
00:19:19,850 --> 00:19:25,189
you want to use you know the<font color="#E5E5E5"> basic one</font>

447
00:19:21,619 --> 00:19:28,939
<font color="#CCCCCC">you can just tunnel these over SSH</font><font color="#E5E5E5"> as</font>

448
00:19:25,190 --> 00:19:30,980
well<font color="#E5E5E5"> yeah but when you use the the pro</font>

449
00:19:28,940 --> 00:19:33,019
version<font color="#CCCCCC"> everything is</font><font color="#E5E5E5"> as so encrypted</font>

450
00:19:30,980 --> 00:19:34,460
and if for<font color="#CCCCCC"> some reason</font><font color="#E5E5E5"> some one man in</font>

451
00:19:33,019 --> 00:19:35,119
the<font color="#CCCCCC"> middle is you and puts up a rogue</font>

452
00:19:34,460 --> 00:19:37,429
server

453
00:19:35,119 --> 00:19:39,199
you know notify you that<font color="#E5E5E5"> the fingerprint</font>

454
00:19:37,429 --> 00:19:42,499
of<font color="#CCCCCC"> the server</font><font color="#E5E5E5"> has changed and</font><font color="#CCCCCC"> you have</font>

455
00:19:39,200 --> 00:19:44,809
to accept<font color="#E5E5E5"> that so if you did go and like</font>

456
00:19:42,499 --> 00:19:48,080
click yes to<font color="#E5E5E5"> this warning</font><font color="#CCCCCC"> you could</font>

457
00:19:44,809 --> 00:19:49,369
still get owned<font color="#E5E5E5"> but if if you know what</font>

458
00:19:48,080 --> 00:19:51,289
you're doing<font color="#E5E5E5"> for the most part this</font>

459
00:19:49,369 --> 00:19:54,100
should give you you<font color="#E5E5E5"> know some notice</font>

460
00:19:51,289 --> 00:19:57,529
that you're<font color="#E5E5E5"> being attacked</font>

461
00:19:54,100 --> 00:19:59,689
so in conclusion just unencrypted

462
00:19:57,529 --> 00:20:02,060
protocol is just<font color="#E5E5E5"> aren't good don't use</font>

463
00:19:59,690 --> 00:20:04,130
them at all<font color="#CCCCCC"> and don't be</font>

464
00:20:02,060 --> 00:20:05,720
afraid<font color="#E5E5E5"> to do your own research either</font><font color="#CCCCCC"> so</font>

465
00:20:04,130 --> 00:20:08,420
this<font color="#CCCCCC"> was just kind of a side project I</font>

466
00:20:05,720 --> 00:20:10,760
had in my free time<font color="#CCCCCC"> I didn't take too</font>

467
00:20:08,420 --> 00:20:12,560
long do<font color="#E5E5E5"> so if you're interested in just</font>

468
00:20:10,760 --> 00:20:13,090
<font color="#E5E5E5">like picking</font><font color="#CCCCCC"> things apart</font><font color="#E5E5E5"> I would say go</font>

469
00:20:12,560 --> 00:20:16,429
for<font color="#E5E5E5"> it</font>

470
00:20:13,090 --> 00:20:19,100
<font color="#CCCCCC">all the tools</font><font color="#E5E5E5"> that I mentioned</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> rogue</font>

471
00:20:16,430 --> 00:20:21,800
<font color="#E5E5E5">synergy server is there on my github as</font>

472
00:20:19,100 --> 00:20:24,320
<font color="#E5E5E5">well as angry hippo</font><font color="#CCCCCC"> both of these are</font>

473
00:20:21,800 --> 00:20:26,149
<font color="#E5E5E5">written in Python not a developer not</font>

474
00:20:24,320 --> 00:20:28,129
really much<font color="#CCCCCC"> of a programmer</font><font color="#E5E5E5"> but Python</font>

475
00:20:26,150 --> 00:20:31,010
<font color="#E5E5E5">super easy to use</font><font color="#CCCCCC"> so if you hadn't</font>

476
00:20:28,130 --> 00:20:33,170
gotten into<font color="#E5E5E5"> any programming yet I would</font>

477
00:20:31,010 --> 00:20:33,830
say jump into that<font color="#E5E5E5"> and have some fun</font>

478
00:20:33,170 --> 00:20:36,590
<font color="#E5E5E5">with it</font>

479
00:20:33,830 --> 00:20:38,840
down on the<font color="#CCCCCC"> right is my blog I</font><font color="#E5E5E5"> talk</font>

480
00:20:36,590 --> 00:20:40,820
<font color="#E5E5E5">about a lot</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> topics related</font><font color="#CCCCCC"> to pen</font>

481
00:20:38,840 --> 00:20:45,320
testing and<font color="#E5E5E5"> just kind of security</font>

482
00:20:40,820 --> 00:21:03,889
research that I do and that's it so does

483
00:20:45,320 --> 00:21:05,450
anybody<font color="#E5E5E5"> have any</font><font color="#CCCCCC"> questions you</font><font color="#E5E5E5"> know yeah</font>

484
00:21:03,890 --> 00:21:07,130
someone<font color="#E5E5E5"> brought that up to me the other</font>

485
00:21:05,450 --> 00:21:08,510
<font color="#E5E5E5">day they're like and I hadn't heard of</font>

486
00:21:07,130 --> 00:21:10,820
Mouse Without Borders

487
00:21:08,510 --> 00:21:12,610
I wanted to<font color="#CCCCCC"> analyze it</font><font color="#E5E5E5"> and maybe</font><font color="#CCCCCC"> sneak</font>

488
00:21:10,820 --> 00:21:14,629
<font color="#E5E5E5">into this talk but I didn't have time</font>

489
00:21:12,610 --> 00:21:17,479
<font color="#E5E5E5">but yeah that's something I wanted to</font>

490
00:21:14,630 --> 00:21:22,610
<font color="#E5E5E5">look into yeah very similar type of</font>

491
00:21:17,480 --> 00:21:25,430
<font color="#E5E5E5">software</font><font color="#CCCCCC"> I know I went through</font><font color="#E5E5E5"> a lot of</font>

492
00:21:22,610 --> 00:21:28,070
stuff kind of fast<font color="#E5E5E5"> so if yeah if you</font>

493
00:21:25,430 --> 00:21:29,420
have any<font color="#E5E5E5"> questions let me</font><font color="#CCCCCC"> know or talk</font>

494
00:21:28,070 --> 00:21:32,030
<font color="#CCCCCC">to</font><font color="#E5E5E5"> me after if you don't want to ask it</font>

495
00:21:29,420 --> 00:21:37,070
publicly<font color="#E5E5E5"> or just want to you know talk</font>

496
00:21:32,030 --> 00:21:37,940
<font color="#CCCCCC">about</font><font color="#E5E5E5"> anything cool I guess that's it</font>

497
00:21:37,070 --> 00:21:45,269
<font color="#CCCCCC">Thanks</font>

498
00:21:37,940 --> 00:21:45,269
[Applause]

