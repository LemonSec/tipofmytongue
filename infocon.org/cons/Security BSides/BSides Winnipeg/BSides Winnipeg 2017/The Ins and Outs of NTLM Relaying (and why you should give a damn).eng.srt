1
00:00:04,819 --> 00:00:10,950
hello hello thank<font color="#E5E5E5"> you so much for having</font>

2
00:00:08,099 --> 00:00:12,900
me<font color="#CCCCCC"> here at goose is giving a</font><font color="#E5E5E5"> talk this</font>

3
00:00:10,950 --> 00:00:14,940
<font color="#E5E5E5">is my very</font><font color="#CCCCCC"> first</font><font color="#E5E5E5"> time giving</font><font color="#CCCCCC"> a</font>

4
00:00:12,900 --> 00:00:17,279
presentation<font color="#E5E5E5"> at a security</font><font color="#CCCCCC"> conference so</font>

5
00:00:14,940 --> 00:00:20,279
please be gentle<font color="#E5E5E5"> and I will try not to</font>

6
00:00:17,279 --> 00:00:22,109
bore you<font color="#CCCCCC"> today the sharp-eyed among you</font>

7
00:00:20,279 --> 00:00:24,869
might notice that<font color="#E5E5E5"> my windows isn't</font>

8
00:00:22,109 --> 00:00:27,539
activated<font color="#CCCCCC"> I have a good reason for that</font>

9
00:00:24,869 --> 00:00:29,970
my laptop was<font color="#E5E5E5"> acting pretty weird</font><font color="#CCCCCC"> the</font>

10
00:00:27,539 --> 00:00:31,230
<font color="#E5E5E5">last couple of days</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> because you know</font>

11
00:00:29,970 --> 00:00:32,910
<font color="#E5E5E5">after spending a couple years InfoSec</font>

12
00:00:31,230 --> 00:00:35,910
I'm so paranoid<font color="#E5E5E5"> I completely</font>

13
00:00:32,910 --> 00:00:37,110
<font color="#E5E5E5">wiped windows and reinstalled it so I</font>

14
00:00:35,910 --> 00:00:39,148
<font color="#E5E5E5">haven't got around to activating it I</font>

15
00:00:37,110 --> 00:00:45,510
<font color="#E5E5E5">swear I have the licenses everything's</font>

16
00:00:39,149 --> 00:00:49,230
legit yeah nobody cares<font color="#CCCCCC"> through</font><font color="#E5E5E5"> that so</font>

17
00:00:45,510 --> 00:00:50,670
quick talk about me<font color="#CCCCCC"> apparently I'm the</font>

18
00:00:49,230 --> 00:00:53,010
<font color="#E5E5E5">sort of guy who forgets to</font><font color="#CCCCCC"> put his name</font>

19
00:00:50,670 --> 00:00:55,710
<font color="#CCCCCC">on his intro slide but I am Travis</font>

20
00:00:53,010 --> 00:00:58,559
<font color="#CCCCCC">Friesen</font><font color="#E5E5E5"> I swear and for my</font><font color="#CCCCCC"> regular day</font>

21
00:00:55,710 --> 00:01:00,780
job<font color="#E5E5E5"> I do IT security for a company</font>

22
00:00:58,559 --> 00:01:04,080
<font color="#CCCCCC">called Merlin Merlin which aside from</font>

23
00:01:00,780 --> 00:01:05,460
<font color="#E5E5E5">having</font><font color="#CCCCCC"> an awesome</font><font color="#E5E5E5"> name is the is a part</font>

24
00:01:04,080 --> 00:01:08,000
of the provincial government<font color="#CCCCCC"> it's a</font>

25
00:01:05,459 --> 00:01:10,530
special operating agency who provides

26
00:01:08,000 --> 00:01:14,189
internet and Internet related services

27
00:01:10,530 --> 00:01:16,080
<font color="#CCCCCC">for education in Manitoba pretty much</font>

28
00:01:14,189 --> 00:01:18,029
all<font color="#CCCCCC"> of the schools in Manitoba get the</font>

29
00:01:16,080 --> 00:01:20,189
<font color="#E5E5E5">internet through us</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> some</font><font color="#CCCCCC"> form or</font>

30
00:01:18,030 --> 00:01:23,490
another<font color="#E5E5E5"> we also provide a</font><font color="#CCCCCC"> lot of hosted</font>

31
00:01:20,189 --> 00:01:23,880
services consulting services<font color="#CCCCCC"> pretty</font><font color="#E5E5E5"> much</font>

32
00:01:23,490 --> 00:01:25,580
anything

33
00:01:23,880 --> 00:01:28,530
anything<font color="#E5E5E5"> related you can think of that</font>

34
00:01:25,580 --> 00:01:31,439
in<font color="#CCCCCC"> that capacity I wear pretty</font><font color="#E5E5E5"> much</font>

35
00:01:28,530 --> 00:01:34,950
every single<font color="#E5E5E5"> InfoSec hat imaginable I do</font>

36
00:01:31,439 --> 00:01:36,360
<font color="#CCCCCC">pen testing red teaming policy forensics</font>

37
00:01:34,950 --> 00:01:39,720
the whole whole business so it's a lot

38
00:01:36,360 --> 00:01:41,520
of<font color="#E5E5E5"> fun but that's not the only job I</font>

39
00:01:39,720 --> 00:01:45,140
have<font color="#E5E5E5"> and you think a guy with two jobs</font>

40
00:01:41,520 --> 00:01:49,170
<font color="#E5E5E5">be happy</font><font color="#CCCCCC"> it's</font><font color="#E5E5E5"> not the case my other job</font>

41
00:01:45,140 --> 00:01:51,960
job<font color="#CCCCCC"> I</font><font color="#E5E5E5"> co-founded</font><font color="#CCCCCC"> IT consulting for him</font>

42
00:01:49,170 --> 00:01:52,560
with<font color="#E5E5E5"> my colleague Mike Kimbo he's back</font>

43
00:01:51,960 --> 00:01:54,240
there<font color="#E5E5E5"> somewhere</font>

44
00:01:52,560 --> 00:01:55,920
<font color="#E5E5E5">he's the relief</font><font color="#CCCCCC"> short guy who's really</font>

45
00:01:54,240 --> 00:01:59,280
<font color="#CCCCCC">well dressed</font>

46
00:01:55,920 --> 00:02:02,070
he's giving a talk tomorrow<font color="#E5E5E5"> on Amazon</font>

47
00:01:59,280 --> 00:02:04,799
Web Services<font color="#CCCCCC"> and security related topics</font>

48
00:02:02,070 --> 00:02:06,960
<font color="#CCCCCC">I don't exactly know</font><font color="#E5E5E5"> what it's about</font>

49
00:02:04,799 --> 00:02:09,030
<font color="#E5E5E5">whenever he opens</font><font color="#CCCCCC"> his mouth my eyes kind</font>

50
00:02:06,960 --> 00:02:11,310
of glaze over and<font color="#E5E5E5"> all I really hear is</font>

51
00:02:09,030 --> 00:02:12,900
something something something<font color="#E5E5E5"> Amazon</font><font color="#CCCCCC"> but</font>

52
00:02:11,310 --> 00:02:17,280
<font color="#E5E5E5">he's a really</font><font color="#CCCCCC"> smart</font><font color="#E5E5E5"> guy so I'm sure it's</font>

53
00:02:12,900 --> 00:02:18,930
a<font color="#E5E5E5"> good talk and he'll educate us so</font>

54
00:02:17,280 --> 00:02:21,120
<font color="#E5E5E5">flying fortress IT is the name of</font><font color="#CCCCCC"> our</font>

55
00:02:18,930 --> 00:02:23,489
little<font color="#E5E5E5"> company we offer cloud and</font>

56
00:02:21,120 --> 00:02:25,800
InfoSec expertise primarily towards

57
00:02:23,489 --> 00:02:27,959
small and medium businesses<font color="#E5E5E5"> we're trying</font>

58
00:02:25,800 --> 00:02:29,670
<font color="#E5E5E5">to help bridge kind of a skills gap that</font>

59
00:02:27,959 --> 00:02:31,980
<font color="#CCCCCC">smaller organizations have where they</font>

60
00:02:29,670 --> 00:02:35,129
frequently could benefit<font color="#CCCCCC"> from</font><font color="#E5E5E5"> having a</font>

61
00:02:31,980 --> 00:02:36,540
cloud expert or a<font color="#E5E5E5"> security expert on</font>

62
00:02:35,129 --> 00:02:38,790
staff<font color="#CCCCCC"> but they can't afford</font><font color="#E5E5E5"> to pay one</font>

63
00:02:36,540 --> 00:02:40,049
full time when we try<font color="#E5E5E5"> to help them help</font>

64
00:02:38,790 --> 00:02:43,980
them address<font color="#CCCCCC"> their needs</font><font color="#E5E5E5"> in that regard</font>

65
00:02:40,050 --> 00:02:46,830
<font color="#CCCCCC">so this</font><font color="#E5E5E5"> talk as you probably together is</font>

66
00:02:43,980 --> 00:02:48,690
primarily about<font color="#CCCCCC"> mcl</font><font color="#E5E5E5"> and relaying</font><font color="#CCCCCC"> I am</font>

67
00:02:46,830 --> 00:02:50,519
going to<font color="#E5E5E5"> segue a little bit here and</font>

68
00:02:48,690 --> 00:02:52,739
<font color="#E5E5E5">there talk about some man-in-the-middle</font>

69
00:02:50,519 --> 00:02:54,780
stuff and some hashing<font color="#E5E5E5"> and stuff like</font>

70
00:02:52,739 --> 00:02:56,970
<font color="#E5E5E5">that</font><font color="#CCCCCC"> the talk is targeted primarily</font>

71
00:02:54,780 --> 00:02:58,650
<font color="#E5E5E5">towards both blue</font><font color="#CCCCCC"> end and red teamers</font>

72
00:02:56,970 --> 00:03:00,239
people both<font color="#CCCCCC"> on the offensive and the</font>

73
00:02:58,650 --> 00:03:01,530
defensive side<font color="#E5E5E5"> I'm</font><font color="#CCCCCC"> going to talk about</font>

74
00:03:00,239 --> 00:03:03,330
<font color="#CCCCCC">some the tools</font><font color="#E5E5E5"> for exploit and the</font>

75
00:03:01,530 --> 00:03:06,239
techniques for defense<font color="#E5E5E5"> towards the end</font>

76
00:03:03,330 --> 00:03:07,500
<font color="#CCCCCC">jenni experienced</font><font color="#E5E5E5"> pen testers out there</font>

77
00:03:06,239 --> 00:03:09,750
or<font color="#E5E5E5"> Ron Bo's</font>

78
00:03:07,500 --> 00:03:11,459
this will all be a little tack<font color="#CCCCCC"> but</font>

79
00:03:09,750 --> 00:03:15,390
<font color="#E5E5E5">hopefully there's still something new in</font>

80
00:03:11,459 --> 00:03:17,159
it for you the talk is a<font color="#E5E5E5"> fairly</font>

81
00:03:15,390 --> 00:03:19,619
technical and I'll probably<font color="#E5E5E5"> make some</font>

82
00:03:17,159 --> 00:03:20,970
mistakes along<font color="#E5E5E5"> the way so feel free to</font>

83
00:03:19,620 --> 00:03:24,120
<font color="#E5E5E5">point those out at the end and call me</font>

84
00:03:20,970 --> 00:03:25,739
<font color="#CCCCCC">stupid I don't</font><font color="#E5E5E5"> mind so starting at the</font>

85
00:03:24,120 --> 00:03:30,269
beginning<font color="#E5E5E5"> asking the obvious question</font>

86
00:03:25,739 --> 00:03:32,159
what is<font color="#E5E5E5"> ntlm so you could ask what does</font>

87
00:03:30,269 --> 00:03:33,840
<font color="#E5E5E5">it stand for</font><font color="#CCCCCC"> well if</font><font color="#E5E5E5"> you expand the</font>

88
00:03:32,159 --> 00:03:36,659
acronym a little bit you end up with the

89
00:03:33,840 --> 00:03:38,459
NT land manager which<font color="#E5E5E5"> is not very</font>

90
00:03:36,659 --> 00:03:41,129
<font color="#E5E5E5">helpful we have acronyms and acronyms</font>

91
00:03:38,459 --> 00:03:43,409
<font color="#CCCCCC">if you expand</font><font color="#E5E5E5"> it the full way you end up</font>

92
00:03:41,129 --> 00:03:45,690
with new technology local area network

93
00:03:43,409 --> 00:03:49,048
manager which<font color="#CCCCCC"> is still entirely</font>

94
00:03:45,690 --> 00:03:52,590
unhelpful<font color="#CCCCCC"> now you could do my usual</font><font color="#E5E5E5"> mo</font>

95
00:03:49,049 --> 00:03:55,019
and ask Google what is<font color="#CCCCCC"> in CLM</font><font color="#E5E5E5"> but be</font>

96
00:03:52,590 --> 00:03:56,849
careful if you<font color="#E5E5E5"> go that route</font><font color="#CCCCCC"> the</font>

97
00:03:55,019 --> 00:03:58,709
<font color="#E5E5E5">internet tends to play kind of fast and</font>

98
00:03:56,849 --> 00:04:01,560
loose with<font color="#CCCCCC"> what it means what it's</font>

99
00:03:58,709 --> 00:04:04,739
talking about<font color="#E5E5E5"> ntlm and ntlm can also</font>

100
00:04:01,560 --> 00:04:08,220
refer to insulin hashes as well as ntlm

101
00:04:04,739 --> 00:04:10,470
authentication<font color="#CCCCCC"> ntlm hashes</font><font color="#E5E5E5"> if those who</font>

102
00:04:08,220 --> 00:04:12,599
aren't aware is the<font color="#E5E5E5"> primary method that</font>

103
00:04:10,470 --> 00:04:15,720
Windows machines use for storing

104
00:04:12,599 --> 00:04:17,668
passwords securely on the on the local

105
00:04:15,720 --> 00:04:19,320
machine<font color="#CCCCCC"> I know</font><font color="#E5E5E5"> also on the domain</font>

106
00:04:17,668 --> 00:04:21,180
<font color="#CCCCCC">controller in</font><font color="#E5E5E5"> the in the associated</font>

107
00:04:19,320 --> 00:04:22,349
<font color="#E5E5E5">password database</font><font color="#CCCCCC"> that's</font><font color="#E5E5E5"> kind of what</font>

108
00:04:21,180 --> 00:04:25,620
they look<font color="#CCCCCC"> like they're weirdly enough</font>

109
00:04:22,350 --> 00:04:27,360
it's<font color="#E5E5E5"> actually this is the LM the</font>

110
00:04:25,620 --> 00:04:29,010
is the LM part of the hash and then

111
00:04:27,360 --> 00:04:31,710
that's the NT part of the hash<font color="#CCCCCC"> that's</font>

112
00:04:29,010 --> 00:04:33,300
kind<font color="#E5E5E5"> of weirdly backwards</font><font color="#CCCCCC"> it's a very</font>

113
00:04:31,710 --> 00:04:36,719
weak method of storing passwords

114
00:04:33,300 --> 00:04:41,010
unfortunately<font color="#CCCCCC"> it uses a form of unsalted</font>

115
00:04:36,720 --> 00:04:43,740
<font color="#CCCCCC">md4 doesn't even use md5</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> salt their</font>

116
00:04:41,010 --> 00:04:46,169
story to generate the hash<font color="#E5E5E5"> and these</font><font color="#CCCCCC"> Pat</font>

117
00:04:43,740 --> 00:04:48,510
<font color="#E5E5E5">and these hashes</font><font color="#CCCCCC"> if you as an attacker</font>

118
00:04:46,169 --> 00:04:50,789
can obtain them<font color="#CCCCCC"> you can</font><font color="#E5E5E5"> actually try</font><font color="#CCCCCC"> to</font>

119
00:04:48,510 --> 00:04:54,590
crack them at very very high speeds<font color="#CCCCCC"> a</font>

120
00:04:50,790 --> 00:04:58,440
single modern<font color="#E5E5E5"> GPU like an Nvidia 1080</font>

121
00:04:54,590 --> 00:04:59,698
<font color="#E5E5E5">can try 42 Giga hashes per second on one</font>

122
00:04:58,440 --> 00:05:03,539
of these hashes<font color="#CCCCCC"> if you didn't obtain</font>

123
00:04:59,699 --> 00:05:05,910
them<font color="#CCCCCC"> all so on top</font><font color="#E5E5E5"> of this they</font><font color="#CCCCCC"> can be</font>

124
00:05:03,539 --> 00:05:07,680
they<font color="#CCCCCC"> can be replayed so frequently if</font>

125
00:05:05,910 --> 00:05:09,270
you can obtain<font color="#E5E5E5"> one of these hashes</font><font color="#CCCCCC"> it's</font>

126
00:05:07,680 --> 00:05:12,360
as<font color="#E5E5E5"> good as having the password itself</font>

127
00:05:09,270 --> 00:05:13,530
without<font color="#E5E5E5"> even having to crack it by you</font>

128
00:05:12,360 --> 00:05:16,199
can authenticate<font color="#CCCCCC"> too many</font><font color="#E5E5E5"> windows</font>

129
00:05:13,530 --> 00:05:18,419
services<font color="#E5E5E5"> just using the hash this is</font>

130
00:05:16,199 --> 00:05:20,039
maybe<font color="#E5E5E5"> the</font><font color="#CCCCCC"> video her to pass the hash</font>

131
00:05:18,419 --> 00:05:22,680
attacks<font color="#E5E5E5"> that's usually what they</font>

132
00:05:20,039 --> 00:05:25,260
referring<font color="#E5E5E5"> to but that</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> not actually</font>

133
00:05:22,680 --> 00:05:27,000
<font color="#E5E5E5">what I'm here to talk about today</font><font color="#CCCCCC"> as far</font>

134
00:05:25,260 --> 00:05:28,440
<font color="#E5E5E5">as usually</font><font color="#CCCCCC"> knows this is is</font><font color="#E5E5E5"> I could go</font>

135
00:05:27,000 --> 00:05:30,720
on for<font color="#CCCCCC"> quite some time talking about</font>

136
00:05:28,440 --> 00:05:33,930
ntlm hashes<font color="#CCCCCC"> I am here to</font><font color="#E5E5E5"> focus on</font><font color="#CCCCCC"> into</font>

137
00:05:30,720 --> 00:05:35,400
an authentication so I'm going<font color="#E5E5E5"> to stop</font>

138
00:05:33,930 --> 00:05:37,470
dicking you around now and<font color="#CCCCCC"> actually tell</font>

139
00:05:35,400 --> 00:05:40,950
you what<font color="#E5E5E5"> I mean when I say into an</font>

140
00:05:37,470 --> 00:05:43,320
authentication so<font color="#E5E5E5"> in</font><font color="#CCCCCC"> Selenas indication</font>

141
00:05:40,950 --> 00:05:47,909
<font color="#E5E5E5">sometimes also known as net ntlm or</font>

142
00:05:43,320 --> 00:05:49,349
ntlmssp or<font color="#E5E5E5"> a few other weird names it's</font>

143
00:05:47,910 --> 00:05:51,690
a base of<font color="#E5E5E5"> challenge in response method</font>

144
00:05:49,349 --> 00:05:55,590
<font color="#E5E5E5">of authentication</font><font color="#CCCCCC"> it's been around since</font>

145
00:05:51,690 --> 00:05:58,080
1993<font color="#E5E5E5"> it was upgraded to MTOM version 2</font>

146
00:05:55,590 --> 00:05:59,729
with the introduction of<font color="#E5E5E5"> Windows NT 4.0</font>

147
00:05:58,080 --> 00:06:01,680
which included some security

148
00:05:59,729 --> 00:06:06,000
improvements<font color="#E5E5E5"> it was ultimately</font>

149
00:06:01,680 --> 00:06:07,680
deprecated by Kerberos<font color="#E5E5E5"> in 2000</font><font color="#CCCCCC"> Windows</font>

150
00:06:06,000 --> 00:06:09,870
<font color="#CCCCCC">networks prefer to use Kerberos when</font>

151
00:06:07,680 --> 00:06:11,520
<font color="#CCCCCC">possible but ntlm is still widely</font>

152
00:06:09,870 --> 00:06:13,949
supported including<font color="#E5E5E5"> the latest and</font>

153
00:06:11,520 --> 00:06:16,948
<font color="#CCCCCC">greatest versions of Windows Windows 10</font>

154
00:06:13,949 --> 00:06:20,010
Server 2016<font color="#E5E5E5"> so it's a little bit long in</font>

155
00:06:16,949 --> 00:06:22,260
the tooth that's 24 years by my mouth

156
00:06:20,010 --> 00:06:26,130
<font color="#CCCCCC">that it's</font><font color="#E5E5E5"> a that's been around it isn't</font>

157
00:06:22,260 --> 00:06:28,860
gonna go<font color="#CCCCCC"> away anytime soon so how does</font>

158
00:06:26,130 --> 00:06:30,449
<font color="#E5E5E5">it work well until an authentication as</font>

159
00:06:28,860 --> 00:06:32,610
I mentioned is a challenge<font color="#E5E5E5"> response</font>

160
00:06:30,449 --> 00:06:35,250
method<font color="#E5E5E5"> of authentication and the idea is</font>

161
00:06:32,610 --> 00:06:36,719
you<font color="#CCCCCC"> know we have a</font><font color="#E5E5E5"> client or user that</font>

162
00:06:35,250 --> 00:06:37,590
wants<font color="#CCCCCC"> to authenticate against a remote</font>

163
00:06:36,719 --> 00:06:39,540
server

164
00:06:37,590 --> 00:06:41,820
and they both have a some shared secret

165
00:06:39,540 --> 00:06:45,840
in<font color="#E5E5E5"> this case the shared secret is the</font><font color="#CCCCCC"> as</font>

166
00:06:41,820 --> 00:06:47,400
Bob's<font color="#CCCCCC"> ntl</font><font color="#E5E5E5"> and password hash</font><font color="#CCCCCC"> so the</font>

167
00:06:45,840 --> 00:06:49,380
client initiates the connections is I

168
00:06:47,400 --> 00:06:51,840
want<font color="#E5E5E5"> to log in as Bob and the server</font>

169
00:06:49,380 --> 00:06:53,550
responds<font color="#E5E5E5"> with a challenge and the</font>

170
00:06:51,840 --> 00:06:55,200
challenge in<font color="#E5E5E5"> this case is really just</font>

171
00:06:53,550 --> 00:06:58,800
<font color="#E5E5E5">eight bytes of random data that the</font>

172
00:06:55,200 --> 00:07:00,810
server generates on the fly<font color="#CCCCCC"> the client</font>

173
00:06:58,800 --> 00:07:03,360
knowing Bob's<font color="#CCCCCC"> entailing password hash</font>

174
00:07:00,810 --> 00:07:04,740
and the challenge combines these two<font color="#E5E5E5"> and</font>

175
00:07:03,360 --> 00:07:06,800
performs a transform of them just

176
00:07:04,740 --> 00:07:09,810
usually some sort<font color="#CCCCCC"> of some sort of hash</font>

177
00:07:06,800 --> 00:07:12,060
<font color="#CCCCCC">when we function and returns them</font><font color="#E5E5E5"> to the</font>

178
00:07:09,810 --> 00:07:14,190
server<font color="#CCCCCC"> now the server</font><font color="#E5E5E5"> which also knows</font>

179
00:07:12,060 --> 00:07:16,860
the ntlm hash and the challenge<font color="#CCCCCC"> it's</font>

180
00:07:14,190 --> 00:07:18,570
sent out can perform the same transform

181
00:07:16,860 --> 00:07:20,580
and ultimately you can compare the

182
00:07:18,570 --> 00:07:21,659
response with what it should be<font color="#E5E5E5"> and if</font>

183
00:07:20,580 --> 00:07:25,380
they<font color="#E5E5E5"> match well then we have</font><font color="#CCCCCC"> a</font>

184
00:07:21,660 --> 00:07:27,210
successful<font color="#CCCCCC"> successful login and the</font>

185
00:07:25,380 --> 00:07:28,740
advantage here is<font color="#CCCCCC"> that you know we've</font>

186
00:07:27,210 --> 00:07:32,870
managed<font color="#E5E5E5"> to authenticate without</font>

187
00:07:28,740 --> 00:07:35,280
disclosing the shared secret<font color="#E5E5E5"> on the wire</font>

188
00:07:32,870 --> 00:07:37,320
<font color="#E5E5E5">so the</font><font color="#CCCCCC"> nature of</font><font color="#E5E5E5"> the response</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the</font>

189
00:07:35,280 --> 00:07:39,900
challenge<font color="#E5E5E5"> depends on which version of</font>

190
00:07:37,320 --> 00:07:42,900
ntlm we're dealing with in<font color="#E5E5E5"> until in</font>

191
00:07:39,900 --> 00:07:45,989
<font color="#E5E5E5">version</font><font color="#CCCCCC"> one the response is a</font><font color="#E5E5E5"> DES that's</font>

192
00:07:42,900 --> 00:07:48,150
that's right<font color="#CCCCCC"> des not triple des des</font>

193
00:07:45,990 --> 00:07:50,760
<font color="#E5E5E5">encrypted results of the</font><font color="#CCCCCC"> entail</font><font color="#E5E5E5"> and</font>

194
00:07:48,150 --> 00:07:54,299
password hash and the random<font color="#CCCCCC"> eight bytes</font>

195
00:07:50,760 --> 00:07:56,849
<font color="#E5E5E5">server challenge now in this format it's</font>

196
00:07:54,300 --> 00:07:58,890
it's slightly better than<font color="#E5E5E5"> the raw</font><font color="#CCCCCC"> ntlm</font>

197
00:07:56,850 --> 00:08:01,320
password hash when it comes to<font color="#E5E5E5"> we're</font>

198
00:07:58,890 --> 00:08:03,590
<font color="#E5E5E5">trying to resist cracking so if you'll</font>

199
00:08:01,320 --> 00:08:06,120
remember the<font color="#E5E5E5"> raw ntlm password hash</font>

200
00:08:03,590 --> 00:08:09,179
<font color="#CCCCCC">could be cracked</font><font color="#E5E5E5"> at about</font><font color="#CCCCCC"> forty was</font><font color="#E5E5E5"> it</font>

201
00:08:06,120 --> 00:08:12,720
42 or 46 Giga hashes per second<font color="#E5E5E5"> the</font>

202
00:08:09,180 --> 00:08:15,060
until<font color="#CCCCCC"> m1 handshake</font><font color="#E5E5E5"> can be cracked at 23</font>

203
00:08:12,720 --> 00:08:18,450
Giga has per second<font color="#CCCCCC"> there are other</font>

204
00:08:15,060 --> 00:08:20,730
weaknesses<font color="#E5E5E5"> in NC LM version</font><font color="#CCCCCC"> one</font><font color="#E5E5E5"> so if an</font>

205
00:08:18,450 --> 00:08:23,659
attacker can can control or otherwise

206
00:08:20,730 --> 00:08:27,360
modify that<font color="#CCCCCC"> eight</font><font color="#E5E5E5"> bytes server challenge</font>

207
00:08:23,660 --> 00:08:28,950
<font color="#CCCCCC">here see here she can essentially</font><font color="#E5E5E5"> it's</font>

208
00:08:27,360 --> 00:08:30,210
like<font color="#E5E5E5"> removing the salt from a password</font>

209
00:08:28,950 --> 00:08:32,220
right and then the hash becomes

210
00:08:30,210 --> 00:08:36,590
susceptible to look up tables and

211
00:08:32,220 --> 00:08:40,380
rainbow tables so to<font color="#E5E5E5"> address this</font>

212
00:08:36,590 --> 00:08:42,630
<font color="#CCCCCC">Microsoft</font><font color="#E5E5E5"> released ntlm version to the</font>

213
00:08:40,380 --> 00:08:46,410
the hashing is a little bit stronger<font color="#CCCCCC"> its</font>

214
00:08:42,630 --> 00:08:48,000
<font color="#CCCCCC">H Mac md5 instead of DES which makes it</font>

215
00:08:46,410 --> 00:08:48,589
a little bit<font color="#E5E5E5"> more resistance</font><font color="#CCCCCC"> to cracking</font>

216
00:08:48,000 --> 00:08:51,020
it's now

217
00:08:48,590 --> 00:08:54,590
<font color="#CCCCCC">1.6 Giga hashes per second</font><font color="#E5E5E5"> instead of a</font>

218
00:08:51,020 --> 00:08:57,380
measly 23 but any handshakes that<font color="#E5E5E5"> are</font>

219
00:08:54,590 --> 00:08:58,820
intercepted<font color="#E5E5E5"> are still very crackable</font>

220
00:08:57,380 --> 00:09:01,280
right it's still a very good<font color="#E5E5E5"> chance that</font>

221
00:08:58,820 --> 00:09:04,970
<font color="#E5E5E5">an attacker would be</font><font color="#CCCCCC"> able</font><font color="#E5E5E5"> to recover the</font>

222
00:09:01,280 --> 00:09:07,780
<font color="#CCCCCC">password from</font><font color="#E5E5E5"> the ntlm hash</font><font color="#CCCCCC"> 1.6</font><font color="#E5E5E5"> Giga</font>

223
00:09:04,970 --> 00:09:11,090
hashes is still really<font color="#E5E5E5"> really fast</font><font color="#CCCCCC"> on</font>

224
00:09:07,780 --> 00:09:13,280
<font color="#CCCCCC">the plus side the</font><font color="#E5E5E5"> ntlm</font><font color="#CCCCCC"> 2 handshake</font>

225
00:09:11,090 --> 00:09:16,430
<font color="#E5E5E5">includes a client challenge so when the</font>

226
00:09:13,280 --> 00:09:18,770
client responds<font color="#E5E5E5"> it also includes its own</font>

227
00:09:16,430 --> 00:09:23,150
<font color="#CCCCCC">8 bytes of random data and because it</font>

228
00:09:18,770 --> 00:09:26,980
does that the an attacker could no

229
00:09:23,150 --> 00:09:29,720
longer perform<font color="#E5E5E5"> rainbow table lookups</font>

230
00:09:26,980 --> 00:09:32,030
<font color="#CCCCCC">there is another version of</font><font color="#E5E5E5"> ntlm called</font>

231
00:09:29,720 --> 00:09:34,190
<font color="#CCCCCC">m2 m2</font><font color="#E5E5E5"> session but it's not very commonly</font>

232
00:09:32,030 --> 00:09:36,650
seen<font color="#E5E5E5"> it was</font><font color="#CCCCCC"> ultimately</font><font color="#E5E5E5"> an attempt</font><font color="#CCCCCC"> to</font>

233
00:09:34,190 --> 00:09:39,890
<font color="#CCCCCC">backport</font><font color="#E5E5E5"> some of the Intel and choose</font>

234
00:09:36,650 --> 00:09:41,300
crypto features<font color="#E5E5E5"> back to ntlm</font><font color="#CCCCCC"> 1</font><font color="#E5E5E5"> to try to</font>

235
00:09:39,890 --> 00:09:43,370
solve<font color="#CCCCCC"> some of these problems like the</font>

236
00:09:41,300 --> 00:09:45,589
the challenge response<font color="#E5E5E5"> and rainbow table</font>

237
00:09:43,370 --> 00:09:47,090
<font color="#E5E5E5">issue but you don't see it very often</font>

238
00:09:45,590 --> 00:09:49,970
<font color="#E5E5E5">because generally if two computers</font>

239
00:09:47,090 --> 00:09:54,740
support ntlm<font color="#CCCCCC"> 2 session they also</font><font color="#E5E5E5"> support</font>

240
00:09:49,970 --> 00:09:56,350
ntlm version<font color="#E5E5E5"> 2 and will prefer that so</font><font color="#CCCCCC"> I</font>

241
00:09:54,740 --> 00:09:58,430
just<font color="#CCCCCC"> want to take a little bit</font><font color="#E5E5E5"> of a</font>

242
00:09:56,350 --> 00:10:00,710
<font color="#CCCCCC">little bit</font><font color="#E5E5E5"> of a digression</font><font color="#CCCCCC"> here and I</font>

243
00:09:58,430 --> 00:10:02,060
want<font color="#E5E5E5"> to emphasize I'm not a microsoft</font>

244
00:10:00,710 --> 00:10:04,490
hater<font color="#E5E5E5"> I don't hate them I think they</font>

245
00:10:02,060 --> 00:10:06,920
make a lot of great software<font color="#E5E5E5"> but they</font>

246
00:10:04,490 --> 00:10:09,010
have made<font color="#E5E5E5"> in the past some very some</font>

247
00:10:06,920 --> 00:10:11,780
<font color="#CCCCCC">very questionable</font><font color="#E5E5E5"> design decisions</font>

248
00:10:09,010 --> 00:10:14,450
including<font color="#E5E5E5"> our friend cookie here and</font>

249
00:10:11,780 --> 00:10:16,660
some<font color="#E5E5E5"> of these decisions</font><font color="#CCCCCC"> have had serious</font>

250
00:10:14,450 --> 00:10:18,860
consequences<font color="#CCCCCC"> from a</font><font color="#E5E5E5"> security perspective</font>

251
00:10:16,660 --> 00:10:20,480
<font color="#E5E5E5">for many many</font><font color="#CCCCCC"> years and because of</font>

252
00:10:18,860 --> 00:10:22,670
Microsoft's adherence<font color="#CCCCCC"> to the need for</font>

253
00:10:20,480 --> 00:10:24,140
backwards<font color="#CCCCCC"> compatibility are likely to</font>

254
00:10:22,670 --> 00:10:28,849
<font color="#CCCCCC">continue to have ramifications</font><font color="#E5E5E5"> for the</font>

255
00:10:24,140 --> 00:10:30,319
next 10 or more years<font color="#CCCCCC"> so I've kind of</font>

256
00:10:28,850 --> 00:10:33,770
<font color="#E5E5E5">Illustrated how ntlm authentication</font>

257
00:10:30,320 --> 00:10:35,750
works<font color="#E5E5E5"> I'm not gonna kind</font><font color="#CCCCCC"> of drop a</font>

258
00:10:33,770 --> 00:10:36,980
scenario<font color="#E5E5E5"> about how we can how we</font><font color="#CCCCCC"> can</font>

259
00:10:35,750 --> 00:10:39,790
break and how we can mess with<font color="#CCCCCC"> that or</font>

260
00:10:36,980 --> 00:10:42,170
<font color="#E5E5E5">to abuse</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> in order</font><font color="#CCCCCC"> to gain game</font><font color="#E5E5E5"> volume</font>

261
00:10:39,790 --> 00:10:44,000
<font color="#E5E5E5">so in this scenario we have an attacker</font>

262
00:10:42,170 --> 00:10:45,860
here and you know he's an attacker he's

263
00:10:44,000 --> 00:10:47,930
got a big red skull on<font color="#CCCCCC"> them we have this</font>

264
00:10:45,860 --> 00:10:50,480
attacker here has managed<font color="#CCCCCC"> to intercept</font>

265
00:10:47,930 --> 00:10:53,599
<font color="#E5E5E5">the intercept of the login attempt or</font>

266
00:10:50,480 --> 00:10:58,630
from between<font color="#E5E5E5"> Bob's computer and the</font>

267
00:10:53,600 --> 00:11:00,320
<font color="#E5E5E5">server so Bob initiates a login attempt</font>

268
00:10:58,630 --> 00:11:01,990
and

269
00:11:00,320 --> 00:11:05,780
and the attacker intercepts this

270
00:11:01,990 --> 00:11:08,570
initiate and initiates<font color="#E5E5E5"> its own login</font>

271
00:11:05,780 --> 00:11:10,579
session<font color="#CCCCCC"> to</font><font color="#E5E5E5"> the server with</font><font color="#CCCCCC"> the same user</font>

272
00:11:08,570 --> 00:11:12,230
ID<font color="#CCCCCC"> so now the server thinks it's</font>

273
00:11:10,580 --> 00:11:15,350
authenticated to<font color="#CCCCCC"> Bob Bob relates</font><font color="#E5E5E5"> attend</font>

274
00:11:12,230 --> 00:11:17,300
<font color="#E5E5E5">to getting to the attacker so the server</font>

275
00:11:15,350 --> 00:11:19,310
generates<font color="#E5E5E5"> a challenge just</font><font color="#CCCCCC"> as before and</font>

276
00:11:17,300 --> 00:11:21,020
passes<font color="#E5E5E5"> it to the attacker and the</font>

277
00:11:19,310 --> 00:11:25,670
attacker passes that exact same

278
00:11:21,020 --> 00:11:28,010
challenge back to Bob's<font color="#E5E5E5"> computer Bob's</font>

279
00:11:25,670 --> 00:11:30,380
computer responds to this because it

280
00:11:28,010 --> 00:11:31,730
knows<font color="#E5E5E5"> in those</font><font color="#CCCCCC"> bombs password hash the</font>

281
00:11:30,380 --> 00:11:33,680
response to<font color="#E5E5E5"> this sends it to</font><font color="#CCCCCC"> the</font>

282
00:11:31,730 --> 00:11:36,890
attacker<font color="#CCCCCC"> and then the attacker in turn</font>

283
00:11:33,680 --> 00:11:38,900
forwards on this exact same<font color="#CCCCCC"> response to</font>

284
00:11:36,890 --> 00:11:40,939
the server<font color="#E5E5E5"> and because this response is</font>

285
00:11:38,900 --> 00:11:43,910
exactly what the chat<font color="#E5E5E5"> the server rather</font>

286
00:11:40,940 --> 00:11:47,120
would expect for the given challenge we

287
00:11:43,910 --> 00:11:48,709
have a<font color="#E5E5E5"> successful login despite the fact</font>

288
00:11:47,120 --> 00:11:52,160
that<font color="#E5E5E5"> our attacker doesn't even know the</font>

289
00:11:48,710 --> 00:11:54,350
password hash<font color="#E5E5E5"> though the crux of the</font>

290
00:11:52,160 --> 00:11:56,209
<font color="#CCCCCC">problem</font><font color="#E5E5E5"> here for</font><font color="#CCCCCC"> anybody</font><font color="#E5E5E5"> who's</font>

291
00:11:54,350 --> 00:11:58,370
interested<font color="#CCCCCC"> in designing authentication</font>

292
00:11:56,210 --> 00:11:59,510
protocols in the<font color="#CCCCCC"> future the</font><font color="#E5E5E5"> crux of the</font>

293
00:11:58,370 --> 00:12:02,030
problem here<font color="#CCCCCC"> is that while the server</font>

294
00:11:59,510 --> 00:12:04,160
authenticates the<font color="#E5E5E5"> client the client</font><font color="#CCCCCC"> does</font>

295
00:12:02,030 --> 00:12:06,890
nothing<font color="#CCCCCC"> to authenticate the</font><font color="#E5E5E5"> server this</font>

296
00:12:04,160 --> 00:12:09,350
<font color="#E5E5E5">is a part of the problem</font><font color="#CCCCCC"> with HTTP and</font>

297
00:12:06,890 --> 00:12:10,880
HTTPS right and<font color="#E5E5E5"> this is why we have or a</font>

298
00:12:09,350 --> 00:12:12,650
part of<font color="#E5E5E5"> the reason anyway we have public</font>

299
00:12:10,880 --> 00:12:14,180
key cryptography<font color="#E5E5E5"> and certificate</font>

300
00:12:12,650 --> 00:12:17,240
authorities and chains of<font color="#E5E5E5"> trust and</font><font color="#CCCCCC"> that</font>

301
00:12:14,180 --> 00:12:19,430
<font color="#E5E5E5">sort of thing so I'm going</font><font color="#CCCCCC"> to take</font>

302
00:12:17,240 --> 00:12:20,960
another<font color="#E5E5E5"> quick digression here and this</font>

303
00:12:19,430 --> 00:12:23,270
is<font color="#CCCCCC"> probably because when I was starting</font>

304
00:12:20,960 --> 00:12:24,740
out in InfoSec<font color="#CCCCCC"> I was under</font><font color="#E5E5E5"> the</font>

305
00:12:23,270 --> 00:12:26,600
impression that<font color="#CCCCCC"> 9:00 in the</font><font color="#E5E5E5"> middle</font>

306
00:12:24,740 --> 00:12:30,200
attacks were very<font color="#E5E5E5"> difficult to pull off</font>

307
00:12:26,600 --> 00:12:31,820
<font color="#E5E5E5">very very rare</font><font color="#CCCCCC"> I've I thought at the</font>

308
00:12:30,200 --> 00:12:34,100
<font color="#CCCCCC">time that you know you had</font><font color="#E5E5E5"> to compromise</font>

309
00:12:31,820 --> 00:12:35,870
<font color="#E5E5E5">a switch or a router or or something</font>

310
00:12:34,100 --> 00:12:37,700
like<font color="#CCCCCC"> that in order</font><font color="#E5E5E5"> to format in the</font>

311
00:12:35,870 --> 00:12:40,460
middle<font color="#E5E5E5"> but I've since come to realize</font>

312
00:12:37,700 --> 00:12:42,470
just<font color="#CCCCCC"> how easy it is to make these happen</font>

313
00:12:40,460 --> 00:12:44,450
<font color="#CCCCCC">some</font><font color="#E5E5E5"> of these techniques here there's a</font>

314
00:12:42,470 --> 00:12:46,850
lot of different techniques for doing<font color="#E5E5E5"> it</font>

315
00:12:44,450 --> 00:12:48,290
are<font color="#E5E5E5"> very reliable like our poisoning and</font>

316
00:12:46,850 --> 00:12:50,690
DNS spoofing and<font color="#E5E5E5"> that sort of thing</font>

317
00:12:48,290 --> 00:12:53,150
<font color="#CCCCCC">especially if you can</font><font color="#E5E5E5"> get</font><font color="#CCCCCC"> onto the same</font>

318
00:12:50,690 --> 00:12:56,960
<font color="#E5E5E5">network</font><font color="#CCCCCC"> segment as your as your target</font>

319
00:12:53,150 --> 00:12:58,310
<font color="#E5E5E5">victim so if you are someone who's</font>

320
00:12:56,960 --> 00:13:00,200
<font color="#E5E5E5">fairly new to InfoSec you've never had a</font>

321
00:12:58,310 --> 00:13:02,540
chance<font color="#E5E5E5"> to do so you know pull open</font>

322
00:13:00,200 --> 00:13:05,210
<font color="#CCCCCC">something like Cain and</font><font color="#E5E5E5"> Abel or</font><font color="#CCCCCC"> a dork</font>

323
00:13:02,540 --> 00:13:07,430
<font color="#CCCCCC">app play around with it have some fun</font>

324
00:13:05,210 --> 00:13:09,740
it'll kind<font color="#CCCCCC"> of open your</font><font color="#E5E5E5"> eyes and</font>

325
00:13:07,430 --> 00:13:13,819
<font color="#CCCCCC">so just how</font><font color="#E5E5E5"> how prevalent most networks</font>

326
00:13:09,740 --> 00:13:15,980
are to these techniques however strictly

327
00:13:13,820 --> 00:13:18,290
speaking you don't<font color="#CCCCCC"> even need to</font><font color="#E5E5E5"> use</font><font color="#CCCCCC"> a</font>

328
00:13:15,980 --> 00:13:19,850
man-in-the-middle connection in order to

329
00:13:18,290 --> 00:13:22,550
hijack<font color="#CCCCCC"> an ansi</font><font color="#E5E5E5"> the authentication</font>

330
00:13:19,850 --> 00:13:26,930
attempt in fact the attacker can use<font color="#E5E5E5"> any</font>

331
00:13:22,550 --> 00:13:28,819
inbound connection to him or herself<font color="#CCCCCC"> to</font>

332
00:13:26,930 --> 00:13:30,589
kind<font color="#E5E5E5"> of initiate the</font><font color="#CCCCCC"> until end handshake</font>

333
00:13:28,820 --> 00:13:34,250
and<font color="#E5E5E5"> then hand it off to authenticate</font>

334
00:13:30,589 --> 00:13:35,600
against a server<font color="#CCCCCC"> for instance if you've</font>

335
00:13:34,250 --> 00:13:37,670
compromised another<font color="#E5E5E5"> machine on the</font>

336
00:13:35,600 --> 00:13:39,470
network<font color="#E5E5E5"> already you can use that to</font>

337
00:13:37,670 --> 00:13:41,599
generate<font color="#E5E5E5"> new</font><font color="#CCCCCC"> authentication attempts</font>

338
00:13:39,470 --> 00:13:44,630
against you know your your<font color="#E5E5E5"> listening</font>

339
00:13:41,600 --> 00:13:47,600
device<font color="#CCCCCC"> and use</font><font color="#E5E5E5"> that to authenticate</font>

340
00:13:44,630 --> 00:13:49,250
against other servers one of the best

341
00:13:47,600 --> 00:13:52,190
ways<font color="#CCCCCC"> to do this is for instance</font><font color="#E5E5E5"> through</font>

342
00:13:49,250 --> 00:13:54,350
a watering hole<font color="#E5E5E5"> attack</font><font color="#CCCCCC"> so if you can</font>

343
00:13:52,190 --> 00:13:56,870
compromise<font color="#E5E5E5"> a corporate you know</font><font color="#CCCCCC"> website</font>

344
00:13:54,350 --> 00:13:59,540
an internal<font color="#CCCCCC"> website</font><font color="#E5E5E5"> so that</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> includes</font>

345
00:13:56,870 --> 00:14:01,790
a<font color="#E5E5E5"> reference to a resource on your</font>

346
00:13:59,540 --> 00:14:04,490
<font color="#E5E5E5">listening machine than any</font><font color="#CCCCCC"> client</font><font color="#E5E5E5"> who</font>

347
00:14:01,790 --> 00:14:06,380
goes to<font color="#E5E5E5"> that goes to that website</font><font color="#CCCCCC"> will</font>

348
00:14:04,490 --> 00:14:09,200
<font color="#E5E5E5">try to get the resource from the</font>

349
00:14:06,380 --> 00:14:12,950
attacking machine which can lead to<font color="#E5E5E5"> an</font>

350
00:14:09,200 --> 00:14:14,570
<font color="#E5E5E5">until an authentication attempt</font><font color="#CCCCCC"> you can</font>

351
00:14:12,950 --> 00:14:16,990
<font color="#CCCCCC">also leverage</font><font color="#E5E5E5"> a great little tool called</font>

352
00:14:14,570 --> 00:14:20,170
responder to respond to name<font color="#E5E5E5"> resolution</font>

353
00:14:16,990 --> 00:14:22,820
broadcasts responders a great tool

354
00:14:20,170 --> 00:14:24,740
<font color="#E5E5E5">should</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> in any the toolkit of any red</font>

355
00:14:22,820 --> 00:14:27,170
team or a penetration<font color="#E5E5E5"> tester but</font>

356
00:14:24,740 --> 00:14:29,330
basically when a DNS lookup fails on an

357
00:14:27,170 --> 00:14:32,900
internal network<font color="#E5E5E5"> most</font><font color="#CCCCCC"> windows machines</font>

358
00:14:29,330 --> 00:14:34,700
will perform a multicast lookup for for

359
00:14:32,900 --> 00:14:36,050
<font color="#E5E5E5">anyone anybody on the network so</font><font color="#CCCCCC"> you</font>

360
00:14:34,700 --> 00:14:37,790
know you're on<font color="#E5E5E5"> your network and you try</font>

361
00:14:36,050 --> 00:14:39,319
to<font color="#E5E5E5"> go to you know</font><font color="#CCCCCC"> a file</font><font color="#E5E5E5"> server or</font>

362
00:14:37,790 --> 00:14:41,990
<font color="#E5E5E5">whatever</font><font color="#CCCCCC"> but it's not in your an</font>

363
00:14:39,320 --> 00:14:44,240
internal DNS<font color="#E5E5E5"> your your clients or your</font>

364
00:14:41,990 --> 00:14:44,810
<font color="#E5E5E5">machine will well he was one of these</font>

365
00:14:44,240 --> 00:14:48,709
<font color="#CCCCCC">protocols</font>

366
00:14:44,810 --> 00:14:50,359
<font color="#E5E5E5">llm and our multicast DNS or MB TNS to</font>

367
00:14:48,709 --> 00:14:54,219
try to find that machine on the network

368
00:14:50,360 --> 00:14:56,540
<font color="#CCCCCC">without the</font><font color="#E5E5E5"> help of your internal DNS</font>

369
00:14:54,220 --> 00:14:58,850
<font color="#CCCCCC">the advantage here comes in that the</font>

370
00:14:56,540 --> 00:15:00,439
<font color="#CCCCCC">easier multicast adnan not broadcast but</font>

371
00:14:58,850 --> 00:15:03,350
multicast<font color="#E5E5E5"> into many machines on the</font>

372
00:15:00,440 --> 00:15:05,450
network and<font color="#E5E5E5"> what happens if we</font><font color="#CCCCCC"> as an</font>

373
00:15:03,350 --> 00:15:08,120
attacker<font color="#E5E5E5"> start responding to them and we</font>

374
00:15:05,450 --> 00:15:10,160
say hey you<font color="#CCCCCC"> want to connect</font><font color="#E5E5E5"> to you know</font>

375
00:15:08,120 --> 00:15:12,950
file server<font color="#E5E5E5"> sure I'll be final server</font>

376
00:15:10,160 --> 00:15:17,560
<font color="#E5E5E5">you can connect to me and that's where</font>

377
00:15:12,950 --> 00:15:19,820
this tool<font color="#E5E5E5"> comes into play pardon me</font>

378
00:15:17,560 --> 00:15:21,380
responder as I mentioned great Python

379
00:15:19,820 --> 00:15:23,450
tool like Cain and<font color="#E5E5E5"> Abel</font>

380
00:15:21,380 --> 00:15:26,300
spend some<font color="#E5E5E5"> time</font><font color="#CCCCCC"> playing with it the</font><font color="#E5E5E5"> very</font>

381
00:15:23,450 --> 00:15:28,190
first<font color="#E5E5E5"> time</font><font color="#CCCCCC"> I spun it</font><font color="#E5E5E5"> up on our internal</font>

382
00:15:26,300 --> 00:15:30,770
<font color="#E5E5E5">network</font><font color="#CCCCCC"> I managed</font><font color="#E5E5E5"> to get domain admin</font>

383
00:15:28,190 --> 00:15:32,810
credentials in about two minutes<font color="#CCCCCC"> so that</font>

384
00:15:30,770 --> 00:15:34,640
<font color="#CCCCCC">was a bit of an eye-opener for us we</font>

385
00:15:32,810 --> 00:15:36,199
discovered there was<font color="#E5E5E5"> a script that had</font>

386
00:15:34,640 --> 00:15:37,550
been improperly<font color="#E5E5E5"> configured and was</font>

387
00:15:36,200 --> 00:15:39,890
sprained<font color="#E5E5E5"> two main admin credentials</font>

388
00:15:37,550 --> 00:15:44,420
<font color="#E5E5E5">around our network so even if you're</font>

389
00:15:39,890 --> 00:15:45,949
just yeah<font color="#E5E5E5"> this is</font><font color="#CCCCCC"> before</font><font color="#E5E5E5"> my time so even</font>

390
00:15:44,420 --> 00:15:47,870
<font color="#E5E5E5">if you're interested in only defending</font>

391
00:15:45,950 --> 00:15:49,850
your network<font color="#E5E5E5"> you know</font><font color="#CCCCCC"> firing</font><font color="#E5E5E5"> up this</font>

392
00:15:47,870 --> 00:15:51,470
tool can be really insightful that there

393
00:15:49,850 --> 00:15:55,400
might be something<font color="#CCCCCC"> misconfigured on your</font>

394
00:15:51,470 --> 00:15:57,350
network<font color="#CCCCCC"> that somebody could exploit so</font>

395
00:15:55,400 --> 00:15:59,600
<font color="#E5E5E5">I'm going to give a brief little demo</font>

396
00:15:57,350 --> 00:16:02,120
<font color="#CCCCCC">sort</font><font color="#E5E5E5"> of about some of what I've</font><font color="#CCCCCC"> been</font>

397
00:15:59,600 --> 00:16:04,220
<font color="#E5E5E5">talking</font><font color="#CCCCCC"> about so far</font><font color="#E5E5E5"> now I'm not so</font>

398
00:16:02,120 --> 00:16:06,920
conceited<font color="#CCCCCC"> as to</font><font color="#E5E5E5"> think I should tempt the</font>

399
00:16:04,220 --> 00:16:09,430
demo gods by giving an actual demo on my

400
00:16:06,920 --> 00:16:12,469
<font color="#E5E5E5">very first security conference</font>

401
00:16:09,430 --> 00:16:14,329
presentation<font color="#CCCCCC"> so all I've done early is</font>

402
00:16:12,470 --> 00:16:16,520
<font color="#CCCCCC">fix</font><font color="#E5E5E5"> some screenshots that I'll kind of</font>

403
00:16:14,330 --> 00:16:18,950
<font color="#CCCCCC">walk you through I</font><font color="#E5E5E5"> apologize that these</font>

404
00:16:16,520 --> 00:16:21,290
are not so easy to see<font color="#E5E5E5"> for the people in</font>

405
00:16:18,950 --> 00:16:22,850
the back<font color="#E5E5E5"> when I made up these slides in</font>

406
00:16:21,290 --> 00:16:25,010
<font color="#E5E5E5">my mind's eye the projector was about</font>

407
00:16:22,850 --> 00:16:27,460
twice as<font color="#CCCCCC"> big</font><font color="#E5E5E5"> because apparently I've</font>

408
00:16:25,010 --> 00:16:30,920
never been to the<font color="#CCCCCC"> King said before so</font>

409
00:16:27,460 --> 00:16:33,950
but but<font color="#CCCCCC"> anyway so our scenario is that</font>

410
00:16:30,920 --> 00:16:36,620
an attacker has somehow gotten<font color="#E5E5E5"> on to a</font>

411
00:16:33,950 --> 00:16:37,760
particular<font color="#CCCCCC"> network so for</font><font color="#E5E5E5"> instance maybe</font>

412
00:16:36,620 --> 00:16:40,820
they've you know they've plugged<font color="#CCCCCC"> a</font>

413
00:16:37,760 --> 00:16:42,319
laptop<font color="#E5E5E5"> into an open Ethernet port and</font>

414
00:16:40,820 --> 00:16:44,180
the<font color="#CCCCCC"> organisation doesn't</font><font color="#E5E5E5"> have proper</font>

415
00:16:42,320 --> 00:16:47,210
port security or maybe they've got<font color="#CCCCCC"> onto</font>

416
00:16:44,180 --> 00:16:50,449
<font color="#CCCCCC">the wireless right - very realistic and</font>

417
00:16:47,210 --> 00:16:52,510
common scenarios so we fire up responder

418
00:16:50,450 --> 00:16:54,230
it starts up<font color="#E5E5E5"> and dumps a bunch of</font>

419
00:16:52,510 --> 00:16:56,720
diagnostic information<font color="#E5E5E5"> that we don't</font>

420
00:16:54,230 --> 00:16:59,950
really care<font color="#CCCCCC"> about</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> ultimately</font><font color="#E5E5E5"> just</font>

421
00:16:56,720 --> 00:17:03,200
sits<font color="#CCCCCC"> there waiting listening for events</font>

422
00:16:59,950 --> 00:17:06,800
so along<font color="#E5E5E5"> comes Joel user and</font><font color="#CCCCCC"> Joey user</font>

423
00:17:03,200 --> 00:17:08,540
wants<font color="#E5E5E5"> to visit SharePoint but you know</font>

424
00:17:06,800 --> 00:17:10,430
he maybe has<font color="#E5E5E5"> its coffee that morning and</font>

425
00:17:08,540 --> 00:17:13,069
he<font color="#CCCCCC"> fat-fingers it and types in</font><font color="#E5E5E5"> sharp</font>

426
00:17:10,430 --> 00:17:17,320
point instead of<font color="#E5E5E5"> SharePoint right so</font>

427
00:17:13,069 --> 00:17:17,319
SharePoint not being in the internal DNS

428
00:17:18,430 --> 00:17:23,150
<font color="#E5E5E5">SharePoint up</font><font color="#CCCCCC"> the char point not being</font>

429
00:17:20,569 --> 00:17:25,490
in the internal DNS the<font color="#CCCCCC"> lookup fails</font><font color="#E5E5E5"> and</font>

430
00:17:23,150 --> 00:17:28,339
now his machine attempts to do<font color="#E5E5E5"> a</font>

431
00:17:25,490 --> 00:17:31,940
multicast<font color="#E5E5E5"> name resolution using in this</font>

432
00:17:28,339 --> 00:17:34,190
case<font color="#CCCCCC"> ll M&R our listener hears this</font>

433
00:17:31,940 --> 00:17:34,910
particular request<font color="#E5E5E5"> response</font><font color="#CCCCCC"> - it's a</font>

434
00:17:34,190 --> 00:17:37,070
sure

435
00:17:34,910 --> 00:17:40,010
I'll be sharp point<font color="#CCCCCC"> you can connect to</font>

436
00:17:37,070 --> 00:17:42,050
me no problem<font color="#CCCCCC"> and sure enough you know</font>

437
00:17:40,010 --> 00:17:44,510
<font color="#E5E5E5">Joey user in this case apparently his</font>

438
00:17:42,050 --> 00:17:47,200
name is<font color="#E5E5E5"> T freezing Joey</font><font color="#CCCCCC"> users</font><font color="#E5E5E5"> computer</font>

439
00:17:44,510 --> 00:17:49,190
<font color="#E5E5E5">other that is it connects in</font>

440
00:17:47,200 --> 00:17:50,690
authenticates<font color="#E5E5E5"> there's the server</font>

441
00:17:49,190 --> 00:17:52,070
challenge the client challenge which

442
00:17:50,690 --> 00:17:54,290
I've kind of<font color="#E5E5E5"> blocked out</font><font color="#CCCCCC"> and then the</font>

443
00:17:52,070 --> 00:17:57,439
resulting<font color="#E5E5E5"> actual ntlm authentication</font>

444
00:17:54,290 --> 00:18:01,340
hash now<font color="#CCCCCC"> I as an attacker can take this</font>

445
00:17:57,440 --> 00:18:07,130
hash<font color="#E5E5E5"> and use it to try to track this</font>

446
00:18:01,340 --> 00:18:10,879
<font color="#E5E5E5">users password now</font><font color="#CCCCCC"> Joe user mr.</font><font color="#E5E5E5"> t</font>

447
00:18:07,130 --> 00:18:13,370
<font color="#CCCCCC">Friesland this is all he sees right he's</font>

448
00:18:10,880 --> 00:18:15,170
miss typed in the char point<font color="#E5E5E5"> and so he</font>

449
00:18:13,370 --> 00:18:16,429
says<font color="#CCCCCC"> Oh Windows cannot access char point</font>

450
00:18:15,170 --> 00:18:18,410
<font color="#E5E5E5">oh well that's because I'm an idiot</font><font color="#CCCCCC"> I</font>

451
00:18:16,430 --> 00:18:20,420
mistyped it right<font color="#E5E5E5"> this is normal and</font>

452
00:18:18,410 --> 00:18:22,220
expected behavior<font color="#E5E5E5"> from the users</font>

453
00:18:20,420 --> 00:18:24,080
<font color="#E5E5E5">perspective</font><font color="#CCCCCC"> so as far as he or she is</font>

454
00:18:22,220 --> 00:18:30,200
<font color="#E5E5E5">concerned nothing untoward has happened</font>

455
00:18:24,080 --> 00:18:32,179
here so if instead of<font color="#E5E5E5"> just capturing the</font>

456
00:18:30,200 --> 00:18:34,540
hashes I want to<font color="#E5E5E5"> perform</font><font color="#CCCCCC"> a proper relay</font>

457
00:18:32,180 --> 00:18:36,830
attack<font color="#CCCCCC"> I need to leverage</font><font color="#E5E5E5"> other tools</font>

458
00:18:34,540 --> 00:18:39,889
<font color="#CCCCCC">ntlm relay apps is probably one of the</font>

459
00:18:36,830 --> 00:18:42,620
the better ones available<font color="#E5E5E5"> so I fire up</font>

460
00:18:39,890 --> 00:18:44,930
<font color="#E5E5E5">until M relay X on</font><font color="#CCCCCC"> my listening</font><font color="#E5E5E5"> machine</font>

461
00:18:42,620 --> 00:18:47,209
and this case I'm<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> attack I'm</font>

462
00:18:44,930 --> 00:18:48,080
<font color="#E5E5E5">gonna attack the LDAP service on the</font>

463
00:18:47,210 --> 00:18:49,700
domain controller

464
00:18:48,080 --> 00:18:50,929
<font color="#E5E5E5">I've</font><font color="#CCCCCC"> loaded up</font><font color="#E5E5E5"> the domain controller</font>

465
00:18:49,700 --> 00:18:52,310
because you don't need<font color="#CCCCCC"> to know</font><font color="#E5E5E5"> that and</font>

466
00:18:50,930 --> 00:18:55,150
<font color="#E5E5E5">I didn't have enough time but</font><font color="#CCCCCC"> actually</font>

467
00:18:52,310 --> 00:18:59,960
set up<font color="#E5E5E5"> a proper testing environment but</font>

468
00:18:55,150 --> 00:19:01,760
what's wrong so it sets up the SMB

469
00:18:59,960 --> 00:19:04,340
server HTTP server listens for

470
00:19:01,760 --> 00:19:07,310
connections<font color="#E5E5E5"> and goes on</font><font color="#CCCCCC"> from there</font>

471
00:19:04,340 --> 00:19:11,540
so same things before<font color="#CCCCCC"> Julie user that</font>

472
00:19:07,310 --> 00:19:14,000
fingers<font color="#E5E5E5"> char point or responder sees it</font>

473
00:19:11,540 --> 00:19:18,649
responds to<font color="#E5E5E5"> it says hey sure I'm John</font>

474
00:19:14,000 --> 00:19:21,020
sharp point<font color="#CCCCCC"> and likewise the connection</font>

475
00:19:18,650 --> 00:19:23,240
is initiated and<font color="#CCCCCC"> the hash is then</font>

476
00:19:21,020 --> 00:19:24,440
relayed<font color="#E5E5E5"> on to the domain controller you</font>

477
00:19:23,240 --> 00:19:26,930
<font color="#CCCCCC">can see the authentication there has</font>

478
00:19:24,440 --> 00:19:30,950
succeeded here's the hash once again

479
00:19:26,930 --> 00:19:33,830
plotted out<font color="#E5E5E5"> but thankfully</font><font color="#CCCCCC"> for our</font><font color="#E5E5E5"> you</font>

480
00:19:30,950 --> 00:19:36,470
<font color="#CCCCCC">know theoretical victim organization</font><font color="#E5E5E5"> the</font>

481
00:19:33,830 --> 00:19:38,870
domain user in question<font color="#CCCCCC"> is not a domain</font>

482
00:19:36,470 --> 00:19:40,940
admin if it had been<font color="#E5E5E5"> a domain admin this</font>

483
00:19:38,870 --> 00:19:43,280
tool will automatically create<font color="#E5E5E5"> a</font><font color="#CCCCCC"> new</font>

484
00:19:40,940 --> 00:19:45,560
<font color="#E5E5E5">domain admin account with an own</font>

485
00:19:43,280 --> 00:19:49,899
password which the attacker can

486
00:19:45,560 --> 00:19:53,240
use to you know have the<font color="#E5E5E5"> main admin</font>

487
00:19:49,900 --> 00:19:56,810
<font color="#CCCCCC">instead it will it will just</font><font color="#E5E5E5"> dump the</font>

488
00:19:53,240 --> 00:19:58,340
info for<font color="#CCCCCC"> the first time pulldown</font><font color="#E5E5E5"> pretty</font>

489
00:19:56,810 --> 00:20:01,790
<font color="#E5E5E5">much any useful information</font><font color="#CCCCCC"> you can get</font>

490
00:19:58,340 --> 00:20:02,780
<font color="#E5E5E5">from</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> Active</font><font color="#CCCCCC"> Directory this is kind</font>

491
00:20:01,790 --> 00:20:04,580
of<font color="#CCCCCC"> the some of the</font><font color="#E5E5E5"> things you can</font>

492
00:20:02,780 --> 00:20:07,580
<font color="#CCCCCC">it'll-it'll grab and look grab the main</font>

493
00:20:04,580 --> 00:20:09,800
users computers policies groups<font color="#CCCCCC"> are a</font>

494
00:20:07,580 --> 00:20:14,540
wealth of<font color="#CCCCCC"> useful information</font><font color="#E5E5E5"> to an</font>

495
00:20:09,800 --> 00:20:15,860
attacker<font color="#E5E5E5"> attempting to you know get</font>

496
00:20:14,540 --> 00:20:21,409
<font color="#E5E5E5">together</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> privilege escalation on a</font>

497
00:20:15,860 --> 00:20:23,629
victim domain so now that<font color="#CCCCCC"> I've done the</font>

498
00:20:21,410 --> 00:20:26,450
fun stuff<font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> gonna give some history</font>

499
00:20:23,630 --> 00:20:28,640
lessons here<font color="#CCCCCC"> the issue with ntlm was</font>

500
00:20:26,450 --> 00:20:32,570
first identified in 1996 by fellow named

501
00:20:28,640 --> 00:20:34,550
<font color="#E5E5E5">Dominique Brzezinski unfortunately this</font>

502
00:20:32,570 --> 00:20:36,980
paper his kind of landmark<font color="#E5E5E5"> as it was has</font>

503
00:20:34,550 --> 00:20:38,180
<font color="#CCCCCC">been</font><font color="#E5E5E5"> lost lost to time in bit rot and to</font>

504
00:20:36,980 --> 00:20:40,510
the best of<font color="#E5E5E5"> my knowledge is no longer</font>

505
00:20:38,180 --> 00:20:42,800
available anywhere on the<font color="#CCCCCC"> internet</font>

506
00:20:40,510 --> 00:20:44,750
<font color="#CCCCCC">partly in response to this it's no</font>

507
00:20:42,800 --> 00:20:49,639
coincidence<font color="#CCCCCC"> that Microsoft released</font><font color="#E5E5E5"> any</font>

508
00:20:44,750 --> 00:20:53,030
level version<font color="#CCCCCC"> to in 1996 as part of its</font>

509
00:20:49,640 --> 00:20:54,950
Windows NT 4.0 operating system<font color="#CCCCCC"> in 2000</font>

510
00:20:53,030 --> 00:20:57,830
a fellow with a creative name of dill

511
00:20:54,950 --> 00:21:01,460
<font color="#E5E5E5">dog released the very first</font>

512
00:20:57,830 --> 00:21:05,510
ntlm relaying<font color="#E5E5E5"> tool allowing allowing</font>

513
00:21:01,460 --> 00:21:08,030
someone to relay between sessions<font color="#E5E5E5"> of</font>

514
00:21:05,510 --> 00:21:10,550
telnet and likewise we saw the first NT

515
00:21:08,030 --> 00:21:14,180
unrelated patch released that year to

516
00:21:10,550 --> 00:21:16,460
<font color="#E5E5E5">partly address that issue</font><font color="#CCCCCC"> and then in</font>

517
00:21:14,180 --> 00:21:18,590
2001 we throw us all the first SMB

518
00:21:16,460 --> 00:21:21,560
relaying tool<font color="#E5E5E5"> released by statistics and</font>

519
00:21:18,590 --> 00:21:23,990
in 2004<font color="#E5E5E5"> the first</font><font color="#CCCCCC"> cross protocol attack</font>

520
00:21:21,560 --> 00:21:26,600
was developed<font color="#CCCCCC"> I've kind of hinted</font><font color="#E5E5E5"> that</font>

521
00:21:23,990 --> 00:21:27,740
<font color="#E5E5E5">this without</font><font color="#CCCCCC"> alright saying this but one</font>

522
00:21:26,600 --> 00:21:30,050
of<font color="#E5E5E5"> the nice</font><font color="#CCCCCC"> things</font><font color="#E5E5E5"> will entail in</font>

523
00:21:27,740 --> 00:21:32,270
relaying<font color="#E5E5E5"> is it's a cross protocol attack</font>

524
00:21:30,050 --> 00:21:35,629
so if somebody is<font color="#CCCCCC"> trying</font><font color="#E5E5E5"> to attend to</font>

525
00:21:32,270 --> 00:21:37,730
Kate over SMB and<font color="#CCCCCC"> I can intercept that I</font>

526
00:21:35,630 --> 00:21:39,590
can then<font color="#E5E5E5"> turn around and use</font><font color="#CCCCCC"> that ntlm</font>

527
00:21:37,730 --> 00:21:41,900
authentication attempts against<font color="#E5E5E5"> say an</font>

528
00:21:39,590 --> 00:21:45,740
LDAP service or HTTP or something else

529
00:21:41,900 --> 00:21:48,980
like<font color="#CCCCCC"> that in 2008 was kind of a banner</font>

530
00:21:45,740 --> 00:21:50,870
year<font color="#CCCCCC"> for ntlm</font><font color="#E5E5E5"> relay</font><font color="#CCCCCC"> we saw a lot of new</font>

531
00:21:48,980 --> 00:21:55,190
tools<font color="#CCCCCC"> uh a lot of patches</font><font color="#E5E5E5"> were released</font>

532
00:21:50,870 --> 00:21:59,370
<font color="#CCCCCC">most</font><font color="#E5E5E5"> significantly MSO 868</font><font color="#CCCCCC"> were</font>

533
00:21:55,190 --> 00:22:01,620
Microsoft<font color="#CCCCCC"> a</font><font color="#E5E5E5"> patched ntlm authentication</font>

534
00:21:59,370 --> 00:22:03,449
<font color="#E5E5E5">were SMB so that you can no</font><font color="#CCCCCC"> longer do</font>

535
00:22:01,620 --> 00:22:04,979
reflective attacks that<font color="#E5E5E5"> is you can no</font>

536
00:22:03,450 --> 00:22:07,980
longer authenticate back to the same

537
00:22:04,980 --> 00:22:10,380
host<font color="#CCCCCC"> that was</font><font color="#E5E5E5"> originally you know a</font>

538
00:22:07,980 --> 00:22:11,910
religion<font color="#E5E5E5"> initiated the connection</font><font color="#CCCCCC"> this</font>

539
00:22:10,380 --> 00:22:13,980
<font color="#E5E5E5">kind of prevented a very trivial</font>

540
00:22:11,910 --> 00:22:18,890
privilege escalation<font color="#E5E5E5"> that that could be</font>

541
00:22:13,980 --> 00:22:22,020
<font color="#E5E5E5">used otherwise ntlm authentication</font>

542
00:22:18,890 --> 00:22:23,670
<font color="#E5E5E5">supports a large number of protocols</font>

543
00:22:22,020 --> 00:22:25,290
<font color="#E5E5E5">rather I should say a large number</font><font color="#CCCCCC"> of</font>

544
00:22:23,670 --> 00:22:27,809
protocols<font color="#E5E5E5"> support ntlm authentication</font>

545
00:22:25,290 --> 00:22:29,190
because<font color="#E5E5E5"> ntlm authentication is almost</font>

546
00:22:27,809 --> 00:22:31,260
more about framework a method for

547
00:22:29,190 --> 00:22:33,210
authentication<font color="#CCCCCC"> rather than a protocol in</font>

548
00:22:31,260 --> 00:22:35,940
itself<font color="#E5E5E5"> and how these protocols</font>

549
00:22:33,210 --> 00:22:37,830
<font color="#E5E5E5">wrap the ntlm authentication will will</font>

550
00:22:35,940 --> 00:22:40,679
vary from protocol<font color="#E5E5E5"> the protocol so for</font>

551
00:22:37,830 --> 00:22:42,659
instance in HTTP the<font color="#CCCCCC"> enfield</font>

552
00:22:40,679 --> 00:22:43,470
authentication is initiated as part of

553
00:22:42,660 --> 00:22:47,130
<font color="#E5E5E5">the get</font><font color="#CCCCCC"> request</font>

554
00:22:43,470 --> 00:22:53,790
<font color="#E5E5E5">whereas in SMB it's part of the</font><font color="#CCCCCC"> index</font>

555
00:22:47,130 --> 00:22:55,830
session<font color="#CCCCCC"> setup so</font><font color="#E5E5E5"> this is kind of gives</font>

556
00:22:53,790 --> 00:22:57,090
<font color="#E5E5E5">you a</font><font color="#CCCCCC"> little bit of information but what</font>

557
00:22:55,830 --> 00:22:58,800
<font color="#E5E5E5">sort of tools are currently available</font>

558
00:22:57,090 --> 00:23:01,620
and what's the mitigations are<font color="#E5E5E5"> in place</font>

559
00:22:58,800 --> 00:23:04,050
<font color="#E5E5E5">from one protocol to another</font><font color="#CCCCCC"> what I find</font>

560
00:23:01,620 --> 00:23:06,659
<font color="#E5E5E5">most interesting about this this chart</font>

561
00:23:04,050 --> 00:23:08,700
is just<font color="#E5E5E5"> how much white space there is on</font>

562
00:23:06,660 --> 00:23:12,390
there is actually<font color="#CCCCCC"> a lot of unexplored</font>

563
00:23:08,700 --> 00:23:15,870
areas for<font color="#CCCCCC"> NCL in relay</font><font color="#E5E5E5"> so if there are</font>

564
00:23:12,390 --> 00:23:17,460
any you know young InfoSec researchers

565
00:23:15,870 --> 00:23:19,290
in the audience perhaps<font color="#E5E5E5"> looking to make</font>

566
00:23:17,460 --> 00:23:21,450
a name for themselves<font color="#CCCCCC"> there are a lot of</font>

567
00:23:19,290 --> 00:23:25,080
<font color="#E5E5E5">opportunities</font><font color="#CCCCCC"> here for for new tools</font><font color="#E5E5E5"> and</font>

568
00:23:21,450 --> 00:23:27,090
<font color="#E5E5E5">techniques so I'm going to go through</font>

569
00:23:25,080 --> 00:23:28,169
some<font color="#CCCCCC"> of these services and</font><font color="#E5E5E5"> just kind of</font>

570
00:23:27,090 --> 00:23:29,399
highlight what I think are some<font color="#CCCCCC"> of the</font>

571
00:23:28,170 --> 00:23:30,900
most<font color="#E5E5E5"> interesting ones and I'm going to</font>

572
00:23:29,400 --> 00:23:34,350
put them<font color="#E5E5E5"> in order from least interesting</font>

573
00:23:30,900 --> 00:23:36,240
to<font color="#E5E5E5"> most interesting least interesting</font>

574
00:23:34,350 --> 00:23:39,059
while still being fairly<font color="#E5E5E5"> interesting</font><font color="#CCCCCC"> is</font>

575
00:23:36,240 --> 00:23:40,140
<font color="#E5E5E5">FTP</font><font color="#CCCCCC"> and telnet the reason these</font><font color="#E5E5E5"> aren't</font>

576
00:23:39,059 --> 00:23:43,170
so interesting is that they're not<font color="#E5E5E5"> very</font>

577
00:23:40,140 --> 00:23:45,450
<font color="#E5E5E5">common anymore right the</font><font color="#CCCCCC"> FTP servers</font>

578
00:23:43,170 --> 00:23:47,429
you'll see but tell that particularly<font color="#E5E5E5"> on</font>

579
00:23:45,450 --> 00:23:49,320
a Windows<font color="#CCCCCC"> server is is pretty pretty</font>

580
00:23:47,429 --> 00:23:52,220
uncommon nobody really uses tell that to

581
00:23:49,320 --> 00:23:54,629
<font color="#E5E5E5">control their Windows machines</font><font color="#CCCCCC"> anymore</font>

582
00:23:52,220 --> 00:23:56,160
in general I think these<font color="#CCCCCC"> are also</font>

583
00:23:54,630 --> 00:23:59,010
disabled by default<font color="#CCCCCC"> but</font><font color="#E5E5E5"> have to be</font>

584
00:23:56,160 --> 00:24:01,070
explicitly enabled by an administrator

585
00:23:59,010 --> 00:24:03,510
for them to<font color="#E5E5E5"> support ntlm authentication</font>

586
00:24:01,070 --> 00:24:04,980
<font color="#CCCCCC">internal</font><font color="#E5E5E5"> ftp servers can contain all</font>

587
00:24:03,510 --> 00:24:07,200
sorts<font color="#CCCCCC"> of interesting</font><font color="#E5E5E5"> information of</font>

588
00:24:04,980 --> 00:24:10,230
course<font color="#E5E5E5"> the</font><font color="#CCCCCC"> best</font><font color="#E5E5E5"> thing</font><font color="#CCCCCC"> i've ever found on</font>

589
00:24:07,200 --> 00:24:12,340
other<font color="#E5E5E5"> clients internal ftp server was a</font>

590
00:24:10,230 --> 00:24:14,169
blank check in the PDF form<font color="#E5E5E5"> we ran</font>

591
00:24:12,340 --> 00:24:15,580
<font color="#CCCCCC">tacker got got ahold</font><font color="#E5E5E5"> of that they could</font>

592
00:24:14,169 --> 00:24:19,150
have<font color="#E5E5E5"> had a lot of fun with with that</font><font color="#CCCCCC"> one</font>

593
00:24:15,580 --> 00:24:23,139
for<font color="#CCCCCC"> sure the next most interesting thing</font>

594
00:24:19,150 --> 00:24:25,690
in my<font color="#CCCCCC"> opinion is</font><font color="#E5E5E5"> IMAP</font><font color="#CCCCCC"> IMAP</font><font color="#E5E5E5"> supporting</font>

595
00:24:23,140 --> 00:24:27,850
ntlm authentication is not very common I

596
00:24:25,690 --> 00:24:29,529
believe it's disabled by default<font color="#CCCCCC"> and was</font>

597
00:24:27,850 --> 00:24:32,799
really<font color="#CCCCCC"> only included</font><font color="#E5E5E5"> in a fairly narrow</font>

598
00:24:29,529 --> 00:24:35,260
version<font color="#E5E5E5"> or narrow like selection of</font>

599
00:24:32,799 --> 00:24:38,320
Windows<font color="#CCCCCC"> Server versions but</font><font color="#E5E5E5"> I can't back</font>

600
00:24:35,260 --> 00:24:40,860
that up<font color="#CCCCCC"> unfortunately</font><font color="#E5E5E5"> but if you do or</font>

601
00:24:38,320 --> 00:24:44,770
<font color="#E5E5E5">if you are able to find as an attacker</font>

602
00:24:40,860 --> 00:24:47,199
<font color="#CCCCCC">you know an IMAP service which supports</font>

603
00:24:44,770 --> 00:24:48,700
ntlm authentication<font color="#CCCCCC"> you can use that to</font>

604
00:24:47,200 --> 00:24:51,010
download all<font color="#E5E5E5"> the emails of a particular</font>

605
00:24:48,700 --> 00:24:52,870
user<font color="#E5E5E5"> now of course if you can get</font>

606
00:24:51,010 --> 00:24:55,179
somebody's emails<font color="#E5E5E5"> this is the dawn of</font>

607
00:24:52,870 --> 00:24:57,489
time what are the odds that you<font color="#CCCCCC"> know</font>

608
00:24:55,179 --> 00:24:59,440
that user<font color="#E5E5E5"> has at least one email with</font><font color="#CCCCCC"> a</font>

609
00:24:57,490 --> 00:25:01,809
<font color="#E5E5E5">password</font><font color="#CCCCCC"> in that right like we tell</font>

610
00:24:59,440 --> 00:25:04,779
users<font color="#E5E5E5"> not</font><font color="#CCCCCC"> to do that but sure enough it</font>

611
00:25:01,809 --> 00:25:07,600
happens and<font color="#E5E5E5"> I know this because once or</font>

612
00:25:04,779 --> 00:25:09,909
twice myself<font color="#E5E5E5"> change those passwords I've</font>

613
00:25:07,600 --> 00:25:11,770
always changed those<font color="#CCCCCC"> passwords but but</font>

614
00:25:09,909 --> 00:25:13,450
maybe the<font color="#E5E5E5"> user that you found hasn't</font>

615
00:25:11,770 --> 00:25:15,220
<font color="#E5E5E5">unnecessarily change their password</font><font color="#CCCCCC"> and</font>

616
00:25:13,450 --> 00:25:16,809
<font color="#CCCCCC">not just passwords</font><font color="#E5E5E5"> right there's all</font>

617
00:25:15,220 --> 00:25:18,520
sorts of you<font color="#CCCCCC"> know</font><font color="#E5E5E5"> useful interesting</font>

618
00:25:16,809 --> 00:25:20,500
<font color="#E5E5E5">information is somebody's emails</font>

619
00:25:18,520 --> 00:25:22,779
<font color="#E5E5E5">potentially config files or even</font>

620
00:25:20,500 --> 00:25:25,270
certificates<font color="#E5E5E5"> I was working with one</font>

621
00:25:22,779 --> 00:25:26,890
organization<font color="#CCCCCC"> right</font><font color="#E5E5E5"> around the same time</font>

622
00:25:25,270 --> 00:25:29,260
<font color="#CCCCCC">their wildcard certificate was up for</font>

623
00:25:26,890 --> 00:25:31,840
renewal<font color="#CCCCCC"> so in order</font><font color="#E5E5E5"> to help you</font>

624
00:25:29,260 --> 00:25:33,640
disseminate<font color="#E5E5E5"> the certificate</font><font color="#CCCCCC"> to all the</font>

625
00:25:31,840 --> 00:25:36,370
appropriate<font color="#E5E5E5"> you know servers and</font>

626
00:25:33,640 --> 00:25:38,649
services<font color="#E5E5E5"> one</font><font color="#CCCCCC"> of the techs</font><font color="#E5E5E5"> generated the</font>

627
00:25:36,370 --> 00:25:41,469
new certificate and emailed the public

628
00:25:38,649 --> 00:25:44,260
key and the private key<font color="#CCCCCC"> as an attachment</font>

629
00:25:41,470 --> 00:25:46,779
to<font color="#CCCCCC"> the email and they included</font><font color="#E5E5E5"> the</font>

630
00:25:44,260 --> 00:25:50,020
passphrase<font color="#E5E5E5"> for the private key in the</font>

631
00:25:46,779 --> 00:25:51,700
body<font color="#E5E5E5"> of the email so that was that was</font>

632
00:25:50,020 --> 00:25:53,918
<font color="#E5E5E5">quite</font><font color="#CCCCCC"> at</font><font color="#E5E5E5"> the moment and to</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> fellow's</font>

633
00:25:51,700 --> 00:25:55,630
credit<font color="#E5E5E5"> as soon as I pointed out what he</font>

634
00:25:53,919 --> 00:25:57,340
had done<font color="#CCCCCC"> he</font><font color="#E5E5E5"> immediately realized his</font>

635
00:25:55,630 --> 00:25:59,740
mistake<font color="#E5E5E5"> and revoked that certificate</font>

636
00:25:57,340 --> 00:26:01,570
altogether<font color="#E5E5E5"> but that is the sort of thing</font>

637
00:25:59,740 --> 00:26:06,789
you will frequently<font color="#E5E5E5"> find in in small IT</font>

638
00:26:01,570 --> 00:26:09,908
shops<font color="#CCCCCC"> the next most interesting I think</font>

639
00:26:06,789 --> 00:26:12,370
is SMB now SMB is<font color="#E5E5E5"> kind of the classic</font>

640
00:26:09,909 --> 00:26:14,320
<font color="#E5E5E5">ntlm relaying target it's kind</font><font color="#CCCCCC"> of one</font><font color="#E5E5E5"> of</font>

641
00:26:12,370 --> 00:26:17,199
the most<font color="#CCCCCC"> documented it has the widest</font>

642
00:26:14,320 --> 00:26:19,330
<font color="#E5E5E5">tool support</font><font color="#CCCCCC"> and for good reason partly</font>

643
00:26:17,200 --> 00:26:20,919
because of its ubiquity<font color="#E5E5E5"> pretty much</font>

644
00:26:19,330 --> 00:26:24,699
every Windows machine that's<font color="#CCCCCC"> tahno</font>

645
00:26:20,919 --> 00:26:25,680
domain accepts ntlm over SMB<font color="#E5E5E5"> and pretty</font>

646
00:26:24,700 --> 00:26:28,050
much every Windows machine

647
00:26:25,680 --> 00:26:30,810
is listening on part<font color="#CCCCCC"> 4 or 4</font><font color="#E5E5E5"> or</font><font color="#CCCCCC"> 5 when</font>

648
00:26:28,050 --> 00:26:33,389
it's my least<font color="#E5E5E5"> when it's on</font><font color="#CCCCCC"> a domain</font><font color="#E5E5E5"> and</font>

649
00:26:30,810 --> 00:26:35,100
<font color="#E5E5E5">of course for anyone who's done any pen</font>

650
00:26:33,390 --> 00:26:36,870
testing out there you'll<font color="#E5E5E5"> be</font><font color="#CCCCCC"> familiar</font>

651
00:26:35,100 --> 00:26:39,090
with PS<font color="#E5E5E5"> exec which allows you to run</font>

652
00:26:36,870 --> 00:26:41,129
arbitrary<font color="#E5E5E5"> commands on a target machine</font>

653
00:26:39,090 --> 00:26:42,270
over SMB at least if<font color="#E5E5E5"> you have the</font>

654
00:26:41,130 --> 00:26:46,680
administrative credentials<font color="#CCCCCC"> for</font><font color="#E5E5E5"> that</font>

655
00:26:42,270 --> 00:26:48,240
machine even more<font color="#E5E5E5"> interesting than that</font>

656
00:26:46,680 --> 00:26:50,430
<font color="#E5E5E5">I think</font><font color="#CCCCCC"> is LDAP and</font><font color="#E5E5E5"> I kind of</font>

657
00:26:48,240 --> 00:26:53,760
demonstrated<font color="#E5E5E5"> what LDAP can do during my</font>

658
00:26:50,430 --> 00:26:55,920
my<font color="#E5E5E5"> little demo</font><font color="#CCCCCC"> my experience has been</font>

659
00:26:53,760 --> 00:26:58,860
<font color="#CCCCCC">very common pretty</font><font color="#E5E5E5"> much every Windows</font>

660
00:26:55,920 --> 00:27:00,420
domain is running LDAP somewhere and if

661
00:26:58,860 --> 00:27:02,159
the relay credentials are foreign admin

662
00:27:00,420 --> 00:27:03,690
as<font color="#E5E5E5"> I've mentioned you can make a new</font>

663
00:27:02,160 --> 00:27:06,480
domain admin which you now know the

664
00:27:03,690 --> 00:27:08,340
<font color="#E5E5E5">password for and have domain admin but</font>

665
00:27:06,480 --> 00:27:10,890
even if you don't you can of course<font color="#E5E5E5"> get</font>

666
00:27:08,340 --> 00:27:13,169
as I saw a list of users machines groups

667
00:27:10,890 --> 00:27:15,930
that sort of thing and if an

668
00:27:13,170 --> 00:27:18,300
organization is<font color="#CCCCCC"> using laps Microsoft</font>

669
00:27:15,930 --> 00:27:21,240
solution for managing<font color="#E5E5E5"> local admin</font>

670
00:27:18,300 --> 00:27:23,690
passwords<font color="#E5E5E5"> if they're using laps</font><font color="#CCCCCC"> you can</font>

671
00:27:21,240 --> 00:27:25,590
actually<font color="#CCCCCC"> download the</font><font color="#E5E5E5"> whole in a list of</font>

672
00:27:23,690 --> 00:27:27,060
administrative passwords<font color="#E5E5E5"> for all the</font>

673
00:27:25,590 --> 00:27:31,379
machines<font color="#CCCCCC"> now you have local admin</font>

674
00:27:27,060 --> 00:27:35,340
everywhere<font color="#CCCCCC"> even more interesting than</font>

675
00:27:31,380 --> 00:27:37,920
<font color="#CCCCCC">that I</font><font color="#E5E5E5"> think is RDP RDP</font><font color="#CCCCCC"> supports ntlm</font>

676
00:27:35,340 --> 00:27:40,800
authentication<font color="#E5E5E5"> frequently enabled it's</font>

677
00:27:37,920 --> 00:27:42,030
not very commonly exploited<font color="#E5E5E5"> partly</font>

678
00:27:40,800 --> 00:27:44,490
because there's not<font color="#E5E5E5"> really any tools</font>

679
00:27:42,030 --> 00:27:47,370
currently existent<font color="#E5E5E5"> that will exploit RDP</font>

680
00:27:44,490 --> 00:27:49,140
for you automatically<font color="#E5E5E5"> now of course if</font>

681
00:27:47,370 --> 00:27:51,209
you're exploiting RDP<font color="#E5E5E5"> it's not</font>

682
00:27:49,140 --> 00:27:53,040
particularly<font color="#E5E5E5"> OPSEC safe if a user</font><font color="#CCCCCC"> is</font>

683
00:27:51,210 --> 00:27:55,140
sitting<font color="#CCCCCC"> down</font><font color="#E5E5E5"> at their machine and you</font>

684
00:27:53,040 --> 00:27:57,659
RDP<font color="#CCCCCC"> into it they're gonna get booted out</font>

685
00:27:55,140 --> 00:27:59,040
and that looks pretty<font color="#CCCCCC"> damn suspicious</font><font color="#E5E5E5"> if</font>

686
00:27:57,660 --> 00:28:00,570
you're targeting a server though it's

687
00:27:59,040 --> 00:28:01,409
it's a<font color="#E5E5E5"> little bit less suspicious right</font>

688
00:28:00,570 --> 00:28:05,159
<font color="#E5E5E5">cuz there's nobody there's nobody</font>

689
00:28:01,410 --> 00:28:07,500
<font color="#E5E5E5">sitting at</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> usually but what makes RDP</font>

690
00:28:05,160 --> 00:28:09,750
I think so valuable<font color="#E5E5E5"> as a potential</font><font color="#CCCCCC"> ntl</font>

691
00:28:07,500 --> 00:28:12,000
<font color="#E5E5E5">and relaying source is that RDP is</font>

692
00:28:09,750 --> 00:28:14,550
generally only used<font color="#E5E5E5"> for two things right</font>

693
00:28:12,000 --> 00:28:16,710
<font color="#E5E5E5">either</font><font color="#CCCCCC"> your you know it's somebody's</font>

694
00:28:14,550 --> 00:28:19,919
remoting into their own desktop over<font color="#CCCCCC"> a</font>

695
00:28:16,710 --> 00:28:22,800
VPN or it's used by by an administer to

696
00:28:19,920 --> 00:28:24,450
administer you know a server or<font color="#CCCCCC"> the</font>

697
00:28:22,800 --> 00:28:27,330
<font color="#CCCCCC">helpdesk to administer a local</font><font color="#E5E5E5"> machine</font>

698
00:28:24,450 --> 00:28:29,720
so it's a very very<font color="#CCCCCC"> good source of admin</font>

699
00:28:27,330 --> 00:28:31,409
credentials<font color="#E5E5E5"> and if you can tap into</font><font color="#CCCCCC"> that</font>

700
00:28:29,720 --> 00:28:33,630
you<font color="#CCCCCC"> know there's a lot</font><font color="#E5E5E5"> of potential</font>

701
00:28:31,410 --> 00:28:36,990
<font color="#CCCCCC">there to</font><font color="#E5E5E5"> get administrative access to</font>

702
00:28:33,630 --> 00:28:39,010
machines on the network now the thing

703
00:28:36,990 --> 00:28:41,050
about RDP is

704
00:28:39,010 --> 00:28:43,690
even it does include<font color="#CCCCCC"> some protection</font>

705
00:28:41,050 --> 00:28:45,370
against<font color="#E5E5E5"> man in the middle attacks and</font>

706
00:28:43,690 --> 00:28:47,950
we've probably all seen<font color="#E5E5E5"> this</font><font color="#CCCCCC"> before in</font>

707
00:28:45,370 --> 00:28:49,389
some fashion<font color="#E5E5E5"> or</font><font color="#CCCCCC"> another</font>

708
00:28:47,950 --> 00:28:51,310
but that's kind of<font color="#E5E5E5"> the problem</font><font color="#CCCCCC"> right</font>

709
00:28:49,390 --> 00:28:53,140
<font color="#E5E5E5">this is the warning that you see but we</font>

710
00:28:51,310 --> 00:28:56,260
see it so frequently<font color="#CCCCCC"> we've all been in</font>

711
00:28:53,140 --> 00:28:57,880
nerd to it because this is pretty<font color="#CCCCCC"> much</font>

712
00:28:56,260 --> 00:28:59,650
normal<font color="#E5E5E5"> behavior</font><font color="#CCCCCC"> if provided you</font><font color="#E5E5E5"> don't</font>

713
00:28:57,880 --> 00:29:01,630
have proper public<font color="#E5E5E5"> key infrastructure</font>

714
00:28:59,650 --> 00:29:04,030
<font color="#E5E5E5">but the</font><font color="#CCCCCC"> thing is</font><font color="#E5E5E5"> well this is normal</font>

715
00:29:01,630 --> 00:29:05,140
behavior<font color="#E5E5E5"> this is the warning</font><font color="#CCCCCC"> you get</font>

716
00:29:04,030 --> 00:29:05,560
<font color="#E5E5E5">when you're being men in the middle</font>

717
00:29:05,140 --> 00:29:06,970
right

718
00:29:05,560 --> 00:29:08,860
did you catch you catch the difference

719
00:29:06,970 --> 00:29:12,490
there<font color="#CCCCCC"> it's</font><font color="#E5E5E5"> pretty</font><font color="#CCCCCC"> obvious when I have</font>

720
00:29:08,860 --> 00:29:14,800
them back and<font color="#E5E5E5"> forth like</font><font color="#CCCCCC"> that but but</font>

721
00:29:12,490 --> 00:29:17,080
<font color="#E5E5E5">when you're expecting this and you see</font>

722
00:29:14,800 --> 00:29:18,850
<font color="#E5E5E5">this instead how many people are just</font>

723
00:29:17,080 --> 00:29:24,490
<font color="#E5E5E5">gonna click through</font><font color="#CCCCCC"> yes don't want Bob</font>

724
00:29:18,850 --> 00:29:25,540
don't worry me again right<font color="#CCCCCC"> for the last</font>

725
00:29:24,490 --> 00:29:30,040
kind<font color="#E5E5E5"> of service</font><font color="#CCCCCC"> that I wanted</font><font color="#E5E5E5"> to</font>

726
00:29:25,540 --> 00:29:31,990
<font color="#E5E5E5">highlight is MSRP</font><font color="#CCCCCC"> CWM I and those those</font>

727
00:29:30,040 --> 00:29:33,250
protocols<font color="#E5E5E5"> and services again another</font>

728
00:29:31,990 --> 00:29:35,440
<font color="#E5E5E5">rich source of administrative</font>

729
00:29:33,250 --> 00:29:37,240
credentials it's frequently used<font color="#E5E5E5"> for</font>

730
00:29:35,440 --> 00:29:38,800
<font color="#E5E5E5">overnight scripts you remember that that</font>

731
00:29:37,240 --> 00:29:40,450
domain admin<font color="#E5E5E5"> that I got in</font><font color="#CCCCCC"> two minutes</font>

732
00:29:38,800 --> 00:29:44,950
<font color="#E5E5E5">from earlier yeah that was something</font>

733
00:29:40,450 --> 00:29:46,300
using the WMI script<font color="#CCCCCC"> because it's</font>

734
00:29:44,950 --> 00:29:48,130
unattended it's less likely<font color="#CCCCCC"> to</font><font color="#E5E5E5"> be</font>

735
00:29:46,300 --> 00:29:50,350
noticed than RDP you're not<font color="#E5E5E5"> interfering</font>

736
00:29:48,130 --> 00:29:52,030
with anybody's<font color="#CCCCCC"> you know direct</font><font color="#E5E5E5"> sessions</font>

737
00:29:50,350 --> 00:29:55,240
so it doesn't set off alarms in the<font color="#E5E5E5"> same</font>

738
00:29:52,030 --> 00:29:57,670
way<font color="#E5E5E5"> and of course if you can get admin /</font>

739
00:29:55,240 --> 00:30:00,670
w mi you can frequently<font color="#E5E5E5"> execute</font>

740
00:29:57,670 --> 00:30:02,920
arbitrary code the plus side<font color="#CCCCCC"> at least</font>

741
00:30:00,670 --> 00:30:05,430
from a defense perspective<font color="#E5E5E5"> there's no</font>

742
00:30:02,920 --> 00:30:09,850
tools that<font color="#E5E5E5"> exist</font><font color="#CCCCCC"> for this</font><font color="#E5E5E5"> just yet</font>

743
00:30:05,430 --> 00:30:12,220
so speaking of tools<font color="#CCCCCC"> some</font><font color="#E5E5E5"> of the most</font>

744
00:30:09,850 --> 00:30:15,580
<font color="#E5E5E5">popular ones NC unreal ax the one I used</font>

745
00:30:12,220 --> 00:30:19,120
before formally known as<font color="#E5E5E5"> SMB</font><font color="#CCCCCC"> real ax</font><font color="#E5E5E5"> is</font>

746
00:30:15,580 --> 00:30:21,399
included as part of the<font color="#CCCCCC"> impact</font><font color="#E5E5E5"> toolkit</font>

747
00:30:19,120 --> 00:30:25,149
<font color="#E5E5E5">and it can source this</font><font color="#CCCCCC"> in being</font><font color="#E5E5E5"> HTTP and</font>

748
00:30:21,400 --> 00:30:27,370
target a variety of other<font color="#CCCCCC"> services of</font>

749
00:30:25,150 --> 00:30:30,040
course<font color="#CCCCCC"> Metasploit a tool that's near</font><font color="#E5E5E5"> and</font>

750
00:30:27,370 --> 00:30:32,860
<font color="#CCCCCC">dear to any pen testers</font><font color="#E5E5E5"> heart includes</font>

751
00:30:30,040 --> 00:30:35,500
its own its own modules for doing ntlm

752
00:30:32,860 --> 00:30:39,219
<font color="#E5E5E5">reading and it can take from SMB HTTP</font>

753
00:30:35,500 --> 00:30:41,080
<font color="#E5E5E5">and</font><font color="#CCCCCC"> in turn target SMB and</font><font color="#E5E5E5"> HTTP it's one</font>

754
00:30:39,220 --> 00:30:46,210
of the<font color="#E5E5E5"> few tools</font><font color="#CCCCCC"> i've encountered</font><font color="#E5E5E5"> that</font>

755
00:30:41,080 --> 00:30:48,159
actually does proper you<font color="#E5E5E5"> know HTTP you</font>

756
00:30:46,210 --> 00:30:50,050
know<font color="#CCCCCC"> traversing so to speak</font><font color="#E5E5E5"> where you</font>

757
00:30:48,160 --> 00:30:52,060
can specify the URI the cookies the

758
00:30:50,050 --> 00:30:52,879
headers user agents<font color="#E5E5E5"> basically you can</font>

759
00:30:52,060 --> 00:30:55,850
get<font color="#E5E5E5"> pretty</font>

760
00:30:52,880 --> 00:30:59,900
you can<font color="#E5E5E5"> access any resource through this</font>

761
00:30:55,850 --> 00:31:02,290
by using<font color="#CCCCCC"> NT unreeling oh there are some</font>

762
00:30:59,900 --> 00:31:05,600
older tools<font color="#E5E5E5"> I want to highlight</font><font color="#CCCCCC"> quick</font>

763
00:31:02,290 --> 00:31:08,120
<font color="#CCCCCC">interceptor ng it's been around</font><font color="#E5E5E5"> for a</font>

764
00:31:05,600 --> 00:31:10,459
<font color="#E5E5E5">little</font><font color="#CCCCCC"> while it has a very nice GUI very</font>

765
00:31:08,120 --> 00:31:13,580
friendly to use it<font color="#CCCCCC"> only supports</font><font color="#E5E5E5"> SMB and</font>

766
00:31:10,460 --> 00:31:15,530
<font color="#E5E5E5">is closed source</font><font color="#CCCCCC"> it's also made by</font>

767
00:31:13,580 --> 00:31:17,149
Russians<font color="#CCCCCC"> now I have</font><font color="#E5E5E5"> nothing against</font>

768
00:31:15,530 --> 00:31:20,510
Russians but whenever I throw

769
00:31:17,150 --> 00:31:21,890
interceptor<font color="#E5E5E5"> ng into virustotal it spits</font>

770
00:31:20,510 --> 00:31:25,460
out a bunch of warnings about potential

771
00:31:21,890 --> 00:31:28,570
<font color="#CCCCCC">Trojans so</font><font color="#E5E5E5"> you just consider yourself</font>

772
00:31:25,460 --> 00:31:31,010
<font color="#E5E5E5">warned about</font><font color="#CCCCCC"> that one on the plus side</font>

773
00:31:28,570 --> 00:31:34,970
<font color="#CCCCCC">it does</font><font color="#E5E5E5"> include a handy Android version</font>

774
00:31:31,010 --> 00:31:38,390
so considering consider yourself warned

775
00:31:34,970 --> 00:31:39,140
anyway<font color="#E5E5E5"> there's also squirtle a bit of an</font>

776
00:31:38,390 --> 00:31:42,440
older one

777
00:31:39,140 --> 00:31:43,669
SMB relay 3 another<font color="#E5E5E5"> older one</font><font color="#CCCCCC"> but it</font><font color="#E5E5E5"> is</font>

778
00:31:42,440 --> 00:31:49,820
the<font color="#CCCCCC"> only</font><font color="#E5E5E5"> one that I've seen</font><font color="#CCCCCC"> that</font>

779
00:31:43,669 --> 00:31:51,890
supports IMAP<font color="#CCCCCC"> SMTP and and pop3</font><font color="#E5E5E5"> related</font>

780
00:31:49,820 --> 00:31:54,879
tools I<font color="#CCCCCC"> mentioned or</font><font color="#E5E5E5"> he demonstrated</font>

781
00:31:51,890 --> 00:31:57,740
<font color="#E5E5E5">responder earlier a very valuable tool</font>

782
00:31:54,880 --> 00:31:59,720
<font color="#CCCCCC">but</font><font color="#E5E5E5"> they're also for for</font><font color="#CCCCCC"> man in the</font>

783
00:31:57,740 --> 00:32:02,360
middle tools there's you know better tap

784
00:31:59,720 --> 00:32:04,429
enter capped<font color="#E5E5E5"> Cain and Abel</font><font color="#CCCCCC"> are there's a</font>

785
00:32:02,360 --> 00:32:07,040
ton of various<font color="#E5E5E5"> man-in-the-middle of</font>

786
00:32:04,429 --> 00:32:08,660
tools<font color="#E5E5E5"> out there which can</font><font color="#CCCCCC"> assist an</font>

787
00:32:07,040 --> 00:32:13,159
attacker<font color="#CCCCCC"> and in gaining</font><font color="#E5E5E5"> some of those</font>

788
00:32:08,660 --> 00:32:15,679
<font color="#E5E5E5">credentials</font><font color="#CCCCCC"> one tool that has</font><font color="#E5E5E5"> NT on</font>

789
00:32:13,160 --> 00:32:19,730
relaying<font color="#E5E5E5"> on the horizon is the</font><font color="#CCCCCC"> seth tool</font>

790
00:32:15,679 --> 00:32:21,140
<font color="#E5E5E5">can not not set seth toolkit for</font><font color="#CCCCCC"> RDP</font>

791
00:32:19,730 --> 00:32:23,090
<font color="#CCCCCC">man-in-the-middle created by adrian</font>

792
00:32:21,140 --> 00:32:25,340
<font color="#CCCCCC">boulevard</font><font color="#E5E5E5"> so really it's a really neat</font>

793
00:32:23,090 --> 00:32:27,139
tool<font color="#E5E5E5"> under active development includes a</font>

794
00:32:25,340 --> 00:32:31,129
lot of<font color="#E5E5E5"> you know potential downgrade</font>

795
00:32:27,140 --> 00:32:33,080
attacks against RDP another<font color="#E5E5E5"> related</font>

796
00:32:31,130 --> 00:32:35,299
things you can grab the<font color="#E5E5E5"> Intel and hashes</font>

797
00:32:33,080 --> 00:32:37,399
<font color="#E5E5E5">it can't relay them yet that is a</font>

798
00:32:35,299 --> 00:32:41,270
feature on the<font color="#E5E5E5"> wish list hopefully</font><font color="#CCCCCC"> is</font>

799
00:32:37,400 --> 00:32:42,320
coming soon<font color="#E5E5E5"> so enough of the bad news</font>

800
00:32:41,270 --> 00:32:43,370
I'm going to talk<font color="#CCCCCC"> about some of</font><font color="#E5E5E5"> the good</font>

801
00:32:42,320 --> 00:32:45,350
<font color="#CCCCCC">news some of</font><font color="#E5E5E5"> the ways you can</font><font color="#CCCCCC"> actually</font>

802
00:32:43,370 --> 00:32:47,360
defend<font color="#E5E5E5"> your network against these</font>

803
00:32:45,350 --> 00:32:49,969
attacks<font color="#CCCCCC"> and the best way to do so is</font><font color="#E5E5E5"> to</font>

804
00:32:47,360 --> 00:32:52,790
just<font color="#E5E5E5"> flat-out disable ntlm right there's</font>

805
00:32:49,970 --> 00:32:54,169
a GPO<font color="#CCCCCC"> checkbox</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> can hit</font><font color="#E5E5E5"> turn off ntlm</font>

806
00:32:52,790 --> 00:32:56,960
so none of<font color="#E5E5E5"> your machines on your network</font>

807
00:32:54,169 --> 00:32:59,179
accepts or<font color="#E5E5E5"> transmit ntlm authentication</font>

808
00:32:56,960 --> 00:33:01,100
attempts and in this<font color="#E5E5E5"> case you'd be</font>

809
00:32:59,179 --> 00:33:04,520
ruining<font color="#E5E5E5"> relying on Kerberos</font><font color="#CCCCCC"> and your</font>

810
00:33:01,100 --> 00:33:06,280
domain<font color="#CCCCCC"> controllers for authentication</font><font color="#E5E5E5"> it</font>

811
00:33:04,520 --> 00:33:09,370
is in theory<font color="#CCCCCC"> 100% effective</font>

812
00:33:06,280 --> 00:33:11,740
yet I've<font color="#CCCCCC"> never actually seen a network</font>

813
00:33:09,370 --> 00:33:14,139
that has properly disabled ntlm for all

814
00:33:11,740 --> 00:33:15,850
machines<font color="#E5E5E5"> and the reason for</font><font color="#CCCCCC"> that is as</font>

815
00:33:14,140 --> 00:33:18,160
networks get larger<font color="#CCCCCC"> or have the old</font>

816
00:33:15,850 --> 00:33:21,270
services legacy applications<font color="#E5E5E5"> the</font>

817
00:33:18,160 --> 00:33:24,040
likelihood of breakage<font color="#E5E5E5"> by disabling ntlm</font>

818
00:33:21,270 --> 00:33:25,900
becomes higher<font color="#CCCCCC"> and higher</font><font color="#E5E5E5"> on the plus</font>

819
00:33:24,040 --> 00:33:28,120
<font color="#CCCCCC">side these problems are usually fixable</font>

820
00:33:25,900 --> 00:33:30,100
but in production networks you know

821
00:33:28,120 --> 00:33:33,570
there's<font color="#CCCCCC"> Jim</font><font color="#E5E5E5"> rain and typically towards</font>

822
00:33:30,100 --> 00:33:33,570
<font color="#CCCCCC">making changes which might break them</font>

823
00:33:33,930 --> 00:33:40,960
<font color="#CCCCCC">depends number</font><font color="#E5E5E5"> two LDAP and SMB</font>

824
00:33:36,970 --> 00:33:43,090
specifically include signing option it's

825
00:33:40,960 --> 00:33:44,410
disabled by default<font color="#CCCCCC"> I don't know why but</font>

826
00:33:43,090 --> 00:33:47,169
it's disabled by default<font color="#E5E5E5"> on Windows</font>

827
00:33:44,410 --> 00:33:52,390
networks<font color="#E5E5E5"> very easy to enable another GPO</font>

828
00:33:47,170 --> 00:33:55,330
you could another GPO<font color="#CCCCCC"> checkbox you</font><font color="#E5E5E5"> can</font>

829
00:33:52,390 --> 00:33:56,440
<font color="#CCCCCC">just hit and it closes</font><font color="#E5E5E5"> the hole on</font><font color="#CCCCCC"> two</font>

830
00:33:55,330 --> 00:34:00,220
<font color="#E5E5E5">of one of the most vulnerable</font>

831
00:33:56,440 --> 00:34:02,680
applications<font color="#CCCCCC"> doing so</font><font color="#E5E5E5"> may cause</font><font color="#CCCCCC"> some</font>

832
00:34:00,220 --> 00:34:05,110
<font color="#E5E5E5">legacy applications to not work in my</font>

833
00:34:02,680 --> 00:34:07,510
experience it's very<font color="#E5E5E5"> uncommon that</font>

834
00:34:05,110 --> 00:34:10,270
that's that's an<font color="#E5E5E5"> issue it will impact</font>

835
00:34:07,510 --> 00:34:12,070
the performance<font color="#E5E5E5"> of SMB by about</font><font color="#CCCCCC"> fifteen</font>

836
00:34:10,270 --> 00:34:13,509
<font color="#CCCCCC">percent</font><font color="#E5E5E5"> but I think we can usually live</font>

837
00:34:12,070 --> 00:34:15,490
with the<font color="#E5E5E5"> 15 percent degradation and</font>

838
00:34:13,510 --> 00:34:19,720
performance for for plugging this

839
00:34:15,489 --> 00:34:21,850
particular hole<font color="#CCCCCC"> defense</font><font color="#E5E5E5"> number three is</font>

840
00:34:19,719 --> 00:34:24,060
<font color="#CCCCCC">something called microsoft's epa</font>

841
00:34:21,850 --> 00:34:26,469
extended<font color="#CCCCCC"> protection for authentication</font>

842
00:34:24,060 --> 00:34:27,909
<font color="#CCCCCC">also known as channel binding token</font>

843
00:34:26,469 --> 00:34:30,129
that's<font color="#E5E5E5"> a bit of a it's a bit of a</font>

844
00:34:27,909 --> 00:34:33,310
mouthful but<font color="#CCCCCC"> EPA</font><font color="#E5E5E5"> is also a little</font><font color="#CCCCCC"> bit</font>

845
00:34:30,129 --> 00:34:34,629
<font color="#E5E5E5">ambiguous</font><font color="#CCCCCC"> when you try to</font><font color="#E5E5E5"> google it</font><font color="#CCCCCC"> it</font>

846
00:34:33,310 --> 00:34:37,870
does bring<font color="#E5E5E5"> the equivalent of LDAP</font>

847
00:34:34,629 --> 00:34:40,629
signing<font color="#E5E5E5"> in to HTTPS</font><font color="#CCCCCC"> but it has the</font>

848
00:34:37,870 --> 00:34:43,239
downside that<font color="#E5E5E5"> each application needs to</font>

849
00:34:40,629 --> 00:34:45,279
support<font color="#E5E5E5"> it or opt in on an application</font>

850
00:34:43,239 --> 00:34:47,138
<font color="#E5E5E5">of application basis and there's no easy</font>

851
00:34:45,280 --> 00:34:49,570
you know GPO so we can just<font color="#E5E5E5"> check no</font>

852
00:34:47,139 --> 00:34:51,610
easy way to to<font color="#E5E5E5"> verify</font><font color="#CCCCCC"> there early</font><font color="#E5E5E5"> to</font>

853
00:34:49,570 --> 00:34:54,520
like automate turning it on so to<font color="#CCCCCC"> speak</font>

854
00:34:51,610 --> 00:34:57,510
I know sequel server 2012 exchange 2010

855
00:34:54,520 --> 00:35:00,820
<font color="#E5E5E5">and others support it I'm not</font><font color="#CCCCCC"> sure</font>

856
00:34:57,510 --> 00:35:02,410
<font color="#E5E5E5">exactly how widespread it is</font><font color="#CCCCCC"> and part of</font>

857
00:35:00,820 --> 00:35:04,630
the downside is that<font color="#E5E5E5"> it has to be</font><font color="#CCCCCC"> also</font>

858
00:35:02,410 --> 00:35:06,460
enabled on clients through registry

859
00:35:04,630 --> 00:35:09,940
registry<font color="#E5E5E5"> keys again there's no</font>

860
00:35:06,460 --> 00:35:11,880
convenient checkbox<font color="#CCCCCC"> gpo's on top of that</font>

861
00:35:09,940 --> 00:35:16,000
a<font color="#E5E5E5"> requires support</font><font color="#CCCCCC"> of the browser</font>

862
00:35:11,880 --> 00:35:19,559
<font color="#E5E5E5">accessing resource</font><font color="#CCCCCC"> chrome</font><font color="#E5E5E5"> and obviously</font>

863
00:35:16,000 --> 00:35:21,689
<font color="#CCCCCC">ie and edge</font><font color="#E5E5E5"> support it Firefox last time</font>

864
00:35:19,559 --> 00:35:24,049
<font color="#E5E5E5">checked sadly does not so if an</font>

865
00:35:21,689 --> 00:35:27,299
organization<font color="#E5E5E5"> is relying on Firefox</font>

866
00:35:24,049 --> 00:35:31,979
<font color="#E5E5E5">turning this on may break their ability</font>

867
00:35:27,299 --> 00:35:34,170
to<font color="#E5E5E5"> access certain</font><font color="#CCCCCC"> web sites defense</font>

868
00:35:31,979 --> 00:35:35,968
<font color="#CCCCCC">number four which I</font><font color="#E5E5E5"> recognize for any</font>

869
00:35:34,170 --> 00:35:38,430
organ which<font color="#E5E5E5"> I recommend for any</font>

870
00:35:35,969 --> 00:35:41,069
<font color="#E5E5E5">organization is aggressive use of</font>

871
00:35:38,430 --> 00:35:42,629
segmentation<font color="#E5E5E5"> ideally you know you have</font>

872
00:35:41,069 --> 00:35:44,339
fewer computers<font color="#E5E5E5"> together on the same</font>

873
00:35:42,630 --> 00:35:46,199
<font color="#E5E5E5">network</font><font color="#CCCCCC"> segment</font><font color="#E5E5E5"> there's fewer chances</font>

874
00:35:44,339 --> 00:35:49,349
<font color="#E5E5E5">for an attacker to intercept handshakes</font>

875
00:35:46,199 --> 00:35:52,380
right<font color="#E5E5E5"> so if Kyle clicks on links from</font>

876
00:35:49,349 --> 00:35:53,789
accounting has his computer<font color="#E5E5E5"> infected you</font>

877
00:35:52,380 --> 00:35:55,949
know there's no<font color="#E5E5E5"> there's no easy way for</font>

878
00:35:53,789 --> 00:35:57,630
<font color="#CCCCCC">him to intercept a privileged users and</font>

879
00:35:55,949 --> 00:35:59,549
<font color="#CCCCCC">he'll end handshake if all</font><font color="#E5E5E5"> of your</font>

880
00:35:57,630 --> 00:36:01,680
admins and<font color="#CCCCCC"> Tech's</font><font color="#E5E5E5"> are in a completely</font>

881
00:35:59,549 --> 00:36:03,630
separate<font color="#CCCCCC"> Network</font><font color="#E5E5E5"> segment and VLAN right</font>

882
00:36:01,680 --> 00:36:04,948
<font color="#E5E5E5">and also don't forget</font><font color="#CCCCCC"> to control your</font>

883
00:36:03,630 --> 00:36:07,140
ports<font color="#E5E5E5"> right I've seen</font><font color="#CCCCCC"> way too many</font>

884
00:36:04,949 --> 00:36:08,939
organizations where you know the

885
00:36:07,140 --> 00:36:11,910
accounting computers can connect to the

886
00:36:08,939 --> 00:36:14,038
CEOs computers on ports<font color="#CCCCCC"> 4 4 5</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> 135</font>

887
00:36:11,910 --> 00:36:16,259
right there's no<font color="#E5E5E5"> reason for that</font><font color="#CCCCCC"> lock</font>

888
00:36:14,039 --> 00:36:18,329
<font color="#E5E5E5">that down right this is ridiculous</font>

889
00:36:16,259 --> 00:36:19,890
and<font color="#E5E5E5"> particularly if you're using</font><font color="#CCCCCC"> a</font>

890
00:36:18,329 --> 00:36:21,269
centralized<font color="#CCCCCC"> file sharing service you</font>

891
00:36:19,890 --> 00:36:24,209
know if you use<font color="#E5E5E5"> if you have a SharePoint</font>

892
00:36:21,269 --> 00:36:26,098
or a<font color="#CCCCCC"> backed-up</font><font color="#E5E5E5"> file share why is there</font>

893
00:36:24,209 --> 00:36:27,239
this<font color="#E5E5E5"> you know</font><font color="#CCCCCC"> computer-to-computer file</font>

894
00:36:26,099 --> 00:36:30,089
sharing even allowed

895
00:36:27,239 --> 00:36:32,189
there's no reason<font color="#E5E5E5"> unfortunately at this</font>

896
00:36:30,089 --> 00:36:33,719
<font color="#E5E5E5">point</font><font color="#CCCCCC"> though we're</font><font color="#E5E5E5"> not really solving</font>

897
00:36:32,189 --> 00:36:35,609
<font color="#E5E5E5">the problem so</font><font color="#CCCCCC"> much as controlling the</font>

898
00:36:33,719 --> 00:36:39,929
damage trying<font color="#CCCCCC"> to isolate it as best we</font>

899
00:36:35,609 --> 00:36:41,670
can<font color="#CCCCCC"> a few other defenses which don't</font>

900
00:36:39,929 --> 00:36:45,959
<font color="#E5E5E5">really address the problem directly</font>

901
00:36:41,670 --> 00:36:49,259
<font color="#E5E5E5">either we still allow only ntlm to</font><font color="#CCCCCC"> again</font>

902
00:36:45,959 --> 00:36:51,178
<font color="#E5E5E5">very easy to do via GPO</font><font color="#CCCCCC"> this slightly</font>

903
00:36:49,259 --> 00:36:53,999
reduces the crack ability of<font color="#E5E5E5"> handshakes</font>

904
00:36:51,179 --> 00:36:55,949
by<font color="#E5E5E5"> preventing ntlm</font><font color="#CCCCCC"> 1 handshakes from</font>

905
00:36:53,999 --> 00:36:57,678
being transmitted doesn't solve the

906
00:36:55,949 --> 00:37:00,150
<font color="#CCCCCC">problem of relaying at all unfortunately</font>

907
00:36:57,679 --> 00:37:01,469
<font color="#E5E5E5">however I've</font><font color="#CCCCCC"> never encountered I've</font>

908
00:37:00,150 --> 00:37:02,849
never encountered something breaking

909
00:37:01,469 --> 00:37:06,329
because<font color="#E5E5E5"> of it so</font><font color="#CCCCCC"> you may as</font><font color="#E5E5E5"> well turn it</font>

910
00:37:02,849 --> 00:37:09,059
on<font color="#CCCCCC"> another thing you can do is disable</font>

911
00:37:06,329 --> 00:37:14,069
those the name resolution<font color="#CCCCCC"> broadcast</font>

912
00:37:09,059 --> 00:37:16,619
attempts<font color="#CCCCCC"> NBT and SLM in</font><font color="#E5E5E5"> our mdns</font><font color="#CCCCCC"> fairly</font>

913
00:37:14,069 --> 00:37:18,150
<font color="#E5E5E5">easy</font><font color="#CCCCCC"> to turn off remember by doing so</font>

914
00:37:16,619 --> 00:37:20,849
you make<font color="#CCCCCC"> it much harder for</font><font color="#E5E5E5"> an attacker</font>

915
00:37:18,150 --> 00:37:22,499
<font color="#E5E5E5">to solicit authentication attempts by</font>

916
00:37:20,849 --> 00:37:26,069
answering<font color="#E5E5E5"> these multicast name</font>

917
00:37:22,499 --> 00:37:28,828
resolution attempts<font color="#E5E5E5"> the chance of</font>

918
00:37:26,069 --> 00:37:32,549
breakage unfortunately is fairly high<font color="#E5E5E5"> if</font>

919
00:37:28,829 --> 00:37:34,079
<font color="#E5E5E5">you disable those you know a lot of</font>

920
00:37:32,549 --> 00:37:37,288
<font color="#CCCCCC">properly configured with their</font><font color="#E5E5E5"> internal</font>

921
00:37:34,079 --> 00:37:41,160
DNS<font color="#E5E5E5"> and rely on multicast DNS to resolve</font>

922
00:37:37,289 --> 00:37:42,749
names internally of course you could

923
00:37:41,160 --> 00:37:44,519
deploy<font color="#E5E5E5"> man-in-the-middle protections</font>

924
00:37:42,749 --> 00:37:46,948
always a good<font color="#E5E5E5"> idea for a variety of</font>

925
00:37:44,519 --> 00:37:48,269
reasons<font color="#E5E5E5"> it is</font><font color="#CCCCCC"> unfortunately much easier</font>

926
00:37:46,949 --> 00:37:50,249
said than done there's a couple<font color="#E5E5E5"> of</font>

927
00:37:48,269 --> 00:37:51,419
protections<font color="#CCCCCC"> that where</font><font color="#E5E5E5"> the Cure's</font>

928
00:37:50,249 --> 00:37:53,848
sometimes a<font color="#CCCCCC"> little</font><font color="#E5E5E5"> bit worse</font><font color="#CCCCCC"> than</font><font color="#E5E5E5"> the</font>

929
00:37:51,420 --> 00:37:55,199
<font color="#CCCCCC">disease</font><font color="#E5E5E5"> and and if you remember</font><font color="#CCCCCC"> that big</font>

930
00:37:53,849 --> 00:37:56,609
list<font color="#E5E5E5"> that I had and there's so many</font>

931
00:37:55,199 --> 00:37:58,799
<font color="#E5E5E5">different ways of performing a</font>

932
00:37:56,609 --> 00:38:02,219
man-in-the-middle attack you know it's

933
00:37:58,799 --> 00:38:04,429
hard<font color="#CCCCCC"> to get them all you can use strong</font>

934
00:38:02,219 --> 00:38:07,109
passwords again<font color="#E5E5E5"> always good advice</font>

935
00:38:04,429 --> 00:38:09,359
<font color="#CCCCCC">prevent</font><font color="#E5E5E5"> you know</font><font color="#CCCCCC"> prevent</font><font color="#E5E5E5"> an attacker</font>

936
00:38:07,109 --> 00:38:11,939
from being able<font color="#E5E5E5"> to actually crack those</font>

937
00:38:09,359 --> 00:38:13,049
ntlm authentication hashes<font color="#E5E5E5"> this of</font>

938
00:38:11,939 --> 00:38:14,640
course<font color="#E5E5E5"> doesn't solve the problem</font><font color="#CCCCCC"> of</font>

939
00:38:13,049 --> 00:38:16,679
relaying but you know at<font color="#CCCCCC"> least it's a</font>

940
00:38:14,640 --> 00:38:17,910
step in<font color="#CCCCCC"> the right</font><font color="#E5E5E5"> direction and of</font>

941
00:38:16,679 --> 00:38:19,019
course one<font color="#CCCCCC"> of the</font><font color="#E5E5E5"> best things you can do</font>

942
00:38:17,910 --> 00:38:20,689
is just<font color="#E5E5E5"> keep attackers out of your</font>

943
00:38:19,019 --> 00:38:23,519
<font color="#E5E5E5">network in the first place and I mean</font>

944
00:38:20,689 --> 00:38:24,779
I'm also very easier said than done but

945
00:38:23,519 --> 00:38:26,819
<font color="#E5E5E5">I mean that's always should be our</font>

946
00:38:24,779 --> 00:38:28,529
effort<font color="#E5E5E5"> you know practice good</font><font color="#CCCCCC"> endpoint</font>

947
00:38:26,819 --> 00:38:31,469
and edge protection you know it<font color="#E5E5E5"> use 802</font>

948
00:38:28,529 --> 00:38:35,609
<font color="#E5E5E5">One X and the Wi-Fi security</font><font color="#CCCCCC"> user</font>

949
00:38:31,469 --> 00:38:37,709
<font color="#CCCCCC">education always a good idea</font><font color="#E5E5E5"> to so that</font>

950
00:38:35,609 --> 00:38:39,449
actually is all I really<font color="#E5E5E5"> have to say</font>

951
00:38:37,709 --> 00:38:40,979
<font color="#CCCCCC">about</font><font color="#E5E5E5"> that or rather than it's a small</font>

952
00:38:39,449 --> 00:38:43,019
<font color="#CCCCCC">section of what I have</font><font color="#E5E5E5"> to say about that</font>

953
00:38:40,979 --> 00:38:44,939
<font color="#E5E5E5">but due to the</font><font color="#CCCCCC"> limited amount</font><font color="#E5E5E5"> of time</font><font color="#CCCCCC"> I</font>

954
00:38:43,019 --> 00:38:46,229
had that<font color="#E5E5E5"> with my condensed version so I</font>

955
00:38:44,939 --> 00:38:48,239
don't know how are we good for time

956
00:38:46,229 --> 00:38:52,288
<font color="#E5E5E5">right now is anybody</font><font color="#CCCCCC"> know we're good</font>

957
00:38:48,239 --> 00:38:54,119
<font color="#CCCCCC">okay</font><font color="#E5E5E5"> so family 15 minutes home</font><font color="#CCCCCC"> I should</font>

958
00:38:52,289 --> 00:38:57,289
<font color="#E5E5E5">just look down next</font><font color="#CCCCCC"> time all</font><font color="#E5E5E5"> right we</font>

959
00:38:54,119 --> 00:38:57,289
got a<font color="#CCCCCC"> question there so let hit me</font>

960
00:39:19,099 --> 00:39:23,130
<font color="#CCCCCC">that's right and I'm sorry</font><font color="#E5E5E5"> if I kind</font><font color="#CCCCCC"> of</font>

961
00:39:21,539 --> 00:39:25,349
<font color="#E5E5E5">gloss</font><font color="#CCCCCC"> that over the question or the</font>

962
00:39:23,130 --> 00:39:27,150
<font color="#E5E5E5">point was</font><font color="#CCCCCC"> that a standard</font><font color="#E5E5E5"> user should</font>

963
00:39:25,349 --> 00:39:28,739
not<font color="#E5E5E5"> have access to</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> information</font>

964
00:39:27,150 --> 00:39:29,309
<font color="#E5E5E5">stored by</font><font color="#CCCCCC"> lab so that's</font><font color="#E5E5E5"> absolutely</font>

965
00:39:28,739 --> 00:39:32,549
<font color="#CCCCCC">correct</font>

966
00:39:29,309 --> 00:39:34,349
<font color="#CCCCCC">it is</font><font color="#E5E5E5"> I believe I haven't used</font><font color="#CCCCCC"> laughs</font>

967
00:39:32,549 --> 00:39:37,288
myself<font color="#E5E5E5"> but my understanding is that</font>

968
00:39:34,349 --> 00:39:39,630
<font color="#E5E5E5">lapse can be configured to allow certain</font>

969
00:39:37,289 --> 00:39:41,279
users<font color="#E5E5E5"> other than domain admin users so</font>

970
00:39:39,630 --> 00:39:43,679
<font color="#E5E5E5">you know your text or whatever their</font>

971
00:39:41,279 --> 00:39:46,460
users can also<font color="#CCCCCC"> access</font><font color="#E5E5E5"> laps</font><font color="#CCCCCC"> if you</font>

972
00:39:43,679 --> 00:39:55,979
configure<font color="#CCCCCC"> it that way</font>

973
00:39:46,460 --> 00:40:02,020
yes that would<font color="#CCCCCC"> be</font><font color="#E5E5E5"> yeah anybody</font><font color="#CCCCCC"> else</font><font color="#E5E5E5"> my</font>

974
00:39:55,979 --> 00:40:04,669
off the hook<font color="#CCCCCC"> Oh funny you should ask</font>

975
00:40:02,020 --> 00:40:09,989
[Laughter]

976
00:40:04,670 --> 00:40:10,319
anybody else anybody good of<font color="#E5E5E5"> you to</font>

977
00:40:09,989 --> 00:40:12,749
notice

978
00:40:10,319 --> 00:40:31,380
yeah you<font color="#CCCCCC"> they're the short one in the</font>

979
00:40:12,749 --> 00:40:33,689
back yeah that's a good question<font color="#CCCCCC"> the the</font>

980
00:40:31,380 --> 00:40:35,849
<font color="#CCCCCC">question</font><font color="#E5E5E5"> essentially was what about non</font>

981
00:40:33,690 --> 00:40:40,079
Windows machines that use services like

982
00:40:35,849 --> 00:40:42,029
<font color="#E5E5E5">Bonjour or or</font><font color="#CCCCCC"> Samba</font><font color="#E5E5E5"> that'll vary a lot</font>

983
00:40:40,079 --> 00:40:43,979
between the tool<font color="#E5E5E5"> being</font><font color="#CCCCCC"> used</font>

984
00:40:42,029 --> 00:40:46,880
I know Samba has support for ntlm

985
00:40:43,979 --> 00:40:49,200
generally you can't authenticate into

986
00:40:46,880 --> 00:40:50,819
<font color="#E5E5E5">those machines this is</font><font color="#CCCCCC"> very much a</font>

987
00:40:49,200 --> 00:40:52,919
generality<font color="#CCCCCC"> you can't authenticate into</font>

988
00:40:50,819 --> 00:40:54,619
<font color="#E5E5E5">those machines but they will frequently</font>

989
00:40:52,920 --> 00:40:57,569
<font color="#E5E5E5">if they're trying</font><font color="#CCCCCC"> to connect to like a</font>

990
00:40:54,619 --> 00:40:59,999
share on<font color="#CCCCCC"> the network</font><font color="#E5E5E5"> they will emit they</font>

991
00:40:57,569 --> 00:41:02,489
ntlm hashes<font color="#CCCCCC"> are antolín handshakes</font>

992
00:40:59,999 --> 00:41:05,269
rather that<font color="#E5E5E5"> you can also capture even</font>

993
00:41:02,489 --> 00:41:19,440
though they're not Windows machines<font color="#CCCCCC"> oh</font>

994
00:41:05,269 --> 00:41:22,379
yeah<font color="#CCCCCC"> what is what is the current state</font>

995
00:41:19,440 --> 00:41:24,420
<font color="#E5E5E5">of detection for doing</font><font color="#CCCCCC"> an ntlm relaying</font>

996
00:41:22,380 --> 00:41:25,979
and man in<font color="#E5E5E5"> the middle attacks generally</font>

997
00:41:24,420 --> 00:41:30,390
pretty poor is kind of how I<font color="#E5E5E5"> would</font>

998
00:41:25,979 --> 00:41:33,808
<font color="#CCCCCC">describe it some of them are like via</font>

999
00:41:30,390 --> 00:41:35,848
the example I gave during<font color="#E5E5E5"> the demo</font><font color="#CCCCCC"> that</font>

1000
00:41:33,809 --> 00:41:38,489
looks like fairly you<font color="#CCCCCC"> know regular</font>

1001
00:41:35,849 --> 00:41:39,809
behavior<font color="#CCCCCC"> right and that one's gonna be</font>

1002
00:41:38,489 --> 00:41:43,019
<font color="#E5E5E5">very hard</font><font color="#CCCCCC"> to detect</font>

1003
00:41:39,809 --> 00:41:45,210
<font color="#E5E5E5">then in the middle attacks it'll</font><font color="#CCCCCC"> depend</font>

1004
00:41:43,019 --> 00:41:47,519
a lot on<font color="#E5E5E5"> the attack itself there are</font>

1005
00:41:45,210 --> 00:41:50,069
tools for<font color="#CCCCCC"> instance for detecting ARP</font>

1006
00:41:47,519 --> 00:41:52,499
spoofing and that sort of thing<font color="#CCCCCC"> and</font>

1007
00:41:50,069 --> 00:41:55,619
<font color="#E5E5E5">there are tools for you know seeing</font>

1008
00:41:52,499 --> 00:41:58,288
unsolicited<font color="#E5E5E5"> DNS responses or DNS</font>

1009
00:41:55,619 --> 00:41:58,470
responses that<font color="#E5E5E5"> don't make sense</font><font color="#CCCCCC"> so there</font>

1010
00:41:58,289 --> 00:42:00,359
<font color="#E5E5E5">are</font>

1011
00:41:58,470 --> 00:42:05,750
tools out there that<font color="#E5E5E5"> will</font><font color="#CCCCCC"> help to detect</font>

1012
00:42:00,359 --> 00:42:05,750
<font color="#E5E5E5">but generally speaking it's not great</font>

1013
00:42:07,970 --> 00:42:12,890
anymore<font color="#CCCCCC"> am i off the hook</font><font color="#E5E5E5"> the other</font><font color="#CCCCCC"> one</font>

1014
00:42:16,160 --> 00:42:22,259
this<font color="#E5E5E5"> is all completely</font><font color="#CCCCCC"> mitigated with</font>

1015
00:42:19,200 --> 00:42:24,000
<font color="#E5E5E5">cameras right exactly</font><font color="#CCCCCC"> yeah</font>

1016
00:42:22,260 --> 00:42:26,400
Kerberos is<font color="#E5E5E5"> great</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> mean the Kerberos</font>

1017
00:42:24,000 --> 00:42:27,900
has its own weaknesses<font color="#E5E5E5"> and issues but</font>

1018
00:42:26,400 --> 00:42:30,900
they're not nearly<font color="#E5E5E5"> as severe as this</font>

1019
00:42:27,900 --> 00:42:34,109
right<font color="#CCCCCC"> particularly</font><font color="#E5E5E5"> if you configure</font><font color="#CCCCCC"> it</font>

1020
00:42:30,900 --> 00:42:36,990
to rely on on AES<font color="#CCCCCC"> as opposed to arc four</font>

1021
00:42:34,109 --> 00:42:39,569
or something<font color="#CCCCCC"> like</font><font color="#E5E5E5"> that so use Kerberos</font>

1022
00:42:36,990 --> 00:42:48,259
<font color="#E5E5E5">turn off in CLM that's kind of the short</font>

1023
00:42:39,569 --> 00:42:48,259
version<font color="#E5E5E5"> anymore okay I think that's it</font>

1024
00:42:48,980 --> 00:42:51,980
okay

1025
00:42:54,400 --> 00:42:56,979
[Applause]

