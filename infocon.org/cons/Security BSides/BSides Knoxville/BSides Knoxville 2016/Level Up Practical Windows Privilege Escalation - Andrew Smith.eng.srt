1
00:00:00,480 --> 00:00:07,340
and so this<font color="#E5E5E5"> talk was born out of just my</font>

2
00:00:03,419 --> 00:00:09,870
personal experience in doing engagements

3
00:00:07,340 --> 00:00:12,000
<font color="#E5E5E5">like when I when I do land on a machine</font>

4
00:00:09,870 --> 00:00:14,759
<font color="#E5E5E5">things that I see often or I work with</font>

5
00:00:12,000 --> 00:00:16,529
<font color="#CCCCCC">clients often</font><font color="#E5E5E5"> on as far</font><font color="#CCCCCC"> as local</font>

6
00:00:14,759 --> 00:00:20,189
privilege escalation goes in a Windows

7
00:00:16,529 --> 00:00:23,039
environment<font color="#E5E5E5"> so first we're going to talk</font>

8
00:00:20,189 --> 00:00:25,890
<font color="#CCCCCC">a little bit about some relevant Windows</font>

9
00:00:23,039 --> 00:00:27,990
security info<font color="#CCCCCC"> and then</font><font color="#E5E5E5"> we're going</font><font color="#CCCCCC"> to</font>

10
00:00:25,890 --> 00:00:30,210
get into<font color="#E5E5E5"> some tricks like I said from my</font>

11
00:00:27,990 --> 00:00:35,879
<font color="#E5E5E5">own personal experience</font><font color="#CCCCCC"> that I think are</font>

12
00:00:30,210 --> 00:00:38,610
<font color="#CCCCCC">interesting or I run into a lot so</font><font color="#E5E5E5"> why</font>

13
00:00:35,880 --> 00:00:42,030
do you<font color="#E5E5E5"> why should you care</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> if</font>

14
00:00:38,610 --> 00:00:44,280
you work on the offensive<font color="#CCCCCC"> side</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> you</font>

15
00:00:42,030 --> 00:00:46,079
are doing engagements this can perhaps

16
00:00:44,280 --> 00:00:47,460
help<font color="#E5E5E5"> you think of some new things or</font>

17
00:00:46,079 --> 00:00:50,460
<font color="#E5E5E5">maybe it's some new techniques</font><font color="#CCCCCC"> that you</font>

18
00:00:47,460 --> 00:00:52,199
haven't seen<font color="#CCCCCC"> before if you are on</font>

19
00:00:50,460 --> 00:00:55,140
defense<font color="#CCCCCC"> and you want to prevent this</font>

20
00:00:52,199 --> 00:00:58,019
kind<font color="#E5E5E5"> of thing</font><font color="#CCCCCC"> I get I get questions a</font>

21
00:00:55,140 --> 00:00:59,910
lot like why should<font color="#CCCCCC"> I care</font><font color="#E5E5E5"> about local</font>

22
00:00:58,020 --> 00:01:01,890
<font color="#CCCCCC">privileged escalation</font><font color="#E5E5E5"> that's that's not</font>

23
00:00:59,910 --> 00:01:04,080
like if I'm joined to a Windows domain<font color="#CCCCCC"> I</font>

24
00:01:01,890 --> 00:01:07,170
really<font color="#E5E5E5"> don't care it's</font><font color="#CCCCCC"> just a local</font><font color="#E5E5E5"> box</font>

25
00:01:04,080 --> 00:01:12,179
like what<font color="#E5E5E5"> does it really matter</font><font color="#CCCCCC"> and if</font>

26
00:01:07,170 --> 00:01:13,409
that is you<font color="#CCCCCC"> I would encourage you</font><font color="#E5E5E5"> how</font>

27
00:01:12,180 --> 00:01:17,520
<font color="#E5E5E5">many people in</font><font color="#CCCCCC"> here</font><font color="#E5E5E5"> have heard of mini</font>

28
00:01:13,409 --> 00:01:20,729
cats<font color="#E5E5E5"> okay good a lot of people if you're</font>

29
00:01:17,520 --> 00:01:23,310
<font color="#E5E5E5">not really</font><font color="#CCCCCC"> if the concept</font><font color="#E5E5E5"> is lost on you</font>

30
00:01:20,729 --> 00:01:24,990
<font color="#E5E5E5">that local privilege escalation and</font>

31
00:01:23,310 --> 00:01:27,570
becoming a<font color="#E5E5E5"> local admin on a box that's</font>

32
00:01:24,990 --> 00:01:29,100
joined to a Windows domain<font color="#E5E5E5"> often results</font>

33
00:01:27,570 --> 00:01:31,139
in the<font color="#E5E5E5"> downfall</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the entire rest of</font>

34
00:01:29,100 --> 00:01:34,048
the domain<font color="#CCCCCC"> I would really encourage you</font>

35
00:01:31,140 --> 00:01:37,590
to<font color="#E5E5E5"> look</font><font color="#CCCCCC"> up some talks or some papers</font><font color="#E5E5E5"> on</font>

36
00:01:34,049 --> 00:01:39,450
mini cats and harvesting credentials

37
00:01:37,590 --> 00:01:44,340
from else asks for single sign-on

38
00:01:39,450 --> 00:01:46,320
purposes it's like the the new hotness I

39
00:01:44,340 --> 00:01:49,460
guess you could<font color="#E5E5E5"> say in lateral movement</font>

40
00:01:46,320 --> 00:01:49,460
within<font color="#E5E5E5"> Windows environments</font>

41
00:01:50,780 --> 00:01:55,340
<font color="#CCCCCC">I try</font><font color="#E5E5E5"> and include this in every talk</font>

42
00:01:53,540 --> 00:01:55,760
<font color="#CCCCCC">that I give because I think</font><font color="#E5E5E5"> the quote is</font>

43
00:01:55,340 --> 00:01:58,159
<font color="#E5E5E5">badass</font>

44
00:01:55,760 --> 00:02:02,330
so I'll give you<font color="#CCCCCC"> a second to read it</font>

45
00:01:58,159 --> 00:02:04,509
this<font color="#E5E5E5"> is by Dan Guido he runs</font><font color="#CCCCCC"> trail of</font>

46
00:02:02,330 --> 00:02:08,408
bits and<font color="#CCCCCC"> he used to</font><font color="#E5E5E5"> do the NYU poly</font>

47
00:02:04,509 --> 00:02:08,408
<font color="#E5E5E5">offensive security curriculum</font>

48
00:02:16,670 --> 00:02:22,069
<font color="#CCCCCC">I think that I really</font><font color="#E5E5E5"> like that quote</font>

49
00:02:20,150 --> 00:02:25,610
<font color="#E5E5E5">perhaps I'm a little biased because this</font>

50
00:02:22,069 --> 00:02:29,859
is the kind of work<font color="#CCCCCC"> that I do</font><font color="#E5E5E5"> but</font><font color="#CCCCCC"> I deal</font>

51
00:02:25,610 --> 00:02:33,350
<font color="#CCCCCC">with clients a lot who are building</font>

52
00:02:29,860 --> 00:02:35,600
networks<font color="#CCCCCC"> without having any kind</font><font color="#E5E5E5"> of</font>

53
00:02:33,350 --> 00:02:40,010
<font color="#CCCCCC">understanding of offensive security</font><font color="#E5E5E5"> at</font>

54
00:02:35,600 --> 00:02:43,130
all<font color="#E5E5E5"> and that typically leads to not good</font>

55
00:02:40,010 --> 00:02:44,030
situations for them so I the the keynote

56
00:02:43,130 --> 00:02:48,109
was awesome by the way

57
00:02:44,030 --> 00:02:49,730
<font color="#CCCCCC">a great job the the fact that offense</font>

58
00:02:48,110 --> 00:02:52,400
should inform defense and<font color="#E5E5E5"> defenses</font>

59
00:02:49,730 --> 00:02:55,040
offensive offenses child<font color="#CCCCCC"> I think is a</font>

60
00:02:52,400 --> 00:03:02,750
particularly important fact to remember

61
00:02:55,040 --> 00:03:03,950
when designing defenses so first we're

62
00:03:02,750 --> 00:03:07,540
going<font color="#E5E5E5"> to do some a little bit of</font>

63
00:03:03,950 --> 00:03:10,569
background<font color="#CCCCCC"> windows security information</font>

64
00:03:07,540 --> 00:03:13,130
related to<font color="#E5E5E5"> local privilege escalation</font>

65
00:03:10,569 --> 00:03:17,030
<font color="#CCCCCC">windows is divided up into securable</font>

66
00:03:13,130 --> 00:03:18,560
objects<font color="#CCCCCC"> and these can</font><font color="#E5E5E5"> be anything on</font>

67
00:03:17,030 --> 00:03:20,630
<font color="#E5E5E5">this list as well as</font><font color="#CCCCCC"> a bunch of other</font>

68
00:03:18,560 --> 00:03:22,700
<font color="#CCCCCC">things but the techniques that</font><font color="#E5E5E5"> I'm going</font>

69
00:03:20,630 --> 00:03:24,440
to<font color="#E5E5E5"> show in</font><font color="#CCCCCC"> this presentation can be</font>

70
00:03:22,700 --> 00:03:27,500
<font color="#E5E5E5">applied</font><font color="#CCCCCC"> to any</font><font color="#E5E5E5"> of these securable</font>

71
00:03:24,440 --> 00:03:29,299
objects<font color="#CCCCCC"> so one of the things we're</font><font color="#E5E5E5"> going</font>

72
00:03:27,500 --> 00:03:31,459
to<font color="#E5E5E5"> get into is like files with bad</font>

73
00:03:29,299 --> 00:03:34,640
permissions that can<font color="#E5E5E5"> apply to registry</font>

74
00:03:31,459 --> 00:03:36,170
<font color="#E5E5E5">keys as</font><font color="#CCCCCC"> well</font><font color="#E5E5E5"> and can affect the security</font>

75
00:03:34,640 --> 00:03:38,450
model<font color="#E5E5E5"> in an interesting way if you can</font>

76
00:03:36,170 --> 00:03:40,190
modify registry keys or<font color="#E5E5E5"> modify data</font>

77
00:03:38,450 --> 00:03:43,459
within registry keys that are<font color="#E5E5E5"> used</font><font color="#CCCCCC"> by</font>

78
00:03:40,190 --> 00:03:46,130
<font color="#CCCCCC">privileged services or applications so</font>

79
00:03:43,459 --> 00:03:48,019
just keep in mind<font color="#E5E5E5"> that the method in</font>

80
00:03:46,130 --> 00:03:50,359
which<font color="#E5E5E5"> we</font><font color="#CCCCCC"> go about</font><font color="#E5E5E5"> trying to elevate</font>

81
00:03:48,019 --> 00:03:51,799
privileges<font color="#E5E5E5"> can be applied in more ways</font>

82
00:03:50,359 --> 00:03:57,560
than<font color="#CCCCCC"> just the ways that</font><font color="#E5E5E5"> I'm going to</font>

83
00:03:51,799 --> 00:03:59,780
show you<font color="#E5E5E5"> today another important piece</font>

84
00:03:57,560 --> 00:04:03,230
<font color="#CCCCCC">of the</font><font color="#E5E5E5"> windows access control</font><font color="#CCCCCC"> model is</font>

85
00:03:59,780 --> 00:04:06,079
the security descriptor<font color="#CCCCCC"> this is</font>

86
00:04:03,230 --> 00:04:08,540
basically<font color="#E5E5E5"> the security</font><font color="#CCCCCC"> information</font>

87
00:04:06,079 --> 00:04:09,920
associated<font color="#CCCCCC"> with each securable</font><font color="#E5E5E5"> object</font>

88
00:04:08,540 --> 00:04:11,959
and it contains a<font color="#E5E5E5"> lot of</font><font color="#CCCCCC"> different</font>

89
00:04:09,920 --> 00:04:13,358
<font color="#CCCCCC">things</font><font color="#E5E5E5"> but</font><font color="#CCCCCC"> for this presentation</font><font color="#E5E5E5"> I'm</font>

90
00:04:11,959 --> 00:04:15,650
mainly going<font color="#CCCCCC"> to focus on the</font>

91
00:04:13,359 --> 00:04:18,650
discretionary access control list or the

92
00:04:15,650 --> 00:04:26,060
dackel<font color="#CCCCCC"> as well as the</font><font color="#E5E5E5"> access control</font>

93
00:04:18,649 --> 00:04:28,729
entries that<font color="#CCCCCC"> are inside them and</font><font color="#E5E5E5"> then</font>

94
00:04:26,060 --> 00:04:30,169
finally the access token<font color="#CCCCCC"> is another</font>

95
00:04:28,729 --> 00:04:30,409
important piece<font color="#E5E5E5"> of information this is</font>

96
00:04:30,169 --> 00:04:34,628
going

97
00:04:30,409 --> 00:04:38,029
be a blob of<font color="#E5E5E5"> data that</font><font color="#CCCCCC"> contains the</font>

98
00:04:34,629 --> 00:04:40,369
users security info<font color="#CCCCCC"> it's going to talk</font>

99
00:04:38,029 --> 00:04:46,939
about who what like what groups your

100
00:04:40,369 --> 00:04:49,939
user is in what your<font color="#E5E5E5"> user name is as</font>

101
00:04:46,939 --> 00:04:53,809
well as the<font color="#E5E5E5"> access rights that your user</font>

102
00:04:49,939 --> 00:04:56,569
<font color="#E5E5E5">is allowed to go after so anytime</font>

103
00:04:53,809 --> 00:04:59,149
<font color="#CCCCCC">anytime you</font><font color="#E5E5E5"> request access to an object</font>

104
00:04:56,569 --> 00:05:01,419
<font color="#CCCCCC">within Windows Windows does the thing</font>

105
00:04:59,149 --> 00:05:04,039
that they call the access check function

106
00:05:01,419 --> 00:05:06,859
which is taking your<font color="#CCCCCC"> security descriptor</font>

107
00:05:04,039 --> 00:05:08,808
as well as the dackel for the object and

108
00:05:06,860 --> 00:05:11,300
<font color="#E5E5E5">determining whether or not you have</font>

109
00:05:08,809 --> 00:05:15,349
<font color="#CCCCCC">sufficient privileges to read or write</font>

110
00:05:11,300 --> 00:05:19,099
<font color="#CCCCCC">or execute that object</font><font color="#E5E5E5"> I like to think</font>

111
00:05:15,349 --> 00:05:21,489
of it<font color="#CCCCCC"> like this a little</font><font color="#E5E5E5"> more less</font>

112
00:05:19,099 --> 00:05:24,919
<font color="#CCCCCC">abstract example I guess you could say</font>

113
00:05:21,489 --> 00:05:30,018
<font color="#E5E5E5">so you show up to the club with your</font>

114
00:05:24,919 --> 00:05:34,909
access token<font color="#CCCCCC"> the object is</font><font color="#E5E5E5"> going to be</font>

115
00:05:30,019 --> 00:05:36,919
<font color="#CCCCCC">defined</font><font color="#E5E5E5"> by the dackel and that object</font><font color="#CCCCCC"> as</font>

116
00:05:34,909 --> 00:05:44,209
<font color="#E5E5E5">well as your access</font><font color="#CCCCCC"> token is checked by</font>

117
00:05:36,919 --> 00:05:46,639
the access check function<font color="#CCCCCC"> another</font>

118
00:05:44,209 --> 00:05:49,729
important piece<font color="#CCCCCC"> of Windows security is</font>

119
00:05:46,639 --> 00:05:51,829
the mandatory integrity control this is

120
00:05:49,729 --> 00:05:55,419
a feature<font color="#CCCCCC"> that was</font><font color="#E5E5E5"> implemented with</font>

121
00:05:51,829 --> 00:05:58,879
Vista<font color="#E5E5E5"> forward to provide per process</font>

122
00:05:55,419 --> 00:06:06,619
<font color="#CCCCCC">integrity levels</font><font color="#E5E5E5"> that represents kind of</font>

123
00:05:58,879 --> 00:06:13,550
the trustworthiness<font color="#E5E5E5"> of each</font><font color="#CCCCCC"> object here</font>

124
00:06:06,619 --> 00:06:15,679
is a very Microsoft<font color="#E5E5E5"> e graph or a list</font>

125
00:06:13,550 --> 00:06:20,389
for the common integrity levels within

126
00:06:15,679 --> 00:06:22,279
<font color="#E5E5E5">Windows</font><font color="#CCCCCC"> important</font><font color="#E5E5E5"> to note is that medium</font>

127
00:06:20,389 --> 00:06:23,989
integrity levels are mostly what we're

128
00:06:22,279 --> 00:06:25,779
going to<font color="#E5E5E5"> be</font><font color="#CCCCCC"> talking about escalating</font>

129
00:06:23,989 --> 00:06:31,099
<font color="#CCCCCC">from medium to</font><font color="#E5E5E5"> high integrity levels</font>

130
00:06:25,779 --> 00:06:32,899
<font color="#E5E5E5">when UAC is enabled by default</font><font color="#CCCCCC"> processes</font>

131
00:06:31,099 --> 00:06:34,399
will be spawned with medium integrity

132
00:06:32,899 --> 00:06:39,769
levels regardless<font color="#CCCCCC"> as to whether or not</font>

133
00:06:34,399 --> 00:06:42,709
<font color="#E5E5E5">the user is a local admin or not but I</font>

134
00:06:39,769 --> 00:06:44,389
<font color="#E5E5E5">think that mario has</font><font color="#CCCCCC"> a does a much</font>

135
00:06:42,709 --> 00:06:46,860
better<font color="#E5E5E5"> job of</font>

136
00:06:44,389 --> 00:06:50,789
<font color="#CCCCCC">indicating the security integrity levels</font>

137
00:06:46,860 --> 00:06:52,800
<font color="#E5E5E5">within windows</font><font color="#CCCCCC"> perhaps even the</font>

138
00:06:50,789 --> 00:06:55,438
designers of<font color="#E5E5E5"> integrity levels played a</font>

139
00:06:52,800 --> 00:06:57,800
<font color="#E5E5E5">bunch of Mario I don't know</font><font color="#CCCCCC"> but as you</font>

140
00:06:55,439 --> 00:07:01,639
can<font color="#E5E5E5"> see it's fairly straightforward</font>

141
00:06:57,800 --> 00:07:04,979
<font color="#CCCCCC">system</font><font color="#E5E5E5"> can destroy the goombahs at will</font>

142
00:07:01,639 --> 00:07:08,430
<font color="#CCCCCC">high integrity</font><font color="#E5E5E5"> levels are kind</font><font color="#CCCCCC"> of what</font>

143
00:07:04,979 --> 00:07:09,960
we're<font color="#E5E5E5"> going to be looking at if you need</font>

144
00:07:08,430 --> 00:07:11,969
to go from a low integral<font color="#E5E5E5"> 'evil to a</font>

145
00:07:09,960 --> 00:07:13,498
medium integrity level<font color="#E5E5E5"> talk to James</font>

146
00:07:11,969 --> 00:07:15,840
<font color="#CCCCCC">Forshaw</font><font color="#E5E5E5"> he's going to be presenting here</font>

147
00:07:13,499 --> 00:07:17,909
<font color="#E5E5E5">in a second</font><font color="#CCCCCC"> he's done a lot of</font><font color="#E5E5E5"> work with</font>

148
00:07:15,840 --> 00:07:19,758
the<font color="#E5E5E5"> windows sandbox and it I'll admit</font>

149
00:07:17,909 --> 00:07:22,169
<font color="#CCCCCC">that it feels a little strange</font><font color="#E5E5E5"> to give a</font>

150
00:07:19,759 --> 00:07:23,340
presentation on this topic<font color="#E5E5E5"> when James</font>

151
00:07:22,169 --> 00:07:29,758
for<font color="#E5E5E5"> shells going to be presenting next</font>

152
00:07:23,340 --> 00:07:31,229
<font color="#E5E5E5">but such</font><font color="#CCCCCC"> is life between between medium</font>

153
00:07:29,759 --> 00:07:32,759
integrity levels and high integrity

154
00:07:31,229 --> 00:07:37,979
levels within<font color="#E5E5E5"> Windows you're going to</font>

155
00:07:32,759 --> 00:07:41,150
run<font color="#CCCCCC"> into this</font><font color="#E5E5E5"> pesky little um</font><font color="#CCCCCC"> I don't</font>

156
00:07:37,979 --> 00:07:45,810
<font color="#CCCCCC">know what to</font><font color="#E5E5E5"> call it thing called UAC</font>

157
00:07:41,150 --> 00:07:48,179
<font color="#CCCCCC">luckily</font><font color="#E5E5E5"> for our purposes UAC</font><font color="#CCCCCC"> is not much</font>

158
00:07:45,810 --> 00:07:50,430
of<font color="#CCCCCC"> a barrier</font><font color="#E5E5E5"> when we are running as a</font>

159
00:07:48,180 --> 00:07:53,069
local admin which is why<font color="#E5E5E5"> kind of in the</font>

160
00:07:50,430 --> 00:07:55,680
summary of this talk if you take away

161
00:07:53,069 --> 00:07:57,779
<font color="#E5E5E5">one thing please do not run your users</font>

162
00:07:55,680 --> 00:08:00,389
as local admins I mean I'm happy<font color="#E5E5E5"> when</font>

163
00:07:57,779 --> 00:08:01,759
you do that but you you should<font color="#E5E5E5"> really</font>

164
00:08:00,389 --> 00:08:09,449
shouldn't do that

165
00:08:01,759 --> 00:08:11,129
UAC is not a security boundary so here's

166
00:08:09,449 --> 00:08:16,110
kind<font color="#E5E5E5"> of the</font><font color="#CCCCCC"> setup for</font><font color="#E5E5E5"> the rest of this</font>

167
00:08:11,129 --> 00:08:19,139
talk we're<font color="#E5E5E5"> going to land on a</font>

168
00:08:16,110 --> 00:08:22,710
workstation<font color="#E5E5E5"> within a Windows domain as</font>

169
00:08:19,139 --> 00:08:24,689
<font color="#E5E5E5">the Luigi user again he is actually a</font>

170
00:08:22,710 --> 00:08:28,198
limited<font color="#E5E5E5"> user he's not a local admin</font>

171
00:08:24,689 --> 00:08:31,830
running with<font color="#E5E5E5"> UAC he is a limited user</font>

172
00:08:28,199 --> 00:08:34,919
<font color="#E5E5E5">he's not in the local admin group via</font>

173
00:08:31,830 --> 00:08:39,019
whatever<font color="#E5E5E5"> method you choose the most I</font>

174
00:08:34,919 --> 00:08:42,059
guess<font color="#E5E5E5"> the</font><font color="#CCCCCC"> most recent popular thing is</font>

175
00:08:39,019 --> 00:08:44,300
office documents with macros enabled

176
00:08:42,059 --> 00:08:48,989
that<font color="#CCCCCC"> asks you to</font><font color="#E5E5E5"> please run this macro</font>

177
00:08:44,300 --> 00:08:50,640
and then we can hop on your machine<font color="#E5E5E5"> and</font>

178
00:08:48,990 --> 00:08:53,790
<font color="#CCCCCC">here we're trying to escalate privileges</font>

179
00:08:50,640 --> 00:08:56,189
from like I said an actual limited user

180
00:08:53,790 --> 00:08:59,730
to a local admin

181
00:08:56,190 --> 00:09:01,800
because you never<font color="#E5E5E5"> are</font><font color="#CCCCCC"> going to run your</font>

182
00:08:59,730 --> 00:09:04,740
users as admins<font color="#CCCCCC"> rights like this is a</font>

183
00:09:01,800 --> 00:09:10,040
necessary<font color="#E5E5E5"> step</font><font color="#CCCCCC"> for an attacker</font><font color="#E5E5E5"> right</font>

184
00:09:04,740 --> 00:09:10,040
you don't run users admins<font color="#E5E5E5"> that is bad</font>

185
00:09:13,340 --> 00:09:21,780
so here's kind<font color="#E5E5E5"> of our game plan</font><font color="#CCCCCC"> first</font>

186
00:09:19,620 --> 00:09:23,940
we're going to<font color="#E5E5E5"> look for many</font>

187
00:09:21,780 --> 00:09:28,530
<font color="#E5E5E5">misconfigurations</font><font color="#CCCCCC"> somewhere else I</font>

188
00:09:23,940 --> 00:09:30,780
actually see<font color="#E5E5E5"> this a ton</font><font color="#CCCCCC"> a user</font><font color="#E5E5E5"> that I</font>

189
00:09:28,530 --> 00:09:32,520
have compromised<font color="#CCCCCC"> they're not a local</font>

190
00:09:30,780 --> 00:09:34,740
<font color="#E5E5E5">admin on the</font><font color="#CCCCCC"> box that</font><font color="#E5E5E5"> they're on but</font>

191
00:09:32,520 --> 00:09:36,689
they've been for some reason configured

192
00:09:34,740 --> 00:09:40,710
as a local admin on other boxes within

193
00:09:36,690 --> 00:09:42,390
<font color="#E5E5E5">the domain at that point we can just PS</font>

194
00:09:40,710 --> 00:09:46,020
<font color="#CCCCCC">exec whatever your favorite remote</font>

195
00:09:42,390 --> 00:09:47,490
command execution<font color="#E5E5E5"> method is</font><font color="#CCCCCC"> then we're</font>

196
00:09:46,020 --> 00:09:49,740
going<font color="#E5E5E5"> to just look for some credentials</font>

197
00:09:47,490 --> 00:09:51,900
and<font color="#E5E5E5"> files and show some interesting</font>

198
00:09:49,740 --> 00:09:59,280
places that files<font color="#CCCCCC"> can have</font><font color="#E5E5E5"> local admin</font>

199
00:09:51,900 --> 00:10:00,720
credentials in them separate<font color="#CCCCCC"> then we're</font>

200
00:09:59,280 --> 00:10:03,199
going to look at exploiting<font color="#CCCCCC"> any</font>

201
00:10:00,720 --> 00:10:05,550
unpatched<font color="#E5E5E5"> elevation of</font><font color="#CCCCCC"> privilege bugs</font>

202
00:10:03,200 --> 00:10:07,380
<font color="#CCCCCC">these</font><font color="#E5E5E5"> are going to be guys like James or</font>

203
00:10:05,550 --> 00:10:10,319
Tavis or<font color="#CCCCCC"> Mandi</font><font color="#E5E5E5"> that have found bugs</font>

204
00:10:07,380 --> 00:10:11,939
<font color="#E5E5E5">within</font><font color="#CCCCCC"> windows and it could be any any</font>

205
00:10:10,320 --> 00:10:13,770
<font color="#CCCCCC">third-party software that's</font><font color="#E5E5E5"> running with</font>

206
00:10:11,940 --> 00:10:15,320
<font color="#CCCCCC">elevated privileges but for these</font>

207
00:10:13,770 --> 00:10:17,189
<font color="#E5E5E5">purposes we're just</font><font color="#CCCCCC"> going to do Windows</font>

208
00:10:15,320 --> 00:10:18,870
<font color="#E5E5E5">and then finally going</font><font color="#CCCCCC"> to look at</font>

209
00:10:17,190 --> 00:10:23,760
<font color="#E5E5E5">exploiting insecure figure age</font>

210
00:10:18,870 --> 00:10:25,860
configurations<font color="#E5E5E5"> or applications services</font>

211
00:10:23,760 --> 00:10:28,710
with weak permissions any files with

212
00:10:25,860 --> 00:10:32,940
weak permissions<font color="#CCCCCC"> we're going to look at</font>

213
00:10:28,710 --> 00:10:35,630
a registry setting that can<font color="#E5E5E5"> be pushed</font>

214
00:10:32,940 --> 00:10:41,670
via GPO called always install elevated

215
00:10:35,630 --> 00:10:45,920
that always installs<font color="#E5E5E5"> elevated</font><font color="#CCCCCC"> and then</font>

216
00:10:41,670 --> 00:10:45,920
we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to look</font><font color="#E5E5E5"> at some DLL fun</font>

217
00:10:56,080 --> 00:11:01,209
so first we're<font color="#CCCCCC"> going to see about</font>

218
00:10:59,529 --> 00:11:04,420
looking somewhere<font color="#E5E5E5"> else so we've landed</font>

219
00:11:01,209 --> 00:11:07,959
on a<font color="#CCCCCC"> workstation a user that</font><font color="#E5E5E5"> we've</font>

220
00:11:04,420 --> 00:11:10,719
compromised<font color="#E5E5E5"> the whatever method you so</font>

221
00:11:07,959 --> 00:11:12,729
choose<font color="#E5E5E5"> is running as a limited user and</font>

222
00:11:10,720 --> 00:11:16,899
we want to<font color="#E5E5E5"> continue to try and</font>

223
00:11:12,730 --> 00:11:18,250
compromise<font color="#CCCCCC"> the rest</font><font color="#E5E5E5"> of the domain</font><font color="#CCCCCC"> like I</font>

224
00:11:16,899 --> 00:11:20,500
<font color="#CCCCCC">said one of the things you can</font><font color="#E5E5E5"> do is try</font>

225
00:11:18,250 --> 00:11:22,450
and<font color="#E5E5E5"> look at other machines within that</font>

226
00:11:20,500 --> 00:11:25,329
domain<font color="#E5E5E5"> that have been</font><font color="#CCCCCC"> Mis configured for</font>

227
00:11:22,450 --> 00:11:29,410
whatever reasons<font color="#E5E5E5"> someone has allowed</font>

228
00:11:25,329 --> 00:11:30,880
that user<font color="#E5E5E5"> to become a local admin for to</font>

229
00:11:29,410 --> 00:11:35,140
install some software or<font color="#CCCCCC"> whatever it is</font>

230
00:11:30,880 --> 00:11:37,420
and<font color="#E5E5E5"> they forget</font><font color="#CCCCCC"> to take them back out so</font>

231
00:11:35,140 --> 00:11:40,050
one one box in the domain that<font color="#E5E5E5"> we're in</font>

232
00:11:37,420 --> 00:11:43,420
is going to have the<font color="#CCCCCC"> domain</font><font color="#E5E5E5"> users group</font>

233
00:11:40,050 --> 00:11:50,199
which<font color="#CCCCCC"> Luigi is a member of configured as</font>

234
00:11:43,420 --> 00:11:52,930
a local admin<font color="#CCCCCC"> when we do this we can use</font>

235
00:11:50,200 --> 00:11:55,690
<font color="#E5E5E5">a tool called Power View this is a part</font>

236
00:11:52,930 --> 00:11:57,399
of a larger group<font color="#E5E5E5"> of tools developed</font><font color="#CCCCCC"> by</font>

237
00:11:55,690 --> 00:11:59,620
some of the guys<font color="#E5E5E5"> that the</font><font color="#CCCCCC"> various group</font>

238
00:11:57,399 --> 00:12:03,279
will<font color="#CCCCCC"> schroeder</font><font color="#E5E5E5"> develop this tool it's a</font>

239
00:11:59,620 --> 00:12:05,560
<font color="#CCCCCC">powershell script that will essentially</font>

240
00:12:03,279 --> 00:12:09,130
query the domain controller<font color="#E5E5E5"> with our</font>

241
00:12:05,560 --> 00:12:10,540
current<font color="#E5E5E5"> users token</font><font color="#CCCCCC"> ask them hey where</font>

242
00:12:09,130 --> 00:12:12,250
are<font color="#CCCCCC"> all the different boxes in the</font>

243
00:12:10,540 --> 00:12:15,310
domain<font color="#E5E5E5"> what are the names of them and</font>

244
00:12:12,250 --> 00:12:17,529
<font color="#E5E5E5">then it will try</font><font color="#CCCCCC"> and open up a handle to</font>

245
00:12:15,310 --> 00:12:19,869
the<font color="#E5E5E5"> service Control Manager</font><font color="#CCCCCC"> if it's</font>

246
00:12:17,529 --> 00:12:23,020
successful<font color="#CCCCCC"> that means that we're</font><font color="#E5E5E5"> able</font><font color="#CCCCCC"> to</font>

247
00:12:19,870 --> 00:12:26,560
<font color="#E5E5E5">a PS exec or whatever you want to as a</font>

248
00:12:23,020 --> 00:12:29,110
local admin to that box<font color="#CCCCCC"> and you can see</font>

249
00:12:26,560 --> 00:12:34,899
the screenshot<font color="#E5E5E5"> there we're going to load</font>

250
00:12:29,110 --> 00:12:36,610
the<font color="#CCCCCC"> PowerShell script and then run the</font>

251
00:12:34,899 --> 00:12:38,949
find local admin access<font color="#E5E5E5"> fairly</font>

252
00:12:36,610 --> 00:12:41,410
straightforward command and you can see

253
00:12:38,949 --> 00:12:45,430
that<font color="#E5E5E5"> we get one back back one box where</font>

254
00:12:41,410 --> 00:12:50,110
our current<font color="#E5E5E5"> user is able</font><font color="#CCCCCC"> to log into</font>

255
00:12:45,430 --> 00:12:53,170
<font color="#CCCCCC">that box as a local admin you</font><font color="#E5E5E5"> can see</font>

256
00:12:50,110 --> 00:12:55,329
here<font color="#E5E5E5"> that we've got the configuration on</font>

257
00:12:53,170 --> 00:12:57,490
that machine<font color="#E5E5E5"> we run a net local groups</font>

258
00:12:55,329 --> 00:13:00,670
for the administrator group<font color="#E5E5E5"> and the</font>

259
00:12:57,490 --> 00:13:02,920
domain<font color="#E5E5E5"> users group within the domain has</font>

260
00:13:00,670 --> 00:13:06,729
been<font color="#E5E5E5"> dropped in that group for whatever</font>

261
00:13:02,920 --> 00:13:08,630
reason<font color="#CCCCCC"> next we can</font><font color="#E5E5E5"> look for credentials</font>

262
00:13:06,730 --> 00:13:11,750
<font color="#CCCCCC">and files</font>

263
00:13:08,630 --> 00:13:15,920
this can be as simple<font color="#E5E5E5"> as passwords</font><font color="#CCCCCC"> XLS</font>

264
00:13:11,750 --> 00:13:17,630
on the desktop web config files I don't

265
00:13:15,920 --> 00:13:19,880
actually see<font color="#E5E5E5"> this on workstations as</font>

266
00:13:17,630 --> 00:13:22,730
much but<font color="#CCCCCC"> definitely on servers I have</font>

267
00:13:19,880 --> 00:13:25,970
also<font color="#E5E5E5"> seen backups of web config files</font>

268
00:13:22,730 --> 00:13:27,470
that users<font color="#E5E5E5"> are able to access like on a</font>

269
00:13:25,970 --> 00:13:28,880
say a network share<font color="#E5E5E5"> or something</font><font color="#CCCCCC"> like</font>

270
00:13:27,470 --> 00:13:30,710
<font color="#E5E5E5">that</font>

271
00:13:28,880 --> 00:13:32,870
grab the credentials<font color="#CCCCCC"> out</font><font color="#E5E5E5"> of there log</font>

272
00:13:30,710 --> 00:13:34,520
<font color="#E5E5E5">into the</font><font color="#CCCCCC"> database</font><font color="#E5E5E5"> the database</font><font color="#CCCCCC"> is likely</font>

273
00:13:32,870 --> 00:13:36,740
<font color="#E5E5E5">going</font><font color="#CCCCCC"> to be running with either domain</font>

274
00:13:34,520 --> 00:13:39,230
admin privileges or at least local admin

275
00:13:36,740 --> 00:13:41,270
privileges on that machine<font color="#CCCCCC"> moved from</font>

276
00:13:39,230 --> 00:13:43,450
<font color="#E5E5E5">the database</font><font color="#CCCCCC"> to the OS and</font><font color="#E5E5E5"> then you're</font>

277
00:13:41,270 --> 00:13:45,740
off<font color="#CCCCCC"> to the</font><font color="#E5E5E5"> races</font>

278
00:13:43,450 --> 00:13:48,560
<font color="#CCCCCC">unattended to install files this is</font>

279
00:13:45,740 --> 00:13:50,780
<font color="#E5E5E5">another pretty big one</font><font color="#CCCCCC"> here</font><font color="#E5E5E5"> are some</font>

280
00:13:48,560 --> 00:13:53,930
commands you can<font color="#E5E5E5"> use</font><font color="#CCCCCC"> to try</font><font color="#E5E5E5"> and look for</font>

281
00:13:50,780 --> 00:13:56,449
<font color="#E5E5E5">those on the machines</font><font color="#CCCCCC"> that you're on and</font>

282
00:13:53,930 --> 00:13:58,339
then<font color="#E5E5E5"> yeah finally the</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> Pat</font><font color="#CCCCCC"> any</font><font color="#E5E5E5"> just</font>

283
00:13:56,450 --> 00:14:01,430
any file that<font color="#CCCCCC"> has pass in it as always</font>

284
00:13:58,340 --> 00:14:03,710
<font color="#CCCCCC">useful as well as Group Policy</font>

285
00:14:01,430 --> 00:14:08,410
<font color="#CCCCCC">preferences</font><font color="#E5E5E5"> who's heard of</font><font color="#CCCCCC"> Group Policy</font>

286
00:14:03,710 --> 00:14:12,770
<font color="#E5E5E5">preferences</font><font color="#CCCCCC"> a few</font><font color="#E5E5E5"> people yeah that's</font>

287
00:14:08,410 --> 00:14:16,430
super cool<font color="#E5E5E5"> for my purposes</font><font color="#CCCCCC"> Group</font><font color="#E5E5E5"> Policy</font>

288
00:14:12,770 --> 00:14:20,240
preferences allows<font color="#E5E5E5"> domain admins to</font>

289
00:14:16,430 --> 00:14:23,689
<font color="#E5E5E5">specify local admin account</font><font color="#CCCCCC"> our</font>

290
00:14:20,240 --> 00:14:26,630
passwords<font color="#E5E5E5"> those passwords are</font><font color="#CCCCCC"> stored</font>

291
00:14:23,690 --> 00:14:29,060
encrypted<font color="#CCCCCC"> on the domain controller which</font>

292
00:14:26,630 --> 00:14:31,220
is<font color="#E5E5E5"> good right</font>

293
00:14:29,060 --> 00:14:33,439
the only problem<font color="#E5E5E5"> is that Microsoft has</font>

294
00:14:31,220 --> 00:14:37,520
published the private key to decrypt

295
00:14:33,440 --> 00:14:39,710
<font color="#E5E5E5">those values so any user</font><font color="#CCCCCC"> with access to</font>

296
00:14:37,520 --> 00:14:43,160
the<font color="#E5E5E5"> domain controller which is</font><font color="#CCCCCC"> going</font><font color="#E5E5E5"> to</font>

297
00:14:39,710 --> 00:14:47,420
be every user can<font color="#E5E5E5"> look for those files</font>

298
00:14:43,160 --> 00:14:52,310
<font color="#E5E5E5">and decrypt that encrypted value to get</font>

299
00:14:47,420 --> 00:14:53,870
<font color="#CCCCCC">the local</font><font color="#E5E5E5"> admin and also any just</font>

300
00:14:52,310 --> 00:14:54,349
looking around on the<font color="#CCCCCC"> domain control at</font>

301
00:14:53,870 --> 00:14:56,120
all

302
00:14:54,350 --> 00:15:00,700
find hard-coded credentials and

303
00:14:56,120 --> 00:15:04,210
PowerShell autoexec files batch files

304
00:15:00,700 --> 00:15:04,210
those sorts of things

305
00:15:06,809 --> 00:15:10,949
next we can look at<font color="#E5E5E5"> any potential</font>

306
00:15:09,360 --> 00:15:13,379
elevation<font color="#CCCCCC"> and privilege bugs that we can</font>

307
00:15:10,949 --> 00:15:15,179
exploit<font color="#E5E5E5"> like I said these can be</font><font color="#CCCCCC"> Windows</font>

308
00:15:13,379 --> 00:15:17,100
bugs but they don't<font color="#E5E5E5"> necessarily have</font><font color="#CCCCCC"> to</font>

309
00:15:15,179 --> 00:15:19,290
be there is something<font color="#E5E5E5"> I</font><font color="#CCCCCC"> think like a</font>

310
00:15:17,100 --> 00:15:22,049
week<font color="#CCCCCC"> ago that</font><font color="#E5E5E5"> came out with a</font><font color="#CCCCCC"> Lenovo bug</font>

311
00:15:19,290 --> 00:15:25,319
and some service that they run<font color="#CCCCCC"> where a</font>

312
00:15:22,049 --> 00:15:27,239
low<font color="#CCCCCC"> privilege</font><font color="#E5E5E5"> user can pass some</font>

313
00:15:25,319 --> 00:15:30,179
argument to a service which starts the

314
00:15:27,239 --> 00:15:34,619
device manager<font color="#E5E5E5"> at that</font><font color="#CCCCCC"> point you can</font>

315
00:15:30,179 --> 00:15:38,720
load a malicious driver drivers are

316
00:15:34,619 --> 00:15:41,730
running the kernel which is<font color="#E5E5E5"> good for us</font>

317
00:15:38,720 --> 00:15:43,470
so<font color="#CCCCCC"> here's these are</font><font color="#E5E5E5"> two model modules</font>

318
00:15:41,730 --> 00:15:45,720
within<font color="#CCCCCC"> Metasploit that can help</font><font color="#E5E5E5"> you</font>

319
00:15:43,470 --> 00:15:47,489
quickly<font color="#E5E5E5"> kind of run</font><font color="#CCCCCC"> through hey what are</font>

320
00:15:45,720 --> 00:15:49,799
<font color="#E5E5E5">some interesting patches that we have</font>

321
00:15:47,489 --> 00:15:55,829
exploits<font color="#CCCCCC"> for and are any of</font><font color="#E5E5E5"> those</font>

322
00:15:49,799 --> 00:15:58,350
missing on<font color="#E5E5E5"> this machine so I'm going to</font>

323
00:15:55,829 --> 00:16:01,258
demo this one<font color="#E5E5E5"> this is a going to be one</font>

324
00:15:58,350 --> 00:16:05,329
of<font color="#CCCCCC"> tavis Normandy's bugs that was</font>

325
00:16:01,259 --> 00:16:05,329
patched in<font color="#E5E5E5"> ms-13 0:53</font>

326
00:16:27,850 --> 00:16:32,989
so here we're going<font color="#CCCCCC"> to confirm that we</font>

327
00:16:31,519 --> 00:16:35,959
already have a session<font color="#CCCCCC"> on the target</font><font color="#E5E5E5"> as</font>

328
00:16:32,989 --> 00:16:37,610
a low<font color="#E5E5E5"> privilege user you could dump the</font>

329
00:16:35,959 --> 00:16:43,670
privileges you<font color="#E5E5E5"> can see that</font><font color="#CCCCCC"> we're don't</font>

330
00:16:37,610 --> 00:16:52,540
have many privileges<font color="#E5E5E5"> in our process load</font>

331
00:16:43,670 --> 00:16:52,540
<font color="#E5E5E5">the exploit module configure it</font>

332
00:16:58,100 --> 00:17:01,449
<font color="#E5E5E5">exploits going to run</font>

333
00:17:08,930 --> 00:17:14,750
then we confirm that<font color="#E5E5E5"> we have elevated</font>

334
00:17:12,599 --> 00:17:14,750
<font color="#CCCCCC">privileges</font>

335
00:17:29,480 --> 00:17:34,910
if the box<font color="#CCCCCC"> is fully patched we can look</font>

336
00:17:32,480 --> 00:17:39,490
at service permissions<font color="#CCCCCC"> most of the time</font>

337
00:17:34,910 --> 00:17:39,490
services<font color="#E5E5E5"> are run</font><font color="#CCCCCC"> with system privileges</font>

338
00:17:39,550 --> 00:17:44,930
<font color="#CCCCCC">here we're</font><font color="#E5E5E5"> going to use the sysinternals</font>

339
00:17:42,020 --> 00:17:47,780
access check tool that<font color="#E5E5E5"> can dump the</font>

340
00:17:44,930 --> 00:17:51,010
dackel for a whole lot<font color="#CCCCCC"> of securable</font>

341
00:17:47,780 --> 00:17:56,629
objects within<font color="#CCCCCC"> Windows registry</font><font color="#E5E5E5"> keys</font>

342
00:17:51,010 --> 00:17:58,220
<font color="#E5E5E5">named pipes processes or threads</font><font color="#CCCCCC"> we're</font>

343
00:17:56,630 --> 00:18:00,350
going to look for any<font color="#E5E5E5"> miss</font>

344
00:17:58,220 --> 00:18:02,030
configurations with any users<font color="#E5E5E5"> within the</font>

345
00:18:00,350 --> 00:18:03,980
authenticated users group the<font color="#E5E5E5"> users</font>

346
00:18:02,030 --> 00:18:06,020
group or the everyone<font color="#CCCCCC"> group and we're</font>

347
00:18:03,980 --> 00:18:09,500
going<font color="#E5E5E5"> to search</font><font color="#CCCCCC"> through every service so</font>

348
00:18:06,020 --> 00:18:12,139
<font color="#E5E5E5">a simple command like this can help you</font>

349
00:18:09,500 --> 00:18:14,540
quickly identify any miss configurations

350
00:18:12,140 --> 00:18:17,150
on<font color="#E5E5E5"> third-party services you're likely</font>

351
00:18:14,540 --> 00:18:19,820
not<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to find one on</font><font color="#E5E5E5"> Windows 7</font><font color="#CCCCCC"> well</font>

352
00:18:17,150 --> 00:18:21,620
you're not<font color="#E5E5E5"> going to find one</font><font color="#CCCCCC"> but I</font><font color="#E5E5E5"> think</font>

353
00:18:19,820 --> 00:18:26,990
it<font color="#E5E5E5"> was Windows XP an earlier service</font>

354
00:18:21,620 --> 00:18:29,750
<font color="#E5E5E5">pack in Windows XP had maybe the</font><font color="#CCCCCC"> UPnP</font>

355
00:18:26,990 --> 00:18:33,410
<font color="#E5E5E5">service was you could reconfigure the</font>

356
00:18:29,750 --> 00:18:34,970
<font color="#CCCCCC">UPnP service I think that's right so</font>

357
00:18:33,410 --> 00:18:38,150
here in the screenshot you can<font color="#E5E5E5"> see that</font>

358
00:18:34,970 --> 00:18:41,330
when<font color="#E5E5E5"> we run the command for the everyone</font>

359
00:18:38,150 --> 00:18:48,500
group<font color="#E5E5E5"> we get back readwrite access for a</font>

360
00:18:41,330 --> 00:18:51,639
service named code meter<font color="#CCCCCC"> exe at this</font>

361
00:18:48,500 --> 00:18:55,760
point I want<font color="#CCCCCC"> to see if we</font><font color="#E5E5E5"> can edit the</font>

362
00:18:51,640 --> 00:18:58,010
where the service points<font color="#CCCCCC"> to as well</font><font color="#E5E5E5"> as</font>

363
00:18:55,760 --> 00:18:59,570
if we can edit the binary<font color="#E5E5E5"> that this site</font>

364
00:18:58,010 --> 00:19:01,280
so maybe we can't edit<font color="#E5E5E5"> the service the</font>

365
00:18:59,570 --> 00:19:03,230
service<font color="#CCCCCC"> doesn't have rewrite permissions</font>

366
00:19:01,280 --> 00:19:04,490
<font color="#E5E5E5">but we could perhaps edit the binary</font>

367
00:19:03,230 --> 00:19:07,070
that<font color="#E5E5E5"> the service is</font><font color="#CCCCCC"> currently pointing</font>

368
00:19:04,490 --> 00:19:11,660
<font color="#E5E5E5">to by exploiting weak file permissions</font>

369
00:19:07,070 --> 00:19:14,439
or weak directory permissions<font color="#E5E5E5"> I'm going</font>

370
00:19:11,660 --> 00:19:14,440
to demo<font color="#CCCCCC"> that one real quick</font>

371
00:19:27,930 --> 00:19:35,610
so here we're on the<font color="#E5E5E5"> box again as the</font>

372
00:19:31,530 --> 00:19:36,870
same user<font color="#E5E5E5"> with low privileges to confirm</font>

373
00:19:35,610 --> 00:19:42,080
that we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to try and</font><font color="#E5E5E5"> add a user</font>

374
00:19:36,870 --> 00:19:45,000
<font color="#E5E5E5">to the</font><font color="#CCCCCC"> machine</font><font color="#E5E5E5"> and get an access denied</font>

375
00:19:42,080 --> 00:19:47,340
we've already<font color="#CCCCCC"> enumerated on</font><font color="#E5E5E5"> this box</font><font color="#CCCCCC"> the</font>

376
00:19:45,000 --> 00:19:49,260
service that<font color="#E5E5E5"> we're going</font><font color="#CCCCCC"> to go after</font><font color="#E5E5E5"> so</font>

377
00:19:47,340 --> 00:19:52,110
we're going<font color="#E5E5E5"> to use the</font><font color="#CCCCCC"> windows SC</font>

378
00:19:49,260 --> 00:19:56,250
command<font color="#E5E5E5"> to reconfigure the</font><font color="#CCCCCC"> bin path to</font>

379
00:19:52,110 --> 00:19:59,070
point to the net user binary<font color="#E5E5E5"> so that we</font>

380
00:19:56,250 --> 00:20:00,570
can add a user it's going to look<font color="#E5E5E5"> like</font>

381
00:19:59,070 --> 00:20:06,360
<font color="#CCCCCC">or we're going</font><font color="#E5E5E5"> to restart the</font><font color="#CCCCCC"> service</font>

382
00:20:00,570 --> 00:20:08,010
and it looks like<font color="#E5E5E5"> it fails do the same</font>

383
00:20:06,360 --> 00:20:09,750
thing except this<font color="#E5E5E5"> time add that user</font>

384
00:20:08,010 --> 00:20:12,870
<font color="#E5E5E5">that we just created to the local admin</font>

385
00:20:09,750 --> 00:20:15,150
<font color="#E5E5E5">group try and restart</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> service again</font>

386
00:20:12,870 --> 00:20:16,709
<font color="#CCCCCC">and it looks like it fails</font><font color="#E5E5E5"> but when</font>

387
00:20:15,150 --> 00:20:18,930
we've run<font color="#E5E5E5"> the net user command we</font><font color="#CCCCCC"> can</font>

388
00:20:16,710 --> 00:20:21,900
see that a user has<font color="#CCCCCC"> been</font><font color="#E5E5E5"> added</font><font color="#CCCCCC"> to the</font>

389
00:20:18,930 --> 00:20:23,990
box<font color="#E5E5E5"> and that user is in the local admins</font>

390
00:20:21,900 --> 00:20:23,990
group

391
00:20:42,760 --> 00:20:45,420
maybe

392
00:20:55,309 --> 00:20:58,520
there we go

393
00:20:59,809 --> 00:21:05,779
so next we're going<font color="#E5E5E5"> to look for</font>

394
00:21:01,269 --> 00:21:07,759
<font color="#CCCCCC">misconfigurations</font><font color="#E5E5E5"> with files</font><font color="#CCCCCC"> this is</font>

395
00:21:05,779 --> 00:21:10,609
extremely<font color="#E5E5E5"> common especially in</font>

396
00:21:07,759 --> 00:21:12,889
third-party<font color="#E5E5E5"> software</font><font color="#CCCCCC"> here we're</font><font color="#E5E5E5"> going to</font>

397
00:21:10,609 --> 00:21:14,859
look for any files<font color="#E5E5E5"> that we can write to</font>

398
00:21:12,889 --> 00:21:17,478
with the current privileges<font color="#CCCCCC"> that we have</font>

399
00:21:14,859 --> 00:21:19,519
bonus<font color="#E5E5E5"> points if those files are</font><font color="#CCCCCC"> auto</font>

400
00:21:17,479 --> 00:21:22,489
runs or they're kicked off by scheduled

401
00:21:19,519 --> 00:21:25,129
<font color="#CCCCCC">tasks scheduled tasks can run with</font>

402
00:21:22,489 --> 00:21:27,619
system permissions<font color="#E5E5E5"> and in</font><font color="#CCCCCC"> Auto runs we</font>

403
00:21:25,129 --> 00:21:29,899
can backdoor the binary<font color="#E5E5E5"> and wait for</font>

404
00:21:27,619 --> 00:21:31,549
maybe a higher<font color="#CCCCCC"> privileged user to log in</font>

405
00:21:29,899 --> 00:21:34,908
if it's a multi-user system which it

406
00:21:31,549 --> 00:21:36,320
likely<font color="#CCCCCC"> is same same kind of commands</font>

407
00:21:34,909 --> 00:21:38,869
<font color="#E5E5E5">here except we're going</font><font color="#CCCCCC"> to change one</font>

408
00:21:36,320 --> 00:21:41,869
flag<font color="#E5E5E5"> use the access check tool again</font>

409
00:21:38,869 --> 00:21:43,728
from sysinternals<font color="#CCCCCC"> again this is an</font>

410
00:21:41,869 --> 00:21:45,259
extremely powerful<font color="#CCCCCC"> tool I highly</font>

411
00:21:43,729 --> 00:21:49,690
recommend that<font color="#CCCCCC"> you check</font><font color="#E5E5E5"> it out if</font>

412
00:21:45,259 --> 00:21:49,690
you're<font color="#CCCCCC"> responsible for Windows machines</font>

413
00:21:50,830 --> 00:21:56,589
I'm not going<font color="#E5E5E5"> to demo this one but I</font>

414
00:21:53,210 --> 00:21:59,989
have perhaps an interesting story so

415
00:21:56,589 --> 00:22:01,249
sometimes I<font color="#CCCCCC"> play games</font><font color="#E5E5E5"> if you haven't</font>

416
00:21:59,989 --> 00:22:04,940
<font color="#E5E5E5">been able to figure that</font><font color="#CCCCCC"> out</font><font color="#E5E5E5"> by this</font>

417
00:22:01,249 --> 00:22:07,399
<font color="#E5E5E5">presentation</font><font color="#CCCCCC"> yet sometimes I</font><font color="#E5E5E5"> get bored</font>

418
00:22:04,940 --> 00:22:10,009
<font color="#CCCCCC">of playing those</font><font color="#E5E5E5"> games though and I</font>

419
00:22:07,399 --> 00:22:14,238
start to look for<font color="#E5E5E5"> bugs within the games</font>

420
00:22:10,009 --> 00:22:16,789
themselves<font color="#CCCCCC"> in this</font><font color="#E5E5E5"> case the main</font>

421
00:22:14,239 --> 00:22:21,139
application binary was writable<font color="#E5E5E5"> by</font>

422
00:22:16,789 --> 00:22:26,450
anyone in the users group in addition<font color="#CCCCCC"> it</font>

423
00:22:21,139 --> 00:22:30,859
was ought to run on a<font color="#CCCCCC"> login reporting it</font>

424
00:22:26,450 --> 00:22:34,279
<font color="#CCCCCC">to</font><font color="#E5E5E5"> the vendor</font><font color="#CCCCCC"> I received this kind yet</font>

425
00:22:30,859 --> 00:22:38,059
uninformed email<font color="#E5E5E5"> in return which</font>

426
00:22:34,279 --> 00:22:40,700
essentially<font color="#CCCCCC"> just says</font><font color="#E5E5E5"> we're good UAC</font>

427
00:22:38,059 --> 00:22:43,940
protects us<font color="#E5E5E5"> or it protects you rather as</font>

428
00:22:40,700 --> 00:22:46,070
the<font color="#CCCCCC"> as the user of this</font><font color="#E5E5E5"> software now</font>

429
00:22:43,940 --> 00:22:49,279
<font color="#E5E5E5">like I</font><font color="#CCCCCC"> said this this highlights a very</font>

430
00:22:46,070 --> 00:22:54,349
important thing to<font color="#E5E5E5"> note about what UAC</font>

431
00:22:49,279 --> 00:22:59,450
<font color="#E5E5E5">is or rather what you AC is not</font><font color="#CCCCCC"> UAC</font><font color="#E5E5E5"> is</font>

432
00:22:54,349 --> 00:23:01,218
not a security boundary<font color="#E5E5E5"> as an admin the</font>

433
00:22:59,450 --> 00:23:03,049
little pop-up box that<font color="#E5E5E5"> you receive is</font>

434
00:23:01,219 --> 00:23:05,799
not<font color="#E5E5E5"> is</font><font color="#CCCCCC"> not a security boundary they're</font>

435
00:23:03,049 --> 00:23:08,658
public ways public publicly<font color="#E5E5E5"> documented</font>

436
00:23:05,799 --> 00:23:11,470
<font color="#E5E5E5">methods and techniques for bypassing UAC</font>

437
00:23:08,659 --> 00:23:14,970
if you are a local admin thanks to

438
00:23:11,470 --> 00:23:17,559
<font color="#E5E5E5">a windows feature called Auto elevate</font>

439
00:23:14,970 --> 00:23:19,799
<font color="#CCCCCC">and this is a really important thing</font>

440
00:23:17,559 --> 00:23:23,770
<font color="#CCCCCC">because I run into a lot of cases where</font>

441
00:23:19,799 --> 00:23:26,139
clients are designing their architecture

442
00:23:23,770 --> 00:23:28,418
on their systems with<font color="#E5E5E5"> UAC in mind as a</font>

443
00:23:26,140 --> 00:23:29,679
<font color="#E5E5E5">security boundary this is</font><font color="#CCCCCC"> why it's very</font>

444
00:23:28,419 --> 00:23:32,440
important to make<font color="#CCCCCC"> sure</font><font color="#E5E5E5"> that you're</font>

445
00:23:29,679 --> 00:23:35,530
<font color="#CCCCCC">running as limited users and not local</font>

446
00:23:32,440 --> 00:23:39,490
admins<font color="#CCCCCC"> and not making</font><font color="#E5E5E5"> this mistake</font>

447
00:23:35,530 --> 00:23:43,330
<font color="#E5E5E5">so what what would an attack path be for</font>

448
00:23:39,490 --> 00:23:45,580
a case like<font color="#CCCCCC"> this someone who's in the</font>

449
00:23:43,330 --> 00:23:48,789
local admin group logs in<font color="#E5E5E5"> and wants to</font>

450
00:23:45,580 --> 00:23:52,299
play<font color="#E5E5E5"> games because no one ever has games</font>

451
00:23:48,789 --> 00:23:56,320
on their work computers right nobody<font color="#E5E5E5"> nut</font>

452
00:23:52,299 --> 00:23:58,150
<font color="#E5E5E5">doesn't happen</font><font color="#CCCCCC"> so an admin logs in</font><font color="#E5E5E5"> we</font>

453
00:23:56,320 --> 00:24:02,439
have<font color="#E5E5E5"> back door to binary or just</font>

454
00:23:58,150 --> 00:24:05,679
overwritten it if we're sloppy with

455
00:24:02,440 --> 00:24:08,110
<font color="#E5E5E5">something that is</font><font color="#CCCCCC"> malicious so at this</font>

456
00:24:05,679 --> 00:24:13,630
<font color="#E5E5E5">stage we have code execution</font><font color="#CCCCCC"> at a medium</font>

457
00:24:08,110 --> 00:24:14,918
integrity<font color="#CCCCCC"> level</font><font color="#E5E5E5"> as a local admin and I</font>

458
00:24:13,630 --> 00:24:16,390
tried to go<font color="#CCCCCC"> back and</font><font color="#E5E5E5"> forth</font><font color="#CCCCCC"> with this</font>

459
00:24:14,919 --> 00:24:19,360
particular vendor<font color="#E5E5E5"> and say look this is</font>

460
00:24:16,390 --> 00:24:22,510
<font color="#CCCCCC">still not okay that</font><font color="#E5E5E5"> anyone</font><font color="#CCCCCC"> on the</font>

461
00:24:19,360 --> 00:24:26,139
machine<font color="#E5E5E5"> in the users group can overwrite</font>

462
00:24:22,510 --> 00:24:27,280
your<font color="#E5E5E5"> binary</font><font color="#CCCCCC"> but he or she was</font><font color="#E5E5E5"> not</font>

463
00:24:26,140 --> 00:24:31,030
particularly interested<font color="#CCCCCC"> in that</font>

464
00:24:27,280 --> 00:24:32,379
conversation and<font color="#CCCCCC"> if up until this</font><font color="#E5E5E5"> point</font>

465
00:24:31,030 --> 00:24:35,980
<font color="#CCCCCC">you've been like well yeah actually</font><font color="#E5E5E5"> I</font>

466
00:24:32,380 --> 00:24:38,020
think<font color="#CCCCCC"> USC is a security boundary don't</font>

467
00:24:35,980 --> 00:24:40,179
take my<font color="#E5E5E5"> word for it because</font><font color="#CCCCCC"> there are</font>

468
00:24:38,020 --> 00:24:43,090
<font color="#E5E5E5">multiple</font><font color="#CCCCCC"> MSDN articles where Microsoft</font>

469
00:24:40,179 --> 00:24:47,230
<font color="#E5E5E5">has essentially said UAC is not a</font>

470
00:24:43,090 --> 00:24:49,270
security boundary<font color="#CCCCCC"> a local</font><font color="#E5E5E5"> admin</font><font color="#CCCCCC"> a tomini</font>

471
00:24:47,230 --> 00:24:51,850
<font color="#E5E5E5">integrity process</font><font color="#CCCCCC"> should still be</font>

472
00:24:49,270 --> 00:24:55,530
<font color="#CCCCCC">considered a local</font><font color="#E5E5E5"> admin so again that</font>

473
00:24:51,850 --> 00:24:55,530
<font color="#CCCCCC">is that is not a security boundary</font>

474
00:24:56,730 --> 00:25:01,870
<font color="#CCCCCC">another interesting</font><font color="#E5E5E5"> one is the always</font>

475
00:24:59,260 --> 00:25:04,539
<font color="#E5E5E5">install elevated group policy setting</font>

476
00:25:01,870 --> 00:25:07,299
that you can<font color="#E5E5E5"> set and I do I sympathize</font>

477
00:25:04,539 --> 00:25:10,000
with<font color="#CCCCCC"> this one because</font><font color="#E5E5E5"> this is a good</font>

478
00:25:07,299 --> 00:25:11,559
<font color="#CCCCCC">idea</font><font color="#E5E5E5"> at the start until you think about</font>

479
00:25:10,000 --> 00:25:13,390
it and think<font color="#CCCCCC"> about the fact that UAC</font>

480
00:25:11,559 --> 00:25:18,340
is not again USC is not a security

481
00:25:13,390 --> 00:25:21,399
boundary this essentially<font color="#CCCCCC"> allows any any</font>

482
00:25:18,340 --> 00:25:24,980
user where this is<font color="#E5E5E5"> enabled you</font><font color="#CCCCCC"> can</font>

483
00:25:21,399 --> 00:25:27,799
install MSI package files with<font color="#CCCCCC"> system</font>

484
00:25:24,980 --> 00:25:31,640
privileges<font color="#E5E5E5"> so and I again I sympathize</font>

485
00:25:27,799 --> 00:25:33,470
with<font color="#E5E5E5"> this one because</font><font color="#CCCCCC"> you have your you</font>

486
00:25:31,640 --> 00:25:36,590
<font color="#E5E5E5">know marketing person or whatever who</font>

487
00:25:33,470 --> 00:25:39,559
wants to install patches or updates or

488
00:25:36,590 --> 00:25:41,540
something<font color="#E5E5E5"> like</font><font color="#CCCCCC"> that and they want to</font><font color="#E5E5E5"> do</font>

489
00:25:39,559 --> 00:25:43,340
it<font color="#E5E5E5"> without</font><font color="#CCCCCC"> having</font><font color="#E5E5E5"> to have a local admin</font>

490
00:25:41,540 --> 00:25:45,290
come and do<font color="#E5E5E5"> that for them it's kind of</font>

491
00:25:43,340 --> 00:25:47,659
an issue<font color="#E5E5E5"> right but this illustrates the</font>

492
00:25:45,290 --> 00:25:52,100
kind<font color="#CCCCCC"> of proverbial trade-off between</font>

493
00:25:47,660 --> 00:25:54,380
<font color="#E5E5E5">security and usability because any MSI</font>

494
00:25:52,100 --> 00:25:56,090
can be installed<font color="#CCCCCC"> which means we can</font>

495
00:25:54,380 --> 00:25:59,600
<font color="#E5E5E5">build an MSI to do something that is not</font>

496
00:25:56,090 --> 00:26:01,639
<font color="#CCCCCC">good</font><font color="#E5E5E5"> and try and install that and it</font>

497
00:25:59,600 --> 00:26:06,139
will be it<font color="#E5E5E5"> will yield us system</font>

498
00:26:01,640 --> 00:26:08,330
<font color="#E5E5E5">privileges you</font><font color="#CCCCCC"> can</font><font color="#E5E5E5"> check for this very</font>

499
00:26:06,140 --> 00:26:11,840
quickly<font color="#CCCCCC"> again these are not</font><font color="#E5E5E5"> like crazy</font>

500
00:26:08,330 --> 00:26:16,580
complicated<font color="#E5E5E5"> things to do</font><font color="#CCCCCC"> you have to</font>

501
00:26:11,840 --> 00:26:19,129
query<font color="#E5E5E5"> to registry settings</font><font color="#CCCCCC"> there in the</font>

502
00:26:16,580 --> 00:26:21,699
commands<font color="#E5E5E5"> to do that and then we'll demo</font>

503
00:26:19,130 --> 00:26:21,700
<font color="#E5E5E5">this real quick</font>

504
00:26:38,080 --> 00:26:43,159
here we start<font color="#CCCCCC"> the same thing we have a</font>

505
00:26:40,220 --> 00:26:45,700
low privileged<font color="#E5E5E5"> code execution a low</font>

506
00:26:43,160 --> 00:26:45,700
<font color="#E5E5E5">privileged user</font>

507
00:26:52,530 --> 00:26:58,700
we're going to query these<font color="#CCCCCC"> two registry</font>

508
00:26:54,360 --> 00:26:58,699
<font color="#CCCCCC">keys</font><font color="#E5E5E5"> as we can see the first one is set</font>

509
00:27:02,600 --> 00:27:11,399
second one is set you<font color="#E5E5E5"> can build your own</font>

510
00:27:08,520 --> 00:27:13,139
<font color="#E5E5E5">MSI to do as you wish but</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> this case</font>

511
00:27:11,400 --> 00:27:15,600
<font color="#E5E5E5">I'm for the demo purposes I'm going to</font>

512
00:27:13,140 --> 00:27:18,289
<font color="#E5E5E5">use a</font><font color="#CCCCCC"> Metasploit as Metasploit does have</font>

513
00:27:15,600 --> 00:27:18,289
a<font color="#CCCCCC"> module</font><font color="#E5E5E5"> for this</font>

514
00:27:27,460 --> 00:27:31,669
<font color="#CCCCCC">mondal is going to check for</font><font color="#E5E5E5"> the to</font>

515
00:27:30,260 --> 00:27:32,960
registry settings that<font color="#E5E5E5"> we just manually</font>

516
00:27:31,669 --> 00:27:36,350
checked for to make<font color="#CCCCCC"> sure that they're</font>

517
00:27:32,960 --> 00:27:38,630
enabled run<font color="#CCCCCC"> msi</font><font color="#E5E5E5"> exec with the package</font>

518
00:27:36,350 --> 00:27:41,149
<font color="#CCCCCC">that it builds and then you can see we</font>

519
00:27:38,630 --> 00:27:43,630
get back command execution with higher

520
00:27:41,150 --> 00:27:43,630
privileges

521
00:27:56,000 --> 00:28:03,540
another fun one this this one<font color="#E5E5E5"> is not not</font>

522
00:28:00,690 --> 00:28:08,130
as common<font color="#E5E5E5"> I just like it so I put</font><font color="#CCCCCC"> it in</font>

523
00:28:03,540 --> 00:28:10,970
<font color="#E5E5E5">this deck</font><font color="#CCCCCC"> so Windows can dynamically</font>

524
00:28:08,130 --> 00:28:13,560
load<font color="#CCCCCC"> DLLs</font><font color="#E5E5E5"> there's a decent</font><font color="#CCCCCC"> amount</font><font color="#E5E5E5"> of</font>

525
00:28:10,970 --> 00:28:17,190
security effort focused<font color="#CCCCCC"> on the spawning</font>

526
00:28:13,560 --> 00:28:19,620
<font color="#E5E5E5">of processes but not so much with the</font>

527
00:28:17,190 --> 00:28:23,250
loading of<font color="#CCCCCC"> dll's</font><font color="#E5E5E5"> both places we can</font>

528
00:28:19,620 --> 00:28:25,949
execute code from if the application

529
00:28:23,250 --> 00:28:30,530
<font color="#E5E5E5">loads a DLL</font><font color="#CCCCCC"> and doesn't give a fully</font>

530
00:28:25,950 --> 00:28:33,630
<font color="#E5E5E5">qualified path</font><font color="#CCCCCC"> Windows will execute the</font>

531
00:28:30,530 --> 00:28:35,399
<font color="#E5E5E5">windows search order there's there</font><font color="#CCCCCC"> was a</font>

532
00:28:33,630 --> 00:28:39,540
lot of<font color="#CCCCCC"> lot</font><font color="#E5E5E5"> of talk about DLL hijacking</font>

533
00:28:35,400 --> 00:28:42,690
in 2010<font color="#CCCCCC"> and</font><font color="#E5E5E5"> again I just think</font><font color="#CCCCCC"> it's</font>

534
00:28:39,540 --> 00:28:44,850
interesting<font color="#CCCCCC"> so I</font><font color="#E5E5E5"> threw</font><font color="#CCCCCC"> it in here it's</font>

535
00:28:42,690 --> 00:28:46,860
kind of my fallback I guess if I'm on an

536
00:28:44,850 --> 00:28:49,679
engagement<font color="#E5E5E5"> and some of the techniques</font>

537
00:28:46,860 --> 00:28:53,479
that I just showed you<font color="#E5E5E5"> haven't worked</font><font color="#CCCCCC"> so</font>

538
00:28:49,680 --> 00:28:56,370
first<font color="#CCCCCC"> or yeah so here's</font><font color="#E5E5E5"> the search order</font>

539
00:28:53,480 --> 00:28:58,590
the good news for<font color="#E5E5E5"> us is</font><font color="#CCCCCC"> that the last</font>

540
00:28:56,370 --> 00:29:01,409
two are potentially exploitable most of

541
00:28:58,590 --> 00:29:03,899
the DLL hijacking attacks<font color="#E5E5E5"> I've seen that</font>

542
00:29:01,410 --> 00:29:08,190
<font color="#E5E5E5">our public are going</font><font color="#CCCCCC"> after</font><font color="#E5E5E5"> the current</font>

543
00:29:03,900 --> 00:29:11,160
<font color="#E5E5E5">directory there was a recent one</font><font color="#CCCCCC"> Greg</font>

544
00:29:08,190 --> 00:29:15,060
<font color="#CCCCCC">Linnaeus reported</font><font color="#E5E5E5"> bug to Microsoft in</font>

545
00:29:11,160 --> 00:29:18,690
Windows 10 will look for phone info<font color="#E5E5E5"> DLL</font>

546
00:29:15,060 --> 00:29:20,100
when I think<font color="#CCCCCC"> it's edge maybe it's yeah I</font>

547
00:29:18,690 --> 00:29:21,900
think<font color="#E5E5E5"> it's when edge is launched</font><font color="#CCCCCC"> or</font>

548
00:29:20,100 --> 00:29:23,639
<font color="#CCCCCC">inner Explorer</font><font color="#E5E5E5"> as well as Skype a bunch</font>

549
00:29:21,900 --> 00:29:28,250
of different<font color="#CCCCCC"> applications</font><font color="#E5E5E5"> that use a</font>

550
00:29:23,640 --> 00:29:31,260
<font color="#CCCCCC">library that</font><font color="#E5E5E5"> looks for this</font><font color="#CCCCCC"> library but</font>

551
00:29:28,250 --> 00:29:33,600
in a lot of<font color="#E5E5E5"> cases that's</font><font color="#CCCCCC"> not really</font>

552
00:29:31,260 --> 00:29:37,410
privileged escalation<font color="#E5E5E5"> so why is that in</font>

553
00:29:33,600 --> 00:29:38,850
<font color="#E5E5E5">here if a privileged application and</font>

554
00:29:37,410 --> 00:29:41,730
again<font color="#CCCCCC"> this kind of</font><font color="#E5E5E5"> gets back</font><font color="#CCCCCC"> to the</font>

555
00:29:38,850 --> 00:29:44,429
methodology<font color="#CCCCCC"> that we've talked</font><font color="#E5E5E5"> about</font>

556
00:29:41,730 --> 00:29:46,230
before<font color="#E5E5E5"> thinking</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> what okay what is</font>

557
00:29:44,430 --> 00:29:47,760
my<font color="#E5E5E5"> attack surface as far</font><font color="#CCCCCC"> as privileged</font>

558
00:29:46,230 --> 00:29:49,800
applications go and then how can<font color="#CCCCCC"> I</font>

559
00:29:47,760 --> 00:29:52,320
influence that in a way<font color="#E5E5E5"> that would</font>

560
00:29:49,800 --> 00:29:54,780
benefit me<font color="#E5E5E5"> so a privileged application</font>

561
00:29:52,320 --> 00:29:57,450
can load a<font color="#E5E5E5"> DLL that's maybe missing</font>

562
00:29:54,780 --> 00:29:59,220
<font color="#CCCCCC">maybe</font><font color="#E5E5E5"> they have updated the</font><font color="#CCCCCC"> codebase</font><font color="#E5E5E5"> and</font>

563
00:29:57,450 --> 00:30:01,260
there's no longer<font color="#E5E5E5"> the use for a</font>

564
00:29:59,220 --> 00:30:03,390
particular DLL<font color="#E5E5E5"> and instead of commenting</font>

565
00:30:01,260 --> 00:30:07,860
<font color="#CCCCCC">it out they</font><font color="#E5E5E5"> just say who cares doesn't</font>

566
00:30:03,390 --> 00:30:09,149
matter we combine this with<font color="#CCCCCC"> weak</font>

567
00:30:07,860 --> 00:30:11,248
directory permissions

568
00:30:09,149 --> 00:30:14,428
that so like a<font color="#CCCCCC"> rideable path for</font>

569
00:30:11,249 --> 00:30:16,139
instance again that's the path is going

570
00:30:14,429 --> 00:30:19,440
<font color="#E5E5E5">to be the final</font><font color="#CCCCCC"> location that windows</font>

571
00:30:16,139 --> 00:30:23,070
<font color="#CCCCCC">will look for dll's</font><font color="#E5E5E5"> when it runs the</font>

572
00:30:19,440 --> 00:30:25,710
search<font color="#CCCCCC"> so we</font><font color="#E5E5E5"> combine a missing dll with</font>

573
00:30:23,070 --> 00:30:28,859
a writable path<font color="#E5E5E5"> we can potentially</font>

574
00:30:25,710 --> 00:30:32,940
execute code with privileges of a higher

575
00:30:28,859 --> 00:30:36,149
application<font color="#CCCCCC"> I</font><font color="#E5E5E5"> actually reported an issue</font>

576
00:30:32,940 --> 00:30:37,469
to another vendor<font color="#CCCCCC"> that is of</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> nature</font>

577
00:30:36,149 --> 00:30:42,418
<font color="#E5E5E5">that I was hoping to be able to show you</font>

578
00:30:37,469 --> 00:30:45,019
today<font color="#CCCCCC"> but that is</font><font color="#E5E5E5"> um still in vendor</font>

579
00:30:42,419 --> 00:30:45,019
land<font color="#CCCCCC"> Oh</font>

580
00:30:46,739 --> 00:30:52,320
so to find these kinds of issues<font color="#E5E5E5"> it's</font>

581
00:30:49,019 --> 00:30:54,749
again<font color="#E5E5E5"> fairly simple</font><font color="#CCCCCC"> you can use</font>

582
00:30:52,320 --> 00:30:56,218
sysinternals proc<font color="#E5E5E5"> Mon tool if you</font>

583
00:30:54,749 --> 00:30:59,879
haven't figured<font color="#CCCCCC"> it out yet</font><font color="#E5E5E5"> sysinternals</font>

584
00:30:56,219 --> 00:31:02,879
<font color="#E5E5E5">suite is extremely powerful</font><font color="#CCCCCC"> go</font><font color="#E5E5E5"> use it</font>

585
00:30:59,879 --> 00:31:05,728
and<font color="#CCCCCC"> learn it</font><font color="#E5E5E5"> love it you want to include</font>

586
00:31:02,879 --> 00:31:08,639
<font color="#E5E5E5">set a</font><font color="#CCCCCC"> filter to</font><font color="#E5E5E5"> include</font><font color="#CCCCCC"> dll's</font><font color="#E5E5E5"> with name</font>

587
00:31:05,729 --> 00:31:10,499
not found as the result as well as just

588
00:31:08,639 --> 00:31:12,149
a folder<font color="#CCCCCC"> in your path and then launch</font>

589
00:31:10,499 --> 00:31:15,269
<font color="#CCCCCC">the applications that you're interested</font>

590
00:31:12,149 --> 00:31:20,209
<font color="#E5E5E5">in looking at</font><font color="#CCCCCC"> you might be surprised</font>

591
00:31:15,269 --> 00:31:20,210
what you<font color="#E5E5E5"> see and deny that as well</font>

592
00:31:36,740 --> 00:31:43,800
this is actually this was discovered

593
00:31:40,830 --> 00:31:46,199
<font color="#E5E5E5">this particular exploit her attack was</font>

594
00:31:43,800 --> 00:31:49,440
discovered by<font color="#E5E5E5"> Parvez Anwar and Ben</font>

595
00:31:46,200 --> 00:31:52,140
Campbell<font color="#E5E5E5"> with</font><font color="#CCCCCC"> MWR in the UK rota</font>

596
00:31:49,440 --> 00:31:54,980
<font color="#E5E5E5">Metasploit module for it</font><font color="#CCCCCC"> it's</font><font color="#E5E5E5"> going</font><font color="#CCCCCC"> to</font>

597
00:31:52,140 --> 00:31:59,760
look for<font color="#E5E5E5"> let me see what the name of</font><font color="#CCCCCC"> the</font>

598
00:31:54,980 --> 00:32:02,430
it's<font color="#E5E5E5"> the</font><font color="#CCCCCC"> ike</font><font color="#E5E5E5"> IP</font><font color="#CCCCCC"> IP set keen module</font>

599
00:31:59,760 --> 00:32:05,220
service in all versions of<font color="#CCCCCC"> windows seven</font>

600
00:32:02,430 --> 00:32:08,820
loads<font color="#CCCCCC"> a</font><font color="#E5E5E5"> dll that loads a dependent dll</font>

601
00:32:05,220 --> 00:32:12,690
called<font color="#CCCCCC"> i</font><font color="#E5E5E5"> key xt dll that does not exist</font>

602
00:32:08,820 --> 00:32:14,399
<font color="#E5E5E5">or no it's called w lb s control dll</font>

603
00:32:12,690 --> 00:32:16,770
<font color="#E5E5E5">that does not exist in any version of</font>

604
00:32:14,400 --> 00:32:18,090
Windows<font color="#CCCCCC"> 7 the only thing about this</font>

605
00:32:16,770 --> 00:32:20,430
<font color="#CCCCCC">particular attack</font><font color="#E5E5E5"> is that you're going</font>

606
00:32:18,090 --> 00:32:21,780
<font color="#CCCCCC">to</font><font color="#E5E5E5"> have to reboot the box</font><font color="#CCCCCC"> to trigger the</font>

607
00:32:20,430 --> 00:32:23,430
service because<font color="#E5E5E5"> the low privilege user</font>

608
00:32:21,780 --> 00:32:31,649
is<font color="#E5E5E5"> not</font><font color="#CCCCCC"> going to be able to restart the</font>

609
00:32:23,430 --> 00:32:32,730
service<font color="#CCCCCC"> by default so here we're</font><font color="#E5E5E5"> going</font>

610
00:32:31,650 --> 00:32:35,340
<font color="#E5E5E5">to load the module we've already</font>

611
00:32:32,730 --> 00:32:37,860
<font color="#CCCCCC">determined that</font><font color="#E5E5E5"> python is installed on</font>

612
00:32:35,340 --> 00:32:44,280
<font color="#CCCCCC">the machine that</font><font color="#E5E5E5"> we're</font><font color="#CCCCCC"> looking</font><font color="#E5E5E5"> at and is</font>

613
00:32:37,860 --> 00:32:46,050
writable again this is<font color="#E5E5E5"> easily done</font>

614
00:32:44,280 --> 00:32:48,360
manually<font color="#E5E5E5"> it's just faster</font><font color="#CCCCCC"> to use</font><font color="#E5E5E5"> the</font>

615
00:32:46,050 --> 00:32:52,850
<font color="#E5E5E5">module so there it's going to write the</font>

616
00:32:48,360 --> 00:32:55,649
<font color="#CCCCCC">DLL to the folder that</font><font color="#E5E5E5"> we specified</font>

617
00:32:52,850 --> 00:32:59,850
we're going to run it as a job<font color="#CCCCCC"> and then</font>

618
00:32:55,650 --> 00:33:07,170
reboot the box if we<font color="#CCCCCC"> can run the write</font>

619
00:32:59,850 --> 00:33:09,270
command<font color="#E5E5E5"> the box comes back on the</font>

620
00:33:07,170 --> 00:33:11,580
service will kick off<font color="#E5E5E5"> look for this DLL</font>

621
00:33:09,270 --> 00:33:13,260
it's not supposed to<font color="#E5E5E5"> exist but it does</font>

622
00:33:11,580 --> 00:33:16,020
in this<font color="#CCCCCC"> case it will load it and</font><font color="#E5E5E5"> then</font>

623
00:33:13,260 --> 00:33:19,460
<font color="#E5E5E5">we'll have code execution as if we were</font>

624
00:33:16,020 --> 00:33:19,460
the service so system privileges

625
00:33:46,760 --> 00:33:52,460
so some conclusions<font color="#CCCCCC"> I'm going to echo</font>

626
00:33:49,250 --> 00:33:55,179
the NSA<font color="#E5E5E5"> towel guy</font><font color="#CCCCCC"> that spoke at a nigma</font>

627
00:33:52,460 --> 00:33:58,040
<font color="#E5E5E5">Kampf he essentially said that the</font>

628
00:33:55,179 --> 00:34:00,350
<font color="#CCCCCC">biggest</font><font color="#E5E5E5"> thing he can tell people who</font><font color="#CCCCCC"> are</font>

629
00:33:58,040 --> 00:34:02,120
on<font color="#E5E5E5"> defense is know your network know</font>

630
00:34:00,350 --> 00:34:03,559
what's on your network<font color="#E5E5E5"> know the</font>

631
00:34:02,120 --> 00:34:07,760
third-party applications that are

632
00:34:03,559 --> 00:34:09,290
installed<font color="#E5E5E5"> on your boxes</font><font color="#CCCCCC"> if I can show up</font>

633
00:34:07,760 --> 00:34:12,020
<font color="#E5E5E5">in a week and I can</font><font color="#CCCCCC"> know your network</font>

634
00:34:09,290 --> 00:34:15,800
<font color="#E5E5E5">better than you can that's probably</font>

635
00:34:12,020 --> 00:34:19,190
going to<font color="#CCCCCC"> end up bad for you again</font><font color="#E5E5E5"> don't</font>

636
00:34:15,800 --> 00:34:21,350
<font color="#CCCCCC">at</font><font color="#E5E5E5"> all</font><font color="#CCCCCC"> costs</font><font color="#E5E5E5"> do not run as a local admin</font>

637
00:34:19,190 --> 00:34:23,210
this is a critical piece<font color="#E5E5E5"> in the</font>

638
00:34:21,350 --> 00:34:27,980
<font color="#E5E5E5">successful attack chain in Windows</font>

639
00:34:23,210 --> 00:34:29,270
environments<font color="#E5E5E5"> if if a local admin I mean</font>

640
00:34:27,980 --> 00:34:30,290
I don't<font color="#E5E5E5"> have a statistic on it that</font>

641
00:34:29,270 --> 00:34:32,030
would<font color="#CCCCCC"> be interesting</font><font color="#E5E5E5"> to do actually I</font>

642
00:34:30,290 --> 00:34:34,399
don't have a statistic<font color="#E5E5E5"> on it but admin</font>

643
00:34:32,030 --> 00:34:37,550
<font color="#CCCCCC">access on a</font><font color="#E5E5E5"> workstation that is within a</font>

644
00:34:34,399 --> 00:34:41,659
domain<font color="#E5E5E5"> has almost always led to the</font>

645
00:34:37,550 --> 00:34:43,460
downfall<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the entire domain</font><font color="#CCCCCC"> so making</font>

646
00:34:41,659 --> 00:34:46,850
<font color="#E5E5E5">that difficult</font><font color="#CCCCCC"> for an attacker is an</font>

647
00:34:43,460 --> 00:34:51,889
extremely important piece<font color="#CCCCCC"> of breaking</font>

648
00:34:46,850 --> 00:34:56,389
the successful attack chain<font color="#CCCCCC"> patch your</font>

649
00:34:51,889 --> 00:34:58,910
 it's fairly straightforward<font color="#CCCCCC"> and</font>

650
00:34:56,389 --> 00:35:01,250
<font color="#CCCCCC">then</font><font color="#E5E5E5"> again this kind of this I was</font>

651
00:34:58,910 --> 00:35:03,200
<font color="#E5E5E5">hoping with this talk to give you some</font>

652
00:35:01,250 --> 00:35:05,600
ways<font color="#CCCCCC"> to look for some of</font><font color="#E5E5E5"> the things that</font>

653
00:35:03,200 --> 00:35:08,839
<font color="#CCCCCC">I'm going to look</font><font color="#E5E5E5"> for if I show up on</font>

654
00:35:05,600 --> 00:35:11,089
<font color="#E5E5E5">your doorstep so knowing again knowing</font>

655
00:35:08,840 --> 00:35:16,580
offense using offense to inform defense

656
00:35:11,090 --> 00:35:19,970
<font color="#E5E5E5">is an extremely important thing some</font>

657
00:35:16,580 --> 00:35:21,830
tools to<font color="#E5E5E5"> automate this kind of thing not</font>

658
00:35:19,970 --> 00:35:25,368
everybody<font color="#CCCCCC"> has</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> time to</font><font color="#E5E5E5"> dick around</font>

659
00:35:21,830 --> 00:35:27,470
<font color="#E5E5E5">with it like</font><font color="#CCCCCC"> I do first power up again</font>

660
00:35:25,369 --> 00:35:29,869
it's going<font color="#E5E5E5"> to be by the guys at</font><font color="#CCCCCC"> very</font>

661
00:35:27,470 --> 00:35:33,200
<font color="#CCCCCC">bears group will Schroeder write this</font>

662
00:35:29,869 --> 00:35:34,640
one it'll<font color="#E5E5E5"> automate the enumeration of</font>

663
00:35:33,200 --> 00:35:35,919
some of the things<font color="#E5E5E5"> that I</font><font color="#CCCCCC"> just showed</font>

664
00:35:34,640 --> 00:35:38,589
you<font color="#E5E5E5"> as well as a few other things</font>

665
00:35:35,920 --> 00:35:40,760
<font color="#E5E5E5">extremely useful PowerShell module</font>

666
00:35:38,590 --> 00:35:43,580
<font color="#E5E5E5">script it out run it across all the</font>

667
00:35:40,760 --> 00:35:44,740
boxes in<font color="#CCCCCC"> your domain</font><font color="#E5E5E5"> and fix whatever it</font>

668
00:35:43,580 --> 00:35:48,200
finds

669
00:35:44,740 --> 00:35:51,770
<font color="#CCCCCC">Windows</font><font color="#E5E5E5"> profess check</font><font color="#CCCCCC"> this is</font><font color="#E5E5E5"> by</font><font color="#CCCCCC"> pin</font>

670
00:35:48,200 --> 00:35:56,419
test<font color="#E5E5E5"> monkey yes the portcullis guys and</font>

671
00:35:51,770 --> 00:35:59,300
Bernardo de male<font color="#E5E5E5"> I think he works at NCC</font>

672
00:35:56,420 --> 00:36:00,590
<font color="#E5E5E5">group and then finally the sysinternals</font>

673
00:35:59,300 --> 00:36:04,670
<font color="#E5E5E5">suite again</font>

674
00:36:00,590 --> 00:36:06,380
extremely<font color="#CCCCCC"> powerful for doing analysis of</font>

675
00:36:04,670 --> 00:36:10,940
<font color="#CCCCCC">windows boxes can help you</font><font color="#E5E5E5"> out in many</font>

676
00:36:06,380 --> 00:36:14,180
ways here's some<font color="#E5E5E5"> other references and</font>

677
00:36:10,940 --> 00:36:17,090
<font color="#CCCCCC">resources</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> note is this first talk</font>

678
00:36:14,180 --> 00:36:20,810
<font color="#E5E5E5">this was by Brett Moore</font><font color="#CCCCCC"> I think it ruxk</font>

679
00:36:17,090 --> 00:36:24,800
on maybe like talks a lot about Windows

680
00:36:20,810 --> 00:36:27,200
XP so maybe four or<font color="#E5E5E5"> five</font><font color="#CCCCCC"> years ago this</font>

681
00:36:24,800 --> 00:36:28,700
<font color="#CCCCCC">is an incredibly good talk if you are in</font>

682
00:36:27,200 --> 00:36:32,689
offense<font color="#E5E5E5"> and you haven't watched this</font>

683
00:36:28,700 --> 00:36:35,089
talk I<font color="#CCCCCC"> would highly suggest it as well</font>

684
00:36:32,690 --> 00:36:42,670
as some of these other references<font color="#E5E5E5"> that</font>

685
00:36:35,090 --> 00:36:42,670
<font color="#CCCCCC">you</font><font color="#E5E5E5"> can check out so I've got questions</font>

686
00:36:43,330 --> 00:36:55,610
two<font color="#E5E5E5"> questions first question here that's</font>

687
00:36:52,490 --> 00:36:57,140
going<font color="#CCCCCC"> to use oh</font><font color="#E5E5E5"> okay</font><font color="#CCCCCC"> I think it</font><font color="#E5E5E5"> a lot of</font>

688
00:36:55,610 --> 00:37:00,290
<font color="#E5E5E5">large</font><font color="#CCCCCC"> companies</font><font color="#E5E5E5"> are going to use an</font>

689
00:36:57,140 --> 00:37:01,730
automated<font color="#E5E5E5"> patching service or they're</font>

690
00:37:00,290 --> 00:37:03,620
going<font color="#E5E5E5"> to have monitoring and those are</font>

691
00:37:01,730 --> 00:37:05,840
<font color="#E5E5E5">going to be</font><font color="#CCCCCC"> running</font><font color="#E5E5E5"> with administrative</font>

692
00:37:03,620 --> 00:37:07,940
privileges<font color="#CCCCCC"> you didn't mention leveraging</font>

693
00:37:05,840 --> 00:37:10,400
that<font color="#E5E5E5"> to exploit boxes would you consider</font>

694
00:37:07,940 --> 00:37:13,370
that to<font color="#E5E5E5"> also be something of concern and</font>

695
00:37:10,400 --> 00:37:16,250
<font color="#E5E5E5">how could you protect against exploiting</font>

696
00:37:13,370 --> 00:37:20,690
that<font color="#E5E5E5"> if you could</font><font color="#CCCCCC"> you're</font><font color="#E5E5E5"> talking about</font>

697
00:37:16,250 --> 00:37:24,470
like agents<font color="#E5E5E5"> like a monitoring agent on a</font>

698
00:37:20,690 --> 00:37:25,970
machine<font color="#CCCCCC"> SCCM to deploy patching yeah so</font>

699
00:37:24,470 --> 00:37:28,370
there was<font color="#E5E5E5"> actually an interesting talk</font>

700
00:37:25,970 --> 00:37:33,589
<font color="#E5E5E5">by another guy at the various group on</font>

701
00:37:28,370 --> 00:37:34,880
using SCCM to infect the entire domain

702
00:37:33,590 --> 00:37:35,450
is<font color="#E5E5E5"> that that's kind of what you're</font>

703
00:37:34,880 --> 00:37:38,600
<font color="#CCCCCC">talking about</font>

704
00:37:35,450 --> 00:37:40,040
no so in order<font color="#CCCCCC"> to</font><font color="#E5E5E5"> install the patches in</font>

705
00:37:38,600 --> 00:37:42,049
the<font color="#CCCCCC"> Box you have</font><font color="#E5E5E5"> to have an account on</font>

706
00:37:40,040 --> 00:37:43,520
the<font color="#E5E5E5"> box that it can</font><font color="#CCCCCC"> login to and</font><font color="#E5E5E5"> that</font>

707
00:37:42,050 --> 00:37:45,230
account has<font color="#CCCCCC"> to have administrator</font>

708
00:37:43,520 --> 00:37:47,810
privileges and<font color="#CCCCCC"> they want</font><font color="#E5E5E5"> to install</font><font color="#CCCCCC"> the</font>

709
00:37:45,230 --> 00:37:50,000
patches<font color="#E5E5E5"> if you take local admin away the</font>

710
00:37:47,810 --> 00:37:52,040
users can't<font color="#CCCCCC"> I mean if you yeah then the</font>

711
00:37:50,000 --> 00:37:53,960
users can't install their own patches so

712
00:37:52,040 --> 00:37:56,029
now you have to manually push out

713
00:37:53,960 --> 00:37:58,370
patches<font color="#E5E5E5"> so you have to have an account</font>

714
00:37:56,030 --> 00:38:02,720
<font color="#CCCCCC">on the on the that's active on the box</font>

715
00:37:58,370 --> 00:38:05,900
<font color="#E5E5E5">do you leverage the account that's used</font>

716
00:38:02,720 --> 00:38:09,200
by say<font color="#CCCCCC"> secm to go in and push that down</font>

717
00:38:05,900 --> 00:38:10,700
<font color="#E5E5E5">with yeah so most implementations of</font>

718
00:38:09,200 --> 00:38:12,319
that<font color="#E5E5E5"> I've seen are going to be service</font>

719
00:38:10,700 --> 00:38:14,000
accounts within<font color="#CCCCCC"> a</font><font color="#E5E5E5"> window</font>

720
00:38:12,320 --> 00:38:17,630
and the main<font color="#CCCCCC"> concern with those is just</font>

721
00:38:14,000 --> 00:38:22,030
<font color="#CCCCCC">going</font><font color="#E5E5E5"> to be weak passwords</font><font color="#CCCCCC"> I've seen</font>

722
00:38:17,630 --> 00:38:25,370
<font color="#E5E5E5">service accounts for like application</font>

723
00:38:22,030 --> 00:38:28,820
stack management<font color="#E5E5E5"> where the username is</font>

724
00:38:25,370 --> 00:38:33,589
<font color="#CCCCCC">the same as the password that's going to</font>

725
00:38:28,820 --> 00:38:34,970
be not good that<font color="#E5E5E5"> is that helpful</font><font color="#CCCCCC"> or yeah</font>

726
00:38:33,590 --> 00:38:37,430
I was just<font color="#E5E5E5"> wondering</font><font color="#CCCCCC"> if you had taken</font>

727
00:38:34,970 --> 00:38:39,470
<font color="#E5E5E5">like if you leverage</font><font color="#CCCCCC"> that account</font><font color="#E5E5E5"> in</font>

728
00:38:37,430 --> 00:38:41,390
order<font color="#E5E5E5"> to exploit other than than</font>

729
00:38:39,470 --> 00:38:43,509
cracking the<font color="#CCCCCC"> password is there another</font>

730
00:38:41,390 --> 00:38:47,529
way that<font color="#E5E5E5"> you've leveraged that to gain</font>

731
00:38:43,510 --> 00:38:49,760
<font color="#E5E5E5">privileges on</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> box yeah</font><font color="#CCCCCC"> if I if I</font>

732
00:38:47,530 --> 00:38:52,550
<font color="#E5E5E5">compromised that account then I have</font>

733
00:38:49,760 --> 00:38:57,890
access<font color="#E5E5E5"> to everything that that account</font>

734
00:38:52,550 --> 00:38:59,780
has access<font color="#CCCCCC"> to</font><font color="#E5E5E5"> I don't</font><font color="#CCCCCC"> know</font><font color="#E5E5E5"> if</font><font color="#CCCCCC"> there know</font>

735
00:38:57,890 --> 00:39:01,430
so what I'm saying<font color="#E5E5E5"> is</font><font color="#CCCCCC"> that you there's</font>

736
00:38:59,780 --> 00:39:04,880
an account on the<font color="#CCCCCC"> Box can't do you</font>

737
00:39:01,430 --> 00:39:06,140
leverage<font color="#E5E5E5"> the admin account that I now</font>

738
00:39:04,880 --> 00:39:09,200
have to<font color="#E5E5E5"> put on the box because I've</font>

739
00:39:06,140 --> 00:39:11,210
taken the the<font color="#CCCCCC"> Ministry of privileges</font>

740
00:39:09,200 --> 00:39:13,370
away from the user so you log in the<font color="#CCCCCC"> Box</font>

741
00:39:11,210 --> 00:39:16,040
you go and you<font color="#CCCCCC"> look and and you had just</font>

742
00:39:13,370 --> 00:39:18,680
<font color="#CCCCCC">like Luigi before right now you're going</font>

743
00:39:16,040 --> 00:39:21,670
<font color="#CCCCCC">to have you know this patching account</font>

744
00:39:18,680 --> 00:39:27,259
that has administrative<font color="#E5E5E5"> privileges is</font>

745
00:39:21,670 --> 00:39:30,110
that and<font color="#E5E5E5"> a vector that</font><font color="#CCCCCC"> you attack yeah</font>

746
00:39:27,260 --> 00:39:32,390
yeah if<font color="#E5E5E5"> that if I don't have</font><font color="#CCCCCC"> loop access</font>

747
00:39:30,110 --> 00:39:34,220
to<font color="#CCCCCC"> a Luigi and</font><font color="#E5E5E5"> I have access</font><font color="#CCCCCC"> to a</font>

748
00:39:32,390 --> 00:39:36,350
service account<font color="#E5E5E5"> or some account that's</font>

749
00:39:34,220 --> 00:39:38,959
used to deploy patches or something<font color="#E5E5E5"> like</font>

750
00:39:36,350 --> 00:39:41,360
<font color="#CCCCCC">that it's going to give</font><font color="#E5E5E5"> me access</font><font color="#CCCCCC"> to any</font>

751
00:39:38,960 --> 00:39:43,400
machine<font color="#E5E5E5"> within the domain that that</font>

752
00:39:41,360 --> 00:39:45,560
account is<font color="#E5E5E5"> used to</font><font color="#CCCCCC"> login</font><font color="#E5E5E5"> with in patch</font>

753
00:39:43,400 --> 00:39:49,910
boxes with is there a way to protect

754
00:39:45,560 --> 00:39:51,799
<font color="#CCCCCC">against</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> the lark the biggest I mean</font>

755
00:39:49,910 --> 00:39:53,420
<font color="#E5E5E5">the most common thing that I see</font><font color="#CCCCCC"> as far</font>

756
00:39:51,800 --> 00:39:55,640
<font color="#E5E5E5">as that goes is</font><font color="#CCCCCC"> just again weak</font>

757
00:39:53,420 --> 00:39:57,530
passwords<font color="#E5E5E5"> use us use a really strong</font>

758
00:39:55,640 --> 00:40:00,830
password for service account service

759
00:39:57,530 --> 00:40:02,540
accounts aren't necessarily bad<font color="#CCCCCC"> if I'm</font>

760
00:40:00,830 --> 00:40:05,450
able<font color="#CCCCCC"> to compromise a machine that your</font>

761
00:40:02,540 --> 00:40:08,390
service account is<font color="#E5E5E5"> logging into you've</font>

762
00:40:05,450 --> 00:40:10,970
already lost<font color="#E5E5E5"> because I've achieved local</font>

763
00:40:08,390 --> 00:40:12,620
admin on that box<font color="#E5E5E5"> your service account</font>

764
00:40:10,970 --> 00:40:14,419
interactively logs in or does<font color="#E5E5E5"> whatever</font>

765
00:40:12,620 --> 00:40:17,089
<font color="#E5E5E5">it needs to do scrape those credentials</font>

766
00:40:14,420 --> 00:40:18,910
<font color="#E5E5E5">out of memory and then on I go so the</font>

767
00:40:17,090 --> 00:40:21,830
biggest<font color="#E5E5E5"> thing</font><font color="#CCCCCC"> I would</font><font color="#E5E5E5"> say with</font><font color="#CCCCCC"> that is</font>

768
00:40:18,910 --> 00:40:24,290
<font color="#E5E5E5">protect protect your workstations and</font>

769
00:40:21,830 --> 00:40:25,009
assume that<font color="#CCCCCC"> the boxes that you're trying</font>

770
00:40:24,290 --> 00:40:28,180
<font color="#E5E5E5">to defend are</font>

771
00:40:25,010 --> 00:40:30,770
to be compromised like<font color="#CCCCCC"> assume Kevin in</font>

772
00:40:28,180 --> 00:40:34,040
marketing if you're logging into his box

773
00:40:30,770 --> 00:40:36,610
with a trust relationship<font color="#E5E5E5"> a one-way</font>

774
00:40:34,040 --> 00:40:39,140
trust relationship<font color="#E5E5E5"> assume</font><font color="#CCCCCC"> that you're on</font>

775
00:40:36,610 --> 00:40:42,350
dangerous<font color="#E5E5E5"> territory because he's</font>

776
00:40:39,140 --> 00:40:44,120
browsing<font color="#E5E5E5"> the internet with an unpatched</font>

777
00:40:42,350 --> 00:40:46,130
version of<font color="#E5E5E5"> Firefox or he's downloading</font>

778
00:40:44,120 --> 00:40:48,290
macros and<font color="#CCCCCC"> execute or downloading</font><font color="#E5E5E5"> Word</font>

779
00:40:46,130 --> 00:40:51,080
documents<font color="#CCCCCC"> XQ macros would ever try and</font>

780
00:40:48,290 --> 00:40:54,380
try<font color="#CCCCCC"> and think</font><font color="#E5E5E5"> of your perimeter</font><font color="#CCCCCC"> not just</font>

781
00:40:51,080 --> 00:40:56,509
as oh<font color="#E5E5E5"> your firewalls or oh your</font><font color="#CCCCCC"> IDs and</font>

782
00:40:54,380 --> 00:40:59,840
your<font color="#CCCCCC"> IPs like assuming compromise on</font>

783
00:40:56,510 --> 00:41:02,090
<font color="#E5E5E5">those boxes</font><font color="#CCCCCC"> is an</font><font color="#E5E5E5"> extremely interesting</font>

784
00:40:59,840 --> 00:41:04,550
<font color="#E5E5E5">and useful exercise to</font><font color="#CCCCCC"> kind of run</font>

785
00:41:02,090 --> 00:41:08,450
through right so what we do is we look

786
00:41:04,550 --> 00:41:10,160
<font color="#CCCCCC">for is that</font><font color="#E5E5E5"> account being used for like</font>

787
00:41:08,450 --> 00:41:12,020
an<font color="#E5E5E5"> RDP session which it should never</font><font color="#CCCCCC"> be</font>

788
00:41:10,160 --> 00:41:13,819
<font color="#E5E5E5">used for it right that would</font><font color="#CCCCCC"> be yeah</font>

789
00:41:12,020 --> 00:41:15,110
absolutely<font color="#CCCCCC"> for those types</font><font color="#E5E5E5"> of things but</font>

790
00:41:13,820 --> 00:41:18,230
<font color="#E5E5E5">I was wondering if there's any way else</font>

791
00:41:15,110 --> 00:41:20,300
<font color="#CCCCCC">yeah yeah the monitoring aspect is huge</font>

792
00:41:18,230 --> 00:41:23,380
<font color="#CCCCCC">if you can if you can</font><font color="#E5E5E5"> monitor and do</font>

793
00:41:20,300 --> 00:41:25,370
some<font color="#E5E5E5"> sort of like anomaly detection</font><font color="#CCCCCC"> a</font>

794
00:41:23,380 --> 00:41:27,830
service like you said a service account

795
00:41:25,370 --> 00:41:32,859
shouldn't be<font color="#CCCCCC"> logging in over RDP and it</font>

796
00:41:27,830 --> 00:41:34,910
shouldn't<font color="#E5E5E5"> be doing doing strange things</font>

797
00:41:32,860 --> 00:41:38,270
<font color="#CCCCCC">that</font><font color="#E5E5E5"> that's definitely something that</font>

798
00:41:34,910 --> 00:41:40,160
that<font color="#E5E5E5"> is worth</font><font color="#CCCCCC"> checking out monitoring</font>

799
00:41:38,270 --> 00:41:41,780
<font color="#CCCCCC">getting some sort of</font><font color="#E5E5E5"> baseline for</font>

800
00:41:40,160 --> 00:41:44,029
accounts that you<font color="#CCCCCC"> have and what</font><font color="#E5E5E5"> there</font>

801
00:41:41,780 --> 00:41:46,730
should be doing or normally do<font color="#E5E5E5"> and then</font>

802
00:41:44,030 --> 00:41:49,820
look at<font color="#CCCCCC"> that at Microsoft advanced</font>

803
00:41:46,730 --> 00:41:52,010
<font color="#CCCCCC">it's a TA I forget to forget than what</font>

804
00:41:49,820 --> 00:41:54,230
the full acronym is but they're<font color="#E5E5E5"> doing a</font>

805
00:41:52,010 --> 00:41:56,120
lot<font color="#CCCCCC"> of work in that area I think that's</font>

806
00:41:54,230 --> 00:41:58,340
a you have to buy that at this stage but

807
00:41:56,120 --> 00:42:02,450
<font color="#CCCCCC">that is trying they're trying to take</font>

808
00:41:58,340 --> 00:42:04,160
<font color="#E5E5E5">that idea</font><font color="#CCCCCC"> baselining</font><font color="#E5E5E5"> Kevin only logs in</font>

809
00:42:02,450 --> 00:42:06,950
<font color="#E5E5E5">during these times here are the kind of</font>

810
00:42:04,160 --> 00:42:08,870
things<font color="#CCCCCC"> that he typically accesses</font><font color="#E5E5E5"> are</font>

811
00:42:06,950 --> 00:42:10,960
<font color="#E5E5E5">there deviations from</font><font color="#CCCCCC"> that and if so</font>

812
00:42:08,870 --> 00:42:12,650
<font color="#CCCCCC">that could be an indicator of</font><font color="#E5E5E5"> compromise</font>

813
00:42:10,960 --> 00:42:18,730
<font color="#CCCCCC">nice thank you</font>

814
00:42:12,650 --> 00:42:18,730
yep other questions

815
00:42:18,800 --> 00:42:28,980
get one<font color="#E5E5E5"> on the back for that demo that</font>

816
00:42:25,680 --> 00:42:31,830
<font color="#CCCCCC">you did of</font><font color="#E5E5E5"> the replacing the service</font>

817
00:42:28,980 --> 00:42:34,230
with the<font color="#E5E5E5"> week service ACLs have you</font>

818
00:42:31,830 --> 00:42:36,480
heard of<font color="#E5E5E5"> a serve check three</font>

819
00:42:34,230 --> 00:42:39,090
it's<font color="#E5E5E5"> an executable</font><font color="#CCCCCC"> that automates that</font>

820
00:42:36,480 --> 00:42:40,860
process and<font color="#E5E5E5"> simplifies it as well as the</font>

821
00:42:39,090 --> 00:42:42,690
<font color="#E5E5E5">cooperation</font><font color="#CCCCCC"> I just thought I'd mention</font>

822
00:42:40,860 --> 00:42:44,760
<font color="#E5E5E5">yeah no I actually haven't heard of that</font>

823
00:42:42,690 --> 00:42:48,480
<font color="#E5E5E5">one that's awesome serve check three</font>

824
00:42:44,760 --> 00:42:50,910
<font color="#CCCCCC">yeah SRV check</font><font color="#E5E5E5"> three : z yeah it's</font>

825
00:42:48,480 --> 00:42:57,870
really useful<font color="#E5E5E5"> awesome</font><font color="#CCCCCC"> thanks</font><font color="#E5E5E5"> yeah I'll</font>

826
00:42:50,910 --> 00:43:03,319
check<font color="#E5E5E5"> that out other questions hard to</font>

827
00:42:57,870 --> 00:43:03,319
see the top cool thank you

