1
00:00:05,600 --> 00:00:06,960
good afternoon b-sides

2
00:00:06,960 --> 00:00:09,040
my name is james and i'm here to talk to

3
00:00:09,040 --> 00:00:10,480
you today about

4
00:00:10,480 --> 00:00:13,440
purple teaming particularly with a tool

5
00:00:13,440 --> 00:00:14,799
called preload operator

6
00:00:14,799 --> 00:00:17,359
and also elastic security i do work for

7
00:00:17,359 --> 00:00:18,640
elastic myself so i'm a product

8
00:00:18,640 --> 00:00:19,520
marketing manager

9
00:00:19,520 --> 00:00:21,119
at elastic focusing on our security

10
00:00:21,119 --> 00:00:23,039
products uh but the stock is going to be

11
00:00:23,039 --> 00:00:24,880
very besides and community friendly

12
00:00:24,880 --> 00:00:26,640
and it's always a pleasure to be able to

13
00:00:26,640 --> 00:00:28,560
talk at these events

14
00:00:28,560 --> 00:00:30,240
and we don't have too much time so i am

15
00:00:30,240 --> 00:00:32,079
going to dive right in um

16
00:00:32,079 --> 00:00:33,680
and i'd like to start off just by

17
00:00:33,680 --> 00:00:35,600
introducing the the concept of purple

18
00:00:35,600 --> 00:00:37,040
teaming for those of you who might not

19
00:00:37,040 --> 00:00:39,760
be too aware about what that is

20
00:00:39,760 --> 00:00:41,920
so it's not a new concept right purple

21
00:00:41,920 --> 00:00:43,360
teaming has been around for a while but

22
00:00:43,360 --> 00:00:44,879
it has gained a bit more traction

23
00:00:44,879 --> 00:00:46,320
in the past couple of months or even a

24
00:00:46,320 --> 00:00:48,000
year or so i would say

25
00:00:48,000 --> 00:00:50,320
and the whole point is closer

26
00:00:50,320 --> 00:00:51,360
collaboration

27
00:00:51,360 --> 00:00:54,239
between a red team and a blue team and a

28
00:00:54,239 --> 00:00:56,160
lot of people know what a red team is or

29
00:00:56,160 --> 00:00:58,719
people trying to

30
00:00:58,719 --> 00:01:00,160
exploit their own organization whether

31
00:01:00,160 --> 00:01:02,879
that's a pen test whether that's

32
00:01:02,879 --> 00:01:04,720
you know running adversary emulations by

33
00:01:04,720 --> 00:01:06,320
any tool they prefer

34
00:01:06,320 --> 00:01:07,840
and then we have the blue team side of

35
00:01:07,840 --> 00:01:09,600
the house which is typically

36
00:01:09,600 --> 00:01:13,680
um trying to detect all of this behavior

37
00:01:13,680 --> 00:01:15,200
purple theming brings those two teams

38
00:01:15,200 --> 00:01:18,560
together in a very close collaboration

39
00:01:18,560 --> 00:01:20,479
exercise rather than having direct team

40
00:01:20,479 --> 00:01:21,680
do their thing

41
00:01:21,680 --> 00:01:23,520
and the blue team do their thing it's

42
00:01:23,520 --> 00:01:25,280
all about

43
00:01:25,280 --> 00:01:28,000
the red team trying things and helping

44
00:01:28,000 --> 00:01:29,520
the blue team understand what they might

45
00:01:29,520 --> 00:01:31,360
have not detected and how they can help

46
00:01:31,360 --> 00:01:32,079
detect

47
00:01:32,079 --> 00:01:33,600
and vice versa so if the blue team

48
00:01:33,600 --> 00:01:35,759
detects something and the red team

49
00:01:35,759 --> 00:01:36,960
wasn't expecting them

50
00:01:36,960 --> 00:01:40,000
their their

51
00:01:40,000 --> 00:01:42,000
you know emulations to be detected in

52
00:01:42,000 --> 00:01:43,840
that way they provide that feedback loop

53
00:01:43,840 --> 00:01:44,880
and they also provide

54
00:01:44,880 --> 00:01:47,200
an end-to-end performance of that

55
00:01:47,200 --> 00:01:48,240
exercise back

56
00:01:48,240 --> 00:01:49,360
to the business or to whoever the

57
00:01:49,360 --> 00:01:51,200
stakeholders are so just really

58
00:01:51,200 --> 00:01:52,799
close-knit collaboration between the two

59
00:01:52,799 --> 00:01:54,560
teams rather than you know there's this

60
00:01:54,560 --> 00:01:56,479
a lot of a lot of times we hear like the

61
00:01:56,479 --> 00:01:58,799
red team saying oh we we're the best we

62
00:01:58,799 --> 00:02:01,119
we defeated the blue team entirely this

63
00:02:01,119 --> 00:02:02,880
takes that approach and and

64
00:02:02,880 --> 00:02:04,399
throws out the window it's all about

65
00:02:04,399 --> 00:02:06,000
really close-knit collaboration between

66
00:02:06,000 --> 00:02:06,399
the two

67
00:02:06,399 --> 00:02:08,479
because at the end of the day their goal

68
00:02:08,479 --> 00:02:09,758
is the same to help protect their

69
00:02:09,758 --> 00:02:11,440
organization better

70
00:02:11,440 --> 00:02:13,280
so that's the concept of purple teaming

71
00:02:13,280 --> 00:02:14,879
really and

72
00:02:14,879 --> 00:02:18,080
obviously the name purple is derived

73
00:02:18,080 --> 00:02:19,120
from blue and red

74
00:02:19,120 --> 00:02:22,239
which makes absolute sense

75
00:02:22,239 --> 00:02:23,599
what are we going to look at today so

76
00:02:23,599 --> 00:02:26,720
there are a whole host

77
00:02:26,720 --> 00:02:29,760
of tools that you can use for

78
00:02:29,760 --> 00:02:32,480
uh particularly for adversariation so

79
00:02:32,480 --> 00:02:32,959
you know

80
00:02:32,959 --> 00:02:34,879
common ones like caldera it's on the red

81
00:02:34,879 --> 00:02:36,800
team red team automation

82
00:02:36,800 --> 00:02:40,080
infection monkey there's way more attack

83
00:02:40,080 --> 00:02:40,720
iq

84
00:02:40,720 --> 00:02:42,800
so there's so many dimensions uh there's

85
00:02:42,800 --> 00:02:44,480
even tools focused on

86
00:02:44,480 --> 00:02:46,879
reporting perpetual metrics like vector

87
00:02:46,879 --> 00:02:47,599
and

88
00:02:47,599 --> 00:02:48,879
and also from the blue team side and

89
00:02:48,879 --> 00:02:50,400
then there's all your traditional sim

90
00:02:50,400 --> 00:02:52,080
technologies or security analytics and

91
00:02:52,080 --> 00:02:52,800
obviously

92
00:02:52,800 --> 00:02:56,000
elastic security as product um or as a

93
00:02:56,000 --> 00:02:57,040
platform i should say

94
00:02:57,040 --> 00:03:00,159
covers that side of the of the purple

95
00:03:00,159 --> 00:03:01,280
team really well as for

96
00:03:01,280 --> 00:03:04,720
so the blue team detection reporting

97
00:03:04,720 --> 00:03:06,319
and even data collection site which

98
00:03:06,319 --> 00:03:08,720
we're going to see i'll be using elastic

99
00:03:08,720 --> 00:03:10,159
agent

100
00:03:10,159 --> 00:03:13,360
um pre-load operator it's fairly new in

101
00:03:13,360 --> 00:03:14,480
the space as

102
00:03:14,480 --> 00:03:17,360
a as a tool for it for simulation but

103
00:03:17,360 --> 00:03:18,000
they have some

104
00:03:18,000 --> 00:03:21,840
really really interesting um

105
00:03:22,400 --> 00:03:24,560
features available uh which i really

106
00:03:24,560 --> 00:03:25,519
really like so that's why i'll be

107
00:03:25,519 --> 00:03:26,879
talking about it today

108
00:03:26,879 --> 00:03:28,480
and with that being said i'm just gonna

109
00:03:28,480 --> 00:03:29,680
dive right in because we don't really

110
00:03:29,680 --> 00:03:32,000
have that much time

111
00:03:32,000 --> 00:03:33,519
so let me go right into a demo and i'll

112
00:03:33,519 --> 00:03:35,599
start off by

113
00:03:35,599 --> 00:03:37,120
talking about preloads the i pretty

114
00:03:37,120 --> 00:03:38,400
operator i should say so previous the

115
00:03:38,400 --> 00:03:40,319
company operator is the product

116
00:03:40,319 --> 00:03:43,519
and and i

117
00:03:43,519 --> 00:03:46,400
am running prelude operator on just a

118
00:03:46,400 --> 00:03:47,680
standard windows

119
00:03:47,680 --> 00:03:50,239
machine and preload the operator i keep

120
00:03:50,239 --> 00:03:51,200
saying preload i should be saying

121
00:03:51,200 --> 00:03:52,080
operator

122
00:03:52,080 --> 00:03:53,680
operator itself is totally

123
00:03:53,680 --> 00:03:55,120
cross-platform so you can run it on

124
00:03:55,120 --> 00:03:56,480
whatever

125
00:03:56,480 --> 00:03:57,920
operating system you want in fact you

126
00:03:57,920 --> 00:03:59,360
can see i have it here on my mac as well

127
00:03:59,360 --> 00:04:01,360
if you can see down below on my screen

128
00:04:01,360 --> 00:04:03,360
and i'm just going to be running it on

129
00:04:03,360 --> 00:04:04,959
windows just for

130
00:04:04,959 --> 00:04:07,120
the sake of this demo and there's a

131
00:04:07,120 --> 00:04:08,640
bunch of features i'd like to call out

132
00:04:08,640 --> 00:04:10,080
first so the whole concept with an

133
00:04:10,080 --> 00:04:10,879
operator is

134
00:04:10,879 --> 00:04:12,959
you deploy adversaries you can either

135
00:04:12,959 --> 00:04:14,640
schedule them to run or you can run them

136
00:04:14,640 --> 00:04:16,238
manually

137
00:04:16,238 --> 00:04:19,600
and they provide a lot of

138
00:04:19,600 --> 00:04:21,519
ttp so tactics techniques and procedures

139
00:04:21,519 --> 00:04:23,280
that you can just start to immediately

140
00:04:23,280 --> 00:04:24,720
use and you can see this via their

141
00:04:24,720 --> 00:04:26,240
editor plugin hopefully this is coming

142
00:04:26,240 --> 00:04:28,479
across on the screen um

143
00:04:28,479 --> 00:04:30,240
but you can see here there's a lot of

144
00:04:30,240 --> 00:04:31,759
tactics you can choose from

145
00:04:31,759 --> 00:04:33,759
some of them are tagged by particular

146
00:04:33,759 --> 00:04:36,080
adversaries or particular

147
00:04:36,080 --> 00:04:38,080
situations and outcomes or maybe even

148
00:04:38,080 --> 00:04:39,759
things like

149
00:04:39,759 --> 00:04:41,759
recent vulnerabilities you've seen like

150
00:04:41,759 --> 00:04:42,960
a hefnium

151
00:04:42,960 --> 00:04:45,600
and then you click on the tag and you

152
00:04:45,600 --> 00:04:47,120
can see the actual ttp

153
00:04:47,120 --> 00:04:49,120
and exactly what it would run and you

154
00:04:49,120 --> 00:04:50,560
have you're free to edit these as well

155
00:04:50,560 --> 00:04:52,479
that's why we're in the editor here so

156
00:04:52,479 --> 00:04:54,000
a lot of flexibility everything is

157
00:04:54,000 --> 00:04:55,600
explained really well which is one of

158
00:04:55,600 --> 00:04:58,080
the things i really like about it

159
00:04:58,080 --> 00:05:01,520
and they tell you what if if any

160
00:05:01,520 --> 00:05:03,039
sort of miter tactics and techniques

161
00:05:03,039 --> 00:05:04,800
they cover if it's deployed to any

162
00:05:04,800 --> 00:05:06,639
adversaries already

163
00:05:06,639 --> 00:05:09,520
so all of this is really well explained

164
00:05:09,520 --> 00:05:10,800
so there's a ton of these that they

165
00:05:10,800 --> 00:05:11,360
provide

166
00:05:11,360 --> 00:05:13,919
however there's a few other tools which

167
00:05:13,919 --> 00:05:15,680
are really really cool so

168
00:05:15,680 --> 00:05:20,320
um i i don't reinvent the wheel here so

169
00:05:20,320 --> 00:05:21,919
we will be talking about existing tools

170
00:05:21,919 --> 00:05:23,280
like i already mentioned atomic red team

171
00:05:23,280 --> 00:05:24,479
from red canary

172
00:05:24,479 --> 00:05:28,639
and they provide a ton of ttps which are

173
00:05:28,639 --> 00:05:30,000
very very popular

174
00:05:30,000 --> 00:05:31,840
and what preludes have allowed you to do

175
00:05:31,840 --> 00:05:33,360
with an operator is you can leverage

176
00:05:33,360 --> 00:05:35,280
those if you want or even leverage any

177
00:05:35,280 --> 00:05:37,520
for example existing color plugins even

178
00:05:37,520 --> 00:05:38,560
though they have their own

179
00:05:38,560 --> 00:05:40,080
ttps you can use whatever you're more

180
00:05:40,080 --> 00:05:41,600
comfortable with and for the sake of

181
00:05:41,600 --> 00:05:42,639
this demo i actually

182
00:05:42,639 --> 00:05:45,680
did that i loaded up you can see they

183
00:05:45,680 --> 00:05:47,600
have import atomic red team attack files

184
00:05:47,600 --> 00:05:48,560
i've done that

185
00:05:48,560 --> 00:05:50,880
and if i go back to the editor you can

186
00:05:50,880 --> 00:05:52,160
see that i have a whole section

187
00:05:52,160 --> 00:05:55,199
where i've just very simply imported

188
00:05:55,199 --> 00:05:56,560
all the atomic red team files and you

189
00:05:56,560 --> 00:05:58,240
can see here

190
00:05:58,240 --> 00:06:00,000
very very easy if i wanted to change

191
00:06:00,000 --> 00:06:01,360
them even though

192
00:06:01,360 --> 00:06:02,880
they are important from atomic red team

193
00:06:02,880 --> 00:06:04,560
i can just do that here

194
00:06:04,560 --> 00:06:06,800
so now instead of me having to run these

195
00:06:06,800 --> 00:06:08,000
um atomic

196
00:06:08,000 --> 00:06:10,880
team ttps manually or have them stored

197
00:06:10,880 --> 00:06:12,400
separately apart from my other tools

198
00:06:12,400 --> 00:06:13,840
i've just put everything into one which

199
00:06:13,840 --> 00:06:15,199
is really really nice

200
00:06:15,199 --> 00:06:17,680
and again really easy to to run as we're

201
00:06:17,680 --> 00:06:18,639
going to see

202
00:06:18,639 --> 00:06:21,360
easy to edit easy to modify and to

203
00:06:21,360 --> 00:06:22,960
deploy to any adversary

204
00:06:22,960 --> 00:06:24,319
so that's one thing i wanted to

205
00:06:24,319 --> 00:06:25,759
highlight with an operator that you can

206
00:06:25,759 --> 00:06:26,720
really

207
00:06:26,720 --> 00:06:28,560
use any sort of ttps you're comfortable

208
00:06:28,560 --> 00:06:29,919
with

209
00:06:29,919 --> 00:06:31,520
another thing they provide is which is

210
00:06:31,520 --> 00:06:34,080
really nice is the ability to

211
00:06:34,080 --> 00:06:37,680
load up any tools that you like using

212
00:06:37,680 --> 00:06:39,039
so if you have a project within github

213
00:06:39,039 --> 00:06:41,440
which you track uh again atomic rating

214
00:06:41,440 --> 00:06:42,400
might be one of them

215
00:06:42,400 --> 00:06:44,639
but maybe caldera or anything else or

216
00:06:44,639 --> 00:06:46,240
any other

217
00:06:46,240 --> 00:06:49,440
community based tool that

218
00:06:49,440 --> 00:06:51,120
you really like and you want to keep

219
00:06:51,120 --> 00:06:52,960
track of it's sort of any updates and

220
00:06:52,960 --> 00:06:53,919
stuff

221
00:06:53,919 --> 00:06:57,280
you can add those right here as well

222
00:06:57,280 --> 00:06:58,560
so you can see for example atomic grid

223
00:06:58,560 --> 00:07:00,720
team i'm synchronized with the with the

224
00:07:00,720 --> 00:07:02,960
github repository within this toolbox

225
00:07:02,960 --> 00:07:04,240
and i can see

226
00:07:04,240 --> 00:07:05,599
all the latest and greatest from that

227
00:07:05,599 --> 00:07:06,800
repo without having to stay going to

228
00:07:06,800 --> 00:07:08,000
github

229
00:07:08,000 --> 00:07:10,080
and one of the things obviously at the

230
00:07:10,080 --> 00:07:11,919
elastic that we provide

231
00:07:11,919 --> 00:07:14,639
from the bluetooth side of the house is

232
00:07:14,639 --> 00:07:16,639
a lot of detection rules so we should we

233
00:07:16,639 --> 00:07:17,199
have

234
00:07:17,199 --> 00:07:20,960
over i think it's 550 detection rules

235
00:07:20,960 --> 00:07:22,319
which are all public and i get super

236
00:07:22,319 --> 00:07:23,440
positive for anyone to use and

237
00:07:23,440 --> 00:07:24,720
contribute to

238
00:07:24,720 --> 00:07:26,240
and i have that hooked up right here as

239
00:07:26,240 --> 00:07:27,680
well so you can do stuff like that so

240
00:07:27,680 --> 00:07:28,160
you

241
00:07:28,160 --> 00:07:29,680
the the concept of integrating tools

242
00:07:29,680 --> 00:07:31,039
that you might be already using is

243
00:07:31,039 --> 00:07:32,960
really really handy

244
00:07:32,960 --> 00:07:35,360
another thing is you might already have

245
00:07:35,360 --> 00:07:37,759
an existing

246
00:07:37,759 --> 00:07:39,120
blue team infrastructure so you might

247
00:07:39,120 --> 00:07:40,880
have a sim you might have

248
00:07:40,880 --> 00:07:42,160
a security analytics tool you might have

249
00:07:42,160 --> 00:07:44,960
something like elastic so what

250
00:07:44,960 --> 00:07:46,720
preload have provided through operator

251
00:07:46,720 --> 00:07:49,039
as well is the ability

252
00:07:49,039 --> 00:07:51,599
to deploy attack ranges and even

253
00:07:51,599 --> 00:07:53,280
something they call their cloud

254
00:07:53,280 --> 00:07:55,919
redirector so i'm running operator

255
00:07:55,919 --> 00:07:57,440
locally on a machine

256
00:07:57,440 --> 00:07:59,039
but as we all know in an enterprise

257
00:07:59,039 --> 00:08:00,479
that's not going to be the case so what

258
00:08:00,479 --> 00:08:01,919
you can do is you can set up sort of

259
00:08:01,919 --> 00:08:03,599
like a cloud redirector

260
00:08:03,599 --> 00:08:05,840
and have remote agents report into that

261
00:08:05,840 --> 00:08:06,879
redirector

262
00:08:06,879 --> 00:08:08,240
and you can have everything managed

263
00:08:08,240 --> 00:08:09,520
through there it's really really nice

264
00:08:09,520 --> 00:08:11,440
and really easy to set up

265
00:08:11,440 --> 00:08:14,720
but you can also see it set up here um

266
00:08:14,720 --> 00:08:17,120
an elastic range if you wanted to and

267
00:08:17,120 --> 00:08:18,800
they're already utilizing

268
00:08:18,800 --> 00:08:20,879
some of our latest features like uh

269
00:08:20,879 --> 00:08:22,720
fleet so centralized management so you

270
00:08:22,720 --> 00:08:24,639
literally just put in your fleet url

271
00:08:24,639 --> 00:08:27,120
and the free token and it will not only

272
00:08:27,120 --> 00:08:28,560
deploy

273
00:08:28,560 --> 00:08:31,360
an agent a fleet agent i should say an

274
00:08:31,360 --> 00:08:33,360
elastic agent on that host but it will

275
00:08:33,360 --> 00:08:34,719
also drop

276
00:08:34,719 --> 00:08:37,839
an operator agent so you're with

277
00:08:37,839 --> 00:08:41,599
one click you're basically deploying um

278
00:08:41,599 --> 00:08:44,159
a data collection and you're going to be

279
00:08:44,159 --> 00:08:45,040
have the agent that's

280
00:08:45,040 --> 00:08:46,480
going to doing the adverse emulation on

281
00:08:46,480 --> 00:08:48,560
that machine as well in one click

282
00:08:48,560 --> 00:08:49,920
and it's not just elastic that they do

283
00:08:49,920 --> 00:08:52,000
this for so there is a you can set up a

284
00:08:52,000 --> 00:08:53,680
similar thing with splunk

285
00:08:53,680 --> 00:08:56,080
and a few others as well and then they

286
00:08:56,080 --> 00:08:57,040
even have things like

287
00:08:57,040 --> 00:08:58,480
integration with azure and stuff so

288
00:08:58,480 --> 00:09:00,160
there's a really really rich set of

289
00:09:00,160 --> 00:09:02,080
features within operator which is

290
00:09:02,080 --> 00:09:03,440
one of the reasons why i like it because

291
00:09:03,440 --> 00:09:05,440
it just makes things really easy for

292
00:09:05,440 --> 00:09:09,360
for teams so let's run an emulation

293
00:09:09,360 --> 00:09:10,480
exercise so i'm going to go

294
00:09:10,480 --> 00:09:13,279
into operate and i have my host here and

295
00:09:13,279 --> 00:09:14,480
you can see i can just immediately

296
00:09:14,480 --> 00:09:15,839
deploy an adversary

297
00:09:15,839 --> 00:09:17,519
i can create an adversary on the fly and

298
00:09:17,519 --> 00:09:18,800
remember an adversity is basically a

299
00:09:18,800 --> 00:09:21,040
collection of ttps

300
00:09:21,040 --> 00:09:22,880
um i created one for b sides i've

301
00:09:22,880 --> 00:09:24,160
already deployed it but we can deploy it

302
00:09:24,160 --> 00:09:24,800
again

303
00:09:24,800 --> 00:09:26,320
so i'm just going to deploy it and you

304
00:09:26,320 --> 00:09:27,839
can see it immediately starts running on

305
00:09:27,839 --> 00:09:28,720
my host

306
00:09:28,720 --> 00:09:30,880
if i was using the cloud redirector or i

307
00:09:30,880 --> 00:09:32,800
had another host i just simply picked

308
00:09:32,800 --> 00:09:34,399
the range of machines that i want to run

309
00:09:34,399 --> 00:09:35,839
it on and i would have deployed that

310
00:09:35,839 --> 00:09:37,680
adversary on that machine

311
00:09:37,680 --> 00:09:39,600
and you get um as it's running you get

312
00:09:39,600 --> 00:09:41,680
sort of a like many other tools you get

313
00:09:41,680 --> 00:09:41,920
a

314
00:09:41,920 --> 00:09:45,120
immediate feedback loop

315
00:09:45,120 --> 00:09:46,880
and so this is just running one of those

316
00:09:46,880 --> 00:09:49,279
ttps which requires 7-zip

317
00:09:49,279 --> 00:09:52,240
um and it's all happening in the

318
00:09:52,240 --> 00:09:53,120
background

319
00:09:53,120 --> 00:09:54,720
and you get you can see everything

320
00:09:54,720 --> 00:09:56,320
that's going on so if something failed

321
00:09:56,320 --> 00:09:57,519
you can see why

322
00:09:57,519 --> 00:09:59,200
and for example this is trying to query

323
00:09:59,200 --> 00:10:00,880
domain computers this

324
00:10:00,880 --> 00:10:02,399
machine is not part of a domain so

325
00:10:02,399 --> 00:10:04,240
that's very well explained

326
00:10:04,240 --> 00:10:06,160
and every single ttp is also really well

327
00:10:06,160 --> 00:10:08,480
explained

328
00:10:08,480 --> 00:10:09,760
excellent so that's the verse here is

329
00:10:09,760 --> 00:10:12,640
ran so from the from the red team side

330
00:10:12,640 --> 00:10:15,519
they're doing their job um what about

331
00:10:15,519 --> 00:10:16,720
the blue team side where does elastic

332
00:10:16,720 --> 00:10:18,720
security fit in and this fits in in many

333
00:10:18,720 --> 00:10:20,320
ways so remember the whole concept

334
00:10:20,320 --> 00:10:21,920
is we're running an exercise with our

335
00:10:21,920 --> 00:10:23,519
red team and the blue team needs to

336
00:10:23,519 --> 00:10:24,720
determine hey

337
00:10:24,720 --> 00:10:26,320
did we detect everything the red team

338
00:10:26,320 --> 00:10:27,760
ran

339
00:10:27,760 --> 00:10:31,200
if not how come do we have missing

340
00:10:31,200 --> 00:10:33,360
detection rules are we not collecting a

341
00:10:33,360 --> 00:10:34,560
certain

342
00:10:34,560 --> 00:10:35,920
data set that we need to be able to

343
00:10:35,920 --> 00:10:38,320
detect this and did something fail

344
00:10:38,320 --> 00:10:41,040
and did they deploy a new technique and

345
00:10:41,040 --> 00:10:41,600
that's the

346
00:10:41,600 --> 00:10:42,480
that's what we're going to start doing

347
00:10:42,480 --> 00:10:44,240
inside of elastic so this adversary has

348
00:10:44,240 --> 00:10:46,560
ran or still running

349
00:10:46,560 --> 00:10:48,800
and at any time you can clear any

350
00:10:48,800 --> 00:10:50,079
pending procedures or

351
00:10:50,079 --> 00:10:52,000
pending ttps that need to be run but

352
00:10:52,000 --> 00:10:53,440
let's um

353
00:10:53,440 --> 00:10:55,200
let's dive into elastic the elastic side

354
00:10:55,200 --> 00:10:56,160
now so i'm just going to put this

355
00:10:56,160 --> 00:10:57,680
machine aside

356
00:10:57,680 --> 00:11:00,399
and we'll start off in kibana so for

357
00:11:00,399 --> 00:11:01,440
those of you aren't familiar with

358
00:11:01,440 --> 00:11:02,160
elastic

359
00:11:02,160 --> 00:11:04,880
cabana is our user interface we have a

360
00:11:04,880 --> 00:11:06,959
dedicated security solution

361
00:11:06,959 --> 00:11:08,480
which is which is what i'm in here and

362
00:11:08,480 --> 00:11:09,360
everything you're seeing comes out of

363
00:11:09,360 --> 00:11:10,560
the box

364
00:11:10,560 --> 00:11:12,399
i have not done anything custom about

365
00:11:12,399 --> 00:11:14,640
what you what you're seeing right now

366
00:11:14,640 --> 00:11:17,760
um and it's all part of the the free

367
00:11:17,760 --> 00:11:19,040
version so none of what you're going to

368
00:11:19,040 --> 00:11:20,480
see is a paid feature

369
00:11:20,480 --> 00:11:21,760
so you can start running this

370
00:11:21,760 --> 00:11:24,399
immediately today uh without ever having

371
00:11:24,399 --> 00:11:26,839
to pay us in

372
00:11:26,839 --> 00:11:29,200
so we start off

373
00:11:29,200 --> 00:11:31,040
uh particularly from blue team you

374
00:11:31,040 --> 00:11:32,160
typically start off with in your

375
00:11:32,160 --> 00:11:33,600
detections view right so what

376
00:11:33,600 --> 00:11:35,200
have we detected as part of this running

377
00:11:35,200 --> 00:11:37,680
exercise and you can see here within the

378
00:11:37,680 --> 00:11:38,640
detections page

379
00:11:38,640 --> 00:11:40,240
i have some detections that fired from

380
00:11:40,240 --> 00:11:42,959
earlier today some will fire again

381
00:11:42,959 --> 00:11:46,160
as i as the new emulation ran

382
00:11:46,160 --> 00:11:47,360
but you can see here within the

383
00:11:47,360 --> 00:11:49,120
detections view i can clearly see

384
00:11:49,120 --> 00:11:50,959
already what's what's starting to happen

385
00:11:50,959 --> 00:11:51,600
so i had

386
00:11:51,600 --> 00:11:53,600
rules like encoding or the coding files

387
00:11:53,600 --> 00:11:54,880
were asserted till

388
00:11:54,880 --> 00:11:56,320
and i can clearly see that it was

389
00:11:56,320 --> 00:11:57,920
running out of operator

390
00:11:57,920 --> 00:12:00,240
but what's nice about it is even without

391
00:12:00,240 --> 00:12:01,920
the red team telling me

392
00:12:01,920 --> 00:12:04,079
i know what was run because of the the

393
00:12:04,079 --> 00:12:05,360
way we collect data

394
00:12:05,360 --> 00:12:07,120
and all of this data by the way so on

395
00:12:07,120 --> 00:12:08,560
this machine if i just bring it back we

396
00:12:08,560 --> 00:12:10,240
do have elastic agent running

397
00:12:10,240 --> 00:12:12,480
with endpoint security so we have an

398
00:12:12,480 --> 00:12:14,000
endpoint security integration for our

399
00:12:14,000 --> 00:12:15,680
agent which is basically doing all the

400
00:12:15,680 --> 00:12:17,120
really rich data collection

401
00:12:17,120 --> 00:12:18,480
it also has malware detection and

402
00:12:18,480 --> 00:12:19,920
prevention running on it which is also

403
00:12:19,920 --> 00:12:21,200
part of what you get

404
00:12:21,200 --> 00:12:23,600
included for free so you will see for

405
00:12:23,600 --> 00:12:25,040
example some malware alerts trigger

406
00:12:25,040 --> 00:12:26,639
because of some of the payloads that

407
00:12:26,639 --> 00:12:28,320
operator uses or even autonomous red

408
00:12:28,320 --> 00:12:30,000
team have some malicious payloads as

409
00:12:30,000 --> 00:12:32,959
well so we pick those up anyway

410
00:12:32,959 --> 00:12:34,480
um so you can see this is one of the

411
00:12:34,480 --> 00:12:36,560
hero malware detection alerts atomic red

412
00:12:36,560 --> 00:12:37,600
theme

413
00:12:37,600 --> 00:12:40,000
this particular executable is determined

414
00:12:40,000 --> 00:12:41,440
to be uh malware

415
00:12:41,440 --> 00:12:42,560
but you can see how easy it is to

416
00:12:42,560 --> 00:12:45,120
understand so what i like to do in this

417
00:12:45,120 --> 00:12:46,480
case because there's quite a few alerts

418
00:12:46,480 --> 00:12:47,920
coming in when we started running this

419
00:12:47,920 --> 00:12:49,600
exercise now the from a bluetooth

420
00:12:49,600 --> 00:12:52,240
perspective we have to try and determine

421
00:12:52,240 --> 00:12:54,160
number one is everything part of this

422
00:12:54,160 --> 00:12:55,519
exercise so there's an easy way to

423
00:12:55,519 --> 00:12:57,120
filter those out when you use a specific

424
00:12:57,120 --> 00:12:57,680
tool

425
00:12:57,680 --> 00:13:00,079
but number two did we detect everything

426
00:13:00,079 --> 00:13:01,200
or are we just looking

427
00:13:01,200 --> 00:13:04,240
at or is some of it coming in as data

428
00:13:04,240 --> 00:13:05,440
without detections

429
00:13:05,440 --> 00:13:07,200
and a really easy way to start looking

430
00:13:07,200 --> 00:13:09,279
at that is by

431
00:13:09,279 --> 00:13:11,680
we can apply a filter and we can also

432
00:13:11,680 --> 00:13:13,040
look at that in what we call our

433
00:13:13,040 --> 00:13:13,519
timeline

434
00:13:13,519 --> 00:13:15,279
in fact i have a prepared timeline just

435
00:13:15,279 --> 00:13:17,519
in the interest of time

436
00:13:17,519 --> 00:13:18,959
and the timeline basically allows you to

437
00:13:18,959 --> 00:13:21,120
to search across all your data sets

438
00:13:21,120 --> 00:13:23,040
for anything you want and you can see

439
00:13:23,040 --> 00:13:24,320
it's a very similar view with what we

440
00:13:24,320 --> 00:13:25,360
call those

441
00:13:25,360 --> 00:13:28,320
row renderers and but it combines the

442
00:13:28,320 --> 00:13:29,680
detections

443
00:13:29,680 --> 00:13:32,320
and also the raw data so if i so i'm

444
00:13:32,320 --> 00:13:34,240
missing something i can get

445
00:13:34,240 --> 00:13:36,000
a bird's eye view of it right within

446
00:13:36,000 --> 00:13:38,639
here and you can see i applied a filter

447
00:13:38,639 --> 00:13:39,920
i have a saved query here which

448
00:13:39,920 --> 00:13:41,360
basically looks for

449
00:13:41,360 --> 00:13:44,560
um which basically

450
00:13:44,560 --> 00:13:46,639
shows me what's coming out of the

451
00:13:46,639 --> 00:13:48,639
operator directory

452
00:13:48,639 --> 00:13:51,040
and i'm excluding the actual operator

453
00:13:51,040 --> 00:13:52,320
process itself just to make sure it

454
00:13:52,320 --> 00:13:54,399
doesn't get convoluted

455
00:13:54,399 --> 00:13:57,980
and you can see today i had 193

456
00:13:57,980 --> 00:13:59,120
[Music]

457
00:13:59,120 --> 00:14:02,399
logs essentially that match that

458
00:14:02,399 --> 00:14:03,920
and you can see some of them are in

459
00:14:03,920 --> 00:14:06,480
yellow which means they were detections

460
00:14:06,480 --> 00:14:09,360
some of them are not so basically what

461
00:14:09,360 --> 00:14:10,399
i'm seeing here is

462
00:14:10,399 --> 00:14:12,480
i have a very immediate indication that

463
00:14:12,480 --> 00:14:14,079
listen my red team is doing something

464
00:14:14,079 --> 00:14:15,279
with operator

465
00:14:15,279 --> 00:14:16,480
and i don't have a corresponding

466
00:14:16,480 --> 00:14:18,000
detection for it so that's number one

467
00:14:18,000 --> 00:14:19,120
that's metric number one

468
00:14:19,120 --> 00:14:21,839
where we have the red team doing stuff

469
00:14:21,839 --> 00:14:24,160
and we didn't automatically detect it

470
00:14:24,160 --> 00:14:25,519
we have the data coming in which is

471
00:14:25,519 --> 00:14:27,920
fantastic but we haven't we did not have

472
00:14:27,920 --> 00:14:29,920
an out of the box or i should say a

473
00:14:29,920 --> 00:14:30,560
pre-built

474
00:14:30,560 --> 00:14:31,920
detection rule whether that's one that

475
00:14:31,920 --> 00:14:33,519
elastic has given me or one that we've

476
00:14:33,519 --> 00:14:34,560
created ourselves

477
00:14:34,560 --> 00:14:36,399
in my environment i have not turned all

478
00:14:36,399 --> 00:14:37,839
the rules on just for this exercise

479
00:14:37,839 --> 00:14:38,880
because otherwise probably would have

480
00:14:38,880 --> 00:14:40,399
detected everything

481
00:14:40,399 --> 00:14:41,600
but i wanted to show you how easy that

482
00:14:41,600 --> 00:14:43,680
would have been um

483
00:14:43,680 --> 00:14:45,040
so you can see here for example i can

484
00:14:45,040 --> 00:14:46,880
switch i can pivot between just viewing

485
00:14:46,880 --> 00:14:48,079
the detections

486
00:14:48,079 --> 00:14:50,480
or just viewing the the logs so if i

487
00:14:50,480 --> 00:14:52,000
wanted to just say okay what did we

488
00:14:52,000 --> 00:14:53,199
detect

489
00:14:53,199 --> 00:14:54,639
during our emulation exercising our

490
00:14:54,639 --> 00:14:56,240
purple team exercise today

491
00:14:56,240 --> 00:14:58,639
i can just show the detection alerts and

492
00:14:58,639 --> 00:14:59,279
it will

493
00:14:59,279 --> 00:15:01,600
only show me the detections and then i

494
00:15:01,600 --> 00:15:03,199
can pivot and say okay we have these

495
00:15:03,199 --> 00:15:04,000
detections

496
00:15:04,000 --> 00:15:06,720
what didn't we detect so i can exclude

497
00:15:06,720 --> 00:15:08,240
the detection so pretty much

498
00:15:08,240 --> 00:15:10,800
what's not in yellow is a miss from my

499
00:15:10,800 --> 00:15:12,639
part it's something that uh

500
00:15:12,639 --> 00:15:14,480
obviously during a demo i get a few

501
00:15:14,480 --> 00:15:16,560
errors but that's okay it wasn't too bad

502
00:15:16,560 --> 00:15:18,160
but you can see we have the

503
00:15:18,160 --> 00:15:19,440
all the all these and yellows were

504
00:15:19,440 --> 00:15:21,680
detections so we had five detections

505
00:15:21,680 --> 00:15:24,160
today some of them might be repeatable

506
00:15:24,160 --> 00:15:26,000
so if we look at for example the name of

507
00:15:26,000 --> 00:15:27,519
this detection

508
00:15:27,519 --> 00:15:29,920
we can see what it is so i'll just pull

509
00:15:29,920 --> 00:15:31,519
up the details here on the side

510
00:15:31,519 --> 00:15:33,360
and it will basically give me the

511
00:15:33,360 --> 00:15:34,800
detection name

512
00:15:34,800 --> 00:15:37,600
and but i can see exactly what was run

513
00:15:37,600 --> 00:15:38,959
as well

514
00:15:38,959 --> 00:15:40,959
uh my instance is behaving a bit oddly

515
00:15:40,959 --> 00:15:42,800
today no problem let's woke up

516
00:15:42,800 --> 00:15:44,079
so you can see this rule in particular

517
00:15:44,079 --> 00:15:45,680
is powershell spawning command prompt

518
00:15:45,680 --> 00:15:47,040
and i can see

519
00:15:47,040 --> 00:15:50,240
um if i tell you exactly what happened

520
00:15:50,240 --> 00:15:52,839
here which matches that description so

521
00:15:52,839 --> 00:15:56,240
um james on this host

522
00:15:56,240 --> 00:15:58,160
and this on this domain on this host and

523
00:15:58,160 --> 00:15:59,920
this directory started command prompt

524
00:15:59,920 --> 00:16:00,560
with these

525
00:16:00,560 --> 00:16:02,480
arguments so you can see group domain

526
00:16:02,480 --> 00:16:04,240
computers and via parent process

527
00:16:04,240 --> 00:16:05,199
powershell

528
00:16:05,199 --> 00:16:07,680
so we detected that via this rule and we

529
00:16:07,680 --> 00:16:08,880
also have some other views that you can

530
00:16:08,880 --> 00:16:10,160
look at this as well so if i click on

531
00:16:10,160 --> 00:16:10,720
the what's

532
00:16:10,720 --> 00:16:12,720
called the event analyzer i can see the

533
00:16:12,720 --> 00:16:13,920
the full process tree

534
00:16:13,920 --> 00:16:14,959
it might be easier for some to

535
00:16:14,959 --> 00:16:16,560
understand and digest what happened when

536
00:16:16,560 --> 00:16:17,759
the when the

537
00:16:17,759 --> 00:16:21,040
the red team ran that exercise so we

538
00:16:21,040 --> 00:16:22,240
also have this

539
00:16:22,240 --> 00:16:24,160
view as well uh i would just let this

540
00:16:24,160 --> 00:16:26,480
load for a second because today my

541
00:16:26,480 --> 00:16:29,440
uh my instance is incorporating of

542
00:16:29,440 --> 00:16:30,880
course whenever you do a recording a

543
00:16:30,880 --> 00:16:31,519
demo

544
00:16:31,519 --> 00:16:33,519
uh it always happens but you can see

545
00:16:33,519 --> 00:16:35,360
here there we go so

546
00:16:35,360 --> 00:16:38,320
i can see a launch fire operator we can

547
00:16:38,320 --> 00:16:40,079
see powershell response command prompt

548
00:16:40,079 --> 00:16:41,519
response i'm

549
00:16:41,519 --> 00:16:44,079
doing that query for the domain groups

550
00:16:44,079 --> 00:16:45,199
by the net process

551
00:16:45,199 --> 00:16:46,560
and i have all this information that i

552
00:16:46,560 --> 00:16:48,000
can see right here so some people might

553
00:16:48,000 --> 00:16:49,519
prefer this view which i like

554
00:16:49,519 --> 00:16:52,480
which i like that you have the option uh

555
00:16:52,480 --> 00:16:53,759
rather than just looking at

556
00:16:53,759 --> 00:16:55,600
the text itself when you're going

557
00:16:55,600 --> 00:16:56,880
through an exercise it's important that

558
00:16:56,880 --> 00:16:58,079
you keep track of this right so as

559
00:16:58,079 --> 00:16:59,839
you're going to the purple team exercise

560
00:16:59,839 --> 00:17:01,759
and if you spot the detection what i

561
00:17:01,759 --> 00:17:03,279
like to do is

562
00:17:03,279 --> 00:17:05,039
we can open up what we call a case

563
00:17:05,039 --> 00:17:06,720
within elastic security where we

564
00:17:06,720 --> 00:17:08,079
can keep track of everything we've

565
00:17:08,079 --> 00:17:10,559
detected and you can see i also saved

566
00:17:10,559 --> 00:17:12,559
this as a timeline called b-sides

567
00:17:12,559 --> 00:17:14,319
but you can typically in reality if

568
00:17:14,319 --> 00:17:16,000
you're running an exercise you would

569
00:17:16,000 --> 00:17:18,160
call it accordingly but we have an

570
00:17:18,160 --> 00:17:19,520
option here to add

571
00:17:19,520 --> 00:17:22,640
an alert to a case so i'm going to go

572
00:17:22,640 --> 00:17:23,839
ahead and do that i'll add this to a new

573
00:17:23,839 --> 00:17:24,240
case

574
00:17:24,240 --> 00:17:25,679
and this just really helps me keep track

575
00:17:25,679 --> 00:17:27,280
of like here's the case for

576
00:17:27,280 --> 00:17:30,320
our purple theming exercise so

577
00:17:30,320 --> 00:17:32,799
we can do that here so i'm just get rid

578
00:17:32,799 --> 00:17:34,640
of this

579
00:17:34,640 --> 00:17:39,120
and i'll turn it off so

580
00:17:39,120 --> 00:17:43,440
teaming exercise as an example

581
00:17:43,440 --> 00:17:45,600
there we go thank you spell check i can

582
00:17:45,600 --> 00:17:47,200
put in a description i can i can even

583
00:17:47,200 --> 00:17:49,200
synchronize with the third-party system

584
00:17:49,200 --> 00:17:51,440
and let's not do this for now and then i

585
00:17:51,440 --> 00:17:53,039
can put in a description and it will add

586
00:17:53,039 --> 00:17:54,720
that alert to that case so i can keep

587
00:17:54,720 --> 00:17:56,400
track of everything i've detected during

588
00:17:56,400 --> 00:17:57,840
that case

589
00:17:57,840 --> 00:18:01,760
on the inverse side i can say

590
00:18:01,760 --> 00:18:03,919
what data has come in via operator that

591
00:18:03,919 --> 00:18:06,000
we didn't detect so

592
00:18:06,000 --> 00:18:08,160
i'll just open that again so we can do

593
00:18:08,160 --> 00:18:09,600
the inverse right i can basically

594
00:18:09,600 --> 00:18:11,039
instead of looking at just the detection

595
00:18:11,039 --> 00:18:12,000
alerts

596
00:18:12,000 --> 00:18:13,600
i can look at everything or just the

597
00:18:13,600 --> 00:18:15,120
events in this case we just look at the

598
00:18:15,120 --> 00:18:17,039
events and we'll see the difference

599
00:18:17,039 --> 00:18:19,120
so this is important because now within

600
00:18:19,120 --> 00:18:20,720
one view

601
00:18:20,720 --> 00:18:22,799
i have i know exactly what my red team

602
00:18:22,799 --> 00:18:24,400
has been running

603
00:18:24,400 --> 00:18:26,799
i know what we've detected thanks to our

604
00:18:26,799 --> 00:18:28,480
predefined detection rules

605
00:18:28,480 --> 00:18:30,559
and i know what we've we've looked what

606
00:18:30,559 --> 00:18:33,360
we've collected but we didn't detect

607
00:18:33,360 --> 00:18:34,720
and all of this was done through the

608
00:18:34,720 --> 00:18:36,320
through the whole timeline function so

609
00:18:36,320 --> 00:18:37,760
obviously and then if we detected

610
00:18:37,760 --> 00:18:39,520
something that we didn't pick up

611
00:18:39,520 --> 00:18:41,919
so here we picked for example whatever

612
00:18:41,919 --> 00:18:43,280
was ran

613
00:18:43,280 --> 00:18:46,160
we can see started process 7-zip and we

614
00:18:46,160 --> 00:18:47,679
ran these arguments

615
00:18:47,679 --> 00:18:49,440
and via command prompt we didn't detect

616
00:18:49,440 --> 00:18:51,039
that so if i wanted to create a

617
00:18:51,039 --> 00:18:52,400
detection rule for it

618
00:18:52,400 --> 00:18:55,760
and i can do that so we can literally

619
00:18:55,760 --> 00:18:58,720
if we wanted to look at uh creating a

620
00:18:58,720 --> 00:19:00,080
query just for that so there's multiple

621
00:19:00,080 --> 00:19:01,679
ways we can do that with an elastic

622
00:19:01,679 --> 00:19:04,240
and it's all defined within the same

623
00:19:04,240 --> 00:19:07,919
view so we have the detection engine

624
00:19:08,559 --> 00:19:10,720
there's something else though so what's

625
00:19:10,720 --> 00:19:12,320
nice about operator

626
00:19:12,320 --> 00:19:16,240
is and just bring that into focus again

627
00:19:16,240 --> 00:19:18,000
as you're running an emulation it

628
00:19:18,000 --> 00:19:19,280
creates a report

629
00:19:19,280 --> 00:19:21,280
so you have a nice reporting view but

630
00:19:21,280 --> 00:19:24,000
what's even better about it is you can

631
00:19:24,000 --> 00:19:27,520
continuously feed this live into a tool

632
00:19:27,520 --> 00:19:28,480
like elastic

633
00:19:28,480 --> 00:19:30,880
as an index or you can export it as a

634
00:19:30,880 --> 00:19:32,960
json file if you wanted to

635
00:19:32,960 --> 00:19:34,960
i'm doing that in the background so what

636
00:19:34,960 --> 00:19:36,160
i've done is

637
00:19:36,160 --> 00:19:38,480
all this data so not only am i

638
00:19:38,480 --> 00:19:39,919
collecting the raw data as the result of

639
00:19:39,919 --> 00:19:41,440
the emulation but i'm also collecting

640
00:19:41,440 --> 00:19:43,679
all the emulation actions

641
00:19:43,679 --> 00:19:45,520
why don't we correlate that right so

642
00:19:45,520 --> 00:19:47,840
what uh what um

643
00:19:47,840 --> 00:19:49,919
operator does as part of that report so

644
00:19:49,919 --> 00:19:51,360
this is like the raw data but we'll look

645
00:19:51,360 --> 00:19:53,280
at it inside of the timeline as well

646
00:19:53,280 --> 00:19:57,120
so they provide as you're running ttps

647
00:19:57,120 --> 00:20:00,240
you can see the the process id of the

648
00:20:00,240 --> 00:20:02,640
of what was ran you can see the request

649
00:20:02,640 --> 00:20:04,159
that was sent from operator and you can

650
00:20:04,159 --> 00:20:06,000
see the response of something failed

651
00:20:06,000 --> 00:20:07,520
something wasn't successful if something

652
00:20:07,520 --> 00:20:09,039
was successful you get all of that back

653
00:20:09,039 --> 00:20:10,240
you get the technique

654
00:20:10,240 --> 00:20:11,520
so i'm going to correlate this data with

655
00:20:11,520 --> 00:20:12,799
the data that i'm bringing and i'm going

656
00:20:12,799 --> 00:20:14,080
to use

657
00:20:14,080 --> 00:20:17,360
um eql for this so we have a event query

658
00:20:17,360 --> 00:20:19,120
language within elastic

659
00:20:19,120 --> 00:20:20,640
and you can see i have this correlate

660
00:20:20,640 --> 00:20:23,039
tab i've already pre-built this query

661
00:20:23,039 --> 00:20:24,960
but i'll walk you through it

662
00:20:24,960 --> 00:20:26,960
and i'll explain why this is red so it

663
00:20:26,960 --> 00:20:28,880
does syntax validation for me

664
00:20:28,880 --> 00:20:31,440
and so you can query any index pattern

665
00:20:31,440 --> 00:20:32,400
that you want

666
00:20:32,400 --> 00:20:35,039
and so in this case i need to include

667
00:20:35,039 --> 00:20:36,480
the results

668
00:20:36,480 --> 00:20:39,679
of operator

669
00:20:39,679 --> 00:20:41,360
which is its own index so if as soon as

670
00:20:41,360 --> 00:20:43,600
i add that in there and then

671
00:20:43,600 --> 00:20:45,360
i can correlate and i'm gonna i'm gonna

672
00:20:45,360 --> 00:20:46,960
narrow this down a bit more because i

673
00:20:46,960 --> 00:20:48,400
only care about the data coming from

674
00:20:48,400 --> 00:20:49,520
elastic agent

675
00:20:49,520 --> 00:20:51,679
which is under this logs index and we

676
00:20:51,679 --> 00:20:53,440
can leave that signals index in there as

677
00:20:53,440 --> 00:20:54,640
well

678
00:20:54,640 --> 00:20:57,840
and i hit save so now my query is

679
00:20:57,840 --> 00:20:58,799
essentially looking i'm going to look

680
00:20:58,799 --> 00:21:01,039
for a sequence of events where i have

681
00:21:01,039 --> 00:21:04,159
a process running

682
00:21:04,159 --> 00:21:06,799
by a certain process id i'm going to

683
00:21:06,799 --> 00:21:08,400
match that with the data coming from

684
00:21:08,400 --> 00:21:09,280
operator

685
00:21:09,280 --> 00:21:12,960
by its process id so technically

686
00:21:12,960 --> 00:21:15,840
i should see for every ttp that was

687
00:21:15,840 --> 00:21:17,039
around an operator

688
00:21:17,039 --> 00:21:18,320
if i've collected everything i should

689
00:21:18,320 --> 00:21:20,159
see a corresponding process

690
00:21:20,159 --> 00:21:21,600
and you can see and these are the

691
00:21:21,600 --> 00:21:23,039
results of a sequence so the difference

692
00:21:23,039 --> 00:21:24,559
in color is basically where every time

693
00:21:24,559 --> 00:21:26,080
there was a sequence match

694
00:21:26,080 --> 00:21:27,280
so this is the first match in the

695
00:21:27,280 --> 00:21:29,120
sequence this is another match and you

696
00:21:29,120 --> 00:21:30,480
can see i have 10

697
00:21:30,480 --> 00:21:32,559
because i had five ttps which means i

698
00:21:32,559 --> 00:21:34,080
had two logs per ttp

699
00:21:34,080 --> 00:21:36,080
which is exactly what i want to see so

700
00:21:36,080 --> 00:21:38,320
you can see here i have

701
00:21:38,320 --> 00:21:42,240
um the the log that we collected so you

702
00:21:42,240 --> 00:21:43,120
can see

703
00:21:43,120 --> 00:21:45,120
um terminated process command prompt

704
00:21:45,120 --> 00:21:47,200
that ran these arguments so let's let's

705
00:21:47,200 --> 00:21:48,000
say at once

706
00:21:48,000 --> 00:21:50,880
the firewall show all profiles and then

707
00:21:50,880 --> 00:21:51,840
i have another one here

708
00:21:51,840 --> 00:21:53,600
this doesn't have row rendering it looks

709
00:21:53,600 --> 00:21:55,200
blank but it actually has data so if we

710
00:21:55,200 --> 00:21:57,280
just expand this video to see

711
00:21:57,280 --> 00:21:58,799
and what this is going to show me is the

712
00:21:58,799 --> 00:22:00,880
log from operator where the pit matched

713
00:22:00,880 --> 00:22:02,320
that's really cool right because now i

714
00:22:02,320 --> 00:22:05,120
can see um

715
00:22:05,120 --> 00:22:07,440
the the response that the red team got

716
00:22:07,440 --> 00:22:09,200
without having to go to the red team so

717
00:22:09,200 --> 00:22:11,039
that full feedback loop is right within

718
00:22:11,039 --> 00:22:12,799
the blue teaming eyes as well

719
00:22:12,799 --> 00:22:15,200
so both sides of the house get it and i

720
00:22:15,200 --> 00:22:16,480
can see exactly what

721
00:22:16,480 --> 00:22:18,400
operator ran and i've matched it to the

722
00:22:18,400 --> 00:22:20,400
corresponding long that i got

723
00:22:20,400 --> 00:22:22,080
and this is thanks to eql because we can

724
00:22:22,080 --> 00:22:23,520
do that correlation based off of the

725
00:22:23,520 --> 00:22:24,400
process id

726
00:22:24,400 --> 00:22:25,440
you can see here even though they're

727
00:22:25,440 --> 00:22:27,760
different fields we can still do that um

728
00:22:27,760 --> 00:22:29,039
which is quite nice so

729
00:22:29,039 --> 00:22:31,600
here i'm querying for any process and

730
00:22:31,600 --> 00:22:32,080
here i'm

731
00:22:32,080 --> 00:22:34,480
looking for any ttp and i'm just

732
00:22:34,480 --> 00:22:36,640
matching based off of the process id

733
00:22:36,640 --> 00:22:38,559
so you can do stuff like that as well we

734
00:22:38,559 --> 00:22:40,159
have too much time left so

735
00:22:40,159 --> 00:22:42,960
um what i'd like to like to do is now

736
00:22:42,960 --> 00:22:44,559
how we can

737
00:22:44,559 --> 00:22:45,919
show how we can provide this back to the

738
00:22:45,919 --> 00:22:47,520
business so so far we've looked at

739
00:22:47,520 --> 00:22:48,799
everything graphical and we've looked at

740
00:22:48,799 --> 00:22:50,159
the blue team and the red team and how

741
00:22:50,159 --> 00:22:51,679
what they can do and what the blue team

742
00:22:51,679 --> 00:22:53,039
can detect and

743
00:22:53,039 --> 00:22:54,240
everything that we can run which is

744
00:22:54,240 --> 00:22:56,720
great but what about the business right

745
00:22:56,720 --> 00:22:57,280
so

746
00:22:57,280 --> 00:22:58,799
what we can do is we can create really

747
00:22:58,799 --> 00:23:00,559
good visual graphics as well

748
00:23:00,559 --> 00:23:03,200
so here i have something called canvas

749
00:23:03,200 --> 00:23:04,559
and you can see i've already included

750
00:23:04,559 --> 00:23:06,080
sort of the raw data coming from

751
00:23:06,080 --> 00:23:07,280
operator

752
00:23:07,280 --> 00:23:09,840
but if i wanted to i can include a chart

753
00:23:09,840 --> 00:23:10,559
here

754
00:23:10,559 --> 00:23:12,960
or like a performance metric so we have

755
00:23:12,960 --> 00:23:13,919
here

756
00:23:13,919 --> 00:23:16,880
um a really easy way of building those

757
00:23:16,880 --> 00:23:18,400
in elastic code lens

758
00:23:18,400 --> 00:23:20,240
so if i wanted to do some sort of drag

759
00:23:20,240 --> 00:23:22,240
and drop visualizations

760
00:23:22,240 --> 00:23:23,840
and i can do that and add them to that

761
00:23:23,840 --> 00:23:25,360
canvas workpad i think i have a

762
00:23:25,360 --> 00:23:26,880
pre-prepared one here so i'll just load

763
00:23:26,880 --> 00:23:28,400
up onto the screen

764
00:23:28,400 --> 00:23:31,360
there we go so you can see here i have

765
00:23:31,360 --> 00:23:32,720
for example i'm

766
00:23:32,720 --> 00:23:34,240
doing that same query as before so i'm

767
00:23:34,240 --> 00:23:35,200
looking for things coming out of

768
00:23:35,200 --> 00:23:36,080
operator

769
00:23:36,080 --> 00:23:37,679
and i'm doing a correlation but this

770
00:23:37,679 --> 00:23:39,120
time in the form of a chart

771
00:23:39,120 --> 00:23:43,360
so i'm doing sort of the the top um

772
00:23:43,360 --> 00:23:44,880
what are the hosts that we're running

773
00:23:44,880 --> 00:23:47,039
the emulation on

774
00:23:47,039 --> 00:23:48,320
and we're listing we can see we have

775
00:23:48,320 --> 00:23:49,919
that one host in green here james honey

776
00:23:49,919 --> 00:23:50,720
put an

777
00:23:50,720 --> 00:23:53,120
endpoint windows demo uh we have the

778
00:23:53,120 --> 00:23:54,480
processes which are being run

779
00:23:54,480 --> 00:23:56,320
as a result of the emulation plan so you

780
00:23:56,320 --> 00:23:58,000
can see certitude rayok which is

781
00:23:58,000 --> 00:23:59,039
ransomware we have

782
00:23:59,039 --> 00:24:02,400
msi exec come on from go ransomwindows

783
00:24:02,400 --> 00:24:04,559
then we have the detections so you can

784
00:24:04,559 --> 00:24:06,480
see top value of signal rule name so so

785
00:24:06,480 --> 00:24:08,559
far we've noticed that we had

786
00:24:08,559 --> 00:24:10,159
two detections and all the emulations

787
00:24:10,159 --> 00:24:12,159
we've ran today which is not good we

788
00:24:12,159 --> 00:24:13,440
should probably figure out our coverage

789
00:24:13,440 --> 00:24:14,640
but you can see this provides me the

790
00:24:14,640 --> 00:24:16,000
percentages

791
00:24:16,000 --> 00:24:17,360
of everything and then i can just grab

792
00:24:17,360 --> 00:24:20,000
this and add it to our

793
00:24:20,000 --> 00:24:22,320
canvas work pad and then have this being

794
00:24:22,320 --> 00:24:24,080
presented live to whoever needs it so

795
00:24:24,080 --> 00:24:26,480
this is all live data right

796
00:24:26,480 --> 00:24:27,760
so i think that's all i have time for

797
00:24:27,760 --> 00:24:29,840
today i'm just going to go back to my

798
00:24:29,840 --> 00:24:33,120
very last slide here and hopefully you

799
00:24:33,120 --> 00:24:34,799
enjoyed that and hopefully you enjoyed

800
00:24:34,799 --> 00:24:36,080
the whole besides event and what stuff

801
00:24:36,080 --> 00:24:38,080
to come and if you have any questions

802
00:24:38,080 --> 00:24:39,360
please feel free to reach out to us on

803
00:24:39,360 --> 00:24:40,320
our community slack

804
00:24:40,320 --> 00:24:43,520
or discuss forums and

805
00:24:43,520 --> 00:24:45,360
have a great day and stay safe thank you

806
00:24:45,360 --> 00:24:47,840
all very much

