1
00:00:04,930 --> 00:00:06,850
hi everyone

2
00:00:06,850 --> 00:00:11,570
so let's get physical' first of all this

3
00:00:11,570 --> 00:00:15,080
is not an original title and there have

4
00:00:15,080 --> 00:00:17,029
been some talk to this out of before but

5
00:00:17,029 --> 00:00:19,369
it was too good not to not to use it

6
00:00:19,369 --> 00:00:21,529
it felt too good for for this

7
00:00:21,529 --> 00:00:25,760
presentation so I'll start by

8
00:00:25,760 --> 00:00:28,689
introducing is my name is Lucia 13 I

9
00:00:28,689 --> 00:00:33,800
work at adamant sec this year is Pedro

10
00:00:33,800 --> 00:00:36,230
Rodriguez he is a security engineer at

11
00:00:36,230 --> 00:00:39,110
fire fetch and together we comprise a

12
00:00:39,110 --> 00:00:43,840
team of very curious individuals that

13
00:00:43,840 --> 00:00:47,570
have met and some some very fun projects

14
00:00:47,570 --> 00:00:49,940
in the past some of them we can talk

15
00:00:49,940 --> 00:00:53,930
about some of them we can but since this

16
00:00:53,930 --> 00:00:59,360
talk was was heaven so so big and so big

17
00:00:59,360 --> 00:01:04,989
we brought projects so broad so proud

18
00:01:04,989 --> 00:01:10,130
sorry it was a very broad research and

19
00:01:10,130 --> 00:01:12,380
we wanted to share it with the community

20
00:01:12,380 --> 00:01:16,400
and hopefully we can get you guys as

21
00:01:16,400 --> 00:01:18,650
curious as we were about about these

22
00:01:18,650 --> 00:01:21,110
devices and hopefully starting also to

23
00:01:21,110 --> 00:01:24,680
do some research reading standard

24
00:01:24,680 --> 00:01:27,530
disclaimer yeah we have to put it here

25
00:01:27,530 --> 00:01:32,080
and now I'll pass the word to Pedro

26
00:01:32,080 --> 00:01:34,159
hello everyone

27
00:01:34,159 --> 00:01:39,050
before we start let me just went through

28
00:01:39,050 --> 00:01:41,300
the basics of authentication basically

29
00:01:41,300 --> 00:01:44,390
you could authenticate yourselves with

30
00:01:44,390 --> 00:01:47,830
the device any kind of authentication

31
00:01:47,830 --> 00:01:54,710
through three ways the citizen

32
00:01:54,710 --> 00:01:57,620
something you know that's like a

33
00:01:57,620 --> 00:02:00,290
password or a pin or something like that

34
00:02:00,290 --> 00:02:03,789
something that you have a keycard

35
00:02:03,789 --> 00:02:08,580
of cellphone or something on that matter

36
00:02:08,580 --> 00:02:12,129
something you are that something that

37
00:02:12,129 --> 00:02:14,050
you cannot change like your fingerprint

38
00:02:14,050 --> 00:02:18,310
your iris your eyes your face something

39
00:02:18,310 --> 00:02:22,050
that you are born with obviously

40
00:02:22,050 --> 00:02:25,720
passwords are easy to change key cards

41
00:02:25,720 --> 00:02:29,470
sometimes it has a cost but fairly easy

42
00:02:29,470 --> 00:02:33,269
and it's cents on the key card

43
00:02:33,269 --> 00:02:36,430
fingerprints and eyeballs and something

44
00:02:36,430 --> 00:02:39,370
like that it's easy if you do a

45
00:02:39,370 --> 00:02:42,250
transplant the transplant itself could

46
00:02:42,250 --> 00:02:44,530
not be maybe it's not that easy

47
00:02:44,530 --> 00:02:49,989
but it's easy on that note biometric

48
00:02:49,989 --> 00:02:53,110
devices everyone is starting to deploy

49
00:02:53,110 --> 00:02:57,190
that meant to deploy them it's great for

50
00:02:57,190 --> 00:03:00,690
time attendance because when you need to

51
00:03:00,690 --> 00:03:04,269
place your finger on the device you need

52
00:03:04,269 --> 00:03:06,720
to have that finger you cannot borrow

53
00:03:06,720 --> 00:03:11,350
someone's finger to to bypass it that's

54
00:03:11,350 --> 00:03:13,450
great because your boss now knows that

55
00:03:13,450 --> 00:03:16,959
effectively you went to the office at

56
00:03:16,959 --> 00:03:21,420
that time and obviously you can't forget

57
00:03:21,420 --> 00:03:26,139
your finger at home I usually lost my

58
00:03:26,139 --> 00:03:29,130
cards and people who know me know that I

59
00:03:29,130 --> 00:03:33,819
may not misplace everything it's easy

60
00:03:33,819 --> 00:03:38,180
it's getting cheaper by the day

61
00:03:38,180 --> 00:03:44,569
and nobody's really loved them so in the

62
00:03:44,569 --> 00:03:47,680
recent months more specifically about

63
00:03:47,680 --> 00:03:51,500
one month one month and a half ago if

64
00:03:51,500 --> 00:03:54,920
you go to exploit a beer you see to

65
00:03:54,920 --> 00:03:57,440
exploit for prime access control and

66
00:03:57,440 --> 00:03:59,900
face entry they are basically time

67
00:03:59,900 --> 00:04:03,129
attendances and access control devices

68
00:04:03,129 --> 00:04:07,549
they both have RC vulnerabilities in

69
00:04:07,549 --> 00:04:10,989
them and you can also see a BBC news

70
00:04:10,989 --> 00:04:13,700
story about the bio star leaks it

71
00:04:13,700 --> 00:04:18,108
basically was given an elastic such

72
00:04:18,108 --> 00:04:23,120
exposed to the web and that was leaked

73
00:04:23,120 --> 00:04:26,650
through that I don't know why they have

74
00:04:26,650 --> 00:04:30,229
data bytes or fingerprints and time

75
00:04:30,229 --> 00:04:32,780
antennas but you know leaks happened

76
00:04:32,780 --> 00:04:36,500
let's spoil them okay so it's kind of

77
00:04:36,500 --> 00:04:40,340
pull these devices use Department deploy

78
00:04:40,340 --> 00:04:44,060
them you make them work

79
00:04:44,060 --> 00:04:46,760
oh yeah I see I cannot bypass this

80
00:04:46,760 --> 00:04:50,210
authentication or this control because

81
00:04:50,210 --> 00:04:52,370
you need to have physical existence

82
00:04:52,370 --> 00:04:56,960
before the device so it was cool to find

83
00:04:56,960 --> 00:05:00,050
something on other devices that we could

84
00:05:00,050 --> 00:05:03,340
have exploit more or less like the

85
00:05:03,340 --> 00:05:06,169
watchdog's game the watchdogs tube from

86
00:05:06,169 --> 00:05:09,199
Ubisoft where Marcus the main character

87
00:05:09,199 --> 00:05:11,840
went through the city with the cellphone

88
00:05:11,840 --> 00:05:14,000
opening doors and study and bypassing

89
00:05:14,000 --> 00:05:17,150
all these controls so you know let's try

90
00:05:17,150 --> 00:05:22,070
to do something like that okay how do

91
00:05:22,070 --> 00:05:24,070
you start

92
00:05:24,070 --> 00:05:28,430
Katarina call me hey look when you

93
00:05:28,430 --> 00:05:34,820
device here what we start looking cool

94
00:05:34,820 --> 00:05:36,770
this is really

95
00:05:36,770 --> 00:05:40,819
a standalone device that you can place

96
00:05:40,819 --> 00:05:44,990
and it has a weird protocol and stuff

97
00:05:44,990 --> 00:05:49,009
you let's let's let's [ __ ] this up so we

98
00:05:49,009 --> 00:05:55,009
start looking out this devices word they

99
00:05:55,009 --> 00:05:58,840
later and before we know it

100
00:05:58,840 --> 00:06:09,830
this happened just an enter and now the

101
00:06:09,830 --> 00:06:15,319
Lord is open notification easy just went

102
00:06:15,319 --> 00:06:18,409
through so how did we manage to do this

103
00:06:18,409 --> 00:06:21,470
we look at Wireshark because it was a

104
00:06:21,470 --> 00:06:27,710
janky protocol and we took the payload

105
00:06:27,710 --> 00:06:29,720
and replay it and it's opened the door

106
00:06:29,720 --> 00:06:31,940
it was easy

107
00:06:31,940 --> 00:06:34,729
there is no announcer or something like

108
00:06:34,729 --> 00:06:38,180
that and probably not an SSL or TLS

109
00:06:38,180 --> 00:06:45,020
encryption connection so we configure

110
00:06:45,020 --> 00:06:47,449
the part mirroring or spanning part if

111
00:06:47,449 --> 00:06:51,909
you want and restart to listen every

112
00:06:51,909 --> 00:06:55,880
payload that was sent to the device the

113
00:06:55,880 --> 00:06:59,150
architrave was the following there is a

114
00:06:59,150 --> 00:07:01,969
management software where you control

115
00:07:01,969 --> 00:07:04,820
the devices your all devices from your

116
00:07:04,820 --> 00:07:09,460
office you can ask them to open it or

117
00:07:09,460 --> 00:07:12,770
upload a new fingerprint or access code

118
00:07:12,770 --> 00:07:15,830
and you can manage all through that you

119
00:07:15,830 --> 00:07:18,530
actually most of your implementations

120
00:07:18,530 --> 00:07:23,060
need that when we started to make small

121
00:07:23,060 --> 00:07:25,639
requests get me the device information

122
00:07:25,639 --> 00:07:30,219
open the door get the the current locks

123
00:07:30,219 --> 00:07:36,139
starting from scratch in Wireshark the

124
00:07:36,139 --> 00:07:38,960
payloads the payloads were actually very

125
00:07:38,960 --> 00:07:41,719
simple you can see here

126
00:07:41,719 --> 00:07:44,929
it starts with a five and as a small

127
00:07:44,929 --> 00:07:48,759
number of whites it is wrongly recalled

128
00:07:48,759 --> 00:07:53,989
it stated that I I psi CTL its hello

129
00:07:53,989 --> 00:07:56,659
well something like that

130
00:07:56,659 --> 00:08:00,789
protocol don't know don't care really

131
00:08:00,789 --> 00:08:04,369
but since it was small man we could take

132
00:08:04,369 --> 00:08:06,589
the challenge we are not experts in

133
00:08:06,589 --> 00:08:08,989
reversing but you know something like

134
00:08:08,989 --> 00:08:11,360
this I don't see any passwords or

135
00:08:11,360 --> 00:08:13,339
something that resembled it because we

136
00:08:13,339 --> 00:08:15,709
set a password and it's not being sent

137
00:08:15,709 --> 00:08:21,139
here so let's dig deeper since we have

138
00:08:21,139 --> 00:08:24,499
control of the network we start making

139
00:08:24,499 --> 00:08:27,289
those small requests open the door by

140
00:08:27,289 --> 00:08:32,469
force negative I states whatever that is

141
00:08:32,469 --> 00:08:35,360
device type record information something

142
00:08:35,360 --> 00:08:38,208
small to understand how the protocol

143
00:08:38,208 --> 00:08:42,649
work as you can see here they all start

144
00:08:42,649 --> 00:08:46,750
the same with a fight bite then it has a

145
00:08:46,750 --> 00:08:50,990
small number for instance get record

146
00:08:50,990 --> 00:08:56,540
info if you have four bytes with

147
00:08:56,540 --> 00:09:00,800
numerical one below on the open door

148
00:09:00,800 --> 00:09:04,819
force you have all zeros and we didn't

149
00:09:04,819 --> 00:09:09,860
understand how this was what is going to

150
00:09:09,860 --> 00:09:12,500
affect our research but we start

151
00:09:12,500 --> 00:09:14,990
changing all these parameters to see how

152
00:09:14,990 --> 00:09:19,639
the device respond so we can come up

153
00:09:19,639 --> 00:09:23,540
with this we know that there is a

154
00:09:23,540 --> 00:09:28,209
preamble and no data but it's very small

155
00:09:28,209 --> 00:09:32,300
one - it's like a sequence number not a

156
00:09:32,300 --> 00:09:34,519
huge number but yet it has four bytes

157
00:09:34,519 --> 00:09:39,030
the interesting thing was some devices

158
00:09:39,030 --> 00:09:41,560
respondent when we did a replay attack

159
00:09:41,560 --> 00:09:44,350
when it sweet when we change the number

160
00:09:44,350 --> 00:09:48,580
it stopped responding but if we nope I

161
00:09:48,580 --> 00:09:51,250
thought the sequence every devices start

162
00:09:51,250 --> 00:09:54,730
to respond so we just set all zeros on

163
00:09:54,730 --> 00:09:57,430
pillows and went with it because we did

164
00:09:57,430 --> 00:10:00,460
not know what this thing was there is a

165
00:10:00,460 --> 00:10:03,790
one byte for any instruction opened our

166
00:10:03,790 --> 00:10:07,390
or get devices records or something like

167
00:10:07,390 --> 00:10:11,500
that it's basically the command there

168
00:10:11,500 --> 00:10:16,030
was what we assumed length two bytes for

169
00:10:16,030 --> 00:10:18,610
the length because it was the remaining

170
00:10:18,610 --> 00:10:25,120
of the data - - so we map we thought

171
00:10:25,120 --> 00:10:28,180
maybe this is length but they are two

172
00:10:28,180 --> 00:10:31,390
bytes that aren't linked so we marked as

173
00:10:31,390 --> 00:10:34,330
unknown data and we start the process of

174
00:10:34,330 --> 00:10:39,150
fingering what that two bytes were

175
00:10:39,150 --> 00:10:43,540
luckily and this provides an SDK this

176
00:10:43,540 --> 00:10:47,130
SDK is for you to deploy your own

177
00:10:47,130 --> 00:10:51,510
implementations for instance and it's

178
00:10:51,510 --> 00:10:54,340
product from telly max here in Portugal

179
00:10:54,340 --> 00:10:57,970
that uses SDK to implement their own

180
00:10:57,970 --> 00:11:01,440
software and control all these devices

181
00:11:01,440 --> 00:11:04,540
since we have an SDK and we didn't know

182
00:11:04,540 --> 00:11:07,930
how these packets were being made we

183
00:11:07,930 --> 00:11:10,750
start either and start to to look for

184
00:11:10,750 --> 00:11:18,520
this this belt this is the SDK it has

185
00:11:18,520 --> 00:11:22,720
four files one talk acts that I didn't

186
00:11:22,720 --> 00:11:25,960
understand I'm not going to say the next

187
00:11:25,960 --> 00:11:31,840
four and three files a DLL header file

188
00:11:31,840 --> 00:11:36,250
and a dot exe file it's a testing

189
00:11:36,250 --> 00:11:38,560
program that you can interact with every

190
00:11:38,560 --> 00:11:41,770
device and get all records from from

191
00:11:41,770 --> 00:11:42,670
that

192
00:11:42,670 --> 00:11:45,850
basically they just say okay this is

193
00:11:45,850 --> 00:11:48,820
vulnerable but just use it so you don't

194
00:11:48,820 --> 00:11:50,740
need to provide any password to interact

195
00:11:50,740 --> 00:11:56,140
with which device or the test problem we

196
00:11:56,140 --> 00:12:01,510
started reversing but there wasn't any

197
00:12:01,510 --> 00:12:03,130
export functions that resemble a

198
00:12:03,130 --> 00:12:08,890
checksum or CRC we know it's a CRC 16

199
00:12:08,890 --> 00:12:12,010
now because to bite but we didn't find

200
00:12:12,010 --> 00:12:14,260
any export process so maybe it's a

201
00:12:14,260 --> 00:12:16,240
function that is being : not exported

202
00:12:16,240 --> 00:12:19,860
but going through the flow of all the

203
00:12:19,860 --> 00:12:22,630
communications and so it's kind of

204
00:12:22,630 --> 00:12:25,779
tedious so we we are lazy and we just

205
00:12:25,779 --> 00:12:27,880
look for the function that has most

206
00:12:27,880 --> 00:12:31,570
cross references to it and guess what we

207
00:12:31,570 --> 00:12:37,390
actually find it this is the the this is

208
00:12:37,390 --> 00:12:39,040
assembly the start of the function and

209
00:12:39,040 --> 00:12:43,329
we looked at the bottom and we saw an

210
00:12:43,329 --> 00:12:49,510
array CRC has polynomials that I used to

211
00:12:49,510 --> 00:12:54,220
make that array it's a standard CRC for

212
00:12:54,220 --> 00:12:57,100
our point of view but we started to

213
00:12:57,100 --> 00:13:02,339
looking we didn't understand these bytes

214
00:13:02,339 --> 00:13:06,160
it's same it seemed different that's

215
00:13:06,160 --> 00:13:09,640
what we used to use so we just start

216
00:13:09,640 --> 00:13:11,860
reversing and I'm mapping a lots to to

217
00:13:11,860 --> 00:13:14,440
our implementation of the protocol later

218
00:13:14,440 --> 00:13:17,260
no noon right my friend that's a far

219
00:13:17,260 --> 00:13:19,540
fetch told me yeah you are looking at at

220
00:13:19,540 --> 00:13:23,350
wrong CRC 16 they are multiple standards

221
00:13:23,350 --> 00:13:25,589
you are looking at the wrong standard I

222
00:13:25,589 --> 00:13:30,750
just waited 8 hours of my life thank you

223
00:13:31,350 --> 00:13:35,050
now since we have two CRC we have all

224
00:13:35,050 --> 00:13:38,860
the requirements to make a payload so we

225
00:13:38,860 --> 00:13:41,829
just make drip I repeat the same spell

226
00:13:41,829 --> 00:13:43,660
outs and start to look for the responses

227
00:13:43,660 --> 00:13:46,390
the responses were quite easy to parse

228
00:13:46,390 --> 00:13:48,160
because it follows almost the same

229
00:13:48,160 --> 00:13:50,680
structure of the protocol and it was

230
00:13:50,680 --> 00:13:52,480
easy since we have access to the device

231
00:13:52,480 --> 00:13:54,290
to map out what

232
00:13:54,290 --> 00:13:58,310
what the bytes that the name is going to

233
00:13:58,310 --> 00:14:03,410
be the password the card ID RFID and

234
00:14:03,410 --> 00:14:05,899
even fingerprints the fingerprints it's

235
00:14:05,899 --> 00:14:11,300
not a no a BMP or PNG file it's actually

236
00:14:11,300 --> 00:14:13,550
a Aiden vowel matrix

237
00:14:13,550 --> 00:14:17,079
so let's fortune that but you can

238
00:14:17,079 --> 00:14:19,880
extract passwords and even you can set

239
00:14:19,880 --> 00:14:22,670
your own password without knowing to the

240
00:14:22,670 --> 00:14:25,399
previous password so the protocol is so

241
00:14:25,399 --> 00:14:27,529
open that you just send an instruction

242
00:14:27,529 --> 00:14:31,550
and it accepts it no matter what you are

243
00:14:31,550 --> 00:14:32,149
the boss

244
00:14:32,149 --> 00:14:45,019
if you have access to part 50 10 DCPS I

245
00:14:45,019 --> 00:14:47,300
see the SDK add some security in some

246
00:14:47,300 --> 00:14:52,399
fields when we call the DLL is we saw

247
00:14:52,399 --> 00:14:58,730
some sanity checks that are going to

248
00:14:58,730 --> 00:15:02,000
truncate our pilots and something more

249
00:15:02,000 --> 00:15:05,779
or less like that so we just okay we can

250
00:15:05,779 --> 00:15:08,449
implement probably not the protocol so

251
00:15:08,449 --> 00:15:11,990
we may make our own implementation of

252
00:15:11,990 --> 00:15:13,790
the protocol so you can face it without

253
00:15:13,790 --> 00:15:16,790
any constraints we aim to look for

254
00:15:16,790 --> 00:15:18,680
vulnerabilities in the device and in the

255
00:15:18,680 --> 00:15:23,839
management manager not on the SDK so not

256
00:15:23,839 --> 00:15:30,260
start building and basically at this

257
00:15:30,260 --> 00:15:32,240
point here we have the structure where

258
00:15:32,240 --> 00:15:34,480
were able to communicate with the device

259
00:15:34,480 --> 00:15:37,399
devices themselves and retrieve

260
00:15:37,399 --> 00:15:39,860
information change information we had

261
00:15:39,860 --> 00:15:41,959
control of the devices without any any

262
00:15:41,959 --> 00:15:44,389
authentication what we didn't have was

263
00:15:44,389 --> 00:15:47,750
access to the server for the other way

264
00:15:47,750 --> 00:15:50,449
that part would be very interesting and

265
00:15:50,449 --> 00:15:54,230
if if the devices are designed like this

266
00:15:54,230 --> 00:15:57,069
and implemented like this it'll probably

267
00:15:57,069 --> 00:15:59,120
it won't be that hard

268
00:15:59,120 --> 00:16:01,070
probably so

269
00:16:01,070 --> 00:16:05,630
damn we wanted to see if we could find

270
00:16:05,630 --> 00:16:08,889
some some problems with the manager and

271
00:16:08,889 --> 00:16:10,100
yeah

272
00:16:10,100 --> 00:16:13,639
and after some I don't know I think it

273
00:16:13,639 --> 00:16:15,860
was the first fuzzing test we were

274
00:16:15,860 --> 00:16:17,060
trying to communicate through the

275
00:16:17,060 --> 00:16:19,430
devices at the same time so probably

276
00:16:19,430 --> 00:16:22,639
some payload some random pill because

277
00:16:22,639 --> 00:16:26,449
this access violation so okay we have a

278
00:16:26,449 --> 00:16:29,720
buffer overflow but yeah we're talking

279
00:16:29,720 --> 00:16:32,870
about some software that has a lot of

280
00:16:32,870 --> 00:16:35,149
years in the market and the vendor is

281
00:16:35,149 --> 00:16:37,940
yeah well-known so it will probably have

282
00:16:37,940 --> 00:16:42,380
a SLR canneries it will have some

283
00:16:42,380 --> 00:16:46,610
protection right yeah at this point we

284
00:16:46,610 --> 00:16:49,339
saw that it didn't have any any type of

285
00:16:49,339 --> 00:16:52,310
protection yeah and we were talking

286
00:16:52,310 --> 00:16:55,220
about a 32-bit executable some file so

287
00:16:55,220 --> 00:16:57,860
it was easier for us and this simply

288
00:16:57,860 --> 00:17:02,180
admit that if it were in in 64 it takes

289
00:17:02,180 --> 00:17:03,949
a take us some some more time but

290
00:17:03,949 --> 00:17:06,949
fortunately they didn't they gave us a

291
00:17:06,949 --> 00:17:11,000
hand and yeah and basically okay now so

292
00:17:11,000 --> 00:17:13,549
we have we know that there is a buffer

293
00:17:13,549 --> 00:17:18,589
overflow we can replicate it and at this

294
00:17:18,589 --> 00:17:21,530
point will not bother with the details

295
00:17:21,530 --> 00:17:24,260
but basically yeah we we basically

296
00:17:24,260 --> 00:17:29,210
rewrite the EP and register on the under

297
00:17:29,210 --> 00:17:31,250
on the CPU when you can exploit the

298
00:17:31,250 --> 00:17:34,090
buffer overflow we found the jump ESP

299
00:17:34,090 --> 00:17:37,460
function in the in the executive L file

300
00:17:37,460 --> 00:17:39,169
so we were able to jump to the point of

301
00:17:39,169 --> 00:17:41,840
the stack and we were able to place some

302
00:17:41,840 --> 00:17:45,530
malicious payload and hopefully to go as

303
00:17:45,530 --> 00:17:47,990
we wanted and gives us some

304
00:17:47,990 --> 00:17:52,220
I'll put it would be good for us so so

305
00:17:52,220 --> 00:17:57,559
basically we have our our solution in

306
00:17:57,559 --> 00:18:01,840
there some someone runs the the

307
00:18:01,840 --> 00:18:03,799
cross-checks application that is the

308
00:18:03,799 --> 00:18:06,860
manager of the devices they search for

309
00:18:06,860 --> 00:18:11,690
new devices and below we can see that

310
00:18:11,690 --> 00:18:14,299
yeah we have remote code execution we

311
00:18:14,299 --> 00:18:16,970
can get access to the to the men to the

312
00:18:16,970 --> 00:18:19,669
server that is hosting the manager okay

313
00:18:19,669 --> 00:18:24,490
so we have control in two directions

314
00:18:24,490 --> 00:18:27,110
we're good to go right we're gonna stop

315
00:18:27,110 --> 00:18:33,070
here I didn't want to so we kept going

316
00:18:33,070 --> 00:18:36,529
one Martin notes these application needs

317
00:18:36,529 --> 00:18:39,529
to be run at highest privilege on the

318
00:18:39,529 --> 00:18:42,309
system because it uses raw sockets and

319
00:18:42,309 --> 00:18:46,909
some more obscure stuff so when you are

320
00:18:46,909 --> 00:18:50,110
executing you need elevated privileges

321
00:18:50,110 --> 00:18:55,070
and as we were testing we left Wireshark

322
00:18:55,070 --> 00:18:56,749
open because we wanted to see everything

323
00:18:56,749 --> 00:19:00,799
on the network and we actually come

324
00:19:00,799 --> 00:19:04,639
across this and no plain old HTTP

325
00:19:04,639 --> 00:19:08,720
connection you know it's not unusual to

326
00:19:08,720 --> 00:19:11,929
see this but it's here it came to our

327
00:19:11,929 --> 00:19:14,149
attention that it was trying to get an

328
00:19:14,149 --> 00:19:18,590
upgrade so it could be nothing because

329
00:19:18,590 --> 00:19:21,619
it could have a PGP check later on like

330
00:19:21,619 --> 00:19:25,309
apt or something like that so okay maybe

331
00:19:25,309 --> 00:19:27,379
you should look at it but don't get our

332
00:19:27,379 --> 00:19:30,230
hopes up too much when you try to

333
00:19:30,230 --> 00:19:35,499
upgrade if there is no available a plate

334
00:19:35,499 --> 00:19:39,049
you'll see an on your version like on

335
00:19:39,049 --> 00:19:42,590
the screen but since you are controlling

336
00:19:42,590 --> 00:19:46,970
the network we redirect the traffic to

337
00:19:46,970 --> 00:19:49,929
us about simple

338
00:19:49,929 --> 00:19:52,840
peyten HTTP server and we start to

339
00:19:52,840 --> 00:19:55,899
tamper with the requests we actually

340
00:19:55,899 --> 00:19:58,210
show that change the message to nothing

341
00:19:58,210 --> 00:20:02,100
to show we just received the request

342
00:20:02,100 --> 00:20:06,100
from the the version that he was

343
00:20:06,100 --> 00:20:09,490
advertising and we increment by one and

344
00:20:09,490 --> 00:20:11,499
we say okay it's and there is nothing to

345
00:20:11,499 --> 00:20:16,090
show but here is the manifest of all new

346
00:20:16,090 --> 00:20:18,369
files and updates since you are running

347
00:20:18,369 --> 00:20:21,700
as with hires privileges we can upload

348
00:20:21,700 --> 00:20:27,039
just a simple backdoor everything will

349
00:20:27,039 --> 00:20:29,440
run with ice villages on the device you

350
00:20:29,440 --> 00:20:31,779
just need to send a file with the same

351
00:20:31,779 --> 00:20:35,889
name as you right on manifest of the

352
00:20:35,889 --> 00:20:38,889
upgrade and you get a shell but if you

353
00:20:38,889 --> 00:20:40,899
if you can poison the DNS or redirect

354
00:20:40,899 --> 00:20:45,159
traffic you can also try to overtake the

355
00:20:45,159 --> 00:20:50,889
server with this vector here okay this

356
00:20:50,889 --> 00:20:53,889
is pretty much broken of course and we

357
00:20:53,889 --> 00:20:57,220
didn't know why someone will deploy this

358
00:20:57,220 --> 00:21:04,960
to the network but we kept going we

359
00:21:04,960 --> 00:21:10,509
start to talk each other and all the

360
00:21:10,509 --> 00:21:12,460
public resources and we actually found

361
00:21:12,460 --> 00:21:16,210
something interesting the vendor and

362
00:21:16,210 --> 00:21:19,659
this actually recommends that these

363
00:21:19,659 --> 00:21:23,110
devices are exposed to the Internet so

364
00:21:23,110 --> 00:21:26,080
you can allow inter-site communication

365
00:21:26,080 --> 00:21:30,850
why anyone will do this without VPN or

366
00:21:30,850 --> 00:21:32,679
something like that I don't know I

367
00:21:32,679 --> 00:21:35,799
really do not know but ok if they

368
00:21:35,799 --> 00:21:38,830
recommend this probably someone on the

369
00:21:38,830 --> 00:21:43,960
internet will expose this right so we so

370
00:21:43,960 --> 00:21:46,029
basically that's our open source

371
00:21:46,029 --> 00:21:49,090
intelligence gathering you can see it

372
00:21:49,090 --> 00:21:52,080
yeah from ranging from 1 to 2

373
00:21:52,080 --> 00:21:58,090
163 IPS we got a total of 1,000 78

374
00:21:58,090 --> 00:22:02,710
unique devices and we stopped basically

375
00:22:02,710 --> 00:22:05,019
later on we'll talk about the disclosure

376
00:22:05,019 --> 00:22:08,559
we were asked how was what was the

377
00:22:08,559 --> 00:22:11,950
exposure of this visible materiality and

378
00:22:11,950 --> 00:22:16,239
we wanted to be able to reply so we we

379
00:22:16,239 --> 00:22:18,519
thought yeah we have more than 1,000

380
00:22:18,519 --> 00:22:21,309
unique devices so we're good to go

381
00:22:21,309 --> 00:22:27,729
and we sent a tests payload for to show

382
00:22:27,729 --> 00:22:30,450
them with so that they would be able to

383
00:22:30,450 --> 00:22:33,309
confirm that the devices are there it's

384
00:22:33,309 --> 00:22:35,049
now on the the better version and

385
00:22:35,049 --> 00:22:37,509
hopefully it will be on unsure and soon

386
00:22:37,509 --> 00:22:40,149
you will be able to search for the ports

387
00:22:40,149 --> 00:22:43,840
in six zero one zero four tin find

388
00:22:43,840 --> 00:22:49,659
devices so yeah but until now we would

389
00:22:49,659 --> 00:22:52,659
be thinking yeah they're probably small

390
00:22:52,659 --> 00:22:54,669
clients right and all small companies

391
00:22:54,669 --> 00:22:57,609
are implementing this and we went to

392
00:22:57,609 --> 00:23:01,679
their website to see if they would would

393
00:23:01,679 --> 00:23:04,720
share some of their and some some of the

394
00:23:04,720 --> 00:23:06,609
the clients that that are using this

395
00:23:06,609 --> 00:23:12,539
solution so you can see on the bottom we

396
00:23:12,539 --> 00:23:16,570
did some sim warnings before this talk

397
00:23:16,570 --> 00:23:19,090
we coordinated a responsible researcher

398
00:23:19,090 --> 00:23:22,859
of course hopefully most of them are now

399
00:23:22,859 --> 00:23:25,960
not implementing this solution but yeah

400
00:23:25,960 --> 00:23:29,649
basically this is the the point where

401
00:23:29,649 --> 00:23:37,299
yeah so memory where the that was a time

402
00:23:37,299 --> 00:23:41,379
that people exposed printers to be able

403
00:23:41,379 --> 00:23:43,590
to print anywhere in the world

404
00:23:43,590 --> 00:23:46,330
what if you can

405
00:23:46,330 --> 00:23:49,130
upgrade the software version to a vector

406
00:23:49,130 --> 00:23:53,120
or a filmer that will perform malicious

407
00:23:53,120 --> 00:23:55,220
actions on your network you basically

408
00:23:55,220 --> 00:23:58,159
start to getting into the the network

409
00:23:58,159 --> 00:24:02,929
itself of all these clients and since

410
00:24:02,929 --> 00:24:07,330
this is an application that has PII

411
00:24:07,330 --> 00:24:10,039
personal are infinitely added file

412
00:24:10,039 --> 00:24:14,510
information it that could be a leak a

413
00:24:14,510 --> 00:24:18,049
major leak here and this is not a small

414
00:24:18,049 --> 00:24:21,169
vendor as you can see this is actually

415
00:24:21,169 --> 00:24:24,110
very dangerous for people to deploy on

416
00:24:24,110 --> 00:24:27,919
their networks and you know you are

417
00:24:27,919 --> 00:24:30,530
liable for what you start on your

418
00:24:30,530 --> 00:24:36,740
devices to back me up on this yes there

419
00:24:36,740 --> 00:24:39,350
is an appropriate function that you can

420
00:24:39,350 --> 00:24:42,230
call and you can upload an evil firmware

421
00:24:42,230 --> 00:24:44,990
and basically you have control you can

422
00:24:44,990 --> 00:24:49,190
put make an applause to have a socks

423
00:24:49,190 --> 00:24:51,350
proxy an extension of the current

424
00:24:51,350 --> 00:24:54,140
protocol to proxy your request inside

425
00:24:54,140 --> 00:24:59,000
network or you can make a farmer that

426
00:24:59,000 --> 00:25:02,120
will pound the manager itself and you

427
00:25:02,120 --> 00:25:03,799
get a reverse shell with highest

428
00:25:03,799 --> 00:25:08,500
privileges mode on your attack machine

429
00:25:08,500 --> 00:25:12,500
these are some useful exported fractions

430
00:25:12,500 --> 00:25:16,429
that you can call with DLL you can force

431
00:25:16,429 --> 00:25:20,480
unlock this call will not log anything

432
00:25:20,480 --> 00:25:25,820
on log file so it will never happen at

433
00:25:25,820 --> 00:25:30,200
the eyes of the CM you can download all

434
00:25:30,200 --> 00:25:32,030
records all attendance records you can

435
00:25:32,030 --> 00:25:35,300
erase all records of course you get

436
00:25:35,300 --> 00:25:38,090
you can get Network information

437
00:25:38,090 --> 00:25:40,760
installed personal you can live message

438
00:25:40,760 --> 00:25:45,020
to someone when they place the fingers

439
00:25:45,020 --> 00:25:47,630
you can pop a message saying you have

440
00:25:47,630 --> 00:25:50,960
just been pumped or you can get admitted

441
00:25:50,960 --> 00:25:53,090
credentials because there is no

442
00:25:53,090 --> 00:25:56,540
verification of any kind there is no

443
00:25:56,540 --> 00:26:01,040
security whatsoever okay so we were

444
00:26:01,040 --> 00:26:04,550
trying to release the tool today I'm not

445
00:26:04,550 --> 00:26:06,440
sure we'll be able to but yeah we've

446
00:26:06,440 --> 00:26:09,320
been working on it until five minutes

447
00:26:09,320 --> 00:26:12,770
before we entered in this room we're

448
00:26:12,770 --> 00:26:15,679
also releasing this tool as the

449
00:26:15,679 --> 00:26:18,290
implementation of the protocol is able

450
00:26:18,290 --> 00:26:20,390
to communicate with the devices

451
00:26:20,390 --> 00:26:24,380
themselves and it has also the buffer

452
00:26:24,380 --> 00:26:26,690
overflow proof of concept in there but

453
00:26:26,690 --> 00:26:28,880
we're also releasing as as a standalone

454
00:26:28,880 --> 00:26:32,210
file for exploit TV hopefully it will be

455
00:26:32,210 --> 00:26:37,309
publishing yeah today so now to the

456
00:26:37,309 --> 00:26:40,670
future yeah hopefully we'll be able to

457
00:26:40,670 --> 00:26:43,580
see the the exposure I have a better

458
00:26:43,580 --> 00:26:45,110
understanding of the exposure to the

459
00:26:45,110 --> 00:26:45,770
Internet

460
00:26:45,770 --> 00:26:49,130
well it is possible you know that it is

461
00:26:49,130 --> 00:26:52,250
possible to upload some firmware some

462
00:26:52,250 --> 00:26:53,990
malicious firmware to the device and

463
00:26:53,990 --> 00:26:56,570
vector to the device and basically

464
00:26:56,570 --> 00:26:59,570
attack all of the devices that are

465
00:26:59,570 --> 00:27:03,860
exposed so we wanted to do some more but

466
00:27:03,860 --> 00:27:06,860
we didn't have the time it makes some

467
00:27:06,860 --> 00:27:09,920
sense to create if someone wants to take

468
00:27:09,920 --> 00:27:12,860
that initiative to create the protocol

469
00:27:12,860 --> 00:27:15,200
decoder for Wireshark some firmware

470
00:27:15,200 --> 00:27:17,809
analysis we wanted to disassemble the

471
00:27:17,809 --> 00:27:19,640
device and do some more is some more

472
00:27:19,640 --> 00:27:23,750
research on it but not in time but yeah

473
00:27:23,750 --> 00:27:26,090
there's still a lot of work to do in the

474
00:27:26,090 --> 00:27:30,800
the devices in the firmware itself so to

475
00:27:30,800 --> 00:27:34,960
the disclosure we of course contacted

476
00:27:34,960 --> 00:27:40,360
CNCs the c-cert in Portugal and they

477
00:27:40,360 --> 00:27:44,440
they met with us here here in Lisbon and

478
00:27:44,440 --> 00:27:47,270
during which was between February and

479
00:27:47,270 --> 00:27:51,080
March but but basically we told them

480
00:27:51,080 --> 00:27:54,230
what was going on how we asked them well

481
00:27:54,230 --> 00:27:57,320
how they wanted to proceed they they

482
00:27:57,320 --> 00:27:59,630
agreed to coordinate with us we would

483
00:27:59,630 --> 00:28:02,360
contact and visited indirectly and they

484
00:28:02,360 --> 00:28:05,360
would be aware of any communications in

485
00:28:05,360 --> 00:28:07,880
the meantime they would also contact the

486
00:28:07,880 --> 00:28:10,760
the major ISPs here in Portugal to to

487
00:28:10,760 --> 00:28:14,030
get them to advise the companies as much

488
00:28:14,030 --> 00:28:16,670
companies as a good so they will disable

489
00:28:16,670 --> 00:28:21,080
or at least segregate the devices and in

490
00:28:21,080 --> 00:28:23,210
the meantime and this didn't reply to

491
00:28:23,210 --> 00:28:26,300
any of our emails we know that there was

492
00:28:26,300 --> 00:28:29,120
another researcher that basically he

493
00:28:29,120 --> 00:28:31,990
didn't coordinate to it and with other

494
00:28:31,990 --> 00:28:34,580
entities it was fortunate to have a

495
00:28:34,580 --> 00:28:36,680
reply for them and he published some of

496
00:28:36,680 --> 00:28:39,020
these some of the same same

497
00:28:39,020 --> 00:28:41,360
vulnerabilities not all the buffer

498
00:28:41,360 --> 00:28:43,160
overflow and some other ones and the

499
00:28:43,160 --> 00:28:45,920
upgrade but that part is in full

500
00:28:45,920 --> 00:28:49,130
disclosure right now but for the to us

501
00:28:49,130 --> 00:28:51,830
we still don't have don't have a reply

502
00:28:51,830 --> 00:28:54,230
and yet they published on their website

503
00:28:54,230 --> 00:28:57,200
there we saw that a few weeks ago that

504
00:28:57,200 --> 00:29:00,350
we they're promising to have

505
00:29:00,350 --> 00:29:02,540
peer-to-peer double encryption for all

506
00:29:02,540 --> 00:29:06,800
device communications so this is only a

507
00:29:06,800 --> 00:29:08,990
small part of the documents basically

508
00:29:08,990 --> 00:29:11,930
they have military-grade security and at

509
00:29:11,930 --> 00:29:14,870
least they're telling us they have it we

510
00:29:14,870 --> 00:29:16,910
don't know we haven't talked to them and

511
00:29:16,910 --> 00:29:20,450
yeah and we downloaded the latest update

512
00:29:20,450 --> 00:29:22,670
of the cross checks and everything

513
00:29:22,670 --> 00:29:26,900
worked every exploit works the same for

514
00:29:26,900 --> 00:29:28,490
the

515
00:29:28,490 --> 00:29:31,310
upgrade to the devices themselves and

516
00:29:31,310 --> 00:29:33,890
they say that they have an upgrade but

517
00:29:33,890 --> 00:29:36,050
you have to send an email server to to

518
00:29:36,050 --> 00:29:38,870
be able to receive it and we don't have

519
00:29:38,870 --> 00:29:41,690
we don't have that that upgrade so at

520
00:29:41,690 --> 00:29:44,030
least cross-checked its in in the same

521
00:29:44,030 --> 00:29:45,340
point by now

522
00:29:45,340 --> 00:29:52,340
so of course seriously yeah and the the

523
00:29:52,340 --> 00:29:56,060
CRC was a big lesson to us and thank you

524
00:29:56,060 --> 00:30:00,500
again no number but yeah basically I

525
00:30:00,500 --> 00:30:02,900
think the lesson here the main lesson is

526
00:30:02,900 --> 00:30:06,490
do not expose devices and this is

527
00:30:06,490 --> 00:30:09,770
transmitted rehearsal to every IOT

528
00:30:09,770 --> 00:30:13,130
device right now right but don't expose

529
00:30:13,130 --> 00:30:15,950
them don't trust them segregate them as

530
00:30:15,950 --> 00:30:19,220
much as you can and again question them

531
00:30:19,220 --> 00:30:21,620
and for the people that are here that

532
00:30:21,620 --> 00:30:24,230
and they have the time and have the will

533
00:30:24,230 --> 00:30:26,540
to do some more research in this yeah

534
00:30:26,540 --> 00:30:28,910
there's a lot to discover a lot to to

535
00:30:28,910 --> 00:30:32,360
contribute and hopefully a few years

536
00:30:32,360 --> 00:30:36,470
from now we'll have secure devices we

537
00:30:36,470 --> 00:30:39,260
wanted to thank also besides Lisbon for

538
00:30:39,260 --> 00:30:43,760
letting us do this presentation we liked

539
00:30:43,760 --> 00:30:46,640
you a link for the for the vendor wanted

540
00:30:46,640 --> 00:30:48,980
to thank Sharon for the implementation

541
00:30:48,980 --> 00:30:50,990
of the protocol and of course since yes

542
00:30:50,990 --> 00:30:53,360
they were very quick to respond they

543
00:30:53,360 --> 00:30:55,010
coordinated everything with us

544
00:30:55,010 --> 00:30:57,920
they're a very efficient team and yeah

545
00:30:57,920 --> 00:31:00,950
we were basically very very lucky to

546
00:31:00,950 --> 00:31:03,680
have them have them on our side because

547
00:31:03,680 --> 00:31:06,650
we're a bit worried to to get arrested

548
00:31:06,650 --> 00:31:09,220
or something like it

549
00:31:09,220 --> 00:31:13,220
so some more thanks and just to to seems

550
00:31:13,220 --> 00:31:16,400
an end in the ends as average further

551
00:31:16,400 --> 00:31:19,690
for the document review a big thank you

552
00:31:19,690 --> 00:31:23,690
and a and I told you that we wanted to

553
00:31:23,690 --> 00:31:26,559
do leave this in writing this in there

554
00:31:26,559 --> 00:31:28,690
there has been a CV disclosed for some

555
00:31:28,690 --> 00:31:33,100
parts of the this research also and yeah

556
00:31:33,100 --> 00:31:36,100
we basically saw in the meantime that we

557
00:31:36,100 --> 00:31:38,350
were able to get the comms protocol so

558
00:31:38,350 --> 00:31:40,330
we lost a lot of time but yeah we were

559
00:31:40,330 --> 00:31:48,149
not less fun so thank you and questions

560
00:31:54,710 --> 00:31:58,290
Thank You Louis and fellow questions

561
00:31:58,290 --> 00:32:08,250
anyone no questions I have to make time

562
00:32:08,250 --> 00:32:10,650
because coffee break is not ready so you

563
00:32:10,650 --> 00:32:12,720
still have time yeah they don't have the

564
00:32:12,720 --> 00:32:14,550
food ready so if you want to ask some

565
00:32:14,550 --> 00:32:17,100
simple questions you have you guys know

566
00:32:17,100 --> 00:32:22,530
any jokes or yes a joke or a question

567
00:32:22,530 --> 00:32:25,350
I'll ask a quick question okay how hard

568
00:32:25,350 --> 00:32:27,990
was it to find the Control Manager

569
00:32:27,990 --> 00:32:30,900
software was it easy to find was it it's

570
00:32:30,900 --> 00:32:33,780
free on the vendors website turn off but

571
00:32:33,780 --> 00:32:35,490
your love them they have two versions

572
00:32:35,490 --> 00:32:37,470
another one and the new one they all

573
00:32:37,470 --> 00:32:40,020
work the same and they all have two

574
00:32:40,020 --> 00:32:41,130
simple devotee soon

575
00:32:41,130 --> 00:32:44,820
except for Ian Ian it's on a PI basis

576
00:32:44,820 --> 00:32:47,100
but it's from tally max it's not an

577
00:32:47,100 --> 00:32:50,030
official application okie Dokes thanks

578
00:32:50,030 --> 00:32:53,070
okay can I ask question cake course how

579
00:32:53,070 --> 00:32:55,110
long have you been working on this and

580
00:32:55,110 --> 00:32:58,950
what fuzzer did you use to test the

581
00:32:58,950 --> 00:33:03,750
software okay so how long we spent yeah

582
00:33:03,750 --> 00:33:05,490
we talked about it yeah we spend a lot

583
00:33:05,490 --> 00:33:08,400
of time in the in this research

584
00:33:08,400 --> 00:33:10,400
especially in the beginning I don't know

585
00:33:10,400 --> 00:33:14,820
30 years ago a lot of days a lot of days

586
00:33:14,820 --> 00:33:18,510
is some weekends yeah I don't really

587
00:33:18,510 --> 00:33:21,540
have the the idea of how much time we

588
00:33:21,540 --> 00:33:24,420
spent because it was a really fun but it

589
00:33:24,420 --> 00:33:27,930
was a lot was a lot and as for the

590
00:33:27,930 --> 00:33:29,070
second question

591
00:33:29,070 --> 00:33:33,060
it was what yeah what fozzy yeah we

592
00:33:33,060 --> 00:33:35,310
basically didn't didn't need any

593
00:33:35,310 --> 00:33:38,490
forecasts any any professing program

594
00:33:38,490 --> 00:33:41,070
because basically if you send some

595
00:33:41,070 --> 00:33:44,820
enough ace you'll be able to get every

596
00:33:44,820 --> 00:33:48,210
result so no need for that it was not

597
00:33:48,210 --> 00:33:51,770
that hard we don't deserve the credit

598
00:33:52,520 --> 00:33:56,369
[Music]

599
00:33:56,369 --> 00:33:58,499
so in terms of the devices in the

600
00:33:58,499 --> 00:34:01,229
firmware they have did you open one of

601
00:34:01,229 --> 00:34:02,339
the devices you know what type of

602
00:34:02,339 --> 00:34:04,379
storage does it has is like emmc is a

603
00:34:04,379 --> 00:34:06,749
flash to not yet not yet yeah basically

604
00:34:06,749 --> 00:34:09,239
the one we had access to isn't there are

605
00:34:09,239 --> 00:34:11,789
complete access to it was implemented on

606
00:34:11,789 --> 00:34:14,009
our office so what is the cost of one of

607
00:34:14,009 --> 00:34:15,750
those devices anywhere did you like

608
00:34:15,750 --> 00:34:20,239
stationary but very and when I asked

609
00:34:20,239 --> 00:34:22,859
dalla max to the implementation portico

610
00:34:22,859 --> 00:34:27,480
they asked me for 300 euros it was quite

611
00:34:27,480 --> 00:34:31,409
expensive so that delay a little bit we

612
00:34:31,409 --> 00:34:33,059
should make an Hardware love and get

613
00:34:33,059 --> 00:34:37,230
sponsors to buy the devices I try but no

614
00:34:37,230 --> 00:34:40,079
one was answering this conference okay

615
00:34:40,079 --> 00:34:46,819
okay more questions

616
00:34:47,418 --> 00:34:49,159
really

617
00:34:49,159 --> 00:34:54,690
okay let's pray that if you want to to

618
00:34:54,690 --> 00:34:58,789
go more in that this this is now fully

619
00:34:58,789 --> 00:35:02,039
open to the web you can accept the

620
00:35:02,039 --> 00:35:04,259
application you can look for the

621
00:35:04,259 --> 00:35:07,890
disclosure on the sites that we are we

622
00:35:07,890 --> 00:35:09,869
show here and you can see all the

623
00:35:09,869 --> 00:35:12,269
process that we took to understand this

624
00:35:12,269 --> 00:35:14,910
protocol if you want to understand the

625
00:35:14,910 --> 00:35:19,620
market okay so thank you

626
00:35:19,620 --> 00:35:22,719
[Applause]

