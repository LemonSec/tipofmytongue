1
00:00:00,000 --> 00:00:06,509
hi<font color="#E5E5E5"> I'm going to talk</font><font color="#CCCCCC"> to you it's talking</font>

2
00:00:03,959 --> 00:00:09,780
<font color="#CCCCCC">about some toward they don't know yet</font>

3
00:00:06,509 --> 00:00:12,000
Anubis and<font color="#E5E5E5"> the work</font><font color="#CCCCCC"> that you did on a</font>

4
00:00:09,780 --> 00:00:15,030
particular pocket that<font color="#CCCCCC"> is interesting</font>

5
00:00:12,000 --> 00:00:17,039
<font color="#CCCCCC">because it has some some characteristics</font>

6
00:00:15,030 --> 00:00:20,759
that make it good for presentation it's

7
00:00:17,039 --> 00:00:23,160
not too sophisticated but it still uses

8
00:00:20,760 --> 00:00:26,269
some people and some interesting

9
00:00:23,160 --> 00:00:29,580
<font color="#CCCCCC">features and also it was first detected</font>

10
00:00:26,269 --> 00:00:31,109
and we didn't<font color="#CCCCCC"> know what it was so it's</font>

11
00:00:29,580 --> 00:00:34,349
good because we can show the whole

12
00:00:31,109 --> 00:00:36,270
<font color="#CCCCCC">process from the detection of the</font><font color="#E5E5E5"> EGA to</font>

13
00:00:34,350 --> 00:00:40,070
the understanding<font color="#E5E5E5"> of the malware and the</font>

14
00:00:36,270 --> 00:00:44,480
reversing doctrine of<font color="#CCCCCC"> the DJ algorithm</font>

15
00:00:40,070 --> 00:00:47,460
so short shorts what about me cap bread

16
00:00:44,480 --> 00:00:51,110
technical security<font color="#CCCCCC"> enthusiasts started</font>

17
00:00:47,460 --> 00:00:53,219
working in security some time ago and we

18
00:00:51,110 --> 00:00:56,160
penetration test in technical security

19
00:00:53,219 --> 00:00:57,870
consulting highlighter started doing

20
00:00:56,160 --> 00:01:01,050
some forensics which eventually led me

21
00:00:57,870 --> 00:01:03,538
to mom we're reversing and just started

22
00:01:01,050 --> 00:01:06,210
to really enjoy it and finally now or

23
00:01:03,539 --> 00:01:08,549
get a<font color="#CCCCCC"> new piece networks where I get to</font>

24
00:01:06,210 --> 00:01:13,830
do rehearsing<font color="#CCCCCC"> all the research</font><font color="#E5E5E5"> but net</font>

25
00:01:08,549 --> 00:01:18,869
tracking so it's pretty cool so what

26
00:01:13,830 --> 00:01:22,380
we're going to see the<font color="#CCCCCC"> idea is to give</font>

27
00:01:18,869 --> 00:01:26,189
you a short overview<font color="#E5E5E5"> of what we do at</font>

28
00:01:22,380 --> 00:01:27,750
<font color="#E5E5E5">Anubis and what we help however the</font>

29
00:01:26,189 --> 00:01:31,798
whole<font color="#E5E5E5"> process from the detection of a</font>

30
00:01:27,750 --> 00:01:35,729
new DGA to the detection of what and the

31
00:01:31,799 --> 00:01:38,220
understanding<font color="#E5E5E5"> of what malware it is on</font>

32
00:01:35,729 --> 00:01:39,869
the first part of the presentation<font color="#CCCCCC"> we</font>

33
00:01:38,220 --> 00:01:43,500
<font color="#E5E5E5">shall i'll show you a bit of how we</font>

34
00:01:39,869 --> 00:01:46,110
detect<font color="#CCCCCC"> DJs and and on</font><font color="#E5E5E5"> the second part</font>

35
00:01:43,500 --> 00:01:50,460
will go a little bit deeper<font color="#E5E5E5"> into reverse</font>

36
00:01:46,110 --> 00:01:52,439
engineering and show you<font color="#E5E5E5"> how usually the</font>

37
00:01:50,460 --> 00:01:55,770
reverse engineering process called we

38
00:01:52,439 --> 00:02:02,089
use it to<font color="#E5E5E5"> understand the inner workings</font>

39
00:01:55,770 --> 00:02:05,630
of nowhere so detecting ETA is malware

40
00:02:02,090 --> 00:02:08,670
first of all just is charged side to

41
00:02:05,630 --> 00:02:11,549
give a short introduction to in gso GS

42
00:02:08,669 --> 00:02:13,350
our domain generation algorithms so in

43
00:02:11,550 --> 00:02:17,040
fact<font color="#E5E5E5"> there to simply algorithms that</font>

44
00:02:13,350 --> 00:02:19,590
are hard-coded into the<font color="#E5E5E5"> male</font><font color="#CCCCCC"> and that</font>

45
00:02:17,040 --> 00:02:23,570
generate the domains that are used for

46
00:02:19,590 --> 00:02:26,610
command and control of<font color="#CCCCCC"> death mother so</font>

47
00:02:23,570 --> 00:02:28,890
the main objective<font color="#CCCCCC"> of using these years</font>

48
00:02:26,610 --> 00:02:30,960
from a malware point of view is to

49
00:02:28,890 --> 00:02:33,299
increase resiliency so it<font color="#E5E5E5"> is harder</font><font color="#CCCCCC"> to</font>

50
00:02:30,960 --> 00:02:35,550
take<font color="#E5E5E5"> down if you take down one current</font>

51
00:02:33,300 --> 00:02:37,530
control center the bar where we'll keep

52
00:02:35,550 --> 00:02:39,420
on generating new demands<font color="#E5E5E5"> and all the</font>

53
00:02:37,530 --> 00:02:41,310
<font color="#E5E5E5">attacker has to do is register one of</font>

54
00:02:39,420 --> 00:02:43,619
<font color="#E5E5E5">those domains and the malware will</font>

55
00:02:41,310 --> 00:02:45,810
connect the infected pods will connect

56
00:02:43,620 --> 00:02:49,440
<font color="#E5E5E5">to the new demand so it's harder to take</font>

57
00:02:45,810 --> 00:02:51,510
down these kinds of buttons and so in

58
00:02:49,440 --> 00:02:55,500
the<font color="#E5E5E5"> dj's there are different kinds of</font>

59
00:02:51,510 --> 00:02:57,840
<font color="#E5E5E5">each yet so there are fixed the</font><font color="#CCCCCC"> dgs that</font>

60
00:02:55,500 --> 00:03:00,840
simply generate the same set of demands

61
00:02:57,840 --> 00:03:03,390
over and over again when example this is

62
00:03:00,840 --> 00:03:08,130
<font color="#E5E5E5">the rounded but yet which just generated</font>

63
00:03:03,390 --> 00:03:09,660
a waste of 300 I think domains so and it

64
00:03:08,130 --> 00:03:12,810
<font color="#E5E5E5">just iterates over those three hundred</font>

65
00:03:09,660 --> 00:03:15,390
<font color="#E5E5E5">domains there are so some DJ that are</font>

66
00:03:12,810 --> 00:03:17,910
hard-coded that have a hard-coded scene

67
00:03:15,390 --> 00:03:20,369
so the seed is<font color="#CCCCCC"> the development or a</font>

68
00:03:17,910 --> 00:03:22,530
number<font color="#E5E5E5"> that is used to produce a</font>

69
00:03:20,370 --> 00:03:26,070
different<font color="#CCCCCC"> set of domains what the</font>

70
00:03:22,530 --> 00:03:28,440
podmaster can do is after a while he

71
00:03:26,070 --> 00:03:31,620
simply changes the seed and send the new

72
00:03:28,440 --> 00:03:33,690
campaign and the<font color="#E5E5E5"> new malware in the news</font>

73
00:03:31,620 --> 00:03:36,480
the new bots will connect to<font color="#CCCCCC"> a whole</font>

74
00:03:33,690 --> 00:03:38,760
<font color="#CCCCCC">different set of domain so even if there</font>

75
00:03:36,480 --> 00:03:41,040
is something holding and some<font color="#E5E5E5"> people</font>

76
00:03:38,760 --> 00:03:43,170
detecting a group of hosts the<font color="#E5E5E5"> new</font>

77
00:03:41,040 --> 00:03:45,500
sealed<font color="#E5E5E5"> look us the DGA to generate a</font>

78
00:03:43,170 --> 00:03:49,350
completely different set of demands

79
00:03:45,500 --> 00:03:53,040
another common type of<font color="#CCCCCC"> DJ's</font><font color="#E5E5E5"> are the</font>

80
00:03:49,350 --> 00:03:56,040
time-based CDG<font color="#CCCCCC"> eight so here the seed is</font>

81
00:03:53,040 --> 00:03:58,560
based on time so the malware will not

82
00:03:56,040 --> 00:04:00,540
generate the same set of the<font color="#E5E5E5"> mines it</font>

83
00:03:58,560 --> 00:04:03,180
will generate different domains every

84
00:04:00,540 --> 00:04:06,079
day or every other because it is<font color="#E5E5E5"> based</font>

85
00:04:03,180 --> 00:04:08,700
on the time and finally there<font color="#E5E5E5"> are some</font>

86
00:04:06,080 --> 00:04:11,490
tougher ones like the external

87
00:04:08,700 --> 00:04:13,410
value-based<font color="#E5E5E5"> seem honest and good example</font>

88
00:04:11,490 --> 00:04:15,660
of Jesus is the<font color="#E5E5E5"> beat em malware it has</font>

89
00:04:13,410 --> 00:04:17,820
been recently<font color="#E5E5E5"> published the DJ has been</font>

90
00:04:15,660 --> 00:04:20,488
recently<font color="#E5E5E5"> published what it does is it</font>

91
00:04:17,820 --> 00:04:23,310
<font color="#E5E5E5">uses the currency exchange for a given</font>

92
00:04:20,488 --> 00:04:24,840
day as a seed to generate the domain so

93
00:04:23,310 --> 00:04:26,820
we cannot predict the currency exchange

94
00:04:24,840 --> 00:04:29,250
for tomorrow

95
00:04:26,820 --> 00:04:31,440
good we would be rich and<font color="#CCCCCC"> the gas from</font>

96
00:04:29,250 --> 00:04:34,320
the buttons would not need to do to

97
00:04:31,440 --> 00:04:37,320
create button exhale so what it does is

98
00:04:34,320 --> 00:04:39,330
<font color="#CCCCCC">it great and you shall tgi's</font><font color="#E5E5E5"> every day</font>

99
00:04:37,320 --> 00:04:41,070
that's from<font color="#E5E5E5"> between</font><font color="#CCCCCC"> and predictable even</font>

100
00:04:39,330 --> 00:04:43,859
if you have job rhythm you cannot

101
00:04:41,070 --> 00:04:47,820
generate<font color="#CCCCCC"> eg8 further you</font><font color="#E5E5E5"> cannot generate</font>

102
00:04:43,860 --> 00:04:50,190
the domains for the future so now on the

103
00:04:47,820 --> 00:04:53,909
left you have an example<font color="#CCCCCC"> of a DJ that we</font>

104
00:04:50,190 --> 00:04:56,670
so recently it just looks like what<font color="#CCCCCC"> it</font>

105
00:04:53,910 --> 00:04:59,280
is it's<font color="#CCCCCC"> just a random there actually is</font>

106
00:04:56,670 --> 00:05:02,100
<font color="#E5E5E5">my friend it's a algorithm generator but</font>

107
00:04:59,280 --> 00:05:05,460
it looks like random domains and that's

108
00:05:02,100 --> 00:05:08,780
that's an example of the DGA so how do

109
00:05:05,460 --> 00:05:13,640
we detect it this slide shows<font color="#E5E5E5"> a bit of</font>

110
00:05:08,780 --> 00:05:16,409
how will it take and how we get to the

111
00:05:13,640 --> 00:05:18,060
<font color="#CCCCCC">domains and how do we get to</font><font color="#E5E5E5"> sync hold</font>

112
00:05:16,410 --> 00:05:21,000
the domains that the memoir connects to

113
00:05:18,060 --> 00:05:23,880
in order to show them at the<font color="#CCCCCC"> cyber cream</font>

114
00:05:21,000 --> 00:05:27,300
product which<font color="#CCCCCC"> is the flagship product of</font>

115
00:05:23,880 --> 00:05:29,940
Anubis networks now we have two main

116
00:05:27,300 --> 00:05:33,030
entry points which are the top boxes

117
00:05:29,940 --> 00:05:34,260
there's a network-based DJ detection and

118
00:05:33,030 --> 00:05:37,109
there is no file based somewhere

119
00:05:34,260 --> 00:05:39,690
<font color="#E5E5E5">analysis system so on the network based</font>

120
00:05:37,110 --> 00:05:41,850
in a detection what we do is we process

121
00:05:39,690 --> 00:05:44,280
network traffic from internal and

122
00:05:41,850 --> 00:05:46,560
external sources and we have algorithms

123
00:05:44,280 --> 00:05:49,080
to detect when something<font color="#E5E5E5"> that puts like</font>

124
00:05:46,560 --> 00:05:52,050
a DJ appears on that traffic and wind

125
00:05:49,080 --> 00:05:55,409
ens craft so when it does we detect a

126
00:05:52,050 --> 00:05:57,000
new DJ and then we use<font color="#E5E5E5"> that to</font><font color="#CCCCCC"> cinco it</font>

127
00:05:55,410 --> 00:06:00,510
and just start receiving connections

128
00:05:57,000 --> 00:06:03,990
from those buds another thing<font color="#CCCCCC"> that we do</font>

129
00:06:00,510 --> 00:06:06,300
is we do<font color="#CCCCCC"> file based power analysis on an</font>

130
00:06:03,990 --> 00:06:09,300
automated fashion we run thousands of

131
00:06:06,300 --> 00:06:12,510
samples every day and we see if those

132
00:06:09,300 --> 00:06:14,790
samples try to connect to non existing

133
00:06:12,510 --> 00:06:16,530
domains for instance a sample day is

134
00:06:14,790 --> 00:06:18,420
executed and tries to<font color="#E5E5E5"> connect to a large</font>

135
00:06:16,530 --> 00:06:21,270
number<font color="#CCCCCC"> of</font><font color="#E5E5E5"> non existing domain is</font>

136
00:06:18,420 --> 00:06:25,050
probably running a TGA so that's another

137
00:06:21,270 --> 00:06:27,330
way to detect the<font color="#CCCCCC"> dgs and finally what</font>

138
00:06:25,050 --> 00:06:29,580
<font color="#CCCCCC">we</font><font color="#E5E5E5"> do is we use the information from</font>

139
00:06:27,330 --> 00:06:32,310
<font color="#E5E5E5">both these sources and try to connect</font>

140
00:06:29,580 --> 00:06:35,310
them together<font color="#CCCCCC"> to understand what malware</font>

141
00:06:32,310 --> 00:06:38,310
is connecting to each each yet because

142
00:06:35,310 --> 00:06:39,840
lots of times we<font color="#E5E5E5"> identify the ga we know</font>

143
00:06:38,310 --> 00:06:41,070
that it's probably malicious<font color="#E5E5E5"> but we</font>

144
00:06:39,840 --> 00:06:43,799
<font color="#E5E5E5">don't know what</font>

145
00:06:41,070 --> 00:06:45,900
<font color="#E5E5E5">power it is what family it isn't what is</font>

146
00:06:43,800 --> 00:06:52,550
it why is it<font color="#CCCCCC"> good at connecting to those</font>

147
00:06:45,900 --> 00:06:57,390
domains so just using a short example

148
00:06:52,550 --> 00:06:59,100
that similar on the on the right is a is

149
00:06:57,390 --> 00:07:03,479
an image from from an internal system of

150
00:06:59,100 --> 00:07:05,820
ours that shows and<font color="#E5E5E5"> EGA being detected</font>

151
00:07:03,480 --> 00:07:10,980
so the little<font color="#E5E5E5"> the little dots that you</font>

152
00:07:05,820 --> 00:07:12,630
see our our<font color="#E5E5E5"> hosts so you see that there</font>

153
00:07:10,980 --> 00:07:15,330
are lots of ideas that connect to lots

154
00:07:12,630 --> 00:07:18,570
of different posts when did and the same

155
00:07:15,330 --> 00:07:21,270
<font color="#E5E5E5">IP is connected his hosts so this this</font>

156
00:07:18,570 --> 00:07:23,490
is a typical pattern of a TGA and this

157
00:07:21,270 --> 00:07:25,500
is what lets us know that hey there this

158
00:07:23,490 --> 00:07:27,840
is probably<font color="#CCCCCC"> ETA let's look into this</font>

159
00:07:25,500 --> 00:07:32,300
let's sing call it and see<font color="#CCCCCC"> what what it</font>

160
00:07:27,840 --> 00:07:34,799
is so what do you is largely automated

161
00:07:32,300 --> 00:07:36,510
that still has some manual processing at

162
00:07:34,800 --> 00:07:39,150
the end the detection is largely

163
00:07:36,510 --> 00:07:41,370
automated we detect the TV is as they

164
00:07:39,150 --> 00:07:43,770
appear and we use our see how

165
00:07:41,370 --> 00:07:45,990
infrastructure to<font color="#CCCCCC"> sync home plus</font>

166
00:07:43,770 --> 00:07:48,120
<font color="#CCCCCC">dimension process the thousands of hits</font>

167
00:07:45,990 --> 00:07:50,250
the thousands<font color="#E5E5E5"> of hits per second that we</font>

168
00:07:48,120 --> 00:07:53,490
receive<font color="#E5E5E5"> and the</font><font color="#CCCCCC"> millions of infections</font>

169
00:07:50,250 --> 00:07:56,130
they pertain it appear after that the

170
00:07:53,490 --> 00:07:59,160
TGA processing is mostly manual some

171
00:07:56,130 --> 00:08:01,050
some parts are automated what can be

172
00:07:59,160 --> 00:08:03,210
automated we try to automate it but

173
00:08:01,050 --> 00:08:06,480
there's still some manual investigation

174
00:08:03,210 --> 00:08:09,739
going on and so this is<font color="#E5E5E5"> what we'll show</font>

175
00:08:06,480 --> 00:08:13,950
you next what are the advantages of this

176
00:08:09,740 --> 00:08:16,350
base TJ detection it's we can detect new

177
00:08:13,950 --> 00:08:19,020
<font color="#CCCCCC">dgs as they appear as soon as something</font>

178
00:08:16,350 --> 00:08:21,390
appears on the internet trying to to

179
00:08:19,020 --> 00:08:22,710
connect when a new<font color="#CCCCCC"> morality's infecting</font>

180
00:08:21,390 --> 00:08:24,840
machines and all the missions are trying

181
00:08:22,710 --> 00:08:28,739
to connect to these amounts we<font color="#E5E5E5"> detect it</font>

182
00:08:24,840 --> 00:08:30,859
and but most times we detect it and we

183
00:08:28,740 --> 00:08:34,560
don't know what<font color="#E5E5E5"> it is we don't we know</font>

184
00:08:30,860 --> 00:08:36,479
the domains and we can see parts of the

185
00:08:34,559 --> 00:08:38,968
protocol that<font color="#E5E5E5"> connect to</font><font color="#CCCCCC"> our cycles but</font>

186
00:08:36,479 --> 00:08:41,510
sometimes we don't know what it is and

187
00:08:38,969 --> 00:08:45,090
let's bring<font color="#E5E5E5"> this to a question that</font>

188
00:08:41,510 --> 00:08:48,060
appears lots of times there hello miss

189
00:08:45,090 --> 00:08:50,670
you lots of emails have discounted here

190
00:08:48,060 --> 00:08:53,130
what partner is this because sometimes

191
00:08:50,670 --> 00:08:56,410
you just don't know what<font color="#E5E5E5"> is</font>

192
00:08:53,130 --> 00:08:59,620
this brings us to the<font color="#E5E5E5"> next part of</font><font color="#CCCCCC"> the</font>

193
00:08:56,410 --> 00:09:02,709
firebase automatic malware analysis it's

194
00:08:59,620 --> 00:09:05,050
a sandbox that processes tens of

195
00:09:02,710 --> 00:09:08,050
thousands<font color="#CCCCCC"> of samples there is constantly</font>

196
00:09:05,050 --> 00:09:09,880
processing updated samples and it does

197
00:09:08,050 --> 00:09:12,520
catch the following features or because

198
00:09:09,880 --> 00:09:15,250
it is a pretty common features<font color="#CCCCCC"> from</font>

199
00:09:12,520 --> 00:09:18,329
<font color="#CCCCCC">frozen boxes these days the basic static</font>

200
00:09:15,250 --> 00:09:22,839
analysis it finds<font color="#CCCCCC"> the be Heather's the</font>

201
00:09:18,330 --> 00:09:25,839
<font color="#E5E5E5">strings values the umpires exponents of</font>

202
00:09:22,839 --> 00:09:27,880
that basic safety analysis that it does

203
00:09:25,839 --> 00:09:31,240
<font color="#CCCCCC">anamika nalysis so it runs the malware</font>

204
00:09:27,880 --> 00:09:33,730
and in<font color="#E5E5E5"> charge to find what the mower</font>

205
00:09:31,240 --> 00:09:36,400
does which is what fat creates what

206
00:09:33,730 --> 00:09:38,980
registry keys it creates or changes new

207
00:09:36,400 --> 00:09:41,709
taxes and network traffic what network

208
00:09:38,980 --> 00:09:44,800
traffic it generates it also<font color="#E5E5E5"> has a nice</font>

209
00:09:41,710 --> 00:09:46,810
feature that<font color="#E5E5E5"> it is able to use physical</font>

210
00:09:44,800 --> 00:09:49,390
machines there are some malware that

211
00:09:46,810 --> 00:09:52,930
won't run or smt the measures

212
00:09:49,390 --> 00:09:56,439
implemented to detect<font color="#E5E5E5"> virtual machine</font>

213
00:09:52,930 --> 00:09:58,329
and so we have some instances that

214
00:09:56,440 --> 00:10:01,270
<font color="#E5E5E5">Doraemon physical machines and they are</font>

215
00:09:58,330 --> 00:10:05,020
able<font color="#CCCCCC"> to run this power at ultimate so it</font>

216
00:10:01,270 --> 00:10:06,670
is critical stuff then there is<font color="#E5E5E5"> also a</font>

217
00:10:05,020 --> 00:10:09,100
<font color="#E5E5E5">public for instance if you want to try</font>

218
00:10:06,670 --> 00:10:11,500
<font color="#E5E5E5">it there's a you are out there is his</font>

219
00:10:09,100 --> 00:10:14,020
free you can use it<font color="#E5E5E5"> anytime you want to</font>

220
00:10:11,500 --> 00:10:16,870
<font color="#E5E5E5">just blow the sample we don't run it</font>

221
00:10:14,020 --> 00:10:19,060
give your report and<font color="#CCCCCC"> so this is what it</font>

222
00:10:16,870 --> 00:10:23,709
does in terms of samples gives us a

223
00:10:19,060 --> 00:10:27,219
report and<font color="#E5E5E5"> you use</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> for two main</font>

224
00:10:23,709 --> 00:10:29,709
things first to detect malware if you're

225
00:10:27,220 --> 00:10:32,080
using<font color="#CCCCCC"> PGA's and we do this by detecting</font>

226
00:10:29,709 --> 00:10:33,939
malware that tries<font color="#CCCCCC"> to connect to the</font>

227
00:10:32,080 --> 00:10:37,060
mains that don't exist because when you

228
00:10:33,940 --> 00:10:38,770
use it<font color="#CCCCCC"> oh my when you use</font><font color="#E5E5E5"> alleviate most</font>

229
00:10:37,060 --> 00:10:41,589
of the domains that the power connects

230
00:10:38,770 --> 00:10:44,380
to will return run existing and that's

231
00:10:41,589 --> 00:10:47,740
that's the way to<font color="#E5E5E5"> detective and the</font>

232
00:10:44,380 --> 00:10:51,130
<font color="#CCCCCC">other is the main reason why we use this</font>

233
00:10:47,740 --> 00:10:53,860
sun sand box is to detect samples that

234
00:10:51,130 --> 00:10:56,080
are already see<font color="#E5E5E5"> cold because we detected</font>

235
00:10:53,860 --> 00:10:58,870
them with our network based analysis

236
00:10:56,080 --> 00:11:01,780
<font color="#E5E5E5">system but we don't know what they are</font>

237
00:10:58,870 --> 00:11:06,520
we don't<font color="#E5E5E5"> know what family or what power</font>

238
00:11:01,780 --> 00:11:09,579
does it so we can implement gallows and

239
00:11:06,520 --> 00:11:11,710
smart rules into the sandbox and detect

240
00:11:09,580 --> 00:11:14,410
those patterns that we are seeing on our

241
00:11:11,710 --> 00:11:15,760
<font color="#E5E5E5">sink rolls so we can get alerted as soon</font>

242
00:11:14,410 --> 00:11:21,130
as the sample<font color="#CCCCCC"> that matches those</font>

243
00:11:15,760 --> 00:11:25,470
patterns to sound this is an example<font color="#CCCCCC"> of</font>

244
00:11:21,130 --> 00:11:30,220
the ultra<font color="#E5E5E5"> interface and you can see here</font>

245
00:11:25,470 --> 00:11:33,250
this step shows the NX domains so the

246
00:11:30,220 --> 00:11:34,810
fourth<font color="#E5E5E5"> column shows the domain that the</font>

247
00:11:33,250 --> 00:11:36,820
malware tried to connect you that

248
00:11:34,810 --> 00:11:39,520
doesn't exist and you will<font color="#E5E5E5"> see that</font>

249
00:11:36,820 --> 00:11:41,470
there are this<font color="#E5E5E5"> is just</font><font color="#CCCCCC"> a static image so</font>

250
00:11:39,520 --> 00:11:43,990
we won't cheat but there you will see

251
00:11:41,470 --> 00:11:48,100
that the malware that connects too much

252
00:11:43,990 --> 00:11:53,160
domain that's<font color="#E5E5E5"> probably a TGA so this</font><font color="#CCCCCC"> is</font>

253
00:11:48,100 --> 00:11:53,160
an example of<font color="#E5E5E5"> they've kept their</font><font color="#CCCCCC"> charter</font>

254
00:11:53,820 --> 00:12:02,560
so finally we've made all this<font color="#CCCCCC"> and we</font>

255
00:11:59,590 --> 00:12:04,630
<font color="#E5E5E5">identified the vga who are we to network</font>

256
00:12:02,560 --> 00:12:08,199
analysis or we did for<font color="#CCCCCC"> the teacher to</font>

257
00:12:04,630 --> 00:12:10,360
five analysis when what we do next is we

258
00:12:08,200 --> 00:12:12,340
try to aggregate this information so

259
00:12:10,360 --> 00:12:14,410
that<font color="#E5E5E5"> we can add it into the server field</font>

260
00:12:12,340 --> 00:12:16,600
and it give it some contexts we need to

261
00:12:14,410 --> 00:12:18,880
add into the soccer field until at least

262
00:12:16,600 --> 00:12:20,410
tell what family it is that ideally we

263
00:12:18,880 --> 00:12:23,140
need to give some<font color="#E5E5E5"> more information</font><font color="#CCCCCC"> than</font>

264
00:12:20,410 --> 00:12:25,600
that what<font color="#E5E5E5"> mount one's behavior is</font>

265
00:12:23,140 --> 00:12:28,240
nowhere<font color="#CCCCCC"> as what does it do what is it</font>

266
00:12:25,600 --> 00:12:32,380
trying to<font color="#E5E5E5"> put down from its intentions</font>

267
00:12:28,240 --> 00:12:34,600
so what we do is put on all things we

268
00:12:32,380 --> 00:12:36,550
try to query all the sources of

269
00:12:34,600 --> 00:12:39,100
information<font color="#E5E5E5"> that we have try to identify</font>

270
00:12:36,550 --> 00:12:41,589
the smaller as soon as possible if we

271
00:12:39,100 --> 00:12:44,800
<font color="#E5E5E5">can't identify it we will put signature</font>

272
00:12:41,590 --> 00:12:47,050
to detect them and<font color="#E5E5E5"> finally when we</font>

273
00:12:44,800 --> 00:12:49,290
detected what we can do is you can

274
00:12:47,050 --> 00:12:52,089
<font color="#CCCCCC">reverse engineer the samples and</font>

275
00:12:49,290 --> 00:12:54,219
understand what they will<font color="#E5E5E5"> be too if</font><font color="#CCCCCC"> they</font>

276
00:12:52,090 --> 00:13:00,040
have a DG I understand the<font color="#CCCCCC"> TGA what it</font>

277
00:12:54,220 --> 00:13:02,380
does and finally a quitter will pacify

278
00:13:00,040 --> 00:13:07,089
all this malware and add context to side

279
00:13:02,380 --> 00:13:13,439
of it so this<font color="#CCCCCC"> is</font><font color="#E5E5E5"> the first part that</font>

280
00:13:07,090 --> 00:13:16,990
shows you how<font color="#CCCCCC"> we detect smaller the next</font>

281
00:13:13,440 --> 00:13:19,699
part of the presentation will be focused

282
00:13:16,990 --> 00:13:23,029
on<font color="#E5E5E5"> the reversing part of it so</font>

283
00:13:19,699 --> 00:13:27,349
so the whole story is we detected<font color="#CCCCCC"> a</font>

284
00:13:23,029 --> 00:13:29,359
<font color="#E5E5E5">botnet the Piron run on the network face</font>

285
00:13:27,350 --> 00:13:32,410
detection systems those are<font color="#CCCCCC"> some of the</font>

286
00:13:29,359 --> 00:13:36,290
<font color="#E5E5E5">domain sets which we saw showing up and</font>

287
00:13:32,410 --> 00:13:39,439
we didn't<font color="#E5E5E5"> know what it was we seen hold</font>

288
00:13:36,290 --> 00:13:41,839
it and we looked at all the<font color="#E5E5E5"> Aussie</font>

289
00:13:39,439 --> 00:13:44,089
sources they were at the<font color="#E5E5E5"> time and there</font>

290
00:13:41,839 --> 00:13:47,149
are simply no information about it we

291
00:13:44,089 --> 00:13:51,649
saw<font color="#E5E5E5"> that it was targeting almost</font>

292
00:13:47,149 --> 00:13:53,269
exclusively the US and you a but we

293
00:13:51,649 --> 00:13:55,040
didn't know we saw the traffic patterns

294
00:13:53,269 --> 00:13:58,309
arriving at<font color="#E5E5E5"> the sinkholes we saw the</font>

295
00:13:55,040 --> 00:14:00,529
domains but nothing there<font color="#CCCCCC"> was no and now</font>

296
00:13:58,309 --> 00:14:04,040
it is on virustotal that<font color="#E5E5E5"> showed anything</font>

297
00:14:00,529 --> 00:14:06,709
like it or I'm malware nothing showed

298
00:14:04,040 --> 00:14:09,169
anything that we could use to identify

299
00:14:06,709 --> 00:14:12,258
this person we have to create signatures

300
00:14:09,169 --> 00:14:14,329
and wait<font color="#CCCCCC"> until we found something and</font>

301
00:14:12,259 --> 00:14:16,609
this again brings us to that question it

302
00:14:14,329 --> 00:14:21,618
shows up sometimes<font color="#E5E5E5"> what what what bug</font>

303
00:14:16,609 --> 00:14:25,220
net is this so what we have to<font color="#CCCCCC"> look to</font>

304
00:14:21,619 --> 00:14:28,539
try to understand what button is this we

305
00:14:25,220 --> 00:14:32,419
had that humility to sorry the US and UK

306
00:14:28,539 --> 00:14:34,309
not much community hell so curious HTTP

307
00:14:32,419 --> 00:14:38,059
headers you can see here it has this

308
00:14:34,309 --> 00:14:41,389
check this is this is the data that we

309
00:14:38,059 --> 00:14:44,660
can extract on cyber feet and what it

310
00:14:41,389 --> 00:14:47,389
has is this tells<font color="#E5E5E5"> an HTTP header in</font>

311
00:14:44,660 --> 00:14:50,689
check we do lots of related that strange

312
00:14:47,389 --> 00:14:53,179
not commonly seen so we knew we had this

313
00:14:50,689 --> 00:14:54,889
check ever we try to find some

314
00:14:53,179 --> 00:14:57,679
<font color="#CCCCCC">information about malware it has a check</font>

315
00:14:54,889 --> 00:15:00,649
<font color="#CCCCCC">Heather on the network communication and</font>

316
00:14:57,679 --> 00:15:03,379
knock each other and<font color="#E5E5E5"> you can sell me to</font>

317
00:15:00,649 --> 00:15:05,239
other interesting features it uses<font color="#CCCCCC"> in</font>

318
00:15:03,379 --> 00:15:09,499
<font color="#CCCCCC">each end user agent saying</font><font color="#E5E5E5"> people's</font>

319
00:15:05,239 --> 00:15:12,199
<font color="#E5E5E5">Microsoft crypto API 633 which seemed</font>

320
00:15:09,499 --> 00:15:14,509
pretty legit<font color="#E5E5E5"> you will get it also use</font>

321
00:15:12,199 --> 00:15:17,449
that earth mean for all URL that's

322
00:15:14,509 --> 00:15:19,699
that's in the real path that microsoft

323
00:15:17,449 --> 00:15:22,519
windows uses to download the certificate

324
00:15:19,699 --> 00:15:24,919
revocation list so it was probably

325
00:15:22,519 --> 00:15:28,100
trying to point in into common network

326
00:15:24,919 --> 00:15:30,110
traffic by using a URL is used by

327
00:15:28,100 --> 00:15:32,550
Microsoft Windows messages process we

328
00:15:30,110 --> 00:15:34,860
appearing on on<font color="#E5E5E5"> with proxies and</font>

329
00:15:32,550 --> 00:15:36,839
on proxy walls so it was time to blend

330
00:15:34,860 --> 00:15:39,180
in this is what was the information that

331
00:15:36,839 --> 00:15:44,760
we had with it we used<font color="#E5E5E5"> to create our</font>

332
00:15:39,180 --> 00:15:48,750
signatures place them so<font color="#E5E5E5"> eventually we</font>

333
00:15:44,760 --> 00:15:52,220
found the sample once we<font color="#E5E5E5"> have a sample</font>

334
00:15:48,750 --> 00:15:54,390
the immediate questions are so is this

335
00:15:52,220 --> 00:15:58,290
categorized and detected by antivirus

336
00:15:54,390 --> 00:15:59,730
software is there somebody who made the

337
00:15:58,290 --> 00:16:03,810
reference paper on you two already

338
00:15:59,730 --> 00:16:06,930
reverse smaller those what it does do so

339
00:16:03,810 --> 00:16:09,479
what is it do and another important

340
00:16:06,930 --> 00:16:11,880
question<font color="#E5E5E5"> is do we have visibility over</font>

341
00:16:09,480 --> 00:16:14,940
the whole botnets on our sinkholes and

342
00:16:11,880 --> 00:16:17,670
if not can we increase it because if you

343
00:16:14,940 --> 00:16:20,910
remember<font color="#CCCCCC"> from the types of tj's if it is</font>

344
00:16:17,670 --> 00:16:22,439
for instance<font color="#E5E5E5"> scene based DGA be there</font>

345
00:16:20,910 --> 00:16:25,290
can be several seats and we are only

346
00:16:22,440 --> 00:16:26,790
<font color="#CCCCCC">sync only one of the scenes and we are</font>

347
00:16:25,290 --> 00:16:29,550
not seeing the whole<font color="#CCCCCC"> button it's just a</font>

348
00:16:26,790 --> 00:16:33,390
small subset of it so we<font color="#CCCCCC"> need to</font>

349
00:16:29,550 --> 00:16:35,760
understand what kind of<font color="#E5E5E5"> TGA is to</font>

350
00:16:33,390 --> 00:16:38,370
understand be free if we have it all<font color="#E5E5E5"> and</font>

351
00:16:35,760 --> 00:16:43,589
if not how can we<font color="#E5E5E5"> get</font><font color="#CCCCCC"> on the other</font><font color="#E5E5E5"> seeds</font>

352
00:16:38,370 --> 00:16:46,079
and increase our visibility also we

353
00:16:43,589 --> 00:16:47,880
received that check header and some post

354
00:16:46,079 --> 00:16:49,829
data on the sinkholes and we wanted to

355
00:16:47,880 --> 00:16:52,020
understand or what is this vector you

356
00:16:49,829 --> 00:16:53,910
totally seem to encrypted it was<font color="#E5E5E5"> pretty</font>

357
00:16:52,020 --> 00:16:55,529
<font color="#E5E5E5">much Trevor and we didn't</font><font color="#CCCCCC"> know a request</font>

358
00:16:53,910 --> 00:16:57,779
we had you want you to understand

359
00:16:55,529 --> 00:17:00,029
<font color="#E5E5E5">because you saw with their information</font>

360
00:16:57,779 --> 00:17:02,430
you that we can<font color="#CCCCCC"> use to for instance</font>

361
00:17:00,029 --> 00:17:04,829
identify unique infections instead of

362
00:17:02,430 --> 00:17:08,490
eyepiece so we wanted to understand<font color="#E5E5E5"> what</font>

363
00:17:04,829 --> 00:17:13,589
it was so<font color="#CCCCCC"> we started doing</font><font color="#E5E5E5"> some</font>

364
00:17:08,490 --> 00:17:16,500
reversing optimality we started doing

365
00:17:13,589 --> 00:17:19,260
pretty much to the standard reverse

366
00:17:16,500 --> 00:17:22,020
engineering process of malware so we

367
00:17:19,260 --> 00:17:25,459
started by using basic safety<font color="#CCCCCC"> canali it</font>

368
00:17:22,020 --> 00:17:28,889
will toward strings inside malware the

369
00:17:25,459 --> 00:17:32,490
heathers of the PDF file and imports and

370
00:17:28,890 --> 00:17:34,980
what we found<font color="#E5E5E5"> was that those strings</font>

371
00:17:32,490 --> 00:17:37,559
that were going useful strings in the

372
00:17:34,980 --> 00:17:41,910
Malheur the rest was just courage I

373
00:17:37,559 --> 00:17:44,460
think readable the<font color="#CCCCCC"> imports were also on</font>

374
00:17:41,910 --> 00:17:46,270
<font color="#E5E5E5">Windows densities feels pretty small</font>

375
00:17:44,460 --> 00:17:48,670
table of imports

376
00:17:46,270 --> 00:17:52,420
so this<font color="#CCCCCC"> told is that most likely</font><font color="#E5E5E5"> is no</font>

377
00:17:48,670 --> 00:17:55,540
respect so most malware uses some form

378
00:17:52,420 --> 00:17:57,490
of packing in order to hide respondents

379
00:17:55,540 --> 00:18:00,399
and make the reversal process a little

380
00:17:57,490 --> 00:18:04,020
more difficult and to avoid anti virus

381
00:18:00,400 --> 00:18:07,660
detection and<font color="#E5E5E5"> what</font><font color="#CCCCCC"> it first it uses a</font>

382
00:18:04,020 --> 00:18:10,180
stub that will if you have a section or

383
00:18:07,660 --> 00:18:12,910
part of the sample a part of the file

384
00:18:10,180 --> 00:18:15,190
<font color="#E5E5E5">that will contain the real cold in an</font>

385
00:18:12,910 --> 00:18:18,190
encrypted or an encoded format and then

386
00:18:15,190 --> 00:18:20,650
<font color="#CCCCCC">it will have a small</font><font color="#E5E5E5"> particle that will</font>

387
00:18:18,190 --> 00:18:22,720
run it will run to decode the white part

388
00:18:20,650 --> 00:18:25,570
<font color="#E5E5E5">of</font><font color="#CCCCCC"> the power and then it will jump to</font>

389
00:18:22,720 --> 00:18:29,320
<font color="#E5E5E5">that part and run the real cop that's</font>

390
00:18:25,570 --> 00:18:31,689
its distinct simple overview what what

391
00:18:29,320 --> 00:18:35,139
what acting is so it<font color="#E5E5E5"> became a script or</font>

392
00:18:31,690 --> 00:18:37,960
it can just use X are you several<font color="#E5E5E5"> the</font>

393
00:18:35,140 --> 00:18:40,480
ways of<font color="#E5E5E5"> doing it</font><font color="#CCCCCC"> softly perspect okay</font>

394
00:18:37,960 --> 00:18:43,780
not much we can see from basic static

395
00:18:40,480 --> 00:18:45,670
analysis so we started by reading it and

396
00:18:43,780 --> 00:18:48,490
by running it with Swiss Miss awesome

397
00:18:45,670 --> 00:18:50,770
certain things we saw that if<font color="#E5E5E5"> the once</font>

398
00:18:48,490 --> 00:18:53,530
you friend created a few files it

399
00:18:50,770 --> 00:18:56,590
creates a file called software

400
00:18:53,530 --> 00:19:01,810
protection platform as BBC that a deed

401
00:18:56,590 --> 00:19:04,629
holds pretty legit added it to system 32

402
00:19:01,810 --> 00:19:08,860
directory it creates some temporary

403
00:19:04,630 --> 00:19:11,860
files and random names all right and it

404
00:19:08,860 --> 00:19:14,229
uses a common key issues for registry

405
00:19:11,860 --> 00:19:17,379
key that's used for persistent so we

406
00:19:14,230 --> 00:19:20,230
tell in itself to current version ran so

407
00:19:17,380 --> 00:19:23,530
every time that the user was in it would

408
00:19:20,230 --> 00:19:26,980
run so it<font color="#CCCCCC"> it it uses this feature</font><font color="#E5E5E5"> to add</font>

409
00:19:23,530 --> 00:19:28,660
persistence on the system and<font color="#CCCCCC"> then if</font>

410
00:19:26,980 --> 00:19:30,880
that wasn't enough it still at this

411
00:19:28,660 --> 00:19:32,800
second mechanism for persistence we

412
00:19:30,880 --> 00:19:35,860
created a<font color="#CCCCCC"> windows</font><font color="#E5E5E5"> service and also</font>

413
00:19:32,800 --> 00:19:38,980
<font color="#E5E5E5">pointed to death first time and finally</font>

414
00:19:35,860 --> 00:19:41,320
<font color="#CCCCCC">it started to try to resolve all of the</font>

415
00:19:38,980 --> 00:19:44,380
minds of the vga and<font color="#CCCCCC"> try to connect them</font>

416
00:19:41,320 --> 00:19:46,929
so this<font color="#CCCCCC"> is what we have from the panic</font>

417
00:19:44,380 --> 00:19:49,660
from the dynamic analysis but still we

418
00:19:46,930 --> 00:19:53,890
knew pretty much the same we knew<font color="#E5E5E5"> few</font>

419
00:19:49,660 --> 00:19:55,510
files it created we knew it<font color="#E5E5E5"> connected to</font>

420
00:19:53,890 --> 00:19:57,730
the domains that we were seeing hauling

421
00:19:55,510 --> 00:20:01,690
so ok this is the sample<font color="#E5E5E5"> this is the</font>

422
00:19:57,730 --> 00:20:04,600
fun but still what<font color="#E5E5E5"> does it do this isn't</font>

423
00:20:01,690 --> 00:20:07,810
tell us much so we have to do some

424
00:20:04,600 --> 00:20:10,750
reversing on it first thing we did was

425
00:20:07,810 --> 00:20:14,940
try<font color="#E5E5E5"> to identify to pecker how is this</font>

426
00:20:10,750 --> 00:20:18,450
our bags and what we did was use the

427
00:20:14,940 --> 00:20:22,090
common program that<font color="#E5E5E5"> is for reasons PID</font>

428
00:20:18,450 --> 00:20:25,570
and we ran it and it identified it has

429
00:20:22,090 --> 00:20:28,060
been fasm one but five this<font color="#E5E5E5"> is grand</font>

430
00:20:25,570 --> 00:20:30,490
assembly so it was telling<font color="#E5E5E5"> us hope this</font>

431
00:20:28,060 --> 00:20:32,770
is written<font color="#CCCCCC"> in assembly there is an</font>

432
00:20:30,490 --> 00:20:35,080
<font color="#CCCCCC">object so will you in perspective</font>

433
00:20:32,770 --> 00:20:37,660
probably just a<font color="#CCCCCC"> pecker written in</font>

434
00:20:35,080 --> 00:20:40,090
assembly that<font color="#E5E5E5"> was the conclusion that we</font>

435
00:20:37,660 --> 00:20:43,840
got and no matter there are a few other

436
00:20:40,090 --> 00:20:46,810
<font color="#E5E5E5">pecker it turns out there and i'll</font>

437
00:20:43,840 --> 00:20:51,100
return the same results that says there

438
00:20:46,810 --> 00:20:53,560
is no<font color="#CCCCCC"> packer ID so we cannot use a no</font>

439
00:20:51,100 --> 00:20:55,810
<font color="#E5E5E5">writing mate and back there are some for</font>

440
00:20:53,560 --> 00:20:57,909
instance upx is a common factor and

441
00:20:55,810 --> 00:21:00,850
there are you can end back in choosing

442
00:20:57,910 --> 00:21:04,900
ups with respect like that just run at

443
00:21:00,850 --> 00:21:06,969
all we have<font color="#CCCCCC"> the original power on our</font>

444
00:21:04,900 --> 00:21:12,010
hands so<font color="#CCCCCC"> we</font><font color="#E5E5E5"> have to do some manual and</font>

445
00:21:06,970 --> 00:21:15,730
back anyone taking its most of the times

446
00:21:12,010 --> 00:21:18,730
it's not hard it's<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> just a question</font>

447
00:21:15,730 --> 00:21:21,940
<font color="#CCCCCC">getting used</font><font color="#E5E5E5"> to it it gets easier with</font>

448
00:21:18,730 --> 00:21:24,370
time so what we did was read that<font color="#E5E5E5"> Holly</font>

449
00:21:21,940 --> 00:21:27,640
debugger to the process when<font color="#E5E5E5"> and use we</font>

450
00:21:24,370 --> 00:21:29,790
started the<font color="#CCCCCC"> momma and we set a</font>

451
00:21:27,640 --> 00:21:32,770
<font color="#CCCCCC">breakpoint on the ritual of our function</font>

452
00:21:29,790 --> 00:21:36,639
this function is commonly used to

453
00:21:32,770 --> 00:21:39,840
allocate memory region<font color="#CCCCCC"> on earth</font><font color="#E5E5E5"> memory</font>

454
00:21:36,640 --> 00:21:46,180
that the mallard and uses to write the

455
00:21:39,840 --> 00:21:49,540
impact the mower code and assembly into

456
00:21:46,180 --> 00:21:51,940
so it will just<font color="#E5E5E5"> jump week after so we</font>

457
00:21:49,540 --> 00:21:54,430
knew<font color="#CCCCCC"> that once we got to the execution</font>

458
00:21:51,940 --> 00:21:57,970
of the<font color="#CCCCCC"> ripple log function then the real</font>

459
00:21:54,430 --> 00:22:01,360
problem would be<font color="#E5E5E5"> fired so that's what we</font>

460
00:21:57,970 --> 00:22:03,310
did and<font color="#E5E5E5"> after that we</font><font color="#CCCCCC"> just got the</font>

461
00:22:01,360 --> 00:22:07,600
return<font color="#E5E5E5"> value from people</font><font color="#CCCCCC"> work which gave</font>

462
00:22:03,310 --> 00:22:10,470
us the memory section that was<font color="#E5E5E5"> created</font>

463
00:22:07,600 --> 00:22:14,010
to store the

464
00:22:10,470 --> 00:22:15,360
the real code and then we just<font color="#E5E5E5"> created</font>

465
00:22:14,010 --> 00:22:17,580
<font color="#E5E5E5">breakpoints so they're going to code</font>

466
00:22:15,360 --> 00:22:20,100
started running<font color="#E5E5E5"> in that section we knew</font>

467
00:22:17,580 --> 00:22:23,220
well<font color="#CCCCCC"> okay this is now your regional cult</font>

468
00:22:20,100 --> 00:22:26,490
that respect so and at<font color="#E5E5E5"> that point we</font>

469
00:22:23,220 --> 00:22:28,650
would dump the process yet what we do we

470
00:22:26,490 --> 00:22:31,710
have<font color="#E5E5E5"> some some examples here that show</font>

471
00:22:28,650 --> 00:22:34,940
that sure what we need so here in the

472
00:22:31,710 --> 00:22:38,400
first image you'll see the virtual<font color="#E5E5E5"> the</font>

473
00:22:34,940 --> 00:22:41,100
function just finished being called then

474
00:22:38,400 --> 00:22:44,850
you can look at the ebay<font color="#E5E5E5"> x register on</font>

475
00:22:41,100 --> 00:22:47,668
the antis the red circle is that shows

476
00:22:44,850 --> 00:22:50,010
you intend<font color="#E5E5E5"> to return the value of the</font>

477
00:22:47,669 --> 00:22:52,350
<font color="#CCCCCC">function so we knew that probably</font><font color="#E5E5E5"> this</font>

478
00:22:50,010 --> 00:22:55,919
hour we'll do it you know code would be

479
00:22:52,350 --> 00:22:58,799
written into that section and then move

480
00:22:55,919 --> 00:23:01,320
that section and we saw it tell already

481
00:22:58,799 --> 00:23:03,629
read Brian a few privileges so this is

482
00:23:01,320 --> 00:23:08,158
probably<font color="#E5E5E5"> it</font><font color="#CCCCCC"> and power will jump</font><font color="#E5E5E5"> to it</font>

483
00:23:03,630 --> 00:23:10,890
and execute from there so what we did

484
00:23:08,159 --> 00:23:13,289
was<font color="#CCCCCC"> we just set a few breakpoints and</font>

485
00:23:10,890 --> 00:23:17,190
finally the malware when it on this

486
00:23:13,289 --> 00:23:20,850
session once it's landed here is well

487
00:23:17,190 --> 00:23:22,980
it's not very easy to see<font color="#CCCCCC"> but</font><font color="#E5E5E5"> this lower</font>

488
00:23:20,850 --> 00:23:25,678
section<font color="#E5E5E5"> can see the MC Hammer that's</font>

489
00:23:22,980 --> 00:23:28,230
<font color="#E5E5E5">typical from the beginning of</font><font color="#CCCCCC"> the pp5</font>

490
00:23:25,679 --> 00:23:33,000
and there is the<font color="#E5E5E5"> beginning session so we</font>

491
00:23:28,230 --> 00:23:35,610
just use the<font color="#CCCCCC"> plug-in for 40 any bugger</font>

492
00:23:33,000 --> 00:23:38,280
that's called<font color="#E5E5E5"> holy dump and we just</font>

493
00:23:35,610 --> 00:23:42,240
dumped the memory section when set the

494
00:23:38,280 --> 00:23:45,000
appropriate entry point of this charge

495
00:23:42,240 --> 00:23:48,150
and we got your original code of<font color="#CCCCCC"> the mat</font>

496
00:23:45,000 --> 00:23:49,559
workshop it was no impact after i'm

497
00:23:48,150 --> 00:23:53,340
hanging things were a lot different

498
00:23:49,559 --> 00:23:55,139
<font color="#CCCCCC">they're well mark imports and there were</font>

499
00:23:53,340 --> 00:23:56,850
several functions you can be streamed so

500
00:23:55,140 --> 00:23:59,309
there were no names on the functions

501
00:23:56,850 --> 00:24:01,830
which we make the<font color="#CCCCCC"> universe's a little</font>

502
00:23:59,309 --> 00:24:04,289
bit different and there are<font color="#E5E5E5"> lots of</font>

503
00:24:01,830 --> 00:24:07,080
strings now that had some meaning so you

504
00:24:04,289 --> 00:24:10,650
can see Constance their head the URL<font color="#E5E5E5"> in</font>

505
00:24:07,080 --> 00:24:13,850
the path the<font color="#E5E5E5"> pki and escort so all that</font>

506
00:24:10,650 --> 00:24:17,059
was now accessible and we could start

507
00:24:13,850 --> 00:24:17,059
reversing it

508
00:24:17,619 --> 00:24:25,789
so after and backe is we wanted<font color="#CCCCCC"> to know</font>

509
00:24:22,850 --> 00:24:28,189
about what<font color="#E5E5E5"> physic do after</font><font color="#CCCCCC"> all and it</font>

510
00:24:25,789 --> 00:24:30,590
was to be<font color="#E5E5E5"> running streams we saw a lot</font>

511
00:24:28,190 --> 00:24:34,519
of information that<font color="#CCCCCC"> give us</font><font color="#E5E5E5"> clues about</font>

512
00:24:30,590 --> 00:24:37,369
what if you it was it has strings like

513
00:24:34,519 --> 00:24:40,369
screenshot probably big screen shot and

514
00:24:37,369 --> 00:24:43,009
a lot of functions<font color="#E5E5E5"> that are used to take</font>

515
00:24:40,369 --> 00:24:45,738
screenshots report it also it had this

516
00:24:43,009 --> 00:24:49,820
TV info something probably get her she's

517
00:24:45,739 --> 00:24:54,970
a meaningful a 10 yet dot PE m dot exe

518
00:24:49,820 --> 00:24:58,639
it so there's something<font color="#E5E5E5"> with PDFs and it</font>

519
00:24:54,970 --> 00:25:01,759
had some strange names but he gave us an

520
00:24:58,639 --> 00:25:04,580
idea probably did it also<font color="#CCCCCC"> had a group of</font>

521
00:25:01,759 --> 00:25:06,409
comments that<font color="#E5E5E5"> we prevent it given this</font>

522
00:25:04,580 --> 00:25:09,739
is the meaningful task least run in

523
00:25:06,409 --> 00:25:11,779
verse registry keys sir it's pretty much

524
00:25:09,739 --> 00:25:16,999
gather some information<font color="#E5E5E5"> that's what we</font>

525
00:25:11,779 --> 00:25:20,570
saw so following this if you have<font color="#CCCCCC"> Doug</font>

526
00:25:16,999 --> 00:25:23,570
PDF but<font color="#CCCCCC"> yet see</font><font color="#E5E5E5"> the strings in memory we</font>

527
00:25:20,570 --> 00:25:25,639
saw using either bro where it was

528
00:25:23,570 --> 00:25:28,399
referenced and we started dressing

529
00:25:25,639 --> 00:25:30,498
assembly you see what it<font color="#E5E5E5"> did and we got</font>

530
00:25:28,399 --> 00:25:34,119
to the function and we understood by

531
00:25:30,499 --> 00:25:37,070
just skinny we didn't have<font color="#CCCCCC"> to just</font><font color="#E5E5E5"> 22</font>

532
00:25:34,119 --> 00:25:38,600
radius and we learn by<font color="#CCCCCC"> both sometimes if</font>

533
00:25:37,070 --> 00:25:42,470
you just came through the golden see

534
00:25:38,600 --> 00:25:44,299
what<font color="#E5E5E5"> calls our calls are being made you</font>

535
00:25:42,470 --> 00:25:47,359
get<font color="#E5E5E5"> the general idea of what it</font><font color="#CCCCCC"> is doing</font>

536
00:25:44,299 --> 00:25:49,820
so what we saw was that<font color="#E5E5E5"> it was actively</font>

537
00:25:47,359 --> 00:25:52,549
searching for dot PDF and not txt files

538
00:25:49,820 --> 00:25:55,100
on system and it damn did something to

539
00:25:52,549 --> 00:25:56,960
it and replaced them we did the same

540
00:25:55,100 --> 00:25:59,719
files for instance if it was a little

541
00:25:56,960 --> 00:26:02,359
<font color="#CCCCCC">touch a PDF file it will replace it</font><font color="#E5E5E5"> with</font>

542
00:25:59,720 --> 00:26:05,389
a file that was just with the same name

543
00:26:02,359 --> 00:26:08,178
and dot dot exe so it was probably

544
00:26:05,389 --> 00:26:11,889
infecting the files with itself and then

545
00:26:08,179 --> 00:26:11,889
it<font color="#E5E5E5"> doesn't</font><font color="#CCCCCC"> like what it was doing</font>

546
00:26:12,100 --> 00:26:17,299
looking further into<font color="#E5E5E5"> it we started to</font>

547
00:26:14,690 --> 00:26:19,989
see that it also<font color="#E5E5E5"> meant some men in the</font>

548
00:26:17,299 --> 00:26:23,149
browser capabilities it hoped the

549
00:26:19,989 --> 00:26:26,990
libraries of Internet Explorer Google

550
00:26:23,149 --> 00:26:30,129
Chrome Firefox in fact all teaches those

551
00:26:26,990 --> 00:26:32,770
two areas and<font color="#CCCCCC"> ser</font><font color="#E5E5E5"> trainers careful</font>

552
00:26:30,130 --> 00:26:36,520
and in internet explorer hooking

553
00:26:32,770 --> 00:26:38,950
function it had a hair this is memory

554
00:26:36,520 --> 00:26:41,320
structure it<font color="#CCCCCC"> is pretty useful because it</font>

555
00:26:38,950 --> 00:26:45,330
just shows the name of the functions

556
00:26:41,320 --> 00:26:48,070
that hooks and<font color="#E5E5E5"> underlying all of it the</font>

557
00:26:45,330 --> 00:26:50,350
the function let it replaces in it so it

558
00:26:48,070 --> 00:26:53,260
<font color="#CCCCCC">was pretty neat devotional exactly what</font>

559
00:26:50,350 --> 00:26:55,959
was being content replaced by what it's

560
00:26:53,260 --> 00:26:57,700
pretty easy to see<font color="#E5E5E5"> what it did if we</font>

561
00:26:55,960 --> 00:27:00,190
called edco<font color="#E5E5E5"> that didn't put it out</font><font color="#CCCCCC"> here</font>

562
00:26:57,700 --> 00:27:03,310
to just be too<font color="#CCCCCC"> much we something to</font>

563
00:27:00,190 --> 00:27:05,350
people<font color="#CCCCCC"> is capturing every post that the</font>

564
00:27:03,310 --> 00:27:08,710
browser it has<font color="#E5E5E5"> free HTTP POST and</font>

565
00:27:05,350 --> 00:27:11,620
sending it to<font color="#CCCCCC"> the government control so</font>

566
00:27:08,710 --> 00:27:14,290
it<font color="#E5E5E5"> was they didn't have a typical phone</font>

567
00:27:11,620 --> 00:27:17,800
from our to have configuration files

568
00:27:14,290 --> 00:27:19,480
that will show<font color="#CCCCCC"> some</font><font color="#E5E5E5"> targeted bangs and</font>

569
00:27:17,800 --> 00:27:21,460
it was<font color="#E5E5E5"> secure information for a specific</font>

570
00:27:19,480 --> 00:27:23,500
bank or something this was just

571
00:27:21,460 --> 00:27:26,830
capturing everything<font color="#E5E5E5"> if it's a post</font>

572
00:27:23,500 --> 00:27:31,170
<font color="#E5E5E5">request we wanted until send it all the</font>

573
00:27:26,830 --> 00:27:35,260
way to did the government controls so

574
00:27:31,170 --> 00:27:38,350
after this we<font color="#CCCCCC"> just walked through the</font>

575
00:27:35,260 --> 00:27:41,740
code and we<font color="#E5E5E5"> found the main rule after</font>

576
00:27:38,350 --> 00:27:43,540
each we can send to the government

577
00:27:41,740 --> 00:27:46,270
control code so every time intensive

578
00:27:43,540 --> 00:27:48,970
into the content control hood right when

579
00:27:46,270 --> 00:27:50,800
it receives the answer we did one of

580
00:27:48,970 --> 00:27:53,650
these<font color="#E5E5E5"> three things so it will take</font><font color="#CCCCCC"> a</font>

581
00:27:50,800 --> 00:27:55,780
screenshot or it would be<font color="#E5E5E5"> exact q 2</font>

582
00:27:53,650 --> 00:27:59,230
final or it would run<font color="#E5E5E5"> the season</font><font color="#CCCCCC"> 4</font>

583
00:27:55,780 --> 00:28:02,610
<font color="#CCCCCC">copies of</font><font color="#E5E5E5"> course these names we gave</font>

584
00:27:59,230 --> 00:28:05,890
their fees net the names are just<font color="#CCCCCC"> super</font>

585
00:28:02,610 --> 00:28:09,100
their names were just<font color="#CCCCCC"> with random</font>

586
00:28:05,890 --> 00:28:11,980
numbers that no it<font color="#CCCCCC"> was</font><font color="#E5E5E5"> it was a number</font>

587
00:28:09,100 --> 00:28:14,110
that<font color="#E5E5E5"> I don't usually use them and so it</font>

588
00:28:11,980 --> 00:28:16,630
didn't have any means we manually why

589
00:28:14,110 --> 00:28:20,649
would we reverse it given his full name

590
00:28:16,630 --> 00:28:22,060
so it was really easier to read so at

591
00:28:20,650 --> 00:28:25,510
this<font color="#E5E5E5"> point we knew pretty much what</font>

592
00:28:22,060 --> 00:28:28,179
about where did see we have fewer other

593
00:28:25,510 --> 00:28:31,950
answers we wanted so we wanted to<font color="#E5E5E5"> know</font>

594
00:28:28,180 --> 00:28:34,270
what the DGA was what it would buy and

595
00:28:31,950 --> 00:28:36,340
we wanted to<font color="#E5E5E5"> know what the network</font>

596
00:28:34,270 --> 00:28:39,610
protocol was and if we could extract

597
00:28:36,340 --> 00:28:43,030
information from it so we started work

598
00:28:39,610 --> 00:28:46,479
on discovering the UGA discover

599
00:28:43,030 --> 00:28:49,680
DGA the same kind<font color="#E5E5E5"> of method was was used</font>

600
00:28:46,480 --> 00:28:52,000
so we found a string<font color="#E5E5E5"> that we knew</font>

601
00:28:49,680 --> 00:28:54,550
actually not a string we<font color="#E5E5E5"> found that we</font>

602
00:28:52,000 --> 00:28:57,610
<font color="#CCCCCC">needed in connected using HTTP so you</font>

603
00:28:54,550 --> 00:29:00,580
looked for HTTP related libraries that

604
00:28:57,610 --> 00:29:02,979
made a request we found internet open

605
00:29:00,580 --> 00:29:06,070
<font color="#CCCCCC">and a few other related libraries and</font>

606
00:29:02,980 --> 00:29:08,920
<font color="#E5E5E5">meet them okay this is the function that</font>

607
00:29:06,070 --> 00:29:12,010
makes the request to<font color="#CCCCCC"> the sea do so we</font>

608
00:29:08,920 --> 00:29:15,700
just backed traced the actress the code

609
00:29:12,010 --> 00:29:18,490
and assembly until we found the DGA so

610
00:29:15,700 --> 00:29:21,640
if you make trace it using other

611
00:29:18,490 --> 00:29:24,340
<font color="#CCCCCC">products a way</font><font color="#E5E5E5"> to it has this feature</font>

612
00:29:21,640 --> 00:29:27,160
that creates<font color="#E5E5E5"> the culture that you can</font>

613
00:29:24,340 --> 00:29:29,379
see here so we were is we need internet

614
00:29:27,160 --> 00:29:32,890
the night loop well it<font color="#E5E5E5"> had that internet</font>

615
00:29:29,380 --> 00:29:34,840
open<font color="#E5E5E5"> so we just</font><font color="#CCCCCC"> asked it</font><font color="#E5E5E5"> to create a</font>

616
00:29:32,890 --> 00:29:38,470
chart of all the functions that would

617
00:29:34,840 --> 00:29:42,159
fit into it and he did and so we saw

618
00:29:38,470 --> 00:29:44,680
<font color="#CCCCCC">that which was felt by</font><font color="#E5E5E5"> post base the</font>

619
00:29:42,160 --> 00:29:46,900
screenshots is simple and they all went

620
00:29:44,680 --> 00:29:50,740
<font color="#CCCCCC">to this free this function that we</font>

621
00:29:46,900 --> 00:29:53,280
<font color="#CCCCCC">waiter</font><font color="#E5E5E5"> named prefer connection so most</font>

622
00:29:50,740 --> 00:29:56,080
likely their printer connection is

623
00:29:53,280 --> 00:29:58,300
getting the domain that will be used for

624
00:29:56,080 --> 00:30:01,899
the<font color="#E5E5E5"> party collection so that's where we</font>

625
00:29:58,300 --> 00:30:04,629
started looking<font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> eventually in</font><font color="#CCCCCC"> this</font>

626
00:30:01,900 --> 00:30:07,030
system<font color="#E5E5E5"> before its installed there you</font>

627
00:30:04,630 --> 00:30:08,470
can see<font color="#E5E5E5"> that will also initiate we saw</font>

628
00:30:07,030 --> 00:30:11,440
<font color="#CCCCCC">that there was a function being called</font>

629
00:30:08,470 --> 00:30:13,050
just before the prepared connection and

630
00:30:11,440 --> 00:30:17,710
you can see that<font color="#CCCCCC"> the</font><font color="#E5E5E5"> repair connection</font>

631
00:30:13,050 --> 00:30:20,760
receives the URL it's a big aiims are

632
00:30:17,710 --> 00:30:23,860
surfing it receives the HTTP method both

633
00:30:20,760 --> 00:30:25,629
receives the season Howe and it also

634
00:30:23,860 --> 00:30:27,969
needed to receive the demand it did

635
00:30:25,630 --> 00:30:31,210
because it was built on that<font color="#CCCCCC"> previous</font>

636
00:30:27,970 --> 00:30:36,370
call to the function gabon member we

637
00:30:31,210 --> 00:30:39,520
renamed the vga so started looking into

638
00:30:36,370 --> 00:30:42,489
that Rancher because not too complex but

639
00:30:39,520 --> 00:30:45,610
<font color="#E5E5E5">it helps something some it had several</font>

640
00:30:42,490 --> 00:30:48,850
<font color="#E5E5E5">sub functions usually there we have to</font>

641
00:30:45,610 --> 00:30:53,199
read it a slip just reverse it back into

642
00:30:48,850 --> 00:30:56,500
code and so what ensure here is that

643
00:30:53,200 --> 00:30:56,860
this last line shows you the best part

644
00:30:56,500 --> 00:30:59,830
of your

645
00:30:56,860 --> 00:31:04,240
where he decides if the top-level domain

646
00:30:59,830 --> 00:31:08,620
movie but info arc net or com and that

647
00:31:04,240 --> 00:31:11,380
section shows you again yeah and then

648
00:31:08,620 --> 00:31:13,030
section shows you hear<font color="#E5E5E5"> the an</font>

649
00:31:11,380 --> 00:31:15,240
initialization string that you choose

650
00:31:13,030 --> 00:31:18,250
and then it went through some

651
00:31:15,240 --> 00:31:21,070
mathematical operations<font color="#E5E5E5"> of younger to</font>

652
00:31:18,250 --> 00:31:23,049
create the string of the domain then I

653
00:31:21,070 --> 00:31:24,610
didn't put here<font color="#CCCCCC"> that there was a thought</font>

654
00:31:23,049 --> 00:31:28,030
skimmer that would connect these two

655
00:31:24,610 --> 00:31:31,918
parts so we<font color="#E5E5E5"> just reverse it and here was</font>

656
00:31:28,030 --> 00:31:35,500
the bundle is fighting for<font color="#E5E5E5"> it so this is</font>

657
00:31:31,919 --> 00:31:39,580
this part of its same algorithm between

658
00:31:35,500 --> 00:31:41,740
<font color="#CCCCCC">in vital</font><font color="#E5E5E5"> and this is this part so it has</font>

659
00:31:39,580 --> 00:31:43,480
this initialization string and it goes

660
00:31:41,740 --> 00:31:50,080
through some operation and it just

661
00:31:43,480 --> 00:31:55,150
generates the domain so at<font color="#E5E5E5"> this point we</font>

662
00:31:50,080 --> 00:31:59,290
had discovered the ETA and we could now

663
00:31:55,150 --> 00:32:02,020
edit for DJ database and we knew that it

664
00:31:59,290 --> 00:32:05,379
was technically<font color="#E5E5E5"> seated here is the whole</font>

665
00:32:02,020 --> 00:32:08,740
DJ go and if you work here this is

666
00:32:05,380 --> 00:32:10,059
already seen is included it was included

667
00:32:08,740 --> 00:32:12,010
in another section<font color="#E5E5E5"> of the code it's</font>

668
00:32:10,059 --> 00:32:15,730
actually<font color="#E5E5E5"> probably be</font><font color="#CCCCCC"> really hard to find</font>

669
00:32:12,010 --> 00:32:19,480
but it had evaluated it was on a global

670
00:32:15,730 --> 00:32:21,850
variable and the malware rather use this

671
00:32:19,480 --> 00:32:25,809
and you couldn't get in time change the

672
00:32:21,850 --> 00:32:28,418
seed<font color="#E5E5E5"> and the malware would just try to</font>

673
00:32:25,809 --> 00:32:29,860
<font color="#E5E5E5">connect to other domains another and</font>

674
00:32:28,419 --> 00:32:33,100
would generate a different set of the

675
00:32:29,860 --> 00:32:35,020
lines so<font color="#E5E5E5"> we knew that we could not win</font>

676
00:32:33,100 --> 00:32:37,780
we might not have coverage of the whole

677
00:32:35,020 --> 00:32:40,530
botnet and we might<font color="#E5E5E5"> just</font><font color="#CCCCCC"> be seeing one</font>

678
00:32:37,780 --> 00:32:43,210
seed of the botnet and maps hello

679
00:32:40,530 --> 00:32:45,280
however we started searching virus tone

680
00:32:43,210 --> 00:32:46,830
tone with getting<font color="#E5E5E5"> our hands on every</font>

681
00:32:45,280 --> 00:32:51,309
single that we could<font color="#E5E5E5"> get</font><font color="#CCCCCC"> that was</font>

682
00:32:46,830 --> 00:32:55,750
related<font color="#E5E5E5"> to to this malware and we didn't</font>

683
00:32:51,309 --> 00:33:01,270
<font color="#CCCCCC">see any sample that had a different see</font>

684
00:32:55,750 --> 00:33:04,240
so that was it unfortunately after some

685
00:33:01,270 --> 00:33:08,110
time there sometime after we start

686
00:33:04,240 --> 00:33:08,860
reversing it oh no<font color="#E5E5E5"> actually we start to</font>

687
00:33:08,110 --> 00:33:12,040
reversing it

688
00:33:08,860 --> 00:33:13,899
at some time after it was started so<font color="#E5E5E5"> the</font>

689
00:33:12,040 --> 00:33:15,850
<font color="#CCCCCC">Marvis</font><font color="#E5E5E5"> at the same time that we were</font>

690
00:33:13,900 --> 00:33:19,510
reversing it the other was making a

691
00:33:15,850 --> 00:33:21,610
change to<font color="#CCCCCC"> the to the DGA and it was it</font>

692
00:33:19,510 --> 00:33:25,629
was basically<font color="#E5E5E5"> saying that</font><font color="#CCCCCC"> the scenes</font>

693
00:33:21,610 --> 00:33:27,850
32-bit data based only<font color="#E5E5E5"> she started to be</font>

694
00:33:25,630 --> 00:33:29,950
used only as a fallback mechanism so

695
00:33:27,850 --> 00:33:33,699
mower started using hard coded IP

696
00:33:29,950 --> 00:33:34,900
addresses for c2 and only when those who

697
00:33:33,700 --> 00:33:37,059
are not reached because they had been

698
00:33:34,900 --> 00:33:40,750
<font color="#CCCCCC">taken down would the malware start to</font>

699
00:33:37,059 --> 00:33:44,440
use the g8 to try to regain connection

700
00:33:40,750 --> 00:33:46,900
to its dominant across so this was not

701
00:33:44,440 --> 00:33:49,000
good for<font color="#CCCCCC"> us because when the</font><font color="#E5E5E5"> DGA is our</font>

702
00:33:46,900 --> 00:33:51,309
fallback mechanism we could be<font color="#E5E5E5"> going</font>

703
00:33:49,000 --> 00:33:53,440
<font color="#E5E5E5">only see them for a while the malware</font>

704
00:33:51,309 --> 00:33:55,270
author regains control of the botnet and

705
00:33:53,440 --> 00:33:57,790
we<font color="#CCCCCC"> stopped seeing them for a while so</font>

706
00:33:55,270 --> 00:34:00,309
it's not good for<font color="#CCCCCC"> us but still we had an</font>

707
00:33:57,790 --> 00:34:03,309
idea<font color="#CCCCCC"> that we had covers of the whole</font>

708
00:34:00,309 --> 00:34:05,440
botnet at that time<font color="#E5E5E5"> cuz contrariwise</font>

709
00:34:03,309 --> 00:34:07,629
with its few thousand infections and

710
00:34:05,440 --> 00:34:09,850
those<font color="#E5E5E5"> infections started and staying</font>

711
00:34:07,630 --> 00:34:11,950
there so the malware writers<font color="#E5E5E5"> just</font>

712
00:34:09,850 --> 00:34:15,969
<font color="#E5E5E5">abandon them and they slowly decreased</font>

713
00:34:11,949 --> 00:34:18,158
over time so we have a vga it's just

714
00:34:15,969 --> 00:34:20,560
nice we knew what what mama did we knew

715
00:34:18,159 --> 00:34:22,869
how it was connecting to us we need<font color="#E5E5E5"> that</font>

716
00:34:20,560 --> 00:34:25,960
we had coverage of<font color="#E5E5E5"> their toll but had</font>

717
00:34:22,869 --> 00:34:28,960
death version at least and we needed to

718
00:34:25,960 --> 00:34:32,679
understand the network protocol so this

719
00:34:28,960 --> 00:34:37,810
is a this is image from Wireshark that

720
00:34:32,679 --> 00:34:40,600
shows the HTTP<font color="#E5E5E5"> request that was arriving</font>

721
00:34:37,810 --> 00:34:45,570
at our sinkholes southern plus is this<font color="#CCCCCC"> a</font>

722
00:34:40,600 --> 00:34:49,210
common post request that fact the

723
00:34:45,570 --> 00:34:51,580
<font color="#E5E5E5">Microsoft survey to significant</font>

724
00:34:49,210 --> 00:34:53,560
revocation list<font color="#E5E5E5"> that will request to</font>

725
00:34:51,580 --> 00:34:56,199
strange cutting / suppose to borrow the

726
00:34:53,560 --> 00:34:59,380
certificate request certification with

727
00:34:56,199 --> 00:35:01,810
strange<font color="#CCCCCC"> you can depth check header that</font>

728
00:34:59,380 --> 00:35:05,950
was strange and then the<font color="#E5E5E5"> post paid any</font>

729
00:35:01,810 --> 00:35:09,369
perceived we<font color="#E5E5E5"> routed so how would</font><font color="#CCCCCC"> we go</font>

730
00:35:05,950 --> 00:35:10,868
and try<font color="#E5E5E5"> to understand this well just</font>

731
00:35:09,369 --> 00:35:12,970
followed the same process because all

732
00:35:10,869 --> 00:35:16,960
the<font color="#CCCCCC"> streams</font><font color="#E5E5E5"> were acquitted so we started</font>

733
00:35:12,970 --> 00:35:19,390
looking for the<font color="#CCCCCC"> check</font><font color="#E5E5E5"> Heather the jet</font>

734
00:35:16,960 --> 00:35:22,900
stream remember and we<font color="#E5E5E5"> went we found it</font>

735
00:35:19,390 --> 00:35:25,690
being used here so we just

736
00:35:22,900 --> 00:35:29,680
choice to go and saw what it did and<font color="#E5E5E5"> if</font>

737
00:35:25,690 --> 00:35:32,650
you<font color="#E5E5E5"> look at you here there's this this</font>

738
00:35:29,680 --> 00:35:35,288
is a function that this and that<font color="#CCCCCC"> use</font>

739
00:35:32,650 --> 00:35:37,539
<font color="#E5E5E5">student basically a student copy and it</font>

740
00:35:35,289 --> 00:35:40,390
uses the check error and something that

741
00:35:37,539 --> 00:35:44,020
<font color="#E5E5E5">was encrypted before it so any chosen to</font>

742
00:35:40,390 --> 00:35:46,930
create<font color="#E5E5E5"> that part of the request so we</font>

743
00:35:44,020 --> 00:35:50,559
knew that it was what it was we did to

744
00:35:46,930 --> 00:35:53,589
know how it was built and to do that we

745
00:35:50,559 --> 00:35:57,579
saw just choice the gold a<font color="#E5E5E5"> little bit</font>

746
00:35:53,589 --> 00:36:00,220
pepper<font color="#E5E5E5"> and we found this this string was</font>

747
00:35:57,579 --> 00:36:02,200
also used it was most<font color="#E5E5E5"> likely the thing</font>

748
00:36:00,220 --> 00:36:04,930
that was used<font color="#E5E5E5"> to send to being sent for</font>

749
00:36:02,200 --> 00:36:08,379
to encrypt country and before it helped

750
00:36:04,930 --> 00:36:11,680
Islam so the check ever had a version

751
00:36:08,380 --> 00:36:15,130
client<font color="#E5E5E5"> from get her name yo ass groups</font>

752
00:36:11,680 --> 00:36:17,200
some to fresh start and less<font color="#CCCCCC"> sinta so</font>

753
00:36:15,130 --> 00:36:21,069
this was was what was english those

754
00:36:17,200 --> 00:36:23,558
check helps so okay it's<font color="#CCCCCC"> useful it would</font>

755
00:36:21,069 --> 00:36:26,380
<font color="#E5E5E5">be nice to get the</font><font color="#CCCCCC"> computer name is a</font>

756
00:36:23,559 --> 00:36:30,240
<font color="#E5E5E5">client and the group this group would</font>

757
00:36:26,380 --> 00:36:33,160
most likely beat the met the

758
00:36:30,240 --> 00:36:36,759
usually buckets for some of them are

759
00:36:33,160 --> 00:36:39,160
grouped<font color="#E5E5E5"> into logical groups so that the</font>

760
00:36:36,760 --> 00:36:42,190
bud masters can<font color="#CCCCCC"> whisk them</font><font color="#E5E5E5"> or keep track</font>

761
00:36:39,160 --> 00:36:44,020
of what our new<font color="#CCCCCC"> infection infection so</font>

762
00:36:42,190 --> 00:36:46,450
you to be nice<font color="#CCCCCC"> to see if the route</font>

763
00:36:44,020 --> 00:36:48,490
changes if we have several groups so we

764
00:36:46,450 --> 00:36:50,950
started to see if we could understand

765
00:36:48,490 --> 00:36:53,618
how the network protocol<font color="#E5E5E5"> was being</font>

766
00:36:50,950 --> 00:36:57,069
encrypted<font color="#CCCCCC"> and</font><font color="#E5E5E5"> the grid function don't</font>

767
00:36:53,619 --> 00:37:00,460
shot here we open it and it was scary it

768
00:36:57,069 --> 00:37:03,270
<font color="#CCCCCC">was enormous it</font><font color="#E5E5E5"> had lots of sub</font>

769
00:37:00,460 --> 00:37:06,640
functions and it's the name<font color="#CCCCCC"> of it was</font>

770
00:37:03,270 --> 00:37:09,460
had named in it so with<font color="#CCCCCC"> our symbol so it</font>

771
00:37:06,640 --> 00:37:11,529
was<font color="#CCCCCC"> just terrible and it would take</font>

772
00:37:09,460 --> 00:37:14,770
forever to try to reverse it line by

773
00:37:11,529 --> 00:37:17,710
line so what we did was we<font color="#E5E5E5"> use a</font>

774
00:37:14,770 --> 00:37:21,160
combination of static analysis dynamic

775
00:37:17,710 --> 00:37:26,039
analysis guess where it gets over it try

776
00:37:21,160 --> 00:37:28,149
whenever so first we try to identify

777
00:37:26,039 --> 00:37:32,319
each of the sub functions without

778
00:37:28,150 --> 00:37:34,900
actually reversing it to do<font color="#E5E5E5"> this who</font>

779
00:37:32,319 --> 00:37:36,310
knows how long it is but thanks we will

780
00:37:34,900 --> 00:37:38,920
scheme to dissemble

781
00:37:36,310 --> 00:37:41,259
you understand<font color="#CCCCCC"> how they would connect to</font>

782
00:37:38,920 --> 00:37:43,570
each other and then finally we would

783
00:37:41,260 --> 00:37:45,610
battle weekly NOS the malware with a

784
00:37:43,570 --> 00:37:47,290
debugger to try to understand the

785
00:37:45,610 --> 00:37:49,840
missing bits and to<font color="#CCCCCC"> verify the</font>

786
00:37:47,290 --> 00:37:53,770
exemptions that we would make we would

787
00:37:49,840 --> 00:37:55,180
make during the process so to understand

788
00:37:53,770 --> 00:37:59,110
what functions were caught without

789
00:37:55,180 --> 00:38:01,270
reversing it we used there are some

790
00:37:59,110 --> 00:38:03,130
<font color="#E5E5E5">tools that give us identify common</font>

791
00:38:01,270 --> 00:38:07,780
cryptographic routines and<font color="#CCCCCC"> we knew</font><font color="#E5E5E5"> this</font>

792
00:38:03,130 --> 00:38:12,850
<font color="#E5E5E5">pen to have some crypto in it so what we</font>

793
00:38:07,780 --> 00:38:15,430
did was<font color="#CCCCCC"> we ran the very hopeful as I</font>

794
00:38:12,850 --> 00:38:19,000
<font color="#CCCCCC">missile and I discover what it does it</font>

795
00:38:15,430 --> 00:38:21,069
just searches to the the binary code<font color="#E5E5E5"> and</font>

796
00:38:19,000 --> 00:38:23,440
it looks for magic numbers cryptographic

797
00:38:21,070 --> 00:38:25,900
magic numbers and lots of quadratic

798
00:38:23,440 --> 00:38:29,110
functions use them for instance<font color="#CCCCCC"> you saw</font>

799
00:38:25,900 --> 00:38:31,770
this Pentagon that was related<font color="#CCCCCC"> RC six</font><font color="#E5E5E5"> so</font>

800
00:38:29,110 --> 00:38:35,260
this one that was joined in too crc32

801
00:38:31,770 --> 00:38:38,200
<font color="#E5E5E5">although 75 magic numbers children the</font>

802
00:38:35,260 --> 00:38:40,060
nectar number generated so we needed in

803
00:38:38,200 --> 00:38:42,669
<font color="#CCCCCC">these dis</font><font color="#E5E5E5"> the functions that content</font>

804
00:38:40,060 --> 00:38:44,590
each of these magic numbers<font color="#CCCCCC"> well the</font>

805
00:38:42,670 --> 00:38:47,020
function at<font color="#E5E5E5"> Kentavious was amplified</font><font color="#CCCCCC"> for</font>

806
00:38:44,590 --> 00:38:50,350
the<font color="#CCCCCC"> Pegasus assertion 32 this was</font>

807
00:38:47,020 --> 00:38:52,660
actually sit so we already<font color="#E5E5E5"> knew some</font>

808
00:38:50,350 --> 00:38:56,830
things about it next we just needed to

809
00:38:52,660 --> 00:38:58,750
connect the<font color="#E5E5E5"> dots after that there were</font>

810
00:38:56,830 --> 00:39:01,259
still a few functions remaining that we

811
00:38:58,750 --> 00:39:04,330
didn't our what worth what they were and

812
00:39:01,260 --> 00:39:06,820
but looking at strings<font color="#E5E5E5"> we saw let it</font>

813
00:39:04,330 --> 00:39:10,620
have invented a version of<font color="#CCCCCC"> I</font><font color="#E5E5E5"> believe</font>

814
00:39:06,820 --> 00:39:13,300
this<font color="#E5E5E5"> is a library that used to pack</font>

815
00:39:10,620 --> 00:39:15,580
commonly used to pack malware tesam

816
00:39:13,300 --> 00:39:17,890
compressing function so the Maori was

817
00:39:15,580 --> 00:39:21,279
using this to compress part of the

818
00:39:17,890 --> 00:39:25,480
pillow so it will it be so large and so

819
00:39:21,280 --> 00:39:28,660
connecting the dots we solved it what

820
00:39:25,480 --> 00:39:32,670
day was it ran the pad function to pack

821
00:39:28,660 --> 00:39:37,210
the<font color="#CCCCCC"> peyote it then created the checks on</font>

822
00:39:32,670 --> 00:39:39,940
encrypted it in the encryption it<font color="#E5E5E5"> uses</font>

823
00:39:37,210 --> 00:39:46,780
the<font color="#E5E5E5"> term random number it used md5 a fun</font>

824
00:39:39,940 --> 00:39:50,010
bitches RC six so<font color="#E5E5E5"> I just threw it open</font>

825
00:39:46,780 --> 00:39:51,960
it and what it did was this species that

826
00:39:50,010 --> 00:39:54,870
goody that we got it<font color="#CCCCCC"> chooses the perfect</font>

827
00:39:51,960 --> 00:39:57,690
<font color="#CCCCCC">Xavier</font><font color="#E5E5E5"> and it uses this for both the</font>

828
00:39:54,870 --> 00:40:00,540
jackhammer are the post header<font color="#CCCCCC"> on status</font>

829
00:39:57,690 --> 00:40:02,730
which is the same seven function<font color="#E5E5E5"> to</font>

830
00:40:00,540 --> 00:40:05,910
ingredient three games the quickness

831
00:40:02,730 --> 00:40:08,430
very ones to send the fans in size he

832
00:40:05,910 --> 00:40:10,200
doesnt sit here to the searcher he packs

833
00:40:08,430 --> 00:40:13,049
it stunted and he<font color="#E5E5E5"> tears it</font><font color="#CCCCCC"> to the</font>

834
00:40:10,200 --> 00:40:15,779
structure out rate to check sir and adds

835
00:40:13,050 --> 00:40:19,170
to the<font color="#CCCCCC"> searcher then</font><font color="#E5E5E5"> it's increased this</font>

836
00:40:15,780 --> 00:40:21,830
using<font color="#E5E5E5"> RC six with a random key that was</font>

837
00:40:19,170 --> 00:40:26,430
generated to the remember generator and

838
00:40:21,830 --> 00:40:29,819
<font color="#E5E5E5">it chooses an md5 and his concatenates</font>

839
00:40:26,430 --> 00:40:32,549
this and defile her enemies and it

840
00:40:29,820 --> 00:40:35,280
improves it using a symmetric crypto

841
00:40:32,550 --> 00:40:39,240
geometrical part was the tough part

842
00:40:35,280 --> 00:40:41,400
because most asymmetry<font color="#E5E5E5"> will at least not</font>

843
00:40:39,240 --> 00:40:43,799
our essay or most common ones don't<font color="#E5E5E5"> use</font>

844
00:40:41,400 --> 00:40:46,920
magic numbers so we couldn't find any

845
00:40:43,800 --> 00:40:49,320
her<font color="#CCCCCC"> here so finally</font><font color="#E5E5E5"> we got</font><font color="#CCCCCC"> to the Bible</font>

846
00:40:46,920 --> 00:40:52,230
it<font color="#E5E5E5"> was depicted</font><font color="#CCCCCC"> bubble and again it had</font>

847
00:40:49,320 --> 00:40:54,930
the key and the<font color="#CCCCCC"> md5</font><font color="#E5E5E5"> unfortunately</font>

848
00:40:52,230 --> 00:40:57,030
because it was a symmetric<font color="#CCCCCC"> reto we could</font>

849
00:40:54,930 --> 00:40:59,549
get the<font color="#CCCCCC"> fumbling key not the private key</font>

850
00:40:57,030 --> 00:41:03,480
and so there was no<font color="#CCCCCC"> way we could decrypt</font>

851
00:40:59,550 --> 00:41:05,940
this it wasn't my sexercise but we would

852
00:41:03,480 --> 00:41:11,610
just COC random later arriving at<font color="#E5E5E5"> our</font>

853
00:41:05,940 --> 00:41:15,570
<font color="#E5E5E5">signals so just to finish up what we did</font>

854
00:41:11,610 --> 00:41:18,570
we found<font color="#E5E5E5"> a new one on DJ on the</font><font color="#CCCCCC"> internet</font>

855
00:41:15,570 --> 00:41:19,800
<font color="#CCCCCC">of the power our mechanism started</font>

856
00:41:18,570 --> 00:41:23,010
attacking what seemed to be a pattern

857
00:41:19,800 --> 00:41:25,770
what seemed to be in<font color="#CCCCCC"> vga so we see hold</font>

858
00:41:23,010 --> 00:41:29,760
it and started analyzing the traffic

859
00:41:25,770 --> 00:41:31,350
<font color="#E5E5E5">that came into it we will print try to</font>

860
00:41:29,760 --> 00:41:34,470
understand<font color="#CCCCCC"> what it was we couldn't find</font>

861
00:41:31,350 --> 00:41:36,720
it so<font color="#CCCCCC"> we created signatures and waited</font>

862
00:41:34,470 --> 00:41:39,180
for example and<font color="#E5E5E5"> we find we found</font><font color="#CCCCCC"> a</font>

863
00:41:36,720 --> 00:41:42,390
sample we just reversed it to understand

864
00:41:39,180 --> 00:41:44,129
what it<font color="#CCCCCC"> is what was the TGA the TGA part</font>

865
00:41:42,390 --> 00:41:47,040
is important for us because we need

866
00:41:44,130 --> 00:41:48,810
toilet for internal database<font color="#CCCCCC"> of TGS and</font>

867
00:41:47,040 --> 00:41:53,240
because we need to understand we have

868
00:41:48,810 --> 00:41:55,680
full coverage of the buttons and finally

869
00:41:53,240 --> 00:41:57,600
we need to go up we didn't need it but

870
00:41:55,680 --> 00:41:58,950
we<font color="#CCCCCC"> intend to understand the network</font>

871
00:41:57,600 --> 00:42:02,089
protocols to see if there are some

872
00:41:58,950 --> 00:42:04,339
useful information that we could extract

873
00:42:02,090 --> 00:42:08,369
so

874
00:42:04,339 --> 00:42:11,130
this is it of hope you found it

875
00:42:08,369 --> 00:42:13,549
entertaining at least to have any

876
00:42:11,130 --> 00:42:13,549
questions

