1
00:00:16,710 --> 00:00:22,360
hey friends as blessedly introduced by

2
00:00:20,080 --> 00:00:23,589
Mickey my name's Patrick we're gonna be

3
00:00:22,360 --> 00:00:25,060
talking about the bottom of the barrel

4
00:00:23,590 --> 00:00:26,980
which is scraping paste bin for

5
00:00:25,060 --> 00:00:28,599
obfuscated malware this is an

6
00:00:26,980 --> 00:00:29,830
open-source program they're gonna be

7
00:00:28,599 --> 00:00:32,080
talking about its name is fierce

8
00:00:29,830 --> 00:00:34,360
croissant you can check it out the

9
00:00:32,080 --> 00:00:37,269
source code there's gonna be released

10
00:00:34,360 --> 00:00:39,220
later so the plan introduction who the

11
00:00:37,270 --> 00:00:39,670
hell am i paste man what the hell is

12
00:00:39,220 --> 00:00:41,910
that

13
00:00:39,670 --> 00:00:44,230
first croissant why would you do this

14
00:00:41,910 --> 00:00:46,510
findings what sort of terrible things

15
00:00:44,230 --> 00:00:48,400
are out there on paste bin and stuff you

16
00:00:46,510 --> 00:00:51,640
can try with fierce croissant when you

17
00:00:48,400 --> 00:00:52,720
download it so me what do you know cor I

18
00:00:51,640 --> 00:00:55,150
love video games

19
00:00:52,720 --> 00:00:56,470
dancing musicals helping people you can

20
00:00:55,150 --> 00:00:58,390
see me dressed up for your Dickens fair

21
00:00:56,470 --> 00:00:59,760
and San Francisco come check it out

22
00:00:58,390 --> 00:01:02,589
pretend to be in Victorian London

23
00:00:59,760 --> 00:01:05,319
because honestly it's kind of less scary

24
00:01:02,589 --> 00:01:07,750
than now and the barrel that has paste

25
00:01:05,319 --> 00:01:10,149
bin so if you don't know paceman is a

26
00:01:07,750 --> 00:01:12,549
paste repository service tech sharing

27
00:01:10,150 --> 00:01:14,920
service basically and it was founded in

28
00:01:12,549 --> 00:01:18,280
2002 it allows you to store snippets of

29
00:01:14,920 --> 00:01:20,740
text or more commonly code the idea of a

30
00:01:18,280 --> 00:01:22,210
paste bin originated in the 90s when

31
00:01:20,740 --> 00:01:24,130
programmers were like I have this cool

32
00:01:22,210 --> 00:01:26,798
program can you help me check it out

33
00:01:24,130 --> 00:01:30,520
sure paste it in a bin and chat with me

34
00:01:26,799 --> 00:01:32,380
and that's what happens as of 2010 it

35
00:01:30,520 --> 00:01:33,880
reached 1 million pace but that was

36
00:01:32,380 --> 00:01:37,899
eight years ago it's got a lot more

37
00:01:33,880 --> 00:01:40,298
since then and as of 2014 it has one and

38
00:01:37,899 --> 00:01:42,429
a half million active user accounts with

39
00:01:40,299 --> 00:01:44,710
about 3 billion paste views like each

40
00:01:42,429 --> 00:01:47,350
paste was viewed not each paste is

41
00:01:44,710 --> 00:01:47,890
viewed when three billion times but you

42
00:01:47,350 --> 00:01:49,600
know what I mean

43
00:01:47,890 --> 00:01:51,399
one of the strengths of paceman is that

44
00:01:49,600 --> 00:01:53,199
you don't actually need a user account

45
00:01:51,399 --> 00:01:55,060
to paste anything and you can delete

46
00:01:53,200 --> 00:01:57,700
stuff if you want you can set it to

47
00:01:55,060 --> 00:02:00,340
delete it like 10 minutes an hour couple

48
00:01:57,700 --> 00:02:01,840
months from now and you like I said you

49
00:02:00,340 --> 00:02:04,299
don't need a user account you just post

50
00:02:01,840 --> 00:02:05,799
anonymously as a guest and for that

51
00:02:04,299 --> 00:02:07,299
reason there are lots of benign stuff

52
00:02:05,799 --> 00:02:07,929
that you may not want to attribute to

53
00:02:07,299 --> 00:02:11,200
yourself

54
00:02:07,929 --> 00:02:15,490
bad slash Vic you know your pokemon

55
00:02:11,200 --> 00:02:17,589
evolution strategies how to run you know

56
00:02:15,490 --> 00:02:20,110
speed run anything there are tons of

57
00:02:17,590 --> 00:02:22,569
benign uses for baseman it's a really

58
00:02:20,110 --> 00:02:25,180
popular service for that reason but

59
00:02:22,569 --> 00:02:26,799
there's a lot of terrible stuff one

60
00:02:25,180 --> 00:02:29,710
basement too

61
00:02:26,800 --> 00:02:31,870
this is deep web links how to access the

62
00:02:29,710 --> 00:02:33,520
dark web and you know download tor get

63
00:02:31,870 --> 00:02:36,550
your drugs on Silk Road isn't that

64
00:02:33,520 --> 00:02:41,620
awesome if you see up here it has about

65
00:02:36,550 --> 00:02:43,900
three million pages and so a lot of

66
00:02:41,620 --> 00:02:45,280
people have seen this there's definitely

67
00:02:43,900 --> 00:02:48,190
more nefarious stuff disinformation

68
00:02:45,280 --> 00:02:50,020
campaigns Clinton underground child sex

69
00:02:48,190 --> 00:02:52,600
scandal the pizza gate scandal that came

70
00:02:50,020 --> 00:02:55,300
out late 2016

71
00:02:52,600 --> 00:02:56,680
this is posted on pastebin it has three

72
00:02:55,300 --> 00:02:58,780
hundred fifty seven thousand views

73
00:02:56,680 --> 00:03:01,450
people totally thought there was an

74
00:02:58,780 --> 00:03:06,400
underground pedophile ring in tiny pizza

75
00:03:01,450 --> 00:03:10,989
restaurant in New Jersey opk up KKK

76
00:03:06,400 --> 00:03:13,270
hoods off 2015 D masking planners in you

77
00:03:10,990 --> 00:03:14,830
know the South although you know if it's

78
00:03:13,270 --> 00:03:16,810
a detox campaign

79
00:03:14,830 --> 00:03:21,970
who knows if those are actual Klansmen

80
00:03:16,810 --> 00:03:24,100
or not this is posted in 2015 it's

81
00:03:21,970 --> 00:03:27,580
probably got new views and there's stuff

82
00:03:24,100 --> 00:03:31,030
like this this is a dotnet framework

83
00:03:27,580 --> 00:03:33,940
assembly just running and evaluating

84
00:03:31,030 --> 00:03:37,290
this base64 string that starts like that

85
00:03:33,940 --> 00:03:39,820
I'm sure that's totally benign like I

86
00:03:37,290 --> 00:03:41,679
love to run an obfuscated code all the

87
00:03:39,820 --> 00:03:44,590
time

88
00:03:41,680 --> 00:03:46,780
more stuff here's PHP running similar

89
00:03:44,590 --> 00:03:48,910
stuff evaluate these base64 strings and

90
00:03:46,780 --> 00:03:52,750
then just do them what the is

91
00:03:48,910 --> 00:03:55,480
happening this is the beginnings of a

92
00:03:52,750 --> 00:03:57,970
project I got into when I started

93
00:03:55,480 --> 00:03:59,799
becoming part of the security analyst

94
00:03:57,970 --> 00:04:01,209
team I've been approached for a loan

95
00:03:59,800 --> 00:04:04,180
while as part of the customer service

96
00:04:01,209 --> 00:04:06,760
team and then in the October the winner

97
00:04:04,180 --> 00:04:08,709
of 2016 when I joined the team we had a

98
00:04:06,760 --> 00:04:11,920
company-wide hackathon and we read this

99
00:04:08,709 --> 00:04:13,780
blog by Securi saying websites backdoors

100
00:04:11,920 --> 00:04:16,209
leverage the baseband service in essence

101
00:04:13,780 --> 00:04:19,209
what happens is compromised websites use

102
00:04:16,209 --> 00:04:21,519
something like that executable to go and

103
00:04:19,209 --> 00:04:23,770
look for raw paste content on paste bin

104
00:04:21,519 --> 00:04:26,440
execute it and then do whatever the the

105
00:04:23,770 --> 00:04:27,969
program is because you know like our

106
00:04:26,440 --> 00:04:31,090
keynote speaker was talking about their

107
00:04:27,970 --> 00:04:33,700
malicious executables everywhere you can

108
00:04:31,090 --> 00:04:36,070
find them on paste bin - so this blog

109
00:04:33,700 --> 00:04:38,050
post sparked our interest you know what

110
00:04:36,070 --> 00:04:40,840
kind of malware can we find we

111
00:04:38,050 --> 00:04:42,849
malware protection company this is our

112
00:04:40,840 --> 00:04:45,128
dub it's a little hanging fruit let's go

113
00:04:42,849 --> 00:04:47,229
out and grab it what is there and what

114
00:04:45,129 --> 00:04:49,720
else is there besides malware that we

115
00:04:47,229 --> 00:04:51,909
can you know analyze because paceman is

116
00:04:49,720 --> 00:04:53,199
used for more than just strictly you

117
00:04:51,909 --> 00:04:54,840
know malicious stuff it sees for

118
00:04:53,199 --> 00:04:56,889
questionably malicious stuff to

119
00:04:54,840 --> 00:04:59,378
disinformation campaigns has talked

120
00:04:56,889 --> 00:05:00,520
about before data dumps security

121
00:04:59,379 --> 00:05:02,770
breaches

122
00:05:00,520 --> 00:05:04,448
you know you get I mean those are not

123
00:05:02,770 --> 00:05:06,789
questionably malicious but it's hard for

124
00:05:04,449 --> 00:05:09,159
an automated intelligence or an

125
00:05:06,789 --> 00:05:11,409
automated program at all to just analyze

126
00:05:09,159 --> 00:05:13,479
it you need some brains looking at it so

127
00:05:11,409 --> 00:05:15,819
this is the start of fiesta croissant

128
00:05:13,479 --> 00:05:18,460
which is a scrappy little open-source

129
00:05:15,819 --> 00:05:20,860
kai thon scraper and there are three

130
00:05:18,460 --> 00:05:23,080
steps we use to block bad stuff on paste

131
00:05:20,860 --> 00:05:25,270
bin the first two are what fierce

132
00:05:23,080 --> 00:05:29,650
pissant will help you do the third step

133
00:05:25,270 --> 00:05:32,049
is up to you so first step Python super

134
00:05:29,650 --> 00:05:33,520
easy for a non-coding guy like me my

135
00:05:32,050 --> 00:05:36,550
degree is in English literature I

136
00:05:33,520 --> 00:05:39,039
rounded wound and this job because I

137
00:05:36,550 --> 00:05:41,500
like helping people and we're looking

138
00:05:39,039 --> 00:05:43,449
for non-human patterns regex is really

139
00:05:41,500 --> 00:05:43,810
good for this fierce Besant's a little

140
00:05:43,449 --> 00:05:46,270
greedy

141
00:05:43,810 --> 00:05:48,069
it'll just grab 200 characters in a row

142
00:05:46,270 --> 00:05:51,068
and that's the start of where it looks

143
00:05:48,069 --> 00:05:54,009
so you grab a lot of stuff like links to

144
00:05:51,069 --> 00:05:55,659
various fishing sites or YouTube

145
00:05:54,009 --> 00:05:57,759
channels where you can view pay-per-view

146
00:05:55,659 --> 00:06:01,659
stuff or you know slash fake where as

147
00:05:57,759 --> 00:06:05,050
people are screaming like let's do

148
00:06:01,659 --> 00:06:06,639
hundred characters part two is the

149
00:06:05,050 --> 00:06:09,849
coding commonly used obfuscation

150
00:06:06,639 --> 00:06:13,479
techniques to to find what those actual

151
00:06:09,849 --> 00:06:16,810
malware bits are common malware common

152
00:06:13,479 --> 00:06:19,120
obfuscation techniques base64 hex binary

153
00:06:16,810 --> 00:06:20,529
ASCII those are pretty much the the ones

154
00:06:19,120 --> 00:06:22,810
we find in to you but we were on into

155
00:06:20,529 --> 00:06:25,599
wrappers a lot and then step three is

156
00:06:22,810 --> 00:06:26,860
where you come in you've got your d op

157
00:06:25,599 --> 00:06:29,979
you skated malware you can do whatever

158
00:06:26,860 --> 00:06:31,690
you want with it at cisco umbrella we

159
00:06:29,979 --> 00:06:34,060
throw it into threat grid because that's

160
00:06:31,690 --> 00:06:36,610
what cisco has its proprietary for stuff

161
00:06:34,060 --> 00:06:40,300
for us we take out the dns information

162
00:06:36,610 --> 00:06:42,759
but you could totally use virustotal joe

163
00:06:40,300 --> 00:06:45,580
sandbox any sort of open source or

164
00:06:42,759 --> 00:06:47,529
proprietary stuff you have and your own

165
00:06:45,580 --> 00:06:49,630
work your own you know whatever you're

166
00:06:47,529 --> 00:06:50,969
developing on your own to find out what

167
00:06:49,630 --> 00:06:54,390
this malware does

168
00:06:50,970 --> 00:06:57,660
so step on scraped them in this is

169
00:06:54,390 --> 00:07:00,120
Python uses HTTP request so it's a cool

170
00:06:57,660 --> 00:07:04,200
library for accessing pretty much

171
00:07:00,120 --> 00:07:07,500
anything on the Internet go Python and

172
00:07:04,200 --> 00:07:11,010
this is the core of what it scripts for

173
00:07:07,500 --> 00:07:13,590
we grab various things about the paste

174
00:07:11,010 --> 00:07:15,210
check to see if it's untyped because

175
00:07:13,590 --> 00:07:16,950
malware authors are lazy and won't tell

176
00:07:15,210 --> 00:07:20,580
you if they're writing in PHP or Java or

177
00:07:16,950 --> 00:07:24,240
C++ whatever grab everything from

178
00:07:20,580 --> 00:07:24,780
baseman and check out its size like how

179
00:07:24,240 --> 00:07:26,940
big is it

180
00:07:24,780 --> 00:07:28,289
this is kind of one of the failings of

181
00:07:26,940 --> 00:07:29,640
first croissant which I'll get into we

182
00:07:28,290 --> 00:07:31,620
look for something over a certain size

183
00:07:29,640 --> 00:07:35,669
if it's under that will just miss it

184
00:07:31,620 --> 00:07:37,470
need to change that but you can - here's

185
00:07:35,670 --> 00:07:39,690
where I mentioned we just look for 200

186
00:07:37,470 --> 00:07:41,610
characters in Ralph that's not a human

187
00:07:39,690 --> 00:07:43,770
string you know humans weren't meant to

188
00:07:41,610 --> 00:07:46,350
read characters or words and then are

189
00:07:43,770 --> 00:07:47,940
200 characters long but computers are

190
00:07:46,350 --> 00:07:50,310
really good at that so let's find out

191
00:07:47,940 --> 00:07:52,230
what they're finding out here's the

192
00:07:50,310 --> 00:07:56,100
start of the magic sauce

193
00:07:52,230 --> 00:08:01,470
if a base64 encoded structure starts

194
00:07:56,100 --> 00:08:05,669
with TV and then OAP be p q QQ q aro and

195
00:08:01,470 --> 00:08:09,090
PA it's a base it's a 1 it will decode

196
00:08:05,669 --> 00:08:11,789
into is an ms-dos executable the start

197
00:08:09,090 --> 00:08:13,979
of base64 as it starts like that will

198
00:08:11,790 --> 00:08:16,380
always always always decode into and i'm

199
00:08:13,980 --> 00:08:17,820
a stock's executable and we reverse that

200
00:08:16,380 --> 00:08:19,440
search because malware authors are lazy

201
00:08:17,820 --> 00:08:21,570
sometimes i will take their program

202
00:08:19,440 --> 00:08:25,260
literally just reverse it and then put

203
00:08:21,570 --> 00:08:27,480
it up on base pin to binary matching

204
00:08:25,260 --> 00:08:30,120
just looking for ones and zeros 200 of

205
00:08:27,480 --> 00:08:32,760
them in a row and then hex matching

206
00:08:30,120 --> 00:08:34,289
because people will put things on paste

207
00:08:32,760 --> 00:08:37,559
bin that are malicious in hex format

208
00:08:34,289 --> 00:08:41,280
either straight hex or encoded as raw

209
00:08:37,559 --> 00:08:43,380
bytes and then part of what we found led

210
00:08:41,280 --> 00:08:44,939
us to these next three things PHP

211
00:08:43,380 --> 00:08:47,550
matching looking for anything that

212
00:08:44,940 --> 00:08:50,100
starts with PHP declaration image

213
00:08:47,550 --> 00:08:52,410
matching because despite paceman only

214
00:08:50,100 --> 00:08:55,200
being four texts people have managed to

215
00:08:52,410 --> 00:08:57,110
put images on there through encoding and

216
00:08:55,200 --> 00:08:59,279
then ASCII matching

217
00:08:57,110 --> 00:09:02,850
looking for anything that encodes with

218
00:08:59,279 --> 00:09:04,740
ASCII values step to you decoding it all

219
00:09:02,850 --> 00:09:06,959
these decoders come with paste bin or

220
00:09:04,740 --> 00:09:08,579
come with fares croissant and they use

221
00:09:06,959 --> 00:09:08,910
native libraries to Python because it's

222
00:09:08,579 --> 00:09:14,430
easy

223
00:09:08,910 --> 00:09:22,380
this is hex just 22 lines of code they

224
00:09:14,430 --> 00:09:24,839
ASCII 23 binary 24 base64 25 easy and so

225
00:09:22,380 --> 00:09:28,529
we check out what we've got we grab that

226
00:09:24,839 --> 00:09:31,589
base64 we throw it into a decoder I

227
00:09:28,529 --> 00:09:33,389
can't read assembly thank you and we

228
00:09:31,589 --> 00:09:35,339
find out that this program cannot be run

229
00:09:33,389 --> 00:09:36,649
in DOS mode it has to be run at the

230
00:09:35,339 --> 00:09:39,570
command line

231
00:09:36,649 --> 00:09:43,519
so for our purposes we run the malware

232
00:09:39,570 --> 00:09:46,769
this is a threat grid we're looking for

233
00:09:43,519 --> 00:09:49,139
declarations from threat grid to tell us

234
00:09:46,769 --> 00:09:51,089
what this is and like I said you can use

235
00:09:49,139 --> 00:09:52,709
your own open source intelligences Joe

236
00:09:51,089 --> 00:09:55,110
sandbox has something similar virustotal

237
00:09:52,709 --> 00:09:58,529
will tell you like hey 50 people flag

238
00:09:55,110 --> 00:10:00,959
this is malware in our case we found

239
00:09:58,529 --> 00:10:03,930
blotted bindi which is a Trojan being

240
00:10:00,959 --> 00:10:06,899
hosted on a sprin and importantly for

241
00:10:03,930 --> 00:10:09,599
our case we check out the DNS

242
00:10:06,899 --> 00:10:13,079
information it found out krypter stop

243
00:10:09,600 --> 00:10:15,779
dude org which is a D DNS domain because

244
00:10:13,079 --> 00:10:18,300
well similar to why you would want to

245
00:10:15,779 --> 00:10:20,850
host on pastebin to begin with hosting

246
00:10:18,300 --> 00:10:22,949
malware on DDS domains is easy you

247
00:10:20,850 --> 00:10:25,110
typically don't have to really pay for

248
00:10:22,949 --> 00:10:27,300
infrastructure all that much you can't

249
00:10:25,110 --> 00:10:29,310
be blocked by a list records if your IP

250
00:10:27,300 --> 00:10:32,189
address changes all the time

251
00:10:29,310 --> 00:10:34,229
and if anyone finds it out you're one of

252
00:10:32,190 --> 00:10:36,300
thousands tens of thousands hundreds of

253
00:10:34,230 --> 00:10:39,420
thousands on domains on the same like

254
00:10:36,300 --> 00:10:40,740
under the same structure what is anyone

255
00:10:39,420 --> 00:10:43,229
going to do to you no one's gonna call

256
00:10:40,740 --> 00:10:45,560
the internet police on you so

257
00:10:43,230 --> 00:10:48,870
interesting finding is that you found

258
00:10:45,560 --> 00:10:53,189
has found fifty seven thousand pastes

259
00:10:48,870 --> 00:10:55,620
since May 20 2017 and we found about two

260
00:10:53,190 --> 00:10:58,279
thousand two hundred domains worth of

261
00:10:55,620 --> 00:11:02,069
that a lot of the malware seems to be

262
00:10:58,279 --> 00:11:03,569
sandbox aware and so it'll get false

263
00:11:02,069 --> 00:11:05,819
responses like it's just checking

264
00:11:03,569 --> 00:11:07,529
Internet connectivity making sure I can

265
00:11:05,819 --> 00:11:10,170
you know get out to Google or Facebook

266
00:11:07,529 --> 00:11:12,810
or whatever but almost half of

267
00:11:10,170 --> 00:11:17,839
malicious domains that we've found are

268
00:11:12,810 --> 00:11:21,839
ddns domains DNS org dine org Haupt org

269
00:11:17,839 --> 00:11:24,360
whatever this allows actors to just host

270
00:11:21,839 --> 00:11:26,130
stuff and not care about it what I've

271
00:11:24,360 --> 00:11:27,750
learned in my time as a security analyst

272
00:11:26,130 --> 00:11:32,010
is that a lot of malware authors are

273
00:11:27,750 --> 00:11:33,870
very lazy phishing is a low cost high

274
00:11:32,010 --> 00:11:36,329
payoff kind of attack because even if

275
00:11:33,870 --> 00:11:38,519
you only get two or three people to bite

276
00:11:36,329 --> 00:11:40,709
on the hook like if you've made your

277
00:11:38,519 --> 00:11:42,269
money back right you can spend 100 bucks

278
00:11:40,709 --> 00:11:44,699
to send out a bunch of phishing emails

279
00:11:42,269 --> 00:11:46,320
to tens of thousands of people you get

280
00:11:44,699 --> 00:11:47,609
banking information for one of them and

281
00:11:46,320 --> 00:11:48,959
they have a hundred and one dollars in

282
00:11:47,610 --> 00:11:52,380
their account great you've turned a

283
00:11:48,959 --> 00:11:55,768
profit malware tends to come as either

284
00:11:52,380 --> 00:11:57,899
straight binary or base64 or wrapped in

285
00:11:55,769 --> 00:12:03,300
some other language I've seen Visual

286
00:11:57,899 --> 00:12:06,300
Basic I've seen php.net etc people will

287
00:12:03,300 --> 00:12:08,130
also tend to go an extra distance when

288
00:12:06,300 --> 00:12:11,370
obfuscating their base64 for whatever

289
00:12:08,130 --> 00:12:13,320
reason talk about that and there's a lot

290
00:12:11,370 --> 00:12:16,769
of stuff on paceman that surprised me

291
00:12:13,320 --> 00:12:21,089
see 99 shells back door kits defacement

292
00:12:16,769 --> 00:12:24,540
kits phishing images may be hard to say

293
00:12:21,089 --> 00:12:26,250
and a lot of well a lot of gibberish - I

294
00:12:24,540 --> 00:12:28,199
pick up so many pay-per-view channels

295
00:12:26,250 --> 00:12:31,050
I'm really sick of it especially in

296
00:12:28,199 --> 00:12:32,969
Portuguese I don't understand oh and

297
00:12:31,050 --> 00:12:34,979
Filipino there's a large Indonesian

298
00:12:32,970 --> 00:12:37,019
company that are there's a large

299
00:12:34,980 --> 00:12:39,899
Indonesian community that uses pastebin

300
00:12:37,019 --> 00:12:42,899
for various stuff so example it's clear

301
00:12:39,899 --> 00:12:46,170
base64 I check that out who wouldn't

302
00:12:42,899 --> 00:12:48,449
wanna run that rapped 64 this is a

303
00:12:46,170 --> 00:12:50,370
visual basic just dim this string and

304
00:12:48,449 --> 00:12:54,029
then run it

305
00:12:50,370 --> 00:12:55,529
here's that obfuscated base64 I was

306
00:12:54,029 --> 00:12:57,870
talking about they just substituted

307
00:12:55,529 --> 00:13:01,439
capital a for this I believe it's a

308
00:12:57,870 --> 00:13:05,910
Chinese character reverse base64 because

309
00:13:01,440 --> 00:13:06,240
malware authors are lazy binary what do

310
00:13:05,910 --> 00:13:11,010
you want

311
00:13:06,240 --> 00:13:16,319
it's ones and zeroes similar to base64

312
00:13:11,010 --> 00:13:19,829
if it starts with 77 91 44 0 3 0 they'll

313
00:13:16,319 --> 00:13:21,660
decode in terment ms-dos executable now

314
00:13:19,829 --> 00:13:23,849
some more interesting findings it's

315
00:13:21,660 --> 00:13:25,860
weird to me that malware authors would

316
00:13:23,850 --> 00:13:29,310
actually use their own accounts to host

317
00:13:25,860 --> 00:13:31,230
things but they do and you'll see you

318
00:13:29,310 --> 00:13:33,268
like these untitled things that have

319
00:13:31,230 --> 00:13:34,889
been hit like several thousand times

320
00:13:33,269 --> 00:13:37,920
because this compromised website has

321
00:13:34,889 --> 00:13:41,370
been on for a long time and more

322
00:13:37,920 --> 00:13:44,069
examples of check you know all my base64

323
00:13:41,370 --> 00:13:47,190
all my binary more stuff to decode and

324
00:13:44,069 --> 00:13:49,380
find out where it goes see 99 shells are

325
00:13:47,190 --> 00:13:51,660
hosted on pastebin a lot which I found

326
00:13:49,380 --> 00:13:54,720
very interesting if you don't know

327
00:13:51,660 --> 00:13:57,959
shells are an interface for malicious

328
00:13:54,720 --> 00:14:00,350
actors to use their server that they've

329
00:13:57,959 --> 00:14:03,540
got without having to use a command line

330
00:14:00,350 --> 00:14:04,740
stuff like this is very ugly but they

331
00:14:03,540 --> 00:14:06,899
can have a shell like this which gives

332
00:14:04,740 --> 00:14:08,730
them access to poke around the server

333
00:14:06,899 --> 00:14:11,639
they can read all the files they can

334
00:14:08,730 --> 00:14:13,800
grab files from the server see what's on

335
00:14:11,639 --> 00:14:15,569
there make files available delete them

336
00:14:13,800 --> 00:14:18,000
what have you

337
00:14:15,569 --> 00:14:19,649
other cool examples phishing images I

338
00:14:18,000 --> 00:14:21,509
mentioned that images are hosted on

339
00:14:19,649 --> 00:14:23,759
paceman because browsers are so smart

340
00:14:21,509 --> 00:14:26,519
that they can take base64 encoded stuff

341
00:14:23,759 --> 00:14:27,690
and translate it for us because we love

342
00:14:26,519 --> 00:14:29,610
computers and we want to make them

343
00:14:27,690 --> 00:14:31,980
easier for us so if you start with data

344
00:14:29,610 --> 00:14:34,649
: image and then a slash and then the

345
00:14:31,980 --> 00:14:36,930
image type if paying JPEG whatever and

346
00:14:34,649 --> 00:14:40,290
then tell it the encoding structure in

347
00:14:36,930 --> 00:14:42,689
our case base64 your browser will turn

348
00:14:40,290 --> 00:14:45,329
that into pramada bank or at least this

349
00:14:42,689 --> 00:14:46,889
image pramana Bank probably don't know

350
00:14:45,329 --> 00:14:50,670
eighth largest bank in Indonesia

351
00:14:46,889 --> 00:14:52,050
transparent backgrounds I can I'm really

352
00:14:50,670 --> 00:14:54,779
confident that's used in a phishing

353
00:14:52,050 --> 00:14:59,699
email somewhere or a phishing website

354
00:14:54,779 --> 00:15:01,110
you can just paste your you're sorry

355
00:14:59,699 --> 00:15:03,180
you're compromised website can just

356
00:15:01,110 --> 00:15:04,680
reference back to the raw value of this

357
00:15:03,180 --> 00:15:08,310
paste and suddenly you've got this image

358
00:15:04,680 --> 00:15:12,029
here other phishing examples well we've

359
00:15:08,310 --> 00:15:14,550
got this image Google cool you just want

360
00:15:12,029 --> 00:15:16,259
to you know fish people a Gmail and

361
00:15:14,550 --> 00:15:18,839
maybe some hidden information too

362
00:15:16,259 --> 00:15:21,329
one of the coolest examples I came up

363
00:15:18,839 --> 00:15:23,370
with is this which doesn't look like

364
00:15:21,329 --> 00:15:25,410
anything to human eyes but similar to

365
00:15:23,370 --> 00:15:26,550
encoding structures this might be

366
00:15:25,410 --> 00:15:29,660
steganographic

367
00:15:26,550 --> 00:15:31,949
hidden steganography hidden information

368
00:15:29,660 --> 00:15:34,519
computers can see a pattern in this if

369
00:15:31,949 --> 00:15:36,920
you can run it through a stego library

370
00:15:34,519 --> 00:15:38,720
bonus that has recently been coming up

371
00:15:36,920 --> 00:15:40,759
and is a talk tomorrow which I encourage

372
00:15:38,720 --> 00:15:44,179
you to go to people put PowerShell

373
00:15:40,759 --> 00:15:46,009
executions on paste bin check out that

374
00:15:44,179 --> 00:15:50,419
talk tomorrow because there's a bunch of

375
00:15:46,009 --> 00:15:51,499
people there so yeah last part of my

376
00:15:50,419 --> 00:15:53,239
talk that I want to talk about is

377
00:15:51,499 --> 00:15:55,879
changes you can make on Pharos on

378
00:15:53,239 --> 00:15:57,829
yourself one of the earliest iterations

379
00:15:55,879 --> 00:15:59,689
of course on used keywords to search for

380
00:15:57,829 --> 00:16:01,519
and if your company's in the financial

381
00:15:59,689 --> 00:16:05,029
sector this is probably a good idea you

382
00:16:01,519 --> 00:16:07,819
can search for SSID data dumps logins

383
00:16:05,029 --> 00:16:09,499
you know people post all sorts of stuff

384
00:16:07,819 --> 00:16:12,559
on paste bin that they didn't get

385
00:16:09,499 --> 00:16:15,199
legitimately and you probably want to

386
00:16:12,559 --> 00:16:17,629
know about you can change the alerting

387
00:16:15,199 --> 00:16:20,599
system by default fierce croissant uses

388
00:16:17,629 --> 00:16:22,040
HipChat as its messaging system because

389
00:16:20,600 --> 00:16:23,839
that's what we used at work at the time

390
00:16:22,040 --> 00:16:24,498
but you could totally adapt it for

391
00:16:23,839 --> 00:16:26,929
anything else

392
00:16:24,499 --> 00:16:30,109
email Python has pretty good email

393
00:16:26,929 --> 00:16:31,608
libraries natively SMS to do Twilio

394
00:16:30,109 --> 00:16:34,699
they're out there they probably want to

395
00:16:31,609 --> 00:16:37,519
talk to you slack and everyone uses

396
00:16:34,699 --> 00:16:41,118
slack you can scrape for particular

397
00:16:37,519 --> 00:16:43,339
users as I mentioned you know some

398
00:16:41,119 --> 00:16:45,679
malware authors will just keep posting

399
00:16:43,339 --> 00:16:49,129
stuff on their own account in one

400
00:16:45,679 --> 00:16:51,829
notable case there is a user called like

401
00:16:49,129 --> 00:16:54,829
master blazer or something inane like

402
00:16:51,829 --> 00:16:56,868
that who hosts a bunch of crypto mining

403
00:16:54,829 --> 00:16:58,758
stuff on his Facebook account and then

404
00:16:56,869 --> 00:17:01,040
deletes them so I'm particularly

405
00:16:58,759 --> 00:17:04,610
interested in him and one of my variants

406
00:17:01,040 --> 00:17:06,019
of this scrapes for just him and you can

407
00:17:04,609 --> 00:17:06,559
change the size of the pace that you

408
00:17:06,019 --> 00:17:09,470
look for

409
00:17:06,559 --> 00:17:12,559
like I said Facebook looks for anything

410
00:17:09,470 --> 00:17:14,360
about 40k but there's a rat that run has

411
00:17:12,559 --> 00:17:15,470
been thrown up a lot on pastebin

412
00:17:14,359 --> 00:17:17,898
recently

413
00:17:15,470 --> 00:17:19,490
that's like 31 point 12 K and it's

414
00:17:17,898 --> 00:17:24,948
annoying because I haven't fixed fc2

415
00:17:19,490 --> 00:17:27,859
Sartori yet so that's about it actually

416
00:17:24,949 --> 00:17:30,860
um any questions

417
00:17:27,859 --> 00:17:37,959
you know sometimes 20 10 minutes 11

418
00:17:30,860 --> 00:17:37,959
minutes go yes

419
00:17:42,669 --> 00:17:48,669
so c99 shells are just like via shells

420
00:17:45,940 --> 00:17:52,660
that back to our users who've

421
00:17:48,669 --> 00:17:54,610
compromised the server will have so that

422
00:17:52,660 --> 00:17:57,400
people who don't want to rummage around

423
00:17:54,610 --> 00:18:01,299
in a shell system that they don't know

424
00:17:57,400 --> 00:18:02,290
or rather a command-line interface they

425
00:18:01,299 --> 00:18:05,520
don't know

426
00:18:02,290 --> 00:18:08,440
can still impact the server plenty of

427
00:18:05,520 --> 00:18:10,418
low-grade malicious actors are just

428
00:18:08,440 --> 00:18:12,760
clicking on interfaces like this to make

429
00:18:10,419 --> 00:18:14,919
changes without having to know how does

430
00:18:12,760 --> 00:18:17,049
the UNIX file system work like how do I

431
00:18:14,919 --> 00:18:20,440
make dear how do I delete stuff how do I

432
00:18:17,049 --> 00:18:22,720
am yeah script kiddies for sure

433
00:18:20,440 --> 00:18:25,660
and this goes online with like fishing

434
00:18:22,720 --> 00:18:27,760
kits and rootkits and botnets being like

435
00:18:25,660 --> 00:18:30,760
low-cost you can rent these services out

436
00:18:27,760 --> 00:18:33,100
to people so you know I don't want to

437
00:18:30,760 --> 00:18:34,870
learn how to RM dash RF my entire

438
00:18:33,100 --> 00:18:37,780
directory it'll teach someone how to do

439
00:18:34,870 --> 00:18:39,820
it through this shell stuff like that

440
00:18:37,780 --> 00:18:42,668
one of the things I should mention that

441
00:18:39,820 --> 00:18:45,189
I want to improve on for Hassan second

442
00:18:42,669 --> 00:18:50,400
edition is the ability to report itself

443
00:18:45,190 --> 00:18:52,360
and to do uploads into specified

444
00:18:50,400 --> 00:18:54,910
sandboxes so if you've got just a

445
00:18:52,360 --> 00:18:56,080
sandbox account you can have FC just

446
00:18:54,910 --> 00:18:58,330
automatically upload it and then

447
00:18:56,080 --> 00:18:59,830
download the reports virustotal

448
00:18:58,330 --> 00:19:03,370
direct grade if you have access to it

449
00:18:59,830 --> 00:19:11,530
that sort of thing good question other

450
00:19:03,370 --> 00:19:13,678
questions yes fierce passant natively

451
00:19:11,530 --> 00:19:17,530
grabs all of the mated metadata about

452
00:19:13,679 --> 00:19:19,780
paste so it will grab the size the user

453
00:19:17,530 --> 00:19:22,629
the contents of the paste if it has an

454
00:19:19,780 --> 00:19:25,270
expiration date and then it includes

455
00:19:22,630 --> 00:19:27,820
based off of what we have seen its own

456
00:19:25,270 --> 00:19:30,179
defined value called an encoding type

457
00:19:27,820 --> 00:19:34,000
which we're like is this ascii hex

458
00:19:30,179 --> 00:19:36,700
base64 is it an image is at PHP or is it

459
00:19:34,000 --> 00:19:37,809
something some gibberish that human mind

460
00:19:36,700 --> 00:19:41,020
has to look at later

461
00:19:37,809 --> 00:19:44,490
so natively it will grab it and also

462
00:19:41,020 --> 00:19:47,620
uses by default Mongo as its database so

463
00:19:44,490 --> 00:19:48,940
because it's easy and really doesn't

464
00:19:47,620 --> 00:19:49,389
care what you throw into it it's just

465
00:19:48,940 --> 00:19:51,789
like yeah

466
00:19:49,389 --> 00:19:54,178
I'll take it as long as it's the same

467
00:19:51,789 --> 00:19:57,849
structure so yeah we we do grab all the

468
00:19:54,179 --> 00:19:59,079
metadata about a paste and if you play

469
00:19:57,849 --> 00:20:01,109
around with it later and you grab a

470
00:19:59,079 --> 00:20:04,149
paste that has an expediter expiry

471
00:20:01,109 --> 00:20:07,239
expiry of zero and it means it's never

472
00:20:04,149 --> 00:20:09,488
set to dumb to delete but expiration

473
00:20:07,239 --> 00:20:12,700
dates are also set in epoch time so when

474
00:20:09,489 --> 00:20:17,399
one thing I'd one thing a user did when

475
00:20:12,700 --> 00:20:19,809
I was teaching this at an in conference

476
00:20:17,399 --> 00:20:23,049
talking about scraping paste bin for

477
00:20:19,809 --> 00:20:26,859
obviously it's tough is he took the X X

478
00:20:23,049 --> 00:20:30,279
prime value minus the current time to

479
00:20:26,859 --> 00:20:32,109
check if pastes were set to delete so

480
00:20:30,279 --> 00:20:35,639
that he could like save them in a

481
00:20:32,109 --> 00:20:35,639
special place to go over them later

482
00:20:50,030 --> 00:20:54,750
unfortunately Pistons reporting function

483
00:20:52,710 --> 00:20:57,270
is on the web interface you can't do it

484
00:20:54,750 --> 00:20:59,670
through an API or any call I would be

485
00:20:57,270 --> 00:21:01,620
cool to alert paceman themselves about

486
00:20:59,670 --> 00:21:04,440
automated stuff like hey this is a rat

487
00:21:01,620 --> 00:21:07,260
that's just surfing but they don't have

488
00:21:04,440 --> 00:21:10,110
really good mechanisms for that which is

489
00:21:07,260 --> 00:21:12,150
kind of why FC exists as a tool to give

490
00:21:10,110 --> 00:21:14,879
individual users the option to do what

491
00:21:12,150 --> 00:21:17,550
they want to with it either block the

492
00:21:14,880 --> 00:21:20,130
domain in our case at Cisco umbrella

493
00:21:17,550 --> 00:21:22,230
maybe proactively go out and report I'm

494
00:21:20,130 --> 00:21:24,840
sure you could use selenium to just like

495
00:21:22,230 --> 00:21:26,280
hey I found this bad paste I've got the

496
00:21:24,840 --> 00:21:27,899
key I'm gonna go and click on the

497
00:21:26,280 --> 00:21:31,139
airport button and get people in you

498
00:21:27,900 --> 00:21:34,440
know get bad guys in trouble as Captain

499
00:21:31,140 --> 00:21:38,880
Planet says the power is yours and do do

500
00:21:34,440 --> 00:21:41,220
what you'd like to I know that at least

501
00:21:38,880 --> 00:21:43,650
one banking company that that saw this

502
00:21:41,220 --> 00:21:45,210
presentation was like and we're totally

503
00:21:43,650 --> 00:21:50,270
going to use this to report all the the

504
00:21:45,210 --> 00:21:50,270
phishing images BC yeah

505
00:21:54,500 --> 00:22:00,840
yes paceman has a and much to our

506
00:21:59,130 --> 00:22:04,529
consolation one of the earliest versions

507
00:22:00,840 --> 00:22:07,590
of fierce croissant made requests of

508
00:22:04,529 --> 00:22:09,630
each individual pastes and like very

509
00:22:07,590 --> 00:22:12,330
quickly choked paceman to death and

510
00:22:09,630 --> 00:22:14,130
remember like marrow is dubbing we've

511
00:22:12,330 --> 00:22:16,740
since tuned fierce croissant to be

512
00:22:14,130 --> 00:22:19,049
better about scraping and paste bins

513
00:22:16,740 --> 00:22:21,630
fact on scraping is actually really good

514
00:22:19,049 --> 00:22:24,750
they recommend scraping once every

515
00:22:21,630 --> 00:22:28,350
minute the latest hundred pastes so FC

516
00:22:24,750 --> 00:22:30,149
does that by default now one of the

517
00:22:28,350 --> 00:22:32,908
unfortunate things about paceman is that

518
00:22:30,149 --> 00:22:35,309
you have to pay for a paid account in

519
00:22:32,909 --> 00:22:37,649
order to scrape the service so it's not

520
00:22:35,309 --> 00:22:39,178
too expensive it's 40 to 50 bucks and

521
00:22:37,649 --> 00:22:42,389
it's a really good treasure trove of

522
00:22:39,179 --> 00:22:43,980
information but I have contributed way

523
00:22:42,389 --> 00:22:47,129
too much money placement and service of

524
00:22:43,980 --> 00:22:48,509
this project so yeah that's something

525
00:22:47,129 --> 00:22:51,120
I've learned but rate limits were

526
00:22:48,509 --> 00:22:53,309
definitely a problem and I as someone

527
00:22:51,120 --> 00:22:55,469
who did not know what coding was really

528
00:22:53,309 --> 00:22:57,149
when I got said was like why does it

529
00:22:55,470 --> 00:22:59,070
keep timing out I don't understand and

530
00:22:57,149 --> 00:23:00,600
then I do it curl to paceman API they

531
00:22:59,070 --> 00:23:05,070
would tell me stop it

532
00:23:00,600 --> 00:23:15,110
like just slow down say yeah rate limits

533
00:23:05,070 --> 00:23:17,580
where problem know to do for later

534
00:23:15,110 --> 00:23:18,870
that's a good idea and I think one of

535
00:23:17,580 --> 00:23:20,399
the cool things that the keynote

536
00:23:18,870 --> 00:23:22,258
highlighted is that various perspectives

537
00:23:20,399 --> 00:23:24,658
will give you a lot more information a

538
00:23:22,259 --> 00:23:26,580
lot cool ideas so I would totally use

539
00:23:24,659 --> 00:23:29,580
that Mamie and suggest it to the rest of

540
00:23:26,580 --> 00:23:31,408
my team it's particularly good in our

541
00:23:29,580 --> 00:23:33,330
use case because one of the things we

542
00:23:31,409 --> 00:23:35,789
want to try to do is automate fishing

543
00:23:33,330 --> 00:23:37,678
blocks and so like if you're doing you

544
00:23:35,789 --> 00:23:39,120
know fishing images that are just hosted

545
00:23:37,679 --> 00:23:43,159
on pastebin and we can find that we'll

546
00:23:39,120 --> 00:23:43,158
be like yeah like that immediately

547
00:23:45,710 --> 00:23:51,480
that's true paceman does do Black Friday

548
00:23:49,710 --> 00:23:53,490
sales they do do deals all the time you

549
00:23:51,480 --> 00:23:55,620
can say on top of it and I really

550
00:23:53,490 --> 00:23:57,150
recommend it just as either hobbyist or

551
00:23:55,620 --> 00:23:59,919
professional there's lots of stuff there

552
00:23:57,150 --> 00:24:03,229
you'll never know what you'll find

553
00:23:59,920 --> 00:24:03,229
[Music]

554
00:24:09,530 --> 00:24:17,280
to be honest I have not a lot of the

555
00:24:13,980 --> 00:24:20,240
images seem to be just like people using

556
00:24:17,280 --> 00:24:23,399
paceman is a cheap version of Dropbox

557
00:24:20,240 --> 00:24:25,740
like people will put images for like

558
00:24:23,400 --> 00:24:27,600
Facebook fishes and then also their own

559
00:24:25,740 --> 00:24:30,270
personally used for the stuff I've seen

560
00:24:27,600 --> 00:24:34,168
a lot of animate portfolios it's been

561
00:24:30,270 --> 00:24:35,820
weird but I also have seen like less

562
00:24:34,169 --> 00:24:38,789
images than I thought I would expect

563
00:24:35,820 --> 00:24:41,760
over you know we we've caught like fifty

564
00:24:38,789 --> 00:24:43,830
seven thousand pastes but I imagine the

565
00:24:41,760 --> 00:24:46,799
number of images like we found through

566
00:24:43,830 --> 00:24:53,939
this structure are probably less than

567
00:24:46,799 --> 00:24:56,610
200 to be honest yeah absolutely

568
00:24:53,940 --> 00:24:58,650
I mean people could could upload Excel

569
00:24:56,610 --> 00:25:01,020
spreadsheets that have macros uploaded

570
00:24:58,650 --> 00:25:03,929
and like coming into all those problems

571
00:25:01,020 --> 00:25:07,408
so there's a wealth of stuff to find I'm

572
00:25:03,929 --> 00:25:09,360
sure I'm sure it has been there one of

573
00:25:07,409 --> 00:25:11,429
the things about pastebin bees for

574
00:25:09,360 --> 00:25:14,580
malware's it's been this way since at

575
00:25:11,429 --> 00:25:16,950
least 2012 people have used pastebin in

576
00:25:14,580 --> 00:25:19,799
this way there was a talk at RSA like

577
00:25:16,950 --> 00:25:25,890
2012 or 2013 saying like this is

578
00:25:19,799 --> 00:25:30,418
happening be aware of it in the last

579
00:25:25,890 --> 00:25:32,820
question oh yeah open source up on

580
00:25:30,419 --> 00:25:35,610
github I'll give you the you get github

581
00:25:32,820 --> 00:25:39,110
calm slash chaotic Requiem because I was

582
00:25:35,610 --> 00:25:41,969
in ng 90s teen slash fierce croissant

583
00:25:39,110 --> 00:25:45,330
and feel free to add me on Twitter or

584
00:25:41,970 --> 00:25:47,460
email me and stuff like that last shout

585
00:25:45,330 --> 00:25:49,710
out actually is a Twitter account I

586
00:25:47,460 --> 00:25:50,610
followed because of this project called

587
00:25:49,710 --> 00:25:53,190
scum BOTS

588
00:25:50,610 --> 00:25:54,570
so at scum BOTS which does a lot of the

589
00:25:53,190 --> 00:25:56,039
same thing but it uses Twitter to

590
00:25:54,570 --> 00:25:58,439
broadcast like hey here's a malicious

591
00:25:56,039 --> 00:26:00,269
paste and that's how I found out about

592
00:25:58,440 --> 00:26:03,570
the ascii encoding and the powershell

593
00:26:00,269 --> 00:26:05,730
executive all's cool so thank you so

594
00:26:03,570 --> 00:26:07,908
much for your time and yeah have a great

595
00:26:05,730 --> 00:26:07,909
conference

596
00:26:17,059 --> 00:26:19,120
you

