1
00:00:16,650 --> 00:00:19,919
I really love that you guys just heard

2
00:00:18,270 --> 00:00:22,169
from this guy about like how to create

3
00:00:19,920 --> 00:00:24,110
an oh moment so I'm hopefully gonna

4
00:00:22,170 --> 00:00:25,950
flip the perspective around a little bit

5
00:00:24,110 --> 00:00:27,540
before we get started just a little bit

6
00:00:25,950 --> 00:00:29,970
about myself I'm based out of DC I work

7
00:00:27,540 --> 00:00:31,500
for a cool company called expell we do

8
00:00:29,970 --> 00:00:33,059
awesome stuff one of the things I've

9
00:00:31,500 --> 00:00:36,239
been working on recently use like

10
00:00:33,059 --> 00:00:37,500
helping organizations defend against

11
00:00:36,239 --> 00:00:39,199
attacks in their cloud infrastructure

12
00:00:37,500 --> 00:00:41,970
and against their cloud applications

13
00:00:39,199 --> 00:00:44,160
huge banner besides besides do you see

14
00:00:41,970 --> 00:00:45,540
go where first why I'm here and besides

15
00:00:44,160 --> 00:00:47,669
Portland has been awesome so far I think

16
00:00:45,540 --> 00:00:51,200
you guys are doing a really great thing

17
00:00:47,670 --> 00:00:53,190
with this event and let's dive into it

18
00:00:51,200 --> 00:00:54,720
so this is what you guys are in for

19
00:00:53,190 --> 00:00:56,790
today we're just gonna talk a little bit

20
00:00:54,720 --> 00:00:58,710
about the problems faced I probably

21
00:00:56,790 --> 00:00:59,700
don't have to explain it to most of you

22
00:00:58,710 --> 00:01:02,640
so we're not gonna spend a whole lot of

23
00:00:59,700 --> 00:01:04,739
time there we'll talk about how you can

24
00:01:02,640 --> 00:01:06,000
set yourself up for a success when you

25
00:01:04,739 --> 00:01:08,509
think about protecting yourself

26
00:01:06,000 --> 00:01:12,600
defending against attacks on office 365

27
00:01:08,509 --> 00:01:15,240
we'll talk about how you can consume

28
00:01:12,600 --> 00:01:17,970
data and identify unusual things evil

29
00:01:15,240 --> 00:01:19,350
you know office 365 we'll talk about how

30
00:01:17,970 --> 00:01:22,320
you take an alert something that might

31
00:01:19,350 --> 00:01:24,240
be suspicious and actually run that down

32
00:01:22,320 --> 00:01:26,250
and determine what the heck it is if

33
00:01:24,240 --> 00:01:27,570
it's good or if it's bad and then we'll

34
00:01:26,250 --> 00:01:29,640
kind of round things out with some

35
00:01:27,570 --> 00:01:30,960
trends that we're seeing in terms of

36
00:01:29,640 --> 00:01:34,979
what you can do that actually get better

37
00:01:30,960 --> 00:01:37,048
and prevent these types of attacks so

38
00:01:34,979 --> 00:01:39,060
should be no surprise you guys so like

39
00:01:37,049 --> 00:01:42,299
cloud is a thing so quick show hands

40
00:01:39,060 --> 00:01:43,320
like who uses office 365 right now yeah

41
00:01:42,299 --> 00:01:47,400
that's that's kind of what I thought

42
00:01:43,320 --> 00:01:50,158
everybody right these days you're either

43
00:01:47,400 --> 00:01:52,200
cloud born or you're rapidly moving

44
00:01:50,159 --> 00:01:54,630
there a lot of great reasons for this

45
00:01:52,200 --> 00:01:57,630
it's a it's a great service

46
00:01:54,630 --> 00:01:59,820
convenience liability generally better

47
00:01:57,630 --> 00:02:02,220
user experience as we know in the

48
00:01:59,820 --> 00:02:04,199
security community however generally

49
00:02:02,220 --> 00:02:06,450
when we move on to adopt something new

50
00:02:04,200 --> 00:02:10,709
Security's often like an afterthought

51
00:02:06,450 --> 00:02:12,360
right so when we start to leverage these

52
00:02:10,709 --> 00:02:14,220
cloud applications software the service

53
00:02:12,360 --> 00:02:16,410
like office 365 we have to kind of wrap

54
00:02:14,220 --> 00:02:19,079
our heads around this idea of security

55
00:02:16,410 --> 00:02:20,340
as a shared responsibility so Microsoft

56
00:02:19,079 --> 00:02:21,780
is actually a big proponent of this

57
00:02:20,340 --> 00:02:23,640
themselves

58
00:02:21,780 --> 00:02:25,800
if you think about it you know as you

59
00:02:23,640 --> 00:02:28,049
offload more functions to your SATs

60
00:02:25,800 --> 00:02:29,880
provider like Microsoft you you don't

61
00:02:28,050 --> 00:02:31,980
have to worry about certain aspects of

62
00:02:29,880 --> 00:02:34,680
like security for example you don't have

63
00:02:31,980 --> 00:02:36,630
to think about worrying about physical

64
00:02:34,680 --> 00:02:37,860
security for the Microsoft data center

65
00:02:36,630 --> 00:02:39,359
right that's their problem you don't

66
00:02:37,860 --> 00:02:41,040
have to worry about processes running on

67
00:02:39,360 --> 00:02:43,320
exchange boxes like that's Microsoft's

68
00:02:41,040 --> 00:02:45,000
problem and even if you wanted to like

69
00:02:43,320 --> 00:02:49,260
Microsoft doesn't give you that control

70
00:02:45,000 --> 00:02:50,550
or visibility right and in some cases it

71
00:02:49,260 --> 00:02:51,989
seems like it's tempting for us to

72
00:02:50,550 --> 00:02:53,340
overestimate the responsibilities of

73
00:02:51,990 --> 00:02:54,630
that cloud provider right there doing

74
00:02:53,340 --> 00:02:57,450
all this stuff do we really have to

75
00:02:54,630 --> 00:02:58,980
worry about anything at all but you know

76
00:02:57,450 --> 00:03:01,709
when reality strikes when we actually

77
00:02:58,980 --> 00:03:03,899
move here often we kind of left like

78
00:03:01,710 --> 00:03:05,790
feeling like this guy on the right

79
00:03:03,900 --> 00:03:07,890
Robinson realized we actually we still

80
00:03:05,790 --> 00:03:09,120
do have some responsibilities we're not

81
00:03:07,890 --> 00:03:11,190
super clear on what they are we don't

82
00:03:09,120 --> 00:03:12,620
really understand them and also we have

83
00:03:11,190 --> 00:03:16,230
to deal with all kinds of new threats

84
00:03:12,620 --> 00:03:17,670
new security controls and that kind of

85
00:03:16,230 --> 00:03:20,760
creates some uncertainty and a little

86
00:03:17,670 --> 00:03:23,280
bit of it makes it difficult for

87
00:03:20,760 --> 00:03:24,269
security teams to understand what they

88
00:03:23,280 --> 00:03:26,520
actually need to do what they actually

89
00:03:24,270 --> 00:03:28,260
need to worry about with office 365 and

90
00:03:26,520 --> 00:03:29,610
that kind of leads us to the motivation

91
00:03:28,260 --> 00:03:32,910
for this talk so we've been on this

92
00:03:29,610 --> 00:03:34,620
journey to expell I've been on it as

93
00:03:32,910 --> 00:03:37,230
well trying to figure out how we can

94
00:03:34,620 --> 00:03:39,060
help organizations detect and response

95
00:03:37,230 --> 00:03:40,260
to attacks in office 365 and I think

96
00:03:39,060 --> 00:03:41,940
we've learned some insights along the

97
00:03:40,260 --> 00:03:43,290
way that I can share with you all

98
00:03:41,940 --> 00:03:44,790
hopefully some tidbits and tips and

99
00:03:43,290 --> 00:03:45,989
tricks that you can take back think

100
00:03:44,790 --> 00:03:48,959
about maybe implement your own

101
00:03:45,990 --> 00:03:53,250
environment hopefully avoid that oh

102
00:03:48,959 --> 00:03:54,690
moment so right off the bat like what do

103
00:03:53,250 --> 00:03:56,880
you need to do to set yourself up for

104
00:03:54,690 --> 00:03:59,910
success I'm sure many of you are

105
00:03:56,880 --> 00:04:01,530
familiar with office 365 audit log it's

106
00:03:59,910 --> 00:04:04,470
basically this magic button that you

107
00:04:01,530 --> 00:04:05,400
need to press right off the bat and that

108
00:04:04,470 --> 00:04:07,650
will start to record everything that

109
00:04:05,400 --> 00:04:09,570
happens in office 365 why it's not on by

110
00:04:07,650 --> 00:04:10,830
default I don't know but super important

111
00:04:09,570 --> 00:04:11,790
that you need to enable this right like

112
00:04:10,830 --> 00:04:14,100
the last thing you want to worry about

113
00:04:11,790 --> 00:04:15,120
like is somebody's owned and all of a

114
00:04:14,100 --> 00:04:17,279
sudden you realize you don't have the

115
00:04:15,120 --> 00:04:20,940
evidence to go back and figure out like

116
00:04:17,279 --> 00:04:23,549
what's going on so definitely recommend

117
00:04:20,940 --> 00:04:24,990
you do this right off the bat it's a

118
00:04:23,550 --> 00:04:28,550
simple button press or you can use some

119
00:04:24,990 --> 00:04:28,550
powerful magic to make it happen

120
00:04:28,770 --> 00:04:35,049
it doesn't really end there as luck

121
00:04:33,970 --> 00:04:36,700
would have it there are some more

122
00:04:35,050 --> 00:04:37,630
configuration things you probably want

123
00:04:36,700 --> 00:04:39,520
to think about

124
00:04:37,630 --> 00:04:41,230
although the audit log does record most

125
00:04:39,520 --> 00:04:43,359
of the things that go on go on and

126
00:04:41,230 --> 00:04:45,400
office 365 that you care about

127
00:04:43,360 --> 00:04:47,170
it doesn't include like all sorts of

128
00:04:45,400 --> 00:04:48,700
specific operations that occur with when

129
00:04:47,170 --> 00:04:50,400
users interact with their mailbox so

130
00:04:48,700 --> 00:04:53,560
every time they log into their mailbox

131
00:04:50,400 --> 00:04:55,840
when they create objects delete objects

132
00:04:53,560 --> 00:04:58,120
move things around create inbox rules

133
00:04:55,840 --> 00:04:59,289
things like that and we'll talk in a few

134
00:04:58,120 --> 00:05:01,030
slides like why those events are

135
00:04:59,290 --> 00:05:02,020
important but just another thing you

136
00:05:01,030 --> 00:05:03,070
need to be aware of it's kind of a

137
00:05:02,020 --> 00:05:04,840
hidden thing that's not enabled by

138
00:05:03,070 --> 00:05:06,640
default and you definitely want to check

139
00:05:04,840 --> 00:05:10,719
it out and run some PowerShell to make

140
00:05:06,640 --> 00:05:13,300
it happen some weird stuff to note like

141
00:05:10,720 --> 00:05:15,520
that was confusing to me when I first

142
00:05:13,300 --> 00:05:17,800
looked at this some things that are

143
00:05:15,520 --> 00:05:20,049
maybe not intuitive like how long those

144
00:05:17,800 --> 00:05:22,780
audit logs live actually depends on like

145
00:05:20,050 --> 00:05:24,700
how much you pay Microsoft so if you're

146
00:05:22,780 --> 00:05:27,130
using the very popular III subscription

147
00:05:24,700 --> 00:05:29,080
you get it for 90 days if you pay a

148
00:05:27,130 --> 00:05:31,450
whole bucket load of money for e5 which

149
00:05:29,080 --> 00:05:33,280
not not many people do I mean you get a

150
00:05:31,450 --> 00:05:35,440
year just something to be aware of also

151
00:05:33,280 --> 00:05:37,030
not intuitive all but like not all

152
00:05:35,440 --> 00:05:38,890
events actually show up and a lot of log

153
00:05:37,030 --> 00:05:40,000
in real time so if like if you're trying

154
00:05:38,890 --> 00:05:41,770
to run something down that's actually

155
00:05:40,000 --> 00:05:43,390
happening right now

156
00:05:41,770 --> 00:05:45,099
keep in mind you may have to wait like

157
00:05:43,390 --> 00:05:46,750
up to 30 minutes for some types of

158
00:05:45,100 --> 00:05:48,040
events to show up and in some cases like

159
00:05:46,750 --> 00:05:49,360
for like it's your Active Directory it's

160
00:05:48,040 --> 00:05:52,120
literally 24 hours so you have to sit

161
00:05:49,360 --> 00:05:54,940
there and wait so it's kind of confusing

162
00:05:52,120 --> 00:05:56,520
but something to be aware of so let's

163
00:05:54,940 --> 00:05:59,170
say you do check all these magic boxes

164
00:05:56,520 --> 00:06:02,140
you've turned it online how do you

165
00:05:59,170 --> 00:06:03,640
actually access that data right a couple

166
00:06:02,140 --> 00:06:05,740
options you can use these or interface

167
00:06:03,640 --> 00:06:08,650
the awesome Microsoft user interface

168
00:06:05,740 --> 00:06:10,360
everybody loves you can run a search

169
00:06:08,650 --> 00:06:12,609
that way in the security compliance

170
00:06:10,360 --> 00:06:14,710
Center there's a powershell commandlets

171
00:06:12,610 --> 00:06:15,940
it easy as well if you're actually

172
00:06:14,710 --> 00:06:17,409
developing a product and you want to

173
00:06:15,940 --> 00:06:19,270
consume this data like continuously

174
00:06:17,410 --> 00:06:22,740
microsoft recommends that you use their

175
00:06:19,270 --> 00:06:22,740
management API for that

176
00:06:24,090 --> 00:06:28,919
so once you've got all those buttons

177
00:06:26,160 --> 00:06:30,960
pressed and enabled and you've waited

178
00:06:28,919 --> 00:06:33,599
like a painful 24 hours for the data to

179
00:06:30,960 --> 00:06:36,060
actually start flowing you'll be able to

180
00:06:33,600 --> 00:06:37,500
query events but that's really no good

181
00:06:36,060 --> 00:06:39,210
used to youth like you don't know how to

182
00:06:37,500 --> 00:06:40,410
understand interpret those events right

183
00:06:39,210 --> 00:06:43,198
like how do you actually interpret the

184
00:06:40,410 --> 00:06:44,639
data that this thing records look at

185
00:06:43,199 --> 00:06:46,560
luckily for us Microsoft actually has

186
00:06:44,639 --> 00:06:48,510
put together a really good knowledge

187
00:06:46,560 --> 00:06:50,760
base article on this like just bookmark

188
00:06:48,510 --> 00:06:52,469
it it's invaluable it like pretty much

189
00:06:50,760 --> 00:06:54,150
describes every single field that exists

190
00:06:52,470 --> 00:06:55,169
in the art log it has a pretty good

191
00:06:54,150 --> 00:06:57,570
description of like what that field

192
00:06:55,169 --> 00:06:59,700
means there's some high-value fields

193
00:06:57,570 --> 00:07:01,290
here that you're you're very frequently

194
00:06:59,700 --> 00:07:03,889
gonna using things like the user ID

195
00:07:01,290 --> 00:07:05,910
which is the user that did the thing

196
00:07:03,889 --> 00:07:08,250
there's a client info string which is

197
00:07:05,910 --> 00:07:11,639
like the user agent so like what

198
00:07:08,250 --> 00:07:13,050
application generated this request IP

199
00:07:11,639 --> 00:07:15,240
address obviously where the request came

200
00:07:13,050 --> 00:07:20,250
from and operation which is like the

201
00:07:15,240 --> 00:07:21,930
thing that the user did cool so we have

202
00:07:20,250 --> 00:07:23,010
like a we have auditing enabled we have

203
00:07:21,930 --> 00:07:25,530
a basic understanding of what those

204
00:07:23,010 --> 00:07:27,479
audit events look like so how do you

205
00:07:25,530 --> 00:07:30,419
start to leverage that for detection

206
00:07:27,479 --> 00:07:31,919
response we talked about a few weeds you

207
00:07:30,419 --> 00:07:32,880
can like query things ad hoc and look

208
00:07:31,919 --> 00:07:34,229
for stuff during the course of an

209
00:07:32,880 --> 00:07:35,639
investigation that's fine and dandy but

210
00:07:34,229 --> 00:07:37,830
that doesn't make continuous monitoring

211
00:07:35,639 --> 00:07:41,310
right so how do you actually monitor

212
00:07:37,830 --> 00:07:43,650
this stuff in real time the easiest path

213
00:07:41,310 --> 00:07:46,229
forward there is to pick the data up to

214
00:07:43,650 --> 00:07:47,820
your sim of choice it doesn't have to be

215
00:07:46,229 --> 00:07:49,050
like any of these Legos but I've had

216
00:07:47,820 --> 00:07:50,250
good luck with them like a lot of these

217
00:07:49,050 --> 00:07:54,030
vendors it's just a couple of button

218
00:07:50,250 --> 00:07:55,440
presses and you'll be good to go one

219
00:07:54,030 --> 00:07:56,820
thing I'll call out like if you're not

220
00:07:55,440 --> 00:07:58,950
familiar with the juror log analytics

221
00:07:56,820 --> 00:08:00,990
you don't have a sim and you're going to

222
00:07:58,950 --> 00:08:02,669
which are already you definitely want to

223
00:08:00,990 --> 00:08:04,200
check it out it's literally a few clicks

224
00:08:02,669 --> 00:08:07,109
and a lot of this data just shows up

225
00:08:04,200 --> 00:08:09,270
automatically which is pretty nifty and

226
00:08:07,110 --> 00:08:12,710
they're rapidly developing into so they

227
00:08:09,270 --> 00:08:12,710
got a pretty awesome great language

228
00:08:13,909 --> 00:08:18,270
all right cool so we've got data flowing

229
00:08:16,500 --> 00:08:19,590
now the challenge becomes how do you

230
00:08:18,270 --> 00:08:21,448
transform there's like hundreds of

231
00:08:19,590 --> 00:08:24,210
thousands of events that you're

232
00:08:21,449 --> 00:08:25,710
consuming on a daily basis into things

233
00:08:24,210 --> 00:08:28,378
that are actually actionable like that

234
00:08:25,710 --> 00:08:29,729
are interesting to you so let's say

235
00:08:28,379 --> 00:08:31,530
we're interested in for example an

236
00:08:29,729 --> 00:08:33,838
attacker activity users doing things

237
00:08:31,530 --> 00:08:35,130
that they shouldn't there's a lot of

238
00:08:33,839 --> 00:08:36,149
ways to slice and dice this data there's

239
00:08:35,130 --> 00:08:38,969
a whole bunch of different types of

240
00:08:36,149 --> 00:08:40,409
events in the audit logs but we're going

241
00:08:38,969 --> 00:08:41,880
to talk about three kind of high-level

242
00:08:40,409 --> 00:08:44,218
categories today

243
00:08:41,880 --> 00:08:46,439
one being authentication to being like

244
00:08:44,219 --> 00:08:47,430
post authentication so they've logged in

245
00:08:46,440 --> 00:08:49,589
what kind of activities they're doing

246
00:08:47,430 --> 00:08:50,819
are they doing afterwards and then we'll

247
00:08:49,589 --> 00:08:53,070
around out with some examples of like

248
00:08:50,820 --> 00:08:58,470
say they pop an administrative user what

249
00:08:53,070 --> 00:09:00,600
kind of doors is out unlock for them so

250
00:08:58,470 --> 00:09:01,860
starting with authentication like right

251
00:09:00,600 --> 00:09:03,600
off the bat one really easy thing you

252
00:09:01,860 --> 00:09:04,950
can do is just like look at the source

253
00:09:03,600 --> 00:09:07,709
of where people are logging in from

254
00:09:04,950 --> 00:09:09,870
right this is not exactly a novel

255
00:09:07,709 --> 00:09:12,268
technique we've been doing this for a

256
00:09:09,870 --> 00:09:13,470
while with other sources of data and it

257
00:09:12,269 --> 00:09:16,829
definitely gets flack for being like

258
00:09:13,470 --> 00:09:19,079
over simplistic like you know filtering

259
00:09:16,829 --> 00:09:20,939
based on country it's easy to get around

260
00:09:19,079 --> 00:09:22,410
it right but at the end of the day this

261
00:09:20,940 --> 00:09:24,000
is a very low hanging fruit and you'll

262
00:09:22,410 --> 00:09:27,360
be surprised sometimes like what falls

263
00:09:24,000 --> 00:09:28,649
out of this so if you look at you know

264
00:09:27,360 --> 00:09:31,199
where you're doing business as an

265
00:09:28,649 --> 00:09:33,360
organization the hotspots become very

266
00:09:31,199 --> 00:09:35,510
apparent the big red dots the stuff that

267
00:09:33,360 --> 00:09:37,769
sticks out that's really weird is like

268
00:09:35,510 --> 00:09:39,689
instances where like only one user has

269
00:09:37,769 --> 00:09:42,720
ever wanted from that location and it's

270
00:09:39,690 --> 00:09:44,610
like not a common travel destination

271
00:09:42,720 --> 00:09:48,839
right like who vacations off the coast

272
00:09:44,610 --> 00:09:52,610
of Nigeria joking aside somebody to do

273
00:09:48,839 --> 00:09:56,279
that once that was yeah that was weird

274
00:09:52,610 --> 00:09:59,040
cool so ok this is cool well it's a good

275
00:09:56,279 --> 00:10:00,570
start not exactly now what can we like

276
00:09:59,040 --> 00:10:02,819
take this up what else could we do is

277
00:10:00,570 --> 00:10:04,050
let syndication locks what are the

278
00:10:02,820 --> 00:10:06,300
things that's pretty cool about

279
00:10:04,050 --> 00:10:07,740
authentication in office 365 it's just

280
00:10:06,300 --> 00:10:09,420
like the sheer volume of data that you

281
00:10:07,740 --> 00:10:11,579
get especially when you like enable

282
00:10:09,420 --> 00:10:13,050
mailbox auditing you actually get pretty

283
00:10:11,579 --> 00:10:15,089
granular information like where your

284
00:10:13,050 --> 00:10:17,430
users are on a pretty like a daily on an

285
00:10:15,089 --> 00:10:18,690
hourly basis so we can use that to we're

286
00:10:17,430 --> 00:10:20,760
an advantage to kind of track the

287
00:10:18,690 --> 00:10:23,550
location of our physical location of our

288
00:10:20,760 --> 00:10:24,180
users and try to identify maybe a

289
00:10:23,550 --> 00:10:27,209
compromised

290
00:10:24,180 --> 00:10:28,649
account right the general idea here is

291
00:10:27,210 --> 00:10:31,440
like you should only be able to travel

292
00:10:28,649 --> 00:10:33,360
so fast between physical locations

293
00:10:31,440 --> 00:10:34,649
unless you're shopping yourself like to

294
00:10:33,360 --> 00:10:38,810
a rocket like this guy you're not gonna

295
00:10:34,649 --> 00:10:42,240
travel faster than 650 miles an hour so

296
00:10:38,810 --> 00:10:44,099
when you look at user authentication you

297
00:10:42,240 --> 00:10:45,660
can identify things like this user

298
00:10:44,100 --> 00:10:47,070
normally like just logged in from their

299
00:10:45,660 --> 00:10:49,380
New York office and then an hour later

300
00:10:47,070 --> 00:10:51,360
log in from Nigeria like they would have

301
00:10:49,380 --> 00:10:54,899
had to travel 4,000 miles an hour to get

302
00:10:51,360 --> 00:10:55,860
there so some common false positives

303
00:10:54,899 --> 00:10:59,220
I'll call out here that you'll run into

304
00:10:55,860 --> 00:11:01,860
if you try to do this VPN proxy services

305
00:10:59,220 --> 00:11:03,270
that's gonna throw you off if somebody

306
00:11:01,860 --> 00:11:04,649
hops on their VPN it's gonna look like

307
00:11:03,270 --> 00:11:06,089
they traveled all the way around the

308
00:11:04,649 --> 00:11:09,300
world in a few seconds and obviously

309
00:11:06,089 --> 00:11:11,190
they didn't and mobile networks can be

310
00:11:09,300 --> 00:11:12,689
kind of a pain as well so if you're

311
00:11:11,190 --> 00:11:13,890
connected to your corporate Wi-Fi on

312
00:11:12,690 --> 00:11:15,779
your phone you walk across the street to

313
00:11:13,890 --> 00:11:17,100
get Starbucks you're gonna bounce it

314
00:11:15,779 --> 00:11:18,689
around between Verizon your Wi-Fi

315
00:11:17,100 --> 00:11:20,130
Starbucks Wi-Fi it's gonna look like

316
00:11:18,690 --> 00:11:21,620
you're traveling like all sorts of

317
00:11:20,130 --> 00:11:23,550
different directions pretty quick

318
00:11:21,620 --> 00:11:26,160
there's a couple ways you can pretty

319
00:11:23,550 --> 00:11:29,250
easily filter that stuff out you can

320
00:11:26,160 --> 00:11:31,040
identify VPN providers and like proxies

321
00:11:29,250 --> 00:11:34,080
there's services out there like IP hub

322
00:11:31,040 --> 00:11:35,969
that makes this easy you can filter out

323
00:11:34,080 --> 00:11:38,040
the mobile traffic based on the ISP that

324
00:11:35,970 --> 00:11:41,089
makes it pretty obvious and just user

325
00:11:38,040 --> 00:11:41,089
agents as well right

326
00:11:45,769 --> 00:11:53,959
I love the Segway so speaking of

327
00:11:49,129 --> 00:11:55,699
user-agents I didn't pay user agents one

328
00:11:53,959 --> 00:11:56,689
really thing what this is another really

329
00:11:55,699 --> 00:11:58,579
interesting property about

330
00:11:56,689 --> 00:12:00,199
authentication right like is you get you

331
00:11:58,579 --> 00:12:01,670
can get a sense for what client

332
00:12:00,199 --> 00:12:02,899
application initiated the request now we

333
00:12:01,670 --> 00:12:04,819
all know like you can't necessarily

334
00:12:02,899 --> 00:12:07,339
trust user agent people can for July

335
00:12:04,819 --> 00:12:08,420
yeah right but all that aside there's

336
00:12:07,339 --> 00:12:10,040
some pretty interesting stuff you can

337
00:12:08,420 --> 00:12:11,689
look for right one you can just try to

338
00:12:10,040 --> 00:12:14,599
profile the number of devices that a

339
00:12:11,689 --> 00:12:15,860
user has right you think about the

340
00:12:14,600 --> 00:12:18,410
average user you're gonna have like your

341
00:12:15,860 --> 00:12:20,059
phone your laptop that's pretty much it

342
00:12:18,410 --> 00:12:21,279
once you start to see like three four

343
00:12:20,059 --> 00:12:23,480
devices that gets a bit unusual

344
00:12:21,279 --> 00:12:24,619
especially when you start to see like

345
00:12:23,480 --> 00:12:26,600
flip-flopping between different

346
00:12:24,619 --> 00:12:27,980
operating systems like if somebody

347
00:12:26,600 --> 00:12:29,239
normally connects from their iPhone and

348
00:12:27,980 --> 00:12:30,679
then all of a sudden we see Android and

349
00:12:29,239 --> 00:12:33,019
iPhone back and forth like that's pretty

350
00:12:30,679 --> 00:12:35,299
weird obviously like very minor changes

351
00:12:33,019 --> 00:12:36,709
like version numbers changes in the

352
00:12:35,299 --> 00:12:40,399
browser that they're using that's less

353
00:12:36,709 --> 00:12:41,628
suspicious that's no big deal and the

354
00:12:40,399 --> 00:12:43,549
other thing you can look for with the

355
00:12:41,629 --> 00:12:45,350
user agents specifically with office 365

356
00:12:43,549 --> 00:12:47,600
is like you can see if they connected to

357
00:12:45,350 --> 00:12:49,850
through OWA or through like an

358
00:12:47,600 --> 00:12:52,670
application installed on their on their

359
00:12:49,850 --> 00:12:54,139
device so like to talk through the table

360
00:12:52,670 --> 00:12:55,969
on the right this is an example of like

361
00:12:54,139 --> 00:12:59,779
a distribution of a compromised user

362
00:12:55,970 --> 00:13:01,459
accounts user agent strings and we're

363
00:12:59,779 --> 00:13:03,139
just acting based on the frequency of

364
00:13:01,459 --> 00:13:05,179
the user agent string and we've

365
00:13:03,139 --> 00:13:06,679
normalized out the the version numbers

366
00:13:05,179 --> 00:13:10,329
so this just replaced with an uppercase

367
00:13:06,679 --> 00:13:13,009
D things that stood out about this case

368
00:13:10,329 --> 00:13:14,959
we can see already like the colored dots

369
00:13:13,009 --> 00:13:16,790
correspond with the operating system

370
00:13:14,959 --> 00:13:20,179
that's associated that user agent string

371
00:13:16,790 --> 00:13:22,969
so already this guy as like a Windows

372
00:13:20,179 --> 00:13:25,129
laptop he's got an iPhone and then he's

373
00:13:22,970 --> 00:13:26,629
also connecting via OSX so three devices

374
00:13:25,129 --> 00:13:28,939
like not unheard of but it's kind of

375
00:13:26,629 --> 00:13:30,889
unusual and then we also see like he

376
00:13:28,939 --> 00:13:32,299
connected via OWA which is pretty weird

377
00:13:30,889 --> 00:13:33,589
because we can tell from the user agent

378
00:13:32,299 --> 00:13:36,649
strings that he's got Outlook installed

379
00:13:33,589 --> 00:13:38,569
on his like his Windows laptop he's

380
00:13:36,649 --> 00:13:40,279
using a mail app on his iPhone so like

381
00:13:38,569 --> 00:13:43,809
why what purpose would this guy have of

382
00:13:40,279 --> 00:13:43,809
like logging in for through it'll be way

383
00:13:47,010 --> 00:13:52,480
there are exceptions to these rules yes

384
00:13:50,580 --> 00:13:53,500
some things that can help with this

385
00:13:52,480 --> 00:13:55,930
there's actually some pretty good user

386
00:13:53,500 --> 00:13:57,670
agent databases out there you can bounce

387
00:13:55,930 --> 00:13:59,620
usage of strings off and you'll get like

388
00:13:57,670 --> 00:14:00,910
hey here's the vendor here's the the

389
00:13:59,620 --> 00:14:02,200
browser it's associated with which

390
00:14:00,910 --> 00:14:06,939
definitely helps with enriching this

391
00:14:02,200 --> 00:14:08,530
data one of the property that's pretty

392
00:14:06,940 --> 00:14:10,360
interesting for authentication is just

393
00:14:08,530 --> 00:14:13,959
looking for like the use of anonymizer

394
00:14:10,360 --> 00:14:15,310
services in general there there are

395
00:14:13,960 --> 00:14:17,920
legitimate use cases for a non riser

396
00:14:15,310 --> 00:14:22,089
service we love VPN services in the

397
00:14:17,920 --> 00:14:24,670
security community obviously if you for

398
00:14:22,090 --> 00:14:26,290
example have an authorized VPN service

399
00:14:24,670 --> 00:14:28,030
that you install on like all of your

400
00:14:26,290 --> 00:14:29,439
laptops you could look for anything

401
00:14:28,030 --> 00:14:32,230
falling outside of that people using

402
00:14:29,440 --> 00:14:36,010
other services one of the thing we came

403
00:14:32,230 --> 00:14:38,140
across here I'll mention like is like

404
00:14:36,010 --> 00:14:39,340
kind of evolving TTP's so like we've had

405
00:14:38,140 --> 00:14:40,750
a couple clients where we continuously

406
00:14:39,340 --> 00:14:42,400
kick these people out of compromised

407
00:14:40,750 --> 00:14:43,390
accounts and when they come back they

408
00:14:42,400 --> 00:14:45,790
always do something a little bit

409
00:14:43,390 --> 00:14:47,680
different right this client in

410
00:14:45,790 --> 00:14:49,060
particular had decided like hey we're

411
00:14:47,680 --> 00:14:50,349
gonna use conditional access policies

412
00:14:49,060 --> 00:14:54,010
we're gonna block everything outside of

413
00:14:50,350 --> 00:14:56,590
the US great so we would start to see

414
00:14:54,010 --> 00:14:58,480
these messages coming across like

415
00:14:56,590 --> 00:15:00,340
attempted off indications and they'd be

416
00:14:58,480 --> 00:15:02,080
blocked due to that conditional access

417
00:15:00,340 --> 00:15:04,420
policy so it's kind of interesting about

418
00:15:02,080 --> 00:15:05,740
that is if you actually read the nuances

419
00:15:04,420 --> 00:15:07,449
of Microsoft's documentation on

420
00:15:05,740 --> 00:15:09,070
conditional access policies that's

421
00:15:07,450 --> 00:15:11,170
evaluated after a successful

422
00:15:09,070 --> 00:15:12,730
authentication so when you see this

423
00:15:11,170 --> 00:15:14,349
message show up it means somebody is

424
00:15:12,730 --> 00:15:15,460
where they shouldn't be and had the

425
00:15:14,350 --> 00:15:17,980
right password so that's kind of

426
00:15:15,460 --> 00:15:19,180
interesting to look for by itself even

427
00:15:17,980 --> 00:15:21,850
more interesting is when you correlate

428
00:15:19,180 --> 00:15:24,550
that with like a success from a proxy or

429
00:15:21,850 --> 00:15:25,990
VPN service what we were seeing was they

430
00:15:24,550 --> 00:15:27,910
would attempt to authenticate from a

431
00:15:25,990 --> 00:15:29,890
blacklisted country and then when it

432
00:15:27,910 --> 00:15:31,660
didn't work they'd hop on a VPN pop up

433
00:15:29,890 --> 00:15:34,740
in the US and success from there so

434
00:15:31,660 --> 00:15:34,740
queerly aims two things together

435
00:15:38,149 --> 00:15:41,189
all right so we talked a little bit

436
00:15:40,499 --> 00:15:43,319
about what you can do with

437
00:15:41,189 --> 00:15:44,699
authentication events let's talk a

438
00:15:43,319 --> 00:15:46,920
little bit about like okay they've

439
00:15:44,699 --> 00:15:49,050
they've got compromised credentials they

440
00:15:46,920 --> 00:15:51,179
logged in they're gonna do a series of

441
00:15:49,050 --> 00:15:54,089
activities after that and what can we

442
00:15:51,179 --> 00:15:57,749
look for that might a flag is that

443
00:15:54,089 --> 00:15:59,819
something suspicious is going on we know

444
00:15:57,749 --> 00:16:00,990
attackers generally want to persist an

445
00:15:59,819 --> 00:16:02,849
environment which they they have

446
00:16:00,990 --> 00:16:04,439
compromised credentials they want to fly

447
00:16:02,850 --> 00:16:06,720
under the radar and they have some sort

448
00:16:04,439 --> 00:16:08,519
of goal in mind so we can take that and

449
00:16:06,720 --> 00:16:11,269
it's kind of already how about like how

450
00:16:08,519 --> 00:16:15,019
office 365 works to identify some

451
00:16:11,269 --> 00:16:18,149
behaviors that they may attempt to you

452
00:16:15,019 --> 00:16:21,660
one thing that we see all the time is

453
00:16:18,149 --> 00:16:23,189
this idea of evil inbox rules so I'm

454
00:16:21,660 --> 00:16:25,649
sure we're all familiar with like the

455
00:16:23,189 --> 00:16:28,860
concept of an inbox rule we use it to

456
00:16:25,649 --> 00:16:30,929
keep our inboxes clean we will send all

457
00:16:28,860 --> 00:16:34,649
that spam to the trash we'll send those

458
00:16:30,929 --> 00:16:35,819
reports to reports folder very useful it

459
00:16:34,649 --> 00:16:37,920
turns out attackers use this all the

460
00:16:35,819 --> 00:16:39,389
time as well to send stuff they don't

461
00:16:37,920 --> 00:16:40,309
want you to see to places where you

462
00:16:39,389 --> 00:16:42,869
can't see it

463
00:16:40,309 --> 00:16:44,309
so if legitimate users using box rules

464
00:16:42,869 --> 00:16:45,509
and bad guys use the inbox rules like

465
00:16:44,309 --> 00:16:47,429
what's the difference how can you tell

466
00:16:45,509 --> 00:16:50,879
all right couple of things you can look

467
00:16:47,429 --> 00:16:52,649
for look at the action so users

468
00:16:50,879 --> 00:16:55,470
typically don't create inbox rules that

469
00:16:52,649 --> 00:16:56,699
delete messages like we like to keep our

470
00:16:55,470 --> 00:16:58,769
data somewhere just in case we made a

471
00:16:56,699 --> 00:17:00,748
mistake right that's unusual

472
00:16:58,769 --> 00:17:02,610
you can look for actions where they're

473
00:17:00,749 --> 00:17:05,279
moving stuff to an unusual place we'll

474
00:17:02,610 --> 00:17:07,529
get into an example in a second and you

475
00:17:05,279 --> 00:17:09,419
can look for unusual keywords things

476
00:17:07,529 --> 00:17:10,500
like infected malware virus no I know

477
00:17:09,419 --> 00:17:12,209
what you guys are thinking right like

478
00:17:10,500 --> 00:17:14,520
you're telling me if this guy has

479
00:17:12,209 --> 00:17:16,470
compromised credentials and he created

480
00:17:14,520 --> 00:17:20,639
an inbox rule with the word malware in

481
00:17:16,470 --> 00:17:21,990
it why would why would you do that so

482
00:17:20,640 --> 00:17:26,610
let's talk about it so we've got three

483
00:17:21,990 --> 00:17:27,809
examples here we'll go left to right and

484
00:17:26,609 --> 00:17:30,649
these are all real examples that I

485
00:17:27,809 --> 00:17:32,730
sanitized from recent recent incidents

486
00:17:30,649 --> 00:17:35,449
so the first one on the Left somebody

487
00:17:32,730 --> 00:17:38,789
created an inbox rule with the name one

488
00:17:35,450 --> 00:17:41,130
and it's deleting all messages that have

489
00:17:38,789 --> 00:17:45,299
any of these keywords so things like

490
00:17:41,130 --> 00:17:47,160
delivery failure document email spam

491
00:17:45,299 --> 00:17:48,629
virus hack

492
00:17:47,160 --> 00:17:50,550
it was kind of cool when you look at

493
00:17:48,630 --> 00:17:51,930
then you analyze these inbox rules as

494
00:17:50,550 --> 00:17:53,310
you can sort of understand what the

495
00:17:51,930 --> 00:17:55,320
attacker was trying to do you can get at

496
00:17:53,310 --> 00:17:58,860
their intent by looking at what these

497
00:17:55,320 --> 00:18:00,179
inbox rules do in this case this guy was

498
00:17:58,860 --> 00:18:01,620
trying to mask the fact that he had

499
00:18:00,180 --> 00:18:03,780
compromised an email account and was

500
00:18:01,620 --> 00:18:04,820
like spamming out email to a thousand

501
00:18:03,780 --> 00:18:07,190
other places and he's trying to

502
00:18:04,820 --> 00:18:09,510
essentially send all the bounce backs

503
00:18:07,190 --> 00:18:11,220
like to the void

504
00:18:09,510 --> 00:18:13,770
so the compromised user doesn't realize

505
00:18:11,220 --> 00:18:17,040
that they've been popped right now

506
00:18:13,770 --> 00:18:18,540
obviously that's not pretty subtle one

507
00:18:17,040 --> 00:18:21,510
glance of that rule and you can tell

508
00:18:18,540 --> 00:18:23,040
it's pretty unusual but as I mentioned

509
00:18:21,510 --> 00:18:26,129
like as you start to kick these people

510
00:18:23,040 --> 00:18:27,990
out out of your networks they'll come

511
00:18:26,130 --> 00:18:29,790
back and they'll they'll evolve their

512
00:18:27,990 --> 00:18:32,220
their techniques to try to bypass any de

513
00:18:29,790 --> 00:18:33,840
Texas that you put in place so the

514
00:18:32,220 --> 00:18:36,960
second rule in the middle there is an

515
00:18:33,840 --> 00:18:41,240
example of that same customer they

516
00:18:36,960 --> 00:18:45,780
created a rule with the name period

517
00:18:41,240 --> 00:18:47,670
great but interesting instead of using

518
00:18:45,780 --> 00:18:49,620
subject keywords now they're looking at

519
00:18:47,670 --> 00:18:50,970
the from address so if you created some

520
00:18:49,620 --> 00:18:53,100
sort of detection rule that looked for

521
00:18:50,970 --> 00:18:54,090
keywords in the subject this would have

522
00:18:53,100 --> 00:18:55,260
ate your detection so they're

523
00:18:54,090 --> 00:18:58,620
essentially trying to do the same thing

524
00:18:55,260 --> 00:18:59,820
right they're trying to delete any

525
00:18:58,620 --> 00:19:01,139
messages that are bounced back so

526
00:18:59,820 --> 00:19:04,320
they're doing that by looking for

527
00:19:01,140 --> 00:19:09,660
keywords like postmaster mail Microsoft

528
00:19:04,320 --> 00:19:11,580
in the in the from address so the last

529
00:19:09,660 --> 00:19:14,100
one is kind of an additional example of

530
00:19:11,580 --> 00:19:15,300
them evolving this technique this is

531
00:19:14,100 --> 00:19:18,480
probably one of the more subtle ones

532
00:19:15,300 --> 00:19:20,070
that I've seen right off the bat the

533
00:19:18,480 --> 00:19:21,510
rule name this is like the default rule

534
00:19:20,070 --> 00:19:23,070
name if you create an inbox rule so if

535
00:19:21,510 --> 00:19:25,830
you were just looking at that this

536
00:19:23,070 --> 00:19:27,990
wouldn't stick out to you at all they're

537
00:19:25,830 --> 00:19:28,980
using the from address again but what's

538
00:19:27,990 --> 00:19:30,510
kind of interesting here is they're no

539
00:19:28,980 --> 00:19:33,090
longer deleting the message so they only

540
00:19:30,510 --> 00:19:35,550
caught on to the fact that like people

541
00:19:33,090 --> 00:19:36,480
are using that to detect badness and now

542
00:19:35,550 --> 00:19:38,040
instead of leaving it they're just

543
00:19:36,480 --> 00:19:39,750
moving it marking it as right and moving

544
00:19:38,040 --> 00:19:42,149
it to the RSS subscriptions folder which

545
00:19:39,750 --> 00:19:43,500
like I don't think anybody uses RSS

546
00:19:42,150 --> 00:19:46,710
anymore right you're never gonna look at

547
00:19:43,500 --> 00:19:48,300
that folder so that was pretty cool

548
00:19:46,710 --> 00:19:49,320
this one was actually a little bit

549
00:19:48,300 --> 00:19:50,700
different and they weren't doing spam

550
00:19:49,320 --> 00:19:54,830
they were trying to do wire transfer

551
00:19:50,700 --> 00:19:57,840
fraud so you can see they're masking

552
00:19:54,830 --> 00:19:59,590
replies that form addresses that had to

553
00:19:57,840 --> 00:20:02,760
do with invoicing payment

554
00:19:59,590 --> 00:20:02,760
why everything like things like that

555
00:20:08,190 --> 00:20:12,300
so here's another interesting behavior

556
00:20:10,170 --> 00:20:15,300
that's almost never a good idea even if

557
00:20:12,300 --> 00:20:18,300
it is you were a user doing this on

558
00:20:15,300 --> 00:20:20,010
purpose you know office 365 you can

559
00:20:18,300 --> 00:20:22,460
configure your mailbox you automatically

560
00:20:20,010 --> 00:20:24,840
send every email to a different dress

561
00:20:22,460 --> 00:20:26,460
and when that address is not owned by

562
00:20:24,840 --> 00:20:28,379
your organization that's a terrible idea

563
00:20:26,460 --> 00:20:32,940
for a thousand reasons that I don't need

564
00:20:28,380 --> 00:20:34,470
to explain to you guys so it at best

565
00:20:32,940 --> 00:20:37,200
it's a policy violation and at worst

566
00:20:34,470 --> 00:20:38,850
this is a method for persistence as well

567
00:20:37,200 --> 00:20:40,770
the nice thing about this from a tax

568
00:20:38,850 --> 00:20:42,750
perspective is like this is a passive

569
00:20:40,770 --> 00:20:44,070
way to chill in somebody's inbox you

570
00:20:42,750 --> 00:20:45,810
don't have to log in and pull down their

571
00:20:44,070 --> 00:20:47,370
email every time you want to see it you

572
00:20:45,810 --> 00:20:48,750
can just siphon it off to an email

573
00:20:47,370 --> 00:20:51,060
address that you create that looks very

574
00:20:48,750 --> 00:20:52,710
believable right so what we've seen we

575
00:20:51,060 --> 00:20:54,720
actually had an instance like where this

576
00:20:52,710 --> 00:20:56,010
was the CFO that was targeted and they

577
00:20:54,720 --> 00:20:57,570
went out and they stood up a gmail

578
00:20:56,010 --> 00:21:00,330
account that it was first named out last

579
00:20:57,570 --> 00:21:01,770
name and it looks exactly like him so if

580
00:21:00,330 --> 00:21:08,669
you just skimming by it but it told me

581
00:21:01,770 --> 00:21:11,790
it was not him so moving away from like

582
00:21:08,670 --> 00:21:13,380
mailbox activities one other thing you

583
00:21:11,790 --> 00:21:16,139
can look for us like obviously there are

584
00:21:13,380 --> 00:21:18,350
other services and applications in

585
00:21:16,140 --> 00:21:20,610
office 465 like SharePoint and onedrive

586
00:21:18,350 --> 00:21:21,780
depending on you know your attackers

587
00:21:20,610 --> 00:21:23,129
objectives they may actually start to

588
00:21:21,780 --> 00:21:25,710
poke around and use those services to

589
00:21:23,130 --> 00:21:27,480
try to collect a airing there's some

590
00:21:25,710 --> 00:21:30,180
definitely interesting things you can

591
00:21:27,480 --> 00:21:33,210
look there look for there so when you

592
00:21:30,180 --> 00:21:35,460
request like a file on SharePoint or you

593
00:21:33,210 --> 00:21:37,020
view a file on onedrive

594
00:21:35,460 --> 00:21:38,610
that does generate events in the auto

595
00:21:37,020 --> 00:21:40,740
log and you can use that to detect a

596
00:21:38,610 --> 00:21:42,689
weirdness so one thing about the bat is

597
00:21:40,740 --> 00:21:45,570
just look for a bursty behavior like no

598
00:21:42,690 --> 00:21:47,100
users gonna manually go look at 50

599
00:21:45,570 --> 00:21:48,840
SharePoint sites in five seconds right

600
00:21:47,100 --> 00:21:51,870
so when you see stuff like that that's

601
00:21:48,840 --> 00:21:52,970
that's kind of a red flag the other

602
00:21:51,870 --> 00:21:57,780
thing that's kind of interesting here is

603
00:21:52,970 --> 00:21:59,190
these concept of public links a very

604
00:21:57,780 --> 00:22:02,100
convenient feature I'm sure we've all

605
00:21:59,190 --> 00:22:04,320
used it regardless of the service in

606
00:22:02,100 --> 00:22:06,540
office 365 if you've got a resource in

607
00:22:04,320 --> 00:22:08,399
SharePoint or a file in onedrive and you

608
00:22:06,540 --> 00:22:09,870
want to collaborate with someone you can

609
00:22:08,400 --> 00:22:11,760
press the easy button and it'll generate

610
00:22:09,870 --> 00:22:13,889
like a pseudo-random link that you can

611
00:22:11,760 --> 00:22:15,840
share with anybody in the world and they

612
00:22:13,890 --> 00:22:18,680
have full permissions to that file I'm

613
00:22:15,840 --> 00:22:18,679
super convenient right

614
00:22:19,750 --> 00:22:25,549
unfortunately sometimes this can lead to

615
00:22:22,009 --> 00:22:30,169
hairy situations when users share things

616
00:22:25,549 --> 00:22:31,789
maybe they shouldn't share so this is

617
00:22:30,169 --> 00:22:34,340
kind of interesting as well one thing

618
00:22:31,789 --> 00:22:35,899
that we've come across is the users

619
00:22:34,340 --> 00:22:37,580
accidentally sharing a parent folder

620
00:22:35,899 --> 00:22:39,979
that contains way more files than they

621
00:22:37,580 --> 00:22:44,029
thought it shared they thought it

622
00:22:39,980 --> 00:22:45,830
contained whoops so something to watch

623
00:22:44,029 --> 00:22:47,980
out for and just ask yourself hey hey

624
00:22:45,830 --> 00:22:51,080
what are my users sharing publicly and

625
00:22:47,980 --> 00:22:52,070
you know you can actually view this view

626
00:22:51,080 --> 00:22:54,769
OTO long as well

627
00:22:52,070 --> 00:22:56,450
something worth reviewing every month or

628
00:22:54,769 --> 00:22:57,740
whatever just to see what's out there

629
00:22:56,450 --> 00:22:59,269
the scary thing is like this stuff never

630
00:22:57,740 --> 00:23:00,710
goes away like they don't expire right

631
00:22:59,269 --> 00:23:02,419
and once somebody sends that leak out

632
00:23:00,710 --> 00:23:05,090
you have absolutely no control over it

633
00:23:02,419 --> 00:23:10,580
so especially with stuff like this kind

634
00:23:05,090 --> 00:23:12,740
of makes you a little uneasy alright so

635
00:23:10,580 --> 00:23:14,178
the last category i'll talk to you here

636
00:23:12,740 --> 00:23:18,470
is like what if what if they do pop in

637
00:23:14,179 --> 00:23:21,830
admin obviously that kind of sucks and

638
00:23:18,470 --> 00:23:25,399
unlocks a lot of doors one of those

639
00:23:21,830 --> 00:23:28,009
doors is this idea of delegating

640
00:23:25,399 --> 00:23:29,360
permissions which is essentially

641
00:23:28,009 --> 00:23:30,980
impersonation I don't know if you guys

642
00:23:29,360 --> 00:23:34,969
have seen master disguise it's a

643
00:23:30,980 --> 00:23:38,629
terrible movie but it does I apologize

644
00:23:34,970 --> 00:23:41,360
it's a cult classic I know but that's

645
00:23:38,629 --> 00:23:43,029
essentially what this is right executive

646
00:23:41,360 --> 00:23:45,889
assistants use it all the time to manage

647
00:23:43,029 --> 00:23:48,350
inboxes and calendars for you know

648
00:23:45,889 --> 00:23:51,168
executives bad guys use it all the time

649
00:23:48,350 --> 00:23:52,610
to you you know gain access to other

650
00:23:51,169 --> 00:23:53,960
people's mailboxes right so a couple

651
00:23:52,610 --> 00:23:56,330
things you can look out for there like

652
00:23:53,960 --> 00:23:57,590
if somebody's been delegated privileges

653
00:23:56,330 --> 00:23:59,029
to another users mailbox and they're not

654
00:23:57,590 --> 00:24:00,230
an executive assistant or somebody that

655
00:23:59,029 --> 00:24:02,779
you'd expect to have that kind of

656
00:24:00,230 --> 00:24:05,419
privilege that's super weird if an admin

657
00:24:02,779 --> 00:24:07,070
assigns themself permissions to a bunch

658
00:24:05,419 --> 00:24:08,889
of other users mailboxes that's kind of

659
00:24:07,070 --> 00:24:11,178
weird

660
00:24:08,889 --> 00:24:12,860
the other interesting door that it

661
00:24:11,179 --> 00:24:15,200
unlocks you know obviously because

662
00:24:12,860 --> 00:24:18,769
you're using office 365 surprise you're

663
00:24:15,200 --> 00:24:21,500
using Azure is this idea of like

664
00:24:18,769 --> 00:24:24,320
persisting via app registration in Azure

665
00:24:21,500 --> 00:24:25,639
Active Directory the interesting thing

666
00:24:24,320 --> 00:24:28,519
here from an attacker perspective is

667
00:24:25,639 --> 00:24:31,250
like a lot of times these applications

668
00:24:28,519 --> 00:24:32,160
are not subject to the same security

669
00:24:31,250 --> 00:24:35,220
controls that you're using

670
00:24:32,160 --> 00:24:37,320
your multi-factor authentication your

671
00:24:35,220 --> 00:24:38,640
conditional access policies chances are

672
00:24:37,320 --> 00:24:39,780
your apps aren't subject to all that

673
00:24:38,640 --> 00:24:42,510
because you want those automation

674
00:24:39,780 --> 00:24:44,190
accounts to work right so definitely a

675
00:24:42,510 --> 00:24:49,950
stealthy way to persist if you're an

676
00:24:44,190 --> 00:24:51,390
attacker all right so like we've run

677
00:24:49,950 --> 00:24:54,030
through few examples of attacker

678
00:24:51,390 --> 00:24:56,450
behaviors detection use cases let's look

679
00:24:54,030 --> 00:24:58,379
over now to the investigator process

680
00:24:56,450 --> 00:24:59,250
this is kind of harder than you might

681
00:24:58,380 --> 00:25:01,770
think

682
00:24:59,250 --> 00:25:03,960
if you're you know traditional security

683
00:25:01,770 --> 00:25:06,060
analyst security team you've had a lot

684
00:25:03,960 --> 00:25:07,830
of practice in enterprise forensics like

685
00:25:06,060 --> 00:25:09,389
how to run down a piece of malware on a

686
00:25:07,830 --> 00:25:11,570
Windows box like we're very practiced

687
00:25:09,390 --> 00:25:14,790
but when running down stuff like this

688
00:25:11,570 --> 00:25:16,050
stuff targeting your users in office 3c5

689
00:25:14,790 --> 00:25:18,139
like there's a lot of things that are

690
00:25:16,050 --> 00:25:21,419
just different and aren't natural to you

691
00:25:18,140 --> 00:25:23,520
a couple of things changes like we're

692
00:25:21,420 --> 00:25:25,290
very used to the host right something

693
00:25:23,520 --> 00:25:27,270
goes wrong in my enterprise like what

694
00:25:25,290 --> 00:25:31,860
what's going on in the host how did I

695
00:25:27,270 --> 00:25:33,510
get here right in office 365 sometimes

696
00:25:31,860 --> 00:25:37,459
there's just simply no host to pivot to

697
00:25:33,510 --> 00:25:37,460
right so we have to change how we think

698
00:25:37,520 --> 00:25:41,850
gathering sources of evidence and the

699
00:25:39,720 --> 00:25:44,640
sources like just the evidence itself is

700
00:25:41,850 --> 00:25:46,500
different than what we're used to and as

701
00:25:44,640 --> 00:25:49,410
a result like the investigative question

702
00:25:46,500 --> 00:25:51,930
like is it bad there's a little bit

703
00:25:49,410 --> 00:25:54,840
different from traditional instant

704
00:25:51,930 --> 00:25:57,840
response so like how can we overcome

705
00:25:54,840 --> 00:25:59,459
this insecurity when one approach that

706
00:25:57,840 --> 00:26:03,260
we've taken and have had success with

707
00:25:59,460 --> 00:26:03,260
that expell is this idea of a playbook

708
00:26:04,970 --> 00:26:08,820
so like I've been on both sides of this

709
00:26:07,350 --> 00:26:11,310
my history is like manage security

710
00:26:08,820 --> 00:26:13,200
services we have tons of play books I've

711
00:26:11,310 --> 00:26:16,530
seen getting bad play books I've written

712
00:26:13,200 --> 00:26:19,020
good and bad play books a couple couple

713
00:26:16,530 --> 00:26:23,190
key things like keep it simple keep it

714
00:26:19,020 --> 00:26:27,330
consistent and keep it clear I've had

715
00:26:23,190 --> 00:26:29,010
good luck with this format so I tend to

716
00:26:27,330 --> 00:26:31,139
start off with just like general context

717
00:26:29,010 --> 00:26:33,629
about like what this use case is this is

718
00:26:31,140 --> 00:26:34,800
super important when like the problem

719
00:26:33,630 --> 00:26:36,740
we're trying to solve or the thing we're

720
00:26:34,800 --> 00:26:40,409
trying to run down is not natural to us

721
00:26:36,740 --> 00:26:41,550
so we want to include things like what

722
00:26:40,410 --> 00:26:42,990
is this attacker behavior that we're

723
00:26:41,550 --> 00:26:44,280
trying to detect it's important because

724
00:26:42,990 --> 00:26:45,270
it Orient's the analysts around the

725
00:26:44,280 --> 00:26:47,520
problem

726
00:26:45,270 --> 00:26:49,290
gets them in the right mindset and then

727
00:26:47,520 --> 00:26:51,260
discussing how we're trying to detect it

728
00:26:49,290 --> 00:26:53,909
talk about your detection methodology

729
00:26:51,260 --> 00:26:56,240
this again gets them thinking about well

730
00:26:53,910 --> 00:26:57,990
you know why this all it exists and

731
00:26:56,240 --> 00:27:05,730
helps set them on the right track to

732
00:26:57,990 --> 00:27:07,530
answer is it legit or is it evil also

733
00:27:05,730 --> 00:27:09,720
it's important to have like a guidelines

734
00:27:07,530 --> 00:27:12,178
for validation steps one thing I'll call

735
00:27:09,720 --> 00:27:13,950
it here is I I've seen in some cases

736
00:27:12,179 --> 00:27:15,900
people go away to overboard like in

737
00:27:13,950 --> 00:27:17,850
defining process for like validating a

738
00:27:15,900 --> 00:27:19,200
thing and it gets to the point where

739
00:27:17,850 --> 00:27:20,340
like analysts aren't even making

740
00:27:19,200 --> 00:27:22,110
decisions anymore they're just following

741
00:27:20,340 --> 00:27:23,580
like and clicking buttons

742
00:27:22,110 --> 00:27:24,540
that's super bad like that kind of takes

743
00:27:23,580 --> 00:27:27,629
it in the wrong direction we want

744
00:27:24,540 --> 00:27:28,980
analysts to use their brains right so in

745
00:27:27,630 --> 00:27:31,260
the in the better play books I've seen

746
00:27:28,980 --> 00:27:33,900
it's generally like guidelines nots not

747
00:27:31,260 --> 00:27:40,710
explicit instructions right that being

748
00:27:33,900 --> 00:27:42,150
said examples are good and remediation

749
00:27:40,710 --> 00:27:43,830
steps are important as well again some

750
00:27:42,150 --> 00:27:45,210
of these things are not what we're used

751
00:27:43,830 --> 00:27:47,610
to like you're not going to pay the box

752
00:27:45,210 --> 00:27:50,940
if somebody is 365 like crayons are

753
00:27:47,610 --> 00:27:52,020
popped so but how would you respond so

754
00:27:50,940 --> 00:27:53,220
we want to take the guesswork out of

755
00:27:52,020 --> 00:27:56,360
that especially when analysts aren't

756
00:27:53,220 --> 00:27:59,610
used to interacting with these services

757
00:27:56,360 --> 00:28:01,678
so you may for example document steps

758
00:27:59,610 --> 00:28:03,570
like this okay once you validate you

759
00:28:01,679 --> 00:28:05,669
have user credential controls that are

760
00:28:03,570 --> 00:28:07,678
compromised like figure out what user it

761
00:28:05,669 --> 00:28:08,970
was revoke all their session tokens and

762
00:28:07,679 --> 00:28:10,530
like reset their password for example

763
00:28:08,970 --> 00:28:12,780
and obviously these steps will be

764
00:28:10,530 --> 00:28:14,520
different based on your organization but

765
00:28:12,780 --> 00:28:16,049
like just giving those examples and

766
00:28:14,520 --> 00:28:17,340
especially when this like these are new

767
00:28:16,049 --> 00:28:22,320
muscles that you're building as a team

768
00:28:17,340 --> 00:28:23,879
are super important finally and this is

769
00:28:22,320 --> 00:28:26,100
kind of often overlooked like this

770
00:28:23,880 --> 00:28:27,000
concept of resilience which is like how

771
00:28:26,100 --> 00:28:28,770
do you I should get better as an

772
00:28:27,000 --> 00:28:30,390
organization like yeah we have to put

773
00:28:28,770 --> 00:28:31,950
out fires we have to fix this using the

774
00:28:30,390 --> 00:28:33,480
short term but like how do we prevent

775
00:28:31,950 --> 00:28:35,460
this class of thing from happening and

776
00:28:33,480 --> 00:28:36,870
like what do we need to do security

777
00:28:35,460 --> 00:28:39,270
strategy wise to prevent this type of

778
00:28:36,870 --> 00:28:41,040
attack a lot of times this is

779
00:28:39,270 --> 00:28:43,320
multi-factor authentication you know

780
00:28:41,040 --> 00:28:44,580
whatever the greater security control is

781
00:28:43,320 --> 00:28:46,110
but it's important to track this stuff

782
00:28:44,580 --> 00:28:49,668
on an instant by instant basis so you

783
00:28:46,110 --> 00:28:49,668
can sort of sell that business case

784
00:28:50,070 --> 00:28:54,970
so this is example of little playbook

785
00:28:52,300 --> 00:28:57,310
looks like the in its full form again

786
00:28:54,970 --> 00:28:59,070
like providing context about the attack

787
00:28:57,310 --> 00:29:01,300
we're looking for how we're detecting it

788
00:28:59,070 --> 00:29:06,879
and what you need to do about it as an

789
00:29:01,300 --> 00:29:09,520
analyst cool so I mean we've been doing

790
00:29:06,880 --> 00:29:12,490
this for a while it expell and there are

791
00:29:09,520 --> 00:29:14,560
a couple like themes that keep popping

792
00:29:12,490 --> 00:29:17,200
up one for sure is multi-factor

793
00:29:14,560 --> 00:29:18,820
authentication like everybody has been

794
00:29:17,200 --> 00:29:19,870
beating on that dead horse and it's way

795
00:29:18,820 --> 00:29:23,409
harder than it sounds

796
00:29:19,870 --> 00:29:25,120
but whatever you can do start with your

797
00:29:23,410 --> 00:29:29,170
admins start with your high-value who

798
00:29:25,120 --> 00:29:31,659
users but this seems to be the big

799
00:29:29,170 --> 00:29:32,920
sticking point for people the other

800
00:29:31,660 --> 00:29:35,020
thing that seems to be causing a little

801
00:29:32,920 --> 00:29:36,580
bit of confusion within security teams

802
00:29:35,020 --> 00:29:38,430
I've seen is like there are a lot of

803
00:29:36,580 --> 00:29:41,020
native security controls in office 365

804
00:29:38,430 --> 00:29:42,730
and honestly they're continuously

805
00:29:41,020 --> 00:29:44,020
evolving and being developed like it

806
00:29:42,730 --> 00:29:46,720
seems like every month or so Microsoft

807
00:29:44,020 --> 00:29:48,400
comes out with a cool new feature it's

808
00:29:46,720 --> 00:29:49,540
hard to keep track of all that but it's

809
00:29:48,400 --> 00:29:51,130
definitely worth reviewing like there's

810
00:29:49,540 --> 00:29:52,600
all kinds of cool capabilities like

811
00:29:51,130 --> 00:29:55,660
conditional access policies I talked

812
00:29:52,600 --> 00:29:57,520
about Microsoft has like DLP Mauer

813
00:29:55,660 --> 00:29:58,900
anti-phishing policies all sorts of cool

814
00:29:57,520 --> 00:30:00,490
stuff that you can leverage without

815
00:29:58,900 --> 00:30:04,930
having to like buy a whole new product

816
00:30:00,490 --> 00:30:07,810
in some cases yes there are different

817
00:30:04,930 --> 00:30:09,730
subscriptions so it depends if you want

818
00:30:07,810 --> 00:30:13,060
to go that route versus you know roll

819
00:30:09,730 --> 00:30:14,110
your own or buy a product but it seems

820
00:30:13,060 --> 00:30:15,879
like a lot of people just aren't aware

821
00:30:14,110 --> 00:30:18,659
of all the different knobs and levers

822
00:30:15,880 --> 00:30:21,370
that they have available to an office I

823
00:30:18,660 --> 00:30:23,910
think that's like office 365 advanced

824
00:30:21,370 --> 00:30:26,919
threat protection you actually have like

825
00:30:23,910 --> 00:30:27,730
anti-phishing where Dell well I think

826
00:30:26,920 --> 00:30:29,050
they call them threat intelligence

827
00:30:27,730 --> 00:30:30,910
events or whatever it will though

828
00:30:29,050 --> 00:30:32,139
identify a phishing message and like

829
00:30:30,910 --> 00:30:34,360
tell you if it was delivered to users

830
00:30:32,140 --> 00:30:39,160
inbox pretty cool I think it's a

831
00:30:34,360 --> 00:30:40,689
relatively new thing and then just

832
00:30:39,160 --> 00:30:41,830
generally reviewing policy configuration

833
00:30:40,690 --> 00:30:44,170
so a couple of the things that we talked

834
00:30:41,830 --> 00:30:45,730
about like the ability for users to

835
00:30:44,170 --> 00:30:49,210
create public links to file so you can

836
00:30:45,730 --> 00:30:50,680
just turn that off and things like

837
00:30:49,210 --> 00:30:53,260
mailbox forwarding again you could turn

838
00:30:50,680 --> 00:30:54,610
that stuff off so especially as as you

839
00:30:53,260 --> 00:30:56,440
think about like how you're going to get

840
00:30:54,610 --> 00:30:57,330
attacked and maybe how you have been

841
00:30:56,440 --> 00:30:59,130
attacked

842
00:30:57,330 --> 00:31:00,570
go back and think about those policies

843
00:30:59,130 --> 00:31:02,520
like what can you do to actually prevent

844
00:31:00,570 --> 00:31:07,919
that class of attack from from occurring

845
00:31:02,520 --> 00:31:10,260
again cool so just bring it all together

846
00:31:07,920 --> 00:31:12,630
again like office six office 365 is

847
00:31:10,260 --> 00:31:15,870
great we all of it brings a lot of cost

848
00:31:12,630 --> 00:31:18,380
savings cool new features we don't want

849
00:31:15,870 --> 00:31:20,129
the security of it to be an afterthought

850
00:31:18,380 --> 00:31:21,930
we don't necessarily want to

851
00:31:20,130 --> 00:31:23,880
overestimate the responsibilities of

852
00:31:21,930 --> 00:31:27,540
Microsoft or any other cloud provider

853
00:31:23,880 --> 00:31:28,830
right the investigations in the cloud in

854
00:31:27,540 --> 00:31:30,149
general are sort of different from what

855
00:31:28,830 --> 00:31:32,189
we're used to so we have and we have to

856
00:31:30,150 --> 00:31:33,840
make sure that we start to build those

857
00:31:32,190 --> 00:31:37,140
muscles as a team

858
00:31:33,840 --> 00:31:38,610
and in general just plan ahead for

859
00:31:37,140 --> 00:31:40,140
account account compromise don't wait

860
00:31:38,610 --> 00:31:42,240
for that incident to happen before you

861
00:31:40,140 --> 00:31:50,330
start thinking about this stuff so cool

862
00:31:42,240 --> 00:31:50,330
with that any questions yes

863
00:31:57,360 --> 00:32:01,260
that is a good call yeah actually

864
00:31:59,250 --> 00:32:03,900
Microsoft has a lot of pretty legit

865
00:32:01,260 --> 00:32:05,429
reporting now on is your security

866
00:32:03,900 --> 00:32:07,679
recommendations all kinds of good stuff

867
00:32:05,429 --> 00:32:17,370
there's almost too many features to keep

868
00:32:07,679 --> 00:32:26,780
track of but it's legitimately just a

869
00:32:17,370 --> 00:32:26,780
button that you click count I'm sure

870
00:33:10,450 --> 00:33:50,300
yeah it's basically ignorant sis blitz

871
00:33:42,740 --> 00:33:51,440
right yeah I mean the parallel I would

872
00:33:50,300 --> 00:33:52,879
draw is like what if they shipped

873
00:33:51,440 --> 00:33:54,740
Windows without like the Windows Event

874
00:33:52,880 --> 00:34:09,919
log turned on though be catastrophic

875
00:33:54,740 --> 00:34:11,030
right like yeah I don't think you can

876
00:34:09,918 --> 00:34:12,440
press a button but you can use

877
00:34:11,030 --> 00:34:14,810
PowerShell to shut it off yeah it's

878
00:34:12,440 --> 00:34:21,918
pretty easy I don't think there's like a

879
00:34:14,810 --> 00:34:23,210
big like stop button exactly yeah the

880
00:34:21,918 --> 00:34:24,710
thing I've seen is like most people go

881
00:34:23,210 --> 00:34:26,690
with III and then they sort of have this

882
00:34:24,710 --> 00:34:28,460
philosophical like do I pay a whole like

883
00:34:26,690 --> 00:34:29,780
truckload of money to Microsoft to get

884
00:34:28,460 --> 00:34:31,520
some of this stuff or do I pipe the data

885
00:34:29,780 --> 00:34:33,590
off to assume and do some of the stuff

886
00:34:31,520 --> 00:34:38,168
myself so we've seen people go both

887
00:34:33,590 --> 00:34:38,169
routes but there's a lot of options

888
00:34:39,280 --> 00:34:45,130
yeah that's an understatement yeah yes

889
00:34:43,010 --> 00:34:45,130
sir

890
00:34:54,070 --> 00:34:58,310
those sharing files that's a good point

891
00:34:56,360 --> 00:34:59,840
so by default they allow you to create

892
00:34:58,310 --> 00:35:01,190
public links and you can share stuff to

893
00:34:59,840 --> 00:35:03,230
the world right there are pretty

894
00:35:01,190 --> 00:35:04,400
granular controls one of the things like

895
00:35:03,230 --> 00:35:05,450
the easiest things you can do like

896
00:35:04,400 --> 00:35:09,290
obviously you don't want to hamper

897
00:35:05,450 --> 00:35:10,970
people's like work workflows right you

898
00:35:09,290 --> 00:35:12,140
can just force them to actually share it

899
00:35:10,970 --> 00:35:13,850
with specific people in your

900
00:35:12,140 --> 00:35:15,410
organization versus a public link which

901
00:35:13,850 --> 00:35:17,180
is a lot safer right because then only

902
00:35:15,410 --> 00:35:19,970
the person that you actually granted the

903
00:35:17,180 --> 00:35:21,680
access to has access to it and you can

904
00:35:19,970 --> 00:35:23,600
actually do that like per user for a

905
00:35:21,680 --> 00:35:25,339
group it doesn't have to be an org like

906
00:35:23,600 --> 00:35:26,900
thing so like you could you could allow

907
00:35:25,340 --> 00:35:28,160
certain groups or people to create

908
00:35:26,900 --> 00:35:30,500
public links if they'd you really needed

909
00:35:28,160 --> 00:35:32,149
to but locking that down seems like a

910
00:35:30,500 --> 00:35:34,100
no-brainer and I think it's almost just

911
00:35:32,150 --> 00:35:36,230
as convenient to like force them to

912
00:35:34,100 --> 00:35:43,430
share it with a specific person or group

913
00:35:36,230 --> 00:35:46,570
versus publicly right is that alright

914
00:35:43,430 --> 00:35:46,569
thanks guys thank so much

915
00:35:55,210 --> 00:35:57,270
you

