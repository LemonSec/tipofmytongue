1
00:00:15,750 --> 00:00:21,490
so welcome thanks everybody for showing

2
00:00:19,090 --> 00:00:25,500
up on Saturday here this is speaking to

3
00:00:21,490 --> 00:00:28,330
a city of Amazon echoes Karl Fossen

4
00:00:25,500 --> 00:00:30,100
intro kind of covered all this but I'm a

5
00:00:28,330 --> 00:00:32,168
managing consultant over at net spy

6
00:00:30,100 --> 00:00:33,760
we've got a table over there I don't

7
00:00:32,168 --> 00:00:35,800
think anybody's over at the moment but

8
00:00:33,760 --> 00:00:38,140
if anybody wants to talk to me after

9
00:00:35,800 --> 00:00:41,709
this I'll be over there we've got such a

10
00:00:38,140 --> 00:00:43,720
swag and stuff but over at net spy I do

11
00:00:41,710 --> 00:00:46,750
a number of different things wear a lot

12
00:00:43,720 --> 00:00:47,949
of different hats but over the last six

13
00:00:46,750 --> 00:00:50,530
years I've worked there I've done a

14
00:00:47,949 --> 00:00:51,789
variety of network and app pen testing a

15
00:00:50,530 --> 00:00:53,590
little bit of mobile stuff we're gonna

16
00:00:51,789 --> 00:00:57,609
see a little bit of mobile kind of web

17
00:00:53,590 --> 00:00:59,680
stuff here today and password cracking

18
00:00:57,609 --> 00:01:01,390
and social engineering like I said we're

19
00:00:59,680 --> 00:01:03,699
a number of different hats do a lot of

20
00:01:01,390 --> 00:01:06,760
different things so you can find me on

21
00:01:03,699 --> 00:01:08,860
Twitter with @k Fossen these slides will

22
00:01:06,760 --> 00:01:11,080
be posted to SlideShare so if anybody

23
00:01:08,860 --> 00:01:13,150
wants to snap a photo of that it's just

24
00:01:11,080 --> 00:01:15,550
my first initial last name for

25
00:01:13,150 --> 00:01:17,620
SlideShare you can find me on the net

26
00:01:15,550 --> 00:01:19,600
spy blog this will hopefully be

27
00:01:17,620 --> 00:01:22,720
published as a blog within the next

28
00:01:19,600 --> 00:01:24,548
couple of weeks here there's still some

29
00:01:22,720 --> 00:01:25,960
approval process with Amazon for

30
00:01:24,549 --> 00:01:26,409
publicly talking about some of this

31
00:01:25,960 --> 00:01:28,179
stuff

32
00:01:26,409 --> 00:01:30,220
I finally got approval to actually do

33
00:01:28,180 --> 00:01:33,549
this talk I think it was Monday of last

34
00:01:30,220 --> 00:01:35,740
week so this is kind of a bleeding edge

35
00:01:33,549 --> 00:01:37,600
for approval stuff but hopefully that'll

36
00:01:35,740 --> 00:01:39,908
be up as a blog within the next couple

37
00:01:37,600 --> 00:01:42,369
of weeks here and any code that I've

38
00:01:39,909 --> 00:01:47,409
written typically ends up in the Nets by

39
00:01:42,369 --> 00:01:50,229
github repository so uh quick show of

40
00:01:47,409 --> 00:01:54,909
hands here anybody have an echo device

41
00:01:50,229 --> 00:01:58,149
at home or an Amazon Alexa enabled type

42
00:01:54,909 --> 00:02:01,719
device I've got a couple myself I've got

43
00:01:58,149 --> 00:02:03,640
the echo dot there's the tap the show I

44
00:02:01,719 --> 00:02:05,048
to be honest I don't know all of the

45
00:02:03,640 --> 00:02:07,060
different names they've got a ton of new

46
00:02:05,049 --> 00:02:10,630
products within the last even couple of

47
00:02:07,060 --> 00:02:12,700
months here but these are just your

48
00:02:10,630 --> 00:02:15,160
really handy devices for voice control

49
00:02:12,700 --> 00:02:17,290
kind of stuff for those haven't used

50
00:02:15,160 --> 00:02:19,120
them or used any of the Alexa enabled

51
00:02:17,290 --> 00:02:21,579
services we can talk about what they can

52
00:02:19,120 --> 00:02:23,830
do but you know last count that I saw

53
00:02:21,580 --> 00:02:25,810
there's over 11 million devices that

54
00:02:23,830 --> 00:02:28,030
have been sold so chances are there's a

55
00:02:25,810 --> 00:02:29,230
fair number of devices that are in this

56
00:02:28,030 --> 00:02:31,450
audience

57
00:02:29,230 --> 00:02:34,329
or owned by people in this audience but

58
00:02:31,450 --> 00:02:37,268
I don't work for Amazon I just kind of

59
00:02:34,330 --> 00:02:39,400
like their products so what can they do

60
00:02:37,269 --> 00:02:42,370
as I said the primary kind of thing is

61
00:02:39,400 --> 00:02:44,799
voice control that was moving apparently

62
00:02:42,370 --> 00:02:47,530
that's on wheels

63
00:02:44,799 --> 00:02:50,470
primary thing is voice control so Alexa

64
00:02:47,530 --> 00:02:53,170
do this thing I don't know with the echo

65
00:02:50,470 --> 00:02:55,299
dot that we've got at home I say Alexa

66
00:02:53,170 --> 00:02:56,500
news now get a nice news briefing while

67
00:02:55,299 --> 00:02:59,079
I'm making coffee in the morning or

68
00:02:56,500 --> 00:03:00,970
Alexa turn on the kitchen lights really

69
00:02:59,079 --> 00:03:03,340
kind of Handy voice control home

70
00:03:00,970 --> 00:03:05,980
automation playing music from Pandora

71
00:03:03,340 --> 00:03:08,560
anything like that very similar to any

72
00:03:05,980 --> 00:03:11,619
other type of solutions like the Google

73
00:03:08,560 --> 00:03:14,349
home device the Alexa and echo devices

74
00:03:11,620 --> 00:03:15,940
do the same stuff but one of the newer

75
00:03:14,349 --> 00:03:18,819
features within the last year is the

76
00:03:15,940 --> 00:03:20,590
ability to contact other people so it

77
00:03:18,819 --> 00:03:23,738
can be text messages that you can send

78
00:03:20,590 --> 00:03:25,239
from the Alexa app audio messages that

79
00:03:23,739 --> 00:03:27,010
you can record from the app and send

80
00:03:25,239 --> 00:03:29,230
from devices advice I think you can

81
00:03:27,010 --> 00:03:32,649
record them like send a voice memo to

82
00:03:29,230 --> 00:03:34,388
somebody from echo to echo and recently

83
00:03:32,650 --> 00:03:36,250
phone calling within the last month here

84
00:03:34,389 --> 00:03:38,530
they actually introduced calls directly

85
00:03:36,250 --> 00:03:41,019
to landlines or cell phones so you

86
00:03:38,530 --> 00:03:42,760
actually do like actual SIP trunking to

87
00:03:41,019 --> 00:03:44,799
actually make actual phone calls was

88
00:03:42,760 --> 00:03:46,510
just kind of cool having actually got to

89
00:03:44,799 --> 00:03:47,889
dive into that yet been a little too

90
00:03:46,510 --> 00:03:50,798
busy to actually start pulling that

91
00:03:47,889 --> 00:03:52,329
apart and also pretty recently video

92
00:03:50,799 --> 00:03:54,819
chat so you can see one of the echo

93
00:03:52,329 --> 00:03:56,620
devices here with a screen you can do

94
00:03:54,819 --> 00:03:59,798
video chatting with that built-in

95
00:03:56,620 --> 00:04:01,630
cameras your privacy concerns aside all

96
00:03:59,799 --> 00:04:04,239
that they are kind of interesting

97
00:04:01,630 --> 00:04:05,590
devices and fun to play around with so

98
00:04:04,239 --> 00:04:08,849
what we're gonna focus on today is

99
00:04:05,590 --> 00:04:12,099
primarily the text and audio message

100
00:04:08,849 --> 00:04:14,200
side of things primarily what protocols

101
00:04:12,099 --> 00:04:15,910
api's are used to do both of those and

102
00:04:14,200 --> 00:04:19,570
the interesting things that we can do

103
00:04:15,910 --> 00:04:23,469
around that so first things first we

104
00:04:19,570 --> 00:04:25,599
need people to contact one of the things

105
00:04:23,470 --> 00:04:29,020
that you do when you set up the echo

106
00:04:25,599 --> 00:04:31,479
devices within the Amazon app on your

107
00:04:29,020 --> 00:04:33,219
phone is you can actually choose to give

108
00:04:31,479 --> 00:04:35,139
Amazon permissions to your contacts and

109
00:04:33,220 --> 00:04:37,419
you upload a list of your contacts from

110
00:04:35,139 --> 00:04:39,280
your phone this is done with a pretty

111
00:04:37,419 --> 00:04:42,099
simple JSON format that we'll look at in

112
00:04:39,280 --> 00:04:42,909
a moment but basically you upload the

113
00:04:42,099 --> 00:04:45,219
phone numbers

114
00:04:42,910 --> 00:04:47,530
the names of your contacts up to Amazon

115
00:04:45,220 --> 00:04:50,230
and they go ahead and find the other

116
00:04:47,530 --> 00:04:51,549
people that you can talk to we'll go

117
00:04:50,230 --> 00:04:55,240
through that whole process in just a

118
00:04:51,550 --> 00:04:57,340
moment here but really for each of these

119
00:04:55,240 --> 00:05:00,220
requests we're gonna look at in the next

120
00:04:57,340 --> 00:05:01,659
few minutes here I was using burp or

121
00:05:00,220 --> 00:05:04,720
burp suite professional as an

122
00:05:01,660 --> 00:05:09,160
intercepting proxy so what that means is

123
00:05:04,720 --> 00:05:10,960
I ran this burp suite professional on my

124
00:05:09,160 --> 00:05:13,690
laptop hooked up to the same wireless

125
00:05:10,960 --> 00:05:16,239
network as my phone pointed my phone at

126
00:05:13,690 --> 00:05:18,520
that proxy in the configuration settings

127
00:05:16,240 --> 00:05:20,980
installed the SSL certificate and that

128
00:05:18,520 --> 00:05:23,260
allows me to intercept the

129
00:05:20,980 --> 00:05:25,870
communications that go out to Amazon

130
00:05:23,260 --> 00:05:27,460
services so when we want to send a text

131
00:05:25,870 --> 00:05:29,530
message we intercept that with burp

132
00:05:27,460 --> 00:05:31,630
first take a look at it you'll actually

133
00:05:29,530 --> 00:05:33,309
see some of these requests and then we

134
00:05:31,630 --> 00:05:34,960
go ahead and forward that on to Amazon

135
00:05:33,310 --> 00:05:37,030
to do the things that we want to do

136
00:05:34,960 --> 00:05:39,820
there's a pretty standard tool for web

137
00:05:37,030 --> 00:05:41,919
app or mobile testing if anybody's done

138
00:05:39,820 --> 00:05:43,420
any mobile or web app testing you've

139
00:05:41,920 --> 00:05:45,400
probably used burp or another

140
00:05:43,420 --> 00:05:47,620
intercepting proxy if you haven't

141
00:05:45,400 --> 00:05:49,359
utilized burp or other interception

142
00:05:47,620 --> 00:05:52,120
proxies before they have a free version

143
00:05:49,360 --> 00:05:54,370
I highly recommend everybody here goes

144
00:05:52,120 --> 00:05:55,870
ahead and gives it a try installing the

145
00:05:54,370 --> 00:05:58,210
burp certificate on your phones pretty

146
00:05:55,870 --> 00:06:00,160
easy to do there's instructions on ports

147
00:05:58,210 --> 00:06:03,909
wiggers website it's the company that

148
00:06:00,160 --> 00:06:06,100
makes burp but yeah just as a general

149
00:06:03,910 --> 00:06:08,260
like auditing of what your applications

150
00:06:06,100 --> 00:06:11,380
are doing on your phone you'd be really

151
00:06:08,260 --> 00:06:13,210
surprised as to what applications are

152
00:06:11,380 --> 00:06:14,530
calling out to the Internet for the

153
00:06:13,210 --> 00:06:16,210
little you know fun games that you're

154
00:06:14,530 --> 00:06:18,489
playing on your phone you'd be surprised

155
00:06:16,210 --> 00:06:21,760
at how many other like ad and content

156
00:06:18,490 --> 00:06:23,410
networks these simple games go up to the

157
00:06:21,760 --> 00:06:26,020
Internet to serve up your personal

158
00:06:23,410 --> 00:06:27,940
information out to so as just kind of a

159
00:06:26,020 --> 00:06:30,219
recommendation for everybody give it a

160
00:06:27,940 --> 00:06:32,350
try point your phone at it see what kind

161
00:06:30,220 --> 00:06:33,760
of traffic is going through that proxy

162
00:06:32,350 --> 00:06:37,780
you might end up finding some

163
00:06:33,760 --> 00:06:39,520
interesting stuff like this so this is

164
00:06:37,780 --> 00:06:41,109
what the request looks like for

165
00:06:39,520 --> 00:06:42,010
uploading your contacts and this is

166
00:06:41,110 --> 00:06:43,570
going to be a bit of an eye chart

167
00:06:42,010 --> 00:06:46,300
especially for people that are a little

168
00:06:43,570 --> 00:06:48,400
further off screen here but what we can

169
00:06:46,300 --> 00:06:50,560
see is that I've blocked out some

170
00:06:48,400 --> 00:06:53,140
pertinent information regarding my

171
00:06:50,560 --> 00:06:55,870
account identifier Amazon uses these

172
00:06:53,140 --> 00:06:56,260
long goods to identify your account and

173
00:06:55,870 --> 00:06:58,570
other

174
00:06:56,260 --> 00:07:01,659
people's accounts so in this case making

175
00:06:58,570 --> 00:07:04,750
a simple API request to put a JSON list

176
00:07:01,660 --> 00:07:06,760
of contact ID numbers and telephone

177
00:07:04,750 --> 00:07:09,070
numbers with first name last name in

178
00:07:06,760 --> 00:07:10,630
this case we're putting tests and then

179
00:07:09,070 --> 00:07:12,430
whatever the last four digits the phone

180
00:07:10,630 --> 00:07:16,270
number is we'll talk a little bit more

181
00:07:12,430 --> 00:07:18,490
about that later but basically a simple

182
00:07:16,270 --> 00:07:20,650
API request to put out a list of your

183
00:07:18,490 --> 00:07:22,660
contacts with your first name last name

184
00:07:20,650 --> 00:07:25,479
out to Amazon so they can go ahead and

185
00:07:22,660 --> 00:07:27,250
look up these phone numbers to identify

186
00:07:25,480 --> 00:07:30,820
who's got an echo device and who you can

187
00:07:27,250 --> 00:07:31,510
talk to so on the app side it's gonna

188
00:07:30,820 --> 00:07:33,909
look like this

189
00:07:31,510 --> 00:07:36,039
so I've uploaded a list of contact

190
00:07:33,910 --> 00:07:37,450
information from my phone these are a

191
00:07:36,040 --> 00:07:39,250
bunch of people that I know that all

192
00:07:37,450 --> 00:07:41,409
have echo devices they're gonna show up

193
00:07:39,250 --> 00:07:46,060
as contacts that I can reach out to

194
00:07:41,410 --> 00:07:47,890
within the application so once we've got

195
00:07:46,060 --> 00:07:49,990
contacts that we could reach out to and

196
00:07:47,890 --> 00:07:52,870
send messages to we can go ahead and

197
00:07:49,990 --> 00:07:54,730
send text messages it's pretty simple

198
00:07:52,870 --> 00:07:57,010
process you click your contact and say

199
00:07:54,730 --> 00:07:58,660
hey I want to send the text message you

200
00:07:57,010 --> 00:08:00,280
go ahead and send it this will show up

201
00:07:58,660 --> 00:08:02,230
on their echo device with a nice green

202
00:08:00,280 --> 00:08:03,820
glowing ring it might be a little

203
00:08:02,230 --> 00:08:05,830
confusing the first time you get one of

204
00:08:03,820 --> 00:08:07,330
these messages same thing for any

205
00:08:05,830 --> 00:08:08,950
notifications like if you have shipping

206
00:08:07,330 --> 00:08:10,750
notifications set up for your echo

207
00:08:08,950 --> 00:08:13,150
device it will go ahead and you know

208
00:08:10,750 --> 00:08:15,250
glow green it's a little confusing it

209
00:08:13,150 --> 00:08:16,210
sometimes my hope was that the

210
00:08:15,250 --> 00:08:17,920
text-to-speech

211
00:08:16,210 --> 00:08:20,500
message read out that it does when you

212
00:08:17,920 --> 00:08:22,720
say Alexa play my messages or tell me my

213
00:08:20,500 --> 00:08:24,400
messages I just kind of hope that that

214
00:08:22,720 --> 00:08:26,590
would be automatic it doesn't

215
00:08:24,400 --> 00:08:28,450
automatically just start yelling stuff

216
00:08:26,590 --> 00:08:33,669
out to you this is one of my co-workers

217
00:08:28,450 --> 00:08:35,620
Erik who I was hoping would just get the

218
00:08:33,669 --> 00:08:38,470
message and just start yelling at him he

219
00:08:35,620 --> 00:08:41,500
was a little confused by this said it

220
00:08:38,470 --> 00:08:43,150
started blinking so I unplugged it so

221
00:08:41,500 --> 00:08:48,550
not everybody's used to getting messages

222
00:08:43,150 --> 00:08:49,600
on their echo devices all right so that

223
00:08:48,550 --> 00:08:50,859
request is gonna look something like

224
00:08:49,600 --> 00:08:52,900
this

225
00:08:50,860 --> 00:08:55,330
I apologize for anybody that's further

226
00:08:52,900 --> 00:08:57,610
off to the side here but basically what

227
00:08:55,330 --> 00:08:59,290
we're looking at is the account that I'm

228
00:08:57,610 --> 00:09:01,420
sending from it's that gooood again

229
00:08:59,290 --> 00:09:04,170
the account I'm sending to which I've

230
00:09:01,420 --> 00:09:06,790
blanked out purposefully for my own

231
00:09:04,170 --> 00:09:08,800
privacy not that I don't want to speak

232
00:09:06,790 --> 00:09:10,209
with anybody here but I don't

233
00:09:08,800 --> 00:09:12,729
necessarily want to get echo

234
00:09:10,209 --> 00:09:16,329
device notifications you know spam doubt

235
00:09:12,730 --> 00:09:17,920
to me necessarily so anyways that's just

236
00:09:16,329 --> 00:09:20,429
gonna look like this simple JSON message

237
00:09:17,920 --> 00:09:23,410
here payload hey this is Carl I'm

238
00:09:20,429 --> 00:09:24,999
testing some Amazon stuff I promise I

239
00:09:23,410 --> 00:09:27,790
won't spam you over this and the

240
00:09:24,999 --> 00:09:30,970
timestamp and notification that it's a

241
00:09:27,790 --> 00:09:32,469
text message really simple it's gonna

242
00:09:30,970 --> 00:09:34,540
look like this in the application and

243
00:09:32,470 --> 00:09:36,819
then you get that nice green glowing

244
00:09:34,540 --> 00:09:40,540
light on your echo or echo dot whatever

245
00:09:36,819 --> 00:09:42,998
and yes this is a message I sent out to

246
00:09:40,540 --> 00:09:44,349
another co-worker Alex and that's

247
00:09:42,999 --> 00:09:49,389
basically what it's gonna look like in

248
00:09:44,350 --> 00:09:52,959
the app so sending audio messages this

249
00:09:49,389 --> 00:09:54,939
is kind of fun in a number of different

250
00:09:52,959 --> 00:09:57,008
ways but basically you can record short

251
00:09:54,939 --> 00:10:00,639
audio clips to send back and forth

252
00:09:57,009 --> 00:10:02,079
between echo devices so hey it's Karl

253
00:10:00,639 --> 00:10:03,639
just saying hi I wanted to send you a

254
00:10:02,079 --> 00:10:05,679
message something like that you can

255
00:10:03,639 --> 00:10:07,509
record that in the app and then go ahead

256
00:10:05,679 --> 00:10:09,429
and send it to the api's and that gets

257
00:10:07,509 --> 00:10:11,679
sent out to another echo device

258
00:10:09,429 --> 00:10:14,199
well there's message transcription

259
00:10:11,679 --> 00:10:15,939
available for this so you can just have

260
00:10:14,199 --> 00:10:17,618
it transcribed and it'll show up in the

261
00:10:15,939 --> 00:10:19,059
actual app so that you don't actually

262
00:10:17,619 --> 00:10:21,850
have to play it which is kind of handy

263
00:10:19,059 --> 00:10:23,589
but we can also do custom audio messages

264
00:10:21,850 --> 00:10:26,259
if we're able to intercept these

265
00:10:23,589 --> 00:10:29,199
requests so it's more fun part about

266
00:10:26,259 --> 00:10:29,980
this so that request is gonna look like

267
00:10:29,199 --> 00:10:32,859
this

268
00:10:29,980 --> 00:10:35,019
we did include true for include

269
00:10:32,860 --> 00:10:36,850
transcript here so that'll put it

270
00:10:35,019 --> 00:10:39,160
through the transcribing service so that

271
00:10:36,850 --> 00:10:40,899
you get text message listing there we

272
00:10:39,160 --> 00:10:42,699
can put false if we want to hide what

273
00:10:40,899 --> 00:10:45,610
the content of that message is going to

274
00:10:42,699 --> 00:10:47,529
be so it just plays the audio file but

275
00:10:45,610 --> 00:10:50,470
what you can see here is the content

276
00:10:47,529 --> 00:10:53,619
type in this HTTP request here is audio

277
00:10:50,470 --> 00:10:56,559
AAC and you can see here in kind of the

278
00:10:53,619 --> 00:10:59,199
file header information here m4a audio

279
00:10:56,559 --> 00:11:03,699
so this is basically just recording an

280
00:10:59,199 --> 00:11:07,240
m4a audio track and sending that file up

281
00:11:03,699 --> 00:11:10,599
to Amazon to upload to their cloud of

282
00:11:07,240 --> 00:11:13,529
stuff so once we have that audio file up

283
00:11:10,600 --> 00:11:17,049
in Amazon's Cloud we basically get a

284
00:11:13,529 --> 00:11:18,759
media ID and I'm leaving this one

285
00:11:17,049 --> 00:11:19,870
purposefully open here if somebody

286
00:11:18,759 --> 00:11:22,419
really wants to go ahead and type that

287
00:11:19,870 --> 00:11:24,490
out and see if they can access it let me

288
00:11:22,419 --> 00:11:27,310
know you'll find out what that is

289
00:11:24,490 --> 00:11:29,920
the next message but much like the text

290
00:11:27,310 --> 00:11:33,579
message we have our sender ID and the

291
00:11:29,920 --> 00:11:36,459
recipient ID and I've removed some other

292
00:11:33,580 --> 00:11:39,339
information in here as well but really

293
00:11:36,459 --> 00:11:41,380
you just upload your audio file and this

294
00:11:39,339 --> 00:11:43,630
you can actually overwrite I you can

295
00:11:41,380 --> 00:11:45,790
just go ahead with burb select over all

296
00:11:43,630 --> 00:11:47,620
of this file information here and then

297
00:11:45,790 --> 00:11:50,920
paste from file and you can go ahead and

298
00:11:47,620 --> 00:11:53,380
paste your own m4a file so that's what

299
00:11:50,920 --> 00:11:55,930
we've done here you could put whatever

300
00:11:53,380 --> 00:11:59,740
audio recording you want and that can be

301
00:11:55,930 --> 00:12:01,959
kind of fun so basically once we have

302
00:11:59,740 --> 00:12:03,970
that uploaded we send the link for that

303
00:12:01,959 --> 00:12:05,979
uploaded file within the message to a

304
00:12:03,970 --> 00:12:08,980
recipient they get an audio message

305
00:12:05,980 --> 00:12:11,680
again does not automatically play but

306
00:12:08,980 --> 00:12:14,500
does show up in the application it will

307
00:12:11,680 --> 00:12:18,399
show up with the green glowing ring on

308
00:12:14,500 --> 00:12:21,430
the echo so this one was kind of fun and

309
00:12:18,399 --> 00:12:24,730
totally mature of me and my coworker

310
00:12:21,430 --> 00:12:25,899
here but yeah I sent Alex message saying

311
00:12:24,730 --> 00:12:27,850
I'm gonna you know send you some

312
00:12:25,899 --> 00:12:31,480
messages about this so he responded no

313
00:12:27,850 --> 00:12:33,310
problem let her rip or let it rip so the

314
00:12:31,480 --> 00:12:37,630
mature response here is to send a fart

315
00:12:33,310 --> 00:12:39,790
noise so went out and found m4a audio

316
00:12:37,630 --> 00:12:41,950
for that sent that to him and he

317
00:12:39,790 --> 00:12:44,649
responded with I hope that was real so

318
00:12:41,950 --> 00:12:48,490
thanks to Alex for accepting all of

319
00:12:44,649 --> 00:12:49,870
these messages dealing with me so what

320
00:12:48,490 --> 00:12:52,510
can we do with this we understand how

321
00:12:49,870 --> 00:12:54,880
the text messages text messages are sent

322
00:12:52,510 --> 00:12:57,040
how the audio messages are sent and how

323
00:12:54,880 --> 00:12:59,410
we can enumerate contacts now

324
00:12:57,040 --> 00:13:01,029
legitimately sure you could upload all

325
00:12:59,410 --> 00:13:03,819
of your regular contacts people that you

326
00:13:01,029 --> 00:13:05,860
actually know and try to figure out who

327
00:13:03,820 --> 00:13:07,540
has an echo device well we could also

328
00:13:05,860 --> 00:13:10,060
try and make some new friends out around

329
00:13:07,540 --> 00:13:14,469
Portland there's two different primary

330
00:13:10,060 --> 00:13:18,160
area codes for Portland 503 and 971 the

331
00:13:14,470 --> 00:13:19,779
exchanges are the xxx part of those

332
00:13:18,160 --> 00:13:21,520
phone numbers so you've got your area

333
00:13:19,779 --> 00:13:23,680
code you've got an exchange and then

334
00:13:21,520 --> 00:13:27,189
you've got the four digits for a phone

335
00:13:23,680 --> 00:13:29,050
number between the two area codes five

336
00:13:27,190 --> 00:13:32,050
oh three and nine seven one you have

337
00:13:29,050 --> 00:13:34,359
eight hundred exchanges per area code so

338
00:13:32,050 --> 00:13:38,519
that equals sixteen hundred exchanges

339
00:13:34,360 --> 00:13:40,990
meaning you know 503 3 2 3 whatever

340
00:13:38,519 --> 00:13:43,089
1600 total exchanges between both of

341
00:13:40,990 --> 00:13:45,430
those area codes so that makes up for a

342
00:13:43,089 --> 00:13:47,380
lot of potential phone numbers 16

343
00:13:45,430 --> 00:13:49,420
million potential numbers to be exact

344
00:13:47,380 --> 00:13:51,970
you've got 10,000 numbers per exchange

345
00:13:49,420 --> 00:13:55,510
because they're four digits zero zero

346
00:13:51,970 --> 00:14:00,040
zero zero all the way through 9999 we've

347
00:13:55,510 --> 00:14:01,810
got 10,000 options there so how do we go

348
00:14:00,040 --> 00:14:04,719
about trying to go through all 16

349
00:14:01,810 --> 00:14:07,180
million of those numbers well we could

350
00:14:04,720 --> 00:14:10,450
use Google contacts we did look at that

351
00:14:07,180 --> 00:14:16,930
previous JSON upload everything in that

352
00:14:10,450 --> 00:14:19,149
and I don't know if I have yeah so

353
00:14:16,930 --> 00:14:22,209
actually with Google contacts they limit

354
00:14:19,149 --> 00:14:23,680
you at 25,000 contacts per account I

355
00:14:22,209 --> 00:14:26,800
actually have a source on that if

356
00:14:23,680 --> 00:14:29,319
anybody wants to see that but when we

357
00:14:26,800 --> 00:14:31,149
looked at that previous response or that

358
00:14:29,320 --> 00:14:34,269
previous request here for uploading

359
00:14:31,149 --> 00:14:35,740
contacts it's it's all serialized so

360
00:14:34,269 --> 00:14:38,649
everything's tagged and what you can see

361
00:14:35,740 --> 00:14:40,029
here and again apologize for that side

362
00:14:38,649 --> 00:14:43,360
of the room or it's a little bit harder

363
00:14:40,029 --> 00:14:48,010
to see you have a device contact ID so

364
00:14:43,360 --> 00:14:50,199
the top one we can see here is 25 8 to 8

365
00:14:48,010 --> 00:14:51,760
that may or may not mean that I've

366
00:14:50,199 --> 00:14:53,319
uploaded twenty five thousand eight

367
00:14:51,760 --> 00:14:58,180
hundred and twenty seven contacts prior

368
00:14:53,320 --> 00:15:00,490
to that uh but anyways as I said I you

369
00:14:58,180 --> 00:15:02,529
know it's serialized so that you've got

370
00:15:00,490 --> 00:15:03,940
that device contact ID that gets sent

371
00:15:02,529 --> 00:15:05,649
there you've got your phone number and

372
00:15:03,940 --> 00:15:08,199
you kind of iterate through that you

373
00:15:05,649 --> 00:15:10,329
could automate all of this through burp

374
00:15:08,199 --> 00:15:11,709
with the intruder functionality it's

375
00:15:10,329 --> 00:15:12,670
really handy way of just iterating

376
00:15:11,709 --> 00:15:13,899
through a bunch of different numbers

377
00:15:12,670 --> 00:15:15,519
since there were a couple of different

378
00:15:13,899 --> 00:15:16,990
spots we had to iterate through I

379
00:15:15,519 --> 00:15:18,640
figured it would just be easier to go

380
00:15:16,990 --> 00:15:23,010
ahead and just upload contacts for

381
00:15:18,640 --> 00:15:23,010
Google so I'll walk you through that

382
00:15:23,670 --> 00:15:29,199
okay

383
00:15:24,880 --> 00:15:31,779
so within Google as I mentioned you're

384
00:15:29,199 --> 00:15:34,599
limited to 25,000 contacts per account

385
00:15:31,779 --> 00:15:36,160
what I did and I actually did this for a

386
00:15:34,600 --> 00:15:39,250
different area code but here's a good

387
00:15:36,160 --> 00:15:41,439
example for 503 basically just created a

388
00:15:39,250 --> 00:15:45,010
contact spreadsheet of Google contacts

389
00:15:41,440 --> 00:15:47,290
to import ours 503 2 3 5 and then all

390
00:15:45,010 --> 00:15:49,480
four zeros and using some Excel

391
00:15:47,290 --> 00:15:51,610
spreadsheet magic with a CSV just

392
00:15:49,480 --> 00:15:53,470
iterated all the way down to 90

393
00:15:51,610 --> 00:15:57,010
99 and filled out the rest of those

394
00:15:53,470 --> 00:15:59,950
numbers so per contact upload you could

395
00:15:57,010 --> 00:16:02,079
do twenty-five thousand at a time you

396
00:15:59,950 --> 00:16:03,700
could cover two and a half exchanges per

397
00:16:02,079 --> 00:16:06,399
upload of contacts which would mean you

398
00:16:03,700 --> 00:16:08,860
need about six hundred and forty rounds

399
00:16:06,399 --> 00:16:11,320
of uploading your contacts up to Amazon

400
00:16:08,860 --> 00:16:13,570
with this method you could probably just

401
00:16:11,320 --> 00:16:15,550
automate that to I don't know exactly

402
00:16:13,570 --> 00:16:18,040
how many they cap on the actual JSON

403
00:16:15,550 --> 00:16:19,300
format but anyways you can probably

404
00:16:18,040 --> 00:16:27,790
speed that up a little bit if you used

405
00:16:19,300 --> 00:16:29,859
intruder that question yep so the

406
00:16:27,790 --> 00:16:32,079
question was could you set up a bunch of

407
00:16:29,860 --> 00:16:34,180
contacts upload them delete them and

408
00:16:32,079 --> 00:16:36,910
then upload twenty five thousand more

409
00:16:34,180 --> 00:16:38,769
yes so that's actually the process that

410
00:16:36,910 --> 00:16:43,469
I ended up doing with some of this was

411
00:16:38,769 --> 00:16:46,029
uploaded an entire exchange and then

412
00:16:43,470 --> 00:16:47,350
basically deleted those Google contacts

413
00:16:46,029 --> 00:16:48,790
from my phone signed out of the

414
00:16:47,350 --> 00:16:50,350
application if you're signed back into

415
00:16:48,790 --> 00:16:53,290
the application it will prompt you again

416
00:16:50,350 --> 00:16:56,649
to upload your contacts and then you can

417
00:16:53,290 --> 00:16:58,120
go ahead and reload so yeah like I said

418
00:16:56,649 --> 00:17:00,130
six hundred and forty rounds to cover

419
00:16:58,120 --> 00:17:02,440
all 16 million numbers in the Portland

420
00:17:00,130 --> 00:17:03,550
area for those two exchanges now granted

421
00:17:02,440 --> 00:17:05,439
there's a fair number of people that

422
00:17:03,550 --> 00:17:07,540
have moved in from out of state that may

423
00:17:05,439 --> 00:17:10,120
not have either one of those exchanges

424
00:17:07,540 --> 00:17:11,799
or either one of those area codes myself

425
00:17:10,119 --> 00:17:13,119
I actually have a six one two number I

426
00:17:11,799 --> 00:17:15,040
moved from Minneapolis a couple years

427
00:17:13,119 --> 00:17:17,229
ago and didn't want to change phone

428
00:17:15,040 --> 00:17:19,720
numbers so kind of guilty of that myself

429
00:17:17,230 --> 00:17:21,520
but this actually generates a ton of

430
00:17:19,720 --> 00:17:24,339
requests to Amazon right we're trying to

431
00:17:21,520 --> 00:17:26,530
look up 16 million numbers within the

432
00:17:24,339 --> 00:17:29,470
echo infrastructure they're going to

433
00:17:26,530 --> 00:17:32,020
notice they have detective controls in

434
00:17:29,470 --> 00:17:33,669
place to identify hey you know there's

435
00:17:32,020 --> 00:17:35,110
potential that if somebody's trying to

436
00:17:33,669 --> 00:17:38,440
enumerate all of these different phone

437
00:17:35,110 --> 00:17:40,870
numbers so for proof of concept as I was

438
00:17:38,440 --> 00:17:42,730
identifying this and this whole

439
00:17:40,870 --> 00:17:45,909
discussion actually kind of came out of

440
00:17:42,730 --> 00:17:47,500
a rain SEC discussion you know who's

441
00:17:45,910 --> 00:17:50,080
familiar with rain secures local

442
00:17:47,500 --> 00:17:52,360
security group meetup I frequent that

443
00:17:50,080 --> 00:17:54,549
pretty regularly so you can typically

444
00:17:52,360 --> 00:17:55,840
find me there but we were talking about

445
00:17:54,549 --> 00:17:57,400
you know what we could potentially do

446
00:17:55,840 --> 00:18:01,000
with this and talked about uploading

447
00:17:57,400 --> 00:18:05,100
contacts and the next day went back home

448
00:18:01,000 --> 00:18:05,100
and tried this with my six one two range

449
00:18:05,230 --> 00:18:11,440
basically in the Google contacts import

450
00:18:08,679 --> 00:18:13,630
here we just have a first name of test a

451
00:18:11,440 --> 00:18:16,210
last name of test and then whatever the

452
00:18:13,630 --> 00:18:19,330
last four digits are of that phone

453
00:18:16,210 --> 00:18:22,030
number that I'm uploading so 6 1 2 1 2 3

454
00:18:19,330 --> 00:18:23,260
all zeroes that way I could tie it back

455
00:18:22,030 --> 00:18:24,370
to what the actual phone number was

456
00:18:23,260 --> 00:18:27,280
because it's kind of hard to pull that

457
00:18:24,370 --> 00:18:30,610
out of the app and then uploaded those

458
00:18:27,280 --> 00:18:32,860
to Google so within my 6 1 2 range which

459
00:18:30,610 --> 00:18:34,990
is a cell phone range for kind of

460
00:18:32,860 --> 00:18:37,990
northern Minneapolis I was able to find

461
00:18:34,990 --> 00:18:41,080
65 different devices in that one kind of

462
00:18:37,990 --> 00:18:43,059
scan of that specific range so there's

463
00:18:41,080 --> 00:18:46,889
definitely potential to enumerate a

464
00:18:43,059 --> 00:18:51,760
number of different echo devices there

465
00:18:46,890 --> 00:18:53,620
let's see here oh one note on this if

466
00:18:51,760 --> 00:18:57,010
you were to do this and I would

467
00:18:53,620 --> 00:18:59,199
recommend against that this will

468
00:18:57,010 --> 00:19:02,440
actually significantly slow down your

469
00:18:59,200 --> 00:19:03,970
echo devices if you upload 25,000

470
00:19:02,440 --> 00:19:06,250
contacts and Amazon your echo device

471
00:19:03,970 --> 00:19:09,490
actually thinks you have 25,000 contacts

472
00:19:06,250 --> 00:19:11,799
so I only had like 15 actual contacts in

473
00:19:09,490 --> 00:19:14,770
here before added another 65 so we're

474
00:19:11,799 --> 00:19:16,690
looking at 75 real contacts but my echo

475
00:19:14,770 --> 00:19:19,960
thought that I had 25,000 phone numbers

476
00:19:16,690 --> 00:19:21,840
it had to keep track of this basically

477
00:19:19,960 --> 00:19:25,090
slowed my echo devices down to a crawl

478
00:19:21,840 --> 00:19:27,610
you would say Alexa give me the news and

479
00:19:25,090 --> 00:19:30,639
then five seconds later it would finally

480
00:19:27,610 --> 00:19:32,080
bring me the news so just more of a

481
00:19:30,640 --> 00:19:33,549
heads up if you have a ton of contacts

482
00:19:32,080 --> 00:19:36,070
on there it can really slow down to the

483
00:19:33,549 --> 00:19:38,230
device it also annoys other people in

484
00:19:36,070 --> 00:19:40,270
your household that may be utilizing the

485
00:19:38,230 --> 00:19:45,880
echo devices to say turn on lights or

486
00:19:40,270 --> 00:19:49,090
anything like that yeah so at this point

487
00:19:45,880 --> 00:19:52,150
we have roughly a city's worth of echo

488
00:19:49,090 --> 00:19:55,510
devices knowledge of the messaging

489
00:19:52,150 --> 00:19:57,460
protocols text and audio message and a

490
00:19:55,510 --> 00:20:00,070
moral obligation to do the right thing

491
00:19:57,460 --> 00:20:02,130
and I won't asking me to raise hands but

492
00:20:00,070 --> 00:20:04,840
there may be other CIS SPS in the room

493
00:20:02,130 --> 00:20:07,480
but I've worked with some people in the

494
00:20:04,840 --> 00:20:09,730
past we're very strict with adhering to

495
00:20:07,480 --> 00:20:13,750
the is C squared code of ethics I try to

496
00:20:09,730 --> 00:20:16,659
myself but yeah I do have a moral

497
00:20:13,750 --> 00:20:18,140
obligation to do so so I worked with

498
00:20:16,659 --> 00:20:19,940
Amazon to

499
00:20:18,140 --> 00:20:21,760
disclose all of this information I

500
00:20:19,940 --> 00:20:24,770
initially disclosed this back in June

501
00:20:21,760 --> 00:20:26,300
they implemented a couple of the

502
00:20:24,770 --> 00:20:27,530
features in line the call blocking

503
00:20:26,300 --> 00:20:29,750
feature which will talk about

504
00:20:27,530 --> 00:20:31,610
mitigations in a section in a second

505
00:20:29,750 --> 00:20:34,010
didn't actually have anything to do with

506
00:20:31,610 --> 00:20:36,560
me but they implemented that pretty soon

507
00:20:34,010 --> 00:20:39,680
after that and then I finally got

508
00:20:36,560 --> 00:20:42,590
approval to do this what all of eleven

509
00:20:39,680 --> 00:20:44,060
days ago something like that so they've

510
00:20:42,590 --> 00:20:45,379
been a great team to work with just for

511
00:20:44,060 --> 00:20:47,419
the record the people that I've worked

512
00:20:45,380 --> 00:20:50,450
with over at Amazon for disclosing this

513
00:20:47,420 --> 00:20:51,650
have been really cool about that I kind

514
00:20:50,450 --> 00:20:53,300
of a note on that there is some

515
00:20:51,650 --> 00:20:54,380
additional stuff that they're still kind

516
00:20:53,300 --> 00:20:57,200
of working on that I can't necessarily

517
00:20:54,380 --> 00:20:59,150
talk about in this talk so I apologize

518
00:20:57,200 --> 00:21:02,140
about that but hopefully that'll come

519
00:20:59,150 --> 00:21:05,180
out in the blog post in the future here

520
00:21:02,140 --> 00:21:07,100
so just a couple of notes on mitigations

521
00:21:05,180 --> 00:21:08,570
for this you know I can leave it up to

522
00:21:07,100 --> 00:21:10,459
you to kind of figure out what you could

523
00:21:08,570 --> 00:21:12,379
potentially do with all of this

524
00:21:10,460 --> 00:21:15,020
information we've talked about I can't

525
00:21:12,380 --> 00:21:16,250
tell you exactly all the bad things you

526
00:21:15,020 --> 00:21:17,750
could potentially do with all of this

527
00:21:16,250 --> 00:21:20,720
but I think people can kind of put two

528
00:21:17,750 --> 00:21:22,220
and two together here anyways Amazon

529
00:21:20,720 --> 00:21:23,930
already has detective controls in place

530
00:21:22,220 --> 00:21:25,550
to identify people that are trying to

531
00:21:23,930 --> 00:21:27,920
enumerate numbers through specific

532
00:21:25,550 --> 00:21:30,409
exchanges additionally you can block

533
00:21:27,920 --> 00:21:33,560
messages and calls from unwanted senders

534
00:21:30,410 --> 00:21:35,870
this actually came out of a completely

535
00:21:33,560 --> 00:21:37,550
different scenario so you know we showed

536
00:21:35,870 --> 00:21:40,100
you all right you upload a phone number

537
00:21:37,550 --> 00:21:41,629
it matches it to an echo device Amazon

538
00:21:40,100 --> 00:21:43,580
gives you the ability to reach out to

539
00:21:41,630 --> 00:21:45,290
that echo device and make phone calls

540
00:21:43,580 --> 00:21:46,790
well let's say that you have somebody in

541
00:21:45,290 --> 00:21:48,080
your life that you don't want to speak

542
00:21:46,790 --> 00:21:49,909
to but they happen to have your phone

543
00:21:48,080 --> 00:21:51,830
number they could potentially upload

544
00:21:49,910 --> 00:21:54,280
your phone number lookup your echo

545
00:21:51,830 --> 00:21:55,909
device and contact you through that so

546
00:21:54,280 --> 00:21:58,250
initially they didn't actually have

547
00:21:55,910 --> 00:22:01,400
options to block numbers Amazon actually

548
00:21:58,250 --> 00:22:03,560
implemented that mid June so it's

549
00:22:01,400 --> 00:22:05,090
definitely a very good thing because you

550
00:22:03,560 --> 00:22:06,889
know either unwanted messages from

551
00:22:05,090 --> 00:22:08,659
somebody you don't know or from somebody

552
00:22:06,890 --> 00:22:12,230
you do know you can definitely block

553
00:22:08,660 --> 00:22:14,450
those through the Alexa app one of the

554
00:22:12,230 --> 00:22:16,190
things they are currently working on is

555
00:22:14,450 --> 00:22:17,570
enabling cert pinning for all of the API

556
00:22:16,190 --> 00:22:20,630
calls so pretty much everything we

557
00:22:17,570 --> 00:22:22,639
showed you intercepting with burp all of

558
00:22:20,630 --> 00:22:25,400
those API requests everything like that

559
00:22:22,640 --> 00:22:28,280
they did not have certain required so

560
00:22:25,400 --> 00:22:30,170
basically requiring a specific SSL

561
00:22:28,280 --> 00:22:31,590
certificate to allow communication

562
00:22:30,170 --> 00:22:34,169
between the

563
00:22:31,590 --> 00:22:36,120
ocation and Amazon there are some

564
00:22:34,169 --> 00:22:39,240
bypasses for that but it would be at

565
00:22:36,120 --> 00:22:41,039
least a barrier to entry to actually get

566
00:22:39,240 --> 00:22:42,150
to those API calls and reverse all of

567
00:22:41,039 --> 00:22:44,309
that so that's something are currently

568
00:22:42,150 --> 00:22:45,720
working on well another thing that was

569
00:22:44,309 --> 00:22:47,820
kind of a recommendation on my side was

570
00:22:45,720 --> 00:22:51,270
limiting the reception recipients of an

571
00:22:47,820 --> 00:22:52,950
audio message so the wonderfully mature

572
00:22:51,270 --> 00:22:55,620
fart message that we sent out to Alex

573
00:22:52,950 --> 00:22:57,510
earlier in the presentation here that

574
00:22:55,620 --> 00:22:59,250
could actually be potentially sent out

575
00:22:57,510 --> 00:23:02,360
to other recipients because it's just a

576
00:22:59,250 --> 00:23:05,370
file blob that you're sending a link to

577
00:23:02,360 --> 00:23:07,139
within the messaging API so you could

578
00:23:05,370 --> 00:23:09,479
potentially reuse that to send to

579
00:23:07,140 --> 00:23:11,730
another recipient so this would kind of

580
00:23:09,480 --> 00:23:14,450
require people to re-upload audio files

581
00:23:11,730 --> 00:23:18,000
as part of that kind of slow people down

582
00:23:14,450 --> 00:23:19,320
so quick thanks thanks for everybody at

583
00:23:18,000 --> 00:23:22,230
rainstick that I kind of talked through

584
00:23:19,320 --> 00:23:23,490
the initial ideas of this with gave me

585
00:23:22,230 --> 00:23:25,740
some really good ideas as to what

586
00:23:23,490 --> 00:23:28,470
direction to take this thanks to

587
00:23:25,740 --> 00:23:30,559
everybody here at besides PDX for having

588
00:23:28,470 --> 00:23:33,179
me speak here and for showing up today

589
00:23:30,559 --> 00:23:35,460
specifically my Nets by coworkers Eric

590
00:23:33,179 --> 00:23:37,409
Alex and Chris who all had EKKO devices

591
00:23:35,460 --> 00:23:40,710
and put up with a ton of messages from

592
00:23:37,409 --> 00:23:43,080
me we also kind of fuzzed on other stuff

593
00:23:40,710 --> 00:23:45,450
like cross-site scripting or you know

594
00:23:43,080 --> 00:23:46,860
other types of links and other things

595
00:23:45,450 --> 00:23:48,809
that we could send through the actual

596
00:23:46,860 --> 00:23:51,120
api's and they dealt with a ton of

597
00:23:48,809 --> 00:23:53,760
messages from me on that side so thanks

598
00:23:51,120 --> 00:23:55,289
to them Tom and Carrie over at Amazon

599
00:23:53,760 --> 00:23:57,539
security for working with me through the

600
00:23:55,289 --> 00:24:00,120
disclosure process they've been really

601
00:23:57,539 --> 00:24:02,460
really helpful and worked with me to get

602
00:24:00,120 --> 00:24:05,100
approval for all of this went over

603
00:24:02,460 --> 00:24:08,190
slides and everything and been very very

604
00:24:05,100 --> 00:24:09,870
helpful there and thanks to my wife for

605
00:24:08,190 --> 00:24:11,159
dealing with the incredibly slow echo

606
00:24:09,870 --> 00:24:14,610
devices for a couple of weeks while I

607
00:24:11,159 --> 00:24:16,529
was doing this I think she was a little

608
00:24:14,610 --> 00:24:17,789
upset when you know she tried to turn on

609
00:24:16,529 --> 00:24:19,110
the kitchen lights and it takes five

610
00:24:17,789 --> 00:24:20,908
seconds and you're just standing in the

611
00:24:19,110 --> 00:24:22,529
dark waiting for the kitchen lights to

612
00:24:20,909 --> 00:24:26,399
turn on and like oh I'll just hit the

613
00:24:22,529 --> 00:24:27,870
switch so thanks to her I think I've got

614
00:24:26,399 --> 00:24:30,529
a couple minutes left here does anybody

615
00:24:27,870 --> 00:24:30,529
have any questions

616
00:24:37,120 --> 00:24:39,179
you

