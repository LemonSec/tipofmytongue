1
00:00:01,439 --> 00:00:05,120
okay ladies and gentlemen uh we have our

2
00:00:05,120 --> 00:00:07,759
final speaker of the morning session

3
00:00:07,759 --> 00:00:10,320
andres tevez speaking

4
00:00:10,320 --> 00:00:12,880
with us about offensive rust tales not

5
00:00:12,880 --> 00:00:16,800
too offensive we hope

6
00:00:16,800 --> 00:00:19,920
no definitely not

7
00:00:21,520 --> 00:00:24,880
okay so i am happy to be here and after

8
00:00:24,880 --> 00:00:26,880
the past two years behind webcams this

9
00:00:26,880 --> 00:00:28,840
is great

10
00:00:28,840 --> 00:00:31,039
um okay

11
00:00:31,039 --> 00:00:34,079
who else did participate in red teaming

12
00:00:34,079 --> 00:00:36,320
in the past years

13
00:00:36,320 --> 00:00:38,559
in the room

14
00:00:38,559 --> 00:00:41,120
okay at least one guy

15
00:00:41,120 --> 00:00:42,840
that's something

16
00:00:42,840 --> 00:00:47,600
okay would you like to execute my binary

17
00:00:47,600 --> 00:00:50,160
okay that's good

18
00:00:50,160 --> 00:00:51,520
so

19
00:00:51,520 --> 00:00:53,840
how many guys are you using corporate

20
00:00:53,840 --> 00:00:56,399
laptops

21
00:00:56,719 --> 00:00:59,359
okay some of you most of you use windows

22
00:00:59,359 --> 00:01:00,640
i assume

23
00:01:00,640 --> 00:01:03,680
and do you use office like

24
00:01:03,680 --> 00:01:06,479
openoffice or microsoft office

25
00:01:06,479 --> 00:01:08,400
if microsoft office then this will be an

26
00:01:08,400 --> 00:01:11,360
interesting presentation

27
00:01:11,360 --> 00:01:12,400
okay

28
00:01:12,400 --> 00:01:15,119
about me i am andres davis

29
00:01:15,119 --> 00:01:16,799
currently working as a senior i.t

30
00:01:16,799 --> 00:01:19,600
security researcher at kujo ai i have

31
00:01:19,600 --> 00:01:21,759
more than 15 years i.t security

32
00:01:21,759 --> 00:01:24,320
experience on different fields

33
00:01:24,320 --> 00:01:27,040
like i was a developer researcher

34
00:01:27,040 --> 00:01:29,520
penetration tester

35
00:01:29,520 --> 00:01:32,159
and i think many more things

36
00:01:32,159 --> 00:01:36,000
you may run my code in production

37
00:01:36,000 --> 00:01:38,479
if you use syslog ng for example then

38
00:01:38,479 --> 00:01:42,079
that might be some of my codes

39
00:01:42,079 --> 00:01:43,680
okay i have done

40
00:01:43,680 --> 00:01:46,720
security research in the past 10 years

41
00:01:46,720 --> 00:01:48,000
more than that

42
00:01:48,000 --> 00:01:49,759
but it's rather hard to present on a

43
00:01:49,759 --> 00:01:51,759
conference if you are not called a

44
00:01:51,759 --> 00:01:53,759
security researcher

45
00:01:53,759 --> 00:01:55,920
so when i was working at a bigger

46
00:01:55,920 --> 00:01:58,560
company like morgan stanley and i am

47
00:01:58,560 --> 00:02:01,439
going to my pr team that okay i hacked

48
00:02:01,439 --> 00:02:02,960
this and i would like to present about

49
00:02:02,960 --> 00:02:05,040
it then they said no

50
00:02:05,040 --> 00:02:07,439
please no please don't so

51
00:02:07,439 --> 00:02:09,280
i changed and now i am trying to present

52
00:02:09,280 --> 00:02:11,360
something

53
00:02:11,360 --> 00:02:13,440
the presentation will be mostly about

54
00:02:13,440 --> 00:02:15,520
red teaming 101 because we have only one

55
00:02:15,520 --> 00:02:18,000
guy who participated that's great it

56
00:02:18,000 --> 00:02:20,480
might be helpful for you guys

57
00:02:20,480 --> 00:02:22,560
i will provide some details about

58
00:02:22,560 --> 00:02:24,560
when should you do

59
00:02:24,560 --> 00:02:26,640
red teaming when should you

60
00:02:26,640 --> 00:02:28,800
execute it what is it called who should

61
00:02:28,800 --> 00:02:30,080
it look like

62
00:02:30,080 --> 00:02:32,319
who should do that and

63
00:02:32,319 --> 00:02:36,440
of course why should you do that

64
00:02:39,920 --> 00:02:41,920
okay

65
00:02:41,920 --> 00:02:44,560
so a red team is a group of professional

66
00:02:44,560 --> 00:02:46,720
people hopefully professional

67
00:02:46,720 --> 00:02:49,360
and this is the key authorized to do

68
00:02:49,360 --> 00:02:51,120
something

69
00:02:51,120 --> 00:02:53,280
like emulated attack

70
00:02:53,280 --> 00:02:55,440
achieve something gain access to your

71
00:02:55,440 --> 00:02:56,879
systems

72
00:02:56,879 --> 00:02:59,920
and is it is it familiar for you so did

73
00:02:59,920 --> 00:03:02,840
you do something similar like maybe pen

74
00:03:02,840 --> 00:03:06,080
tests yeah it's similar

75
00:03:06,080 --> 00:03:08,159
if if you go to a pentester company and

76
00:03:08,159 --> 00:03:09,920
ask them to do something they will focus

77
00:03:09,920 --> 00:03:11,360
on an application

78
00:03:11,360 --> 00:03:14,720
or a website or or some mostly simple

79
00:03:14,720 --> 00:03:15,599
thing

80
00:03:15,599 --> 00:03:17,760
and they will have a limited time

81
00:03:17,760 --> 00:03:19,200
because

82
00:03:19,200 --> 00:03:22,400
you won't pay much enough for them so in

83
00:03:22,400 --> 00:03:24,319
most cases it will be 10 days or

84
00:03:24,319 --> 00:03:26,480
something and one or two guys will be

85
00:03:26,480 --> 00:03:28,400
there or will help you

86
00:03:28,400 --> 00:03:30,720
so time is limited and the penetration

87
00:03:30,720 --> 00:03:33,360
test in the most case is rather noisy so

88
00:03:33,360 --> 00:03:36,080
if you have a team who can detect they

89
00:03:36,080 --> 00:03:37,680
feel detected

90
00:03:37,680 --> 00:03:39,440
if they are not sleeping

91
00:03:39,440 --> 00:03:41,200
red team on the other hand is a bit

92
00:03:41,200 --> 00:03:43,920
different because in that case you have

93
00:03:43,920 --> 00:03:44,840
those

94
00:03:44,840 --> 00:03:48,879
guys so red team is is more complex

95
00:03:48,879 --> 00:03:51,360
because in that case you are not really

96
00:03:51,360 --> 00:03:53,120
focusing on generating as many

97
00:03:53,120 --> 00:03:55,840
vulnerabilities as possible in a network

98
00:03:55,840 --> 00:03:58,720
rather you are focusing on how to do it

99
00:03:58,720 --> 00:04:00,720
end to end and what will happen from the

100
00:04:00,720 --> 00:04:04,560
other side so if you have a blue team

101
00:04:04,560 --> 00:04:06,080
most of most of us don't have a blue

102
00:04:06,080 --> 00:04:08,159
team but if we would have one

103
00:04:08,159 --> 00:04:10,319
then that blue team should detect an

104
00:04:10,319 --> 00:04:12,080
attack and if the red team is good

105
00:04:12,080 --> 00:04:13,200
enough

106
00:04:13,200 --> 00:04:15,439
they can fight and that could be

107
00:04:15,439 --> 00:04:16,959
interesting

108
00:04:16,959 --> 00:04:19,759
so red team is more time it takes more

109
00:04:19,759 --> 00:04:22,479
time it takes more resources and as well

110
00:04:22,479 --> 00:04:24,560
it takes more money

111
00:04:24,560 --> 00:04:26,639
but it should be more silent than a

112
00:04:26,639 --> 00:04:28,720
simple penetration testing

113
00:04:28,720 --> 00:04:30,639
maybe you have heard something about

114
00:04:30,639 --> 00:04:33,680
ransomware gangs is it similar

115
00:04:33,680 --> 00:04:34,479
or

116
00:04:34,479 --> 00:04:37,360
is it yes it's rather similar but in

117
00:04:37,360 --> 00:04:39,840
that case you pay much more

118
00:04:39,840 --> 00:04:41,680
and you lose some data as well so not

119
00:04:41,680 --> 00:04:44,240
that serious

120
00:04:44,400 --> 00:04:46,000
so

121
00:04:46,000 --> 00:04:48,400
why are we doing this

122
00:04:48,400 --> 00:04:50,240
i am doing this because it's fun and

123
00:04:50,240 --> 00:04:53,040
it's interesting and challenging

124
00:04:53,040 --> 00:04:55,280
from a customer viewpoint or from the

125
00:04:55,280 --> 00:04:57,040
business viewpoint

126
00:04:57,040 --> 00:05:00,560
it's a relatively safe option because

127
00:05:00,560 --> 00:05:03,360
you know who is coming you can define a

128
00:05:03,360 --> 00:05:05,919
target you can tell them this is the

129
00:05:05,919 --> 00:05:08,160
service that you should reach this is

130
00:05:08,160 --> 00:05:10,639
our amazon production service if you can

131
00:05:10,639 --> 00:05:12,320
reach that then

132
00:05:12,320 --> 00:05:14,080
we are we are happy and and please

133
00:05:14,080 --> 00:05:16,479
document what you did

134
00:05:16,479 --> 00:05:19,600
okay next up is the who

135
00:05:19,600 --> 00:05:22,479
if you are a big company then you should

136
00:05:22,479 --> 00:05:24,400
have a right team so it's an internal

137
00:05:24,400 --> 00:05:26,639
one

138
00:05:26,639 --> 00:05:29,120
you maintain that team you pay them lots

139
00:05:29,120 --> 00:05:30,960
of money and then they play with your

140
00:05:30,960 --> 00:05:32,880
network and if they are good then they

141
00:05:32,880 --> 00:05:35,120
will kill the network and everybody will

142
00:05:35,120 --> 00:05:36,880
be happy

143
00:05:36,880 --> 00:05:39,039
in hungary the more realistic way is to

144
00:05:39,039 --> 00:05:41,039
pay for someone and

145
00:05:41,039 --> 00:05:42,639
search for a professional company who

146
00:05:42,639 --> 00:05:45,039
can do that for you

147
00:05:45,039 --> 00:05:47,120
i am not sure if there is one in hungary

148
00:05:47,120 --> 00:05:47,919
but

149
00:05:47,919 --> 00:05:50,560
did you see

150
00:05:50,880 --> 00:05:53,840
and other question is then should you do

151
00:05:53,840 --> 00:05:55,440
that

152
00:05:55,440 --> 00:05:58,400
if your organization is prepared and if

153
00:05:58,400 --> 00:06:00,240
your organization is at least partially

154
00:06:00,240 --> 00:06:02,319
confident that they can catch an

155
00:06:02,319 --> 00:06:04,560
intruder and by catching an intruder i

156
00:06:04,560 --> 00:06:06,400
don't mean that grabbing his hand at the

157
00:06:06,400 --> 00:06:09,280
gate and then taking away to a back room

158
00:06:09,280 --> 00:06:11,199
rather catching them on the network and

159
00:06:11,199 --> 00:06:12,720
if they are doing something like

160
00:06:12,720 --> 00:06:15,199
executing an unsigned application on

161
00:06:15,199 --> 00:06:17,039
your corporate laptop and then gaining

162
00:06:17,039 --> 00:06:19,199
other excesses and you can catch that

163
00:06:19,199 --> 00:06:22,240
then you are there you should you should

164
00:06:22,240 --> 00:06:24,800
start a red team exercise

165
00:06:24,800 --> 00:06:25,759
so

166
00:06:25,759 --> 00:06:28,400
bvv

167
00:06:28,960 --> 00:06:31,039
i found this

168
00:06:31,039 --> 00:06:32,720
for my presentation when i was looking

169
00:06:32,720 --> 00:06:34,960
up for documents this is a great

170
00:06:34,960 --> 00:06:37,199
representation how all the teams should

171
00:06:37,199 --> 00:06:39,600
cooperate in a network or not in a

172
00:06:39,600 --> 00:06:43,280
network really in a company

173
00:06:43,280 --> 00:06:46,240
this is valid for a huge company like

174
00:06:46,240 --> 00:06:50,400
fortune 500 14 000 if your company is

175
00:06:50,400 --> 00:06:52,880
let's say 100 people then you definitely

176
00:06:52,880 --> 00:06:55,360
won't need this or all of this

177
00:06:55,360 --> 00:06:57,919
but you would need some

178
00:06:57,919 --> 00:06:59,120
yellow team

179
00:06:59,120 --> 00:07:00,960
you know yellow team most of you most of

180
00:07:00,960 --> 00:07:02,639
you are developers so if you are a

181
00:07:02,639 --> 00:07:04,560
developer you are part of the yellow

182
00:07:04,560 --> 00:07:06,080
team

183
00:07:06,080 --> 00:07:08,880
there are green teams

184
00:07:08,880 --> 00:07:12,720
devops sec devops something like that

185
00:07:12,720 --> 00:07:14,160
yellow

186
00:07:14,160 --> 00:07:16,319
that was okay so orange team is

187
00:07:16,319 --> 00:07:18,000
basically training

188
00:07:18,000 --> 00:07:19,759
if you are learning something about

189
00:07:19,759 --> 00:07:21,280
fishing if you are learning something

190
00:07:21,280 --> 00:07:24,880
new then that should be done by the

191
00:07:24,880 --> 00:07:26,160
yellow team

192
00:07:26,160 --> 00:07:27,199
orange team

193
00:07:27,199 --> 00:07:29,520
and i will talk about red teaming and i

194
00:07:29,520 --> 00:07:30,479
am

195
00:07:30,479 --> 00:07:32,160
blue team is the opposite of the red

196
00:07:32,160 --> 00:07:33,919
team they are trying to defend the

197
00:07:33,919 --> 00:07:36,720
network if they catch you then you might

198
00:07:36,720 --> 00:07:38,880
get fired if you have a paper that you

199
00:07:38,880 --> 00:07:41,039
can do that you might not get fired you

200
00:07:41,039 --> 00:07:43,199
might get a promotion

201
00:07:43,199 --> 00:07:45,919
and the purple theme is when you are

202
00:07:45,919 --> 00:07:47,599
mature enough and

203
00:07:47,599 --> 00:07:49,360
all your red teaming is willing to do

204
00:07:49,360 --> 00:07:51,680
blue team stuff and the other then they

205
00:07:51,680 --> 00:07:54,800
are merged into a purple team

206
00:07:54,800 --> 00:07:55,680
okay

207
00:07:55,680 --> 00:07:59,039
let's see at the typical attack scenario

208
00:07:59,039 --> 00:08:01,199
how this should work

209
00:08:01,199 --> 00:08:03,360
normally we start with information

210
00:08:03,360 --> 00:08:05,599
gathering if you have an internal team

211
00:08:05,599 --> 00:08:08,160
this is rather easy you sit down

212
00:08:08,160 --> 00:08:10,319
and go and ask the users

213
00:08:10,319 --> 00:08:12,160
if it's an external company then they

214
00:08:12,160 --> 00:08:14,560
should go and look up data

215
00:08:14,560 --> 00:08:17,280
in their wasn't way so go to showdown

216
00:08:17,280 --> 00:08:19,039
dns dumpster

217
00:08:19,039 --> 00:08:22,160
execute port scans go to linkedin

218
00:08:22,160 --> 00:08:24,000
maybe you could

219
00:08:24,000 --> 00:08:27,039
go and try to get a job at the company

220
00:08:27,039 --> 00:08:29,599
just saying if you call hr hr will

221
00:08:29,599 --> 00:08:31,680
provide you lots of information like

222
00:08:31,680 --> 00:08:33,599
what systems are we using

223
00:08:33,599 --> 00:08:34,880
what uh

224
00:08:34,880 --> 00:08:37,200
competencies are we lack of because we

225
00:08:37,200 --> 00:08:39,279
would like to hire someone so we should

226
00:08:39,279 --> 00:08:42,000
not have that right

227
00:08:42,000 --> 00:08:43,679
okay

228
00:08:43,679 --> 00:08:47,360
the next step is to decide how to evade

229
00:08:47,360 --> 00:08:49,839
and how to get into the system

230
00:08:49,839 --> 00:08:51,200
most cases

231
00:08:51,200 --> 00:08:54,560
most companies are using emails or slack

232
00:08:54,560 --> 00:08:56,720
but email is more common because it's

233
00:08:56,720 --> 00:08:59,120
more integrated with the external world

234
00:08:59,120 --> 00:09:01,040
so you might get an email

235
00:09:01,040 --> 00:09:03,360
in the past time you might get a

236
00:09:03,360 --> 00:09:05,040
phishing email

237
00:09:05,040 --> 00:09:07,760
protection training like what you should

238
00:09:07,760 --> 00:09:09,760
not do like click on a link and don't

239
00:09:09,760 --> 00:09:11,760
download it if you download it don't

240
00:09:11,760 --> 00:09:14,399
execute it if you execute it

241
00:09:14,399 --> 00:09:16,480
then don't

242
00:09:16,480 --> 00:09:18,640
let it drive your show why

243
00:09:18,640 --> 00:09:19,519
so

244
00:09:19,519 --> 00:09:21,680
infiltration gets somehow into the

245
00:09:21,680 --> 00:09:23,839
network

246
00:09:24,959 --> 00:09:27,920
physical access in

247
00:09:27,920 --> 00:09:30,080
in the modern world like

248
00:09:30,080 --> 00:09:31,600
best from here

249
00:09:31,600 --> 00:09:34,160
you can you can do physical access red

250
00:09:34,160 --> 00:09:36,480
teaming like get into an office

251
00:09:36,480 --> 00:09:38,800
and use your lock picks and pick the

252
00:09:38,800 --> 00:09:41,040
office door and get into the office and

253
00:09:41,040 --> 00:09:43,519
see how can you get access to a server

254
00:09:43,519 --> 00:09:45,360
room normally we have a server room

255
00:09:45,360 --> 00:09:47,600
that's well protected but there might be

256
00:09:47,600 --> 00:09:51,839
a back door and that's direct aiming for

257
00:09:52,080 --> 00:09:55,279
okay let's assume that

258
00:09:55,279 --> 00:09:57,680
somehow you did send in an email or you

259
00:09:57,680 --> 00:10:00,480
did you did send in a link and you have

260
00:10:00,480 --> 00:10:03,200
at least one user who was

261
00:10:03,200 --> 00:10:06,800
somehow asked to execute that binary

262
00:10:06,800 --> 00:10:08,560
we call the stager

263
00:10:08,560 --> 00:10:10,720
the next part of the presentation will

264
00:10:10,720 --> 00:10:12,640
be more about stagers and how they

265
00:10:12,640 --> 00:10:15,120
should work

266
00:10:16,839 --> 00:10:21,200
okay corporate laptop yes

267
00:10:27,120 --> 00:10:30,160
no i don't want to do that

268
00:10:30,160 --> 00:10:31,600
so

269
00:10:31,600 --> 00:10:34,160
gain initial access execute something

270
00:10:34,160 --> 00:10:36,800
it can be a file it can be a binary it

271
00:10:36,800 --> 00:10:38,240
can be anything

272
00:10:38,240 --> 00:10:40,000
in a microsoft environment you can

273
00:10:40,000 --> 00:10:42,640
execute help files and those have files

274
00:10:42,640 --> 00:10:44,880
can execute other binaries

275
00:10:44,880 --> 00:10:47,279
or you can execute you can open an excel

276
00:10:47,279 --> 00:10:49,200
file and those extra files could execute

277
00:10:49,200 --> 00:10:52,399
binaries like commands or poover shell

278
00:10:52,399 --> 00:10:56,399
you know excel is great in powershell

279
00:10:56,399 --> 00:10:59,279
and if somehow you executed your binary

280
00:10:59,279 --> 00:11:01,600
then that's the last phase

281
00:11:01,600 --> 00:11:04,560
then you are going for the target

282
00:11:04,560 --> 00:11:06,480
just an example if you have a production

283
00:11:06,480 --> 00:11:08,399
system production system is running on

284
00:11:08,399 --> 00:11:09,839
aws

285
00:11:09,839 --> 00:11:12,320
then the red team should get access to

286
00:11:12,320 --> 00:11:16,000
the aws systems like use vpn but vpn is

287
00:11:16,000 --> 00:11:18,160
very protected is it not

288
00:11:18,160 --> 00:11:21,040
like security tokens passwords and and

289
00:11:21,040 --> 00:11:25,120
sessions and and all the other stuff

290
00:11:25,200 --> 00:11:26,839
okay let's move

291
00:11:26,839 --> 00:11:30,079
forward so

292
00:11:30,079 --> 00:11:31,519
as i mentioned

293
00:11:31,519 --> 00:11:33,440
with sending an email

294
00:11:33,440 --> 00:11:36,399
the victim is somewhat known we did our

295
00:11:36,399 --> 00:11:39,040
homework we did collect his

296
00:11:39,040 --> 00:11:40,000
i don't know

297
00:11:40,000 --> 00:11:43,279
laptop we know that he's running windows

298
00:11:43,279 --> 00:11:44,959
we know that

299
00:11:44,959 --> 00:11:46,399
what components are running on his

300
00:11:46,399 --> 00:11:48,320
laptop like we know at least the

301
00:11:48,320 --> 00:11:51,040
antivirus maybe we know the version

302
00:11:51,040 --> 00:11:53,680
maybe we might know the firewalls

303
00:11:53,680 --> 00:11:56,240
if there is any

304
00:11:56,240 --> 00:12:00,240
he downloaded the binary or stager

305
00:12:00,240 --> 00:12:02,160
and then

306
00:12:02,160 --> 00:12:04,160
here we must bypass some protections

307
00:12:04,160 --> 00:12:05,839
like if you download something from the

308
00:12:05,839 --> 00:12:08,000
internet the browser is telling you that

309
00:12:08,000 --> 00:12:10,160
don't do that don't execute it no no no

310
00:12:10,160 --> 00:12:12,240
but you are executing it because you

311
00:12:12,240 --> 00:12:14,079
would like to do something

312
00:12:14,079 --> 00:12:17,120
you would like to update a system so

313
00:12:17,120 --> 00:12:19,839
if i for example call you by phone and

314
00:12:19,839 --> 00:12:22,320
tell you that i am from i don't know an

315
00:12:22,320 --> 00:12:24,560
antivirus company and i will push you an

316
00:12:24,560 --> 00:12:26,639
update and this update is rather

317
00:12:26,639 --> 00:12:28,639
important because if you don't execute

318
00:12:28,639 --> 00:12:29,920
it then

319
00:12:29,920 --> 00:12:32,560
your ships will die or i don't know or

320
00:12:32,560 --> 00:12:34,639
your apes will be lost that's that's

321
00:12:34,639 --> 00:12:35,519
better

322
00:12:35,519 --> 00:12:38,240
you you will lose your apes

323
00:12:38,240 --> 00:12:41,440
so you execute it

324
00:12:41,600 --> 00:12:43,200
the execution

325
00:12:43,200 --> 00:12:44,480
will download something from the

326
00:12:44,480 --> 00:12:45,600
internet

327
00:12:45,600 --> 00:12:48,480
that's the red theme

328
00:12:49,200 --> 00:12:51,200
in my case in this

329
00:12:51,200 --> 00:12:53,279
later demo

330
00:12:53,279 --> 00:12:54,880
i downloaded

331
00:12:54,880 --> 00:12:58,160
pp and i will dab it later poopy because

332
00:12:58,160 --> 00:12:58,959
it's

333
00:12:58,959 --> 00:13:00,560
it resonates better

334
00:13:00,560 --> 00:13:02,720
how we should use that application

335
00:13:02,720 --> 00:13:05,680
so it's poopy and puppy

336
00:13:05,680 --> 00:13:09,040
and also we have a component called

337
00:13:09,040 --> 00:13:11,200
hiddenvnc

338
00:13:11,200 --> 00:13:13,760
but my

339
00:13:16,320 --> 00:13:18,639
sorry

340
00:13:18,720 --> 00:13:20,720
whatever

341
00:13:20,720 --> 00:13:23,839
so let's hide them vnc behind that

342
00:13:23,839 --> 00:13:26,560
connect to me

343
00:13:26,560 --> 00:13:28,480
item vnc will be interesting at the

344
00:13:28,480 --> 00:13:30,320
later stage

345
00:13:30,320 --> 00:13:33,760
and if hyden vs is rather similar to vnc

346
00:13:33,760 --> 00:13:36,240
you can get access to a computer

347
00:13:36,240 --> 00:13:38,320
and you can run applications on that

348
00:13:38,320 --> 00:13:41,120
computer the good thing is that you can

349
00:13:41,120 --> 00:13:43,199
see the output of that application but

350
00:13:43,199 --> 00:13:44,800
the user can see

351
00:13:44,800 --> 00:13:47,040
so you can copy things and execute

352
00:13:47,040 --> 00:13:49,279
browsers you will see the browser window

353
00:13:49,279 --> 00:13:51,360
but the user won't see it

354
00:13:51,360 --> 00:13:53,440
you will have the same session

355
00:13:53,440 --> 00:13:56,240
and with that access you you can access

356
00:13:56,240 --> 00:13:58,560
anything in the browser like cookies

357
00:13:58,560 --> 00:14:00,839
tokens

358
00:14:00,839 --> 00:14:04,000
sso if you have password save in your

359
00:14:04,000 --> 00:14:05,199
browser

360
00:14:05,199 --> 00:14:07,279
maybe then that's also there and it's

361
00:14:07,279 --> 00:14:09,440
also accessible

362
00:14:09,440 --> 00:14:13,360
so that will be the demo later

363
00:14:13,920 --> 00:14:17,839
let's get back to information gathering

364
00:14:21,040 --> 00:14:22,800
here i would like to provide some

365
00:14:22,800 --> 00:14:23,839
details

366
00:14:23,839 --> 00:14:26,800
during my investigation how to how to

367
00:14:26,800 --> 00:14:30,560
discover valid users in a system i did

368
00:14:30,560 --> 00:14:31,920
run into this

369
00:14:31,920 --> 00:14:34,079
i tried to report this but nobody really

370
00:14:34,079 --> 00:14:37,279
was interested and after

371
00:14:37,279 --> 00:14:39,279
i think two days two or three days ago i

372
00:14:39,279 --> 00:14:41,040
discovered that this is well known so it

373
00:14:41,040 --> 00:14:43,120
was just new for me

374
00:14:43,120 --> 00:14:46,880
but it's interesting

375
00:14:46,880 --> 00:14:48,480
so

376
00:14:48,480 --> 00:14:51,199
information gathering

377
00:14:51,199 --> 00:14:53,120
do you know microsoft

378
00:14:53,120 --> 00:14:54,959
yes yes we know

379
00:14:54,959 --> 00:14:57,199
and do you know azure most of you are

380
00:14:57,199 --> 00:14:59,600
using i assume azure ads

381
00:14:59,600 --> 00:15:00,560
maybe

382
00:15:00,560 --> 00:15:04,160
maybe microsoft office from the browser

383
00:15:04,160 --> 00:15:06,800
how are you authenticating to that

384
00:15:06,800 --> 00:15:08,959
yes it's out2

385
00:15:08,959 --> 00:15:12,000
and o2 is great because it's integrated

386
00:15:12,000 --> 00:15:13,839
all the user likes it

387
00:15:13,839 --> 00:15:16,079
they can get in without providing new

388
00:15:16,079 --> 00:15:19,920
passwords so it's a great thing

389
00:15:20,639 --> 00:15:22,399
this is a window if you are trying to

390
00:15:22,399 --> 00:15:25,839
log into office you will see this window

391
00:15:25,839 --> 00:15:29,199
and it depends on what data you put in

392
00:15:29,199 --> 00:15:31,360
if you use your private email address it

393
00:15:31,360 --> 00:15:33,839
will show you something if you use your

394
00:15:33,839 --> 00:15:35,839
corporate email address it will show you

395
00:15:35,839 --> 00:15:37,759
totally different thing

396
00:15:37,759 --> 00:15:39,759
and there is an authentication backend

397
00:15:39,759 --> 00:15:41,839
for this and the authentication backend

398
00:15:41,839 --> 00:15:44,240
decides based on many things

399
00:15:44,240 --> 00:15:46,399
like you provide an email address it has

400
00:15:46,399 --> 00:15:49,040
a domain part and it has a username part

401
00:15:49,040 --> 00:15:51,199
and it will provide you details about

402
00:15:51,199 --> 00:15:53,839
that specific user so if you send

403
00:15:53,839 --> 00:15:55,600
something to these endpoints then you

404
00:15:55,600 --> 00:15:58,000
can figure out what the email is is it a

405
00:15:58,000 --> 00:16:00,320
valid email address

406
00:16:00,320 --> 00:16:02,480
you might get login with that is it

407
00:16:02,480 --> 00:16:06,000
logged out is it throttled

408
00:16:06,000 --> 00:16:08,720
maybe you'll see it later so

409
00:16:08,720 --> 00:16:10,800
you set an email address

410
00:16:10,800 --> 00:16:13,839
you get that window and

411
00:16:13,839 --> 00:16:16,160
you might get a simple login window if

412
00:16:16,160 --> 00:16:21,279
you are keem at g something something

413
00:16:21,600 --> 00:16:23,759
you might get this window if you are

414
00:16:23,759 --> 00:16:25,199
came at

415
00:16:25,199 --> 00:16:28,000
d something something something

416
00:16:28,000 --> 00:16:31,360
hopeful nobody knows this window

417
00:16:31,360 --> 00:16:33,120
okay

418
00:16:33,120 --> 00:16:34,800
try to remove as many

419
00:16:34,800 --> 00:16:37,519
features as possible

420
00:16:37,519 --> 00:16:40,399
and there are interesting places when

421
00:16:40,399 --> 00:16:42,480
you provide one email address you might

422
00:16:42,480 --> 00:16:44,639
have different authentications for that

423
00:16:44,639 --> 00:16:46,880
so you can authenticate directly and you

424
00:16:46,880 --> 00:16:48,560
can authenticate with a federated

425
00:16:48,560 --> 00:16:50,160
authentication

426
00:16:50,160 --> 00:16:51,759
this is rather strange i didn't know

427
00:16:51,759 --> 00:16:53,920
about that

428
00:16:53,920 --> 00:16:54,880
okay

429
00:16:54,880 --> 00:16:56,959
let's see what's behind

430
00:16:56,959 --> 00:16:59,680
so there is an api called get credential

431
00:16:59,680 --> 00:17:01,680
type

432
00:17:01,680 --> 00:17:03,519
if you type in your email address you

433
00:17:03,519 --> 00:17:05,760
will see

434
00:17:05,760 --> 00:17:07,280
those

435
00:17:07,280 --> 00:17:09,760
like we will know that you have a

436
00:17:09,760 --> 00:17:12,240
certificate authentication param can you

437
00:17:12,240 --> 00:17:14,160
authenticate with facebook can you

438
00:17:14,160 --> 00:17:17,039
authenticate with fido google

439
00:17:17,039 --> 00:17:20,480
is there a password at all

440
00:17:20,480 --> 00:17:24,000
and we can oh microsoft did

441
00:17:24,000 --> 00:17:26,000
remain in okay so

442
00:17:26,000 --> 00:17:28,559
if you go down you see much more stuff

443
00:17:28,559 --> 00:17:29,440
like

444
00:17:29,440 --> 00:17:32,640
what branding information is there but

445
00:17:32,640 --> 00:17:35,360
logos are the company using in an email

446
00:17:35,360 --> 00:17:37,120
so imagine a case that you would like to

447
00:17:37,120 --> 00:17:39,440
send an email a phishing email and you

448
00:17:39,440 --> 00:17:41,760
don't have the logo for the company here

449
00:17:41,760 --> 00:17:43,760
it is microsoft stores it for you you

450
00:17:43,760 --> 00:17:46,240
can download it from the cloud and then

451
00:17:46,240 --> 00:17:47,600
you can use it

452
00:17:47,600 --> 00:17:49,520
i think this is great for phishing

453
00:17:49,520 --> 00:17:53,440
and i would like to highlight this here

454
00:17:53,440 --> 00:17:56,799
is the most important part

455
00:17:57,840 --> 00:18:00,720
if that's zero then we are okay if

456
00:18:00,720 --> 00:18:01,600
that's

457
00:18:01,600 --> 00:18:03,440
other values then

458
00:18:03,440 --> 00:18:05,360
we are more okay

459
00:18:05,360 --> 00:18:08,000
okay let's see

460
00:18:08,880 --> 00:18:11,200
some great animations

461
00:18:11,200 --> 00:18:13,679
so we have two things we have federated

462
00:18:13,679 --> 00:18:15,440
authentication and non-federated

463
00:18:15,440 --> 00:18:17,520
authentication federated in this case

464
00:18:17,520 --> 00:18:18,559
means that

465
00:18:18,559 --> 00:18:20,720
someone else is doing the real work and

466
00:18:20,720 --> 00:18:23,760
microsoft is just interfacing with them

467
00:18:23,760 --> 00:18:26,559
and then microsoft creates a token and

468
00:18:26,559 --> 00:18:30,320
you can use that token there are token

469
00:18:31,120 --> 00:18:32,960
click click

470
00:18:32,960 --> 00:18:34,240
click

471
00:18:34,240 --> 00:18:35,440
ok

472
00:18:35,440 --> 00:18:36,480
so

473
00:18:36,480 --> 00:18:38,240
depending on your domain

474
00:18:38,240 --> 00:18:40,160
you will get a federated url and the

475
00:18:40,160 --> 00:18:42,480
federated url will do the authentication

476
00:18:42,480 --> 00:18:44,160
this is not really important for us

477
00:18:44,160 --> 00:18:46,480
because we need to go to the federated

478
00:18:46,480 --> 00:18:48,720
endpoint and figure out some data about

479
00:18:48,720 --> 00:18:50,160
the users

480
00:18:50,160 --> 00:18:53,760
but if you are not federated

481
00:18:54,160 --> 00:18:58,480
then there is exist result value

482
00:18:59,840 --> 00:19:02,480
and let's assume that we have a random

483
00:19:02,480 --> 00:19:04,799
string in our email address

484
00:19:04,799 --> 00:19:08,080
that is exists result value will be one

485
00:19:08,080 --> 00:19:09,840
if we have a valid email address then

486
00:19:09,840 --> 00:19:11,919
the value will be zero

487
00:19:11,919 --> 00:19:13,760
so what happens if you would like to

488
00:19:13,760 --> 00:19:16,640
figure out an email to attack or to

489
00:19:16,640 --> 00:19:20,160
figure out an email a victim's email

490
00:19:20,160 --> 00:19:22,880
yes you try three four times and then

491
00:19:22,880 --> 00:19:24,640
you will get an email

492
00:19:24,640 --> 00:19:26,720
and there is no authentication happening

493
00:19:26,720 --> 00:19:29,679
here so you can basically ask thousand

494
00:19:29,679 --> 00:19:31,840
times million times

495
00:19:31,840 --> 00:19:33,280
maybe at the million you might get a

496
00:19:33,280 --> 00:19:34,799
throttle but

497
00:19:34,799 --> 00:19:36,160
that's it

498
00:19:36,160 --> 00:19:38,480
there are also other values here there

499
00:19:38,480 --> 00:19:40,799
is one for throttling so if your

500
00:19:40,799 --> 00:19:42,559
authentication is throttled then that

501
00:19:42,559 --> 00:19:44,240
value will be two

502
00:19:44,240 --> 00:19:46,240
if there are some errors then it could

503
00:19:46,240 --> 00:19:47,600
be minus one

504
00:19:47,600 --> 00:19:48,720
four

505
00:19:48,720 --> 00:19:51,280
and five and six is for

506
00:19:51,280 --> 00:19:53,200
federated authentication

507
00:19:53,200 --> 00:19:57,120
or it might be federated authentication

508
00:19:57,360 --> 00:20:00,480
is this similar so did we hear something

509
00:20:00,480 --> 00:20:02,159
like this in the past

510
00:20:02,159 --> 00:20:04,159
like a web application and if you go to

511
00:20:04,159 --> 00:20:06,640
a web application provide your email and

512
00:20:06,640 --> 00:20:09,120
type in a random password and then what

513
00:20:09,120 --> 00:20:11,440
happens the application tells you that

514
00:20:11,440 --> 00:20:13,919
okay your password is wrong but the

515
00:20:13,919 --> 00:20:16,320
email seems to be okay so

516
00:20:16,320 --> 00:20:19,280
maybe try some new passwords because

517
00:20:19,280 --> 00:20:21,679
you might figure it out or the other way

518
00:20:21,679 --> 00:20:22,880
like

519
00:20:22,880 --> 00:20:25,280
normally we should tell the user here

520
00:20:25,280 --> 00:20:27,440
that go away

521
00:20:27,440 --> 00:20:29,600
something is broken we don't know what

522
00:20:29,600 --> 00:20:31,679
or your authentication session did not

523
00:20:31,679 --> 00:20:33,679
happen try again

524
00:20:33,679 --> 00:20:36,320
but definitely not telling anybody that

525
00:20:36,320 --> 00:20:38,960
it is it's a valid user in the specific

526
00:20:38,960 --> 00:20:41,360
domain

527
00:20:42,159 --> 00:20:43,200
so

528
00:20:43,200 --> 00:20:45,679
infiltrating infrastructures

529
00:20:45,679 --> 00:20:50,240
infiltrating this might be interesting

530
00:20:52,000 --> 00:20:55,360
so as i mentioned we sent in an email

531
00:20:55,360 --> 00:20:56,480
and

532
00:20:56,480 --> 00:20:59,840
in my case it was a simple email and

533
00:20:59,840 --> 00:21:02,240
the victim downloaded the binary and he

534
00:21:02,240 --> 00:21:04,960
executed it because he was instructed to

535
00:21:04,960 --> 00:21:09,440
do so by his boss by someone

536
00:21:09,520 --> 00:21:11,440
what happens in a system if if you

537
00:21:11,440 --> 00:21:12,480
execute

538
00:21:12,480 --> 00:21:14,880
first let's start from downloading if

539
00:21:14,880 --> 00:21:17,360
you get an email and there is a link in

540
00:21:17,360 --> 00:21:18,960
that email

541
00:21:18,960 --> 00:21:21,039
you would like to download something so

542
00:21:21,039 --> 00:21:23,200
go there click on the link

543
00:21:23,200 --> 00:21:25,280
and chrome and edge will tell you that

544
00:21:25,280 --> 00:21:27,520
it's an exa don't do that don't execute

545
00:21:27,520 --> 00:21:32,720
it but you will because you are people

546
00:21:32,720 --> 00:21:36,480
if you have a huge binary like more than

547
00:21:36,480 --> 00:21:39,280
65 megabytes i think then the browser

548
00:21:39,280 --> 00:21:42,159
will simply ignore it if it's a if it's

549
00:21:42,159 --> 00:21:43,440
an exa

550
00:21:43,440 --> 00:21:45,520
who cares it's a big access so we don't

551
00:21:45,520 --> 00:21:47,039
scan it

552
00:21:47,039 --> 00:21:48,640
let's go through

553
00:21:48,640 --> 00:21:50,400
okay next up

554
00:21:50,400 --> 00:21:51,679
marco fab

555
00:21:51,679 --> 00:21:55,520
have you ever heard about marco fab

556
00:21:55,840 --> 00:21:58,400
okay some some if you download something

557
00:21:58,400 --> 00:22:00,880
from the internet most of the browsers

558
00:22:00,880 --> 00:22:01,679
will

559
00:22:01,679 --> 00:22:03,840
use alternate data streams to store info

560
00:22:03,840 --> 00:22:06,000
about that data so

561
00:22:06,000 --> 00:22:07,200
it will be

562
00:22:07,200 --> 00:22:09,919
marked as it's an external data it's

563
00:22:09,919 --> 00:22:12,000
from the internet mostly it's from the

564
00:22:12,000 --> 00:22:14,400
internet so it's not safe

565
00:22:14,400 --> 00:22:16,880
please don't execute it

566
00:22:16,880 --> 00:22:18,640
smart screen might yell at you that

567
00:22:18,640 --> 00:22:22,880
don't execute it but you will execute it

568
00:22:23,600 --> 00:22:25,200
those markov maps are interesting

569
00:22:25,200 --> 00:22:27,280
because if you download the zip file and

570
00:22:27,280 --> 00:22:29,760
you happen to use 7-zip

571
00:22:29,760 --> 00:22:33,200
then 7-zip is not really

572
00:22:33,200 --> 00:22:35,280
using markov web so if you unzip

573
00:22:35,280 --> 00:22:37,200
something from a zip file 7-z if you

574
00:22:37,200 --> 00:22:39,360
simply drop the barcode web and you will

575
00:22:39,360 --> 00:22:42,159
be safe because you are the danzip

576
00:22:42,159 --> 00:22:44,080
the other option is that you simply use

577
00:22:44,080 --> 00:22:46,799
an iso file you download the iso file

578
00:22:46,799 --> 00:22:50,400
it's a huge iso file so we don't mark it

579
00:22:50,400 --> 00:22:52,400
and the iso file itself is marked by the

580
00:22:52,400 --> 00:22:54,640
markov web but if you click on it

581
00:22:54,640 --> 00:22:57,440
windows will happily open it and mount

582
00:22:57,440 --> 00:22:58,159
it

583
00:22:58,159 --> 00:23:01,440
you will have a virtual cd-rom and no

584
00:23:01,440 --> 00:23:04,080
markov web in the virtual cd-roms so you

585
00:23:04,080 --> 00:23:08,799
can execute binaries without any yelling

586
00:23:08,799 --> 00:23:11,360
in my case the small disc footprint is

587
00:23:11,360 --> 00:23:15,039
1.2 megabytes so it depends if it would

588
00:23:15,039 --> 00:23:17,200
be a virus then it should be much much

589
00:23:17,200 --> 00:23:19,120
much smaller but this is a small

590
00:23:19,120 --> 00:23:21,120
footprint

591
00:23:21,120 --> 00:23:23,520
my application is doing

592
00:23:23,520 --> 00:23:26,240
some data gathering like figuring out

593
00:23:26,240 --> 00:23:28,799
what user is running it

594
00:23:28,799 --> 00:23:31,280
which domain is it running in so if we

595
00:23:31,280 --> 00:23:33,360
are in the proper domain

596
00:23:33,360 --> 00:23:35,600
and executed by the proper user then we

597
00:23:35,600 --> 00:23:37,440
are happy and

598
00:23:37,440 --> 00:23:39,440
we will download components based on

599
00:23:39,440 --> 00:23:41,200
those

600
00:23:41,200 --> 00:23:44,000
if you are somewhere else like you are

601
00:23:44,000 --> 00:23:47,200
executed in a sandbox those sandboxes

602
00:23:47,200 --> 00:23:49,039
won't have the proper domains so

603
00:23:49,039 --> 00:23:50,960
application won't execute

604
00:23:50,960 --> 00:23:53,520
this helps us target a specific attack

605
00:23:53,520 --> 00:23:55,120
and it will also

606
00:23:55,120 --> 00:23:57,360
make the life of the

607
00:23:57,360 --> 00:23:59,919
protection so the blue team much harder

608
00:23:59,919 --> 00:24:02,000
because normally they won't have any

609
00:24:02,000 --> 00:24:04,159
details about the attack they will have

610
00:24:04,159 --> 00:24:06,000
a binary that's downloading something

611
00:24:06,000 --> 00:24:08,000
from somewhere but if they don't know

612
00:24:08,000 --> 00:24:10,320
specifically the username and the domain

613
00:24:10,320 --> 00:24:12,640
then it won't be downloaded by them

614
00:24:12,640 --> 00:24:14,640
so everybody is happy

615
00:24:14,640 --> 00:24:16,880
except the blue team

616
00:24:16,880 --> 00:24:18,640
sandbox evasion

617
00:24:18,640 --> 00:24:20,400
please raise your hand if you have seen

618
00:24:20,400 --> 00:24:22,240
a sandbox with more than eight gigabytes

619
00:24:22,240 --> 00:24:24,640
of ram

620
00:24:24,880 --> 00:24:25,919
okay

621
00:24:25,919 --> 00:24:28,400
okay have you ever seen a sandbox with

622
00:24:28,400 --> 00:24:32,159
four cpu cores

623
00:24:32,159 --> 00:24:33,440
okay

624
00:24:33,440 --> 00:24:36,640
might be can we detect these values like

625
00:24:36,640 --> 00:24:39,039
is there an api to carry it

626
00:24:39,039 --> 00:24:40,960
yes sadly but there is

627
00:24:40,960 --> 00:24:43,360
so those two values can bypass mostly

628
00:24:43,360 --> 00:24:46,159
all of the sandboxes

629
00:24:46,159 --> 00:24:48,640
and that's it

630
00:24:48,640 --> 00:24:50,400
as i mentioned

631
00:24:50,400 --> 00:24:52,720
i will have plugins i will talk about it

632
00:24:52,720 --> 00:24:54,720
later

633
00:24:54,720 --> 00:24:56,799
plugin in this case is a simple hexa

634
00:24:56,799 --> 00:25:00,080
binary i could encrypt it but basically

635
00:25:00,080 --> 00:25:03,039
i used https so don't have to encrypt it

636
00:25:03,039 --> 00:25:05,360
again but we could specifically target

637
00:25:05,360 --> 00:25:07,600
it for the user and based on the

638
00:25:07,600 --> 00:25:09,279
username and domain we could encrypt it

639
00:25:09,279 --> 00:25:10,159
as well

640
00:25:10,159 --> 00:25:12,480
so if someone downloads it

641
00:25:12,480 --> 00:25:14,799
there is a there is no key really

642
00:25:14,799 --> 00:25:16,080
because the key is based on the

643
00:25:16,080 --> 00:25:17,279
environment

644
00:25:17,279 --> 00:25:19,279
the key is not in the binary so if

645
00:25:19,279 --> 00:25:21,279
someone is looking at the binary they

646
00:25:21,279 --> 00:25:24,000
won't have that key

647
00:25:24,559 --> 00:25:27,440
one of my plugins is the vnc

648
00:25:27,440 --> 00:25:30,240
implementation

649
00:25:31,520 --> 00:25:34,080
i should definitely

650
00:25:34,080 --> 00:25:37,678
switch off the wi-fi

651
00:25:38,799 --> 00:25:41,200
so the height and vnc is great for

652
00:25:41,200 --> 00:25:43,200
accessing browsers and other

653
00:25:43,200 --> 00:25:44,480
applications

654
00:25:44,480 --> 00:25:46,320
we'll talk about it later

655
00:25:46,320 --> 00:25:48,400
and as i mentioned we have multi-factor

656
00:25:48,400 --> 00:25:50,400
authentication you know if if you use

657
00:25:50,400 --> 00:25:52,320
multi-factor authentication like two or

658
00:25:52,320 --> 00:25:54,799
three or four steps and biometrics and

659
00:25:54,799 --> 00:25:57,600
other stuff what will be the end of an

660
00:25:57,600 --> 00:26:01,120
authentication what do you have

661
00:26:01,120 --> 00:26:03,360
some ideas like

662
00:26:03,360 --> 00:26:04,799
hash

663
00:26:04,799 --> 00:26:06,720
or cookies

664
00:26:06,720 --> 00:26:08,720
you will have a cookie right

665
00:26:08,720 --> 00:26:11,120
do you store those cookies

666
00:26:11,120 --> 00:26:12,640
in the browser

667
00:26:12,640 --> 00:26:14,400
yes okay

668
00:26:14,400 --> 00:26:16,559
so what happens if we copy the the

669
00:26:16,559 --> 00:26:18,400
browser's profile

670
00:26:18,400 --> 00:26:20,559
and then re-execute it in another

671
00:26:20,559 --> 00:26:21,919
process

672
00:26:21,919 --> 00:26:26,400
we might have that data yes

673
00:26:27,679 --> 00:26:28,960
okay

674
00:26:28,960 --> 00:26:31,760
so this was a short introduction so far

675
00:26:31,760 --> 00:26:34,480
and let's talk a bit about rust

676
00:26:34,480 --> 00:26:37,679
rust is a great programming language

677
00:26:37,679 --> 00:26:38,400
it's

678
00:26:38,400 --> 00:26:40,159
from the reversing viewpoint it's it's

679
00:26:40,159 --> 00:26:42,080
rather hard to understand

680
00:26:42,080 --> 00:26:43,039
it's

681
00:26:43,039 --> 00:26:46,000
doing stuff rather differently

682
00:26:46,000 --> 00:26:48,159
its main advantage is that the code is

683
00:26:48,159 --> 00:26:49,200
ugly

684
00:26:49,200 --> 00:26:52,240
and the binary is ugly as well so if you

685
00:26:52,240 --> 00:26:54,320
if you try to reverse some some other

686
00:26:54,320 --> 00:26:58,799
programs this might get interesting

687
00:26:59,760 --> 00:27:02,400
it has a static binary so if you compile

688
00:27:02,400 --> 00:27:04,320
something it will be a bit

689
00:27:04,320 --> 00:27:05,919
a bit bigger than a normal windows

690
00:27:05,919 --> 00:27:08,240
application but your mail verb won't ask

691
00:27:08,240 --> 00:27:09,760
for the ers

692
00:27:09,760 --> 00:27:12,400
because it's it's not that good if you

693
00:27:12,400 --> 00:27:14,960
if you send the application to your

694
00:27:14,960 --> 00:27:18,320
victim and he executes it or she or they

695
00:27:18,320 --> 00:27:19,279
and then

696
00:27:19,279 --> 00:27:22,240
the application asks for a dll because

697
00:27:22,240 --> 00:27:25,919
please download me msvcrt whatever to to

698
00:27:25,919 --> 00:27:27,360
be executed

699
00:27:27,360 --> 00:27:30,159
you might get pass through that but

700
00:27:30,159 --> 00:27:32,480
that's a bit harder so static binary is

701
00:27:32,480 --> 00:27:35,679
great for attacks

702
00:27:35,679 --> 00:27:38,000
rust has a steep learning curve

703
00:27:38,000 --> 00:27:41,039
steep in this case means that you will

704
00:27:41,039 --> 00:27:44,480
you will back for mercy after two weeks

705
00:27:44,480 --> 00:27:47,039
and after two more weeks you might get

706
00:27:47,039 --> 00:27:50,480
through through that phase

707
00:27:50,960 --> 00:27:53,679
rust has also great async code

708
00:27:53,679 --> 00:27:57,279
so you can create really easy async code

709
00:27:57,279 --> 00:27:59,600
implementation if you are a javascript

710
00:27:59,600 --> 00:28:01,120
programmer you know what i am talking

711
00:28:01,120 --> 00:28:04,320
about you execute it you forget it and

712
00:28:04,320 --> 00:28:05,679
then

713
00:28:05,679 --> 00:28:08,080
you might use the data or not

714
00:28:08,080 --> 00:28:10,480
from a dynamic analysis perspective this

715
00:28:10,480 --> 00:28:12,799
is also great because i execute a lot of

716
00:28:12,799 --> 00:28:14,799
stuff and if someone is trying to

717
00:28:14,799 --> 00:28:17,360
analyze my binary if you go through and

718
00:28:17,360 --> 00:28:19,679
and find out all the different random

719
00:28:19,679 --> 00:28:21,520
parts of the application

720
00:28:21,520 --> 00:28:24,720
and they are not really doing anything

721
00:28:24,720 --> 00:28:26,799
to be honest for me it was strange to

722
00:28:26,799 --> 00:28:28,799
see that rust is well integrated into

723
00:28:28,799 --> 00:28:31,039
windows so you can create great windows

724
00:28:31,039 --> 00:28:33,520
applications

725
00:28:33,520 --> 00:28:35,919
and these are the rather helpful

726
00:28:35,919 --> 00:28:37,840
error messages

727
00:28:37,840 --> 00:28:39,440
so

728
00:28:39,440 --> 00:28:41,520
if you are trying to work with trusts

729
00:28:41,520 --> 00:28:43,840
you will run into borrow checker barrel

730
00:28:43,840 --> 00:28:44,960
checker is

731
00:28:44,960 --> 00:28:47,919
something that's trying to protect your

732
00:28:47,919 --> 00:28:49,840
code from yourself

733
00:28:49,840 --> 00:28:52,480
that's my view on it and also it's it's

734
00:28:52,480 --> 00:28:55,200
rather painful so to satisfy

735
00:28:55,200 --> 00:28:57,279
but if you learn how to do that then you

736
00:28:57,279 --> 00:28:59,120
will be a great trust programmer and

737
00:28:59,120 --> 00:29:01,039
hopefully you will be better in other

738
00:29:01,039 --> 00:29:03,120
programming languages as well

739
00:29:03,120 --> 00:29:03,840
so

740
00:29:03,840 --> 00:29:07,760
helpful message lifetime mismatch

741
00:29:08,080 --> 00:29:10,000
okay great

742
00:29:10,000 --> 00:29:12,880
unnecessary unsafe block don't do unsafe

743
00:29:12,880 --> 00:29:16,720
stuff no it's it's bad for you

744
00:29:16,720 --> 00:29:17,600
and

745
00:29:17,600 --> 00:29:20,480
and others my favorite was the

746
00:29:20,480 --> 00:29:23,039
x does not long live

747
00:29:23,039 --> 00:29:26,399
does not live long enough for you

748
00:29:26,399 --> 00:29:31,199
but i do not kill it what happened okay

749
00:29:31,360 --> 00:29:34,159
so let's talk a bit about

750
00:29:34,159 --> 00:29:35,039
how

751
00:29:35,039 --> 00:29:37,200
my application works and how my loader

752
00:29:37,200 --> 00:29:38,480
works

753
00:29:38,480 --> 00:29:40,480
you know loader is rather simple you

754
00:29:40,480 --> 00:29:42,960
download something execute it

755
00:29:42,960 --> 00:29:44,960
it pokes around collects some

756
00:29:44,960 --> 00:29:47,679
information it hashes that information

757
00:29:47,679 --> 00:29:49,520
and then based on those hashes it will

758
00:29:49,520 --> 00:29:52,880
go and try to find other components

759
00:29:52,880 --> 00:29:54,399
so normally

760
00:29:54,399 --> 00:29:56,559
the louder loader section is totally

761
00:29:56,559 --> 00:29:58,960
harmless it does not do anything if you

762
00:29:58,960 --> 00:30:00,720
don't count that it downloads malwares

763
00:30:00,720 --> 00:30:02,960
and executes them but that's not really

764
00:30:02,960 --> 00:30:04,080
bad

765
00:30:04,080 --> 00:30:06,480
for me

766
00:30:06,840 --> 00:30:10,159
and we have other components

767
00:30:10,159 --> 00:30:14,240
we have the hidden vnc implementation

768
00:30:14,240 --> 00:30:17,279
not so harmless it could be used for

769
00:30:17,279 --> 00:30:18,720
many stuff

770
00:30:18,720 --> 00:30:20,240
i will talk about

771
00:30:20,240 --> 00:30:22,960
it later in more details

772
00:30:22,960 --> 00:30:25,520
and we have also puppy

773
00:30:25,520 --> 00:30:28,399
pup is harmless we love puppies so it's

774
00:30:28,399 --> 00:30:29,520
great

775
00:30:29,520 --> 00:30:31,279
you can execute applications you can

776
00:30:31,279 --> 00:30:33,520
execute any python code

777
00:30:33,520 --> 00:30:36,399
because pp has an integrated python

778
00:30:36,399 --> 00:30:39,360
environment in it

779
00:30:40,080 --> 00:30:42,080
so some rust code

780
00:30:42,080 --> 00:30:43,919
every good technical presentation should

781
00:30:43,919 --> 00:30:47,120
contain at least some source code

782
00:30:47,120 --> 00:30:49,679
is it visible is it readable

783
00:30:49,679 --> 00:30:50,480
okay

784
00:30:50,480 --> 00:30:54,080
i choose those mainly for readability

785
00:30:54,080 --> 00:30:56,960
and to provide some visibility how rust

786
00:30:56,960 --> 00:30:58,720
look like

787
00:30:58,720 --> 00:31:01,919
in this case i used visual studio code

788
00:31:01,919 --> 00:31:04,159
and visual studio provides some some

789
00:31:04,159 --> 00:31:06,320
hints some typings

790
00:31:06,320 --> 00:31:09,519
in most cases that's uh static but in

791
00:31:09,519 --> 00:31:11,440
some in some cases it might be

792
00:31:11,440 --> 00:31:13,039
misleading

793
00:31:13,039 --> 00:31:14,640
the misleading section is where you are

794
00:31:14,640 --> 00:31:16,080
trying to figure out why the hell is it

795
00:31:16,080 --> 00:31:18,480
not compiling or not working but

796
00:31:18,480 --> 00:31:21,440
normally it's okay for a string it works

797
00:31:21,440 --> 00:31:23,840
so these these are the three functions

798
00:31:23,840 --> 00:31:25,760
that i talked about

799
00:31:25,760 --> 00:31:27,440
exec exec

800
00:31:27,440 --> 00:31:29,840
obviously it downloads a binary from

801
00:31:29,840 --> 00:31:32,320
somewhere it gets the binary data in a

802
00:31:32,320 --> 00:31:34,399
reference then it creates a thread and

803
00:31:34,399 --> 00:31:35,679
executes it

804
00:31:35,679 --> 00:31:37,600
that's great for our purposes we

805
00:31:37,600 --> 00:31:39,360
download something and don't write it

806
00:31:39,360 --> 00:31:42,080
onto the disk so no bad code will ever

807
00:31:42,080 --> 00:31:43,360
touch the disk

808
00:31:43,360 --> 00:31:45,679
it will only be in the memory

809
00:31:45,679 --> 00:31:47,840
check as i mentioned is

810
00:31:47,840 --> 00:31:51,279
validating the values about cpu and

811
00:31:51,279 --> 00:31:53,120
memory

812
00:31:53,120 --> 00:31:54,720
now

813
00:31:54,720 --> 00:31:56,720
and host names and if we have enough

814
00:31:56,720 --> 00:31:59,279
memory so we are not running in a

815
00:31:59,279 --> 00:32:00,399
virtual machine

816
00:32:00,399 --> 00:32:03,200
a small virtual machine or not running

817
00:32:03,200 --> 00:32:05,600
in a sandbox then we go through

818
00:32:05,600 --> 00:32:06,559
if we

819
00:32:06,559 --> 00:32:09,600
if you don't pass that is the panic exit

820
00:32:09,600 --> 00:32:11,279
panic in this case we will create a

821
00:32:11,279 --> 00:32:13,039
screenshot about your desktop and it

822
00:32:13,039 --> 00:32:15,440
will upload it to my server so i will

823
00:32:15,440 --> 00:32:16,640
see who is

824
00:32:16,640 --> 00:32:18,720
trying to message my application if it's

825
00:32:18,720 --> 00:32:21,120
not the target

826
00:32:21,120 --> 00:32:22,080
hash

827
00:32:22,080 --> 00:32:23,919
in this case hash function is used to

828
00:32:23,919 --> 00:32:26,559
identify the domain and the user

829
00:32:26,559 --> 00:32:29,039
and then based on those hash values i

830
00:32:29,039 --> 00:32:32,000
can target the user so if i know that he

831
00:32:32,000 --> 00:32:33,840
is using a rather old laptop i can

832
00:32:33,840 --> 00:32:36,960
create specific implants for him

833
00:32:36,960 --> 00:32:40,799
that can be executed in his old laptop

834
00:32:40,799 --> 00:32:41,519
so

835
00:32:41,519 --> 00:32:43,600
this is what happens if you are in the

836
00:32:43,600 --> 00:32:46,240
target we will collect information and

837
00:32:46,240 --> 00:32:48,080
we will upload the json file to our

838
00:32:48,080 --> 00:32:50,000
servers

839
00:32:50,000 --> 00:32:51,919
and this happens if you are not the

840
00:32:51,919 --> 00:32:54,640
target or if you are

841
00:32:54,640 --> 00:32:56,480
like a malevolent analyst

842
00:32:56,480 --> 00:32:59,279
so if a malevolence executes the binary

843
00:32:59,279 --> 00:33:01,760
then we will have his desktop

844
00:33:01,760 --> 00:33:05,600
it's not really useful but it's fun

845
00:33:06,240 --> 00:33:11,000
okay a bit talk about pp

846
00:33:12,159 --> 00:33:14,159
this is an interesting application it

847
00:33:14,159 --> 00:33:17,039
implemented huge amount of

848
00:33:17,039 --> 00:33:20,159
services originally i wanted to create a

849
00:33:20,159 --> 00:33:21,279
crypter

850
00:33:21,279 --> 00:33:22,399
loader

851
00:33:22,399 --> 00:33:24,720
and much more stuff

852
00:33:24,720 --> 00:33:26,799
but after some

853
00:33:26,799 --> 00:33:28,799
some time i figured it out that i don't

854
00:33:28,799 --> 00:33:30,720
really have two years for this so i

855
00:33:30,720 --> 00:33:32,720
started to look for smaller components

856
00:33:32,720 --> 00:33:36,320
that are usable in my

857
00:33:36,840 --> 00:33:40,320
case and up is great in this because it

858
00:33:40,320 --> 00:33:43,120
has python it runs on android

859
00:33:43,120 --> 00:33:45,679
you can execute it on windows it runs on

860
00:33:45,679 --> 00:33:49,440
linux and because this is python

861
00:33:49,440 --> 00:33:52,880
it's rather easy to create an installer

862
00:33:52,880 --> 00:33:55,200
it handles multi

863
00:33:55,200 --> 00:34:00,320
it handles scripts you can generate dlls

864
00:34:00,320 --> 00:34:02,880
just name it in most cases poopy will do

865
00:34:02,880 --> 00:34:05,200
that the only issue is that poopy is

866
00:34:05,200 --> 00:34:07,840
based on python 2.7

867
00:34:07,840 --> 00:34:11,760
so if you are trying to compile it then

868
00:34:11,760 --> 00:34:13,679
you might have to patch it at least 10

869
00:34:13,679 --> 00:34:16,159
times and 10 different places

870
00:34:16,159 --> 00:34:18,079
and that might help you to build a

871
00:34:18,079 --> 00:34:20,239
docker image the docker image might work

872
00:34:20,239 --> 00:34:24,000
but it's in most cases it's not working

873
00:34:24,000 --> 00:34:26,399
but you can figure it out

874
00:34:26,399 --> 00:34:28,879
maybe later i will push the changes to

875
00:34:28,879 --> 00:34:31,599
the ppmain repository

876
00:34:31,599 --> 00:34:35,480
so this is the nice ui

877
00:34:35,918 --> 00:34:37,918
i think it's unreadable from the back

878
00:34:37,918 --> 00:34:39,040
lines but

879
00:34:39,040 --> 00:34:41,359
i try to do the best

880
00:34:41,359 --> 00:34:44,320
so if you ever used metal prater or

881
00:34:44,320 --> 00:34:46,879
other similar tools then this will be

882
00:34:46,879 --> 00:34:48,800
rather similar to you

883
00:34:48,800 --> 00:34:51,440
i have four more minutes and

884
00:34:51,440 --> 00:34:53,280
i am late

885
00:34:53,280 --> 00:34:55,760
okay let's speed this up

886
00:34:55,760 --> 00:34:57,599
this was about pupi modules and what

887
00:34:57,599 --> 00:34:59,200
puppy implemented

888
00:34:59,200 --> 00:35:01,040
it has a desktop it can enable your

889
00:35:01,040 --> 00:35:05,520
desktop it can execute your binaries

890
00:35:06,480 --> 00:35:08,640
ssh ssh

891
00:35:08,640 --> 00:35:10,960
and

892
00:35:11,760 --> 00:35:14,800
it can also support persistency so they

893
00:35:14,800 --> 00:35:16,880
created multiple models to help you with

894
00:35:16,880 --> 00:35:18,240
persistency

895
00:35:18,240 --> 00:35:20,800
and based on your level of access it can

896
00:35:20,800 --> 00:35:22,480
automatically do that for you you can

897
00:35:22,480 --> 00:35:25,200
copy files so in my case i did simply

898
00:35:25,200 --> 00:35:27,040
download my binary

899
00:35:27,040 --> 00:35:30,160
and then use poopy to enable persistency

900
00:35:30,160 --> 00:35:33,520
and my binary is not handful so

901
00:35:33,520 --> 00:35:36,880
we can execute it automatically

902
00:35:36,880 --> 00:35:40,480
okay let's speed it up again

903
00:35:40,480 --> 00:35:42,960
what the user sees so normally this is

904
00:35:42,960 --> 00:35:44,560
what the user sees

905
00:35:44,560 --> 00:35:48,720
and what happens if you use item vnc

906
00:35:48,720 --> 00:35:50,160
we see those

907
00:35:50,160 --> 00:35:53,280
there are some minor differences

908
00:35:53,280 --> 00:35:55,359
if we execute a window here at the user

909
00:35:55,359 --> 00:35:57,520
side it won't be visible there and the

910
00:35:57,520 --> 00:35:59,040
same stance if you execute it on the

911
00:35:59,040 --> 00:36:01,040
height of vnc it will not be visible by

912
00:36:01,040 --> 00:36:02,720
the user

913
00:36:02,720 --> 00:36:03,839
this is

914
00:36:03,839 --> 00:36:06,880
mainly used by financial mervers because

915
00:36:06,880 --> 00:36:08,720
your money is in your bank urbanite

916
00:36:08,720 --> 00:36:11,280
provides you a web application and web

917
00:36:11,280 --> 00:36:12,800
application is protected by some

918
00:36:12,800 --> 00:36:14,800
authentication and if you are through

919
00:36:14,800 --> 00:36:17,040
that authentication this approach is

920
00:36:17,040 --> 00:36:19,599
great to defeat most of the bank bank

921
00:36:19,599 --> 00:36:21,520
side protections

922
00:36:21,520 --> 00:36:24,079
and there is a tiny hint for browser

923
00:36:24,079 --> 00:36:25,440
developers

924
00:36:25,440 --> 00:36:27,280
if your application runs in a standard

925
00:36:27,280 --> 00:36:29,920
windows era environment you can query

926
00:36:29,920 --> 00:36:32,560
the desktop name it will be default

927
00:36:32,560 --> 00:36:34,960
but if it's something else then maybe

928
00:36:34,960 --> 00:36:37,119
you are not running

929
00:36:37,119 --> 00:36:38,880
where you should be

930
00:36:38,880 --> 00:36:40,800
so you might be running in a item

931
00:36:40,800 --> 00:36:43,760
virtual desktop or any any other places

932
00:36:43,760 --> 00:36:45,760
that you don't really want to start your

933
00:36:45,760 --> 00:36:48,000
browser

934
00:36:48,000 --> 00:36:51,760
okay some more technical stuff

935
00:36:51,760 --> 00:36:54,079
all this is based on the origin of

936
00:36:54,079 --> 00:36:57,119
windows implementation

937
00:36:57,119 --> 00:36:59,599
who is old enough can remember in those

938
00:36:59,599 --> 00:37:02,000
apis the old windows apis those were

939
00:37:02,000 --> 00:37:03,599
introduced in

940
00:37:03,599 --> 00:37:05,359
windows 3.1

941
00:37:05,359 --> 00:37:08,560
in 1992

942
00:37:08,560 --> 00:37:10,480
i think microsoft did mention at least

943
00:37:10,480 --> 00:37:12,400
four times that

944
00:37:12,400 --> 00:37:14,800
we did rewrite everything from sketch

945
00:37:14,800 --> 00:37:16,400
everything and

946
00:37:16,400 --> 00:37:19,359
everything is not really true

947
00:37:19,359 --> 00:37:22,640
because the core windows api is there so

948
00:37:22,640 --> 00:37:24,720
since windows

949
00:37:24,720 --> 00:37:28,000
i think maybe windows maybe 1.0 but

950
00:37:28,000 --> 00:37:30,240
definitely from windows 3.1 there is

951
00:37:30,240 --> 00:37:31,599
this api

952
00:37:31,599 --> 00:37:34,320
you have a vmd pros vndpros will handle

953
00:37:34,320 --> 00:37:36,960
all the messages for you vnd was

954
00:37:36,960 --> 00:37:39,040
introduced in in the origin of windows

955
00:37:39,040 --> 00:37:40,560
3.1

956
00:37:40,560 --> 00:37:42,800
and it tried to implement something like

957
00:37:42,800 --> 00:37:44,400
multithreading but it was called

958
00:37:44,400 --> 00:37:47,359
cooperative multitasking because you

959
00:37:47,359 --> 00:37:49,839
should cooperate with other applications

960
00:37:49,839 --> 00:37:52,720
so if your vmd process is running

961
00:37:52,720 --> 00:37:55,599
at full scale and it does something like

962
00:37:55,599 --> 00:37:57,839
i don't know downloads a binary then you

963
00:37:57,839 --> 00:37:59,440
basically killed all the other windows

964
00:37:59,440 --> 00:38:00,720
applications

965
00:38:00,720 --> 00:38:02,720
so it's not good not that great later

966
00:38:02,720 --> 00:38:06,078
they created more stuff

967
00:38:08,480 --> 00:38:10,800
this is a plain old

968
00:38:10,800 --> 00:38:13,200
vnd approach how it's implemented it

969
00:38:13,200 --> 00:38:15,200
gets a message the message is something

970
00:38:15,200 --> 00:38:17,839
like in this case vm paint so you should

971
00:38:17,839 --> 00:38:19,599
be repainted

972
00:38:19,599 --> 00:38:22,240
application we repaint it button

973
00:38:22,240 --> 00:38:24,400
list drop down is something

974
00:38:24,400 --> 00:38:27,040
and then it must go forward and use the

975
00:38:27,040 --> 00:38:29,520
def window pros

976
00:38:29,520 --> 00:38:31,839
on the left side if you see it there is

977
00:38:31,839 --> 00:38:34,079
a set window hookah x

978
00:38:34,079 --> 00:38:36,720
this is a great function because you can

979
00:38:36,720 --> 00:38:40,160
execute it and you can indirectly inject

980
00:38:40,160 --> 00:38:41,599
your dll into any v in those

981
00:38:41,599 --> 00:38:43,200
applications

982
00:38:43,200 --> 00:38:44,240
is it

983
00:38:44,240 --> 00:38:46,880
is it good or is it useful

984
00:38:46,880 --> 00:38:48,960
yes from my view it's it's a great

985
00:38:48,960 --> 00:38:50,400
application

986
00:38:50,400 --> 00:38:53,200
i really in the past have never even

987
00:38:53,200 --> 00:38:56,240
seen application using it for good

988
00:38:56,240 --> 00:38:57,760
purposes

989
00:38:57,760 --> 00:39:00,480
but this is there since i don't know

990
00:39:00,480 --> 00:39:03,920
windows 95

991
00:39:06,960 --> 00:39:08,800
that was an application but it doesn't

992
00:39:08,800 --> 00:39:12,079
really add anything for us

993
00:39:12,640 --> 00:39:13,680
so

994
00:39:13,680 --> 00:39:16,960
how to create a item vnc first call

995
00:39:16,960 --> 00:39:19,599
create desktop

996
00:39:19,599 --> 00:39:23,119
then write your own window handler

997
00:39:23,119 --> 00:39:25,760
and then implement your vnc so it's

998
00:39:25,760 --> 00:39:29,160
rather fast

999
00:39:30,079 --> 00:39:31,920
create the stop create desktop is there

1000
00:39:31,920 --> 00:39:35,359
since windows 2000 and you can call it

1001
00:39:35,359 --> 00:39:37,599
and in most cases it will work it's

1002
00:39:37,599 --> 00:39:39,920
rather easy to use

1003
00:39:39,920 --> 00:39:41,680
the handling of the windows and other

1004
00:39:41,680 --> 00:39:45,118
stuff is a bit different part

1005
00:39:45,280 --> 00:39:47,520
so an implementation is server client

1006
00:39:47,520 --> 00:39:50,079
based your application is connected

1007
00:39:50,079 --> 00:39:52,079
to the server in this case the victim is

1008
00:39:52,079 --> 00:39:54,640
running the client and the attacker is

1009
00:39:54,640 --> 00:39:57,599
running the server

1010
00:39:57,599 --> 00:39:59,839
as i mentioned we have messages in

1011
00:39:59,839 --> 00:40:02,880
windows and those messages can be sent

1012
00:40:02,880 --> 00:40:04,880
from one window to the other and in this

1013
00:40:04,880 --> 00:40:08,160
case we implemented a tcp based vnd

1014
00:40:08,160 --> 00:40:11,760
process so if i click on the server

1015
00:40:11,760 --> 00:40:14,079
application on the window then the

1016
00:40:14,079 --> 00:40:16,240
message will be sent over tcp to the

1017
00:40:16,240 --> 00:40:18,720
client and the client will do that

1018
00:40:18,720 --> 00:40:21,440
we have to do some mapping on most

1019
00:40:21,440 --> 00:40:23,520
coordinates and stuff like that but it

1020
00:40:23,520 --> 00:40:26,079
it works

1021
00:40:26,480 --> 00:40:28,720
some more unreadable code

1022
00:40:28,720 --> 00:40:31,119
open desktop is the right side and the

1023
00:40:31,119 --> 00:40:34,160
left side is how to create your desktop

1024
00:40:34,160 --> 00:40:38,359
so windows provides apis

1025
00:40:42,319 --> 00:40:44,240
windows provides apis to iterate all

1026
00:40:44,240 --> 00:40:45,520
over the windows

1027
00:40:45,520 --> 00:40:47,359
and you can figure out which desktop you

1028
00:40:47,359 --> 00:40:49,920
would like to iterate over and then you

1029
00:40:49,920 --> 00:40:52,880
can use to render the window there are

1030
00:40:52,880 --> 00:40:54,800
apis for that and then you can copy out

1031
00:40:54,800 --> 00:40:57,119
it and you can basically render your own

1032
00:40:57,119 --> 00:40:59,280
windows implementation

1033
00:40:59,280 --> 00:41:03,359
it's less interesting than it is

1034
00:41:03,599 --> 00:41:06,160
the server part is totally unreadable

1035
00:41:06,160 --> 00:41:08,400
but this is also rather simple

1036
00:41:08,400 --> 00:41:10,560
we have a vnd process on the server that

1037
00:41:10,560 --> 00:41:12,240
will handle the messages that you

1038
00:41:12,240 --> 00:41:14,079
generated by clicking or moving your

1039
00:41:14,079 --> 00:41:15,440
mouse

1040
00:41:15,440 --> 00:41:17,040
or painting it

1041
00:41:17,040 --> 00:41:18,079
and

1042
00:41:18,079 --> 00:41:19,839
the right side is how you create a

1043
00:41:19,839 --> 00:41:21,359
windows desktop

1044
00:41:21,359 --> 00:41:24,720
application so how to pop up a window

1045
00:41:24,720 --> 00:41:27,119
if it's similar to you then i am sad to

1046
00:41:27,119 --> 00:41:30,079
say that you are old

1047
00:41:30,480 --> 00:41:34,880
okay why is it this good for us

1048
00:41:34,880 --> 00:41:37,280
i am not sure what this application is

1049
00:41:37,280 --> 00:41:38,319
but

1050
00:41:38,319 --> 00:41:41,440
we might execute it and and if we can

1051
00:41:41,440 --> 00:41:43,359
log keystrokes

1052
00:41:43,359 --> 00:41:46,400
then if you see if you read that string

1053
00:41:46,400 --> 00:41:48,480
this application might not get

1054
00:41:48,480 --> 00:41:50,800
second factor authentications for a

1055
00:41:50,800 --> 00:41:51,680
month

1056
00:41:51,680 --> 00:41:53,920
so if you have the password

1057
00:41:53,920 --> 00:41:55,760
then you can access

1058
00:41:55,760 --> 00:42:01,200
all the fine data in this something volt

1059
00:42:01,359 --> 00:42:04,560
okay so left side is the target in this

1060
00:42:04,560 --> 00:42:05,839
case the victim

1061
00:42:05,839 --> 00:42:07,760
right side is the attacker

1062
00:42:07,760 --> 00:42:10,560
if he executed the application

1063
00:42:10,560 --> 00:42:13,200
normally the user is seeing this so he

1064
00:42:13,200 --> 00:42:16,160
started his browser and wisely he saved

1065
00:42:16,160 --> 00:42:18,319
his own password there in the firefox

1066
00:42:18,319 --> 00:42:19,680
password store

1067
00:42:19,680 --> 00:42:21,200
what happens if we

1068
00:42:21,200 --> 00:42:23,599
execute the application in the

1069
00:42:23,599 --> 00:42:27,920
in our desktop we will see the same so

1070
00:42:27,920 --> 00:42:29,359
firefox will provide us all the

1071
00:42:29,359 --> 00:42:31,839
necessary passwords

1072
00:42:31,839 --> 00:42:34,400
what happens if we log into to ams

1073
00:42:34,400 --> 00:42:36,560
office

1074
00:42:36,560 --> 00:42:39,119
can you guess

1075
00:42:39,520 --> 00:42:40,560
yes

1076
00:42:40,560 --> 00:42:42,800
we can access anything in a mesh office

1077
00:42:42,800 --> 00:42:45,280
with the original users privileges

1078
00:42:45,280 --> 00:42:46,079
like

1079
00:42:46,079 --> 00:42:47,839
basically anything and because we are

1080
00:42:47,839 --> 00:42:49,839
talking about cloud

1081
00:42:49,839 --> 00:42:52,319
editing

1082
00:42:52,880 --> 00:42:55,920
and this would be the demo if i can

1083
00:42:55,920 --> 00:42:57,760
figure out

1084
00:42:57,760 --> 00:43:01,520
how to provide sound

1085
00:43:01,520 --> 00:43:04,640
so there will be three different parts

1086
00:43:04,640 --> 00:43:06,560
the left side is the victim the right

1087
00:43:06,560 --> 00:43:08,960
side is the attacker and

1088
00:43:08,960 --> 00:43:12,920
underneath will be puppy

1089
00:43:14,610 --> 00:43:28,160
[Music]

1090
00:43:28,160 --> 00:43:29,839
so we can see that there is some

1091
00:43:29,839 --> 00:43:32,160
antivirus running on the application

1092
00:43:32,160 --> 00:43:35,200
or the the server

1093
00:43:35,200 --> 00:43:37,599
the user did get an email that he should

1094
00:43:37,599 --> 00:43:41,839
download that specific file

1095
00:43:42,079 --> 00:43:44,400
he executes a virus cam because that's

1096
00:43:44,400 --> 00:43:46,640
important don't execute anything without

1097
00:43:46,640 --> 00:43:48,960
wire scanning

1098
00:43:48,960 --> 00:43:51,760
and that was it

1099
00:43:51,760 --> 00:43:54,800
we have an up-to-date windows system

1100
00:43:54,800 --> 00:43:56,560
and we just provided access to an

1101
00:43:56,560 --> 00:43:59,119
attacker

1102
00:44:04,160 --> 00:44:06,880
pp is also connected so we can do

1103
00:44:06,880 --> 00:44:09,839
basically anything

1104
00:44:11,599 --> 00:44:13,839
the user is using his password store

1105
00:44:13,839 --> 00:44:16,720
normally so he's trying to access it

1106
00:44:16,720 --> 00:44:18,560
he's trying to figure out his password

1107
00:44:18,560 --> 00:44:20,720
to report this to

1108
00:44:20,720 --> 00:44:23,200
i t for example but it doesn't know the

1109
00:44:23,200 --> 00:44:25,040
original password so he looks up in the

1110
00:44:25,040 --> 00:44:26,560
password store

1111
00:44:26,560 --> 00:44:28,560
but we have a keylogger so we know

1112
00:44:28,560 --> 00:44:31,359
that's the password source password

1113
00:44:31,359 --> 00:44:33,760
and we can execute it in our

1114
00:44:33,760 --> 00:44:37,400
separated environment

1115
00:44:38,000 --> 00:44:41,760
and we have access to all the passwords

1116
00:44:42,560 --> 00:44:45,200
and that would be persistency so the

1117
00:44:45,200 --> 00:44:46,720
next time our application will be

1118
00:44:46,720 --> 00:44:49,119
executed

1119
00:44:49,119 --> 00:44:51,599
in my later investigations i figured it

1120
00:44:51,599 --> 00:44:53,760
out that it's better to execute binary

1121
00:44:53,760 --> 00:44:56,000
from network shares because in those

1122
00:44:56,000 --> 00:44:59,440
cases anti-virus applications are almost

1123
00:44:59,440 --> 00:45:01,200
ignoring them

1124
00:45:01,200 --> 00:45:03,040
all of them

1125
00:45:03,040 --> 00:45:06,079
so don't use persistency by copying

1126
00:45:06,079 --> 00:45:07,760
rather try to execute it from a network

1127
00:45:07,760 --> 00:45:10,000
share

1128
00:45:17,359 --> 00:45:21,200
and this was a i think this was a reboot

1129
00:45:21,200 --> 00:45:23,280
and everything is up and running again

1130
00:45:23,280 --> 00:45:24,880
without proper access to the user's

1131
00:45:24,880 --> 00:45:27,440
computer

1132
00:45:28,640 --> 00:45:32,520
headset is up and running

1133
00:45:41,680 --> 00:45:43,520
it will be the same but with a different

1134
00:45:43,520 --> 00:45:45,839
antivirus

1135
00:45:45,839 --> 00:45:47,839
really had not had the time to execute

1136
00:45:47,839 --> 00:45:48,800
it with

1137
00:45:48,800 --> 00:45:50,960
with windows defender but it's almost

1138
00:45:50,960 --> 00:45:54,119
the same

1139
00:46:25,920 --> 00:46:27,200
and the best part is that you are

1140
00:46:27,200 --> 00:46:29,200
protected because your antivirus tells

1141
00:46:29,200 --> 00:46:31,920
you that you are protected

1142
00:46:31,920 --> 00:46:33,839
it doesn't really detect anything

1143
00:46:33,839 --> 00:46:36,480
strange like creating new desktops

1144
00:46:36,480 --> 00:46:40,400
downloading and executing binaries

1145
00:46:40,400 --> 00:46:44,400
loading the ls into other applications

1146
00:46:44,400 --> 00:46:46,960
migrating your binary

1147
00:46:46,960 --> 00:46:49,440
into an explorer

1148
00:46:49,440 --> 00:46:52,920
so that's it

1149
00:47:00,400 --> 00:47:02,800
these are

1150
00:47:07,200 --> 00:47:08,839
thank you these are the

1151
00:47:08,839 --> 00:47:10,880
references i think we will upload the

1152
00:47:10,880 --> 00:47:13,599
pdf later so

1153
00:47:13,599 --> 00:47:16,560
okay any questions

1154
00:47:20,400 --> 00:47:21,440
so first

1155
00:47:21,440 --> 00:47:24,680
have anything

1156
00:47:30,640 --> 00:47:32,720
so just a quick one what if the av

1157
00:47:32,720 --> 00:47:34,720
vendor is disabling the execution of

1158
00:47:34,720 --> 00:47:35,680
rust

1159
00:47:35,680 --> 00:47:37,680
having a signature for rust any rust

1160
00:47:37,680 --> 00:47:39,119
compiled application and they are

1161
00:47:39,119 --> 00:47:40,800
disabling that

1162
00:47:40,800 --> 00:47:42,960
sorry again i don't know so what if an

1163
00:47:42,960 --> 00:47:45,520
av vendor is disabling the execution of

1164
00:47:45,520 --> 00:47:46,720
rust

1165
00:47:46,720 --> 00:47:48,480
all rust applications because we are not

1166
00:47:48,480 --> 00:47:50,319
really having a lot of in-house and

1167
00:47:50,319 --> 00:47:52,400
surprising applications they are just

1168
00:47:52,400 --> 00:47:54,480
disabling that

1169
00:47:54,480 --> 00:47:56,480
i did not run into this issue

1170
00:47:56,480 --> 00:47:58,800
but if you sign your application for

1171
00:47:58,800 --> 00:48:00,240
example if you buy your signing

1172
00:48:00,240 --> 00:48:02,559
certificate for 400 bucks

1173
00:48:02,559 --> 00:48:03,839
then

1174
00:48:03,839 --> 00:48:06,559
everything is okay i assume so in this

1175
00:48:06,559 --> 00:48:08,800
case signing would be the key i would

1176
00:48:08,800 --> 00:48:11,599
say depends of how the av is trusting

1177
00:48:11,599 --> 00:48:14,319
the signature versus the compiler

1178
00:48:14,319 --> 00:48:16,880
in most cases av avs are detecting

1179
00:48:16,880 --> 00:48:19,760
signatures like error roots or something

1180
00:48:19,760 --> 00:48:22,240
but the compiler so you can strip there

1181
00:48:22,240 --> 00:48:25,599
is a strip co command in rust compile

1182
00:48:25,599 --> 00:48:28,079
and the later originally it was used by

1183
00:48:28,079 --> 00:48:29,839
the nightly build but right now you can

1184
00:48:29,839 --> 00:48:32,559
use it in any rust production code and

1185
00:48:32,559 --> 00:48:34,960
it will strip most of the strings

1186
00:48:34,960 --> 00:48:37,440
i am not sure why your avs is marking

1187
00:48:37,440 --> 00:48:39,040
all the last code

1188
00:48:39,040 --> 00:48:41,280
i mean they can go for any compiled code

1189
00:48:41,280 --> 00:48:43,920
not looking for strings but but for like

1190
00:48:43,920 --> 00:48:46,720
startup code or anything else

1191
00:48:46,720 --> 00:48:49,040
it depends it depends on the av let's

1192
00:48:49,040 --> 00:48:50,240
talk later

1193
00:48:50,240 --> 00:48:52,400
okay thanks

1194
00:48:52,400 --> 00:48:54,559
thank you

1195
00:48:54,559 --> 00:48:57,890
okay i'm rush thank you very much

1196
00:48:57,890 --> 00:49:00,880
[Applause]

1197
00:49:00,880 --> 00:49:05,119
it's now uh break time uh the next

1198
00:49:05,119 --> 00:49:05,839
uh

1199
00:49:05,839 --> 00:49:07,440
well the afternoon session

1200
00:49:07,440 --> 00:49:09,839
commences at 1 45.

1201
00:49:09,839 --> 00:49:13,078
thank you

