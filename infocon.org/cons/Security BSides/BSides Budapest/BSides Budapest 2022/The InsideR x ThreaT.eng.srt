1
00:00:00,399 --> 00:00:03,040
or that our scar

2
00:00:03,040 --> 00:00:04,240
okay

3
00:00:04,240 --> 00:00:06,319
so now i think you can

4
00:00:06,319 --> 00:00:08,320
hear me even better so

5
00:00:08,320 --> 00:00:10,160
i'm guessing it's gonna be a bit hard to

6
00:00:10,160 --> 00:00:12,639
get your attraction at this time of the

7
00:00:12,639 --> 00:00:14,960
day because you're probably tired and

8
00:00:14,960 --> 00:00:16,640
not going to be long but first of all

9
00:00:16,640 --> 00:00:18,080
i'm going to be introducing myself my

10
00:00:18,080 --> 00:00:20,640
name is adeda delawaskar and i'm a

11
00:00:20,640 --> 00:00:22,560
senior threat hunter in palo alto

12
00:00:22,560 --> 00:00:24,880
networks unit 42 for the past two and a

13
00:00:24,880 --> 00:00:26,800
half years now before that i used to be

14
00:00:26,800 --> 00:00:29,840
a checkpoint to stock manager and

15
00:00:29,840 --> 00:00:32,079
and today i'm going to be discussing

16
00:00:32,079 --> 00:00:34,239
with you an insider threat

17
00:00:34,239 --> 00:00:37,200
uh use cases that we managed to find on

18
00:00:37,200 --> 00:00:39,440
our customers environment

19
00:00:39,440 --> 00:00:41,520
we're going to be discussing and i will

20
00:00:41,520 --> 00:00:44,239
be showing you how can you use your edr

21
00:00:44,239 --> 00:00:45,680
logs your endpoint detection and

22
00:00:45,680 --> 00:00:47,920
response logs in order to target those

23
00:00:47,920 --> 00:00:51,360
two frequently seen use cases and

24
00:00:51,360 --> 00:00:54,559
i'd say at least 60 or 70 percent of

25
00:00:54,559 --> 00:00:56,559
our customer base

26
00:00:56,559 --> 00:00:57,440
so

27
00:00:57,440 --> 00:00:59,920
without further ado let's just start

28
00:00:59,920 --> 00:01:02,399
um so on the agenda today we're gonna

29
00:01:02,399 --> 00:01:04,959
start with defining the insider threat

30
00:01:04,959 --> 00:01:06,479
we're gonna give you some

31
00:01:06,479 --> 00:01:09,360
at least try to set the grounds for this

32
00:01:09,360 --> 00:01:10,960
entire conversation

33
00:01:10,960 --> 00:01:12,640
then we're gonna share with you a few

34
00:01:12,640 --> 00:01:13,439
real

35
00:01:13,439 --> 00:01:16,000
real world use cases that i'm pretty

36
00:01:16,000 --> 00:01:17,680
sure you're all familiar with at least

37
00:01:17,680 --> 00:01:19,040
one of them

38
00:01:19,040 --> 00:01:21,520
we're gonna deep dive into how and what

39
00:01:21,520 --> 00:01:23,520
we can do in order to spot them using

40
00:01:23,520 --> 00:01:25,360
your edr logs

41
00:01:25,360 --> 00:01:28,080
uh q a and we're going to wrap up the

42
00:01:28,080 --> 00:01:30,400
session with a few recommendations

43
00:01:30,400 --> 00:01:34,799
to everyone so let's just begin

44
00:01:34,799 --> 00:01:36,400
so a little bit about the team we're a

45
00:01:36,400 --> 00:01:38,960
managed hunting team that's providing

46
00:01:38,960 --> 00:01:41,520
on threat hunting for our customers that

47
00:01:41,520 --> 00:01:43,040
is based on

48
00:01:43,040 --> 00:01:44,640
practically anywhere in the world and

49
00:01:44,640 --> 00:01:47,280
this is done on top of 46 dr logs which

50
00:01:47,280 --> 00:01:50,000
is palo alto's edr obviously you can do

51
00:01:50,000 --> 00:01:52,720
those type of hunting on any type of edr

52
00:01:52,720 --> 00:01:55,119
that you own and it doesn't it is not

53
00:01:55,119 --> 00:01:58,560
limited to cortex xdr

54
00:01:58,560 --> 00:01:59,920
so first of all

55
00:01:59,920 --> 00:02:03,520
let's um deep dive into who is he who is

56
00:02:03,520 --> 00:02:05,920
the insider and let's try to define him

57
00:02:05,920 --> 00:02:06,960
so

58
00:02:06,960 --> 00:02:10,080
when you're thinking about a bluetooth

59
00:02:10,080 --> 00:02:13,360
whatever is in our mind all the time is

60
00:02:13,360 --> 00:02:16,640
rats and ransomwares and apts and

61
00:02:16,640 --> 00:02:18,720
vulnerabilities and those type of things

62
00:02:18,720 --> 00:02:21,440
are usually occupying the socks in the

63
00:02:21,440 --> 00:02:24,239
blue teams the entire time now there's

64
00:02:24,239 --> 00:02:27,440
also one thing that is always floating

65
00:02:27,440 --> 00:02:29,040
in the back of our head and it's called

66
00:02:29,040 --> 00:02:30,800
the insider threat

67
00:02:30,800 --> 00:02:31,840
and

68
00:02:31,840 --> 00:02:34,239
i feel as personally as a previous stock

69
00:02:34,239 --> 00:02:36,720
manager that we always come short in

70
00:02:36,720 --> 00:02:39,440
detecting those insiders throughout our

71
00:02:39,440 --> 00:02:40,319
days

72
00:02:40,319 --> 00:02:42,720
and in this use cases that i'm going to

73
00:02:42,720 --> 00:02:44,160
share with you i hope

74
00:02:44,160 --> 00:02:45,120
that

75
00:02:45,120 --> 00:02:46,879
maybe some more blue teams around the

76
00:02:46,879 --> 00:02:48,480
world are going to are going to be

77
00:02:48,480 --> 00:02:51,120
utilizing those specific use cases in

78
00:02:51,120 --> 00:02:54,640
order to find those insider threats

79
00:02:54,640 --> 00:02:56,239
so

80
00:02:56,239 --> 00:02:58,319
i'll give you a couple of examples why

81
00:02:58,319 --> 00:03:00,400
insider threats are a really big problem

82
00:03:00,400 --> 00:03:02,800
to organizations worldwide and

83
00:03:02,800 --> 00:03:04,879
essentially why they are so hard to

84
00:03:04,879 --> 00:03:07,120
detect and essentially they're so hard

85
00:03:07,120 --> 00:03:09,920
to detect because they're part of organ

86
00:03:09,920 --> 00:03:12,720
our organizations it's we that gave them

87
00:03:12,720 --> 00:03:14,640
the credentials and it's we that gave

88
00:03:14,640 --> 00:03:16,959
them the legitimate access to those

89
00:03:16,959 --> 00:03:20,080
systems and to those data types of data

90
00:03:20,080 --> 00:03:22,000
that they need to interact with in order

91
00:03:22,000 --> 00:03:23,599
to do their job

92
00:03:23,599 --> 00:03:26,080
and when you think about an insider

93
00:03:26,080 --> 00:03:29,519
threat or an insider it can virtually be

94
00:03:29,519 --> 00:03:31,360
anyone it can be

95
00:03:31,360 --> 00:03:33,920
um a careless employee that sends an

96
00:03:33,920 --> 00:03:36,159
email mistakenly but it can be much much

97
00:03:36,159 --> 00:03:37,040
worse

98
00:03:37,040 --> 00:03:39,200
with a rogue business partner that knit

99
00:03:39,200 --> 00:03:42,000
that sets sorry right next to you and

100
00:03:42,000 --> 00:03:44,400
decides to turn against the same

101
00:03:44,400 --> 00:03:47,360
organization that he is working for

102
00:03:47,360 --> 00:03:50,400
so we'll start with a couple of examples

103
00:03:50,400 --> 00:03:52,239
and i'm pretty sure that

104
00:03:52,239 --> 00:03:54,640
everyone in here probably recognizes the

105
00:03:54,640 --> 00:03:56,480
person in this picture

106
00:03:56,480 --> 00:03:58,480
on the left so this is edward snowden

107
00:03:58,480 --> 00:04:00,400
and this is the famous case of eder

108
00:04:00,400 --> 00:04:03,360
snowden versus the nsa and the story

109
00:04:03,360 --> 00:04:06,480
begins on 2013 when edward snowden is

110
00:04:06,480 --> 00:04:09,439
getting hired by the nsa as an external

111
00:04:09,439 --> 00:04:10,640
contractor

112
00:04:10,640 --> 00:04:14,080
and throughout his service in the nsa he

113
00:04:14,080 --> 00:04:16,880
decides after 15 months of employment

114
00:04:16,880 --> 00:04:19,680
to steal a lot of data from the nsa top

115
00:04:19,680 --> 00:04:21,358
secret documents

116
00:04:21,358 --> 00:04:24,880
approximately 1.7 million documents were

117
00:04:24,880 --> 00:04:27,280
alleged to be licked by edward snowden

118
00:04:27,280 --> 00:04:30,479
and obviously this caused a whole lot of

119
00:04:30,479 --> 00:04:33,680
embarrassment to the national security

120
00:04:33,680 --> 00:04:36,000
agency of the united states

121
00:04:36,000 --> 00:04:38,240
how did he do it you ask

122
00:04:38,240 --> 00:04:40,240
he essentially had domain admin

123
00:04:40,240 --> 00:04:42,720
credentials and he connected an external

124
00:04:42,720 --> 00:04:45,360
usb drive to one of the servers which he

125
00:04:45,360 --> 00:04:46,240
then

126
00:04:46,240 --> 00:04:49,120
leaked a lot of documents from this

127
00:04:49,120 --> 00:04:51,520
specific server

128
00:04:51,520 --> 00:04:53,600
another example before we dig into the

129
00:04:53,600 --> 00:04:55,440
technicalities

130
00:04:55,440 --> 00:04:59,199
um the anatom and the urible affair

131
00:04:59,199 --> 00:05:01,199
i'm guessing that this is one probably

132
00:05:01,199 --> 00:05:03,199
one of the most uses that is less known

133
00:05:03,199 --> 00:05:05,039
here in the crowd but this is a really

134
00:05:05,039 --> 00:05:07,280
famous uh case in israel

135
00:05:07,280 --> 00:05:10,800
and in 2005 anatkam was assigned to work

136
00:05:10,800 --> 00:05:13,280
as a clerk in the israeli command office

137
00:05:13,280 --> 00:05:14,080
center

138
00:05:14,080 --> 00:05:15,759
she was just a regular soldier and

139
00:05:15,759 --> 00:05:18,320
uriblau is an israeli rs newspaper that

140
00:05:18,320 --> 00:05:22,080
is specialized in military affairs

141
00:05:22,080 --> 00:05:24,560
throughout his throughout her

142
00:05:24,560 --> 00:05:28,000
military service anotcom has decided to

143
00:05:28,000 --> 00:05:30,560
copy thousands of classified

144
00:05:30,560 --> 00:05:33,120
documents including many uh confidential

145
00:05:33,120 --> 00:05:34,639
documents also

146
00:05:34,639 --> 00:05:36,880
to us an external cd drive this time

147
00:05:36,880 --> 00:05:38,960
this was quite a while ago where usbs

148
00:05:38,960 --> 00:05:41,680
were not as popular and then after she

149
00:05:41,680 --> 00:05:42,720
finished

150
00:05:42,720 --> 00:05:44,240
her um

151
00:05:44,240 --> 00:05:46,320
her service she took that specific usb

152
00:05:46,320 --> 00:05:51,199
with her later on linked it to

153
00:05:51,280 --> 00:05:53,280
the journalist uriblau

154
00:05:53,280 --> 00:05:55,520
which eventually uh published some of

155
00:05:55,520 --> 00:05:58,400
the documents in harris newspaper

156
00:05:58,400 --> 00:06:00,800
later on on january

157
00:06:00,800 --> 00:06:03,919
2010 anatka was indicted with espionage

158
00:06:03,919 --> 00:06:06,479
and she actually uh served and was

159
00:06:06,479 --> 00:06:08,319
sentenced to four and a half years in

160
00:06:08,319 --> 00:06:11,199
prison in prison and 18 months of

161
00:06:11,199 --> 00:06:13,600
probation

162
00:06:13,600 --> 00:06:15,840
so with all this background being laid

163
00:06:15,840 --> 00:06:16,800
out

164
00:06:16,800 --> 00:06:18,400
let's start with the first use case that

165
00:06:18,400 --> 00:06:20,800
i'm going to be sharing with you and the

166
00:06:20,800 --> 00:06:22,560
first one is going to be called living

167
00:06:22,560 --> 00:06:23,840
somewhere

168
00:06:23,840 --> 00:06:25,600
um

169
00:06:25,600 --> 00:06:26,639
so

170
00:06:26,639 --> 00:06:28,560
let's just

171
00:06:28,560 --> 00:06:31,440
read and go through the life cycle of an

172
00:06:31,440 --> 00:06:34,160
ins of a classic insider threat it all

173
00:06:34,160 --> 00:06:35,520
begins with a new employees being

174
00:06:35,520 --> 00:06:37,840
recruited to the team and he is assigned

175
00:06:37,840 --> 00:06:40,400
with a legitimate account to perform its

176
00:06:40,400 --> 00:06:43,680
daily tasks later on as time moves on

177
00:06:43,680 --> 00:06:45,680
the employees granted with more and more

178
00:06:45,680 --> 00:06:46,960
permissions

179
00:06:46,960 --> 00:06:49,360
to different types of systems and

180
00:06:49,360 --> 00:06:51,759
various data types that he needs to do

181
00:06:51,759 --> 00:06:54,240
you know because he's participating in

182
00:06:54,240 --> 00:06:56,400
some more project or some

183
00:06:56,400 --> 00:06:57,759
new uh

184
00:06:57,759 --> 00:07:00,080
teams that he's engaging with and this

185
00:07:00,080 --> 00:07:01,759
is something that happens essentially to

186
00:07:01,759 --> 00:07:04,800
all of you i'm guessing as well

187
00:07:04,800 --> 00:07:06,960
later on comes the termination phase and

188
00:07:06,960 --> 00:07:09,919
this can be a dual part termination can

189
00:07:09,919 --> 00:07:11,919
either be the employee's pending to

190
00:07:11,919 --> 00:07:13,680
leave the company because he decided to

191
00:07:13,680 --> 00:07:17,120
move on to another to another company or

192
00:07:17,120 --> 00:07:20,319
he's or this is the company's decision

193
00:07:20,319 --> 00:07:22,160
to fire him

194
00:07:22,160 --> 00:07:24,000
and this is exactly where the data

195
00:07:24,000 --> 00:07:25,919
expectation takes place

196
00:07:25,919 --> 00:07:27,840
a few days prior to the last day of the

197
00:07:27,840 --> 00:07:28,960
employee

198
00:07:28,960 --> 00:07:31,199
he moves on to connect a personal usb

199
00:07:31,199 --> 00:07:35,039
drive to his or her machine and copy

200
00:07:35,039 --> 00:07:37,919
internal data to this specific disk

201
00:07:37,919 --> 00:07:38,880
drive

202
00:07:38,880 --> 00:07:41,599
now let's do an anonymous survey

203
00:07:41,599 --> 00:07:43,520
i wanted you to raise your hand if you

204
00:07:43,520 --> 00:07:45,680
ever copied

205
00:07:45,680 --> 00:07:47,840
data from your own

206
00:07:47,840 --> 00:07:50,639
and fast employer when you left

207
00:07:50,639 --> 00:07:53,280
all right so

208
00:07:53,599 --> 00:07:54,879
there's some courage people in here

209
00:07:54,879 --> 00:07:55,759
because

210
00:07:55,759 --> 00:07:57,360
so first of all i'm guessing that no one

211
00:07:57,360 --> 00:07:59,120
has actually fell into this because when

212
00:07:59,120 --> 00:08:01,280
we were doing it internally in palo alto

213
00:08:01,280 --> 00:08:02,720
a couple of people were actually raising

214
00:08:02,720 --> 00:08:04,400
their hand and we were saying is someone

215
00:08:04,400 --> 00:08:06,639
taking notes i mean we should be kind of

216
00:08:06,639 --> 00:08:07,919
taking notes for the next time that

217
00:08:07,919 --> 00:08:09,199
they're going to leave

218
00:08:09,199 --> 00:08:11,039
so no one's going to admit it but i'm

219
00:08:11,039 --> 00:08:13,520
guessing that if we're really honest

220
00:08:13,520 --> 00:08:15,599
probably a lot of us have probably did

221
00:08:15,599 --> 00:08:18,479
that a longer along the way

222
00:08:18,479 --> 00:08:19,919
so what i'm going to be providing with

223
00:08:19,919 --> 00:08:22,000
you first of all is

224
00:08:22,000 --> 00:08:24,319
some example of reports every obviously

225
00:08:24,319 --> 00:08:26,080
everything that is customer related is

226
00:08:26,080 --> 00:08:27,759
obfuscated in here

227
00:08:27,759 --> 00:08:29,759
but just i'll give you a high level of

228
00:08:29,759 --> 00:08:32,399
what is this report is all about so the

229
00:08:32,399 --> 00:08:33,919
managed threat hunting team has managed

230
00:08:33,919 --> 00:08:36,640
to find over the past three months three

231
00:08:36,640 --> 00:08:38,559
users that have copied excessive amount

232
00:08:38,559 --> 00:08:40,479
of data to an external usb drive you can

233
00:08:40,479 --> 00:08:43,440
see one and a half gigabytes of data 5.1

234
00:08:43,440 --> 00:08:45,279
gigabytes of data and 15 gigabytes of

235
00:08:45,279 --> 00:08:46,240
data

236
00:08:46,240 --> 00:08:47,600
the key

237
00:08:47,600 --> 00:08:50,560
finding in this specific report is not

238
00:08:50,560 --> 00:08:52,720
the amount of data that was copied but

239
00:08:52,720 --> 00:08:55,760
the fact that for the last 90 days

240
00:08:55,760 --> 00:08:59,440
for the last 45 days story no login

241
00:08:59,440 --> 00:09:02,640
event was was spotted for this specific

242
00:09:02,640 --> 00:09:05,279
user and this may hint that this user is

243
00:09:05,279 --> 00:09:08,800
no longer part of the organization

244
00:09:08,800 --> 00:09:11,120
the second part of this

245
00:09:11,120 --> 00:09:14,160
report is followed by highlighting to

246
00:09:14,160 --> 00:09:15,360
the customer

247
00:09:15,360 --> 00:09:17,120
what is the type of data that was being

248
00:09:17,120 --> 00:09:19,680
linked so we can see a couple of really

249
00:09:19,680 --> 00:09:21,839
interesting

250
00:09:21,839 --> 00:09:24,000
named directories like

251
00:09:24,000 --> 00:09:26,240
clients which contains 5000 suspected

252
00:09:26,240 --> 00:09:28,800
internal company documents my appeals

253
00:09:28,800 --> 00:09:31,600
again a lot of company documents alleged

254
00:09:31,600 --> 00:09:33,360
that are containing in this specific

255
00:09:33,360 --> 00:09:36,000
directory and ipdump now this was a

256
00:09:36,000 --> 00:09:38,080
really big law firm company

257
00:09:38,080 --> 00:09:40,720
which later on confirmed to us that

258
00:09:40,720 --> 00:09:41,680
indeed

259
00:09:41,680 --> 00:09:44,480
those directories were containing

260
00:09:44,480 --> 00:09:46,480
internal documents

261
00:09:46,480 --> 00:09:48,640
another example

262
00:09:48,640 --> 00:09:51,519
another user that has copied 1.8

263
00:09:51,519 --> 00:09:53,680
gigabytes worth of data to an external

264
00:09:53,680 --> 00:09:55,760
usb drive from a directory that is

265
00:09:55,760 --> 00:09:56,720
called

266
00:09:56,720 --> 00:09:58,959
fda submission this was a really large

267
00:09:58,959 --> 00:10:01,360
pharmaceutical company and again when

268
00:10:01,360 --> 00:10:04,079
looking through the copy event obviously

269
00:10:04,079 --> 00:10:06,720
fda submission is highly suspicious when

270
00:10:06,720 --> 00:10:09,839
we're looking at this event

271
00:10:09,839 --> 00:10:11,360
so how do we create those type of

272
00:10:11,360 --> 00:10:12,480
reports

273
00:10:12,480 --> 00:10:14,560
so we're going to use two queries and

274
00:10:14,560 --> 00:10:16,959
in this specific um screenshot what you

275
00:10:16,959 --> 00:10:18,560
can see is is a

276
00:10:18,560 --> 00:10:19,440
is this

277
00:10:19,440 --> 00:10:22,320
it's a screenshot of an xql query xql is

278
00:10:22,320 --> 00:10:25,120
a proprietary language of uh palo alto

279
00:10:25,120 --> 00:10:27,600
networks but you can use it at any ed r

280
00:10:27,600 --> 00:10:29,760
that you own it could be either splunk

281
00:10:29,760 --> 00:10:32,240
or any or crowdstrike or anything

282
00:10:32,240 --> 00:10:34,560
similar to that and with that query

283
00:10:34,560 --> 00:10:36,959
we're doing a couple of things we have

284
00:10:36,959 --> 00:10:39,120
the first query that is going to get a

285
00:10:39,120 --> 00:10:41,120
list of all the users

286
00:10:41,120 --> 00:10:43,680
that copied data to an external usb

287
00:10:43,680 --> 00:10:47,839
drive and were and did not observe login

288
00:10:47,839 --> 00:10:50,880
for the last 45 or 90 days you can just

289
00:10:50,880 --> 00:10:53,279
adapt it to any um

290
00:10:53,279 --> 00:10:55,920
duration of time that you would like

291
00:10:55,920 --> 00:10:58,000
this is what we call the lead generation

292
00:10:58,000 --> 00:10:58,959
query

293
00:10:58,959 --> 00:11:00,800
we're going to get all the leads to our

294
00:11:00,800 --> 00:11:03,279
further hunting efforts based on query

295
00:11:03,279 --> 00:11:05,120
number one

296
00:11:05,120 --> 00:11:07,040
then we're gonna go to query number two

297
00:11:07,040 --> 00:11:09,200
and query number two is all about

298
00:11:09,200 --> 00:11:11,440
getting an idea on interesting files or

299
00:11:11,440 --> 00:11:12,560
folders

300
00:11:12,560 --> 00:11:15,360
that were spotted throughout the copy

301
00:11:15,360 --> 00:11:17,680
event

302
00:11:19,040 --> 00:11:20,640
so this is query number one and this is

303
00:11:20,640 --> 00:11:22,480
the lead generation query

304
00:11:22,480 --> 00:11:24,720
and we're going to use the following

305
00:11:24,720 --> 00:11:27,200
output columns in order to make our life

306
00:11:27,200 --> 00:11:29,200
easier

307
00:11:29,200 --> 00:11:32,079
let's login when was the last time stamp

308
00:11:32,079 --> 00:11:34,800
where the user has logged into any

309
00:11:34,800 --> 00:11:37,360
systems in the system that we actually

310
00:11:37,360 --> 00:11:38,800
have logs for

311
00:11:38,800 --> 00:11:41,279
usb connecting number of days this is

312
00:11:41,279 --> 00:11:43,519
the unique amount of days that this

313
00:11:43,519 --> 00:11:45,920
specific user has connected

314
00:11:45,920 --> 00:11:48,480
i use a usb drive to his machine

315
00:11:48,480 --> 00:11:51,600
throughout the query period and this is

316
00:11:51,600 --> 00:11:54,000
just to show you how often

317
00:11:54,000 --> 00:11:56,560
is this user is prone to connect usb

318
00:11:56,560 --> 00:11:58,639
drive to his machine part of his regular

319
00:11:58,639 --> 00:12:00,560
job or not

320
00:12:00,560 --> 00:12:02,160
total amount of emails that were copied

321
00:12:02,160 --> 00:12:04,160
throughout the event total amount of

322
00:12:04,160 --> 00:12:06,000
documents amount of images total amount

323
00:12:06,000 --> 00:12:07,760
of code and

324
00:12:07,760 --> 00:12:11,040
total amount of gigabytes and count of

325
00:12:11,040 --> 00:12:12,959
the unique files that were copied

326
00:12:12,959 --> 00:12:14,480
throughout the event

327
00:12:14,480 --> 00:12:16,800
all of this columns are designed in

328
00:12:16,800 --> 00:12:19,360
order to generate and make our life

329
00:12:19,360 --> 00:12:21,680
easier in picking those

330
00:12:21,680 --> 00:12:23,839
highly suspicious leads where we're

331
00:12:23,839 --> 00:12:27,040
gonna run the second query on top

332
00:12:27,040 --> 00:12:28,639
and this is the exam this is an example

333
00:12:28,639 --> 00:12:30,399
of the output of the query i know it's

334
00:12:30,399 --> 00:12:32,160
in uh

335
00:12:32,160 --> 00:12:33,920
it's in dark mode so it's really hard to

336
00:12:33,920 --> 00:12:35,920
see i hope that you can see it but

337
00:12:35,920 --> 00:12:38,880
you have the query highlights right

338
00:12:38,880 --> 00:12:42,079
above so the user's last login was july

339
00:12:42,079 --> 00:12:44,560
13th and this was actually this was a

340
00:12:44,560 --> 00:12:46,800
query that was executed around um

341
00:12:46,800 --> 00:12:48,639
december 2021

342
00:12:48,639 --> 00:12:50,480
so for quite a while the user did not

343
00:12:50,480 --> 00:12:52,800
log into any system of the specific

344
00:12:52,800 --> 00:12:54,800
customers environment

345
00:12:54,800 --> 00:12:57,200
over the past 90 days the following usb

346
00:12:57,200 --> 00:12:59,760
properties were spotted so the user has

347
00:12:59,760 --> 00:13:01,360
connected only

348
00:13:01,360 --> 00:13:03,839
on one day i mean for only one day the

349
00:13:03,839 --> 00:13:06,320
user connected a usb device to his

350
00:13:06,320 --> 00:13:07,519
machine

351
00:13:07,519 --> 00:13:10,480
a total a total amount of 1.8 gigabyte

352
00:13:10,480 --> 00:13:11,760
was copied

353
00:13:11,760 --> 00:13:14,880
over 1.1 k unique files

354
00:13:14,880 --> 00:13:17,519
and the file type breakdown says that

355
00:13:17,519 --> 00:13:20,720
two email file types are copied 85

356
00:13:20,720 --> 00:13:25,120
file type 85 images sorry 102 code files

357
00:13:25,120 --> 00:13:28,000
and 646

358
00:13:28,000 --> 00:13:29,519
documents

359
00:13:29,519 --> 00:13:31,440
so following this

360
00:13:31,440 --> 00:13:33,279
really good line and you can see

361
00:13:33,279 --> 00:13:35,200
the output in here this is the drive

362
00:13:35,200 --> 00:13:37,519
letter the username which is math and

363
00:13:37,519 --> 00:13:40,720
all of this type of data that is like on

364
00:13:40,720 --> 00:13:43,519
the query itself

365
00:13:43,519 --> 00:13:45,600
this is where we're gonna pivot to query

366
00:13:45,600 --> 00:13:47,199
number two and query number two is

367
00:13:47,199 --> 00:13:49,920
analyzing the copy and again the columns

368
00:13:49,920 --> 00:13:51,920
are here to help us understand better

369
00:13:51,920 --> 00:13:53,839
what was copied out throughout this

370
00:13:53,839 --> 00:13:56,560
event so one of them is the timestamp

371
00:13:56,560 --> 00:13:57,920
which is obviously the time step of the

372
00:13:57,920 --> 00:14:00,480
copy the full path of the file that was

373
00:14:00,480 --> 00:14:02,880
copied the username the drive letter

374
00:14:02,880 --> 00:14:04,639
the host name and the file size which

375
00:14:04,639 --> 00:14:05,680
are all

376
00:14:05,680 --> 00:14:08,480
which are all pretty straightforward

377
00:14:08,480 --> 00:14:11,360
this is an output of the second query

378
00:14:11,360 --> 00:14:12,800
and this is related to the first query

379
00:14:12,800 --> 00:14:15,040
that we just saw with the fda submission

380
00:14:15,040 --> 00:14:17,760
so you can see that the drive

381
00:14:17,760 --> 00:14:20,480
that a directory called fda submission

382
00:14:20,480 --> 00:14:23,440
was copied to a usb drive a few days

383
00:14:23,440 --> 00:14:28,079
prior to the user's termination

384
00:14:29,120 --> 00:14:31,360
so while we're experiencing the feedback

385
00:14:31,360 --> 00:14:33,920
that we got we send a lot of um

386
00:14:33,920 --> 00:14:36,720
those type of reports to customers and

387
00:14:36,720 --> 00:14:38,399
it essentially happens on every

388
00:14:38,399 --> 00:14:41,040
environment that doesn't block usb drive

389
00:14:41,040 --> 00:14:42,480
so one thing that we recommend to our

390
00:14:42,480 --> 00:14:45,360
customers is maybe enforce a usb block

391
00:14:45,360 --> 00:14:48,000
and just open the usb to those people

392
00:14:48,000 --> 00:14:51,360
who need it to be part of their actual

393
00:14:51,360 --> 00:14:52,399
work

394
00:14:52,399 --> 00:14:54,000
and if this is something that you will

395
00:14:54,000 --> 00:14:55,360
not be able to enforce in your

396
00:14:55,360 --> 00:14:57,600
organization so we highly recommend you

397
00:14:57,600 --> 00:15:00,079
to have those queries or those similar

398
00:15:00,079 --> 00:15:01,519
type of queries running in your

399
00:15:01,519 --> 00:15:03,279
environment regularly

400
00:15:03,279 --> 00:15:05,440
just spot them even if it happens after

401
00:15:05,440 --> 00:15:07,760
the users get is getting terminated i

402
00:15:07,760 --> 00:15:09,440
mean for us

403
00:15:09,440 --> 00:15:10,880
as blue teams

404
00:15:10,880 --> 00:15:13,199
when a specific file leaves our

405
00:15:13,199 --> 00:15:14,800
environment and it doesn't matter if

406
00:15:14,800 --> 00:15:18,160
it's physical copy or an online copy it

407
00:15:18,160 --> 00:15:21,600
usually means game over in a way

408
00:15:21,600 --> 00:15:23,199
but then again we had a lot of customers

409
00:15:23,199 --> 00:15:26,240
that were reaching out to users after

410
00:15:26,240 --> 00:15:28,240
their termination

411
00:15:28,240 --> 00:15:29,040
and

412
00:15:29,040 --> 00:15:30,079
starting

413
00:15:30,079 --> 00:15:31,920
kind of a legal actions against them

414
00:15:31,920 --> 00:15:34,399
because they took and they violated

415
00:15:34,399 --> 00:15:37,680
company policy with doing that

416
00:15:37,680 --> 00:15:39,040
okay so this is something that's really

417
00:15:39,040 --> 00:15:40,560
key and while you're all reading the

418
00:15:40,560 --> 00:15:42,240
feedback do you have any questions while

419
00:15:42,240 --> 00:15:45,360
i'm drinking some water

420
00:15:46,639 --> 00:15:49,639
awesome

421
00:15:55,759 --> 00:15:57,759
so the second uses is called uploading

422
00:15:57,759 --> 00:16:00,399
somewhere and this is very similar to

423
00:16:00,399 --> 00:16:01,920
the first use case you can see that the

424
00:16:01,920 --> 00:16:04,000
lifecycle that is laid out in front of

425
00:16:04,000 --> 00:16:05,759
you is extremely similar to the first

426
00:16:05,759 --> 00:16:07,839
one with one exception

427
00:16:07,839 --> 00:16:09,279
instead of connecting

428
00:16:09,279 --> 00:16:11,920
a usb drive to your host you're going to

429
00:16:11,920 --> 00:16:14,399
link it to one of the online drives and

430
00:16:14,399 --> 00:16:17,199
the third-party vendors that are aligned

431
00:16:17,199 --> 00:16:20,560
that are allowing external storage for

432
00:16:20,560 --> 00:16:23,279
people that are gonna use it

433
00:16:23,279 --> 00:16:24,000
so

434
00:16:24,000 --> 00:16:26,320
a couple one two report examples with

435
00:16:26,320 --> 00:16:27,839
two key differences which i'm gonna

436
00:16:27,839 --> 00:16:29,920
highlight for you so one of them you can

437
00:16:29,920 --> 00:16:32,240
see that over the past three months a

438
00:16:32,240 --> 00:16:35,519
user was spotted to upload 5.7 gigabytes

439
00:16:35,519 --> 00:16:36,800
to one drive

440
00:16:36,800 --> 00:16:38,160
and again

441
00:16:38,160 --> 00:16:40,720
the last login for that user was spotted

442
00:16:40,720 --> 00:16:43,680
45 days in earlier now notable

443
00:16:43,680 --> 00:16:45,360
directories that were spotted throughout

444
00:16:45,360 --> 00:16:47,480
the copy event is

445
00:16:47,480 --> 00:16:51,279
archive.pst a psd file is

446
00:16:51,279 --> 00:16:53,920
probably microsoft outlook's

447
00:16:53,920 --> 00:16:55,120
internal

448
00:16:55,120 --> 00:16:58,720
mailbox file and it probably copied and

449
00:16:58,720 --> 00:17:00,800
contains an internal copy of the user's

450
00:17:00,800 --> 00:17:03,759
email backup including a lot of stuff

451
00:17:03,759 --> 00:17:06,400
that we probably don't want to leave the

452
00:17:06,400 --> 00:17:08,319
organization

453
00:17:08,319 --> 00:17:11,599
so this is the output of the copy again

454
00:17:11,599 --> 00:17:13,919
now highlighting the

455
00:17:13,919 --> 00:17:17,439
uh process that actually initiated this

456
00:17:17,439 --> 00:17:20,240
specific upload towards the cloud in

457
00:17:20,240 --> 00:17:24,520
this case we have onedrive.exe

458
00:17:24,640 --> 00:17:27,280
another example

459
00:17:27,280 --> 00:17:28,640
is

460
00:17:28,640 --> 00:17:31,520
when you're when when you're hunting for

461
00:17:31,520 --> 00:17:33,200
customers or essentially in your

462
00:17:33,200 --> 00:17:36,400
environment you have an idea on what is

463
00:17:36,400 --> 00:17:38,400
the allowed third-party software that

464
00:17:38,400 --> 00:17:41,120
this specific organization allows their

465
00:17:41,120 --> 00:17:44,000
users in order to use for cloud storage

466
00:17:44,000 --> 00:17:45,679
so for example in palo alto networks

467
00:17:45,679 --> 00:17:48,080
we're using google drive

468
00:17:48,080 --> 00:17:50,320
and in this specific company we saw that

469
00:17:50,320 --> 00:17:51,679
onedrive

470
00:17:51,679 --> 00:17:52,400
is

471
00:17:52,400 --> 00:17:54,480
something that is fairly used by in this

472
00:17:54,480 --> 00:17:56,720
specific organization which made us to

473
00:17:56,720 --> 00:17:59,520
believe that onedrive was the authorized

474
00:17:59,520 --> 00:18:01,679
third party vendor that this specific

475
00:18:01,679 --> 00:18:03,840
company has chosen not to mention that

476
00:18:03,840 --> 00:18:05,440
the remote host

477
00:18:05,440 --> 00:18:08,320
that this the onedrive is uploading the

478
00:18:08,320 --> 00:18:09,520
data to

479
00:18:09,520 --> 00:18:12,640
is the domain is called sharepoint.com

480
00:18:12,640 --> 00:18:15,679
but luckily enough for us microsoft also

481
00:18:15,679 --> 00:18:17,200
um

482
00:18:17,200 --> 00:18:19,200
registers a sub domain

483
00:18:19,200 --> 00:18:21,760
which is masked in here which you will

484
00:18:21,760 --> 00:18:23,679
be which is which is owned by this

485
00:18:23,679 --> 00:18:26,320
specific company so in here for example

486
00:18:26,320 --> 00:18:29,039
if palo alto was to use one drive in

487
00:18:29,039 --> 00:18:31,120
order to store their file it would have

488
00:18:31,120 --> 00:18:34,918
been palo alto.my.sharepoint.com

489
00:18:35,520 --> 00:18:38,080
and when to me as a threat hunter this

490
00:18:38,080 --> 00:18:39,440
is a really key

491
00:18:39,440 --> 00:18:41,679
and important investigation point

492
00:18:41,679 --> 00:18:43,919
because i can whitelist everything that

493
00:18:43,919 --> 00:18:45,760
goes out to

494
00:18:45,760 --> 00:18:47,919
this specific subdomain

495
00:18:47,919 --> 00:18:51,200
i'm guessing that this is allowed

496
00:18:51,200 --> 00:18:54,080
an allowed connection that is done by

497
00:18:54,080 --> 00:18:55,760
onedrive but in here you can see at this

498
00:18:55,760 --> 00:18:58,400
specific account that google drive

499
00:18:58,400 --> 00:19:00,799
dropbox were used throughout the

500
00:19:00,799 --> 00:19:03,200
organization not to mention

501
00:19:03,200 --> 00:19:05,760
that using this technique of the remote

502
00:19:05,760 --> 00:19:08,240
host you'll be able to determine if a

503
00:19:08,240 --> 00:19:10,559
user is connected with his personal

504
00:19:10,559 --> 00:19:11,840
onedrive

505
00:19:11,840 --> 00:19:12,960
because when you're going to be

506
00:19:12,960 --> 00:19:14,799
connecting with your user with your

507
00:19:14,799 --> 00:19:17,760
personal onedrive your data get is

508
00:19:17,760 --> 00:19:20,400
getting uploaded to a different domain

509
00:19:20,400 --> 00:19:23,679
and not the company owned domain

510
00:19:23,679 --> 00:19:26,080
so again this is an example

511
00:19:26,080 --> 00:19:28,640
of the query and you can see that those

512
00:19:28,640 --> 00:19:30,720
processes that are responsible for

513
00:19:30,720 --> 00:19:32,720
uploading a lot of data

514
00:19:32,720 --> 00:19:34,200
towards uh

515
00:19:34,200 --> 00:19:37,679
both.dropbox.com and google apis

516
00:19:37,679 --> 00:19:40,640
google apis dot com which

517
00:19:40,640 --> 00:19:42,480
belongs to google drive sync and

518
00:19:42,480 --> 00:19:45,480
dropbox.exe

519
00:19:45,840 --> 00:19:47,919
so how to create the report

520
00:19:47,919 --> 00:19:50,000
so again we're going to use two queries

521
00:19:50,000 --> 00:19:52,559
really similar to our first assumptions

522
00:19:52,559 --> 00:19:54,559
getting a list of all the users this

523
00:19:54,559 --> 00:19:57,120
time who uploaded data the third party

524
00:19:57,120 --> 00:20:00,240
vendors and their last again was set to

525
00:20:00,240 --> 00:20:02,320
back in the past

526
00:20:02,320 --> 00:20:04,000
the second query is gonna

527
00:20:04,000 --> 00:20:05,919
help us in understanding what are the

528
00:20:05,919 --> 00:20:08,880
type of files that are being executed so

529
00:20:08,880 --> 00:20:10,720
again very very similar i'm not going to

530
00:20:10,720 --> 00:20:13,039
bore you with again but last login date

531
00:20:13,039 --> 00:20:15,760
number of unique uh uploaded days where

532
00:20:15,760 --> 00:20:18,240
the user is actually uploading stuff to

533
00:20:18,240 --> 00:20:20,240
the cloud total amount of emails

534
00:20:20,240 --> 00:20:22,480
documents images code total amount of

535
00:20:22,480 --> 00:20:25,520
gigabytes and unique files that were

536
00:20:25,520 --> 00:20:27,679
spotted the query number two is to help

537
00:20:27,679 --> 00:20:31,120
you analyze the copy again

538
00:20:31,120 --> 00:20:34,640
and this is where the q a comes and if

539
00:20:34,640 --> 00:20:36,880
you do want to do the q a at the end

540
00:20:36,880 --> 00:20:39,039
because i have a wrap up all right so

541
00:20:39,039 --> 00:20:41,360
i'm going to jump straight to the

542
00:20:41,360 --> 00:20:42,640
wrapping up

543
00:20:42,640 --> 00:20:44,960
so wrapping up

544
00:20:44,960 --> 00:20:47,039
so blue jeans it's really easy to focus

545
00:20:47,039 --> 00:20:49,200
on the on the outside i mean if i would

546
00:20:49,200 --> 00:20:51,679
have an enormous survey in here and ask

547
00:20:51,679 --> 00:20:54,159
you if you're a member on the on a blue

548
00:20:54,159 --> 00:20:56,320
team what concerns it the most i'm

549
00:20:56,320 --> 00:20:58,080
guessing that ransomware would be number

550
00:20:58,080 --> 00:20:58,880
one

551
00:20:58,880 --> 00:21:00,320
followed by

552
00:21:00,320 --> 00:21:03,120
i guess crypto miners and some uh

553
00:21:03,120 --> 00:21:04,480
botnets and

554
00:21:04,480 --> 00:21:07,039
and rats but nobody would have mentioned

555
00:21:07,039 --> 00:21:08,880
the inside of france

556
00:21:08,880 --> 00:21:09,679
now

557
00:21:09,679 --> 00:21:11,919
there's a real if you're gonna

558
00:21:11,919 --> 00:21:13,760
google some

559
00:21:13,760 --> 00:21:15,520
really interesting cases over the past

560
00:21:15,520 --> 00:21:17,760
few few months even there are a lot of

561
00:21:17,760 --> 00:21:20,080
cases where insiders from really popular

562
00:21:20,080 --> 00:21:21,520
companies like

563
00:21:21,520 --> 00:21:24,000
even google and tesla

564
00:21:24,000 --> 00:21:26,080
there were a lot of cases where it

565
00:21:26,080 --> 00:21:27,840
really affected the company and made

566
00:21:27,840 --> 00:21:30,400
them pay millions of dollars

567
00:21:30,400 --> 00:21:31,440
to just

568
00:21:31,440 --> 00:21:33,200
counteract those activities that are

569
00:21:33,200 --> 00:21:35,760
made by the insider threats

570
00:21:35,760 --> 00:21:37,360
one another thing and this comes from me

571
00:21:37,360 --> 00:21:38,480
to you

572
00:21:38,480 --> 00:21:40,880
in a data-driven world where everything

573
00:21:40,880 --> 00:21:42,320
essentially we're doing is being

574
00:21:42,320 --> 00:21:44,480
documented

575
00:21:44,480 --> 00:21:46,080
don't borrow stuff with you when you

576
00:21:46,080 --> 00:21:47,919
when you leave a company because

577
00:21:47,919 --> 00:21:50,159
essentially we can see everything

578
00:21:50,159 --> 00:21:51,840
and again if you would like a copy of

579
00:21:51,840 --> 00:21:54,159
the queries again this is xql based so

580
00:21:54,159 --> 00:21:56,320
if you have all follow auto networks

581
00:21:56,320 --> 00:21:58,400
cortex xtr you'll be able to use them

582
00:21:58,400 --> 00:22:00,559
out of the box but if not it's just a

583
00:22:00,559 --> 00:22:02,559
general idea on how to build them then

584
00:22:02,559 --> 00:22:04,320
you can adapt into your

585
00:22:04,320 --> 00:22:07,280
own edr language so please don't don't

586
00:22:07,280 --> 00:22:09,280
hesitate to reach to reach out i'm

587
00:22:09,280 --> 00:22:11,280
pretty sure you'll be able to do so on

588
00:22:11,280 --> 00:22:12,880
linkedin twitter or

589
00:22:12,880 --> 00:22:14,400
anything similar

590
00:22:14,400 --> 00:22:16,720
that you feel free to so thank you very

591
00:22:16,720 --> 00:22:18,480
much for having me

592
00:22:18,480 --> 00:22:21,280
and the q a

593
00:22:22,159 --> 00:22:24,840
thank you uh

594
00:22:24,840 --> 00:22:29,129
[Applause]

595
00:22:30,159 --> 00:22:32,480
yeah i was wondering whether waiting for

596
00:22:32,480 --> 00:22:35,360
45 or 90 days isn't too late

597
00:22:35,360 --> 00:22:36,559
is it

598
00:22:36,559 --> 00:22:39,679
by informing the customers in real time

599
00:22:39,679 --> 00:22:41,679
about these events is it too false

600
00:22:41,679 --> 00:22:43,440
positive

601
00:22:43,440 --> 00:22:45,039
of an approach

602
00:22:45,039 --> 00:22:47,039
so that's actually an excellent question

603
00:22:47,039 --> 00:22:49,120
the problem is when you have third-party

604
00:22:49,120 --> 00:22:51,360
hunters is that we don't have the

605
00:22:51,360 --> 00:22:53,039
ability to know who's spending to leave

606
00:22:53,039 --> 00:22:55,679
the company so for some of the customers

607
00:22:55,679 --> 00:22:58,400
that we actually reported it to

608
00:22:58,400 --> 00:23:01,840
we build a process that actually

609
00:23:01,840 --> 00:23:03,440
they're gonna send us the people that

610
00:23:03,440 --> 00:23:05,200
are pending to leave and we would run

611
00:23:05,200 --> 00:23:08,159
those queries before the alleged date of

612
00:23:08,159 --> 00:23:09,600
this specific user that is going to be

613
00:23:09,600 --> 00:23:10,480
leaving

614
00:23:10,480 --> 00:23:12,400
if you are working for a company and

615
00:23:12,400 --> 00:23:14,240
you're um

616
00:23:14,240 --> 00:23:16,240
threat hunting for a company for your

617
00:23:16,240 --> 00:23:18,320
internal company then you don't have the

618
00:23:18,320 --> 00:23:20,640
you have the ability to contact your hr

619
00:23:20,640 --> 00:23:22,880
and have them send you all the employees

620
00:23:22,880 --> 00:23:25,360
that are pending to leave or even worse

621
00:23:25,360 --> 00:23:27,520
ones that are getting terminated soon so

622
00:23:27,520 --> 00:23:29,520
this is going to be uh but this this

623
00:23:29,520 --> 00:23:31,120
this is a good a good comment because

624
00:23:31,120 --> 00:23:33,039
you when you're sending something that

625
00:23:33,039 --> 00:23:35,360
happened three months ago

626
00:23:35,360 --> 00:23:37,440
it's usually a little bit problematic in

627
00:23:37,440 --> 00:23:40,480
terms of the customer

628
00:23:43,279 --> 00:23:44,480
uh

629
00:23:44,480 --> 00:23:46,240
thanks for the for the talk really great

630
00:23:46,240 --> 00:23:47,200
talk

631
00:23:47,200 --> 00:23:50,240
just out of curiosity you said that when

632
00:23:50,240 --> 00:23:52,240
your clients like received the report

633
00:23:52,240 --> 00:23:54,799
they could maybe sue that

634
00:23:54,799 --> 00:23:57,600
that employee that stole their data

635
00:23:57,600 --> 00:23:58,799
um

636
00:23:58,799 --> 00:24:00,320
i don't know if maybe if you know the

637
00:24:00,320 --> 00:24:02,640
answer but is like the data from your

638
00:24:02,640 --> 00:24:04,960
report is applicable at court for them

639
00:24:04,960 --> 00:24:07,200
to sue but maybe they didn't record the

640
00:24:07,200 --> 00:24:10,960
all the data that is transferred

641
00:24:10,960 --> 00:24:12,720
so again an excellent question and thank

642
00:24:12,720 --> 00:24:13,440
you

643
00:24:13,440 --> 00:24:14,320
so

644
00:24:14,320 --> 00:24:16,000
the thing is i'm not sure they will be

645
00:24:16,000 --> 00:24:18,159
able to utilize our report but our

646
00:24:18,159 --> 00:24:19,679
reporting also includes the queries

647
00:24:19,679 --> 00:24:21,919
themselves and the query squares their

648
00:24:21,919 --> 00:24:24,400
data that they're saving on

649
00:24:24,400 --> 00:24:26,640
on palo alto's cloud

650
00:24:26,640 --> 00:24:28,880
and if they're gonna use those queries

651
00:24:28,880 --> 00:24:30,240
in order to get the output from the

652
00:24:30,240 --> 00:24:32,799
apollo's cloud it's it's applicable to

653
00:24:32,799 --> 00:24:34,159
court i mean

654
00:24:34,159 --> 00:24:36,720
it aligns with all the data regulations

655
00:24:36,720 --> 00:24:38,640
that are needed and they can just

656
00:24:38,640 --> 00:24:40,720
provide the output query and i'm

657
00:24:40,720 --> 00:24:43,200
guessing it stands in court i guess

658
00:24:43,200 --> 00:24:46,360
thank you

659
00:24:48,320 --> 00:24:51,039
anybody else

660
00:24:51,039 --> 00:24:52,559
okay in that case

661
00:24:52,559 --> 00:24:55,440
once again thank you to odd and his

662
00:24:55,440 --> 00:24:57,360
young assistant

663
00:24:57,360 --> 00:24:59,530
thank you

664
00:24:59,530 --> 00:25:06,579
[Applause]

665
00:25:08,240 --> 00:25:10,320
you

