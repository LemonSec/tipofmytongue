1
00:00:02,550 --> 00:00:08,068
all right it is one o'clock in Atlanta

2
00:00:05,399 --> 00:00:10,260
and we are ready to get going

3
00:00:08,069 --> 00:00:11,730
so real quick I'd like to thank all of

4
00:00:10,260 --> 00:00:13,950
our sponsors who have been with us

5
00:00:11,730 --> 00:00:15,800
through this transition to a virtual

6
00:00:13,950 --> 00:00:18,810
conference they've been super supportive

7
00:00:15,800 --> 00:00:21,119
at Diamond level we have Warner Media

8
00:00:18,810 --> 00:00:23,939
gold-level Kennesaw State University

9
00:00:21,119 --> 00:00:26,819
Kohl's college and the KSU Department of

10
00:00:23,939 --> 00:00:29,130
Information Systems Bishop Fox coal fire

11
00:00:26,819 --> 00:00:31,140
genuine parts company and NCR and

12
00:00:29,130 --> 00:00:34,170
crystal level we've got critical

13
00:00:31,140 --> 00:00:37,320
critical paths and synopsis Silver level

14
00:00:34,170 --> 00:00:40,109
errands binary defense Black Hills Cora

15
00:00:37,320 --> 00:00:42,899
light and guide point security bronze

16
00:00:40,109 --> 00:00:44,910
level we have NCC group and our in-kind

17
00:00:42,899 --> 00:00:47,160
sponsors are EC Council for online

18
00:00:44,910 --> 00:00:49,709
training and secure code warrior for the

19
00:00:47,160 --> 00:00:51,898
virtual CTF we'd also like to thank

20
00:00:49,710 --> 00:00:54,300
crosshair Information Technology Joe

21
00:00:51,899 --> 00:00:56,519
gray offensive security and pin tester

22
00:00:54,300 --> 00:00:59,459
lab for their contributions to our

23
00:00:56,519 --> 00:01:01,858
raffle prizes make sure to go to the

24
00:00:59,460 --> 00:01:03,179
raffle giveaways channel and get signed

25
00:01:01,859 --> 00:01:05,700
up for those there's some really great

26
00:01:03,179 --> 00:01:09,360
prizes if you haven't done it already

27
00:01:05,700 --> 00:01:11,850
and we'd like you to drop a pin on our

28
00:01:09,360 --> 00:01:13,440
map just so we can get an idea of where

29
00:01:11,850 --> 00:01:15,929
everybody's coming from I'll post a link

30
00:01:13,440 --> 00:01:20,039
to that in the track protect channel in

31
00:01:15,930 --> 00:01:24,230
a minute and yeah without further ado I

32
00:01:20,040 --> 00:01:24,230
will pass it off to Oscar and Brandon

33
00:01:25,250 --> 00:01:30,530
hey everybody thanks Patrick for the

34
00:01:28,280 --> 00:01:32,900
introduction and thank you besides for

35
00:01:30,530 --> 00:01:35,380
having us it's been an interesting

36
00:01:32,900 --> 00:01:38,150
transition definitely going to

37
00:01:35,380 --> 00:01:39,170
everything virtual lately so glad to be

38
00:01:38,150 --> 00:01:41,510
here

39
00:01:39,170 --> 00:02:04,130
make sure that first we can see my

40
00:01:41,510 --> 00:02:06,520
screen there we go

41
00:02:04,130 --> 00:02:06,520
can everybody

42
00:02:07,459 --> 00:02:15,660
symmetry yes perfect alright so welcome

43
00:02:13,470 --> 00:02:31,110
today expose yourself without consider

44
00:02:15,660 --> 00:02:34,650
talk so during this talk we're trying to

45
00:02:31,110 --> 00:02:39,420
answer the question how do you determine

46
00:02:34,650 --> 00:02:40,769
what your exposure is on on cloud

47
00:02:39,420 --> 00:02:43,380
infrastructure like what is your

48
00:02:40,769 --> 00:02:45,420
publicly facing external infrastructure

49
00:02:43,380 --> 00:02:51,750
for the cloud accounts within your

50
00:02:45,420 --> 00:02:53,880
organization my name is Oscar Salazar

51
00:02:51,750 --> 00:02:57,290
the principal researcher at Bishop Fox

52
00:02:53,880 --> 00:03:01,019
this is Brandon Gaudet he is also

53
00:02:57,290 --> 00:03:04,380
working on the continuous attack surface

54
00:03:01,019 --> 00:03:06,360
testing team mr. Fox and we've been

55
00:03:04,380 --> 00:03:08,640
working on techniques and procedures and

56
00:03:06,360 --> 00:03:15,329
tools to help improve that process and

57
00:03:08,640 --> 00:03:17,399
improve that system yeah and so before

58
00:03:15,329 --> 00:03:18,989
we kind of go into the cloud and what

59
00:03:17,400 --> 00:03:21,209
your cloud exposes on the public

60
00:03:18,989 --> 00:03:25,109
Internet and the first thing you have to

61
00:03:21,209 --> 00:03:27,359
do is define what is an asset inventory

62
00:03:25,109 --> 00:03:29,579
and what is it X what is the success

63
00:03:27,359 --> 00:03:30,750
criteria to define that you your asset

64
00:03:29,579 --> 00:03:33,060
inventory is what you want it to be

65
00:03:30,750 --> 00:03:35,430
units doing what you need it to do so

66
00:03:33,060 --> 00:03:37,500
during our work we've kind of stepped

67
00:03:35,430 --> 00:03:39,450
down and took a step back and looked at

68
00:03:37,500 --> 00:03:40,980
this and kind of what do we want out of

69
00:03:39,450 --> 00:03:42,869
it what is it gonna do for us and what

70
00:03:40,980 --> 00:03:45,570
does it need to have in order to do that

71
00:03:42,870 --> 00:03:47,160
and those kind of break down into your

72
00:03:45,570 --> 00:03:48,690
some of your standards and some new

73
00:03:47,160 --> 00:03:50,609
approaches that we're taking so the

74
00:03:48,690 --> 00:03:53,489
first one is just that it is complete

75
00:03:50,609 --> 00:03:55,260
and accurate you don't want to be

76
00:03:53,489 --> 00:03:56,430
tracking assets that you no longer own

77
00:03:55,260 --> 00:03:58,350
because you could waste your time

78
00:03:56,430 --> 00:04:01,609
tracking down vulnerabilities or

79
00:03:58,350 --> 00:04:04,260
different types of problems and you also

80
00:04:01,609 --> 00:04:06,840
it's only as good as how accurate is

81
00:04:04,260 --> 00:04:09,269
because you only need to miss one asset

82
00:04:06,840 --> 00:04:11,160
on one subsidiary that has a critical

83
00:04:09,269 --> 00:04:13,889
vulnerability in order for you to feel

84
00:04:11,160 --> 00:04:16,108
like your asset inventory failed you or

85
00:04:13,889 --> 00:04:17,609
wasn't good enough in doing what you

86
00:04:16,108 --> 00:04:18,870
wanted it to do because you essentially

87
00:04:17,608 --> 00:04:19,888
weren't tracking something that was

88
00:04:18,870 --> 00:04:23,189
critical to your

89
00:04:19,889 --> 00:04:25,469
company's infrastructure so then once

90
00:04:23,189 --> 00:04:27,740
you have this base of accurate inventory

91
00:04:25,469 --> 00:04:29,729
kind of like what is the next step and

92
00:04:27,740 --> 00:04:31,229
for us it was kind of take a different

93
00:04:29,729 --> 00:04:33,479
approach than kind of the old-school

94
00:04:31,229 --> 00:04:35,520
approaches you do a pen test once a year

95
00:04:33,479 --> 00:04:38,188
and you kind of redefine your assets

96
00:04:35,520 --> 00:04:40,580
every still X months depending on your

97
00:04:38,189 --> 00:04:43,469
company and organization into having a

98
00:04:40,580 --> 00:04:45,210
continuously updated set of assets at

99
00:04:43,469 --> 00:04:48,748
any point in time if I have a question

100
00:04:45,210 --> 00:04:51,688
that I want to know about my exposure to

101
00:04:48,749 --> 00:04:52,919
the Internet for my organization I want

102
00:04:51,689 --> 00:04:55,349
to be look go to this asset inventory

103
00:04:52,919 --> 00:04:58,219
and just be able to ask it so that means

104
00:04:55,349 --> 00:05:00,509
you have to update that inventory at a

105
00:04:58,219 --> 00:05:01,919
quicker time period it can't be every

106
00:05:00,509 --> 00:05:05,039
year you should try to get it down to

107
00:05:01,919 --> 00:05:06,719
one plate or weekly or even daily in

108
00:05:05,039 --> 00:05:09,360
some cases so depending on your

109
00:05:06,719 --> 00:05:10,710
organization or your kind of your level

110
00:05:09,360 --> 00:05:12,659
of security you kind of want to reduce

111
00:05:10,710 --> 00:05:14,818
that time to as low as possible so that

112
00:05:12,659 --> 00:05:17,759
anytime you do have a question you can

113
00:05:14,819 --> 00:05:21,150
go and ask it and then kind of the last

114
00:05:17,759 --> 00:05:23,219
big thing was the thing I want to use my

115
00:05:21,150 --> 00:05:25,438
asset inventory for is to ask questions

116
00:05:23,219 --> 00:05:27,089
about it so we kind of need to improve

117
00:05:25,439 --> 00:05:28,830
the data we don't want just a list of

118
00:05:27,089 --> 00:05:32,189
assets or like a list of domain IPS

119
00:05:28,830 --> 00:05:33,930
insider ranges when I have a question

120
00:05:32,189 --> 00:05:36,779
about my exposure on the internet or

121
00:05:33,930 --> 00:05:38,819
what assets do I own I mostly want to be

122
00:05:36,779 --> 00:05:41,490
able to answer a specific question as in

123
00:05:38,819 --> 00:05:43,409
hey do I have this type of asset on my

124
00:05:41,490 --> 00:05:45,569
network and just having a domain moster

125
00:05:43,409 --> 00:05:47,370
IP address kind of isn't enough to

126
00:05:45,569 --> 00:05:49,680
answer those questions so we want to

127
00:05:47,370 --> 00:05:51,270
move the data that is in our inventory

128
00:05:49,680 --> 00:05:53,580
assets to something that's more

129
00:05:51,270 --> 00:05:56,370
actionable don't just have domains or

130
00:05:53,580 --> 00:05:58,318
IPS or cider ranges kind of scan those

131
00:05:56,370 --> 00:06:01,409
and see what ports are open or what

132
00:05:58,319 --> 00:06:03,089
services are running on them or any

133
00:06:01,409 --> 00:06:04,409
other kind of data what is what do they

134
00:06:03,089 --> 00:06:06,449
resolve to what name servers they're

135
00:06:04,409 --> 00:06:09,270
using in order to kind of have a better

136
00:06:06,449 --> 00:06:11,370
picture of what that inventory actually

137
00:06:09,270 --> 00:06:13,378
means and then be able to action on it

138
00:06:11,370 --> 00:06:16,199
and have the data that's required to

139
00:06:13,379 --> 00:06:18,389
action so kind of breaking those three

140
00:06:16,199 --> 00:06:21,060
thing down if you can do all of them and

141
00:06:18,389 --> 00:06:22,949
kind of doing them continuously and over

142
00:06:21,060 --> 00:06:24,779
time and always be able to ask them a

143
00:06:22,949 --> 00:06:27,659
specific question socially that would

144
00:06:24,779 --> 00:06:30,089
define a very successful inventory that

145
00:06:27,659 --> 00:06:31,949
if I have a question I can go and ask it

146
00:06:30,089 --> 00:06:33,400
I can get an answer and then I know that

147
00:06:31,949 --> 00:06:34,780
what I'm asking it a question that I'm

148
00:06:33,400 --> 00:06:38,770
the correct answer that it's accurate

149
00:06:34,780 --> 00:06:40,570
and for our perspective we focus we tend

150
00:06:38,770 --> 00:06:43,448
to focus on external attack surfaces

151
00:06:40,570 --> 00:06:45,370
which ends up being like your targets

152
00:06:43,449 --> 00:06:48,039
right so it's arguing would be a scheme

153
00:06:45,370 --> 00:06:51,160
host port combination and IP address and

154
00:06:48,039 --> 00:07:00,940
a way to interact with it that's really

155
00:06:51,160 --> 00:07:05,860
what we're trying to target here so yeah

156
00:07:00,940 --> 00:07:08,320
so the way that we tackle this at Bishop

157
00:07:05,860 --> 00:07:10,600
Fox is that we try to start with

158
00:07:08,320 --> 00:07:13,630
building a baseline in order to build a

159
00:07:10,600 --> 00:07:15,430
good baseline we take a couple different

160
00:07:13,630 --> 00:07:18,880
approaches the first thing that we want

161
00:07:15,430 --> 00:07:22,000
to try to do is identify a brand right

162
00:07:18,880 --> 00:07:23,979
what is your organization's brand what

163
00:07:22,000 --> 00:07:26,770
are all of the things associated with

164
00:07:23,979 --> 00:07:29,680
your organization and start moving from

165
00:07:26,770 --> 00:07:31,780
there we want to evaluate what your

166
00:07:29,680 --> 00:07:34,810
brand has what organization structure

167
00:07:31,780 --> 00:07:37,030
what's the org structure within this

168
00:07:34,810 --> 00:07:39,190
company what business units do they have

169
00:07:37,030 --> 00:07:43,570
do they have any specific products that

170
00:07:39,190 --> 00:07:45,880
they that they service or sell and/or do

171
00:07:43,570 --> 00:07:49,180
they are they large enough to have like

172
00:07:45,880 --> 00:07:55,300
a mergers and acquisitions be part of

173
00:07:49,180 --> 00:07:57,250
that infrastructure the within those

174
00:07:55,300 --> 00:07:59,440
business units and different portions of

175
00:07:57,250 --> 00:08:02,979
the organization we try to start

176
00:07:59,440 --> 00:08:05,860
tracking different types of assets so

177
00:08:02,979 --> 00:08:07,590
front-yard their primary domains any sub

178
00:08:05,860 --> 00:08:10,120
domains associated with those domains

179
00:08:07,590 --> 00:08:13,150
your IP address space like a site

180
00:08:10,120 --> 00:08:16,750
arrange active services that they may

181
00:08:13,150 --> 00:08:20,500
host or may may have as part of their

182
00:08:16,750 --> 00:08:21,570
infrastructure and any a SMS that would

183
00:08:20,500 --> 00:08:25,780
be associated with them

184
00:08:21,570 --> 00:08:28,090
and in addition to that making sure that

185
00:08:25,780 --> 00:08:31,510
again we're continuously updating that

186
00:08:28,090 --> 00:08:34,179
data with new dns information new

187
00:08:31,510 --> 00:08:36,370
records as they come up making sure that

188
00:08:34,179 --> 00:08:39,029
the domains that we're tracking are

189
00:08:36,370 --> 00:08:41,409
up-to-date as we're going to

190
00:08:39,029 --> 00:08:44,078
organizations purchase new ones or as

191
00:08:41,409 --> 00:08:47,020
they relinquish the old ones that

192
00:08:44,078 --> 00:08:50,140
they're no longer using and making

193
00:08:47,020 --> 00:08:52,120
that we have a accurate set of cider

194
00:08:50,140 --> 00:08:55,420
ranges so that when we're discussing

195
00:08:52,120 --> 00:08:57,520
what your attack surface is we know the

196
00:08:55,420 --> 00:09:03,819
correct set of my piece as a SN will

197
00:08:57,520 --> 00:09:06,189
change to change over time so yeah as

198
00:09:03,820 --> 00:09:07,600
Oscar stated we do this at a bishop box

199
00:09:06,190 --> 00:09:09,850
right now is a completely external

200
00:09:07,600 --> 00:09:11,290
perspective but there's kind of a second

201
00:09:09,850 --> 00:09:13,330
way of doing this and that's kind of

202
00:09:11,290 --> 00:09:15,310
where this presentation is gonna be

203
00:09:13,330 --> 00:09:17,380
pushing trying to push towards going

204
00:09:15,310 --> 00:09:19,540
towards and that is from a defensive

205
00:09:17,380 --> 00:09:20,770
standpoint you have access to more data

206
00:09:19,540 --> 00:09:23,199
than you do from an external ax

207
00:09:20,770 --> 00:09:26,140
standpoint you have access to master

208
00:09:23,200 --> 00:09:29,230
records for DNS you have access directly

209
00:09:26,140 --> 00:09:31,240
to your cloud accounts which we'll get

210
00:09:29,230 --> 00:09:33,310
into a lot more detail later so you have

211
00:09:31,240 --> 00:09:35,230
a different view on your network from

212
00:09:33,310 --> 00:09:37,569
the inside than you do the outside which

213
00:09:35,230 --> 00:09:40,420
gives you once again access to more data

214
00:09:37,570 --> 00:09:42,580
and a different way to try to find these

215
00:09:40,420 --> 00:09:44,170
domains and a different understanding of

216
00:09:42,580 --> 00:09:44,590
how the organization works in order to

217
00:09:44,170 --> 00:09:46,540
do it

218
00:09:44,590 --> 00:09:48,250
so listed below is a couple examples

219
00:09:46,540 --> 00:09:52,180
already named some DNS records domain

220
00:09:48,250 --> 00:09:53,620
registrar's scanning stuff just your

221
00:09:52,180 --> 00:09:55,719
internal IT team will know about the

222
00:09:53,620 --> 00:09:56,940
organization that it's not might not

223
00:09:55,720 --> 00:09:59,290
necessarily be public

224
00:09:56,940 --> 00:10:00,970
just like proprietary information are

225
00:09:59,290 --> 00:10:02,500
just kind of common knowledge within an

226
00:10:00,970 --> 00:10:05,050
organization is also very different than

227
00:10:02,500 --> 00:10:07,600
what you know is an external and all of

228
00:10:05,050 --> 00:10:09,430
this can be used to find domains that

229
00:10:07,600 --> 00:10:12,610
are different than you would find on an

230
00:10:09,430 --> 00:10:14,260
on an external attack surface so you

231
00:10:12,610 --> 00:10:19,900
should be using both this is the kind of

232
00:10:14,260 --> 00:10:22,360
the second approach of doing that so

233
00:10:19,900 --> 00:10:24,730
you're gonna start talking about kind of

234
00:10:22,360 --> 00:10:26,380
the methodology that we think makes the

235
00:10:24,730 --> 00:10:29,470
most sense when you're trying to create

236
00:10:26,380 --> 00:10:31,750
a complete inventory of your externally

237
00:10:29,470 --> 00:10:34,030
accessible targets you got to look at it

238
00:10:31,750 --> 00:10:35,710
from from both sides right from the

239
00:10:34,030 --> 00:10:39,220
inside looking out and from the outside

240
00:10:35,710 --> 00:10:41,320
looking in for the inside looking out

241
00:10:39,220 --> 00:10:44,680
kind of like we just discussed you have

242
00:10:41,320 --> 00:10:47,020
access to master records you have access

243
00:10:44,680 --> 00:10:49,359
to basically the source of truth for the

244
00:10:47,020 --> 00:10:53,020
information right if I'm trying to

245
00:10:49,360 --> 00:10:54,880
identify all the subdomains on on a

246
00:10:53,020 --> 00:10:57,490
domain that belongs to your organization

247
00:10:54,880 --> 00:10:59,950
from an external perspective I have a

248
00:10:57,490 --> 00:11:00,910
limited set of resources and I have to

249
00:10:59,950 --> 00:11:05,650
essentially get

250
00:11:00,910 --> 00:11:08,500
at what subdomains maybe and try to find

251
00:11:05,650 --> 00:11:12,160
records from an internal perspective you

252
00:11:08,500 --> 00:11:13,360
have access to your your DNS zones and

253
00:11:12,160 --> 00:11:15,880
you have access to all the subdomains

254
00:11:13,360 --> 00:11:20,650
that are in fact there so you have a

255
00:11:15,880 --> 00:11:23,290
more complete view from the outside on

256
00:11:20,650 --> 00:11:28,000
the flip side though from it as an

257
00:11:23,290 --> 00:11:32,079
internal as someone looking from the

258
00:11:28,000 --> 00:11:34,330
inside you only know what you know right

259
00:11:32,080 --> 00:11:35,590
so you have access to the records you

260
00:11:34,330 --> 00:11:37,750
can query the systems that you know

261
00:11:35,590 --> 00:11:41,590
about you can pull that information but

262
00:11:37,750 --> 00:11:46,870
shadow IT exists in many organizations

263
00:11:41,590 --> 00:11:49,960
and we've seen companies customers tell

264
00:11:46,870 --> 00:11:52,810
us well we have no AWS infrastructure

265
00:11:49,960 --> 00:11:55,390
for example and then during the

266
00:11:52,810 --> 00:11:57,339
assessment we break into their AWS

267
00:11:55,390 --> 00:11:59,290
infrastructure and so it turns out that

268
00:11:57,340 --> 00:12:02,290
somebody at the organization and a

269
00:11:59,290 --> 00:12:03,790
higher-up had created an account and we

270
00:12:02,290 --> 00:12:07,770
were able to correlate that data and

271
00:12:03,790 --> 00:12:10,780
find they're essentially shadow IT right

272
00:12:07,770 --> 00:12:14,350
so you can only protect what you know

273
00:12:10,780 --> 00:12:16,420
about and that's why we we also want to

274
00:12:14,350 --> 00:12:20,110
look at it from the outside in right Red

275
00:12:16,420 --> 00:12:21,930
Team Red Team errs and and Osen

276
00:12:20,110 --> 00:12:24,580
techniques can be used to help identify

277
00:12:21,930 --> 00:12:32,020
assets that you own that you are unaware

278
00:12:24,580 --> 00:12:33,460
of yes this is kind of an example what

279
00:12:32,020 --> 00:12:36,040
we didn't want on our customers we took

280
00:12:33,460 --> 00:12:38,350
the outside an approach well gathering

281
00:12:36,040 --> 00:12:40,420
asking our customer to hand us all of

282
00:12:38,350 --> 00:12:43,030
the inside out approach so in this case

283
00:12:40,420 --> 00:12:44,920
they handed us forty three hundred and

284
00:12:43,030 --> 00:12:47,680
eighty one domains that they knew about

285
00:12:44,920 --> 00:12:49,449
from an inside perspective and then we

286
00:12:47,680 --> 00:12:51,099
did the outside predictive scan of doing

287
00:12:49,450 --> 00:12:53,170
a full deep dive into the organization

288
00:12:51,100 --> 00:12:55,420
its acquisitions and subsidiaries doing

289
00:12:53,170 --> 00:12:56,829
our own identification and we ended up

290
00:12:55,420 --> 00:12:59,800
with eleven thousand one hundred ninety

291
00:12:56,830 --> 00:13:02,920
one domains and under those some might

292
00:12:59,800 --> 00:13:05,079
not have been there so we had 79 roughly

293
00:13:02,920 --> 00:13:06,790
eight thousand high confidence so what

294
00:13:05,080 --> 00:13:08,410
we mean by confidence here is those

295
00:13:06,790 --> 00:13:10,030
domains are correlated with multiple

296
00:13:08,410 --> 00:13:12,189
data points that belong to the company

297
00:13:10,030 --> 00:13:13,220
so it could be like they have their name

298
00:13:12,190 --> 00:13:14,269
server and their

299
00:13:13,220 --> 00:13:16,040
screen shot looks like them or something

300
00:13:14,269 --> 00:13:18,230
they essentially have more than one data

301
00:13:16,040 --> 00:13:19,939
point that makes us believe that it

302
00:13:18,230 --> 00:13:21,740
belongs to the company where we have

303
00:13:19,939 --> 00:13:23,719
some medium confidence domains there's

304
00:13:21,740 --> 00:13:26,000
just over three thousand that just kind

305
00:13:23,720 --> 00:13:27,949
of have one data point might be Whois

306
00:13:26,000 --> 00:13:29,300
data might be something else where it

307
00:13:27,949 --> 00:13:31,250
could be somebody else just trying to

308
00:13:29,300 --> 00:13:34,639
act like them or it might just not be

309
00:13:31,250 --> 00:13:36,529
them anymore but there still looks like

310
00:13:34,639 --> 00:13:38,089
them it just might not be then and then

311
00:13:36,529 --> 00:13:40,879
we would combine this data you kind of

312
00:13:38,089 --> 00:13:43,490
get that we from an external perspective

313
00:13:40,879 --> 00:13:45,410
only missed 24 domains

314
00:13:43,490 --> 00:13:48,500
well they end up missing from an

315
00:13:45,410 --> 00:13:49,550
internal perspective 11,000 domains but

316
00:13:48,500 --> 00:13:51,620
how many domains here is not an

317
00:13:49,550 --> 00:13:53,269
necessarily important kind of what to

318
00:13:51,620 --> 00:13:55,490
pull out of this slide and what matters

319
00:13:53,269 --> 00:13:58,160
is that neither approach was good enough

320
00:13:55,490 --> 00:14:00,889
to find all of the domains so we ended

321
00:13:58,160 --> 00:14:02,540
up missing 24 domains and while digging

322
00:14:00,889 --> 00:14:05,870
into those domains we realized they had

323
00:14:02,540 --> 00:14:09,589
things like protected privacy Whois data

324
00:14:05,870 --> 00:14:11,180
and did have data directly correlated to

325
00:14:09,589 --> 00:14:13,189
the company or any of these acquisitions

326
00:14:11,180 --> 00:14:14,839
so those type of domains are gonna be

327
00:14:13,189 --> 00:14:16,339
almost impossible to find from an

328
00:14:14,839 --> 00:14:18,079
external perspective because they'd have

329
00:14:16,339 --> 00:14:20,360
nothing that's tying them to the company

330
00:14:18,079 --> 00:14:22,399
but from an internal perspective they

331
00:14:20,360 --> 00:14:25,250
had records showing that they owned it

332
00:14:22,399 --> 00:14:27,500
and they host it or that they control

333
00:14:25,250 --> 00:14:28,699
what it's doing which is not something

334
00:14:27,500 --> 00:14:30,949
that you'll ever find from the external

335
00:14:28,699 --> 00:14:33,109
where for this organization they had a

336
00:14:30,949 --> 00:14:35,269
lot of the shadow IT or the security

337
00:14:33,110 --> 00:14:36,949
team had acquisitions that they didn't

338
00:14:35,269 --> 00:14:38,930
know about where when we looked at it

339
00:14:36,949 --> 00:14:40,819
from an external perspective their

340
00:14:38,930 --> 00:14:42,800
security team essentially the org itself

341
00:14:40,819 --> 00:14:45,378
was behind because this company acquires

342
00:14:42,800 --> 00:14:46,819
a lot and we found domains that were

343
00:14:45,379 --> 00:14:48,620
associated with acquisitions that they

344
00:14:46,819 --> 00:14:50,420
weren't necessarily tracking that

345
00:14:48,620 --> 00:14:51,860
infrastructure wasn't pulled into their

346
00:14:50,420 --> 00:14:55,370
security team yet so they just weren't

347
00:14:51,860 --> 00:14:56,660
tracking it yet the things kind of take

348
00:14:55,370 --> 00:14:58,129
away from this is that neither approach

349
00:14:56,660 --> 00:14:59,719
is good enough to find all of it but if

350
00:14:58,129 --> 00:15:00,980
we kind of can take both approaches at

351
00:14:59,720 --> 00:15:03,500
the same time we'll have a better

352
00:15:00,980 --> 00:15:05,660
understanding of the total external

353
00:15:03,500 --> 00:15:09,050
attack surface our asset management of

354
00:15:05,660 --> 00:15:12,110
an organization so let's say that now

355
00:15:09,050 --> 00:15:14,120
you've gone through the process you're

356
00:15:12,110 --> 00:15:16,519
convinced that you want to use the at

357
00:15:14,120 --> 00:15:20,089
the inside-out approach right how do you

358
00:15:16,519 --> 00:15:22,339
find all of the AWS accounts that you

359
00:15:20,089 --> 00:15:25,639
own we have some customers that have

360
00:15:22,339 --> 00:15:27,020
hundreds of AWS accounts and they need

361
00:15:25,639 --> 00:15:30,649
to track all those

362
00:15:27,020 --> 00:15:33,470
how do you find shadow IT within your

363
00:15:30,649 --> 00:15:35,600
organization and one technique is to

364
00:15:33,470 --> 00:15:38,480
follow the money right so talk to your

365
00:15:35,600 --> 00:15:40,790
finance group see if anybody has put

366
00:15:38,480 --> 00:15:44,450
credit card charges for AWS

367
00:15:40,790 --> 00:15:46,579
on their on their cards and try to track

368
00:15:44,450 --> 00:15:50,240
those people down and try to get access

369
00:15:46,580 --> 00:15:53,959
to to that data or visibility into their

370
00:15:50,240 --> 00:15:55,790
accounts one thing to know is that you

371
00:15:53,959 --> 00:15:58,180
know just because you're looking for AWS

372
00:15:55,790 --> 00:16:00,949
Azure or like Google Cloud compute

373
00:15:58,180 --> 00:16:02,420
that's not necessarily all the different

374
00:16:00,950 --> 00:16:05,589
ways that shadow IT can come up there

375
00:16:02,420 --> 00:16:10,099
are additional you know SAS services

376
00:16:05,589 --> 00:16:12,560
that can also create AWS accounts for

377
00:16:10,100 --> 00:16:14,480
you or plug accounts for you that would

378
00:16:12,560 --> 00:16:18,500
show up on on that so just beware for

379
00:16:14,480 --> 00:16:20,839
that but about that so once you've

380
00:16:18,500 --> 00:16:22,149
collected information about all the

381
00:16:20,839 --> 00:16:25,180
accounts that you want to have access to

382
00:16:22,149 --> 00:16:27,370
how do you manage that and I think the

383
00:16:25,180 --> 00:16:30,260
answer is you create one more account

384
00:16:27,370 --> 00:16:34,240
which is the one that has accessed from

385
00:16:30,260 --> 00:16:36,890
like a read-only access auditor role to

386
00:16:34,240 --> 00:16:40,760
to get insight into all the accounts

387
00:16:36,890 --> 00:16:41,990
that you have identified so then yeah

388
00:16:40,760 --> 00:16:43,339
once even once you have the accounts

389
00:16:41,990 --> 00:16:44,750
then the next questions are like what do

390
00:16:43,339 --> 00:16:47,510
you do with those accounts or what do

391
00:16:44,750 --> 00:16:48,440
you care about so you kind of boil it

392
00:16:47,510 --> 00:16:49,819
down add a few pieces of information

393
00:16:48,440 --> 00:16:51,529
once you have access to an account

394
00:16:49,820 --> 00:16:53,000
there's kind of different informations

395
00:16:51,529 --> 00:16:55,130
you can pull out of these cloud

396
00:16:53,000 --> 00:16:57,110
providers and so depending on your

397
00:16:55,130 --> 00:16:58,250
access level and what you can do and

398
00:16:57,110 --> 00:16:59,930
what services you're using it'll all

399
00:16:58,250 --> 00:17:01,310
change the kind of boils down to a

400
00:16:59,930 --> 00:17:03,439
couple different things so that you're

401
00:17:01,310 --> 00:17:07,250
internally facing stuff which should

402
00:17:03,440 --> 00:17:09,770
only be accessed internally but you can

403
00:17:07,250 --> 00:17:11,089
be misconfigured be PCs and other things

404
00:17:09,770 --> 00:17:15,319
so that that's not necessarily the case

405
00:17:11,089 --> 00:17:17,300
there's the internal side there's and

406
00:17:15,319 --> 00:17:19,938
also the internet side so some services

407
00:17:17,300 --> 00:17:22,069
create like an s3 will create it

408
00:17:19,939 --> 00:17:25,250
essentially a link to the outside

409
00:17:22,069 --> 00:17:27,619
Internet where people can access it from

410
00:17:25,250 --> 00:17:29,120
the external and then there's kind of

411
00:17:27,619 --> 00:17:30,409
the in-between there's different

412
00:17:29,120 --> 00:17:32,090
services you can set up in between that

413
00:17:30,410 --> 00:17:34,670
will link the internal the external or

414
00:17:32,090 --> 00:17:36,949
just could be done and something we did

415
00:17:34,670 --> 00:17:38,690
look into is the a TMS resource

416
00:17:36,950 --> 00:17:39,700
relationships so there's something now

417
00:17:38,690 --> 00:17:41,500
called it I am

418
00:17:39,700 --> 00:17:43,029
analyzer which is something that looks

419
00:17:41,500 --> 00:17:45,279
at your infrastructure and determines

420
00:17:43,029 --> 00:17:46,450
that so it can help you determine if

421
00:17:45,279 --> 00:17:49,630
those internal things are publicly

422
00:17:46,450 --> 00:17:51,460
facing or any type of those

423
00:17:49,630 --> 00:17:54,789
misconfigurations are happening on the

424
00:17:51,460 --> 00:17:57,850
internal system yeah so some in some

425
00:17:54,789 --> 00:18:02,289
cases you can configure like AWS for

426
00:17:57,850 --> 00:18:04,539
example to give any other account within

427
00:18:02,289 --> 00:18:07,470
AWS at all not within your organization

428
00:18:04,539 --> 00:18:09,610
just any AWS account access to your data

429
00:18:07,470 --> 00:18:11,320
that's not really what we're focusing on

430
00:18:09,610 --> 00:18:14,019
for this talk we're really focusing on

431
00:18:11,320 --> 00:18:20,980
from the external perspective internet

432
00:18:14,019 --> 00:18:22,480
facing systems so when we're looking at

433
00:18:20,980 --> 00:18:26,919
this the types of data that we're trying

434
00:18:22,480 --> 00:18:29,350
to collect here are associated with host

435
00:18:26,919 --> 00:18:32,590
names which is whether it be a DNS

436
00:18:29,350 --> 00:18:34,658
record or an IP address what ports are

437
00:18:32,590 --> 00:18:37,149
being exposed on that infrastructure

438
00:18:34,659 --> 00:18:37,960
what what protocol is being used to

439
00:18:37,149 --> 00:18:40,750
interact with it

440
00:18:37,960 --> 00:18:42,970
are there any relative paths that may be

441
00:18:40,750 --> 00:18:45,760
relevant when you're accessing it so in

442
00:18:42,970 --> 00:18:47,620
some cases like if you're doing a lambda

443
00:18:45,760 --> 00:18:52,120
and you're putting it behind an API

444
00:18:47,620 --> 00:18:54,279
gateway then it is a host name plus a

445
00:18:52,120 --> 00:18:56,018
path in order to access that content so

446
00:18:54,279 --> 00:18:57,610
making sure that you have the kind of

447
00:18:56,019 --> 00:19:03,570
the read relevant contextual knowledge

448
00:18:57,610 --> 00:19:05,709
of how to interact with that system and

449
00:19:03,570 --> 00:19:08,799
one of the interesting things to note

450
00:19:05,710 --> 00:19:12,190
for cloud services in particular is that

451
00:19:08,799 --> 00:19:14,350
there's a lot of be hosting or like

452
00:19:12,190 --> 00:19:17,409
multi honing of these systems so do you

453
00:19:14,350 --> 00:19:20,199
just scan the internet for and IP on an

454
00:19:17,409 --> 00:19:22,539
IP basis you will not reach the correct

455
00:19:20,200 --> 00:19:25,000
back-end application that's serving your

456
00:19:22,539 --> 00:19:27,610
data in a lot of cases right you have an

457
00:19:25,000 --> 00:19:31,149
ec2 box then that has an IP address as a

458
00:19:27,610 --> 00:19:34,120
scientist to you but if you are using s3

459
00:19:31,149 --> 00:19:36,010
for example you you won't really access

460
00:19:34,120 --> 00:19:38,739
it by IP address you won't get to this

461
00:19:36,010 --> 00:19:41,158
list system that you're trying to to

462
00:19:38,740 --> 00:19:41,159
target

463
00:19:42,730 --> 00:19:47,660
so when we started this we were trying

464
00:19:46,280 --> 00:19:54,490
to answer that question right what

465
00:19:47,660 --> 00:19:54,490
systems are exposed to the Internet

466
00:19:54,880 --> 00:20:01,760
when when we were looking at this you

467
00:19:57,920 --> 00:20:06,740
know the the number of services that AWS

468
00:20:01,760 --> 00:20:09,260
passed in 2011 yet in 2011 it was like a

469
00:20:06,740 --> 00:20:12,530
handful right you could look at them you

470
00:20:09,260 --> 00:20:14,960
could count them very easily in 2017

471
00:20:12,530 --> 00:20:18,920
that number kind of exploded that number

472
00:20:14,960 --> 00:20:22,640
just continued to go up every year they

473
00:20:18,920 --> 00:20:25,040
release new like several new services

474
00:20:22,640 --> 00:20:26,210
and it becomes harder and harder to keep

475
00:20:25,040 --> 00:20:29,300
track of which one of those services

476
00:20:26,210 --> 00:20:34,250
have publicly facing data and which one

477
00:20:29,300 --> 00:20:36,850
of those services have I expose you on

478
00:20:34,250 --> 00:20:36,850
the Internet

479
00:20:37,030 --> 00:20:43,940
so some of the previous research that we

480
00:20:40,280 --> 00:20:45,889
looked into there was cloud mapper AWS

481
00:20:43,940 --> 00:20:49,040
public IPS which was linked from cloud

482
00:20:45,890 --> 00:20:50,410
mapper and access analyzer which we

483
00:20:49,040 --> 00:20:53,149
discussed a little bit earlier and

484
00:20:50,410 --> 00:20:55,610
cartography which was a tool by lift

485
00:20:53,150 --> 00:20:58,790
that kind of did a couple a little bit

486
00:20:55,610 --> 00:21:00,469
of everything some of the problems that

487
00:20:58,790 --> 00:21:02,629
we had with those is that it wasn't

488
00:21:00,470 --> 00:21:04,730
comprehensive it didn't have access to

489
00:21:02,630 --> 00:21:08,060
all the different endpoints just a very

490
00:21:04,730 --> 00:21:09,770
select few not all yeah so not all

491
00:21:08,060 --> 00:21:11,540
services were covered some of them had

492
00:21:09,770 --> 00:21:13,160
port information some of them didn't

493
00:21:11,540 --> 00:21:15,649
some of them had protocol information

494
00:21:13,160 --> 00:21:19,310
some of them didn't some of them focused

495
00:21:15,650 --> 00:21:20,420
on access control lists and none of them

496
00:21:19,310 --> 00:21:24,530
did exactly what we needed

497
00:21:20,420 --> 00:21:28,280
so our first pass at this was going

498
00:21:24,530 --> 00:21:31,010
through the looking on the internet for

499
00:21:28,280 --> 00:21:33,740
what are the URL structures or the

500
00:21:31,010 --> 00:21:39,190
access patterns that you can use in

501
00:21:33,740 --> 00:21:43,460
order to get access to this data so

502
00:21:39,190 --> 00:21:45,590
first we went to the Guru api's guru and

503
00:21:43,460 --> 00:21:47,960
found some information that seems to be

504
00:21:45,590 --> 00:21:52,459
updated fairly often about what AWS

505
00:21:47,960 --> 00:21:55,250
services were available and in within

506
00:21:52,460 --> 00:21:55,850
their what the URLs were and we use that

507
00:21:55,250 --> 00:21:59,390
too

508
00:21:55,850 --> 00:22:01,879
perform some analysis using like passive

509
00:21:59,390 --> 00:22:03,679
DNS data to see what kind of data you

510
00:22:01,880 --> 00:22:07,850
could get access to there's some

511
00:22:03,679 --> 00:22:16,130
examples that we put together of how it

512
00:22:07,850 --> 00:22:18,889
is how the domains are structured this

513
00:22:16,130 --> 00:22:22,400
part based on time so here's some

514
00:22:18,890 --> 00:22:26,890
example of exposed elastic search

515
00:22:22,400 --> 00:22:30,080
indexes that contain sensitive data that

516
00:22:26,890 --> 00:22:32,390
you can access only by hitting the

517
00:22:30,080 --> 00:22:34,039
correct hostname if you access these by

518
00:22:32,390 --> 00:22:36,020
IP address it doesn't work you can't

519
00:22:34,039 --> 00:22:38,299
scan for these with an with the old

520
00:22:36,020 --> 00:22:40,908
method of scanning IP on the right you

521
00:22:38,299 --> 00:22:42,679
need host names so making sure that you

522
00:22:40,909 --> 00:22:47,659
can find these on your environment helps

523
00:22:42,679 --> 00:22:51,980
you protect yourself same with another

524
00:22:47,659 --> 00:22:54,590
example was the media media store which

525
00:22:51,980 --> 00:22:57,980
allows you to watch videos or post

526
00:22:54,590 --> 00:22:59,240
videos the ready to videos we found

527
00:22:57,980 --> 00:23:01,549
patterns that allowed us to access

528
00:22:59,240 --> 00:23:04,760
channels that were supposed to be paid

529
00:23:01,549 --> 00:23:07,520
channels or part of the Samsung library

530
00:23:04,760 --> 00:23:11,390
of TV channels that we were able to

531
00:23:07,520 --> 00:23:14,270
access without owning a Samsung TV so

532
00:23:11,390 --> 00:23:18,890
our current solution now is to create

533
00:23:14,270 --> 00:23:21,530
another tool producing small cloud right

534
00:23:18,890 --> 00:23:23,990
which is essentially a tool to help you

535
00:23:21,530 --> 00:23:29,059
identify and pull out all the host names

536
00:23:23,990 --> 00:23:31,700
IP addresses and and you our eyes that

537
00:23:29,059 --> 00:23:36,770
are publicly exposed on your AWS

538
00:23:31,700 --> 00:23:39,200
infrastructure and you yeah so big thing

539
00:23:36,770 --> 00:23:40,580
here is I'm kind of offended the same

540
00:23:39,200 --> 00:23:43,280
problem of which ones do we actually

541
00:23:40,580 --> 00:23:45,918
want to look at so we've looked at the

542
00:23:43,280 --> 00:23:48,139
example documentation with the AWS CLI I

543
00:23:45,919 --> 00:23:51,409
did some grep commands and try to

544
00:23:48,140 --> 00:23:53,299
understand what ones was returning

545
00:23:51,409 --> 00:23:55,669
datasets we wanted either domains or IPs

546
00:23:53,299 --> 00:23:57,190
and after enumerate again you end up

547
00:23:55,669 --> 00:24:00,770
with a much smaller list than the

548
00:23:57,190 --> 00:24:03,230
thousands or hundreds of different

549
00:24:00,770 --> 00:24:04,400
services that are available in AWS so at

550
00:24:03,230 --> 00:24:06,770
that point you then have to take a

551
00:24:04,400 --> 00:24:08,090
deeper look so we essentially integrated

552
00:24:06,770 --> 00:24:10,010
those I think next slide shows that we

553
00:24:08,090 --> 00:24:12,080
ended up with 288 and

554
00:24:10,010 --> 00:24:15,590
across sixty two services that returned

555
00:24:12,080 --> 00:24:17,720
either hosting gi's or IPS from that we

556
00:24:15,590 --> 00:24:20,120
could see that there was ex-service --is

557
00:24:17,720 --> 00:24:22,040
so we started manually and going through

558
00:24:20,120 --> 00:24:24,530
each service and looking at these

559
00:24:22,040 --> 00:24:28,430
endpoints to identify which ones would

560
00:24:24,530 --> 00:24:30,590
disclose it and how so so far we've gone

561
00:24:28,430 --> 00:24:33,470
through 14 services like including like

562
00:24:30,590 --> 00:24:35,899
API gateway CloudFront s3 and wrote

563
00:24:33,470 --> 00:24:38,360
tooling that could be easily extendable

564
00:24:35,900 --> 00:24:40,190
in order to hold the correct information

565
00:24:38,360 --> 00:24:42,229
out of those services that would be

566
00:24:40,190 --> 00:24:46,310
publicly facing and interesting to look

567
00:24:42,230 --> 00:24:49,100
at from an external perspective yeah and

568
00:24:46,310 --> 00:24:51,889
so there's a couple of tricky things

569
00:24:49,100 --> 00:24:54,320
right the 680 services our only ones

570
00:24:51,890 --> 00:24:56,060
that returned like fully formed host

571
00:24:54,320 --> 00:24:58,189
names you are eyes or IPs but there's

572
00:24:56,060 --> 00:25:00,050
also services that don't return that

573
00:24:58,190 --> 00:25:02,660
information so like example for an

574
00:25:00,050 --> 00:25:05,659
example s3 it will give you your bucket

575
00:25:02,660 --> 00:25:07,070
main but not the full URL so there's

576
00:25:05,660 --> 00:25:10,820
still additional combing that needs to

577
00:25:07,070 --> 00:25:13,520
be performed through the 194 services

578
00:25:10,820 --> 00:25:16,280
that are available but I think this is a

579
00:25:13,520 --> 00:25:18,590
good start we've created we've pushed

580
00:25:16,280 --> 00:25:20,540
the code to the repo and put some

581
00:25:18,590 --> 00:25:23,720
documentation there you can run it and

582
00:25:20,540 --> 00:25:26,690
see the outcome for you our eyes IPS and

583
00:25:23,720 --> 00:25:31,310
hostname on your external infrastructure

584
00:25:26,690 --> 00:25:33,080
or externally facing cloud and and past

585
00:25:31,310 --> 00:25:35,270
that you know we're working towards

586
00:25:33,080 --> 00:25:40,820
getting a more and more comprehensive

587
00:25:35,270 --> 00:25:43,700
list to to wrap up our view of what your

588
00:25:40,820 --> 00:25:49,580
external attack surfaces when looking at

589
00:25:43,700 --> 00:25:50,960
an AWS account thank you for listening I

590
00:25:49,580 --> 00:25:52,820
know we had to go through the end faster

591
00:25:50,960 --> 00:25:54,440
to time anyone has any questions we'll

592
00:25:52,820 --> 00:25:57,860
be around to answer those

593
00:25:54,440 --> 00:26:00,610
yeah via the slack channel or any type

594
00:25:57,860 --> 00:26:00,610
of questioning system

