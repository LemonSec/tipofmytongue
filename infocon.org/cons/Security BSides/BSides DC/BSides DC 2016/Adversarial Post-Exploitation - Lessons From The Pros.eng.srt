1
00:00:00,000 --> 00:00:06,720
the b-sides DC 2016 videos are brought

2
00:00:03,240 --> 00:00:10,129
to you by clear jobs net and cyber sex

3
00:00:06,720 --> 00:00:12,899
calm tools for your next career move and

4
00:00:10,130 --> 00:00:15,330
Antietam technologies focusing on

5
00:00:12,900 --> 00:00:20,789
advanced cyber detection analysis and

6
00:00:15,330 --> 00:00:22,650
mitigation good morning thank you

7
00:00:20,789 --> 00:00:23,910
besides for having us putting this on

8
00:00:22,650 --> 00:00:25,740
our talk is<font color="#E5E5E5"> going to be called</font>

9
00:00:23,910 --> 00:00:28,320
adversarial post exploitation lessons

10
00:00:25,740 --> 00:00:29,340
from the pros we're going<font color="#E5E5E5"> to go over a</font>

11
00:00:28,320 --> 00:00:31,140
lot of really interesting<font color="#E5E5E5"> stuff here</font>

12
00:00:29,340 --> 00:00:32,850
today we're going to focus on a kind of

13
00:00:31,140 --> 00:00:34,320
<font color="#E5E5E5">introduction on what adversary emulation</font>

14
00:00:32,850 --> 00:00:37,260
is and what red teaming is and how we

15
00:00:34,320 --> 00:00:38,430
apply it in the services space lessons

16
00:00:37,260 --> 00:00:41,329
from bad guys we're going<font color="#E5E5E5"> to go through</font>

17
00:00:38,430 --> 00:00:43,890
<font color="#E5E5E5">a bunch of</font><font color="#CCCCCC"> different apt examples and</font>

18
00:00:41,329 --> 00:00:46,289
malicious pieces of malware that we

19
00:00:43,890 --> 00:00:48,480
found and talk about<font color="#E5E5E5"> how we can study</font>

20
00:00:46,289 --> 00:00:49,980
them to better emulate bad guys on

21
00:00:48,480 --> 00:00:51,779
engagements we're going<font color="#E5E5E5"> to go through</font>

22
00:00:49,980 --> 00:00:53,309
<font color="#CCCCCC">each feature at a technical level go</font>

23
00:00:51,780 --> 00:00:55,110
through the mal reverse engineering of

24
00:00:53,309 --> 00:00:57,180
it what we<font color="#CCCCCC"> discovered and how we apply</font>

25
00:00:55,110 --> 00:00:59,910
that as well as kind of a very broad

26
00:00:57,180 --> 00:01:01,410
overview of the defense I'm just a

27
00:00:59,910 --> 00:01:02,669
<font color="#CCCCCC">Warner I'm the manager of offensive</font>

28
00:01:01,410 --> 00:01:04,709
services here at the adapter threat

29
00:01:02,670 --> 00:01:07,409
division so I hear a whole bunch<font color="#E5E5E5"> of us</font>

30
00:01:04,709 --> 00:01:08,610
up here I'm a former<font color="#E5E5E5"> Air Force guy spend</font>

31
00:01:07,409 --> 00:01:11,220
a lot of time in the DoD about five

32
00:01:08,610 --> 00:01:12,990
years<font color="#E5E5E5"> a lot of time right and then I</font>

33
00:01:11,220 --> 00:01:15,630
transition to the commercial sector

34
00:01:12,990 --> 00:01:17,189
where I do consulting now I'm a Fairfax

35
00:01:15,630 --> 00:01:22,199
County volunteer<font color="#CCCCCC"> EMT so if there's any</font>

36
00:01:17,189 --> 00:01:24,270
fire rescue volunteers hi Chris my name

37
00:01:22,200 --> 00:01:26,790
is chris ross<font color="#CCCCCC"> i've</font><font color="#E5E5E5"> been a part</font><font color="#CCCCCC"> of a</font><font color="#E5E5E5"> TV</font>

38
00:01:24,270 --> 00:01:29,189
for just about two years I'm also

39
00:01:26,790 --> 00:01:33,659
involved with Python<font color="#E5E5E5"> Empire and I'm a</font>

40
00:01:29,189 --> 00:01:35,908
former sysadmin so inspiration for this

41
00:01:33,659 --> 00:01:37,619
talk I saw the talk by ritual war tell a

42
00:01:35,909 --> 00:01:39,600
long time it goes a couple<font color="#CCCCCC"> years ago at</font>

43
00:01:37,619 --> 00:01:41,729
<font color="#CCCCCC">B side chicago and his talk was called</font>

44
00:01:39,600 --> 00:01:43,740
<font color="#CCCCCC">malware's hard let's go shopping and the</font>

45
00:01:41,729 --> 00:01:46,770
generic theme of the talk was diving

46
00:01:43,740 --> 00:01:48,390
deep into<font color="#E5E5E5"> a supposedly very advanced bad</font>

47
00:01:46,770 --> 00:01:50,220
guys malware sample to look at the

48
00:01:48,390 --> 00:01:52,020
different mistakes they make and then

49
00:01:50,220 --> 00:01:53,610
how<font color="#CCCCCC"> we can learn from them so I really</font>

50
00:01:52,020 --> 00:01:55,079
like the idea of a mix of a technical

51
00:01:53,610 --> 00:01:57,000
talk where you're diving deep into these

52
00:01:55,079 --> 00:01:58,740
samples as well as kind of applying the

53
00:01:57,000 --> 00:01:59,939
big broad overview as well as many of

54
00:01:58,740 --> 00:02:01,189
the different offensive tool sets that

55
00:01:59,939 --> 00:02:03,869
have come out over the past couple years

56
00:02:01,189 --> 00:02:05,579
so<font color="#E5E5E5"> Mac grabbers power supply project PDF</font>

57
00:02:03,869 --> 00:02:07,920
proxy<font color="#CCCCCC"> Meekins all these different tools</font>

58
00:02:05,579 --> 00:02:10,109
that are based on techniques that are

59
00:02:07,920 --> 00:02:11,360
being leveraged by<font color="#E5E5E5"> real-world bad guys</font>

60
00:02:10,110 --> 00:02:13,520
and breach scenarios

61
00:02:11,360 --> 00:02:14,990
and it inspired me to kind of look at

62
00:02:13,520 --> 00:02:16,370
what we could do better<font color="#E5E5E5"> from the from</font>

63
00:02:14,990 --> 00:02:18,020
<font color="#E5E5E5">the other side and then lots of red team</font>

64
00:02:16,370 --> 00:02:19,250
engagement so in the two years I've<font color="#CCCCCC"> been</font>

65
00:02:18,020 --> 00:02:21,890
on numerous red team engagements for

66
00:02:19,250 --> 00:02:23,300
commercial top fortune companies and you

67
00:02:21,890 --> 00:02:25,070
learn a lot<font color="#CCCCCC"> in each engagement you kind</font>

68
00:02:23,300 --> 00:02:27,230
of take<font color="#E5E5E5"> away a different lesson learning</font>

69
00:02:25,070 --> 00:02:29,329
a different skill or technique that that

70
00:02:27,230 --> 00:02:31,100
was never heard<font color="#E5E5E5"> about before never</font>

71
00:02:29,330 --> 00:02:33,560
really been publicized or a way to do it

72
00:02:31,100 --> 00:02:35,989
that's<font color="#E5E5E5"> not previously known and in these</font>

73
00:02:33,560 --> 00:02:37,730
engagements you really learn a lot<font color="#E5E5E5"> so</font>

74
00:02:35,990 --> 00:02:39,440
before we go too deep we want to give

75
00:02:37,730 --> 00:02:41,480
<font color="#E5E5E5">you a good intro overview about really</font>

76
00:02:39,440 --> 00:02:43,910
<font color="#E5E5E5">what we're talking</font><font color="#CCCCCC"> about so first we</font>

77
00:02:41,480 --> 00:02:45,380
have to start with what is an adversary

78
00:02:43,910 --> 00:02:46,730
and that's kind of<font color="#E5E5E5"> the other guy on the</font>

79
00:02:45,380 --> 00:02:48,769
other side of the playing field this is

80
00:02:46,730 --> 00:02:50,359
this is if you're a blue team this<font color="#E5E5E5"> is</font>

81
00:02:48,770 --> 00:02:52,430
<font color="#E5E5E5">the red team or for the red team the</font>

82
00:02:50,360 --> 00:02:56,570
blue team or in the real world this is

83
00:02:52,430 --> 00:02:58,340
either nation-states or criminals or you

84
00:02:56,570 --> 00:03:00,019
know kids<font color="#E5E5E5"> in a basement or you know</font><font color="#CCCCCC"> any</font>

85
00:02:58,340 --> 00:03:02,300
sort of asymmetric threat that might be

86
00:03:00,020 --> 00:03:03,890
out<font color="#CCCCCC"> there then what is the threat</font><font color="#E5E5E5"> it's</font>

87
00:03:02,300 --> 00:03:06,700
that thing that it's the source of the

88
00:03:03,890 --> 00:03:08,809
harm so both source and means and

89
00:03:06,700 --> 00:03:10,609
there's<font color="#E5E5E5"> a wide range of different</font>

90
00:03:08,810 --> 00:03:12,080
adversaries so when you talk about red

91
00:03:10,610 --> 00:03:14,270
teaming or adversary emulation you're

92
00:03:12,080 --> 00:03:15,890
not really<font color="#E5E5E5"> just focusing on super</font>

93
00:03:14,270 --> 00:03:17,450
advanced like nation state level threat

94
00:03:15,890 --> 00:03:19,010
that could be one aspect of it so

95
00:03:17,450 --> 00:03:21,170
there's there's obviously apts like

96
00:03:19,010 --> 00:03:25,609
these guys notice the middle pictures

97
00:03:21,170 --> 00:03:27,980
<font color="#CCCCCC">matt graver he's apt there's also a BTS</font>

98
00:03:25,610 --> 00:03:30,410
like these guys so these are these<font color="#CCCCCC"> are</font>

99
00:03:27,980 --> 00:03:33,079
<font color="#E5E5E5">rare old threats to environments they</font>

100
00:03:30,410 --> 00:03:34,790
might be it might be<font color="#CCCCCC"> a deed awesome it</font>

101
00:03:33,080 --> 00:03:37,790
might be a script kidding in a basement

102
00:03:34,790 --> 00:03:40,190
but because of the means of warfare or

103
00:03:37,790 --> 00:03:42,440
the means of computers these days it

104
00:03:40,190 --> 00:03:45,130
gives them a unique advantage that makes

105
00:03:42,440 --> 00:03:47,120
them a real power in an<font color="#E5E5E5"> environment and</font>

106
00:03:45,130 --> 00:03:48,739
so when you talk<font color="#CCCCCC"> about adversary</font>

107
00:03:47,120 --> 00:03:50,870
emulation it's it's a<font color="#E5E5E5"> form or</font>

108
00:03:48,739 --> 00:03:52,880
subcategory of red teaming is how I like

109
00:03:50,870 --> 00:03:55,040
<font color="#CCCCCC">to think of it it's a</font><font color="#E5E5E5"> specific kind of</font>

110
00:03:52,880 --> 00:03:57,890
red teaming focused on modeling a very

111
00:03:55,040 --> 00:03:59,630
realistic known threat and so you're

112
00:03:57,890 --> 00:04:01,730
looking<font color="#E5E5E5"> at you're utilizing intelligence</font>

113
00:03:59,630 --> 00:04:03,709
that is<font color="#E5E5E5"> either public or private to</font>

114
00:04:01,730 --> 00:04:05,350
model this adversary you're<font color="#E5E5E5"> trying to</font>

115
00:04:03,709 --> 00:04:07,880
both model their behaviors and

116
00:04:05,350 --> 00:04:10,519
objectives all the way down to their low

117
00:04:07,880 --> 00:04:13,160
level techniques or malware or ways that

118
00:04:10,519 --> 00:04:14,930
they do things<font color="#E5E5E5"> they're obviously a lot</font>

119
00:04:13,160 --> 00:04:16,640
<font color="#E5E5E5">of benefits to this approach so you know</font>

120
00:04:14,930 --> 00:04:18,410
it's very measurable you can actually

121
00:04:16,640 --> 00:04:19,579
<font color="#E5E5E5">tie your direct actions as something</font>

122
00:04:18,410 --> 00:04:21,530
<font color="#E5E5E5">that's been done in</font><font color="#CCCCCC"> the wild which</font>

123
00:04:19,579 --> 00:04:23,419
answers a lot of questions from execs

124
00:04:21,529 --> 00:04:24,799
and different decision makers but also

125
00:04:23,419 --> 00:04:26,659
there's some notable weakness

126
00:04:24,800 --> 00:04:28,190
<font color="#CCCCCC">is that are that are introduced</font><font color="#E5E5E5"> and so</font>

127
00:04:26,659 --> 00:04:30,409
when you're<font color="#E5E5E5"> forced to model a specific</font>

128
00:04:28,190 --> 00:04:32,719
adversary you risk of handcuffed in<font color="#E5E5E5"> the</font>

129
00:04:30,409 --> 00:04:35,300
red team so part of red teaming is being

130
00:04:32,720 --> 00:04:38,720
creative<font color="#E5E5E5"> and flexible and learning in</font>

131
00:04:35,300 --> 00:04:40,159
the engagement to adapt and change when

132
00:04:38,720 --> 00:04:42,110
you're trying<font color="#E5E5E5"> to model an adversary if</font>

133
00:04:40,159 --> 00:04:44,659
you if you do that if you<font color="#CCCCCC"> flex and adapt</font>

134
00:04:42,110 --> 00:04:46,250
you might deviate from that model or

135
00:04:44,659 --> 00:04:48,530
that threat model in which case you you

136
00:04:46,250 --> 00:04:50,720
risk kind of straying outside of what

137
00:04:48,530 --> 00:04:52,729
you were<font color="#E5E5E5"> intending on doing and so some</font>

138
00:04:50,720 --> 00:04:54,650
<font color="#CCCCCC">of these weaknesses are worth noting it</font>

139
00:04:52,729 --> 00:04:56,449
doesn't this depends on what<font color="#CCCCCC"> the end</font>

140
00:04:54,650 --> 00:04:59,150
goal or what the objective isn't in the

141
00:04:56,449 --> 00:05:01,219
different engagements as there's no real

142
00:04:59,150 --> 00:05:03,830
framework for adversary emulation or

143
00:05:01,219 --> 00:05:06,169
ways to model adversaries I<font color="#E5E5E5"> kind of like</font>

144
00:05:03,830 --> 00:05:07,878
to<font color="#E5E5E5"> look at defensive frameworks or tools</font>

145
00:05:06,169 --> 00:05:09,080
so there's<font color="#E5E5E5"> something called the diamond</font>

146
00:05:07,879 --> 00:05:11,449
model which<font color="#CCCCCC"> is essentially it's a</font>

147
00:05:09,080 --> 00:05:12,949
mathematical<font color="#CCCCCC"> model it's it's used both</font>

148
00:05:11,449 --> 00:05:15,500
mathematically as well as kind of<font color="#CCCCCC"> in a</font>

149
00:05:12,949 --> 00:05:16,879
generic concept but it basically states

150
00:05:15,500 --> 00:05:18,409
that for every intrusion event there's

151
00:05:16,879 --> 00:05:20,629
an adversary taking a step towards an

152
00:05:18,409 --> 00:05:22,729
intended goal by using a capability with

153
00:05:20,629 --> 00:05:24,650
an infrastructure against the victim so

154
00:05:22,729 --> 00:05:26,270
it breaks out and characterizes

155
00:05:24,650 --> 00:05:29,120
adversaries<font color="#E5E5E5"> into kind of four different</font>

156
00:05:26,270 --> 00:05:31,130
components and so we're going to talk a

157
00:05:29,120 --> 00:05:33,199
lot<font color="#E5E5E5"> about tools today in capabilities</font>

158
00:05:31,130 --> 00:05:34,460
and techniques but there's other aspects

159
00:05:33,199 --> 00:05:36,139
<font color="#CCCCCC">of our steering emulation that you have</font>

160
00:05:34,460 --> 00:05:37,609
to be aware of when you're when you're

161
00:05:36,139 --> 00:05:39,650
actually doing this threat modeling

162
00:05:37,610 --> 00:05:40,699
things like are you<font color="#E5E5E5"> using a similar type</font>

163
00:05:39,650 --> 00:05:42,799
of<font color="#CCCCCC"> infrastructure or the same</font>

164
00:05:40,699 --> 00:05:44,389
infrastructure as them not necessarily

165
00:05:42,800 --> 00:05:45,949
IP addresses<font color="#E5E5E5"> but let's say they use</font>

166
00:05:44,389 --> 00:05:49,819
digital ocean during their operations

167
00:05:45,949 --> 00:05:51,919
can use digital ocean or adversaries

168
00:05:49,819 --> 00:05:53,300
what adversary are you trying to become

169
00:05:51,919 --> 00:05:57,139
and what victims<font color="#E5E5E5"> are you going after</font>

170
00:05:53,300 --> 00:05:58,310
with what objectives post exploitation I

171
00:05:57,139 --> 00:05:59,479
want to make sure<font color="#E5E5E5"> I highlight and call</font>

172
00:05:58,310 --> 00:06:01,129
this out this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> one of</font><font color="#E5E5E5"> the biggest</font>

173
00:05:59,479 --> 00:06:03,318
phases during red team and adversary

174
00:06:01,129 --> 00:06:05,330
emulation engagements and so<font color="#E5E5E5"> oftentimes</font>

175
00:06:03,319 --> 00:06:08,150
in our engagements they can be weeks to

176
00:06:05,330 --> 00:06:10,430
months to half a year long<font color="#E5E5E5"> and in that</font>

177
00:06:08,150 --> 00:06:12,198
<font color="#E5E5E5">case</font><font color="#CCCCCC"> we want to</font><font color="#E5E5E5"> make sure that we are</font>

178
00:06:10,430 --> 00:06:13,969
often<font color="#E5E5E5"> in the network within the first</font>

179
00:06:12,199 --> 00:06:16,400
week meaning that we're spending<font color="#E5E5E5"> four to</font>

180
00:06:13,969 --> 00:06:17,509
five<font color="#E5E5E5"> months moving around the</font>

181
00:06:16,400 --> 00:06:20,120
environment targeting different

182
00:06:17,509 --> 00:06:21,770
objectives in in working through

183
00:06:20,120 --> 00:06:22,909
different phases and so post

184
00:06:21,770 --> 00:06:24,500
exploitation is probably the<font color="#CCCCCC"> most</font>

185
00:06:22,909 --> 00:06:26,060
consequential phase during these

186
00:06:24,500 --> 00:06:28,069
engagements it's where the most of the

187
00:06:26,060 --> 00:06:29,449
intelligence gathering is conducted it's

188
00:06:28,069 --> 00:06:31,069
where you're actually obtaining and

189
00:06:29,449 --> 00:06:32,569
getting your objectives as<font color="#E5E5E5"> well as</font>

190
00:06:31,069 --> 00:06:33,979
demonstrating that impact and in

191
00:06:32,569 --> 00:06:35,089
providing the training two different

192
00:06:33,979 --> 00:06:37,250
blue team members which is the ultimate

193
00:06:35,089 --> 00:06:38,449
goal of these engagements it's not just

194
00:06:37,250 --> 00:06:40,309
show they're vulnerable

195
00:06:38,449 --> 00:06:41,960
<font color="#E5E5E5">that's one aspect of it but it's also</font>

196
00:06:40,309 --> 00:06:43,809
provide training as well as show the

197
00:06:41,960 --> 00:06:46,549
risk of a breach in an<font color="#E5E5E5"> environment</font>

198
00:06:43,809 --> 00:06:49,460
before<font color="#E5E5E5"> you</font><font color="#CCCCCC"> go to</font><font color="#E5E5E5"> much deeper we're the</font>

199
00:06:46,550 --> 00:06:51,499
dog and the<font color="#CCCCCC"> bad guys the turtle and so</font>

200
00:06:49,460 --> 00:06:52,818
we're going to ride off all the work

201
00:06:51,499 --> 00:06:55,879
that<font color="#E5E5E5"> they've done and we're going to</font>

202
00:06:52,819 --> 00:06:57,860
heavily focus on stealing their ideas or

203
00:06:55,879 --> 00:07:00,319
learning from them so that<font color="#E5E5E5"> we don't have</font>

204
00:06:57,860 --> 00:07:02,089
<font color="#E5E5E5">to</font><font color="#CCCCCC"> go innovate as often innovation can</font>

205
00:07:00,319 --> 00:07:03,860
be really awesome it can be expensive

206
00:07:02,089 --> 00:07:07,370
and resources and time and money and

207
00:07:03,860 --> 00:07:10,039
researchers so if you can study a sample

208
00:07:07,370 --> 00:07:11,539
or a specific breach analysis why not

209
00:07:10,039 --> 00:07:13,610
just replicate some of the activity

210
00:07:11,539 --> 00:07:14,990
you've seen there again relax somebody's

211
00:07:13,610 --> 00:07:20,330
already done the<font color="#CCCCCC"> work for you that's the</font>

212
00:07:14,990 --> 00:07:25,279
beauty of being a red team<font color="#CCCCCC"> er so when</font>

213
00:07:20,330 --> 00:07:27,198
focusing on threat emulation with

214
00:07:25,279 --> 00:07:29,240
focusing on threat emulation it really

215
00:07:27,199 --> 00:07:31,610
<font color="#E5E5E5">pushes you to understand the what's</font>

216
00:07:29,240 --> 00:07:34,219
going on underneath these different

217
00:07:31,610 --> 00:07:36,949
samples and techniques and I think as

218
00:07:34,219 --> 00:07:38,990
testers we generally have an idea<font color="#E5E5E5"> that</font>

219
00:07:36,949 --> 00:07:41,360
we practice their emulation on and gave

220
00:07:38,990 --> 00:07:43,339
engagements when really<font color="#E5E5E5"> where we're</font>

221
00:07:41,360 --> 00:07:47,960
modeling ourselves after a general

222
00:07:43,339 --> 00:07:49,849
threat so this is<font color="#E5E5E5"> just a general</font>

223
00:07:47,960 --> 00:07:51,649
overview of our<font color="#E5E5E5"> process for a threat</font>

224
00:07:49,849 --> 00:07:55,580
emulation and<font color="#E5E5E5"> I'll talk about</font><font color="#CCCCCC"> each of</font>

225
00:07:51,649 --> 00:07:57,110
these in the following slides so where

226
00:07:55,580 --> 00:07:59,599
can we see some<font color="#CCCCCC"> of these cool stuff I</font>

227
00:07:57,110 --> 00:08:03,080
know myself personally I like to look at

228
00:07:59,599 --> 00:08:05,300
threat reports to find new cool ideas to

229
00:08:03,080 --> 00:08:07,370
implement I'm and also some of<font color="#E5E5E5"> the times</font>

230
00:08:05,300 --> 00:08:09,649
these reports are more so marketing

231
00:08:07,370 --> 00:08:12,529
material than actual technical

232
00:08:09,649 --> 00:08:14,029
documentation which is unfortunate but

233
00:08:12,529 --> 00:08:17,659
really that's what we're looking for<font color="#E5E5E5"> a</font>

234
00:08:14,029 --> 00:08:22,009
<font color="#E5E5E5">detailed sort of map of where we</font><font color="#CCCCCC"> need to</font>

235
00:08:17,659 --> 00:08:23,810
go to<font color="#E5E5E5"> implement this technique and then</font>

236
00:08:22,009 --> 00:08:26,029
when it<font color="#E5E5E5"> comes to analyzing or looking at</font>

237
00:08:23,810 --> 00:08:27,770
<font color="#E5E5E5">these samples you want to lean on the</font>

238
00:08:26,029 --> 00:08:30,919
technical documentation that you

239
00:08:27,770 --> 00:08:32,870
acquired previously and use that to<font color="#E5E5E5"> kind</font>

240
00:08:30,919 --> 00:08:34,880
of walk you through the<font color="#E5E5E5"> code or walk you</font>

241
00:08:32,870 --> 00:08:37,940
through<font color="#CCCCCC"> what you can look at an Ida pro</font>

242
00:08:34,880 --> 00:08:40,429
on<font color="#CCCCCC"> to find specifically</font><font color="#E5E5E5"> what you're</font>

243
00:08:37,940 --> 00:08:42,740
looking for and<font color="#E5E5E5"> how to implement it and</font>

244
00:08:40,429 --> 00:08:44,420
I definitely<font color="#E5E5E5"> recommend practical malware</font>

245
00:08:42,740 --> 00:08:48,019
analysis to anyone who's interested in

246
00:08:44,420 --> 00:08:49,760
reverse engineering it's a great book

247
00:08:48,019 --> 00:08:50,930
there's a lot<font color="#CCCCCC"> of hands-on labs</font>

248
00:08:49,760 --> 00:08:54,290
and you'll definitely take away

249
00:08:50,930 --> 00:08:55,370
something from it and we<font color="#E5E5E5"> won't do this</font>

250
00:08:54,290 --> 00:08:57,980
to you we're not<font color="#E5E5E5"> going to show you just</font>

251
00:08:55,370 --> 00:09:00,850
<font color="#E5E5E5">a random screenshot of some I to pro</font>

252
00:08:57,980 --> 00:09:03,080
output expect you to gain much from it I

253
00:09:00,850 --> 00:09:08,900
think it's<font color="#E5E5E5"> really cheesy when companies</font>

254
00:09:03,080 --> 00:09:10,520
do<font color="#CCCCCC"> that so when looking at alternatives</font>

255
00:09:08,900 --> 00:09:13,970
the great thing is<font color="#CCCCCC"> that there's almost</font>

256
00:09:10,520 --> 00:09:16,010
always a POC or some open source project

257
00:09:13,970 --> 00:09:18,770
that is available<font color="#CCCCCC"> on github or</font><font color="#E5E5E5"> Rohit</font>

258
00:09:16,010 --> 00:09:21,470
labs or somewhere else for you to use as

259
00:09:18,770 --> 00:09:23,960
a base for your project for development

260
00:09:21,470 --> 00:09:26,270
I think that's a<font color="#CCCCCC"> great thing and</font><font color="#E5E5E5"> it</font>

261
00:09:23,960 --> 00:09:28,910
allows you to quickly or rapidly develop

262
00:09:26,270 --> 00:09:33,020
your<font color="#CCCCCC"> PLC for the technique you want to</font>

263
00:09:28,910 --> 00:09:35,030
implement so when it comes<font color="#E5E5E5"> to</font>

264
00:09:33,020 --> 00:09:37,610
implementation I think the<font color="#E5E5E5"> level of</font>

265
00:09:35,030 --> 00:09:41,079
difficulty depends on how<font color="#CCCCCC"> well you want</font>

266
00:09:37,610 --> 00:09:44,270
<font color="#E5E5E5">to replicate what this threat was doing</font>

267
00:09:41,080 --> 00:09:48,640
or what this what this group was doing

268
00:09:44,270 --> 00:09:51,170
in their technique<font color="#CCCCCC"> whether you want</font><font color="#E5E5E5"> to</font>

269
00:09:48,640 --> 00:09:53,090
definitely<font color="#E5E5E5"> focus on true threat</font>

270
00:09:51,170 --> 00:09:55,069
replication or you want<font color="#E5E5E5"> to take what</font>

271
00:09:53,090 --> 00:09:59,140
they did and sort of<font color="#E5E5E5"> modify it and apply</font>

272
00:09:55,070 --> 00:10:00,860
<font color="#E5E5E5">to a general or generic solution and</font>

273
00:09:59,140 --> 00:10:02,870
definitely<font color="#E5E5E5"> you want to live off the land</font>

274
00:10:00,860 --> 00:10:05,360
and that's what brings<font color="#E5E5E5"> us to why we love</font>

275
00:10:02,870 --> 00:10:08,060
<font color="#CCCCCC">powershell so much</font><font color="#E5E5E5"> I think nowadays</font>

276
00:10:05,360 --> 00:10:09,530
whenever you see a new tool release nine

277
00:10:08,060 --> 00:10:13,459
times<font color="#E5E5E5"> out of</font><font color="#CCCCCC"> ten you can</font><font color="#E5E5E5"> say it was</font>

278
00:10:09,530 --> 00:10:15,470
<font color="#E5E5E5">implemented in</font><font color="#CCCCCC"> PowerShell and for me the</font>

279
00:10:13,460 --> 00:10:17,930
biggest benefits are just direct access

280
00:10:15,470 --> 00:10:21,160
to<font color="#E5E5E5"> the windows api and its default</font>

281
00:10:17,930 --> 00:10:23,810
installed on windows<font color="#CCCCCC"> 7 and</font><font color="#E5E5E5"> above and</font>

282
00:10:21,160 --> 00:10:26,630
just a<font color="#E5E5E5"> little disclaimer all these tools</font>

283
00:10:23,810 --> 00:10:29,209
that we've written our strictly POC and

284
00:10:26,630 --> 00:10:31,160
we don't<font color="#E5E5E5"> really plan on providing active</font>

285
00:10:29,210 --> 00:10:34,360
support for some<font color="#CCCCCC"> of them</font><font color="#E5E5E5"> after this talk</font>

286
00:10:31,160 --> 00:10:37,459
so we're going to ignore your get issues

287
00:10:34,360 --> 00:10:39,860
and make<font color="#CCCCCC"> sure you understand the code in</font>

288
00:10:37,460 --> 00:10:43,640
use it at your own risk and<font color="#E5E5E5"> even</font>

289
00:10:39,860 --> 00:10:45,320
contribute if you can so<font color="#CCCCCC"> I'm going to go</font>

290
00:10:43,640 --> 00:10:46,670
<font color="#CCCCCC">back it's a huge pet peeve the screen</font>

291
00:10:45,320 --> 00:10:48,710
<font color="#CCCCCC">shot at the bottom is sewing running</font>

292
00:10:46,670 --> 00:10:51,349
code right off of github don't do<font color="#CCCCCC"> that</font>

293
00:10:48,710 --> 00:10:53,120
no your code or else we'll put message

294
00:10:51,350 --> 00:10:56,470
boxes in them so you get<font color="#E5E5E5"> popups on every</font>

295
00:10:53,120 --> 00:10:58,430
OPP you use we've totally not done<font color="#CCCCCC"> that</font>

296
00:10:56,470 --> 00:11:01,940
so the first example we're going to

297
00:10:58,430 --> 00:11:03,660
cover was inspired by an adversary or a

298
00:11:01,940 --> 00:11:05,280
tool that we saw<font color="#E5E5E5"> going around the y</font>

299
00:11:03,660 --> 00:11:07,620
a lot of<font color="#E5E5E5"> the</font><font color="#CCCCCC"> old-school</font><font color="#E5E5E5"> Trojans you see</font>

300
00:11:05,280 --> 00:11:09,569
<font color="#CCCCCC">Senate running around things from late</font>

301
00:11:07,620 --> 00:11:11,160
90s or early thousands<font color="#E5E5E5"> it's it's all the</font>

302
00:11:09,570 --> 00:11:13,380
rage to like get webcam and microphone

303
00:11:11,160 --> 00:11:14,850
access right like that's the sexiest

304
00:11:13,380 --> 00:11:16,920
thing you can do is access someone's

305
00:11:14,850 --> 00:11:18,210
webcam and take a snapshot of them you

306
00:11:16,920 --> 00:11:20,729
get<font color="#CCCCCC"> this</font><font color="#E5E5E5"> really juicy picture of them</font>

307
00:11:18,210 --> 00:11:22,380
playing<font color="#E5E5E5"> Wow or something it's really</font>

308
00:11:20,730 --> 00:11:24,030
impressive now you might you might think

309
00:11:22,380 --> 00:11:25,500
it's kind of silly because you're like

310
00:11:24,030 --> 00:11:27,569
well what value does that actually have

311
00:11:25,500 --> 00:11:29,040
to a sophisticated adversary but there's

312
00:11:27,570 --> 00:11:31,440
a lot of intelligence<font color="#CCCCCC"> that can be gained</font>

313
00:11:29,040 --> 00:11:33,569
or learned from a microphone recording

314
00:11:31,440 --> 00:11:35,940
of you depending on what time or where

315
00:11:33,570 --> 00:11:37,170
you're at as well as the webcam image so

316
00:11:35,940 --> 00:11:39,240
we start by kind<font color="#E5E5E5"> of looking at these</font>

317
00:11:37,170 --> 00:11:40,589
examples the the example we're going to

318
00:11:39,240 --> 00:11:42,390
dive into for<font color="#E5E5E5"> the microphone recording</font>

319
00:11:40,590 --> 00:11:44,880
is called<font color="#CCCCCC"> Lux net rat it's an old school</font>

320
00:11:42,390 --> 00:11:46,350
<font color="#CCCCCC">trojan similar to like you know sub 7 or</font>

321
00:11:44,880 --> 00:11:48,510
back or first<font color="#CCCCCC"> i was</font><font color="#E5E5E5"> running around very</font>

322
00:11:46,350 --> 00:11:51,240
commodity in its nature but it provided

323
00:11:48,510 --> 00:11:52,770
the ability to issue commands to a

324
00:11:51,240 --> 00:11:54,270
multimedia interface which allowed you

325
00:11:52,770 --> 00:11:56,280
to kind of dump<font color="#CCCCCC"> WAV files and gain</font>

326
00:11:54,270 --> 00:11:57,990
control of the<font color="#E5E5E5"> microphone which will</font>

327
00:11:56,280 --> 00:11:59,760
dive<font color="#CCCCCC"> into a</font><font color="#E5E5E5"> little bit deeper</font><font color="#CCCCCC"> and then</font>

328
00:11:57,990 --> 00:12:01,500
for<font color="#E5E5E5"> the webcam specific capability we're</font>

329
00:11:59,760 --> 00:12:04,140
going to dive into adversary known as

330
00:12:01,500 --> 00:12:05,760
rocket kitten they have a tool called

331
00:12:04,140 --> 00:12:08,340
mpk shell which is kind<font color="#E5E5E5"> of their</font>

332
00:12:05,760 --> 00:12:10,830
lightweight<font color="#CCCCCC"> backdoor very very simple</font><font color="#E5E5E5"> in</font>

333
00:12:08,340 --> 00:12:13,170
nature however it uses a set of<font color="#E5E5E5"> API</font>

334
00:12:10,830 --> 00:12:15,240
calls called VFW video for<font color="#E5E5E5"> windows to</font>

335
00:12:13,170 --> 00:12:18,300
access and control the webcam that we're

336
00:12:15,240 --> 00:12:20,040
<font color="#E5E5E5">going to dive deep into so for mci the</font>

337
00:12:18,300 --> 00:12:21,449
basically<font color="#E5E5E5"> what the malware sample did so</font>

338
00:12:20,040 --> 00:12:23,730
when you tore apart Lux now and when you

339
00:12:21,450 --> 00:12:25,740
looked at it essentially the the bad

340
00:12:23,730 --> 00:12:27,000
guys controlling it were simply<font color="#E5E5E5"> sending</font>

341
00:12:25,740 --> 00:12:29,490
commands to something called<font color="#E5E5E5"> the</font>

342
00:12:27,000 --> 00:12:31,170
multimedia or multimedia command

343
00:12:29,490 --> 00:12:32,940
interface it's facing an abstraction

344
00:12:31,170 --> 00:12:35,010
layer over all the different devices

345
00:12:32,940 --> 00:12:36,060
that your computer<font color="#E5E5E5"> uses most people</font>

346
00:12:35,010 --> 00:12:38,189
don't even<font color="#E5E5E5"> know it's there it's built</font>

347
00:12:36,060 --> 00:12:40,650
into<font color="#CCCCCC"> Windows it's built to help</font>

348
00:12:38,190 --> 00:12:42,930
developers or programmers control those

349
00:12:40,650 --> 00:12:44,550
different devices and so by simply

350
00:12:42,930 --> 00:12:47,160
sending command strings to that

351
00:12:44,550 --> 00:12:48,780
abstraction layer it'll handle the<font color="#E5E5E5"> back</font>

352
00:12:47,160 --> 00:12:49,980
<font color="#E5E5E5">end control the devices for you you</font>

353
00:12:48,780 --> 00:12:52,439
<font color="#E5E5E5">don't need to do anything device</font>

354
00:12:49,980 --> 00:12:53,940
specific or independent so when we<font color="#CCCCCC"> were</font>

355
00:12:52,440 --> 00:12:55,260
looking on an engagement one time we

356
00:12:53,940 --> 00:12:56,730
were like hey we need<font color="#E5E5E5"> to we think it</font>

357
00:12:55,260 --> 00:12:58,260
would be really<font color="#CCCCCC"> cool to both demo this</font>

358
00:12:56,730 --> 00:13:00,680
to the customer as<font color="#CCCCCC"> well as see what we</font>

359
00:12:58,260 --> 00:13:03,210
can gain by utilizing microphone capture

360
00:13:00,680 --> 00:13:05,099
<font color="#CCCCCC">God approvals went through everything we</font>

361
00:13:03,210 --> 00:13:06,480
def duck<font color="#E5E5E5"> this capability that used this</font>

362
00:13:05,100 --> 00:13:08,850
technique and so it would send

363
00:13:06,480 --> 00:13:11,370
individual strings to that abstraction

364
00:13:08,850 --> 00:13:13,260
layer to essentially drop a recording

365
00:13:11,370 --> 00:13:14,880
<font color="#CCCCCC">wave file to disk and</font><font color="#E5E5E5"> then allow you to</font>

366
00:13:13,260 --> 00:13:16,500
download it and close the recording very

367
00:13:14,880 --> 00:13:17,400
simple requires like four different API

368
00:13:16,500 --> 00:13:20,910
calls to do

369
00:13:17,400 --> 00:13:22,170
and in very little<font color="#E5E5E5"> chance of error here</font>

370
00:13:20,910 --> 00:13:25,709
as the abstraction layer is going to

371
00:13:22,170 --> 00:13:28,380
<font color="#E5E5E5">handle any faults or errors for you as</font>

372
00:13:25,710 --> 00:13:29,700
far<font color="#E5E5E5"> as the video capability with rocket</font>

373
00:13:28,380 --> 00:13:33,000
kit and what they were doing is they

374
00:13:29,700 --> 00:13:36,540
were essentially using the VFW libraries

375
00:13:33,000 --> 00:13:38,160
inside of<font color="#CCCCCC"> Windows to control a capture</font>

376
00:13:36,540 --> 00:13:40,500
window and so they would instantiate a

377
00:13:38,160 --> 00:13:42,209
capture window on the<font color="#E5E5E5"> system and then</font>

378
00:13:40,500 --> 00:13:44,160
they would send commands to that capture

379
00:13:42,210 --> 00:13:46,110
window to get the drivers get the

380
00:13:44,160 --> 00:13:47,939
description and issue a recording and

381
00:13:46,110 --> 00:13:49,110
that hidden capture window and then they

382
00:13:47,940 --> 00:13:50,460
would disconnect the driver and that

383
00:13:49,110 --> 00:13:52,410
would result in a recording being

384
00:13:50,460 --> 00:13:54,270
written out the<font color="#CCCCCC"> disk and now we're going</font>

385
00:13:52,410 --> 00:13:56,370
to<font color="#E5E5E5"> talk about how much that hurt us</font>

386
00:13:54,270 --> 00:13:59,040
going forward so when researching

387
00:13:56,370 --> 00:14:00,330
alternatives for the<font color="#E5E5E5"> video stuff it was</font>

388
00:13:59,040 --> 00:14:01,709
a<font color="#CCCCCC"> really easy to find</font><font color="#E5E5E5"> we went to</font>

389
00:14:00,330 --> 00:14:03,300
<font color="#E5E5E5">microsoft's website we're like what else</font>

390
00:14:01,710 --> 00:14:05,280
is there there has to be more native

391
00:14:03,300 --> 00:14:07,380
capability to access these different

392
00:14:05,280 --> 00:14:08,939
<font color="#CCCCCC">devices and one</font><font color="#E5E5E5"> of the first</font><font color="#CCCCCC"> things we</font>

393
00:14:07,380 --> 00:14:11,370
see is many of its features have been

394
00:14:08,940 --> 00:14:13,020
superseded by DirectX it's like oh dang

395
00:14:11,370 --> 00:14:15,540
it<font color="#E5E5E5"> rocky kitten like they're using old</font>

396
00:14:13,020 --> 00:14:17,130
school like superseded capabilities and

397
00:14:15,540 --> 00:14:19,410
we'll show you why but<font color="#E5E5E5"> essentially the</font>

398
00:14:17,130 --> 00:14:22,080
biggest alternative was just use DirectX

399
00:14:19,410 --> 00:14:23,280
it's it's built<font color="#CCCCCC"> for this very reason and</font>

400
00:14:22,080 --> 00:14:25,380
there's a whole<font color="#E5E5E5"> bunch of libraries and</font>

401
00:14:23,280 --> 00:14:27,780
supports in different languages and<font color="#CCCCCC"> so</font>

402
00:14:25,380 --> 00:14:29,100
we consider<font color="#CCCCCC"> that for audio we</font><font color="#E5E5E5"> analyzed a</font>

403
00:14:27,780 --> 00:14:30,180
<font color="#E5E5E5">lot of different</font><font color="#CCCCCC"> tools so when I was</font>

404
00:14:29,100 --> 00:14:31,560
<font color="#E5E5E5">going through all this piece of</font>

405
00:14:30,180 --> 00:14:33,359
commodity malware it's like the least

406
00:14:31,560 --> 00:14:34,709
fun thing for verse engineers the sit

407
00:14:33,360 --> 00:14:37,380
and stare at commodity malware all day

408
00:14:34,710 --> 00:14:38,970
and I was<font color="#CCCCCC"> I spent about two days going</font>

409
00:14:37,380 --> 00:14:41,010
through different samples hoping to find

410
00:14:38,970 --> 00:14:42,930
some different method of doing

411
00:14:41,010 --> 00:14:44,310
microphone capture fortunately<font color="#E5E5E5"> the</font>

412
00:14:42,930 --> 00:14:46,620
majority of them uses the windows

413
00:14:44,310 --> 00:14:47,790
multimedia library or in mci<font color="#E5E5E5"> and so I</font>

414
00:14:46,620 --> 00:14:49,590
didn't<font color="#CCCCCC"> really find other ways although</font>

415
00:14:47,790 --> 00:14:52,829
DirectX and we've considered other

416
00:14:49,590 --> 00:14:54,240
methods that would be just<font color="#E5E5E5"> as usable so</font>

417
00:14:52,830 --> 00:14:55,860
the resulting capability and the big

418
00:14:54,240 --> 00:14:57,150
picture<font color="#CCCCCC"> takeaway for us was on that up</font>

419
00:14:55,860 --> 00:15:00,060
where we<font color="#CCCCCC"> actually ran into this</font>

420
00:14:57,150 --> 00:15:01,620
situation we were able to mock up this

421
00:15:00,060 --> 00:15:02,939
capability we call to get microphone

422
00:15:01,620 --> 00:15:04,680
audio and powershell it's actually

423
00:15:02,940 --> 00:15:06,630
support supported to the power supply

424
00:15:04,680 --> 00:15:09,329
dev ranch so this is one<font color="#E5E5E5"> that will be</font>

425
00:15:06,630 --> 00:15:12,960
supported unlike<font color="#CCCCCC"> most of the others and</font>

426
00:15:09,330 --> 00:15:14,430
it used the win it win<font color="#E5E5E5"> MCI to issue</font><font color="#CCCCCC"> this</font>

427
00:15:12,960 --> 00:15:15,900
calls and<font color="#CCCCCC"> dumped away file to</font><font color="#E5E5E5"> disk the</font>

428
00:15:14,430 --> 00:15:17,489
big<font color="#E5E5E5"> picture</font><font color="#CCCCCC"> takeaway is is we were</font><font color="#E5E5E5"> able</font>

429
00:15:15,900 --> 00:15:19,380
to<font color="#E5E5E5"> take this luxe net route which we</font>

430
00:15:17,490 --> 00:15:20,820
studied<font color="#CCCCCC"> in depth reverse engineered it</font>

431
00:15:19,380 --> 00:15:23,460
figured out how<font color="#E5E5E5"> they</font><font color="#CCCCCC"> did it and then</font>

432
00:15:20,820 --> 00:15:25,350
directly mock it up for use during a red

433
00:15:23,460 --> 00:15:27,120
team engagement so when the customer

434
00:15:25,350 --> 00:15:28,740
says you know you guys were dumping

435
00:15:27,120 --> 00:15:30,270
audio from dis how are you doing<font color="#E5E5E5"> that or</font>

436
00:15:28,740 --> 00:15:31,360
why were you doing that you<font color="#E5E5E5"> could you</font>

437
00:15:30,270 --> 00:15:32,380
could<font color="#CCCCCC"> cite and tell them</font>

438
00:15:31,360 --> 00:15:34,209
you know let them know that you were

439
00:15:32,380 --> 00:15:36,310
your emulating a real bad guy that<font color="#E5E5E5"> does</font>

440
00:15:34,209 --> 00:15:38,920
this in the wild in this case you<font color="#CCCCCC"> might</font>

441
00:15:36,310 --> 00:15:40,599
wonder what is audio gets you well when

442
00:15:38,920 --> 00:15:42,130
you're sitting in a call center or

443
00:15:40,600 --> 00:15:44,470
you're targeting a call center or a

444
00:15:42,130 --> 00:15:46,000
network operations center or a security

445
00:15:44,470 --> 00:15:48,760
operation center and they're handling

446
00:15:46,000 --> 00:15:50,620
trouble tickets or various different of

447
00:15:48,760 --> 00:15:52,899
customer support or I don't know

448
00:15:50,620 --> 00:15:54,970
administering systems audio gets you a

449
00:15:52,899 --> 00:15:56,380
<font color="#CCCCCC">lot you can hear</font><font color="#E5E5E5"> a lot of really juicy</font>

450
00:15:54,970 --> 00:15:57,790
details and you can learn a<font color="#E5E5E5"> lot about</font>

451
00:15:56,380 --> 00:16:00,700
the network by listening<font color="#E5E5E5"> to voices</font>

452
00:15:57,790 --> 00:16:02,410
rather than relying on pure IP addresses

453
00:16:00,700 --> 00:16:03,610
<font color="#CCCCCC">and scans and nessus and all the</font>

454
00:16:02,410 --> 00:16:05,290
different types<font color="#E5E5E5"> of telemetry that</font>

455
00:16:03,610 --> 00:16:07,029
penetration testers and red teamers<font color="#CCCCCC"> are</font>

456
00:16:05,290 --> 00:16:08,529
used to the really big downside of this

457
00:16:07,029 --> 00:16:10,600
capability is that<font color="#E5E5E5"> there is</font><font color="#CCCCCC"> no</font>

458
00:16:08,529 --> 00:16:12,010
compression<font color="#CCCCCC"> wah-wah so when you're using</font>

459
00:16:10,600 --> 00:16:14,860
<font color="#CCCCCC">lean MCI and you're dumping these</font><font color="#E5E5E5"> wave</font>

460
00:16:12,010 --> 00:16:15,970
files they are giant and so if you're if

461
00:16:14,860 --> 00:16:18,190
you're working under strict like

462
00:16:15,970 --> 00:16:19,899
operational security concerns it's not

463
00:16:18,190 --> 00:16:21,160
encrypted it's a<font color="#E5E5E5"> WAV file on disk and</font>

464
00:16:19,899 --> 00:16:22,860
they're rather large and<font color="#E5E5E5"> so you're going</font>

465
00:16:21,160 --> 00:16:24,880
to chunk it up and x fill it out

466
00:16:22,860 --> 00:16:26,560
potentially in a little bit stealthier

467
00:16:24,880 --> 00:16:30,579
way than if you were to get good

468
00:16:26,560 --> 00:16:32,349
compression or mp4 some other method for

469
00:16:30,579 --> 00:16:33,370
the<font color="#E5E5E5"> rocket kitten mock-up we had a lot</font>

470
00:16:32,350 --> 00:16:35,079
of fun with<font color="#CCCCCC"> this one I</font><font color="#E5E5E5"> spent a</font><font color="#CCCCCC"> lot of</font>

471
00:16:33,370 --> 00:16:37,990
time playing with<font color="#E5E5E5"> her mpk shell on a dev</font>

472
00:16:35,079 --> 00:16:39,399
system and<font color="#E5E5E5"> I built a logically similar</font>

473
00:16:37,990 --> 00:16:41,230
mock-up<font color="#E5E5E5"> and so I actually got it to the</font>

474
00:16:39,399 --> 00:16:42,670
point where it was exact<font color="#E5E5E5"> API is called</font>

475
00:16:41,230 --> 00:16:45,130
in the exact order that the adversary

476
00:16:42,670 --> 00:16:46,839
toolkit was with the exact flags and

477
00:16:45,130 --> 00:16:48,370
arguments and everything you<font color="#CCCCCC"> know almost</font>

478
00:16:46,839 --> 00:16:50,920
a line for line replication in the

479
00:16:48,370 --> 00:16:52,390
<font color="#CCCCCC">PowerShell of</font><font color="#E5E5E5"> what their toolkit did but</font>

480
00:16:50,920 --> 00:16:54,910
every time I ran it I would get a<font color="#CCCCCC"> pop-up</font>

481
00:16:52,390 --> 00:16:56,410
as the user which<font color="#E5E5E5"> you're not not the</font>

482
00:16:54,910 --> 00:16:59,199
goal of a red team<font color="#CCCCCC"> or by the way is to</font>

483
00:16:56,410 --> 00:17:00,579
get a user<font color="#E5E5E5"> pop-up and so and it would</font>

484
00:16:59,199 --> 00:17:02,319
always<font color="#E5E5E5"> ask me to select the device and</font>

485
00:17:00,579 --> 00:17:04,000
I'm like man maybe this<font color="#CCCCCC"> is why</font>

486
00:17:02,320 --> 00:17:06,970
Microsoft's who preceded this it<font color="#E5E5E5"> turns</font>

487
00:17:04,000 --> 00:17:10,179
out that VFW when you're using like<font color="#E5E5E5"> a</font>

488
00:17:06,970 --> 00:17:11,799
virtual a vm<font color="#E5E5E5"> with a generic driver that</font>

489
00:17:10,179 --> 00:17:15,370
handles all of that different multimedia

490
00:17:11,799 --> 00:17:16,720
including your camera the VFW doesn't

491
00:17:15,369 --> 00:17:18,549
know what device to<font color="#E5E5E5"> use and even when</font>

492
00:17:16,720 --> 00:17:19,720
trying to specify it it doesn't take it

493
00:17:18,549 --> 00:17:22,389
real well so either I'm a really bad

494
00:17:19,720 --> 00:17:24,370
programmer or I just kind of figure it

495
00:17:22,390 --> 00:17:25,660
out and the rocket<font color="#E5E5E5"> kenton actors didn't</font>

496
00:17:24,369 --> 00:17:26,708
figure it<font color="#E5E5E5"> out either because it's after</font>

497
00:17:25,660 --> 00:17:28,419
playing<font color="#E5E5E5"> with their toolkit enough I</font>

498
00:17:26,709 --> 00:17:31,450
realized it did the exact<font color="#E5E5E5"> same thing</font>

499
00:17:28,419 --> 00:17:33,010
cause a giant user<font color="#CCCCCC"> pop-up and so I put</font>

500
00:17:31,450 --> 00:17:34,330
this out on github for release the

501
00:17:33,010 --> 00:17:35,650
github is going to be dropped right

502
00:17:34,330 --> 00:17:37,330
after the talk so you can see these

503
00:17:35,650 --> 00:17:39,100
different samples but I don't<font color="#E5E5E5"> recommend</font>

504
00:17:37,330 --> 00:17:42,820
using this in a<font color="#E5E5E5"> real world engagement</font>

505
00:17:39,100 --> 00:17:44,530
instead use this one so we went with

506
00:17:42,820 --> 00:17:44,980
Microsoft's advice after failing at the

507
00:17:44,530 --> 00:17:47,320
VA

508
00:17:44,980 --> 00:17:48,669
VFW stuff we<font color="#E5E5E5"> went ahead and we found</font>

509
00:17:47,320 --> 00:17:50,710
dotnet assemblies that<font color="#E5E5E5"> already</font>

510
00:17:48,669 --> 00:17:52,570
implemented<font color="#E5E5E5"> directshow and DirectX</font>

511
00:17:50,710 --> 00:17:53,650
capability so all credit goes are those

512
00:17:52,570 --> 00:17:56,620
actors cited here<font color="#E5E5E5"> are different</font>

513
00:17:53,650 --> 00:17:58,720
different licenses but<font color="#E5E5E5"> we embedded those</font>

514
00:17:56,620 --> 00:18:01,239
into our tool which allowed us to gain

515
00:17:58,720 --> 00:18:03,549
<font color="#CCCCCC">that DirectX support straight</font><font color="#E5E5E5"> up in our</font>

516
00:18:01,240 --> 00:18:05,470
tool and so we can use<font color="#E5E5E5"> both compression</font>

517
00:18:03,549 --> 00:18:07,629
and video tuning with proper frame rates

518
00:18:05,470 --> 00:18:10,450
and we can open<font color="#E5E5E5"> up the webcam and audio</font>

519
00:18:07,630 --> 00:18:12,700
for capture in a very stealthy manner

520
00:18:10,450 --> 00:18:14,620
now the light does turn on<font color="#E5E5E5"> so that's a</font>

521
00:18:12,700 --> 00:18:16,750
<font color="#E5E5E5">good indicator compromise if your video</font>

522
00:18:14,620 --> 00:18:18,010
<font color="#E5E5E5">light is turning on randomly but you'd</font>

523
00:18:16,750 --> 00:18:19,600
be surprised<font color="#CCCCCC"> how</font><font color="#E5E5E5"> many places we've used</font>

524
00:18:18,010 --> 00:18:23,260
it with no help desk ticket being

525
00:18:19,600 --> 00:18:25,360
submitted so now the big takeaway for

526
00:18:23,260 --> 00:18:27,520
adversary emulation in this case is the

527
00:18:25,360 --> 00:18:29,620
<font color="#E5E5E5">actors what are they using webcams for</font>

528
00:18:27,520 --> 00:18:31,570
well<font color="#E5E5E5"> they're using</font><font color="#CCCCCC"> it to capture I don't</font>

529
00:18:29,620 --> 00:18:33,159
know maybe who is at<font color="#CCCCCC"> the other end of</font>

530
00:18:31,570 --> 00:18:34,780
that keyboard what are they doing where

531
00:18:33,160 --> 00:18:36,040
do they live is this as it's a

532
00:18:34,780 --> 00:18:39,309
residential purchase this is a

533
00:18:36,040 --> 00:18:41,649
commercial<font color="#E5E5E5"> building for us personally it</font>

534
00:18:39,309 --> 00:18:43,120
works<font color="#E5E5E5"> really well in socks again you</font>

535
00:18:41,650 --> 00:18:45,160
hear me talking<font color="#CCCCCC"> about socks a lot these</font>

536
00:18:43,120 --> 00:18:47,049
capabilities<font color="#E5E5E5"> roku well it's nice that if</font>

537
00:18:45,160 --> 00:18:49,600
you're on a laptop that just happens to

538
00:18:47,049 --> 00:18:51,160
be facing the wall of sin like that's

539
00:18:49,600 --> 00:18:52,899
always displayed in every operation

540
00:18:51,160 --> 00:18:55,120
center up on the wall and you can<font color="#E5E5E5"> get a</font>

541
00:18:52,900 --> 00:18:56,410
nice picture screenshot of all the sims

542
00:18:55,120 --> 00:18:58,030
in the background gives you a<font color="#E5E5E5"> pretty</font>

543
00:18:56,410 --> 00:18:59,350
good preview of all their technology as

544
00:18:58,030 --> 00:19:01,059
well as<font color="#E5E5E5"> any alerts that are at the top</font>

545
00:18:59,350 --> 00:19:03,820
<font color="#E5E5E5">of the list there</font><font color="#CCCCCC"> Giro tickets and and</font>

546
00:19:01,059 --> 00:19:05,830
<font color="#E5E5E5">everything else that's pretty juicy in</font>

547
00:19:03,820 --> 00:19:08,649
this tools this holes been put out on

548
00:19:05,830 --> 00:19:10,030
the on his github for random<font color="#E5E5E5"> PowerShell</font>

549
00:19:08,650 --> 00:19:13,570
scripts and we're going<font color="#E5E5E5"> to show a quick</font>

550
00:19:10,030 --> 00:19:16,799
demo of it so this tool or this tim was

551
00:19:13,570 --> 00:19:16,799
going to run<font color="#E5E5E5"> for you let's see ooh</font>

552
00:19:16,919 --> 00:19:20,280
escape the<font color="#CCCCCC"> mood</font>

553
00:19:28,190 --> 00:19:32,830
two clues there it is

554
00:19:35,610 --> 00:19:39,870
alright so the first function we're

555
00:19:38,160 --> 00:19:41,520
going to<font color="#E5E5E5"> run here the first part of this</font>

556
00:19:39,870 --> 00:19:44,159
is<font color="#CCCCCC"> just kind</font><font color="#E5E5E5"> of showing the ability to</font>

557
00:19:41,520 --> 00:19:45,629
query the end user system so you can<font color="#E5E5E5"> see</font>

558
00:19:44,160 --> 00:19:46,830
here we're able to query and get the

559
00:19:45,630 --> 00:19:48,809
different audio inputs that are

560
00:19:46,830 --> 00:19:50,129
available<font color="#CCCCCC"> on the system we're able</font><font color="#E5E5E5"> to</font>

561
00:19:48,809 --> 00:19:51,389
get the<font color="#CCCCCC"> different compression methods</font>

562
00:19:50,130 --> 00:19:52,770
that are available in the system and<font color="#E5E5E5"> so</font>

563
00:19:51,390 --> 00:19:55,799
<font color="#E5E5E5">this would allow you to be very granular</font>

564
00:19:52,770 --> 00:19:58,980
and<font color="#E5E5E5"> fine-tune exactly what compression</font>

565
00:19:55,799 --> 00:20:00,960
and<font color="#E5E5E5"> tools your your video and audio</font><font color="#CCCCCC"> is</font>

566
00:19:58,980 --> 00:20:02,790
going<font color="#CCCCCC"> to record with so in this case you</font>

567
00:20:00,960 --> 00:20:04,890
<font color="#CCCCCC">can</font><font color="#E5E5E5"> see we have a USB video device and a</font>

568
00:20:02,790 --> 00:20:06,230
microphone attached as well as<font color="#E5E5E5"> different</font>

569
00:20:04,890 --> 00:20:09,960
compression methods that are available

570
00:20:06,230 --> 00:20:11,190
to<font color="#E5E5E5"> the actor</font><font color="#CCCCCC"> and so</font><font color="#E5E5E5"> obviously this is a</font>

571
00:20:09,960 --> 00:20:12,419
proof of concept we're not showing<font color="#E5E5E5"> you</font>

572
00:20:11,190 --> 00:20:14,580
in weaponized manner we're in a power

573
00:20:12,419 --> 00:20:16,230
shell prompt again not probably ideal if

574
00:20:14,580 --> 00:20:18,449
you're red teaming straight up like our

575
00:20:16,230 --> 00:20:21,929
<font color="#E5E5E5">DP din or anything but this is all</font>

576
00:20:18,450 --> 00:20:23,190
usable and friendly to name your ex you

577
00:20:21,929 --> 00:20:25,890
know hacker tool that you like to<font color="#CCCCCC"> use</font>

578
00:20:23,190 --> 00:20:27,360
<font color="#E5E5E5">cobalt</font><font color="#CCCCCC"> StoryCorps metasploit so in this</font>

579
00:20:25,890 --> 00:20:29,580
case we're going to record a webcam

580
00:20:27,360 --> 00:20:31,530
video it's going to be a record time of

581
00:20:29,580 --> 00:20:33,949
<font color="#CCCCCC">four so four seconds</font><font color="#E5E5E5"> with a video</font>

582
00:20:31,530 --> 00:20:35,879
compression and we're going to add a

583
00:20:33,950 --> 00:20:37,770
compression to it as<font color="#CCCCCC"> well to kind of</font>

584
00:20:35,880 --> 00:20:40,710
keep the size as minimal as possible and

585
00:20:37,770 --> 00:20:41,970
<font color="#CCCCCC">then we're going to slap on reverse</font>

586
00:20:40,710 --> 00:20:44,160
because<font color="#CCCCCC"> I like to</font><font color="#E5E5E5"> see output for EM</font>

587
00:20:41,970 --> 00:20:45,330
everything and when it runs it's going

588
00:20:44,160 --> 00:20:46,890
to set all the frame rates that the

589
00:20:45,330 --> 00:20:48,270
capture and<font color="#E5E5E5"> start it so at this point</font>

590
00:20:46,890 --> 00:20:50,250
the light would be on<font color="#CCCCCC"> it's capturing</font>

591
00:20:48,270 --> 00:20:51,720
<font color="#E5E5E5">video from the end user and</font><font color="#CCCCCC"> that returns</font>

592
00:20:50,250 --> 00:20:54,240
the<font color="#E5E5E5"> file object that it's written to out</font>

593
00:20:51,720 --> 00:20:56,820
on disk and so at this point<font color="#E5E5E5"> you could</font>

594
00:20:54,240 --> 00:20:58,740
you could as<font color="#CCCCCC"> the adversary begin to</font>

595
00:20:56,820 --> 00:21:00,389
chunk up and exfil this or if it's<font color="#CCCCCC"> small</font>

596
00:20:58,740 --> 00:21:02,580
enough which in this case it's it's a

597
00:21:00,390 --> 00:21:04,500
fair size we could just exfil it

598
00:21:02,580 --> 00:21:05,879
directly so just to show you improve

599
00:21:04,500 --> 00:21:09,799
we're going to see Chris Ross's pretty

600
00:21:05,880 --> 00:21:09,799
face here in<font color="#CCCCCC"> a second</font>

601
00:21:13,880 --> 00:21:19,560
yay and so you can<font color="#CCCCCC"> see that</font><font color="#E5E5E5"> we were able</font>

602
00:21:17,100 --> 00:21:21,510
<font color="#E5E5E5">to record the webcam in a very similar</font>

603
00:21:19,560 --> 00:21:22,649
technique obviously adapted because in

604
00:21:21,510 --> 00:21:24,990
this<font color="#CCCCCC"> case we decided that</font><font color="#E5E5E5"> the</font>

605
00:21:22,650 --> 00:21:27,090
alternatives were better<font color="#E5E5E5"> than the pure</font>

606
00:21:24,990 --> 00:21:29,640
threat emulation approach that we could

607
00:21:27,090 --> 00:21:40,290
have<font color="#E5E5E5"> taken in the previous and the</font>

608
00:21:29,640 --> 00:21:42,120
previous<font color="#E5E5E5"> examples okay with skype so</font>

609
00:21:40,290 --> 00:21:45,510
earlier this year I think<font color="#E5E5E5"> in February</font>

610
00:21:42,120 --> 00:21:47,850
Palo Alto released a report giving a

611
00:21:45,510 --> 00:21:50,250
detailed account of the t nine thousand

612
00:21:47,850 --> 00:21:51,929
malware sample and they<font color="#E5E5E5"> basically</font>

613
00:21:50,250 --> 00:21:54,840
described one of the capabilities for

614
00:21:51,930 --> 00:21:58,050
that they that<font color="#CCCCCC"> they had to record skype</font>

615
00:21:54,840 --> 00:22:00,419
conversations and also take screenshots

616
00:21:58,050 --> 00:22:01,649
during the skype call that really piqued

617
00:22:00,420 --> 00:22:03,810
my interest<font color="#E5E5E5"> I thought that'd be</font>

618
00:22:01,650 --> 00:22:07,530
something<font color="#E5E5E5"> really cool to implement in</font>

619
00:22:03,810 --> 00:22:09,659
<font color="#CCCCCC">PowerShell and work on as a project so</font>

620
00:22:07,530 --> 00:22:11,700
how did it<font color="#CCCCCC"> go about recording</font>

621
00:22:09,660 --> 00:22:14,930
conversations first it<font color="#E5E5E5"> would start with</font>

622
00:22:11,700 --> 00:22:18,150
sending a used the<font color="#E5E5E5"> windows messaging API</font>

623
00:22:14,930 --> 00:22:20,700
to send a broadcast message called API

624
00:22:18,150 --> 00:22:22,800
discover to all the windows president on

625
00:22:20,700 --> 00:22:24,480
the system<font color="#E5E5E5"> and Scott were to respond to</font>

626
00:22:22,800 --> 00:22:27,510
<font color="#E5E5E5">that and indicate that it was running</font>

627
00:22:24,480 --> 00:22:30,210
you know it's here and then the malware

628
00:22:27,510 --> 00:22:32,940
would send another message saying API

629
00:22:30,210 --> 00:22:35,850
attached requesting access<font color="#E5E5E5"> to the skype</font>

630
00:22:32,940 --> 00:22:37,320
desktop API and this is when the user

631
00:22:35,850 --> 00:22:38,909
will receive the warrant the little

632
00:22:37,320 --> 00:22:41,639
orange box you see up there a prompt

633
00:22:38,910 --> 00:22:43,830
saying that there's a process trying<font color="#E5E5E5"> to</font>

634
00:22:41,640 --> 00:22:46,500
gain access to skype and unfortunately

635
00:22:43,830 --> 00:22:48,480
there's no way around this but users<font color="#E5E5E5"> are</font>

636
00:22:46,500 --> 00:22:49,560
not the brightest people so they're

637
00:22:48,480 --> 00:22:52,560
<font color="#CCCCCC">probably going to click allow access</font>

638
00:22:49,560 --> 00:22:54,389
anyway but once you are allowed access

639
00:22:52,560 --> 00:22:57,000
you'll start to see a flurry of messages

640
00:22:54,390 --> 00:22:58,650
from skype and any conceivable

641
00:22:57,000 --> 00:23:03,540
screenshot skype is pretty<font color="#CCCCCC"> roburt</font>

642
00:22:58,650 --> 00:23:05,280
verbose with its output so mainly while

643
00:23:03,540 --> 00:23:07,530
skype is running the the malware<font color="#E5E5E5"> sample</font>

644
00:23:05,280 --> 00:23:09,990
was looking for a call status ringing

645
00:23:07,530 --> 00:23:11,820
<font color="#E5E5E5">message and once it received that it</font>

646
00:23:09,990 --> 00:23:13,920
would send a message to retrieve the

647
00:23:11,820 --> 00:23:16,409
user handle of the other call

648
00:23:13,920 --> 00:23:18,390
participant and then it would<font color="#E5E5E5"> move on</font>

649
00:23:16,410 --> 00:23:20,820
and wait for a call status in progress

650
00:23:18,390 --> 00:23:22,920
message and it would instruct skype to

651
00:23:20,820 --> 00:23:24,519
redirect the microphone and audio output

652
00:23:22,920 --> 00:23:26,440
to a file on disk

653
00:23:24,519 --> 00:23:29,229
and then it would just<font color="#E5E5E5"> run in a loop</font>

654
00:23:26,440 --> 00:23:30,940
until the call status indicated that was

655
00:23:29,229 --> 00:23:34,749
finished I'm and then it would just

656
00:23:30,940 --> 00:23:37,899
record the call log so that brought

657
00:23:34,749 --> 00:23:40,330
about<font color="#E5E5E5"> the skype recorder tool that we</font>

658
00:23:37,899 --> 00:23:43,268
developed this was<font color="#E5E5E5"> definitely something</font>

659
00:23:40,330 --> 00:23:44,708
interesting for me to<font color="#E5E5E5"> work on is a</font>

660
00:23:43,269 --> 00:23:47,279
little challenging<font color="#CCCCCC"> because this is my</font>

661
00:23:44,709 --> 00:23:50,859
<font color="#CCCCCC">first time developing using.net</font>

662
00:23:47,279 --> 00:23:52,659
reflection in<font color="#E5E5E5"> PowerShell and the entire</font>

663
00:23:50,859 --> 00:23:55,029
purpose of this is strictly just

664
00:23:52,659 --> 00:23:57,219
intelligence collection like if we're

665
00:23:55,029 --> 00:23:59,440
able to hook some of these skype calls

666
00:23:57,219 --> 00:24:01,119
and listening on a conference or meeting

667
00:23:59,440 --> 00:24:04,509
minutes maybe we learn some<font color="#E5E5E5"> more</font>

668
00:24:01,119 --> 00:24:07,918
information<font color="#E5E5E5"> about our environment so</font>

669
00:24:04,509 --> 00:24:07,919
<font color="#CCCCCC">I'll move on to a quick demo</font>

670
00:24:15,450 --> 00:24:19,230
so we see here we import the skype

671
00:24:17,460 --> 00:24:21,480
recorder module and then we're going<font color="#E5E5E5"> to</font>

672
00:24:19,230 --> 00:24:23,639
start recording with a<font color="#E5E5E5"> duration of</font><font color="#CCCCCC"> 1</font>

673
00:24:21,480 --> 00:24:26,820
minute and you'll see it creates a

674
00:24:23,639 --> 00:24:27,899
window has a window handle and during

675
00:24:26,820 --> 00:24:30,178
that time it will go ahead and<font color="#E5E5E5"> send</font>

676
00:24:27,899 --> 00:24:31,320
messages to connect to skype and we're

677
00:24:30,179 --> 00:24:33,830
going to<font color="#E5E5E5"> go ahead</font><font color="#CCCCCC"> and start a call with</font>

678
00:24:31,320 --> 00:24:36,750
our buddy echo the<font color="#E5E5E5"> Skype test service</font>

679
00:24:33,830 --> 00:24:39,269
<font color="#E5E5E5">and then once we receive a call status</font>

680
00:24:36,750 --> 00:24:40,830
ringing and then call status in progress

681
00:24:39,269 --> 00:24:43,230
the it's going to go ahead<font color="#CCCCCC"> and try</font><font color="#E5E5E5"> to</font>

682
00:24:40,830 --> 00:24:45,418
redirect output to a file and you'll see

683
00:24:43,230 --> 00:24:47,100
there that on skype echoes back and

684
00:24:45,419 --> 00:24:49,740
tells you that<font color="#CCCCCC"> the output has been set</font>

685
00:24:47,100 --> 00:24:51,539
to the file that you<font color="#CCCCCC"> specified and then</font>

686
00:24:49,740 --> 00:24:53,970
while the call is in progress it will

687
00:24:51,539 --> 00:24:55,980
give you the entire the message<font color="#E5E5E5"> about</font>

688
00:24:53,970 --> 00:24:57,690
the duration<font color="#CCCCCC"> of the call and then</font><font color="#E5E5E5"> once</font>

689
00:24:55,980 --> 00:24:59,730
the call is finished it will wait<font color="#CCCCCC"> until</font>

690
00:24:57,690 --> 00:25:02,340
the timeout loop is reached to output

691
00:24:59,730 --> 00:25:04,049
the location of the<font color="#E5E5E5"> files and there's</font>

692
00:25:02,340 --> 00:25:06,779
also some logic built into the tool

693
00:25:04,049 --> 00:25:08,460
where if you set the timeout loop to say

694
00:25:06,779 --> 00:25:10,830
one minute in the call last 45 minutes

695
00:25:08,460 --> 00:25:13,279
it'll keep on recording until the call

696
00:25:10,830 --> 00:25:13,279
is finished

697
00:25:25,020 --> 00:25:28,650
so this<font color="#CCCCCC"> is really really</font><font color="#E5E5E5"> useful i've</font>

698
00:25:27,000 --> 00:25:31,080
seen this really useful and engagements

699
00:25:28,650 --> 00:25:32,880
and commercial entities that<font color="#E5E5E5"> they use</font>

700
00:25:31,080 --> 00:25:34,470
skype for their commercial entities that

701
00:25:32,880 --> 00:25:36,090
<font color="#CCCCCC">there there are numerous of them to</font>

702
00:25:34,470 --> 00:25:37,740
actually<font color="#CCCCCC"> use skype for conference calls</font>

703
00:25:36,090 --> 00:25:40,800
as well as enter like interwork

704
00:25:37,740 --> 00:25:42,570
messaging so you know in<font color="#E5E5E5"> that specific</font>

705
00:25:40,800 --> 00:25:43,919
case we walked in we weren't weaponized

706
00:25:42,570 --> 00:25:46,230
we're ready for anything with skype

707
00:25:43,920 --> 00:25:47,910
there's not too many tools that do this

708
00:25:46,230 --> 00:25:49,710
in the<font color="#E5E5E5"> red team space and so again</font>

709
00:25:47,910 --> 00:25:51,330
drawing inspiration from the bad guys in

710
00:25:49,710 --> 00:25:53,730
order to kind<font color="#E5E5E5"> of solve a challenge or</font>

711
00:25:51,330 --> 00:25:55,980
overcome an obstacle as well as in this

712
00:25:53,730 --> 00:25:59,480
case being able to directly quote or

713
00:25:55,980 --> 00:26:02,400
cite the apt that<font color="#E5E5E5"> were they were working</font>

714
00:25:59,480 --> 00:26:04,740
so<font color="#E5E5E5"> almost every red team engagement I've</font>

715
00:26:02,400 --> 00:26:06,840
been<font color="#E5E5E5"> in and especially on the</font><font color="#CCCCCC"> first one</font>

716
00:26:04,740 --> 00:26:08,370
<font color="#E5E5E5">I was working with will shredder another</font>

717
00:26:06,840 --> 00:26:09,659
the right<font color="#E5E5E5"> team or a company and I walk</font>

718
00:26:08,370 --> 00:26:11,489
in and there's a couple<font color="#CCCCCC"> of things</font><font color="#E5E5E5"> he</font>

719
00:26:09,660 --> 00:26:13,170
<font color="#E5E5E5">tells me to do our very first red team</font>

720
00:26:11,490 --> 00:26:14,700
he tells me<font color="#E5E5E5"> to do it by hand which</font><font color="#CCCCCC"> is</font>

721
00:26:13,170 --> 00:26:16,380
like I hate<font color="#E5E5E5"> doing things by hand like</font>

722
00:26:14,700 --> 00:26:18,540
hackers are all about hacking and

723
00:26:16,380 --> 00:26:20,310
automation so the first thing he tells

724
00:26:18,540 --> 00:26:21,510
me to<font color="#CCCCCC"> do by hand or map all the domain</font>

725
00:26:20,310 --> 00:26:23,970
trust in<font color="#E5E5E5"> this environment and there's</font>

726
00:26:21,510 --> 00:26:25,980
like 150 domain trust all in the CSV and

727
00:26:23,970 --> 00:26:27,420
he's like exploit this like fine Emily

728
00:26:25,980 --> 00:26:28,680
well I'm not going<font color="#E5E5E5"> to do that i'm going</font>

729
00:26:27,420 --> 00:26:30,210
<font color="#CCCCCC">to write something automate that the</font>

730
00:26:28,680 --> 00:26:33,810
next thing we<font color="#CCCCCC"> have to do</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> just some</font>

731
00:26:30,210 --> 00:26:35,010
sit in mine file<font color="#E5E5E5"> chairs endlessly every</font>

732
00:26:33,810 --> 00:26:36,990
red team<font color="#CCCCCC"> irnos that</font><font color="#E5E5E5"> feeling of just</font>

733
00:26:35,010 --> 00:26:38,850
looking<font color="#CCCCCC"> through dozens if not hundreds</font>

734
00:26:36,990 --> 00:26:40,470
of file<font color="#E5E5E5"> sharers an environment trying to</font>

735
00:26:38,850 --> 00:26:42,510
find that one file that's either going

736
00:26:40,470 --> 00:26:43,770
<font color="#E5E5E5">to give you your escalation path or it's</font>

737
00:26:42,510 --> 00:26:45,000
going to<font color="#E5E5E5"> be the crown jewels just</font>

738
00:26:43,770 --> 00:26:46,950
<font color="#E5E5E5">sitting unprotected in a file share</font>

739
00:26:45,000 --> 00:26:48,090
<font color="#E5E5E5">ready for you ready for the stealing</font>

740
00:26:46,950 --> 00:26:51,030
ready for you to highlight for that

741
00:26:48,090 --> 00:26:52,679
customer so in this case I was like why

742
00:26:51,030 --> 00:26:53,910
do we have to sit and<font color="#E5E5E5"> look at file</font>

743
00:26:52,680 --> 00:26:57,750
shares and why do I have<font color="#E5E5E5"> to do this</font>

744
00:26:53,910 --> 00:26:59,730
<font color="#E5E5E5">every</font><font color="#CCCCCC"> day to detect changes there has to</font>

745
00:26:57,750 --> 00:27:02,670
be a better<font color="#CCCCCC"> way to do this</font><font color="#E5E5E5"> and so for</font>

746
00:26:59,730 --> 00:27:05,460
this specific case I apt 30 or<font color="#E5E5E5"> Nikon</font>

747
00:27:02,670 --> 00:27:06,930
they're really solid actor lots of

748
00:27:05,460 --> 00:27:08,010
reporting and documentation on them

749
00:27:06,930 --> 00:27:10,170
which makes<font color="#E5E5E5"> them a really good case</font>

750
00:27:08,010 --> 00:27:11,640
<font color="#CCCCCC">study for thread emulation they have a</font>

751
00:27:10,170 --> 00:27:14,310
piece of our called the<font color="#E5E5E5"> flash flood</font>

752
00:27:11,640 --> 00:27:16,470
malware which is essentially their host

753
00:27:14,310 --> 00:27:18,300
profile or their ability to survey an

754
00:27:16,470 --> 00:27:20,460
in-system and packaged up a whole bunch

755
00:27:18,300 --> 00:27:22,500
of preliminary data for exfiltration

756
00:27:20,460 --> 00:27:24,660
from the<font color="#CCCCCC"> environment and so essentially</font>

757
00:27:22,500 --> 00:27:26,130
how it works is it<font color="#E5E5E5"> uses timestamps to</font>

758
00:27:24,660 --> 00:27:27,510
measure changes in an environment and

759
00:27:26,130 --> 00:27:29,730
anything that changes in certain

760
00:27:27,510 --> 00:27:32,870
<font color="#E5E5E5">monitored directories automatically get</font>

761
00:27:29,730 --> 00:27:35,700
exfilled out to this extra<font color="#CCCCCC"> lector E and</font>

762
00:27:32,870 --> 00:27:37,409
encrypted<font color="#E5E5E5"> AK off you skated using some</font>

763
00:27:35,700 --> 00:27:37,990
custom routine that's<font color="#E5E5E5"> really really bad</font>

764
00:27:37,410 --> 00:27:40,270
and easy to

765
00:27:37,990 --> 00:27:41,920
fix the things that it specifically

766
00:27:40,270 --> 00:27:44,530
gathers is the windows address books

767
00:27:41,920 --> 00:27:46,270
certain<font color="#CCCCCC"> lnk files anything from</font>

768
00:27:44,530 --> 00:27:48,010
removable media any friend thing from

769
00:27:46,270 --> 00:27:50,170
the desktop<font color="#E5E5E5"> Tim temporary</font><font color="#CCCCCC"> internet it's</font>

770
00:27:48,010 --> 00:27:51,370
all the normal stuff that pen testers

771
00:27:50,170 --> 00:27:52,750
and red teamers and adversaries are

772
00:27:51,370 --> 00:27:54,909
looking at every time they get on a box

773
00:27:52,750 --> 00:27:57,400
to try to look for interesting<font color="#CCCCCC"> things</font>

774
00:27:54,910 --> 00:27:59,410
and so when you dive down specifically

775
00:27:57,400 --> 00:28:01,240
to the monitoring and exfil component

776
00:27:59,410 --> 00:28:02,740
how it works they use an API<font color="#E5E5E5"> called</font>

777
00:28:01,240 --> 00:28:04,240
called<font color="#CCCCCC"> find first</font><font color="#E5E5E5"> file a which</font>

778
00:28:02,740 --> 00:28:05,830
essentially gives you a pointer to a

779
00:28:04,240 --> 00:28:07,630
linked list<font color="#E5E5E5"> of all the files in a</font>

780
00:28:05,830 --> 00:28:10,270
certain directory and<font color="#CCCCCC"> then they iterate</font>

781
00:28:07,630 --> 00:28:12,010
over every file and every file they get

782
00:28:10,270 --> 00:28:15,160
to they compare a file time to see if

783
00:28:12,010 --> 00:28:17,170
<font color="#CCCCCC">that file time is newer than the last</font>

784
00:28:15,160 --> 00:28:19,870
time<font color="#CCCCCC"> that their tool ran which is stored</font>

785
00:28:17,170 --> 00:28:23,170
<font color="#E5E5E5">in some text file on the back end if it</font>

786
00:28:19,870 --> 00:28:25,120
is it'll automatically archived it so

787
00:28:23,170 --> 00:28:28,270
it'll right up wrap it up in its custom

788
00:28:25,120 --> 00:28:29,739
in compression routine or custom off you

789
00:28:28,270 --> 00:28:32,139
skating routine and<font color="#E5E5E5"> ex roll it out</font><font color="#CCCCCC"> to</font>

790
00:28:29,740 --> 00:28:33,700
this<font color="#E5E5E5"> windows / files directory or recent</font>

791
00:28:32,140 --> 00:28:35,679
files directory depending on what it is

792
00:28:33,700 --> 00:28:37,750
and then what and then it will it

793
00:28:35,679 --> 00:28:39,910
continue iterating over then the actor

794
00:28:37,750 --> 00:28:42,820
will return take everything in this

795
00:28:39,910 --> 00:28:44,620
office cated directory swipe it up take

796
00:28:42,820 --> 00:28:46,600
<font color="#E5E5E5">it out and remove it</font><font color="#CCCCCC"> now the benefit</font>

797
00:28:44,620 --> 00:28:47,620
here is is most pen testers and red

798
00:28:46,600 --> 00:28:50,379
teamers when they're on<font color="#E5E5E5"> an engagement</font>

799
00:28:47,620 --> 00:28:51,820
including us like you just maintain

800
00:28:50,380 --> 00:28:53,110
access to whatever systems you'd ask<font color="#CCCCCC"> the</font>

801
00:28:51,820 --> 00:28:54,189
<font color="#E5E5E5">soon use keep them calling home right</font>

802
00:28:53,110 --> 00:28:55,689
like if you get if you<font color="#CCCCCC"> got on a new</font>

803
00:28:54,190 --> 00:28:57,340
system you<font color="#E5E5E5"> don't kill your agents every</font>

804
00:28:55,690 --> 00:28:58,990
hour and you don't only do like 30

805
00:28:57,340 --> 00:29:00,459
<font color="#E5E5E5">minutes of ops and clean off and</font><font color="#CCCCCC"> leave</font>

806
00:28:58,990 --> 00:29:02,020
it<font color="#E5E5E5"> but when you're operating with</font>

807
00:29:00,460 --> 00:29:03,460
operational security concerns so in some

808
00:29:02,020 --> 00:29:05,830
of our tightest<font color="#E5E5E5"> read times we have to be</font>

809
00:29:03,460 --> 00:29:07,330
very careful<font color="#E5E5E5"> about where we leave agents</font>

810
00:29:05,830 --> 00:29:09,580
and how long we're on the system and<font color="#E5E5E5"> we</font>

811
00:29:07,330 --> 00:29:11,230
have to be very selective and where we

812
00:29:09,580 --> 00:29:13,120
move throughout the network so in this

813
00:29:11,230 --> 00:29:15,490
case<font color="#E5E5E5"> running a tool like this leaving it</font>

814
00:29:13,120 --> 00:29:18,309
behind and then coming<font color="#CCCCCC"> back to</font><font color="#E5E5E5"> get your</font>

815
00:29:15,490 --> 00:29:19,780
exfil later is a much better solution

816
00:29:18,309 --> 00:29:21,700
that allows you to<font color="#E5E5E5"> maintain a more</font>

817
00:29:19,780 --> 00:29:23,740
covert pressing presence in the

818
00:29:21,700 --> 00:29:26,020
environment<font color="#E5E5E5"> so when looking at different</font>

819
00:29:23,740 --> 00:29:27,550
alternate techniques I like all the

820
00:29:26,020 --> 00:29:28,720
asynchronous options<font color="#E5E5E5"> because like</font>

821
00:29:27,550 --> 00:29:30,730
sitting there<font color="#E5E5E5"> and just constantly</font>

822
00:29:28,720 --> 00:29:32,200
<font color="#E5E5E5">iterating over and some time to manner</font>

823
00:29:30,730 --> 00:29:33,670
seems kind of silly for me<font color="#E5E5E5"> like there's</font>

824
00:29:32,200 --> 00:29:37,030
this holy venting thing built into

825
00:29:33,670 --> 00:29:39,100
windows just is made for this but so

826
00:29:37,030 --> 00:29:41,559
there's the win32<font color="#CCCCCC"> API</font><font color="#E5E5E5"> which exposes the</font>

827
00:29:39,100 --> 00:29:43,090
fine first change notification API call

828
00:29:41,559 --> 00:29:44,830
that allows you<font color="#E5E5E5"> to set</font><font color="#CCCCCC"> up asynchronous</font>

829
00:29:43,090 --> 00:29:47,320
events to watch for stuff like this or

830
00:29:44,830 --> 00:29:49,510
in.net since we're cheating or using

831
00:29:47,320 --> 00:29:51,520
<font color="#CCCCCC">powershell and.net there's the system</font>

832
00:29:49,510 --> 00:29:52,660
diode a file watcher class or

833
00:29:51,520 --> 00:29:55,000
all system watcher class which will

834
00:29:52,660 --> 00:29:56,710
essentially monitor and fire some

835
00:29:55,000 --> 00:29:58,270
callback function every time there's a

836
00:29:56,710 --> 00:30:01,900
change<font color="#E5E5E5"> in the file</font><font color="#CCCCCC"> system in a specific</font>

837
00:29:58,270 --> 00:30:03,790
location there's also<font color="#E5E5E5"> wmi events and</font>

838
00:30:01,900 --> 00:30:05,440
then as far as<font color="#CCCCCC"> acceleration or</font>

839
00:30:03,790 --> 00:30:07,180
compression there's all sorts of options

840
00:30:05,440 --> 00:30:09,220
we specifically mentioned the script

841
00:30:07,180 --> 00:30:11,140
here i'll tak encrypted store it's a

842
00:30:09,220 --> 00:30:14,080
really really good option<font color="#CCCCCC"> for saving off</font>

843
00:30:11,140 --> 00:30:15,760
and encrypting or exfiltrating data it

844
00:30:14,080 --> 00:30:18,460
<font color="#E5E5E5">basically takes everything going into it</font>

845
00:30:15,760 --> 00:30:20,710
encrypts it using AES or RSA and stores

846
00:30:18,460 --> 00:30:23,650
it kind of like a virtual file system so

847
00:30:20,710 --> 00:30:25,720
it's kind of like a VFS on a system so

848
00:30:23,650 --> 00:30:28,570
the in tool that we came<font color="#E5E5E5"> up with really</font>

849
00:30:25,720 --> 00:30:30,280
good for file shares we<font color="#CCCCCC"> we</font><font color="#E5E5E5"> utilize the</font>

850
00:30:28,570 --> 00:30:32,230
previously written sit starts file

851
00:30:30,280 --> 00:30:34,510
system monitor tool with some slight

852
00:30:32,230 --> 00:30:36,010
tweaks in this case that<font color="#E5E5E5"> we were using</font>

853
00:30:34,510 --> 00:30:37,840
<font color="#E5E5E5">this tool on an engagement we were</font>

854
00:30:36,010 --> 00:30:40,420
specifically asked to emulate a threat

855
00:30:37,840 --> 00:30:43,060
so<font color="#CCCCCC"> they</font><font color="#E5E5E5"> wanted us to to try to model</font>

856
00:30:40,420 --> 00:30:45,700
this specific<font color="#E5E5E5"> our Terry so</font><font color="#CCCCCC"> apt</font><font color="#E5E5E5"> 30 and so</font>

857
00:30:43,060 --> 00:30:46,960
in this case we we created a tool set

858
00:30:45,700 --> 00:30:49,150
and we<font color="#E5E5E5"> created an encryption routine</font>

859
00:30:46,960 --> 00:30:51,820
called right dash flash flood file which

860
00:30:49,150 --> 00:30:53,590
it<font color="#E5E5E5"> takes in any file off the pipeline or</font>

861
00:30:51,820 --> 00:30:56,260
any byte string off the pipeline and

862
00:30:53,590 --> 00:30:58,480
outputs it to the proper location<font color="#CCCCCC"> with</font>

863
00:30:56,260 --> 00:31:01,300
<font color="#CCCCCC">the proper iocs with the exact crypto</font>

864
00:30:58,480 --> 00:31:03,460
routine the apt 30 is using so there's

865
00:31:01,300 --> 00:31:05,139
obviously<font color="#CCCCCC"> numerous cases or use cases</font>

866
00:31:03,460 --> 00:31:06,460
for this there's<font color="#CCCCCC"> adversary emulation</font>

867
00:31:05,140 --> 00:31:08,320
there's I<font color="#E5E5E5"> don't know maybe</font>

868
00:31:06,460 --> 00:31:09,760
misattribution or malware<font color="#CCCCCC"> myth</font>

869
00:31:08,320 --> 00:31:12,129
distribution maybe if you're trying<font color="#E5E5E5"> to</font>

870
00:31:09,760 --> 00:31:13,870
blame somebody else for<font color="#E5E5E5"> your work if you</font>

871
00:31:12,130 --> 00:31:15,250
encrypt all your stuff exactly<font color="#E5E5E5"> like them</font>

872
00:31:13,870 --> 00:31:17,139
<font color="#E5E5E5">and put it in the same places then</font>

873
00:31:15,250 --> 00:31:19,510
oftentimes analysts will jump<font color="#E5E5E5"> to</font>

874
00:31:17,140 --> 00:31:23,290
conclusions that's a pretty good a good

875
00:31:19,510 --> 00:31:25,680
<font color="#E5E5E5">use for this as well as</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> up you know</font>

876
00:31:23,290 --> 00:31:28,690
obfuscating things on disk again this is

877
00:31:25,680 --> 00:31:31,270
their routine is like a very simple like

878
00:31:28,690 --> 00:31:33,430
add shift little<font color="#CCCCCC"> kung flute confused so</font>

879
00:31:31,270 --> 00:31:35,470
<font color="#E5E5E5">I don't I don't recommend actually using</font>

880
00:31:33,430 --> 00:31:36,730
this on an engagement unless authorized

881
00:31:35,470 --> 00:31:38,890
by your customer it's much better to

882
00:31:36,730 --> 00:31:40,270
dump things<font color="#E5E5E5"> that</font><font color="#CCCCCC"> disk encrypted AES RSA</font>

883
00:31:38,890 --> 00:31:43,260
so it's<font color="#E5E5E5"> not going to be picked up</font>

884
00:31:40,270 --> 00:31:45,700
especially if it's anything sensitive

885
00:31:43,260 --> 00:31:48,280
but<font color="#E5E5E5"> again makes a good use case or demo</font>

886
00:31:45,700 --> 00:31:49,900
in<font color="#CCCCCC"> the case that you're</font><font color="#E5E5E5"> trying to show</font>

887
00:31:48,280 --> 00:31:51,070
the effects of a bad guy in the

888
00:31:49,900 --> 00:31:55,780
environment so let's see if we can find

889
00:31:51,070 --> 00:31:57,520
<font color="#E5E5E5">it here so we're going to load up our</font>

890
00:31:55,780 --> 00:31:59,139
tool to start file system monitor<font color="#E5E5E5"> this</font>

891
00:31:57,520 --> 00:32:01,120
has been tweet from<font color="#CCCCCC"> the version that's</font>

892
00:31:59,140 --> 00:32:03,370
on guests you be specific for our thread

893
00:32:01,120 --> 00:32:04,719
emulation scenario here<font color="#E5E5E5"> and then we're</font>

894
00:32:03,370 --> 00:32:05,409
going to start monitoring this really

895
00:32:04,720 --> 00:32:07,120
secretive

896
00:32:05,410 --> 00:32:09,400
recalled I hey I hide things on my

897
00:32:07,120 --> 00:32:10,689
desktop because<font color="#E5E5E5"> by the way all the</font>

898
00:32:09,400 --> 00:32:12,850
directories we see in real engagements

899
00:32:10,690 --> 00:32:14,770
are about that<font color="#E5E5E5"> obvious now you notice</font>

900
00:32:12,850 --> 00:32:16,209
there's nothing in here<font color="#E5E5E5"> yet so the users</font>

901
00:32:14,770 --> 00:32:17,470
just set this up and but they have a

902
00:32:16,210 --> 00:32:19,300
text file that they've written a note

903
00:32:17,470 --> 00:32:21,130
pad with all their<font color="#E5E5E5"> super-secret data</font>

904
00:32:19,300 --> 00:32:22,600
banking passwords and passwords of

905
00:32:21,130 --> 00:32:25,090
Pandora and everything else that they

906
00:32:22,600 --> 00:32:26,439
always<font color="#E5E5E5"> store in the desktop so we're</font>

907
00:32:25,090 --> 00:32:28,360
going<font color="#E5E5E5"> to start</font><font color="#CCCCCC"> our monitoring script and</font>

908
00:32:26,440 --> 00:32:29,950
the user is<font color="#CCCCCC"> going to be really lame and</font>

909
00:32:28,360 --> 00:32:32,199
<font color="#CCCCCC">drop their password text file and you'll</font>

910
00:32:29,950 --> 00:32:34,300
<font color="#E5E5E5">notice that instantly they synchronous</font>

911
00:32:32,200 --> 00:32:36,900
event fires which notice is that what's

912
00:32:34,300 --> 00:32:39,639
been created and it<font color="#E5E5E5"> exel traits it</font>

913
00:32:36,900 --> 00:32:42,040
obvious cated out to the exact directory

914
00:32:39,640 --> 00:32:43,660
that that apt 30 did so if you come to

915
00:32:42,040 --> 00:32:46,480
<font color="#E5E5E5">that directory you'll notice the files</font>

916
00:32:43,660 --> 00:32:48,100
there we're going<font color="#E5E5E5"> to open it up and show</font>

917
00:32:46,480 --> 00:32:49,600
<font color="#CCCCCC">that it's</font><font color="#E5E5E5"> not exactly plaintext it's a</font>

918
00:32:48,100 --> 00:32:52,330
nice random byte string that doesn't

919
00:32:49,600 --> 00:32:54,010
make any<font color="#E5E5E5"> sense then as the bad guy or</font>

920
00:32:52,330 --> 00:32:56,199
the red team or whoever we are we<font color="#E5E5E5"> would</font>

921
00:32:54,010 --> 00:32:57,700
come<font color="#CCCCCC"> back and</font><font color="#E5E5E5"> pick up this file actual</font>

922
00:32:56,200 --> 00:32:59,590
trade it which would<font color="#E5E5E5"> be all their</font>

923
00:32:57,700 --> 00:33:00,940
sensitive passwords and then we can read

924
00:32:59,590 --> 00:33:03,550
it because we're<font color="#CCCCCC"> the ones who wrote the</font>

925
00:33:00,940 --> 00:33:05,890
encryption routine and so we can output

926
00:33:03,550 --> 00:33:08,830
all of their secretive data that we

927
00:33:05,890 --> 00:33:11,080
swiped off without<font color="#E5E5E5"> them noticing so real</font>

928
00:33:08,830 --> 00:33:12,730
time this would get everything that they

929
00:33:11,080 --> 00:33:14,770
add even if they delete it so if they

930
00:33:12,730 --> 00:33:16,090
instantly add it like a tent file or oh

931
00:33:14,770 --> 00:33:17,860
man<font color="#E5E5E5"> I need to</font><font color="#CCCCCC"> just write this password</font>

932
00:33:16,090 --> 00:33:19,389
down real quick and<font color="#E5E5E5"> they delete it</font>

933
00:33:17,860 --> 00:33:20,740
because they're really secure against

934
00:33:19,390 --> 00:33:23,230
bad guys and they're aware of what

935
00:33:20,740 --> 00:33:25,390
they're doing this would swipe it it's a

936
00:33:23,230 --> 00:33:27,130
race condition so depends on if you can

937
00:33:25,390 --> 00:33:29,560
beat the milliseconds of asynchronous

938
00:33:27,130 --> 00:33:31,480
eventing but<font color="#CCCCCC"> I'd like</font><font color="#E5E5E5"> to bet on</font>

939
00:33:29,560 --> 00:33:35,220
Microsoft on that one a couple<font color="#CCCCCC"> times out</font>

940
00:33:31,480 --> 00:33:35,220
of<font color="#CCCCCC"> 10 alright</font>

941
00:33:41,970 --> 00:33:46,280
so for packet capture<font color="#E5E5E5"> I think that's one</font>

942
00:33:44,580 --> 00:33:48,720
of<font color="#E5E5E5"> the most useful post exploitation</font>

943
00:33:46,280 --> 00:33:52,889
capabilities that you can have when

944
00:33:48,720 --> 00:33:56,220
operating in an environment there are a

945
00:33:52,890 --> 00:33:58,640
lot of<font color="#E5E5E5"> different attacks that use packet</font>

946
00:33:56,220 --> 00:34:01,590
capture as a base to<font color="#CCCCCC"> conduct the attack</font>

947
00:33:58,640 --> 00:34:04,320
for one wsus<font color="#E5E5E5"> man in the middle</font><font color="#CCCCCC"> I think</font>

948
00:34:01,590 --> 00:34:05,939
that's<font color="#E5E5E5"> a really</font><font color="#CCCCCC"> cool technique just</font>

949
00:34:04,320 --> 00:34:08,250
being able<font color="#E5E5E5"> to inject the payload into a</font>

950
00:34:05,940 --> 00:34:12,179
wsus update and have it pushed to a

951
00:34:08,250 --> 00:34:14,100
remote host it's pretty amazing and also

952
00:34:12,179 --> 00:34:16,020
<font color="#E5E5E5">there</font><font color="#CCCCCC"> are several apt groups that make</font>

953
00:34:14,100 --> 00:34:18,330
use of packet capture for different

954
00:34:16,020 --> 00:34:21,389
techniques they implement for one Dooku

955
00:34:18,330 --> 00:34:23,819
love to drop the wimpy<font color="#E5E5E5"> cap driver on and</font>

956
00:34:21,389 --> 00:34:32,129
do a hot install and use a virtual file

957
00:34:23,820 --> 00:34:36,000
system to inject mdns replies so how

958
00:34:32,130 --> 00:34:37,650
winpcap works usually it's a pretty

959
00:34:36,000 --> 00:34:39,750
dirty installation you'll have to drop

960
00:34:37,650 --> 00:34:42,540
all the required<font color="#CCCCCC"> dll's and also the</font>

961
00:34:39,750 --> 00:34:45,780
required driver and use<font color="#E5E5E5"> SE to create a</font>

962
00:34:42,540 --> 00:34:47,639
service and start that service for<font color="#E5E5E5"> wimpy</font>

963
00:34:45,780 --> 00:34:50,340
<font color="#CCCCCC">cap and then then you'll be</font><font color="#E5E5E5"> able to</font>

964
00:34:47,639 --> 00:34:53,779
utilize all the wimpy cab functions to

965
00:34:50,340 --> 00:34:56,880
capture traffic to your heart's desire

966
00:34:53,780 --> 00:34:59,910
so what other research is out there for

967
00:34:56,880 --> 00:35:02,370
<font color="#E5E5E5">one</font><font color="#CCCCCC"> invoking vay it's a tool written by</font>

968
00:34:59,910 --> 00:35:06,029
<font color="#E5E5E5">Kevin Ron Robinson it's a great tool for</font>

969
00:35:02,370 --> 00:35:09,810
a spoofing attacks specifically w pad

970
00:35:06,030 --> 00:35:14,730
spoofing attacks uses raw sockets<font color="#CCCCCC"> to</font>

971
00:35:09,810 --> 00:35:17,670
capture traffic in respond to SMB or DNS

972
00:35:14,730 --> 00:35:20,220
or<font color="#CCCCCC"> netbios requests and then also</font>

973
00:35:17,670 --> 00:35:23,790
there's some work done by alex from deco

974
00:35:20,220 --> 00:35:26,609
or<font color="#E5E5E5"> kill switch GUI he wrote a peer</font>

975
00:35:23,790 --> 00:35:29,070
packet capture in<font color="#E5E5E5"> c++ inside of a</font>

976
00:35:26,610 --> 00:35:31,080
reflective DLL so it's pretty pretty

977
00:35:29,070 --> 00:35:33,270
great work another thing<font color="#CCCCCC"> I've</font><font color="#E5E5E5"> seen a lot</font>

978
00:35:31,080 --> 00:35:34,830
<font color="#CCCCCC">of is when reversing all these different</font>

979
00:35:33,270 --> 00:35:36,060
samples of examples of this one of the

980
00:35:34,830 --> 00:35:38,400
favorite techniques that I saw

981
00:35:36,060 --> 00:35:40,320
implemented by different actors and

982
00:35:38,400 --> 00:35:41,640
different reports was when the windows

983
00:35:40,320 --> 00:35:43,740
filtering platform drivers which is

984
00:35:41,640 --> 00:35:45,629
essentially a driver that's supposed to

985
00:35:43,740 --> 00:35:47,549
be a middle abstraction layer that you

986
00:35:45,630 --> 00:35:49,590
can install<font color="#E5E5E5"> does require code signing</font>

987
00:35:47,550 --> 00:35:52,320
but we've all seen<font color="#CCCCCC"> that code signing</font>

988
00:35:49,590 --> 00:35:53,640
certificates get stolen and so if these

989
00:35:52,320 --> 00:35:55,140
actors are able to get their hands on

990
00:35:53,640 --> 00:35:55,799
one they can sign their<font color="#CCCCCC"> own a driver</font>

991
00:35:55,140 --> 00:35:57,839
<font color="#CCCCCC">that</font>

992
00:35:55,800 --> 00:35:59,250
that is built to basically intercept

993
00:35:57,840 --> 00:36:01,620
network of paths network packet capture

994
00:35:59,250 --> 00:36:03,240
the other one is<font color="#CCCCCC"> etw a little-known</font>

995
00:36:01,620 --> 00:36:05,339
feature inside of<font color="#E5E5E5"> Windows it's built for</font>

996
00:36:03,240 --> 00:36:07,979
event tracing it's<font color="#E5E5E5"> meant for debugging</font>

997
00:36:05,340 --> 00:36:10,080
and administration but it exposes a huge

998
00:36:07,980 --> 00:36:12,330
amount<font color="#E5E5E5"> of functionality to access</font>

999
00:36:10,080 --> 00:36:14,700
back-end data on a system including

1000
00:36:12,330 --> 00:36:17,100
<font color="#CCCCCC">Network traces so you can</font><font color="#E5E5E5"> actually to</font>

1001
00:36:14,700 --> 00:36:19,439
some degree record and store off network

1002
00:36:17,100 --> 00:36:24,360
traces all using a native built in tool

1003
00:36:19,440 --> 00:36:27,060
in the environment so that's what

1004
00:36:24,360 --> 00:36:30,420
brought<font color="#E5E5E5"> about get wind pick pcap capture</font>

1005
00:36:27,060 --> 00:36:33,590
the PowerShell tool use utilizes some

1006
00:36:30,420 --> 00:36:36,630
dotnet libraries to craft packets on and

1007
00:36:33,590 --> 00:36:39,090
conduct packet capture it also takes

1008
00:36:36,630 --> 00:36:42,210
care of the hot install of the<font color="#E5E5E5"> wimpy cab</font>

1009
00:36:39,090 --> 00:36:44,880
drivers and also uninstall you can set

1010
00:36:42,210 --> 00:36:46,200
the size<font color="#CCCCCC"> limit for the amount of data</font>

1011
00:36:44,880 --> 00:36:49,560
you want<font color="#E5E5E5"> to or packets you want to</font>

1012
00:36:46,200 --> 00:36:53,060
capture<font color="#E5E5E5"> and also a timeout so then</font><font color="#CCCCCC"> I'll</font>

1013
00:36:49,560 --> 00:36:53,060
<font color="#E5E5E5">move to</font><font color="#CCCCCC"> a quick demo</font>

1014
00:36:57,880 --> 00:37:01,900
so you see here first we're checking to

1015
00:36:59,770 --> 00:37:04,750
see if the<font color="#CCCCCC"> npf service is installed and</font>

1016
00:37:01,900 --> 00:37:07,660
it's not so we'll go<font color="#CCCCCC"> ahead and use the</font>

1017
00:37:04,750 --> 00:37:09,730
tool will import<font color="#E5E5E5"> the wimpy cap capture</font>

1018
00:37:07,660 --> 00:37:13,270
and install the wind<font color="#CCCCCC"> coupee cab drivers</font>

1019
00:37:09,730 --> 00:37:14,800
I mean currently it uses sexc to install

1020
00:37:13,270 --> 00:37:16,570
this<font color="#E5E5E5"> are to create and install the</font>

1021
00:37:14,800 --> 00:37:18,490
service we<font color="#CCCCCC"> have plans in the future to</font>

1022
00:37:16,570 --> 00:37:21,450
change that to use peer dotnet

1023
00:37:18,490 --> 00:37:24,549
reflection<font color="#E5E5E5"> then once it's</font><font color="#CCCCCC"> setup we can</font>

1024
00:37:21,450 --> 00:37:26,830
use the main function get wind pcap

1025
00:37:24,550 --> 00:37:31,350
capture and we're going to capture /

1026
00:37:26,830 --> 00:37:31,350
port 80 and set them<font color="#E5E5E5"> excise</font><font color="#CCCCCC"> 25 megs</font>

1027
00:37:37,780 --> 00:37:43,210
and then we're going to capture over a

1028
00:37:41,380 --> 00:37:45,400
plane a<font color="#E5E5E5"> plaintext protocol someone</font>

1029
00:37:43,210 --> 00:37:49,390
logging into harmed reside which is

1030
00:37:45,400 --> 00:37:51,840
pretty awesome totally<font color="#CCCCCC"> not a</font>

1031
00:37:49,390 --> 00:37:51,839
vulnerability

1032
00:37:57,980 --> 00:38:01,359
I got approval for this

1033
00:38:01,880 --> 00:38:08,780
and once it's finished it will output

1034
00:38:04,070 --> 00:38:11,510
the location of the pcap file you can

1035
00:38:08,780 --> 00:38:17,360
use the same script to uninstall the<font color="#CCCCCC"> npf</font>

1036
00:38:11,510 --> 00:38:21,260
service and clean up and<font color="#CCCCCC"> then we can</font>

1037
00:38:17,360 --> 00:38:23,560
<font color="#CCCCCC">just go ahead and open up that file with</font>

1038
00:38:21,260 --> 00:38:23,560
wireshark

1039
00:38:28,410 --> 00:38:33,290
and then we see the clear text<font color="#CCCCCC"> login for</font>

1040
00:38:31,020 --> 00:38:33,290
the site

1041
00:38:41,020 --> 00:38:44,550
that's his face again yes

1042
00:38:45,309 --> 00:38:48,890
so I've liked also note on<font color="#E5E5E5"> this one</font>

1043
00:38:47,390 --> 00:38:50,779
that's I've seen the<font color="#E5E5E5"> most use out of</font>

1044
00:38:48,890 --> 00:38:52,308
<font color="#E5E5E5">something like this in a lot of like</font>

1045
00:38:50,779 --> 00:38:54,670
finance and<font color="#CCCCCC"> Industry you know there's a</font>

1046
00:38:52,309 --> 00:38:57,079
lot<font color="#CCCCCC"> of regulatory protocols that control</font>

1047
00:38:54,670 --> 00:38:58,880
<font color="#E5E5E5">the use of plaintext protocols but</font>

1048
00:38:57,079 --> 00:39:00,559
you'll note that a lot of<font color="#CCCCCC"> those</font>

1049
00:38:58,880 --> 00:39:02,900
protocols or a lot of the specific

1050
00:39:00,559 --> 00:39:05,029
compliance things are about traffic over

1051
00:39:02,900 --> 00:39:07,220
<font color="#CCCCCC">the boundary or things leaving the</font>

1052
00:39:05,029 --> 00:39:08,450
environment however there's this thing

1053
00:39:07,220 --> 00:39:09,680
where bad guys get inside your

1054
00:39:08,450 --> 00:39:12,109
environment and<font color="#E5E5E5"> they</font><font color="#CCCCCC"> don't need the</font>

1055
00:39:09,680 --> 00:39:13,788
boundary anymore and so if there's

1056
00:39:12,109 --> 00:39:15,650
situations or systems or credit

1057
00:39:13,789 --> 00:39:17,630
processing or financial processing or

1058
00:39:15,650 --> 00:39:19,130
core banking or any of those other

1059
00:39:17,630 --> 00:39:20,960
really good buzz words that utilize

1060
00:39:19,130 --> 00:39:23,569
praying text protocols this is a really

1061
00:39:20,960 --> 00:39:26,390
<font color="#E5E5E5">good method to directly rip off of a bad</font>

1062
00:39:23,569 --> 00:39:28,940
guy to<font color="#E5E5E5"> dump those financial transactions</font>

1063
00:39:26,390 --> 00:39:30,950
<font color="#CCCCCC">just clear text into a pcap and improve</font>

1064
00:39:28,940 --> 00:39:32,809
access to<font color="#E5E5E5"> that data all without having</font>

1065
00:39:30,950 --> 00:39:37,970
<font color="#CCCCCC">to get on the mainframes which I hate</font>

1066
00:39:32,809 --> 00:39:39,319
<font color="#E5E5E5">touching anyway stay far away from so we</font>

1067
00:39:37,970 --> 00:39:41,450
feel kind of feel it's an obligation we

1068
00:39:39,319 --> 00:39:42,890
try very hard to give mitigations or

1069
00:39:41,450 --> 00:39:44,899
defensive talk on everything we do

1070
00:39:42,890 --> 00:39:47,058
because you know our job as red teamers

1071
00:39:44,900 --> 00:39:49,069
especially used to help better on train

1072
00:39:47,059 --> 00:39:51,740
and<font color="#CCCCCC"> improve the state of the industry</font>

1073
00:39:49,069 --> 00:39:54,500
and try to try to offer suggestions is

1074
00:39:51,740 --> 00:39:57,950
the world ending no<font color="#CCCCCC"> I would say it is</font>

1075
00:39:54,500 --> 00:39:59,660
very<font color="#CCCCCC"> very hard to find a trick or a</font>

1076
00:39:57,950 --> 00:40:02,598
mitigation for a lot<font color="#E5E5E5"> of these different</font>

1077
00:39:59,660 --> 00:40:04,490
post exploitation activities in each of

1078
00:40:02,599 --> 00:40:05,599
these cases there<font color="#CCCCCC"> are indicators and</font>

1079
00:40:04,490 --> 00:40:08,899
things that<font color="#E5E5E5"> could have been locked down</font>

1080
00:40:05,599 --> 00:40:13,539
to prevent<font color="#E5E5E5"> this from occurring however I</font>

1081
00:40:08,900 --> 00:40:16,309
would say<font color="#CCCCCC"> that it's it's it's kind of</font>

1082
00:40:13,539 --> 00:40:17,900
the focus<font color="#CCCCCC"> oftentimes when we release</font>

1083
00:40:16,309 --> 00:40:18,920
these tools so we come up here<font color="#CCCCCC"> and we do</font>

1084
00:40:17,900 --> 00:40:20,329
<font color="#E5E5E5">this talk and you</font><font color="#CCCCCC"> should we show you</font>

1085
00:40:18,920 --> 00:40:21,589
everything in powershell right the

1086
00:40:20,329 --> 00:40:22,849
number one thing we get after our talk

1087
00:40:21,589 --> 00:40:24,980
like this is like<font color="#CCCCCC"> I'm deleting</font>

1088
00:40:22,849 --> 00:40:27,559
<font color="#CCCCCC">PowerShell from my environment like</font>

1089
00:40:24,980 --> 00:40:30,200
don't let our proof of concepts this

1090
00:40:27,559 --> 00:40:31,819
trick you this can all be done in native

1091
00:40:30,200 --> 00:40:33,769
code<font color="#CCCCCC"> to and</font><font color="#E5E5E5"> this can all be done with</font>

1092
00:40:31,819 --> 00:40:34,970
built-in tools so<font color="#CCCCCC"> we don't want you</font><font color="#E5E5E5"> to</font>

1093
00:40:33,769 --> 00:40:36,618
think that<font color="#E5E5E5"> you know power shells the</font>

1094
00:40:34,970 --> 00:40:38,538
enemy I would say there's a core thing

1095
00:40:36,619 --> 00:40:40,819
here are the issues this is in the words

1096
00:40:38,539 --> 00:40:43,789
of a very very wise senior red team or

1097
00:40:40,819 --> 00:40:45,890
Matt Nelson users are<font color="#CCCCCC"> going to use and</font>

1098
00:40:43,789 --> 00:40:47,869
so like most often what adversaries are

1099
00:40:45,890 --> 00:40:49,670
exploiting is that user they're using

1100
00:40:47,869 --> 00:40:51,650
user behavior and they're using<font color="#E5E5E5"> admin</font>

1101
00:40:49,670 --> 00:40:52,880
behavior in situations where they're

1102
00:40:51,650 --> 00:40:54,650
supposed to<font color="#E5E5E5"> be able to do it and the</font>

1103
00:40:52,880 --> 00:40:56,420
real<font color="#E5E5E5"> focus should be on auditing and</font>

1104
00:40:54,650 --> 00:40:58,069
detection because that you know after an

1105
00:40:56,420 --> 00:40:58,850
adversary gets admin in your environment

1106
00:40:58,069 --> 00:41:01,550
and their<font color="#CCCCCC"> due</font>

1107
00:40:58,850 --> 00:41:03,529
admin things<font color="#CCCCCC"> oftentimes</font><font color="#E5E5E5"> the things</font>

1108
00:41:01,550 --> 00:41:05,150
that's going to trip you off is admin

1109
00:41:03,530 --> 00:41:06,470
things that don't normally<font color="#E5E5E5"> happen in</font>

1110
00:41:05,150 --> 00:41:08,480
your<font color="#E5E5E5"> environment let's say the admin</font>

1111
00:41:06,470 --> 00:41:09,680
normally takes a two hour lunch<font color="#CCCCCC"> and</font>

1112
00:41:08,480 --> 00:41:11,120
<font color="#E5E5E5">instead of his two-hour lunch it looks</font>

1113
00:41:09,680 --> 00:41:13,339
like he's working<font color="#CCCCCC"> through lunch maybe</font>

1114
00:41:11,120 --> 00:41:14,720
you<font color="#CCCCCC"> should ask the question why or I</font>

1115
00:41:13,340 --> 00:41:17,150
don't<font color="#E5E5E5"> know if they're logging in at two</font>

1116
00:41:14,720 --> 00:41:18,740
in the morning from<font color="#E5E5E5"> a VPN or any number</font>

1117
00:41:17,150 --> 00:41:20,480
of like every<font color="#E5E5E5"> time you read a breach</font>

1118
00:41:18,740 --> 00:41:23,000
report you're like how<font color="#CCCCCC"> did no one notice</font>

1119
00:41:20,480 --> 00:41:24,830
this this is very odd behavior but<font color="#CCCCCC"> it</font>

1120
00:41:23,000 --> 00:41:26,900
you know it's easy<font color="#E5E5E5"> in hindsight 20 20</font>

1121
00:41:24,830 --> 00:41:28,340
but the auditing and real-time capture

1122
00:41:26,900 --> 00:41:30,200
of all this kind of the industry best

1123
00:41:28,340 --> 00:41:31,970
practices are going to help you one of

1124
00:41:30,200 --> 00:41:34,040
the best blogs<font color="#E5E5E5"> I like to recommend and I</font>

1125
00:41:31,970 --> 00:41:36,410
<font color="#E5E5E5">absolutely love this post I think it's</font>

1126
00:41:34,040 --> 00:41:38,570
extremely underrated is the Maslow's

1127
00:41:36,410 --> 00:41:41,029
hierarchy of security controls written

1128
00:41:38,570 --> 00:41:43,220
by Lee homes of our<font color="#E5E5E5"> Microsoft basically</font>

1129
00:41:41,030 --> 00:41:46,100
the concept is if you're installing like

1130
00:41:43,220 --> 00:41:47,660
15<font color="#E5E5E5"> next-gen agents to like solve all the</font>

1131
00:41:46,100 --> 00:41:50,360
security in your network but<font color="#E5E5E5"> you don't</font>

1132
00:41:47,660 --> 00:41:52,250
have<font color="#CCCCCC"> a</font><font color="#E5E5E5"> V or white listing maybe you</font>

1133
00:41:50,360 --> 00:41:54,320
should<font color="#CCCCCC"> take a step back maybe you should</font>

1134
00:41:52,250 --> 00:41:55,910
build<font color="#E5E5E5"> a foundation of</font><font color="#CCCCCC"> your network</font>

1135
00:41:54,320 --> 00:41:58,490
<font color="#E5E5E5">security and defense in the right order</font>

1136
00:41:55,910 --> 00:42:00,680
and step it up in an appropriate manner

1137
00:41:58,490 --> 00:42:02,359
focus on the basics first the basics<font color="#E5E5E5"> of</font>

1138
00:42:00,680 --> 00:42:04,069
detection have a sock have a team that's

1139
00:42:02,360 --> 00:42:05,420
trained to respond and<font color="#E5E5E5"> then you can</font>

1140
00:42:04,070 --> 00:42:09,350
start installing the tools that<font color="#E5E5E5"> will</font>

1141
00:42:05,420 --> 00:42:10,850
empower that team to do their job we

1142
00:42:09,350 --> 00:42:12,290
often<font color="#CCCCCC"> get asked the new buzzword or the</font>

1143
00:42:10,850 --> 00:42:13,730
new favorite<font color="#CCCCCC"> thing to say is threat</font>

1144
00:42:12,290 --> 00:42:15,860
hunting right like everyone's heard it

1145
00:42:13,730 --> 00:42:17,420
we<font color="#E5E5E5"> want to hunt we want to hunt in our</font>

1146
00:42:15,860 --> 00:42:19,820
environment<font color="#E5E5E5"> and that that's</font><font color="#CCCCCC"> awesome I</font>

1147
00:42:17,420 --> 00:42:21,140
actually I'm a big fan of it I kind<font color="#E5E5E5"> of</font>

1148
00:42:19,820 --> 00:42:22,840
go back to<font color="#CCCCCC"> or boil this down to a very</font>

1149
00:42:21,140 --> 00:42:24,859
<font color="#E5E5E5">simple principle so Locard's exchange</font>

1150
00:42:22,840 --> 00:42:26,690
essentially it's a traditional forensics

1151
00:42:24,860 --> 00:42:28,400
<font color="#E5E5E5">principle it's been applied to digital</font>

1152
00:42:26,690 --> 00:42:29,960
forensics as well it essentially says

1153
00:42:28,400 --> 00:42:31,970
every contact leave it straight there's

1154
00:42:29,960 --> 00:42:33,380
always trace evidence every time<font color="#E5E5E5"> an</font>

1155
00:42:31,970 --> 00:42:35,779
actor enters your environment no matter

1156
00:42:33,380 --> 00:42:37,670
how sexy and sophisticated they are now

1157
00:42:35,780 --> 00:42:39,800
how many<font color="#E5E5E5"> billions of dollars they spent</font>

1158
00:42:37,670 --> 00:42:41,480
on a tool there is an artifact left

1159
00:42:39,800 --> 00:42:43,910
somewhere it's impossible not to leave

1160
00:42:41,480 --> 00:42:45,860
an artifact somewhere however the trick

1161
00:42:43,910 --> 00:42:47,930
is are you<font color="#E5E5E5"> looking for the artifacts</font>

1162
00:42:45,860 --> 00:42:50,090
right so that's essentially what throw

1163
00:42:47,930 --> 00:42:52,669
hunting is is going to proactively look

1164
00:42:50,090 --> 00:42:54,320
for and identify artifacts<font color="#E5E5E5"> and so I'm a</font>

1165
00:42:52,670 --> 00:42:57,560
big fan of it I<font color="#CCCCCC"> think if it's applied in</font>

1166
00:42:54,320 --> 00:42:59,210
the right way<font color="#CCCCCC"> and it's focused on focus</font>

1167
00:42:57,560 --> 00:43:01,100
on the people aspect not just installing

1168
00:42:59,210 --> 00:43:03,950
a bunch of tools<font color="#E5E5E5"> that do things but</font>

1169
00:43:01,100 --> 00:43:06,200
trained analysts<font color="#E5E5E5"> that use those tools</font>

1170
00:43:03,950 --> 00:43:08,359
and know how to organize<font color="#CCCCCC"> an engagement</font><font color="#E5E5E5"> I</font>

1171
00:43:06,200 --> 00:43:09,710
think<font color="#E5E5E5"> you'll be very helpful the</font>

1172
00:43:08,360 --> 00:43:11,120
majority<font color="#CCCCCC"> of times we've been call an</font>

1173
00:43:09,710 --> 00:43:12,110
engagement yes we get caught that's the

1174
00:43:11,120 --> 00:43:13,759
job of the red<font color="#CCCCCC"> team</font>

1175
00:43:12,110 --> 00:43:16,160
<font color="#CCCCCC">majorities at times we call or either</font>

1176
00:43:13,760 --> 00:43:17,840
users because we do<font color="#E5E5E5"> something</font><font color="#CCCCCC"> really bad</font>

1177
00:43:16,160 --> 00:43:21,200
<font color="#CCCCCC">and they notice or we intend</font><font color="#E5E5E5"> to get</font>

1178
00:43:17,840 --> 00:43:22,550
caught or I are people that are being

1179
00:43:21,200 --> 00:43:24,500
proactive they're digging through sim

1180
00:43:22,550 --> 00:43:26,180
data because they enjoy<font color="#E5E5E5"> their job and</font>

1181
00:43:24,500 --> 00:43:28,370
while digging through sim data they

1182
00:43:26,180 --> 00:43:30,080
<font color="#CCCCCC">notice something odd versus just sitting</font>

1183
00:43:28,370 --> 00:43:32,509
and waiting for<font color="#E5E5E5"> the big giant red alert</font>

1184
00:43:30,080 --> 00:43:34,670
like nuclear alarm to go off<font color="#CCCCCC"> in the</font><font color="#E5E5E5"> sock</font>

1185
00:43:32,510 --> 00:43:37,370
which you know rarely happens in an

1186
00:43:34,670 --> 00:43:38,900
adversary<font color="#CCCCCC"> that knows the environment so</font>

1187
00:43:37,370 --> 00:43:40,220
what's the big takeaways from here well

1188
00:43:38,900 --> 00:43:43,490
hopefully some really cool tools you can

1189
00:43:40,220 --> 00:43:45,350
go play<font color="#E5E5E5"> with and some ideas realistic</font>

1190
00:43:43,490 --> 00:43:46,879
threat revelation replication must model

1191
00:43:45,350 --> 00:43:48,860
threats and so a lot<font color="#E5E5E5"> of people say they</font>

1192
00:43:46,880 --> 00:43:50,840
do threat rap but are you really are you

1193
00:43:48,860 --> 00:43:52,370
<font color="#E5E5E5">modeling a generic threat or remodeling</font>

1194
00:43:50,840 --> 00:43:54,410
a specific<font color="#E5E5E5"> threat or have you even asked</font>

1195
00:43:52,370 --> 00:43:56,089
that question like because<font color="#CCCCCC"> you know when</font>

1196
00:43:54,410 --> 00:43:57,440
you<font color="#E5E5E5"> start talking about applying the</font>

1197
00:43:56,090 --> 00:43:59,300
appropriate<font color="#CCCCCC"> level of threat for the</font>

1198
00:43:57,440 --> 00:44:01,520
environment it doesn't always<font color="#E5E5E5"> mean being</font>

1199
00:43:59,300 --> 00:44:03,740
super advanced apt sometimes it means

1200
00:44:01,520 --> 00:44:05,930
modeling a rant similar threat to see

1201
00:44:03,740 --> 00:44:08,299
how the environment would respond now

1202
00:44:05,930 --> 00:44:10,730
all of<font color="#CCCCCC"> the threat replication relies on</font>

1203
00:44:08,300 --> 00:44:13,490
realistic tactics and<font color="#E5E5E5"> Intel and observe</font>

1204
00:44:10,730 --> 00:44:15,710
techniques which is the hard part in

1205
00:44:13,490 --> 00:44:17,660
this industry<font color="#CCCCCC"> because it's so hard to</font>

1206
00:44:15,710 --> 00:44:19,760
<font color="#E5E5E5">get your hands</font><font color="#CCCCCC"> on a detailed post-mortem</font>

1207
00:44:17,660 --> 00:44:22,250
<font color="#CCCCCC">analysis of the majority of breaches one</font>

1208
00:44:19,760 --> 00:44:23,810
of my favorite talks was it was no easy

1209
00:44:22,250 --> 00:44:26,330
<font color="#E5E5E5">breach</font><font color="#CCCCCC"> i think</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> what it was titled it</font>

1210
00:44:23,810 --> 00:44:28,100
was talked about a derby<font color="#CCCCCC"> colin and it</font>

1211
00:44:26,330 --> 00:44:29,810
was essentially a walkthrough of<font color="#E5E5E5"> mandy</font>

1212
00:44:28,100 --> 00:44:31,610
and how they did this giant ir and it

1213
00:44:29,810 --> 00:44:33,200
was like a major battle back and forth

1214
00:44:31,610 --> 00:44:34,790
of this adversary trying to fight for

1215
00:44:33,200 --> 00:44:36,439
control<font color="#E5E5E5"> in an environment and it's a</font>

1216
00:44:34,790 --> 00:44:38,210
really great post mortem for people to

1217
00:44:36,440 --> 00:44:40,850
be<font color="#E5E5E5"> able to learn how to replicate those</font>

1218
00:44:38,210 --> 00:44:42,230
threats there's<font color="#CCCCCC"> plenty of creative</font>

1219
00:44:40,850 --> 00:44:43,940
things so all of you who have used

1220
00:44:42,230 --> 00:44:45,890
screenshot and key<font color="#E5E5E5"> loggers and that's it</font>

1221
00:44:43,940 --> 00:44:48,380
on your engagements think<font color="#E5E5E5"> outside the</font>

1222
00:44:45,890 --> 00:44:50,509
box like there are so<font color="#E5E5E5"> many</font><font color="#CCCCCC"> different</font>

1223
00:44:48,380 --> 00:44:54,050
<font color="#E5E5E5">things you can do to collect Intel from</font>

1224
00:44:50,510 --> 00:44:56,330
a user that<font color="#CCCCCC"> is powerful beyond those two</font>

1225
00:44:54,050 --> 00:44:58,190
simple techniques so expand your

1226
00:44:56,330 --> 00:44:59,600
horizons get creative go out and study

1227
00:44:58,190 --> 00:45:02,000
bad guys and how they're doing it and

1228
00:44:59,600 --> 00:45:03,230
then go create that and then my favorite

1229
00:45:02,000 --> 00:45:06,080
line and<font color="#E5E5E5"> I always tell our new guys this</font>

1230
00:45:03,230 --> 00:45:08,390
<font color="#E5E5E5">is op SEC is never perfect I shouldn't</font>

1231
00:45:06,080 --> 00:45:09,740
even<font color="#E5E5E5"> say rarely so that trace evidence</font>

1232
00:45:08,390 --> 00:45:12,020
that that you're<font color="#E5E5E5"> going to leave behind</font>

1233
00:45:09,740 --> 00:45:13,250
<font color="#E5E5E5">as a bad guy</font><font color="#CCCCCC"> both understand what you're</font>

1234
00:45:12,020 --> 00:45:14,780
leaving behind and for the blue team

1235
00:45:13,250 --> 00:45:16,460
errs understand what the bad guys leave

1236
00:45:14,780 --> 00:45:17,810
behind so red needs to learn a little

1237
00:45:16,460 --> 00:45:19,550
bit of blue<font color="#CCCCCC"> and blue needs to learn a</font>

1238
00:45:17,810 --> 00:45:22,820
little bit of red 22 better everybody

1239
00:45:19,550 --> 00:45:23,750
skill sets so we got a bunch of malware

1240
00:45:22,820 --> 00:45:25,070
references we're going to put these

1241
00:45:23,750 --> 00:45:25,760
slides up on SlideShare and release them

1242
00:45:25,070 --> 00:45:27,350
but there's a bunch of my

1243
00:45:25,760 --> 00:45:29,180
references for the specific hashes and

1244
00:45:27,350 --> 00:45:30,920
reports<font color="#E5E5E5"> that we talked about in here if</font>

1245
00:45:29,180 --> 00:45:33,470
<font color="#E5E5E5">you want to check out like how we</font>

1246
00:45:30,920 --> 00:45:35,750
modeled it or how close it was so these

1247
00:45:33,470 --> 00:45:37,700
are kind of reference material at this

1248
00:45:35,750 --> 00:45:39,470
point<font color="#E5E5E5"> open up for questions I think we</font>

1249
00:45:37,700 --> 00:45:42,140
have<font color="#CCCCCC"> about</font><font color="#E5E5E5"> five</font><font color="#CCCCCC"> minutes and then we'll</font>

1250
00:45:39,470 --> 00:45:44,740
be<font color="#CCCCCC"> out back we have a table out back and</font>

1251
00:45:42,140 --> 00:45:50,000
<font color="#CCCCCC">we'll be</font><font color="#E5E5E5"> around for any other questions</font>

1252
00:45:44,740 --> 00:45:51,500
go ahead<font color="#E5E5E5"> ah great question he's trying</font>

1253
00:45:50,000 --> 00:45:53,060
<font color="#E5E5E5">to stump me post actually by the way I</font>

1254
00:45:51,500 --> 00:45:56,090
work for this guy so he's just<font color="#E5E5E5"> trying to</font>

1255
00:45:53,060 --> 00:45:57,620
troll me post exploitation and<font color="#E5E5E5"> Linux so</font>

1256
00:45:56,090 --> 00:45:59,390
it's a<font color="#E5E5E5"> great question we're heavy</font>

1257
00:45:57,620 --> 00:46:01,100
PowerShell people you'll see that we

1258
00:45:59,390 --> 00:46:02,810
also we also a<font color="#E5E5E5"> model a tool called</font>

1259
00:46:01,100 --> 00:46:05,270
Python<font color="#E5E5E5"> Empire which has been since</font>

1260
00:46:02,810 --> 00:46:07,580
rolled into Empire we have an entire rat

1261
00:46:05,270 --> 00:46:10,360
that we've built<font color="#E5E5E5"> and released in linux</font>

1262
00:46:07,580 --> 00:46:12,980
and mac which is built<font color="#E5E5E5"> to do just that</font>

1263
00:46:10,360 --> 00:46:16,340
so it's focused on post exploitation

1264
00:46:12,980 --> 00:46:18,950
model post exploitation modules written

1265
00:46:16,340 --> 00:46:20,960
for those tool sets you'll<font color="#E5E5E5"> notice that a</font>

1266
00:46:18,950 --> 00:46:22,640
lot<font color="#CCCCCC"> of adversaries like they have tool</font>

1267
00:46:20,960 --> 00:46:24,620
<font color="#CCCCCC">kits</font><font color="#E5E5E5"> and linux and mac but they're a lot</font>

1268
00:46:22,640 --> 00:46:26,660
harder to find because<font color="#E5E5E5"> they're less of</font>

1269
00:46:24,620 --> 00:46:27,620
them<font color="#E5E5E5"> i would say it's because nine of</font>

1270
00:46:26,660 --> 00:46:29,149
the top<font color="#E5E5E5"> ten like commercial</font>

1271
00:46:27,620 --> 00:46:30,620
organizations use active directory and

1272
00:46:29,150 --> 00:46:32,720
therefore they use a majority of windows

1273
00:46:30,620 --> 00:46:34,430
<font color="#CCCCCC">we have operated in ninety percent</font><font color="#E5E5E5"> mac</font>

1274
00:46:32,720 --> 00:46:37,279
environments and successfully conducted

1275
00:46:34,430 --> 00:46:38,839
post exploitation so it's doable is just

1276
00:46:37,280 --> 00:46:40,190
as doable with anywhere<font color="#E5E5E5"> else you just</font>

1277
00:46:38,840 --> 00:46:43,930
got to<font color="#CCCCCC"> know where to draw</font><font color="#E5E5E5"> your</font>

1278
00:46:40,190 --> 00:46:43,930
inspiration and how to code the tools

1279
00:46:44,170 --> 00:46:49,580
questions no all right either that was a

1280
00:46:48,140 --> 00:46:52,629
really good presentation or you're all

1281
00:46:49,580 --> 00:46:52,630
sleeping yeah

