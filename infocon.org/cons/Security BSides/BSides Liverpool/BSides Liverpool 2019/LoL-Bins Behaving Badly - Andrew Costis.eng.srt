1
00:00:02,550 --> 00:00:08,500
all right so I'm Andrew Costas I'm a

2
00:00:06,069 --> 00:00:11,200
threat researcher at carbon black my

3
00:00:08,500 --> 00:00:15,099
talk today is on low bins behaving badly

4
00:00:11,200 --> 00:00:18,759
I just want to start by thanking all the

5
00:00:15,099 --> 00:00:21,640
besides organizers and everyone has been

6
00:00:18,760 --> 00:00:24,760
involved and thank you for selecting my

7
00:00:21,640 --> 00:00:25,600
talk it's a great honor to be here so

8
00:00:24,760 --> 00:00:28,359
good job everyone

9
00:00:25,600 --> 00:00:32,130
and like the venue but need a bit of air

10
00:00:28,359 --> 00:00:32,130
conditioning maybe for the next year so

11
00:00:32,698 --> 00:00:39,010
a little bit about me so most of my

12
00:00:36,700 --> 00:00:41,230
colleagues know me as AC so I've been

13
00:00:39,010 --> 00:00:44,829
doing threat research slash malware

14
00:00:41,230 --> 00:00:46,180
analysis for about four years but I've

15
00:00:44,829 --> 00:00:49,600
been in the tech industry as a whole

16
00:00:46,180 --> 00:00:51,610
for about 17 years so it's funny how I

17
00:00:49,600 --> 00:00:55,480
kind of got into it so my background is

18
00:00:51,610 --> 00:00:58,989
quite varied so I've done hardware to

19
00:00:55,480 --> 00:01:02,410
software to date center field

20
00:00:58,989 --> 00:01:03,879
engineering technical support sis at min

21
00:01:02,410 --> 00:01:05,470
kind of a bit of everything and just

22
00:01:03,879 --> 00:01:07,869
kind of being exposed to so many

23
00:01:05,470 --> 00:01:10,479
different technologies has kind of

24
00:01:07,869 --> 00:01:13,570
helped me to kind of do more what I

25
00:01:10,479 --> 00:01:14,229
wanted to do so yeah quite a varied

26
00:01:13,570 --> 00:01:18,008
background

27
00:01:14,229 --> 00:01:20,229
I don't sort of do Twitter I am on

28
00:01:18,009 --> 00:01:24,759
Twitter but I use it more for sort of

29
00:01:20,229 --> 00:01:28,119
research so looking at any new malware

30
00:01:24,759 --> 00:01:30,250
hashes that get posted or any of the AV

31
00:01:28,119 --> 00:01:34,829
vendors or other researchers that might

32
00:01:30,250 --> 00:01:38,229
post some interest in information so I

33
00:01:34,829 --> 00:01:41,770
specifically work in our fret analysis

34
00:01:38,229 --> 00:01:44,890
unit for carbon black so we have about a

35
00:01:41,770 --> 00:01:46,420
team of about 16 people and we're kind

36
00:01:44,890 --> 00:01:49,450
of scattered all over the world we're

37
00:01:46,420 --> 00:01:51,159
all remote so we're out of the 16 of us

38
00:01:49,450 --> 00:01:53,350
we're kind of broken into four focus

39
00:01:51,159 --> 00:01:56,590
groups so I work on a team of four

40
00:01:53,350 --> 00:01:58,570
looking at a crime and commodity malware

41
00:01:56,590 --> 00:02:01,000
we've got other teams that do kind of

42
00:01:58,570 --> 00:02:04,380
internal support so building and

43
00:02:01,000 --> 00:02:07,270
supporting tools for us guys to use and

44
00:02:04,380 --> 00:02:09,060
we have an apt nation-state team and

45
00:02:07,270 --> 00:02:11,170
then we have kind of more of a product

46
00:02:09,060 --> 00:02:15,030
kind of focused team that are more

47
00:02:11,170 --> 00:02:17,760
experts at the how the products work

48
00:02:15,030 --> 00:02:20,220
and that is a picture of my dog showing

49
00:02:17,760 --> 00:02:24,630
no signs of reading practical marrow

50
00:02:20,220 --> 00:02:27,870
analysis so quick rundown of the agenda

51
00:02:24,630 --> 00:02:30,299
so my plan is to kind of make a few

52
00:02:27,870 --> 00:02:32,340
definitions to anyone that's kind of not

53
00:02:30,300 --> 00:02:33,420
clear on some of the stuff I'm going to

54
00:02:32,340 --> 00:02:36,090
cover and they're not going to actually

55
00:02:33,420 --> 00:02:37,910
step through some examples so gonna

56
00:02:36,090 --> 00:02:40,440
start off simple talking about some

57
00:02:37,910 --> 00:02:42,510
ransomware campaigns and families I've

58
00:02:40,440 --> 00:02:44,040
looked at over the last six months and

59
00:02:42,510 --> 00:02:46,679
then kind of move on to some of the more

60
00:02:44,040 --> 00:02:49,920
advanced techniques banking Trojans and

61
00:02:46,680 --> 00:02:51,930
how they're leveraged in low bins and if

62
00:02:49,920 --> 00:02:53,280
we've got time and please be nice if we

63
00:02:51,930 --> 00:02:54,870
do have time please ask me some

64
00:02:53,280 --> 00:03:00,390
questions that I might have a clue how

65
00:02:54,870 --> 00:03:02,610
to answer so starting from low bins and

66
00:03:00,390 --> 00:03:05,850
so what is a low bin so living off the

67
00:03:02,610 --> 00:03:08,280
land binary so this is any you know this

68
00:03:05,850 --> 00:03:10,890
is any application or binary that comes

69
00:03:08,280 --> 00:03:13,380
preloaded with whatever flavor of

70
00:03:10,890 --> 00:03:22,708
operating system helps if I click Next

71
00:03:13,380 --> 00:03:26,190
why is that not work in laptops now it's

72
00:03:22,709 --> 00:03:28,830
a good start oh there we go yeah so

73
00:03:26,190 --> 00:03:31,290
living off the land so these are

74
00:03:28,830 --> 00:03:35,340
binaries that come pre-loaded so common

75
00:03:31,290 --> 00:03:37,620
things such as PowerShell WMI you know

76
00:03:35,340 --> 00:03:39,720
windows script in the host and lots of

77
00:03:37,620 --> 00:03:41,010
others there's actually some very

78
00:03:39,720 --> 00:03:42,359
unusual ones that you probably wouldn't

79
00:03:41,010 --> 00:03:46,200
even think to look at that are being

80
00:03:42,360 --> 00:03:48,150
used everyday by malware actors really

81
00:03:46,200 --> 00:03:51,480
wanted to just mention so there's a guy

82
00:03:48,150 --> 00:03:53,820
that's based in Norway odd ver mo he's

83
00:03:51,480 --> 00:03:55,950
done not only a brilliant talk about the

84
00:03:53,820 --> 00:03:58,530
history behind how the term low bins

85
00:03:55,950 --> 00:04:00,630
first came about but he also manages and

86
00:03:58,530 --> 00:04:02,370
maintains a github project where it's

87
00:04:00,630 --> 00:04:05,070
basically an inventory of the different

88
00:04:02,370 --> 00:04:07,380
file names for different windows you

89
00:04:05,070 --> 00:04:09,660
know low bins so highly recommend to

90
00:04:07,380 --> 00:04:12,480
check them out I've reached out to him

91
00:04:09,660 --> 00:04:14,519
because there was a specific malware

92
00:04:12,480 --> 00:04:16,469
family that I was looking at and there

93
00:04:14,519 --> 00:04:18,329
was a particular lobe in that it's not

94
00:04:16,470 --> 00:04:19,820
very well documented and it wasn't on

95
00:04:18,329 --> 00:04:22,830
his github page and he's super

96
00:04:19,820 --> 00:04:24,750
responsive so yeah if you have any if

97
00:04:22,830 --> 00:04:25,919
you encounter any low bins in your day

98
00:04:24,750 --> 00:04:28,700
to day world I'd definitely recommend

99
00:04:25,919 --> 00:04:28,700
hitting him up

100
00:04:30,070 --> 00:04:36,709
I've got a powerpoints gonna crash on me

101
00:04:33,670 --> 00:04:36,709
[Music]

102
00:04:37,750 --> 00:04:56,810
so you didn't see that boy did I have an

103
00:04:40,009 --> 00:04:59,270
error message pop up here come on yeah

104
00:04:56,810 --> 00:05:01,490
looks like PowerPoint is completely

105
00:04:59,270 --> 00:05:04,299
dying so let me just restart this real

106
00:05:01,490 --> 00:05:04,300
quick apologies

107
00:05:18,159 --> 00:05:20,639
to

108
00:05:26,490 --> 00:05:30,380
this is a good way of killing five

109
00:05:27,930 --> 00:05:30,380
minutes

110
00:05:38,020 --> 00:05:42,570
okay maybe the clickers completely

111
00:05:40,360 --> 00:05:42,570
broken

112
00:05:54,190 --> 00:06:02,440
try that it seems to be lagging somewhat

113
00:05:59,140 --> 00:06:03,789
so I'm just going to try and talk about

114
00:06:02,440 --> 00:06:06,190
what's on the slides before it crashes

115
00:06:03,790 --> 00:06:08,560
again so another definition so commodity

116
00:06:06,190 --> 00:06:09,969
malware so most people know malware when

117
00:06:08,560 --> 00:06:12,490
they talk about malware they typically

118
00:06:09,970 --> 00:06:14,950
think about apt so advanced persistent

119
00:06:12,490 --> 00:06:17,200
threat but in actual fact kind of

120
00:06:14,950 --> 00:06:19,390
first-hand experiences that a PT's

121
00:06:17,200 --> 00:06:21,130
aren't always as advanced as what people

122
00:06:19,390 --> 00:06:23,110
think so that if anything they're more

123
00:06:21,130 --> 00:06:24,700
adaptive because they're very well

124
00:06:23,110 --> 00:06:26,950
financially backed they're very well

125
00:06:24,700 --> 00:06:28,900
highly resourced in terms of the people

126
00:06:26,950 --> 00:06:30,640
behind the apt campaigns and the

127
00:06:28,900 --> 00:06:32,500
nation-state campaigns they usually

128
00:06:30,640 --> 00:06:35,110
after a specific goal whether it's

129
00:06:32,500 --> 00:06:37,300
corporate espionage whether it's

130
00:06:35,110 --> 00:06:39,000
blueprints to the latest f-35 stealth

131
00:06:37,300 --> 00:06:42,070
fighter or whatever the case may be

132
00:06:39,000 --> 00:06:43,810
there's enough indications as to who the

133
00:06:42,070 --> 00:06:47,440
usual culprits are we're not going to go

134
00:06:43,810 --> 00:06:49,300
there so typically or if anything apt

135
00:06:47,440 --> 00:06:51,490
should probably be labeled as adaptive

136
00:06:49,300 --> 00:06:53,470
because they're designed to be adaptive

137
00:06:51,490 --> 00:06:56,440
and just kind of stay off the radar in

138
00:06:53,470 --> 00:06:58,510
the typical corporate environment in

139
00:06:56,440 --> 00:07:02,760
contrast to that and I've got another

140
00:06:58,510 --> 00:07:02,760
error this is not going well

141
00:07:04,470 --> 00:07:09,669
so in contrast to that commodity Mouse

142
00:07:08,230 --> 00:07:11,230
that's pretty much everything else so

143
00:07:09,669 --> 00:07:12,940
most people think that key loggers

144
00:07:11,230 --> 00:07:14,620
ransomware yeah this stuff's been around

145
00:07:12,940 --> 00:07:17,560
for years it's not that sophisticated

146
00:07:14,620 --> 00:07:19,750
in actual fact from what we're seeing at

147
00:07:17,560 --> 00:07:21,940
least in our team is that sophistication

148
00:07:19,750 --> 00:07:24,130
level in the advanced level of quality

149
00:07:21,940 --> 00:07:25,900
mao is actually improving somewhat over

150
00:07:24,130 --> 00:07:28,510
recent times

151
00:07:25,900 --> 00:07:30,700
generally speaking you know not just

152
00:07:28,510 --> 00:07:33,550
ransomware but even banking Trojans are

153
00:07:30,700 --> 00:07:35,650
looking for specific targets they're

154
00:07:33,550 --> 00:07:37,390
looking to kind of infect as many

155
00:07:35,650 --> 00:07:38,950
systems as possible with we're talking

156
00:07:37,390 --> 00:07:40,390
about ransomware or maybe just a

157
00:07:38,950 --> 00:07:43,000
specific company if we're talking about

158
00:07:40,390 --> 00:07:46,270
banking Trojans but either way there's a

159
00:07:43,000 --> 00:07:48,040
very on a technical level while the

160
00:07:46,270 --> 00:07:50,260
motives and the intent might might be

161
00:07:48,040 --> 00:07:52,210
slightly different there's actually a

162
00:07:50,260 --> 00:07:54,039
very close technical overlap between the

163
00:07:52,210 --> 00:07:56,830
two for example

164
00:07:54,040 --> 00:07:58,870
malware you know nation-state malware

165
00:07:56,830 --> 00:08:00,750
often uses low bins as does commodity

166
00:07:58,870 --> 00:08:03,220
malware they both use obfuscation

167
00:08:00,750 --> 00:08:04,990
methods they both use ways to hide

168
00:08:03,220 --> 00:08:06,680
themselves from people like me in terms

169
00:08:04,990 --> 00:08:09,170
of anti analysis

170
00:08:06,680 --> 00:08:11,720
you know sandbox escaping or whatever so

171
00:08:09,170 --> 00:08:16,880
just to kind of clear up any issues with

172
00:08:11,720 --> 00:08:18,470
with those so next big buzzword for has

173
00:08:16,880 --> 00:08:20,990
been around for the last couple of years

174
00:08:18,470 --> 00:08:22,940
so if anyone hasn't heard of miter

175
00:08:20,990 --> 00:08:25,310
attack I hate to tell you may have been

176
00:08:22,940 --> 00:08:28,940
living under a rock but really really

177
00:08:25,310 --> 00:08:31,990
helpful so effectively it's a knowledge

178
00:08:28,940 --> 00:08:34,370
base of adversary behaviors so

179
00:08:31,990 --> 00:08:36,650
historically if we kind of that so

180
00:08:34,370 --> 00:08:38,659
there's a model that a guy created David

181
00:08:36,650 --> 00:08:41,390
Bianco back in 2013 called the pyramid

182
00:08:38,659 --> 00:08:44,540
of pain recommend to check it out but at

183
00:08:41,390 --> 00:08:47,000
the bottom you have IOC s now iacs I'm

184
00:08:44,540 --> 00:08:49,280
not saying a pointless or they have no a

185
00:08:47,000 --> 00:08:52,130
certain a purpose but in the age of

186
00:08:49,280 --> 00:08:54,560
Imhotep and I know at the keynote you

187
00:08:52,130 --> 00:08:56,840
know Imhotep was mentioned the reason

188
00:08:54,560 --> 00:08:58,310
why Imhotep specifically gave a lot of

189
00:08:56,840 --> 00:09:00,080
the blue team a headache a big headache

190
00:08:58,310 --> 00:09:02,119
was because the IO scenes were changing

191
00:09:00,080 --> 00:09:03,740
all the time it is very very difficult

192
00:09:02,120 --> 00:09:05,780
to keep track of when you have hundreds

193
00:09:03,740 --> 00:09:07,460
of thousands if not millions of samples

194
00:09:05,780 --> 00:09:09,910
and hashes at a change in there are only

195
00:09:07,460 --> 00:09:12,860
valid ones and then you know have a very

196
00:09:09,910 --> 00:09:15,680
short shelf life or low tto if you like

197
00:09:12,860 --> 00:09:17,620
so enter the miter attack frameworks

198
00:09:15,680 --> 00:09:20,449
it's effectively a knowledge base of

199
00:09:17,620 --> 00:09:23,240
behaviors so rather than map into AI OCS

200
00:09:20,450 --> 00:09:26,000
which expire very quickly you can kind

201
00:09:23,240 --> 00:09:28,070
of abstract that a high level and not

202
00:09:26,000 --> 00:09:31,100
just from a blue team but also for red

203
00:09:28,070 --> 00:09:33,230
teaming pentesting adversary' simulation

204
00:09:31,100 --> 00:09:36,470
and just basically using the framework

205
00:09:33,230 --> 00:09:38,690
to kind of you know measure your

206
00:09:36,470 --> 00:09:41,660
security measure your effectiveness the

207
00:09:38,690 --> 00:09:44,540
form gap analysis and so on and as a

208
00:09:41,660 --> 00:09:46,040
quick example this is just a slide taken

209
00:09:44,540 --> 00:09:47,510
from The MITRE framework in that I know

210
00:09:46,040 --> 00:09:49,819
I'm sure some of you here have seen this

211
00:09:47,510 --> 00:09:51,860
before but you know this is just one of

212
00:09:49,820 --> 00:09:53,750
the uses so from a researchers

213
00:09:51,860 --> 00:09:55,940
perspective it's quite useful to be able

214
00:09:53,750 --> 00:09:57,860
to compare different apt campaigns and

215
00:09:55,940 --> 00:09:59,960
looking at the behaviors that they share

216
00:09:57,860 --> 00:10:02,450
and what's common because that might

217
00:09:59,960 --> 00:10:04,910
help to kind of track going forward that

218
00:10:02,450 --> 00:10:07,490
may help with hunting and you know other

219
00:10:04,910 --> 00:10:09,650
reasons as well so yeah mitre attack is

220
00:10:07,490 --> 00:10:11,270
not a bullet through a silver bullet

221
00:10:09,650 --> 00:10:14,390
kind of approach to this is going to fix

222
00:10:11,270 --> 00:10:16,370
everything but if you haven't you know

223
00:10:14,390 --> 00:10:17,900
encountered it as yet you know

224
00:10:16,370 --> 00:10:20,180
definitely check out the website is some

225
00:10:17,900 --> 00:10:20,360
really good information fundamentally

226
00:10:20,180 --> 00:10:22,670
how

227
00:10:20,360 --> 00:10:25,790
works as the column headers if you like

228
00:10:22,670 --> 00:10:27,799
at the top represent the the goal of the

229
00:10:25,790 --> 00:10:29,929
attacker and then the cell underneath

230
00:10:27,799 --> 00:10:32,809
each column represents the tactic or

231
00:10:29,929 --> 00:10:34,429
technique used and their websites great

232
00:10:32,809 --> 00:10:37,249
because you can obviously drill in and

233
00:10:34,429 --> 00:10:39,769
get specific examples of you know

234
00:10:37,249 --> 00:10:44,899
exfiltration c2 or lateral movement

235
00:10:39,769 --> 00:10:47,029
examples and so on so touch weird we're

236
00:10:44,899 --> 00:10:48,619
still working so that's good so we're

237
00:10:47,029 --> 00:10:51,649
going to move on to some quick examples

238
00:10:48,619 --> 00:10:53,660
of ransomware so going to start off with

239
00:10:51,649 --> 00:10:55,639
some simpler examples so this particular

240
00:10:53,660 --> 00:10:58,929
ransomware campaign came out a couple of

241
00:10:55,639 --> 00:11:02,059
months ago bought down some government

242
00:10:58,929 --> 00:11:04,910
agencies government kind of services

243
00:11:02,059 --> 00:11:06,589
across North America it's quite an

244
00:11:04,910 --> 00:11:08,449
interesting sample so most of most

245
00:11:06,589 --> 00:11:10,999
ransomware that I've personally dealt

246
00:11:08,449 --> 00:11:13,849
with is written in net and this is

247
00:11:10,999 --> 00:11:16,429
actually written in go language so that

248
00:11:13,850 --> 00:11:19,429
we not saying that we're seeing a huge

249
00:11:16,429 --> 00:11:22,579
uptake in malware threatenin go but it

250
00:11:19,429 --> 00:11:24,860
was probably one of the first go written

251
00:11:22,579 --> 00:11:26,209
or coded ransomware strains that i've

252
00:11:24,860 --> 00:11:29,089
personally encountered so that's quite

253
00:11:26,209 --> 00:11:30,069
interesting this particular ransom note

254
00:11:29,089 --> 00:11:33,199
was quite interesting as well because

255
00:11:30,069 --> 00:11:36,589
after four days it was prompting the

256
00:11:33,199 --> 00:11:38,929
victim to make an additional $10,000

257
00:11:36,589 --> 00:11:41,389
daemon on the after the fourth day and

258
00:11:38,929 --> 00:11:44,509
for each day thereafter so again like

259
00:11:41,389 --> 00:11:47,110
the psychology behind ransomware but

260
00:11:44,509 --> 00:11:49,399
digging into this particular sample

261
00:11:47,110 --> 00:11:52,189
doesn't take long to kind of see some

262
00:11:49,399 --> 00:11:56,360
common tactics and techniques delivered

263
00:11:52,189 --> 00:11:58,549
so at the top we've got the process so

264
00:11:56,360 --> 00:12:01,309
we've got basically the executable that

265
00:11:58,549 --> 00:12:04,009
spawns command prompt which spawns nets

266
00:12:01,309 --> 00:12:06,230
and it basically does a net use this is

267
00:12:04,009 --> 00:12:09,169
not so common and this is quite

268
00:12:06,230 --> 00:12:11,209
interesting command because it basically

269
00:12:09,169 --> 00:12:14,749
just disconnects all map network drives

270
00:12:11,209 --> 00:12:17,029
so typically ransomware has worm kind of

271
00:12:14,749 --> 00:12:19,850
capability built in so ultimately if we

272
00:12:17,029 --> 00:12:21,799
you know if you know common aim for the

273
00:12:19,850 --> 00:12:23,749
malware offer is to kind of an infect

274
00:12:21,799 --> 00:12:25,519
and spread because ultimately if they

275
00:12:23,749 --> 00:12:26,779
can infect more people then there's more

276
00:12:25,519 --> 00:12:30,169
chance that they're going to receive

277
00:12:26,779 --> 00:12:32,389
payment right so so this command is

278
00:12:30,169 --> 00:12:34,220
quite unusual for a regular user to run

279
00:12:32,389 --> 00:12:36,320
and so just by knowing the

280
00:12:34,220 --> 00:12:40,160
attack ID which is in green so attack

281
00:12:36,320 --> 00:12:42,980
IDT 1 1 2 6 it falls under the defense

282
00:12:40,160 --> 00:12:44,750
evasion column if you like and then it's

283
00:12:42,980 --> 00:12:45,800
network share connection removal and

284
00:12:44,750 --> 00:12:47,270
there's a whole load of other

285
00:12:45,800 --> 00:12:49,069
information about this particular

286
00:12:47,270 --> 00:12:51,620
command as I say I'm going to start

287
00:12:49,070 --> 00:12:54,530
simple but these these are quite you

288
00:12:51,620 --> 00:12:55,820
these aren't unique to ransomware but

289
00:12:54,530 --> 00:12:58,699
these these are just very common

290
00:12:55,820 --> 00:13:03,410
commands blow bins that I see very very

291
00:12:58,700 --> 00:13:05,570
often so again SC exe does a stop but

292
00:13:03,410 --> 00:13:08,000
actually stops 180 something services

293
00:13:05,570 --> 00:13:10,520
all in one go so you actually see if

294
00:13:08,000 --> 00:13:11,270
you're monitoring you actually see 180

295
00:13:10,520 --> 00:13:14,150
odd

296
00:13:11,270 --> 00:13:16,100
command prompts all spawn in and each

297
00:13:14,150 --> 00:13:18,620
individually doing a stop of whichever

298
00:13:16,100 --> 00:13:21,470
service name and included in that was a

299
00:13:18,620 --> 00:13:24,440
pre compiled list of services not just

300
00:13:21,470 --> 00:13:27,860
antivirus but also backup disaster

301
00:13:24,440 --> 00:13:29,540
recovery virtualization SQL Microsoft

302
00:13:27,860 --> 00:13:31,460
Exchange a load of other services to

303
00:13:29,540 --> 00:13:33,110
just try and stop it as stop all those

304
00:13:31,460 --> 00:13:36,020
services running as quickly impossible

305
00:13:33,110 --> 00:13:38,750
is a common tactic for kind of counter

306
00:13:36,020 --> 00:13:40,250
ir so trying to make you know make

307
00:13:38,750 --> 00:13:42,620
people as our lives difficult

308
00:13:40,250 --> 00:13:44,540
essentially but again the attack IDs in

309
00:13:42,620 --> 00:13:47,360
green say service and you know services

310
00:13:44,540 --> 00:13:52,819
stop disabling them security tools very

311
00:13:47,360 --> 00:13:54,260
common to ransomware again kind of not

312
00:13:52,820 --> 00:13:56,390
going to go too much in depth but web

313
00:13:54,260 --> 00:13:57,740
tea utils so again it's a low bin that

314
00:13:56,390 --> 00:14:00,199
comes at Windows has been around for

315
00:13:57,740 --> 00:14:02,780
years effectively used to clear the

316
00:14:00,200 --> 00:14:05,930
windows event logs really really common

317
00:14:02,780 --> 00:14:09,380
technique used and ransomware again

318
00:14:05,930 --> 00:14:11,020
another counter ir technique bcdedit so

319
00:14:09,380 --> 00:14:14,270
ransomware typically doesn't want you to

320
00:14:11,020 --> 00:14:16,730
recover your system so how it will do

321
00:14:14,270 --> 00:14:19,400
that will do it will basically disable

322
00:14:16,730 --> 00:14:21,530
the automatic start up recovery and

323
00:14:19,400 --> 00:14:23,930
repair screen so that the next time

324
00:14:21,530 --> 00:14:27,079
windows boots up it's kind of game over

325
00:14:23,930 --> 00:14:29,780
so again attack IDs in green indicated

326
00:14:27,080 --> 00:14:31,700
removal on host in other words indicator

327
00:14:29,780 --> 00:14:35,089
being the artifacts of the windows event

328
00:14:31,700 --> 00:14:36,800
logs and a common one is obviously

329
00:14:35,090 --> 00:14:39,320
inhibiting system recovery and that's

330
00:14:36,800 --> 00:14:43,339
really which you will see shortly but

331
00:14:39,320 --> 00:14:44,810
that that one pops up a lot another

332
00:14:43,340 --> 00:14:46,400
strain of ransomware so this kind of

333
00:14:44,810 --> 00:14:47,619
crops up at the start of the year very

334
00:14:46,400 --> 00:14:49,959
very similar to one across

335
00:14:47,620 --> 00:14:53,380
not Petra so it contains the eternal

336
00:14:49,960 --> 00:14:55,180
blue exploit embedded in it uses a pool

337
00:14:53,380 --> 00:14:58,060
of onion addresses kind of fairly fairly

338
00:14:55,180 --> 00:15:00,310
normal for ransomware again drops of

339
00:14:58,060 --> 00:15:02,199
window shadow copies so really kind of

340
00:15:00,310 --> 00:15:05,250
typical and how it does that is it has a

341
00:15:02,200 --> 00:15:08,260
visual basic script and it executes that

342
00:15:05,250 --> 00:15:10,270
which then executes wmic which then

343
00:15:08,260 --> 00:15:12,760
executes the delete shadow copies the

344
00:15:10,270 --> 00:15:14,740
shadow copies are there the legitimate

345
00:15:12,760 --> 00:15:17,410
reasons as part of Windows System

346
00:15:14,740 --> 00:15:20,920
Restore and also your third-party backup

347
00:15:17,410 --> 00:15:23,079
applications will use shadow copies if

348
00:15:20,920 --> 00:15:25,779
you're using snapshot provided type

349
00:15:23,080 --> 00:15:27,160
backup technologies so again you know

350
00:15:25,779 --> 00:15:29,080
common common way of just trying to

351
00:15:27,160 --> 00:15:30,189
clear that clear down the system hide

352
00:15:29,080 --> 00:15:34,240
all the evidence as quickly as possible

353
00:15:30,190 --> 00:15:36,130
and move on to the next victim so kind

354
00:15:34,240 --> 00:15:39,190
of going through this exercise with a

355
00:15:36,130 --> 00:15:40,900
few more samples with specifically

356
00:15:39,190 --> 00:15:42,460
ransomware you can kind of see in you

357
00:15:40,900 --> 00:15:44,260
know build your table how you want or

358
00:15:42,460 --> 00:15:47,890
you know this is kind of a way of just

359
00:15:44,260 --> 00:15:50,230
showing you the usefulness of the you

360
00:15:47,890 --> 00:15:52,209
know of the understanding of the the my

361
00:15:50,230 --> 00:15:53,620
to attack framework and how the low bins

362
00:15:52,209 --> 00:15:55,329
fit in so as you can see and I've just

363
00:15:53,620 --> 00:15:57,970
kind of map like I don't know five or

364
00:15:55,330 --> 00:15:59,440
six or seven ransomware families and you

365
00:15:57,970 --> 00:16:01,180
can see highlighted in green you know

366
00:15:59,440 --> 00:16:03,490
inhibiting system recovery is quite

367
00:16:01,180 --> 00:16:06,219
common theme amongst malware ransomware

368
00:16:03,490 --> 00:16:08,050
rather but also you know understanding

369
00:16:06,220 --> 00:16:10,060
the common low bins that keep cropping

370
00:16:08,050 --> 00:16:12,189
up will help you to kind of zoom in

371
00:16:10,060 --> 00:16:14,380
within your network whether it's from a

372
00:16:12,190 --> 00:16:16,150
detection standpoint or whether it's

373
00:16:14,380 --> 00:16:18,250
from a hunting standpoint you know you

374
00:16:16,150 --> 00:16:20,140
can start to look at okay why did why is

375
00:16:18,250 --> 00:16:22,959
that user that's in finance running

376
00:16:20,140 --> 00:16:25,029
bcdedit or why is this user running you

377
00:16:22,959 --> 00:16:27,430
know SC commands or whatever you know

378
00:16:25,029 --> 00:16:30,000
out of hours or whatever so the idea is

379
00:16:27,430 --> 00:16:32,650
to kind of use your own kind of

380
00:16:30,000 --> 00:16:36,420
intelligence to kind of perform gap

381
00:16:32,650 --> 00:16:39,189
analysis understand in doing you know

382
00:16:36,420 --> 00:16:40,630
evaluating your assets obviously your

383
00:16:39,190 --> 00:16:42,190
defenses and there's there's loads of

384
00:16:40,630 --> 00:16:44,110
ways that you could kind of use this to

385
00:16:42,190 --> 00:16:46,270
kind of measure you know in terms of

386
00:16:44,110 --> 00:16:48,279
count priority you could start using it

387
00:16:46,270 --> 00:16:50,650
to tag things and that's just all from a

388
00:16:48,279 --> 00:16:51,850
you know free framework that you know

389
00:16:50,650 --> 00:16:55,870
has been around for the last couple

390
00:16:51,850 --> 00:16:57,370
years so moving on to a couple of

391
00:16:55,870 --> 00:17:00,510
banking Trojan examples so this

392
00:16:57,370 --> 00:17:02,220
particular banking Trojan Nano core

393
00:17:00,510 --> 00:17:04,020
has actually been around for a couple of

394
00:17:02,220 --> 00:17:07,049
years so this was quite interesting

395
00:17:04,020 --> 00:17:09,660
because it used quite an old oldish to

396
00:17:07,049 --> 00:17:11,400
2017 I believe the CVE for Microsoft

397
00:17:09,660 --> 00:17:13,829
Office equation editor so the equation

398
00:17:11,400 --> 00:17:16,020
editor is something that comes with

399
00:17:13,829 --> 00:17:18,359
Microsoft Office and has done for quite

400
00:17:16,020 --> 00:17:19,889
a few years but specifically what was

401
00:17:18,359 --> 00:17:23,219
interesting about this was that it hides

402
00:17:19,890 --> 00:17:24,990
itself as a JPEG file it would rather it

403
00:17:23,220 --> 00:17:27,870
downloads a JPEG file but it's actually

404
00:17:24,990 --> 00:17:30,059
a P for our executable file the the P

405
00:17:27,869 --> 00:17:31,320
file is actually compiled with a piece

406
00:17:30,059 --> 00:17:33,120
of third-party software called

407
00:17:31,320 --> 00:17:35,070
autohotkey I don't know if anyone's

408
00:17:33,120 --> 00:17:38,428
familiar with autohotkey but basically

409
00:17:35,070 --> 00:17:41,668
it's used for creating emboss for gaming

410
00:17:38,429 --> 00:17:42,780
other legitimate uses as well like you

411
00:17:41,669 --> 00:17:45,000
know for example if you wanted to

412
00:17:42,780 --> 00:17:46,649
demonstrate stuff without a click of a

413
00:17:45,000 --> 00:17:48,960
button you can pre-program it through

414
00:17:46,650 --> 00:17:50,850
macros from my understanding so this

415
00:17:48,960 --> 00:17:54,150
this particular executable was embedded

416
00:17:50,850 --> 00:17:55,469
using third-party software and you can

417
00:17:54,150 --> 00:17:56,850
actually it basically comes with a

418
00:17:55,470 --> 00:17:59,700
compiler where you can compile an

419
00:17:56,850 --> 00:18:02,520
executable so this particular campaign

420
00:17:59,700 --> 00:18:05,070
had multiple levels of obfuscation and

421
00:18:02,520 --> 00:18:06,840
part of that was a law been embedded

422
00:18:05,070 --> 00:18:08,790
within one of these scripts and there

423
00:18:06,840 --> 00:18:10,290
was a load of base64 encoded in and

424
00:18:08,790 --> 00:18:11,809
there was they were actually using a lot

425
00:18:10,290 --> 00:18:15,600
of the libraries that come of autohotkey

426
00:18:11,809 --> 00:18:16,980
to do all the obligation but essentially

427
00:18:15,600 --> 00:18:20,309
what it's actually looking for is a

428
00:18:16,980 --> 00:18:23,400
hard-coded paths to the dotnet framework

429
00:18:20,309 --> 00:18:25,799
folder within the windows directory and

430
00:18:23,400 --> 00:18:29,160
it's actually called calls out to a tool

431
00:18:25,799 --> 00:18:31,470
called reg ASM ISO reg ASM is assembly

432
00:18:29,160 --> 00:18:34,140
registration tool and it's basically

433
00:18:31,470 --> 00:18:36,630
used to compile dotnet framework type

434
00:18:34,140 --> 00:18:40,260
binaries effectively dotnet code right

435
00:18:36,630 --> 00:18:42,809
so once that reg ASM ran this particular

436
00:18:40,260 --> 00:18:44,610
code it was then it then kind of

437
00:18:42,809 --> 00:18:46,860
proceeded to the next stage which was to

438
00:18:44,610 --> 00:18:48,389
install the remote access Trojan and it

439
00:18:46,860 --> 00:18:50,610
in you know persisted through the

440
00:18:48,390 --> 00:18:54,480
registry and it set up a key logger and

441
00:18:50,610 --> 00:18:56,790
it was store in its own database in the

442
00:18:54,480 --> 00:18:59,460
temp directory for anything like copy

443
00:18:56,790 --> 00:19:01,918
and paste and anything copied or even

444
00:18:59,460 --> 00:19:03,870
typed from the user's end would be set

445
00:19:01,919 --> 00:19:06,919
would be saved cached and then sent back

446
00:19:03,870 --> 00:19:06,918
through the c2

447
00:19:08,080 --> 00:19:12,220
another one night I was looking at just

448
00:19:09,580 --> 00:19:13,720
about a month or so ago so sniff again

449
00:19:12,220 --> 00:19:16,030
isn't anything new it's been around for

450
00:19:13,720 --> 00:19:18,070
a long time it was formerly known as a

451
00:19:16,030 --> 00:19:20,350
different actor or group if you like

452
00:19:18,070 --> 00:19:22,030
behind it but the code the source code

453
00:19:20,350 --> 00:19:23,889
behind it got leaked and then it got

454
00:19:22,030 --> 00:19:26,440
forked and then it just became a sniff

455
00:19:23,890 --> 00:19:27,820
quite a few years ago but this has been

456
00:19:26,440 --> 00:19:30,190
doing the rounds for a long time and

457
00:19:27,820 --> 00:19:33,220
they're they're very much active that

458
00:19:30,190 --> 00:19:35,830
they're kind of up in their game all the

459
00:19:33,220 --> 00:19:38,020
time they have heavy Anton alysus which

460
00:19:35,830 --> 00:19:41,139
makes my job hard and they have rapidly

461
00:19:38,020 --> 00:19:43,360
change in c2s one particular day I was

462
00:19:41,140 --> 00:19:44,530
looking at a new sample that to the best

463
00:19:43,360 --> 00:19:47,469
of my knowledge no one else was looking

464
00:19:44,530 --> 00:19:48,960
out I was quickly able to get onto the

465
00:19:47,470 --> 00:19:50,860
admin dashboard of the situ

466
00:19:48,960 --> 00:19:53,230
unfortunately went offline very quickly

467
00:19:50,860 --> 00:19:56,040
but it's interesting to see obviously

468
00:19:53,230 --> 00:19:58,120
the the facilities behind the c2

469
00:19:56,040 --> 00:19:59,680
controller so obviously they've got a

470
00:19:58,120 --> 00:20:01,899
dashboard for their clients how many

471
00:19:59,680 --> 00:20:03,970
clients are infected probably us flavors

472
00:20:01,900 --> 00:20:05,290
the modules that they can load because

473
00:20:03,970 --> 00:20:08,140
banking Trojans are typically very

474
00:20:05,290 --> 00:20:10,149
modular obviously users so if they've

475
00:20:08,140 --> 00:20:11,950
got you know a team of people that need

476
00:20:10,150 --> 00:20:14,110
access to this admin console and

477
00:20:11,950 --> 00:20:16,210
probably other settings as well for FRA

478
00:20:14,110 --> 00:20:18,969
Toulon

479
00:20:16,210 --> 00:20:21,310
so again this particular sample so when

480
00:20:18,970 --> 00:20:23,320
the executable runs typically it will

481
00:20:21,310 --> 00:20:25,929
execute run deal of 32 which then

482
00:20:23,320 --> 00:20:27,939
executes CMD then PowerShell then CSC

483
00:20:25,930 --> 00:20:31,090
then CV Trez so I'm going to go into a

484
00:20:27,940 --> 00:20:33,520
bit of detail about that so run DLL 32

485
00:20:31,090 --> 00:20:36,159
so it's a legitimate process so it

486
00:20:33,520 --> 00:20:39,430
typically spawns you know exported or

487
00:20:36,160 --> 00:20:41,260
shared DLL is very very common what's

488
00:20:39,430 --> 00:20:44,230
not so common is when you see something

489
00:20:41,260 --> 00:20:47,080
like a shell exec run DLL highlighted in

490
00:20:44,230 --> 00:20:52,000
red so basically what that's doing is

491
00:20:47,080 --> 00:20:54,399
it's basically so it's kind of like a

492
00:20:52,000 --> 00:20:56,400
common way to kind of create a backdoor

493
00:20:54,400 --> 00:20:58,750
if you like through a PowerShell

494
00:20:56,400 --> 00:21:00,640
output and then kind of triggered

495
00:20:58,750 --> 00:21:01,840
through CMD but then indirectly through

496
00:21:00,640 --> 00:21:03,300
run DLL

497
00:21:01,840 --> 00:21:06,060
this is actually quite common for

498
00:21:03,300 --> 00:21:08,919
products like COBOL strike and

499
00:21:06,060 --> 00:21:11,169
PowerShell Empire as well but obviously

500
00:21:08,920 --> 00:21:13,300
if you you know again if you kind of are

501
00:21:11,170 --> 00:21:15,850
responsible for looking at your low bins

502
00:21:13,300 --> 00:21:17,560
in your estate then you know run DLL 32

503
00:21:15,850 --> 00:21:19,928
activity don't overlook it because you

504
00:21:17,560 --> 00:21:26,440
can obviously do a lot of damage so

505
00:21:19,929 --> 00:21:29,379
again attack ID run dll 32 next ones I

506
00:21:26,440 --> 00:21:32,440
mentioned was CSC and CV Trez so CSC is

507
00:21:29,379 --> 00:21:34,480
a is the c-sharp compiler so kind of

508
00:21:32,440 --> 00:21:36,820
similar to the Reg ASM that I mentioned

509
00:21:34,480 --> 00:21:39,999
so this is quite interesting so you see

510
00:21:36,820 --> 00:21:41,470
SCO exe and CB Trez dot exe CV Trez was

511
00:21:39,999 --> 00:21:44,259
actually not listed on the github page

512
00:21:41,470 --> 00:21:46,470
that I mentioned before so that's what

513
00:21:44,259 --> 00:21:48,460
prompted me to hook up with odd ver mo

514
00:21:46,470 --> 00:21:49,299
who's kind of looking into it as well

515
00:21:48,460 --> 00:21:52,389
with me at the moment

516
00:21:49,299 --> 00:21:55,779
but what's kind of interesting is again

517
00:21:52,389 --> 00:21:57,729
files were pulled down through a remote

518
00:21:55,779 --> 00:22:00,700
web server and then they're effectively

519
00:21:57,730 --> 00:22:03,399
built on the fly typically you know kind

520
00:22:00,700 --> 00:22:05,559
of unusual to be maybe not unusual but

521
00:22:03,399 --> 00:22:09,070
you know potentially to be building out

522
00:22:05,559 --> 00:22:11,740
and compiling you know dotnet code or

523
00:22:09,070 --> 00:22:13,658
c-sharp code from you know the windows

524
00:22:11,740 --> 00:22:15,490
temp folder that may or may not be

525
00:22:13,659 --> 00:22:16,539
usually in your environment but it's

526
00:22:15,490 --> 00:22:18,220
something to think about

527
00:22:16,539 --> 00:22:19,720
typically if you're a developer you

528
00:22:18,220 --> 00:22:21,340
might have Visual Studio you may have a

529
00:22:19,720 --> 00:22:22,840
path where you're going to save all your

530
00:22:21,340 --> 00:22:24,549
you know your projects and so on so

531
00:22:22,840 --> 00:22:26,860
again this isn't like a silver bullet

532
00:22:24,549 --> 00:22:28,629
but it's hopefully helpful forward to

533
00:22:26,860 --> 00:22:31,330
kind of see where malware and how

534
00:22:28,629 --> 00:22:33,100
malware is using the low bins and raises

535
00:22:31,330 --> 00:22:35,439
questions so kind of going back to the

536
00:22:33,100 --> 00:22:36,969
ransomware table that I produce you

537
00:22:35,440 --> 00:22:42,940
could produce something very similar as

538
00:22:36,970 --> 00:22:45,639
well and the last example is one that

539
00:22:42,940 --> 00:22:47,230
cropped up earlier this year so ash

540
00:22:45,639 --> 00:22:49,840
layer so this is something that got

541
00:22:47,230 --> 00:22:51,999
picked up around last year

542
00:22:49,840 --> 00:22:54,759
now our fret research team is kind of a

543
00:22:51,999 --> 00:22:57,820
funny story behind this so one of one of

544
00:22:54,759 --> 00:23:00,460
my colleagues is a very keen beer brewer

545
00:22:57,820 --> 00:23:02,289
and in the States and he was just kind

546
00:23:00,460 --> 00:23:04,600
of browsing around some forums and then

547
00:23:02,289 --> 00:23:06,610
on his Mac and he was presented with

548
00:23:04,600 --> 00:23:08,649
some but kind of obviously you know

549
00:23:06,610 --> 00:23:11,080
quite well kind of legitimate looking

550
00:23:08,649 --> 00:23:12,729
Adobe Flash Player update which

551
00:23:11,080 --> 00:23:14,889
obviously kind of saw it as a bit of a

552
00:23:12,730 --> 00:23:17,769
red flag and this is how we started

553
00:23:14,889 --> 00:23:19,990
tracking Slayer because actually turned

554
00:23:17,769 --> 00:23:23,350
out to be quite a relevant piece of map

555
00:23:19,990 --> 00:23:26,289
malware and how it works is essentially

556
00:23:23,350 --> 00:23:29,199
there's multiple hijack web servers

557
00:23:26,289 --> 00:23:31,359
servin up ads and fake Adobe installers

558
00:23:29,200 --> 00:23:31,840
and whatnot those become in different

559
00:23:31,359 --> 00:23:33,699
forms

560
00:23:31,840 --> 00:23:35,740
typically dmg files

561
00:23:33,700 --> 00:23:38,800
other files like zips and ISOs and

562
00:23:35,740 --> 00:23:40,990
package files and some of the samples

563
00:23:38,800 --> 00:23:44,020
not all would also include a crypto

564
00:23:40,990 --> 00:23:45,790
mining element to it as well but this

565
00:23:44,020 --> 00:23:47,290
particular campaign was quite

566
00:23:45,790 --> 00:23:49,420
interesting because it used multiple

567
00:23:47,290 --> 00:23:51,220
layers of obfuscation so it it would

568
00:23:49,420 --> 00:23:53,350
unpack and then it would create it

569
00:23:51,220 --> 00:23:55,120
whatever it unpacked into a hidden file

570
00:23:53,350 --> 00:23:58,570
then it would um download something else

571
00:23:55,120 --> 00:24:02,709
and and repeat and repeat interestingly

572
00:23:58,570 --> 00:24:04,780
these these particulars samples were

573
00:24:02,710 --> 00:24:07,570
also signed by Apple developer IDs like

574
00:24:04,780 --> 00:24:09,340
actual developer IDs so we got onto

575
00:24:07,570 --> 00:24:12,790
Apple and fortunately they got taken

576
00:24:09,340 --> 00:24:17,230
down but what's kind of relevant to this

577
00:24:12,790 --> 00:24:19,120
is a lot of the tools used mobin's also

578
00:24:17,230 --> 00:24:21,610
apply to mac as well so of course we

579
00:24:19,120 --> 00:24:24,719
mostly think about the windows world but

580
00:24:21,610 --> 00:24:27,580
you know xxd so this tool was used to

581
00:24:24,720 --> 00:24:29,410
you know perform the you know the attack

582
00:24:27,580 --> 00:24:31,389
and what the malware you know how the

583
00:24:29,410 --> 00:24:34,930
malware played out also you know open

584
00:24:31,390 --> 00:24:36,640
ssl users curl UID and there was also

585
00:24:34,930 --> 00:24:40,000
some other scripts as well called the

586
00:24:36,640 --> 00:24:42,010
security or trampoline which actually we

587
00:24:40,000 --> 00:24:44,530
had to reach out to miter attack for

588
00:24:42,010 --> 00:24:46,000
because there wasn't even a TTP for that

589
00:24:44,530 --> 00:24:48,010
because it was quite a new technique

590
00:24:46,000 --> 00:24:50,710
specifically targeting Mac's

591
00:24:48,010 --> 00:24:53,020
but kind of interesting because you know

592
00:24:50,710 --> 00:24:55,120
you don't always think about max or your

593
00:24:53,020 --> 00:24:56,379
Mac user estate but you know again

594
00:24:55,120 --> 00:24:58,989
looking being able to look at the

595
00:24:56,380 --> 00:25:00,430
behaviour kind of allows you to kind of

596
00:24:58,990 --> 00:25:02,320
start building questions of you know

597
00:25:00,430 --> 00:25:04,000
should again should that find out should

598
00:25:02,320 --> 00:25:06,970
that guy working in finance have access

599
00:25:04,000 --> 00:25:09,430
to xxd and should he be using it and so

600
00:25:06,970 --> 00:25:11,140
on so kind of similar scenario but

601
00:25:09,430 --> 00:25:13,600
rather than building a table you can

602
00:25:11,140 --> 00:25:16,270
start to use the attack navigator and

603
00:25:13,600 --> 00:25:19,179
actually start map into the different

604
00:25:16,270 --> 00:25:20,980
you know techniques so again you can

605
00:25:19,180 --> 00:25:22,420
even if you have no knowledge of Mac or

606
00:25:20,980 --> 00:25:24,700
even if you've got a small Mac estate

607
00:25:22,420 --> 00:25:27,490
you can use this information to start

608
00:25:24,700 --> 00:25:29,680
looking at perhaps the key columns on

609
00:25:27,490 --> 00:25:31,450
this table and then decide to you know

610
00:25:29,680 --> 00:25:33,490
maybe you want to focus in on script

611
00:25:31,450 --> 00:25:35,560
execution and Apple script or whatever

612
00:25:33,490 --> 00:25:37,330
the case may be you can use that

613
00:25:35,560 --> 00:25:38,980
approach you can use the table approach

614
00:25:37,330 --> 00:25:41,649
for the ransomware table that I showed

615
00:25:38,980 --> 00:25:44,650
you but the whole idea is don't

616
00:25:41,650 --> 00:25:46,720
underestimate the low bins they are

617
00:25:44,650 --> 00:25:47,799
being used all the time at least from

618
00:25:46,720 --> 00:25:50,440
what we're seeing

619
00:25:47,799 --> 00:25:51,970
and obviously you know mitre attack is

620
00:25:50,440 --> 00:25:55,210
your friend so if you haven't heard of

621
00:25:51,970 --> 00:25:56,679
it check it out and that brings me to

622
00:25:55,210 --> 00:26:00,249
the end of my talk so apologies for the

623
00:25:56,679 --> 00:26:01,929
technical problems we made it any

624
00:26:00,249 --> 00:26:05,580
questions if you don't want to ask me

625
00:26:01,929 --> 00:26:05,580
now feel free to grab me outside

626
00:26:06,620 --> 00:26:09,699
[Applause]

