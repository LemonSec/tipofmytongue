1
00:00:02,960 --> 00:00:07,279
uh welcome

2
00:00:03,840 --> 00:00:08,240
back everybody and hello uh roberto how

3
00:00:07,279 --> 00:00:10,639
are you today

4
00:00:08,240 --> 00:00:11,759
good good good how are you uh how are

5
00:00:10,639 --> 00:00:14,399
you can you hear me well

6
00:00:11,759 --> 00:00:17,840
yes absolutely very good very good so uh

7
00:00:14,400 --> 00:00:20,880
where have you flown in from

8
00:00:17,840 --> 00:00:23,519
okay uh so i'm from virginia from the us

9
00:00:20,880 --> 00:00:24,320
yeah and you're still in virginia from

10
00:00:23,519 --> 00:00:26,959
the us

11
00:00:24,320 --> 00:00:27,680
yeah yeah virginia from the us virginia

12
00:00:26,960 --> 00:00:30,480
um

13
00:00:27,680 --> 00:00:31,039
and kind of early i guess yeah for me a

14
00:00:30,480 --> 00:00:33,440
little bit

15
00:00:31,039 --> 00:00:35,600
i usually work late and you know wake up

16
00:00:33,440 --> 00:00:38,718
late but uh

17
00:00:35,600 --> 00:00:40,719
typical infrastruck hacker right

18
00:00:38,719 --> 00:00:41,840
yeah yeah but uh no thank you for the

19
00:00:40,719 --> 00:00:44,719
opportunity all

20
00:00:41,840 --> 00:00:46,320
you know everybody um in you know

21
00:00:44,719 --> 00:00:46,640
looking forward to talking about these

22
00:00:46,320 --> 00:00:49,280
uh

23
00:00:46,640 --> 00:00:51,120
you know projects as well so absolutely

24
00:00:49,280 --> 00:00:52,160
absolutely so please start to bring up

25
00:00:51,120 --> 00:00:54,800
your slides

26
00:00:52,160 --> 00:00:55,680
uh your talk is on um comprehensive

27
00:00:54,800 --> 00:00:58,160
cross-domain

28
00:00:55,680 --> 00:00:59,199
enterprise threat exposure no that was

29
00:00:58,160 --> 00:01:02,398
the last one

30
00:00:59,199 --> 00:01:04,640
sharing open data sets with the world to

31
00:01:02,399 --> 00:01:07,760
develop detections from home

32
00:01:04,640 --> 00:01:10,799
so there you go and you are

33
00:01:07,760 --> 00:01:12,560
up and running so roberto thank you and

34
00:01:10,799 --> 00:01:15,280
take it away please

35
00:01:12,560 --> 00:01:16,560
all right well thank you very much um

36
00:01:15,280 --> 00:01:18,799
well first of all

37
00:01:16,560 --> 00:01:19,600
you know thank you everybody for joining

38
00:01:18,799 --> 00:01:22,960
my talk

39
00:01:19,600 --> 00:01:24,240
and uh this is gonna be um a couple

40
00:01:22,960 --> 00:01:26,240
things talking about

41
00:01:24,240 --> 00:01:27,920
some projects but in general focusing

42
00:01:26,240 --> 00:01:29,439
only on on one

43
00:01:27,920 --> 00:01:32,000
which is uh something that has been

44
00:01:29,439 --> 00:01:34,559
helping me a lot to start doing research

45
00:01:32,000 --> 00:01:35,119
and this um you know first banner is

46
00:01:34,560 --> 00:01:37,680
pretty much

47
00:01:35,119 --> 00:01:38,720
a a community behind all these projects

48
00:01:37,680 --> 00:01:40,880
and it's something that i'm going to

49
00:01:38,720 --> 00:01:42,960
talk about also in a little bit

50
00:01:40,880 --> 00:01:44,880
and the talk today of course welcome to

51
00:01:42,960 --> 00:01:46,880
mordor i'm a big fan of a lot of the

52
00:01:44,880 --> 00:01:47,439
rings so that's why the name of the

53
00:01:46,880 --> 00:01:49,600
project

54
00:01:47,439 --> 00:01:50,960
and this is more related to how can we

55
00:01:49,600 --> 00:01:52,079
start sharing data sets with the

56
00:01:50,960 --> 00:01:53,919
community

57
00:01:52,079 --> 00:01:55,520
after emulating or simulating an

58
00:01:53,920 --> 00:01:56,799
adversary

59
00:01:55,520 --> 00:01:59,360
and once again my name is roberto

60
00:01:56,799 --> 00:02:00,880
rodriguez um i work for microsoft for

61
00:01:59,360 --> 00:02:01,679
the microsoft trading intelligence

62
00:02:00,880 --> 00:02:04,640
center team

63
00:02:01,680 --> 00:02:06,479
the mystic rnd team and i'm also the the

64
00:02:04,640 --> 00:02:08,639
founder of the otr community

65
00:02:06,479 --> 00:02:10,080
and also i love open source so there is

66
00:02:08,639 --> 00:02:11,359
a lot of projects that i have developed

67
00:02:10,080 --> 00:02:14,000
in the past couple years

68
00:02:11,360 --> 00:02:14,400
so if you are interested on some of them

69
00:02:14,000 --> 00:02:16,879
um

70
00:02:14,400 --> 00:02:17,840
some of them have twitter handles so you

71
00:02:16,879 --> 00:02:19,280
can just follow them

72
00:02:17,840 --> 00:02:21,040
and then you know we can start also

73
00:02:19,280 --> 00:02:22,959
having a conversation about those

74
00:02:21,040 --> 00:02:25,040
and my twitter handle is cyberward doc

75
00:02:22,959 --> 00:02:27,120
just in case um

76
00:02:25,040 --> 00:02:29,280
if you want to continue the conversation

77
00:02:27,120 --> 00:02:30,959
um in twitter as well

78
00:02:29,280 --> 00:02:32,560
and agenda for today is going to be

79
00:02:30,959 --> 00:02:36,160
talking about

80
00:02:32,560 --> 00:02:38,400
kind of the basic process of research

81
00:02:36,160 --> 00:02:40,319
and and how that translates into the

82
00:02:38,400 --> 00:02:41,840
need for data

83
00:02:40,319 --> 00:02:43,760
and then start talking about a little

84
00:02:41,840 --> 00:02:45,440
bit of these things that you can do in

85
00:02:43,760 --> 00:02:47,359
order to generate the data

86
00:02:45,440 --> 00:02:48,879
and then at the same time go over how

87
00:02:47,360 --> 00:02:50,319
this project started

88
00:02:48,879 --> 00:02:52,720
and what are the different things that

89
00:02:50,319 --> 00:02:54,799
you can do with it all the way to

90
00:02:52,720 --> 00:02:56,480
the couple things that you can do in the

91
00:02:54,800 --> 00:02:58,000
future as well with some of the things

92
00:02:56,480 --> 00:03:01,040
that are in the roadmap

93
00:02:58,000 --> 00:03:01,599
um so let's just start with the first

94
00:03:01,040 --> 00:03:03,519
part

95
00:03:01,599 --> 00:03:05,119
which is what triggers the detection

96
00:03:03,519 --> 00:03:07,200
research and this happens a lot

97
00:03:05,120 --> 00:03:09,120
especially from home right for those

98
00:03:07,200 --> 00:03:11,518
that are doing research from home

99
00:03:09,120 --> 00:03:12,239
besides what you do at work right

100
00:03:11,519 --> 00:03:13,680
because

101
00:03:12,239 --> 00:03:15,360
that's a little different sometimes

102
00:03:13,680 --> 00:03:16,640
because when you do research sometimes

103
00:03:15,360 --> 00:03:19,280
your organization

104
00:03:16,640 --> 00:03:21,040
will define some of that research right

105
00:03:19,280 --> 00:03:22,640
the specific research goal can be

106
00:03:21,040 --> 00:03:25,679
related to a specific

107
00:03:22,640 --> 00:03:27,518
for uh for example you know policy that

108
00:03:25,680 --> 00:03:30,720
just came out for your organization

109
00:03:27,519 --> 00:03:32,879
or it could be a specific environment

110
00:03:30,720 --> 00:03:34,879
that you need to focus on the most but

111
00:03:32,879 --> 00:03:37,359
in reality or for a lot of people

112
00:03:34,879 --> 00:03:38,720
it's pretty much researchers start from

113
00:03:37,360 --> 00:03:40,319
twitter right there is a lot of

114
00:03:38,720 --> 00:03:42,400
different things going on now

115
00:03:40,319 --> 00:03:43,760
um in the past two months there's been

116
00:03:42,400 --> 00:03:45,440
all the way from

117
00:03:43,760 --> 00:03:47,679
awesome lateral movement techniques

118
00:03:45,440 --> 00:03:48,480
being released by the mdseg labs um you

119
00:03:47,680 --> 00:03:50,799
know team

120
00:03:48,480 --> 00:03:51,518
um all the way to start also dropping a

121
00:03:50,799 --> 00:03:53,840
few

122
00:03:51,519 --> 00:03:55,519
um you know pocs like proof of concepts

123
00:03:53,840 --> 00:03:58,080
for a couple of cbes that also

124
00:03:55,519 --> 00:03:59,439
start popping out there so this is

125
00:03:58,080 --> 00:04:00,080
pretty much where i get a lot of my

126
00:03:59,439 --> 00:04:03,439
inspiration

127
00:04:00,080 --> 00:04:04,480
as well so if i were you you're not in

128
00:04:03,439 --> 00:04:06,239
twitter yet

129
00:04:04,480 --> 00:04:08,319
um i would highly recommend to join the

130
00:04:06,239 --> 00:04:10,319
community and start also trying to

131
00:04:08,319 --> 00:04:11,679
you know take all this research and

132
00:04:10,319 --> 00:04:14,159
start understanding it

133
00:04:11,680 --> 00:04:15,120
and you know so that you can apply your

134
00:04:14,159 --> 00:04:17,599
detection

135
00:04:15,120 --> 00:04:19,040
um approach as well so what can we do

136
00:04:17,600 --> 00:04:20,639
right first we consume that

137
00:04:19,040 --> 00:04:22,800
open intelligence and the first thing we

138
00:04:20,639 --> 00:04:24,479
do is start trying to google

139
00:04:22,800 --> 00:04:26,000
if there is any detections out there has

140
00:04:24,479 --> 00:04:29,199
anybody even written

141
00:04:26,000 --> 00:04:31,520
a um you know just an article or

142
00:04:29,199 --> 00:04:32,800
probably share the detection rule and

143
00:04:31,520 --> 00:04:34,080
then at the end of course you start

144
00:04:32,800 --> 00:04:36,240
thinking okay now

145
00:04:34,080 --> 00:04:38,080
if there is not much out there you know

146
00:04:36,240 --> 00:04:39,520
can i actually do it myself can i start

147
00:04:38,080 --> 00:04:40,080
replicating this and there's when you

148
00:04:39,520 --> 00:04:42,159
start

149
00:04:40,080 --> 00:04:44,159
you know google and also if there is a

150
00:04:42,160 --> 00:04:45,840
you know poc available

151
00:04:44,160 --> 00:04:47,520
and of course the next question is where

152
00:04:45,840 --> 00:04:49,359
i'm going to deploy this i'm going to do

153
00:04:47,520 --> 00:04:51,520
it on my local computer

154
00:04:49,360 --> 00:04:52,800
do i have to set up my own lab do i have

155
00:04:51,520 --> 00:04:55,120
to probably spawn

156
00:04:52,800 --> 00:04:56,400
more than one computer all those

157
00:04:55,120 --> 00:04:58,240
questions are valid

158
00:04:56,400 --> 00:04:59,758
right all those questions are valid and

159
00:04:58,240 --> 00:05:00,960
if you're realizing a little bit

160
00:04:59,759 --> 00:05:03,120
a lot of those questions are more

161
00:05:00,960 --> 00:05:04,320
related towards before you even start

162
00:05:03,120 --> 00:05:05,759
executing your research

163
00:05:04,320 --> 00:05:07,440
and you're not even getting to the

164
00:05:05,759 --> 00:05:10,320
detection piece yet

165
00:05:07,440 --> 00:05:11,280
and unconsciously right and you know

166
00:05:10,320 --> 00:05:12,960
indirectly

167
00:05:11,280 --> 00:05:14,400
you start creating this methodology in

168
00:05:12,960 --> 00:05:16,320
your on your own

169
00:05:14,400 --> 00:05:17,679
so i started doing the same um i started

170
00:05:16,320 --> 00:05:18,800
doing the same and i started putting

171
00:05:17,680 --> 00:05:21,840
together a couple of

172
00:05:18,800 --> 00:05:22,880
main steps um starting for example from

173
00:05:21,840 --> 00:05:25,520
my research goal

174
00:05:22,880 --> 00:05:26,960
right this specific tweet that i liked

175
00:05:25,520 --> 00:05:28,560
and it was very interesting and then

176
00:05:26,960 --> 00:05:30,239
there are not detections about

177
00:05:28,560 --> 00:05:33,039
and i go through this you know whole

178
00:05:30,240 --> 00:05:35,840
cycle now of course a lot of things

179
00:05:33,039 --> 00:05:37,280
um do not just go clockwise all the time

180
00:05:35,840 --> 00:05:39,119
right there's a couple of things as

181
00:05:37,280 --> 00:05:40,479
a couple of things that you will have to

182
00:05:39,120 --> 00:05:42,320
go back and

183
00:05:40,479 --> 00:05:44,000
start doing some of the you know

184
00:05:42,320 --> 00:05:45,440
feedback loop and trying to improve a

185
00:05:44,000 --> 00:05:47,039
couple of steps but

186
00:05:45,440 --> 00:05:48,560
behind this right because this is very

187
00:05:47,039 --> 00:05:52,080
high level and of course

188
00:05:48,560 --> 00:05:53,600
this is only you know one approach there

189
00:05:52,080 --> 00:05:55,840
there's a lot of approaches out there

190
00:05:53,600 --> 00:05:58,639
and and people also choose what they

191
00:05:55,840 --> 00:05:59,280
um like to do the most but for me i

192
00:05:58,639 --> 00:06:01,440
actually put

193
00:05:59,280 --> 00:06:03,679
a couple of other um you know steps in

194
00:06:01,440 --> 00:06:05,360
this specific basic methodology i was

195
00:06:03,680 --> 00:06:07,520
working with my brother on this

196
00:06:05,360 --> 00:06:09,680
um because we had a couple of ideas into

197
00:06:07,520 --> 00:06:11,919
what should we do next what can we add

198
00:06:09,680 --> 00:06:13,039
as a you know step that would allow us

199
00:06:11,919 --> 00:06:14,960
to improve the next

200
00:06:13,039 --> 00:06:16,960
step and then you know once again do

201
00:06:14,960 --> 00:06:18,239
this feedback loop across all these

202
00:06:16,960 --> 00:06:21,039
different steps

203
00:06:18,240 --> 00:06:23,120
but when we talk about um trying to

204
00:06:21,039 --> 00:06:25,280
understand the adversary

205
00:06:23,120 --> 00:06:27,120
besides doing a lot of the you know

206
00:06:25,280 --> 00:06:30,000
which is necessary a lot of the

207
00:06:27,120 --> 00:06:32,000
static analysis or basic and advanced

208
00:06:30,000 --> 00:06:33,360
dynamic analysis for example

209
00:06:32,000 --> 00:06:35,600
you start getting also into the part

210
00:06:33,360 --> 00:06:38,400
where you need to simulate it

211
00:06:35,600 --> 00:06:39,919
right and this is the part on that side

212
00:06:38,400 --> 00:06:41,120
of the methodology which we're going to

213
00:06:39,919 --> 00:06:43,520
focus you know today

214
00:06:41,120 --> 00:06:44,880
and and that part sometimes is where a

215
00:06:43,520 --> 00:06:47,280
lot of people actually get

216
00:06:44,880 --> 00:06:49,520
stuck especially from a detection side

217
00:06:47,280 --> 00:06:51,520
um not everybody has the expertise to

218
00:06:49,520 --> 00:06:53,440
actually go through all these and

219
00:06:51,520 --> 00:06:55,039
create their own tools their own pocs

220
00:06:53,440 --> 00:06:57,199
and execute a cbe

221
00:06:55,039 --> 00:06:59,199
just like that right so that's the p

222
00:06:57,199 --> 00:07:02,000
that's very important to understand

223
00:06:59,199 --> 00:07:03,120
where all these steps actually um fit in

224
00:07:02,000 --> 00:07:04,479
your methodologies

225
00:07:03,120 --> 00:07:06,000
so you can also probably start

226
00:07:04,479 --> 00:07:07,280
collaborating with other people that

227
00:07:06,000 --> 00:07:10,000
might have the skills

228
00:07:07,280 --> 00:07:11,599
to help you in those aspects so this

229
00:07:10,000 --> 00:07:14,319
takes us to the simulation part

230
00:07:11,599 --> 00:07:15,440
which as a basic strategy right you need

231
00:07:14,319 --> 00:07:16,960
to start

232
00:07:15,440 --> 00:07:18,160
exploring the tradecraft like you need

233
00:07:16,960 --> 00:07:18,960
to understand a little bit of the

234
00:07:18,160 --> 00:07:21,199
tradecraft

235
00:07:18,960 --> 00:07:23,280
the techniques behind it the procedures

236
00:07:21,199 --> 00:07:24,960
and tools probably being used out there

237
00:07:23,280 --> 00:07:26,880
you need to start you know creating your

238
00:07:24,960 --> 00:07:28,638
plan of simulation sometimes it could be

239
00:07:26,880 --> 00:07:30,880
as easy as running one command

240
00:07:28,639 --> 00:07:32,639
sometimes it could be it could be a

241
00:07:30,880 --> 00:07:34,479
couple commands could be a new script it

242
00:07:32,639 --> 00:07:36,000
could be a whole emulation plan

243
00:07:34,479 --> 00:07:37,599
and then you have to do this also

244
00:07:36,000 --> 00:07:38,639
feedback loop in order to start

245
00:07:37,599 --> 00:07:40,319
understanding

246
00:07:38,639 --> 00:07:42,240
what it is that you can do as well to

247
00:07:40,319 --> 00:07:43,120
enhance that environment that you're

248
00:07:42,240 --> 00:07:45,199
working with

249
00:07:43,120 --> 00:07:46,240
um it's not just enabling telemetry but

250
00:07:45,199 --> 00:07:48,319
it's actually

251
00:07:46,240 --> 00:07:49,520
creating more context around that

252
00:07:48,319 --> 00:07:51,199
telemetry um

253
00:07:49,520 --> 00:07:53,039
and and you know probably enabling a

254
00:07:51,199 --> 00:07:54,240
couple of other more configurations or

255
00:07:53,039 --> 00:07:58,000
probably adding

256
00:07:54,240 --> 00:08:00,400
more data sources um to you to your flow

257
00:07:58,000 --> 00:08:02,080
and then of course you know once you are

258
00:08:00,400 --> 00:08:02,960
close to a detection or you're feeling

259
00:08:02,080 --> 00:08:04,800
comfortable

260
00:08:02,960 --> 00:08:06,318
with some of them you know you know that

261
00:08:04,800 --> 00:08:08,720
needs to be documented somewhere

262
00:08:06,319 --> 00:08:10,720
right you either document it for your

263
00:08:08,720 --> 00:08:12,479
organization or you document it to share

264
00:08:10,720 --> 00:08:12,960
with the community so that's also up to

265
00:08:12,479 --> 00:08:14,479
you

266
00:08:12,960 --> 00:08:17,198
and something that i've been doing also

267
00:08:14,479 --> 00:08:18,960
a lot um is actually sharing as much as

268
00:08:17,199 --> 00:08:20,960
i can with the community

269
00:08:18,960 --> 00:08:23,359
but there's a lot of challenges and some

270
00:08:20,960 --> 00:08:25,359
of the challenges that i have identified

271
00:08:23,360 --> 00:08:27,199
it's a lot of time and technology

272
00:08:25,360 --> 00:08:29,599
constraints for example

273
00:08:27,199 --> 00:08:31,120
once again some of these might be very

274
00:08:29,599 --> 00:08:34,000
easy some of these

275
00:08:31,120 --> 00:08:36,640
simulations might take time for example

276
00:08:34,000 --> 00:08:39,279
from my experience i'm

277
00:08:36,640 --> 00:08:40,399
not doing a lot of the offensive

278
00:08:39,279 --> 00:08:43,039
research

279
00:08:40,399 --> 00:08:43,519
but i try to you know try to learn a

280
00:08:43,039 --> 00:08:45,279
little bit

281
00:08:43,519 --> 00:08:46,720
you know trying to learn what it is that

282
00:08:45,279 --> 00:08:47,360
i need to do in order to be more

283
00:08:46,720 --> 00:08:49,440
proficient

284
00:08:47,360 --> 00:08:50,560
in in that piece and start building my

285
00:08:49,440 --> 00:08:52,160
own tools as well

286
00:08:50,560 --> 00:08:53,839
but it takes time right you know for me

287
00:08:52,160 --> 00:08:54,079
sometimes it takes probably a week or

288
00:08:53,839 --> 00:08:56,480
two

289
00:08:54,080 --> 00:08:57,440
in order to get to a really good

290
00:08:56,480 --> 00:09:00,880
representation

291
00:08:57,440 --> 00:09:02,240
or or or a good proof of concept

292
00:09:00,880 --> 00:09:04,480
of a technique that was released

293
00:09:02,240 --> 00:09:06,399
recently right all the way also

294
00:09:04,480 --> 00:09:08,000
that goes along with expertise and of

295
00:09:06,399 --> 00:09:09,200
course you start thinking what it is

296
00:09:08,000 --> 00:09:11,360
that i need to collect

297
00:09:09,200 --> 00:09:12,880
once again it's not as easy as just

298
00:09:11,360 --> 00:09:13,600
running something and then expecting

299
00:09:12,880 --> 00:09:15,519
data to

300
00:09:13,600 --> 00:09:17,760
come out there needs to be a lot of

301
00:09:15,519 --> 00:09:19,360
different configurations around it um

302
00:09:17,760 --> 00:09:21,360
if you're dealing with a use case that

303
00:09:19,360 --> 00:09:23,279
you need to understand

304
00:09:21,360 --> 00:09:24,959
you know what specific actions of the

305
00:09:23,279 --> 00:09:26,800
adversary would trigger

306
00:09:24,959 --> 00:09:28,000
or potentially would trigger some of

307
00:09:26,800 --> 00:09:30,959
those

308
00:09:28,000 --> 00:09:32,399
some of those events so just to kind of

309
00:09:30,959 --> 00:09:36,000
get a few examples to

310
00:09:32,399 --> 00:09:38,560
tell you how also some of my days go

311
00:09:36,000 --> 00:09:39,920
i can go with the basic creation of a

312
00:09:38,560 --> 00:09:42,800
local user account

313
00:09:39,920 --> 00:09:43,599
all the way to for example um trying to

314
00:09:42,800 --> 00:09:46,319
replicate

315
00:09:43,600 --> 00:09:47,519
a specific dll hijack that was released

316
00:09:46,320 --> 00:09:49,040
in the community

317
00:09:47,519 --> 00:09:50,640
so from a local account perspective

318
00:09:49,040 --> 00:09:52,959
creation there is this project called

319
00:09:50,640 --> 00:09:54,160
atomic red team and they have a lot of

320
00:09:52,959 --> 00:09:57,439
different

321
00:09:54,160 --> 00:09:59,439
scripts that would allow you to um

322
00:09:57,440 --> 00:10:01,760
you know simulate that specific

323
00:09:59,440 --> 00:10:02,959
procedure as well within a specific tool

324
00:10:01,760 --> 00:10:03,680
and you'll be able to get an

325
00:10:02,959 --> 00:10:06,959
understanding

326
00:10:03,680 --> 00:10:08,319
into what these actions actually um what

327
00:10:06,959 --> 00:10:10,160
data actually

328
00:10:08,320 --> 00:10:11,760
uh um is kind of generated for these

329
00:10:10,160 --> 00:10:14,880
actions right and

330
00:10:11,760 --> 00:10:16,640
that's very easy usually you only need

331
00:10:14,880 --> 00:10:18,320
one computer to do that and you only

332
00:10:16,640 --> 00:10:21,760
need probably just one console

333
00:10:18,320 --> 00:10:23,760
you know command command and prompt um

334
00:10:21,760 --> 00:10:25,600
you know command prompt console you just

335
00:10:23,760 --> 00:10:27,760
run these specific uh

336
00:10:25,600 --> 00:10:29,120
specific commands and then you can just

337
00:10:27,760 --> 00:10:30,319
do this right

338
00:10:29,120 --> 00:10:32,240
but then when you start getting into

339
00:10:30,320 --> 00:10:32,880
this type of research where someone says

340
00:10:32,240 --> 00:10:34,959
hey i

341
00:10:32,880 --> 00:10:36,959
found a new lateral movement technique

342
00:10:34,959 --> 00:10:37,920
which involves for example like copying

343
00:10:36,959 --> 00:10:41,199
a dll

344
00:10:37,920 --> 00:10:42,640
um you know over smb and then also start

345
00:10:41,200 --> 00:10:45,120
interacting with the

346
00:10:42,640 --> 00:10:46,000
service control manager and then trying

347
00:10:45,120 --> 00:10:48,800
to

348
00:10:46,000 --> 00:10:49,839
query the service start it stop it and

349
00:10:48,800 --> 00:10:53,040
you know trying to

350
00:10:49,839 --> 00:10:54,560
to go through this process it is not

351
00:10:53,040 --> 00:10:57,199
that easy right

352
00:10:54,560 --> 00:10:58,319
sounds well for some people might sound

353
00:10:57,200 --> 00:11:01,279
very easy

354
00:10:58,320 --> 00:11:02,560
but for a lot of people this is not as

355
00:11:01,279 --> 00:11:04,399
pretty straightforward

356
00:11:02,560 --> 00:11:05,920
and just to give you an example right so

357
00:11:04,399 --> 00:11:08,560
the way how this works is that

358
00:11:05,920 --> 00:11:11,040
you have two computers and the adversary

359
00:11:08,560 --> 00:11:13,119
or the threat actor

360
00:11:11,040 --> 00:11:15,040
you know performs research before you're

361
00:11:13,120 --> 00:11:16,720
executing this of course and identifies

362
00:11:15,040 --> 00:11:17,519
that there is a vulnerable service that

363
00:11:16,720 --> 00:11:19,279
exists on

364
00:11:17,519 --> 00:11:20,560
any for example windows you know windows

365
00:11:19,279 --> 00:11:22,959
10 computer right

366
00:11:20,560 --> 00:11:24,399
so there is no need to create a new

367
00:11:22,959 --> 00:11:25,920
service in this case

368
00:11:24,399 --> 00:11:28,079
and then it starts interacting with this

369
00:11:25,920 --> 00:11:30,800
other computer um you know through rpc

370
00:11:28,079 --> 00:11:32,560
for example and it starts um you know

371
00:11:30,800 --> 00:11:35,359
getting a handle to the sem

372
00:11:32,560 --> 00:11:36,719
and trying to query the specific uh

373
00:11:35,360 --> 00:11:39,839
service that wants to

374
00:11:36,720 --> 00:11:42,000
um you know do the dll hijack for

375
00:11:39,839 --> 00:11:44,640
and then stops the service so you can do

376
00:11:42,000 --> 00:11:46,880
it with a control service rpc method

377
00:11:44,640 --> 00:11:48,240
and then you you know use the smb career

378
00:11:46,880 --> 00:11:50,639
request

379
00:11:48,240 --> 00:11:53,200
session in order to um you know copy

380
00:11:50,639 --> 00:11:55,760
that dll that the service is going to

381
00:11:53,200 --> 00:11:57,920
actually look for and execute and then

382
00:11:55,760 --> 00:12:00,800
at the end you start the service

383
00:11:57,920 --> 00:12:01,760
right so this can be done through a few

384
00:12:00,800 --> 00:12:03,199
commands

385
00:12:01,760 --> 00:12:05,040
it could be done through for example

386
00:12:03,200 --> 00:12:07,120
some scripting languages too

387
00:12:05,040 --> 00:12:08,639
um or you can just do directly you know

388
00:12:07,120 --> 00:12:10,320
pure directly pure pc

389
00:12:08,639 --> 00:12:12,800
through some other you know command line

390
00:12:10,320 --> 00:12:13,440
as well but then you start thinking okay

391
00:12:12,800 --> 00:12:14,719
this

392
00:12:13,440 --> 00:12:16,560
now that i understand a little bit

393
00:12:14,720 --> 00:12:18,079
what's going on so now i have a lot of

394
00:12:16,560 --> 00:12:19,199
questions right so what are the things

395
00:12:18,079 --> 00:12:21,439
that i need for each

396
00:12:19,200 --> 00:12:23,040
specific thing that is going on in here

397
00:12:21,440 --> 00:12:24,880
this is of course something that you can

398
00:12:23,040 --> 00:12:27,360
do prior to

399
00:12:24,880 --> 00:12:29,120
um you know prior to simulating all this

400
00:12:27,360 --> 00:12:31,360
because you by understanding the the

401
00:12:29,120 --> 00:12:33,600
tradecraft you can start understanding

402
00:12:31,360 --> 00:12:34,880
this uh specific model between an action

403
00:12:33,600 --> 00:12:38,000
of an adversary

404
00:12:34,880 --> 00:12:41,040
and also a specific event id for example

405
00:12:38,000 --> 00:12:41,680
but then you start asking what can i do

406
00:12:41,040 --> 00:12:43,760
from a

407
00:12:41,680 --> 00:12:45,519
service perspective what audit policies

408
00:12:43,760 --> 00:12:47,519
can i actually use to start

409
00:12:45,519 --> 00:12:48,880
you know monitoring my services and

410
00:12:47,519 --> 00:12:51,440
here's when you start

411
00:12:48,880 --> 00:12:52,320
doing some research for example on these

412
00:12:51,440 --> 00:12:55,360
systems uh

413
00:12:52,320 --> 00:12:56,720
system access control list cycles on the

414
00:12:55,360 --> 00:12:59,360
specific service

415
00:12:56,720 --> 00:13:00,800
or you can also create a cycle on the

416
00:12:59,360 --> 00:13:03,920
sem itself

417
00:13:00,800 --> 00:13:06,160
right then you might ask yourself why do

418
00:13:03,920 --> 00:13:08,079
i need to do that and why do i even care

419
00:13:06,160 --> 00:13:10,160
and what makes you even think that you

420
00:13:08,079 --> 00:13:12,800
need one or the other one

421
00:13:10,160 --> 00:13:13,839
is exactly why because in this case for

422
00:13:12,800 --> 00:13:15,839
example

423
00:13:13,839 --> 00:13:17,120
the blog post that was shared by the

424
00:13:15,839 --> 00:13:20,480
researcher dwight

425
00:13:17,120 --> 00:13:21,920
um that discovered this uh specific one

426
00:13:20,480 --> 00:13:23,680
a specific latter movement technique

427
00:13:21,920 --> 00:13:25,920
through dll hijacking

428
00:13:23,680 --> 00:13:26,959
was that instead of querying the service

429
00:13:25,920 --> 00:13:30,479
directly

430
00:13:26,959 --> 00:13:31,279
um he was using actually a different rpc

431
00:13:30,480 --> 00:13:34,560
method

432
00:13:31,279 --> 00:13:37,040
which interrogates the sem and asks

433
00:13:34,560 --> 00:13:38,638
about the status of all the services so

434
00:13:37,040 --> 00:13:41,839
it doesn't actually touch

435
00:13:38,639 --> 00:13:42,800
the service directly so if you create a

436
00:13:41,839 --> 00:13:46,000
rule

437
00:13:42,800 --> 00:13:47,599
on that specific vulnerable service so

438
00:13:46,000 --> 00:13:50,639
that if anybody touches it

439
00:13:47,600 --> 00:13:51,360
there is an event that happens well if

440
00:13:50,639 --> 00:13:53,920
you

441
00:13:51,360 --> 00:13:54,959
use a different method that event is not

442
00:13:53,920 --> 00:13:57,040
going to trigger

443
00:13:54,959 --> 00:13:58,479
so you need to also account through some

444
00:13:57,040 --> 00:14:01,360
of these also

445
00:13:58,480 --> 00:14:02,560
um you know variations of this technique

446
00:14:01,360 --> 00:14:04,079
and that just happens

447
00:14:02,560 --> 00:14:06,160
all the time right there's a lot of

448
00:14:04,079 --> 00:14:08,239
things that you will have to consider

449
00:14:06,160 --> 00:14:10,480
if you want to start building a

450
00:14:08,240 --> 00:14:12,000
detection around one specific procedure

451
00:14:10,480 --> 00:14:15,120
or you know technique

452
00:14:12,000 --> 00:14:16,079
so that was very interesting right um

453
00:14:15,120 --> 00:14:18,079
there's a lot of things that are

454
00:14:16,079 --> 00:14:18,800
happening here and just after telling

455
00:14:18,079 --> 00:14:22,079
you all this

456
00:14:18,800 --> 00:14:24,000
you are still in that section of a whole

457
00:14:22,079 --> 00:14:25,680
research methodology you're just kind of

458
00:14:24,000 --> 00:14:27,600
like trying to figure out

459
00:14:25,680 --> 00:14:28,880
how this is going to play out how i'm

460
00:14:27,600 --> 00:14:30,959
going to simulate it

461
00:14:28,880 --> 00:14:32,160
and actually what do i need in order to

462
00:14:30,959 --> 00:14:34,000
simulate um

463
00:14:32,160 --> 00:14:35,439
and also start getting the data from

464
00:14:34,000 --> 00:14:37,279
this environment

465
00:14:35,440 --> 00:14:39,279
this happens everywhere right everybody

466
00:14:37,279 --> 00:14:40,880
else is doing in a community in

467
00:14:39,279 --> 00:14:42,480
different countries i talk to people and

468
00:14:40,880 --> 00:14:44,480
they say yeah we do research

469
00:14:42,480 --> 00:14:46,480
the moment something happens in twitter

470
00:14:44,480 --> 00:14:48,079
uh we just start getting together and

471
00:14:46,480 --> 00:14:50,160
start trying to figure out

472
00:14:48,079 --> 00:14:51,279
how to how to replicate it and how to

473
00:14:50,160 --> 00:14:53,279
get data out of it

474
00:14:51,279 --> 00:14:55,680
right and of course some people are

475
00:14:53,279 --> 00:14:57,279
successful some teams some communities

476
00:14:55,680 --> 00:14:59,040
some organizations are successful they

477
00:14:57,279 --> 00:15:00,639
can just do it right away

478
00:14:59,040 --> 00:15:02,959
but the problem is that there's a lot of

479
00:15:00,639 --> 00:15:05,279
people that are not successful

480
00:15:02,959 --> 00:15:06,880
for example myself there's a lot of

481
00:15:05,279 --> 00:15:09,439
different techniques that get shared

482
00:15:06,880 --> 00:15:10,720
almost every day and i cannot replicate

483
00:15:09,440 --> 00:15:13,440
a lot of them

484
00:15:10,720 --> 00:15:14,880
and i actually uh collaborate with with

485
00:15:13,440 --> 00:15:16,480
other researchers that are you know

486
00:15:14,880 --> 00:15:19,279
great researchers out there

487
00:15:16,480 --> 00:15:21,040
that um you know help me with the pocs

488
00:15:19,279 --> 00:15:24,959
for example like how can we build

489
00:15:21,040 --> 00:15:27,279
a specific dll that will for example

490
00:15:24,959 --> 00:15:29,040
spawn on the thread of a process or

491
00:15:27,279 --> 00:15:30,880
probably create another process

492
00:15:29,040 --> 00:15:32,639
and then inject code and then create a

493
00:15:30,880 --> 00:15:34,480
thread to execute code

494
00:15:32,639 --> 00:15:36,160
so how can we start you know building

495
00:15:34,480 --> 00:15:38,959
all those things right so

496
00:15:36,160 --> 00:15:40,160
that's to me was you know very

497
00:15:38,959 --> 00:15:42,000
interesting because when you start

498
00:15:40,160 --> 00:15:44,000
thinking about

499
00:15:42,000 --> 00:15:46,160
why don't we just start sharing some of

500
00:15:44,000 --> 00:15:49,120
this data that we're generating

501
00:15:46,160 --> 00:15:50,880
right if it took me a week to figure out

502
00:15:49,120 --> 00:15:52,160
how to do for example this like lateral

503
00:15:50,880 --> 00:15:55,759
movement technique

504
00:15:52,160 --> 00:15:57,759
um why can i just you know collect data

505
00:15:55,759 --> 00:15:59,519
after doing my research of course right

506
00:15:57,759 --> 00:16:01,680
understanding what do i need

507
00:15:59,519 --> 00:16:04,240
for example i talked about a little bit

508
00:16:01,680 --> 00:16:05,758
um these audit rules and services

509
00:16:04,240 --> 00:16:08,000
and then i can share that with somebody

510
00:16:05,759 --> 00:16:10,720
else right and then this person

511
00:16:08,000 --> 00:16:11,839
um or whoever i'm sharing this with in

512
00:16:10,720 --> 00:16:13,600
the community

513
00:16:11,839 --> 00:16:15,040
they might be more proficient on the

514
00:16:13,600 --> 00:16:17,279
data analysis piece

515
00:16:15,040 --> 00:16:18,079
right we have to find understand

516
00:16:17,279 --> 00:16:20,399
identify

517
00:16:18,079 --> 00:16:21,680
our strengths right where we're actually

518
00:16:20,399 --> 00:16:23,839
good at and that's

519
00:16:21,680 --> 00:16:25,120
good because sometimes you might think

520
00:16:23,839 --> 00:16:28,399
that because you're not

521
00:16:25,120 --> 00:16:29,839
good at let's say the simulation step

522
00:16:28,399 --> 00:16:31,920
you might just get stuck in there and

523
00:16:29,839 --> 00:16:33,839
you might think i'm not doing as much

524
00:16:31,920 --> 00:16:35,519
and i feel uncomfortable like you know

525
00:16:33,839 --> 00:16:38,560
like this is some something that i don't

526
00:16:35,519 --> 00:16:40,240
you know something i don't like right um

527
00:16:38,560 --> 00:16:42,239
yeah but in reality you're really good

528
00:16:40,240 --> 00:16:43,600
at the other steps so to me it's like

529
00:16:42,240 --> 00:16:45,680
how can we empower

530
00:16:43,600 --> 00:16:47,680
other people in the community that have

531
00:16:45,680 --> 00:16:48,800
um skills as well in other parts of the

532
00:16:47,680 --> 00:16:50,959
methodology

533
00:16:48,800 --> 00:16:52,319
just by sharing the data and that's

534
00:16:50,959 --> 00:16:55,359
pretty much where

535
00:16:52,320 --> 00:16:57,839
the project mortador started and the

536
00:16:55,360 --> 00:16:58,639
project mordor is just a repository of

537
00:16:57,839 --> 00:17:01,440
data sets

538
00:16:58,639 --> 00:17:03,440
that um are shared after you know

539
00:17:01,440 --> 00:17:04,959
simulating an adversary in a specific

540
00:17:03,440 --> 00:17:06,959
technique or procedure

541
00:17:04,959 --> 00:17:08,559
and everything is in json format and the

542
00:17:06,959 --> 00:17:10,640
reason why i'm sharing everything in

543
00:17:08,559 --> 00:17:11,280
json is because i believe that it's a

544
00:17:10,640 --> 00:17:15,439
more

545
00:17:11,280 --> 00:17:17,918
portable easier to use

546
00:17:15,439 --> 00:17:19,839
you know type of data or specific you

547
00:17:17,919 --> 00:17:22,240
know file that i could use for example

548
00:17:19,839 --> 00:17:24,240
with with python i can use it with

549
00:17:22,240 --> 00:17:26,720
powershell or i can just integrate it

550
00:17:24,240 --> 00:17:29,840
with other sims for example i can throw

551
00:17:26,720 --> 00:17:30,320
a json file to a data pipeline directly

552
00:17:29,840 --> 00:17:31,678
and

553
00:17:30,320 --> 00:17:34,159
and that could make it all the way to my

554
00:17:31,679 --> 00:17:34,960
sim so that was the idea a little bit

555
00:17:34,160 --> 00:17:37,120
and also

556
00:17:34,960 --> 00:17:39,120
i started categorizing all this by the

557
00:17:37,120 --> 00:17:41,360
mitre attack framework like specific

558
00:17:39,120 --> 00:17:43,199
tactics and techniques and all that

559
00:17:41,360 --> 00:17:45,280
and also something that also

560
00:17:43,200 --> 00:17:46,640
differentiates this project from other

561
00:17:45,280 --> 00:17:49,200
projects

562
00:17:46,640 --> 00:17:50,320
is the mordor project also generates

563
00:17:49,200 --> 00:17:53,600
atomic samples

564
00:17:50,320 --> 00:17:54,240
a specific data set for specific actions

565
00:17:53,600 --> 00:17:56,799
just

566
00:17:54,240 --> 00:17:58,000
like the ones that i just showed you a

567
00:17:56,799 --> 00:18:00,559
couple minutes ago

568
00:17:58,000 --> 00:18:02,559
and then also we cover large data sets

569
00:18:00,559 --> 00:18:04,399
so data sets that are created after

570
00:18:02,559 --> 00:18:06,639
simulating a whole campaign

571
00:18:04,400 --> 00:18:07,919
not just one atomic behavior but

572
00:18:06,640 --> 00:18:09,520
actually multiple

573
00:18:07,919 --> 00:18:10,880
multiple atomic behaviors and i'm going

574
00:18:09,520 --> 00:18:11,600
to explain to you what that actually

575
00:18:10,880 --> 00:18:14,720
means and

576
00:18:11,600 --> 00:18:16,240
and how it's being done so at the end of

577
00:18:14,720 --> 00:18:16,799
the day with the mordo data set for

578
00:18:16,240 --> 00:18:18,880
example

579
00:18:16,799 --> 00:18:20,720
my brother it's over there at the bottom

580
00:18:18,880 --> 00:18:24,240
uh his name is jose

581
00:18:20,720 --> 00:18:26,320
and his handle is cyber cyber panda h

582
00:18:24,240 --> 00:18:27,600
um just in case you're gonna follow him

583
00:18:26,320 --> 00:18:29,439
and uh

584
00:18:27,600 --> 00:18:30,959
the awesome thing about this project is

585
00:18:29,440 --> 00:18:33,440
that this also started

586
00:18:30,960 --> 00:18:35,360
with with us helping each other it it

587
00:18:33,440 --> 00:18:37,120
started by me saying hey i have this

588
00:18:35,360 --> 00:18:38,559
data set and you're actually good at

589
00:18:37,120 --> 00:18:40,559
analyzing data

590
00:18:38,559 --> 00:18:42,799
um because his background is more from

591
00:18:40,559 --> 00:18:46,240
the data analysis data science

592
00:18:42,799 --> 00:18:48,799
aspect of infosec um so

593
00:18:46,240 --> 00:18:50,240
for him it was very easy just to say hey

594
00:18:48,799 --> 00:18:52,559
can you just send me the data set and i

595
00:18:50,240 --> 00:18:54,720
can start building probably some

596
00:18:52,559 --> 00:18:56,399
detection rules or i can probably import

597
00:18:54,720 --> 00:18:58,320
that into a jupiter notebook

598
00:18:56,400 --> 00:19:01,200
and i can start analyzing the data just

599
00:18:58,320 --> 00:19:03,600
exploring the events that were collected

600
00:19:01,200 --> 00:19:05,520
after simulating on a specific technique

601
00:19:03,600 --> 00:19:07,439
so that was very helpful and that was

602
00:19:05,520 --> 00:19:09,918
also the inspiration to help

603
00:19:07,440 --> 00:19:11,679
others in the community the immortal

604
00:19:09,919 --> 00:19:12,559
data set if you go to that website

605
00:19:11,679 --> 00:19:15,679
you're gonna

606
00:19:12,559 --> 00:19:17,440
have pretty much on the left all the the

607
00:19:15,679 --> 00:19:19,919
specific data sets that we have

608
00:19:17,440 --> 00:19:22,320
for a specific platform and then i also

609
00:19:19,919 --> 00:19:23,919
have this um

610
00:19:22,320 --> 00:19:26,000
what's it called attack navigator view

611
00:19:23,919 --> 00:19:28,880
where you can see just some of the

612
00:19:26,000 --> 00:19:30,720
the things that the data sets cover um i

613
00:19:28,880 --> 00:19:33,200
focus a lot on a specific technique so

614
00:19:30,720 --> 00:19:34,960
you will see a lot of procedures under

615
00:19:33,200 --> 00:19:35,520
one technique so don't get scared if you

616
00:19:34,960 --> 00:19:38,080
only see

617
00:19:35,520 --> 00:19:38,879
six or seven or let's say 10 things

618
00:19:38,080 --> 00:19:40,559
highlighting

619
00:19:38,880 --> 00:19:42,559
there's a lot of things under those

620
00:19:40,559 --> 00:19:44,720
techniques as well

621
00:19:42,559 --> 00:19:45,600
and i'm kind of showing the example that

622
00:19:44,720 --> 00:19:48,080
i talked about

623
00:19:45,600 --> 00:19:49,918
a couple minutes ago about dll hijacking

624
00:19:48,080 --> 00:19:50,960
so there is the link at the bottom and

625
00:19:49,919 --> 00:19:53,440
you can see

626
00:19:50,960 --> 00:19:55,520
pretty much how it was done that also is

627
00:19:53,440 --> 00:19:56,880
part of the project so if you contribute

628
00:19:55,520 --> 00:19:58,720
on a specific data set

629
00:19:56,880 --> 00:20:00,160
i would love to know how you actually

630
00:19:58,720 --> 00:20:02,960
get the data set

631
00:20:00,160 --> 00:20:04,400
so that you can just add more context to

632
00:20:02,960 --> 00:20:06,480
someone that is actually

633
00:20:04,400 --> 00:20:07,919
using it and consuming it for me that's

634
00:20:06,480 --> 00:20:10,320
very important

635
00:20:07,919 --> 00:20:11,760
having metadata about data sets beyond

636
00:20:10,320 --> 00:20:14,480
just event logs

637
00:20:11,760 --> 00:20:15,440
um it is crucial for somebody to to kind

638
00:20:14,480 --> 00:20:17,440
of like

639
00:20:15,440 --> 00:20:19,520
get familiarized with what's going on

640
00:20:17,440 --> 00:20:21,120
and also trying to understand

641
00:20:19,520 --> 00:20:23,440
a little bit more of the tradecraft

642
00:20:21,120 --> 00:20:25,039
without executing it

643
00:20:23,440 --> 00:20:26,880
and at the end i also provide a little

644
00:20:25,039 --> 00:20:27,520
table of all the events that were

645
00:20:26,880 --> 00:20:29,520
generated

646
00:20:27,520 --> 00:20:31,440
in that period of time now something

647
00:20:29,520 --> 00:20:33,120
that you might have noticed already is

648
00:20:31,440 --> 00:20:36,799
that you might be asking yourself

649
00:20:33,120 --> 00:20:38,799
why not share only the events that

650
00:20:36,799 --> 00:20:40,639
are actually related to that technique

651
00:20:38,799 --> 00:20:41,600
why do you have to share a whole period

652
00:20:40,640 --> 00:20:43,520
of time

653
00:20:41,600 --> 00:20:46,719
and to me it's because there is a lot of

654
00:20:43,520 --> 00:20:49,280
rules out there that if you only give it

655
00:20:46,720 --> 00:20:50,320
for example one event let's say event id

656
00:20:49,280 --> 00:20:52,000
one

657
00:20:50,320 --> 00:20:53,678
and you say look for this specific

658
00:20:52,000 --> 00:20:55,360
command line for example

659
00:20:53,679 --> 00:20:57,760
but that command line is also executed

660
00:20:55,360 --> 00:21:00,479
by other processes and you need to have

661
00:20:57,760 --> 00:21:02,320
that extra noise on the top of that if

662
00:21:00,480 --> 00:21:04,559
you want to actually have some type of

663
00:21:02,320 --> 00:21:06,399
validation going on as well

664
00:21:04,559 --> 00:21:07,760
it doesn't occur of course in every

665
00:21:06,400 --> 00:21:09,679
single data set where you're going to

666
00:21:07,760 --> 00:21:11,440
have some potential false positives but

667
00:21:09,679 --> 00:21:13,919
i've seen data sets where

668
00:21:11,440 --> 00:21:15,760
even though i say oh this query is very

669
00:21:13,919 --> 00:21:17,600
good for this specific technique

670
00:21:15,760 --> 00:21:20,720
and then i apply it to my data set and i

671
00:21:17,600 --> 00:21:23,520
have more than 20 or 30 events

672
00:21:20,720 --> 00:21:25,679
that occur so that allows me to to see

673
00:21:23,520 --> 00:21:27,039
what context can i add to my query in

674
00:21:25,679 --> 00:21:29,520
order to improve it

675
00:21:27,039 --> 00:21:31,919
so having a data set with more context

676
00:21:29,520 --> 00:21:34,720
allows me to also have

677
00:21:31,919 --> 00:21:36,320
you know create you know better queries

678
00:21:34,720 --> 00:21:38,240
and also enhance my queries

679
00:21:36,320 --> 00:21:41,360
and also have the opportunity to join a

680
00:21:38,240 --> 00:21:42,960
couple of data sets at the same time

681
00:21:41,360 --> 00:21:44,639
now some of the environments that this

682
00:21:42,960 --> 00:21:47,600
project comes with

683
00:21:44,640 --> 00:21:49,520
and and you know exactly you know what

684
00:21:47,600 --> 00:21:51,600
you can do with those

685
00:21:49,520 --> 00:21:54,480
there is a strategy for mordor and there

686
00:21:51,600 --> 00:21:58,080
is two things that we have identified

687
00:21:54,480 --> 00:21:59,919
works and i think it depends on on

688
00:21:58,080 --> 00:22:01,280
how much time you want to spend actually

689
00:21:59,919 --> 00:22:03,520
creating a data set

690
00:22:01,280 --> 00:22:04,799
and how quick and you know how quick you

691
00:22:03,520 --> 00:22:05,600
just want to share something with the

692
00:22:04,799 --> 00:22:08,000
community

693
00:22:05,600 --> 00:22:08,799
so the first one is um you know having

694
00:22:08,000 --> 00:22:10,640
your own

695
00:22:08,799 --> 00:22:12,480
local computer or it could be a virtual

696
00:22:10,640 --> 00:22:14,159
machine or or it could just be one

697
00:22:12,480 --> 00:22:16,000
machine in the cloud but i assume that a

698
00:22:14,159 --> 00:22:17,840
lot of people have their

699
00:22:16,000 --> 00:22:20,480
labs in their own computers with like

700
00:22:17,840 --> 00:22:22,158
specific programs like virtualbox or or

701
00:22:20,480 --> 00:22:24,400
you know vmware

702
00:22:22,159 --> 00:22:26,000
and in in that scenario i believe that

703
00:22:24,400 --> 00:22:28,080
you can also get the data out of

704
00:22:26,000 --> 00:22:29,520
it directly and i put together a

705
00:22:28,080 --> 00:22:30,720
powershell script which i'm going to

706
00:22:29,520 --> 00:22:32,960
show in a little bit

707
00:22:30,720 --> 00:22:34,000
and with that one you can easily point

708
00:22:32,960 --> 00:22:36,000
to a couple of

709
00:22:34,000 --> 00:22:38,400
uh a couple of event providers like

710
00:22:36,000 --> 00:22:40,400
sysmon like security application

711
00:22:38,400 --> 00:22:42,320
system and you can just pack all the

712
00:22:40,400 --> 00:22:45,840
data that happen

713
00:22:42,320 --> 00:22:47,120
right after you execute a technique and

714
00:22:45,840 --> 00:22:49,520
and you can pretty much collect that

715
00:22:47,120 --> 00:22:50,399
data then share it with the community as

716
00:22:49,520 --> 00:22:52,799
well

717
00:22:50,400 --> 00:22:55,440
the other uh strategy is actually using

718
00:22:52,799 --> 00:22:56,960
a bigger environment

719
00:22:55,440 --> 00:22:58,880
and when i say bigger i don't mean

720
00:22:56,960 --> 00:23:00,720
hundreds of computers i mean probably

721
00:22:58,880 --> 00:23:02,960
two or three computers

722
00:23:00,720 --> 00:23:04,559
some techniques require more than one

723
00:23:02,960 --> 00:23:05,440
computer like for example lateral

724
00:23:04,559 --> 00:23:06,879
movement

725
00:23:05,440 --> 00:23:09,360
and of course if you're if you're in a

726
00:23:06,880 --> 00:23:11,360
domain environment you need to have

727
00:23:09,360 --> 00:23:14,399
also a domain controller if you want to

728
00:23:11,360 --> 00:23:16,719
also capture some of that data

729
00:23:14,400 --> 00:23:18,000
so talking about local computers uh this

730
00:23:16,720 --> 00:23:19,760
is pretty much what i would do

731
00:23:18,000 --> 00:23:21,520
i would just you know download this

732
00:23:19,760 --> 00:23:22,000
script and of course you're going to

733
00:23:21,520 --> 00:23:24,400
have

734
00:23:22,000 --> 00:23:25,120
um you know the slides later but if you

735
00:23:24,400 --> 00:23:27,679
go to the

736
00:23:25,120 --> 00:23:28,559
github ot rf as you can see in the link

737
00:23:27,679 --> 00:23:31,919
at the bottom

738
00:23:28,559 --> 00:23:32,639
mordor and you go to scripts you'll be

739
00:23:31,919 --> 00:23:34,799
able to see

740
00:23:32,640 --> 00:23:37,200
that script over there so you download

741
00:23:34,799 --> 00:23:39,679
and you look into your local computer

742
00:23:37,200 --> 00:23:40,320
you import that specific module or that

743
00:23:39,679 --> 00:23:44,240
specific

744
00:23:40,320 --> 00:23:44,559
um script and then um you can first you

745
00:23:44,240 --> 00:23:48,000
know

746
00:23:44,559 --> 00:23:49,840
clear the vm providers that you have so

747
00:23:48,000 --> 00:23:51,039
pretty much before you want to execute

748
00:23:49,840 --> 00:23:54,000
something simple

749
00:23:51,039 --> 00:23:54,320
clear your event providers run your exec

750
00:23:54,000 --> 00:23:56,480
or

751
00:23:54,320 --> 00:23:57,760
specific techniques or one command or a

752
00:23:56,480 --> 00:24:00,240
couple of commands

753
00:23:57,760 --> 00:24:01,200
and then you can run the last step which

754
00:24:00,240 --> 00:24:03,279
is going to grab

755
00:24:01,200 --> 00:24:04,640
all these event providers and it's going

756
00:24:03,279 --> 00:24:07,600
to use powershell to

757
00:24:04,640 --> 00:24:08,480
grab that data you know parse the xml

758
00:24:07,600 --> 00:24:11,678
out of it

759
00:24:08,480 --> 00:24:13,919
and then create a json uh create an

760
00:24:11,679 --> 00:24:16,559
array with a couple of json objects

761
00:24:13,919 --> 00:24:18,880
and then it's going to merge all those

762
00:24:16,559 --> 00:24:21,678
in those event providers into one array

763
00:24:18,880 --> 00:24:25,039
and then just copy that to a json file

764
00:24:21,679 --> 00:24:27,039
i i find that very easy to do

765
00:24:25,039 --> 00:24:28,960
and pretty straightforward and once

766
00:24:27,039 --> 00:24:30,080
again i don't want to collect only one

767
00:24:28,960 --> 00:24:32,080
event provider

768
00:24:30,080 --> 00:24:34,000
i want to collect more than one at least

769
00:24:32,080 --> 00:24:35,199
you know security and sysmon is pretty

770
00:24:34,000 --> 00:24:37,120
good because you can have

771
00:24:35,200 --> 00:24:38,880
events also that are not created in

772
00:24:37,120 --> 00:24:42,639
sysmon that might be

773
00:24:38,880 --> 00:24:44,000
good context for your detections

774
00:24:42,640 --> 00:24:45,600
the other case and i'm going to show an

775
00:24:44,000 --> 00:24:46,880
example in a little bit so don't think

776
00:24:45,600 --> 00:24:48,080
that that's just

777
00:24:46,880 --> 00:24:50,240
it right i'm going to show you a little

778
00:24:48,080 --> 00:24:52,559
bit how i actually did one

779
00:24:50,240 --> 00:24:54,320
and then the other one is a couple

780
00:24:52,559 --> 00:24:55,840
environments as code and here's where it

781
00:24:54,320 --> 00:24:58,158
starts getting

782
00:24:55,840 --> 00:25:00,000
not complex well complex for me because

783
00:24:58,159 --> 00:25:01,840
i have to figure out all these different

784
00:25:00,000 --> 00:25:03,200
pieces together so i can just share

785
00:25:01,840 --> 00:25:05,439
everything to you

786
00:25:03,200 --> 00:25:06,320
um with you but there's a couple of

787
00:25:05,440 --> 00:25:09,360
things going on

788
00:25:06,320 --> 00:25:10,960
so blacksmith is a project as well part

789
00:25:09,360 --> 00:25:12,959
of the community that i'm part of

790
00:25:10,960 --> 00:25:14,159
the otr community the open third

791
00:25:12,960 --> 00:25:17,279
research community

792
00:25:14,159 --> 00:25:17,520
and blacksmith only has configurations

793
00:25:17,279 --> 00:25:20,640
and

794
00:25:17,520 --> 00:25:24,000
scripts that can be reused anywhere else

795
00:25:20,640 --> 00:25:26,000
for example if i have a sysmon config

796
00:25:24,000 --> 00:25:28,240
and i want to create five to six

797
00:25:26,000 --> 00:25:30,400
environments with the same config

798
00:25:28,240 --> 00:25:31,840
why would i copy the config six times

799
00:25:30,400 --> 00:25:33,600
and if i want to update

800
00:25:31,840 --> 00:25:35,600
the configs i have to update it in six

801
00:25:33,600 --> 00:25:36,240
different places so blacksmith for me is

802
00:25:35,600 --> 00:25:38,559
more

803
00:25:36,240 --> 00:25:40,480
a centralized repository for a lot of

804
00:25:38,559 --> 00:25:42,799
scripts a lot of configurations

805
00:25:40,480 --> 00:25:45,039
and that i can reuse them somewhere else

806
00:25:42,799 --> 00:25:47,840
simulan is another project which what it

807
00:25:45,039 --> 00:25:50,158
does it actually creates environments

808
00:25:47,840 --> 00:25:50,959
through templates that have a specific

809
00:25:50,159 --> 00:25:54,080
purpose

810
00:25:50,960 --> 00:25:55,520
so think about um you know every time we

811
00:25:54,080 --> 00:25:58,720
say for example

812
00:25:55,520 --> 00:26:01,279
um the emulation plan right i have an

813
00:25:58,720 --> 00:26:03,520
emulation plan for apt-29 for example

814
00:26:01,279 --> 00:26:05,440
but the plan usually is

815
00:26:03,520 --> 00:26:06,720
commands right there's a couple commands

816
00:26:05,440 --> 00:26:09,760
a couple of payloads

817
00:26:06,720 --> 00:26:10,960
that you can use think about simulan as

818
00:26:09,760 --> 00:26:12,960
the

819
00:26:10,960 --> 00:26:14,720
emulation plan but from an

820
00:26:12,960 --> 00:26:16,559
infrastructure perspective like

821
00:26:14,720 --> 00:26:19,360
everything that you need to deploy in

822
00:26:16,559 --> 00:26:22,240
order to execute that specific plan

823
00:26:19,360 --> 00:26:22,559
and then at the end um mordor is pretty

824
00:26:22,240 --> 00:26:24,320
much

825
00:26:22,559 --> 00:26:25,760
just waiting for the data to be

826
00:26:24,320 --> 00:26:27,840
generated by

827
00:26:25,760 --> 00:26:30,640
environments like simulink and then

828
00:26:27,840 --> 00:26:32,559
could be shared to the model project

829
00:26:30,640 --> 00:26:34,799
so talking about simulant a little bit

830
00:26:32,559 --> 00:26:36,960
once again it's just a combination of

831
00:26:34,799 --> 00:26:38,720
of cloud templates and scripts as well

832
00:26:36,960 --> 00:26:39,440
that are grabbed from the blacksmith

833
00:26:38,720 --> 00:26:42,000
project

834
00:26:39,440 --> 00:26:44,320
and there are just pretty much um you

835
00:26:42,000 --> 00:26:47,200
know being put together to make sense

836
00:26:44,320 --> 00:26:47,840
and to you know kind of like replicate a

837
00:26:47,200 --> 00:26:50,640
little bit

838
00:26:47,840 --> 00:26:52,158
what a potential apt did right because a

839
00:26:50,640 --> 00:26:54,720
lot of the emulation plans

840
00:26:52,159 --> 00:26:56,320
are actually based on open um you know

841
00:26:54,720 --> 00:26:57,679
open thread intelligence so you know

842
00:26:56,320 --> 00:26:59,918
we're just working with open thread

843
00:26:57,679 --> 00:27:02,000
intelligence that does not mean 100

844
00:26:59,919 --> 00:27:03,120
that that's what they did but you know

845
00:27:02,000 --> 00:27:06,240
we're just doing

846
00:27:03,120 --> 00:27:09,279
working with community resources as well

847
00:27:06,240 --> 00:27:11,360
so the next one um it's it well

848
00:27:09,279 --> 00:27:13,120
some of the environments in simulink for

849
00:27:11,360 --> 00:27:15,678
example i talk about one which is

850
00:27:13,120 --> 00:27:16,399
the the attack evaluations environment

851
00:27:15,679 --> 00:27:18,000
and that one

852
00:27:16,400 --> 00:27:20,720
pretty much follows the attack

853
00:27:18,000 --> 00:27:22,960
evaluations program where they actually

854
00:27:20,720 --> 00:27:24,880
assess a lot of ebr solutions

855
00:27:22,960 --> 00:27:26,720
and they share their emulation plan so

856
00:27:24,880 --> 00:27:27,520
what i do is i just take that emulation

857
00:27:26,720 --> 00:27:29,840
plan

858
00:27:27,520 --> 00:27:30,559
create the environment and then execute

859
00:27:29,840 --> 00:27:33,199
it and collect

860
00:27:30,559 --> 00:27:34,158
data the other one that we have is cloud

861
00:27:33,200 --> 00:27:36,960
bridge s3

862
00:27:34,159 --> 00:27:38,159
so this is just a basic scenario which

863
00:27:36,960 --> 00:27:41,360
would allow me to cover

864
00:27:38,159 --> 00:27:42,399
potential uh techniques where s3 buckets

865
00:27:41,360 --> 00:27:44,559
are involved

866
00:27:42,399 --> 00:27:46,080
and i have the difference with this

867
00:27:44,559 --> 00:27:48,158
environment and other

868
00:27:46,080 --> 00:27:50,000
cloud environments is that the

869
00:27:48,159 --> 00:27:52,559
environments that i create

870
00:27:50,000 --> 00:27:53,919
do have a data pipeline attached to it

871
00:27:52,559 --> 00:27:55,440
which means that

872
00:27:53,919 --> 00:27:56,880
i'm not just attacking the environment

873
00:27:55,440 --> 00:27:59,120
usually when you see an environment out

874
00:27:56,880 --> 00:28:01,679
there being released by somebody to

875
00:27:59,120 --> 00:28:03,360
to use for you know practicing a couple

876
00:28:01,679 --> 00:28:05,039
of adversary techniques

877
00:28:03,360 --> 00:28:06,399
it's only to attack the environment but

878
00:28:05,039 --> 00:28:09,039
there is not a

879
00:28:06,399 --> 00:28:11,039
a concept of okay so i'm attacking the

880
00:28:09,039 --> 00:28:13,679
environment what data is being generated

881
00:28:11,039 --> 00:28:15,440
right so this environment actually

882
00:28:13,679 --> 00:28:16,080
enables like cloud trail logs for

883
00:28:15,440 --> 00:28:18,480
example

884
00:28:16,080 --> 00:28:19,600
and and they're pushed to lock stash and

885
00:28:18,480 --> 00:28:23,120
then are pushed to

886
00:28:19,600 --> 00:28:25,039
um you know to a kafka server it's just

887
00:28:23,120 --> 00:28:26,719
a server that allows me to centralize my

888
00:28:25,039 --> 00:28:29,200
data and then from there i can just

889
00:28:26,720 --> 00:28:31,360
take it out and then we have also the

890
00:28:29,200 --> 00:28:32,480
shire and the shire is just a windows

891
00:28:31,360 --> 00:28:35,279
environment

892
00:28:32,480 --> 00:28:38,480
which is trying to replicate i would say

893
00:28:35,279 --> 00:28:40,399
like a very very small environment

894
00:28:38,480 --> 00:28:42,159
but the good thing about that the shower

895
00:28:40,399 --> 00:28:44,080
is that it's very modular so you can

896
00:28:42,159 --> 00:28:45,120
actually deploy only one computer one

897
00:28:44,080 --> 00:28:47,520
domain controller

898
00:28:45,120 --> 00:28:48,479
and then a couple of things more that

899
00:28:47,520 --> 00:28:50,320
will allow you to

900
00:28:48,480 --> 00:28:52,320
you know get the data out and then push

901
00:28:50,320 --> 00:28:53,600
it out for example

902
00:28:52,320 --> 00:28:55,760
and if we want to talk about a little

903
00:28:53,600 --> 00:28:57,760
bit this environment once again

904
00:28:55,760 --> 00:29:00,000
all this is deployed by the azure

905
00:28:57,760 --> 00:29:03,120
resource manager services

906
00:29:00,000 --> 00:29:03,120
this just allows me to

907
00:29:03,200 --> 00:29:06,960
share a template with a community the

908
00:29:05,360 --> 00:29:08,959
community can just click on it

909
00:29:06,960 --> 00:29:10,960
and that just gets sent to azure and

910
00:29:08,960 --> 00:29:12,480
then gets deployed in azure and then you

911
00:29:10,960 --> 00:29:15,440
can use it directly

912
00:29:12,480 --> 00:29:17,120
um i was thinking on doing some you know

913
00:29:15,440 --> 00:29:19,919
some terraform

914
00:29:17,120 --> 00:29:20,799
but to be honest i'm very busy with a

915
00:29:19,919 --> 00:29:22,480
lot of

916
00:29:20,799 --> 00:29:24,240
a lot of things going on too with a lot

917
00:29:22,480 --> 00:29:25,679
of different projects that i rather just

918
00:29:24,240 --> 00:29:27,760
focus on one thing

919
00:29:25,679 --> 00:29:29,840
and then um you know try to understand

920
00:29:27,760 --> 00:29:32,240
also the the ins and outs of like

921
00:29:29,840 --> 00:29:33,678
new apis and things that are coming out

922
00:29:32,240 --> 00:29:35,039
like you know almost every month and

923
00:29:33,679 --> 00:29:36,640
it's like a new feature so

924
00:29:35,039 --> 00:29:38,080
i'd rather just not wait for other

925
00:29:36,640 --> 00:29:40,960
features to be enabled and just

926
00:29:38,080 --> 00:29:41,840
start using this thing directly so the

927
00:29:40,960 --> 00:29:44,559
data collection

928
00:29:41,840 --> 00:29:46,000
from the shire is pretty straightforward

929
00:29:44,559 --> 00:29:49,440
and there's just a couple of things

930
00:29:46,000 --> 00:29:51,679
that of course might be a little

931
00:29:49,440 --> 00:29:52,799
different from what you probably would

932
00:29:51,679 --> 00:29:54,320
like to do

933
00:29:52,799 --> 00:29:56,240
but in this case we're using windows

934
00:29:54,320 --> 00:29:56,799
event forwarding from every single

935
00:29:56,240 --> 00:29:58,799
computer

936
00:29:56,799 --> 00:30:01,360
in this environment and then push it to

937
00:29:58,799 --> 00:30:03,600
a a windows event collector

938
00:30:01,360 --> 00:30:04,399
now all the policies all the windows

939
00:30:03,600 --> 00:30:07,199
event

940
00:30:04,399 --> 00:30:08,080
um you know the web configs for example

941
00:30:07,200 --> 00:30:10,159
all those configs

942
00:30:08,080 --> 00:30:11,918
are in blacksmith so you can just grab

943
00:30:10,159 --> 00:30:13,760
them from there and then you'll be able

944
00:30:11,919 --> 00:30:15,360
to see exactly what are the specific

945
00:30:13,760 --> 00:30:17,520
things that we're collecting

946
00:30:15,360 --> 00:30:18,559
all the data gets sent to the windows

947
00:30:17,520 --> 00:30:20,399
event collector

948
00:30:18,559 --> 00:30:22,000
and then we have nx log you know

949
00:30:20,399 --> 00:30:24,000
community edition sending data

950
00:30:22,000 --> 00:30:25,600
to logstash and then logstash

951
00:30:24,000 --> 00:30:26,000
automatically sends it to something

952
00:30:25,600 --> 00:30:28,559
called an

953
00:30:26,000 --> 00:30:30,480
azure event hub and then from there i

954
00:30:28,559 --> 00:30:31,039
can just pull it out directly and then

955
00:30:30,480 --> 00:30:34,080
just

956
00:30:31,039 --> 00:30:35,200
you know push it to my repository so as

957
00:30:34,080 --> 00:30:38,080
you can see there is like

958
00:30:35,200 --> 00:30:40,240
you know two different scenarios right a

959
00:30:38,080 --> 00:30:42,000
local scenario that you can use

960
00:30:40,240 --> 00:30:43,919
and then you can also use this other

961
00:30:42,000 --> 00:30:46,080
infrastructure so it would depend

962
00:30:43,919 --> 00:30:47,360
also on how complex you want your

963
00:30:46,080 --> 00:30:49,199
scenario to be

964
00:30:47,360 --> 00:30:51,039
and i assume that a lot of people will

965
00:30:49,200 --> 00:30:53,440
start with the basic powershell

966
00:30:51,039 --> 00:30:55,039
script on their own vms but just to let

967
00:30:53,440 --> 00:30:57,679
you know there is also environments

968
00:30:55,039 --> 00:30:59,519
available that you can use

969
00:30:57,679 --> 00:31:01,679
so once again that's just the flow

970
00:30:59,519 --> 00:31:05,919
that's pretty much how things will go

971
00:31:01,679 --> 00:31:07,840
if i try to create something in simulink

972
00:31:05,919 --> 00:31:09,600
and as i mentioned before all the audio

973
00:31:07,840 --> 00:31:11,360
policies um all the

974
00:31:09,600 --> 00:31:12,639
for example like powershell logging how

975
00:31:11,360 --> 00:31:14,399
do i enable all that

976
00:31:12,640 --> 00:31:16,080
it's it's in blacksmith so so you

977
00:31:14,399 --> 00:31:18,399
understand what data

978
00:31:16,080 --> 00:31:19,519
is actually being created and how is it

979
00:31:18,399 --> 00:31:21,678
being created

980
00:31:19,519 --> 00:31:23,360
so if i were you and if you want to

981
00:31:21,679 --> 00:31:25,679
contribute something from your own

982
00:31:23,360 --> 00:31:27,760
vm i would definitely you know take a

983
00:31:25,679 --> 00:31:29,600
look at these configurations and see

984
00:31:27,760 --> 00:31:31,679
what we are considering good

985
00:31:29,600 --> 00:31:33,360
configurations to enable telemetry

986
00:31:31,679 --> 00:31:35,760
right because you don't just want to

987
00:31:33,360 --> 00:31:37,120
start a fresh windows 10 computer and

988
00:31:35,760 --> 00:31:39,519
then say

989
00:31:37,120 --> 00:31:40,239
run my attack and then expect something

990
00:31:39,519 --> 00:31:42,880
to happen

991
00:31:40,240 --> 00:31:44,840
right so um there will be some configs

992
00:31:42,880 --> 00:31:46,240
that will allow you to have some more

993
00:31:44,840 --> 00:31:48,799
telemetry

994
00:31:46,240 --> 00:31:50,559
then we get to the cycle right so this

995
00:31:48,799 --> 00:31:52,158
is also something that gets applied into

996
00:31:50,559 --> 00:31:54,559
the data sets of mordor

997
00:31:52,159 --> 00:31:56,000
so i have a a project with a lot of

998
00:31:54,559 --> 00:31:59,440
different cycles

999
00:31:56,000 --> 00:32:00,480
and this gets applied to every single

1000
00:31:59,440 --> 00:32:03,360
computer

1001
00:32:00,480 --> 00:32:04,880
um on the model environments so once

1002
00:32:03,360 --> 00:32:08,320
again if i were you

1003
00:32:04,880 --> 00:32:09,840
and i am uh documenting my own vm

1004
00:32:08,320 --> 00:32:11,519
i would definitely take a look at those

1005
00:32:09,840 --> 00:32:12,480
uh scripts as well that one in

1006
00:32:11,519 --> 00:32:15,600
particular

1007
00:32:12,480 --> 00:32:17,360
uh pretty much are rules that allows you

1008
00:32:15,600 --> 00:32:20,639
to track when somebody

1009
00:32:17,360 --> 00:32:23,039
queries for example um yeah queries

1010
00:32:20,640 --> 00:32:24,640
those values like those register keys

1011
00:32:23,039 --> 00:32:25,679
and you know for those that are not

1012
00:32:24,640 --> 00:32:27,840
familiar with those

1013
00:32:25,679 --> 00:32:29,039
uh keys those are the keys that would

1014
00:32:27,840 --> 00:32:31,760
allow you to

1015
00:32:29,039 --> 00:32:32,158
um to actually calculate the key a cis

1016
00:32:31,760 --> 00:32:35,039
key

1017
00:32:32,159 --> 00:32:37,200
to to access the uh for example sam

1018
00:32:35,039 --> 00:32:39,039
database right the same file

1019
00:32:37,200 --> 00:32:41,840
so you need to have that c key in order

1020
00:32:39,039 --> 00:32:42,720
to access that and also decrypt the

1021
00:32:41,840 --> 00:32:44,959
contents of that

1022
00:32:42,720 --> 00:32:46,080
and try to get information like hashes

1023
00:32:44,960 --> 00:32:48,480
so those

1024
00:32:46,080 --> 00:32:49,840
registry keys for example are not being

1025
00:32:48,480 --> 00:32:53,039
audited by default

1026
00:32:49,840 --> 00:32:53,760
right but if you audit those it might be

1027
00:32:53,039 --> 00:32:55,760
an interesting

1028
00:32:53,760 --> 00:32:57,919
um you know exercise for you as well to

1029
00:32:55,760 --> 00:32:58,559
know what processes are constantly

1030
00:32:57,919 --> 00:33:01,279
querying those

1031
00:32:58,559 --> 00:33:02,799
those things so as you can see there is

1032
00:33:01,279 --> 00:33:06,000
research behind

1033
00:33:02,799 --> 00:33:07,039
the telemetry decisions and that's

1034
00:33:06,000 --> 00:33:09,039
something that

1035
00:33:07,039 --> 00:33:11,279
uh you could definitely also use on your

1036
00:33:09,039 --> 00:33:13,039
own vm as well

1037
00:33:11,279 --> 00:33:14,320
and as i mentioned before there is also

1038
00:33:13,039 --> 00:33:16,399
cycles and services

1039
00:33:14,320 --> 00:33:17,439
and this is very interesting because if

1040
00:33:16,399 --> 00:33:18,080
you're not doing this in your

1041
00:33:17,440 --> 00:33:19,760
environment

1042
00:33:18,080 --> 00:33:21,120
i would i would highly recommend you

1043
00:33:19,760 --> 00:33:24,879
know for you

1044
00:33:21,120 --> 00:33:27,199
to do it um uh for example like in the

1045
00:33:24,880 --> 00:33:29,600
dll hijack example

1046
00:33:27,200 --> 00:33:30,799
the service that was vulnerable and the

1047
00:33:29,600 --> 00:33:33,439
service that

1048
00:33:30,799 --> 00:33:34,799
dwight was talking about it was the ikea

1049
00:33:33,440 --> 00:33:36,880
ext

1050
00:33:34,799 --> 00:33:38,480
so what i did is i just enabled this

1051
00:33:36,880 --> 00:33:40,640
audit policy and as you can see

1052
00:33:38,480 --> 00:33:42,720
some of the commands in there i just

1053
00:33:40,640 --> 00:33:46,720
grabbed that service and i apply

1054
00:33:42,720 --> 00:33:50,000
a i just added this entry

1055
00:33:46,720 --> 00:33:52,399
on the specific access control list and

1056
00:33:50,000 --> 00:33:54,159
i also do it for ac manager once again

1057
00:33:52,399 --> 00:33:57,120
because i also want to track uh

1058
00:33:54,159 --> 00:33:58,720
you know who is doing what now you might

1059
00:33:57,120 --> 00:33:59,918
be asking yourself okay but i don't

1060
00:33:58,720 --> 00:34:02,640
understand what this

1061
00:33:59,919 --> 00:34:04,559
uh things mean right and believe me it

1062
00:34:02,640 --> 00:34:06,080
took me a while also to

1063
00:34:04,559 --> 00:34:08,000
you know to figure out like how i'm

1064
00:34:06,080 --> 00:34:08,879
going to be uh playing with these

1065
00:34:08,000 --> 00:34:11,918
settings

1066
00:34:08,879 --> 00:34:14,879
so i also give some of these uh strings

1067
00:34:11,918 --> 00:34:16,158
on the configurations for mordor and as

1068
00:34:14,879 --> 00:34:17,279
you can see like there is a couple of

1069
00:34:16,159 --> 00:34:19,359
things that are

1070
00:34:17,280 --> 00:34:20,720
you know related to services so i want

1071
00:34:19,359 --> 00:34:23,199
to track when a service

1072
00:34:20,719 --> 00:34:25,678
starts when a service stops and you know

1073
00:34:23,199 --> 00:34:27,598
it's query and all the stuff

1074
00:34:25,679 --> 00:34:28,800
the interesting thing about this uh

1075
00:34:27,599 --> 00:34:31,280
cycle for a service

1076
00:34:28,800 --> 00:34:33,280
or for example for sem is that at the

1077
00:34:31,280 --> 00:34:36,879
bottom you can see that there is this

1078
00:34:33,280 --> 00:34:39,520
wd and nu stuff

1079
00:34:36,879 --> 00:34:40,480
if you track the nu like if you you know

1080
00:34:39,520 --> 00:34:42,159
set up the

1081
00:34:40,480 --> 00:34:44,879
the specific accounts that you want to

1082
00:34:42,159 --> 00:34:46,720
track and and you set it to nu

1083
00:34:44,879 --> 00:34:48,560
that's going to track um all these

1084
00:34:46,719 --> 00:34:50,480
accounts that are coming from you know

1085
00:34:48,560 --> 00:34:52,960
over the network so if somebody is

1086
00:34:50,480 --> 00:34:54,960
querying your sc manager for example

1087
00:34:52,960 --> 00:34:56,879
um you know over the network you know

1088
00:34:54,960 --> 00:34:58,960
remotely from another computer

1089
00:34:56,879 --> 00:35:00,560
potential lateral movement exploration

1090
00:34:58,960 --> 00:35:02,079
probably um

1091
00:35:00,560 --> 00:35:04,799
that's a very interesting use case

1092
00:35:02,079 --> 00:35:06,800
because it would be nice to to know

1093
00:35:04,800 --> 00:35:07,839
who is querying or who is touching the

1094
00:35:06,800 --> 00:35:10,000
sc manager

1095
00:35:07,839 --> 00:35:11,440
overall remotely not locally because

1096
00:35:10,000 --> 00:35:13,920
that happens a lot

1097
00:35:11,440 --> 00:35:15,599
locally right but if you set it to to

1098
00:35:13,920 --> 00:35:16,560
end you you'll be able to capture that

1099
00:35:15,599 --> 00:35:18,800
telemetry

1100
00:35:16,560 --> 00:35:19,680
so that's also another you know data

1101
00:35:18,800 --> 00:35:21,760
point that is

1102
00:35:19,680 --> 00:35:22,799
very interesting and actually a lot of

1103
00:35:21,760 --> 00:35:25,520
organizations

1104
00:35:22,800 --> 00:35:26,800
um have talked about it how they can

1105
00:35:25,520 --> 00:35:28,800
leverage sa manager

1106
00:35:26,800 --> 00:35:30,079
telemetry for example and that's just

1107
00:35:28,800 --> 00:35:32,079
one example that gets applied

1108
00:35:30,079 --> 00:35:33,599
to also you know the model environments

1109
00:35:32,079 --> 00:35:35,119
you know the ones that are deployed as

1110
00:35:33,599 --> 00:35:36,800
code

1111
00:35:35,119 --> 00:35:38,240
and once again the configurations are

1112
00:35:36,800 --> 00:35:39,119
there so you can just take a look at

1113
00:35:38,240 --> 00:35:41,118
them

1114
00:35:39,119 --> 00:35:42,480
and you know those are what they look

1115
00:35:41,119 --> 00:35:45,119
like

1116
00:35:42,480 --> 00:35:46,400
and pretty much we haven't sent as much

1117
00:35:45,119 --> 00:35:48,480
yet you know we just kind of like

1118
00:35:46,400 --> 00:35:50,160
collected the data configure it

1119
00:35:48,480 --> 00:35:52,800
but then we have to you know send the

1120
00:35:50,160 --> 00:35:55,520
data out and of course once again

1121
00:35:52,800 --> 00:35:56,000
the destination is an azure event hub

1122
00:35:55,520 --> 00:35:57,920
and

1123
00:35:56,000 --> 00:35:59,359
you can see all the configurations also

1124
00:35:57,920 --> 00:36:01,200
in the environment so so

1125
00:35:59,359 --> 00:36:02,880
you know of course you know if we talk

1126
00:36:01,200 --> 00:36:04,000
about every single configuration

1127
00:36:02,880 --> 00:36:06,240
we might go through the whole

1128
00:36:04,000 --> 00:36:08,079
presentation but at the end the idea

1129
00:36:06,240 --> 00:36:10,160
like this image is is very interesting

1130
00:36:08,079 --> 00:36:12,160
because you're pretty much seeing

1131
00:36:10,160 --> 00:36:13,520
the amount of data that can be flowing

1132
00:36:12,160 --> 00:36:16,240
in real time

1133
00:36:13,520 --> 00:36:17,599
and data that you can start collecting

1134
00:36:16,240 --> 00:36:19,598
and at the end of the day i use this

1135
00:36:17,599 --> 00:36:20,800
tool called kafkacat in order to collect

1136
00:36:19,599 --> 00:36:23,040
that data

1137
00:36:20,800 --> 00:36:25,280
and that too pretty much what it does it

1138
00:36:23,040 --> 00:36:27,599
just connects to the hub

1139
00:36:25,280 --> 00:36:28,880
grabs the data and then pushes it to a

1140
00:36:27,599 --> 00:36:31,200
json file

1141
00:36:28,880 --> 00:36:32,079
nothing complex like if you actually go

1142
00:36:31,200 --> 00:36:33,598
and read about it

1143
00:36:32,079 --> 00:36:35,280
it's pretty straightforward and it's

1144
00:36:33,599 --> 00:36:38,800
just a client that you can use

1145
00:36:35,280 --> 00:36:42,000
to gather data so one quick example

1146
00:36:38,800 --> 00:36:44,400
is this one uh

1147
00:36:42,000 --> 00:36:46,000
there you go oh let me just click in

1148
00:36:44,400 --> 00:36:49,040
here sorry

1149
00:36:46,000 --> 00:36:50,000
i was clicking on the on the on the

1150
00:36:49,040 --> 00:36:51,520
other screen

1151
00:36:50,000 --> 00:36:53,760
so as you can see on the left we have

1152
00:36:51,520 --> 00:36:55,680
already a compromised computer

1153
00:36:53,760 --> 00:36:57,119
but on the right we can run the the

1154
00:36:55,680 --> 00:36:59,200
specific command

1155
00:36:57,119 --> 00:37:01,119
and and you can see there is just data

1156
00:36:59,200 --> 00:37:02,799
flowing and this is just like real time

1157
00:37:01,119 --> 00:37:03,920
like this is data being collected from

1158
00:37:02,800 --> 00:37:06,240
the pipeline

1159
00:37:03,920 --> 00:37:08,160
and it's just data that i can start

1160
00:37:06,240 --> 00:37:10,240
pushing somewhere

1161
00:37:08,160 --> 00:37:11,359
once again if you do it locally it's

1162
00:37:10,240 --> 00:37:14,000
pretty straightforward

1163
00:37:11,359 --> 00:37:15,200
too but if you want to also capture it

1164
00:37:14,000 --> 00:37:16,960
in a pipeline mode

1165
00:37:15,200 --> 00:37:19,520
that's the way how you know i would do

1166
00:37:16,960 --> 00:37:23,680
it for sure

1167
00:37:19,520 --> 00:37:25,920
so let me just move to these

1168
00:37:23,680 --> 00:37:27,520
here so the other one was just another

1169
00:37:25,920 --> 00:37:29,280
example um

1170
00:37:27,520 --> 00:37:31,040
you know it's pretty much the same but

1171
00:37:29,280 --> 00:37:32,880
it's just pushing it to a file

1172
00:37:31,040 --> 00:37:34,560
and you know which is making sure that

1173
00:37:32,880 --> 00:37:37,200
i'm uh

1174
00:37:34,560 --> 00:37:38,720
you know looking at the time as well but

1175
00:37:37,200 --> 00:37:40,560
in this one for example a lot of people

1176
00:37:38,720 --> 00:37:44,078
are asking me what about network data

1177
00:37:40,560 --> 00:37:46,160
what about pickups and i actually use um

1178
00:37:44,079 --> 00:37:48,800
network shell on every single computer

1179
00:37:46,160 --> 00:37:50,640
that i want to collect data from as well

1180
00:37:48,800 --> 00:37:53,280
this scenario is when you want to do it

1181
00:37:50,640 --> 00:37:55,440
for example locally on your own vm

1182
00:37:53,280 --> 00:37:56,800
if you want to contribute pcaps to motor

1183
00:37:55,440 --> 00:37:59,599
this is something that you can use

1184
00:37:56,800 --> 00:38:00,480
in order to get the data um you know

1185
00:37:59,599 --> 00:38:02,079
that pcap

1186
00:38:00,480 --> 00:38:05,040
actually the moment you do something

1187
00:38:02,079 --> 00:38:07,520
that will um you know flow through your

1188
00:38:05,040 --> 00:38:08,640
uh you know flow through your nick for

1189
00:38:07,520 --> 00:38:10,240
example

1190
00:38:08,640 --> 00:38:12,480
if you do a lateral movement technique

1191
00:38:10,240 --> 00:38:14,720
it would be nice to capture the pickup

1192
00:38:12,480 --> 00:38:16,480
the network traffic in a pickup for

1193
00:38:14,720 --> 00:38:19,118
example so you can use that command

1194
00:38:16,480 --> 00:38:21,599
if you want to contribute a pcap you

1195
00:38:19,119 --> 00:38:23,680
know for the model project

1196
00:38:21,599 --> 00:38:26,079
so at the end of the day you have to use

1197
00:38:23,680 --> 00:38:28,960
another tool which is called the etl

1198
00:38:26,079 --> 00:38:31,680
2 pickup ng and then that's going to

1199
00:38:28,960 --> 00:38:34,720
point to the etl file that gets created

1200
00:38:31,680 --> 00:38:36,078
after using network shell and then

1201
00:38:34,720 --> 00:38:36,720
that's going to give you a big gap that

1202
00:38:36,079 --> 00:38:38,800
you can just

1203
00:38:36,720 --> 00:38:40,720
start seeing in word shark or that you

1204
00:38:38,800 --> 00:38:41,599
can contribute directly to the modal

1205
00:38:40,720 --> 00:38:43,680
project

1206
00:38:41,599 --> 00:38:45,599
so if i were you and you're trying to

1207
00:38:43,680 --> 00:38:48,319
contribute to a project as well

1208
00:38:45,599 --> 00:38:50,320
and you have a vm and it's easy for you

1209
00:38:48,320 --> 00:38:52,400
to execute something

1210
00:38:50,320 --> 00:38:54,240
that might make a network connection and

1211
00:38:52,400 --> 00:38:55,760
you want to share that data just you

1212
00:38:54,240 --> 00:38:57,040
know run those two commands and then

1213
00:38:55,760 --> 00:39:00,240
you'll be able to

1214
00:38:57,040 --> 00:39:01,279
share that data there's another option

1215
00:39:00,240 --> 00:39:02,959
too through azure

1216
00:39:01,280 --> 00:39:04,400
and this is something that you can just

1217
00:39:02,960 --> 00:39:06,560
also read about uh

1218
00:39:04,400 --> 00:39:07,440
more in the link below but that's just

1219
00:39:06,560 --> 00:39:10,720
something called

1220
00:39:07,440 --> 00:39:11,040
network watcher agent the difference

1221
00:39:10,720 --> 00:39:13,040
with

1222
00:39:11,040 --> 00:39:14,079
uh the other things that you know other

1223
00:39:13,040 --> 00:39:14,640
things that you might have in your

1224
00:39:14,079 --> 00:39:16,480
endpoint

1225
00:39:14,640 --> 00:39:18,400
is that this actually is just an

1226
00:39:16,480 --> 00:39:20,560
extension that gets installed on your

1227
00:39:18,400 --> 00:39:21,440
azure vms and you can just collect the

1228
00:39:20,560 --> 00:39:24,400
data

1229
00:39:21,440 --> 00:39:25,119
as if it was just another device in the

1230
00:39:24,400 --> 00:39:26,720
middle

1231
00:39:25,119 --> 00:39:29,200
between your computer and the rest of

1232
00:39:26,720 --> 00:39:30,879
the network so you can just capture uh

1233
00:39:29,200 --> 00:39:32,399
data through those commands and once

1234
00:39:30,880 --> 00:39:34,720
again once you have the slides and you

1235
00:39:32,400 --> 00:39:36,240
can also read at the bottom

1236
00:39:34,720 --> 00:39:38,000
uh there is more information about it

1237
00:39:36,240 --> 00:39:40,240
because i wrote a whole blog post

1238
00:39:38,000 --> 00:39:41,760
about that specific thing and at the end

1239
00:39:40,240 --> 00:39:42,000
what it does it just you know pushes

1240
00:39:41,760 --> 00:39:45,200
that

1241
00:39:42,000 --> 00:39:47,359
pcap to your to your network you know

1242
00:39:45,200 --> 00:39:48,960
watcher for example in here on the top

1243
00:39:47,359 --> 00:39:50,480
that you can see that it's running

1244
00:39:48,960 --> 00:39:53,200
and then at the bottom you're just gonna

1245
00:39:50,480 --> 00:39:55,359
see it in a actual container

1246
00:39:53,200 --> 00:39:57,359
um you know where you can easily

1247
00:39:55,359 --> 00:39:59,520
download it and then just use it

1248
00:39:57,359 --> 00:40:00,960
the advantage of this is that if you

1249
00:39:59,520 --> 00:40:03,200
have an environment with like 20

1250
00:40:00,960 --> 00:40:05,359
computers let's say or 10 computers

1251
00:40:03,200 --> 00:40:07,118
you can just you know run this command

1252
00:40:05,359 --> 00:40:07,920
and you know point it you know point

1253
00:40:07,119 --> 00:40:10,319
that to you

1254
00:40:07,920 --> 00:40:12,000
to several computers and then you will

1255
00:40:10,319 --> 00:40:12,400
be able to get all the pcap from all

1256
00:40:12,000 --> 00:40:14,960
those

1257
00:40:12,400 --> 00:40:16,480
computers and that of course is if you

1258
00:40:14,960 --> 00:40:18,400
are not using any other

1259
00:40:16,480 --> 00:40:20,240
things to capture network data so this

1260
00:40:18,400 --> 00:40:20,560
is just an option another thing that i

1261
00:40:20,240 --> 00:40:25,040
use

1262
00:40:20,560 --> 00:40:27,119
as well all right so that's pretty much

1263
00:40:25,040 --> 00:40:28,960
how the model project is it's maintained

1264
00:40:27,119 --> 00:40:30,800
how the model project is actually

1265
00:40:28,960 --> 00:40:32,480
uh being shared from an infrastructure

1266
00:40:30,800 --> 00:40:35,040
perspective and also from an

1267
00:40:32,480 --> 00:40:37,040
organization perspective like you know

1268
00:40:35,040 --> 00:40:38,400
how the data sets are are organized and

1269
00:40:37,040 --> 00:40:40,079
all the stuff

1270
00:40:38,400 --> 00:40:41,440
but what can you do with it there's a

1271
00:40:40,079 --> 00:40:42,960
lot of things that you can do

1272
00:40:41,440 --> 00:40:44,880
you can go all the way from trainings

1273
00:40:42,960 --> 00:40:47,280
from job interviews for example you can

1274
00:40:44,880 --> 00:40:48,640
use that to actually interview somebody

1275
00:40:47,280 --> 00:40:50,160
because somebody could say i'm very

1276
00:40:48,640 --> 00:40:51,200
familiar for example with lateral

1277
00:40:50,160 --> 00:40:53,359
movement techniques

1278
00:40:51,200 --> 00:40:54,399
great there is like 10 to 20 different

1279
00:40:53,359 --> 00:40:56,640
techniques

1280
00:40:54,400 --> 00:40:58,560
where we have data and we can just push

1281
00:40:56,640 --> 00:40:59,839
that data to a location where you can

1282
00:40:58,560 --> 00:41:02,160
just tell me what it is

1283
00:40:59,839 --> 00:41:03,920
what it is that you could do with it and

1284
00:41:02,160 --> 00:41:04,640
at the end of course you can validate a

1285
00:41:03,920 --> 00:41:06,720
couple of

1286
00:41:04,640 --> 00:41:08,160
uh queries and you can contribute to

1287
00:41:06,720 --> 00:41:09,680
other projects and that's pretty much

1288
00:41:08,160 --> 00:41:12,240
also what i wanted to share

1289
00:41:09,680 --> 00:41:14,000
i mean this uh presentation so what

1290
00:41:12,240 --> 00:41:14,319
we're doing now is we're just pretty

1291
00:41:14,000 --> 00:41:16,400
much

1292
00:41:14,319 --> 00:41:17,599
skipping a lot of those initial steps in

1293
00:41:16,400 --> 00:41:20,000
the whole methodology

1294
00:41:17,599 --> 00:41:21,520
and running directly to the analysis and

1295
00:41:20,000 --> 00:41:23,440
sharing of the data

1296
00:41:21,520 --> 00:41:25,839
and that's also the goal how can i just

1297
00:41:23,440 --> 00:41:28,160
share data so somebody else can use it

1298
00:41:25,839 --> 00:41:30,240
and also benefit learn and at the same

1299
00:41:28,160 --> 00:41:31,759
time if there is not a rule created for

1300
00:41:30,240 --> 00:41:33,919
example in the sigma project

1301
00:41:31,760 --> 00:41:36,640
you can use it to create a rule and you

1302
00:41:33,920 --> 00:41:39,119
can use it also to validate the rule

1303
00:41:36,640 --> 00:41:41,598
so for example going back to this

1304
00:41:39,119 --> 00:41:43,520
specific example like i ran through this

1305
00:41:41,599 --> 00:41:46,000
and now i have a data set in the model

1306
00:41:43,520 --> 00:41:46,400
project so now i can just grab this data

1307
00:41:46,000 --> 00:41:48,160
set

1308
00:41:46,400 --> 00:41:49,760
and i can start you know running some

1309
00:41:48,160 --> 00:41:52,319
queries on the top of that

1310
00:41:49,760 --> 00:41:53,839
um i use different tools to do that one

1311
00:41:52,319 --> 00:41:54,640
of them is jupyter notebooks and there

1312
00:41:53,839 --> 00:41:57,599
is a lot of

1313
00:41:54,640 --> 00:41:59,279
information about it also um in in

1314
00:41:57,599 --> 00:42:00,160
google like you know how to deploy and

1315
00:41:59,280 --> 00:42:02,720
all this stuff

1316
00:42:00,160 --> 00:42:03,520
um i also have a a specific website that

1317
00:42:02,720 --> 00:42:06,160
you can uh

1318
00:42:03,520 --> 00:42:07,200
uh go i can just do it since i can i can

1319
00:42:06,160 --> 00:42:10,399
see that

1320
00:42:07,200 --> 00:42:12,399
you guys can see my uh my

1321
00:42:10,400 --> 00:42:14,400
browser tabs but if you go to infosec

1322
00:42:12,400 --> 00:42:15,839
jupiter book for example like i also put

1323
00:42:14,400 --> 00:42:17,440
together that project so you can get

1324
00:42:15,839 --> 00:42:20,480
familiarized with it

1325
00:42:17,440 --> 00:42:21,280
um okay so for example in this role i

1326
00:42:20,480 --> 00:42:25,280
was able to

1327
00:42:21,280 --> 00:42:28,160
to to query for example any indicators

1328
00:42:25,280 --> 00:42:31,760
that the sc manager was being query

1329
00:42:28,160 --> 00:42:33,359
for example and in this case of course

1330
00:42:31,760 --> 00:42:36,160
as i you know said before

1331
00:42:33,359 --> 00:42:36,560
um you can track if there is a network

1332
00:42:36,160 --> 00:42:39,359
log

1333
00:42:36,560 --> 00:42:40,400
on but if you're just tracking any

1334
00:42:39,359 --> 00:42:43,119
interactions

1335
00:42:40,400 --> 00:42:44,160
with your sc manager for example you can

1336
00:42:43,119 --> 00:42:46,319
add context

1337
00:42:44,160 --> 00:42:47,598
from another event like 4624 from

1338
00:42:46,319 --> 00:42:50,160
windows security auditing

1339
00:42:47,599 --> 00:42:50,880
you can do logon type 3 you can join

1340
00:42:50,160 --> 00:42:53,520
those those

1341
00:42:50,880 --> 00:42:55,760
for example um you know three events and

1342
00:42:53,520 --> 00:42:58,640
then you'll be able to get to

1343
00:42:55,760 --> 00:43:00,880
actually users that are interacting

1344
00:42:58,640 --> 00:43:02,240
querying the the essay manager over the

1345
00:43:00,880 --> 00:43:03,760
network for example

1346
00:43:02,240 --> 00:43:05,439
so that's something that you know could

1347
00:43:03,760 --> 00:43:06,240
be validated right away with the mortal

1348
00:43:05,440 --> 00:43:07,599
data set

1349
00:43:06,240 --> 00:43:09,359
and you don't have to go through the

1350
00:43:07,599 --> 00:43:10,800
whole process just to emulate it or

1351
00:43:09,359 --> 00:43:12,319
simulate it again

1352
00:43:10,800 --> 00:43:14,800
and of course for those that are curious

1353
00:43:12,319 --> 00:43:18,319
to know what those uh specific

1354
00:43:14,800 --> 00:43:21,680
access masks or just access rights

1355
00:43:18,319 --> 00:43:23,680
mean you can see that in this data set

1356
00:43:21,680 --> 00:43:25,520
we actually capture the behavior

1357
00:43:23,680 --> 00:43:27,359
that we were talking about before just

1358
00:43:25,520 --> 00:43:29,680
by monitoring the sc manager

1359
00:43:27,359 --> 00:43:31,279
right you know connecting to the sem

1360
00:43:29,680 --> 00:43:32,879
querying it starting the service

1361
00:43:31,280 --> 00:43:34,000
stopping the service and that's pretty

1362
00:43:32,880 --> 00:43:37,920
much what we had

1363
00:43:34,000 --> 00:43:40,480
um in in in this whole methodology

1364
00:43:37,920 --> 00:43:41,920
of this specific technique so that was

1365
00:43:40,480 --> 00:43:43,200
pretty cool right because we can just

1366
00:43:41,920 --> 00:43:45,760
you know get the data and start

1367
00:43:43,200 --> 00:43:47,200
validating analytics

1368
00:43:45,760 --> 00:43:49,440
this is another example that i also

1369
00:43:47,200 --> 00:43:50,240
collaborated with the team from ndsec

1370
00:43:49,440 --> 00:43:51,839
labs

1371
00:43:50,240 --> 00:43:54,240
i mean in this one they were using for

1372
00:43:51,839 --> 00:43:55,200
example code execution via dcom excel

1373
00:43:54,240 --> 00:43:57,919
register

1374
00:43:55,200 --> 00:43:59,598
xll and this was a very interesting one

1375
00:43:57,920 --> 00:44:02,720
because you can actually see

1376
00:43:59,599 --> 00:44:03,760
that interaction uh for example you can

1377
00:44:02,720 --> 00:44:06,319
see like rpc

1378
00:44:03,760 --> 00:44:08,720
being used and then you can see the

1379
00:44:06,319 --> 00:44:10,400
request to that specific class

1380
00:44:08,720 --> 00:44:12,160
and then you can see at the bottom that

1381
00:44:10,400 --> 00:44:15,839
you know the value also is

1382
00:44:12,160 --> 00:44:17,200
calculator or calc.xll for for example

1383
00:44:15,839 --> 00:44:19,279
so that was also something that i

1384
00:44:17,200 --> 00:44:21,598
started playing with and

1385
00:44:19,280 --> 00:44:23,040
i was able to create these rules as well

1386
00:44:21,599 --> 00:44:26,160
where it tells me that

1387
00:44:23,040 --> 00:44:28,880
a a process for example

1388
00:44:26,160 --> 00:44:29,839
which is excel if excel is launched with

1389
00:44:28,880 --> 00:44:32,319
the automation

1390
00:44:29,839 --> 00:44:33,440
you know arguments and then the parent

1391
00:44:32,319 --> 00:44:35,200
it's also

1392
00:44:33,440 --> 00:44:37,040
you know running the com launch as part

1393
00:44:35,200 --> 00:44:37,919
of their arguments that could be an

1394
00:44:37,040 --> 00:44:41,119
indicator

1395
00:44:37,920 --> 00:44:42,160
of excel being used automatically and it

1396
00:44:41,119 --> 00:44:44,400
could be an indicator

1397
00:44:42,160 --> 00:44:45,359
also that is being done over the network

1398
00:44:44,400 --> 00:44:47,040
so once again

1399
00:44:45,359 --> 00:44:49,359
this data is available so we can just

1400
00:44:47,040 --> 00:44:51,440
download it and start creating rules

1401
00:44:49,359 --> 00:44:53,598
and this was one of the contributions

1402
00:44:51,440 --> 00:44:54,640
very basic contributions for the sigma

1403
00:44:53,599 --> 00:44:57,280
rule project

1404
00:44:54,640 --> 00:44:58,640
which i grabbed this telemetry i went

1405
00:44:57,280 --> 00:45:00,079
through the whole blog post

1406
00:44:58,640 --> 00:45:02,078
and i was able to share that with a

1407
00:45:00,079 --> 00:45:04,560
community as well

1408
00:45:02,079 --> 00:45:07,119
this was another one wmi also dll

1409
00:45:04,560 --> 00:45:10,319
hijacked using that specific dll

1410
00:45:07,119 --> 00:45:12,720
which is called wbam.com and it has a

1411
00:45:10,319 --> 00:45:14,800
similar behavior as the other one

1412
00:45:12,720 --> 00:45:16,640
but this one has a little twist because

1413
00:45:14,800 --> 00:45:19,680
if we execute wmi

1414
00:45:16,640 --> 00:45:21,359
and this dll is just a plain dll waiting

1415
00:45:19,680 --> 00:45:23,598
to be executed

1416
00:45:21,359 --> 00:45:26,400
that would be harder to to to actually

1417
00:45:23,599 --> 00:45:28,240
um you know mimic what the wmi

1418
00:45:26,400 --> 00:45:30,560
execution would do so you have to add

1419
00:45:28,240 --> 00:45:32,479
some also like proxy

1420
00:45:30,560 --> 00:45:35,200
some of those exports to that specific

1421
00:45:32,480 --> 00:45:37,920
dll so all that is being done as well

1422
00:45:35,200 --> 00:45:38,399
through mordor we have another rule and

1423
00:45:37,920 --> 00:45:43,599
we have

1424
00:45:38,400 --> 00:45:46,240
no time oh sorry all right 24 minutes

1425
00:45:43,599 --> 00:45:48,319
yeah that's when the next talk starts oh

1426
00:45:46,240 --> 00:45:48,720
okay okay sorry okay sorry that that was

1427
00:45:48,319 --> 00:45:49,920
uh

1428
00:45:48,720 --> 00:45:52,160
you were scheduled to finish eight

1429
00:45:49,920 --> 00:45:55,680
minutes ago but you know we're like we

1430
00:45:52,160 --> 00:45:56,960
enjoy the enthusiasm we enjoy the uh

1431
00:45:55,680 --> 00:45:58,879
so if you want to bring up one last

1432
00:45:56,960 --> 00:46:00,800
slide um

1433
00:45:58,880 --> 00:46:02,480
that was pretty much like the the end so

1434
00:46:00,800 --> 00:46:04,240
the end will be how to contribute

1435
00:46:02,480 --> 00:46:06,560
and you can just go to that link at the

1436
00:46:04,240 --> 00:46:08,640
bottom the slides are going to be shared

1437
00:46:06,560 --> 00:46:10,799
but at the end the only thing that it's

1438
00:46:08,640 --> 00:46:11,520
left is just you can join the discord

1439
00:46:10,800 --> 00:46:14,400
server

1440
00:46:11,520 --> 00:46:16,240
and we can talk more about um specific

1441
00:46:14,400 --> 00:46:17,280
model data sets and just contribute to

1442
00:46:16,240 --> 00:46:19,520
the community so

1443
00:46:17,280 --> 00:46:20,800
that was it that was just the last thing

1444
00:46:19,520 --> 00:46:23,040
and please please

1445
00:46:20,800 --> 00:46:25,119
please hang on and jump into our slack

1446
00:46:23,040 --> 00:46:27,440
channel as well

1447
00:46:25,119 --> 00:46:29,520
people can ask you questions there too

1448
00:46:27,440 --> 00:46:32,079
um i do have one question for you

1449
00:46:29,520 --> 00:46:34,000
very briefly before we move on what do

1450
00:46:32,079 --> 00:46:36,480
you think of the amazon remake of lord

1451
00:46:34,000 --> 00:46:39,839
of the rings

1452
00:46:36,480 --> 00:46:42,240
well i haven't haven't watched it but um

1453
00:46:39,839 --> 00:46:44,880
having seen what's going on with that

1454
00:46:42,240 --> 00:46:45,598
thing but i'm a big fan so i will give

1455
00:46:44,880 --> 00:46:47,119
my

1456
00:46:45,599 --> 00:46:48,880
feedback when i see what's going on

1457
00:46:47,119 --> 00:46:52,319
there but i haven't i haven't seen it

1458
00:46:48,880 --> 00:46:56,400
okay okay replied like a true consultant

1459
00:46:52,319 --> 00:46:59,279
um so roberta thank you very much indeed

1460
00:46:56,400 --> 00:47:00,400
absolutely fascinating very very uh deep

1461
00:46:59,280 --> 00:47:03,280
knowledge there

1462
00:47:00,400 --> 00:47:04,319
folks everybody go to uh the website

1463
00:47:03,280 --> 00:47:07,680
there and contribute

1464
00:47:04,319 --> 00:47:10,319
and take part use the tool um

1465
00:47:07,680 --> 00:47:11,440
and uh you know unfortunately when it

1466
00:47:10,319 --> 00:47:14,480
comes to

1467
00:47:11,440 --> 00:47:15,760
uh the uh the end of the talk you shall

1468
00:47:14,480 --> 00:47:19,200
not pass

1469
00:47:15,760 --> 00:47:22,400
another two minutes so yeah so

1470
00:47:19,200 --> 00:47:25,439
so um uh roberto thank you so much

1471
00:47:22,400 --> 00:47:28,960
and you get my virtual round of applause

1472
00:47:25,440 --> 00:47:36,240
for uh thank you thank you sir all right

1473
00:47:28,960 --> 00:47:36,240
that's it take care bye everybody bye

