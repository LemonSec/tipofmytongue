1
00:00:06,799 --> 00:00:08,880
hello b-siders and welcome back to track

2
00:00:08,880 --> 00:00:09,280
two

3
00:00:09,280 --> 00:00:12,080
our next presentation is titled advanced

4
00:00:12,080 --> 00:00:13,440
fishing threats

5
00:00:13,440 --> 00:00:15,839
exploding modern features our speaker

6
00:00:15,839 --> 00:00:17,039
peyton miller

7
00:00:17,039 --> 00:00:19,039
joined the open security team after the

8
00:00:19,039 --> 00:00:20,880
completion of the applied

9
00:00:20,880 --> 00:00:23,119
cyber security undergraduate program at

10
00:00:23,119 --> 00:00:25,519
the sands institute of technology

11
00:00:25,519 --> 00:00:27,439
having sharpened his pentestine skill

12
00:00:27,439 --> 00:00:29,279
set and garnering recognition across the

13
00:00:29,279 --> 00:00:31,199
industry through his participation

14
00:00:31,199 --> 00:00:33,600
in various capture the flag competitions

15
00:00:33,600 --> 00:00:35,680
peyton quickly set himself apart as a

16
00:00:35,680 --> 00:00:37,920
highly motivated self-starter

17
00:00:37,920 --> 00:00:39,600
thank you peyton for being here today

18
00:00:39,600 --> 00:00:45,280
i'm going to pass you the controls

19
00:00:45,280 --> 00:00:47,680
all right

20
00:00:52,870 --> 00:00:55,039
[Music]

21
00:00:55,039 --> 00:00:58,719
am i sure yeah

22
00:00:58,719 --> 00:01:02,239
thanks jj for the introduction

23
00:01:02,239 --> 00:01:03,760
and thank you guys for joining me with

24
00:01:03,760 --> 00:01:05,438
uh advanced fishing threats uh

25
00:01:05,438 --> 00:01:07,680
exploiting modern features i'm glad to

26
00:01:07,680 --> 00:01:08,799
be here and

27
00:01:08,799 --> 00:01:10,240
honestly it's great to see this type

28
00:01:10,240 --> 00:01:13,839
turn out with b-sides

29
00:01:14,000 --> 00:01:17,840
so getting into it as previously stated

30
00:01:17,840 --> 00:01:20,080
i am a cyber security engineer with open

31
00:01:20,080 --> 00:01:22,560
security i'm my gsac gcihg pen

32
00:01:22,560 --> 00:01:26,080
and i have attained my education from

33
00:01:26,080 --> 00:01:27,439
sans

34
00:01:27,439 --> 00:01:29,040
but what wasn't mentioned was i

35
00:01:29,040 --> 00:01:31,119
absolutely love finding obscure way

36
00:01:31,119 --> 00:01:34,079
to break web applications um legacy

37
00:01:34,079 --> 00:01:34,960
protocols

38
00:01:34,960 --> 00:01:37,759
anything like that just obscure ways to

39
00:01:37,759 --> 00:01:38,400
either

40
00:01:38,400 --> 00:01:40,320
exceed our permissions or break the

41
00:01:40,320 --> 00:01:43,040
protocol together

42
00:01:43,040 --> 00:01:45,119
so at a basic level we need to get on

43
00:01:45,119 --> 00:01:46,320
the same page

44
00:01:46,320 --> 00:01:50,000
what is fishing so what are we trying to

45
00:01:50,000 --> 00:01:51,680
achieve

46
00:01:51,680 --> 00:01:53,119
and to get into that we need to

47
00:01:53,119 --> 00:01:55,119
understand a few things first off

48
00:01:55,119 --> 00:01:58,159
social manipulation now

49
00:01:58,159 --> 00:02:01,119
maybe we're trying to achieve and

50
00:02:01,119 --> 00:02:02,719
convince you to disclose some type of

51
00:02:02,719 --> 00:02:03,759
information

52
00:02:03,759 --> 00:02:06,719
this information can vary from you know

53
00:02:06,719 --> 00:02:07,119
your

54
00:02:07,119 --> 00:02:08,959
email and password but it could also be

55
00:02:08,959 --> 00:02:10,720
something as trivial as

56
00:02:10,720 --> 00:02:12,160
what kind of applications your

57
00:02:12,160 --> 00:02:13,760
organization is running

58
00:02:13,760 --> 00:02:16,000
now this type of information at face

59
00:02:16,000 --> 00:02:18,319
value may not

60
00:02:18,319 --> 00:02:21,840
you know it may not be

61
00:02:21,840 --> 00:02:24,160
but as an attacker if i can that you're

62
00:02:24,160 --> 00:02:24,959
using

63
00:02:24,959 --> 00:02:28,720
office 365 or using verisign

64
00:02:28,720 --> 00:02:31,040
i can create campaigns targeted around

65
00:02:31,040 --> 00:02:32,720
that concept

66
00:02:32,720 --> 00:02:36,239
now this is usually deployed in two ways

67
00:02:36,239 --> 00:02:38,160
first off maybe we'll jump into a voice

68
00:02:38,160 --> 00:02:39,840
call with you and we'll act as your

69
00:02:39,840 --> 00:02:40,959
company's i.t

70
00:02:40,959 --> 00:02:43,920
that's called fishing meanwhile we

71
00:02:43,920 --> 00:02:44,800
fishing

72
00:02:44,800 --> 00:02:48,480
where we send you an email and we try to

73
00:02:48,480 --> 00:02:50,480
get you to interact with it and disclose

74
00:02:50,480 --> 00:02:51,840
some type of information

75
00:02:51,840 --> 00:02:55,280
that we can't find on our own so

76
00:02:55,280 --> 00:02:57,920
fishing typically has two parts and

77
00:02:57,920 --> 00:03:00,400
historically this is rain true

78
00:03:00,400 --> 00:03:03,120
we have to give you some type of issue

79
00:03:03,120 --> 00:03:04,800
that pulls you in

80
00:03:04,800 --> 00:03:07,280
and gets you to engage with us so maybe

81
00:03:07,280 --> 00:03:09,120
you need the new company benefits you

82
00:03:09,120 --> 00:03:10,879
need to download and update download the

83
00:03:10,879 --> 00:03:11,840
software

84
00:03:11,840 --> 00:03:15,040
maybe you qualify for a stimulus check

85
00:03:15,040 --> 00:03:16,400
you know these are the types of things

86
00:03:16,400 --> 00:03:18,640
that if you get that in your

87
00:03:18,640 --> 00:03:20,959
inbox you may or may not actually

88
00:03:20,959 --> 00:03:22,720
interact with

89
00:03:22,720 --> 00:03:26,080
now in all of these cases they work

90
00:03:26,080 --> 00:03:28,959
and they work because we put deadlines

91
00:03:28,959 --> 00:03:29,280
on

92
00:03:29,280 --> 00:03:32,239
average phishing campaigns only have 23

93
00:03:32,239 --> 00:03:32,799
hours

94
00:03:32,799 --> 00:03:35,680
if they're deployed in mass so we have

95
00:03:35,680 --> 00:03:36,799
23 hours

96
00:03:36,799 --> 00:03:38,400
to get you to click and fill out your

97
00:03:38,400 --> 00:03:42,640
information or download that software

98
00:03:43,840 --> 00:03:46,959
as a society building web applications

99
00:03:46,959 --> 00:03:50,560
and just creating this complex internet

100
00:03:50,560 --> 00:03:53,680
where are we so from an organizational

101
00:03:53,680 --> 00:03:55,120
standpoint

102
00:03:55,120 --> 00:03:57,920
organizations don't want people to buy

103
00:03:57,920 --> 00:04:00,159
domain names that are similar to theirs

104
00:04:00,159 --> 00:04:03,360
so instead they'll buy 10 maybe 20

105
00:04:03,360 --> 00:04:06,080
in some cases even 30 domain names and

106
00:04:06,080 --> 00:04:07,599
they'll maintain these and have them

107
00:04:07,599 --> 00:04:10,080
redirect to the official webpage

108
00:04:10,080 --> 00:04:13,920
that's great and it is a practice that

109
00:04:13,920 --> 00:04:16,000
we keep seeing time and time again

110
00:04:16,000 --> 00:04:19,358
there's nothing vulnerable here until an

111
00:04:19,358 --> 00:04:21,918
attacker redirects to your homepage

112
00:04:21,918 --> 00:04:24,240
and then that attacker gains trust

113
00:04:24,240 --> 00:04:26,400
because for years

114
00:04:26,400 --> 00:04:27,759
maybe you start to think that you

115
00:04:27,759 --> 00:04:29,440
actually own that domain

116
00:04:29,440 --> 00:04:31,680
and maybe your clients that you own that

117
00:04:31,680 --> 00:04:32,639
domain

118
00:04:32,639 --> 00:04:36,800
what's the difference historically we've

119
00:04:36,800 --> 00:04:39,280
kind of shied away against disclosing

120
00:04:39,280 --> 00:04:41,040
information that shouldn't be shared

121
00:04:41,040 --> 00:04:43,400
and this type of information is

122
00:04:43,400 --> 00:04:44,720
sitemap.xml

123
00:04:44,720 --> 00:04:46,880
and robots.txt it can lead to the

124
00:04:46,880 --> 00:04:48,320
disclosure of information that

125
00:04:48,320 --> 00:04:51,600
we don't want you to find but should we

126
00:04:51,600 --> 00:04:52,240
be

127
00:04:52,240 --> 00:04:54,560
exposing a list of all the services that

128
00:04:54,560 --> 00:04:58,080
our company actually owns

129
00:04:59,680 --> 00:05:01,840
another trend that we've seen and this

130
00:05:01,840 --> 00:05:03,440
has picked up over time

131
00:05:03,440 --> 00:05:06,880
is third party apis i myself if i host a

132
00:05:06,880 --> 00:05:08,479
website

133
00:05:08,479 --> 00:05:11,919
say it's a shock i'm selling products

134
00:05:11,919 --> 00:05:13,360
i don't want your credit card

135
00:05:13,360 --> 00:05:15,680
information i don't want the liability

136
00:05:15,680 --> 00:05:17,120
that comes with that

137
00:05:17,120 --> 00:05:19,680
if we get hacked then i have to disclose

138
00:05:19,680 --> 00:05:20,720
to everyone

139
00:05:20,720 --> 00:05:22,400
hey you might want to get a new credit

140
00:05:22,400 --> 00:05:24,000
card and there's

141
00:05:24,000 --> 00:05:26,720
fees for that i do not want that

142
00:05:26,720 --> 00:05:28,400
liability of holding on to that type of

143
00:05:28,400 --> 00:05:30,479
personal information

144
00:05:30,479 --> 00:05:33,360
so we'll use apis and so if you go to an

145
00:05:33,360 --> 00:05:34,240
untrusted site

146
00:05:34,240 --> 00:05:35,919
that you don't trust and they have an

147
00:05:35,919 --> 00:05:38,400
api to a trusted service

148
00:05:38,400 --> 00:05:41,120
will you trust that trusted service

149
00:05:41,120 --> 00:05:42,080
we're relying

150
00:05:42,080 --> 00:05:45,680
on this untrusted site to provide

151
00:05:45,680 --> 00:05:48,160
a trusted service it seems kind of

152
00:05:48,160 --> 00:05:50,639
backwards doesn't it

153
00:05:50,639 --> 00:05:53,280
so that's kind of led to consent based

154
00:05:53,280 --> 00:05:54,720
phishing

155
00:05:54,720 --> 00:05:57,600
in part for example microsoft you can

156
00:05:57,600 --> 00:05:58,880
create custom apps

157
00:05:58,880 --> 00:06:00,319
and you can delegate whatever

158
00:06:00,319 --> 00:06:01,919
permissions you would like

159
00:06:01,919 --> 00:06:04,479
so in this case if i was to install this

160
00:06:04,479 --> 00:06:05,680
application

161
00:06:05,680 --> 00:06:07,440
it would be allowed to sign in as me

162
00:06:07,440 --> 00:06:09,759
read my profile my mail

163
00:06:09,759 --> 00:06:12,080
send mail as me and update my mailbox

164
00:06:12,080 --> 00:06:12,800
settings

165
00:06:12,800 --> 00:06:15,039
alongside everything else enumerated

166
00:06:15,039 --> 00:06:16,400
there

167
00:06:16,400 --> 00:06:18,720
are those really features that these api

168
00:06:18,720 --> 00:06:19,680
should be delegating

169
00:06:19,680 --> 00:06:21,280
or the permissions that should be

170
00:06:21,280 --> 00:06:23,360
delegated from these apis

171
00:06:23,360 --> 00:06:26,319
maybe maybe they are maybe that is a use

172
00:06:26,319 --> 00:06:27,680
case

173
00:06:27,680 --> 00:06:29,840
i don't see why any application would

174
00:06:29,840 --> 00:06:31,600
need all of that information

175
00:06:31,600 --> 00:06:34,880
but it is possible now

176
00:06:34,880 --> 00:06:37,120
historically we've had a few go-to

177
00:06:37,120 --> 00:06:38,080
methods

178
00:06:38,080 --> 00:06:41,120
and one of those is typo domain squad

179
00:06:41,120 --> 00:06:42,880
so let's say we want to buy a domain

180
00:06:42,880 --> 00:06:45,360
like google google.com

181
00:06:45,360 --> 00:06:47,039
we can remove some letters maybe take

182
00:06:47,039 --> 00:06:49,280
out no maybe we duplicate

183
00:06:49,280 --> 00:06:52,560
letters and we have three o's or two l's

184
00:06:52,560 --> 00:06:56,800
we can also try google.net or google.

185
00:06:56,800 --> 00:07:00,479
different top-level domains or

186
00:07:00,479 --> 00:07:02,880
we can look for services that they own

187
00:07:02,880 --> 00:07:05,759
like googleapis.com

188
00:07:05,759 --> 00:07:08,319
and then we can try to name things

189
00:07:08,319 --> 00:07:11,840
around their naming convention

190
00:07:12,319 --> 00:07:13,919
now as you can see here this is a

191
00:07:13,919 --> 00:07:15,599
various

192
00:07:15,599 --> 00:07:19,440
which is available in the github

193
00:07:19,440 --> 00:07:22,400
that was posted to the discord but you

194
00:07:22,400 --> 00:07:24,080
can see we can

195
00:07:24,080 --> 00:07:26,240
very quickly enumerate different types

196
00:07:26,240 --> 00:07:27,280
of domain name

197
00:07:27,280 --> 00:07:29,919
domain names that may or may not have

198
00:07:29,919 --> 00:07:31,039
legitimacy back

199
00:07:31,039 --> 00:07:34,479
in them and so a lot of these are

200
00:07:34,479 --> 00:07:35,199
available

201
00:07:35,199 --> 00:07:37,199
which is the horrifying thing and you

202
00:07:37,199 --> 00:07:38,560
can buy these for

203
00:07:38,560 --> 00:07:42,720
20 maybe 30 dollars in some cases

204
00:07:42,720 --> 00:07:44,639
we also have internationalized domain

205
00:07:44,639 --> 00:07:46,319
names now

206
00:07:46,319 --> 00:07:48,080
internationalized domain names is the

207
00:07:48,080 --> 00:07:49,360
usage of symbols

208
00:07:49,360 --> 00:07:52,479
within the domains or all character sets

209
00:07:52,479 --> 00:07:55,199
for example the twitter one there um you

210
00:07:55,199 --> 00:07:56,960
can see in the symbolic domain name

211
00:07:56,960 --> 00:07:58,240
table

212
00:07:58,240 --> 00:08:01,360
twitter.com is entirely made of cyrillic

213
00:08:01,360 --> 00:08:03,360
characters

214
00:08:03,360 --> 00:08:05,360
now this was a very big vulnerability

215
00:08:05,360 --> 00:08:07,360
and finding back in 2015

216
00:08:07,360 --> 00:08:11,199
2016. the issue was

217
00:08:11,199 --> 00:08:14,240
that looks convincing so what we've done

218
00:08:14,240 --> 00:08:17,280
is we've created this puny code and it's

219
00:08:17,280 --> 00:08:18,319
unicode

220
00:08:18,319 --> 00:08:21,280
but url safe and so anytime you access

221
00:08:21,280 --> 00:08:23,360
one of these symbolic domain names

222
00:08:23,360 --> 00:08:25,360
it will convert to the puny code

223
00:08:25,360 --> 00:08:26,560
equivalent

224
00:08:26,560 --> 00:08:28,960
and that should in most cases at least

225
00:08:28,960 --> 00:08:30,000
for web browsers

226
00:08:30,000 --> 00:08:33,919
it will protect you in recent times

227
00:08:33,919 --> 00:08:37,120
chrome by default converts every request

228
00:08:37,120 --> 00:08:40,240
to the puny code equivalent

229
00:08:40,240 --> 00:08:41,919
that's interesting but it's still

230
00:08:41,919 --> 00:08:44,560
abusable

231
00:08:45,200 --> 00:08:48,560
we can send mail from twitter.com

232
00:08:48,560 --> 00:08:51,200
even though we don't own twitter.com but

233
00:08:51,200 --> 00:08:54,000
we own the cyrillic version

234
00:08:54,000 --> 00:08:55,600
with this type of use case we'd

235
00:08:55,600 --> 00:08:57,440
recommend

236
00:08:57,440 --> 00:09:00,720
staying in one character set and

237
00:09:00,720 --> 00:09:02,160
it's interesting because if you look at

238
00:09:02,160 --> 00:09:04,320
this it does say signed by

239
00:09:04,320 --> 00:09:07,360
the puny code equivalent domain but to

240
00:09:07,360 --> 00:09:08,240
some

241
00:09:08,240 --> 00:09:11,279
unknowing victim even if they analyzed

242
00:09:11,279 --> 00:09:12,080
this

243
00:09:12,080 --> 00:09:14,080
they wouldn't know what that meant and

244
00:09:14,080 --> 00:09:16,480
that's the issue with security

245
00:09:16,480 --> 00:09:18,720
while puny code and internationalized

246
00:09:18,720 --> 00:09:19,920
domain names

247
00:09:19,920 --> 00:09:23,839
are inherently untrusted

248
00:09:24,240 --> 00:09:26,560
we can still send email as those

249
00:09:26,560 --> 00:09:27,519
services

250
00:09:27,519 --> 00:09:31,120
globally okay

251
00:09:31,120 --> 00:09:34,720
now i will take a step back i do feel a

252
00:09:34,720 --> 00:09:36,839
hundred percent comfortable disclosing

253
00:09:36,839 --> 00:09:38,800
microsoft.com and twitter

254
00:09:38,800 --> 00:09:41,279
because frankly i am never getting those

255
00:09:41,279 --> 00:09:42,399
back

256
00:09:42,399 --> 00:09:45,120
um as you can see i received this really

257
00:09:45,120 --> 00:09:46,240
nice email

258
00:09:46,240 --> 00:09:49,279
about res about um the identification of

259
00:09:49,279 --> 00:09:50,800
phishing activities

260
00:09:50,800 --> 00:09:52,560
on my domains in preparation for this

261
00:09:52,560 --> 00:09:55,040
conference it's kind of interesting

262
00:09:55,040 --> 00:09:59,360
and as you can see this legitimate email

263
00:09:59,360 --> 00:10:03,200
is going to cancel my domain

264
00:10:03,200 --> 00:10:04,160
registrations

265
00:10:04,160 --> 00:10:07,440
or terminate my account if i don't take

266
00:10:07,440 --> 00:10:10,079
action in three days

267
00:10:10,079 --> 00:10:12,399
now that's interesting that sounds a lot

268
00:10:12,399 --> 00:10:14,399
like a lot of the phishing campaigns and

269
00:10:14,399 --> 00:10:17,279
the identifiers of fishing

270
00:10:17,279 --> 00:10:20,000
in fact i may actually use this as a

271
00:10:20,000 --> 00:10:23,200
fishing campaign down the road

272
00:10:23,200 --> 00:10:25,040
but in this case it is a truly

273
00:10:25,040 --> 00:10:26,880
legitimate message

274
00:10:26,880 --> 00:10:30,320
and understandably do not host

275
00:10:30,320 --> 00:10:32,240
phishing content or your domains will be

276
00:10:32,240 --> 00:10:34,480
seized and you will not be getting them

277
00:10:34,480 --> 00:10:36,480
back

278
00:10:36,480 --> 00:10:39,040
but what can we do what can we do with

279
00:10:39,040 --> 00:10:40,959
this complex internet and how can we

280
00:10:40,959 --> 00:10:42,720
achieve legitimacy

281
00:10:42,720 --> 00:10:44,720
so there's a few techniques and if we

282
00:10:44,720 --> 00:10:46,000
start out

283
00:10:46,000 --> 00:10:47,680
we can try to use vulnerabilities to

284
00:10:47,680 --> 00:10:50,560
inherit trust

285
00:10:52,640 --> 00:10:55,519
and it has an open redirection on it we

286
00:10:55,519 --> 00:10:57,120
can send you a link that is

287
00:10:57,120 --> 00:11:00,480
test.com redirect question mark

288
00:11:00,480 --> 00:11:03,760
url equals our site and because they

289
00:11:03,760 --> 00:11:05,200
click to link to your site

290
00:11:05,200 --> 00:11:08,480
or sorry to test.com

291
00:11:08,480 --> 00:11:10,640
and now you're redirected to site which

292
00:11:10,640 --> 00:11:12,480
is attacker.go

293
00:11:12,480 --> 00:11:15,839
you inherently trust my website because

294
00:11:15,839 --> 00:11:18,480
why else would this trusted site

295
00:11:18,480 --> 00:11:20,800
redirect you

296
00:11:20,800 --> 00:11:22,240
other examples of this would be

297
00:11:22,240 --> 00:11:24,000
cross-site scripting we can try to steal

298
00:11:24,000 --> 00:11:25,440
your credentials obviously

299
00:11:25,440 --> 00:11:27,519
which that makes phishing campaigns

300
00:11:27,519 --> 00:11:29,920
really easy when we identify that

301
00:11:29,920 --> 00:11:32,959
or we can try to redirect to our site

302
00:11:32,959 --> 00:11:36,399
or inject a login form or set up any

303
00:11:36,399 --> 00:11:37,440
ruse we want

304
00:11:37,440 --> 00:11:43,279
under your domain name that's powerful

305
00:11:43,279 --> 00:11:45,600
some other abusable services that

306
00:11:45,600 --> 00:11:46,480
formats

307
00:11:46,480 --> 00:11:49,760
on behalf of the user we have link

308
00:11:49,760 --> 00:11:50,959
shorteners

309
00:11:50,959 --> 00:11:54,000
now in the case of twitter it's t.co

310
00:11:54,000 --> 00:11:55,839
and we need that because twitter you

311
00:11:55,839 --> 00:11:57,600
only have so many characters you want

312
00:11:57,600 --> 00:11:58,880
shortened links

313
00:11:58,880 --> 00:12:01,920
um file hosting if we host products on

314
00:12:01,920 --> 00:12:03,120
safe and secure

315
00:12:03,120 --> 00:12:08,720
um services that are inherently trusted

316
00:12:08,720 --> 00:12:11,279
then we can send malware from those in

317
00:12:11,279 --> 00:12:13,440
the case on the left here in that image

318
00:12:13,440 --> 00:12:16,560
we have facebook dot me slash a ton of

319
00:12:16,560 --> 00:12:17,279
numbers

320
00:12:17,279 --> 00:12:20,320
now i genuinely don't know if that is

321
00:12:20,320 --> 00:12:21,839
facebook marketing

322
00:12:21,839 --> 00:12:23,120
or whether or not that's a phishing

323
00:12:23,120 --> 00:12:25,440
campaign and that's a reflective

324
00:12:25,440 --> 00:12:29,920
redirection i don't know

325
00:12:29,920 --> 00:12:31,839
another service we can do if we don't

326
00:12:31,839 --> 00:12:33,519
want to do the domain

327
00:12:33,519 --> 00:12:36,720
hop-in we can do sub-domains

328
00:12:36,720 --> 00:12:39,639
um google and firebase they can tell

329
00:12:39,639 --> 00:12:40,959
you.web.app

330
00:12:40,959 --> 00:12:43,760
and firebase.com so you can own any

331
00:12:43,760 --> 00:12:45,600
service you want as long as you

332
00:12:45,600 --> 00:12:47,200
fit their naming schemes for what a

333
00:12:47,200 --> 00:12:49,519
subdomain should be

334
00:12:49,519 --> 00:12:52,800
but these things are free um to be fair

335
00:12:52,800 --> 00:12:55,839
the file hosting is not

336
00:12:56,639 --> 00:13:00,000
the web is a complex place and as we

337
00:13:00,000 --> 00:13:01,360
start to understand this we have to

338
00:13:01,360 --> 00:13:03,600
think about how these applications work

339
00:13:03,600 --> 00:13:06,000
and one example that comes to mind is

340
00:13:06,000 --> 00:13:08,000
meeting platform software

341
00:13:08,000 --> 00:13:11,120
so for example if

342
00:13:11,120 --> 00:13:14,240
i have email and it links directly into

343
00:13:14,240 --> 00:13:18,320
um my calendar can an external entity

344
00:13:18,320 --> 00:13:21,519
send me a meeting invite well yeah they

345
00:13:21,519 --> 00:13:23,600
should be able to

346
00:13:23,600 --> 00:13:25,279
and what if they don't use the same

347
00:13:25,279 --> 00:13:27,839
meeting platform as me

348
00:13:27,839 --> 00:13:31,600
can they send me a link to a nefarious

349
00:13:31,600 --> 00:13:35,440
meeting software installation and then

350
00:13:35,440 --> 00:13:36,959
receive that and i'm like hey i got a

351
00:13:36,959 --> 00:13:39,839
meeting in 15 minutes

352
00:13:39,839 --> 00:13:42,320
what's the implicit trust that i'm going

353
00:13:42,320 --> 00:13:43,680
to click that link and download that

354
00:13:43,680 --> 00:13:44,480
software

355
00:13:44,480 --> 00:13:46,000
because i'm expected to be in that

356
00:13:46,000 --> 00:13:48,079
meeting and these are the types of

357
00:13:48,079 --> 00:13:49,760
things that we're trying to identify and

358
00:13:49,760 --> 00:13:51,279
we're trying to find

359
00:13:51,279 --> 00:13:54,320
that these modern phishing campaigns

360
00:13:54,320 --> 00:13:56,240
can just use the internet it's just that

361
00:13:56,240 --> 00:13:58,639
simple

362
00:13:59,199 --> 00:14:02,160
something that's kind of controversial

363
00:14:02,160 --> 00:14:03,199
is the use of

364
00:14:03,199 --> 00:14:05,920
safe links and link filtering so what

365
00:14:05,920 --> 00:14:07,040
this actually is

366
00:14:07,040 --> 00:14:09,680
is a redirection through outlook's safe

367
00:14:09,680 --> 00:14:11,519
link protocol

368
00:14:11,519 --> 00:14:14,800
and it's a open redirection as long as

369
00:14:14,800 --> 00:14:16,880
the rest of the data in that

370
00:14:16,880 --> 00:14:20,240
url is valid the issue here is

371
00:14:20,240 --> 00:14:22,399
if i click that i have no idea where i'm

372
00:14:22,399 --> 00:14:23,360
going

373
00:14:23,360 --> 00:14:25,279
in the black box there you can see i've

374
00:14:25,279 --> 00:14:26,560
kind of highlighted

375
00:14:26,560 --> 00:14:30,480
http um some parentheses symbols

376
00:14:30,480 --> 00:14:33,440
google.com that's the url encoded form

377
00:14:33,440 --> 00:14:34,800
of google.com

378
00:14:34,800 --> 00:14:39,040
but as you can see it it's a lot

379
00:14:39,040 --> 00:14:41,440
and if i receive a ton of emails a day

380
00:14:41,440 --> 00:14:43,279
i'm not spending the time looking for

381
00:14:43,279 --> 00:14:46,399
what the url actually is this is a

382
00:14:46,399 --> 00:14:47,440
default protection

383
00:14:47,440 --> 00:14:50,639
and frankly

384
00:14:50,639 --> 00:14:53,360
i think it makes our users normalize

385
00:14:53,360 --> 00:14:55,760
trusting random links

386
00:14:55,760 --> 00:14:57,120
because they don't know where they are

387
00:14:57,120 --> 00:14:59,839
going

388
00:15:00,480 --> 00:15:03,680
we can also do subdomain impersonation

389
00:15:03,680 --> 00:15:05,920
now sub domains by default there are a

390
00:15:05,920 --> 00:15:06,959
few character steps

391
00:15:06,959 --> 00:15:09,440
you can do a through z zero through nine

392
00:15:09,440 --> 00:15:11,120
hyphens underscores

393
00:15:11,120 --> 00:15:14,480
and you can use periods as delineators

394
00:15:14,480 --> 00:15:18,560
you also have up to 253 characters

395
00:15:18,560 --> 00:15:21,440
on most registrars or dns providers

396
00:15:21,440 --> 00:15:22,800
rather

397
00:15:22,800 --> 00:15:26,720
to type whatever you would like okay

398
00:15:26,720 --> 00:15:31,440
so this is a valid subdomain interesting

399
00:15:31,440 --> 00:15:34,480
this is also a valid subdomain

400
00:15:34,480 --> 00:15:37,600
huh so how can we start to use this well

401
00:15:37,600 --> 00:15:40,160
here's an example

402
00:15:40,160 --> 00:15:43,440
that's not very convincing you know

403
00:15:43,440 --> 00:15:47,279
it could be http.steam.com

404
00:15:47,279 --> 00:15:50,079
and just to prove it all of these are

405
00:15:50,079 --> 00:15:52,000
completely valid

406
00:15:52,000 --> 00:15:54,959
subdomains and i did blur my actual

407
00:15:54,959 --> 00:15:57,920
domain name there of course

408
00:15:57,920 --> 00:16:01,040
so how can we achieve impersonation so

409
00:16:01,040 --> 00:16:02,800
first off we want to find a trusted

410
00:16:02,800 --> 00:16:05,360
website with a really long url

411
00:16:05,360 --> 00:16:08,959
we open our impersonator

412
00:16:08,959 --> 00:16:11,360
we run a script and we update the dns

413
00:16:11,360 --> 00:16:13,199
it's just that simple

414
00:16:13,199 --> 00:16:15,440
now what the script does and it is again

415
00:16:15,440 --> 00:16:17,040
provided on the github that i linked

416
00:16:17,040 --> 00:16:18,320
there

417
00:16:18,320 --> 00:16:20,800
it runs a few regex expressions to

418
00:16:20,800 --> 00:16:22,240
replace equals with hyphen

419
00:16:22,240 --> 00:16:25,759
delete http or https replace a few

420
00:16:25,759 --> 00:16:27,680
special characters with hyphens and then

421
00:16:27,680 --> 00:16:29,360
delete any of the bad characters that

422
00:16:29,360 --> 00:16:31,920
shouldn't be there

423
00:16:31,920 --> 00:16:35,759
so now we have this is this a legitimate

424
00:16:35,759 --> 00:16:36,720
domain name

425
00:16:36,720 --> 00:16:40,160
um is this discord app.com

426
00:16:40,160 --> 00:16:42,719
cdn

427
00:16:43,199 --> 00:16:45,040
and at first you may actually think it

428
00:16:45,040 --> 00:16:47,120
is but no

429
00:16:47,120 --> 00:16:49,360
in this case our domain name is actually

430
00:16:49,360 --> 00:16:50,800
test.com

431
00:16:50,800 --> 00:16:53,360
the only real way to identify that is

432
00:16:53,360 --> 00:16:55,279
the lack of characters that we can put

433
00:16:55,279 --> 00:16:58,560
we can't put slashes

434
00:16:59,360 --> 00:17:02,720
but we can put a ton of periods and so

435
00:17:02,720 --> 00:17:05,199
at first impression this could look

436
00:17:05,199 --> 00:17:07,599
relatively legitimate

437
00:17:07,599 --> 00:17:10,160
and the worst part is instead of

438
00:17:10,160 --> 00:17:11,679
test.download

439
00:17:11,679 --> 00:17:14,880
we could have any domain in existence

440
00:17:14,880 --> 00:17:17,039
we could have it short we could have id

441
00:17:17,039 --> 00:17:18,640
numbers.com

442
00:17:18,640 --> 00:17:21,679
it really depends

443
00:17:22,319 --> 00:17:24,720
one of my favorite techniques personally

444
00:17:24,720 --> 00:17:26,319
is left to right overrides

445
00:17:26,319 --> 00:17:29,919
and right to leftover eyes now

446
00:17:29,919 --> 00:17:32,000
i don't think this classification

447
00:17:32,000 --> 00:17:33,039
vulnerability

448
00:17:33,039 --> 00:17:36,799
has been given a proper shot

449
00:17:36,799 --> 00:17:38,160
i don't think it's been given a proper

450
00:17:38,160 --> 00:17:39,840
chance

451
00:17:39,840 --> 00:17:42,000
if you actually look into this it's very

452
00:17:42,000 --> 00:17:43,679
hard to find anything

453
00:17:43,679 --> 00:17:46,880
that actually uses it usually you'll

454
00:17:46,880 --> 00:17:48,960
find it through online synopsis of what

455
00:17:48,960 --> 00:17:50,160
it does

456
00:17:50,160 --> 00:17:53,360
so we'll get into it by default in the

457
00:17:53,360 --> 00:17:54,799
english language

458
00:17:54,799 --> 00:17:56,240
text goes from the left side of the

459
00:17:56,240 --> 00:17:58,799
screen to the right side of the screen

460
00:17:58,799 --> 00:18:01,200
and in some languages such as arabic

461
00:18:01,200 --> 00:18:02,080
hebrew

462
00:18:02,080 --> 00:18:03,679
it's the right side of the screen to the

463
00:18:03,679 --> 00:18:05,280
left side of the screen

464
00:18:05,280 --> 00:18:08,880
now on windows we've determined that

465
00:18:08,880 --> 00:18:11,280
why can't we do both at once and we

466
00:18:11,280 --> 00:18:12,400
can't

467
00:18:12,400 --> 00:18:14,240
so we can have left to right and right

468
00:18:14,240 --> 00:18:17,039
to left at the same time

469
00:18:17,039 --> 00:18:20,240
now why is that an issue

470
00:18:20,799 --> 00:18:23,120
well as you can see here what we can

471
00:18:23,120 --> 00:18:24,559
actually do

472
00:18:24,559 --> 00:18:28,000
is completely shift the file extension

473
00:18:28,000 --> 00:18:30,320
anywhere in the file name or at least

474
00:18:30,320 --> 00:18:31,360
that's what's rendered

475
00:18:31,360 --> 00:18:33,360
to the user now this is a little bit

476
00:18:33,360 --> 00:18:34,960
complex but as you can see

477
00:18:34,960 --> 00:18:38,000
the first record there or

478
00:18:38,000 --> 00:18:40,640
row in the table it looks like a dot

479
00:18:40,640 --> 00:18:41,760
docs

480
00:18:41,760 --> 00:18:44,720
it looks like a word document in reality

481
00:18:44,720 --> 00:18:46,400
it's an executable

482
00:18:46,400 --> 00:18:48,080
and the second one is the use case

483
00:18:48,080 --> 00:18:49,919
that's commonly seen with right to left

484
00:18:49,919 --> 00:18:50,720
over right

485
00:18:50,720 --> 00:18:52,960
is that you slide the extension one spot

486
00:18:52,960 --> 00:18:54,799
over

487
00:18:54,799 --> 00:18:57,679
but this is so much more powerful

488
00:18:57,679 --> 00:18:58,960
instead of having

489
00:18:58,960 --> 00:19:02,320
dot link.docs we could have.js

490
00:19:02,320 --> 00:19:05,440
a long file name dot pdf

491
00:19:05,440 --> 00:19:07,360
and you may or may not think it's a pdf

492
00:19:07,360 --> 00:19:09,760
depending on the rendering

493
00:19:09,760 --> 00:19:11,559
and finally my personal favorite

494
00:19:11,559 --> 00:19:12,960
amazon.com

495
00:19:12,960 --> 00:19:15,679
now.com files actually execute on modern

496
00:19:15,679 --> 00:19:16,400
windows as

497
00:19:16,400 --> 00:19:19,039
dot exes so that's really interesting

498
00:19:19,039 --> 00:19:21,440
because we're able to achieve

499
00:19:21,440 --> 00:19:25,679
execution by using web addresses

500
00:19:25,679 --> 00:19:27,440
and as you can see here this is actually

501
00:19:27,440 --> 00:19:29,200
how you type it out

502
00:19:29,200 --> 00:19:31,440
it is a little bit complex and you do

503
00:19:31,440 --> 00:19:33,679
have to play with it a little bit

504
00:19:33,679 --> 00:19:36,160
but as previously stated in the github

505
00:19:36,160 --> 00:19:38,320
repository that i linked there there is

506
00:19:38,320 --> 00:19:40,160
an html file that will

507
00:19:40,160 --> 00:19:42,000
generate most of these for you it does

508
00:19:42,000 --> 00:19:43,520
take a little bit tinkering

509
00:19:43,520 --> 00:19:47,360
just because of um the weird rendering

510
00:19:47,360 --> 00:19:48,799
but a lot of the times it will get you

511
00:19:48,799 --> 00:19:51,039
the most of the way there

512
00:19:51,039 --> 00:19:52,720
now this is interesting because if we

513
00:19:52,720 --> 00:19:54,080
have file names

514
00:19:54,080 --> 00:19:57,918
uh file name extension is disabled

515
00:19:58,400 --> 00:20:01,440
we can no longer see things such as

516
00:20:01,440 --> 00:20:04,880
executive summary it hides the exe

517
00:20:04,880 --> 00:20:07,039
but in the case of amazonwith.com this

518
00:20:07,039 --> 00:20:08,799
is really powerful

519
00:20:08,799 --> 00:20:11,440
because now

520
00:20:12,080 --> 00:20:15,440
instead of amazon.com and that's still

521
00:20:15,440 --> 00:20:18,159
trustworthy

522
00:20:18,320 --> 00:20:21,360
we also have um 2021 executive summary

523
00:20:21,360 --> 00:20:23,600
if we enable the file name extensions

524
00:20:23,600 --> 00:20:25,440
and that looks relatively legitimate

525
00:20:25,440 --> 00:20:26,559
itself

526
00:20:26,559 --> 00:20:32,080
um or amazon.com space dash invoice.pdf

527
00:20:33,200 --> 00:20:35,039
now what other applications does this

528
00:20:35,039 --> 00:20:37,360
have well

529
00:20:37,360 --> 00:20:40,400
frankly if we can send the email

530
00:20:40,400 --> 00:20:42,240
we can write anything we want in the

531
00:20:42,240 --> 00:20:43,520
from header

532
00:20:43,520 --> 00:20:45,600
and so what that means is that

533
00:20:45,600 --> 00:20:48,720
potentially we could flip a domain name

534
00:20:48,720 --> 00:20:50,440
maybe we don't actually own

535
00:20:50,440 --> 00:20:52,080
microsoft.com

536
00:20:52,080 --> 00:20:56,240
but we can allocate a non-spoofed

537
00:20:56,240 --> 00:20:58,240
email address from there and because

538
00:20:58,240 --> 00:21:00,000
it's not spoofed maybe that will give

539
00:21:00,000 --> 00:21:00,799
our email

540
00:21:00,799 --> 00:21:02,799
legitimacy and it won't send it to the

541
00:21:02,799 --> 00:21:04,720
spam list

542
00:21:04,720 --> 00:21:07,520
another example

543
00:21:08,480 --> 00:21:11,840
looks inside of a zip file and displays

544
00:21:11,840 --> 00:21:14,159
what type of file names are inside of it

545
00:21:14,159 --> 00:21:15,360
and as you can see here we have

546
00:21:15,360 --> 00:21:16,480
amazon.com

547
00:21:16,480 --> 00:21:19,360
space dash and voice.docs even though

548
00:21:19,360 --> 00:21:21,360
everybody here knows

549
00:21:21,360 --> 00:21:23,360
that's actually a dot-com file which

550
00:21:23,360 --> 00:21:27,280
executes as a dot-exe

551
00:21:28,720 --> 00:21:30,400
so how do we protect ourselves on the

552
00:21:30,400 --> 00:21:34,000
internet what can we do

553
00:21:34,159 --> 00:21:36,320
well to protect individuals we'd

554
00:21:36,320 --> 00:21:38,799
recommend a password manager

555
00:21:38,799 --> 00:21:42,480
and url matching what that does is

556
00:21:42,480 --> 00:21:44,400
whenever you type in your password if

557
00:21:44,400 --> 00:21:47,600
you are on a fictitious domain name

558
00:21:47,600 --> 00:21:49,440
it won't allow your password manager to

559
00:21:49,440 --> 00:21:51,039
automatically type in your password for

560
00:21:51,039 --> 00:21:51,520
you

561
00:21:51,520 --> 00:21:53,360
and you might be able to identify that

562
00:21:53,360 --> 00:21:54,640
you are on a

563
00:21:54,640 --> 00:21:56,880
malicious website we also have two

564
00:21:56,880 --> 00:21:58,960
factor authentication

565
00:21:58,960 --> 00:22:01,919
the real benefit of this is if you think

566
00:22:01,919 --> 00:22:03,200
that something

567
00:22:03,200 --> 00:22:05,360
needs to be done right away you'll type

568
00:22:05,360 --> 00:22:07,919
in your username and password

569
00:22:07,919 --> 00:22:10,880
but if there's 2fa implemented you'll

570
00:22:10,880 --> 00:22:12,320
take out your phone you'll pull up your

571
00:22:12,320 --> 00:22:13,520
authenticator app

572
00:22:13,520 --> 00:22:15,520
and you'll think about it for a sec and

573
00:22:15,520 --> 00:22:16,559
maybe that's just

574
00:22:16,559 --> 00:22:19,760
long enough to rethink typing in your

575
00:22:19,760 --> 00:22:23,039
credentials in that token

576
00:22:23,039 --> 00:22:26,480
we also have safe site scanners

577
00:22:26,480 --> 00:22:28,480
in the security industry it is kind of a

578
00:22:28,480 --> 00:22:29,679
running joke

579
00:22:29,679 --> 00:22:32,720
but they do detect brand new and new

580
00:22:32,720 --> 00:22:34,480
registered domains

581
00:22:34,480 --> 00:22:38,080
as malicious and it was found that 33

582
00:22:38,080 --> 00:22:39,760
of phishing campaigns on an actual

583
00:22:39,760 --> 00:22:42,080
domain were registered within a month of

584
00:22:42,080 --> 00:22:45,039
use that might be sufficient protection

585
00:22:45,039 --> 00:22:45,440
to

586
00:22:45,440 --> 00:22:48,000
protect you

587
00:22:48,880 --> 00:22:51,280
if you're worried about windows spoofing

588
00:22:51,280 --> 00:22:54,799
where an adversary uses css styles or

589
00:22:54,799 --> 00:22:56,400
modifications to the web browser to

590
00:22:56,400 --> 00:22:58,880
emulate another web browser opening

591
00:22:58,880 --> 00:23:01,440
you can use custom chrome things

592
00:23:01,440 --> 00:23:03,360
historically a great recommendation

593
00:23:03,360 --> 00:23:06,000
is if you can avoid clicking a link

594
00:23:06,000 --> 00:23:07,520
google or navigate directly to the

595
00:23:07,520 --> 00:23:08,000
website

596
00:23:08,000 --> 00:23:09,440
and see if you can find the page

597
00:23:09,440 --> 00:23:11,280
yourself that way if there is a

598
00:23:11,280 --> 00:23:13,600
cross-site scripting or other threat

599
00:23:13,600 --> 00:23:15,200
it's mitigated because you're not

600
00:23:15,200 --> 00:23:16,640
clicking the link with the malicious

601
00:23:16,640 --> 00:23:18,000
payload

602
00:23:18,000 --> 00:23:20,720
and finally regular internal training to

603
00:23:20,720 --> 00:23:22,080
ensure that your organization can

604
00:23:22,080 --> 00:23:24,080
identify a large range

605
00:23:24,080 --> 00:23:28,400
of threats and regular training security

606
00:23:28,400 --> 00:23:30,400
the threat landscape does change over

607
00:23:30,400 --> 00:23:32,320
time and we need to identify that and be

608
00:23:32,320 --> 00:23:34,080
on top of it

609
00:23:34,080 --> 00:23:35,919
finally to protect your organization

610
00:23:35,919 --> 00:23:37,440
here's a few recommendations

611
00:23:37,440 --> 00:23:39,679
if you do have a domain that's being

612
00:23:39,679 --> 00:23:41,039
used for mail server

613
00:23:41,039 --> 00:23:43,360
ensure that your dns records are valid

614
00:23:43,360 --> 00:23:44,960
and up to date

615
00:23:44,960 --> 00:23:47,760
reduce unnecessary domain redirections

616
00:23:47,760 --> 00:23:48,080
so

617
00:23:48,080 --> 00:23:50,000
maybe you shouldn't point everything at

618
00:23:50,000 --> 00:23:51,679
your home page or

619
00:23:51,679 --> 00:23:54,080
at whatever your organization's top

620
00:23:54,080 --> 00:23:55,200
level domain

621
00:23:55,200 --> 00:23:59,200
really is maybe we want to expose a list

622
00:23:59,200 --> 00:24:01,039
of what services we actually own

623
00:24:01,039 --> 00:24:02,799
or some type of endpoint that we can

624
00:24:02,799 --> 00:24:04,640
query that

625
00:24:04,640 --> 00:24:06,960
now this does have other benefits um

626
00:24:06,960 --> 00:24:09,440
although it would have to be maintained

627
00:24:09,440 --> 00:24:11,200
we could implement logging and so if a

628
00:24:11,200 --> 00:24:12,799
lot of people began

629
00:24:12,799 --> 00:24:16,720
querying a fictitious or phishing domain

630
00:24:16,720 --> 00:24:21,200
maybe we can take action on that before

631
00:24:21,200 --> 00:24:24,640
people lose their credentials

632
00:24:24,880 --> 00:24:27,279
and finally maintaining web servers with

633
00:24:27,279 --> 00:24:27,919
regular

634
00:24:27,919 --> 00:24:29,760
vulnerability assessments and ensuring

635
00:24:29,760 --> 00:24:31,200
that your external services

636
00:24:31,200 --> 00:24:34,880
are secure i have linked a

637
00:24:34,880 --> 00:24:36,720
few additional resources if you want to

638
00:24:36,720 --> 00:24:38,000
do any further

639
00:24:38,000 --> 00:24:40,880
research on your own and some links to

640
00:24:40,880 --> 00:24:42,559
blogs that i found interesting while

641
00:24:42,559 --> 00:24:44,159
researching the topic and

642
00:24:44,159 --> 00:24:48,240
doing my own investigations um

643
00:24:48,240 --> 00:24:51,679
finally i know we are close on time

644
00:24:51,679 --> 00:24:53,679
so if you do have any questions that

645
00:24:53,679 --> 00:24:55,200
haven't been answered at this point and

646
00:24:55,200 --> 00:24:56,000
you want to

647
00:24:56,000 --> 00:24:58,400
reach out to me on twitter or discord or

648
00:24:58,400 --> 00:25:00,320
follow up with me in the open security

649
00:25:00,320 --> 00:25:02,159
channel afterwards

650
00:25:02,159 --> 00:25:03,679
all scripts that i've mentioned are

651
00:25:03,679 --> 00:25:05,440
available in the github

652
00:25:05,440 --> 00:25:07,279
that is both published in the discord

653
00:25:07,279 --> 00:25:10,020
chat and enumerated right there

654
00:25:10,020 --> 00:25:12,840
[Music]

655
00:25:12,840 --> 00:25:15,840
so

656
00:25:16,530 --> 00:25:19,589
[Music]

657
00:25:37,320 --> 00:25:47,389
[Music]

658
00:25:51,640 --> 00:25:56,829
[Music]

659
00:26:05,180 --> 00:26:08,319
[Music]

660
00:26:08,720 --> 00:26:10,799
you

