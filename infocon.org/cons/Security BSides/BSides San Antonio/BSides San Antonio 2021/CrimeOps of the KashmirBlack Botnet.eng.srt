1
00:00:06,879 --> 00:00:08,000
thanks

2
00:00:08,000 --> 00:00:10,639
thank you john uh we're super excited to

3
00:00:10,639 --> 00:00:12,000
be here presenting in b

4
00:00:12,000 --> 00:00:15,519
sites so we're about botnets all the

5
00:00:15,519 --> 00:00:16,480
time and

6
00:00:16,480 --> 00:00:18,080
in this session we'll give you a deep

7
00:00:18,080 --> 00:00:20,080
dive into one of them the kashmir black

8
00:00:20,080 --> 00:00:21,279
botnet

9
00:00:21,279 --> 00:00:22,720
and i will start by talking about

10
00:00:22,720 --> 00:00:24,560
botnets in general and describe the

11
00:00:24,560 --> 00:00:26,560
kashmir black and its entities

12
00:00:26,560 --> 00:00:28,640
dino phil will present the operation and

13
00:00:28,640 --> 00:00:30,000
talk about the devops behind

14
00:00:30,000 --> 00:00:32,159
it

15
00:00:33,840 --> 00:00:36,399
i'm sorry

16
00:00:37,920 --> 00:00:40,480
but first let me introduce myself and my

17
00:00:40,480 --> 00:00:41,760
name is sarit and i'm a security

18
00:00:41,760 --> 00:00:43,680
researcher at imperva for the last 10

19
00:00:43,680 --> 00:00:44,480
years

20
00:00:44,480 --> 00:00:46,000
i mainly focus on my application

21
00:00:46,000 --> 00:00:48,079
security and i develop algorithms to

22
00:00:48,079 --> 00:00:50,320
detect and protect against attacks

23
00:00:50,320 --> 00:00:52,000
my colleague of fear is a security

24
00:00:52,000 --> 00:00:53,840
researcher at imperva for the last five

25
00:00:53,840 --> 00:00:54,640
years

26
00:00:54,640 --> 00:00:56,480
his focus is in database and web

27
00:00:56,480 --> 00:00:59,280
application security

28
00:00:59,280 --> 00:01:00,879
before we start to deep dive into

29
00:01:00,879 --> 00:01:02,960
cashmere black i would like to talk

30
00:01:02,960 --> 00:01:06,000
about botnets in general

31
00:01:06,000 --> 00:01:08,159
so there are many kinds of botnets

32
00:01:08,159 --> 00:01:09,520
buttons that infect iot

33
00:01:09,520 --> 00:01:13,200
devices windows machines linux servers

34
00:01:13,200 --> 00:01:15,360
some target the endpoint and others

35
00:01:15,360 --> 00:01:17,280
target the servers

36
00:01:17,280 --> 00:01:20,720
now when talking about botnet purposes

37
00:01:20,720 --> 00:01:22,479
there are cryptojacking botnets that

38
00:01:22,479 --> 00:01:24,840
infect machines in order to mine for

39
00:01:24,840 --> 00:01:26,320
cryptocurrencies

40
00:01:26,320 --> 00:01:28,880
other botnets manage phishing campaigns

41
00:01:28,880 --> 00:01:30,159
and are used to distribute

42
00:01:30,159 --> 00:01:33,840
malware via phishing emails

43
00:01:33,840 --> 00:01:36,159
there are botnets that used to perform

44
00:01:36,159 --> 00:01:38,560
ddos attacks by sending an overwhelming

45
00:01:38,560 --> 00:01:40,640
number of requests to a targeted server

46
00:01:40,640 --> 00:01:42,880
or an application

47
00:01:42,880 --> 00:01:44,799
in addition there are scraping botnets

48
00:01:44,799 --> 00:01:46,799
that are being used to extract data from

49
00:01:46,799 --> 00:01:48,159
websites

50
00:01:48,159 --> 00:01:50,640
and even a contact over botnets that are

51
00:01:50,640 --> 00:01:52,840
being used to validate combinations of

52
00:01:52,840 --> 00:01:54,000
credentials

53
00:01:54,000 --> 00:01:56,960
resulting in identity stats and other

54
00:01:56,960 --> 00:01:57,759
botnets

55
00:01:57,759 --> 00:02:00,000
are offered for rent and may use for any

56
00:02:00,000 --> 00:02:02,479
purpose

57
00:02:02,479 --> 00:02:04,399
before i dive into the bits and bytes of

58
00:02:04,399 --> 00:02:06,240
our research i would like to introduce

59
00:02:06,240 --> 00:02:09,520
you with the cashmere blackboardnet

60
00:02:09,520 --> 00:02:12,800
so it all started on november 2019

61
00:02:12,800 --> 00:02:15,360
and last 11 months which is basically

62
00:02:15,360 --> 00:02:18,000
our research period of time

63
00:02:18,000 --> 00:02:20,160
we discovered a botnet that attacks

64
00:02:20,160 --> 00:02:22,959
popular cms platforms such as wordpress

65
00:02:22,959 --> 00:02:24,319
joomla magento

66
00:02:24,319 --> 00:02:26,239
in more than 60 different countries

67
00:02:26,239 --> 00:02:28,239
around the world

68
00:02:28,239 --> 00:02:30,400
it performs mills of attacks per day on

69
00:02:30,400 --> 00:02:31,280
average

70
00:02:31,280 --> 00:02:33,360
and we calculated that there were

71
00:02:33,360 --> 00:02:35,440
hundreds of thousands of bots out there

72
00:02:35,440 --> 00:02:38,560
participated in the botnet operation

73
00:02:38,560 --> 00:02:40,519
those bots utilize dozens of

74
00:02:40,519 --> 00:02:41,840
non-vulnerabilities

75
00:02:41,840 --> 00:02:43,840
with different attack types like file

76
00:02:43,840 --> 00:02:45,920
upload remote code execution

77
00:02:45,920 --> 00:02:48,959
and many more this session

78
00:02:48,959 --> 00:02:51,120
is a journey into the botnet core from

79
00:02:51,120 --> 00:02:52,800
the attacker point of view

80
00:02:52,800 --> 00:02:56,080
so let's start

81
00:02:56,400 --> 00:02:58,480
security research investigation can

82
00:02:58,480 --> 00:03:00,080
sometimes be like a crime scene

83
00:03:00,080 --> 00:03:01,440
investigation

84
00:03:01,440 --> 00:03:03,760
but our crime scene is spread over the

85
00:03:03,760 --> 00:03:04,720
network

86
00:03:04,720 --> 00:03:07,519
with nobody in place so we need to

87
00:03:07,519 --> 00:03:09,519
collect the clues and fingerprints

88
00:03:09,519 --> 00:03:11,599
to construct a picture of the virtual

89
00:03:11,599 --> 00:03:14,000
crime

90
00:03:14,080 --> 00:03:15,760
as part of a study carried out at

91
00:03:15,760 --> 00:03:18,319
imperva we observed around 9 million

92
00:03:18,319 --> 00:03:20,720
attack attempts exploiting php unit

93
00:03:20,720 --> 00:03:22,480
remote code execution

94
00:03:22,480 --> 00:03:25,280
and we were wondering why is this cv so

95
00:03:25,280 --> 00:03:27,200
popular among attackers

96
00:03:27,200 --> 00:03:30,159
and to understand this hive we started

97
00:03:30,159 --> 00:03:32,400
to analyze attacks from our data lake

98
00:03:32,400 --> 00:03:34,480
we saw different ips using the same

99
00:03:34,480 --> 00:03:36,480
payload over and over again

100
00:03:36,480 --> 00:03:38,640
attacking different customers which

101
00:03:38,640 --> 00:03:41,280
remind us abutment behavior

102
00:03:41,280 --> 00:03:43,120
so we decided to download the payload

103
00:03:43,120 --> 00:03:44,720
and dive in

104
00:03:44,720 --> 00:03:46,640
and we basically started the mapping

105
00:03:46,640 --> 00:03:47,760
step

106
00:03:47,760 --> 00:03:49,360
we downloaded the code and performed

107
00:03:49,360 --> 00:03:51,360
analysis we revealed

108
00:03:51,360 --> 00:03:53,200
all the entities of the operation and

109
00:03:53,200 --> 00:03:54,560
later on we'll talk about them in

110
00:03:54,560 --> 00:03:56,319
further detail

111
00:03:56,319 --> 00:03:59,680
the next step we took was infiltrate

112
00:03:59,680 --> 00:04:01,680
we saw that the budget is updating on a

113
00:04:01,680 --> 00:04:03,120
regular basis

114
00:04:03,120 --> 00:04:05,439
and we decided to act like a bot and

115
00:04:05,439 --> 00:04:08,720
gather these objects for later analysis

116
00:04:08,720 --> 00:04:11,360
and finally we played a victim we

117
00:04:11,360 --> 00:04:12,720
created a honeypot

118
00:04:12,720 --> 00:04:14,319
in order to understand this plus

119
00:04:14,319 --> 00:04:17,360
exploitation stage

120
00:04:17,680 --> 00:04:20,238
so let's review all those entities that

121
00:04:20,238 --> 00:04:23,520
play a role in this massive operation

122
00:04:23,520 --> 00:04:25,919
when looking at a budget entities we can

123
00:04:25,919 --> 00:04:28,400
split them into three groups

124
00:04:28,400 --> 00:04:31,440
the buttons infrastructure the botnet

125
00:04:31,440 --> 00:04:33,440
third party services

126
00:04:33,440 --> 00:04:36,720
and the botnet actors inside the buttons

127
00:04:36,720 --> 00:04:38,639
infrastructure we have the cnc

128
00:04:38,639 --> 00:04:42,160
and repositories amd under the third

129
00:04:42,160 --> 00:04:43,199
party services

130
00:04:43,199 --> 00:04:46,720
we have github baseband and drawbox that

131
00:04:46,720 --> 00:04:48,880
our attacker was using in one hand to

132
00:04:48,880 --> 00:04:50,479
camouflage the operation

133
00:04:50,479 --> 00:04:52,560
and on the other hand to make the button

134
00:04:52,560 --> 00:04:54,720
more flexible

135
00:04:54,720 --> 00:04:56,960
and under the botnet actors we have the

136
00:04:56,960 --> 00:04:59,199
victim and two types of bots

137
00:04:59,199 --> 00:05:00,720
pending and spreading and i will

138
00:05:00,720 --> 00:05:02,639
describe the difference between these

139
00:05:02,639 --> 00:05:07,039
later on the first entity in the bonded

140
00:05:07,039 --> 00:05:08,080
infrastructure

141
00:05:08,080 --> 00:05:09,759
which is responsible for the entire

142
00:05:09,759 --> 00:05:12,400
operation is the command control

143
00:05:12,400 --> 00:05:14,160
and here we can see the login screen of

144
00:05:14,160 --> 00:05:16,000
the cnc

145
00:05:16,000 --> 00:05:18,000
the kashmir black cnc is located in

146
00:05:18,000 --> 00:05:19,199
indonesia and has

147
00:05:19,199 --> 00:05:21,840
three main rules it supplies attack

148
00:05:21,840 --> 00:05:23,680
instructions to bot

149
00:05:23,680 --> 00:05:26,800
it receives attack reports from bots

150
00:05:26,800 --> 00:05:29,039
and it supplies a malicious script that

151
00:05:29,039 --> 00:05:32,320
infects the victim server

152
00:05:32,720 --> 00:05:34,560
here is a snapshot of the infection

153
00:05:34,560 --> 00:05:37,440
script we consider the attacker define a

154
00:05:37,440 --> 00:05:38,160
parameter

155
00:05:38,160 --> 00:05:41,120
that represents a ground up task this

156
00:05:41,120 --> 00:05:41,919
task

157
00:05:41,919 --> 00:05:44,080
contains a python script and scheduled

158
00:05:44,080 --> 00:05:46,880
to run every three minutes

159
00:05:46,880 --> 00:05:49,280
it includes several imports and it uses

160
00:05:49,280 --> 00:05:51,759
basic c4 encoding to obfuscate his

161
00:05:51,759 --> 00:05:54,000
malicious payload

162
00:05:54,000 --> 00:05:56,160
the output of this task will be sent to

163
00:05:56,160 --> 00:06:00,639
dev now so no history will be saved

164
00:06:00,800 --> 00:06:03,199
in the next code block we consider the

165
00:06:03,199 --> 00:06:05,840
attacker redefines the victim cron task

166
00:06:05,840 --> 00:06:07,360
to include this malicious

167
00:06:07,360 --> 00:06:09,759
python task and as part of this

168
00:06:09,759 --> 00:06:11,039
redefinition

169
00:06:11,039 --> 00:06:13,039
the attacker makes sure to remove all

170
00:06:13,039 --> 00:06:15,199
main notifications

171
00:06:15,199 --> 00:06:17,440
and there is one interesting thing to

172
00:06:17,440 --> 00:06:18,400
note here

173
00:06:18,400 --> 00:06:20,240
is that the attacker was using the

174
00:06:20,240 --> 00:06:22,479
combination of pearl and python

175
00:06:22,479 --> 00:06:24,720
which are both installed out of the box

176
00:06:24,720 --> 00:06:26,639
in many linux systems

177
00:06:26,639 --> 00:06:28,960
and basically this increases the

178
00:06:28,960 --> 00:06:32,880
probability of a successful infection

179
00:06:33,039 --> 00:06:35,600
let's move to the repositories the

180
00:06:35,600 --> 00:06:37,120
original repository a

181
00:06:37,120 --> 00:06:39,440
as you can see is a printer component

182
00:06:39,440 --> 00:06:40,880
shopping site

183
00:06:40,880 --> 00:06:42,880
it was hacked by the attacker and was

184
00:06:42,880 --> 00:06:44,800
used to store the communication script

185
00:06:44,800 --> 00:06:45,440
file

186
00:06:45,440 --> 00:06:49,120
to communicate with the cnc

187
00:06:49,120 --> 00:06:51,039
another type of a positive entity in the

188
00:06:51,039 --> 00:06:53,520
botnet is repository b

189
00:06:53,520 --> 00:06:56,400
which is um it was classified as an

190
00:06:56,400 --> 00:06:57,759
educational institute

191
00:06:57,759 --> 00:06:59,440
and was used by the attacker to stop

192
00:06:59,440 --> 00:07:02,240
bundles of export and payloads

193
00:07:02,240 --> 00:07:04,080
and here is an example of the export

194
00:07:04,080 --> 00:07:06,000
payload bundles

195
00:07:06,000 --> 00:07:08,160
the attacker files are located under the

196
00:07:08,160 --> 00:07:10,400
css path

197
00:07:10,400 --> 00:07:13,120
among other css files used by this

198
00:07:13,120 --> 00:07:15,520
innocent web server

199
00:07:15,520 --> 00:07:17,599
the name of the bundle files start with

200
00:07:17,599 --> 00:07:19,599
the in-memory prefix

201
00:07:19,599 --> 00:07:22,400
and there are actually zip files hidden

202
00:07:22,400 --> 00:07:24,720
with the css extension

203
00:07:24,720 --> 00:07:28,800
and here is their modification date and

204
00:07:28,800 --> 00:07:31,280
one of the best qualities of this botnet

205
00:07:31,280 --> 00:07:33,199
is that the infrastructure is just like

206
00:07:33,199 --> 00:07:34,479
plug and play

207
00:07:34,479 --> 00:07:36,240
the attacker can expand his target

208
00:07:36,240 --> 00:07:38,880
victims and add new exploit by just

209
00:07:38,880 --> 00:07:40,000
uploading them here

210
00:07:40,000 --> 00:07:42,720
under the css directory and no

211
00:07:42,720 --> 00:07:45,360
infrastructure changes are required

212
00:07:45,360 --> 00:07:47,759
and i must add that every file here

213
00:07:47,759 --> 00:07:48,879
represents an

214
00:07:48,879 --> 00:07:50,560
exploit the target a specific

215
00:07:50,560 --> 00:07:53,280
vulnerability

216
00:07:54,479 --> 00:07:56,800
here is a partial list of cves the

217
00:07:56,800 --> 00:08:00,000
button it uses as part of its operation

218
00:08:00,000 --> 00:08:01,759
among them we can see remote code

219
00:08:01,759 --> 00:08:04,000
execution file upload remote file

220
00:08:04,000 --> 00:08:06,160
include and and many more

221
00:08:06,160 --> 00:08:07,680
these vulnerabilities are related to

222
00:08:07,680 --> 00:08:10,080
different plugins widgets and themes

223
00:08:10,080 --> 00:08:14,720
and some are even a decade-old from 2011

224
00:08:14,720 --> 00:08:16,639
and the conclusion here is that it's not

225
00:08:16,639 --> 00:08:19,120
necessary to use an exotic exploit

226
00:08:19,120 --> 00:08:22,560
in order to expand a button

227
00:08:23,280 --> 00:08:25,840
moving to the cloud-based services

228
00:08:25,840 --> 00:08:27,520
another type of entity used by the

229
00:08:27,520 --> 00:08:29,440
attacker is github

230
00:08:29,440 --> 00:08:31,520
it was used as a version control to

231
00:08:31,520 --> 00:08:33,440
store some of his files

232
00:08:33,440 --> 00:08:36,559
and when we checked the repositories we

233
00:08:36,559 --> 00:08:40,399
saw php web shells and cryptominers

234
00:08:40,399 --> 00:08:43,279
and we can say that by using github the

235
00:08:43,279 --> 00:08:45,760
button achieves a layer of flexibility

236
00:08:45,760 --> 00:08:47,519
as the attacker can easily update and

237
00:08:47,519 --> 00:08:48,959
find this repository

238
00:08:48,959 --> 00:08:50,480
without interfering with the buttons

239
00:08:50,480 --> 00:08:52,959
activity

240
00:08:53,120 --> 00:08:55,839
another entity is spacebeam which is a

241
00:08:55,839 --> 00:08:58,000
website that allows anonymous users to

242
00:08:58,000 --> 00:09:00,640
share plain text through public posts

243
00:09:00,640 --> 00:09:03,200
they are called paste and the attacker

244
00:09:03,200 --> 00:09:04,240
use this space

245
00:09:04,240 --> 00:09:06,959
as a quick and easy way to access and

246
00:09:06,959 --> 00:09:08,800
download vectors through the infection

247
00:09:08,800 --> 00:09:11,279
step in the buttons operation

248
00:09:11,279 --> 00:09:13,600
and later we'll show how dropbox was

249
00:09:13,600 --> 00:09:16,080
used in order to upgrade the botnet

250
00:09:16,080 --> 00:09:17,920
hide the operation behind legit cloud

251
00:09:17,920 --> 00:09:23,600
services and also to secure the cnc

252
00:09:23,600 --> 00:09:25,440
now let's talk about the two types of

253
00:09:25,440 --> 00:09:26,880
bots

254
00:09:26,880 --> 00:09:30,320
first the spreading bot this bot

255
00:09:30,320 --> 00:09:32,399
constantly communicates with the cnc to

256
00:09:32,399 --> 00:09:33,360
receive attacking

257
00:09:33,360 --> 00:09:36,000
instructions there those are comments

258
00:09:36,000 --> 00:09:38,240
from the cnc telling him who to attack

259
00:09:38,240 --> 00:09:40,080
and how

260
00:09:40,080 --> 00:09:42,399
this bot is being used to infect new

261
00:09:42,399 --> 00:09:43,360
machines

262
00:09:43,360 --> 00:09:46,399
and to expand the botnet and a victim

263
00:09:46,399 --> 00:09:48,560
that was infected by spreading bot

264
00:09:48,560 --> 00:09:51,760
can become one of two a spreading bot or

265
00:09:51,760 --> 00:09:54,160
a pending bot

266
00:09:54,160 --> 00:09:57,200
now let's talk about the pending bot and

267
00:09:57,200 --> 00:09:58,560
as i said before

268
00:09:58,560 --> 00:10:00,800
this bot is a victim side that was

269
00:10:00,800 --> 00:10:02,640
infected by spreading bot the one that

270
00:10:02,640 --> 00:10:04,160
appears here

271
00:10:04,160 --> 00:10:06,880
and as a result is under the control of

272
00:10:06,880 --> 00:10:08,320
the cnc

273
00:10:08,320 --> 00:10:11,839
and it stays in idle mode until the cnc

274
00:10:11,839 --> 00:10:12,720
approach

275
00:10:12,720 --> 00:10:15,360
and change its purpose and actually this

276
00:10:15,360 --> 00:10:18,160
is why we named it pending bot

277
00:10:18,160 --> 00:10:19,680
and i will talk about the purpose in a

278
00:10:19,680 --> 00:10:22,000
bit but i want to add that the

279
00:10:22,000 --> 00:10:24,160
difference between them

280
00:10:24,160 --> 00:10:25,760
is that the pending bot does not

281
00:10:25,760 --> 00:10:29,519
initiate communication with the cnc

282
00:10:30,800 --> 00:10:32,720
let's move to the cashmere black botnet

283
00:10:32,720 --> 00:10:35,760
scope the infiltrate step

284
00:10:35,760 --> 00:10:37,839
the best way to learn an organization is

285
00:10:37,839 --> 00:10:39,519
to be part of it

286
00:10:39,519 --> 00:10:41,120
same for learning about the botnet

287
00:10:41,120 --> 00:10:44,839
operation and we call it the infiltrate

288
00:10:44,839 --> 00:10:46,560
step

289
00:10:46,560 --> 00:10:48,560
so once we mapped all the entities of

290
00:10:48,560 --> 00:10:50,880
the botnet we wanted to understand

291
00:10:50,880 --> 00:10:53,440
the scope of the botnet its victims the

292
00:10:53,440 --> 00:10:55,440
attack and its evolution

293
00:10:55,440 --> 00:10:58,240
and to answer those questions we had to

294
00:10:58,240 --> 00:10:59,760
take a more active approach to the

295
00:10:59,760 --> 00:11:01,519
investigation

296
00:11:01,519 --> 00:11:03,600
we learned the communication protocol

297
00:11:03,600 --> 00:11:05,519
between the bot and the scene scene and

298
00:11:05,519 --> 00:11:06,959
we mimicked it

299
00:11:06,959 --> 00:11:09,519
we infiltrated the botnet by constant

300
00:11:09,519 --> 00:11:11,760
communication with the cnc

301
00:11:11,760 --> 00:11:14,000
we went undercover and impersonated the

302
00:11:14,000 --> 00:11:15,920
spreading but in the botnet

303
00:11:15,920 --> 00:11:17,839
and without actually attacking any

304
00:11:17,839 --> 00:11:20,000
targets we started to collect

305
00:11:20,000 --> 00:11:23,519
information about the botnet victims

306
00:11:23,519 --> 00:11:26,320
and here is an example of a request from

307
00:11:26,320 --> 00:11:27,360
spreading bot

308
00:11:27,360 --> 00:11:29,760
to the cnc asking to get the attack

309
00:11:29,760 --> 00:11:31,040
instructions

310
00:11:31,040 --> 00:11:32,800
and we can say that there is a special

311
00:11:32,800 --> 00:11:34,880
header that without it

312
00:11:34,880 --> 00:11:37,680
the cnc will not retain anything this

313
00:11:37,680 --> 00:11:40,320
special user agent archer ghost 8

314
00:11:40,320 --> 00:11:42,880
is some kind of a security mechanism to

315
00:11:42,880 --> 00:11:43,360
prevent

316
00:11:43,360 --> 00:11:46,480
unauthorized access and although this is

317
00:11:46,480 --> 00:11:48,240
not a sophisticated authentication

318
00:11:48,240 --> 00:11:49,120
mechanism

319
00:11:49,120 --> 00:11:51,519
it is a basic security control for the

320
00:11:51,519 --> 00:11:54,000
cnc

321
00:11:54,480 --> 00:11:57,680
now as a result to the request we just

322
00:11:57,680 --> 00:11:58,320
saw

323
00:11:58,320 --> 00:12:00,399
the pending bot will get attack

324
00:12:00,399 --> 00:12:01,519
instructions

325
00:12:01,519 --> 00:12:05,040
from the in json format from the cnc

326
00:12:05,040 --> 00:12:08,320
and the first parameter the script

327
00:12:08,320 --> 00:12:10,240
contains the commands that will be

328
00:12:10,240 --> 00:12:12,800
executed by the spreading bot

329
00:12:12,800 --> 00:12:14,800
first it will run the curl command to

330
00:12:14,800 --> 00:12:16,800
download the export payload bundle

331
00:12:16,800 --> 00:12:19,440
that will be used to infect the victim

332
00:12:19,440 --> 00:12:22,320
and here we can see the file to download

333
00:12:22,320 --> 00:12:24,880
and it's it we can see that it's located

334
00:12:24,880 --> 00:12:27,440
under the css directory in repository

335
00:12:27,440 --> 00:12:30,480
the one that just show i just showed you

336
00:12:30,480 --> 00:12:33,839
and the second parameter the payload

337
00:12:33,839 --> 00:12:36,399
contained contains a list of victims

338
00:12:36,399 --> 00:12:37,680
site that will be attacked by the

339
00:12:37,680 --> 00:12:39,680
spreading bot

340
00:12:39,680 --> 00:12:42,240
the last parameter is the host name or

341
00:12:42,240 --> 00:12:42,880
ip

342
00:12:42,880 --> 00:12:46,560
that holds all those victim sites

343
00:12:46,800 --> 00:12:49,519
now as i said before we impersonated a

344
00:12:49,519 --> 00:12:51,200
spreading bot in the botnet

345
00:12:51,200 --> 00:12:53,519
by sending a request every three minutes

346
00:12:53,519 --> 00:12:55,200
to fetch attack instructions from the

347
00:12:55,200 --> 00:12:56,800
cnc

348
00:12:56,800 --> 00:12:59,440
we gathered all these instructions for

349
00:12:59,440 --> 00:13:00,720
further analysis

350
00:13:00,720 --> 00:13:03,920
and we use shorthand api to extract

351
00:13:03,920 --> 00:13:07,279
the organization the country they ascend

352
00:13:07,279 --> 00:13:10,079
vulnerabilities and open ports and they

353
00:13:10,079 --> 00:13:10,560
install

354
00:13:10,560 --> 00:13:13,600
components of each target then

355
00:13:13,600 --> 00:13:16,079
we inserted everything into a database

356
00:13:16,079 --> 00:13:18,160
for a detailed analysis

357
00:13:18,160 --> 00:13:21,279
so let's see what we learned

358
00:13:21,279 --> 00:13:23,519
one of the things we wanted to learn was

359
00:13:23,519 --> 00:13:25,760
about the location of the targets

360
00:13:25,760 --> 00:13:27,920
to see if there is a specific country

361
00:13:27,920 --> 00:13:30,720
that that is botnet targets

362
00:13:30,720 --> 00:13:32,240
and here is the distribution of the

363
00:13:32,240 --> 00:13:34,079
attack targets divided by

364
00:13:34,079 --> 00:13:37,440
country and it's a bit hard to see

365
00:13:37,440 --> 00:13:39,839
but we found 60 different countries

366
00:13:39,839 --> 00:13:42,079
these botnet targets

367
00:13:42,079 --> 00:13:44,240
it appears that the majority of the

368
00:13:44,240 --> 00:13:46,240
targets are located in the us

369
00:13:46,240 --> 00:13:49,360
this is the blue part but since a lot of

370
00:13:49,360 --> 00:13:51,199
servers are actually hosted by cloud

371
00:13:51,199 --> 00:13:52,480
providers

372
00:13:52,480 --> 00:13:54,399
the original country of the server does

373
00:13:54,399 --> 00:13:56,399
not necessarily reflect on their origin

374
00:13:56,399 --> 00:13:59,040
of the victim

375
00:13:59,440 --> 00:14:01,040
another interesting question we're

376
00:14:01,040 --> 00:14:03,040
curious about is

377
00:14:03,040 --> 00:14:06,079
how the attacker find his targets so we

378
00:14:06,079 --> 00:14:07,680
believe that the attacker has some sort

379
00:14:07,680 --> 00:14:09,680
of a scanner that scans for potential

380
00:14:09,680 --> 00:14:11,760
vulnerable targets

381
00:14:11,760 --> 00:14:14,079
and this scanner probably uses sheldon

382
00:14:14,079 --> 00:14:16,399
or similar service like binary edge

383
00:14:16,399 --> 00:14:18,560
to locate for potential targets by

384
00:14:18,560 --> 00:14:20,639
searching for specific vulnerability or

385
00:14:20,639 --> 00:14:22,800
open ports

386
00:14:22,800 --> 00:14:25,680
another method this attacker may use is

387
00:14:25,680 --> 00:14:27,920
running cms vulnerability scanners

388
00:14:27,920 --> 00:14:30,959
like cms map or wp scan

389
00:14:30,959 --> 00:14:32,880
that helps with finding potential and

390
00:14:32,880 --> 00:14:35,360
vulnerable targets

391
00:14:35,360 --> 00:14:38,480
so once a target is identified it is

392
00:14:38,480 --> 00:14:40,639
being initiated inside a queue

393
00:14:40,639 --> 00:14:43,600
in the cnc for a future attack and

394
00:14:43,600 --> 00:14:45,279
basically when a pending bot

395
00:14:45,279 --> 00:14:46,880
will fetch attack instruction from the

396
00:14:46,880 --> 00:14:48,720
cnc the target will

397
00:14:48,720 --> 00:14:52,160
will be taken from this queue

398
00:14:52,880 --> 00:14:56,000
moving to the botnet purposes

399
00:14:56,000 --> 00:14:58,160
so in order to understand the purpose of

400
00:14:58,160 --> 00:15:00,240
those victims spending bots

401
00:15:00,240 --> 00:15:03,440
we had to become a victim ourself

402
00:15:03,440 --> 00:15:05,760
so we created a cms honeypot and

403
00:15:05,760 --> 00:15:07,680
attacked it with our spreading bot from

404
00:15:07,680 --> 00:15:10,240
the infiltration step

405
00:15:10,240 --> 00:15:12,240
we reported back to the cnc of a

406
00:15:12,240 --> 00:15:13,760
successful attack

407
00:15:13,760 --> 00:15:16,079
and by that our honeypot became a

408
00:15:16,079 --> 00:15:18,880
pending bot in the cashmere blackboard

409
00:15:18,880 --> 00:15:22,320
waiting for the cnc to approach

410
00:15:22,320 --> 00:15:24,480
so after we reported to the cnc of a

411
00:15:24,480 --> 00:15:27,279
successful attack it took the attacker

412
00:15:27,279 --> 00:15:29,040
one and a half hours to connect our

413
00:15:29,040 --> 00:15:32,000
honeypot which is kind of oppressive

414
00:15:32,000 --> 00:15:35,040
as it's very quickly and

415
00:15:35,040 --> 00:15:37,279
we had a sort of uh log inside the

416
00:15:37,279 --> 00:15:38,480
honeypot

417
00:15:38,480 --> 00:15:40,959
showing us which commander attacker did

418
00:15:40,959 --> 00:15:43,839
and which files he added or modified

419
00:15:43,839 --> 00:15:46,240
and we saw that he added a second web

420
00:15:46,240 --> 00:15:47,120
shows

421
00:15:47,120 --> 00:15:49,120
a second web shell with command

422
00:15:49,120 --> 00:15:51,759
execution vote capability

423
00:15:51,759 --> 00:15:54,079
then he ran several commands to escalate

424
00:15:54,079 --> 00:15:55,440
his privileges

425
00:15:55,440 --> 00:15:58,480
by using sim link and by that our

426
00:15:58,480 --> 00:15:59,040
attacker

427
00:15:59,040 --> 00:16:00,959
got complete control on the infected

428
00:16:00,959 --> 00:16:03,040
server

429
00:16:03,040 --> 00:16:05,600
now let's continue to the purposes of

430
00:16:05,600 --> 00:16:08,320
the botnet

431
00:16:08,320 --> 00:16:11,360
we saw five purposes about the first two

432
00:16:11,360 --> 00:16:13,199
we already discussed those are the

433
00:16:13,199 --> 00:16:15,600
pending bot and the spreading bot

434
00:16:15,600 --> 00:16:18,639
so we'll talk about the others an

435
00:16:18,639 --> 00:16:20,560
exciting purpose we observed is a

436
00:16:20,560 --> 00:16:23,680
cryptominer that mines monero coins

437
00:16:23,680 --> 00:16:26,240
and as part of the colonizers we did we

438
00:16:26,240 --> 00:16:28,000
got access to the hacker's

439
00:16:28,000 --> 00:16:30,560
payment address and we can see it's

440
00:16:30,560 --> 00:16:33,600
balanced in real time

441
00:16:33,600 --> 00:16:35,600
the next purpose was discovered as a

442
00:16:35,600 --> 00:16:37,759
result of our cms honeypot

443
00:16:37,759 --> 00:16:41,440
it was converted into a clickbait bot

444
00:16:41,440 --> 00:16:43,440
when we tried to access the honeypot's

445
00:16:43,440 --> 00:16:45,360
login page we were redirected

446
00:16:45,360 --> 00:16:49,120
to one of many clickbank sites

447
00:16:49,120 --> 00:16:52,160
the last purpose is defacement once we

448
00:16:52,160 --> 00:16:53,839
saw the defacement signature we

449
00:16:53,839 --> 00:16:55,600
discovered the nickname of the hacker

450
00:16:55,600 --> 00:16:57,440
behind the botnet

451
00:16:57,440 --> 00:16:59,519
we also discovered it is part of the

452
00:16:59,519 --> 00:17:00,639
indonesian

453
00:17:00,639 --> 00:17:04,000
hacker crew phantom ghost by searching

454
00:17:04,000 --> 00:17:05,599
the internet we found out more

455
00:17:05,599 --> 00:17:06,799
interesting information

456
00:17:06,799 --> 00:17:09,439
about the crew like the facebook page

457
00:17:09,439 --> 00:17:12,000
and even an online shop that sells the

458
00:17:12,000 --> 00:17:12,799
phantom ghost

459
00:17:12,799 --> 00:17:15,599
crew t-shirts

460
00:17:15,919 --> 00:17:18,400
now after we're familiar with all the

461
00:17:18,400 --> 00:17:19,359
entities

462
00:17:19,359 --> 00:17:21,280
we will continue and show the entire

463
00:17:21,280 --> 00:17:24,399
operation in life

464
00:17:24,720 --> 00:17:28,319
thank you sorry and hi everyone

465
00:17:28,319 --> 00:17:32,160
so how this botnet works

466
00:17:32,160 --> 00:17:35,280
it all starts when a bot exploits php

467
00:17:35,280 --> 00:17:37,440
unit remote code execution on a victim

468
00:17:37,440 --> 00:17:38,720
server

469
00:17:38,720 --> 00:17:40,880
it causes the victim server to download

470
00:17:40,880 --> 00:17:42,080
an infection script

471
00:17:42,080 --> 00:17:46,640
from the cnc then it will execute it

472
00:17:46,640 --> 00:17:48,799
now the infected server will approach

473
00:17:48,799 --> 00:17:50,240
repository a

474
00:17:50,240 --> 00:17:52,240
every three minutes to download the

475
00:17:52,240 --> 00:17:55,360
fresh communication script

476
00:17:55,360 --> 00:17:57,679
at this stage we can say that the victim

477
00:17:57,679 --> 00:17:59,600
server is part of the kashmir black

478
00:17:59,600 --> 00:18:02,159
apartment

479
00:18:02,880 --> 00:18:04,960
the newly infected bot communicates with

480
00:18:04,960 --> 00:18:07,600
the cnc to get attack instructions

481
00:18:07,600 --> 00:18:10,080
describing who to attack and which

482
00:18:10,080 --> 00:18:11,919
bundle to use

483
00:18:11,919 --> 00:18:14,000
the bot downloads the bundle from

484
00:18:14,000 --> 00:18:15,200
repository being

485
00:18:15,200 --> 00:18:18,400
and additional payloads from github and

486
00:18:18,400 --> 00:18:20,320
baseball

487
00:18:20,320 --> 00:18:23,200
then the bots attack the victim and on

488
00:18:23,200 --> 00:18:24,400
successful attack

489
00:18:24,400 --> 00:18:28,160
it will become part of the botnet

490
00:18:28,160 --> 00:18:30,640
as a last step in the process the bot

491
00:18:30,640 --> 00:18:31,520
report back

492
00:18:31,520 --> 00:18:34,320
to the sensing

493
00:18:34,799 --> 00:18:38,080
now that we are familiar with operation

494
00:18:38,080 --> 00:18:40,400
we can move on and describe the stages

495
00:18:40,400 --> 00:18:42,720
of the botnet since we discovered it

496
00:18:42,720 --> 00:18:46,559
and throughout the research period

497
00:18:47,679 --> 00:18:49,679
when we first met kashmir black it had

498
00:18:49,679 --> 00:18:51,360
around 10 exploits and

499
00:18:51,360 --> 00:18:54,480
only two payloads spending and spreading

500
00:18:54,480 --> 00:18:58,000
it focused only on growth increasing the

501
00:18:58,000 --> 00:19:00,240
size of the botnet

502
00:19:00,240 --> 00:19:02,240
then infrastructure changes started to

503
00:19:02,240 --> 00:19:04,799
emerge to make the botnet more

504
00:19:04,799 --> 00:19:08,080
stable and scalable

505
00:19:08,080 --> 00:19:10,960
compared to the first two stages the

506
00:19:10,960 --> 00:19:12,400
expansion stage

507
00:19:12,400 --> 00:19:15,600
is an ongoing process we saw more

508
00:19:15,600 --> 00:19:17,520
exploits and more payloads are

509
00:19:17,520 --> 00:19:19,520
being added during the entire research

510
00:19:19,520 --> 00:19:21,600
period

511
00:19:21,600 --> 00:19:24,080
now let's dive into each one of the

512
00:19:24,080 --> 00:19:25,600
stages

513
00:19:25,600 --> 00:19:29,039
starting with the growth

514
00:19:30,559 --> 00:19:33,520
cashmere black has an exponential growth

515
00:19:33,520 --> 00:19:35,200
i'm going to show you how we came to

516
00:19:35,200 --> 00:19:37,440
this conclusion

517
00:19:37,440 --> 00:19:42,240
so we observed 285 bots in our data lake

518
00:19:42,240 --> 00:19:45,919
attacking our customers but note that

519
00:19:45,919 --> 00:19:46,480
this is

520
00:19:46,480 --> 00:19:47,919
only a portion of the bots in the

521
00:19:47,919 --> 00:19:51,039
botnets since we see only traffic of our

522
00:19:51,039 --> 00:19:52,640
customers

523
00:19:52,640 --> 00:19:55,360
so for this example i'm going to round

524
00:19:55,360 --> 00:19:56,799
the numbers a little bit

525
00:19:56,799 --> 00:20:02,000
for simplicity and i will use 300 watts

526
00:20:02,000 --> 00:20:04,880
so we know that every bot performing

527
00:20:04,880 --> 00:20:07,600
attack every three minutes

528
00:20:07,600 --> 00:20:13,280
per day it will attack 480 targets

529
00:20:13,280 --> 00:20:16,559
the 300 bots together

530
00:20:16,559 --> 00:20:19,520
are performing 140 thousands of attacks

531
00:20:19,520 --> 00:20:21,600
per day

532
00:20:21,600 --> 00:20:24,159
now let's say that only half percent of

533
00:20:24,159 --> 00:20:25,679
all the targets are

534
00:20:25,679 --> 00:20:29,120
successfully infected it means that

535
00:20:29,120 --> 00:20:30,320
tomorrow

536
00:20:30,320 --> 00:20:34,480
we'll have 1 000 new bots

537
00:20:34,480 --> 00:20:39,360
in addition to our current 300 bucks

538
00:20:39,600 --> 00:20:42,480
by day number seven we will have almost

539
00:20:42,480 --> 00:20:43,120
half

540
00:20:43,120 --> 00:20:46,559
million bots the following chart

541
00:20:46,559 --> 00:20:51,440
illustrates the exponential growth

542
00:20:53,520 --> 00:20:56,559
now let's move on from the growth

543
00:20:56,559 --> 00:20:59,760
to the stability stage

544
00:21:01,200 --> 00:21:02,960
in this stage we will describe the

545
00:21:02,960 --> 00:21:04,720
evolution of the botnet

546
00:21:04,720 --> 00:21:07,280
over the research period and the devops

547
00:21:07,280 --> 00:21:09,280
strategy that enable it to carry out

548
00:21:09,280 --> 00:21:11,840
describes

549
00:21:12,159 --> 00:21:14,880
remember that the botnet had only one

550
00:21:14,880 --> 00:21:18,080
repository a and b

551
00:21:18,080 --> 00:21:20,880
once the botnet size increased so did a

552
00:21:20,880 --> 00:21:22,880
load on the repositories

553
00:21:22,880 --> 00:21:25,200
in addition since those repositories

554
00:21:25,200 --> 00:21:27,120
were actually legitimate sites

555
00:21:27,120 --> 00:21:30,000
they couldn't be considered as permanent

556
00:21:30,000 --> 00:21:32,880
and reliable entities

557
00:21:32,880 --> 00:21:36,400
the attacker had to take action

558
00:21:37,440 --> 00:21:39,520
three changes were implemented in the

559
00:21:39,520 --> 00:21:42,639
botnet infrastructure

560
00:21:42,840 --> 00:21:45,440
and the first is

561
00:21:45,440 --> 00:21:47,919
adding new entity repository a load

562
00:21:47,919 --> 00:21:50,000
balancer

563
00:21:50,000 --> 00:21:52,799
expand repository a into multiple

564
00:21:52,799 --> 00:21:54,559
repositories

565
00:21:54,559 --> 00:21:58,080
and expand repository b there were

566
00:21:58,080 --> 00:22:02,159
three main reasons behind these changes

567
00:22:02,159 --> 00:22:03,840
make the botnet more dynamic and

568
00:22:03,840 --> 00:22:05,360
scalable

569
00:22:05,360 --> 00:22:09,678
add redundancy and load balancing

570
00:22:10,640 --> 00:22:13,039
the following diagram shows the old

571
00:22:13,039 --> 00:22:14,159
infrastructure

572
00:22:14,159 --> 00:22:17,200
against the new one while

573
00:22:17,200 --> 00:22:19,440
in the old infrastructure every bot will

574
00:22:19,440 --> 00:22:21,840
address directly repository a

575
00:22:21,840 --> 00:22:24,720
in the new one each bot will address the

576
00:22:24,720 --> 00:22:26,080
load balancer

577
00:22:26,080 --> 00:22:28,080
and will get in return one of many

578
00:22:28,080 --> 00:22:30,879
repositories

579
00:22:32,640 --> 00:22:34,799
to integrate this change into the botnet

580
00:22:34,799 --> 00:22:36,640
operation an additional change in the

581
00:22:36,640 --> 00:22:38,400
botnet was required

582
00:22:38,400 --> 00:22:40,400
we will discuss this change later on

583
00:22:40,400 --> 00:22:41,520
when we will

584
00:22:41,520 --> 00:22:45,360
explore the upgrade process

585
00:22:46,480 --> 00:22:49,280
now let's talk about internal changes

586
00:22:49,280 --> 00:22:51,280
that were made in order to secure the

587
00:22:51,280 --> 00:22:52,000
cnc

588
00:22:52,000 --> 00:22:55,840
and the botnet operation

589
00:22:57,120 --> 00:22:59,520
the cnc is the most sensitive and

590
00:22:59,520 --> 00:23:01,200
important component in the entire

591
00:23:01,200 --> 00:23:02,559
operation

592
00:23:02,559 --> 00:23:06,080
securing it is critical let me take you

593
00:23:06,080 --> 00:23:08,240
back a little bit to the steps where we

594
00:23:08,240 --> 00:23:10,400
infiltrated a botnet and played the

595
00:23:10,400 --> 00:23:12,320
victim

596
00:23:12,320 --> 00:23:15,919
we created the honeypot attacked it with

597
00:23:15,919 --> 00:23:17,919
our spreading bot

598
00:23:17,919 --> 00:23:22,400
and reported back to the cnc we believe

599
00:23:22,400 --> 00:23:24,159
that the attacker grew suspicious

600
00:23:24,159 --> 00:23:27,039
as he performed two internal changes in

601
00:23:27,039 --> 00:23:28,880
order to avoid interfering with the

602
00:23:28,880 --> 00:23:30,880
batman

603
00:23:30,880 --> 00:23:34,080
reporting everest was changed and both

604
00:23:34,080 --> 00:23:35,600
ip tracking mechanism

605
00:23:35,600 --> 00:23:38,158
was added

606
00:23:39,840 --> 00:23:41,679
the first change is related to the

607
00:23:41,679 --> 00:23:43,440
reporting address

608
00:23:43,440 --> 00:23:46,080
this change helps with managing bots and

609
00:23:46,080 --> 00:23:48,000
versions

610
00:23:48,000 --> 00:23:50,559
bots that report to the new address is a

611
00:23:50,559 --> 00:23:53,039
new bot

612
00:23:53,840 --> 00:23:56,400
second change is within the botnet's

613
00:23:56,400 --> 00:23:59,200
communication script

614
00:23:59,200 --> 00:24:00,960
it was updated with a bar tracking

615
00:24:00,960 --> 00:24:02,880
mechanism

616
00:24:02,880 --> 00:24:05,039
a simple architectural change adds the

617
00:24:05,039 --> 00:24:06,080
bot ip

618
00:24:06,080 --> 00:24:08,320
and country while it communicated with

619
00:24:08,320 --> 00:24:10,000
the cnc

620
00:24:10,000 --> 00:24:13,200
it allowed the cnc to track and monitor

621
00:24:13,200 --> 00:24:16,480
the operation of each bot in the botnet

622
00:24:16,480 --> 00:24:18,080
there are two goals behind this

623
00:24:18,080 --> 00:24:19,679
mechanism

624
00:24:19,679 --> 00:24:22,559
the first is to secure the botnet and

625
00:24:22,559 --> 00:24:23,279
the second

626
00:24:23,279 --> 00:24:27,520
is to manage bots versions and upgrades

627
00:24:27,520 --> 00:24:32,559
now let's see how it comes to work

628
00:24:32,559 --> 00:24:34,559
the changes that we described created a

629
00:24:34,559 --> 00:24:35,760
situation where

630
00:24:35,760 --> 00:24:37,600
some bots were using the new

631
00:24:37,600 --> 00:24:38,880
infrastructure

632
00:24:38,880 --> 00:24:42,480
while others were only aware of the old

633
00:24:42,480 --> 00:24:44,159
one

634
00:24:44,159 --> 00:24:46,080
this diagram described the upgrade

635
00:24:46,080 --> 00:24:47,919
process

636
00:24:47,919 --> 00:24:50,720
on the left side you can see the old

637
00:24:50,720 --> 00:24:52,880
infrastructure

638
00:24:52,880 --> 00:24:54,880
when an old bot communicates with the

639
00:24:54,880 --> 00:24:58,960
cnc without the ip tracking header

640
00:24:58,960 --> 00:25:00,960
the cnc in return sends back attack

641
00:25:00,960 --> 00:25:02,000
instructions

642
00:25:02,000 --> 00:25:03,679
that inspect the bot to download the

643
00:25:03,679 --> 00:25:07,279
upgrade script from repository b

644
00:25:07,279 --> 00:25:10,080
once the bot executes the upgrade script

645
00:25:10,080 --> 00:25:10,960
it will turn

646
00:25:10,960 --> 00:25:14,320
into a new bot that is now aware of the

647
00:25:14,320 --> 00:25:14,799
new

648
00:25:14,799 --> 00:25:18,320
infrastructure on the

649
00:25:18,320 --> 00:25:20,720
on the right side the upgraded bot will

650
00:25:20,720 --> 00:25:22,559
address the load balancer

651
00:25:22,559 --> 00:25:26,840
to get to get one of many

652
00:25:26,840 --> 00:25:29,840
repositories the script

653
00:25:29,840 --> 00:25:33,039
is actually changing the contact job

654
00:25:33,039 --> 00:25:34,240
that sarit mentioned

655
00:25:34,240 --> 00:25:36,720
earlier

656
00:25:37,760 --> 00:25:40,720
now let's talk about migrating the cnc

657
00:25:40,720 --> 00:25:43,279
to a cloud-based service

658
00:25:43,279 --> 00:25:45,520
there are fundamental problems in the

659
00:25:45,520 --> 00:25:46,880
botnet architecture

660
00:25:46,880 --> 00:25:48,960
since bots communicating directly with

661
00:25:48,960 --> 00:25:51,039
the cnc and the repositories

662
00:25:51,039 --> 00:25:54,240
their ip is exposed and security

663
00:25:54,240 --> 00:25:54,960
controls

664
00:25:54,960 --> 00:25:57,760
may block them an interesting

665
00:25:57,760 --> 00:25:59,120
infrastructure change

666
00:25:59,120 --> 00:26:02,400
has evolved to solve this problem

667
00:26:02,400 --> 00:26:07,039
integrating drawbacks into the operation

668
00:26:07,760 --> 00:26:09,760
instead of communicating directly with

669
00:26:09,760 --> 00:26:11,440
the infrastructure entities

670
00:26:11,440 --> 00:26:14,320
the cnc and the repositories the bots

671
00:26:14,320 --> 00:26:15,679
are now communicating

672
00:26:15,679 --> 00:26:19,520
only with dropbox now dropbox api is

673
00:26:19,520 --> 00:26:21,840
being used to fetch attack instructions

674
00:26:21,840 --> 00:26:25,760
and to upload reports from bots

675
00:26:25,760 --> 00:26:28,320
this is a big step towards cam flashing

676
00:26:28,320 --> 00:26:29,600
the button traffic

677
00:26:29,600 --> 00:26:32,880
securing the cnc operation and most

678
00:26:32,880 --> 00:26:34,720
importantly

679
00:26:34,720 --> 00:26:37,520
making it hard make it difficult to

680
00:26:37,520 --> 00:26:39,360
trace back to the hacker behind the

681
00:26:39,360 --> 00:26:41,840
operation

682
00:26:42,400 --> 00:26:44,559
when we discovered this change we were

683
00:26:44,559 --> 00:26:45,520
very excited

684
00:26:45,520 --> 00:26:47,279
since we had the authorization key of

685
00:26:47,279 --> 00:26:50,720
the dropbox account of the attacker

686
00:26:50,720 --> 00:26:53,279
we thought we thought to ourselves it

687
00:26:53,279 --> 00:26:54,240
will be fun to

688
00:26:54,240 --> 00:26:57,360
connect and see what's going on we

689
00:26:57,360 --> 00:26:59,120
started to fetch all the files from the

690
00:26:59,120 --> 00:27:00,000
account

691
00:27:00,000 --> 00:27:03,600
and we saw info the structure of the

692
00:27:03,600 --> 00:27:05,200
account

693
00:27:05,200 --> 00:27:08,480
sorry so the directory is

694
00:27:08,480 --> 00:27:12,720
adelia p we believe that the name adelia

695
00:27:12,720 --> 00:27:14,960
is significant for the attacker because

696
00:27:14,960 --> 00:27:17,200
we saw it in several places during our

697
00:27:17,200 --> 00:27:18,640
analysis

698
00:27:18,640 --> 00:27:21,840
it used in passwords and inside urls

699
00:27:21,840 --> 00:27:24,639
inside the cnc

700
00:27:25,360 --> 00:27:28,399
next we have the payload directory

701
00:27:28,399 --> 00:27:29,840
that was used to store attack

702
00:27:29,840 --> 00:27:32,640
instructions we found

703
00:27:32,640 --> 00:27:35,520
400 thousands of attack instructions in

704
00:27:35,520 --> 00:27:37,840
place

705
00:27:38,559 --> 00:27:42,240
next we have the loot directory

706
00:27:42,240 --> 00:27:45,679
and it only have one subdirectory

707
00:27:45,679 --> 00:27:49,279
called nosql nosql is

708
00:27:49,279 --> 00:27:51,200
one of the bundles that added by the

709
00:27:51,200 --> 00:27:53,120
attacker to repository bin

710
00:27:53,120 --> 00:27:56,480
meant to attack nosql databases with

711
00:27:56,480 --> 00:28:00,840
several types of nosql injection

712
00:28:00,840 --> 00:28:05,679
inside we found only one report

713
00:28:05,679 --> 00:28:08,080
putting it all together the loot

714
00:28:08,080 --> 00:28:10,080
directory supposed to store the

715
00:28:10,080 --> 00:28:12,159
successful attack reports uploaded by

716
00:28:12,159 --> 00:28:13,360
bots

717
00:28:13,360 --> 00:28:16,240
splitted into subdirectories for each

718
00:28:16,240 --> 00:28:18,640
exploit bundle

719
00:28:18,640 --> 00:28:21,440
the assumption is that the attacker was

720
00:28:21,440 --> 00:28:23,679
in the middle of transition

721
00:28:23,679 --> 00:28:26,880
maybe in the testing phase this is

722
00:28:26,880 --> 00:28:28,399
another piece in the puzzle

723
00:28:28,399 --> 00:28:30,559
that helps us to sing to the attacker's

724
00:28:30,559 --> 00:28:33,440
world and understand the operation

725
00:28:33,440 --> 00:28:36,080
a glimpse into a development cycle in a

726
00:28:36,080 --> 00:28:38,480
making

727
00:28:40,080 --> 00:28:42,559
by that we close the stabili the stage

728
00:28:42,559 --> 00:28:43,440
of stability

729
00:28:43,440 --> 00:28:46,640
and now we will focus on the extension

730
00:28:46,640 --> 00:28:49,039
stage

731
00:28:50,799 --> 00:28:53,039
as i said before the expansion stage is

732
00:28:53,039 --> 00:28:54,799
an ongoing process

733
00:28:54,799 --> 00:28:56,880
the attacker adds new exploits on a

734
00:28:56,880 --> 00:28:58,640
regular basis

735
00:28:58,640 --> 00:29:01,200
over the research period the exploits

736
00:29:01,200 --> 00:29:02,399
were extended from

737
00:29:02,399 --> 00:29:07,120
10 to 17 targeting new domains

738
00:29:07,120 --> 00:29:09,520
expanding the botnet targets from cms

739
00:29:09,520 --> 00:29:11,440
that are based on apache

740
00:29:11,440 --> 00:29:13,760
to new domains such as web servers that

741
00:29:13,760 --> 00:29:15,760
are running over iis

742
00:29:15,760 --> 00:29:21,200
and even exploring no sql databases

743
00:29:22,080 --> 00:29:24,720
as part of our analysis we fetched the

744
00:29:24,720 --> 00:29:25,520
exploits

745
00:29:25,520 --> 00:29:27,840
from the repositories and we tried to

746
00:29:27,840 --> 00:29:28,880
map them

747
00:29:28,880 --> 00:29:32,000
to the affected platform we saw

748
00:29:32,000 --> 00:29:35,440
total of 17 bundles

749
00:29:35,440 --> 00:29:38,320
while most of the vulnerabilities are in

750
00:29:38,320 --> 00:29:39,440
generic plugins

751
00:29:39,440 --> 00:29:42,720
and or component which are compatible

752
00:29:42,720 --> 00:29:45,200
with multiple cms platforms sorry

753
00:29:45,200 --> 00:29:48,640
or php webshop web web frameworks

754
00:29:48,640 --> 00:29:52,480
only one exploits was related to iis

755
00:29:52,480 --> 00:29:56,720
we mapped 13 different cms platforms

756
00:29:56,720 --> 00:30:00,159
and three php web frameworks that may be

757
00:30:00,159 --> 00:30:03,360
infected by the customer black partner

758
00:30:03,360 --> 00:30:06,000
the percentage shows the distribution of

759
00:30:06,000 --> 00:30:07,120
the vulnerabilities

760
00:30:07,120 --> 00:30:10,158
for each platform

761
00:30:12,080 --> 00:30:14,799
by that we close the stages overview and

762
00:30:14,799 --> 00:30:16,159
now

763
00:30:16,159 --> 00:30:20,000
let's discuss some key takeaways

764
00:30:21,120 --> 00:30:23,600
botnet deployment is similar to

765
00:30:23,600 --> 00:30:25,600
application development process

766
00:30:25,600 --> 00:30:27,919
there are some important key features we

767
00:30:27,919 --> 00:30:29,120
need to consider

768
00:30:29,120 --> 00:30:31,600
in order to create a stable botnet that

769
00:30:31,600 --> 00:30:34,320
is here to stay

770
00:30:34,320 --> 00:30:37,360
those are stability flexibility

771
00:30:37,360 --> 00:30:40,399
and cicd so

772
00:30:40,399 --> 00:30:42,480
in order to create a stable.net we need

773
00:30:42,480 --> 00:30:44,080
to take into consideration load

774
00:30:44,080 --> 00:30:46,080
balancing and redundancy

775
00:30:46,080 --> 00:30:49,360
enabling scalability while growing

776
00:30:49,360 --> 00:30:52,320
in other words stability is the

777
00:30:52,320 --> 00:30:54,559
foundation that enables the partner to

778
00:30:54,559 --> 00:30:56,960
exist

779
00:30:57,279 --> 00:31:01,519
but this is not enough the separation of

780
00:31:01,519 --> 00:31:04,320
the exploits from the infrastructure

781
00:31:04,320 --> 00:31:05,120
enables

782
00:31:05,120 --> 00:31:07,919
maximum flexibility as the attacker can

783
00:31:07,919 --> 00:31:08,559
add new

784
00:31:08,559 --> 00:31:12,158
exploits anytime

785
00:31:12,240 --> 00:31:15,600
together those two key features are the

786
00:31:15,600 --> 00:31:19,840
basis of the ability to grow and expand

787
00:31:20,240 --> 00:31:22,799
on the other hand we have the cicd

788
00:31:22,799 --> 00:31:23,760
branch

789
00:31:23,760 --> 00:31:26,000
that includes version control and

790
00:31:26,000 --> 00:31:28,159
deployment cycles

791
00:31:28,159 --> 00:31:31,360
we call it automation

792
00:31:31,360 --> 00:31:34,080
behind every massive operation we must

793
00:31:34,080 --> 00:31:35,679
have an automatic process

794
00:31:35,679 --> 00:31:39,760
to support it expansion and growth

795
00:31:39,760 --> 00:31:44,000
cannot exist without a solid cicd

796
00:31:44,840 --> 00:31:46,320
process

797
00:31:46,320 --> 00:31:49,120
now let's talk about the insider point

798
00:31:49,120 --> 00:31:51,279
of view

799
00:31:51,279 --> 00:31:54,399
as a security company we have that of

800
00:31:54,399 --> 00:31:56,480
hundreds of thousands of customers

801
00:31:56,480 --> 00:31:59,840
where we could see a tax in the wild

802
00:31:59,840 --> 00:32:02,320
this is not good enough since our data

803
00:32:02,320 --> 00:32:06,000
is biased by our customers

804
00:32:06,000 --> 00:32:08,000
here are a couple of advantages we got

805
00:32:08,000 --> 00:32:11,840
from the insider point of view

806
00:32:12,640 --> 00:32:14,720
being inside the botnet operation gave

807
00:32:14,720 --> 00:32:16,799
us the advantage in analysis

808
00:32:16,799 --> 00:32:19,919
as we could see the big picture and not

809
00:32:19,919 --> 00:32:20,559
just a

810
00:32:20,559 --> 00:32:23,120
small portion of the infection we

811
00:32:23,120 --> 00:32:24,960
watched the botnet evolution from the

812
00:32:24,960 --> 00:32:26,480
first row

813
00:32:26,480 --> 00:32:29,039
we saw new repositories exploits and

814
00:32:29,039 --> 00:32:29,760
payloads

815
00:32:29,760 --> 00:32:33,039
are added in real time and by

816
00:32:33,039 --> 00:32:36,000
analyzing the code changes we concluded

817
00:32:36,000 --> 00:32:38,000
what motivated the attacker to perform

818
00:32:38,000 --> 00:32:40,720
such changes

819
00:32:41,200 --> 00:32:44,640
we had a unique foothold that enabled us

820
00:32:44,640 --> 00:32:46,720
to analyze the victims from the attack

821
00:32:46,720 --> 00:32:48,399
instructions

822
00:32:48,399 --> 00:32:51,200
extracting the country the platforms

823
00:32:51,200 --> 00:32:54,240
domains etc

824
00:32:54,799 --> 00:32:57,039
the inside intelligence led us to the

825
00:32:57,039 --> 00:32:58,880
educated assumption that there is

826
00:32:58,880 --> 00:33:01,919
kind of an automated mechanism that

827
00:33:01,919 --> 00:33:03,760
searches for potential vulnerable

828
00:33:03,760 --> 00:33:05,840
targets and initiate them

829
00:33:05,840 --> 00:33:10,799
inside the queue in the cnc

830
00:33:10,799 --> 00:33:13,120
analyzing the exploit distribution

831
00:33:13,120 --> 00:33:14,399
explains which

832
00:33:14,399 --> 00:33:16,960
which exploits are in use the

833
00:33:16,960 --> 00:33:19,600
distribution of usage

834
00:33:19,600 --> 00:33:21,120
what is the frequency that they are

835
00:33:21,120 --> 00:33:23,360
being used and

836
00:33:23,360 --> 00:33:26,720
which are more common than others

837
00:33:26,720 --> 00:33:29,600
all of this information is accessible

838
00:33:29,600 --> 00:33:32,320
only from the insider point of view

839
00:33:32,320 --> 00:33:34,000
and it is critical in order to

840
00:33:34,000 --> 00:33:36,640
understand the scope of the operation

841
00:33:36,640 --> 00:33:38,960
the motivation and the challenges of the

842
00:33:38,960 --> 00:33:41,440
attacker

843
00:33:43,760 --> 00:33:46,000
now let's sum up everything that we

844
00:33:46,000 --> 00:33:48,480
talked about

845
00:33:49,120 --> 00:33:51,760
in a botnet development the attacker

846
00:33:51,760 --> 00:33:53,440
wearing multiple heads

847
00:33:53,440 --> 00:33:55,760
the attacker is the developer the

848
00:33:55,760 --> 00:33:57,279
architect

849
00:33:57,279 --> 00:34:00,799
and the devops usage of third-party

850
00:34:00,799 --> 00:34:01,519
services

851
00:34:01,519 --> 00:34:03,600
are critical part of the infrastructure

852
00:34:03,600 --> 00:34:04,640
in terms of

853
00:34:04,640 --> 00:34:06,960
how flashing the botnet and bypass

854
00:34:06,960 --> 00:34:09,280
security controls

855
00:34:09,280 --> 00:34:12,399
and it is not necessary to use

856
00:34:12,399 --> 00:34:17,040
exotic exploits in order to expand

857
00:34:17,040 --> 00:34:20,159
in terms of research first we need to

858
00:34:20,159 --> 00:34:20,560
map

859
00:34:20,560 --> 00:34:23,359
all the entities we need to learn the

860
00:34:23,359 --> 00:34:25,440
communication protocol

861
00:34:25,440 --> 00:34:28,719
and last visibility

862
00:34:28,719 --> 00:34:32,399
is essential to understand the big

863
00:34:32,839 --> 00:34:34,159
picture

864
00:34:34,159 --> 00:34:38,239
so what can we do to prevent infection

865
00:34:38,239 --> 00:34:41,599
first make sure to deploy waff in front

866
00:34:41,599 --> 00:34:44,159
of your application server

867
00:34:44,159 --> 00:34:47,280
invest in endpoint security install

868
00:34:47,280 --> 00:34:49,440
antivirus software both on your

869
00:34:49,440 --> 00:34:50,320
endpoints

870
00:34:50,320 --> 00:34:53,760
and servers in reference to cashmere

871
00:34:53,760 --> 00:34:54,399
black

872
00:34:54,399 --> 00:34:56,159
the attacker uploaded web shells that

873
00:34:56,159 --> 00:34:57,520
could be blocked by

874
00:34:57,520 --> 00:35:00,880
waf or antivirus

875
00:35:01,680 --> 00:35:03,680
make sure that your server is behind the

876
00:35:03,680 --> 00:35:05,839
firewall and allow only authorized

877
00:35:05,839 --> 00:35:07,599
services to connect

878
00:35:07,599 --> 00:35:10,640
for example open ssh only for specific

879
00:35:10,640 --> 00:35:14,320
hosts to reduce attack surface

880
00:35:14,320 --> 00:35:16,640
if you are using cloud provider make

881
00:35:16,640 --> 00:35:18,720
sure that your service or host

882
00:35:18,720 --> 00:35:21,839
is not publicly open

883
00:35:21,839 --> 00:35:23,839
make sure that you are up to date with

884
00:35:23,839 --> 00:35:25,680
the latest security patches

885
00:35:25,680 --> 00:35:28,160
and that there are no unused or

886
00:35:28,160 --> 00:35:30,320
unsupported plugins and features

887
00:35:30,320 --> 00:35:32,960
installed that might increase your

888
00:35:32,960 --> 00:35:35,280
attack surface

889
00:35:35,280 --> 00:35:38,880
and anyway make sure that you use

890
00:35:38,880 --> 00:35:44,800
strong authentication mechanism

891
00:35:44,800 --> 00:35:46,880
you are probably wondering what is the

892
00:35:46,880 --> 00:35:48,480
current state of the kashmir black

893
00:35:48,480 --> 00:35:50,000
partner

894
00:35:50,000 --> 00:35:52,880
so when we decided that our research has

895
00:35:52,880 --> 00:35:53,520
come to an

896
00:35:53,520 --> 00:35:57,599
end we collected ip's host names

897
00:35:57,599 --> 00:36:00,400
hosting services and every possible

898
00:36:00,400 --> 00:36:02,240
piece of information

899
00:36:02,240 --> 00:36:07,359
from bots repositories cnc and entities

900
00:36:07,359 --> 00:36:09,440
we notify the owners of the infected

901
00:36:09,440 --> 00:36:11,839
servers and hosting services

902
00:36:11,839 --> 00:36:14,880
about the malicious activity and

903
00:36:14,880 --> 00:36:19,200
today the kashmir black botnet is dead

904
00:36:19,200 --> 00:36:21,599
at least as we know it we checked our

905
00:36:21,599 --> 00:36:22,240
data lake

906
00:36:22,240 --> 00:36:24,880
and we couldn't find any traces of new

907
00:36:24,880 --> 00:36:27,839
infections

908
00:36:28,400 --> 00:36:31,280
so thank you very much for listening to

909
00:36:31,280 --> 00:36:31,920
our talk

910
00:36:31,920 --> 00:36:35,280
about cashmereblack.net feel free to

911
00:36:35,280 --> 00:36:37,920
contact us if you have any questions

912
00:36:37,920 --> 00:36:41,200
and for additional information you can

913
00:36:41,200 --> 00:36:44,079
read the two blocks that we wrote just

914
00:36:44,079 --> 00:36:45,040
search for

915
00:36:45,040 --> 00:36:49,359
kashmir black botnet in imperva's site

916
00:36:49,359 --> 00:36:55,839
thank you

917
00:37:02,079 --> 00:37:05,280
so is there any questions

918
00:37:05,280 --> 00:37:08,720
yeah let me see

919
00:37:08,720 --> 00:37:12,160
um yeah

920
00:37:12,160 --> 00:37:15,040
thank you very much uh mr uh shayti and

921
00:37:15,040 --> 00:37:16,400
uh miss yatoshami

922
00:37:16,400 --> 00:37:18,960
for your presentation uh this is nikhil

923
00:37:18,960 --> 00:37:20,560
one of the volunteers

924
00:37:20,560 --> 00:37:23,040
so now we do have actually a question uh

925
00:37:23,040 --> 00:37:25,280
for you guys uh in the q and a session

926
00:37:25,280 --> 00:37:25,920
here

927
00:37:25,920 --> 00:37:28,560
um why do you think the united states

928
00:37:28,560 --> 00:37:29,920
was a larger target

929
00:37:29,920 --> 00:37:33,280
compared to the other countries

930
00:37:33,520 --> 00:37:37,280
let me transfer it yeah okay um

931
00:37:37,280 --> 00:37:40,560
as we started we said in the slide that

932
00:37:40,560 --> 00:37:42,800
actually we believe that most of the

933
00:37:42,800 --> 00:37:45,200
servers are um

934
00:37:45,200 --> 00:37:48,240
were hosted by cloud providers and

935
00:37:48,240 --> 00:37:51,440
let's say that uh

936
00:37:51,440 --> 00:37:53,839
when you when you create a uh server in

937
00:37:53,839 --> 00:37:54,560
um

938
00:37:54,560 --> 00:37:58,400
over aws or uh gcp or whatever

939
00:37:58,400 --> 00:38:01,280
uh most of you just go to the default

940
00:38:01,280 --> 00:38:02,839
which is um

941
00:38:02,839 --> 00:38:06,640
uh yeah yes or something like that

942
00:38:06,640 --> 00:38:09,280
so we think this is the reason why most

943
00:38:09,280 --> 00:38:09,839
of them

944
00:38:09,839 --> 00:38:13,440
look like uh targeted like uh on the us

945
00:38:13,440 --> 00:38:16,079
but it's not reflected on the real

946
00:38:16,079 --> 00:38:18,160
allocation of the victim of the of the

947
00:38:18,160 --> 00:38:19,680
origin of it

948
00:38:19,680 --> 00:38:22,160
it just looks like the us is the most

949
00:38:22,160 --> 00:38:24,160
targeted but it's not

950
00:38:24,160 --> 00:38:27,359
it's not the the real um

951
00:38:27,359 --> 00:38:29,760
like like for us we are located in

952
00:38:29,760 --> 00:38:32,160
israel and probably if i will host

953
00:38:32,160 --> 00:38:35,119
a server on aws it will be located on on

954
00:38:35,119 --> 00:38:36,079
us

955
00:38:36,079 --> 00:38:38,240
so

956
00:38:39,440 --> 00:38:44,079
awesome uh so the uh

957
00:38:44,079 --> 00:38:46,800
sorry about that uh what happens to the

958
00:38:46,800 --> 00:38:48,480
next question is what happens to bots

959
00:38:48,480 --> 00:38:50,480
that fail to communicate with

960
00:38:50,480 --> 00:38:52,400
new infrastructure do they typically

961
00:38:52,400 --> 00:38:54,240
retry later or just stay

962
00:38:54,240 --> 00:38:57,920
broken so

963
00:38:57,920 --> 00:39:01,520
basically the two infrastructures are

964
00:39:01,520 --> 00:39:05,200
living together side by side

965
00:39:05,200 --> 00:39:07,680
until all the bots are immigrating to

966
00:39:07,680 --> 00:39:09,599
the new infrastructure it doesn't mean

967
00:39:09,599 --> 00:39:11,359
that

968
00:39:11,359 --> 00:39:15,760
um the the all the infrastructure is

969
00:39:15,760 --> 00:39:18,720
having some issues with the stability

970
00:39:18,720 --> 00:39:20,560
and scalability because there are a lot

971
00:39:20,560 --> 00:39:21,680
of bots but

972
00:39:21,680 --> 00:39:24,720
once most of the bots are migrating to

973
00:39:24,720 --> 00:39:26,839
the new infrastructure

974
00:39:26,839 --> 00:39:30,079
and even if some of them

975
00:39:30,079 --> 00:39:33,359
didn't uh successfully uh

976
00:39:33,359 --> 00:39:36,960
upgraded uh they keep work they keep

977
00:39:36,960 --> 00:39:39,040
communicate with the cnc and fetch

978
00:39:39,040 --> 00:39:40,480
attack instructions

979
00:39:40,480 --> 00:39:43,839
and attack victims

980
00:39:45,520 --> 00:39:48,000
awesome yeah and that's definitely great

981
00:39:48,000 --> 00:39:49,760
information and thank you so much

982
00:39:49,760 --> 00:39:52,400
for that uh clarity and once again thank

983
00:39:52,400 --> 00:39:53,040
you both

984
00:39:53,040 --> 00:39:55,760
for the great presentation and feel free

985
00:39:55,760 --> 00:39:57,040
to hang around

986
00:39:57,040 --> 00:40:00,160
at the b-sides conference this year

987
00:40:00,160 --> 00:40:02,800
we do have a breakout room if you would

988
00:40:02,800 --> 00:40:04,079
like to

989
00:40:04,079 --> 00:40:05,680
answer any further questions or if

990
00:40:05,680 --> 00:40:07,119
anyone has any questions

991
00:40:07,119 --> 00:40:08,720
feel free to join us in the breakout

992
00:40:08,720 --> 00:40:11,200
room but other than that once again

993
00:40:11,200 --> 00:40:14,000
thank you and and welcome to b-sides and

994
00:40:14,000 --> 00:40:16,400
enjoy the rest of the conference

995
00:40:16,400 --> 00:40:25,670
thank you very much great to be here

996
00:40:25,670 --> 00:40:28,729
[Music]

997
00:40:36,839 --> 00:40:39,839
do

998
00:40:46,450 --> 00:40:56,529
[Music]

999
00:41:00,790 --> 00:41:05,959
[Music]

1000
00:41:14,320 --> 00:41:17,570
[Music]

1001
00:41:17,920 --> 00:41:20,000
you

