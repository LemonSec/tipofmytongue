1
00:00:05,600 --> 00:00:07,680
hello everyone welcome to my talk

2
00:00:07,680 --> 00:00:09,519
from cali and a couple of vms to next

3
00:00:09,519 --> 00:00:11,519
gen home lab an approach to practice and

4
00:00:11,519 --> 00:00:13,280
development skills

5
00:00:13,280 --> 00:00:14,799
my name is bashar and i will be

6
00:00:14,799 --> 00:00:17,199
presenter for today

7
00:00:17,199 --> 00:00:21,199
here we go perfect

8
00:00:23,039 --> 00:00:25,039
i know you can't wait to hear this talk

9
00:00:25,039 --> 00:00:26,960
but let me first introduce myself

10
00:00:26,960 --> 00:00:29,199
my name is bashar and i'm a member of a

11
00:00:29,199 --> 00:00:31,679
blue team at the fortune 100 company

12
00:00:31,679 --> 00:00:35,120
in houston texas my current role focuses

13
00:00:35,120 --> 00:00:36,960
on threat intelligence threat hunting

14
00:00:36,960 --> 00:00:39,040
and vulnerability management

15
00:00:39,040 --> 00:00:40,640
i have worked previously in different

16
00:00:40,640 --> 00:00:42,079
industries for different service

17
00:00:42,079 --> 00:00:43,200
providers

18
00:00:43,200 --> 00:00:44,800
i have also consulted on many

19
00:00:44,800 --> 00:00:47,280
engagements and projects

20
00:00:47,280 --> 00:00:48,559
i have master's degree from the

21
00:00:48,559 --> 00:00:50,559
university of houston along with 4g x

22
00:00:50,559 --> 00:00:52,399
certifications focusing on digital

23
00:00:52,399 --> 00:00:55,280
forensics and incident response

24
00:00:55,280 --> 00:00:57,440
i am excited to share my how i built my

25
00:00:57,440 --> 00:00:59,199
home lab with you all today

26
00:00:59,199 --> 00:01:01,120
i have a different approach and

27
00:01:01,120 --> 00:01:02,320
hopefully

28
00:01:02,320 --> 00:01:04,159
you will leave this talk with a lot of

29
00:01:04,159 --> 00:01:06,640
ideas that you can use to build your own

30
00:01:06,640 --> 00:01:08,880
lab

31
00:01:10,720 --> 00:01:13,680
before we deep dive into this topic i

32
00:01:13,680 --> 00:01:15,200
want you to keep in mind that this

33
00:01:15,200 --> 00:01:16,159
presentation

34
00:01:16,159 --> 00:01:18,799
is about the journey to build the lab

35
00:01:18,799 --> 00:01:19,600
the goal

36
00:01:19,600 --> 00:01:22,400
is not just to build the lab but rather

37
00:01:22,400 --> 00:01:24,159
it's about everything you are going to

38
00:01:24,159 --> 00:01:26,479
learn along the way

39
00:01:26,479 --> 00:01:28,240
hopefully the idea that i will present

40
00:01:28,240 --> 00:01:30,720
to you today will spark your interest

41
00:01:30,720 --> 00:01:32,400
and encourage you to dig deeper and

42
00:01:32,400 --> 00:01:34,720
continue the journey

43
00:01:34,720 --> 00:01:36,400
because there will be no one specific

44
00:01:36,400 --> 00:01:38,159
destination or one specific

45
00:01:38,159 --> 00:01:41,200
weight or path to build this lab

46
00:01:41,200 --> 00:01:43,439
having a home lab will allow you to

47
00:01:43,439 --> 00:01:45,200
explore and develop new skills

48
00:01:45,200 --> 00:01:48,079
in various areas

49
00:01:49,759 --> 00:01:52,240
so by now you might be wondering how can

50
00:01:52,240 --> 00:01:55,360
a home lab enhance or improve my skills

51
00:01:55,360 --> 00:01:57,520
research has shown that we actually

52
00:01:57,520 --> 00:01:58,399
learn more

53
00:01:58,399 --> 00:02:01,520
by doing your likelihood to return

54
00:02:01,520 --> 00:02:03,920
information is much higher when you're

55
00:02:03,920 --> 00:02:06,000
actively doing the concepts or exercises

56
00:02:06,000 --> 00:02:06,479
that

57
00:02:06,479 --> 00:02:10,318
are presented to you versus for example

58
00:02:10,318 --> 00:02:12,480
reading about something in a blog or

59
00:02:12,480 --> 00:02:14,000
hearing about an audiobook

60
00:02:14,000 --> 00:02:16,879
where you actually do it it it sticks in

61
00:02:16,879 --> 00:02:19,360
your mind

62
00:02:19,360 --> 00:02:21,120
having a home lab will give you the

63
00:02:21,120 --> 00:02:23,280
advantage to practice what you learn

64
00:02:23,280 --> 00:02:26,400
and experiment new technologies or even

65
00:02:26,400 --> 00:02:28,000
give you access to technology that

66
00:02:28,000 --> 00:02:29,360
you're not allowed to work on

67
00:02:29,360 --> 00:02:32,400
at your workplace don't let that limit

68
00:02:32,400 --> 00:02:33,440
yourself

69
00:02:33,440 --> 00:02:35,680
or worry about affecting people's

70
00:02:35,680 --> 00:02:37,200
workflow or causing business

71
00:02:37,200 --> 00:02:38,400
interruptions

72
00:02:38,400 --> 00:02:40,720
your home lab is a safe place where you

73
00:02:40,720 --> 00:02:42,560
can tear things apart

74
00:02:42,560 --> 00:02:46,160
and tinker with them but on that note

75
00:02:46,160 --> 00:02:47,120
just make sure

76
00:02:47,120 --> 00:02:49,360
your significant other or roommate can

77
00:02:49,360 --> 00:02:51,040
still access the internet

78
00:02:51,040 --> 00:02:53,280
i can't tell you how many times my wife

79
00:02:53,280 --> 00:02:54,640
got mad at me

80
00:02:54,640 --> 00:02:57,200
because our home dns server went down

81
00:02:57,200 --> 00:02:59,040
and she can't browse the internet

82
00:02:59,040 --> 00:03:00,560
that's why i wanted to create a

83
00:03:00,560 --> 00:03:02,560
completely separate next-gen

84
00:03:02,560 --> 00:03:05,840
home lab

85
00:03:06,959 --> 00:03:09,280
so now that we all agree on the benefit

86
00:03:09,280 --> 00:03:10,480
of our home lab

87
00:03:10,480 --> 00:03:12,560
let's discuss what a next-gen home lab

88
00:03:12,560 --> 00:03:14,000
is

89
00:03:14,000 --> 00:03:16,959
when i started my career i always used

90
00:03:16,959 --> 00:03:18,720
my desktop or laptop

91
00:03:18,720 --> 00:03:20,879
with some vms to test and learn new

92
00:03:20,879 --> 00:03:22,239
concepts and skills

93
00:03:22,239 --> 00:03:24,319
and probably most of us have well also

94
00:03:24,319 --> 00:03:25,599
as well

95
00:03:25,599 --> 00:03:27,840
that worked for me for a while but then

96
00:03:27,840 --> 00:03:29,200
i realized that i want to take this to

97
00:03:29,200 --> 00:03:30,000
the next

98
00:03:30,000 --> 00:03:33,360
step next level right um so what i did

99
00:03:33,360 --> 00:03:33,680
is

100
00:03:33,680 --> 00:03:36,000
i created next-gen home lab which is

101
00:03:36,000 --> 00:03:38,159
basically a lab where i mimic

102
00:03:38,159 --> 00:03:40,720
the infrastructure of a small company or

103
00:03:40,720 --> 00:03:41,920
enterprise

104
00:03:41,920 --> 00:03:44,840
and virtualize it all in one physical

105
00:03:44,840 --> 00:03:46,480
box this

106
00:03:46,480 --> 00:03:49,120
allowed me to practice and explore an

107
00:03:49,120 --> 00:03:49,760
environment

108
00:03:49,760 --> 00:03:52,000
similar to a company's environment but a

109
00:03:52,000 --> 00:03:54,640
small scale

110
00:03:54,879 --> 00:03:57,200
as you build this next-gen home lab you

111
00:03:57,200 --> 00:03:59,519
are going to enhance your understanding

112
00:03:59,519 --> 00:04:03,040
of many i.t foundational concepts

113
00:04:03,040 --> 00:04:05,920
from networking to virtualization

114
00:04:05,920 --> 00:04:07,599
building a management domain controller

115
00:04:07,599 --> 00:04:09,680
an active directory

116
00:04:09,680 --> 00:04:14,319
linux administration the list goes on

117
00:04:14,319 --> 00:04:16,639
this will also help you understand why

118
00:04:16,639 --> 00:04:17,600
applications

119
00:04:17,600 --> 00:04:19,279
and infrastructure availability is

120
00:04:19,279 --> 00:04:21,440
critical for business operations

121
00:04:21,440 --> 00:04:24,160
in my experience availability is

122
00:04:24,160 --> 00:04:25,040
sometimes

123
00:04:25,040 --> 00:04:28,400
overlooked by security professionals

124
00:04:28,400 --> 00:04:30,800
but it's something that we should always

125
00:04:30,800 --> 00:04:32,479
keep in our mind

126
00:04:32,479 --> 00:04:34,560
is to understand how to how the real

127
00:04:34,560 --> 00:04:36,560
world works and how to secure how

128
00:04:36,560 --> 00:04:37,520
security

129
00:04:37,520 --> 00:04:40,800
fixed fits in overall of the i.t picture

130
00:04:40,800 --> 00:04:43,840
in an enterprise

131
00:04:46,160 --> 00:04:49,360
so let's start building our home lab

132
00:04:49,360 --> 00:04:51,280
first we will need the hardware to run

133
00:04:51,280 --> 00:04:52,960
our lab on

134
00:04:52,960 --> 00:04:55,120
the beauty of this nixon home lab

135
00:04:55,120 --> 00:04:57,440
concept is that you can scale it based

136
00:04:57,440 --> 00:04:58,880
on your resources

137
00:04:58,880 --> 00:05:00,479
the more resources you can give your to

138
00:05:00,479 --> 00:05:02,880
your lab the closer the lab

139
00:05:02,880 --> 00:05:04,400
will mimic a real company's

140
00:05:04,400 --> 00:05:06,639
infrastructure

141
00:05:06,639 --> 00:05:08,639
if you can afford it i strongly

142
00:05:08,639 --> 00:05:10,479
recommend having a dedicated machine to

143
00:05:10,479 --> 00:05:11,120
run the lab

144
00:05:11,120 --> 00:05:15,120
on with at least 32 gigs of ram

145
00:05:15,120 --> 00:05:16,960
but if you don't have access to such a

146
00:05:16,960 --> 00:05:18,880
machine it's okay

147
00:05:18,880 --> 00:05:21,440
you can still apply some or portion of

148
00:05:21,440 --> 00:05:22,560
this concept

149
00:05:22,560 --> 00:05:27,120
to any decent laptop or desktop

150
00:05:27,759 --> 00:05:29,759
also another thing from my experience

151
00:05:29,759 --> 00:05:31,120
when using

152
00:05:31,120 --> 00:05:33,520
solid state hard drives or nvm express

153
00:05:33,520 --> 00:05:34,880
hard drives

154
00:05:34,880 --> 00:05:37,759
it was worth every penny it speeded up

155
00:05:37,759 --> 00:05:38,000
the

156
00:05:38,000 --> 00:05:41,440
deployment process so much

157
00:05:41,440 --> 00:05:43,840
because the idea is we're going to keep

158
00:05:43,840 --> 00:05:45,280
deploying more vms

159
00:05:45,280 --> 00:05:47,440
and and that's time consuming with the

160
00:05:47,440 --> 00:05:48,560
normal hard drive so

161
00:05:48,560 --> 00:05:50,720
if you can afford it please add those to

162
00:05:50,720 --> 00:05:53,840
your list

163
00:05:54,880 --> 00:05:58,160
and speaking of resources also

164
00:05:58,160 --> 00:06:00,319
most vms what i noticed is they would

165
00:06:00,319 --> 00:06:01,600
require more

166
00:06:01,600 --> 00:06:04,000
resources when they're being deployed so

167
00:06:04,000 --> 00:06:05,280
for example

168
00:06:05,280 --> 00:06:08,319
i would assign a windows server domain

169
00:06:08,319 --> 00:06:09,520
controller

170
00:06:09,520 --> 00:06:12,400
for virtual cpus and four gig of ram

171
00:06:12,400 --> 00:06:13,440
when i deploy

172
00:06:13,440 --> 00:06:16,639
the machine or the vm but then once i'm

173
00:06:16,639 --> 00:06:17,759
done provisioning

174
00:06:17,759 --> 00:06:20,479
i will just drop the resources to about

175
00:06:20,479 --> 00:06:21,759
one virtual cpu

176
00:06:21,759 --> 00:06:24,639
and one gig of ram and that should be

177
00:06:24,639 --> 00:06:25,840
the average

178
00:06:25,840 --> 00:06:28,319
hvm will need when it's just sitting

179
00:06:28,319 --> 00:06:30,639
there idling

180
00:06:30,639 --> 00:06:33,440
generally speaking though the heaviest

181
00:06:33,440 --> 00:06:34,720
resource consumers

182
00:06:34,720 --> 00:06:37,120
will be things like a sim that's

183
00:06:37,120 --> 00:06:39,280
processing events at all time

184
00:06:39,280 --> 00:06:41,360
if you have a packet capture server

185
00:06:41,360 --> 00:06:43,919
running it will also require

186
00:06:43,919 --> 00:06:46,639
more resources since traffic is always

187
00:06:46,639 --> 00:06:49,840
going to be floating in our environment

188
00:06:52,080 --> 00:06:53,520
moving on to the virtualization

189
00:06:53,520 --> 00:06:55,759
component of our lab as you probably

190
00:06:55,759 --> 00:06:56,160
know

191
00:06:56,160 --> 00:06:58,240
there are many virtualization solutions

192
00:06:58,240 --> 00:06:59,680
out there

193
00:06:59,680 --> 00:07:02,400
both free and paid since we'll be

194
00:07:02,400 --> 00:07:05,280
deploying many vms in this environment

195
00:07:05,280 --> 00:07:07,840
it's generally a good idea to reserve as

196
00:07:07,840 --> 00:07:08,880
much resources

197
00:07:08,880 --> 00:07:12,560
as possible to run those vms

198
00:07:12,560 --> 00:07:14,800
and we can do that by running a bare

199
00:07:14,800 --> 00:07:16,400
metal hypervisor

200
00:07:16,400 --> 00:07:19,599
also called the type 1 hypervisor i

201
00:07:19,599 --> 00:07:22,960
personally like to use vmware a6i

202
00:07:22,960 --> 00:07:26,000
and that's just my personal preference

203
00:07:26,000 --> 00:07:28,160
even though it has some limitations like

204
00:07:28,160 --> 00:07:29,919
a maximum of four of eight

205
00:07:29,919 --> 00:07:33,520
virtual cpus per vm and a maximum of

206
00:07:33,520 --> 00:07:37,520
two physical cpus in a physical e6i host

207
00:07:37,520 --> 00:07:40,080
i think the current three sxi features

208
00:07:40,080 --> 00:07:41,440
will be more than enough to build our

209
00:07:41,440 --> 00:07:44,960
home lab

210
00:07:44,960 --> 00:07:47,520
if you're interested in getting more

211
00:07:47,520 --> 00:07:50,400
enterprise-like features from vsphere

212
00:07:50,400 --> 00:07:54,240
things like backups uh api calls

213
00:07:54,240 --> 00:07:57,120
for automation using vcenter for cluster

214
00:07:57,120 --> 00:07:58,479
management

215
00:07:58,479 --> 00:08:01,280
you can pay 200 annually and sign up for

216
00:08:01,280 --> 00:08:04,239
vmark advantage

217
00:08:04,319 --> 00:08:06,639
vmac advantage will give you access to

218
00:08:06,639 --> 00:08:08,800
play with most of vmware products for a

219
00:08:08,800 --> 00:08:09,680
whole year

220
00:08:09,680 --> 00:08:13,039
so pretty much the whole line of vmware

221
00:08:13,039 --> 00:08:14,560
for a whole year which is not too bad

222
00:08:14,560 --> 00:08:16,639
honestly

223
00:08:16,639 --> 00:08:19,680
um there are also many open source

224
00:08:19,680 --> 00:08:23,120
virtualization software like zen server

225
00:08:23,120 --> 00:08:26,080
kvm proxmox i have heard many good

226
00:08:26,080 --> 00:08:28,319
things about proxmox lately

227
00:08:28,319 --> 00:08:30,800
proxmox gave you most of the enterprise

228
00:08:30,800 --> 00:08:32,080
features in a6i

229
00:08:32,080 --> 00:08:35,120
for free but unfortunately i haven't

230
00:08:35,120 --> 00:08:37,839
had a chance to play with it or just

231
00:08:37,839 --> 00:08:41,440
experiment with it yet

232
00:08:41,440 --> 00:08:43,440
lastly i want to mention that this home

233
00:08:43,440 --> 00:08:45,200
lab can be built using vmware

234
00:08:45,200 --> 00:08:47,760
workstation or virtualbox

235
00:08:47,760 --> 00:08:49,920
also known as type 2 hypervisors just

236
00:08:49,920 --> 00:08:51,839
keep in mind that you will have less

237
00:08:51,839 --> 00:08:52,880
resources

238
00:08:52,880 --> 00:08:55,920
to use for your vms since this type of

239
00:08:55,920 --> 00:08:56,880
hypervisor

240
00:08:56,880 --> 00:09:01,040
will be running on the top of the os

241
00:09:02,000 --> 00:09:03,680
all right now let's get to the technical

242
00:09:03,680 --> 00:09:05,120
parts

243
00:09:05,120 --> 00:09:08,000
let's start with our home network

244
00:09:08,000 --> 00:09:10,080
usually there is a modem or router from

245
00:09:10,080 --> 00:09:12,240
the usb provider

246
00:09:12,240 --> 00:09:14,560
i recommend putting a firewall behind

247
00:09:14,560 --> 00:09:15,600
the isp modem

248
00:09:15,600 --> 00:09:18,720
so we can isolate our lab traffic

249
00:09:18,720 --> 00:09:21,600
i personally use unify because they are

250
00:09:21,600 --> 00:09:22,640
really user friendly

251
00:09:22,640 --> 00:09:25,360
but feel free to use the firewall of

252
00:09:25,360 --> 00:09:27,920
your choice

253
00:09:28,160 --> 00:09:31,040
the goal is to have a mechanism to

254
00:09:31,040 --> 00:09:33,680
isolate our lab traffic

255
00:09:33,680 --> 00:09:36,800
in my setup i tag all traffic from my

256
00:09:36,800 --> 00:09:40,800
lab as vlan 100

257
00:09:40,959 --> 00:09:43,600
i will explain more about vlans in next

258
00:09:43,600 --> 00:09:45,120
slides

259
00:09:45,120 --> 00:09:47,920
i use my home network firewall to block

260
00:09:47,920 --> 00:09:50,399
all connections from vlan 100

261
00:09:50,399 --> 00:09:54,160
into my home network devices

262
00:09:54,320 --> 00:09:57,360
next i connected a physical switch

263
00:09:57,360 --> 00:09:59,519
that is going to be the main switch for

264
00:09:59,519 --> 00:10:00,640
my lab

265
00:10:00,640 --> 00:10:04,000
so any device that connects

266
00:10:04,000 --> 00:10:05,680
physically to this switch is

267
00:10:05,680 --> 00:10:07,040
automatically blocked

268
00:10:07,040 --> 00:10:09,040
from talking to any device in my home

269
00:10:09,040 --> 00:10:11,360
network

270
00:10:11,360 --> 00:10:14,480
after that i built and configured the

271
00:10:14,480 --> 00:10:17,920
hype the a6i hypervisor the hypervisor

272
00:10:17,920 --> 00:10:18,560
will come

273
00:10:18,560 --> 00:10:22,399
with the default virtual switch which is

274
00:10:22,399 --> 00:10:25,440
v switch 0.

275
00:10:26,240 --> 00:10:28,399
by default this virtual switch will be

276
00:10:28,399 --> 00:10:31,519
connected to the physical network card

277
00:10:31,519 --> 00:10:34,399
that is which will give you access to

278
00:10:34,399 --> 00:10:37,360
the management console on e6i

279
00:10:37,360 --> 00:10:39,760
so for our home lab i will need to add

280
00:10:39,760 --> 00:10:40,480
two more

281
00:10:40,480 --> 00:10:45,120
virtual switches along with board groups

282
00:10:45,120 --> 00:10:47,120
one virtual switch will act as the one

283
00:10:47,120 --> 00:10:49,360
interface for our enterprise

284
00:10:49,360 --> 00:10:51,200
and the other will act as the lan

285
00:10:51,200 --> 00:10:53,760
interface

286
00:10:54,000 --> 00:10:56,800
once we added and created these view

287
00:10:56,800 --> 00:10:58,320
switches and ports

288
00:10:58,320 --> 00:11:02,480
now we can deploy pfsense

289
00:11:04,720 --> 00:11:07,920
pfsense is an open source firewall that

290
00:11:07,920 --> 00:11:10,399
can be run inside a vm

291
00:11:10,399 --> 00:11:13,120
in our case here it will be acting as

292
00:11:13,120 --> 00:11:16,399
the edge firewall for our enterprise

293
00:11:16,399 --> 00:11:18,800
one of the nice things about pfsense it

294
00:11:18,800 --> 00:11:19,600
has

295
00:11:19,600 --> 00:11:21,600
many packages that we can install easily

296
00:11:21,600 --> 00:11:23,120
with one click

297
00:11:23,120 --> 00:11:26,720
we can easily enable a proxy a vpn

298
00:11:26,720 --> 00:11:27,680
server

299
00:11:27,680 --> 00:11:30,959
an intrusion detection system and

300
00:11:30,959 --> 00:11:34,079
so many other features

301
00:11:34,720 --> 00:11:36,320
the the important thing here is when we

302
00:11:36,320 --> 00:11:38,560
connect when we deploy pfsense and

303
00:11:38,560 --> 00:11:41,120
connect it on a6i

304
00:11:41,120 --> 00:11:43,279
we only need to attach two network

305
00:11:43,279 --> 00:11:44,399
adapters

306
00:11:44,399 --> 00:11:46,240
the when and the lan that we just

307
00:11:46,240 --> 00:11:48,720
created

308
00:11:50,639 --> 00:11:53,680
now that we have pfsense in place we

309
00:11:53,680 --> 00:11:55,200
will configure

310
00:11:55,200 --> 00:11:58,240
the web interface as dhcp so it can get

311
00:11:58,240 --> 00:12:00,079
an ip address from our home

312
00:12:00,079 --> 00:12:03,120
firewall automatically

313
00:12:03,120 --> 00:12:05,279
i like to use a dedicated network card

314
00:12:05,279 --> 00:12:06,480
for when

315
00:12:06,480 --> 00:12:08,839
so i can manage pf sense on the one

316
00:12:08,839 --> 00:12:10,560
interface and have

317
00:12:10,560 --> 00:12:14,720
a defined one zone for our enterprise

318
00:12:14,720 --> 00:12:17,839
you can also use v-switch zero as the

319
00:12:17,839 --> 00:12:19,600
one switch if you are limited

320
00:12:19,600 --> 00:12:23,120
to one physical card on your host

321
00:12:23,120 --> 00:12:24,639
but for now i'm going to stick with the

322
00:12:24,639 --> 00:12:27,279
first approach

323
00:12:28,079 --> 00:12:30,800
next we will configure the lan with a

324
00:12:30,800 --> 00:12:31,839
static ip

325
00:12:31,839 --> 00:12:34,079
with no uplinks or physical cards

326
00:12:34,079 --> 00:12:35,200
attached

327
00:12:35,200 --> 00:12:38,480
at the moment so this lan interface

328
00:12:38,480 --> 00:12:40,800
will act as a single backbone to the

329
00:12:40,800 --> 00:12:42,560
firewall

330
00:12:42,560 --> 00:12:45,680
now it's time to set up vlans or virtual

331
00:12:45,680 --> 00:12:47,440
lands

332
00:12:47,440 --> 00:12:49,120
vlans will give us the ability to

333
00:12:49,120 --> 00:12:50,480
segment networks

334
00:12:50,480 --> 00:12:53,680
virtually by assigning a vlan tag id to

335
00:12:53,680 --> 00:12:55,120
each subnet

336
00:12:55,120 --> 00:12:58,240
this way we can use one virtual switch

337
00:12:58,240 --> 00:13:00,720
and define money networks or subnets and

338
00:13:00,720 --> 00:13:02,639
this is how we are going to segment

339
00:13:02,639 --> 00:13:07,040
our enterprise network

340
00:13:07,040 --> 00:13:10,160
so let's start by defining the vlan

341
00:13:10,160 --> 00:13:13,519
on a6i first we simply add a port group

342
00:13:13,519 --> 00:13:15,760
in this case i'm going to create my dmz

343
00:13:15,760 --> 00:13:18,000
vlan so i give it a name of dmz

344
00:13:18,000 --> 00:13:21,519
i give it an id of 200 and i attach it

345
00:13:21,519 --> 00:13:22,240
to my

346
00:13:22,240 --> 00:13:25,279
lan virtual switch

347
00:13:25,279 --> 00:13:28,399
and i go through the cycle as many

348
00:13:28,399 --> 00:13:35,120
vlans as i need

349
00:13:35,120 --> 00:13:36,959
after that we need to define the same

350
00:13:36,959 --> 00:13:38,160
vlan but

351
00:13:38,160 --> 00:13:41,360
on pfsense and we do that by adding a

352
00:13:41,360 --> 00:13:41,920
vlan

353
00:13:41,920 --> 00:13:46,320
interface on pf sense and give it a vlan

354
00:13:46,320 --> 00:13:49,519
id tag so following the same example

355
00:13:49,519 --> 00:13:52,560
i'm matching the same vlan id of 200

356
00:13:52,560 --> 00:13:54,959
that i created a6i

357
00:13:54,959 --> 00:13:58,720
npfsense and give it a name

358
00:13:58,720 --> 00:14:02,000
and then i'm as i assign an

359
00:14:02,000 --> 00:14:05,600
interface to activate it in pf sense

360
00:14:05,600 --> 00:14:09,600
once we activate it we can add a dsp

361
00:14:09,600 --> 00:14:10,880
server

362
00:14:10,880 --> 00:14:14,639
to be defined on this vlan so any vm

363
00:14:14,639 --> 00:14:16,399
that is connected to this vlan will

364
00:14:16,399 --> 00:14:18,639
automatically get an ip address from

365
00:14:18,639 --> 00:14:21,040
pfsense

366
00:14:21,040 --> 00:14:24,240
and in this example any vm

367
00:14:24,240 --> 00:14:27,320
in the dmz will get an ip address of

368
00:14:27,320 --> 00:14:29,360
10.10.200

369
00:14:29,360 --> 00:14:33,279
the whatever is next available

370
00:14:33,279 --> 00:14:35,839
in other words pfsense is acting as a

371
00:14:35,839 --> 00:14:37,440
dhcp server

372
00:14:37,440 --> 00:14:40,399
for hvlan

373
00:14:40,959 --> 00:14:43,920
finally we need to add the firewall rule

374
00:14:43,920 --> 00:14:45,839
to allow connections

375
00:14:45,839 --> 00:14:48,240
for these vlans because pfs doesn't do

376
00:14:48,240 --> 00:14:50,000
it by default so

377
00:14:50,000 --> 00:14:52,639
just because you have the sap configured

378
00:14:52,639 --> 00:14:54,160
you still need the firewall rule

379
00:14:54,160 --> 00:14:55,760
otherwise that vlan cannot talk to

380
00:14:55,760 --> 00:14:57,600
anyone

381
00:14:57,600 --> 00:14:59,920
and again we do the same process for all

382
00:14:59,920 --> 00:15:01,839
the vlans that we need

383
00:15:01,839 --> 00:15:05,360
uh we go through the same cycle

384
00:15:06,160 --> 00:15:08,079
so at the end depending on how many

385
00:15:08,079 --> 00:15:09,760
vlans you want to have

386
00:15:09,760 --> 00:15:11,199
we should have something that looks like

387
00:15:11,199 --> 00:15:14,720
this as you can see the vlan tag ids

388
00:15:14,720 --> 00:15:17,600
have been defined on both a6i and pf

389
00:15:17,600 --> 00:15:18,800
sense

390
00:15:18,800 --> 00:15:21,680
except for the lan and the promiscuous

391
00:15:21,680 --> 00:15:24,319
chord groups

392
00:15:24,959 --> 00:15:30,639
an a6i when you assign a vlan id of 4095

393
00:15:30,639 --> 00:15:33,360
that tells a6i to treat this virtual

394
00:15:33,360 --> 00:15:33,839
switch

395
00:15:33,839 --> 00:15:37,600
as a port as a trunk port

396
00:15:37,600 --> 00:15:40,000
which means it can receive traffic from

397
00:15:40,000 --> 00:15:41,360
any other vlan

398
00:15:41,360 --> 00:15:44,079
regardless of which vlan id the traffic

399
00:15:44,079 --> 00:15:44,560
is

400
00:15:44,560 --> 00:15:48,000
tagged on the promuscus port

401
00:15:48,000 --> 00:15:50,160
will be used to get a copy of all the

402
00:15:50,160 --> 00:15:51,199
traffic that flows

403
00:15:51,199 --> 00:15:54,320
through our v-switch this

404
00:15:54,320 --> 00:15:56,560
can help us monitor traffic monitor

405
00:15:56,560 --> 00:15:58,959
analyze traffic in our environment

406
00:15:58,959 --> 00:16:00,240
the promiscuous mode pretty much

407
00:16:00,240 --> 00:16:02,560
replicates a physical span

408
00:16:02,560 --> 00:16:06,000
tab or mirror port and we'll talk about

409
00:16:06,000 --> 00:16:07,279
this

410
00:16:07,279 --> 00:16:09,839
later on

411
00:16:10,959 --> 00:16:14,399
now it's time to start deploying and

412
00:16:14,399 --> 00:16:16,959
building the enterprise infrastructure

413
00:16:16,959 --> 00:16:19,920
let's talk about the technologies and

414
00:16:19,920 --> 00:16:22,000
networks we can build

415
00:16:22,000 --> 00:16:23,360
that we usually see at a typical

416
00:16:23,360 --> 00:16:26,560
enterprise or a company

417
00:16:28,800 --> 00:16:32,079
starting off with our servers this is

418
00:16:32,079 --> 00:16:33,440
where will we host

419
00:16:33,440 --> 00:16:35,199
all essential servers needed for this

420
00:16:35,199 --> 00:16:37,519
company to function

421
00:16:37,519 --> 00:16:39,600
most companies use active directory and

422
00:16:39,600 --> 00:16:42,000
domain controller in their environments

423
00:16:42,000 --> 00:16:44,399
so let's replicate that and by deploying

424
00:16:44,399 --> 00:16:45,360
a windows

425
00:16:45,360 --> 00:16:47,680
server and promote it to be the domain

426
00:16:47,680 --> 00:16:49,199
controller

427
00:16:49,199 --> 00:16:51,040
and also make it the dna server for the

428
00:16:51,040 --> 00:16:53,279
environment so it will

429
00:16:53,279 --> 00:16:56,639
register workstations as they come up

430
00:16:56,639 --> 00:16:59,839
we can easily also get a free trial of

431
00:16:59,839 --> 00:17:04,480
windows 2016 or 2019 from microsoft

432
00:17:04,480 --> 00:17:07,280
the free trial can run up to 180 days

433
00:17:07,280 --> 00:17:09,520
which is plenty of time to experiment

434
00:17:09,520 --> 00:17:12,400
uh usually i would just hit the uh trial

435
00:17:12,400 --> 00:17:13,839
i'll take a snapshot

436
00:17:13,839 --> 00:17:15,280
before i deploy it and then i can just

437
00:17:15,280 --> 00:17:16,799
revert to that snapshot so i don't have

438
00:17:16,799 --> 00:17:17,599
to download it

439
00:17:17,599 --> 00:17:21,919
again every single time microsoft also

440
00:17:21,919 --> 00:17:24,160
offers other trials if you want to play

441
00:17:24,160 --> 00:17:25,199
with some databases

442
00:17:25,199 --> 00:17:27,599
sharepoint many more you can go there

443
00:17:27,599 --> 00:17:30,840
and find all kind of stuff that you can

444
00:17:30,840 --> 00:17:33,039
download and

445
00:17:33,039 --> 00:17:34,720
because no company can function without

446
00:17:34,720 --> 00:17:37,679
emails we should add an email server

447
00:17:37,679 --> 00:17:39,840
so we can send phishing emails for

448
00:17:39,840 --> 00:17:41,760
example

449
00:17:41,760 --> 00:17:44,000
mail in a box is simple to deploy mail

450
00:17:44,000 --> 00:17:46,559
server that runs on windows

451
00:17:46,559 --> 00:17:48,480
and if you're interested in something

452
00:17:48,480 --> 00:17:49,679
that runs on win

453
00:17:49,679 --> 00:17:54,799
and uh i'm sorry made unboxings on linux

454
00:17:54,799 --> 00:17:56,720
and it's and if you're interested in

455
00:17:56,720 --> 00:17:58,640
something that runs on windows

456
00:17:58,640 --> 00:18:01,600
you can try html server and that's also

457
00:18:01,600 --> 00:18:04,159
open source

458
00:18:05,919 --> 00:18:08,240
we can also include linux servers to

459
00:18:08,240 --> 00:18:10,160
address some of the other technologies

460
00:18:10,160 --> 00:18:13,360
used in enterprises today for example

461
00:18:13,360 --> 00:18:17,360
we can use freenas as our file server

462
00:18:17,360 --> 00:18:19,200
that's where our employees can store and

463
00:18:19,200 --> 00:18:22,000
access their files

464
00:18:22,000 --> 00:18:24,480
in addition to the core servers let's

465
00:18:24,480 --> 00:18:26,400
also think about the applications

466
00:18:26,400 --> 00:18:29,520
used in this company things like the

467
00:18:29,520 --> 00:18:30,799
intranet

468
00:18:30,799 --> 00:18:32,640
where users can go and get companies

469
00:18:32,640 --> 00:18:34,559
internal information

470
00:18:34,559 --> 00:18:37,200
you can run an intranet with any open

471
00:18:37,200 --> 00:18:38,080
source wiki

472
00:18:38,080 --> 00:18:41,200
or words press site

473
00:18:41,200 --> 00:18:43,039
depending on the type of enterprise you

474
00:18:43,039 --> 00:18:44,400
are trying to build

475
00:18:44,400 --> 00:18:46,320
you can add an in-house accounting

476
00:18:46,320 --> 00:18:48,160
software for example

477
00:18:48,160 --> 00:18:50,799
or an electronic medical records

478
00:18:50,799 --> 00:18:51,520
application

479
00:18:51,520 --> 00:18:53,360
if our fictional company is the

480
00:18:53,360 --> 00:18:56,400
healthcare system

481
00:18:56,400 --> 00:18:58,799
and to make our lab interesting we can

482
00:18:58,799 --> 00:19:00,320
deploy vulnerable servers

483
00:19:00,320 --> 00:19:03,360
like with exploitable two or three oas

484
00:19:03,360 --> 00:19:04,559
web goats

485
00:19:04,559 --> 00:19:07,360
these vms are vulnerable by design and

486
00:19:07,360 --> 00:19:09,200
have many open ports on

487
00:19:09,200 --> 00:19:12,480
vulnerable services running

488
00:19:14,880 --> 00:19:17,679
so this is how these vms would look like

489
00:19:17,679 --> 00:19:19,520
in our environment

490
00:19:19,520 --> 00:19:22,640
when we deploy a new vm we simply assign

491
00:19:22,640 --> 00:19:24,880
it to the network adapter in e6i

492
00:19:24,880 --> 00:19:27,600
and it will get an ip from pf sense and

493
00:19:27,600 --> 00:19:28,640
according to the ip

494
00:19:28,640 --> 00:19:30,640
and pf sends firewall rules it be

495
00:19:30,640 --> 00:19:34,000
contained in that specific subnet

496
00:19:34,000 --> 00:19:37,600
this way we can easily move any vm from

497
00:19:37,600 --> 00:19:40,160
network or subnet to another by simply

498
00:19:40,160 --> 00:19:42,240
changing which network adapter

499
00:19:42,240 --> 00:19:46,559
its attachment is attached to an a6i

500
00:19:47,039 --> 00:19:50,640
now let's think about how to secure

501
00:19:50,640 --> 00:19:52,240
these subnets

502
00:19:52,240 --> 00:19:54,799
each subnet will see different types of

503
00:19:54,799 --> 00:19:56,160
traffic

504
00:19:56,160 --> 00:19:58,559
do we allow all traffic this subnet or

505
00:19:58,559 --> 00:20:00,160
should we identify which

506
00:20:00,160 --> 00:20:02,640
ports are required and only allow

507
00:20:02,640 --> 00:20:05,200
connections to these ports

508
00:20:05,200 --> 00:20:06,480
especially when it comes to active

509
00:20:06,480 --> 00:20:08,480
directory and domain controller there is

510
00:20:08,480 --> 00:20:10,400
a number of ports that should be open

511
00:20:10,400 --> 00:20:12,240
company-wide in order for users and

512
00:20:12,240 --> 00:20:14,720
workstations to functions

513
00:20:14,720 --> 00:20:17,520
the same things applies for databases

514
00:20:17,520 --> 00:20:19,520
file servers and

515
00:20:19,520 --> 00:20:22,960
all the above also think about

516
00:20:22,960 --> 00:20:26,159
how to manage files permissions how are

517
00:20:26,159 --> 00:20:27,919
you going to make sure certain files

518
00:20:27,919 --> 00:20:30,559
and folders are only accessed by

519
00:20:30,559 --> 00:20:34,960
authorized users

520
00:20:34,960 --> 00:20:38,640
and another thing to think about is

521
00:20:38,640 --> 00:20:41,200
who should be able to access these

522
00:20:41,200 --> 00:20:41,919
servers

523
00:20:41,919 --> 00:20:45,679
over ssas or ssh or rdp to manage and

524
00:20:45,679 --> 00:20:46,720
maintain

525
00:20:46,720 --> 00:20:50,960
this core applications or servers

526
00:20:51,120 --> 00:20:54,400
finally what's the impact of leaving

527
00:20:54,400 --> 00:20:56,400
some of these databases or applications

528
00:20:56,400 --> 00:20:59,200
with the default configurations

529
00:20:59,200 --> 00:21:02,159
how can you check if the default admin

530
00:21:02,159 --> 00:21:02,960
credentials

531
00:21:02,960 --> 00:21:06,240
were never changed can you configure the

532
00:21:06,240 --> 00:21:08,320
application to run

533
00:21:08,320 --> 00:21:12,080
http instead of https why would that be

534
00:21:12,080 --> 00:21:13,919
beneficial

535
00:21:13,919 --> 00:21:17,840
just somebody has to think about

536
00:21:17,840 --> 00:21:21,360
okay now we have some

537
00:21:21,360 --> 00:21:24,000
servers and applications set up we will

538
00:21:24,000 --> 00:21:25,440
need some users to use these

539
00:21:25,440 --> 00:21:27,760
applications and servers of course

540
00:21:27,760 --> 00:21:31,280
so let's add another subnet called user

541
00:21:31,280 --> 00:21:35,520
subnet i usually uh

542
00:21:35,600 --> 00:21:38,000
deploy just windows 10 vms using the

543
00:21:38,000 --> 00:21:38,880
same link as

544
00:21:38,880 --> 00:21:41,440
the servers from microsoft you get about

545
00:21:41,440 --> 00:21:43,120
90 days trial with these

546
00:21:43,120 --> 00:21:45,280
and the same kind of scenario i just

547
00:21:45,280 --> 00:21:48,559
take snapshots and revert them

548
00:21:48,640 --> 00:21:51,520
once you build them

549
00:21:51,679 --> 00:21:53,200
it's going to be a lot of work to kind

550
00:21:53,200 --> 00:21:55,520
of create a lot of users so

551
00:21:55,520 --> 00:21:57,840
there's a really cool script out there

552
00:21:57,840 --> 00:21:59,200
which generates

553
00:21:59,200 --> 00:22:02,400
active directory objects for you script

554
00:22:02,400 --> 00:22:03,919
is called bad blood

555
00:22:03,919 --> 00:22:07,039
and you run it on the domain controller

556
00:22:07,039 --> 00:22:09,679
using domain admin and it will

557
00:22:09,679 --> 00:22:11,520
automatically create hundreds of

558
00:22:11,520 --> 00:22:14,799
users and workstations in your active

559
00:22:14,799 --> 00:22:16,720
directory within like 15-20 minutes

560
00:22:16,720 --> 00:22:19,360
and you can have a more realistic active

561
00:22:19,360 --> 00:22:22,080
directory that way

562
00:22:22,080 --> 00:22:24,320
also another thing to think about for

563
00:22:24,320 --> 00:22:25,440
our users is

564
00:22:25,440 --> 00:22:27,760
if we want to simulate these users um

565
00:22:27,760 --> 00:22:30,000
there's plenty of options

566
00:22:30,000 --> 00:22:33,280
we can use uh web traffic generator

567
00:22:33,280 --> 00:22:34,080
which

568
00:22:34,080 --> 00:22:37,600
will run as a script on the vm on the

569
00:22:37,600 --> 00:22:38,799
list of windows 10 vm

570
00:22:38,799 --> 00:22:42,320
and it will just visit random sites

571
00:22:42,320 --> 00:22:46,000
all the time android all of web traffic

572
00:22:46,000 --> 00:22:50,400
the next option up is using

573
00:22:50,400 --> 00:22:54,000
invoke users simulator which on the top

574
00:22:54,000 --> 00:22:55,200
of web traffic it will

575
00:22:55,200 --> 00:22:58,960
also uh

576
00:22:58,960 --> 00:23:02,400
it will also run uh i'm sorry it will

577
00:23:02,400 --> 00:23:02,880
also

578
00:23:02,880 --> 00:23:06,080
open unread emails so if you send a

579
00:23:06,080 --> 00:23:07,600
phishing email to this user

580
00:23:07,600 --> 00:23:09,360
and is sitting in their outlook this

581
00:23:09,360 --> 00:23:10,960
script will actually read it

582
00:23:10,960 --> 00:23:14,880
and execute it for us and it also

583
00:23:14,880 --> 00:23:16,640
will have the user access different file

584
00:23:16,640 --> 00:23:20,480
shares that we specify

585
00:23:20,960 --> 00:23:24,000
the last link for it's pretty much for a

586
00:23:24,000 --> 00:23:24,799
full-fledged

587
00:23:24,799 --> 00:23:28,960
uh simulation uh called ghosts

588
00:23:28,960 --> 00:23:30,640
this is gonna lead off work because

589
00:23:30,640 --> 00:23:32,720
you're gonna have to deploy a server

590
00:23:32,720 --> 00:23:34,240
a master server for all the different

591
00:23:34,240 --> 00:23:36,000
clients to talk to but this

592
00:23:36,000 --> 00:23:40,720
would do pretty much a lot of simulation

593
00:23:40,799 --> 00:23:44,960
from running commands to

594
00:23:45,279 --> 00:23:47,200
opening documents creating documents

595
00:23:47,200 --> 00:23:51,840
everything just like learning experience

596
00:23:54,080 --> 00:23:55,919
now since our company keeps getting

597
00:23:55,919 --> 00:23:58,400
bigger with more users

598
00:23:58,400 --> 00:23:59,840
we're going to need to hire some it

599
00:23:59,840 --> 00:24:01,520
admins and give them

600
00:24:01,520 --> 00:24:04,559
some access to all the servers

601
00:24:04,559 --> 00:24:07,440
we can use a windows server and add the

602
00:24:07,440 --> 00:24:09,279
remote desktop services role

603
00:24:09,279 --> 00:24:11,279
so that multiple admins could rdp at the

604
00:24:11,279 --> 00:24:13,760
same time

605
00:24:13,760 --> 00:24:15,440
and to make things interesting in this

606
00:24:15,440 --> 00:24:17,760
subnet we can get an older copy

607
00:24:17,760 --> 00:24:20,799
of manage engine desktop central from

608
00:24:20,799 --> 00:24:22,880
their archive

609
00:24:22,880 --> 00:24:25,760
and we can run it as a free trial for 30

610
00:24:25,760 --> 00:24:27,520
days

611
00:24:27,520 --> 00:24:30,480
this specific software has is widely

612
00:24:30,480 --> 00:24:32,480
used by it admins today

613
00:24:32,480 --> 00:24:35,520
to manage endpoints but many previous

614
00:24:35,520 --> 00:24:36,960
versions of the software

615
00:24:36,960 --> 00:24:38,880
is vulnerable and has been exported

616
00:24:38,880 --> 00:24:41,360
heavily

617
00:24:44,320 --> 00:24:47,520
ok let's think about how do we allow it

618
00:24:47,520 --> 00:24:50,400
admins now to do their job

619
00:24:50,400 --> 00:24:52,320
one of the good security practices out

620
00:24:52,320 --> 00:24:53,600
there is to create

621
00:24:53,600 --> 00:24:56,720
a dedicated jump box for it admins

622
00:24:56,720 --> 00:24:59,760
the idea is it admins should not connect

623
00:24:59,760 --> 00:25:00,480
directly

624
00:25:00,480 --> 00:25:02,640
from their their laptop in the user

625
00:25:02,640 --> 00:25:04,000
subnets

626
00:25:04,000 --> 00:25:06,720
in this example

627
00:25:07,120 --> 00:25:09,840
but rather they connect to a jump box

628
00:25:09,840 --> 00:25:10,480
and use

629
00:25:10,480 --> 00:25:12,480
that jump box to manage or move around

630
00:25:12,480 --> 00:25:14,880
the environment

631
00:25:14,880 --> 00:25:16,880
so with that concept in mind how are we

632
00:25:16,880 --> 00:25:18,000
going to restrict

633
00:25:18,000 --> 00:25:20,720
access to the sensitive i.t jump boxes

634
00:25:20,720 --> 00:25:22,000
subnet

635
00:25:22,000 --> 00:25:24,400
are we going to do it by username or are

636
00:25:24,400 --> 00:25:26,880
we going to do it using firewall rules

637
00:25:26,880 --> 00:25:30,000
meaning should we allow certain users

638
00:25:30,000 --> 00:25:32,640
to be authorized to log into these

639
00:25:32,640 --> 00:25:33,919
jumbox servers

640
00:25:33,919 --> 00:25:36,480
using active directory or are we going

641
00:25:36,480 --> 00:25:37,600
to

642
00:25:37,600 --> 00:25:40,159
enforce access control by limiting which

643
00:25:40,159 --> 00:25:40,880
machines

644
00:25:40,880 --> 00:25:44,799
is able to connect to these jump boxes

645
00:25:45,760 --> 00:25:48,480
also how the boxes in the submits is

646
00:25:48,480 --> 00:25:49,200
able

647
00:25:49,200 --> 00:25:52,880
to access the other servers

648
00:25:52,880 --> 00:25:56,640
should each jump box has two necks

649
00:25:56,640 --> 00:25:59,679
should we use firewall to restrict

650
00:25:59,679 --> 00:26:01,840
who they can talk to what's the

651
00:26:01,840 --> 00:26:04,799
implication of each approach

652
00:26:04,799 --> 00:26:06,320
which one would you prefer as an

653
00:26:06,320 --> 00:26:08,799
attacker

654
00:26:08,960 --> 00:26:11,360
and the last thing is with all these

655
00:26:11,360 --> 00:26:12,799
user machines being

656
00:26:12,799 --> 00:26:15,279
deployed think about how can you harden

657
00:26:15,279 --> 00:26:17,120
these users machines

658
00:26:17,120 --> 00:26:19,520
and servers also which gpos do you want

659
00:26:19,520 --> 00:26:20,159
to use

660
00:26:20,159 --> 00:26:21,679
which logging levels do you want to

661
00:26:21,679 --> 00:26:23,840
enable

662
00:26:23,840 --> 00:26:26,399
and so on

663
00:26:28,240 --> 00:26:31,679
now let's give our company some online

664
00:26:31,679 --> 00:26:34,159
presence

665
00:26:35,039 --> 00:26:36,840
so we're going to deploy some vms in the

666
00:26:36,840 --> 00:26:38,320
dmz

667
00:26:38,320 --> 00:26:40,960
the dmz was originally designed as a

668
00:26:40,960 --> 00:26:41,520
buffer

669
00:26:41,520 --> 00:26:43,760
between the hostile internet and the

670
00:26:43,760 --> 00:26:45,840
internal network

671
00:26:45,840 --> 00:26:49,840
so what should we build in our dmz

672
00:26:49,840 --> 00:26:51,200
well every company is going to have a

673
00:26:51,200 --> 00:26:53,039
website

674
00:26:53,039 --> 00:26:55,760
and to make our website interesting we

675
00:26:55,760 --> 00:26:57,840
can go through the wp scan

676
00:26:57,840 --> 00:27:01,200
vulnerability database and find the a

677
00:27:01,200 --> 00:27:01,919
good

678
00:27:01,919 --> 00:27:04,240
vulnerable plugin or version of

679
00:27:04,240 --> 00:27:06,240
wordpress and use it

680
00:27:06,240 --> 00:27:08,960
and install it on our wordpress site to

681
00:27:08,960 --> 00:27:10,240
have it

682
00:27:10,240 --> 00:27:13,360
be vulnerable another thing is if

683
00:27:13,360 --> 00:27:15,120
we want to do e-commerce if a kind of

684
00:27:15,120 --> 00:27:17,200
our company sells stuff why don't we use

685
00:27:17,200 --> 00:27:20,640
oas juice shop which is a

686
00:27:20,640 --> 00:27:22,000
another application that is vulnerable

687
00:27:22,000 --> 00:27:24,399
by design and it's pretty much a store

688
00:27:24,399 --> 00:27:25,600
that you go through and buy different

689
00:27:25,600 --> 00:27:28,640
juices and fruits and stuff

690
00:27:28,640 --> 00:27:30,880
that's another idea another good site to

691
00:27:30,880 --> 00:27:32,840
have if you want to have something

692
00:27:32,840 --> 00:27:35,840
vulnerable

693
00:27:37,360 --> 00:27:39,440
also a lot of companies will will have

694
00:27:39,440 --> 00:27:41,120
ftp servers running

695
00:27:41,120 --> 00:27:44,320
this is how they still

696
00:27:44,640 --> 00:27:46,480
store files exchange file their

697
00:27:46,480 --> 00:27:49,600
customers or their partners and so on

698
00:27:49,600 --> 00:27:52,240
why don't we have another misconfigured

699
00:27:52,240 --> 00:27:54,799
ftp server with reconfiguration

700
00:27:54,799 --> 00:27:57,600
or just run an old software ftp software

701
00:27:57,600 --> 00:27:59,360
on that server

702
00:27:59,360 --> 00:28:02,240
and see that as the initial portfolio in

703
00:28:02,240 --> 00:28:04,880
our dmz

704
00:28:06,720 --> 00:28:09,360
with a lot of the latest vulnerabilities

705
00:28:09,360 --> 00:28:11,279
going on the past two weeks citrix

706
00:28:11,279 --> 00:28:14,880
scalar f5 big ip what we can also do is

707
00:28:14,880 --> 00:28:17,679
we can go to these vendor sites and sign

708
00:28:17,679 --> 00:28:18,480
up

709
00:28:18,480 --> 00:28:21,039
for an account and we can download

710
00:28:21,039 --> 00:28:23,600
actually free trials of this software

711
00:28:23,600 --> 00:28:25,600
so why don't we just sign up get these

712
00:28:25,600 --> 00:28:27,360
vms deployment our vlan

713
00:28:27,360 --> 00:28:30,480
in our lab and put them in this dmz vlan

714
00:28:30,480 --> 00:28:33,679
to pretty much mimic a real uh or a real

715
00:28:33,679 --> 00:28:35,760
scenario or a live scenario

716
00:28:35,760 --> 00:28:38,799
and go thrust to go through that

717
00:28:38,799 --> 00:28:40,480
and finally if you really run out of

718
00:28:40,480 --> 00:28:42,000
ideas and you're not we don't have

719
00:28:42,000 --> 00:28:44,399
much else to deploy there's always

720
00:28:44,399 --> 00:28:45,520
vulnerable hub

721
00:28:45,520 --> 00:28:49,279
vms where we can go download purposely

722
00:28:49,279 --> 00:28:52,799
designed vms vms and add them and again

723
00:28:52,799 --> 00:28:53,200
the

724
00:28:53,200 --> 00:28:58,720
the options are endless

725
00:28:58,720 --> 00:29:01,360
so now that we have finally brought in a

726
00:29:01,360 --> 00:29:04,640
higher risk subnet into the picture

727
00:29:04,640 --> 00:29:06,240
we want to make sure our internal

728
00:29:06,240 --> 00:29:08,399
network stays safe

729
00:29:08,399 --> 00:29:10,640
many companies implement a firewall

730
00:29:10,640 --> 00:29:11,760
between the dmz

731
00:29:11,760 --> 00:29:14,320
and the internal network but since this

732
00:29:14,320 --> 00:29:15,120
is a lab

733
00:29:15,120 --> 00:29:17,120
i wanted to see if i can accomplish

734
00:29:17,120 --> 00:29:19,679
similar results using a dedicated vlan

735
00:29:19,679 --> 00:29:21,840
or the dmz along with the proper

736
00:29:21,840 --> 00:29:23,600
firewalls

737
00:29:23,600 --> 00:29:27,440
things to think about how should our ibm

738
00:29:27,440 --> 00:29:31,120
our it admins manage the dmz

739
00:29:31,120 --> 00:29:32,720
which could also credential what are

740
00:29:32,720 --> 00:29:34,559
they going to use how these

741
00:29:34,559 --> 00:29:38,399
connections are going to take place

742
00:29:38,399 --> 00:29:41,039
what if an application in our dmz uses a

743
00:29:41,039 --> 00:29:42,480
database

744
00:29:42,480 --> 00:29:46,000
where should we store this database

745
00:29:51,440 --> 00:29:53,840
i also wanted to add additional subnets

746
00:29:53,840 --> 00:29:55,360
to my lab network

747
00:29:55,360 --> 00:29:57,440
to make it a little bit more realistic

748
00:29:57,440 --> 00:29:59,520
and challenging

749
00:29:59,520 --> 00:30:02,000
the first is an air gap network this

750
00:30:02,000 --> 00:30:03,520
network is usually dedicated for

751
00:30:03,520 --> 00:30:05,120
isolating high risk

752
00:30:05,120 --> 00:30:08,080
assets assets that can receive updates

753
00:30:08,080 --> 00:30:08,720
anymore

754
00:30:08,720 --> 00:30:14,320
or unable to apply updates or patches

755
00:30:14,320 --> 00:30:16,320
these assets are not supposed to be able

756
00:30:16,320 --> 00:30:18,159
to connect to the internet

757
00:30:18,159 --> 00:30:21,279
if you have some old copies of windows

758
00:30:21,279 --> 00:30:23,039
xp or 2003

759
00:30:23,039 --> 00:30:24,640
laying around that would be really cool

760
00:30:24,640 --> 00:30:26,960
to deploy on your network

761
00:30:26,960 --> 00:30:29,520
you can also try to find any industrial

762
00:30:29,520 --> 00:30:31,200
control system or iot

763
00:30:31,200 --> 00:30:34,240
iot device simulator

764
00:30:34,240 --> 00:30:37,440
if not i would just use another windows

765
00:30:37,440 --> 00:30:38,080
vm

766
00:30:38,080 --> 00:30:42,080
10 vm without any updates and

767
00:30:42,080 --> 00:30:45,200
limit that vm ability to talk to other

768
00:30:45,200 --> 00:30:46,799
segments of the network using firewall

769
00:30:46,799 --> 00:30:48,880
rules

770
00:30:48,880 --> 00:30:51,679
another uh subnet that i created was a

771
00:30:51,679 --> 00:30:53,279
vpn connection

772
00:30:53,279 --> 00:30:56,399
so i can connect directly into this slab

773
00:30:56,399 --> 00:30:57,200
environment

774
00:30:57,200 --> 00:31:00,480
from anywhere i need it to and i

775
00:31:00,480 --> 00:31:03,279
also use this vpn connection to share

776
00:31:03,279 --> 00:31:04,640
with other researchers

777
00:31:04,640 --> 00:31:08,320
so we can all work together in the lab

778
00:31:08,320 --> 00:31:11,440
pfsense can help you build this easily

779
00:31:11,440 --> 00:31:14,000
um we just have to deal a little bit but

780
00:31:14,000 --> 00:31:15,039
have to learn a little bit about

781
00:31:15,039 --> 00:31:16,240
certificates

782
00:31:16,240 --> 00:31:18,960
and pf pfsense made it really easy to do

783
00:31:18,960 --> 00:31:21,120
it

784
00:31:21,440 --> 00:31:24,480
i also did create the guest wi-fi subnet

785
00:31:24,480 --> 00:31:27,279
for our fictional company since every

786
00:31:27,279 --> 00:31:29,679
company is going to have visitors

787
00:31:29,679 --> 00:31:32,000
pfsense also gives us the ability to

788
00:31:32,000 --> 00:31:33,519
create the captive portal

789
00:31:33,519 --> 00:31:36,000
and guest users registration and

790
00:31:36,000 --> 00:31:38,799
tracking and so on

791
00:31:38,799 --> 00:31:41,840
in the last pieces i added a home wi-fi

792
00:31:41,840 --> 00:31:45,200
to connect directly to this enterprise

793
00:31:45,200 --> 00:31:46,399
from my laptop

794
00:31:46,399 --> 00:31:49,439
anywhere in my house

795
00:31:51,600 --> 00:31:54,159
so what i did for that is i bought a

796
00:31:54,159 --> 00:31:55,600
refurbished router

797
00:31:55,600 --> 00:31:57,919
and configured it to act as an access

798
00:31:57,919 --> 00:31:58,960
point

799
00:31:58,960 --> 00:32:01,360
and connected it to a third physical

800
00:32:01,360 --> 00:32:02,399
neck on the

801
00:32:02,399 --> 00:32:05,439
on the physical host

802
00:32:05,519 --> 00:32:08,480
since i wasn't able to assign a vlan id

803
00:32:08,480 --> 00:32:10,080
to the access point

804
00:32:10,080 --> 00:32:11,919
the vlan tag was automatically set to

805
00:32:11,919 --> 00:32:14,000
zero which means anyone

806
00:32:14,000 --> 00:32:15,919
connects to the asap will be part of the

807
00:32:15,919 --> 00:32:17,360
lan network

808
00:32:17,360 --> 00:32:20,880
but now the cool thing is i have a wi-fi

809
00:32:20,880 --> 00:32:21,519
network

810
00:32:21,519 --> 00:32:24,240
directly inside this enterprise so i can

811
00:32:24,240 --> 00:32:24,640
just

812
00:32:24,640 --> 00:32:27,039
open my laptop connect list ap or this

813
00:32:27,039 --> 00:32:28,480
wifi network

814
00:32:28,480 --> 00:32:32,000
and i'm directly inside my enterprise

815
00:32:32,000 --> 00:32:36,240
that's virtualized in a box

816
00:32:37,519 --> 00:32:39,200
one more thing is the ap is useful for

817
00:32:39,200 --> 00:32:41,600
is if we want to test

818
00:32:41,600 --> 00:32:43,200
wi-fi attacks if that's what you're

819
00:32:43,200 --> 00:32:44,480
interested in and you want to play with

820
00:32:44,480 --> 00:32:46,000
wi-fi attacks that would be a great

821
00:32:46,000 --> 00:32:46,880
opportunity

822
00:32:46,880 --> 00:32:49,360
to mimic wi-fi attacks against our

823
00:32:49,360 --> 00:32:52,000
enterprise

824
00:32:53,039 --> 00:32:56,480
okay now moving on to the attacking side

825
00:32:56,480 --> 00:32:58,320
if you want to work on your red team

826
00:32:58,320 --> 00:33:01,120
skills you can add an attacker vm

827
00:33:01,120 --> 00:33:04,720
or vms for that matter i think most of

828
00:33:04,720 --> 00:33:05,120
you

829
00:33:05,120 --> 00:33:07,200
will know what kind of kalyanics is but

830
00:33:07,200 --> 00:33:08,960
uh if you don't it's an open source

831
00:33:08,960 --> 00:33:10,080
distribution

832
00:33:10,080 --> 00:33:11,760
that has many offensive tools and

833
00:33:11,760 --> 00:33:14,960
scripts out of the box

834
00:33:16,399 --> 00:33:18,559
if you're more interested in trying a

835
00:33:18,559 --> 00:33:20,159
windows based

836
00:33:20,159 --> 00:33:22,960
attacking machine check out commando vm

837
00:33:22,960 --> 00:33:23,360
from

838
00:33:23,360 --> 00:33:26,640
uh fireeye and

839
00:33:26,640 --> 00:33:30,720
if you don't wanna do exploits um or

840
00:33:30,720 --> 00:33:33,039
manual band testing and your thing is

841
00:33:33,039 --> 00:33:33,919
more of

842
00:33:33,919 --> 00:33:36,159
hey i just wanna do some command and

843
00:33:36,159 --> 00:33:38,240
control traffic i want to i want to send

844
00:33:38,240 --> 00:33:39,919
malware and i want to not malware i want

845
00:33:39,919 --> 00:33:41,440
to control it

846
00:33:41,440 --> 00:33:44,320
from my vm then i would strongly

847
00:33:44,320 --> 00:33:45,360
recommend check out

848
00:33:45,360 --> 00:33:48,480
slingshot c2 metrics it has

849
00:33:48,480 --> 00:33:50,480
many different command and control

850
00:33:50,480 --> 00:33:51,600
frameworks

851
00:33:51,600 --> 00:33:54,159
out of the box and you can easily spin

852
00:33:54,159 --> 00:33:55,039
up the

853
00:33:55,039 --> 00:33:57,039
quantum control server and create your

854
00:33:57,039 --> 00:33:58,159
payloads and

855
00:33:58,159 --> 00:34:01,440
malware and send it

856
00:34:01,440 --> 00:34:07,600
to your victim

857
00:34:07,600 --> 00:34:08,800
okay i'm reading the question here's a

858
00:34:08,800 --> 00:34:10,320
great one to add to your list if you're

859
00:34:10,320 --> 00:34:12,639
not one

860
00:34:14,879 --> 00:34:17,839
okay sorry i was getting the uh question

861
00:34:17,839 --> 00:34:18,079
i

862
00:34:18,079 --> 00:34:21,679
got an answer okay we uh next

863
00:34:21,679 --> 00:34:23,040
so let's talk about the red team we

864
00:34:23,040 --> 00:34:26,320
attach the attacking vms to vswitch zero

865
00:34:26,320 --> 00:34:29,520
so in this case they can get an ip from

866
00:34:29,520 --> 00:34:30,960
our home firewall

867
00:34:30,960 --> 00:34:33,760
and be blind to everything behind the pf

868
00:34:33,760 --> 00:34:35,199
sense

869
00:34:35,199 --> 00:34:37,918
this is how i define the internet zone

870
00:34:37,918 --> 00:34:38,879
which is the zone

871
00:34:38,879 --> 00:34:42,159
outside our wind but still within our

872
00:34:42,159 --> 00:34:44,800
home network

873
00:34:45,679 --> 00:34:47,440
now we can start attacking all the

874
00:34:47,440 --> 00:34:49,359
vulnerable vms that we have been

875
00:34:49,359 --> 00:34:51,839
creating throughout this environment

876
00:34:51,839 --> 00:34:53,918
let's think about how to attack this

877
00:34:53,918 --> 00:34:55,520
enterprise

878
00:34:55,520 --> 00:34:58,160
do we scan the dmz and compromise it

879
00:34:58,160 --> 00:34:59,680
first and then move to the

880
00:34:59,680 --> 00:35:02,000
internal network or do we send an

881
00:35:02,000 --> 00:35:03,760
employee a phishing email and have a

882
00:35:03,760 --> 00:35:04,800
malware running

883
00:35:04,800 --> 00:35:07,599
in their vm and start from the user's

884
00:35:07,599 --> 00:35:09,440
network

885
00:35:09,440 --> 00:35:12,160
the possibilities are truly endless and

886
00:35:12,160 --> 00:35:14,240
this is where we really can get creative

887
00:35:14,240 --> 00:35:17,839
with our approach

888
00:35:18,480 --> 00:35:21,359
now we get into my favorite parts

889
00:35:21,359 --> 00:35:22,880
defending and detecting

890
00:35:22,880 --> 00:35:26,079
the attacks against our enterprise

891
00:35:26,079 --> 00:35:28,320
in simple terms we need three core

892
00:35:28,320 --> 00:35:30,320
components to detect attacks

893
00:35:30,320 --> 00:35:34,320
and attackers the first component is the

894
00:35:34,320 --> 00:35:34,960
logs

895
00:35:34,960 --> 00:35:37,280
things like your firewall logs your vpn

896
00:35:37,280 --> 00:35:38,320
logs

897
00:35:38,320 --> 00:35:40,640
we need a place to collect and analyze

898
00:35:40,640 --> 00:35:42,240
these logs

899
00:35:42,240 --> 00:35:45,440
second piece is network traffic data

900
00:35:45,440 --> 00:35:47,680
this will help us understand how packets

901
00:35:47,680 --> 00:35:50,000
move around our environment

902
00:35:50,000 --> 00:35:52,320
and the third piece and finally is the

903
00:35:52,320 --> 00:35:54,480
endpoint data

904
00:35:54,480 --> 00:35:56,400
input data will give us the visibility

905
00:35:56,400 --> 00:35:58,160
into activities that takes place

906
00:35:58,160 --> 00:36:00,640
at the host level things like which

907
00:36:00,640 --> 00:36:01,680
process is ran

908
00:36:01,680 --> 00:36:06,640
or who locked into the machine and so on

909
00:36:09,440 --> 00:36:12,640
so for our let's start off with our

910
00:36:12,640 --> 00:36:14,320
network security monitoring

911
00:36:14,320 --> 00:36:17,760
or how we can get network traffic

912
00:36:17,760 --> 00:36:19,520
first as i mentioned earlier we need to

913
00:36:19,520 --> 00:36:21,680
attach the promiscuous vlan

914
00:36:21,680 --> 00:36:25,680
port into this vm so it can get copy of

915
00:36:25,680 --> 00:36:29,118
the traffic that we want to monitor

916
00:36:29,599 --> 00:36:31,440
after that depends on what we're looking

917
00:36:31,440 --> 00:36:32,960
for we can deploy

918
00:36:32,960 --> 00:36:36,640
zeek which is uh it's an open source

919
00:36:36,640 --> 00:36:37,440
tool

920
00:36:37,440 --> 00:36:39,440
that's in between netflow and a full

921
00:36:39,440 --> 00:36:40,720
packet capture

922
00:36:40,720 --> 00:36:44,000
it's been used widely and it gives us a

923
00:36:44,000 --> 00:36:44,960
lot of

924
00:36:44,960 --> 00:36:47,359
logs that we can look at and see the

925
00:36:47,359 --> 00:36:50,079
traffic that happens in our environment

926
00:36:50,079 --> 00:36:52,880
another option that we can do is cercata

927
00:36:52,880 --> 00:36:54,240
which is uh

928
00:36:54,240 --> 00:36:56,079
intrusion detection system we can't

929
00:36:56,079 --> 00:36:57,359
compare it to zeke it's

930
00:36:57,359 --> 00:37:00,079
it's different but it pretty much looks

931
00:37:00,079 --> 00:37:01,440
at signatures

932
00:37:01,440 --> 00:37:05,200
uh to detect attacks and abnormal

933
00:37:05,200 --> 00:37:07,440
unknown attacks actually or things that

934
00:37:07,440 --> 00:37:08,320
we can

935
00:37:08,320 --> 00:37:11,200
tell it to monitor

936
00:37:11,920 --> 00:37:14,560
next up is security onion which combines

937
00:37:14,560 --> 00:37:15,119
both

938
00:37:15,119 --> 00:37:17,359
zeke and circada out of the box and many

939
00:37:17,359 --> 00:37:18,480
other tools

940
00:37:18,480 --> 00:37:20,560
security onion is awesome because it's

941
00:37:20,560 --> 00:37:23,520
not a tool it's a whole distribution

942
00:37:23,520 --> 00:37:26,160
this troop you uh linux distro that we

943
00:37:26,160 --> 00:37:27,280
can deploy

944
00:37:27,280 --> 00:37:30,640
and out of the box it has zeke sorcata

945
00:37:30,640 --> 00:37:33,680
and elasticstack so we can get all the

946
00:37:33,680 --> 00:37:36,160
network traffic and full packet capture

947
00:37:36,160 --> 00:37:38,800
and everything else so that would be an

948
00:37:38,800 --> 00:37:41,520
easier route to go with if you

949
00:37:41,520 --> 00:37:42,960
want to have something up and running

950
00:37:42,960 --> 00:37:45,520
very quickly

951
00:37:46,720 --> 00:37:49,040
also for full packet capture i really

952
00:37:49,040 --> 00:37:50,079
like malik

953
00:37:50,079 --> 00:37:52,720
malik will give us the ability to do a

954
00:37:52,720 --> 00:37:54,079
full packet capture

955
00:37:54,079 --> 00:37:57,599
and store it in an elastic search

956
00:37:57,599 --> 00:38:00,960
database so think of it as as you can as

957
00:38:00,960 --> 00:38:05,839
wireshark as the front end and then

958
00:38:06,400 --> 00:38:08,240
like elastic search or big database at

959
00:38:08,240 --> 00:38:09,920
the back end and you can easily

960
00:38:09,920 --> 00:38:14,400
hunt and look for traffic to the mallet

961
00:38:15,839 --> 00:38:20,160
what about our endpoint visibility

962
00:38:20,160 --> 00:38:22,880
we can use this one sessmon will give us

963
00:38:22,880 --> 00:38:26,079
additional event ids for windows

964
00:38:26,079 --> 00:38:29,760
so we can for example see which process

965
00:38:29,760 --> 00:38:31,520
is the child of which process or which

966
00:38:31,520 --> 00:38:33,440
process created center dns

967
00:38:33,440 --> 00:38:36,160
query and so on it will give us about 23

968
00:38:36,160 --> 00:38:36,640
event

969
00:38:36,640 --> 00:38:39,119
additional admin ids that are very

970
00:38:39,119 --> 00:38:40,000
important

971
00:38:40,000 --> 00:38:41,920
and help us a lot to get a better

972
00:38:41,920 --> 00:38:44,560
visibility of activities that took place

973
00:38:44,560 --> 00:38:47,920
at the host level uh

974
00:38:47,920 --> 00:38:49,520
if you're interested in actually

975
00:38:49,520 --> 00:38:51,359
actively

976
00:38:51,359 --> 00:38:53,839
looking into a machine and getting

977
00:38:53,839 --> 00:38:55,599
artifacts or data from

978
00:38:55,599 --> 00:38:58,400
a host check out client fleet and os

979
00:38:58,400 --> 00:38:59,119
query

980
00:38:59,119 --> 00:39:01,760
it uses sql-like language so you can

981
00:39:01,760 --> 00:39:03,839
write a query and it will go

982
00:39:03,839 --> 00:39:06,320
create that machine specifically and get

983
00:39:06,320 --> 00:39:09,520
back with you with the results

984
00:39:10,160 --> 00:39:12,480
finally is wazoo which is pretty much a

985
00:39:12,480 --> 00:39:14,720
host intrusion detection system

986
00:39:14,720 --> 00:39:18,160
um it's it will detect

987
00:39:18,160 --> 00:39:20,720
activities at a host level and also

988
00:39:20,720 --> 00:39:23,839
enable additional logging

989
00:39:24,079 --> 00:39:26,240
now with all these tools most of these

990
00:39:26,240 --> 00:39:28,320
tools are if not all regulate some kind

991
00:39:28,320 --> 00:39:30,720
of logs we will need to get these logs

992
00:39:30,720 --> 00:39:33,920
into some kind of aggregator so

993
00:39:33,920 --> 00:39:35,599
that's what we call a sim sim is a place

994
00:39:35,599 --> 00:39:37,440
to store all the logs analyze them and

995
00:39:37,440 --> 00:39:40,560
make some sense out of them

996
00:39:41,040 --> 00:39:43,359
the most common open source tools pretty

997
00:39:43,359 --> 00:39:44,240
much the elastic

998
00:39:44,240 --> 00:39:48,079
stack has been uh very popular lately

999
00:39:48,079 --> 00:39:51,680
and for a long time actually um

1000
00:39:52,400 --> 00:39:55,520
check out hulk which is hunting elk by

1001
00:39:55,520 --> 00:39:58,240
roberto rodriguez that's uh it's a

1002
00:39:58,240 --> 00:40:00,800
really nice

1003
00:40:00,800 --> 00:40:04,960
elastic stack modified version

1004
00:40:04,960 --> 00:40:07,119
it has many other components and he also

1005
00:40:07,119 --> 00:40:08,079
added other

1006
00:40:08,079 --> 00:40:10,640
abuses to use it like running new manual

1007
00:40:10,640 --> 00:40:11,680
queries and

1008
00:40:11,680 --> 00:40:15,839
joining different data sets together

1009
00:40:16,000 --> 00:40:19,599
sof elk is also by phil hagen from sans

1010
00:40:19,599 --> 00:40:23,440
um also another really good x stack

1011
00:40:23,440 --> 00:40:26,240
i really like it because he also added

1012
00:40:26,240 --> 00:40:27,359
the ability to

1013
00:40:27,359 --> 00:40:31,280
parse net flow data out of the box so

1014
00:40:31,280 --> 00:40:34,000
check it out too another another flavor

1015
00:40:34,000 --> 00:40:35,680
of open source is the gray log

1016
00:40:35,680 --> 00:40:39,680
grid logs for gridlock is also also

1017
00:40:39,680 --> 00:40:43,680
free and the interface for free

1018
00:40:43,680 --> 00:40:46,160
i i prefer the interface for greylock i

1019
00:40:46,160 --> 00:40:48,720
think it's more user friendly

1020
00:40:48,720 --> 00:40:51,280
and it also uses elasticsearch as the

1021
00:40:51,280 --> 00:40:52,000
back end so

1022
00:40:52,000 --> 00:40:53,359
it's the same back-end as the elastic

1023
00:40:53,359 --> 00:40:55,040
stack it's just a different

1024
00:40:55,040 --> 00:40:57,759
gui if you will

1025
00:40:58,160 --> 00:41:01,280
and the last option is splunk now splunk

1026
00:41:01,280 --> 00:41:02,960
is commercial

1027
00:41:02,960 --> 00:41:06,000
but you can get a free license

1028
00:41:06,000 --> 00:41:10,880
for up to 500 mix of vlogs a day

1029
00:41:10,880 --> 00:41:12,720
if you haven't checked out splunk you

1030
00:41:12,720 --> 00:41:14,079
know it comes up

1031
00:41:14,079 --> 00:41:16,400
everywhere a lot of job posts have

1032
00:41:16,400 --> 00:41:17,680
splunk on them so

1033
00:41:17,680 --> 00:41:19,200
this will be a really good opportunity

1034
00:41:19,200 --> 00:41:21,680
to have splunk deployed

1035
00:41:21,680 --> 00:41:24,960
and working

1036
00:41:24,960 --> 00:41:28,000
with the sam again think about

1037
00:41:28,000 --> 00:41:30,000
how you're going to get the data right

1038
00:41:30,000 --> 00:41:31,119
if it's a firewall that you're going to

1039
00:41:31,119 --> 00:41:31,920
collect from

1040
00:41:31,920 --> 00:41:32,960
how are you going to send the data to

1041
00:41:32,960 --> 00:41:34,720
your sim is it going to be a syslog or

1042
00:41:34,720 --> 00:41:36,240
are you going to deploy an agent to pull

1043
00:41:36,240 --> 00:41:37,520
this data

1044
00:41:37,520 --> 00:41:40,000
again for for an enterprise level

1045
00:41:40,000 --> 00:41:41,040
operations

1046
00:41:41,040 --> 00:41:42,160
there's going to be a lot of movement

1047
00:41:42,160 --> 00:41:43,760
parts here that you're going to have to

1048
00:41:43,760 --> 00:41:45,520
figure out along the journey

1049
00:41:45,520 --> 00:41:49,839
and this will give you insights to it

1050
00:41:50,880 --> 00:41:53,280
okay so some more additional security

1051
00:41:53,280 --> 00:41:55,040
tools that we can play with

1052
00:41:55,040 --> 00:41:58,079
we need if you want to understand the

1053
00:41:58,079 --> 00:41:59,599
vulnerabilities that you have in your

1054
00:41:59,599 --> 00:42:00,480
environment

1055
00:42:00,480 --> 00:42:02,000
you will need some kind of vulnerability

1056
00:42:02,000 --> 00:42:04,400
scanner openvest is an open source

1057
00:42:04,400 --> 00:42:07,359
monopoly scanner that you can use and

1058
00:42:07,359 --> 00:42:07,839
it's

1059
00:42:07,839 --> 00:42:11,920
uh it's available

1060
00:42:11,920 --> 00:42:13,839
also another option that i like to use

1061
00:42:13,839 --> 00:42:16,720
is actually an ss they have up to 16 ips

1062
00:42:16,720 --> 00:42:20,560
for free deploy it scan your environment

1063
00:42:20,560 --> 00:42:21,839
look at the results

1064
00:42:21,839 --> 00:42:23,280
if you're an attacker you're probably

1065
00:42:23,280 --> 00:42:25,119
already using some of these if you're a

1066
00:42:25,119 --> 00:42:26,240
defender

1067
00:42:26,240 --> 00:42:29,440
you will see what can you make what what

1068
00:42:29,440 --> 00:42:30,800
sense can you make out of the data that

1069
00:42:30,800 --> 00:42:33,119
you can get out of these scanners

1070
00:42:33,119 --> 00:42:35,599
is the data what would you go how would

1071
00:42:35,599 --> 00:42:37,040
you go about patching your

1072
00:42:37,040 --> 00:42:40,640
environment and so on

1073
00:42:41,040 --> 00:42:43,599
if malware is your thing you definitely

1074
00:42:43,599 --> 00:42:45,200
have to have a sandbox

1075
00:42:45,200 --> 00:42:47,040
you can deploy a sandbox in our

1076
00:42:47,040 --> 00:42:49,440
enterprise cuckoo sandbox is

1077
00:42:49,440 --> 00:42:52,800
a well-known sandbox and you pretty much

1078
00:42:52,800 --> 00:42:55,760
set it up deploy it you send it a file

1079
00:42:55,760 --> 00:42:57,119
and it allows it for you and it gives

1080
00:42:57,119 --> 00:42:58,480
you a report

1081
00:42:58,480 --> 00:43:00,800
another good option to have in our blue

1082
00:43:00,800 --> 00:43:03,680
team toolbox

1083
00:43:04,880 --> 00:43:08,560
finally honey pots honey pots are

1084
00:43:08,560 --> 00:43:10,880
pretty much traps that you can set up

1085
00:43:10,880 --> 00:43:12,000
for the attackers

1086
00:43:12,000 --> 00:43:14,480
that they might trip on the nice thing

1087
00:43:14,480 --> 00:43:15,920
about honeypots is we can

1088
00:43:15,920 --> 00:43:17,440
you know place them all through our

1089
00:43:17,440 --> 00:43:20,079
environment with honeypots the things to

1090
00:43:20,079 --> 00:43:20,720
think about

1091
00:43:20,720 --> 00:43:22,960
is where do you want to place them what

1092
00:43:22,960 --> 00:43:24,000
kind of services do you want to have

1093
00:43:24,000 --> 00:43:25,760
them run

1094
00:43:25,760 --> 00:43:28,400
teampots is an open source project by

1095
00:43:28,400 --> 00:43:29,440
t-mobile

1096
00:43:29,440 --> 00:43:32,560
of t-systems and they uh

1097
00:43:32,560 --> 00:43:34,319
it's about they have all kinds of

1098
00:43:34,319 --> 00:43:36,400
services and options running and

1099
00:43:36,400 --> 00:43:38,240
you should definitely stick it out

1100
00:43:38,240 --> 00:43:39,680
another option is

1101
00:43:39,680 --> 00:43:41,839
think of canaries um they have a

1102
00:43:41,839 --> 00:43:42,720
combination of

1103
00:43:42,720 --> 00:43:45,599
uh they have you can actually do

1104
00:43:45,599 --> 00:43:46,000
different

1105
00:43:46,000 --> 00:43:49,280
files and tokens and web uh

1106
00:43:49,280 --> 00:43:50,800
honeypots and deploy them throughout the

1107
00:43:50,800 --> 00:43:53,280
environment and they will alert you over

1108
00:43:53,280 --> 00:43:55,839
the cloud

1109
00:43:59,359 --> 00:44:02,400
so now we have

1110
00:44:02,400 --> 00:44:05,359
the full picture of our environment we

1111
00:44:05,359 --> 00:44:07,359
have deployed the whole thing we have

1112
00:44:07,359 --> 00:44:08,000
our

1113
00:44:08,000 --> 00:44:09,440
attacking our defending our

1114
00:44:09,440 --> 00:44:13,040
infrastructure let's talk about

1115
00:44:13,040 --> 00:44:17,119
what uh some of the scenarios

1116
00:44:17,119 --> 00:44:18,960
so we start off let's say from our

1117
00:44:18,960 --> 00:44:20,640
calgary limits machine

1118
00:44:20,640 --> 00:44:22,800
and we go through our kelly through pf

1119
00:44:22,800 --> 00:44:23,839
sense

1120
00:44:23,839 --> 00:44:26,960
and we compromise a

1121
00:44:26,960 --> 00:44:30,000
vm server web server ftp server

1122
00:44:30,000 --> 00:44:33,200
and our dmz subnets

1123
00:44:33,200 --> 00:44:36,720
now how can we move this to the internal

1124
00:44:36,720 --> 00:44:39,200
network

1125
00:44:40,960 --> 00:44:43,280
and when we move can the blue team

1126
00:44:43,280 --> 00:44:45,680
detect this movement

1127
00:44:45,680 --> 00:44:47,920
if the t if the blue team did detect

1128
00:44:47,920 --> 00:44:49,520
this movement

1129
00:44:49,520 --> 00:44:53,359
then could they set up a layering on it

1130
00:44:53,359 --> 00:44:56,560
or why was this movement while the

1131
00:44:56,560 --> 00:44:58,160
attack was able to move in the first

1132
00:44:58,160 --> 00:44:59,440
place

1133
00:44:59,440 --> 00:45:03,200
now on the flip side if you are

1134
00:45:03,200 --> 00:45:06,800
the attacker how can you bypass this

1135
00:45:06,800 --> 00:45:09,200
detection how can you do your attacking

1136
00:45:09,200 --> 00:45:12,880
your attack in a different way so

1137
00:45:12,880 --> 00:45:19,839
you don't alert the blue team

1138
00:45:20,880 --> 00:45:23,200
that what it comes down to is pretty

1139
00:45:23,200 --> 00:45:24,800
much building

1140
00:45:24,800 --> 00:45:26,960
the truly the purple team at the end

1141
00:45:26,960 --> 00:45:28,319
where you're

1142
00:45:28,319 --> 00:45:30,800
you're defining your visibility gaps

1143
00:45:30,800 --> 00:45:32,240
you're seeing what you're not detecting

1144
00:45:32,240 --> 00:45:32,960
on

1145
00:45:32,960 --> 00:45:34,560
and you're trying to enhance your

1146
00:45:34,560 --> 00:45:36,000
logging or

1147
00:45:36,000 --> 00:45:37,839
your your methods of getting the

1148
00:45:37,839 --> 00:45:39,119
evidence that you need

1149
00:45:39,119 --> 00:45:41,359
at the same time your their team trying

1150
00:45:41,359 --> 00:45:42,400
to get better and

1151
00:45:42,400 --> 00:45:44,400
figure out how to move around from a

1152
00:45:44,400 --> 00:45:46,079
network to another

1153
00:45:46,079 --> 00:45:50,000
using their tools and

1154
00:45:50,000 --> 00:45:53,040
with that that would conclude my

1155
00:45:53,040 --> 00:45:55,440
presentation and i welcome your

1156
00:45:55,440 --> 00:45:57,839
questions

1157
00:45:59,040 --> 00:46:00,880
hey bashar thank you very much for your

1158
00:46:00,880 --> 00:46:03,040
presentation you do have

1159
00:46:03,040 --> 00:46:04,880
uh let me see a cup one question here

1160
00:46:04,880 --> 00:46:06,480
says

1161
00:46:06,480 --> 00:46:09,920
how can how can you isolate the internet

1162
00:46:09,920 --> 00:46:13,200
in the lab so that other people you have

1163
00:46:13,200 --> 00:46:14,400
training in the range

1164
00:46:14,400 --> 00:46:16,480
don't accidentally scan the real

1165
00:46:16,480 --> 00:46:18,880
internet

1166
00:46:19,599 --> 00:46:22,560
if you are setting up this range for

1167
00:46:22,560 --> 00:46:24,720
training

1168
00:46:24,720 --> 00:46:26,240
so if you set up the race for training

1169
00:46:26,240 --> 00:46:28,079
you don't want your um

1170
00:46:28,079 --> 00:46:29,520
so let's go back here you don't want

1171
00:46:29,520 --> 00:46:31,760
your

1172
00:46:31,760 --> 00:46:34,880
players to access the internet

1173
00:46:35,359 --> 00:46:37,440
well if your players are coming from the

1174
00:46:37,440 --> 00:46:40,000
internet you can't isolate them right

1175
00:46:40,000 --> 00:46:41,839
um if your players are you know

1176
00:46:41,839 --> 00:46:44,079
connected locally

1177
00:46:44,079 --> 00:46:45,680
uh depending on the range you're trying

1178
00:46:45,680 --> 00:46:47,599
to build uh

1179
00:46:47,599 --> 00:46:48,800
if they're local and they're connected

1180
00:46:48,800 --> 00:46:50,720
directly into your range

1181
00:46:50,720 --> 00:46:52,560
they shouldn't need the internet unless

1182
00:46:52,560 --> 00:46:54,079
they're gonna use google

1183
00:46:54,079 --> 00:46:56,560
is that what this question is i think so

1184
00:46:56,560 --> 00:46:58,400
it says how can you isolate the

1185
00:46:58,400 --> 00:47:00,240
internet so that other people you have

1186
00:47:00,240 --> 00:47:01,599
training in the range

1187
00:47:01,599 --> 00:47:05,040
don't accidentally scan the real

1188
00:47:05,040 --> 00:47:06,240
internet i think that's what they're

1189
00:47:06,240 --> 00:47:08,400
saying if you have setting up

1190
00:47:08,400 --> 00:47:11,680
in this range for training so in this

1191
00:47:11,680 --> 00:47:12,160
range

1192
00:47:12,160 --> 00:47:14,880
right i have my internet zone here so

1193
00:47:14,880 --> 00:47:15,920
technically

1194
00:47:15,920 --> 00:47:17,839
anything behind the pf sense and let me

1195
00:47:17,839 --> 00:47:19,119
use a laser

1196
00:47:19,119 --> 00:47:22,640
pointer so the when this kelly machine

1197
00:47:22,640 --> 00:47:24,559
comes in here it comes it's getting uh

1198
00:47:24,559 --> 00:47:26,640
198 160 192

1199
00:47:26,640 --> 00:47:30,640
168 that 100 that whatever ip address

1200
00:47:30,640 --> 00:47:33,760
so anything behind the pf sense the

1201
00:47:33,760 --> 00:47:35,760
the the attacker will not know what it

1202
00:47:35,760 --> 00:47:37,200
is so

1203
00:47:37,200 --> 00:47:40,880
i created this internet zone and

1204
00:47:40,880 --> 00:47:42,640
it's not the internet it's actually

1205
00:47:42,640 --> 00:47:44,319
inside my uh

1206
00:47:44,319 --> 00:47:47,200
home and inside this virtualization box

1207
00:47:47,200 --> 00:47:48,160
but

1208
00:47:48,160 --> 00:47:50,839
it's being treated as the internet

1209
00:47:50,839 --> 00:47:52,160
because

1210
00:47:52,160 --> 00:47:55,119
about the pfc is not it so the attacker

1211
00:47:55,119 --> 00:47:56,079
does not know

1212
00:47:56,079 --> 00:47:57,760
what the ipad is so they can't access

1213
00:47:57,760 --> 00:47:59,839
this box directly right there

1214
00:47:59,839 --> 00:48:01,760
they're the truly the internet and to

1215
00:48:01,760 --> 00:48:03,520
this pf synth and everything

1216
00:48:03,520 --> 00:48:07,839
underneath it if that makes sense

1217
00:48:08,319 --> 00:48:09,760
and then i have another question a

1218
00:48:09,760 --> 00:48:11,920
person is asking do you have a deep dive

1219
00:48:11,920 --> 00:48:14,800
step-by-step walkthrough on how you set

1220
00:48:14,800 --> 00:48:15,680
up your home

1221
00:48:15,680 --> 00:48:19,760
lab environment and that is in the works

1222
00:48:19,760 --> 00:48:22,160
that's in work okay

1223
00:48:22,160 --> 00:48:24,640
yep i will i will one day i'm not gonna

1224
00:48:24,640 --> 00:48:26,480
promise but one day i'll release a blog

1225
00:48:26,480 --> 00:48:28,319
post on how to do it step by step it's a

1226
00:48:28,319 --> 00:48:29,839
tedious process

1227
00:48:29,839 --> 00:48:32,720
um and a lot of stuff i did on the fly

1228
00:48:32,720 --> 00:48:34,559
and i did not document

1229
00:48:34,559 --> 00:48:36,319
so i might have to go back and you know

1230
00:48:36,319 --> 00:48:38,000
document the screenshots and do all that

1231
00:48:38,000 --> 00:48:39,200
stuff

1232
00:48:39,200 --> 00:48:41,839
uh pretty much but yes one day i will

1233
00:48:41,839 --> 00:48:44,799
release it hopefully

1234
00:48:45,359 --> 00:48:48,720
and let me see where can i find

1235
00:48:48,720 --> 00:48:50,079
let me see if there's anything else

1236
00:48:50,079 --> 00:48:52,160
interesting um we have

1237
00:48:52,160 --> 00:48:53,280
people saying this was a great

1238
00:48:53,280 --> 00:48:56,240
presentation do you have a blog

1239
00:48:56,240 --> 00:48:58,640
i am working on it as we speak again

1240
00:48:58,640 --> 00:48:59,440
okay

1241
00:48:59,440 --> 00:49:01,680
yeah i will release it and uh follow me

1242
00:49:01,680 --> 00:49:02,559
on uh

1243
00:49:02,559 --> 00:49:06,000
elitebash on twitter uh and that's where

1244
00:49:06,000 --> 00:49:07,520
i'll release my blog post and everything

1245
00:49:07,520 --> 00:49:08,480
else but i am

1246
00:49:08,480 --> 00:49:10,960
working on it yes okay and will the

1247
00:49:10,960 --> 00:49:12,480
slides be available

1248
00:49:12,480 --> 00:49:15,599
at some yes yes i'll raise the slides

1249
00:49:15,599 --> 00:49:18,880
definitely and let me see is there

1250
00:49:18,880 --> 00:49:21,200
anything else

1251
00:49:21,200 --> 00:49:24,480
that looks like it

1252
00:49:24,800 --> 00:49:26,400
all right great prashar thank you so

1253
00:49:26,400 --> 00:49:28,160
much that was very informative

1254
00:49:28,160 --> 00:49:30,319
and someone said where for the slide

1255
00:49:30,319 --> 00:49:32,640
you're going to post that

1256
00:49:32,640 --> 00:49:35,119
i will put them on my github and put

1257
00:49:35,119 --> 00:49:36,720
them on twitter and then i'll post them

1258
00:49:36,720 --> 00:49:38,559
in discord and guys i'll be on discord

1259
00:49:38,559 --> 00:49:40,559
afterwards

1260
00:49:40,559 --> 00:49:44,079
yes i'll be on discord uh as well so you

1261
00:49:44,079 --> 00:49:59,839
can ask away

1262
00:50:23,119 --> 00:50:25,200
you

