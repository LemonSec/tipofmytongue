1
00:00:00,719 --> 00:00:03,199
hello everybody my name is michael gough

2
00:00:03,199 --> 00:00:05,520
and i am a principal at ncc group an

3
00:00:05,520 --> 00:00:06,960
incident response

4
00:00:06,960 --> 00:00:09,040
north american cert practice i'm also

5
00:00:09,040 --> 00:00:11,040
the founder of malwarearcheology.com

6
00:00:11,040 --> 00:00:12,480
this is where i would ask anybody heard

7
00:00:12,480 --> 00:00:13,840
about the cheat sheets

8
00:00:13,840 --> 00:00:16,000
and also the co-founder of imf security

9
00:00:16,000 --> 00:00:19,119
the home of log md

10
00:00:19,439 --> 00:00:21,760
um again raise your hands can't see

11
00:00:21,760 --> 00:00:23,199
anybody i guess you can do it through

12
00:00:23,199 --> 00:00:24,240
the

13
00:00:24,240 --> 00:00:26,160
discord channel how many people have

14
00:00:26,160 --> 00:00:27,680
actually used or seen some of the cheat

15
00:00:27,680 --> 00:00:28,720
sheets

16
00:00:28,720 --> 00:00:30,960
these all started from dealing with the

17
00:00:30,960 --> 00:00:32,800
chinese hackers went in ti group when i

18
00:00:32,800 --> 00:00:33,920
was in gaming

19
00:00:33,920 --> 00:00:35,600
and they've expanded since then i think

20
00:00:35,600 --> 00:00:37,360
there's seven of them now we also have

21
00:00:37,360 --> 00:00:38,640
miter attack

22
00:00:38,640 --> 00:00:40,960
and whatnot and for those looking for a

23
00:00:40,960 --> 00:00:42,480
incident response podcast

24
00:00:42,480 --> 00:00:45,760
we have relaunched the uh

25
00:00:45,760 --> 00:00:47,200
the breaking down incident response

26
00:00:47,200 --> 00:00:49,840
podcast to the incident response podcast

27
00:00:49,840 --> 00:00:51,600
found on your favorite uh

28
00:00:51,600 --> 00:00:54,879
distribution channel of choice that is

29
00:00:54,879 --> 00:00:55,600
due to

30
00:00:55,600 --> 00:00:57,520
uh breaking down security going to

31
00:00:57,520 --> 00:00:59,680
nonprofit and obviously brian and i with

32
00:00:59,680 --> 00:01:00,559
uh

33
00:01:00,559 --> 00:01:03,920
log md and imf is a different scenario

34
00:01:03,920 --> 00:01:06,560
so we had to split and change the name

35
00:01:06,560 --> 00:01:06,960
so

36
00:01:06,960 --> 00:01:08,479
we're still out there same content same

37
00:01:08,479 --> 00:01:10,400
bat time same bat channel same back

38
00:01:10,400 --> 00:01:12,240
content provider

39
00:01:12,240 --> 00:01:14,159
so some background i worked for a video

40
00:01:14,159 --> 00:01:16,159
company that got pwned pretty badly by

41
00:01:16,159 --> 00:01:18,080
the way nti group consistently if you

42
00:01:18,080 --> 00:01:18,560
were in

43
00:01:18,560 --> 00:01:21,600
a video game platform mmos things like

44
00:01:21,600 --> 00:01:22,560
that

45
00:01:22,560 --> 00:01:24,159
you would definitely know who this group

46
00:01:24,159 --> 00:01:26,560
was apt 10 17

47
00:01:26,560 --> 00:01:28,479
41 depending on what they're doing and

48
00:01:28,479 --> 00:01:29,840
who they're attacking

49
00:01:29,840 --> 00:01:31,200
and they got by all of our security

50
00:01:31,200 --> 00:01:33,119
tools we set up try to figure out why

51
00:01:33,119 --> 00:01:34,640
and how they were doing that or what the

52
00:01:34,640 --> 00:01:36,479
flaws were the security tools we found

53
00:01:36,479 --> 00:01:38,560
several and we reported those to the

54
00:01:38,560 --> 00:01:40,159
ctos of the companies that say what the

55
00:01:40,159 --> 00:01:40,960
heck

56
00:01:40,960 --> 00:01:43,200
so they know what we know and they use

57
00:01:43,200 --> 00:01:44,399
what we use

58
00:01:44,399 --> 00:01:46,720
right so they get by just like the red

59
00:01:46,720 --> 00:01:48,079
teams often do

60
00:01:48,079 --> 00:01:50,399
so do we learn and how did we catch them

61
00:01:50,399 --> 00:01:51,840
well that's what we're going to cover in

62
00:01:51,840 --> 00:01:52,840
this

63
00:01:52,840 --> 00:01:55,840
talk i was asked by

64
00:01:55,840 --> 00:01:57,920
an ir consulting firm before i worked

65
00:01:57,920 --> 00:01:59,759
for an iron consulting firm

66
00:01:59,759 --> 00:02:01,439
because i worked with a large healthcare

67
00:02:01,439 --> 00:02:03,360
that acquired people

68
00:02:03,360 --> 00:02:06,000
again are any of them mature and i said

69
00:02:06,000 --> 00:02:06,719
sadly

70
00:02:06,719 --> 00:02:08,318
no i replied even though there's hipaa

71
00:02:08,318 --> 00:02:10,720
requirements and compliance requirements

72
00:02:10,720 --> 00:02:12,879
mature i would say no definitely not on

73
00:02:12,879 --> 00:02:14,640
the cmm model or any other model would i

74
00:02:14,640 --> 00:02:16,560
call them anything other than

75
00:02:16,560 --> 00:02:19,760
than the first one or two stages at best

76
00:02:19,760 --> 00:02:22,480
they buy stuff if they had budget they

77
00:02:22,480 --> 00:02:24,160
think prevention blocks everything right

78
00:02:24,160 --> 00:02:25,920
the infamous easy button

79
00:02:25,920 --> 00:02:28,319
but they still lack security 101 the

80
00:02:28,319 --> 00:02:29,520
basics that they

81
00:02:29,520 --> 00:02:32,560
already have so let's talk about

82
00:02:32,560 --> 00:02:34,080
prevention versus reduction

83
00:02:34,080 --> 00:02:36,879
i throw this out here because um this is

84
00:02:36,879 --> 00:02:39,040
this is a big reason why

85
00:02:39,040 --> 00:02:41,040
you should seriously consider what's in

86
00:02:41,040 --> 00:02:42,640
this presentation and go back to work

87
00:02:42,640 --> 00:02:44,480
and try to get this implemented

88
00:02:44,480 --> 00:02:48,000
i do not believe or like the concept of

89
00:02:48,000 --> 00:02:49,040
prevention

90
00:02:49,040 --> 00:02:51,360
as a directive or a mentality in your

91
00:02:51,360 --> 00:02:52,879
organization say we're going to do this

92
00:02:52,879 --> 00:02:54,000
to prevent that

93
00:02:54,000 --> 00:02:56,560
not really if prevention worked why are

94
00:02:56,560 --> 00:02:58,000
we all here learning why are we all

95
00:02:58,000 --> 00:02:59,920
still buying these products and security

96
00:02:59,920 --> 00:03:01,120
solutions

97
00:03:01,120 --> 00:03:03,120
so the reality is reduction is a more

98
00:03:03,120 --> 00:03:04,879
realistic term right when you buy a web

99
00:03:04,879 --> 00:03:06,080
proxy does it really block

100
00:03:06,080 --> 00:03:09,519
everything no it reduces stuff no slides

101
00:03:09,519 --> 00:03:11,680
are showing

102
00:03:11,680 --> 00:03:14,879
you guys are not seeing the slides

103
00:03:14,879 --> 00:03:18,400
i need verbal verbal audio

104
00:03:18,400 --> 00:03:21,040
i'm seeing the slides here all right so

105
00:03:21,040 --> 00:03:23,360
cactus i guess it's on you

106
00:03:23,360 --> 00:03:26,080
um so the idea here is reduction is more

107
00:03:26,080 --> 00:03:27,920
realistic because we reduce the

108
00:03:27,920 --> 00:03:29,519
likelihood of an incident right a red

109
00:03:29,519 --> 00:03:30,640
epoxy doesn't block

110
00:03:30,640 --> 00:03:32,159
every batting going in and out of your

111
00:03:32,159 --> 00:03:34,159
environment it reduces the bad things

112
00:03:34,159 --> 00:03:35,280
going in and out of

113
00:03:35,280 --> 00:03:37,440
the environment we reduce the attack

114
00:03:37,440 --> 00:03:39,120
surface that can be taken advantage of

115
00:03:39,120 --> 00:03:40,400
or exploited by

116
00:03:40,400 --> 00:03:42,319
putting in you know email filters and

117
00:03:42,319 --> 00:03:44,720
blocks and and wafts and all the things

118
00:03:44,720 --> 00:03:46,560
right vpns and two-factor

119
00:03:46,560 --> 00:03:48,720
and all that stuff we can reduce the

120
00:03:48,720 --> 00:03:49,840
amount of time

121
00:03:49,840 --> 00:03:52,159
it takes to investigate an incident that

122
00:03:52,159 --> 00:03:53,439
is a big one

123
00:03:53,439 --> 00:03:55,360
as an incident responder now in

124
00:03:55,360 --> 00:03:57,280
consulting is also prior

125
00:03:57,280 --> 00:03:59,680
it's important to understand that the

126
00:03:59,680 --> 00:04:00,400
faster

127
00:04:00,400 --> 00:04:02,799
you can help us do our job the cheaper

128
00:04:02,799 --> 00:04:04,080
it will be for you

129
00:04:04,080 --> 00:04:05,120
and that's why we're here we're going to

130
00:04:05,120 --> 00:04:07,760
talk about reduction

131
00:04:07,760 --> 00:04:10,959
reduction starts with preparation

132
00:04:10,959 --> 00:04:12,720
and yes just like the pick-a-roll model

133
00:04:12,720 --> 00:04:13,840
right so what's the first thing in the

134
00:04:13,840 --> 00:04:15,200
sans pickerel model

135
00:04:15,200 --> 00:04:17,918
preparation security 101 so i'm calling

136
00:04:17,918 --> 00:04:19,918
this security one one the basics we

137
00:04:19,918 --> 00:04:21,759
did recently have a podcast on the

138
00:04:21,759 --> 00:04:23,199
incident response podcast i would

139
00:04:23,199 --> 00:04:24,560
definitely encourage you to go listen to

140
00:04:24,560 --> 00:04:25,040
that

141
00:04:25,040 --> 00:04:27,280
as homework to this presentation to

142
00:04:27,280 --> 00:04:28,080
further your

143
00:04:28,080 --> 00:04:29,440
research in this area and definitely

144
00:04:29,440 --> 00:04:31,199
visit the cheat sheets and

145
00:04:31,199 --> 00:04:33,280
and other uh podcasts we'll have on on

146
00:04:33,280 --> 00:04:34,960
some of these other non-windows

147
00:04:34,960 --> 00:04:37,520
scenarios but the basics i think are

148
00:04:37,520 --> 00:04:38,720
sadly ignored

149
00:04:38,720 --> 00:04:40,639
or i.t and management don't really

150
00:04:40,639 --> 00:04:42,639
understand it well enough and maybe that

151
00:04:42,639 --> 00:04:45,440
includes us in infosec

152
00:04:45,440 --> 00:04:48,400
so for example pci hipaa have

153
00:04:48,400 --> 00:04:51,520
requirements there's compliance nist 853

154
00:04:51,520 --> 00:04:53,440
tell you to go turn things on and do

155
00:04:53,440 --> 00:04:54,639
certain things

156
00:04:54,639 --> 00:04:56,639
but are you really actually validating

157
00:04:56,639 --> 00:04:58,479
that these things are what they expect

158
00:04:58,479 --> 00:05:00,000
or what they are

159
00:05:00,000 --> 00:05:02,000
probably not which means you have some

160
00:05:02,000 --> 00:05:04,240
huge gaps and i can tell you

161
00:05:04,240 --> 00:05:06,639
100 of every engagement or acquisition

162
00:05:06,639 --> 00:05:08,400
or company i've been involved with

163
00:05:08,400 --> 00:05:10,479
will definitely fail to meet even the

164
00:05:10,479 --> 00:05:12,080
cis benchmark level

165
00:05:12,080 --> 00:05:15,280
fully implemented and especially never

166
00:05:15,280 --> 00:05:17,039
have i met somebody uh short of some

167
00:05:17,039 --> 00:05:18,720
people i know off to the side

168
00:05:18,720 --> 00:05:20,880
that will pass the windows logging cheat

169
00:05:20,880 --> 00:05:22,840
sheets in the case of a windows

170
00:05:22,840 --> 00:05:25,120
environment if you do some basic things

171
00:05:25,120 --> 00:05:26,400
that by the way

172
00:05:26,400 --> 00:05:28,880
are free and you already have them an

173
00:05:28,880 --> 00:05:30,880
incident is much much easier

174
00:05:30,880 --> 00:05:33,120
and faster to deal with by the way it

175
00:05:33,120 --> 00:05:35,199
makes it cheaper too

176
00:05:35,199 --> 00:05:37,520
that is something where hey if i do this

177
00:05:37,520 --> 00:05:39,360
can i save that

178
00:05:39,360 --> 00:05:40,720
i can tell you my experience with the

179
00:05:40,720 --> 00:05:42,639
winning ti group i first joined three

180
00:05:42,639 --> 00:05:45,039
minutes later we we got nailed by them

181
00:05:45,039 --> 00:05:46,800
it was a couple hundred thousand plus

182
00:05:46,800 --> 00:05:48,560
dollar bill

183
00:05:48,560 --> 00:05:50,080
you know i had to process that paperwork

184
00:05:50,080 --> 00:05:52,240
so i knew what it cost and then bam it's

185
00:05:52,240 --> 00:05:53,600
like oh that's painful that's like you

186
00:05:53,600 --> 00:05:56,000
know two peoples plus salaries here

187
00:05:56,000 --> 00:05:58,880
and and this is back in like 2012. and

188
00:05:58,880 --> 00:05:59,199
so

189
00:05:59,199 --> 00:06:01,120
they hit us again really hard in 2014

190
00:06:01,120 --> 00:06:02,960
they came in within a week we had them

191
00:06:02,960 --> 00:06:04,160
contained and

192
00:06:04,160 --> 00:06:06,479
uh second week had them booted out or at

193
00:06:06,479 --> 00:06:08,000
least black holed until we

194
00:06:08,000 --> 00:06:09,280
went through the maintenance cycles of

195
00:06:09,280 --> 00:06:11,440
cleaning them out and uh

196
00:06:11,440 --> 00:06:13,199
same consulting firm came on site and we

197
00:06:13,199 --> 00:06:14,880
kicked them out they arrived monday

198
00:06:14,880 --> 00:06:16,880
and we kicked them out on friday and

199
00:06:16,880 --> 00:06:19,360
that bill is only 37 thousand dollars so

200
00:06:19,360 --> 00:06:20,960
right there there's a justification

201
00:06:20,960 --> 00:06:22,880
salary and that's what i'm talking about

202
00:06:22,880 --> 00:06:24,319
there's significant

203
00:06:24,319 --> 00:06:27,600
savings uh involved here if you do

204
00:06:27,600 --> 00:06:30,319
preparation well and it is why we caught

205
00:06:30,319 --> 00:06:31,360
when nti

206
00:06:31,360 --> 00:06:33,120
in the course of rolling out a new game

207
00:06:33,120 --> 00:06:35,600
windows 2012 and windows 8.1 rolled out

208
00:06:35,600 --> 00:06:37,039
we implemented a lot of the logging

209
00:06:37,039 --> 00:06:38,960
changes we had splunk we sucked that

210
00:06:38,960 --> 00:06:40,160
stuff into splunk

211
00:06:40,160 --> 00:06:42,319
and it was those alerts that we created

212
00:06:42,319 --> 00:06:44,639
from the data within

213
00:06:44,639 --> 00:06:46,240
the triggers of them getting into the

214
00:06:46,240 --> 00:06:48,000
windows systems in this case was very

215
00:06:48,000 --> 00:06:49,840
windows heavy there was some linux but

216
00:06:49,840 --> 00:06:51,120
generally we would get rid of them

217
00:06:51,120 --> 00:06:53,199
before they ever got to those but

218
00:06:53,199 --> 00:06:55,360
is that configuration changes that

219
00:06:55,360 --> 00:06:57,840
caught them

220
00:06:57,840 --> 00:07:00,400
so help us help you show of hands no

221
00:07:00,400 --> 00:07:01,360
wait

222
00:07:01,360 --> 00:07:04,080
um come on do it anyways raise your hand

223
00:07:04,080 --> 00:07:05,440
your cat or dog or

224
00:07:05,440 --> 00:07:08,000
others we'll see you um or send me

225
00:07:08,000 --> 00:07:09,759
another thumbs up like i saw somebody do

226
00:07:09,759 --> 00:07:10,400
in the uh

227
00:07:10,400 --> 00:07:14,080
discord channel um again do it anyway so

228
00:07:14,080 --> 00:07:16,080
show hands how many of you have actually

229
00:07:16,080 --> 00:07:17,759
configured

230
00:07:17,759 --> 00:07:20,160
policies to at least the cis benchmarks

231
00:07:20,160 --> 00:07:21,680
or better yet the windows logging cheat

232
00:07:21,680 --> 00:07:24,000
sheet like i just uh

233
00:07:24,000 --> 00:07:26,319
discussed here right or how about docker

234
00:07:26,319 --> 00:07:27,599
logging have you looked at it and

235
00:07:27,599 --> 00:07:28,800
validated that you actually have it

236
00:07:28,800 --> 00:07:29,680
turned on

237
00:07:29,680 --> 00:07:31,120
how about my sequel logging if you

238
00:07:31,120 --> 00:07:32,639
looked at it and validated you turned it

239
00:07:32,639 --> 00:07:34,319
on web server logging database server

240
00:07:34,319 --> 00:07:36,240
logging cloud logging

241
00:07:36,240 --> 00:07:38,639
we investigated an aws instance where

242
00:07:38,639 --> 00:07:40,080
they wanted to know

243
00:07:40,080 --> 00:07:41,840
where the people were coming from and lo

244
00:07:41,840 --> 00:07:44,240
and behold flow logs were not turned on

245
00:07:44,240 --> 00:07:46,639
right oh 365 logging depending on your

246
00:07:46,639 --> 00:07:48,319
level which which level you are within

247
00:07:48,319 --> 00:07:48,639
it

248
00:07:48,639 --> 00:07:50,560
what capabilities do you have that stuff

249
00:07:50,560 --> 00:07:52,080
are you looking at it do you know how to

250
00:07:52,080 --> 00:07:53,199
parse it out

251
00:07:53,199 --> 00:07:56,000
copy it off export it get it into a sim

252
00:07:56,000 --> 00:07:58,240
etc the list goes on there's lots of

253
00:07:58,240 --> 00:07:59,280
things here

254
00:07:59,280 --> 00:08:00,560
outside of the windows environment as

255
00:08:00,560 --> 00:08:03,840
well security 101 prepare

256
00:08:03,840 --> 00:08:05,680
enable your logs to collect all the

257
00:08:05,680 --> 00:08:07,360
things yes

258
00:08:07,360 --> 00:08:09,440
local logs need to collect all the

259
00:08:09,440 --> 00:08:11,520
things and yes they will roll

260
00:08:11,520 --> 00:08:12,879
but that's part of the understanding you

261
00:08:12,879 --> 00:08:14,879
need to understand when they roll

262
00:08:14,879 --> 00:08:16,479
and you need to map that and understand

263
00:08:16,479 --> 00:08:18,160
that in a typical windows environment

264
00:08:18,160 --> 00:08:19,919
where i tell you to turn on the logs to

265
00:08:19,919 --> 00:08:21,840
one gigabyte or two gigabytes

266
00:08:21,840 --> 00:08:23,440
that you're going to get a week or more

267
00:08:23,440 --> 00:08:25,440
of data and depending on the server

268
00:08:25,440 --> 00:08:27,280
function or the workstation function

269
00:08:27,280 --> 00:08:28,879
stuff will roll off i understand that

270
00:08:28,879 --> 00:08:30,319
but you need to understand

271
00:08:30,319 --> 00:08:32,240
the start date and date within each log

272
00:08:32,240 --> 00:08:33,519
of each type

273
00:08:33,519 --> 00:08:35,679
in order to know that if you're going to

274
00:08:35,679 --> 00:08:36,799
investigate something

275
00:08:36,799 --> 00:08:38,799
that's the time frame that's your dwell

276
00:08:38,799 --> 00:08:40,159
time that you have to react

277
00:08:40,159 --> 00:08:41,919
unless you're sucking it up to something

278
00:08:41,919 --> 00:08:43,200
like a sim

279
00:08:43,200 --> 00:08:44,800
right so increasing the log size will

280
00:08:44,800 --> 00:08:46,320
get you more than just minutes it'll get

281
00:08:46,320 --> 00:08:49,200
you hours days or weeks in some cases

282
00:08:49,200 --> 00:08:50,800
some of the logs that don't make as much

283
00:08:50,800 --> 00:08:52,640
noise and windows will get you

284
00:08:52,640 --> 00:08:55,040
months max same thing you're gonna have

285
00:08:55,040 --> 00:08:55,839
to deal with that

286
00:08:55,839 --> 00:08:57,920
linux same thing and to deal with that

287
00:08:57,920 --> 00:08:59,760
and obviously platform logs sometimes

288
00:08:59,760 --> 00:09:01,360
are restricted by the hardware vendors

289
00:09:01,360 --> 00:09:02,880
so you need to understand what you what

290
00:09:02,880 --> 00:09:04,640
you have and how long they acquire there

291
00:09:04,640 --> 00:09:05,040
and

292
00:09:05,040 --> 00:09:08,480
syslog them off or or container them off

293
00:09:08,480 --> 00:09:09,760
or do whatever you have to to get them

294
00:09:09,760 --> 00:09:11,600
off the box and store them for

295
00:09:11,600 --> 00:09:13,839
future use and of course nix and apple

296
00:09:13,839 --> 00:09:14,880
have logs too

297
00:09:14,880 --> 00:09:18,000
docker my sequel amazon azure o365 they

298
00:09:18,000 --> 00:09:19,680
all do

299
00:09:19,680 --> 00:09:21,680
do you have a log management solution

300
00:09:21,680 --> 00:09:24,240
edr or other security prevention

301
00:09:24,240 --> 00:09:26,880
you know air quotes here that allow you

302
00:09:26,880 --> 00:09:27,839
to

303
00:09:27,839 --> 00:09:30,000
look at logs it's important to

304
00:09:30,000 --> 00:09:31,519
understand that because some of these

305
00:09:31,519 --> 00:09:32,800
solutions

306
00:09:32,800 --> 00:09:36,240
will let you pull log files from remote

307
00:09:36,240 --> 00:09:36,959
systems

308
00:09:36,959 --> 00:09:39,519
locally right fireeye for example can do

309
00:09:39,519 --> 00:09:41,200
that you can say firearm give me

310
00:09:41,200 --> 00:09:43,440
the endpoint logs as a file go get me

311
00:09:43,440 --> 00:09:45,200
you know security.log or

312
00:09:45,200 --> 00:09:47,680
security evtx and pull them locally so i

313
00:09:47,680 --> 00:09:48,800
can process them

314
00:09:48,800 --> 00:09:50,399
if you understand that and your process

315
00:09:50,399 --> 00:09:52,399
can take into the fact i've got three

316
00:09:52,399 --> 00:09:54,240
days or six days or eight days

317
00:09:54,240 --> 00:09:56,720
i discovered it on day two oh crap i've

318
00:09:56,720 --> 00:09:58,560
got 24 hours to one week

319
00:09:58,560 --> 00:10:01,279
to then copy that data off right and if

320
00:10:01,279 --> 00:10:01,760
you get

321
00:10:01,760 --> 00:10:03,360
to this mentality you're helping

322
00:10:03,360 --> 00:10:05,360
yourself but more importantly

323
00:10:05,360 --> 00:10:06,720
if you do have to bring in a firm like

324
00:10:06,720 --> 00:10:08,880
us or anybody else it will definitely

325
00:10:08,880 --> 00:10:10,800
help them which will save you tons of

326
00:10:10,800 --> 00:10:11,760
money

327
00:10:11,760 --> 00:10:14,240
and obviously log management will be the

328
00:10:14,240 --> 00:10:16,079
best collector of all the right things

329
00:10:16,079 --> 00:10:18,320
so you collect all the things locally

330
00:10:18,320 --> 00:10:19,839
and then you collect the right things

331
00:10:19,839 --> 00:10:21,200
into your sim

332
00:10:21,200 --> 00:10:22,880
that's another talk you'd have to go

333
00:10:22,880 --> 00:10:24,640
listen to my splunk conf from a few

334
00:10:24,640 --> 00:10:26,800
years back of the sexy six

335
00:10:26,800 --> 00:10:28,880
but there are definitely a short list of

336
00:10:28,880 --> 00:10:30,880
things that are very high value

337
00:10:30,880 --> 00:10:32,800
in all platforms that you can collect

338
00:10:32,800 --> 00:10:34,160
that significantly help your

339
00:10:34,160 --> 00:10:35,519
investigations

340
00:10:35,519 --> 00:10:37,040
uh miter attack would be a great

341
00:10:37,040 --> 00:10:39,360
reference point that will get there

342
00:10:39,360 --> 00:10:40,880
logs can make it easier and faster to

343
00:10:40,880 --> 00:10:42,399
deal with an incident of course

344
00:10:42,399 --> 00:10:44,880
and for an ir firm like us to find it

345
00:10:44,880 --> 00:10:45,519
faster

346
00:10:45,519 --> 00:10:47,360
thus saves you money in the long run

347
00:10:47,360 --> 00:10:49,120
thus justifies budget

348
00:10:49,120 --> 00:10:50,800
thus justifies salary that's what

349
00:10:50,800 --> 00:10:52,480
justifies people etc

350
00:10:52,480 --> 00:10:53,360
so you'll have to work with your

351
00:10:53,360 --> 00:10:56,160
management to uh go through all those

352
00:10:56,160 --> 00:10:58,320
soft dollars and how that's accounted

353
00:10:58,320 --> 00:10:59,440
for

354
00:10:59,440 --> 00:11:01,600
do you or can you monitor for for

355
00:11:01,600 --> 00:11:05,120
example new account creation

356
00:11:07,120 --> 00:11:08,880
nuka i'm reading a somebody's having an

357
00:11:08,880 --> 00:11:10,160
issue over here so i'm just making sure

358
00:11:10,160 --> 00:11:12,000
i don't have to stop and wait for them

359
00:11:12,000 --> 00:11:13,600
a new container instance or bucket

360
00:11:13,600 --> 00:11:15,279
creation can you detect that

361
00:11:15,279 --> 00:11:17,600
a lot of cases developers have access to

362
00:11:17,600 --> 00:11:19,040
stuff they'll spin up a container it's

363
00:11:19,040 --> 00:11:20,880
improperly secured and wham

364
00:11:20,880 --> 00:11:22,880
s3 bucket or containers wide open the

365
00:11:22,880 --> 00:11:24,399
internet and it gets owned in minutes or

366
00:11:24,399 --> 00:11:25,440
hours

367
00:11:25,440 --> 00:11:26,959
admin accounts logging into multiple

368
00:11:26,959 --> 00:11:28,959
systems this is a very uncommon thing

369
00:11:28,959 --> 00:11:31,200
bad guy gets in gets the root account

370
00:11:31,200 --> 00:11:32,720
gets the admin accounts

371
00:11:32,720 --> 00:11:34,240
and then all of a sudden across the

372
00:11:34,240 --> 00:11:36,320
environment it goes right

373
00:11:36,320 --> 00:11:37,839
new service creation something by

374
00:11:37,839 --> 00:11:39,440
default windows is good for right

375
00:11:39,440 --> 00:11:41,760
task cron scenarios for scheduled jobs

376
00:11:41,760 --> 00:11:43,279
heavily used because it gives you system

377
00:11:43,279 --> 00:11:43,680
level

378
00:11:43,680 --> 00:11:46,480
access to the os's email vpn citrix

379
00:11:46,480 --> 00:11:49,200
cloud logins can you tell the source ip

380
00:11:49,200 --> 00:11:51,120
of where their attacker is coming from

381
00:11:51,120 --> 00:11:53,040
this would definitely hold true with the

382
00:11:53,040 --> 00:11:54,079
recent citrix

383
00:11:54,079 --> 00:11:56,639
scenario and for those f5 fans we know

384
00:11:56,639 --> 00:11:59,600
currently those are being

385
00:11:59,839 --> 00:12:02,399
attacked right now as we speak and

386
00:12:02,399 --> 00:12:03,279
they're being mapped

387
00:12:03,279 --> 00:12:05,279
and so those of you that have f5

388
00:12:05,279 --> 00:12:07,040
appliances look out

389
00:12:07,040 --> 00:12:08,880
network flow data do you have the

390
00:12:08,880 --> 00:12:10,480
ability of seeing that flow data in your

391
00:12:10,480 --> 00:12:11,360
environment

392
00:12:11,360 --> 00:12:14,000
um i often talk about pcr producer

393
00:12:14,000 --> 00:12:15,839
consumer ratio this is a plus one to

394
00:12:15,839 --> 00:12:17,440
minus one rating

395
00:12:17,440 --> 00:12:20,000
minus one is downloads of content plus

396
00:12:20,000 --> 00:12:20,480
one is

397
00:12:20,480 --> 00:12:23,040
x fill of content so often in an

398
00:12:23,040 --> 00:12:24,560
acquisition you'll you'll go

399
00:12:24,560 --> 00:12:26,079
put an appliance in you'll look for this

400
00:12:26,079 --> 00:12:28,160
pcr scenario because you'll find

401
00:12:28,160 --> 00:12:30,320
dropboxes onedrives you know google

402
00:12:30,320 --> 00:12:31,600
google drive etc

403
00:12:31,600 --> 00:12:33,760
because you tend to push data to there

404
00:12:33,760 --> 00:12:35,760
um and then of course you look for xfill

405
00:12:35,760 --> 00:12:38,800
as well to foreign ips and whatnot now

406
00:12:38,800 --> 00:12:40,959
suspicious processes and see users in

407
00:12:40,959 --> 00:12:42,560
the windows case this is where

408
00:12:42,560 --> 00:12:44,959
a lot of people get compromised when

409
00:12:44,959 --> 00:12:46,720
they get malware or click on a

410
00:12:46,720 --> 00:12:48,720
click on a link or a url or anything in

411
00:12:48,720 --> 00:12:50,560
an email so this is a

412
00:12:50,560 --> 00:12:54,160
a high value target to monitor for

413
00:12:54,160 --> 00:12:55,519
and no you're not going to be able to do

414
00:12:55,519 --> 00:12:58,079
this unless you have better logging

415
00:12:58,079 --> 00:13:00,480
all of what i just mentioned are in logs

416
00:13:00,480 --> 00:13:02,079
a lot of what i just mentioned are not

417
00:13:02,079 --> 00:13:04,880
on by default

418
00:13:05,120 --> 00:13:07,680
you cannot monitor for anything real

419
00:13:07,680 --> 00:13:08,399
useful

420
00:13:08,399 --> 00:13:10,800
real useful if you don't enable the

421
00:13:10,800 --> 00:13:12,880
logging to collect the right things

422
00:13:12,880 --> 00:13:14,639
then you can collect the right stuff

423
00:13:14,639 --> 00:13:16,079
like the guys up in the right corner

424
00:13:16,079 --> 00:13:16,959
there

425
00:13:16,959 --> 00:13:19,680
and monitor for all kinds of things if

426
00:13:19,680 --> 00:13:21,680
you have a log management solution or

427
00:13:21,680 --> 00:13:23,760
something like a log md etc but if you

428
00:13:23,760 --> 00:13:24,880
don't turn the stuff on

429
00:13:24,880 --> 00:13:28,079
even with log md and arthur arthur's

430
00:13:28,079 --> 00:13:30,480
github project for free using windows

431
00:13:30,480 --> 00:13:32,079
powershell remoting

432
00:13:32,079 --> 00:13:34,399
i can't go hunt for artifacts or an

433
00:13:34,399 --> 00:13:36,000
incident even in a windows environment

434
00:13:36,000 --> 00:13:38,079
right i need that stuff turned on

435
00:13:38,079 --> 00:13:40,000
so uh i can immediately would log into

436
00:13:40,000 --> 00:13:41,920
minus a go to a system and say wow you

437
00:13:41,920 --> 00:13:43,279
don't have all this data

438
00:13:43,279 --> 00:13:45,600
and now i know that in the logs i only

439
00:13:45,600 --> 00:13:46,959
can see this data

440
00:13:46,959 --> 00:13:48,639
so therefore i have to think in a

441
00:13:48,639 --> 00:13:50,480
different mindset to go look for signs

442
00:13:50,480 --> 00:13:51,360
of attacks

443
00:13:51,360 --> 00:13:54,000
look in the wmi databases look in the

444
00:13:54,000 --> 00:13:55,680
registry things like that

445
00:13:55,680 --> 00:13:59,279
painful slower more expensive

446
00:13:59,279 --> 00:14:01,519
have you considered a free paid cl cloud

447
00:14:01,519 --> 00:14:02,880
logging solution some of you if you've

448
00:14:02,880 --> 00:14:04,000
listened to me before i've talked about

449
00:14:04,000 --> 00:14:05,760
homeo i personally use it

450
00:14:05,760 --> 00:14:07,519
uh not necessarily an endorsement of any

451
00:14:07,519 --> 00:14:09,279
kind they do have a cloud and on-prem

452
00:14:09,279 --> 00:14:10,160
solution

453
00:14:10,160 --> 00:14:12,240
uh they do offer you a free solution so

454
00:14:12,240 --> 00:14:13,920
if you want to play with logging

455
00:14:13,920 --> 00:14:15,199
and learn how this stuff works in your

456
00:14:15,199 --> 00:14:17,040
own personal environment lab whatnot i

457
00:14:17,040 --> 00:14:18,959
highly recommend you check them out

458
00:14:18,959 --> 00:14:20,720
uh two gigabytes a day for seven days

459
00:14:20,720 --> 00:14:22,399
retention you can pretty much cover five

460
00:14:22,399 --> 00:14:23,839
systems in your house

461
00:14:23,839 --> 00:14:26,240
but i can also convert that to a paid

462
00:14:26,240 --> 00:14:27,440
solution

463
00:14:27,440 --> 00:14:30,160
so imagine if you will that you deploy a

464
00:14:30,160 --> 00:14:30,959
win log b

465
00:14:30,959 --> 00:14:33,120
or file log beat you know elastic client

466
00:14:33,120 --> 00:14:34,480
on all your endpoints

467
00:14:34,480 --> 00:14:36,720
you've got the keys populated you've got

468
00:14:36,720 --> 00:14:38,480
everything turned on or enabled or

469
00:14:38,480 --> 00:14:40,320
configured within the client itself

470
00:14:40,320 --> 00:14:41,839
the beats clients and you have them

471
00:14:41,839 --> 00:14:43,279
pointed to your cloud solution but you

472
00:14:43,279 --> 00:14:45,360
haven't started the service

473
00:14:45,360 --> 00:14:47,760
so the way to look at that is if i just

474
00:14:47,760 --> 00:14:50,000
gpo flip start service then those

475
00:14:50,000 --> 00:14:51,839
systems i'm investigating can be sent to

476
00:14:51,839 --> 00:14:53,360
the cloud after i've turned it up and

477
00:14:53,360 --> 00:14:54,320
paid for

478
00:14:54,320 --> 00:14:57,440
30 60 90 days right so i've even thought

479
00:14:57,440 --> 00:14:58,560
about that because there's so many of

480
00:14:58,560 --> 00:15:00,560
these cloud service providers out there

481
00:15:00,560 --> 00:15:01,920
you could potentially make a deal and

482
00:15:01,920 --> 00:15:04,639
say i'm gonna pay you this much a month

483
00:15:04,639 --> 00:15:06,720
um in the event that i have to you know

484
00:15:06,720 --> 00:15:08,720
break glass and do something big

485
00:15:08,720 --> 00:15:10,079
then it will jump to this much this is

486
00:15:10,079 --> 00:15:11,920
how many agents i have etcetera

487
00:15:11,920 --> 00:15:13,440
and you can work this out with these

488
00:15:13,440 --> 00:15:15,120
cloud providers i'm sure they they love

489
00:15:15,120 --> 00:15:15,600
money

490
00:15:15,600 --> 00:15:17,360
right they're all the money but this is

491
00:15:17,360 --> 00:15:19,279
some serious prep this is almost to the

492
00:15:19,279 --> 00:15:20,240
point where

493
00:15:20,240 --> 00:15:22,079
like an ir firm we come in with a carbon

494
00:15:22,079 --> 00:15:24,480
black or a crowd strike or a mandiant

495
00:15:24,480 --> 00:15:26,000
fire eye what whatnot

496
00:15:26,000 --> 00:15:27,600
and deployed in your environment you can

497
00:15:27,600 --> 00:15:29,199
kind of already be prepared by having

498
00:15:29,199 --> 00:15:29,759
these

499
00:15:29,759 --> 00:15:32,000
again splunk agent universal forwarder

500
00:15:32,000 --> 00:15:33,920
it doesn't matter what you're using elk

501
00:15:33,920 --> 00:15:36,880
file beats when log beats etc um and or

502
00:15:36,880 --> 00:15:38,160
have it deployed and then push the

503
00:15:38,160 --> 00:15:39,920
config update to config and then turn it

504
00:15:39,920 --> 00:15:41,759
on and send this stuff to some server

505
00:15:41,759 --> 00:15:42,639
somewhere

506
00:15:42,639 --> 00:15:44,240
right pay as you need it but prepare to

507
00:15:44,240 --> 00:15:45,759
use it set it up now page

508
00:15:45,759 --> 00:15:48,000
huge dividends later because again

509
00:15:48,000 --> 00:15:49,839
remember stuff rolls and if i can turn

510
00:15:49,839 --> 00:15:51,279
it on before it rolls

511
00:15:51,279 --> 00:15:54,160
i get a lot of valuable data so devops

512
00:15:54,160 --> 00:15:55,199
story

513
00:15:55,199 --> 00:15:57,440
and you thought i was just a windows guy

514
00:15:57,440 --> 00:15:59,360
i investigated a ransom incident no not

515
00:15:59,360 --> 00:16:00,720
ransomware ransom

516
00:16:00,720 --> 00:16:01,920
this is where they were saying hey you

517
00:16:01,920 --> 00:16:03,600
want your data back uh we took it blew

518
00:16:03,600 --> 00:16:04,240
it away

519
00:16:04,240 --> 00:16:06,160
not really the attack really wasn't that

520
00:16:06,160 --> 00:16:08,079
at all but nonetheless um

521
00:16:08,079 --> 00:16:11,279
it's ransom and so we looked into it i

522
00:16:11,279 --> 00:16:13,440
was running on a mac running docker and

523
00:16:13,440 --> 00:16:15,040
there was a mysql within the docker

524
00:16:15,040 --> 00:16:17,360
right typical database developer setup

525
00:16:17,360 --> 00:16:19,759
nothing really fancy or special there

526
00:16:19,759 --> 00:16:20,959
this very well could have been a windows

527
00:16:20,959 --> 00:16:22,160
environment too right really doesn't

528
00:16:22,160 --> 00:16:23,920
matter whether it's mac or windows

529
00:16:23,920 --> 00:16:26,240
in this case thank god it was a mac and

530
00:16:26,240 --> 00:16:27,759
we'll talk about that so mac os

531
00:16:27,759 --> 00:16:30,800
yay apple enables logs by default there

532
00:16:30,800 --> 00:16:31,759
is a lot

533
00:16:31,759 --> 00:16:33,839
turned on automatically by apple unlike

534
00:16:33,839 --> 00:16:36,480
windows containers by default no logging

535
00:16:36,480 --> 00:16:39,279
database by default no logging so i was

536
00:16:39,279 --> 00:16:40,880
a very sad panda

537
00:16:40,880 --> 00:16:43,839
very sad very sad

538
00:16:45,759 --> 00:16:47,680
so what can we see how do we know what

539
00:16:47,680 --> 00:16:49,360
happened right of course the user said

540
00:16:49,360 --> 00:16:49,680
hey

541
00:16:49,680 --> 00:16:51,440
i want to know how this thing got ransom

542
00:16:51,440 --> 00:16:52,959
how did they get in what did they do

543
00:16:52,959 --> 00:16:55,440
what was open etc well the epilogue

544
00:16:55,440 --> 00:16:56,800
showed the container running that's what

545
00:16:56,800 --> 00:16:57,839
you can see when you're running

546
00:16:57,839 --> 00:16:59,120
something like docker or any kind of

547
00:16:59,120 --> 00:17:00,959
containerization software

548
00:17:00,959 --> 00:17:02,800
as you'll see that it's running but in

549
00:17:02,800 --> 00:17:04,319
windows it'll be different than

550
00:17:04,319 --> 00:17:05,679
than apple this is why i picked on the

551
00:17:05,679 --> 00:17:08,480
apple scenario because once you set this

552
00:17:08,480 --> 00:17:10,079
you know the bridge or pass-through mode

553
00:17:10,079 --> 00:17:11,280
depending on the container and the

554
00:17:11,280 --> 00:17:12,640
networking interfaces

555
00:17:12,640 --> 00:17:14,640
uh you can see traffic or you can't in

556
00:17:14,640 --> 00:17:16,799
this case since it was bridged

557
00:17:16,799 --> 00:17:18,799
docker controlled the network flow and

558
00:17:18,799 --> 00:17:21,119
the network ips all apple sees as that

559
00:17:21,119 --> 00:17:21,919
docker

560
00:17:21,919 --> 00:17:23,839
is on and running right so i couldn't

561
00:17:23,839 --> 00:17:25,760
see any details which means now that

562
00:17:25,760 --> 00:17:27,599
requires me to have details and docker

563
00:17:27,599 --> 00:17:30,799
enabled unfortunately port xxs was

564
00:17:30,799 --> 00:17:32,080
opened any any

565
00:17:32,080 --> 00:17:34,320
which meant a database port was open in

566
00:17:34,320 --> 00:17:35,360
this case

567
00:17:35,360 --> 00:17:38,320
and i was a sad panda right i couldn't

568
00:17:38,320 --> 00:17:38,799
see

569
00:17:38,799 --> 00:17:41,200
the traffic in the mac os side i needed

570
00:17:41,200 --> 00:17:43,200
the container to show me the information

571
00:17:43,200 --> 00:17:45,120
thus again a failure of

572
00:17:45,120 --> 00:17:47,679
default conditions as well as default

573
00:17:47,679 --> 00:17:49,280
logging

574
00:17:49,280 --> 00:17:51,200
so my investigation i used heidi sql to

575
00:17:51,200 --> 00:17:52,640
connect to the database had to prove i

576
00:17:52,640 --> 00:17:54,400
could see and connect to the database i

577
00:17:54,400 --> 00:17:56,000
tried the default creds guess what they

578
00:17:56,000 --> 00:17:56,960
worked

579
00:17:56,960 --> 00:18:00,400
so uh yep i still i'm a saying panda

580
00:18:00,400 --> 00:18:02,160
uh but it was on a mac the clamshell lid

581
00:18:02,160 --> 00:18:03,679
was closed so how did this thing get

582
00:18:03,679 --> 00:18:04,400
compromised

583
00:18:04,400 --> 00:18:06,160
so if you think closing the clamshell

584
00:18:06,160 --> 00:18:08,559
lid uh it will turn off or power off a

585
00:18:08,559 --> 00:18:09,120
laptop

586
00:18:09,120 --> 00:18:11,520
uh think again and then apple just

587
00:18:11,520 --> 00:18:12,960
warned in case you haven't seen this

588
00:18:12,960 --> 00:18:15,039
that if you use a

589
00:18:15,039 --> 00:18:17,520
a webcam one of those sliding webcam

590
00:18:17,520 --> 00:18:19,039
covers that you're at risk it uh

591
00:18:19,039 --> 00:18:20,480
shattering your screen or cracking your

592
00:18:20,480 --> 00:18:21,679
screen so

593
00:18:21,679 --> 00:18:23,039
be careful of that you may not want to

594
00:18:23,039 --> 00:18:24,880
do that or read up on that article so

595
00:18:24,880 --> 00:18:26,640
clamshell lead being closed can cause a

596
00:18:26,640 --> 00:18:28,000
couple problems crack your screen

597
00:18:28,000 --> 00:18:30,480
if you're using a cover for your webcam

598
00:18:30,480 --> 00:18:33,039
so use a sticky note or piece of tape

599
00:18:33,039 --> 00:18:35,520
or in this case because apple does a lot

600
00:18:35,520 --> 00:18:36,880
of stuff and updating and patching on

601
00:18:36,880 --> 00:18:39,039
the back end it does power up or stay

602
00:18:39,039 --> 00:18:40,480
powered up or do

603
00:18:40,480 --> 00:18:43,200
on demand powering up and thus enable

604
00:18:43,200 --> 00:18:45,039
the environment in this case docker

605
00:18:45,039 --> 00:18:46,880
which was running in this case my sequel

606
00:18:46,880 --> 00:18:48,320
which was running which allowed this

607
00:18:48,320 --> 00:18:49,760
thing to be communicating what was

608
00:18:49,760 --> 00:18:50,960
plugged into a

609
00:18:50,960 --> 00:18:53,440
insecure internet connection sadly but

610
00:18:53,440 --> 00:18:55,280
apple logs to the rescue the clamshell

611
00:18:55,280 --> 00:18:55,679
did

612
00:18:55,679 --> 00:18:58,720
allow us to see that the the

613
00:18:58,720 --> 00:19:01,679
um clam shell was closed that it had

614
00:19:01,679 --> 00:19:02,880
been closed going into

615
00:19:02,880 --> 00:19:04,400
theoretically sleep mode or hibernate

616
00:19:04,400 --> 00:19:06,799
mode uh but it also showed that it woke

617
00:19:06,799 --> 00:19:07,280
up

618
00:19:07,280 --> 00:19:09,120
and it showed that it was doing patching

619
00:19:09,120 --> 00:19:10,960
and so it gave us the indication that

620
00:19:10,960 --> 00:19:12,799
the system definitely was up and running

621
00:19:12,799 --> 00:19:14,000
during these hours because there were

622
00:19:14,000 --> 00:19:15,760
clearly log entries during the period of

623
00:19:15,760 --> 00:19:16,080
time

624
00:19:16,080 --> 00:19:19,039
this event occurred so again closed lid

625
00:19:19,039 --> 00:19:21,280
does not mean network is off so that was

626
00:19:21,280 --> 00:19:23,200
awesome

627
00:19:23,200 --> 00:19:26,160
so port 3306 was open to any any in

628
00:19:26,160 --> 00:19:26,640
docker

629
00:19:26,640 --> 00:19:29,600
default credits oh bother closing the

630
00:19:29,600 --> 00:19:31,280
lid of the laptop does not power down

631
00:19:31,280 --> 00:19:32,640
the docker my sequel containers or

632
00:19:32,640 --> 00:19:33,360
anything else

633
00:19:33,360 --> 00:19:35,360
clearly default conditions caused this

634
00:19:35,360 --> 00:19:38,080
lack of good logging made it hard

635
00:19:38,080 --> 00:19:39,840
so it should have probably taken me a

636
00:19:39,840 --> 00:19:41,520
day took me a week

637
00:19:41,520 --> 00:19:43,360
because we had to go through and look

638
00:19:43,360 --> 00:19:45,440
for all these conditions try to find

639
00:19:45,440 --> 00:19:46,720
anything and everything we could within

640
00:19:46,720 --> 00:19:48,799
docker anything we could and could not

641
00:19:48,799 --> 00:19:49,200
in

642
00:19:49,200 --> 00:19:51,360
my sequel whereas the logging was turned

643
00:19:51,360 --> 00:19:53,120
on we could have come to a conclusion

644
00:19:53,120 --> 00:19:56,080
and seen data much much quicker

645
00:19:56,080 --> 00:19:58,720
but it's more than just logs so let's

646
00:19:58,720 --> 00:20:00,240
talk about more preparation

647
00:20:00,240 --> 00:20:01,919
do you have a process or procedure to

648
00:20:01,919 --> 00:20:03,840
configure containers used by developers

649
00:20:03,840 --> 00:20:05,679
so one of the things we found and said

650
00:20:05,679 --> 00:20:07,919
look do you how do you deploy these

651
00:20:07,919 --> 00:20:10,400
and we asked the the client in this case

652
00:20:10,400 --> 00:20:11,840
to say you know

653
00:20:11,840 --> 00:20:13,360
how do you deploy these docker

654
00:20:13,360 --> 00:20:14,960
containers and do you have this stuff

655
00:20:14,960 --> 00:20:16,240
turned on is it in the

656
00:20:16,240 --> 00:20:17,840
do you have a procedure that people go

657
00:20:17,840 --> 00:20:19,280
and check this and the answer was no

658
00:20:19,280 --> 00:20:20,799
they found that there were several other

659
00:20:20,799 --> 00:20:22,159
containers that they were deploying to

660
00:20:22,159 --> 00:20:22,720
people

661
00:20:22,720 --> 00:20:25,760
that were in a similar state so again a

662
00:20:25,760 --> 00:20:27,200
process and a procedure that

663
00:20:27,200 --> 00:20:29,919
checks these kinds of build scenarios

664
00:20:29,919 --> 00:20:30,799
would definitely help

665
00:20:30,799 --> 00:20:32,799
right verify logs are enabled come up

666
00:20:32,799 --> 00:20:34,720
with a script or a process to go check

667
00:20:34,720 --> 00:20:35,280
them

668
00:20:35,280 --> 00:20:37,679
whether it's manual automated or whatnot

669
00:20:37,679 --> 00:20:39,280
or using your tools

670
00:20:39,280 --> 00:20:41,440
verify default creds are not used please

671
00:20:41,440 --> 00:20:42,799
please please please please i mean i

672
00:20:42,799 --> 00:20:44,720
just loaded heidi sql put in the default

673
00:20:44,720 --> 00:20:45,600
creds and bam

674
00:20:45,600 --> 00:20:49,440
i got in that only took me you know five

675
00:20:49,440 --> 00:20:50,640
minutes to install the client five

676
00:20:50,640 --> 00:20:52,080
minutes of test

677
00:20:52,080 --> 00:20:54,240
verify verify ports are not open right

678
00:20:54,240 --> 00:20:56,080
simple port scanner will tell you that

679
00:20:56,080 --> 00:20:57,760
and so as you build these containers and

680
00:20:57,760 --> 00:20:59,760
and store them up to be

681
00:20:59,760 --> 00:21:01,600
distributed all this can be tested

682
00:21:01,600 --> 00:21:03,280
before you distribute them

683
00:21:03,280 --> 00:21:04,960
build a process and have procedures to

684
00:21:04,960 --> 00:21:07,840
do this doing this a help with reduction

685
00:21:07,840 --> 00:21:09,520
of incidents right if you did this you

686
00:21:09,520 --> 00:21:10,720
turn this stuff on and you turn this

687
00:21:10,720 --> 00:21:11,600
stuff off

688
00:21:11,600 --> 00:21:13,679
then of course i would have had a much

689
00:21:13,679 --> 00:21:15,760
better time with this particular case

690
00:21:15,760 --> 00:21:17,520
and again doing so will dramatically

691
00:21:17,520 --> 00:21:19,840
help ir people like me or an ir firm

692
00:21:19,840 --> 00:21:21,600
also like me did i say i work for

693
00:21:21,600 --> 00:21:23,440
instance group

694
00:21:23,440 --> 00:21:28,000
i hear people laughing virtually windows

695
00:21:28,000 --> 00:21:30,400
how about local account passwords right

696
00:21:30,400 --> 00:21:31,679
just like we saw

697
00:21:31,679 --> 00:21:34,960
the default accounts in my sql um or

698
00:21:34,960 --> 00:21:37,520
in windows case they are definitely

699
00:21:37,520 --> 00:21:39,760
capitalized right i log in ssh i get the

700
00:21:39,760 --> 00:21:41,520
root password bam and i find that the

701
00:21:41,520 --> 00:21:43,120
organization's root password is the same

702
00:21:43,120 --> 00:21:44,640
everywhere the local admin password is

703
00:21:44,640 --> 00:21:45,600
the same everywhere

704
00:21:45,600 --> 00:21:47,679
or the local any of the local admin

705
00:21:47,679 --> 00:21:49,600
accounts on the local machines

706
00:21:49,600 --> 00:21:51,840
passwords are the same everywhere well

707
00:21:51,840 --> 00:21:53,520
microsoft gives you a free solution to

708
00:21:53,520 --> 00:21:55,039
manage this called lapse

709
00:21:55,039 --> 00:21:56,799
local administrator password solution it

710
00:21:56,799 --> 00:21:58,080
is and does create

711
00:21:58,080 --> 00:22:00,960
a unique password for each local admin

712
00:22:00,960 --> 00:22:01,840
stored

713
00:22:01,840 --> 00:22:03,760
on the local system but it stores it in

714
00:22:03,760 --> 00:22:05,440
active directory which can be queried

715
00:22:05,440 --> 00:22:06,559
with powershell or

716
00:22:06,559 --> 00:22:08,480
looked up within active directory so

717
00:22:08,480 --> 00:22:10,400
that help test guys can still get the

718
00:22:10,400 --> 00:22:12,480
data and log in and all that stuff

719
00:22:12,480 --> 00:22:13,919
but what the cool thing is it makes it

720
00:22:13,919 --> 00:22:15,600
very hard for lateral movement so the

721
00:22:15,600 --> 00:22:18,080
the smb flaws and the attacks on smb

722
00:22:18,080 --> 00:22:21,200
or just net uses wmis things like that

723
00:22:21,200 --> 00:22:22,400
where they're trying to

724
00:22:22,400 --> 00:22:24,559
loop around the environment and utilize

725
00:22:24,559 --> 00:22:25,600
the same creds

726
00:22:25,600 --> 00:22:27,120
back to that original thing where i said

727
00:22:27,120 --> 00:22:29,520
can you detect multiple admin logins

728
00:22:29,520 --> 00:22:31,280
across multiple machines

729
00:22:31,280 --> 00:22:33,039
this would generate a lot of noise

730
00:22:33,039 --> 00:22:34,480
failed logins thus

731
00:22:34,480 --> 00:22:36,000
potentially alerting you if you were

732
00:22:36,000 --> 00:22:38,159
collecting stuff into some sort of

733
00:22:38,159 --> 00:22:40,159
program or causing them to do a

734
00:22:40,159 --> 00:22:41,360
different attack vector

735
00:22:41,360 --> 00:22:43,520
a different you know attack technique

736
00:22:43,520 --> 00:22:45,120
and then theoretically

737
00:22:45,120 --> 00:22:47,039
uh triggering one your security defenses

738
00:22:47,039 --> 00:22:49,039
or one of your logging alerts

739
00:22:49,039 --> 00:22:51,039
okay possibly learning you if you are

740
00:22:51,039 --> 00:22:52,240
collecting them then

741
00:22:52,240 --> 00:22:57,440
alerting on them office macros

742
00:22:57,919 --> 00:22:59,840
oh for the love of all office documents

743
00:22:59,840 --> 00:23:01,600
on their malware block macros that

744
00:23:01,600 --> 00:23:03,280
enable content it is now

745
00:23:03,280 --> 00:23:05,760
available in everything from about 2013

746
00:23:05,760 --> 00:23:06,640
on up in

747
00:23:06,640 --> 00:23:09,600
in office again by default all users

748
00:23:09,600 --> 00:23:10,240
should be

749
00:23:10,240 --> 00:23:12,400
not allowed to do this and you create an

750
00:23:12,400 --> 00:23:13,760
exception list

751
00:23:13,760 --> 00:23:16,000
using a group membership for those who

752
00:23:16,000 --> 00:23:17,360
really really need it and those people

753
00:23:17,360 --> 00:23:19,200
should be trained they should be highly

754
00:23:19,200 --> 00:23:20,400
monitored

755
00:23:20,400 --> 00:23:22,400
and you know seriously sign the dotted

756
00:23:22,400 --> 00:23:23,520
line that you're risking

757
00:23:23,520 --> 00:23:26,080
being terminated if you uh are so dumb

758
00:23:26,080 --> 00:23:26,720
and

759
00:23:26,720 --> 00:23:30,000
are super clicky and again um you know

760
00:23:30,000 --> 00:23:31,600
malware comes in a lot this way via

761
00:23:31,600 --> 00:23:32,080
email

762
00:23:32,080 --> 00:23:33,760
it's definitely the number one vector uh

763
00:23:33,760 --> 00:23:35,280
short of having stuff you know

764
00:23:35,280 --> 00:23:38,159
on the internet like my devops example

765
00:23:38,159 --> 00:23:39,840
you know so much malware comes in this

766
00:23:39,840 --> 00:23:40,159
way

767
00:23:40,159 --> 00:23:42,880
whether it's a url an actual file type

768
00:23:42,880 --> 00:23:44,240
that uh users

769
00:23:44,240 --> 00:23:46,559
double clicky uh happy because windows

770
00:23:46,559 --> 00:23:48,240
has taught us just click the ok and move

771
00:23:48,240 --> 00:23:50,240
on and you can continue your work is

772
00:23:50,240 --> 00:23:51,919
unfortunately makes it a very easy

773
00:23:51,919 --> 00:23:54,240
vector for people to take advantage of

774
00:23:54,240 --> 00:23:55,440
and i know you're not going to block

775
00:23:55,440 --> 00:23:56,640
office documents coming in from the

776
00:23:56,640 --> 00:23:58,080
internet so you're going to have to look

777
00:23:58,080 --> 00:23:59,520
at this a different way and blocking

778
00:23:59,520 --> 00:24:00,640
these policies would

779
00:24:00,640 --> 00:24:04,480
definitely again reduce not prevent

780
00:24:04,480 --> 00:24:07,840
produce a big vector here again free you

781
00:24:07,840 --> 00:24:09,440
got accurate directory just turn it on

782
00:24:09,440 --> 00:24:11,919
that's it turn around create a group add

783
00:24:11,919 --> 00:24:13,760
some exception people in there

784
00:24:13,760 --> 00:24:15,120
there's a lot of finance people that use

785
00:24:15,120 --> 00:24:16,720
macros and whatnot and they're in their

786
00:24:16,720 --> 00:24:18,240
finance spreadsheets great put them in

787
00:24:18,240 --> 00:24:19,520
there give them lots of training

788
00:24:19,520 --> 00:24:22,080
and focus them uh filter the hell out of

789
00:24:22,080 --> 00:24:22,880
their email

790
00:24:22,880 --> 00:24:24,799
and or you know all kinds of other cool

791
00:24:24,799 --> 00:24:26,960
things you can do with them

792
00:24:26,960 --> 00:24:29,200
group policy security there are all

793
00:24:29,200 --> 00:24:30,960
kinds of things you can do here this is

794
00:24:30,960 --> 00:24:32,159
definitely a higher effort

795
00:24:32,159 --> 00:24:35,200
area but i would definitely point you to

796
00:24:35,200 --> 00:24:36,559
derbycon 2019

797
00:24:36,559 --> 00:24:38,960
sean metcalf from 80 securities talk

798
00:24:38,960 --> 00:24:39,679
this was an

799
00:24:39,679 --> 00:24:41,200
awesome talk about some really cool

800
00:24:41,200 --> 00:24:43,039
things you could do iron geek's got the

801
00:24:43,039 --> 00:24:44,480
video posted

802
00:24:44,480 --> 00:24:47,520
he is coming up with a uh white paper on

803
00:24:47,520 --> 00:24:48,559
this subject where

804
00:24:48,559 --> 00:24:50,159
to help you configure this stuff or just

805
00:24:50,159 --> 00:24:52,480
tires consultancy to lock you down

806
00:24:52,480 --> 00:24:53,760
um but it was pretty cool he was

807
00:24:53,760 --> 00:24:55,520
actually able to demonstrate how

808
00:24:55,520 --> 00:24:58,159
recon from a red team was broken by

809
00:24:58,159 --> 00:24:59,919
changes he made with an active directory

810
00:24:59,919 --> 00:25:01,600
that is a very cool thing

811
00:25:01,600 --> 00:25:03,039
because now you're taking away some of

812
00:25:03,039 --> 00:25:05,200
the automatic read access of things that

813
00:25:05,200 --> 00:25:06,400
bad guys use

814
00:25:06,400 --> 00:25:08,240
and guess what when you make those

815
00:25:08,240 --> 00:25:09,600
requests they

816
00:25:09,600 --> 00:25:11,919
will be logged if you configure and turn

817
00:25:11,919 --> 00:25:13,520
on the right things and theoretically

818
00:25:13,520 --> 00:25:14,000
you can see

819
00:25:14,000 --> 00:25:16,000
people making these requests so it would

820
00:25:16,000 --> 00:25:17,440
be really cool thing but check out

821
00:25:17,440 --> 00:25:19,200
sean's talk here he is definitely the

822
00:25:19,200 --> 00:25:20,000
geek

823
00:25:20,000 --> 00:25:23,760
of all the things a.d nms administrator

824
00:25:23,760 --> 00:25:26,320
josh is a good guy too other tech

825
00:25:26,320 --> 00:25:28,400
multi-factor authentication

826
00:25:28,400 --> 00:25:31,200
uh mfa anybody anybody anybody got mfa

827
00:25:31,200 --> 00:25:31,520
here

828
00:25:31,520 --> 00:25:33,279
i'm sure every one of us has a google

829
00:25:33,279 --> 00:25:35,279
authenticator that has pages long

830
00:25:35,279 --> 00:25:38,000
right if you have email citrix vpn rdp

831
00:25:38,000 --> 00:25:39,760
cloud etc face the internet you are

832
00:25:39,760 --> 00:25:40,640
vulnerable with

833
00:25:40,640 --> 00:25:43,360
kovid and us working from home i think a

834
00:25:43,360 --> 00:25:45,039
lot of us have probably discovered

835
00:25:45,039 --> 00:25:46,320
solutions that normally we

836
00:25:46,320 --> 00:25:48,080
accessed within the office are now being

837
00:25:48,080 --> 00:25:49,600
accessed outside the office

838
00:25:49,600 --> 00:25:52,640
do not have mfa and are definitely being

839
00:25:52,640 --> 00:25:54,559
exploited and or attacked more so than

840
00:25:54,559 --> 00:25:56,000
they were before or

841
00:25:56,000 --> 00:25:59,120
opened now that they weren't before but

842
00:25:59,120 --> 00:26:00,799
mfa will definitely attacks from

843
00:26:00,799 --> 00:26:02,880
cred stealing campaigns assume

844
00:26:02,880 --> 00:26:04,320
someone's going to click on an email

845
00:26:04,320 --> 00:26:06,240
assume a credit standing web page is

846
00:26:06,240 --> 00:26:07,039
going to come up

847
00:26:07,039 --> 00:26:09,360
assume they will enter their credentials

848
00:26:09,360 --> 00:26:11,200
and send them off to the bad

849
00:26:11,200 --> 00:26:14,400
bad nefarious uh near dwellers in some

850
00:26:14,400 --> 00:26:15,200
foreign country

851
00:26:15,200 --> 00:26:17,600
or a us server hosting farm here in the

852
00:26:17,600 --> 00:26:19,120
u.s so that you know it's not going to

853
00:26:19,120 --> 00:26:21,120
trigger any foreign ips within your

854
00:26:21,120 --> 00:26:24,159
your thread intel bad ip list

855
00:26:24,159 --> 00:26:26,559
but again if they do get those creds and

856
00:26:26,559 --> 00:26:28,240
then they try them against your citrix

857
00:26:28,240 --> 00:26:29,919
vpn cloud etc

858
00:26:29,919 --> 00:26:31,600
and you have two factor you are going to

859
00:26:31,600 --> 00:26:33,039
get lots of failures so

860
00:26:33,039 --> 00:26:35,440
a really good thing to do something that

861
00:26:35,440 --> 00:26:36,240
everybody should

862
00:26:36,240 --> 00:26:38,159
makes basically validate that they have

863
00:26:38,159 --> 00:26:40,559
turned on and most of these are free you

864
00:26:40,559 --> 00:26:41,679
might have to buy it for your

865
00:26:41,679 --> 00:26:43,039
application space

866
00:26:43,039 --> 00:26:45,600
uh maybe even your vpn but uh something

867
00:26:45,600 --> 00:26:47,440
that definitely helps

868
00:26:47,440 --> 00:26:49,440
and you know rdp attacks ransomware

869
00:26:49,440 --> 00:26:50,559
attacks

870
00:26:50,559 --> 00:26:51,760
you know a lot of these are just due to

871
00:26:51,760 --> 00:26:53,600
the fact that they've bought or stored

872
00:26:53,600 --> 00:26:56,000
downloaded these huge repos of of

873
00:26:56,000 --> 00:26:57,919
credential databases and they just try

874
00:26:57,919 --> 00:26:59,600
them out on everybody's orgs because

875
00:26:59,600 --> 00:27:01,360
who's blocking a bunch of attacks from

876
00:27:01,360 --> 00:27:02,720
server hosting company in

877
00:27:02,720 --> 00:27:04,960
ohio uh nobody and so they just keep

878
00:27:04,960 --> 00:27:06,159
trying the credits trying to create

879
00:27:06,159 --> 00:27:08,000
trying to create spam recycle them and

880
00:27:08,000 --> 00:27:09,279
use them

881
00:27:09,279 --> 00:27:10,640
microsoft recently announced we talked

882
00:27:10,640 --> 00:27:12,320
about this in a podcast because uh

883
00:27:12,320 --> 00:27:13,919
the first one is what we talked about

884
00:27:13,919 --> 00:27:15,360
first and then i saw recently that

885
00:27:15,360 --> 00:27:17,200
lastpass also published

886
00:27:17,200 --> 00:27:19,279
a report that was in the verizon data

887
00:27:19,279 --> 00:27:20,320
breach report

888
00:27:20,320 --> 00:27:23,600
where microsoft said 99 of companies

889
00:27:23,600 --> 00:27:25,440
compromised due to lack of mfa

890
00:27:25,440 --> 00:27:27,919
so they're finding that when people were

891
00:27:27,919 --> 00:27:29,200
logged in

892
00:27:29,200 --> 00:27:31,200
successfully from the internet it was

893
00:27:31,200 --> 00:27:32,320
because no mfa

894
00:27:32,320 --> 00:27:34,399
so mfa would have blocked 99 of these

895
00:27:34,399 --> 00:27:35,360
breaches

896
00:27:35,360 --> 00:27:37,919
and that's that's like you know a lot

897
00:27:37,919 --> 00:27:38,480
and i would

898
00:27:38,480 --> 00:27:41,120
i would say yeah it's easily over 90.

899
00:27:41,120 --> 00:27:42,559
too many companies have too many things

900
00:27:42,559 --> 00:27:43,760
without two factor

901
00:27:43,760 --> 00:27:47,120
uh lastpass verizon dbir report said 80

902
00:27:47,120 --> 00:27:49,120
so this is probably the again dbr

903
00:27:49,120 --> 00:27:50,640
customers who were looked at

904
00:27:50,640 --> 00:27:52,720
and what solutions they had and because

905
00:27:52,720 --> 00:27:54,320
they're going to have more security

906
00:27:54,320 --> 00:27:55,840
that their numbers i guess would be

907
00:27:55,840 --> 00:27:57,200
lower uh being they're a little more

908
00:27:57,200 --> 00:27:58,880
secure and being on the dbvr

909
00:27:58,880 --> 00:28:00,480
questionnaire

910
00:28:00,480 --> 00:28:02,559
but i think microsoft has a more broad

911
00:28:02,559 --> 00:28:04,320
sense of everybody in anybody's small

912
00:28:04,320 --> 00:28:06,640
smbs whereas verizon dpr is probably

913
00:28:06,640 --> 00:28:08,159
medium to large

914
00:28:08,159 --> 00:28:10,640
um but yeah these are these reports are

915
00:28:10,640 --> 00:28:11,440
pretty clearing

916
00:28:11,440 --> 00:28:14,080
right mfa will help and we're not going

917
00:28:14,080 --> 00:28:17,279
to talk about the potential uh

918
00:28:17,279 --> 00:28:19,200
exploits of mfa that is a different

919
00:28:19,200 --> 00:28:21,600
problem we are trying to reduce

920
00:28:21,600 --> 00:28:23,520
so prevention 100 percent just never

921
00:28:23,520 --> 00:28:25,039
going to happen in industry so thus

922
00:28:25,039 --> 00:28:26,640
reduction is what we're after and if we

923
00:28:26,640 --> 00:28:27,679
can get 20 30

924
00:28:27,679 --> 00:28:30,880
60 80 reduction we are winning

925
00:28:30,880 --> 00:28:33,120
seriously winning so how many are

926
00:28:33,120 --> 00:28:34,399
blocking the known

927
00:28:34,399 --> 00:28:36,720
bad file extensions do you have any clue

928
00:28:36,720 --> 00:28:38,320
if you're blocking any of them let alone

929
00:28:38,320 --> 00:28:39,600
the full list

930
00:28:39,600 --> 00:28:42,320
in september 2019 38 more file

931
00:28:42,320 --> 00:28:44,640
extensions were added by microsoft

932
00:28:44,640 --> 00:28:47,200
i have a link here if you look at this

933
00:28:47,200 --> 00:28:49,679
adds to the already extensive list that

934
00:28:49,679 --> 00:28:51,679
microsoft has published for years

935
00:28:51,679 --> 00:28:54,399
here's the link to that as well and then

936
00:28:54,399 --> 00:28:55,760
oddly and i actually have another one

937
00:28:55,760 --> 00:28:56,480
here

938
00:28:56,480 --> 00:28:58,559
that was added this year ransomware

939
00:28:58,559 --> 00:29:00,640
attacks were using the iqy

940
00:29:00,640 --> 00:29:01,919
files i actually had to look that up

941
00:29:01,919 --> 00:29:03,600
when i first heard about this in the

942
00:29:03,600 --> 00:29:04,799
last year

943
00:29:04,799 --> 00:29:07,120
an odd excel document type they are now

944
00:29:07,120 --> 00:29:08,399
going back to the

945
00:29:08,399 --> 00:29:11,679
famous silk format documents in 2020

946
00:29:11,679 --> 00:29:13,360
which were a way that you would save

947
00:29:13,360 --> 00:29:15,120
stuff on a mac and translate it into a

948
00:29:15,120 --> 00:29:17,120
windows environment the old soak format

949
00:29:17,120 --> 00:29:19,200
and so this has a little blurp on my my

950
00:29:19,200 --> 00:29:21,120
updated prezzo where 2020 they're using

951
00:29:21,120 --> 00:29:21,679
silk

952
00:29:21,679 --> 00:29:24,480
so they're going after old excel macro

953
00:29:24,480 --> 00:29:25,600
office content

954
00:29:25,600 --> 00:29:28,559
old macro types not the new ones i see

955
00:29:28,559 --> 00:29:29,679
iqy files

956
00:29:29,679 --> 00:29:33,600
and again uh silk files slk files

957
00:29:33,600 --> 00:29:35,520
so why do we allow these to come in via

958
00:29:35,520 --> 00:29:37,360
email we're never going to need these

959
00:29:37,360 --> 00:29:37,919
normally

960
00:29:37,919 --> 00:29:40,240
ever ever and if you do need something

961
00:29:40,240 --> 00:29:41,679
weird like this normally

962
00:29:41,679 --> 00:29:43,840
teach your users how to encrypt them

963
00:29:43,840 --> 00:29:44,960
with passwords and

964
00:29:44,960 --> 00:29:46,640
properly send the passwords under two

965
00:29:46,640 --> 00:29:48,720
channels and all that right

966
00:29:48,720 --> 00:29:50,640
and we can seriously reduce these kinds

967
00:29:50,640 --> 00:29:52,320
of things we've seen iso files who's

968
00:29:52,320 --> 00:29:53,600
going to send a freaking iso image

969
00:29:53,600 --> 00:29:55,200
through email seriously

970
00:29:55,200 --> 00:29:56,480
but they do because it's small enough

971
00:29:56,480 --> 00:29:58,159
and they can infect you so there's all

972
00:29:58,159 --> 00:29:59,520
kinds of weird file types that are in

973
00:29:59,520 --> 00:30:00,880
these lists that i'm listening here that

974
00:30:00,880 --> 00:30:03,440
if you block these you're way ahead

975
00:30:03,440 --> 00:30:05,919
we implemented just a handful at the

976
00:30:05,919 --> 00:30:08,480
place i came for prior to ncc group

977
00:30:08,480 --> 00:30:11,200
uh jsjc wsf again we had a podcast in

978
00:30:11,200 --> 00:30:13,039
this so so go listen up on it

979
00:30:13,039 --> 00:30:16,320
publish the list as well uh wsh

980
00:30:16,320 --> 00:30:17,760
you know several others there's about

981
00:30:17,760 --> 00:30:19,760
seven types is all we blocked and we

982
00:30:19,760 --> 00:30:21,919
blocked we dropped like 90 percent of

983
00:30:21,919 --> 00:30:22,799
the attack vector

984
00:30:22,799 --> 00:30:24,080
just by getting rid of those those

985
00:30:24,080 --> 00:30:26,720
attachment types so definitely block

986
00:30:26,720 --> 00:30:27,039
these

987
00:30:27,039 --> 00:30:28,640
exchange has a built-in outlook has a

988
00:30:28,640 --> 00:30:30,240
built-in and a lot of organizations just

989
00:30:30,240 --> 00:30:32,240
don't turn on

990
00:30:32,240 --> 00:30:34,159
better yet have you considered

991
00:30:34,159 --> 00:30:35,440
considered the way

992
00:30:35,440 --> 00:30:39,760
users how users respond to these double

993
00:30:39,760 --> 00:30:41,279
clicks right what happens when user

994
00:30:41,279 --> 00:30:43,279
double clicks a wsf

995
00:30:43,279 --> 00:30:46,559
or a jse file or js file right or a nice

996
00:30:46,559 --> 00:30:47,039
iq

997
00:30:47,039 --> 00:30:49,919
y file or silk file you can actually

998
00:30:49,919 --> 00:30:51,919
break these by changing an active

999
00:30:51,919 --> 00:30:52,559
directory

1000
00:30:52,559 --> 00:30:54,159
the association of what's supposed to

1001
00:30:54,159 --> 00:30:56,159
happen and say oh i don't know

1002
00:30:56,159 --> 00:30:59,039
open notepad so instead of the script js

1003
00:30:59,039 --> 00:30:59,919
saying ah

1004
00:30:59,919 --> 00:31:02,399
windows ah i know what this extension is

1005
00:31:02,399 --> 00:31:03,440
go run this

1006
00:31:03,440 --> 00:31:05,039
file that you are clicking on with

1007
00:31:05,039 --> 00:31:06,880
wscript and run it

1008
00:31:06,880 --> 00:31:09,200
now users shouldn't be doing that so you

1009
00:31:09,200 --> 00:31:10,960
can actually with an active directory

1010
00:31:10,960 --> 00:31:14,000
literally tell all these these engine

1011
00:31:14,000 --> 00:31:14,799
related uh

1012
00:31:14,799 --> 00:31:16,960
scripting engine related file types to

1013
00:31:16,960 --> 00:31:18,399
open up notepad and so now you get all

1014
00:31:18,399 --> 00:31:19,519
this gibberish garbage

1015
00:31:19,519 --> 00:31:21,039
for those of us that have looked at

1016
00:31:21,039 --> 00:31:22,640
those uh scripts and how they off you

1017
00:31:22,640 --> 00:31:23,840
scape the heck out of them

1018
00:31:23,840 --> 00:31:25,279
the worst thing the user will do is

1019
00:31:25,279 --> 00:31:26,720
start calling the help desk and opening

1020
00:31:26,720 --> 00:31:28,080
tickets which is a good thing

1021
00:31:28,080 --> 00:31:30,080
they're not getting infected and you're

1022
00:31:30,080 --> 00:31:31,519
identifying a vector that you're being

1023
00:31:31,519 --> 00:31:32,480
attacked

1024
00:31:32,480 --> 00:31:34,559
right so again test this in your

1025
00:31:34,559 --> 00:31:35,600
environment um

1026
00:31:35,600 --> 00:31:37,600
the only one that would be problematic

1027
00:31:37,600 --> 00:31:39,039
but probably vbs

1028
00:31:39,039 --> 00:31:40,559
but again scripting at the command line

1029
00:31:40,559 --> 00:31:42,000
will work fine it's only what happens

1030
00:31:42,000 --> 00:31:43,919
when the user double clicks it the

1031
00:31:43,919 --> 00:31:45,919
default association of the of the

1032
00:31:45,919 --> 00:31:47,360
devious double click

1033
00:31:47,360 --> 00:31:49,919
clickity clicky all right but again it

1034
00:31:49,919 --> 00:31:50,480
doesn't

1035
00:31:50,480 --> 00:31:52,240
it doesn't impact the user that much

1036
00:31:52,240 --> 00:31:53,840
other than a lot of notepads of funky

1037
00:31:53,840 --> 00:31:54,480
stuff will pop

1038
00:31:54,480 --> 00:31:57,120
up but yes that can definitely take you

1039
00:31:57,120 --> 00:31:59,039
another mile down the road in regards to

1040
00:31:59,039 --> 00:32:01,519
inbound emails of attachment types

1041
00:32:01,519 --> 00:32:03,840
or thumb drives or download from zip

1042
00:32:03,840 --> 00:32:05,919
open a zip etc

1043
00:32:05,919 --> 00:32:08,960
or url and go into visit etc

1044
00:32:08,960 --> 00:32:10,799
can you see producer consumer ratio

1045
00:32:10,799 --> 00:32:12,480
within your network traffic i talked

1046
00:32:12,480 --> 00:32:13,360
about this before

1047
00:32:13,360 --> 00:32:15,279
in your network gear do you can you see

1048
00:32:15,279 --> 00:32:17,360
minus one to plus one in log md

1049
00:32:17,360 --> 00:32:18,960
we have this in the report when we

1050
00:32:18,960 --> 00:32:20,960
harvest the windows uh

1051
00:32:20,960 --> 00:32:24,080
firewall logs um we have the ips in

1052
00:32:24,080 --> 00:32:25,519
there we have the uh

1053
00:32:25,519 --> 00:32:27,760
the process that executed that to that

1054
00:32:27,760 --> 00:32:28,720
ip address

1055
00:32:28,720 --> 00:32:30,559
and then in the shrum logs for windows

1056
00:32:30,559 --> 00:32:32,640
10 and windows 8.1

1057
00:32:32,640 --> 00:32:34,559
system resource utilization management

1058
00:32:34,559 --> 00:32:36,000
we can pull out

1059
00:32:36,000 --> 00:32:39,440
the bytes in and bytes out flow of that

1060
00:32:39,440 --> 00:32:40,159
process

1061
00:32:40,159 --> 00:32:42,159
which allows us to convert it to math to

1062
00:32:42,159 --> 00:32:44,480
say are you in a pcr scenario

1063
00:32:44,480 --> 00:32:46,880
hey this weird service host is sending

1064
00:32:46,880 --> 00:32:48,880
out a whole lot of data

1065
00:32:48,880 --> 00:32:50,399
that's a great indication you got a next

1066
00:32:50,399 --> 00:32:52,559
fill happening right so closer to plus

1067
00:32:52,559 --> 00:32:53,600
one is the x fill

1068
00:32:53,600 --> 00:32:55,519
minus one as a download and so can you

1069
00:32:55,519 --> 00:32:57,279
even see it so if you go investigate it

1070
00:32:57,279 --> 00:32:58,240
can you see it

1071
00:32:58,240 --> 00:32:59,919
a lot of netgear bracada's got it built

1072
00:32:59,919 --> 00:33:01,760
in for example i know a lot of other

1073
00:33:01,760 --> 00:33:02,480
network

1074
00:33:02,480 --> 00:33:04,559
solutions that monitor network traffic

1075
00:33:04,559 --> 00:33:06,320
will have this so definitely something

1076
00:33:06,320 --> 00:33:06,640
to

1077
00:33:06,640 --> 00:33:08,840
to consider can i even see it

1078
00:33:08,840 --> 00:33:10,640
preparation or if you're making a

1079
00:33:10,640 --> 00:33:11,840
decision about purchasing

1080
00:33:11,840 --> 00:33:14,880
solutions consider this as a requirement

1081
00:33:14,880 --> 00:33:16,640
this is a big tell right it's where you

1082
00:33:16,640 --> 00:33:18,480
find people using onedrive

1083
00:33:18,480 --> 00:33:20,000
and dropbox when you're not supposed to

1084
00:33:20,000 --> 00:33:21,840
be if you're saying hipaa

1085
00:33:21,840 --> 00:33:24,000
how about dns text records can you see

1086
00:33:24,000 --> 00:33:25,440
that within your

1087
00:33:25,440 --> 00:33:27,440
network devices your routers firewalls

1088
00:33:27,440 --> 00:33:29,600
whatnot the length of these records

1089
00:33:29,600 --> 00:33:31,519
becomes kind of important because the

1090
00:33:31,519 --> 00:33:33,360
bad guys win nti in this case and

1091
00:33:33,360 --> 00:33:34,320
several others

1092
00:33:34,320 --> 00:33:36,640
have used dns text records because you

1093
00:33:36,640 --> 00:33:38,240
can stuff text in there

1094
00:33:38,240 --> 00:33:41,120
as a c2 channel and the length of them

1095
00:33:41,120 --> 00:33:42,240
will often give out that there's

1096
00:33:42,240 --> 00:33:44,480
something really weird going on

1097
00:33:44,480 --> 00:33:46,799
and so can you even see that cisco

1098
00:33:46,799 --> 00:33:48,720
routers firewalls definitely have this

1099
00:33:48,720 --> 00:33:49,279
in there

1100
00:33:49,279 --> 00:33:50,640
you can actually see how many bytes the

1101
00:33:50,640 --> 00:33:52,640
text record is

1102
00:33:52,640 --> 00:33:53,919
so take a look at that you can even see

1103
00:33:53,919 --> 00:33:56,159
the actual value of it too in the data

1104
00:33:56,159 --> 00:33:59,200
does your vpn log source ip addresses if

1105
00:33:59,200 --> 00:33:59,600
you're

1106
00:33:59,600 --> 00:34:01,760
doing load balancers in front of say an

1107
00:34:01,760 --> 00:34:04,000
exchange environment

1108
00:34:04,000 --> 00:34:06,320
if you don't configure them to allow the

1109
00:34:06,320 --> 00:34:07,840
source ip to go all the way through to

1110
00:34:07,840 --> 00:34:10,320
the exchange box and do that translation

1111
00:34:10,320 --> 00:34:12,480
you will have no idea who's attacking

1112
00:34:12,480 --> 00:34:13,839
your exchange environment

1113
00:34:13,839 --> 00:34:16,159
if you're using a front-end proxy same

1114
00:34:16,159 --> 00:34:17,520
thing can happen in these load balance

1115
00:34:17,520 --> 00:34:18,879
citrix environments same thing can

1116
00:34:18,879 --> 00:34:20,960
happen in load balance vpn environments

1117
00:34:20,960 --> 00:34:23,040
so be sure you can see where these

1118
00:34:23,040 --> 00:34:24,800
source ips are coming from

1119
00:34:24,800 --> 00:34:27,280
make those changes put in those plans so

1120
00:34:27,280 --> 00:34:27,918
that those

1121
00:34:27,918 --> 00:34:30,800
ips from china are actually being seen

1122
00:34:30,800 --> 00:34:31,359
and not

1123
00:34:31,359 --> 00:34:32,639
when you look at an attack see it's

1124
00:34:32,639 --> 00:34:34,320
coming from the proxy where's the proxy

1125
00:34:34,320 --> 00:34:34,960
coming from

1126
00:34:34,960 --> 00:34:36,320
well you go to the proxy and all it

1127
00:34:36,320 --> 00:34:38,719
shows is the firewall or the vpn device

1128
00:34:38,719 --> 00:34:39,280
and you're like

1129
00:34:39,280 --> 00:34:41,599
uh that's not descriptive enough i can't

1130
00:34:41,599 --> 00:34:43,359
associate the two sessions

1131
00:34:43,359 --> 00:34:45,359
and so that's why it's important and can

1132
00:34:45,359 --> 00:34:46,480
you see netflow

1133
00:34:46,480 --> 00:34:47,918
if you have even yet if you've got the

1134
00:34:47,918 --> 00:34:49,599
fully forklift upgraded cisco

1135
00:34:49,599 --> 00:34:51,359
environments uh you can you have netflow

1136
00:34:51,359 --> 00:34:52,480
available to you

1137
00:34:52,480 --> 00:34:54,639
uh or palo alto or whatnot can you even

1138
00:34:54,639 --> 00:34:56,320
see it is it configured properly

1139
00:34:56,320 --> 00:34:58,000
there's a lot of options of palo alto to

1140
00:34:58,000 --> 00:34:59,599
turn things on and off and control its

1141
00:34:59,599 --> 00:35:01,200
flow with wildfire

1142
00:35:01,200 --> 00:35:02,800
all right and of course always have the

1143
00:35:02,800 --> 00:35:04,480
ability to do packet captures

1144
00:35:04,480 --> 00:35:06,400
would be nice too because if you can get

1145
00:35:06,400 --> 00:35:07,680
something on the fly

1146
00:35:07,680 --> 00:35:08,960
there's a lot of data to be pulled out

1147
00:35:08,960 --> 00:35:11,599
of packet caps

1148
00:35:11,599 --> 00:35:14,000
web server and web proxy how many block

1149
00:35:14,000 --> 00:35:16,240
uncategorized domains

1150
00:35:16,240 --> 00:35:18,000
i'm thinking i don't see a lot of hands

1151
00:35:18,000 --> 00:35:19,839
if this was uh being asked and i was

1152
00:35:19,839 --> 00:35:21,440
asking raise your hands

1153
00:35:21,440 --> 00:35:23,680
this is a tough one because people think

1154
00:35:23,680 --> 00:35:25,440
the internet is entitled and where i go

1155
00:35:25,440 --> 00:35:27,520
and surf is entitled

1156
00:35:27,520 --> 00:35:29,520
unfortunately the majority of malware

1157
00:35:29,520 --> 00:35:31,760
tax c2 channels are uncategorized

1158
00:35:31,760 --> 00:35:32,400
meaning

1159
00:35:32,400 --> 00:35:34,160
they are not in the alexa top million

1160
00:35:34,160 --> 00:35:36,320
probably let alone top 10 million

1161
00:35:36,320 --> 00:35:39,040
um they are definitely uncategorized and

1162
00:35:39,040 --> 00:35:40,079
web proxies

1163
00:35:40,079 --> 00:35:41,760
and most of our attacks come from there

1164
00:35:41,760 --> 00:35:43,520
are a heck of a lot of them

1165
00:35:43,520 --> 00:35:45,680
definitely the non-apt attacks and even

1166
00:35:45,680 --> 00:35:47,599
a lot of the apt attacks

1167
00:35:47,599 --> 00:35:49,440
and so when i investigate stuff i always

1168
00:35:49,440 --> 00:35:51,599
go look at when i find a url or an ip

1169
00:35:51,599 --> 00:35:53,200
address i go look

1170
00:35:53,200 --> 00:35:55,839
i did a coin miner and actually visited

1171
00:35:55,839 --> 00:35:57,520
the ip address and put in the domain

1172
00:35:57,520 --> 00:35:58,079
into

1173
00:35:58,079 --> 00:36:00,320
into it of course uncategorized visited

1174
00:36:00,320 --> 00:36:01,680
the ip on a browser

1175
00:36:01,680 --> 00:36:03,920
in a lab and of course boom it tells me

1176
00:36:03,920 --> 00:36:05,599
you know mining operational pops up in

1177
00:36:05,599 --> 00:36:06,800
the screen

1178
00:36:06,800 --> 00:36:08,640
so this information is really useful

1179
00:36:08,640 --> 00:36:09,920
because if

1180
00:36:09,920 --> 00:36:12,960
i can or do have the ability to

1181
00:36:12,960 --> 00:36:15,040
implement a categorization block of

1182
00:36:15,040 --> 00:36:16,960
saying i'm turning off uncategorized

1183
00:36:16,960 --> 00:36:17,599
because remember

1184
00:36:17,599 --> 00:36:19,119
the bad guys will just pivot from one to

1185
00:36:19,119 --> 00:36:20,800
the other so if you start chasing

1186
00:36:20,800 --> 00:36:22,800
the bad url and say i'm gonna block i'm

1187
00:36:22,800 --> 00:36:24,000
a block that i'm gonna block that

1188
00:36:24,000 --> 00:36:26,000
you're chasing a runaway train right

1189
00:36:26,000 --> 00:36:27,760
domain generating algorithms

1190
00:36:27,760 --> 00:36:29,280
you just can't block enough so what you

1191
00:36:29,280 --> 00:36:31,359
have to do is say are you uncategorized

1192
00:36:31,359 --> 00:36:32,800
the internet knows who you are

1193
00:36:32,800 --> 00:36:34,320
so i'm just going to block on categories

1194
00:36:34,320 --> 00:36:36,560
and even if it's for a point of time

1195
00:36:36,560 --> 00:36:40,079
or or a short window of the course of an

1196
00:36:40,079 --> 00:36:40,640
incident

1197
00:36:40,640 --> 00:36:43,280
or longer you should have or be prepared

1198
00:36:43,280 --> 00:36:44,400
to do this

1199
00:36:44,400 --> 00:36:46,880
uh very useful in regards to an attack

1200
00:36:46,880 --> 00:36:48,640
or blacklist them as another option

1201
00:36:48,640 --> 00:36:48,960
right

1202
00:36:48,960 --> 00:36:50,960
uh we had an entire environment where we

1203
00:36:50,960 --> 00:36:52,480
blocked an ipaddress

1204
00:36:52,480 --> 00:36:54,320
and they had a detonation when the thing

1205
00:36:54,320 --> 00:36:56,640
couldn't communicate and it blew up the

1206
00:36:56,640 --> 00:36:59,280
the game blade and so we thought oh this

1207
00:36:59,280 --> 00:37:00,160
could be you know

1208
00:37:00,160 --> 00:37:01,920
self-destructing malware the mission

1209
00:37:01,920 --> 00:37:04,079
impossible self-destruct in five second

1210
00:37:04,079 --> 00:37:05,359
if i can't communicate

1211
00:37:05,359 --> 00:37:08,240
so we then set up a netcat server

1212
00:37:08,240 --> 00:37:10,240
outside on some cloud server out there

1213
00:37:10,240 --> 00:37:12,720
and just rerouted all these ips that we

1214
00:37:12,720 --> 00:37:13,680
found

1215
00:37:13,680 --> 00:37:15,839
and then urls to that black hole so that

1216
00:37:15,839 --> 00:37:17,599
the three-way handshake would occur

1217
00:37:17,599 --> 00:37:19,920
to avoid any potential blow-ups but be

1218
00:37:19,920 --> 00:37:22,240
prepared to do this

1219
00:37:22,240 --> 00:37:24,720
windows firewall anybody have this

1220
00:37:24,720 --> 00:37:26,880
enabled and actually enforcing oh please

1221
00:37:26,880 --> 00:37:27,760
please please it

1222
00:37:27,760 --> 00:37:30,400
is in the windows logging cheat sheet it

1223
00:37:30,400 --> 00:37:32,240
you can within group policy

1224
00:37:32,240 --> 00:37:34,240
set it for any any and then go enable

1225
00:37:34,240 --> 00:37:36,320
the gpo to log

1226
00:37:36,320 --> 00:37:39,040
and at least a all traffic will pass

1227
00:37:39,040 --> 00:37:40,560
because i know your i.t people will say

1228
00:37:40,560 --> 00:37:41,839
i might block something i don't want to

1229
00:37:41,839 --> 00:37:43,359
manage all those exceptions yadda yadda

1230
00:37:43,359 --> 00:37:45,040
yadda it's hard

1231
00:37:45,040 --> 00:37:47,200
yes maybe but i do need the logging

1232
00:37:47,200 --> 00:37:49,280
enabled and at some point in the course

1233
00:37:49,280 --> 00:37:50,000
of an incident

1234
00:37:50,000 --> 00:37:53,520
i may need to block a set of ips because

1235
00:37:53,520 --> 00:37:55,520
i can kill an a attack or an

1236
00:37:55,520 --> 00:37:57,599
attack uh as an ir investigator we'll

1237
00:37:57,599 --> 00:37:59,760
come in we can identify the 135 10

1238
00:37:59,760 --> 00:38:02,560
20 ip addresses how will you block that

1239
00:38:02,560 --> 00:38:04,000
if it's windows boxes where

1240
00:38:04,000 --> 00:38:05,920
a lot of attacks occur still eighty-five

1241
00:38:05,920 --> 00:38:08,079
percent of desktops and windows based

1242
00:38:08,079 --> 00:38:09,920
that this is an option where i can just

1243
00:38:09,920 --> 00:38:11,359
say here go turn on the windows firewall

1244
00:38:11,359 --> 00:38:13,119
balancing wham let it go

1245
00:38:13,119 --> 00:38:15,280
so set it up get it working and have the

1246
00:38:15,280 --> 00:38:16,160
ability

1247
00:38:16,160 --> 00:38:18,160
plus if you do turn it on workstation

1248
00:38:18,160 --> 00:38:19,839
workstation within your workstation

1249
00:38:19,839 --> 00:38:20,640
environment

1250
00:38:20,640 --> 00:38:23,200
you're destroying lateral movement right

1251
00:38:23,200 --> 00:38:24,240
a real pain

1252
00:38:24,240 --> 00:38:26,720
for red team pen testers i remember i

1253
00:38:26,720 --> 00:38:28,480
was presenting a similar this first

1254
00:38:28,480 --> 00:38:29,680
version of this talk at wild west

1255
00:38:29,680 --> 00:38:31,119
hacking fest and dave kennedy did a

1256
00:38:31,119 --> 00:38:32,079
keynote

1257
00:38:32,079 --> 00:38:34,000
and he just screamed at his talkers

1258
00:38:34,000 --> 00:38:35,920
along for the love of god if you want to

1259
00:38:35,920 --> 00:38:38,400
stop me turn on the windows firewall

1260
00:38:38,400 --> 00:38:40,960
it makes it so hard right and and hey

1261
00:38:40,960 --> 00:38:42,240
even the red teamers are telling you if

1262
00:38:42,240 --> 00:38:43,680
you want to break me this is a great way

1263
00:38:43,680 --> 00:38:44,480
to do it

1264
00:38:44,480 --> 00:38:46,160
and you get great logging in the course

1265
00:38:46,160 --> 00:38:47,760
of doing it so

1266
00:38:47,760 --> 00:38:49,760
very handy for for us to investigate

1267
00:38:49,760 --> 00:38:51,839
because it gives me the process name

1268
00:38:51,839 --> 00:38:54,560
and the ip problem with ids ips it tells

1269
00:38:54,560 --> 00:38:54,960
me

1270
00:38:54,960 --> 00:38:56,640
this ip address is talking to that ip

1271
00:38:56,640 --> 00:38:58,320
address well who's that ip address

1272
00:38:58,320 --> 00:39:01,200
i don't know it's 10.1.2.3 you go figure

1273
00:39:01,200 --> 00:39:02,000
it out

1274
00:39:02,000 --> 00:39:04,560
well if i can map that or link it

1275
00:39:04,560 --> 00:39:06,079
through my active directory and figure

1276
00:39:06,079 --> 00:39:07,599
out that it's bob's machine i go to

1277
00:39:07,599 --> 00:39:08,640
bob's machine

1278
00:39:08,640 --> 00:39:11,040
and i know the the destination or source

1279
00:39:11,040 --> 00:39:12,800
ip of the bad guy i can look within the

1280
00:39:12,800 --> 00:39:14,400
windows firewall logs find that ip

1281
00:39:14,400 --> 00:39:16,000
address and i now know the process that

1282
00:39:16,000 --> 00:39:17,680
it's talking to

1283
00:39:17,680 --> 00:39:20,640
very very handy saves a lot of time and

1284
00:39:20,640 --> 00:39:21,760
a lot of money

1285
00:39:21,760 --> 00:39:22,960
let's talk a little bit about threat

1286
00:39:22,960 --> 00:39:24,560
hunting purple teaming and incident

1287
00:39:24,560 --> 00:39:26,240
response

1288
00:39:26,240 --> 00:39:27,839
so some say hunting is the creation of a

1289
00:39:27,839 --> 00:39:29,760
hypothesis and then you go searching for

1290
00:39:29,760 --> 00:39:30,000
it

1291
00:39:30,000 --> 00:39:32,320
yeah no that's probably one of the later

1292
00:39:32,320 --> 00:39:33,760
things you do with threat hunting

1293
00:39:33,760 --> 00:39:35,760
i say they do that after you search for

1294
00:39:35,760 --> 00:39:38,079
obvious well-known artifacts and iocs

1295
00:39:38,079 --> 00:39:39,680
a lot of what we talked about of course

1296
00:39:39,680 --> 00:39:41,520
this prezzo already 90

1297
00:39:41,520 --> 00:39:45,200
of attacks have several things in common

1298
00:39:45,200 --> 00:39:46,800
if you do good preparation then threat

1299
00:39:46,800 --> 00:39:48,079
hunting purple teaming and incident

1300
00:39:48,079 --> 00:39:49,040
response become

1301
00:39:49,040 --> 00:39:52,240
much much easier and faster to do by you

1302
00:39:52,240 --> 00:39:54,640
or your preferred ir consultancy

1303
00:39:54,640 --> 00:39:55,440
preparation

1304
00:39:55,440 --> 00:39:57,359
also enables the ability to hunt as you

1305
00:39:57,359 --> 00:39:58,800
will have a lot more data

1306
00:39:58,800 --> 00:40:00,720
which means confidence you will discover

1307
00:40:00,720 --> 00:40:02,720
something if it is out there

1308
00:40:02,720 --> 00:40:04,319
i can tell you from threat hanging

1309
00:40:04,319 --> 00:40:05,839
environments to say i just want you to

1310
00:40:05,839 --> 00:40:06,640
threat hunt

1311
00:40:06,640 --> 00:40:08,400
but i have to do a capability assessment

1312
00:40:08,400 --> 00:40:09,680
first nope just threat hunt

1313
00:40:09,680 --> 00:40:10,880
and i come back and say i didn't find

1314
00:40:10,880 --> 00:40:12,480
anything well why didn't you find

1315
00:40:12,480 --> 00:40:13,920
anything because i told you

1316
00:40:13,920 --> 00:40:15,520
i need to do a capability assessment

1317
00:40:15,520 --> 00:40:16,480
because i know you don't have things

1318
00:40:16,480 --> 00:40:17,520
turned on

1319
00:40:17,520 --> 00:40:19,280
right it's terrible to say come back and

1320
00:40:19,280 --> 00:40:21,280
tell your management or tell your client

1321
00:40:21,280 --> 00:40:22,800
i can't find anything because you didn't

1322
00:40:22,800 --> 00:40:24,480
follow the preparation guidelines in

1323
00:40:24,480 --> 00:40:25,920
which we told you at the very beginning

1324
00:40:25,920 --> 00:40:27,200
or six or eight months ago

1325
00:40:27,200 --> 00:40:29,680
or this presentation i told you about

1326
00:40:29,680 --> 00:40:31,599
that or this podcast right

1327
00:40:31,599 --> 00:40:34,319
the preparation is key here i can't hunt

1328
00:40:34,319 --> 00:40:36,160
for data that is not there the source

1329
00:40:36,160 --> 00:40:37,359
data sources just

1330
00:40:37,359 --> 00:40:39,920
won't have it in the in them right but

1331
00:40:39,920 --> 00:40:42,240
you can look for well-known things

1332
00:40:42,240 --> 00:40:44,160
uh threat actors and mao artifacts

1333
00:40:44,160 --> 00:40:47,040
proactively which we call hunting

1334
00:40:47,040 --> 00:40:48,400
but again you have a better chance of

1335
00:40:48,400 --> 00:40:50,240
catching the wet team and well and doing

1336
00:40:50,240 --> 00:40:51,839
their nefarious foo

1337
00:40:51,839 --> 00:40:53,359
if you do all this preparation right and

1338
00:40:53,359 --> 00:40:55,760
i work for ncc group so here's that

1339
00:40:55,760 --> 00:40:58,720
so i say look for things like is logging

1340
00:40:58,720 --> 00:40:59,680
enabled

1341
00:40:59,680 --> 00:41:01,359
part of threat hunting should be what i

1342
00:41:01,359 --> 00:41:04,160
call the three c's configuration

1343
00:41:04,160 --> 00:41:06,000
um coverage and completeness

1344
00:41:06,000 --> 00:41:07,359
configuration is

1345
00:41:07,359 --> 00:41:10,640
uh is the agent on the machine and if

1346
00:41:10,640 --> 00:41:12,160
the agent is on the machine does the

1347
00:41:12,160 --> 00:41:14,319
configuration within for example winlock

1348
00:41:14,319 --> 00:41:14,880
b

1349
00:41:14,880 --> 00:41:16,240
is it collecting all the things that i

1350
00:41:16,240 --> 00:41:19,040
wanted to collect if you're using sysmon

1351
00:41:19,040 --> 00:41:20,960
did i configure the sysmon config file

1352
00:41:20,960 --> 00:41:22,160
correctly is it collecting all the

1353
00:41:22,160 --> 00:41:23,119
things i expect

1354
00:41:23,119 --> 00:41:25,440
do i see what i need to see verifying

1355
00:41:25,440 --> 00:41:26,480
that is very important

1356
00:41:26,480 --> 00:41:28,800
right that's configuration coverage is

1357
00:41:28,800 --> 00:41:31,119
have i put them on 100 of my assets

1358
00:41:31,119 --> 00:41:32,800
i can tell you that companies are really

1359
00:41:32,800 --> 00:41:34,800
bad at this they have no way

1360
00:41:34,800 --> 00:41:37,200
to know that they have 100 coverage in

1361
00:41:37,200 --> 00:41:38,079
their in their

1362
00:41:38,079 --> 00:41:40,720
assets asset management software's don't

1363
00:41:40,720 --> 00:41:41,920
do a good job of saying

1364
00:41:41,920 --> 00:41:43,839
here's all my assets and here's where i

1365
00:41:43,839 --> 00:41:45,920
mrm not installed

1366
00:41:45,920 --> 00:41:48,000
it's a terrible scenario sscm jobs are

1367
00:41:48,000 --> 00:41:49,839
pretty typical i say go run this all

1368
00:41:49,839 --> 00:41:51,119
against all the machines

1369
00:41:51,119 --> 00:41:52,640
well what if they're powered off what if

1370
00:41:52,640 --> 00:41:55,599
they are remote for a period of time etc

1371
00:41:55,599 --> 00:41:57,119
home users right now

1372
00:41:57,119 --> 00:41:59,119
the sscm job will timeout for two weeks

1373
00:41:59,119 --> 00:42:00,480
they never get their updates

1374
00:42:00,480 --> 00:42:02,720
so that's the whole idea of coverage you

1375
00:42:02,720 --> 00:42:04,000
know it does

1376
00:42:04,000 --> 00:42:06,240
does my thing cover everything all my

1377
00:42:06,240 --> 00:42:07,280
all my assets

1378
00:42:07,280 --> 00:42:08,800
and then completeness is making sure

1379
00:42:08,800 --> 00:42:10,640
you've done all that and then i can rate

1380
00:42:10,640 --> 00:42:12,560
myself on completeness because you can't

1381
00:42:12,560 --> 00:42:13,040
hunt

1382
00:42:13,040 --> 00:42:15,440
you can't do ir and you can't do purple

1383
00:42:15,440 --> 00:42:16,400
teaming very well

1384
00:42:16,400 --> 00:42:18,160
if these assets aren't well covered or

1385
00:42:18,160 --> 00:42:19,520
configured

1386
00:42:19,520 --> 00:42:21,200
are the ports not open in the case of my

1387
00:42:21,200 --> 00:42:22,640
devops scenario are the

1388
00:42:22,640 --> 00:42:24,800
default creds not used yes these are

1389
00:42:24,800 --> 00:42:26,160
actually threat hunting items

1390
00:42:26,160 --> 00:42:27,680
make sure i don't have these because

1391
00:42:27,680 --> 00:42:30,079
they will be exploited if i do have

1392
00:42:30,079 --> 00:42:30,720
these

1393
00:42:30,720 --> 00:42:32,480
so this is a form of threat hunting

1394
00:42:32,480 --> 00:42:34,160
because there are no knowns of things

1395
00:42:34,160 --> 00:42:35,599
that will get exploited

1396
00:42:35,599 --> 00:42:38,160
auto runs persistence aseps right if i

1397
00:42:38,160 --> 00:42:39,280
run something

1398
00:42:39,280 --> 00:42:41,680
on a box and i want to persist then i'm

1399
00:42:41,680 --> 00:42:43,280
going to write some sort of persistence

1400
00:42:43,280 --> 00:42:45,119
on the box so go look for that and say

1401
00:42:45,119 --> 00:42:47,599
i have no signs of any malicious auto

1402
00:42:47,599 --> 00:42:50,079
runs or i can't see boxes 1 3 5

1403
00:42:50,079 --> 00:42:53,760
20 30 512 and so i go and fix those

1404
00:42:53,760 --> 00:42:55,119
issues or address those issues do you

1405
00:42:55,119 --> 00:42:56,720
even have tools that can look for this

1406
00:42:56,720 --> 00:42:57,359
stuff

1407
00:42:57,359 --> 00:42:59,760
right sysinternals autoruns or log md

1408
00:42:59,760 --> 00:43:00,480
can do this

1409
00:43:00,480 --> 00:43:02,720
but you would use that even have that in

1410
00:43:02,720 --> 00:43:03,680
your arsenal

1411
00:43:03,680 --> 00:43:06,400
large keys containing payloads or

1412
00:43:06,400 --> 00:43:08,000
registry scripts right

1413
00:43:08,000 --> 00:43:11,119
when nti copter several others drydex

1414
00:43:11,119 --> 00:43:12,560
and others have stored

1415
00:43:12,560 --> 00:43:15,040
their payloads in the registry thus

1416
00:43:15,040 --> 00:43:16,079
creating huge

1417
00:43:16,079 --> 00:43:19,040
keys so are huge values data within a

1418
00:43:19,040 --> 00:43:20,319
value within a key

1419
00:43:20,319 --> 00:43:21,680
and you can go looking for those and

1420
00:43:21,680 --> 00:43:22,960
eliminate them because there's not very

1421
00:43:22,960 --> 00:43:25,599
many big reg keys honestly in windows

1422
00:43:25,599 --> 00:43:27,280
uh no byte entries in the register key

1423
00:43:27,280 --> 00:43:28,960
kofter did this to hide it when you went

1424
00:43:28,960 --> 00:43:30,640
and did a reg query or opened up the

1425
00:43:30,640 --> 00:43:32,000
registering went looking

1426
00:43:32,000 --> 00:43:34,720
wmi database entries apt users will put

1427
00:43:34,720 --> 00:43:36,480
their scripts or payloads in the wmi

1428
00:43:36,480 --> 00:43:38,000
database it's a database that can hold

1429
00:43:38,000 --> 00:43:38,640
files

1430
00:43:38,640 --> 00:43:40,800
or large powershell scripts or

1431
00:43:40,800 --> 00:43:42,400
suspicious powershell executions

1432
00:43:42,400 --> 00:43:44,400
obfuscation daniel behan and stuff

1433
00:43:44,400 --> 00:43:46,000
can you look at the powershell logs and

1434
00:43:46,000 --> 00:43:47,920
look for this stuff that doesn't

1435
00:43:47,920 --> 00:43:51,839
include um overly amount of ticks or the

1436
00:43:51,839 --> 00:43:53,440
amount of pluses overly amount of coats

1437
00:43:53,440 --> 00:43:54,880
can you do you have a way within splunk

1438
00:43:54,880 --> 00:43:56,319
or what not to do that

1439
00:43:56,319 --> 00:43:57,760
you can check the splunk logging cheat

1440
00:43:57,760 --> 00:43:58,880
sheet we have for that and i'll give you

1441
00:43:58,880 --> 00:43:59,520
an idea of

1442
00:43:59,520 --> 00:44:01,440
what i'm talking about there suspicious

1443
00:44:01,440 --> 00:44:02,880
execution and see users

1444
00:44:02,880 --> 00:44:05,680
heavily heavily watch this if your users

1445
00:44:05,680 --> 00:44:06,960
are standard users even if they're

1446
00:44:06,960 --> 00:44:07,520
admins

1447
00:44:07,520 --> 00:44:09,839
generally they're going to capitalize on

1448
00:44:09,839 --> 00:44:11,680
percent app data percent and percent

1449
00:44:11,680 --> 00:44:13,200
temp those are in the user's data

1450
00:44:13,200 --> 00:44:13,920
structure

1451
00:44:13,920 --> 00:44:16,240
suspicious admin lobbin executions this

1452
00:44:16,240 --> 00:44:18,079
is huge this is where the red teams

1453
00:44:18,079 --> 00:44:18,800
attack you

1454
00:44:18,800 --> 00:44:20,400
this is living off the land this is

1455
00:44:20,400 --> 00:44:22,560
where the the apt guys will attack you

1456
00:44:22,560 --> 00:44:24,160
it's in minor attack

1457
00:44:24,160 --> 00:44:25,680
can you do you have a list of these that

1458
00:44:25,680 --> 00:44:27,200
you're watching for executions and have

1459
00:44:27,200 --> 00:44:28,800
you white listed out the ones

1460
00:44:28,800 --> 00:44:30,480
you know created allows or exceptions

1461
00:44:30,480 --> 00:44:31,760
that say these are good and i'm gonna

1462
00:44:31,760 --> 00:44:32,960
i'm gonna not worry about this

1463
00:44:32,960 --> 00:44:34,000
combination

1464
00:44:34,000 --> 00:44:37,040
of a lobe look for injected processes

1465
00:44:37,040 --> 00:44:39,119
i'm speaking at sands deeper it's free

1466
00:44:39,119 --> 00:44:40,720
i'm talking about this very subject you

1467
00:44:40,720 --> 00:44:41,839
might want to sign up for that and

1468
00:44:41,839 --> 00:44:42,800
listen to that talk

1469
00:44:42,800 --> 00:44:44,560
but there's many many more things that

1470
00:44:44,560 --> 00:44:46,400
are common amongst all

1471
00:44:46,400 --> 00:44:48,240
attacks especially the commodity stuff

1472
00:44:48,240 --> 00:44:50,640
that we see every day coin miners

1473
00:44:50,640 --> 00:44:51,920
ransomware

1474
00:44:51,920 --> 00:44:53,599
see users both of these will be

1475
00:44:53,599 --> 00:44:55,119
capitalized in those cases unless

1476
00:44:55,119 --> 00:44:56,079
they're coming in from

1477
00:44:56,079 --> 00:44:59,280
an internet app flaw

1478
00:44:59,280 --> 00:45:00,560
if you hunt for these things that are

1479
00:45:00,560 --> 00:45:02,400
found in 90 of today's attacks

1480
00:45:02,400 --> 00:45:03,760
on your systems you can eliminate or

1481
00:45:03,760 --> 00:45:06,079
reduce the probability that you do not

1482
00:45:06,079 --> 00:45:08,000
have obvious indicators

1483
00:45:08,000 --> 00:45:09,440
this helps you in an incident too

1484
00:45:09,440 --> 00:45:10,640
because you can use the same tool and

1485
00:45:10,640 --> 00:45:11,440
logic to go

1486
00:45:11,440 --> 00:45:13,599
look for things involved in incident

1487
00:45:13,599 --> 00:45:14,880
well give me a list of all the auto runs

1488
00:45:14,880 --> 00:45:16,720
let's see if they wrote any persistence

1489
00:45:16,720 --> 00:45:19,920
there's a uh malware that's confecting

1490
00:45:19,920 --> 00:45:22,000
machines that's using the smb flaw

1491
00:45:22,000 --> 00:45:24,240
to infect your domain controllers with

1492
00:45:24,240 --> 00:45:26,079
no persistence whatsoever they're using

1493
00:45:26,079 --> 00:45:27,760
the workstations as the persistence

1494
00:45:27,760 --> 00:45:28,480
mechanism

1495
00:45:28,480 --> 00:45:29,440
and they're because again all

1496
00:45:29,440 --> 00:45:30,800
workstations can talk to the domain

1497
00:45:30,800 --> 00:45:32,240
controllers and if people haven't

1498
00:45:32,240 --> 00:45:34,000
patched or closed smb

1499
00:45:34,000 --> 00:45:35,599
they're using that to infect the domain

1500
00:45:35,599 --> 00:45:37,599
controllers with an injected process

1501
00:45:37,599 --> 00:45:38,000
right

1502
00:45:38,000 --> 00:45:40,640
no aseps are running are on the box at

1503
00:45:40,640 --> 00:45:42,160
all so you have to now look for things

1504
00:45:42,160 --> 00:45:44,240
in process injection that's my sounds

1505
00:45:44,240 --> 00:45:45,520
deeper talk

1506
00:45:45,520 --> 00:45:47,520
but again it prepares you to enable all

1507
00:45:47,520 --> 00:45:49,200
the things which is what this talk's all

1508
00:45:49,200 --> 00:45:49,760
about

1509
00:45:49,760 --> 00:45:51,839
which helps us help you and you can help

1510
00:45:51,839 --> 00:45:53,680
yourself and all that

1511
00:45:53,680 --> 00:45:57,119
so last minor attack you can map your

1512
00:45:57,119 --> 00:45:59,119
map your preparation to miter attack and

1513
00:45:59,119 --> 00:46:00,880
i really recommend you do this

1514
00:46:00,880 --> 00:46:03,280
go look at the the matrix they just

1515
00:46:03,280 --> 00:46:04,560
officially announced the sub

1516
00:46:04,560 --> 00:46:06,000
techniques that's going to add a whole

1517
00:46:06,000 --> 00:46:08,000
new layer right if i'm going to go after

1518
00:46:08,000 --> 00:46:09,280
an authentication flaw i'm going to

1519
00:46:09,280 --> 00:46:10,800
steal your creds you've got mimikatch

1520
00:46:10,800 --> 00:46:12,319
you got keystroke logging

1521
00:46:12,319 --> 00:46:14,000
right there's all kinds of ways to to do

1522
00:46:14,000 --> 00:46:16,160
that there's now sub techniques so

1523
00:46:16,160 --> 00:46:18,960
t one two three four dot zero zero one

1524
00:46:18,960 --> 00:46:21,359
zero zero two zero zero three et cetera

1525
00:46:21,359 --> 00:46:23,599
and you can map and say do i have this

1526
00:46:23,599 --> 00:46:25,599
turned on so i can see that

1527
00:46:25,599 --> 00:46:29,359
something in the logs of 4672

1528
00:46:29,359 --> 00:46:32,400
event id i think it is off top my head

1529
00:46:32,400 --> 00:46:34,400
could be wrong here within the security

1530
00:46:34,400 --> 00:46:36,000
log will show me

1531
00:46:36,000 --> 00:46:39,440
the process that is making requests to

1532
00:46:39,440 --> 00:46:42,000
authentication and so if manycats.exe

1533
00:46:42,000 --> 00:46:42,560
which

1534
00:46:42,560 --> 00:46:44,079
would be dumb to run that particular one

1535
00:46:44,079 --> 00:46:45,760
but if minicaps exe

1536
00:46:45,760 --> 00:46:47,839
was making a call i can see that in the

1537
00:46:47,839 --> 00:46:50,160
logs only if you turn it on

1538
00:46:50,160 --> 00:46:52,319
right and so minor attack has that and

1539
00:46:52,319 --> 00:46:53,839
so you can say well yes i have that

1540
00:46:53,839 --> 00:46:55,280
turned on and yes i can actually see

1541
00:46:55,280 --> 00:46:55,599
that

1542
00:46:55,599 --> 00:46:57,680
collecting however i collect it manually

1543
00:46:57,680 --> 00:46:59,280
or or sim or otherwise

1544
00:46:59,280 --> 00:47:00,800
and so you can map all this prep that

1545
00:47:00,800 --> 00:47:03,280
i've talked about

1546
00:47:03,280 --> 00:47:06,400
uh into or from miter tax matrix and go

1547
00:47:06,400 --> 00:47:08,720
print a big 36 by 48 laminate it make

1548
00:47:08,720 --> 00:47:09,599
five of them

1549
00:47:09,599 --> 00:47:10,720
place it up on the wall and start

1550
00:47:10,720 --> 00:47:12,640
highlighting and start doing notes and

1551
00:47:12,640 --> 00:47:15,280
be surprised how many things logging

1552
00:47:15,280 --> 00:47:18,079
will cover about 60 plus percent of the

1553
00:47:18,079 --> 00:47:18,960
miter attack

1554
00:47:18,960 --> 00:47:21,440
matrix uh we have two cheat sheets on on

1555
00:47:21,440 --> 00:47:22,559
malware archaeology

1556
00:47:22,559 --> 00:47:24,079
where we went through this exercise i

1557
00:47:24,079 --> 00:47:26,079
was shocked at the coverage i got with

1558
00:47:26,079 --> 00:47:27,599
logging

1559
00:47:27,599 --> 00:47:29,440
and make your red team definitely map

1560
00:47:29,440 --> 00:47:30,720
all their attacks to minor attacks so

1561
00:47:30,720 --> 00:47:31,119
they don't

1562
00:47:31,119 --> 00:47:32,559
tell you exactly what they use the

1563
00:47:32,559 --> 00:47:34,319
command lines that they did but that

1564
00:47:34,319 --> 00:47:35,920
allows you to research it and say well

1565
00:47:35,920 --> 00:47:37,359
they say they use this this

1566
00:47:37,359 --> 00:47:38,800
technique so let's go research that

1567
00:47:38,800 --> 00:47:40,720
technique and how can i detect that

1568
00:47:40,720 --> 00:47:42,000
technique within the tool sets

1569
00:47:42,000 --> 00:47:45,440
i have again it gives you all the

1570
00:47:45,440 --> 00:47:46,800
tactics and techniques now

1571
00:47:46,800 --> 00:47:48,720
sub techniques that you can map your

1572
00:47:48,720 --> 00:47:50,720
defenses to which means potentially

1573
00:47:50,720 --> 00:47:51,280
alert

1574
00:47:51,280 --> 00:47:53,680
potentially understand your gaps and

1575
00:47:53,680 --> 00:47:55,359
then of course if you identify gaps you

1576
00:47:55,359 --> 00:47:57,040
can identify items for budget

1577
00:47:57,040 --> 00:47:58,640
and again you can speak a common

1578
00:47:58,640 --> 00:48:00,559
language fighter attack but management

1579
00:48:00,559 --> 00:48:01,599
they don't have to know the

1580
00:48:01,599 --> 00:48:03,359
the tidbits of exactly what command the

1581
00:48:03,359 --> 00:48:04,640
red team executed

1582
00:48:04,640 --> 00:48:06,640
or what whitley gidgets you're you're

1583
00:48:06,640 --> 00:48:08,480
doing for your defenses they just need

1584
00:48:08,480 --> 00:48:09,440
to know these 12

1585
00:48:09,440 --> 00:48:11,040
technique ids are heavily exploited and

1586
00:48:11,040 --> 00:48:12,640
we have no defenses for it here's a

1587
00:48:12,640 --> 00:48:13,359
solution

1588
00:48:13,359 --> 00:48:15,680
or solutions that will help us reduce

1589
00:48:15,680 --> 00:48:16,880
our vector

1590
00:48:16,880 --> 00:48:18,640
and again what do your current defenses

1591
00:48:18,640 --> 00:48:20,319
map to do that it's part of the

1592
00:48:20,319 --> 00:48:22,000
preparation again this is all free you

1593
00:48:22,000 --> 00:48:23,440
don't have to buy anything

1594
00:48:23,440 --> 00:48:26,400
prepare means you don't prepare means

1595
00:48:26,400 --> 00:48:27,520
you know what you

1596
00:48:27,520 --> 00:48:30,960
can or cannot do have or do not have

1597
00:48:30,960 --> 00:48:34,160
maybe i should use your voice what can

1598
00:48:34,160 --> 00:48:35,280
you do what

1599
00:48:35,280 --> 00:48:37,520
can you do not what anyway i'm going to

1600
00:48:37,520 --> 00:48:39,520
trash that one but you get the point

1601
00:48:39,520 --> 00:48:42,720
so conclusion ir it's hard

1602
00:48:42,720 --> 00:48:44,160
you have to whine when you say the title

1603
00:48:44,160 --> 00:48:46,400
of this talk but it doesn't have to be

1604
00:48:46,400 --> 00:48:47,119
preparation

1605
00:48:47,119 --> 00:48:49,599
is key security 101 gave you lots of

1606
00:48:49,599 --> 00:48:51,040
things to to work on

1607
00:48:51,040 --> 00:48:54,000
i can tell you that every engagement

1608
00:48:54,000 --> 00:48:54,640
i've worked on

1609
00:48:54,640 --> 00:48:56,960
outside consulting within consulting

1610
00:48:56,960 --> 00:48:59,200
acquisitions new companies

1611
00:48:59,200 --> 00:49:01,359
these are without a doubt your top

1612
00:49:01,359 --> 00:49:03,200
10-ish kind of areas where

1613
00:49:03,200 --> 00:49:05,520
if these are addressed you are so far

1614
00:49:05,520 --> 00:49:08,160
ahead of most people

1615
00:49:08,160 --> 00:49:10,800
enable the logs everywhere figure out

1616
00:49:10,800 --> 00:49:12,319
how long they're going to collect for

1617
00:49:12,319 --> 00:49:14,160
increase the size of that collection to

1618
00:49:14,160 --> 00:49:16,079
the window that you need to react to

1619
00:49:16,079 --> 00:49:17,839
these attacks when you can detect them

1620
00:49:17,839 --> 00:49:19,200
well it took me three months to detect

1621
00:49:19,200 --> 00:49:20,960
the attack yeah you're probably screwed

1622
00:49:20,960 --> 00:49:22,240
you got to improve that

1623
00:49:22,240 --> 00:49:23,920
right so that whole dwell time is is

1624
00:49:23,920 --> 00:49:25,359
definitely a different challenge and a

1625
00:49:25,359 --> 00:49:26,800
different talk which somebody may be

1626
00:49:26,800 --> 00:49:28,240
doing today

1627
00:49:28,240 --> 00:49:29,839
disable the users double-click as

1628
00:49:29,839 --> 00:49:32,079
another option to try to prevent users

1629
00:49:32,079 --> 00:49:34,079
from getting those file types block

1630
00:49:34,079 --> 00:49:36,319
those known file types even better yet

1631
00:49:36,319 --> 00:49:38,640
look at unknown domains or the unknown

1632
00:49:38,640 --> 00:49:40,960
category the uncategorized sites

1633
00:49:40,960 --> 00:49:43,440
and prepare to block them and you know

1634
00:49:43,440 --> 00:49:44,640
they are well known all the proxy

1635
00:49:44,640 --> 00:49:45,440
vendors you can

1636
00:49:45,440 --> 00:49:47,040
you can fortinet's got a website you can

1637
00:49:47,040 --> 00:49:48,480
go up there and look them up who is and

1638
00:49:48,480 --> 00:49:49,839
will tell you the category of

1639
00:49:49,839 --> 00:49:52,400
the urls uh enable the endpoint firewall

1640
00:49:52,400 --> 00:49:53,920
please please please please please along

1641
00:49:53,920 --> 00:49:55,680
with that local admin passwords on all

1642
00:49:55,680 --> 00:49:56,800
endpoints should be rotated with

1643
00:49:56,800 --> 00:49:58,000
something like laps

1644
00:49:58,000 --> 00:50:01,359
or some sort of process for your nix and

1645
00:50:01,359 --> 00:50:02,640
apple environments to make sure the

1646
00:50:02,640 --> 00:50:04,240
passwords are different so that when you

1647
00:50:04,240 --> 00:50:05,040
get into one

1648
00:50:05,040 --> 00:50:07,280
i can't get into all again reduction

1649
00:50:07,280 --> 00:50:08,240
reduction reduction

1650
00:50:08,240 --> 00:50:10,160
enable something to allow you to hunt

1651
00:50:10,160 --> 00:50:12,160
figure out what you can use to hunt

1652
00:50:12,160 --> 00:50:13,599
even if it's remedial and you can only

1653
00:50:13,599 --> 00:50:15,280
look for 10 things

1654
00:50:15,280 --> 00:50:16,960
there are 10 things i can tell you otter

1655
00:50:16,960 --> 00:50:19,040
runs right i p addresses running

1656
00:50:19,040 --> 00:50:20,880
processes

1657
00:50:20,880 --> 00:50:22,480
all these things are things that log md

1658
00:50:22,480 --> 00:50:24,000
can do things that some of the system

1659
00:50:24,000 --> 00:50:25,280
journals can do

1660
00:50:25,280 --> 00:50:26,960
using arthur it's free it's powershell

1661
00:50:26,960 --> 00:50:28,400
enable winrm in your environment

1662
00:50:28,400 --> 00:50:29,839
configure it so it works from a couple

1663
00:50:29,839 --> 00:50:31,119
machines lock it down with the windows

1664
00:50:31,119 --> 00:50:31,760
firewall

1665
00:50:31,760 --> 00:50:32,960
that's another thing you'll need to do

1666
00:50:32,960 --> 00:50:34,319
to secure winter image is the windows

1667
00:50:34,319 --> 00:50:35,200
firewall

1668
00:50:35,200 --> 00:50:36,559
and then map what you have to miter

1669
00:50:36,559 --> 00:50:38,720
attack a lot of this is free you already

1670
00:50:38,720 --> 00:50:40,400
have it

1671
00:50:40,400 --> 00:50:42,079
and you won't be a sad panda if you do

1672
00:50:42,079 --> 00:50:44,480
this so here's some resources

1673
00:50:44,480 --> 00:50:46,880
log md.com the tool arthur free on

1674
00:50:46,880 --> 00:50:48,319
github windows logging cheat sheets at

1675
00:50:48,319 --> 00:50:50,079
my archaeology this presentation will be

1676
00:50:50,079 --> 00:50:50,880
made available

1677
00:50:50,880 --> 00:50:52,480
or already is from a previous version

1678
00:50:52,480 --> 00:50:54,720
but i'll update it on maura archaeology

1679
00:50:54,720 --> 00:50:56,400
through a link through

1680
00:50:56,400 --> 00:50:58,800
slideshare or through the logind website

1681
00:50:58,800 --> 00:50:59,839
either one with that

1682
00:50:59,839 --> 00:51:03,040
questions far away

1683
00:51:04,000 --> 00:51:07,280
i am watching the i am watching the

1684
00:51:07,280 --> 00:51:08,720
channel the discord channel

1685
00:51:08,720 --> 00:51:13,919
so you got some questions let me have

1686
00:51:20,839 --> 00:51:23,839
them

1687
00:51:39,520 --> 00:51:41,599
i think i have a soundtrack for applause

1688
00:51:41,599 --> 00:51:44,800
can i insert that here

1689
00:51:47,920 --> 00:51:51,839
see if i can find one

1690
00:52:06,400 --> 00:52:08,400
there you go okay so you can hear that

1691
00:52:08,400 --> 00:52:11,119
through the microphone

1692
00:52:15,839 --> 00:52:17,680
what is your favorite windows log

1693
00:52:17,680 --> 00:52:19,520
shipper

1694
00:52:19,520 --> 00:52:22,319
i'm assuming to send to some sort of sim

1695
00:52:22,319 --> 00:52:22,720
uh

1696
00:52:22,720 --> 00:52:24,559
for the most part the win log beat yes

1697
00:52:24,559 --> 00:52:26,160
is the answer to that win log beat and

1698
00:52:26,160 --> 00:52:26,880
file log b

1699
00:52:26,880 --> 00:52:29,040
are very configurable i do like nx log

1700
00:52:29,040 --> 00:52:30,880
because you can do both but your sim has

1701
00:52:30,880 --> 00:52:32,559
to support nx log

1702
00:52:32,559 --> 00:52:35,040
i have one agent set a two um so that

1703
00:52:35,040 --> 00:52:36,160
works really well

1704
00:52:36,160 --> 00:52:39,040
most log providers have their own so of

1705
00:52:39,040 --> 00:52:39,520
course

1706
00:52:39,520 --> 00:52:41,359
follows malware i'll talk about that one

1707
00:52:41,359 --> 00:52:43,520
uh so they are easy to use there are

1708
00:52:43,520 --> 00:52:44,480
configurations on

1709
00:52:44,480 --> 00:52:46,000
malware archaeology as well for those

1710
00:52:46,000 --> 00:52:47,760
they work with humeo they work with elk

1711
00:52:47,760 --> 00:52:50,400
several other providers nx log can be

1712
00:52:50,400 --> 00:52:52,160
made to work with several as well

1713
00:52:52,160 --> 00:52:53,839
they they have a community version with

1714
00:52:53,839 --> 00:52:55,680
nx log but really you want the

1715
00:52:55,680 --> 00:52:59,040
paid version any of the log

1716
00:52:59,040 --> 00:53:01,920
log shippers or log agents really need

1717
00:53:01,920 --> 00:53:02,800
to have a way

1718
00:53:02,800 --> 00:53:04,559
you can update the configuration so if

1719
00:53:04,559 --> 00:53:06,000
you've got filebeater win log beat

1720
00:53:06,000 --> 00:53:07,599
i need to be able to push a config out

1721
00:53:07,599 --> 00:53:10,000
to all the items to turn off an item or

1722
00:53:10,000 --> 00:53:10,880
turn on item

1723
00:53:10,880 --> 00:53:13,280
collect another item splunk's universal

1724
00:53:13,280 --> 00:53:15,040
forwarder has that built in gray log has

1725
00:53:15,040 --> 00:53:16,160
that built in

1726
00:53:16,160 --> 00:53:18,640
so um it really depends on what solution

1727
00:53:18,640 --> 00:53:20,079
you're using but that is a number one

1728
00:53:20,079 --> 00:53:22,400
requirement a way to update your

1729
00:53:22,400 --> 00:53:25,440
endpoints logging agent config

1730
00:53:25,440 --> 00:53:26,800
so um you'll have to do that with

1731
00:53:26,800 --> 00:53:28,319
configuration management your big fix or

1732
00:53:28,319 --> 00:53:30,480
ssm scripts or however you want to do it

1733
00:53:30,480 --> 00:53:32,480
follow some malware so filezmower is

1734
00:53:32,480 --> 00:53:34,559
interesting there's no such thing as

1735
00:53:34,559 --> 00:53:36,079
files power listen to our podcast we

1736
00:53:36,079 --> 00:53:38,000
just talked about tyler hudak and and

1737
00:53:38,000 --> 00:53:39,440
martin and i and brian talked about

1738
00:53:39,440 --> 00:53:40,800
fireless malware

1739
00:53:40,800 --> 00:53:44,400
so uh false malware is

1740
00:53:44,400 --> 00:53:47,599
now more so going into process only

1741
00:53:47,599 --> 00:53:50,559
injection area space that's what my talk

1742
00:53:50,559 --> 00:53:52,400
that i'm gonna do at sandsdefer and the

1743
00:53:52,400 --> 00:53:53,920
talk we did and talked about on the

1744
00:53:53,920 --> 00:53:55,040
podcast

1745
00:53:55,040 --> 00:53:58,160
so uh they will write a lot of drydex

1746
00:53:58,160 --> 00:54:00,880
great example rights on shutdown of the

1747
00:54:00,880 --> 00:54:02,319
system so when you're looking on the box

1748
00:54:02,319 --> 00:54:03,440
say i'm going to go look for other auto

1749
00:54:03,440 --> 00:54:04,880
runs you won't find anything

1750
00:54:04,880 --> 00:54:06,400
but if you turn on file and registry

1751
00:54:06,400 --> 00:54:07,760
audit need to look at the obvious

1752
00:54:07,760 --> 00:54:09,760
locations of c users in the

1753
00:54:09,760 --> 00:54:11,839
and several well-known run keys when the

1754
00:54:11,839 --> 00:54:13,599
system reboots you'll see the file right

1755
00:54:13,599 --> 00:54:14,240
to disk

1756
00:54:14,240 --> 00:54:16,319
on shutdown write the registry key when

1757
00:54:16,319 --> 00:54:18,000
it reboots it reads it

1758
00:54:18,000 --> 00:54:21,520
and then and then we'll delete the

1759
00:54:21,520 --> 00:54:23,440
payloads once it loads up and so while

1760
00:54:23,440 --> 00:54:25,280
the system's live you can't see anything

1761
00:54:25,280 --> 00:54:27,440
so looking at process injection running

1762
00:54:27,440 --> 00:54:29,680
processes and dlls our big thing to look

1763
00:54:29,680 --> 00:54:30,960
for with files malware

1764
00:54:30,960 --> 00:54:32,720
and it does reside somewhere it resides

1765
00:54:32,720 --> 00:54:34,319
in it resides in a registry resides in

1766
00:54:34,319 --> 00:54:35,119
wmi

1767
00:54:35,119 --> 00:54:38,400
powershell compile on the fly etc

1768
00:54:38,400 --> 00:54:40,400
so that's my take on there and the

1769
00:54:40,400 --> 00:54:41,680
podcast is the

1770
00:54:41,680 --> 00:54:43,839
incident response podcast found on all

1771
00:54:43,839 --> 00:54:45,440
your favorite providers

1772
00:54:45,440 --> 00:54:46,640
and yes the slides will be made

1773
00:54:46,640 --> 00:54:50,559
available i will post them on slideshare

1774
00:54:50,559 --> 00:54:53,040
mao archaeology or log dash md is where

1775
00:54:53,040 --> 00:54:54,559
you can download them from or get a link

1776
00:54:54,559 --> 00:54:55,680
to download them from

1777
00:54:55,680 --> 00:54:57,760
i'll make them available to uh besides

1778
00:54:57,760 --> 00:55:00,720
as well pdf

1779
00:55:00,720 --> 00:55:02,000
if they want me to post them right to

1780
00:55:02,000 --> 00:55:06,880
this channel i guess i can do that too

1781
00:55:06,880 --> 00:55:10,079
any other questions

1782
00:55:11,359 --> 00:55:13,040
come on throw them at me i don't think

1783
00:55:13,040 --> 00:55:14,720
you have any more slides

1784
00:55:14,720 --> 00:55:19,280
nope ask away

1785
00:55:19,280 --> 00:55:21,119
glad you like the prezzo so we're here

1786
00:55:21,119 --> 00:55:22,880
for education right i need to replicate

1787
00:55:22,880 --> 00:55:24,559
i need to have 10 of 10 of me

1788
00:55:24,559 --> 00:55:26,160
i need all you to become me so i can

1789
00:55:26,160 --> 00:55:27,920
retire and know that the place is better

1790
00:55:27,920 --> 00:55:28,720
off than i

1791
00:55:28,720 --> 00:55:30,960
found it because there wasn't much

1792
00:55:30,960 --> 00:55:32,839
security when i got involved in this

1793
00:55:32,839 --> 00:55:35,839
industry

1794
00:55:41,760 --> 00:55:43,200
five more minutes till the next talk

1795
00:55:43,200 --> 00:55:46,079
starts so i'll hang out

1796
00:55:46,079 --> 00:55:50,559
i'll be popping in and out of the chat

1797
00:55:51,440 --> 00:55:52,880
so post your questions i'll try to get

1798
00:55:52,880 --> 00:55:54,960
back to you if you have any

1799
00:55:54,960 --> 00:55:56,960
what is the best practice to review long

1800
00:55:56,960 --> 00:55:59,040
logging is it better just to look

1801
00:55:59,040 --> 00:56:01,839
for events considered high risk you're

1802
00:56:01,839 --> 00:56:03,280
going to have to define what high risk

1803
00:56:03,280 --> 00:56:04,640
is but i'm going to say minor attack

1804
00:56:04,640 --> 00:56:05,760
should be the way

1805
00:56:05,760 --> 00:56:09,599
you define which what you look at so

1806
00:56:09,599 --> 00:56:11,359
it covers all operating systems in

1807
00:56:11,359 --> 00:56:14,400
application space and network so

1808
00:56:14,400 --> 00:56:16,559
i would say what generally you know make

1809
00:56:16,559 --> 00:56:18,000
sure you have alerts or you look for

1810
00:56:18,000 --> 00:56:19,839
things that are well known like i talk

1811
00:56:19,839 --> 00:56:22,000
about right in windows environment

1812
00:56:22,000 --> 00:56:24,720
90 plus percent 95 probably even 98

1813
00:56:24,720 --> 00:56:25,359
starts

1814
00:56:25,359 --> 00:56:27,920
and see users and goes from there a user

1815
00:56:27,920 --> 00:56:29,280
will click on something

1816
00:56:29,280 --> 00:56:31,680
and boom it uses user space and then

1817
00:56:31,680 --> 00:56:33,920
moves outside that later

1818
00:56:33,920 --> 00:56:36,640
so yes high risk items low bins

1819
00:56:36,640 --> 00:56:37,839
understand what's running there

1820
00:56:37,839 --> 00:56:39,280
low bins are being heavily exploited

1821
00:56:39,280 --> 00:56:41,359
nowadays because it gets by all the

1822
00:56:41,359 --> 00:56:45,839
application white listing scenarios

1823
00:56:46,160 --> 00:56:51,520
uh videos available thanks ranger mike

1824
00:56:51,520 --> 00:56:53,680
there's also a question here do you have

1825
00:56:53,680 --> 00:56:56,079
any books coming out

1826
00:56:56,079 --> 00:56:58,400
i'm thinking about it but no not

1827
00:56:58,400 --> 00:56:59,280
currently

1828
00:56:59,280 --> 00:57:01,599
um it takes time to write a book i've

1829
00:57:01,599 --> 00:57:02,960
written a couple i wrote the first book

1830
00:57:02,960 --> 00:57:04,400
on skype when skype was

1831
00:57:04,400 --> 00:57:06,799
not even at video yet and i wrote one

1832
00:57:06,799 --> 00:57:08,400
after that on video conferencing to do

1833
00:57:08,400 --> 00:57:09,680
personal video conferencing there's a

1834
00:57:09,680 --> 00:57:11,280
long story over a beer we can have about

1835
00:57:11,280 --> 00:57:13,040
why i wrote those books

1836
00:57:13,040 --> 00:57:17,440
but uh i'm you know considering it

1837
00:57:17,440 --> 00:57:19,040
self-publish in case you're wondering i

1838
00:57:19,040 --> 00:57:21,119
will not be signing a dummy contract

1839
00:57:21,119 --> 00:57:23,280
after those first two

1840
00:57:23,280 --> 00:57:25,280
but i have to say to skype book made me

1841
00:57:25,280 --> 00:57:27,599
some change that was a good first dummy

1842
00:57:27,599 --> 00:57:29,920
contract

1843
00:57:29,920 --> 00:57:31,200
great experience from that perspective

1844
00:57:31,200 --> 00:57:41,839
at least i know how to write a book

1845
00:58:12,160 --> 00:58:14,240
you

