1
00:00:02,300 --> 00:00:07,798
get the clock up<font color="#E5E5E5"> if you haven't seen</font>

2
00:00:06,120 --> 00:00:10,260
flicky<font color="#CCCCCC"> oh it's kind of cool here's your</font>

3
00:00:07,799 --> 00:00:13,110
little clock<font color="#E5E5E5"> stays doesn't lock the</font>

4
00:00:10,260 --> 00:00:15,050
screen<font color="#CCCCCC"> taken no time it is hello San</font>

5
00:00:13,110 --> 00:00:16,820
Antonio

6
00:00:15,050 --> 00:00:21,470
[Applause]

7
00:00:16,820 --> 00:00:21,470
we were louder in Austin just<font color="#E5E5E5"> saying it</font>

8
00:00:21,529 --> 00:00:27,119
it's nice to be back<font color="#E5E5E5"> I wasn't not here</font>

9
00:00:24,720 --> 00:00:28,590
<font color="#E5E5E5">last year conflict</font><font color="#CCCCCC"> Kahn whatever the</font>

10
00:00:27,119 --> 00:00:30,359
heck that<font color="#CCCCCC"> where's that but it's nice to</font>

11
00:00:28,590 --> 00:00:32,009
<font color="#E5E5E5">be back here again at San Antonio it's</font>

12
00:00:30,359 --> 00:00:33,840
<font color="#E5E5E5">nice to see this move on from</font><font color="#CCCCCC"> Cindy</font>

13
00:00:32,009 --> 00:00:36,750
<font color="#CCCCCC">myself and the other</font><font color="#E5E5E5"> people that used</font><font color="#CCCCCC"> to</font>

14
00:00:33,840 --> 00:00:38,160
run the besides Texas stuff so<font color="#CCCCCC"> it's nice</font>

15
00:00:36,750 --> 00:00:41,370
I have time<font color="#E5E5E5"> to do more stuff</font><font color="#CCCCCC"> like</font>

16
00:00:38,160 --> 00:00:43,260
interesting<font color="#E5E5E5"> PowerShell research and</font>

17
00:00:41,370 --> 00:00:44,760
write a tool called<font color="#CCCCCC"> log Andy we're gonna</font>

18
00:00:43,260 --> 00:00:47,339
<font color="#E5E5E5">talk a little bit about that but mostly</font>

19
00:00:44,760 --> 00:00:49,079
this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> about PowerShell detection</font><font color="#E5E5E5"> how</font>

20
00:00:47,340 --> 00:00:50,579
many people here know<font color="#E5E5E5"> what</font><font color="#CCCCCC"> version of</font>

21
00:00:49,079 --> 00:00:55,949
PowerShell is running in their

22
00:00:50,579 --> 00:00:58,770
infrastructure<font color="#CCCCCC"> oh wow really</font><font color="#E5E5E5"> nobody then</font>

23
00:00:55,949 --> 00:01:01,468
you're really<font color="#E5E5E5"> gonna like this talk</font><font color="#CCCCCC"> or</font>

24
00:00:58,770 --> 00:01:03,930
how<font color="#CCCCCC"> about your own PC</font><font color="#E5E5E5"> except for Fred on</font>

25
00:01:01,469 --> 00:01:06,619
a Mac well you<font color="#E5E5E5"> power</font><font color="#CCCCCC"> show</font><font color="#E5E5E5"> that runs on a</font>

26
00:01:03,930 --> 00:01:08,850
Mac so<font color="#CCCCCC"> he couldn't even</font><font color="#E5E5E5"> do it</font><font color="#CCCCCC"> America</font><font color="#E5E5E5"> so</font>

27
00:01:06,619 --> 00:01:10,409
that's that's the point I'm trying to

28
00:01:08,850 --> 00:01:12,869
make here is<font color="#E5E5E5"> the fact that you don't</font>

29
00:01:10,409 --> 00:01:16,350
know is kind<font color="#E5E5E5"> of a big gap</font><font color="#CCCCCC"> I would call</font>

30
00:01:12,869 --> 00:01:20,460
this talk or this exploitation<font color="#E5E5E5"> or this</font>

31
00:01:16,350 --> 00:01:22,559
risk or this vulnerability<font color="#CCCCCC"> wait</font>

32
00:01:20,460 --> 00:01:24,279
<font color="#E5E5E5">windows's of vulnerability so just</font>

33
00:01:22,560 --> 00:01:27,460
<font color="#CCCCCC">Windows in general</font>

34
00:01:24,280 --> 00:01:29,080
this is probably<font color="#CCCCCC"> the number one concern</font>

35
00:01:27,460 --> 00:01:31,419
you<font color="#E5E5E5"> have in your environment</font><font color="#CCCCCC"> right now</font>

36
00:01:29,080 --> 00:01:33,490
if you have how many<font color="#E5E5E5"> people</font><font color="#CCCCCC"> here paid or</font>

37
00:01:31,420 --> 00:01:34,630
gotten<font color="#E5E5E5"> pen test servicing red team</font>

38
00:01:33,490 --> 00:01:36,610
servicing done<font color="#E5E5E5"> it all</font><font color="#CCCCCC"> in their</font>

39
00:01:34,630 --> 00:01:38,170
organization<font color="#E5E5E5"> whether you admit it or not</font>

40
00:01:36,610 --> 00:01:39,190
maybe that's part of the problem<font color="#CCCCCC"> too</font>

41
00:01:38,170 --> 00:01:41,590
many government people<font color="#E5E5E5"> won't raise</font><font color="#CCCCCC"> their</font>

42
00:01:39,190 --> 00:01:44,520
<font color="#E5E5E5">hands dang it so the red teamers love</font>

43
00:01:41,590 --> 00:01:46,810
<font color="#E5E5E5">power show the bad guys love power show</font>

44
00:01:44,520 --> 00:01:49,210
so<font color="#E5E5E5"> that's what this talks all about is</font>

45
00:01:46,810 --> 00:01:52,060
how<font color="#CCCCCC"> can you detect things like power</font>

46
00:01:49,210 --> 00:01:53,830
shell exploitation<font color="#E5E5E5"> so Who am I I am a</font>

47
00:01:52,060 --> 00:01:56,110
blue team defender ninja<font color="#E5E5E5"> malware</font>

48
00:01:53,830 --> 00:02:01,300
<font color="#CCCCCC">archeologists I'm a logger</font><font color="#E5E5E5"> holic hello</font>

49
00:01:56,110 --> 00:02:03,220
my name<font color="#CCCCCC"> is Michael I'm a logger</font><font color="#E5E5E5"> holic</font><font color="#CCCCCC"> ok</font>

50
00:02:01,300 --> 00:02:06,009
<font color="#E5E5E5">got to make sure you</font><font color="#CCCCCC"> stay</font><font color="#E5E5E5"> wakes the end</font>

51
00:02:03,220 --> 00:02:07,750
of the day so<font color="#E5E5E5"> that's the way with I love</font>

52
00:02:06,009 --> 00:02:09,340
properly<font color="#CCCCCC"> configured logs because</font><font color="#E5E5E5"> they</font>

53
00:02:07,750 --> 00:02:11,980
tell us who what where when and

54
00:02:09,340 --> 00:02:14,319
hopefully how what happened to your

55
00:02:11,980 --> 00:02:16,780
system<font color="#CCCCCC"> ok</font><font color="#E5E5E5"> and it's really powerful</font>

56
00:02:14,319 --> 00:02:18,850
but unfortunately<font color="#E5E5E5"> windows in this case</font>

57
00:02:16,780 --> 00:02:21,340
by default<font color="#E5E5E5"> sucks</font>

58
00:02:18,850 --> 00:02:23,230
<font color="#E5E5E5">by default</font><font color="#CCCCCC"> Microsoft does not enable</font>

59
00:02:21,340 --> 00:02:26,110
<font color="#E5E5E5">PowerShell logging with a very small</font>

60
00:02:23,230 --> 00:02:27,220
exception<font color="#E5E5E5"> I'm also the creator of some</font>

61
00:02:26,110 --> 00:02:28,600
cheat sheets how many people here<font color="#CCCCCC"> have</font>

62
00:02:27,220 --> 00:02:32,290
heard of<font color="#E5E5E5"> the</font><font color="#CCCCCC"> Windows logging cheat</font><font color="#E5E5E5"> sheet</font>

63
00:02:28,600 --> 00:02:34,930
series fair amount so one<font color="#CCCCCC"> of them is the</font>

64
00:02:32,290 --> 00:02:36,730
power show<font color="#CCCCCC"> Windows PowerShell</font><font color="#E5E5E5"> logging</font>

65
00:02:34,930 --> 00:02:38,680
cheat sheet if you're not familiar with

66
00:02:36,730 --> 00:02:40,540
<font color="#CCCCCC">that you really should be after</font><font color="#E5E5E5"> this</font>

67
00:02:38,680 --> 00:02:43,510
talk but it is a series of<font color="#E5E5E5"> these things</font>

68
00:02:40,540 --> 00:02:45,160
together<font color="#CCCCCC"> I also give examples in a spunk</font>

69
00:02:43,510 --> 00:02:46,690
logging cheat sheet and<font color="#E5E5E5"> we just</font><font color="#CCCCCC"> added</font>

70
00:02:45,160 --> 00:02:47,829
our<font color="#E5E5E5"> seventh with the who me</font><font color="#CCCCCC"> Oh logging</font>

71
00:02:46,690 --> 00:02:49,840
cheat sheet whom you know probably

72
00:02:47,829 --> 00:02:52,299
<font color="#E5E5E5">nobody in this room sort of but it is</font><font color="#CCCCCC"> a</font>

73
00:02:49,840 --> 00:02:53,980
competitor<font color="#CCCCCC"> Splunk fairly new</font><font color="#E5E5E5"> really good</font>

74
00:02:52,299 --> 00:02:55,299
solution<font color="#E5E5E5"> and for all of you that want to</font>

75
00:02:53,980 --> 00:02:56,980
log your<font color="#E5E5E5"> stuff at home and learn how to</font>

76
00:02:55,299 --> 00:02:58,900
do<font color="#E5E5E5"> better logging they have a free</font>

77
00:02:56,980 --> 00:03:01,238
solution<font color="#CCCCCC"> that hold 2 terabytes for a</font>

78
00:02:58,900 --> 00:03:03,160
week<font color="#E5E5E5"> you can do</font><font color="#CCCCCC"> 5</font><font color="#E5E5E5"> systems in your home</font>

79
00:03:01,239 --> 00:03:05,140
with all<font color="#E5E5E5"> these cheat sheet things</font>

80
00:03:03,160 --> 00:03:06,880
enabled<font color="#E5E5E5"> there's a whole bunch of queries</font>

81
00:03:05,140 --> 00:03:09,390
I've created for<font color="#CCCCCC"> you and you can monitor</font>

82
00:03:06,880 --> 00:03:11,850
<font color="#CCCCCC">your</font><font color="#E5E5E5"> home fully turned on it's awesome</font>

83
00:03:09,390 --> 00:03:14,858
<font color="#E5E5E5">and it's free did I mention it's free</font>

84
00:03:11,850 --> 00:03:16,209
<font color="#CCCCCC">did I say</font><font color="#E5E5E5"> it was free and then they have</font>

85
00:03:14,859 --> 00:03:19,570
<font color="#E5E5E5">obviously paid</font><font color="#CCCCCC"> solutions as well but</font>

86
00:03:16,209 --> 00:03:21,400
kudos to<font color="#E5E5E5"> them I'm also the</font><font color="#CCCCCC"> co-creator of</font>

87
00:03:19,570 --> 00:03:23,650
this you know billboard I'm wearing

88
00:03:21,400 --> 00:03:24,730
called<font color="#CCCCCC"> log indie</font><font color="#E5E5E5"> we'll talk a little</font><font color="#CCCCCC"> bit</font>

89
00:03:23,650 --> 00:03:27,130
<font color="#CCCCCC">about that in the course</font><font color="#E5E5E5"> of the</font>

90
00:03:24,730 --> 00:03:28,899
<font color="#E5E5E5">presentation but focusing on that I'm</font>

91
00:03:27,130 --> 00:03:30,760
also<font color="#E5E5E5"> the</font><font color="#CCCCCC"> co-host of breaking down</font>

92
00:03:28,900 --> 00:03:32,590
<font color="#CCCCCC">Incident Response</font><font color="#E5E5E5"> anybody watched</font>

93
00:03:30,760 --> 00:03:36,630
breaking<font color="#CCCCCC"> down</font><font color="#E5E5E5"> secure watch listen to</font>

94
00:03:32,590 --> 00:03:38,670
breaking down security podcast or or<font color="#E5E5E5"> PDR</font>

95
00:03:36,630 --> 00:03:41,010
people don't be there<font color="#E5E5E5"> so we did this</font>

96
00:03:38,670 --> 00:03:43,230
podcast solely to<font color="#E5E5E5"> help share this kind</font>

97
00:03:41,010 --> 00:03:46,500
<font color="#E5E5E5">of information with</font><font color="#CCCCCC"> the public</font><font color="#E5E5E5"> because</font>

98
00:03:43,230 --> 00:03:48,720
<font color="#E5E5E5">we really lack things I can take back to</font>

99
00:03:46,500 --> 00:03:50,550
<font color="#CCCCCC">work and do when I listen to podcast</font>

100
00:03:48,720 --> 00:03:52,260
<font color="#E5E5E5">that's what I want when I go to talks</font>

101
00:03:50,550 --> 00:03:54,060
when I go to trainings when I go when I

102
00:03:52,260 --> 00:03:55,620
listen to<font color="#E5E5E5"> things</font><font color="#CCCCCC"> I want to be able to</font>

103
00:03:54,060 --> 00:03:59,010
take this<font color="#E5E5E5"> back hey</font><font color="#CCCCCC"> deaf card is a great</font>

104
00:03:55,620 --> 00:04:00,960
con can you do 80%<font color="#E5E5E5"> of what</font><font color="#CCCCCC"> you listen to</font>

105
00:03:59,010 --> 00:04:02,790
<font color="#E5E5E5">back at work the</font><font color="#CCCCCC"> thing that pays our</font>

106
00:04:00,960 --> 00:04:05,030
checks<font color="#E5E5E5"> and that's what we're trying</font><font color="#CCCCCC"> to</font>

107
00:04:02,790 --> 00:04:07,620
<font color="#E5E5E5">focus on is</font><font color="#CCCCCC"> things you</font><font color="#E5E5E5"> can actually do</font>

108
00:04:05,030 --> 00:04:08,760
and we did release<font color="#CCCCCC"> a</font><font color="#E5E5E5"> subversion to hear</font>

109
00:04:07,620 --> 00:04:11,460
a little<font color="#E5E5E5"> bit back we're about to release</font>

110
00:04:08,760 --> 00:04:12,810
version 2.1<font color="#E5E5E5"> and you'll see a sneak peek</font>

111
00:04:11,460 --> 00:04:14,400
of<font color="#CCCCCC"> that in the course of the</font><font color="#E5E5E5"> president</font>

112
00:04:12,810 --> 00:04:17,339
so what's a challenge

113
00:04:14,400 --> 00:04:21,030
malware loves<font color="#CCCCCC"> PowerShell</font><font color="#E5E5E5"> and mainly</font><font color="#CCCCCC"> to</font>

114
00:04:17,339 --> 00:04:22,880
download the payloads<font color="#CCCCCC"> it kind</font><font color="#E5E5E5"> of changed</font>

115
00:04:21,029 --> 00:04:26,070
dramatically about a year<font color="#E5E5E5"> and a half ago</font>

116
00:04:22,880 --> 00:04:28,140
<font color="#CCCCCC">we hardly saw PowerShell used and then</font>

117
00:04:26,070 --> 00:04:30,630
all of a<font color="#CCCCCC"> sudden everything now is</font>

118
00:04:28,140 --> 00:04:32,610
PowerShell<font color="#CCCCCC"> a matter of</font><font color="#E5E5E5"> fact it's rare I</font>

119
00:04:30,630 --> 00:04:35,670
don't see malware using PowerShell to

120
00:04:32,610 --> 00:04:37,080
<font color="#E5E5E5">pull stuff down why the bad guys can</font>

121
00:04:35,670 --> 00:04:38,580
write less code because they're gonna

122
00:04:37,080 --> 00:04:40,109
use what's<font color="#E5E5E5"> already living</font><font color="#CCCCCC"> off the land</font>

123
00:04:38,580 --> 00:04:42,240
they're gonna use PowerShell<font color="#E5E5E5"> it's or in</font>

124
00:04:40,110 --> 00:04:44,370
the<font color="#CCCCCC"> Box to make calls</font><font color="#E5E5E5"> to go get their</font>

125
00:04:42,240 --> 00:04:45,960
<font color="#E5E5E5">dropper to execute their dropper</font><font color="#CCCCCC"> so now</font>

126
00:04:44,370 --> 00:04:48,120
they can<font color="#E5E5E5"> write less code it's quicker</font>

127
00:04:45,960 --> 00:04:50,400
<font color="#E5E5E5">it's easier and Microsoft has provided</font>

128
00:04:48,120 --> 00:04:52,260
all of dotnet<font color="#E5E5E5"> at their disposal with</font>

129
00:04:50,400 --> 00:04:55,289
PowerShell<font color="#E5E5E5"> so they have lots of</font>

130
00:04:52,260 --> 00:04:56,909
opportunity here<font color="#CCCCCC"> red teamers love this</font>

131
00:04:55,290 --> 00:04:59,160
stuff<font color="#E5E5E5"> and you'll see why in a second</font>

132
00:04:56,910 --> 00:05:02,160
with as many exploitation kits that are

133
00:04:59,160 --> 00:05:03,920
exist out<font color="#CCCCCC"> there and they love to hide ok</font>

134
00:05:02,160 --> 00:05:07,170
so that's something we have<font color="#CCCCCC"> to uncover</font>

135
00:05:03,920 --> 00:05:09,570
but<font color="#E5E5E5"> PowerShell does make noise you</font><font color="#CCCCCC"> just</font>

136
00:05:07,170 --> 00:05:12,360
<font color="#CCCCCC">have to know how</font><font color="#E5E5E5"> to detect it</font><font color="#CCCCCC"> so where</font>

137
00:05:09,570 --> 00:05:13,440
do we<font color="#E5E5E5"> start</font><font color="#CCCCCC"> check your settings</font><font color="#E5E5E5"> now you</font>

138
00:05:12,360 --> 00:05:14,400
know<font color="#E5E5E5"> I asked the question in the</font>

139
00:05:13,440 --> 00:05:17,250
beginning<font color="#CCCCCC"> how many people here know</font>

140
00:05:14,400 --> 00:05:18,539
<font color="#CCCCCC">version of power so Tyrone</font><font color="#E5E5E5"> you have to</font>

141
00:05:17,250 --> 00:05:20,430
know what<font color="#CCCCCC"> version of</font><font color="#E5E5E5"> power show you run</font>

142
00:05:18,540 --> 00:05:22,470
<font color="#CCCCCC">because for the love of all that is</font>

143
00:05:20,430 --> 00:05:23,760
security<font color="#E5E5E5"> everybody in this room and your</font>

144
00:05:22,470 --> 00:05:27,120
<font color="#E5E5E5">organization's need to</font><font color="#CCCCCC"> upgrade</font><font color="#E5E5E5"> to</font>

145
00:05:23,760 --> 00:05:29,280
PowerShell<font color="#E5E5E5"> 5 you must do so because if</font>

146
00:05:27,120 --> 00:05:31,140
you do<font color="#E5E5E5"> not you cannot detect the type of</font>

147
00:05:29,280 --> 00:05:34,409
<font color="#CCCCCC">attacks I'm going</font><font color="#E5E5E5"> to talk about today at</font>

148
00:05:31,140 --> 00:05:36,960
<font color="#E5E5E5">all well and if you're using PowerShell</font>

149
00:05:34,410 --> 00:05:40,110
<font color="#CCCCCC">v to profile at ps1 which I recommend in</font>

150
00:05:36,960 --> 00:05:41,520
the cheat sheets to turn on populate

151
00:05:40,110 --> 00:05:43,650
with<font color="#E5E5E5"> a couple variables which sets</font>

152
00:05:41,520 --> 00:05:46,109
process command line logging to occur in

153
00:05:43,650 --> 00:05:48,390
<font color="#CCCCCC">older versions</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> V</font><font color="#E5E5E5"> 2</font><font color="#CCCCCC"> V</font><font color="#E5E5E5"> 3</font><font color="#CCCCCC"> before</font><font color="#E5E5E5"> the</font>

154
00:05:46,110 --> 00:05:49,090
<font color="#E5E5E5">problem is all</font><font color="#CCCCCC"> Bower that I see</font><font color="#E5E5E5"> always</font>

155
00:05:48,390 --> 00:05:52,090
<font color="#E5E5E5">execute</font>

156
00:05:49,090 --> 00:05:54,010
-<font color="#CCCCCC"> naah / - no profile</font><font color="#E5E5E5"> so the profile</font>

157
00:05:52,090 --> 00:05:55,780
ends up being useless<font color="#CCCCCC"> this is why you</font>

158
00:05:54,010 --> 00:05:57,820
need<font color="#CCCCCC"> to upgrade</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> PowerShell 5 one</font><font color="#E5E5E5"> of</font>

159
00:05:55,780 --> 00:05:59,888
many reasons and of course execution

160
00:05:57,820 --> 00:06:02,229
policies I still see companies<font color="#CCCCCC"> that</font><font color="#E5E5E5"> just</font>

161
00:05:59,889 --> 00:06:04,150
can't pick one<font color="#E5E5E5"> well we turn around where</font>

162
00:06:02,229 --> 00:06:06,699
we<font color="#E5E5E5"> need to this is not</font><font color="#CCCCCC"> a security thing</font>

163
00:06:04,150 --> 00:06:08,799
<font color="#CCCCCC">it is a way for you to help detect bad</font>

164
00:06:06,699 --> 00:06:10,180
things in your<font color="#CCCCCC"> environment</font><font color="#E5E5E5"> because what</font>

165
00:06:08,800 --> 00:06:12,940
they do in the course of<font color="#E5E5E5"> executing</font>

166
00:06:10,180 --> 00:06:15,100
PowerShell<font color="#CCCCCC"> yeh Microsoft they gave us as</font>

167
00:06:12,940 --> 00:06:18,040
powerful powerful<font color="#E5E5E5"> tool and some settings</font>

168
00:06:15,100 --> 00:06:22,000
<font color="#CCCCCC">and guess what you can bypass them all</font>

169
00:06:18,040 --> 00:06:24,850
<font color="#CCCCCC">yeh exq some policy bypass and poof</font>

170
00:06:22,000 --> 00:06:26,380
<font color="#CCCCCC">whatever your policy is does not</font><font color="#E5E5E5"> work so</font>

171
00:06:24,850 --> 00:06:28,360
how do I check my systems for<font color="#E5E5E5"> this how</font>

172
00:06:26,380 --> 00:06:29,590
do I figure<font color="#E5E5E5"> out it how do I add</font><font color="#CCCCCC"> up them</font>

173
00:06:28,360 --> 00:06:31,020
how do<font color="#E5E5E5"> we get a report</font><font color="#CCCCCC"> how do</font><font color="#E5E5E5"> I start</font>

174
00:06:29,590 --> 00:06:33,880
<font color="#E5E5E5">the process</font><font color="#CCCCCC"> you gotta help</font><font color="#E5E5E5"> me</font>

175
00:06:31,020 --> 00:06:35,560
turns out free tool called<font color="#CCCCCC"> login D we do</font>

176
00:06:33,880 --> 00:06:35,860
a pro<font color="#CCCCCC"> version - I'll tell</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> that right</font>

177
00:06:35,560 --> 00:06:38,139
now

178
00:06:35,860 --> 00:06:40,510
full disclosure<font color="#CCCCCC"> but what we do when you</font>

179
00:06:38,139 --> 00:06:41,860
run<font color="#E5E5E5"> it</font><font color="#CCCCCC"> with our legal test</font><font color="#E5E5E5"> copy guy when</font>

180
00:06:40,510 --> 00:06:43,570
you run it the first thing it's<font color="#CCCCCC"> going to</font>

181
00:06:41,860 --> 00:06:45,760
tell you<font color="#E5E5E5"> when I do a</font><font color="#CCCCCC"> log in D</font><font color="#E5E5E5"> which is</font>

182
00:06:43,570 --> 00:06:48,610
<font color="#E5E5E5">default</font><font color="#CCCCCC"> - one is we're gonna tell you</font>

183
00:06:45,760 --> 00:06:49,960
<font color="#E5E5E5">what the policy of your</font><font color="#CCCCCC"> box is and what</font>

184
00:06:48,610 --> 00:06:51,970
version<font color="#CCCCCC"> you're running</font><font color="#E5E5E5"> because it's so</font>

185
00:06:49,960 --> 00:06:53,888
important that we<font color="#E5E5E5"> can get you</font><font color="#CCCCCC"> guys up or</font>

186
00:06:51,970 --> 00:06:56,320
at<font color="#E5E5E5"> least knowledgeable about the fact</font>

187
00:06:53,889 --> 00:06:58,450
you're not<font color="#E5E5E5"> running PowerShell v5 and the</font>

188
00:06:56,320 --> 00:07:00,340
fact that if you do<font color="#E5E5E5"> have v2 on the</font><font color="#CCCCCC"> box</font>

189
00:06:58,450 --> 00:07:02,169
<font color="#E5E5E5">that</font><font color="#CCCCCC"> there's downgrade attacks are</font>

190
00:07:00,340 --> 00:07:03,849
<font color="#CCCCCC">possible downgrade</font><font color="#E5E5E5"> attacks there's a</font>

191
00:07:02,169 --> 00:07:05,770
couple dll's two or three<font color="#CCCCCC"> dll's</font><font color="#E5E5E5"> that</font>

192
00:07:03,850 --> 00:07:07,750
actually<font color="#E5E5E5"> are</font><font color="#CCCCCC"> PowerShell system</font>

193
00:07:05,770 --> 00:07:09,880
management<font color="#E5E5E5"> automation</font><font color="#CCCCCC"> DLL and</font><font color="#E5E5E5"> another</font>

194
00:07:07,750 --> 00:07:11,680
one and<font color="#CCCCCC"> that is actually</font><font color="#E5E5E5"> PowerShell it's</font>

195
00:07:09,880 --> 00:07:14,080
not<font color="#CCCCCC"> PowerShell exe that's just a fancy</font>

196
00:07:11,680 --> 00:07:16,030
<font color="#CCCCCC">GUI thing that runs the</font><font color="#E5E5E5"> PowerShell the</font>

197
00:07:14,080 --> 00:07:18,190
<font color="#E5E5E5">powershell power is in the</font><font color="#CCCCCC"> DLLs</font>

198
00:07:16,030 --> 00:07:19,690
those things<font color="#E5E5E5"> reside</font><font color="#CCCCCC"> in the box they</font>

199
00:07:18,190 --> 00:07:21,880
cannot be removed<font color="#E5E5E5"> they're hooking to the</font>

200
00:07:19,690 --> 00:07:24,940
system<font color="#E5E5E5"> you're stuck with them too bad</font>

201
00:07:21,880 --> 00:07:26,500
<font color="#CCCCCC">for</font><font color="#E5E5E5"> you and Windows 10</font><font color="#CCCCCC"> in 2016 there is</font>

202
00:07:24,940 --> 00:07:28,450
an option saying disable it

203
00:07:26,500 --> 00:07:30,599
yeah<font color="#E5E5E5"> all it's doing is turning off the</font>

204
00:07:28,450 --> 00:07:33,639
ability<font color="#CCCCCC"> to call it from your perspective</font>

205
00:07:30,599 --> 00:07:35,080
<font color="#CCCCCC">but</font><font color="#E5E5E5"> not from the bad guys perspective</font><font color="#CCCCCC"> so</font>

206
00:07:33,639 --> 00:07:37,000
log of<font color="#E5E5E5"> me will spit this out to you so</font>

207
00:07:35,080 --> 00:07:39,550
you now have<font color="#CCCCCC"> an idea where you</font><font color="#E5E5E5"> stand</font>

208
00:07:37,000 --> 00:07:41,979
<font color="#CCCCCC">that's</font><font color="#E5E5E5"> the first thing also</font><font color="#CCCCCC"> we give you</font>

209
00:07:39,550 --> 00:07:43,750
a report it's in text which means<font color="#CCCCCC"> for</font>

210
00:07:41,979 --> 00:07:45,400
anybody here's a consultant you can<font color="#E5E5E5"> I</font>

211
00:07:43,750 --> 00:07:47,470
was<font color="#CCCCCC"> a consultant for</font><font color="#E5E5E5"> many years sort of</font>

212
00:07:45,400 --> 00:07:48,880
still<font color="#E5E5E5"> I'm I do consulting is I want to</font>

213
00:07:47,470 --> 00:07:51,610
<font color="#E5E5E5">be</font><font color="#CCCCCC"> able to cut</font><font color="#E5E5E5"> and paste what I need to</font>

214
00:07:48,880 --> 00:07:53,159
into a report so we just make it<font color="#E5E5E5"> clear</font>

215
00:07:51,610 --> 00:07:55,570
text you can<font color="#E5E5E5"> make it whatever you want</font>

216
00:07:53,160 --> 00:07:56,889
<font color="#CCCCCC">this is an interesting aspect</font><font color="#E5E5E5"> of what</font>

217
00:07:55,570 --> 00:07:59,890
this looks<font color="#CCCCCC"> like here</font><font color="#E5E5E5"> what are all those</font>

218
00:07:56,889 --> 00:08:02,390
fives<font color="#E5E5E5"> we</font><font color="#CCCCCC"> compare with</font><font color="#E5E5E5"> the windows</font><font color="#CCCCCC"> login</font>

219
00:07:59,890 --> 00:08:04,039
<font color="#E5E5E5">cheat sheet is all the recommend</font><font color="#CCCCCC"> Rick</font>

220
00:08:02,390 --> 00:08:05,180
settings that<font color="#CCCCCC"> I tell</font><font color="#E5E5E5"> you guys</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> turn on</font>

221
00:08:04,040 --> 00:08:07,790
and everybody who wants<font color="#CCCCCC"> to do security</font>

222
00:08:05,180 --> 00:08:10,190
<font color="#E5E5E5">well from a long perspective and the</font><font color="#CCCCCC"> CIS</font>

223
00:08:07,790 --> 00:08:12,770
and<font color="#CCCCCC"> USG CBS and</font><font color="#E5E5E5"> Aussie cyber standards</font>

224
00:08:10,190 --> 00:08:14,300
are also<font color="#E5E5E5"> something</font><font color="#CCCCCC"> login Detex</font><font color="#E5E5E5"> for so we</font>

225
00:08:12,770 --> 00:08:16,099
check all the audit settings and we say

226
00:08:14,300 --> 00:08:18,080
how are<font color="#E5E5E5"> you compared to these standards</font>

227
00:08:16,100 --> 00:08:19,190
<font color="#E5E5E5">and also the windows</font><font color="#CCCCCC"> logging</font><font color="#E5E5E5"> cheat</font>

228
00:08:18,080 --> 00:08:20,870
sheets<font color="#E5E5E5"> and you can see the only thing</font>

229
00:08:19,190 --> 00:08:23,270
<font color="#CCCCCC">that's yes is the one with Windows</font>

230
00:08:20,870 --> 00:08:25,490
<font color="#E5E5E5">logging cheat sheets the five indicates</font>

231
00:08:23,270 --> 00:08:27,770
these standards<font color="#E5E5E5"> that we all use in</font>

232
00:08:25,490 --> 00:08:31,040
compliance<font color="#E5E5E5"> that we're told to rely on</font>

233
00:08:27,770 --> 00:08:31,820
don't even mention enabling Perisher

234
00:08:31,040 --> 00:08:34,400
logging

235
00:08:31,820 --> 00:08:36,110
so there you<font color="#CCCCCC"> are by about five</font><font color="#E5E5E5"> years</font>

236
00:08:34,400 --> 00:08:37,880
behind<font color="#E5E5E5"> they're just now discussing</font>

237
00:08:36,110 --> 00:08:40,280
<font color="#E5E5E5">putting this into their benchmarks and</font>

238
00:08:37,880 --> 00:08:41,419
<font color="#E5E5E5">and standards documents are just</font>

239
00:08:40,280 --> 00:08:43,579
<font color="#CCCCCC">starting to come out from the government</font>

240
00:08:41,419 --> 00:08:45,530
side<font color="#CCCCCC"> and that's a flaw</font><font color="#E5E5E5"> because so many</font>

241
00:08:43,580 --> 00:08:47,090
pen testers uses the hackers are<font color="#E5E5E5"> heavily</font>

242
00:08:45,530 --> 00:08:48,829
using<font color="#E5E5E5"> this if you talk to somebody who's</font>

243
00:08:47,090 --> 00:08:50,510
<font color="#CCCCCC">been owned at a targeted attack</font><font color="#E5E5E5"> they</font>

244
00:08:48,830 --> 00:08:52,970
will tell you they predominantly see

245
00:08:50,510 --> 00:08:54,650
PowerShell being used so that<font color="#CCCCCC"> is the</font>

246
00:08:52,970 --> 00:08:56,570
bummer<font color="#E5E5E5"> so now we have this next</font><font color="#CCCCCC"> report</font>

247
00:08:54,650 --> 00:08:57,860
you now have action to go and help and

248
00:08:56,570 --> 00:09:00,260
put in tickets and do what you need to

249
00:08:57,860 --> 00:09:02,390
<font color="#E5E5E5">do and get PowerShell enabled you have</font>

250
00:09:00,260 --> 00:09:04,189
what you<font color="#E5E5E5"> need to audit the next thing</font>

251
00:09:02,390 --> 00:09:06,350
you have<font color="#E5E5E5"> to</font><font color="#CCCCCC"> do is enable</font><font color="#E5E5E5"> the logging of</font>

252
00:09:04,190 --> 00:09:08,000
<font color="#E5E5E5">course there's a thing called a Windows</font>

253
00:09:06,350 --> 00:09:10,190
PowerShell<font color="#CCCCCC"> logging cheat sheet who</font>

254
00:09:08,000 --> 00:09:12,590
thought and this will<font color="#E5E5E5"> tell you what to</font>

255
00:09:10,190 --> 00:09:13,730
turn on<font color="#CCCCCC"> okay they're</font><font color="#E5E5E5"> all GPO is</font><font color="#CCCCCC"> only</font>

256
00:09:12,590 --> 00:09:15,830
about<font color="#E5E5E5"> four settings you really have to</font>

257
00:09:13,730 --> 00:09:18,020
worry<font color="#E5E5E5"> about you</font><font color="#CCCCCC"> have</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> upgrade</font><font color="#E5E5E5"> to</font>

258
00:09:15,830 --> 00:09:20,270
version<font color="#E5E5E5"> 5 of PowerShell for this to be</font>

259
00:09:18,020 --> 00:09:23,510
at all useful<font color="#CCCCCC"> and yes use the</font><font color="#E5E5E5"> profile</font>

260
00:09:20,270 --> 00:09:25,280
which again a - an apple bypass<font color="#E5E5E5"> but the</font>

261
00:09:23,510 --> 00:09:26,689
cheat sheets are there to guide<font color="#CCCCCC"> you so</font>

262
00:09:25,280 --> 00:09:28,850
now you have a standard<font color="#CCCCCC"> to take to</font><font color="#E5E5E5"> work</font>

263
00:09:26,690 --> 00:09:32,720
saying<font color="#E5E5E5"> we fail here</font><font color="#CCCCCC"> I want to</font><font color="#E5E5E5"> get to</font>

264
00:09:28,850 --> 00:09:34,460
here<font color="#E5E5E5"> and you're about</font><font color="#CCCCCC"> to see why</font><font color="#E5E5E5"> and yes</font>

265
00:09:32,720 --> 00:09:38,330
<font color="#CCCCCC">thank you Microsoft</font><font color="#E5E5E5"> for having all these</font>

266
00:09:34,460 --> 00:09:39,710
bypasses I got this off<font color="#CCCCCC"> of actually an</font>

267
00:09:38,330 --> 00:09:41,180
<font color="#CCCCCC">article</font><font color="#E5E5E5"> a guy wrote I worked at the</font><font color="#CCCCCC"> vent</font>

268
00:09:39,710 --> 00:09:43,400
<font color="#E5E5E5">sentry</font><font color="#CCCCCC"> on some PowerShell stuff and they</font>

269
00:09:41,180 --> 00:09:44,540
published<font color="#E5E5E5"> this as this table comes from</font>

270
00:09:43,400 --> 00:09:45,740
something<font color="#E5E5E5"> else but they threw this</font>

271
00:09:44,540 --> 00:09:46,250
together<font color="#E5E5E5"> I thought hey it's actually</font>

272
00:09:45,740 --> 00:09:49,340
pretty<font color="#E5E5E5"> good</font>

273
00:09:46,250 --> 00:09:51,380
because it does<font color="#E5E5E5"> list the</font><font color="#CCCCCC"> windows there's</font>

274
00:09:49,340 --> 00:09:53,380
actually two partial logs by the way the

275
00:09:51,380 --> 00:09:55,880
<font color="#CCCCCC">Windows PowerShell log of n IDs and</font>

276
00:09:53,380 --> 00:09:57,530
again for reference<font color="#E5E5E5"> please download this</font>

277
00:09:55,880 --> 00:09:59,689
and really consume and study this and

278
00:09:57,530 --> 00:10:01,339
then also the<font color="#E5E5E5"> PowerShell operational</font>

279
00:09:59,690 --> 00:10:02,990
event IDs there<font color="#E5E5E5"> are two we did not list</font>

280
00:10:01,340 --> 00:10:04,520
<font color="#E5E5E5">nobody in the right mind would enable</font>

281
00:10:02,990 --> 00:10:06,500
these<font color="#E5E5E5"> except your pen testers and</font>

282
00:10:04,520 --> 00:10:08,600
attackers<font color="#E5E5E5"> that would generate so much</font>

283
00:10:06,500 --> 00:10:10,580
noise if I wanted<font color="#E5E5E5"> to hide my activity I</font>

284
00:10:08,600 --> 00:10:12,740
would enable these<font color="#CCCCCC"> kick</font><font color="#E5E5E5"> off a script</font>

285
00:10:10,580 --> 00:10:13,340
completely<font color="#E5E5E5"> flush your logs by rotating</font>

286
00:10:12,740 --> 00:10:15,320
<font color="#E5E5E5">them out</font>

287
00:10:13,340 --> 00:10:17,630
in a matter of minutes with<font color="#CCCCCC"> 4105</font><font color="#E5E5E5"> and 41</font>

288
00:10:15,320 --> 00:10:18,980
sixes so these are very bad<font color="#E5E5E5"> but worth</font>

289
00:10:17,630 --> 00:10:21,530
mentioning<font color="#CCCCCC"> that's what they be used for</font>

290
00:10:18,980 --> 00:10:22,640
<font color="#E5E5E5">just</font><font color="#CCCCCC"> talk</font><font color="#E5E5E5"> to any and any red</font><font color="#CCCCCC"> teamer if</font>

291
00:10:21,530 --> 00:10:24,829
they<font color="#E5E5E5"> don't know about this</font>

292
00:10:22,640 --> 00:10:26,980
this attack or a way<font color="#E5E5E5"> to flood the logs</font>

293
00:10:24,830 --> 00:10:30,110
<font color="#CCCCCC">then hire somebody else</font>

294
00:10:26,980 --> 00:10:32,450
typical malware lots of<font color="#E5E5E5"> PowerShell</font>

295
00:10:30,110 --> 00:10:35,600
<font color="#E5E5E5">almost every download I see now comes</font>

296
00:10:32,450 --> 00:10:38,360
and comes from<font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> Windward calls</font>

297
00:10:35,600 --> 00:10:39,950
<font color="#E5E5E5">command shell calls</font><font color="#CCCCCC"> w script called C</font>

298
00:10:38,360 --> 00:10:41,180
<font color="#E5E5E5">script doesn't matter and eventually</font>

299
00:10:39,950 --> 00:10:42,920
<font color="#E5E5E5">PowerShell will go out and fetch it</font>

300
00:10:41,180 --> 00:10:45,469
<font color="#E5E5E5">because built into power</font><font color="#CCCCCC"> shows the</font>

301
00:10:42,920 --> 00:10:47,510
ability<font color="#CCCCCC"> doing web calls and again most</font>

302
00:10:45,470 --> 00:10:48,950
<font color="#E5E5E5">of our we see it</font><font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> hearing it more and</font>

303
00:10:47,510 --> 00:10:50,780
<font color="#E5E5E5">more on the targeted attacks you read</font>

304
00:10:48,950 --> 00:10:52,190
the reports from<font color="#E5E5E5"> the</font><font color="#CCCCCC"> IR firms you're</font>

305
00:10:50,780 --> 00:10:54,589
gonna see that they're gonna reference

306
00:10:52,190 --> 00:10:56,390
<font color="#CCCCCC">power shows</font><font color="#E5E5E5"> use PowerShell use the pen</font>

307
00:10:54,590 --> 00:10:57,920
testers and talks you hear about<font color="#E5E5E5"> living</font>

308
00:10:56,390 --> 00:10:59,780
off the land that's<font color="#E5E5E5"> what we're talking</font>

309
00:10:57,920 --> 00:11:00,530
about<font color="#E5E5E5"> what can</font><font color="#CCCCCC"> we use it's already on</font>

310
00:10:59,780 --> 00:11:02,240
the system

311
00:11:00,530 --> 00:11:04,970
<font color="#CCCCCC">alright the</font><font color="#E5E5E5"> white listing application</font><font color="#CCCCCC"> by</font>

312
00:11:02,240 --> 00:11:06,860
<font color="#CCCCCC">past exploits</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> Casey</font><font color="#E5E5E5"> talks about all</font>

313
00:11:04,970 --> 00:11:08,690
the<font color="#CCCCCC"> time our things that I can run on</font>

314
00:11:06,860 --> 00:11:10,310
<font color="#E5E5E5">Windows that are trusted</font><font color="#CCCCCC"> because they're</font>

315
00:11:08,690 --> 00:11:12,230
Microsoft sign<font color="#E5E5E5"> that can go out</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the</font>

316
00:11:10,310 --> 00:11:13,670
internet<font color="#CCCCCC"> and</font><font color="#E5E5E5"> download stuff and then I</font>

317
00:11:12,230 --> 00:11:15,200
don't have to<font color="#CCCCCC"> actually use malware or</font>

318
00:11:13,670 --> 00:11:17,689
write<font color="#E5E5E5"> something I can just live</font><font color="#CCCCCC"> off the</font>

319
00:11:15,200 --> 00:11:20,210
land<font color="#CCCCCC"> pen</font><font color="#E5E5E5"> testers love this stuff and</font>

320
00:11:17,690 --> 00:11:22,550
again there are<font color="#E5E5E5"> tons of post post</font>

321
00:11:20,210 --> 00:11:24,200
exploitation<font color="#CCCCCC"> too kits I'm here to tell</font>

322
00:11:22,550 --> 00:11:26,660
you<font color="#CCCCCC"> that the Empire has fallen you</font><font color="#E5E5E5"> can</font>

323
00:11:24,200 --> 00:11:28,640
detect these if you pay attention<font color="#E5E5E5"> to</font>

324
00:11:26,660 --> 00:11:30,680
this presentation<font color="#E5E5E5"> there are lots of them</font>

325
00:11:28,640 --> 00:11:32,270
<font color="#E5E5E5">out there</font><font color="#CCCCCC"> the red teamers love this</font>

326
00:11:30,680 --> 00:11:34,339
stuff<font color="#E5E5E5"> here's your proof they've written</font>

327
00:11:32,270 --> 00:11:36,530
so many exploit kits<font color="#E5E5E5"> post exploitation</font>

328
00:11:34,340 --> 00:11:38,030
<font color="#CCCCCC">kits and</font><font color="#E5E5E5"> I don't</font><font color="#CCCCCC"> even think I put</font>

329
00:11:36,530 --> 00:11:40,970
<font color="#CCCCCC">Metasploit on here but nevertheless</font>

330
00:11:38,030 --> 00:11:42,620
<font color="#E5E5E5">Metasploit is included so blue team baby</font>

331
00:11:40,970 --> 00:11:44,330
<font color="#CCCCCC">I</font><font color="#E5E5E5"> think it's the</font><font color="#CCCCCC"> most sexiest thing you</font>

332
00:11:42,620 --> 00:11:46,340
could<font color="#CCCCCC"> ever do as a job people say</font><font color="#E5E5E5"> our</font>

333
00:11:44,330 --> 00:11:48,230
<font color="#E5E5E5">red</font><font color="#CCCCCC"> team</font><font color="#E5E5E5"> sexy when I pop the box no you</font>

334
00:11:46,340 --> 00:11:49,970
know what's sexy<font color="#CCCCCC"> me kicking the Chinese</font>

335
00:11:48,230 --> 00:11:51,440
out of my environment<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> the biggest</font>

336
00:11:49,970 --> 00:11:55,820
<font color="#E5E5E5">thrill I've ever gotten in my security</font>

337
00:11:51,440 --> 00:11:59,930
career period so if you want sexy kick

338
00:11:55,820 --> 00:12:02,480
out a<font color="#E5E5E5"> bag</font><font color="#CCCCCC"> forty</font><font color="#E5E5E5"> six eighty eight these</font>

339
00:11:59,930 --> 00:12:04,579
<font color="#E5E5E5">are process creates again</font><font color="#CCCCCC"> thank you or</font>

340
00:12:02,480 --> 00:12:07,760
<font color="#CCCCCC">fu Microsoft for not enabling</font><font color="#E5E5E5"> this by</font>

341
00:12:04,580 --> 00:12:10,520
default<font color="#E5E5E5"> this watches on your system the</font>

342
00:12:07,760 --> 00:12:12,470
things that<font color="#E5E5E5"> execute as they occur</font><font color="#CCCCCC"> but</font>

343
00:12:10,520 --> 00:12:14,180
again<font color="#E5E5E5"> off by default</font><font color="#CCCCCC"> you must enable</font>

344
00:12:12,470 --> 00:12:16,550
them follow the windows login chichi

345
00:12:14,180 --> 00:12:19,130
<font color="#CCCCCC">this is an example of login</font><font color="#E5E5E5"> D output and</font>

346
00:12:16,550 --> 00:12:21,319
what you're seeing<font color="#CCCCCC"> here is windward a</font>

347
00:12:19,130 --> 00:12:24,380
<font color="#E5E5E5">windward document at</font><font color="#CCCCCC"> the top</font><font color="#E5E5E5"> calling</font>

348
00:12:21,320 --> 00:12:26,790
again parent-child relationship calling

349
00:12:24,380 --> 00:12:29,250
command shell which then spawns<font color="#E5E5E5"> power</font>

350
00:12:26,790 --> 00:12:30,780
<font color="#CCCCCC">shell</font><font color="#E5E5E5"> which phones home</font><font color="#CCCCCC"> you can't</font>

351
00:12:29,250 --> 00:12:32,910
understand what's<font color="#E5E5E5"> up there</font><font color="#CCCCCC"> we'll get</font><font color="#E5E5E5"> to</font>

352
00:12:30,780 --> 00:12:35,160
that<font color="#E5E5E5"> as we as you progressed then</font>

353
00:12:32,910 --> 00:12:38,160
download some our launches<font color="#E5E5E5"> two versions</font>

354
00:12:35,160 --> 00:12:39,420
of it<font color="#E5E5E5"> why because</font><font color="#CCCCCC"> a lot of EDR says</font><font color="#E5E5E5"> you</font>

355
00:12:38,160 --> 00:12:41,880
want to<font color="#E5E5E5"> kill</font><font color="#CCCCCC"> that process that's evil</font>

356
00:12:39,420 --> 00:12:43,410
yes I do<font color="#E5E5E5"> I just</font><font color="#CCCCCC"> cleaned the</font><font color="#E5E5E5"> box</font><font color="#CCCCCC"> no the</font>

357
00:12:41,880 --> 00:12:44,939
other<font color="#CCCCCC"> ones gonna start it back up they</font>

358
00:12:43,410 --> 00:12:47,760
have a check and<font color="#CCCCCC"> balance they understand</font>

359
00:12:44,940 --> 00:12:49,590
<font color="#CCCCCC">load-balancing DRM BCP in malware so</font>

360
00:12:47,760 --> 00:12:51,660
yeah<font color="#CCCCCC"> they launched two copies of</font><font color="#E5E5E5"> them</font>

361
00:12:49,590 --> 00:12:53,130
<font color="#E5E5E5">out are very very common</font><font color="#CCCCCC"> and you can see</font>

362
00:12:51,660 --> 00:12:55,290
down<font color="#CCCCCC"> here basically word caught calling</font>

363
00:12:53,130 --> 00:12:56,580
power command dot exe calling power show

364
00:12:55,290 --> 00:12:58,020
which gets the<font color="#E5E5E5"> droppers launches the</font>

365
00:12:56,580 --> 00:13:01,230
malware<font color="#E5E5E5"> and the malware launches another</font>

366
00:12:58,020 --> 00:13:02,600
copy<font color="#E5E5E5"> of itself to protect itself this is</font>

367
00:13:01,230 --> 00:13:05,210
actually but that blurb looks like

368
00:13:02,600 --> 00:13:07,980
anybody think that's<font color="#E5E5E5"> normal</font>

369
00:13:05,210 --> 00:13:09,870
okay so the goal here<font color="#CCCCCC"> is to</font><font color="#E5E5E5"> figure</font><font color="#CCCCCC"> out</font>

370
00:13:07,980 --> 00:13:12,090
what's not normal<font color="#E5E5E5"> and make it stick out</font>

371
00:13:09,870 --> 00:13:14,370
more<font color="#E5E5E5"> okay and there's many ways we can</font>

372
00:13:12,090 --> 00:13:16,650
do that<font color="#E5E5E5"> one of</font><font color="#CCCCCC"> which is the fact</font><font color="#E5E5E5"> that</font>

373
00:13:14,370 --> 00:13:18,720
it's so friggin little<font color="#E5E5E5"> arch okay</font><font color="#CCCCCC"> but</font>

374
00:13:16,650 --> 00:13:22,020
there's a lot<font color="#E5E5E5"> of large normal but it</font>

375
00:13:18,720 --> 00:13:23,850
won't look like<font color="#E5E5E5"> this so let's look at</font>

376
00:13:22,020 --> 00:13:25,800
that a<font color="#CCCCCC"> little</font><font color="#E5E5E5"> bit tighter</font><font color="#CCCCCC"> i got</font><font color="#E5E5E5"> rid of</font>

377
00:13:23,850 --> 00:13:26,910
<font color="#E5E5E5">42 of the lines of all that</font><font color="#CCCCCC"> garbage and</font>

378
00:13:25,800 --> 00:13:28,800
<font color="#E5E5E5">now what we see</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> the top and</font><font color="#CCCCCC"> the</font>

379
00:13:26,910 --> 00:13:30,930
bottom<font color="#E5E5E5"> and we</font><font color="#CCCCCC"> can start seeing things</font>

380
00:13:28,800 --> 00:13:36,839
that are obvious to<font color="#E5E5E5"> us there's a bunch</font>

381
00:13:30,930 --> 00:13:38,209
of there's<font color="#CCCCCC"> there's some</font><font color="#E5E5E5"> calm specs so we</font>

382
00:13:36,840 --> 00:13:39,990
know they're<font color="#E5E5E5"> doing some variables</font>

383
00:13:38,210 --> 00:13:41,880
<font color="#E5E5E5">although all these sets and the</font>

384
00:13:39,990 --> 00:13:43,230
percentages<font color="#E5E5E5"> so we have an idea</font><font color="#CCCCCC"> they're</font>

385
00:13:41,880 --> 00:13:45,420
doing something<font color="#E5E5E5"> with a bunch of</font>

386
00:13:43,230 --> 00:13:46,590
<font color="#CCCCCC">variables basically they're</font><font color="#E5E5E5"> off you</font>

387
00:13:45,420 --> 00:13:49,079
skating they're trying to hide what

388
00:13:46,590 --> 00:13:51,510
<font color="#E5E5E5">they're doing did that</font><font color="#CCCCCC"> look</font><font color="#E5E5E5"> normal</font><font color="#CCCCCC"> to</font>

389
00:13:49,080 --> 00:13:53,280
anybody<font color="#E5E5E5"> unless you're the evil guy and</font>

390
00:13:51,510 --> 00:13:54,510
if you are then<font color="#CCCCCC"> i'm teaching you how to</font>

391
00:13:53,280 --> 00:13:56,490
be<font color="#CCCCCC"> more evil because i'm teaching</font><font color="#E5E5E5"> you</font>

392
00:13:54,510 --> 00:13:58,080
<font color="#E5E5E5">how</font><font color="#CCCCCC"> to catch yourself but anyway the</font>

393
00:13:56,490 --> 00:14:00,900
forty<font color="#E5E5E5"> six eighty eight process execution</font>

394
00:13:58,080 --> 00:14:02,820
<font color="#CCCCCC">is the core of Windows everything in</font>

395
00:14:00,900 --> 00:14:04,530
<font color="#E5E5E5">execute some windows that</font><font color="#CCCCCC"> login the</font>

396
00:14:02,820 --> 00:14:06,810
security log will catch anything<font color="#E5E5E5"> that</font>

397
00:14:04,530 --> 00:14:08,670
<font color="#E5E5E5">executes almost anything there are ways</font>

398
00:14:06,810 --> 00:14:10,319
to execute stuff<font color="#E5E5E5"> without logging stuff</font>

399
00:14:08,670 --> 00:14:12,569
<font color="#E5E5E5">but for</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> most</font><font color="#CCCCCC"> part this is how it</font>

400
00:14:10,320 --> 00:14:15,540
works and<font color="#E5E5E5"> you can catch this just by</font>

401
00:14:12,570 --> 00:14:17,520
enabling process<font color="#E5E5E5"> command line or process</font>

402
00:14:15,540 --> 00:14:19,920
create with the addition you should

403
00:14:17,520 --> 00:14:21,990
enable<font color="#E5E5E5"> the process command line stuff as</font>

404
00:14:19,920 --> 00:14:23,849
well<font color="#E5E5E5"> because that's where</font><font color="#CCCCCC"> all that food</font>

405
00:14:21,990 --> 00:14:26,250
<font color="#CCCCCC">just saw occurs is in the command line</font>

406
00:14:23,850 --> 00:14:28,740
<font color="#E5E5E5">but</font><font color="#CCCCCC"> I might catch passwords</font><font color="#E5E5E5"> and we'll</font>

407
00:14:26,250 --> 00:14:31,290
talk<font color="#CCCCCC"> about</font><font color="#E5E5E5"> that so again</font><font color="#CCCCCC"> any time you</font>

408
00:14:28,740 --> 00:14:33,840
see word calling<font color="#E5E5E5"> commands C script W</font>

409
00:14:31,290 --> 00:14:36,259
script anything<font color="#E5E5E5"> after that flag it this</font>

410
00:14:33,840 --> 00:14:38,149
is how most<font color="#E5E5E5"> eighty yards will flag</font>

411
00:14:36,259 --> 00:14:40,519
just documents being loaded<font color="#CCCCCC"> whether</font><font color="#E5E5E5"> to</font>

412
00:14:38,149 --> 00:14:41,989
Word Excel<font color="#CCCCCC"> or anything else and so that</font>

413
00:14:40,519 --> 00:14:45,199
big blob looks interesting so<font color="#CCCCCC"> let's dig</font>

414
00:14:41,989 --> 00:14:46,489
into that<font color="#E5E5E5"> so the power show bypasses I</font>

415
00:14:45,199 --> 00:14:49,069
talked<font color="#CCCCCC"> about</font><font color="#E5E5E5"> this the beginning</font><font color="#CCCCCC"> right</font>

416
00:14:46,489 --> 00:14:51,079
the - not so what you see<font color="#CCCCCC"> here is this</font>

417
00:14:49,069 --> 00:14:53,118
<font color="#E5E5E5">Windows hidden why the bad guys don't</font>

418
00:14:51,079 --> 00:14:55,248
want you to see the<font color="#CCCCCC"> power show window</font>

419
00:14:53,119 --> 00:14:57,529
<font color="#E5E5E5">that pops up great Microsoft gives you a</font>

420
00:14:55,249 --> 00:14:58,999
<font color="#E5E5E5">minus H they do it for the admin so the</font>

421
00:14:57,529 --> 00:15:00,769
admins don't interrupt what<font color="#CCCCCC"> you're doing</font>

422
00:14:58,999 --> 00:15:03,229
but<font color="#CCCCCC"> the hackers love it as well</font><font color="#E5E5E5"> and use</font>

423
00:15:00,769 --> 00:15:05,119
it pretty extensively<font color="#E5E5E5"> also here here's</font>

424
00:15:03,229 --> 00:15:06,649
the<font color="#CCCCCC"> -</font><font color="#E5E5E5"> knob that means the profile that I</font>

425
00:15:05,119 --> 00:15:08,059
tell you<font color="#E5E5E5"> to set the variables in to do</font>

426
00:15:06,649 --> 00:15:10,429
the process<font color="#CCCCCC"> command-line logging in</font>

427
00:15:08,059 --> 00:15:13,600
<font color="#E5E5E5">PowerShell</font><font color="#CCCCCC"> v2 well no longer work</font>

428
00:15:10,429 --> 00:15:17,689
because they're<font color="#CCCCCC"> bypassing your profile</font>

429
00:15:13,600 --> 00:15:20,149
and there's all that<font color="#CCCCCC"> other garbage so</font>

430
00:15:17,689 --> 00:15:22,309
the<font color="#E5E5E5"> buzz words of the things that make</font>

431
00:15:20,149 --> 00:15:25,489
it<font color="#CCCCCC"> look like it's being bypassed are</font>

432
00:15:22,309 --> 00:15:27,589
things you should look for here's a<font color="#CCCCCC"> home</font>

433
00:15:25,489 --> 00:15:28,989
you know logging solution that has it

434
00:15:27,589 --> 00:15:31,999
<font color="#E5E5E5">and you</font><font color="#CCCCCC"> can see here</font><font color="#E5E5E5"> PowerShell</font>

435
00:15:28,989 --> 00:15:34,639
non-interactive notice the scenario<font color="#CCCCCC"> of</font>

436
00:15:31,999 --> 00:15:36,410
<font color="#E5E5E5">uppercase and lowercase now they do that</font>

437
00:15:34,639 --> 00:15:38,479
because<font color="#E5E5E5"> a lot of email scanners being</font>

438
00:15:36,410 --> 00:15:40,549
<font color="#CCCCCC">linux based and whatnot</font><font color="#E5E5E5"> case matters</font>

439
00:15:38,479 --> 00:15:43,069
<font color="#CCCCCC">Windows it does not matter long and does</font>

440
00:15:40,549 --> 00:15:45,289
not matter but in the course<font color="#E5E5E5"> of the the</font>

441
00:15:43,069 --> 00:15:47,329
<font color="#E5E5E5">message being inspected case does matter</font>

442
00:15:45,289 --> 00:15:48,709
<font color="#CCCCCC">so they do this which for which</font><font color="#E5E5E5"> is</font>

443
00:15:47,329 --> 00:15:50,329
<font color="#E5E5E5">almost funny to me because in the</font>

444
00:15:48,709 --> 00:15:52,429
Windows<font color="#CCCCCC"> environment this is really</font>

445
00:15:50,329 --> 00:15:55,399
<font color="#CCCCCC">useless</font><font color="#E5E5E5"> but nevertheless it makes it</font>

446
00:15:52,429 --> 00:15:57,649
stick out<font color="#CCCCCC"> more so</font><font color="#E5E5E5"> yeah</font><font color="#CCCCCC"> execution policy</font>

447
00:15:55,399 --> 00:16:00,319
bypass don't matter<font color="#E5E5E5"> what if you're set</font>

448
00:15:57,649 --> 00:16:01,579
to<font color="#CCCCCC"> there</font><font color="#E5E5E5"> bypassing it and they're using</font>

449
00:16:00,319 --> 00:16:05,479
<font color="#CCCCCC">you</font><font color="#E5E5E5"> hit in Windows so you don't see</font><font color="#CCCCCC"> it</font>

450
00:16:01,579 --> 00:16:07,128
right<font color="#CCCCCC"> there so they do this to hide what</font>

451
00:16:05,480 --> 00:16:09,980
they see<font color="#CCCCCC"> right</font><font color="#E5E5E5"> you can capture this</font>

452
00:16:07,129 --> 00:16:11,509
behavior in a<font color="#CCCCCC"> 46 88 standard procedure</font>

453
00:16:09,980 --> 00:16:12,949
<font color="#E5E5E5">of word calling</font><font color="#CCCCCC"> commands show calling</font>

454
00:16:11,509 --> 00:16:15,230
PowerShell<font color="#E5E5E5"> whatever they execute with</font>

455
00:16:12,949 --> 00:16:17,209
PowerShell<font color="#CCCCCC"> in the initial call will be</font>

456
00:16:15,230 --> 00:16:19,549
<font color="#E5E5E5">collected on that command line but you</font>

457
00:16:17,209 --> 00:16:21,289
must enable process<font color="#E5E5E5"> command line it's</font>

458
00:16:19,549 --> 00:16:23,629
another option<font color="#E5E5E5"> in GPO you must turn on</font>

459
00:16:21,289 --> 00:16:26,059
you will get some flack for<font color="#CCCCCC"> it</font><font color="#E5E5E5"> you'll</font>

460
00:16:23,629 --> 00:16:28,489
catch my domain admin creds<font color="#E5E5E5"> good if</font>

461
00:16:26,059 --> 00:16:31,129
you're<font color="#E5E5E5"> stupid enough to type your</font><font color="#CCCCCC"> domain</font>

462
00:16:28,489 --> 00:16:33,259
admin credential password<font color="#CCCCCC"> any script or</font>

463
00:16:31,129 --> 00:16:35,600
store it in a script<font color="#CCCCCC"> that means you're</font>

464
00:16:33,259 --> 00:16:38,299
violating possible policy<font color="#E5E5E5"> because you're</font>

465
00:16:35,600 --> 00:16:40,069
storing a password<font color="#CCCCCC"> I'm clear on the disk</font>

466
00:16:38,299 --> 00:16:42,379
<font color="#E5E5E5">that</font><font color="#CCCCCC"> sit there all the</font><font color="#E5E5E5"> time that I can</font>

467
00:16:40,069 --> 00:16:44,209
<font color="#E5E5E5">find if I just scan for any kind of text</font>

468
00:16:42,379 --> 00:16:45,949
file<font color="#E5E5E5"> there's other ways you can pipe it</font>

469
00:16:44,209 --> 00:16:48,258
<font color="#CCCCCC">there's solutions you can pipe it but if</font>

470
00:16:45,949 --> 00:16:49,920
I<font color="#E5E5E5"> find it in</font><font color="#CCCCCC"> the logs you can remediate</font>

471
00:16:48,259 --> 00:16:51,510
<font color="#CCCCCC">it</font><font color="#E5E5E5"> if you get to a point where I</font>

472
00:16:49,920 --> 00:16:53,729
<font color="#CCCCCC">can't remediated it's something really</font>

473
00:16:51,510 --> 00:16:56,550
<font color="#E5E5E5">weird and custom fine I can tell the log</font>

474
00:16:53,730 --> 00:16:58,920
management<font color="#E5E5E5"> solution this combo of things</font>

475
00:16:56,550 --> 00:17:00,810
don't send<font color="#CCCCCC"> to log management and then I</font>

476
00:16:58,920 --> 00:17:02,519
can't see it and you'll identify the

477
00:17:00,810 --> 00:17:04,409
fact<font color="#CCCCCC"> that it</font><font color="#E5E5E5"> still occurs that box</font>

478
00:17:02,519 --> 00:17:06,990
should<font color="#CCCCCC"> be isolated because the admin</font>

479
00:17:04,410 --> 00:17:08,790
creds are in the clear on<font color="#CCCCCC"> that box so I</font>

480
00:17:06,990 --> 00:17:10,109
don't<font color="#E5E5E5"> have a problem finding passwords</font>

481
00:17:08,790 --> 00:17:12,418
and I<font color="#CCCCCC"> rarely seen</font><font color="#E5E5E5"> this I've been doing</font>

482
00:17:10,109 --> 00:17:14,790
<font color="#CCCCCC">this for</font><font color="#E5E5E5"> 15 years I've come across more</font>

483
00:17:12,419 --> 00:17:16,890
passwords<font color="#E5E5E5"> in</font><font color="#CCCCCC"> user name</font><font color="#E5E5E5"> and fields in the</font>

484
00:17:14,790 --> 00:17:20,159
logs and<font color="#E5E5E5"> I've ever seen in a command</font>

485
00:17:16,890 --> 00:17:22,110
line process and again<font color="#CCCCCC"> the</font><font color="#E5E5E5"> bypassing</font>

486
00:17:20,160 --> 00:17:23,939
with the<font color="#CCCCCC"> v2 stuff this is why v2 so</font>

487
00:17:22,109 --> 00:17:26,309
worthless<font color="#E5E5E5"> now the bad guys have figured</font>

488
00:17:23,939 --> 00:17:28,140
<font color="#E5E5E5">out everything to do even our puppets</font>

489
00:17:26,309 --> 00:17:30,540
and chefs and chocolate ease and bamboos

490
00:17:28,140 --> 00:17:32,669
by default I<font color="#CCCCCC"> actually chewed out</font><font color="#E5E5E5"> one</font><font color="#CCCCCC"> of</font>

491
00:17:30,540 --> 00:17:34,470
the bamboo guys because they execute the

492
00:17:32,669 --> 00:17:35,730
stuff of the - execution policy<font color="#E5E5E5"> so he</font>

493
00:17:34,470 --> 00:17:37,650
started setting off when they deployed

494
00:17:35,730 --> 00:17:39,120
bamboo<font color="#E5E5E5"> they started setting off my alarm</font>

495
00:17:37,650 --> 00:17:42,419
<font color="#E5E5E5">that said any time</font><font color="#CCCCCC"> you see</font><font color="#E5E5E5"> the word -</font>

496
00:17:39,120 --> 00:17:44,129
bypass throw an alarm<font color="#E5E5E5"> and I'm the guys</font>

497
00:17:42,419 --> 00:17:46,110
like under gave us<font color="#E5E5E5"> the script so we had</font>

498
00:17:44,130 --> 00:17:47,669
to<font color="#E5E5E5"> call the</font><font color="#CCCCCC"> third</font><font color="#E5E5E5"> party vendor through</font>

499
00:17:46,110 --> 00:17:50,340
<font color="#E5E5E5">Atlassian and say hey what the hell</font><font color="#CCCCCC"> are</font>

500
00:17:47,669 --> 00:17:51,690
<font color="#E5E5E5">you doing and they said well we do that</font>

501
00:17:50,340 --> 00:17:53,129
so nobody<font color="#E5E5E5"> has to change a configuration</font>

502
00:17:51,690 --> 00:17:55,710
<font color="#CCCCCC">you know this is a complete violation</font>

503
00:17:53,130 --> 00:17:56,970
right and this<font color="#E5E5E5"> is why they changed their</font>

504
00:17:55,710 --> 00:17:58,470
product for<font color="#CCCCCC"> us and gave us one that</font>

505
00:17:56,970 --> 00:18:00,000
didn't do that<font color="#CCCCCC"> and so these are</font><font color="#E5E5E5"> the</font>

506
00:17:58,470 --> 00:18:02,400
<font color="#E5E5E5">conversations you have to have don't</font>

507
00:18:00,000 --> 00:18:04,350
allow good tools to<font color="#E5E5E5"> execute stupid</font>

508
00:18:02,400 --> 00:18:06,780
things<font color="#E5E5E5"> that the hackers do because</font>

509
00:18:04,350 --> 00:18:09,719
you'll end<font color="#E5E5E5"> up excluding the good stuff</font>

510
00:18:06,780 --> 00:18:13,049
and also<font color="#E5E5E5"> the bad stuff</font><font color="#CCCCCC"> so yay for</font>

511
00:18:09,720 --> 00:18:14,970
<font color="#E5E5E5">Microsoft to build in the bypasses and</font>

512
00:18:13,049 --> 00:18:17,129
there's lots of ways<font color="#E5E5E5"> to spell the</font>

513
00:18:14,970 --> 00:18:19,530
bypasses<font color="#E5E5E5"> that's what's worse you don't</font>

514
00:18:17,130 --> 00:18:23,730
<font color="#E5E5E5">have to do the whole word no profile not</font>

515
00:18:19,530 --> 00:18:25,889
will work no<font color="#E5E5E5"> PR will work no PR Oh</font><font color="#CCCCCC"> we'll</font>

516
00:18:23,730 --> 00:18:28,500
work our shell has that autofill

517
00:18:25,890 --> 00:18:32,210
capability which makes it really<font color="#E5E5E5"> hard to</font>

518
00:18:28,500 --> 00:18:34,890
look<font color="#CCCCCC"> forwards</font><font color="#E5E5E5"> but we can deal with that</font>

519
00:18:32,210 --> 00:18:36,630
<font color="#E5E5E5">parallel</font><font color="#CCCCCC"> shell logs</font><font color="#E5E5E5"> and version</font><font color="#CCCCCC"> two and</font>

520
00:18:34,890 --> 00:18:38,309
<font color="#CCCCCC">five you get these lower numbers so the</font>

521
00:18:36,630 --> 00:18:40,260
lower numbers means it's in a Windows

522
00:18:38,309 --> 00:18:42,809
PowerShell log which is<font color="#E5E5E5"> off the roots of</font>

523
00:18:40,260 --> 00:18:45,450
<font color="#CCCCCC">application</font><font color="#E5E5E5"> and services and underneath</font>

524
00:18:42,809 --> 00:18:46,860
Microsoft Windows below that will be the

525
00:18:45,450 --> 00:18:49,350
<font color="#E5E5E5">power show operational logs which has</font>

526
00:18:46,860 --> 00:18:50,850
<font color="#E5E5E5">the larger numbers and so the four</font>

527
00:18:49,350 --> 00:18:52,168
<font color="#E5E5E5">hundred and six hundreds</font><font color="#CCCCCC"> are something</font>

528
00:18:50,850 --> 00:18:53,790
you should<font color="#CCCCCC"> definitely look</font><font color="#E5E5E5"> at the</font><font color="#CCCCCC"> five</font>

529
00:18:52,169 --> 00:18:54,540
<font color="#CCCCCC">hundreds</font><font color="#E5E5E5"> are around with v2 as well</font>

530
00:18:53,790 --> 00:18:55,539
they'll give you the process

531
00:18:54,540 --> 00:18:57,629
<font color="#CCCCCC">command-line</font><font color="#E5E5E5"> but</font>

532
00:18:55,539 --> 00:19:00,340
in the knob the<font color="#CCCCCC"> - knob will bypass</font><font color="#E5E5E5"> that</font>

533
00:18:57,629 --> 00:19:01,748
but it's worth<font color="#CCCCCC"> looking</font><font color="#E5E5E5"> at the</font><font color="#CCCCCC"> four sixes</font>

534
00:19:00,340 --> 00:19:04,299
and eights are something you should

535
00:19:01,749 --> 00:19:06,700
collect<font color="#E5E5E5"> and should focus on and there's</font>

536
00:19:04,299 --> 00:19:08,769
a lot<font color="#CCCCCC"> of</font><font color="#E5E5E5"> duplicates</font><font color="#CCCCCC"> okay because every</font>

537
00:19:06,700 --> 00:19:11,139
<font color="#E5E5E5">time a part</font><font color="#CCCCCC"> of a script executes</font><font color="#E5E5E5"> there's</font>

538
00:19:08,769 --> 00:19:12,609
a<font color="#CCCCCC"> script lit</font><font color="#E5E5E5"> in a script and a command</font>

539
00:19:11,139 --> 00:19:14,228
and a prompt<font color="#E5E5E5"> and so you'll get four</font>

540
00:19:12,609 --> 00:19:16,389
entries or six it's generally six

541
00:19:14,229 --> 00:19:17,289
entries<font color="#E5E5E5"> for the same thing so</font><font color="#CCCCCC"> you have</font>

542
00:19:16,389 --> 00:19:21,100
to learn<font color="#CCCCCC"> how to deep dupe that</font>

543
00:19:17,289 --> 00:19:22,869
<font color="#E5E5E5">information as we call it with Splunk so</font>

544
00:19:21,100 --> 00:19:25,469
web calls well what does a web call look

545
00:19:22,869 --> 00:19:29,289
like in<font color="#E5E5E5"> 46</font><font color="#CCCCCC"> 88 well they look like</font><font color="#E5E5E5"> that</font>

546
00:19:25,470 --> 00:19:31,539
new object systems<font color="#E5E5E5"> dotnet dot web client</font>

547
00:19:29,289 --> 00:19:33,879
dot download<font color="#E5E5E5"> string blah blah blah</font><font color="#CCCCCC"> right</font>

548
00:19:31,539 --> 00:19:35,259
and then HTTP now if they're in the

549
00:19:33,879 --> 00:19:36,939
clear then the buzzwords<font color="#E5E5E5"> that I</font>

550
00:19:35,259 --> 00:19:38,529
mentioned right<font color="#CCCCCC"> here will work you can</font>

551
00:19:36,940 --> 00:19:41,409
set up<font color="#E5E5E5"> an alert that says when I see</font>

552
00:19:38,529 --> 00:19:43,539
this<font color="#E5E5E5"> string or these strings</font><font color="#CCCCCC"> send me an</font>

553
00:19:41,409 --> 00:19:46,149
<font color="#CCCCCC">alert</font><font color="#E5E5E5"> power shells downloading something</font>

554
00:19:43,539 --> 00:19:47,769
that's not<font color="#E5E5E5"> normal</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> if your admins</font>

555
00:19:46,149 --> 00:19:49,178
doing it that<font color="#E5E5E5"> way</font><font color="#CCCCCC"> you'll need</font><font color="#E5E5E5"> to figure</font>

556
00:19:47,769 --> 00:19:51,669
out<font color="#E5E5E5"> exactly what</font><font color="#CCCCCC"> where and whine and</font>

557
00:19:49,179 --> 00:19:53,320
<font color="#CCCCCC">where he's doing it and then set a</font><font color="#E5E5E5"> rule</font>

558
00:19:51,669 --> 00:19:55,749
up that says<font color="#E5E5E5"> okay don't detect it when</font>

559
00:19:53,320 --> 00:19:57,849
<font color="#E5E5E5">this system by this user is doing this</font>

560
00:19:55,749 --> 00:19:59,109
string set<font color="#E5E5E5"> okay and then you can</font><font color="#CCCCCC"> say</font>

561
00:19:57,849 --> 00:20:02,049
throw that out<font color="#CCCCCC"> because then everything</font>

562
00:19:59,109 --> 00:20:05,049
<font color="#E5E5E5">else is bad but</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> problem is there's</font>

563
00:20:02,049 --> 00:20:08,080
<font color="#E5E5E5">lots of ways to spell these like encode</font>

564
00:20:05,049 --> 00:20:11,309
or<font color="#E5E5E5"> encode it okay so you can't just</font><font color="#CCCCCC"> look</font>

565
00:20:08,080 --> 00:20:15,029
for the word dotnet dot<font color="#E5E5E5"> web</font><font color="#CCCCCC"> plan okay</font>

566
00:20:11,309 --> 00:20:17,349
<font color="#CCCCCC">but there are</font><font color="#E5E5E5"> are few stations of that</font>

567
00:20:15,029 --> 00:20:19,419
and here's an<font color="#CCCCCC"> example where they use an</font>

568
00:20:17,349 --> 00:20:21,609
encoded command<font color="#E5E5E5"> and again there's the</font>

569
00:20:19,419 --> 00:20:23,229
encoding and so what<font color="#E5E5E5"> does this mean is</font>

570
00:20:21,609 --> 00:20:25,539
this good or<font color="#CCCCCC"> bad the fact that's encoded</font>

571
00:20:23,229 --> 00:20:27,309
<font color="#E5E5E5">is bad and if you follow the parent tree</font>

572
00:20:25,539 --> 00:20:28,989
if something like again<font color="#E5E5E5"> command shells</font>

573
00:20:27,309 --> 00:20:31,119
calling it from word you know it's bad

574
00:20:28,989 --> 00:20:33,580
<font color="#CCCCCC">but they're</font><font color="#E5E5E5"> doing this in order to try</font>

575
00:20:31,119 --> 00:20:35,559
<font color="#CCCCCC">to get</font><font color="#E5E5E5"> past the defenses the things that</font>

576
00:20:33,580 --> 00:20:37,449
you might<font color="#E5E5E5"> see to me the minute I see</font>

577
00:20:35,559 --> 00:20:39,908
that I'm<font color="#E5E5E5"> like a uppercase lowercase and</font>

578
00:20:37,450 --> 00:20:43,899
<font color="#E5E5E5">a</font><font color="#CCCCCC"> blur</font><font color="#E5E5E5"> our admins to anybody's admins do</font>

579
00:20:39,909 --> 00:20:45,129
this anybody know they just don't so

580
00:20:43,899 --> 00:20:47,289
fetch<font color="#E5E5E5"> that's what they're doing they're</font>

581
00:20:45,129 --> 00:20:49,599
basically<font color="#E5E5E5"> going out and fetching the</font>

582
00:20:47,289 --> 00:20:51,489
item<font color="#E5E5E5"> here's an example of a fetch same</font>

583
00:20:49,599 --> 00:20:54,460
thing I just<font color="#E5E5E5"> showed</font><font color="#CCCCCC"> you but now they've</font>

584
00:20:51,489 --> 00:20:56,830
off you skated it<font color="#E5E5E5"> yay PowerShell lets</font>

585
00:20:54,460 --> 00:20:59,440
you put<font color="#CCCCCC"> tics and carrots</font><font color="#E5E5E5"> in in the</font>

586
00:20:56,830 --> 00:21:01,478
middle<font color="#E5E5E5"> of the words and they ignore them</font>

587
00:20:59,440 --> 00:21:06,399
so now if I want<font color="#CCCCCC"> to look for a web</font>

588
00:21:01,479 --> 00:21:07,149
client<font color="#CCCCCC"> guess what I can't</font><font color="#E5E5E5"> damn it now</font>

589
00:21:06,399 --> 00:21:09,399
what do I do

590
00:21:07,149 --> 00:21:11,949
well you look for the<font color="#E5E5E5"> office keishon</font>

591
00:21:09,400 --> 00:21:14,110
right so here it is<font color="#E5E5E5"> there and here it is</font>

592
00:21:11,950 --> 00:21:16,120
<font color="#E5E5E5">there same thing but in two different</font>

593
00:21:14,110 --> 00:21:18,070
ways<font color="#CCCCCC"> and there it is</font><font color="#E5E5E5"> again some more</font>

594
00:21:16,120 --> 00:21:19,360
<font color="#E5E5E5">information and there it is again more</font>

595
00:21:18,070 --> 00:21:21,760
<font color="#CCCCCC">information you see</font><font color="#E5E5E5"> the download</font><font color="#CCCCCC"> screen</font>

596
00:21:19,360 --> 00:21:23,979
<font color="#E5E5E5">so we want is the ability to take this</font>

597
00:21:21,760 --> 00:21:27,640
and<font color="#CCCCCC"> turn it</font><font color="#E5E5E5"> into this anybody care to</font>

598
00:21:23,980 --> 00:21:28,870
guess how<font color="#E5E5E5"> he did this here's a thought</font>

599
00:21:27,640 --> 00:21:30,520
I read<font color="#E5E5E5"> Jack's out all the special</font>

600
00:21:28,870 --> 00:21:32,229
characters and<font color="#E5E5E5"> then I rewrite it now I</font>

601
00:21:30,520 --> 00:21:34,300
don't<font color="#E5E5E5"> have now I can pass</font><font color="#CCCCCC"> this right</font>

602
00:21:32,230 --> 00:21:36,730
<font color="#E5E5E5">lots of ways</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> can do</font><font color="#CCCCCC"> this in logs</font>

603
00:21:34,300 --> 00:21:38,620
so basically<font color="#CCCCCC"> foreign</font><font color="#E5E5E5"> code that's what we</font>

604
00:21:36,730 --> 00:21:40,840
saw<font color="#E5E5E5"> now one of the things that basic</font><font color="#CCCCCC"> c4</font>

605
00:21:38,620 --> 00:21:42,399
does is often puts an equal<font color="#E5E5E5"> or two</font>

606
00:21:40,840 --> 00:21:44,439
equals into the code there's another

607
00:21:42,400 --> 00:21:45,940
<font color="#E5E5E5">example or you see two equals but if you</font>

608
00:21:44,440 --> 00:21:46,690
do the pasta<font color="#E5E5E5"> if you do the four bites</font>

609
00:21:45,940 --> 00:21:49,090
correctly

610
00:21:46,690 --> 00:21:50,350
there'll be no equal<font color="#E5E5E5"> so you can't just</font>

611
00:21:49,090 --> 00:21:52,120
<font color="#E5E5E5">say</font><font color="#CCCCCC"> well I'll look for anything</font><font color="#E5E5E5"> that has</font>

612
00:21:50,350 --> 00:21:54,780
a bunch<font color="#E5E5E5"> of characters in an equal there</font>

613
00:21:52,120 --> 00:21:57,040
<font color="#E5E5E5">is base64 that will not end in an equal</font>

614
00:21:54,780 --> 00:21:59,649
but the fact that<font color="#E5E5E5"> it's large is an</font>

615
00:21:57,040 --> 00:22:02,139
indicator<font color="#E5E5E5"> and base64 is what a through</font><font color="#CCCCCC"> z</font>

616
00:21:59,650 --> 00:22:04,929
<font color="#E5E5E5">capital a the capital</font><font color="#CCCCCC"> Z</font><font color="#E5E5E5"> zero through</font>

617
00:22:02,140 --> 00:22:07,480
<font color="#E5E5E5">nine okay</font><font color="#CCCCCC"> all the other characters do</font>

618
00:22:04,929 --> 00:22:11,340
not<font color="#E5E5E5"> matter</font><font color="#CCCCCC"> count those and now suddenly</font>

619
00:22:07,480 --> 00:22:11,340
I can trigger<font color="#E5E5E5"> under the tection of this</font>

620
00:22:11,610 --> 00:22:15,428
you can also take<font color="#CCCCCC"> that big</font><font color="#E5E5E5"> blurp right</font>

621
00:22:13,900 --> 00:22:17,440
there go to a site and<font color="#E5E5E5"> say hey please</font>

622
00:22:15,429 --> 00:22:19,890
translate<font color="#E5E5E5"> that right this is kind of how</font>

623
00:22:17,440 --> 00:22:24,309
you do it manually<font color="#E5E5E5"> but you don't need to</font>

624
00:22:19,890 --> 00:22:25,990
because in<font color="#E5E5E5"> PowerShell v5 there's a 4104</font>

625
00:22:24,309 --> 00:22:29,710
called module logging and guess what it

626
00:22:25,990 --> 00:22:31,960
does<font color="#CCCCCC"> it translates that base64 into what</font>

627
00:22:29,710 --> 00:22:34,390
we can read so the translation occurs

628
00:22:31,960 --> 00:22:36,130
automatically in<font color="#CCCCCC"> the logs and yes you</font>

629
00:22:34,390 --> 00:22:37,330
have<font color="#E5E5E5"> to enable module logging it's one</font>

630
00:22:36,130 --> 00:22:39,340
of the<font color="#E5E5E5"> settings</font><font color="#CCCCCC"> in the cheat sheet</font><font color="#E5E5E5"> and</font>

631
00:22:37,330 --> 00:22:41,678
now suddenly I can see things<font color="#E5E5E5"> that</font><font color="#CCCCCC"> are</font>

632
00:22:39,340 --> 00:22:43,149
odd<font color="#CCCCCC"> I can see that</font><font color="#E5E5E5"> you know kill power</font>

633
00:22:41,679 --> 00:22:45,370
<font color="#CCCCCC">show</font><font color="#E5E5E5"> so when I</font><font color="#CCCCCC"> launch</font><font color="#E5E5E5"> this thing did</font>

634
00:22:43,150 --> 00:22:46,720
your powers did your<font color="#CCCCCC"> Excel die yes</font><font color="#E5E5E5"> and</font>

635
00:22:45,370 --> 00:22:48,909
guess what it<font color="#E5E5E5"> went out and saw that</font>

636
00:22:46,720 --> 00:22:51,760
download of that<font color="#CCCCCC"> Mauer</font><font color="#E5E5E5"> suddenly now I</font>

637
00:22:48,910 --> 00:22:53,020
can read it because<font color="#CCCCCC"> the decode occurred</font>

638
00:22:51,760 --> 00:22:55,570
when it<font color="#E5E5E5"> actually got written to the log</font>

639
00:22:53,020 --> 00:22:57,160
so thank you Microsoft and you can see

640
00:22:55,570 --> 00:23:00,639
<font color="#E5E5E5">down here and now read the fact that web</font>

641
00:22:57,160 --> 00:23:02,350
client is going<font color="#E5E5E5"> on so</font><font color="#CCCCCC"> very cool</font><font color="#E5E5E5"> so in</font>

642
00:23:00,640 --> 00:23:04,570
fact that<font color="#CCCCCC"> he codes it now means</font><font color="#E5E5E5"> I can</font>

643
00:23:02,350 --> 00:23:05,800
take<font color="#CCCCCC"> a</font><font color="#E5E5E5"> blurp that I can't understand and</font>

644
00:23:04,570 --> 00:23:08,530
<font color="#E5E5E5">I can have suddenly looks like a now</font>

645
00:23:05,800 --> 00:23:10,629
suddenly<font color="#CCCCCC"> read it that's</font><font color="#E5E5E5"> the cool part so</font>

646
00:23:08,530 --> 00:23:13,059
this is why<font color="#E5E5E5"> 4104 s are so important and</font>

647
00:23:10,630 --> 00:23:14,559
why<font color="#CCCCCC"> powershell 5 is so important</font><font color="#E5E5E5"> stuff</font>

648
00:23:13,059 --> 00:23:16,010
<font color="#CCCCCC">that they're trying</font><font color="#E5E5E5"> to do and get my</font>

649
00:23:14,559 --> 00:23:17,629
<font color="#E5E5E5">suddenly</font><font color="#CCCCCC"> nows decode</font>

650
00:23:16,010 --> 00:23:20,600
in your logs<font color="#E5E5E5"> and you don't have to do</font>

651
00:23:17,630 --> 00:23:22,280
<font color="#E5E5E5">anything other than</font><font color="#CCCCCC"> enable it</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> let's</font>

652
00:23:20,600 --> 00:23:24,350
<font color="#CCCCCC">look at</font><font color="#E5E5E5"> that base64</font><font color="#CCCCCC"> blob here's an</font>

653
00:23:22,280 --> 00:23:26,440
example of one that<font color="#E5E5E5"> has two</font><font color="#CCCCCC"> equal signs</font>

654
00:23:24,350 --> 00:23:28,730
right<font color="#E5E5E5"> big-ass blob what does it do</font>

655
00:23:26,440 --> 00:23:31,250
<font color="#E5E5E5">here's an example of a whom you output</font>

656
00:23:28,730 --> 00:23:33,919
where I'm actually<font color="#E5E5E5"> counting the base64</font>

657
00:23:31,250 --> 00:23:36,559
block so I have an alert that says<font color="#E5E5E5"> if</font>

658
00:23:33,919 --> 00:23:40,100
you are a through Z a through Z<font color="#CCCCCC"> 0</font>

659
00:23:36,559 --> 00:23:42,040
through<font color="#CCCCCC"> 9</font><font color="#E5E5E5"> and you're above 50 60 100 200</font>

660
00:23:40,100 --> 00:23:45,469
<font color="#E5E5E5">I think I got a set around 500</font>

661
00:23:42,040 --> 00:23:48,500
<font color="#E5E5E5">characters</font><font color="#CCCCCC"> then take that</font><font color="#E5E5E5"> block call it</font>

662
00:23:45,470 --> 00:23:50,510
block and then I go look at the<font color="#CCCCCC"> 40 104</font>

663
00:23:48,500 --> 00:23:51,830
message<font color="#E5E5E5"> and I can now see what the</font><font color="#CCCCCC"> heck</font>

664
00:23:50,510 --> 00:23:53,750
it does and they're still<font color="#E5E5E5"> trying to off</font>

665
00:23:51,830 --> 00:23:56,240
you<font color="#CCCCCC"> skate stuff there's some combination</font>

666
00:23:53,750 --> 00:23:57,830
of IP address in<font color="#E5E5E5"> here probably</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> you</font>

667
00:23:56,240 --> 00:24:00,110
can see now we got<font color="#E5E5E5"> assistant lot</font>

668
00:23:57,830 --> 00:24:01,129
management automation<font color="#E5E5E5"> PS credentials so</font>

669
00:24:00,110 --> 00:24:02,840
we now knew they're doing<font color="#E5E5E5"> if they're</font>

670
00:24:01,130 --> 00:24:04,730
doing creds<font color="#CCCCCC"> this is</font><font color="#E5E5E5"> probably something</font>

671
00:24:02,840 --> 00:24:06,980
<font color="#CCCCCC">to do</font><font color="#E5E5E5"> with the cred and then convert</font><font color="#CCCCCC"> to</font>

672
00:24:04,730 --> 00:24:08,890
secure string etc<font color="#CCCCCC"> etc right suddenly now</font>

673
00:24:06,980 --> 00:24:13,240
we can see stuff so this<font color="#E5E5E5"> is who we are</font>

674
00:24:08,890 --> 00:24:16,760
<font color="#E5E5E5">BAM that's what we're after</font><font color="#CCCCCC"> right there</font>

675
00:24:13,240 --> 00:24:19,100
so 46<font color="#CCCCCC"> 88</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> 40 104 is 46</font><font color="#E5E5E5"> eighty eight's</font>

676
00:24:16,760 --> 00:24:20,929
won't decode anything the 4104 will show

677
00:24:19,100 --> 00:24:23,719
you the<font color="#CCCCCC"> powershell decode decoding and</font>

678
00:24:20,929 --> 00:24:25,370
then the 400s<font color="#CCCCCC"> are in the older version</font>

679
00:24:23,720 --> 00:24:27,140
of PowerShell but used in the newer new

680
00:24:25,370 --> 00:24:29,840
ones as<font color="#E5E5E5"> well so let's look at a few</font>

681
00:24:27,140 --> 00:24:30,919
station and what we can see in those you

682
00:24:29,840 --> 00:24:33,860
soften the big blurps

683
00:24:30,919 --> 00:24:35,390
hey if it's base64 it's a big blur

684
00:24:33,860 --> 00:24:37,459
there's nothing special<font color="#E5E5E5"> other than the</font>

685
00:24:35,390 --> 00:24:39,410
size and the lack of<font color="#E5E5E5"> other characters in</font>

686
00:24:37,460 --> 00:24:41,480
it and the way they call it but that can

687
00:24:39,410 --> 00:24:42,710
<font color="#CCCCCC">be off you skated the obfuscation are</font>

688
00:24:41,480 --> 00:24:44,840
the use of<font color="#E5E5E5"> these funny characters</font>

689
00:24:42,710 --> 00:24:47,059
including carrots and<font color="#CCCCCC"> tics and pluses</font>

690
00:24:44,840 --> 00:24:48,110
right they'll take this and this and

691
00:24:47,059 --> 00:24:49,879
<font color="#E5E5E5">they'll put this together and</font><font color="#CCCCCC"> they'll</font>

692
00:24:48,110 --> 00:24:52,370
<font color="#E5E5E5">make up the word PowerShell so that you</font>

693
00:24:49,880 --> 00:24:57,020
can't<font color="#E5E5E5"> use buzzword checks you know my</font>

694
00:24:52,370 --> 00:24:58,340
trigger for - not -<font color="#E5E5E5"> no profile - exp -</font>

695
00:24:57,020 --> 00:25:00,080
execution policy<font color="#E5E5E5"> but they're not working</font>

696
00:24:58,340 --> 00:25:01,879
<font color="#CCCCCC">because they keep putting</font><font color="#E5E5E5"> ticks in there</font>

697
00:25:00,080 --> 00:25:04,070
and that's<font color="#CCCCCC"> the idea that's</font><font color="#E5E5E5"> what they're</font>

698
00:25:01,880 --> 00:25:05,929
<font color="#E5E5E5">trying to break and they use dollars and</font>

699
00:25:04,070 --> 00:25:08,120
percentages<font color="#E5E5E5"> for variables and whatnot</font><font color="#CCCCCC"> so</font>

700
00:25:05,929 --> 00:25:11,690
<font color="#CCCCCC">what you're focusing here on</font><font color="#E5E5E5"> is the odd</font>

701
00:25:08,120 --> 00:25:14,809
characters<font color="#E5E5E5"> surprisingly it's not that</font>

702
00:25:11,690 --> 00:25:16,340
bad<font color="#CCCCCC"> it's there's all the</font><font color="#E5E5E5"> things they can</font>

703
00:25:14,809 --> 00:25:18,230
<font color="#CCCCCC">do if you really want to see what</font><font color="#E5E5E5"> can be</font>

704
00:25:16,340 --> 00:25:20,000
<font color="#E5E5E5">done with a few station go watch Daniel</font>

705
00:25:18,230 --> 00:25:22,340
<font color="#CCCCCC">Bohannon's talk on PowerShell off you</font>

706
00:25:20,000 --> 00:25:24,169
station and you can<font color="#CCCCCC"> thank him for this</font>

707
00:25:22,340 --> 00:25:26,959
stuff<font color="#CCCCCC"> actually you should</font><font color="#E5E5E5"> probably refer</font>

708
00:25:24,169 --> 00:25:28,850
to him<font color="#CCCCCC"> as</font><font color="#E5E5E5"> this because of the fact that</font>

709
00:25:26,960 --> 00:25:29,540
<font color="#E5E5E5">that's how he's trying to teach you how</font>

710
00:25:28,850 --> 00:25:31,939
to write power

711
00:25:29,540 --> 00:25:34,879
pwnage but the fact that you're<font color="#E5E5E5"> doing</font>

712
00:25:31,940 --> 00:25:36,350
this<font color="#E5E5E5"> is very detectable because what</font>

713
00:25:34,880 --> 00:25:39,470
happens if I<font color="#CCCCCC"> start counting those</font>

714
00:25:36,350 --> 00:25:41,510
characters<font color="#E5E5E5"> suddenly this code on the</font>

715
00:25:39,470 --> 00:25:43,730
<font color="#CCCCCC">Left</font><font color="#E5E5E5"> which clearly looks funky to me</font><font color="#CCCCCC"> I</font>

716
00:25:41,510 --> 00:25:44,840
can now<font color="#CCCCCC"> take out all the special</font>

717
00:25:43,730 --> 00:25:47,090
characters remember when I said I

718
00:25:44,840 --> 00:25:48,409
stripped it out and then I reposted<font color="#E5E5E5"> it</font>

719
00:25:47,090 --> 00:25:50,840
that's how I got the difference of

720
00:25:48,410 --> 00:25:52,880
obfuscated<font color="#E5E5E5"> and not now that my buzzword</font>

721
00:25:50,840 --> 00:25:54,530
checks will work<font color="#CCCCCC"> I strip out all</font><font color="#E5E5E5"> the</font>

722
00:25:52,880 --> 00:25:56,510
known characters so now<font color="#E5E5E5"> this stuff gets</font>

723
00:25:54,530 --> 00:25:58,580
crammed together<font color="#E5E5E5"> unless they've done</font>

724
00:25:56,510 --> 00:25:59,720
some other rearranging and things and I

725
00:25:58,580 --> 00:26:01,429
<font color="#E5E5E5">count it look there's</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> hundred</font><font color="#CCCCCC"> and</font>

726
00:25:59,720 --> 00:26:03,890
<font color="#CCCCCC">thirty-eight ticks and two hundred and</font>

727
00:26:01,430 --> 00:26:06,320
<font color="#CCCCCC">sixty-four</font><font color="#E5E5E5"> pluses I defy you to find a</font>

728
00:26:03,890 --> 00:26:08,510
legitimate<font color="#E5E5E5"> PowerShell usage that does</font>

729
00:26:06,320 --> 00:26:09,770
that<font color="#E5E5E5"> this is how you can catch those</font>

730
00:26:08,510 --> 00:26:13,460
kinds of scenarios

731
00:26:09,770 --> 00:26:14,930
I cannot read it but<font color="#E5E5E5"> I definitely can</font>

732
00:26:13,460 --> 00:26:17,660
<font color="#E5E5E5">see there's ticks in it so there's</font>

733
00:26:14,930 --> 00:26:20,720
something<font color="#E5E5E5"> more to do it's very very</font>

734
00:26:17,660 --> 00:26:23,150
telling<font color="#E5E5E5"> once you isolate</font><font color="#CCCCCC"> that so here's</font>

735
00:26:20,720 --> 00:26:25,670
an example<font color="#E5E5E5"> of one as well this is normal</font>

736
00:26:23,150 --> 00:26:27,650
I<font color="#E5E5E5"> can read this data and inside the data</font>

737
00:26:25,670 --> 00:26:29,660
are the typical back slashes<font color="#E5E5E5"> and things</font>

738
00:26:27,650 --> 00:26:31,850
you<font color="#E5E5E5"> can see now this</font><font color="#CCCCCC"> is actually</font><font color="#E5E5E5"> you you</font>

739
00:26:29,660 --> 00:26:33,980
read all this right so users<font color="#E5E5E5"> hack me app</font>

740
00:26:31,850 --> 00:26:35,870
data<font color="#E5E5E5"> so lots of back slashes</font><font color="#CCCCCC"> a few</font>

741
00:26:33,980 --> 00:26:37,730
parents<font color="#CCCCCC"> and so now suddenly you can see</font>

742
00:26:35,870 --> 00:26:40,520
the<font color="#CCCCCC"> makeup</font><font color="#E5E5E5"> between what a normal</font>

743
00:26:37,730 --> 00:26:43,100
<font color="#E5E5E5">scenario</font><font color="#CCCCCC"> count looks</font><font color="#E5E5E5"> like right</font><font color="#CCCCCC"> twenty</font>

744
00:26:40,520 --> 00:26:45,740
<font color="#CCCCCC">two and three and</font><font color="#E5E5E5"> the makeup of it and</font>

745
00:26:43,100 --> 00:26:48,530
what bad looks like big huge<font color="#CCCCCC"> difference</font>

746
00:26:45,740 --> 00:26:50,330
<font color="#CCCCCC">very obvious so in your</font><font color="#E5E5E5"> log management</font>

747
00:26:48,530 --> 00:26:53,870
<font color="#E5E5E5">solutions a little bit of</font><font color="#CCCCCC"> regex</font><font color="#E5E5E5"> you can</font>

748
00:26:50,330 --> 00:26:54,919
detect<font color="#E5E5E5"> this very easily and</font><font color="#CCCCCC"> you can</font><font color="#E5E5E5"> do</font>

749
00:26:53,870 --> 00:26:56,209
<font color="#E5E5E5">that with all over</font><font color="#CCCCCC"> forty six eighty</font>

750
00:26:54,920 --> 00:26:57,980
eight's because they'll put the<font color="#E5E5E5"> ticks on</font>

751
00:26:56,210 --> 00:26:59,780
<font color="#E5E5E5">there the 4104 is like the last slide</font>

752
00:26:57,980 --> 00:27:01,700
<font color="#CCCCCC">and also the 400 so it depends what</font>

753
00:26:59,780 --> 00:27:02,660
version<font color="#CCCCCC"> powershell same example</font><font color="#E5E5E5"> savings</font>

754
00:27:01,700 --> 00:27:04,520
after<font color="#CCCCCC"> the last one</font>

755
00:27:02,660 --> 00:27:06,560
same thing load tick<font color="#E5E5E5"> count</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> four</font>

756
00:27:04,520 --> 00:27:08,090
<font color="#CCCCCC">hundred</font><font color="#E5E5E5"> event</font><font color="#CCCCCC"> and you should look at all</font>

757
00:27:06,560 --> 00:27:10,540
<font color="#CCCCCC">of these because they all do something</font>

758
00:27:08,090 --> 00:27:13,610
<font color="#E5E5E5">slightly different in in the powershell</font>

759
00:27:10,540 --> 00:27:15,590
so script<font color="#CCCCCC"> by logging powershell is</font>

760
00:27:13,610 --> 00:27:18,110
broken<font color="#E5E5E5"> up in these blocks of script</font>

761
00:27:15,590 --> 00:27:20,030
you'll see one<font color="#E5E5E5"> is 6 2</font><font color="#CCCCCC"> is 6 3</font><font color="#E5E5E5"> 6 or 6 etc</font>

762
00:27:18,110 --> 00:27:21,530
<font color="#E5E5E5">and in those they do different functions</font>

763
00:27:20,030 --> 00:27:23,180
<font color="#CCCCCC">this</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> how you'll see your bamboos and</font>

764
00:27:21,530 --> 00:27:25,460
<font color="#CCCCCC">your chocolate YZ</font><font color="#E5E5E5"> and all those work</font>

765
00:27:23,180 --> 00:27:27,740
<font color="#E5E5E5">right big long ass scripts then it get</font>

766
00:27:25,460 --> 00:27:29,030
<font color="#E5E5E5">broken up based by functions but the</font>

767
00:27:27,740 --> 00:27:30,830
cool thing<font color="#E5E5E5"> is it tells you right at the</font>

768
00:27:29,030 --> 00:27:33,320
top the<font color="#CCCCCC"> thing hey i'm a script lock and</font>

769
00:27:30,830 --> 00:27:36,740
i'm i am one up in this case 101<font color="#E5E5E5"> here's</font>

770
00:27:33,320 --> 00:27:39,560
my my strip for turning on file auditing

771
00:27:36,740 --> 00:27:41,049
in<font color="#E5E5E5"> powershell and and so it tells you it</font>

772
00:27:39,560 --> 00:27:43,590
gives you<font color="#E5E5E5"> an indication this is going on</font>

773
00:27:41,049 --> 00:27:47,049
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> and in this</font><font color="#E5E5E5"> case it's a verbose log</font>

774
00:27:43,590 --> 00:27:48,519
<font color="#E5E5E5">it's not a warning or</font><font color="#CCCCCC"> anything else</font><font color="#E5E5E5"> but</font>

775
00:27:47,049 --> 00:27:51,759
<font color="#E5E5E5">the cool</font><font color="#CCCCCC"> thing is</font><font color="#E5E5E5"> when they do trigger</font>

776
00:27:48,519 --> 00:27:53,379
these script blocks<font color="#E5E5E5"> they're big okay</font><font color="#CCCCCC"> now</font>

777
00:27:51,759 --> 00:27:56,080
if I saw<font color="#E5E5E5"> this just from looking at data</font>

778
00:27:53,379 --> 00:27:57,399
but this<font color="#CCCCCC"> isn't very</font><font color="#E5E5E5"> useful to me</font><font color="#CCCCCC"> because</font>

779
00:27:56,080 --> 00:27:59,769
of<font color="#E5E5E5"> the fact it's so big</font>

780
00:27:57,399 --> 00:28:02,080
if you output this<font color="#E5E5E5"> to</font><font color="#CCCCCC"> excel your your</font>

781
00:27:59,769 --> 00:28:03,639
your rows gonna be<font color="#E5E5E5"> this tall</font><font color="#CCCCCC"> it's really</font>

782
00:28:02,080 --> 00:28:06,580
hard to manipulate<font color="#E5E5E5"> so what you have to</font>

783
00:28:03,639 --> 00:28:08,408
<font color="#E5E5E5">do is say what can I look at well</font><font color="#CCCCCC"> if you</font>

784
00:28:06,580 --> 00:28:10,629
look right<font color="#CCCCCC"> here I'm counting the command</font>

785
00:28:08,409 --> 00:28:13,690
<font color="#E5E5E5">length</font><font color="#CCCCCC"> so now I have a trigger about how</font>

786
00:28:10,629 --> 00:28:16,119
long<font color="#E5E5E5"> I have an office keishon to count</font>

787
00:28:13,690 --> 00:28:18,009
how many<font color="#E5E5E5"> pluses ticks everything else so</font>

788
00:28:16,119 --> 00:28:20,799
the<font color="#E5E5E5"> combination of all these</font><font color="#CCCCCC"> events I've</font>

789
00:28:18,009 --> 00:28:23,049
got a big block<font color="#E5E5E5"> it violates the counts</font>

790
00:28:20,799 --> 00:28:26,379
<font color="#E5E5E5">that I'm looking</font><font color="#CCCCCC"> for they exceed 5 50</font>

791
00:28:23,049 --> 00:28:28,269
100 200 etc I<font color="#E5E5E5"> suddenly can not only look</font>

792
00:28:26,379 --> 00:28:30,369
<font color="#E5E5E5">at a big script block in the</font><font color="#CCCCCC"> sighs I</font>

793
00:28:28,269 --> 00:28:31,929
have a secondary mechanism says and it's

794
00:28:30,369 --> 00:28:34,779
off you skated trying to do something

795
00:28:31,929 --> 00:28:36,549
<font color="#E5E5E5">funky</font><font color="#CCCCCC"> okay</font><font color="#E5E5E5"> and so that's the cool</font><font color="#CCCCCC"> thing</font>

796
00:28:34,779 --> 00:28:39,879
I would say start at<font color="#CCCCCC"> about a thousand</font>

797
00:28:36,549 --> 00:28:41,918
<font color="#E5E5E5">you will get false</font><font color="#CCCCCC"> positives real real</font>

798
00:28:39,879 --> 00:28:44,649
stuff that executed very large blocks

799
00:28:41,919 --> 00:28:46,259
like a bamboo<font color="#E5E5E5"> chocolaty etc but that's</font>

800
00:28:44,649 --> 00:28:48,459
<font color="#CCCCCC">okay we'll talk</font><font color="#E5E5E5"> about</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> in a second</font>

801
00:28:46,259 --> 00:28:52,450
<font color="#E5E5E5">so this is one</font><font color="#CCCCCC"> of those normal big</font>

802
00:28:48,460 --> 00:28:55,629
blocks<font color="#E5E5E5"> this is</font><font color="#CCCCCC"> big</font><font color="#E5E5E5"> but guess what</font><font color="#CCCCCC"> I can</font>

803
00:28:52,450 --> 00:28:57,279
actually read that but I<font color="#E5E5E5"> don't know if</font>

804
00:28:55,629 --> 00:28:59,709
it's being used<font color="#CCCCCC"> for</font><font color="#E5E5E5"> good or for bad</font>

805
00:28:57,279 --> 00:29:01,179
<font color="#E5E5E5">that's the problem with the hackers the</font>

806
00:28:59,710 --> 00:29:03,369
pen testers will do this the hackers

807
00:29:01,179 --> 00:29:05,169
will also do<font color="#E5E5E5"> this they can use the real</font>

808
00:29:03,369 --> 00:29:07,059
normal<font color="#E5E5E5"> I'm just gonna query the</font><font color="#CCCCCC"> system</font>

809
00:29:05,169 --> 00:29:08,499
like for inventory<font color="#E5E5E5"> so I wouldn't be able</font>

810
00:29:07,059 --> 00:29:10,029
<font color="#E5E5E5">to tell if this</font><font color="#CCCCCC"> is an inventory script</font>

811
00:29:08,499 --> 00:29:11,590
<font color="#E5E5E5">or whether the bad guys trying to</font>

812
00:29:10,029 --> 00:29:13,509
<font color="#CCCCCC">inventory</font><font color="#E5E5E5"> our system because he just</font>

813
00:29:11,590 --> 00:29:14,859
wrote a PowerShell<font color="#E5E5E5"> script or</font><font color="#CCCCCC"> pulled the</font>

814
00:29:13,509 --> 00:29:16,450
one down<font color="#E5E5E5"> from the internet that doesn't</font>

815
00:29:14,859 --> 00:29:18,939
inventory<font color="#E5E5E5"> that someone wrote and just</font>

816
00:29:16,450 --> 00:29:21,399
executed in your system<font color="#E5E5E5"> but it's bad or</font>

817
00:29:18,940 --> 00:29:23,200
it's being<font color="#E5E5E5"> used for bad but it's big but</font>

818
00:29:21,399 --> 00:29:25,238
it looks<font color="#CCCCCC"> normal so we have to</font><font color="#E5E5E5"> figure out</font>

819
00:29:23,200 --> 00:29:27,369
what the combination<font color="#CCCCCC"> in</font><font color="#E5E5E5"> this case this</font>

820
00:29:25,239 --> 00:29:30,909
one is<font color="#E5E5E5"> ninety five hundred</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> fifty</font>

821
00:29:27,369 --> 00:29:33,129
three large pretty big the big

822
00:29:30,909 --> 00:29:36,970
difference is that<font color="#CCCCCC"> one's readable that</font>

823
00:29:33,129 --> 00:29:39,998
one is not so<font color="#E5E5E5"> suddenly large size means</font>

824
00:29:36,970 --> 00:29:41,590
it's readable or not and this one has

825
00:29:39,999 --> 00:29:43,989
<font color="#E5E5E5">ticks right so we know we</font><font color="#CCCCCC"> can identify</font>

826
00:29:41,590 --> 00:29:46,238
<font color="#CCCCCC">that so now we have to determine</font><font color="#E5E5E5"> how do</font>

827
00:29:43,989 --> 00:29:50,499
we separate readable good script blocks

828
00:29:46,239 --> 00:29:51,789
from readable bad script<font color="#CCCCCC"> blocks well</font>

829
00:29:50,499 --> 00:29:53,020
though office<font color="#CCCCCC"> gate it like I just</font><font color="#E5E5E5"> showed</font>

830
00:29:51,789 --> 00:29:57,100
<font color="#CCCCCC">you in the last one 100</font>

831
00:29:53,020 --> 00:29:58,750
<font color="#CCCCCC">38 tick counts</font><font color="#E5E5E5"> 230 264 pluses</font>

832
00:29:57,100 --> 00:29:59,919
boom here's all this code you can see

833
00:29:58,750 --> 00:30:02,590
<font color="#E5E5E5">down here there's some normal ones</font>

834
00:29:59,920 --> 00:30:04,630
<font color="#E5E5E5">that's bad</font><font color="#CCCCCC"> these two</font><font color="#E5E5E5"> little short guys</font>

835
00:30:02,590 --> 00:30:05,889
are good small counts<font color="#E5E5E5"> so now you can see</font>

836
00:30:04,630 --> 00:30:07,930
all<font color="#E5E5E5"> three of these examples I've shown</font>

837
00:30:05,890 --> 00:30:08,980
<font color="#CCCCCC">thus far together</font><font color="#E5E5E5"> what do you do you</font>

838
00:30:07,930 --> 00:30:10,510
think<font color="#CCCCCC"> that would stick out to you and</font>

839
00:30:08,980 --> 00:30:14,100
<font color="#E5E5E5">all you</font><font color="#CCCCCC"> think that'd be</font><font color="#E5E5E5"> something to</font>

840
00:30:10,510 --> 00:30:16,450
focus<font color="#E5E5E5"> on</font><font color="#CCCCCC"> they're definitely</font><font color="#E5E5E5"> module</font><font color="#CCCCCC"> Augie</font>

841
00:30:14,100 --> 00:30:18,909
<font color="#CCCCCC">this is cool</font><font color="#E5E5E5"> because in module Augie</font>

842
00:30:16,450 --> 00:30:21,040
<font color="#E5E5E5">when you execute something in PowerShell</font>

843
00:30:18,910 --> 00:30:23,170
that violates a<font color="#CCCCCC"> built-in partial rule</font>

844
00:30:21,040 --> 00:30:25,120
and and I've been<font color="#E5E5E5"> doing logging a long</font>

845
00:30:23,170 --> 00:30:27,550
time I generally tell people<font color="#E5E5E5"> that the</font>

846
00:30:25,120 --> 00:30:29,219
level of<font color="#E5E5E5"> the log just ignored it it</font>

847
00:30:27,550 --> 00:30:31,930
<font color="#E5E5E5">rarely is an indicator of anything</font>

848
00:30:29,220 --> 00:30:34,720
except in PowerShell<font color="#E5E5E5"> Microsoft at least</font>

849
00:30:31,930 --> 00:30:37,270
says hey there's a violation<font color="#E5E5E5"> that's</font>

850
00:30:34,720 --> 00:30:39,940
executed yeah<font color="#E5E5E5"> I think I can figure out</font>

851
00:30:37,270 --> 00:30:42,850
the violation it's all that crap right

852
00:30:39,940 --> 00:30:45,100
<font color="#CCCCCC">and so pay attention</font><font color="#E5E5E5"> to the fact that in</font>

853
00:30:42,850 --> 00:30:47,620
<font color="#E5E5E5">these event logs there are warnings in a</font>

854
00:30:45,100 --> 00:30:50,199
couple of<font color="#E5E5E5"> n IDs and they will help</font>

855
00:30:47,620 --> 00:30:52,419
<font color="#CCCCCC">direct you another item you can focus on</font>

856
00:30:50,200 --> 00:30:55,090
to say this is potentially bad

857
00:30:52,420 --> 00:30:57,130
PowerShell<font color="#CCCCCC"> I got a warning does it have</font>

858
00:30:55,090 --> 00:30:59,159
a large tick<font color="#E5E5E5"> count yes does</font><font color="#CCCCCC"> it have a</font>

859
00:30:57,130 --> 00:31:02,020
large block count<font color="#E5E5E5"> yes does it have</font>

860
00:30:59,160 --> 00:31:04,000
base64 no let's look<font color="#E5E5E5"> at it let's see</font>

861
00:31:02,020 --> 00:31:06,430
what's gonna do so thank<font color="#E5E5E5"> you for that</font>

862
00:31:04,000 --> 00:31:09,850
<font color="#E5E5E5">finally a warning that's</font><font color="#CCCCCC"> worthwhile in</font>

863
00:31:06,430 --> 00:31:11,440
<font color="#E5E5E5">Windows</font><font color="#CCCCCC"> and this is what actually</font>

864
00:31:09,850 --> 00:31:13,000
triggered a warning on so there you<font color="#CCCCCC"> can</font>

865
00:31:11,440 --> 00:31:15,340
<font color="#E5E5E5">see it right at the top pink right there</font>

866
00:31:13,000 --> 00:31:17,770
<font color="#CCCCCC">warning and here's that badge</font>

867
00:31:15,340 --> 00:31:19,179
<font color="#CCCCCC">lupa script so now we're</font><font color="#E5E5E5"> starting to put</font>

868
00:31:17,770 --> 00:31:21,550
<font color="#CCCCCC">all the pieces together look for</font>

869
00:31:19,180 --> 00:31:24,550
warnings large blocks off<font color="#E5E5E5"> you station</font>

870
00:31:21,550 --> 00:31:25,930
etc this<font color="#CCCCCC"> is definitely</font><font color="#E5E5E5"> bad this does not</font>

871
00:31:24,550 --> 00:31:28,270
<font color="#E5E5E5">look normal</font>

872
00:31:25,930 --> 00:31:30,280
no way<font color="#CCCCCC"> nohow and so here's what it looks</font>

873
00:31:28,270 --> 00:31:32,200
like in the<font color="#CCCCCC"> actual</font><font color="#E5E5E5"> event log itself you</font>

874
00:31:30,280 --> 00:31:33,790
can<font color="#E5E5E5"> see the word warning and so it's</font>

875
00:31:32,200 --> 00:31:36,730
<font color="#E5E5E5">flunk you would basically say level</font>

876
00:31:33,790 --> 00:31:38,620
equals warning<font color="#E5E5E5"> you know event ID 4104</font>

877
00:31:36,730 --> 00:31:40,300
<font color="#CCCCCC">bam give me a table</font><font color="#E5E5E5"> of the output and</font>

878
00:31:38,620 --> 00:31:43,149
then you have an idea what's going on

879
00:31:40,300 --> 00:31:45,960
okay<font color="#E5E5E5"> and there's the actual back end</font>

880
00:31:43,150 --> 00:31:48,490
data<font color="#E5E5E5"> warning warning</font>

881
00:31:45,960 --> 00:31:50,620
so warning<font color="#E5E5E5"> what do you know actually</font>

882
00:31:48,490 --> 00:31:52,750
something<font color="#CCCCCC"> you</font><font color="#E5E5E5"> can use and you</font><font color="#CCCCCC"> can</font><font color="#E5E5E5"> also</font>

883
00:31:50,620 --> 00:31:55,719
see translations in<font color="#CCCCCC"> the</font><font color="#E5E5E5"> PowerShell</font>

884
00:31:52,750 --> 00:31:57,820
operational log for the event ID<font color="#E5E5E5"> 4100 it</font>

885
00:31:55,720 --> 00:31:59,530
will take some of<font color="#CCCCCC"> that data</font><font color="#E5E5E5"> again a</font>

886
00:31:57,820 --> 00:32:02,350
violation of a power strong rule<font color="#E5E5E5"> that</font>

887
00:31:59,530 --> 00:32:03,580
<font color="#CCCCCC">Microsoft says we're executed this</font><font color="#E5E5E5"> but</font>

888
00:32:02,350 --> 00:32:04,959
there's<font color="#E5E5E5"> something not right</font><font color="#CCCCCC"> about it and</font>

889
00:32:03,580 --> 00:32:05,810
<font color="#E5E5E5">unfortunately don't tell you what the</font>

890
00:32:04,960 --> 00:32:07,820
<font color="#CCCCCC">violation is</font>

891
00:32:05,810 --> 00:32:09,620
but suddenly you can<font color="#E5E5E5"> any right here</font>

892
00:32:07,820 --> 00:32:11,600
missing closing<font color="#CCCCCC"> in expression there's</font>

893
00:32:09,620 --> 00:32:13,010
some there's<font color="#CCCCCC"> some data in here but it</font>

894
00:32:11,600 --> 00:32:14,240
doesn't<font color="#CCCCCC"> help</font><font color="#E5E5E5"> just a warning</font><font color="#CCCCCC"> but this</font>

895
00:32:13,010 --> 00:32:16,670
thing did execute<font color="#CCCCCC"> it did the Box</font>

896
00:32:14,240 --> 00:32:17,990
definitely got<font color="#E5E5E5"> affected right but it</font>

897
00:32:16,670 --> 00:32:20,030
<font color="#E5E5E5">translated some</font><font color="#CCCCCC"> of the stuff that</font>

898
00:32:17,990 --> 00:32:22,550
executed in the course of that link

899
00:32:20,030 --> 00:32:23,960
burps of<font color="#CCCCCC"> plusses</font><font color="#E5E5E5"> you know all blah blah</font>

900
00:32:22,550 --> 00:32:26,060
<font color="#E5E5E5">blah</font><font color="#CCCCCC"> blah plus plus plus plus plus plus</font>

901
00:32:23,960 --> 00:32:27,410
<font color="#E5E5E5">boom</font><font color="#CCCCCC"> and it's trying to give you an</font>

902
00:32:26,060 --> 00:32:29,870
indication<font color="#E5E5E5"> of what happened in</font><font color="#CCCCCC"> that big</font>

903
00:32:27,410 --> 00:32:33,740
large script block<font color="#E5E5E5"> so again a warning in</font>

904
00:32:29,870 --> 00:32:35,870
the<font color="#E5E5E5"> 40 100 good warnings and 4104 good</font>

905
00:32:33,740 --> 00:32:37,610
for us detectors not for the bad guys

906
00:32:35,870 --> 00:32:40,159
<font color="#E5E5E5">and here's a case what it looks like</font>

907
00:32:37,610 --> 00:32:42,620
inside the log so there's the<font color="#E5E5E5"> 41</font><font color="#CCCCCC"> Oh 4100</font>

908
00:32:40,160 --> 00:32:45,290
there's the big blurb of data and it

909
00:32:42,620 --> 00:32:50,239
<font color="#E5E5E5">will tell you that invoke expression</font>

910
00:32:45,290 --> 00:32:51,980
<font color="#CCCCCC">occur</font><font color="#E5E5E5"> do you see that's a short and it</font>

911
00:32:50,240 --> 00:32:55,640
also gives you the<font color="#CCCCCC"> username that's</font>

912
00:32:51,980 --> 00:32:57,440
<font color="#E5E5E5">another cool</font><font color="#CCCCCC"> thing there's</font><font color="#E5E5E5"> two usernames</font>

913
00:32:55,640 --> 00:32:59,540
right the<font color="#CCCCCC"> username of</font><font color="#E5E5E5"> the box versus the</font>

914
00:32:57,440 --> 00:33:01,550
username<font color="#CCCCCC"> of what's executing</font><font color="#E5E5E5"> you can see</font>

915
00:32:59,540 --> 00:33:03,200
that in<font color="#CCCCCC"> one</font><font color="#E5E5E5"> of the other identities and</font>

916
00:33:01,550 --> 00:33:04,940
<font color="#E5E5E5">so the 40 100's and</font><font color="#CCCCCC"> Splunk here's an</font>

917
00:33:03,200 --> 00:33:06,950
example<font color="#E5E5E5"> of them again I'm</font><font color="#CCCCCC"> looking</font>

918
00:33:04,940 --> 00:33:08,780
specifically for warnings<font color="#E5E5E5"> and suddenly</font>

919
00:33:06,950 --> 00:33:10,850
now you can see I can read this<font color="#E5E5E5"> down</font>

920
00:33:08,780 --> 00:33:12,500
here but I see that up here<font color="#CCCCCC"> so I can</font>

921
00:33:10,850 --> 00:33:15,709
<font color="#CCCCCC">start comparing things make them stick</font>

922
00:33:12,500 --> 00:33:17,240
out to me<font color="#E5E5E5"> okay so we're starting to see</font>

923
00:33:15,710 --> 00:33:20,780
some false positives<font color="#CCCCCC"> we got a deal</font><font color="#E5E5E5"> with</font>

924
00:33:17,240 --> 00:33:24,800
<font color="#E5E5E5">that warning warning warning</font><font color="#CCCCCC"> I can read</font>

925
00:33:20,780 --> 00:33:29,060
<font color="#E5E5E5">that I do not read</font><font color="#CCCCCC"> that partial 500</font>

926
00:33:24,800 --> 00:33:31,220
events<font color="#E5E5E5"> the 200s 400 500 600 800 s have a</font>

927
00:33:29,060 --> 00:33:33,740
lot of overlap the overlap generally is

928
00:33:31,220 --> 00:33:37,160
<font color="#E5E5E5">host application right here now if</font><font color="#CCCCCC"> you</font>

929
00:33:33,740 --> 00:33:39,650
<font color="#CCCCCC">do the profile ps1</font><font color="#E5E5E5"> and you actually and</font>

930
00:33:37,160 --> 00:33:41,690
you actually<font color="#E5E5E5"> don't get the - not you</font>

931
00:33:39,650 --> 00:33:44,510
will collect<font color="#E5E5E5"> a command line execution in</font>

932
00:33:41,690 --> 00:33:47,750
the<font color="#E5E5E5"> 500 event that's</font><font color="#CCCCCC"> only if they don't</font>

933
00:33:44,510 --> 00:33:49,580
do a - not and so suddenly<font color="#CCCCCC"> now we have a</font>

934
00:33:47,750 --> 00:33:51,800
<font color="#E5E5E5">base 64 you can see the</font><font color="#CCCCCC"> two equals here</font>

935
00:33:49,580 --> 00:33:54,530
at the end it won't<font color="#E5E5E5"> translate anything</font>

936
00:33:51,800 --> 00:33:56,330
<font color="#E5E5E5">okay that's what you get</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> hey you</font>

937
00:33:54,530 --> 00:33:58,790
just<font color="#E5E5E5"> see right</font><font color="#CCCCCC"> here</font><font color="#E5E5E5"> PowerShell name</font>

938
00:33:56,330 --> 00:34:01,550
right kill<font color="#CCCCCC"> Excel so you saw that from</font>

939
00:33:58,790 --> 00:34:03,740
<font color="#E5E5E5">the prior event so it knows at least</font>

940
00:34:01,550 --> 00:34:06,020
<font color="#E5E5E5">enough that kill PowerShell was executed</font>

941
00:34:03,740 --> 00:34:08,510
after<font color="#E5E5E5"> the encoding was done to trigger</font>

942
00:34:06,020 --> 00:34:10,370
this for you but unfortunately<font color="#E5E5E5"> it's in</font>

943
00:34:08,510 --> 00:34:12,860
the older logs<font color="#E5E5E5"> it's not a warning</font><font color="#CCCCCC"> it's</font>

944
00:34:10,370 --> 00:34:14,870
just informational but again you can use

945
00:34:12,860 --> 00:34:16,040
<font color="#CCCCCC">it because it is</font><font color="#E5E5E5"> big blob you can count</font>

946
00:34:14,870 --> 00:34:17,638
it<font color="#E5E5E5"> you can look</font><font color="#CCCCCC"> at the fact that</font><font color="#E5E5E5"> it's</font>

947
00:34:16,040 --> 00:34:22,199
base64 and start building<font color="#CCCCCC"> your</font>

948
00:34:17,639 --> 00:34:24,149
and triggers off of it<font color="#CCCCCC"> okay and yeah</font>

949
00:34:22,199 --> 00:34:26,248
here's an example of<font color="#CCCCCC"> two that they don't</font>

950
00:34:24,149 --> 00:34:29,578
have to have<font color="#CCCCCC"> two one</font><font color="#E5E5E5"> or they can have</font>

951
00:34:26,248 --> 00:34:31,469
<font color="#CCCCCC">zero so 200 events</font><font color="#E5E5E5"> also again very</font>

952
00:34:29,579 --> 00:34:32,700
repetitive<font color="#CCCCCC"> see host application same</font>

953
00:34:31,469 --> 00:34:34,768
thing here's the big<font color="#E5E5E5"> blur if I'm</font>

954
00:34:32,699 --> 00:34:37,199
interested<font color="#E5E5E5"> here's all the J's HS and DS</font>

955
00:34:34,768 --> 00:34:39,359
<font color="#CCCCCC">and whatnot</font><font color="#E5E5E5"> and again but this cool</font>

956
00:34:37,199 --> 00:34:41,730
thing<font color="#E5E5E5"> gives us a</font><font color="#CCCCCC"> warning so similar to</font>

957
00:34:39,359 --> 00:34:43,139
500 but the 200 gives you a warning<font color="#CCCCCC"> they</font>

958
00:34:41,730 --> 00:34:46,079
<font color="#E5E5E5">call</font><font color="#CCCCCC"> that this is called the command</font>

959
00:34:43,139 --> 00:34:48,659
health<font color="#E5E5E5"> is it is command healthy did it</font>

960
00:34:46,079 --> 00:34:50,069
xq correctly and then of course the

961
00:34:48,659 --> 00:34:52,529
answer is no it'll give you some

962
00:34:50,069 --> 00:34:56,399
translations in here there's an error

963
00:34:52,529 --> 00:34:58,859
<font color="#E5E5E5">boom warning warning Will Robinson post</font>

964
00:34:56,399 --> 00:35:01,078
application<font color="#E5E5E5"> blah blah blah blah blah</font><font color="#CCCCCC"> get</font>

965
00:34:58,859 --> 00:35:05,130
something our show ie<font color="#E5E5E5"> X</font><font color="#CCCCCC"> anytime I see</font>

966
00:35:01,079 --> 00:35:06,720
PowerShell<font color="#CCCCCC"> ITX</font><font color="#E5E5E5"> I worry so we have a lot</font>

967
00:35:05,130 --> 00:35:08,460
<font color="#CCCCCC">of this stuff all right you can detect</font>

968
00:35:06,720 --> 00:35:09,899
stuff now<font color="#E5E5E5"> you can see the things and the</font>

969
00:35:08,460 --> 00:35:12,269
behaviors that<font color="#CCCCCC"> they're using</font><font color="#E5E5E5"> pretty</font>

970
00:35:09,900 --> 00:35:14,999
<font color="#CCCCCC">typical</font><font color="#E5E5E5"> now we saw some false positives</font>

971
00:35:12,269 --> 00:35:17,519
<font color="#CCCCCC">so how about white listing power show on</font>

972
00:35:14,999 --> 00:35:20,238
the logs<font color="#E5E5E5"> okay that's one of the things</font>

973
00:35:17,519 --> 00:35:22,769
we're going<font color="#E5E5E5"> to do so here's an example</font>

974
00:35:20,239 --> 00:35:24,960
<font color="#E5E5E5">what the heck is this is this good or is</font>

975
00:35:22,769 --> 00:35:26,669
this bad<font color="#E5E5E5"> I can read it</font><font color="#CCCCCC"> I can</font><font color="#E5E5E5"> totally</font>

976
00:35:24,960 --> 00:35:29,160
figure out what the hell the<font color="#E5E5E5"> power show</font>

977
00:35:26,670 --> 00:35:31,980
is trying to do but is it<font color="#E5E5E5"> being</font><font color="#CCCCCC"> used for</font>

978
00:35:29,160 --> 00:35:34,348
<font color="#E5E5E5">good</font><font color="#CCCCCC"> or for</font><font color="#E5E5E5"> bad</font><font color="#CCCCCC"> well if we look a</font><font color="#E5E5E5"> little</font>

979
00:35:31,980 --> 00:35:36,029
deeper<font color="#E5E5E5"> or further down the script we'll</font>

980
00:35:34,349 --> 00:35:38,880
see<font color="#E5E5E5"> that this is something chocolaty</font>

981
00:35:36,029 --> 00:35:42,809
kicked off<font color="#E5E5E5"> suddenly now I have something</font>

982
00:35:38,880 --> 00:35:45,980
<font color="#E5E5E5">that I can focus on to exclude okay that</font>

983
00:35:42,809 --> 00:35:48,029
means now in this<font color="#E5E5E5"> execute if I say</font>

984
00:35:45,980 --> 00:35:51,109
specifically comes from this<font color="#E5E5E5"> chocolaty</font>

985
00:35:48,029 --> 00:35:54,690
directory not the greatest<font color="#CCCCCC"> way to do it</font>

986
00:35:51,109 --> 00:35:57,839
what is<font color="#CCCCCC"> set in here in some</font><font color="#E5E5E5"> aspects some</font>

987
00:35:54,690 --> 00:36:00,630
string<font color="#CCCCCC"> I would call these create</font>

988
00:35:57,839 --> 00:36:02,069
comments<font color="#CCCCCC"> in your code</font><font color="#E5E5E5"> or ask the guys</font><font color="#CCCCCC"> to</font>

989
00:36:00,630 --> 00:36:03,480
go add some comments<font color="#CCCCCC"> to it you're not</font>

990
00:36:02,069 --> 00:36:06,029
<font color="#CCCCCC">going</font><font color="#E5E5E5"> to break the</font><font color="#CCCCCC"> powershell scripts</font>

991
00:36:03,480 --> 00:36:07,499
<font color="#E5E5E5">but add some</font><font color="#CCCCCC"> comments in there</font><font color="#E5E5E5"> so the</font>

992
00:36:06,029 --> 00:36:09,660
comments show up and all<font color="#E5E5E5"> the script</font>

993
00:36:07,499 --> 00:36:12,029
blocks like this<font color="#E5E5E5"> is not the script</font>

994
00:36:09,660 --> 00:36:13,859
<font color="#E5E5E5">you're looking for right pound pound</font>

995
00:36:12,029 --> 00:36:15,539
pound<font color="#E5E5E5"> then I can put that in</font><font color="#CCCCCC"> slunk and</font>

996
00:36:13,859 --> 00:36:17,730
say not this is the script<font color="#E5E5E5"> you're</font>

997
00:36:15,539 --> 00:36:20,009
looking for pound pound pound<font color="#CCCCCC"> and now</font>

998
00:36:17,730 --> 00:36:21,779
when I run<font color="#CCCCCC"> my queries</font><font color="#E5E5E5"> anything with</font><font color="#CCCCCC"> that</font>

999
00:36:20,009 --> 00:36:23,880
in it will drop out the bad<font color="#CCCCCC"> guys will</font>

1000
00:36:21,779 --> 00:36:25,529
<font color="#E5E5E5">never know this and suddenly now the</font>

1001
00:36:23,880 --> 00:36:27,589
<font color="#E5E5E5">good noise can start being filtered out</font>

1002
00:36:25,529 --> 00:36:30,829
and you can do<font color="#E5E5E5"> it however you</font>

1003
00:36:27,589 --> 00:36:33,229
<font color="#CCCCCC">by text by path</font><font color="#E5E5E5"> anything you can come up</font>

1004
00:36:30,829 --> 00:36:34,939
<font color="#CCCCCC">with try not to do it by the actual</font>

1005
00:36:33,229 --> 00:36:37,459
command<font color="#CCCCCC"> because the bad</font><font color="#E5E5E5"> guys can use the</font>

1006
00:36:34,939 --> 00:36:38,808
same good powerful<font color="#E5E5E5"> commands for checking</font>

1007
00:36:37,459 --> 00:36:42,649
your<font color="#CCCCCC"> system as the inventory software</font>

1008
00:36:38,809 --> 00:36:44,599
<font color="#E5E5E5">will do as well so</font><font color="#CCCCCC"> please</font><font color="#E5E5E5"> get them to</font>

1009
00:36:42,650 --> 00:36:46,519
sign in some way for<font color="#CCCCCC"> manner</font><font color="#E5E5E5"> of course</font>

1010
00:36:44,599 --> 00:36:47,539
you can<font color="#CCCCCC"> actually sign your scripts</font><font color="#E5E5E5"> but</font>

1011
00:36:46,519 --> 00:36:49,118
generally<font color="#E5E5E5"> that's not going to happen</font>

1012
00:36:47,539 --> 00:36:51,650
people<font color="#E5E5E5"> aren't going to do that</font><font color="#CCCCCC"> too often</font>

1013
00:36:49,119 --> 00:36:53,359
<font color="#CCCCCC">we're looking more for buzzwords in</font>

1014
00:36:51,650 --> 00:36:55,160
there that we<font color="#CCCCCC"> can use to exclude</font><font color="#E5E5E5"> from</font>

1015
00:36:53,359 --> 00:36:57,140
log management<font color="#CCCCCC"> to</font><font color="#E5E5E5"> make it easier to</font>

1016
00:36:55,160 --> 00:36:58,910
filter out<font color="#E5E5E5"> the known good so the bad</font>

1017
00:36:57,140 --> 00:37:01,129
filters out and<font color="#E5E5E5"> actually if you do a</font>

1018
00:36:58,910 --> 00:37:02,359
good job at<font color="#E5E5E5"> this no matter what you're</font>

1019
00:37:01,130 --> 00:37:04,279
using<font color="#CCCCCC"> the bamboo and all that other</font>

1020
00:37:02,359 --> 00:37:06,558
<font color="#CCCCCC">stuff</font><font color="#E5E5E5"> you'll actually be able to</font>

1021
00:37:04,279 --> 00:37:08,599
baseline your<font color="#CCCCCC"> lock your stuff and Splunk</font>

1022
00:37:06,559 --> 00:37:10,459
to the point where nothing<font color="#E5E5E5"> lights up</font>

1023
00:37:08,599 --> 00:37:12,529
until somebody installs<font color="#E5E5E5"> something new</font>

1024
00:37:10,459 --> 00:37:14,328
some new module<font color="#E5E5E5"> that they add to bamboo</font>

1025
00:37:12,529 --> 00:37:15,890
or<font color="#E5E5E5"> whatnot and then it will trigger and</font>

1026
00:37:14,329 --> 00:37:17,209
then I have to go chase that<font color="#E5E5E5"> down figure</font>

1027
00:37:15,890 --> 00:37:19,640
<font color="#E5E5E5">out tell the guy can</font><font color="#CCCCCC"> you put a</font><font color="#E5E5E5"> couple of</font>

1028
00:37:17,209 --> 00:37:21,078
<font color="#CCCCCC">comments I like the 38 line so I get it</font>

1029
00:37:19,640 --> 00:37:23,058
<font color="#CCCCCC">in the second</font><font color="#E5E5E5"> script block and I can</font>

1030
00:37:21,079 --> 00:37:24,799
filter that out sure<font color="#E5E5E5"> he adds a</font><font color="#CCCCCC"> couple of</font>

1031
00:37:23,059 --> 00:37:26,150
comments<font color="#CCCCCC"> I run it again poof it's gone</font>

1032
00:37:24,799 --> 00:37:27,799
because they<font color="#CCCCCC"> use</font><font color="#E5E5E5"> the bud words I told</font>

1033
00:37:26,150 --> 00:37:31,479
<font color="#E5E5E5">him and that's what you're looking at</font>

1034
00:37:27,799 --> 00:37:31,479
<font color="#E5E5E5">that is like a secret key or a code</font>

1035
00:37:39,609 --> 00:37:45,949
social engineer your car make it rain<font color="#CCCCCC"> so</font>

1036
00:37:44,479 --> 00:37:47,839
the path<font color="#E5E5E5"> is awesome because a lot of</font>

1037
00:37:45,949 --> 00:37:50,059
utilities are scripts<font color="#E5E5E5"> that guys</font><font color="#CCCCCC"> write</font>

1038
00:37:47,839 --> 00:37:52,369
<font color="#CCCCCC">will put a path in there</font><font color="#E5E5E5"> so if you do</font>

1039
00:37:50,059 --> 00:37:54,529
see this have them execute the stuff

1040
00:37:52,369 --> 00:37:56,660
from<font color="#E5E5E5"> a specific</font><font color="#CCCCCC"> path</font><font color="#E5E5E5"> in gaming that's</font>

1041
00:37:54,529 --> 00:37:58,189
exactly what we did we had a path<font color="#E5E5E5"> that</font>

1042
00:37:56,660 --> 00:38:00,949
we<font color="#E5E5E5"> created and said put your stuff here</font>

1043
00:37:58,189 --> 00:38:02,598
<font color="#CCCCCC">and then we excluded by that path</font><font color="#E5E5E5"> and by</font>

1044
00:38:00,949 --> 00:38:04,069
the name of<font color="#CCCCCC"> the</font><font color="#E5E5E5"> script and that's how we</font>

1045
00:38:02,599 --> 00:38:05,989
threw out a lot of<font color="#CCCCCC"> the good</font><font color="#E5E5E5"> PowerShell</font>

1046
00:38:04,069 --> 00:38:08,689
that the gamers<font color="#E5E5E5"> that the game developers</font>

1047
00:38:05,989 --> 00:38:10,339
were using<font color="#E5E5E5"> again secret code to be even</font>

1048
00:38:08,689 --> 00:38:12,199
better<font color="#CCCCCC"> because if the bad guys figure</font>

1049
00:38:10,339 --> 00:38:13,939
out<font color="#E5E5E5"> that the path exists they might drop</font>

1050
00:38:12,199 --> 00:38:15,410
their script<font color="#E5E5E5"> from there and you</font><font color="#CCCCCC"> might</font>

1051
00:38:13,939 --> 00:38:16,578
<font color="#E5E5E5">accidentally filter it out because</font>

1052
00:38:15,410 --> 00:38:18,618
they've listened<font color="#CCCCCC"> to this talk</font><font color="#E5E5E5"> because</font>

1053
00:38:16,579 --> 00:38:21,410
it's actually<font color="#CCCCCC"> online</font><font color="#E5E5E5"> thank you iron geek</font>

1054
00:38:18,619 --> 00:38:22,789
and so that's a trend<font color="#E5E5E5"> that they'll look</font>

1055
00:38:21,410 --> 00:38:24,379
at oh let's go<font color="#E5E5E5"> look for</font><font color="#CCCCCC"> powershell</font>

1056
00:38:22,789 --> 00:38:26,150
scripts<font color="#E5E5E5"> and put our bad stuff in the</font>

1057
00:38:24,380 --> 00:38:27,979
directory as we see other power strips

1058
00:38:26,150 --> 00:38:29,359
of script because<font color="#CCCCCC"> mike said it they'll</font>

1059
00:38:27,979 --> 00:38:31,129
filter<font color="#E5E5E5"> that I was</font><font color="#CCCCCC"> Splunk</font><font color="#E5E5E5"> it and they</font>

1060
00:38:29,359 --> 00:38:32,808
won't<font color="#E5E5E5"> see it</font><font color="#CCCCCC"> so you</font><font color="#E5E5E5"> see the</font><font color="#CCCCCC"> logic why</font>

1061
00:38:31,130 --> 00:38:34,969
<font color="#E5E5E5">scripts putting</font><font color="#CCCCCC"> them in the directory of</font>

1062
00:38:32,809 --> 00:38:36,739
scripts is bad<font color="#E5E5E5"> you want a secret code or</font>

1063
00:38:34,969 --> 00:38:38,660
<font color="#E5E5E5">some sort of key</font><font color="#CCCCCC"> and literally it's just</font>

1064
00:38:36,739 --> 00:38:40,760
comments<font color="#E5E5E5"> added to the power</font>

1065
00:38:38,660 --> 00:38:42,310
it's not gonna break anything<font color="#CCCCCC"> or of</font>

1066
00:38:40,760 --> 00:38:44,990
<font color="#E5E5E5">course sign your stuff</font>

1067
00:38:42,310 --> 00:38:47,420
once you<font color="#E5E5E5"> create these queries you can</font>

1068
00:38:44,990 --> 00:38:49,129
trigger on the PowerShell launching so

1069
00:38:47,420 --> 00:38:51,320
all<font color="#E5E5E5"> that stuff I just showed you here's</font>

1070
00:38:49,130 --> 00:38:53,540
my<font color="#E5E5E5"> alerts for the inbox that</font><font color="#CCCCCC"> I have for</font>

1071
00:38:51,320 --> 00:38:54,770
these items<font color="#CCCCCC"> all</font><font color="#E5E5E5"> right of course you got</font>

1072
00:38:53,540 --> 00:38:57,410
<font color="#E5E5E5">to tweak out the known goods like we</font>

1073
00:38:54,770 --> 00:39:00,020
just<font color="#E5E5E5"> talked about so</font><font color="#CCCCCC"> here's a</font><font color="#E5E5E5"> ID 400</font>

1074
00:38:57,410 --> 00:39:01,910
francs<font color="#CCCCCC"> flunk</font><font color="#E5E5E5"> powershell obfuscation</font><font color="#CCCCCC"> tics</font>

1075
00:39:00,020 --> 00:39:03,259
<font color="#CCCCCC">I'm</font><font color="#E5E5E5"> counting the special characters I</font>

1076
00:39:01,910 --> 00:39:04,730
just call it<font color="#CCCCCC"> ticks but</font><font color="#E5E5E5"> it has a bunch</font><font color="#CCCCCC"> of</font>

1077
00:39:03,260 --> 00:39:07,040
the special<font color="#E5E5E5"> characters in there so it</font>

1078
00:39:04,730 --> 00:39:08,960
triggered an ID 400 I've<font color="#E5E5E5"> got a bad eye</font>

1079
00:39:07,040 --> 00:39:11,360
PTSD<font color="#CCCCCC"> Wireless so that means in this case</font>

1080
00:39:08,960 --> 00:39:13,580
<font color="#CCCCCC">I've added the IP to a bad IP list</font><font color="#E5E5E5"> and</font>

1081
00:39:11,360 --> 00:39:15,680
that I know this PowerShell is talking

1082
00:39:13,580 --> 00:39:18,670
to and it triggered for<font color="#E5E5E5"> that</font><font color="#CCCCCC"> right</font>

1083
00:39:15,680 --> 00:39:21,649
<font color="#CCCCCC">because I'm checking the firewall</font><font color="#E5E5E5"> logs</font>

1084
00:39:18,670 --> 00:39:24,410
and then<font color="#E5E5E5"> PowerShell PS web call so we</font>

1085
00:39:21,650 --> 00:39:26,180
did at 46<font color="#E5E5E5"> 88 it saw a web client it was</font>

1086
00:39:24,410 --> 00:39:29,299
in the clear I can tell that<font color="#CCCCCC"> because</font>

1087
00:39:26,180 --> 00:39:31,009
it's in a 46 88 off instigation and<font color="#CCCCCC"> a 46</font>

1088
00:39:29,300 --> 00:39:32,390
88 so I can see<font color="#E5E5E5"> this all the process</font>

1089
00:39:31,010 --> 00:39:34,790
command line<font color="#CCCCCC"> that means I know I'm</font>

1090
00:39:32,390 --> 00:39:36,230
seeing<font color="#E5E5E5"> that I'm gonna get replication</font>

1091
00:39:34,790 --> 00:39:39,350
there's a bypass which means they did

1092
00:39:36,230 --> 00:39:41,540
the -<font color="#CCCCCC"> knob so</font><font color="#E5E5E5"> this is a</font><font color="#CCCCCC"> V - box I now</font>

1093
00:39:39,350 --> 00:39:46,990
know that that's<font color="#E5E5E5"> not gonna work</font><font color="#CCCCCC"> I'm not</font>

1094
00:39:41,540 --> 00:39:50,330
<font color="#CCCCCC">gonna see any 500</font><font color="#E5E5E5"> call again the 400 and</font>

1095
00:39:46,990 --> 00:39:52,459
<font color="#CCCCCC">then</font><font color="#E5E5E5"> I can see again</font><font color="#CCCCCC"> a bypass</font><font color="#E5E5E5"> of the 46</font>

1096
00:39:50,330 --> 00:39:54,980
88 so suddenly<font color="#E5E5E5"> now something that's</font>

1097
00:39:52,460 --> 00:39:57,110
<font color="#E5E5E5">normally noisy just triggered like crazy</font>

1098
00:39:54,980 --> 00:39:58,760
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> and this</font><font color="#E5E5E5"> is actually what you're</font>

1099
00:39:57,110 --> 00:40:01,580
trying to<font color="#E5E5E5"> do and</font><font color="#CCCCCC"> accomplish this is</font><font color="#E5E5E5"> this</font>

1100
00:39:58,760 --> 00:40:05,690
makes these are good alerts<font color="#E5E5E5"> that box is</font>

1101
00:40:01,580 --> 00:40:10,640
owned without a doubt there's all the

1102
00:40:05,690 --> 00:40:11,570
items<font color="#E5E5E5"> logged goodness so enable the logs</font>

1103
00:40:10,640 --> 00:40:16,819
for the<font color="#CCCCCC"> cheat sheets</font>

1104
00:40:11,570 --> 00:40:18,740
<font color="#CCCCCC">PSV</font><font color="#E5E5E5"> - even if you have</font><font color="#CCCCCC"> PS p by p sv v is</font>

1105
00:40:16,820 --> 00:40:20,930
<font color="#E5E5E5">still on the box you cannot get rid of</font>

1106
00:40:18,740 --> 00:40:23,509
it<font color="#E5E5E5"> so here's my suggestion</font><font color="#CCCCCC"> I will be</font>

1107
00:40:20,930 --> 00:40:25,250
adding<font color="#CCCCCC"> this to the file</font><font color="#E5E5E5"> auditing cheat</font>

1108
00:40:23,510 --> 00:40:27,590
sheet<font color="#CCCCCC"> I finally got the information from</font>

1109
00:40:25,250 --> 00:40:29,840
<font color="#E5E5E5">Lee Holmes about the</font><font color="#CCCCCC"> DLLs I should</font>

1110
00:40:27,590 --> 00:40:31,490
monitor<font color="#CCCCCC"> and so the recommendation</font><font color="#E5E5E5"> here</font>

1111
00:40:29,840 --> 00:40:33,670
is how do i how do I check to see<font color="#CCCCCC"> if</font>

1112
00:40:31,490 --> 00:40:36,560
<font color="#E5E5E5">someone's using</font><font color="#CCCCCC"> powershell</font><font color="#E5E5E5"> v</font><font color="#CCCCCC"> 2 attacks</font>

1113
00:40:33,670 --> 00:40:37,400
downgrade attacks<font color="#E5E5E5"> you set file auditing</font>

1114
00:40:36,560 --> 00:40:39,259
on the<font color="#CCCCCC"> two dll's</font>

1115
00:40:37,400 --> 00:40:40,940
and then that way when<font color="#E5E5E5"> they call them</font>

1116
00:40:39,260 --> 00:40:42,440
there'll be a read and normally the

1117
00:40:40,940 --> 00:40:44,420
system should<font color="#CCCCCC"> not be</font><font color="#E5E5E5"> using them</font><font color="#CCCCCC"> because</font>

1118
00:40:42,440 --> 00:40:46,190
<font color="#E5E5E5">your</font><font color="#CCCCCC"> empowers will</font><font color="#E5E5E5"> be</font><font color="#CCCCCC"> v and so this is a</font>

1119
00:40:44,420 --> 00:40:48,230
way for<font color="#CCCCCC"> you to</font><font color="#E5E5E5"> check</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> the down</font><font color="#CCCCCC"> Dre</font>

1120
00:40:46,190 --> 00:40:49,940
attack<font color="#CCCCCC"> and so that's an option right so</font>

1121
00:40:48,230 --> 00:40:51,010
I'm going<font color="#CCCCCC"> to add that</font><font color="#E5E5E5"> to the</font><font color="#CCCCCC"> file</font>

1122
00:40:49,940 --> 00:40:55,210
auditing and

1123
00:40:51,010 --> 00:40:56,200
shall<font color="#CCCCCC"> she cheats for you</font><font color="#E5E5E5"> haven't got</font>

1124
00:40:55,210 --> 00:40:58,930
around at doing any cuz I'm doing a lot

1125
00:40:56,200 --> 00:41:00,549
<font color="#CCCCCC">of</font><font color="#E5E5E5"> cons the last month</font><font color="#CCCCCC"> collect the items</font>

1126
00:40:58,930 --> 00:41:03,100
<font color="#E5E5E5">into PowerShell</font><font color="#CCCCCC"> v2 logs</font>

1127
00:41:00,550 --> 00:41:05,020
<font color="#CCCCCC">200 400 500 and 800 you will get a lot</font>

1128
00:41:03,100 --> 00:41:06,880
of replication<font color="#E5E5E5"> we call it D duping and</font>

1129
00:41:05,020 --> 00:41:08,830
<font color="#CCCCCC">Splunk</font><font color="#E5E5E5"> but basically if you see</font><font color="#CCCCCC"> a lot of</font>

1130
00:41:06,880 --> 00:41:11,650
duplications you can get rid of them and

1131
00:41:08,830 --> 00:41:15,040
then narrow<font color="#E5E5E5"> it</font><font color="#CCCCCC"> down I'll</font><font color="#E5E5E5"> show you how we</font>

1132
00:41:11,650 --> 00:41:16,870
do<font color="#E5E5E5"> it long</font><font color="#CCCCCC"> and D in a second and that's</font>

1133
00:41:15,040 --> 00:41:18,220
the<font color="#E5E5E5"> Windows PowerShell</font><font color="#CCCCCC"> log right so</font>

1134
00:41:16,870 --> 00:41:19,540
that's<font color="#E5E5E5"> under application services</font>

1135
00:41:18,220 --> 00:41:21,879
<font color="#CCCCCC">Windows PowerShell it's way at the</font>

1136
00:41:19,540 --> 00:41:25,000
bottom<font color="#E5E5E5"> and the PowerShell v5 logs you</font>

1137
00:41:21,880 --> 00:41:27,100
want to collect the<font color="#E5E5E5"> 40 140 100 fours</font><font color="#CCCCCC"> 41</font>

1138
00:41:25,000 --> 00:41:28,690
<font color="#CCCCCC">3s are somewhat useful</font><font color="#E5E5E5"> as well there's</font>

1139
00:41:27,100 --> 00:41:30,430
some<font color="#CCCCCC"> information and it's useful and</font>

1140
00:41:28,690 --> 00:41:32,890
they<font color="#CCCCCC"> are the way</font><font color="#E5E5E5"> Microsoft Windows</font>

1141
00:41:30,430 --> 00:41:35,470
PowerShell<font color="#E5E5E5"> operational so it's another</font>

1142
00:41:32,890 --> 00:41:36,580
layer down in the logs<font color="#E5E5E5"> and then the</font>

1143
00:41:35,470 --> 00:41:38,980
windows logs you definitely want to

1144
00:41:36,580 --> 00:41:40,330
collect the<font color="#E5E5E5"> 46</font><font color="#CCCCCC"> 88 so with the process</font>

1145
00:41:38,980 --> 00:41:41,950
<font color="#E5E5E5">command line so this is the list of</font>

1146
00:41:40,330 --> 00:41:45,520
things<font color="#E5E5E5"> you</font><font color="#CCCCCC"> really want to focus on</font><font color="#E5E5E5"> I</font>

1147
00:41:41,950 --> 00:41:47,710
would say<font color="#E5E5E5"> start here there's security</font>

1148
00:41:45,520 --> 00:41:49,840
<font color="#E5E5E5">log 46 88 you're gonna see process</font>

1149
00:41:47,710 --> 00:41:52,450
executed hey PowerShell launched or

1150
00:41:49,840 --> 00:41:54,100
command dot exe<font color="#E5E5E5"> or word command</font><font color="#CCCCCC"> in</font>

1151
00:41:52,450 --> 00:41:55,569
PowerShell<font color="#CCCCCC"> launched like you saw in</font><font color="#E5E5E5"> the</font>

1152
00:41:54,100 --> 00:41:58,330
log in<font color="#CCCCCC"> d example the very beginning</font>

1153
00:41:55,570 --> 00:42:01,510
you're gonna see a bypass executed<font color="#E5E5E5"> -</font><font color="#CCCCCC"> not</font>

1154
00:41:58,330 --> 00:42:03,850
- execution<font color="#CCCCCC"> policy - bypass</font><font color="#E5E5E5"> you're gonna</font>

1155
00:42:01,510 --> 00:42:06,640
see some suspicious buzzwords web client

1156
00:42:03,850 --> 00:42:08,529
download HTTP unless they off you skate

1157
00:42:06,640 --> 00:42:10,750
it then you'll start counting and seeing

1158
00:42:08,530 --> 00:42:12,730
ticks so you can see how building all

1159
00:42:10,750 --> 00:42:14,320
this together<font color="#CCCCCC"> will kind of overlap well</font>

1160
00:42:12,730 --> 00:42:16,870
<font color="#E5E5E5">I'm</font><font color="#CCCCCC"> gonna get around there they're</font>

1161
00:42:14,320 --> 00:42:18,430
looking<font color="#CCCCCC"> for the buzz words by obvious</font>

1162
00:42:16,870 --> 00:42:19,870
skating it you have<font color="#E5E5E5"> an uncounted ticks</font>

1163
00:42:18,430 --> 00:42:21,339
so screw<font color="#CCCCCC"> you and I'm gonna</font><font color="#E5E5E5"> strip those</font>

1164
00:42:19,870 --> 00:42:24,520
out<font color="#E5E5E5"> and then I'm gonna do a buzz word</font>

1165
00:42:21,340 --> 00:42:26,170
check<font color="#E5E5E5"> BAM gotcha okay so we can</font>

1166
00:42:24,520 --> 00:42:27,220
<font color="#CCCCCC">definitely go after</font><font color="#E5E5E5"> them and you're</font>

1167
00:42:26,170 --> 00:42:29,590
<font color="#E5E5E5">gonna go</font><font color="#CCCCCC"> after all these weird</font>

1168
00:42:27,220 --> 00:42:30,879
<font color="#CCCCCC">characters and then of course</font><font color="#E5E5E5"> we're</font>

1169
00:42:29,590 --> 00:42:32,770
<font color="#E5E5E5">gonna look for large script blocks</font>

1170
00:42:30,880 --> 00:42:35,560
because sometimes you'll just<font color="#E5E5E5"> make huge</font>

1171
00:42:32,770 --> 00:42:38,290
blocks where else will they put large

1172
00:42:35,560 --> 00:42:40,600
script<font color="#CCCCCC"> locks or PowerShell code Somebody</font>

1173
00:42:38,290 --> 00:42:44,259
<font color="#CCCCCC">Anybody there's a big database on a</font>

1174
00:42:40,600 --> 00:42:46,120
Windows box called the<font color="#E5E5E5"> registry so</font>

1175
00:42:44,260 --> 00:42:47,650
<font color="#E5E5E5">suddenly</font><font color="#CCCCCC"> now large reg keys become</font>

1176
00:42:46,120 --> 00:42:50,049
something<font color="#CCCCCC"> I can</font><font color="#E5E5E5"> look for because if they</font>

1177
00:42:47,650 --> 00:42:51,370
hide scripts which they do in the

1178
00:42:50,050 --> 00:42:53,620
registry<font color="#E5E5E5"> because it's just a database</font>

1179
00:42:51,370 --> 00:42:55,270
<font color="#E5E5E5">it's like SharePoint they're just going</font>

1180
00:42:53,620 --> 00:42:57,910
<font color="#E5E5E5">to attach</font><font color="#CCCCCC"> a file to</font><font color="#E5E5E5"> it and then they'll</font>

1181
00:42:55,270 --> 00:43:00,520
call<font color="#CCCCCC"> a</font><font color="#E5E5E5"> key read the key drop the stuff</font>

1182
00:42:57,910 --> 00:43:02,440
and execute it or worse<font color="#E5E5E5"> they're really</font>

1183
00:43:00,520 --> 00:43:03,490
good they're going<font color="#E5E5E5"> to call the DLLs</font><font color="#CCCCCC"> that</font>

1184
00:43:02,440 --> 00:43:05,440
they downloaded from

1185
00:43:03,490 --> 00:43:07,000
windows box and they'll inject them into

1186
00:43:05,440 --> 00:43:09,580
<font color="#E5E5E5">memory and they'll never touch the ones</font>

1187
00:43:07,000 --> 00:43:11,260
on the disk<font color="#E5E5E5"> and do that attack but</font>

1188
00:43:09,580 --> 00:43:12,790
<font color="#CCCCCC">that's more</font><font color="#E5E5E5"> complicated</font><font color="#CCCCCC"> and they're</font>

1189
00:43:11,260 --> 00:43:16,030
still executing<font color="#E5E5E5"> something on the box</font>

1190
00:43:12,790 --> 00:43:17,320
<font color="#E5E5E5">that you can detect</font><font color="#CCCCCC"> okay so now we can</font>

1191
00:43:16,030 --> 00:43:19,840
<font color="#E5E5E5">look at these</font><font color="#CCCCCC"> large script blocks and</font>

1192
00:43:17,320 --> 00:43:21,910
the base64 as well so we can<font color="#CCCCCC"> look for</font>

1193
00:43:19,840 --> 00:43:24,550
all these<font color="#CCCCCC"> indicators together</font><font color="#E5E5E5"> and you</font>

1194
00:43:21,910 --> 00:43:27,339
saw<font color="#E5E5E5"> what my email alert looks like in</font>

1195
00:43:24,550 --> 00:43:28,990
PowerShell<font color="#E5E5E5"> B to</font><font color="#CCCCCC"> command health the 200s</font>

1196
00:43:27,340 --> 00:43:30,640
a lot engine life cycles<font color="#CCCCCC"> for hundreds in</font>

1197
00:43:28,990 --> 00:43:32,830
<font color="#E5E5E5">the command lifecycle five hundreds and</font>

1198
00:43:30,640 --> 00:43:34,390
again the<font color="#E5E5E5"> - snopp is not your best</font>

1199
00:43:32,830 --> 00:43:37,240
<font color="#E5E5E5">friend if you're</font><font color="#CCCCCC"> doing that</font><font color="#E5E5E5"> that's why</font>

1200
00:43:34,390 --> 00:43:39,730
please<font color="#E5E5E5"> upgrade</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> PowerShell v5 and oh</font>

1201
00:43:37,240 --> 00:43:42,850
by the way there's PowerShell b6 and the

1202
00:43:39,730 --> 00:43:44,620
command is now<font color="#E5E5E5"> p WS H dot exe and it's</font>

1203
00:43:42,850 --> 00:43:47,950
under Program Files not under windows

1204
00:43:44,620 --> 00:43:50,230
system32<font color="#CCCCCC"> Windows PowerShell</font><font color="#E5E5E5"> v10 block</font>

1205
00:43:47,950 --> 00:43:52,600
<font color="#E5E5E5">right so now Microsoft has put it in two</font>

1206
00:43:50,230 --> 00:43:54,310
<font color="#E5E5E5">places and change the items so be sure</font>

1207
00:43:52,600 --> 00:43:59,980
not to<font color="#E5E5E5"> forget</font><font color="#CCCCCC"> about your friend</font>

1208
00:43:54,310 --> 00:44:02,740
<font color="#CCCCCC">PowerShell v6</font><font color="#E5E5E5"> with PWS c sh w XE power</font>

1209
00:43:59,980 --> 00:44:04,240
<font color="#E5E5E5">shall</font><font color="#CCCCCC"> be to look</font><font color="#E5E5E5"> for the</font><font color="#CCCCCC"> 200 and 400 you</font>

1210
00:44:02,740 --> 00:44:06,509
want to look for web calls<font color="#E5E5E5"> you want to</font>

1211
00:44:04,240 --> 00:44:08,979
look for occupation characters parse

1212
00:44:06,510 --> 00:44:11,560
script block size<font color="#E5E5E5"> or greater a thousand</font>

1213
00:44:08,980 --> 00:44:14,050
of course<font color="#CCCCCC"> to base64</font><font color="#E5E5E5"> blocks and of course</font>

1214
00:44:11,560 --> 00:44:16,990
<font color="#E5E5E5">warning warning something's fishy about</font>

1215
00:44:14,050 --> 00:44:18,970
this<font color="#E5E5E5"> script and in PowerShell</font><font color="#CCCCCC"> v5 you</font>

1216
00:44:16,990 --> 00:44:21,220
want to look at the<font color="#E5E5E5"> 40 141 3 these are</font>

1217
00:44:18,970 --> 00:44:23,109
the<font color="#E5E5E5"> execution pipelines they will</font>

1218
00:44:21,220 --> 00:44:25,120
trigger a warning if there's anything in

1219
00:44:23,110 --> 00:44:27,490
<font color="#CCCCCC">these it's a warning</font><font color="#E5E5E5"> focus on those and</font>

1220
00:44:25,120 --> 00:44:30,520
then look<font color="#E5E5E5"> at the size</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> the ticks and</font>

1221
00:44:27,490 --> 00:44:31,870
<font color="#E5E5E5">the counts and all that stuff</font><font color="#CCCCCC"> ok</font><font color="#E5E5E5"> and</font>

1222
00:44:30,520 --> 00:44:33,370
again<font color="#CCCCCC"> no obvious case in</font><font color="#E5E5E5"> here they've</font>

1223
00:44:31,870 --> 00:44:35,589
stripped it out and they've translated

1224
00:44:33,370 --> 00:44:38,470
it<font color="#E5E5E5"> in some aspects some of it will still</font>

1225
00:44:35,590 --> 00:44:40,410
be<font color="#CCCCCC"> in there but</font><font color="#E5E5E5"> a lot</font><font color="#CCCCCC"> of the massive</font>

1226
00:44:38,470 --> 00:44:42,819
<font color="#E5E5E5">plus you saw will actually be translated</font>

1227
00:44:40,410 --> 00:44:46,000
especially in base64 it's now completely

1228
00:44:42,820 --> 00:44:50,440
<font color="#CCCCCC">readable they decodes</font><font color="#E5E5E5"> it in a 4104</font><font color="#CCCCCC"> of</font>

1229
00:44:46,000 --> 00:44:52,630
<font color="#CCCCCC">them very awesome also in a</font><font color="#E5E5E5"> 40 140 104</font>

1230
00:44:50,440 --> 00:44:55,120
you can do the web calls<font color="#E5E5E5"> suspicious</font>

1231
00:44:52,630 --> 00:44:57,400
command buzzwords<font color="#E5E5E5"> again because maybe it</font>

1232
00:44:55,120 --> 00:44:59,290
was<font color="#E5E5E5"> off you skated in 46 88 now that</font>

1233
00:44:57,400 --> 00:45:00,940
it's<font color="#E5E5E5"> D off you skated or encoded now</font>

1234
00:44:59,290 --> 00:45:02,560
<font color="#E5E5E5">it's decoded and now suddenly I can do</font>

1235
00:45:00,940 --> 00:45:04,270
my<font color="#E5E5E5"> buzzword searches and I can look for</font>

1236
00:45:02,560 --> 00:45:06,910
a web client now<font color="#E5E5E5"> to see if there was a</font>

1237
00:45:04,270 --> 00:45:08,110
download<font color="#E5E5E5"> so yay and I can</font><font color="#CCCCCC"> obviously look</font>

1238
00:45:06,910 --> 00:45:10,720
for large counts and everything else

1239
00:45:08,110 --> 00:45:13,490
<font color="#E5E5E5">base64 and again the warnings do matter</font>

1240
00:45:10,720 --> 00:45:15,859
here<font color="#E5E5E5"> so very detectable</font>

1241
00:45:13,490 --> 00:45:18,439
and then there's a funny little<font color="#E5E5E5"> 800 not</font>

1242
00:45:15,859 --> 00:45:19,940
much not<font color="#E5E5E5"> much talked about it is used it</font>

1243
00:45:18,440 --> 00:45:21,380
<font color="#CCCCCC">is inconsistent but</font><font color="#E5E5E5"> I finally figured</font>

1244
00:45:19,940 --> 00:45:22,849
<font color="#CCCCCC">out how to</font><font color="#E5E5E5"> trigger it all the time</font><font color="#CCCCCC"> I</font>

1245
00:45:21,380 --> 00:45:24,859
will<font color="#CCCCCC"> make an update to the power show</font>

1246
00:45:22,849 --> 00:45:28,369
<font color="#CCCCCC">along in chichi</font><font color="#E5E5E5"> there's actually another</font>

1247
00:45:24,859 --> 00:45:30,109
module<font color="#CCCCCC"> named entry you have</font><font color="#E5E5E5"> to add with</font>

1248
00:45:28,369 --> 00:45:32,359
an asterisk asterisk<font color="#CCCCCC"> Splatt Splatt</font>

1249
00:45:30,109 --> 00:45:34,609
global<font color="#E5E5E5"> global in order to tell it to</font>

1250
00:45:32,359 --> 00:45:35,869
<font color="#CCCCCC">register all</font><font color="#E5E5E5"> modules and so that you can</font>

1251
00:45:34,609 --> 00:45:36,920
actually pick what<font color="#CCCCCC"> modules you want to</font>

1252
00:45:35,869 --> 00:45:39,200
<font color="#CCCCCC">register</font><font color="#E5E5E5"> if you really want to do them</font>

1253
00:45:36,920 --> 00:45:40,640
all<font color="#E5E5E5"> it's not that noisy</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> has to be</font>

1254
00:45:39,200 --> 00:45:44,328
set for<font color="#E5E5E5"> the 800</font><font color="#CCCCCC"> to be consistently</font>

1255
00:45:40,640 --> 00:45:46,098
logging<font color="#CCCCCC"> fairly new fine for me</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> again</font>

1256
00:45:44,329 --> 00:45:47,480
you're focusing<font color="#E5E5E5"> on host application</font>

1257
00:45:46,099 --> 00:45:50,710
that's where the big blurps will occur

1258
00:45:47,480 --> 00:45:52,869
and<font color="#E5E5E5"> all these all these zeros are events</font>

1259
00:45:50,710 --> 00:45:55,369
system on anybody heard it's this month

1260
00:45:52,869 --> 00:45:58,160
<font color="#E5E5E5">so since mom gives you the added feature</font>

1261
00:45:55,369 --> 00:46:01,670
<font color="#E5E5E5">my internet</font><font color="#CCCCCC"> Sun</font><font color="#E5E5E5"> Benton anybody know who</font>

1262
00:45:58,160 --> 00:46:03,649
Ben 10<font color="#CCCCCC"> is you had</font><font color="#E5E5E5"> to be there</font><font color="#CCCCCC"> to</font>

1263
00:46:01,670 --> 00:46:05,119
understand the joke but people actually

1264
00:46:03,650 --> 00:46:05,510
<font color="#E5E5E5">think he's my son and</font><font color="#CCCCCC"> we're just</font><font color="#E5E5E5"> going</font>

1265
00:46:05,119 --> 00:46:07,520
with<font color="#E5E5E5"> it</font>

1266
00:46:05,510 --> 00:46:10,490
after some jokes and Twitter and whatnot

1267
00:46:07,520 --> 00:46:12,530
<font color="#CCCCCC">but there's an idea</font><font color="#E5E5E5"> ID</font><font color="#CCCCCC"> seven and system</font>

1268
00:46:10,490 --> 00:46:13,819
on<font color="#E5E5E5"> I tell</font><font color="#CCCCCC"> people do not rely on system</font>

1269
00:46:12,530 --> 00:46:15,559
<font color="#E5E5E5">on I'll</font><font color="#CCCCCC"> use</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> pond for everything</font>

1270
00:46:13,819 --> 00:46:17,390
yeah I'm gonna own you to Sunday if you

1271
00:46:15,559 --> 00:46:19,160
don't<font color="#E5E5E5"> believe me</font><font color="#CCCCCC"> go watch Carlos Perez's</font>

1272
00:46:17,390 --> 00:46:21,589
<font color="#E5E5E5">talking the subject you know tell you</font>

1273
00:46:19,160 --> 00:46:22,848
how you<font color="#E5E5E5"> can get</font><font color="#CCCCCC"> my system on because</font><font color="#E5E5E5"> you</font>

1274
00:46:21,589 --> 00:46:24,558
<font color="#E5E5E5">lose change your</font><font color="#CCCCCC"> register keys until</font>

1275
00:46:22,849 --> 00:46:26,299
<font color="#CCCCCC">system on not to</font><font color="#E5E5E5"> collect certain things</font>

1276
00:46:24,559 --> 00:46:28,309
<font color="#E5E5E5">and</font><font color="#CCCCCC"> system on will</font><font color="#E5E5E5"> not record that occur</font>

1277
00:46:26,299 --> 00:46:29,960
I can also just<font color="#E5E5E5"> add something in the</font>

1278
00:46:28,309 --> 00:46:31,700
<font color="#E5E5E5">bottom of your config</font><font color="#CCCCCC"> reloaded</font><font color="#E5E5E5"> and it'll</font>

1279
00:46:29,960 --> 00:46:33,410
<font color="#CCCCCC">work</font><font color="#E5E5E5"> the config as it requires a config</font>

1280
00:46:31,700 --> 00:46:35,240
to log anything and if<font color="#CCCCCC"> I Bork your</font>

1281
00:46:33,410 --> 00:46:37,129
config you're not logging anything so I

1282
00:46:35,240 --> 00:46:39,890
<font color="#E5E5E5">don't like system on for all the things</font>

1283
00:46:37,130 --> 00:46:41,750
<font color="#E5E5E5">but it's good for these things ID</font><font color="#CCCCCC"> seven</font>

1284
00:46:39,890 --> 00:46:44,240
is module loading<font color="#E5E5E5"> so what you're gonna</font>

1285
00:46:41,750 --> 00:46:47,150
<font color="#E5E5E5">see</font><font color="#CCCCCC"> now is DLLs so when malware dot exe</font>

1286
00:46:44,240 --> 00:46:48,979
or funky<font color="#CCCCCC"> been ten dot exe execute and he</font>

1287
00:46:47,150 --> 00:46:51,829
makes a call<font color="#E5E5E5"> and loads system</font><font color="#CCCCCC"> dot</font>

1288
00:46:48,980 --> 00:46:54,170
management<font color="#E5E5E5"> DLL doc management automation</font>

1289
00:46:51,829 --> 00:46:56,329
DLL wherever it is in the<font color="#CCCCCC"> box v2 is</font>

1290
00:46:54,170 --> 00:46:59,000
<font color="#E5E5E5">version or</font><font color="#CCCCCC"> B fives version I will catch</font>

1291
00:46:56,329 --> 00:47:00,770
<font color="#CCCCCC">that with an ID seven with system on so</font>

1292
00:46:59,000 --> 00:47:02,119
we are interested<font color="#CCCCCC"> in system on you do</font>

1293
00:47:00,770 --> 00:47:04,910
want to<font color="#E5E5E5"> collect that sevens they will</font>

1294
00:47:02,119 --> 00:47:07,069
generate a lot<font color="#CCCCCC"> of log traffic</font><font color="#E5E5E5"> but you</font>

1295
00:47:04,910 --> 00:47:10,308
could set<font color="#E5E5E5"> up an alert just for anything</font>

1296
00:47:07,069 --> 00:47:11,089
that's not<font color="#E5E5E5"> PowerShell exe loading those</font>

1297
00:47:10,309 --> 00:47:13,130
dll's

1298
00:47:11,089 --> 00:47:14,690
<font color="#E5E5E5">it will not trigger unless something bad</font>

1299
00:47:13,130 --> 00:47:16,130
is happening<font color="#CCCCCC"> okay</font>

1300
00:47:14,690 --> 00:47:17,869
so<font color="#CCCCCC"> system on gives</font><font color="#E5E5E5"> you a lot of power</font>

1301
00:47:16,130 --> 00:47:19,369
<font color="#CCCCCC">the windows logging service would</font><font color="#E5E5E5"> be</font><font color="#CCCCCC"> a</font>

1302
00:47:17,869 --> 00:47:21,530
<font color="#E5E5E5">similar thing it's an agent</font><font color="#CCCCCC"> that</font>

1303
00:47:19,369 --> 00:47:23,089
replaces a<font color="#CCCCCC"> spawn Florida or but a</font>

1304
00:47:21,530 --> 00:47:25,730
<font color="#CCCCCC">government wrote it really cool</font>

1305
00:47:23,089 --> 00:47:26,020
<font color="#E5E5E5">basically a syslog agent that you can</font>

1306
00:47:25,730 --> 00:47:27,730
run

1307
00:47:26,020 --> 00:47:29,620
<font color="#E5E5E5">it does lots of that</font><font color="#CCCCCC"> stuff similar to I</font>

1308
00:47:27,730 --> 00:47:31,060
called<font color="#E5E5E5"> system on steroids</font><font color="#CCCCCC"> so there</font><font color="#E5E5E5"> are</font>

1309
00:47:29,620 --> 00:47:33,759
other solutions<font color="#CCCCCC"> that</font><font color="#E5E5E5"> do this high-end</font>

1310
00:47:31,060 --> 00:47:35,740
security<font color="#CCCCCC"> there's another one it's kind</font>

1311
00:47:33,760 --> 00:47:38,680
of a<font color="#E5E5E5"> kernel hack think of it as EDR it's</font>

1312
00:47:35,740 --> 00:47:40,419
called secure crap can't think of it we

1313
00:47:38,680 --> 00:47:42,279
talked we covered it on<font color="#E5E5E5"> the podcast last</font>

1314
00:47:40,420 --> 00:47:44,920
podcast<font color="#CCCCCC"> with whom you know one of their</font>

1315
00:47:42,280 --> 00:47:46,690
clients<font color="#E5E5E5"> uses it service garbage service</font>

1316
00:47:44,920 --> 00:47:48,370
<font color="#CCCCCC">guard does a</font><font color="#E5E5E5"> similar</font><font color="#CCCCCC"> thing and</font><font color="#E5E5E5"> blogs all</font>

1317
00:47:46,690 --> 00:47:49,780
<font color="#E5E5E5">this I just actually saw the customer</font>

1318
00:47:48,370 --> 00:47:52,029
<font color="#E5E5E5">just gave me a walk through what they do</font>

1319
00:47:49,780 --> 00:47:54,940
same scenario he has triggers based<font color="#E5E5E5"> on</font>

1320
00:47:52,030 --> 00:47:56,920
<font color="#CCCCCC">exe</font><font color="#E5E5E5"> is calling those</font><font color="#CCCCCC"> dll's that are not</font>

1321
00:47:54,940 --> 00:47:58,540
<font color="#E5E5E5">PowerShell to catch the bad food so</font>

1322
00:47:56,920 --> 00:48:00,730
there are some additional<font color="#E5E5E5"> ways or</font>

1323
00:47:58,540 --> 00:48:03,490
whatever tools<font color="#E5E5E5"> you have you can see DLL</font>

1324
00:48:00,730 --> 00:48:05,020
loads which<font color="#E5E5E5"> windows does nothing for</font><font color="#CCCCCC"> ok</font>

1325
00:48:03,490 --> 00:48:07,569
you have<font color="#E5E5E5"> to add something</font><font color="#CCCCCC"> to it to do it</font>

1326
00:48:05,020 --> 00:48:09,130
<font color="#CCCCCC">you can catch these</font><font color="#E5E5E5"> these specialized</font>

1327
00:48:07,570 --> 00:48:10,960
<font color="#E5E5E5">backdoors that people like Benton</font>

1328
00:48:09,130 --> 00:48:12,460
because<font color="#E5E5E5"> people say</font><font color="#CCCCCC"> oh</font><font color="#E5E5E5"> I watch for</font>

1329
00:48:10,960 --> 00:48:15,190
<font color="#E5E5E5">powershell exe or PowerShell underscore</font>

1330
00:48:12,460 --> 00:48:17,170
is exe<font color="#E5E5E5"> and now</font><font color="#CCCCCC"> PWS HIV you seen Benton</font>

1331
00:48:15,190 --> 00:48:18,760
<font color="#CCCCCC">allow fetch in say</font><font color="#E5E5E5"> are you looking for</font>

1332
00:48:17,170 --> 00:48:23,530
not<font color="#E5E5E5"> PowerShell this is what he's talking</font>

1333
00:48:18,760 --> 00:48:24,760
<font color="#CCCCCC">about so how do I hunt for</font><font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> if</font>

1334
00:48:23,530 --> 00:48:26,950
you haven't figured it out<font color="#CCCCCC"> by now log</font>

1335
00:48:24,760 --> 00:48:28,450
management<font color="#CCCCCC"> right it's pivotal here</font>

1336
00:48:26,950 --> 00:48:29,980
because this is where<font color="#CCCCCC"> you</font><font color="#E5E5E5"> can read Jax's</font>

1337
00:48:28,450 --> 00:48:32,109
<font color="#CCCCCC">Regan account because we're getting</font>

1338
00:48:29,980 --> 00:48:34,600
strip and and show all<font color="#E5E5E5"> these things that</font>

1339
00:48:32,110 --> 00:48:36,640
<font color="#E5E5E5">I just showed you but of course what how</font>

1340
00:48:34,600 --> 00:48:38,470
many<font color="#E5E5E5"> people here do</font><font color="#CCCCCC"> not have all this</font>

1341
00:48:36,640 --> 00:48:39,850
<font color="#E5E5E5">kind of fancy log management</font><font color="#CCCCCC"> I assume</font>

1342
00:48:38,470 --> 00:48:42,279
there's<font color="#CCCCCC"> Mayfair set of hands in a room</font>

1343
00:48:39,850 --> 00:48:43,330
<font color="#E5E5E5">that will agreed</font><font color="#CCCCCC"> on San</font><font color="#E5E5E5"> Antonio</font><font color="#CCCCCC"> a lot of</font>

1344
00:48:42,280 --> 00:48:45,460
government<font color="#E5E5E5"> people they won't raise their</font>

1345
00:48:43,330 --> 00:48:48,490
hands<font color="#E5E5E5"> but</font><font color="#CCCCCC"> a lot of us don't have fancy</font>

1346
00:48:45,460 --> 00:48:50,110
<font color="#E5E5E5">ass log</font><font color="#CCCCCC"> management or we have log</font>

1347
00:48:48,490 --> 00:48:52,930
<font color="#CCCCCC">management</font><font color="#E5E5E5"> we want</font><font color="#CCCCCC"> something that helps</font>

1348
00:48:50,110 --> 00:48:58,030
us<font color="#E5E5E5"> do these things more intelligently so</font>

1349
00:48:52,930 --> 00:49:01,210
here is<font color="#CCCCCC"> snap a quick peek at</font><font color="#E5E5E5"> login</font><font color="#CCCCCC"> Dee</font>

1350
00:48:58,030 --> 00:49:03,100
<font color="#E5E5E5">version 2.1</font><font color="#CCCCCC"> whoops and what we did is we</font>

1351
00:49:01,210 --> 00:49:04,480
<font color="#E5E5E5">took all the power so we have a report</font>

1352
00:49:03,100 --> 00:49:05,920
called<font color="#CCCCCC"> powershell reporter underscore</font>

1353
00:49:04,480 --> 00:49:08,890
powers<font color="#CCCCCC"> your line text</font><font color="#E5E5E5"> because</font><font color="#CCCCCC"> the big</font>

1354
00:49:05,920 --> 00:49:10,750
blurbs make it text<font color="#E5E5E5"> not and we said</font>

1355
00:49:08,890 --> 00:49:12,580
let's<font color="#E5E5E5"> take all the logic of all the</font>

1356
00:49:10,750 --> 00:49:18,190
stuff<font color="#CCCCCC"> we know that occurs of all the bad</font>

1357
00:49:12,580 --> 00:49:19,750
<font color="#E5E5E5">things we</font><font color="#CCCCCC"> do we're just gonna label</font><font color="#E5E5E5"> it</font>

1358
00:49:18,190 --> 00:49:22,090
<font color="#E5E5E5">and we have a settings file that you can</font>

1359
00:49:19,750 --> 00:49:23,860
<font color="#E5E5E5">go adjust it well five ticks is too few</font>

1360
00:49:22,090 --> 00:49:25,450
let's make<font color="#CCCCCC"> it 10 ticks because my bamboo</font>

1361
00:49:23,860 --> 00:49:28,060
keeps triggering that<font color="#E5E5E5"> now let's make</font>

1362
00:49:25,450 --> 00:49:31,240
pluses let's make<font color="#CCCCCC"> it</font><font color="#E5E5E5"> 12 to 12 pluses</font><font color="#CCCCCC"> or</font>

1363
00:49:28,060 --> 00:49:33,279
25 parents or<font color="#E5E5E5"> 30</font><font color="#CCCCCC"> backslashes and you can</font>

1364
00:49:31,240 --> 00:49:35,439
adjust<font color="#CCCCCC"> the numbers so that you'll get</font>

1365
00:49:33,280 --> 00:49:37,790
down

1366
00:49:35,440 --> 00:49:40,340
often<font color="#E5E5E5"> occurring you should pay attention</font>

1367
00:49:37,790 --> 00:49:43,100
to<font color="#E5E5E5"> it and we also deep</font><font color="#CCCCCC"> dupe it at</font><font color="#E5E5E5"> the</font>

1368
00:49:40,340 --> 00:49:44,750
same<font color="#E5E5E5"> time so suddenly now</font><font color="#CCCCCC"> you can see</font>

1369
00:49:43,100 --> 00:49:47,180
the event IDs on the<font color="#CCCCCC"> left</font><font color="#E5E5E5"> I don't have</font>

1370
00:49:44,750 --> 00:49:48,680
six of every<font color="#CCCCCC"> four hundred six of</font><font color="#E5E5E5"> every</font>

1371
00:49:47,180 --> 00:49:50,569
<font color="#E5E5E5">five</font><font color="#CCCCCC"> hundred six of</font><font color="#E5E5E5"> every eight hundred</font>

1372
00:49:48,680 --> 00:49:52,640
I only have the ones<font color="#CCCCCC"> are important</font>

1373
00:49:50,570 --> 00:49:56,060
<font color="#E5E5E5">because I'm telling you what's in the</font>

1374
00:49:52,640 --> 00:49:57,410
multiple items in one column you want<font color="#CCCCCC"> to</font>

1375
00:49:56,060 --> 00:50:00,140
do this with your<font color="#E5E5E5"> log management as well</font>

1376
00:49:57,410 --> 00:50:01,759
but we hard-coded it and made<font color="#CCCCCC"> it and</font>

1377
00:50:00,140 --> 00:50:02,930
then we tell you what's violated<font color="#CCCCCC"> your</font>

1378
00:50:01,760 --> 00:50:04,610
hundred<font color="#E5E5E5"> thirty eight takes two hundred</font>

1379
00:50:02,930 --> 00:50:05,990
<font color="#CCCCCC">sixty-four</font><font color="#E5E5E5"> pluses that was that big</font>

1380
00:50:04,610 --> 00:50:08,300
blurb I showed you that had the<font color="#E5E5E5"> arrows</font>

1381
00:50:05,990 --> 00:50:10,100
pointing to so suddenly<font color="#CCCCCC"> now I can run</font>

1382
00:50:08,300 --> 00:50:11,990
<font color="#E5E5E5">this across my entire varmints command</font>

1383
00:50:10,100 --> 00:50:13,430
<font color="#E5E5E5">line so now I can go hunting in the</font>

1384
00:50:11,990 --> 00:50:14,839
environment and say once I figure out

1385
00:50:13,430 --> 00:50:16,850
<font color="#E5E5E5">what's normal and I've run this and done</font>

1386
00:50:14,840 --> 00:50:18,970
my testing and<font color="#E5E5E5"> tweaked my settings file</font>

1387
00:50:16,850 --> 00:50:21,890
<font color="#CCCCCC">I</font><font color="#E5E5E5"> can push this out with</font><font color="#CCCCCC"> SSE n</font>

1388
00:50:18,970 --> 00:50:24,140
<font color="#E5E5E5">PowerShell bigfix</font><font color="#CCCCCC"> taenia and whatever</font>

1389
00:50:21,890 --> 00:50:26,060
<font color="#E5E5E5">you're using</font><font color="#CCCCCC"> run this and it should be</font>

1390
00:50:24,140 --> 00:50:29,060
blank<font color="#E5E5E5"> you should get this down to</font><font color="#CCCCCC"> zero</font>

1391
00:50:26,060 --> 00:50:30,950
<font color="#CCCCCC">if they trigger something</font><font color="#E5E5E5"> investigating</font>

1392
00:50:29,060 --> 00:50:32,600
stuck the report back because it has

1393
00:50:30,950 --> 00:50:34,310
data in it<font color="#E5E5E5"> and then we give you the</font>

1394
00:50:32,600 --> 00:50:35,690
<font color="#CCCCCC">first hundred</font><font color="#E5E5E5"> fifty</font><font color="#CCCCCC"> characters or so of</font>

1395
00:50:34,310 --> 00:50:37,160
the actual payload because I can

1396
00:50:35,690 --> 00:50:39,320
generally see if it's bad in the first

1397
00:50:37,160 --> 00:50:40,609
<font color="#CCCCCC">five fifty characters</font><font color="#E5E5E5"> and so that's a</font>

1398
00:50:39,320 --> 00:50:42,020
sneak<font color="#CCCCCC"> peak of</font><font color="#E5E5E5"> what we're doing</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> how</font>

1399
00:50:40,610 --> 00:50:45,640
we're<font color="#CCCCCC"> trying</font><font color="#E5E5E5"> to help it make it easier</font>

1400
00:50:42,020 --> 00:50:49,130
<font color="#E5E5E5">to detect</font><font color="#CCCCCC"> PowerShell pwnage with logon</font><font color="#E5E5E5"> D</font>

1401
00:50:45,640 --> 00:50:51,049
<font color="#E5E5E5">so in summary again</font><font color="#CCCCCC"> it will login DS</font>

1402
00:50:49,130 --> 00:50:52,580
free download it to check your system

1403
00:50:51,050 --> 00:50:55,190
<font color="#E5E5E5">not at your system you've got</font><font color="#CCCCCC"> it upgrade</font>

1404
00:50:52,580 --> 00:50:59,090
to<font color="#E5E5E5"> PowerShell five I beg of you this</font><font color="#CCCCCC"> is</font>

1405
00:50:55,190 --> 00:51:01,250
<font color="#CCCCCC">this is worse than Java Adobe</font><font color="#E5E5E5"> not</font>

1406
00:50:59,090 --> 00:51:03,290
patching<font color="#E5E5E5"> Microsoft</font><font color="#CCCCCC"> ok because</font><font color="#E5E5E5"> this is</font>

1407
00:51:01,250 --> 00:51:05,270
power<font color="#E5E5E5"> to the red team</font>

1408
00:51:03,290 --> 00:51:07,430
power to the<font color="#E5E5E5"> to the pen testers power to</font>

1409
00:51:05,270 --> 00:51:08,840
the hackers<font color="#E5E5E5"> that's on your box</font><font color="#CCCCCC"> they</font>

1410
00:51:07,430 --> 00:51:11,660
could give a rat's<font color="#CCCCCC"> ass whether you're</font>

1411
00:51:08,840 --> 00:51:13,100
patched<font color="#E5E5E5"> got Adobe or Java on the</font><font color="#CCCCCC"> box ok</font>

1412
00:51:11,660 --> 00:51:14,600
<font color="#E5E5E5">they're gonna get a user click on</font>

1413
00:51:13,100 --> 00:51:16,700
something<font color="#CCCCCC"> they're immediately</font><font color="#E5E5E5"> gonna</font><font color="#CCCCCC"> go</font>

1414
00:51:14,600 --> 00:51:18,170
to<font color="#CCCCCC"> PowerShell and so the user</font><font color="#E5E5E5"> is the bad</font>

1415
00:51:16,700 --> 00:51:20,720
link it doesn't matter of the others

1416
00:51:18,170 --> 00:51:23,030
this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> a huge wrist or tore environment</font>

1417
00:51:20,720 --> 00:51:25,009
now<font color="#E5E5E5"> and again use the cheat sheets all</font>

1418
00:51:23,030 --> 00:51:26,810
<font color="#CCCCCC">right turn</font><font color="#E5E5E5"> it on figure out what it</font><font color="#CCCCCC"> is</font>

1419
00:51:25,010 --> 00:51:27,980
<font color="#E5E5E5">you're doing</font><font color="#CCCCCC"> well what</font><font color="#E5E5E5"> do I turn on use</font>

1420
00:51:26,810 --> 00:51:30,110
<font color="#E5E5E5">a cheat</font><font color="#CCCCCC"> sheet</font><font color="#E5E5E5"> you've already figured</font><font color="#CCCCCC"> out</font>

1421
00:51:27,980 --> 00:51:31,670
how to audit<font color="#E5E5E5"> it create reports and</font>

1422
00:51:30,110 --> 00:51:33,800
<font color="#E5E5E5">alerts in your log</font><font color="#CCCCCC"> management sim</font>

1423
00:51:31,670 --> 00:51:35,390
whatever<font color="#E5E5E5"> to look for these</font><font color="#CCCCCC"> conditions</font>

1424
00:51:33,800 --> 00:51:38,120
after<font color="#E5E5E5"> you figure out how to do it in</font>

1425
00:51:35,390 --> 00:51:39,799
<font color="#CCCCCC">your in your McAfee nitro or Splunk or</font>

1426
00:51:38,120 --> 00:51:42,950
elf stack or whatever you want<font color="#E5E5E5"> to use I</font>

1427
00:51:39,800 --> 00:51:44,980
<font color="#E5E5E5">don't care</font><font color="#CCCCCC"> the spot</font><font color="#E5E5E5"> cheat sheet and who</font>

1428
00:51:42,950 --> 00:51:47,950
<font color="#E5E5E5">me oh chi</font><font color="#CCCCCC"> Chi's both have example</font>

1429
00:51:44,980 --> 00:51:49,480
of<font color="#CCCCCC"> regex Ignis out</font><font color="#E5E5E5"> I did give examples</font>

1430
00:51:47,950 --> 00:51:51,700
in those cheat sheets so<font color="#E5E5E5"> that people can</font>

1431
00:51:49,480 --> 00:51:53,560
cheat and use those queries<font color="#E5E5E5"> and tweak</font>

1432
00:51:51,700 --> 00:51:55,899
<font color="#E5E5E5">them</font><font color="#CCCCCC"> I have received a</font><font color="#E5E5E5"> couple tweaks</font>

1433
00:51:53,560 --> 00:51:58,328
from<font color="#E5E5E5"> those queries</font><font color="#CCCCCC"> one queries for sure</font>

1434
00:51:55,900 --> 00:51:59,740
<font color="#E5E5E5">much bigger audience</font><font color="#CCCCCC"> and it</font><font color="#E5E5E5"> helped you</font>

1435
00:51:58,329 --> 00:52:01,450
get started<font color="#CCCCCC"> help</font><font color="#E5E5E5"> you get an idea of how</font>

1436
00:51:59,740 --> 00:52:02,560
<font color="#E5E5E5">to do this in log management and of</font>

1437
00:52:01,450 --> 00:52:03,848
course<font color="#CCCCCC"> send us your improvements if you</font>

1438
00:52:02,560 --> 00:52:05,890
come<font color="#E5E5E5"> up with something clever that you</font>

1439
00:52:03,849 --> 00:52:08,890
think we're missing please share so that

1440
00:52:05,890 --> 00:52:10,900
<font color="#CCCCCC">we can include it and and if we like it</font>

1441
00:52:08,890 --> 00:52:12,700
<font color="#E5E5E5">we think you're on to something</font><font color="#CCCCCC"> by all</font>

1442
00:52:10,900 --> 00:52:14,200
<font color="#CCCCCC">means</font><font color="#E5E5E5"> you may want to be anonymous</font><font color="#CCCCCC"> you</font>

1443
00:52:12,700 --> 00:52:15,279
<font color="#E5E5E5">know you may be afraid and want to be</font>

1444
00:52:14,200 --> 00:52:18,310
<font color="#CCCCCC">anonymous you</font><font color="#E5E5E5"> don't want to say that</font>

1445
00:52:15,280 --> 00:52:20,050
public<font color="#CCCCCC"> but we'll do it and tweet it out</font>

1446
00:52:18,310 --> 00:52:21,820
saying hey<font color="#E5E5E5"> thanks to a credit we</font><font color="#CCCCCC"> you</font>

1447
00:52:20,050 --> 00:52:24,190
know somebody came<font color="#CCCCCC"> up</font><font color="#E5E5E5"> with this and then</font>

1448
00:52:21,820 --> 00:52:26,200
but most mostly<font color="#E5E5E5"> start turning this stuff</font>

1449
00:52:24,190 --> 00:52:29,109
on even if you're just<font color="#E5E5E5"> collecting it</font>

1450
00:52:26,200 --> 00:52:31,390
locally and<font color="#E5E5E5"> use PowerShell or log</font><font color="#CCCCCC"> MD I</font>

1451
00:52:29,109 --> 00:52:33,310
don't care what you're using<font color="#E5E5E5"> to go query</font>

1452
00:52:31,390 --> 00:52:35,950
for<font color="#E5E5E5"> this information</font><font color="#CCCCCC"> in some</font><font color="#E5E5E5"> automated</font>

1453
00:52:33,310 --> 00:52:38,170
daily<font color="#E5E5E5"> weekly or monthly way so you can</font>

1454
00:52:35,950 --> 00:52:39,390
catch these bad guys<font color="#CCCCCC"> because that's how</font>

1455
00:52:38,170 --> 00:52:41,079
they're gonna own you now it is

1456
00:52:39,390 --> 00:52:43,210
<font color="#E5E5E5">incredibly powerful</font>

1457
00:52:41,079 --> 00:52:44,829
what you can do with<font color="#E5E5E5"> PowerShell here's</font>

1458
00:52:43,210 --> 00:52:47,170
we can get the stuff the website login

1459
00:52:44,829 --> 00:52:48,640
<font color="#E5E5E5">be the the president will be</font><font color="#CCCCCC"> on our</font>

1460
00:52:47,170 --> 00:52:50,380
<font color="#E5E5E5">archaeology and</font><font color="#CCCCCC"> their resources it</font>

1461
00:52:48,640 --> 00:52:52,240
already is look<font color="#E5E5E5"> for the</font><font color="#CCCCCC"> show-me Khan I</font>

1462
00:52:50,380 --> 00:52:54,730
<font color="#CCCCCC">was just here and show me Khan last week</font>

1463
00:52:52,240 --> 00:52:57,310
with this<font color="#CCCCCC"> Prez oh and so it's it's this</font>

1464
00:52:54,730 --> 00:52:59,980
<font color="#E5E5E5">Prez oh look for the</font><font color="#CCCCCC"> show-me con item</font>

1465
00:52:57,310 --> 00:53:02,109
<font color="#E5E5E5">and go get the cheat sheets and log away</font>

1466
00:52:59,980 --> 00:53:05,319
with that<font color="#E5E5E5"> I want to give some serious</font>

1467
00:53:02,109 --> 00:53:07,270
kudos to this and<font color="#CCCCCC"> Vincey a blog what</font>

1468
00:53:05,319 --> 00:53:08,319
<font color="#CCCCCC">buzz words I always get</font><font color="#E5E5E5"> this question so</font>

1469
00:53:07,270 --> 00:53:10,150
before you<font color="#E5E5E5"> can ask</font><font color="#CCCCCC"> the question I'm</font>

1470
00:53:08,319 --> 00:53:11,619
gonna tell you what buzz words should I

1471
00:53:10,150 --> 00:53:13,089
go looking for<font color="#E5E5E5"> I understand they're</font>

1472
00:53:11,619 --> 00:53:15,819
<font color="#E5E5E5">gonna be obfuscated or potentially can</font>

1473
00:53:13,089 --> 00:53:17,470
be obfuscated<font color="#E5E5E5"> so how do I</font><font color="#CCCCCC"> then after I</font>

1474
00:53:15,819 --> 00:53:19,650
do<font color="#E5E5E5"> a few skate them what buzz words do I</font>

1475
00:53:17,470 --> 00:53:23,379
look for<font color="#E5E5E5"> before and after the occupation</font>

1476
00:53:19,650 --> 00:53:25,270
<font color="#E5E5E5">they went out</font><font color="#CCCCCC"> and analyzed</font><font color="#E5E5E5"> like 2,000</font>

1477
00:53:23,380 --> 00:53:27,730
samples of malware<font color="#E5E5E5"> that used PowerShell</font>

1478
00:53:25,270 --> 00:53:30,339
<font color="#E5E5E5">and gave statistics and all the ways</font>

1479
00:53:27,730 --> 00:53:33,130
<font color="#E5E5E5">these things were were shortcutted</font>

1480
00:53:30,339 --> 00:53:35,710
<font color="#E5E5E5">obfuscated did some examples to say is I</font>

1481
00:53:33,130 --> 00:53:38,290
<font color="#E5E5E5">do this really</font><font color="#CCCCCC"> good</font><font color="#E5E5E5"> because in the end</font>

1482
00:53:35,710 --> 00:53:40,690
<font color="#E5E5E5">if you read that blog</font><font color="#CCCCCC"> post</font><font color="#E5E5E5"> you'll have</font>

1483
00:53:38,290 --> 00:53:42,849
<font color="#E5E5E5">your short list of items to put in to</font>

1484
00:53:40,690 --> 00:53:44,950
log in these settings<font color="#E5E5E5"> to go hunting for</font>

1485
00:53:42,849 --> 00:53:48,579
so really kudos they did a really good

1486
00:53:44,950 --> 00:53:50,049
<font color="#CCCCCC">job of what actually</font><font color="#E5E5E5"> is occurring Daniel</font>

1487
00:53:48,579 --> 00:53:52,329
will<font color="#E5E5E5"> say but I could do that but they're</font>

1488
00:53:50,050 --> 00:53:53,800
<font color="#CCCCCC">not Daniel 99% of the cases are doing it</font>

1489
00:53:52,329 --> 00:53:56,140
this<font color="#CCCCCC"> way I know you can do it</font><font color="#E5E5E5"> that way</font>

1490
00:53:53,800 --> 00:53:57,160
but they're not and<font color="#E5E5E5"> you</font><font color="#CCCCCC"> gotta solve</font><font color="#E5E5E5"> for</font>

1491
00:53:56,140 --> 00:53:59,019
the 80%

1492
00:53:57,160 --> 00:54:01,000
<font color="#CCCCCC">okay you just won't get to the</font><font color="#E5E5E5"> 20%</font>

1493
00:53:59,019 --> 00:54:03,279
<font color="#E5E5E5">unless you saw the 80%</font><font color="#CCCCCC"> first so please</font>

1494
00:54:01,000 --> 00:54:05,170
do this first<font color="#E5E5E5"> and</font><font color="#CCCCCC"> then worry about the</font>

1495
00:54:03,279 --> 00:54:07,089
<font color="#E5E5E5">Daniel type but I can get around it with</font>

1496
00:54:05,170 --> 00:54:09,309
<font color="#E5E5E5">that and then figure</font><font color="#CCCCCC"> out if</font><font color="#E5E5E5"> maybe</font><font color="#CCCCCC"> we're</font>

1497
00:54:07,089 --> 00:54:11,470
<font color="#CCCCCC">quick</font><font color="#E5E5E5"> to you here's a bunch of stuff</font>

1498
00:54:09,309 --> 00:54:13,450
<font color="#CCCCCC">Daniel's links to the obfuscation</font><font color="#E5E5E5"> and</font>

1499
00:54:11,470 --> 00:54:14,980
then of course<font color="#E5E5E5"> one of the things that</font>

1500
00:54:13,450 --> 00:54:17,348
Carlos Perez former colleague<font color="#E5E5E5"> of mine at</font>

1501
00:54:14,980 --> 00:54:18,609
HP he wrote a<font color="#E5E5E5"> mouse</font><font color="#CCCCCC"> flight module that</font>

1502
00:54:17,349 --> 00:54:20,380
<font color="#CCCCCC">goes</font><font color="#E5E5E5"> out and looks for the logging that</font>

1503
00:54:18,609 --> 00:54:22,328
<font color="#E5E5E5">I tell you to turn</font><font color="#CCCCCC"> on so he can</font>

1504
00:54:20,380 --> 00:54:24,490
determine whether<font color="#CCCCCC"> or not he can do this</font>

1505
00:54:22,329 --> 00:54:26,680
without getting<font color="#E5E5E5"> caught</font><font color="#CCCCCC"> oh shoot they're</font>

1506
00:54:24,490 --> 00:54:28,118
doing all<font color="#E5E5E5"> the cheats stuff I can't do</font>

1507
00:54:26,680 --> 00:54:30,940
those because<font color="#CCCCCC"> he'll catch me now he has</font>

1508
00:54:28,119 --> 00:54:33,160
to do a different attack<font color="#CCCCCC"> okay</font><font color="#E5E5E5"> which</font>

1509
00:54:30,940 --> 00:54:34,480
<font color="#E5E5E5">means if you audit the keys better in</font>

1510
00:54:33,160 --> 00:54:36,009
the cheat sheets that<font color="#E5E5E5"> he's doing in the</font>

1511
00:54:34,480 --> 00:54:39,700
Metasploit module<font color="#E5E5E5"> and he reads them</font>

1512
00:54:36,009 --> 00:54:41,859
<font color="#E5E5E5">you're gonna catch it</font><font color="#CCCCCC"> just say I love</font>

1513
00:54:39,700 --> 00:54:44,410
you Carlos<font color="#E5E5E5"> but I can catch</font><font color="#CCCCCC"> you here's we</font>

1514
00:54:41,859 --> 00:54:45,788
can find us and again my blog and the

1515
00:54:44,410 --> 00:54:48,640
cheat sheets are there and please listen

1516
00:54:45,789 --> 00:54:50,140
to<font color="#CCCCCC"> our podcast we have fun</font><font color="#E5E5E5"> with it</font>

1517
00:54:48,640 --> 00:54:52,930
I got some nice little<font color="#E5E5E5"> noise bits that I</font>

1518
00:54:50,140 --> 00:54:57,009
tend to make me laugh anyway<font color="#CCCCCC"> and with</font>

1519
00:54:52,930 --> 00:54:58,509
<font color="#E5E5E5">that we'll take questions shoot</font><font color="#CCCCCC"> I don't</font>

1520
00:54:57,009 --> 00:55:01,680
<font color="#CCCCCC">see you</font><font color="#E5E5E5"> today I'm only don't be a person</font>

1521
00:54:58,509 --> 00:55:01,680
holding you back from beer but come on

1522
00:55:05,700 --> 00:55:13,049
<font color="#CCCCCC">PR easy</font><font color="#E5E5E5"> he now works for binary defenses</font>

1523
00:55:09,910 --> 00:55:18,868
with Dave Kennedy<font color="#E5E5E5"> tell him I said hi</font><font color="#CCCCCC"> I</font>

1524
00:55:13,049 --> 00:55:18,869
think<font color="#CCCCCC"> I just did Aiko's yes</font>

1525
00:55:23,460 --> 00:55:31,150
do you have to be an admin<font color="#E5E5E5"> should they</font>

1526
00:55:27,670 --> 00:55:32,920
<font color="#E5E5E5">be doing that</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> don't have to</font>

1527
00:55:31,150 --> 00:55:34,479
<font color="#CCCCCC">powershell we're on roll we're on as a</font>

1528
00:55:32,920 --> 00:55:36,210
user context<font color="#CCCCCC"> it's depending on</font><font color="#E5E5E5"> what</font>

1529
00:55:34,479 --> 00:55:38,470
you're accessing<font color="#E5E5E5"> so it's the same</font>

1530
00:55:36,210 --> 00:55:41,170
<font color="#E5E5E5">limitations you</font><font color="#CCCCCC"> have as you know command</font>

1531
00:55:38,470 --> 00:55:43,299
shell<font color="#CCCCCC"> you</font><font color="#E5E5E5"> can like again anything user</font>

1532
00:55:41,170 --> 00:55:44,470
space<font color="#E5E5E5"> all the HQ user key and all that</font>

1533
00:55:43,299 --> 00:55:46,059
stuff they can do they can<font color="#E5E5E5"> run</font>

1534
00:55:44,470 --> 00:55:48,009
PowerShell<font color="#E5E5E5"> they do queries</font><font color="#CCCCCC"> they'll only</font>

1535
00:55:46,059 --> 00:55:50,680
get<font color="#CCCCCC"> rejected if they're doing admin</font>

1536
00:55:48,009 --> 00:55:53,410
stuff they'll they'll escalate privilege

1537
00:55:50,680 --> 00:55:55,149
for sure<font color="#CCCCCC"> but bad guys if they get that</font>

1538
00:55:53,410 --> 00:55:56,859
deep they will escalate become admins

1539
00:55:55,150 --> 00:55:58,299
<font color="#E5E5E5">but you don't have to there's a lot of</font>

1540
00:55:56,859 --> 00:56:00,999
PowerShell you can do<font color="#E5E5E5"> it not an admin</font>

1541
00:55:58,299 --> 00:56:04,288
any other questions<font color="#CCCCCC"> I</font><font color="#E5E5E5"> build with you</font>

1542
00:56:00,999 --> 00:56:04,288
drinking beer so you<font color="#E5E5E5"> can always come</font>

1543
00:56:17,620 --> 00:56:22,540
yeah<font color="#E5E5E5"> so the</font><font color="#CCCCCC"> question there is couldn't I</font>

1544
00:56:20,590 --> 00:56:26,040
just modify an existing script the

1545
00:56:22,540 --> 00:56:26,040
answer is yes this<font color="#E5E5E5"> is what they do with</font>

1546
00:56:40,500 --> 00:56:46,660
that you<font color="#CCCCCC"> see script</font><font color="#E5E5E5"> the current</font><font color="#CCCCCC"> VBS</font>

1547
00:56:44,020 --> 00:56:48,040
script<font color="#E5E5E5"> right and</font><font color="#CCCCCC"> those</font><font color="#E5E5E5"> just add their</font>

1548
00:56:46,660 --> 00:56:50,470
clue to that<font color="#E5E5E5"> and so when it triggers</font>

1549
00:56:48,040 --> 00:56:52,480
normally you know Dan actually<font color="#E5E5E5"> updated</font>

1550
00:56:50,470 --> 00:56:54,959
the<font color="#CCCCCC"> database they tweak the script so</font>

1551
00:56:52,480 --> 00:56:54,960
the hashing

