1
00:00:15,690 --> 00:00:20,189
I'm Ryan know what I work at carbon

2
00:00:20,189 --> 00:00:21,990
black you guys have heard of that

3
00:00:21,990 --> 00:00:25,039
company we have a couple of cool tools

4
00:00:25,039 --> 00:00:28,710
give you an idea what we're going to be

5
00:00:28,710 --> 00:00:30,539
talking about today is kind of an

6
00:00:30,539 --> 00:00:33,120
extension of two of the other talks the

7
00:00:33,120 --> 00:00:35,010
last one with malware pipelining the one

8
00:00:35,010 --> 00:00:38,219
before that dealt with ransomware the

9
00:00:38,219 --> 00:00:40,770
difference between the talks is i'm

10
00:00:40,770 --> 00:00:42,840
going to show you both an attack and a

11
00:00:42,840 --> 00:00:47,550
defense that you can repeat that i'm not

12
00:00:47,550 --> 00:00:52,170
going to be you know responsible for

13
00:00:52,170 --> 00:00:53,909
what you do with it but you're going to

14
00:00:53,909 --> 00:00:58,710
have some ways to play as well as i'm

15
00:00:58,710 --> 00:01:00,239
going to be able to skip over a bunch of

16
00:01:00,239 --> 00:01:01,949
the beginning stuff of what is

17
00:01:01,949 --> 00:01:03,420
ransomware and whatnot because we've

18
00:01:03,420 --> 00:01:07,860
already talked about it a bit and now my

19
00:01:07,860 --> 00:01:09,780
slides are actually going to work

20
00:01:09,780 --> 00:01:13,920
awesome so welcome to the presentation I

21
00:01:13,920 --> 00:01:16,170
currently run security operations for

22
00:01:16,170 --> 00:01:20,460
carbon black as a disclaimer some of the

23
00:01:20,460 --> 00:01:22,500
screenshots in here do you have the

24
00:01:22,500 --> 00:01:24,840
company's products on it but that's

25
00:01:24,840 --> 00:01:27,180
mostly because I don't have to pay to

26
00:01:27,180 --> 00:01:29,760
use them and they work pretty good but I

27
00:01:29,760 --> 00:01:31,560
promise you no one in marketing has seen

28
00:01:31,560 --> 00:01:35,460
this or HR as you'll find out so you

29
00:01:35,460 --> 00:01:36,810
don't have to worry about that kind of

30
00:01:36,810 --> 00:01:41,250
stuff i'm going to give you guys a an

31
00:01:41,250 --> 00:01:45,000
overview really quickly what i do some

32
00:01:45,000 --> 00:01:47,220
of the uses why i can talk about some of

33
00:01:47,220 --> 00:01:50,040
this stuff as well as show you the

34
00:01:50,040 --> 00:01:53,490
entire attack chain from once you get

35
00:01:53,490 --> 00:01:56,280
onto the system I left out the actual

36
00:01:56,280 --> 00:01:58,280
exploitation portion of the attack

37
00:01:58,280 --> 00:02:00,450
because then I'm really going to be

38
00:02:00,450 --> 00:02:02,280
responsible for doing terrible things so

39
00:02:02,280 --> 00:02:04,410
I only want to show you the parts that

40
00:02:04,410 --> 00:02:07,710
you'll have to work on to reproduce the

41
00:02:07,710 --> 00:02:09,239
specific variant that I'm going to be

42
00:02:09,239 --> 00:02:11,280
talking about is cryptolocker version 1

43
00:02:11,280 --> 00:02:13,860
and that's particularly because i only

44
00:02:13,860 --> 00:02:16,680
have time to go for one variant time box

45
00:02:16,680 --> 00:02:21,840
was so first of all as i said i run

46
00:02:21,840 --> 00:02:24,390
security operations I've been doing

47
00:02:24,390 --> 00:02:28,740
threat research forensics on linux mac

48
00:02:28,740 --> 00:02:30,720
windows for probably bout 10 plus years

49
00:02:30,720 --> 00:02:38,130
now slide that over and some of my daily

50
00:02:38,130 --> 00:02:40,970
responsibilities now are as the main

51
00:02:40,970 --> 00:02:43,260
security engineer for the company I do a

52
00:02:43,260 --> 00:02:44,760
lot of the architecting of the solutions

53
00:02:44,760 --> 00:02:47,250
but I also like to go to the dark places

54
00:02:47,250 --> 00:02:48,710
on the internet and poke it with a stick

55
00:02:48,710 --> 00:02:51,690
and I've been able to actually implement

56
00:02:51,690 --> 00:02:54,230
a bunch of that into the products of

57
00:02:54,230 --> 00:02:56,430
speaking of the ransom where's I

58
00:02:56,430 --> 00:02:59,760
actually invented a way to block the

59
00:02:59,760 --> 00:03:01,770
infection of cryptolocker version 1 2

60
00:03:01,770 --> 00:03:03,930
and 3 from actually happening on the

61
00:03:03,930 --> 00:03:06,270
system I can talk a bit more about that

62
00:03:06,270 --> 00:03:07,890
later because it's not particularly

63
00:03:07,890 --> 00:03:10,260
related to this but I'm sure we can find

64
00:03:10,260 --> 00:03:14,640
a beer somewhere and talk about it this

65
00:03:14,640 --> 00:03:16,980
is what I just grabbed my job as not

66
00:03:16,980 --> 00:03:18,990
only do we eat our own dog food but we

67
00:03:18,990 --> 00:03:21,660
also clean up after it I highly suggest

68
00:03:21,660 --> 00:03:23,280
you do the same with any technologies

69
00:03:23,280 --> 00:03:27,780
that you guys do but first and foremost

70
00:03:27,780 --> 00:03:30,240
I'll jump through this real quick the

71
00:03:30,240 --> 00:03:34,770
what's ransomware really good before you

72
00:03:34,770 --> 00:03:37,020
know the basic definition it basically

73
00:03:37,020 --> 00:03:41,160
ransomware blocks you from being able to

74
00:03:41,160 --> 00:03:43,740
utilize your system from one fashion or

75
00:03:43,740 --> 00:03:48,210
another it encrypts files it will block

76
00:03:48,210 --> 00:03:50,010
processes from running it has a whole

77
00:03:50,010 --> 00:03:52,890
bunch of things that it can do it mostly

78
00:03:52,890 --> 00:03:54,750
made the news because of the encryption

79
00:03:54,750 --> 00:03:57,630
aspect of the ransomware previous

80
00:03:57,630 --> 00:04:01,380
versions were really more of crap where

81
00:04:01,380 --> 00:04:04,350
it was a joke right you had a nice pop

82
00:04:04,350 --> 00:04:06,000
up on your screen they told you that

83
00:04:06,000 --> 00:04:07,380
you've looked at something terrible and

84
00:04:07,380 --> 00:04:08,370
you need to pay the money or they're

85
00:04:08,370 --> 00:04:10,170
going to tell everyone you could go kill

86
00:04:10,170 --> 00:04:13,080
the processing and task manager reboot

87
00:04:13,080 --> 00:04:15,000
your system clean the files and like

88
00:04:15,000 --> 00:04:17,250
nothing ever happened that's no longer

89
00:04:17,250 --> 00:04:20,190
the case the options that the ransomware

90
00:04:20,190 --> 00:04:21,450
can do to your system are pretty

91
00:04:21,450 --> 00:04:24,240
numerous they demand money all kinds of

92
00:04:24,240 --> 00:04:25,620
other good things but by far and away

93
00:04:25,620 --> 00:04:28,020
the most evil thing I've seen ransomware

94
00:04:28,020 --> 00:04:31,470
do is make you complete surveys in order

95
00:04:31,470 --> 00:04:34,710
to get your stuff unlocked um that is

96
00:04:34,710 --> 00:04:38,669
one devious maniacal d-bag for sure oh

97
00:04:38,669 --> 00:04:40,669
it's just

98
00:04:40,669 --> 00:04:42,780
as we're talking about the malware

99
00:04:42,780 --> 00:04:46,199
pipeline I have a one that I built and I

100
00:04:46,199 --> 00:04:48,539
was trying to figure out why the

101
00:04:48,539 --> 00:04:50,300
execution wouldn't finish for about

102
00:04:50,300 --> 00:04:52,710
10,000 runs of a file and it kept

103
00:04:52,710 --> 00:04:54,270
stopping every couple of runs and I

104
00:04:54,270 --> 00:04:56,160
finally viewed it live and it was

105
00:04:56,160 --> 00:04:57,449
because it was trying to get my

106
00:04:57,449 --> 00:05:01,070
automated system to complete a survey

107
00:05:01,070 --> 00:05:06,300
the always good stuff so skip it through

108
00:05:06,300 --> 00:05:07,889
that I'm gonna skip into what V shadow

109
00:05:07,889 --> 00:05:09,930
is this also got brought up during the

110
00:05:09,930 --> 00:05:12,210
ransomware topic because one of the

111
00:05:12,210 --> 00:05:14,760
things that ransomware it does is it

112
00:05:14,760 --> 00:05:17,250
goes in and removes V shadow your actual

113
00:05:17,250 --> 00:05:19,680
shadow copies on the system by using v

114
00:05:19,680 --> 00:05:23,010
shadow or VSS admin or one of the other

115
00:05:23,010 --> 00:05:26,039
tools that ends up actually interacting

116
00:05:26,039 --> 00:05:27,870
and managing your shadow copies on your

117
00:05:27,870 --> 00:05:30,060
system for those of you they don't know

118
00:05:30,060 --> 00:05:32,430
what shadow copies are those are backups

119
00:05:32,430 --> 00:05:35,430
of your files probably everyone has seen

120
00:05:35,430 --> 00:05:37,849
this host property screen before and

121
00:05:37,849 --> 00:05:41,699
sometimes when your office application

122
00:05:41,699 --> 00:05:43,860
crashes you'll have those backup

123
00:05:43,860 --> 00:05:45,570
recoverable files and then if you click

124
00:05:45,570 --> 00:05:47,820
on that document that crashed sometimes

125
00:05:47,820 --> 00:05:49,590
it'll have previous versions saved and

126
00:05:49,590 --> 00:05:51,419
you can restore from those previous

127
00:05:51,419 --> 00:05:54,990
versions that's the most common use the

128
00:05:54,990 --> 00:05:57,870
V shadow is the command line tool that

129
00:05:57,870 --> 00:05:59,370
you use to interface with these shadows

130
00:05:59,370 --> 00:06:03,510
and it's a tool made by microsoft that

131
00:06:03,510 --> 00:06:07,919
is available after windows XP kind of

132
00:06:07,919 --> 00:06:09,510
pretty much available for all the

133
00:06:09,510 --> 00:06:12,150
systems you can get a bunch of different

134
00:06:12,150 --> 00:06:14,310
emulators they have a 32-bit and the

135
00:06:14,310 --> 00:06:17,490
64-bit in order to go the SIS in order

136
00:06:17,490 --> 00:06:19,500
to work on the different systems but

137
00:06:19,500 --> 00:06:22,650
prior to that this wasn't available for

138
00:06:22,650 --> 00:06:24,780
an attack vector because it wasn't

139
00:06:24,780 --> 00:06:26,720
actually built into XP and think until

140
00:06:26,720 --> 00:06:29,430
after service pack 3 like vista was

141
00:06:29,430 --> 00:06:32,070
already out and then they backported a

142
00:06:32,070 --> 00:06:36,479
lot of it the reason why we bring up why

143
00:06:36,479 --> 00:06:40,800
this is so interesting is because VSS

144
00:06:40,800 --> 00:06:44,550
admin is a microsoft sign binary so the

145
00:06:44,550 --> 00:06:46,710
attackers are leveraging legitimately

146
00:06:46,710 --> 00:06:49,620
signed binaries into their attack which

147
00:06:49,620 --> 00:06:51,150
makes them look even more like

148
00:06:51,150 --> 00:06:53,090
legitimate behavior on your sis

149
00:06:53,090 --> 00:06:55,160
much harder to detect much harder to

150
00:06:55,160 --> 00:06:57,410
defend against and because you're using

151
00:06:57,410 --> 00:06:59,750
a legitimate workflow to go through the

152
00:06:59,750 --> 00:07:02,810
attack you can take different vectors to

153
00:07:02,810 --> 00:07:04,790
get to the same legitimate execution and

154
00:07:04,790 --> 00:07:06,290
it gives the attackers a lot more

155
00:07:06,290 --> 00:07:09,190
flexibility and what they're going to do

156
00:07:09,190 --> 00:07:12,710
so i'm going to show you guys how to use

157
00:07:12,710 --> 00:07:16,010
microsoft against itself we're going to

158
00:07:16,010 --> 00:07:18,169
break some stuff as the disclaimer said

159
00:07:18,169 --> 00:07:22,550
please use your best judgment but let's

160
00:07:22,550 --> 00:07:28,160
break something alright the variant of

161
00:07:28,160 --> 00:07:29,720
cryptolocker that i'm going to talk

162
00:07:29,720 --> 00:07:32,389
about is specifically known for deleting

163
00:07:32,389 --> 00:07:37,070
the volume shadow copies and this this

164
00:07:37,070 --> 00:07:38,479
basically stops you from restoring from

165
00:07:38,479 --> 00:07:42,590
backup locally on the system this is all

166
00:07:42,590 --> 00:07:45,919
going to be aimed towards if you had a

167
00:07:45,919 --> 00:07:49,039
ransomware infection on grandma Jo

168
00:07:49,039 --> 00:07:51,289
system I like that name I'm going to

169
00:07:51,289 --> 00:07:53,870
keep using that one not in your

170
00:07:53,870 --> 00:07:57,050
enterprise for this first portion so I'm

171
00:07:57,050 --> 00:07:58,669
only going to be looking at tools that

172
00:07:58,669 --> 00:08:00,889
are available to you on grandma geos

173
00:08:00,889 --> 00:08:06,830
system all right um I've observed a lot

174
00:08:06,830 --> 00:08:08,720
of various techniques utilizing volume

175
00:08:08,720 --> 00:08:11,780
shadows lately it's been for avoiding

176
00:08:11,780 --> 00:08:13,820
detection and what's called anti

177
00:08:13,820 --> 00:08:17,840
analysis or anti forensics as spoke out

178
00:08:17,840 --> 00:08:21,590
in our pipeline talk up attackers are

179
00:08:21,590 --> 00:08:23,510
putting different code into their

180
00:08:23,510 --> 00:08:26,180
malware in order to avoid being analyzed

181
00:08:26,180 --> 00:08:28,910
or to be found the difference between

182
00:08:28,910 --> 00:08:31,099
something like this for an anti

183
00:08:31,099 --> 00:08:34,309
forensics angle vs. using the red pill

184
00:08:34,309 --> 00:08:37,580
type code snippet is this isn't trying

185
00:08:37,580 --> 00:08:39,799
to hide from virtualization this is

186
00:08:39,799 --> 00:08:41,900
trying to hide from incident responders

187
00:08:41,900 --> 00:08:43,820
your cert team the person who's going to

188
00:08:43,820 --> 00:08:45,980
go on to a system that you already know

189
00:08:45,980 --> 00:08:47,390
is compromised because you've been

190
00:08:47,390 --> 00:08:50,120
alerted somehow some way and they are

191
00:08:50,120 --> 00:08:52,490
trying to hide the file system artifacts

192
00:08:52,490 --> 00:08:55,400
as well as the trail to where the

193
00:08:55,400 --> 00:08:58,040
infection actually lives the technique

194
00:08:58,040 --> 00:08:59,150
that I'm going to show you is a

195
00:08:59,150 --> 00:09:03,020
four-part technique I'm skipping over

196
00:09:03,020 --> 00:09:05,540
the exploitation stage and I'm going

197
00:09:05,540 --> 00:09:07,010
right into the attackers drop them

198
00:09:07,010 --> 00:09:09,770
the vial system via whatever infection

199
00:09:09,770 --> 00:09:12,590
mechanism they want they create a volume

200
00:09:12,590 --> 00:09:15,560
shadow they then mount the shadow and

201
00:09:15,560 --> 00:09:18,590
execute the malware and then they

202
00:09:18,590 --> 00:09:21,230
unmount and delete the shadow what this

203
00:09:21,230 --> 00:09:24,920
does is after unmounting and leaving of

204
00:09:24,920 --> 00:09:27,350
the shadow the executed malware is still

205
00:09:27,350 --> 00:09:30,680
running so i'll show you how that kind

206
00:09:30,680 --> 00:09:32,630
of attack works and basically what we're

207
00:09:32,630 --> 00:09:34,280
doing is removing filesystem artifacts

208
00:09:34,280 --> 00:09:37,370
so if you drop this into a copy of any

209
00:09:37,370 --> 00:09:39,830
case or something like that I mean not

210
00:09:39,830 --> 00:09:41,210
going to have file system artifacts to

211
00:09:41,210 --> 00:09:43,400
work with to do that audit trail or the

212
00:09:43,400 --> 00:09:47,770
forensic analysis first and foremost

213
00:09:47,770 --> 00:09:52,460
we've got to create a shadow so what we

214
00:09:52,460 --> 00:09:56,420
do here is we end up running the V

215
00:09:56,420 --> 00:09:58,940
shadow executable with the dash p option

216
00:09:58,940 --> 00:10:02,150
what this is doing is this is P kind of

217
00:10:02,150 --> 00:10:04,940
pointing at the source that you're going

218
00:10:04,940 --> 00:10:06,860
to end up copying and creating the

219
00:10:06,860 --> 00:10:09,530
shadow of in this case we're saying the

220
00:10:09,530 --> 00:10:12,590
rootsy directory you can make this

221
00:10:12,590 --> 00:10:14,930
whatever file path you want I'm doing it

222
00:10:14,930 --> 00:10:18,290
to make it simple and short and what

223
00:10:18,290 --> 00:10:20,240
we're doing there is we're mounting this

224
00:10:20,240 --> 00:10:22,430
and now we have basically created a

225
00:10:22,430 --> 00:10:25,310
persistent see a shadow of the full C

226
00:10:25,310 --> 00:10:27,950
Drive there's a bunch of links in it now

227
00:10:27,950 --> 00:10:33,860
so what is C / malware / bad guy dot exe

228
00:10:33,860 --> 00:10:37,250
is now mountable in different places in

229
00:10:37,250 --> 00:10:40,280
the file structure in your entire

230
00:10:40,280 --> 00:10:42,470
directory tree pretty much you can

231
00:10:42,470 --> 00:10:45,290
choose wherever you want to go one of

232
00:10:45,290 --> 00:10:47,800
the things to pay attention to here is

233
00:10:47,800 --> 00:10:50,570
where it's a shadow name I realized

234
00:10:50,570 --> 00:10:51,710
pointed out the screen you can't see

235
00:10:51,710 --> 00:10:55,160
what I point at the shadow name I named

236
00:10:55,160 --> 00:10:59,540
you know volume Shadow Copy three the

237
00:10:59,540 --> 00:11:01,700
reason I bring this up is this is

238
00:11:01,700 --> 00:11:04,070
basically what the identifier is for the

239
00:11:04,070 --> 00:11:05,600
rest of the attack so you know we're

240
00:11:05,600 --> 00:11:10,970
working with the same stuff so what we

241
00:11:10,970 --> 00:11:13,610
do next is we mount the shadow with the

242
00:11:13,610 --> 00:11:15,980
make link command once again this is

243
00:11:15,980 --> 00:11:17,750
creating those links the pointers

244
00:11:17,750 --> 00:11:19,400
between what

245
00:11:19,400 --> 00:11:21,440
actually exists on the file system and

246
00:11:21,440 --> 00:11:27,200
what exists inside the shadow the next

247
00:11:27,200 --> 00:11:29,480
thing that we're doing is we are now

248
00:11:29,480 --> 00:11:32,150
taking that shadow and we're creating a

249
00:11:32,150 --> 00:11:35,240
new directory in the system32 directory

250
00:11:35,240 --> 00:11:39,140
called msdc if you guys are doing an

251
00:11:39,140 --> 00:11:40,850
analysis on a system and you saw

252
00:11:40,850 --> 00:11:44,320
something running out a system 32 / msdc

253
00:11:44,320 --> 00:11:46,460
probably think it's Microsoft related

254
00:11:46,460 --> 00:11:49,310
right normally when your own through

255
00:11:49,310 --> 00:11:50,960
file system you're looking for low

256
00:11:50,960 --> 00:11:52,640
hanging fruit what doesn't really look

257
00:11:52,640 --> 00:11:54,770
normal this is going to end up off of

258
00:11:54,770 --> 00:11:56,780
your short list for the first run a lot

259
00:11:56,780 --> 00:11:59,500
of the time it looks pretty legitimate

260
00:11:59,500 --> 00:12:01,730
what we're doing here is we're creating

261
00:12:01,730 --> 00:12:05,360
a symlink between this new directory

262
00:12:05,360 --> 00:12:07,760
that we just created in system32 in that

263
00:12:07,760 --> 00:12:11,510
shadow copy of roots edirectory the

264
00:12:11,510 --> 00:12:14,960
malware the binary is now placed in the

265
00:12:14,960 --> 00:12:18,110
root of the shadow so inside the Shadow

266
00:12:18,110 --> 00:12:21,890
Copy c / malware exe is the actual

267
00:12:21,890 --> 00:12:24,620
legitimate path of this however because

268
00:12:24,620 --> 00:12:27,320
of the links that we created when you

269
00:12:27,320 --> 00:12:29,120
look at it in task manager or you're

270
00:12:29,120 --> 00:12:32,030
looking at it in the command prompt to

271
00:12:32,030 --> 00:12:34,160
look at where stuff is coming from it

272
00:12:34,160 --> 00:12:35,720
now looks like it's running out of

273
00:12:35,720 --> 00:12:41,030
system32 / msdc in this case I made the

274
00:12:41,030 --> 00:12:44,540
binary be called Mallory exe i actually

275
00:12:44,540 --> 00:12:47,380
just cloned command exe and renamed it

276
00:12:47,380 --> 00:12:50,540
just it's a binary that we could have

277
00:12:50,540 --> 00:12:53,450
made it do whatever we wanted once the

278
00:12:53,450 --> 00:12:55,460
symlinks created the contents of the

279
00:12:55,460 --> 00:12:57,260
shadow are accessible via normal file

280
00:12:57,260 --> 00:12:59,270
system operations so once again you can

281
00:12:59,270 --> 00:13:02,620
you can der the directory you can

282
00:13:02,620 --> 00:13:05,450
interact with it through other scripts

283
00:13:05,450 --> 00:13:09,170
applications this makes it look like it

284
00:13:09,170 --> 00:13:11,000
exists just as if it was actually

285
00:13:11,000 --> 00:13:13,250
running on your file system and not

286
00:13:13,250 --> 00:13:18,440
inside the shadow so what we're doing

287
00:13:18,440 --> 00:13:21,350
here is I'm going to create in actually

288
00:13:21,350 --> 00:13:24,560
execute this malware and make it run I'm

289
00:13:24,560 --> 00:13:26,420
doing all this graphically this would

290
00:13:26,420 --> 00:13:28,850
all be done via a script but that's not

291
00:13:28,850 --> 00:13:32,780
as much fun to see and also it I get to

292
00:13:32,780 --> 00:13:33,290
make more

293
00:13:33,290 --> 00:13:36,529
rose and I really like this Oh once the

294
00:13:36,529 --> 00:13:38,630
filesystem setups in place the malware

295
00:13:38,630 --> 00:13:40,480
started just like any other executable

296
00:13:40,480 --> 00:13:42,769
you can kick that off any way you want

297
00:13:42,769 --> 00:13:44,449
through command shell double-click in it

298
00:13:44,449 --> 00:13:46,370
there's a million ways to execute stuff

299
00:13:46,370 --> 00:13:49,730
when the malware started and is shown in

300
00:13:49,730 --> 00:13:52,069
a tool like process explorer or in this

301
00:13:52,069 --> 00:13:54,620
case we're looking at task manager it

302
00:13:54,620 --> 00:13:56,360
shows that it's actually running out of

303
00:13:56,360 --> 00:14:01,190
system 32 / MS DC / mallard exe which as

304
00:14:01,190 --> 00:14:04,639
we know doesn't really exist because we

305
00:14:04,639 --> 00:14:07,430
just created it for the shadow this does

306
00:14:07,430 --> 00:14:09,259
not exist on the file system there's no

307
00:14:09,259 --> 00:14:11,779
file system artifacts for it it's a link

308
00:14:11,779 --> 00:14:15,980
it does not exist so the path as we're

309
00:14:15,980 --> 00:14:16,819
saying it doesn't really look that

310
00:14:16,819 --> 00:14:20,509
suspicious at first glance pretend it's

311
00:14:20,509 --> 00:14:24,709
not called malware DXE but it looks very

312
00:14:24,709 --> 00:14:28,279
legitimate at that time once the malware

313
00:14:28,279 --> 00:14:30,410
started the attacker can unmount and

314
00:14:30,410 --> 00:14:32,060
delete the shadow and the Mauer will

315
00:14:32,060 --> 00:14:34,610
continue to run the attacker wants to

316
00:14:34,610 --> 00:14:36,259
remove as much forensic evidence as

317
00:14:36,259 --> 00:14:38,569
possible so they will remain persistent

318
00:14:38,569 --> 00:14:42,380
and undetected one of the downsides of

319
00:14:42,380 --> 00:14:44,329
this technique is if they decide to

320
00:14:44,329 --> 00:14:47,269
reboot the system the Mauer goes away

321
00:14:47,269 --> 00:14:49,040
because at this point is only running in

322
00:14:49,040 --> 00:14:51,410
memory because they have now unmounted

323
00:14:51,410 --> 00:14:53,779
the shadow and deleted the shadow the

324
00:14:53,779 --> 00:14:55,610
file system artifacts are gone it is all

325
00:14:55,610 --> 00:14:58,610
in memory at this point the technique is

326
00:14:58,610 --> 00:15:00,319
a nice hiding mechanism throws in a

327
00:15:00,319 --> 00:15:02,510
little anti forensics will really piss

328
00:15:02,510 --> 00:15:06,260
off investigators and is really commonly

329
00:15:06,260 --> 00:15:09,380
seen against server architecture not

330
00:15:09,380 --> 00:15:13,060
specifically grandma Joe's system

331
00:15:13,060 --> 00:15:15,319
because that's a one-off it's not really

332
00:15:15,319 --> 00:15:17,089
worth using this giant exploit in this

333
00:15:17,089 --> 00:15:19,100
really cool way to hide when they can

334
00:15:19,100 --> 00:15:21,380
just drop a normal binary on it because

335
00:15:21,380 --> 00:15:24,319
she'll never know what to look for so in

336
00:15:24,319 --> 00:15:28,040
this case you're looking specifically to

337
00:15:28,040 --> 00:15:30,350
put this on systems that are not often

338
00:15:30,350 --> 00:15:32,990
rebooted financial institutions were

339
00:15:32,990 --> 00:15:35,389
talked about a lot today a lot of their

340
00:15:35,389 --> 00:15:37,160
trading platforms anything that's right

341
00:15:37,160 --> 00:15:41,930
high frequency trading mainframes that

342
00:15:41,930 --> 00:15:44,300
have the windows plugin and attachments

343
00:15:44,300 --> 00:15:46,700
with it those are also really

344
00:15:46,700 --> 00:15:50,230
popular for these kind of things so

345
00:15:50,230 --> 00:15:52,460
we're going to go over a little bit of

346
00:15:52,460 --> 00:15:55,040
the visibility you know what happened on

347
00:15:55,040 --> 00:15:57,530
the system for these next couple of

348
00:15:57,530 --> 00:16:00,050
steps I'm going to do a mix of what you

349
00:16:00,050 --> 00:16:03,260
see on the actual system versus what I

350
00:16:03,260 --> 00:16:05,510
can see in an IR tool that I was using

351
00:16:05,510 --> 00:16:08,210
you can interchange this section with

352
00:16:08,210 --> 00:16:10,460
any I our tool you want to use that has

353
00:16:10,460 --> 00:16:12,920
both visibilities of the file system as

354
00:16:12,920 --> 00:16:17,480
well as the memory so we're going to

355
00:16:17,480 --> 00:16:20,000
answer two questions here what I meant

356
00:16:20,000 --> 00:16:21,530
on the host from the hosts point of view

357
00:16:21,530 --> 00:16:23,150
and what happens on the host when you're

358
00:16:23,150 --> 00:16:26,390
actually doing an IR on the system keep

359
00:16:26,390 --> 00:16:27,920
in mind that the two main things that

360
00:16:27,920 --> 00:16:29,540
we're doing here is we're doing

361
00:16:29,540 --> 00:16:32,900
visibility and accountability and the

362
00:16:32,900 --> 00:16:34,970
more you increase your visibility the

363
00:16:34,970 --> 00:16:37,640
tighter the loop gets around your actual

364
00:16:37,640 --> 00:16:39,800
target now you can account for who did

365
00:16:39,800 --> 00:16:41,690
what and when and that's what we're

366
00:16:41,690 --> 00:16:45,740
going to try and answer so you don't

367
00:16:45,740 --> 00:16:47,540
have to memorize the slide there will be

368
00:16:47,540 --> 00:16:49,970
a test later though but this is just

369
00:16:49,970 --> 00:16:52,490
give you an idea of these are all the

370
00:16:52,490 --> 00:16:54,290
different artifacts that we get to look

371
00:16:54,290 --> 00:16:59,570
and see and play around with the reason

372
00:16:59,570 --> 00:17:01,370
I bring this up first and foremost is so

373
00:17:01,370 --> 00:17:03,470
you have an idea you don't have to look

374
00:17:03,470 --> 00:17:04,849
at the very specifics but just look at

375
00:17:04,849 --> 00:17:09,050
the the title lines right multiple files

376
00:17:09,050 --> 00:17:15,130
were written multiple files read new

377
00:17:15,130 --> 00:17:18,230
processes respond the registry was

378
00:17:18,230 --> 00:17:20,119
touched it did a ton of crap on that

379
00:17:20,119 --> 00:17:23,829
system pretty much right very very noisy

380
00:17:23,829 --> 00:17:26,690
but how will we know that if everything

381
00:17:26,690 --> 00:17:29,270
ran throughout the shadow we don't so

382
00:17:29,270 --> 00:17:30,950
let's look at what happens from these

383
00:17:30,950 --> 00:17:35,090
different viewpoints first and foremost

384
00:17:35,090 --> 00:17:38,930
the IR tool once again yes my company

385
00:17:38,930 --> 00:17:40,610
that i work for makes this tool I'm not

386
00:17:40,610 --> 00:17:43,100
marketing it I get it for free so I get

387
00:17:43,100 --> 00:17:48,560
to play with it process trees when

388
00:17:48,560 --> 00:17:50,240
you're doing an IR you're going to want

389
00:17:50,240 --> 00:17:52,130
to build this out anyways manually I

390
00:17:52,130 --> 00:17:54,290
have a nice pretty graphic it did it for

391
00:17:54,290 --> 00:17:56,510
me sweet but you can do this with

392
00:17:56,510 --> 00:17:58,430
command line tools as well there's a

393
00:17:58,430 --> 00:18:00,200
bunch of free options you can use

394
00:18:00,200 --> 00:18:04,149
google for ir toolsfree I are tools

395
00:18:04,149 --> 00:18:07,070
there's another one that you can do

396
00:18:07,070 --> 00:18:10,010
process analysis trees or visualizing

397
00:18:10,010 --> 00:18:13,100
process analysis those are good keywords

398
00:18:13,100 --> 00:18:14,899
to search for some free tools that will

399
00:18:14,899 --> 00:18:16,659
actually build something very similar

400
00:18:16,659 --> 00:18:20,480
there's actually a tool by a guy who

401
00:18:20,480 --> 00:18:23,269
works for google that I was on the

402
00:18:23,269 --> 00:18:24,980
forensic lunch if any of you have

403
00:18:24,980 --> 00:18:27,950
watched that podcast we were both on at

404
00:18:27,950 --> 00:18:30,830
the same time and he has a freeware one

405
00:18:30,830 --> 00:18:33,649
that's up on github if you remind me

406
00:18:33,649 --> 00:18:35,419
later I'll find what the link is for you

407
00:18:35,419 --> 00:18:37,940
and give you that so you don't have to

408
00:18:37,940 --> 00:18:41,240
pay to play here in our initial

409
00:18:41,240 --> 00:18:42,649
investigation we can see that the

410
00:18:42,649 --> 00:18:44,809
process tree of this file based on the

411
00:18:44,809 --> 00:18:46,700
alert that I would get that led me to

412
00:18:46,700 --> 00:18:50,809
this is that VSS admin exe execution and

413
00:18:50,809 --> 00:18:51,889
that's the thing that I really care

414
00:18:51,889 --> 00:18:53,990
about because that doesn't happen very

415
00:18:53,990 --> 00:18:57,340
often on end point systems

416
00:18:57,340 --> 00:19:00,289
enterprise-grade backup solutions don't

417
00:19:00,289 --> 00:19:03,500
use VSS admin right they're very

418
00:19:03,500 --> 00:19:05,539
particularly usually targeted towards

419
00:19:05,539 --> 00:19:08,659
your nose or your servers and those will

420
00:19:08,659 --> 00:19:10,730
have proprietary products on it for the

421
00:19:10,730 --> 00:19:13,730
backing up what I'm able to do here is

422
00:19:13,730 --> 00:19:16,429
I'm able to backtrack from the VSS admin

423
00:19:16,429 --> 00:19:19,220
all the way up to the originating file

424
00:19:19,220 --> 00:19:20,870
and process that kicked off this entire

425
00:19:20,870 --> 00:19:24,950
tree in this case you can see that it's

426
00:19:24,950 --> 00:19:27,889
a dot exe with a really long name

427
00:19:27,889 --> 00:19:30,110
because I downloaded it from a virus

428
00:19:30,110 --> 00:19:32,809
share which is already mentioned marcom

429
00:19:32,809 --> 00:19:35,750
is also cool one I have a giant list I

430
00:19:35,750 --> 00:19:37,610
know there's some students in here so I

431
00:19:37,610 --> 00:19:39,830
ping me up later and I'll give you a

432
00:19:39,830 --> 00:19:42,080
list of tools that are all free that you

433
00:19:42,080 --> 00:19:43,610
can use to build your own maurer lab

434
00:19:43,610 --> 00:19:45,919
with but I'm not responsible for what

435
00:19:45,919 --> 00:19:50,029
you doing it one of the very interesting

436
00:19:50,029 --> 00:19:53,269
things they can see is that icon at the

437
00:19:53,269 --> 00:19:56,360
beginning on the left that's a PDF icon

438
00:19:56,360 --> 00:19:59,630
but it's an executable so already in the

439
00:19:59,630 --> 00:20:01,159
attack for how they got dropped to the

440
00:20:01,159 --> 00:20:03,590
system they try to obfuscate their

441
00:20:03,590 --> 00:20:06,559
origination they pretended they were a

442
00:20:06,559 --> 00:20:09,440
PDF they are really a binary and they

443
00:20:09,440 --> 00:20:11,210
executed and drove this whole tree

444
00:20:11,210 --> 00:20:13,840
forward

445
00:20:14,060 --> 00:20:16,490
one of the other nice things also spoke

446
00:20:16,490 --> 00:20:19,640
about was virustotal already you have an

447
00:20:19,640 --> 00:20:23,270
API which is great there's another

448
00:20:23,270 --> 00:20:28,460
github that has virus total uploader I

449
00:20:28,460 --> 00:20:30,410
think it's called somebody already built

450
00:20:30,410 --> 00:20:33,380
the API Python script for you and all

451
00:20:33,380 --> 00:20:35,780
you have to do is download that package

452
00:20:35,780 --> 00:20:38,930
drop in your actual API key and then you

453
00:20:38,930 --> 00:20:40,730
can start submitting things and also

454
00:20:40,730 --> 00:20:43,270
querying virustotal for hashes you find

455
00:20:43,270 --> 00:20:46,490
that is free and is a really cool tool

456
00:20:46,490 --> 00:20:48,520
to help you start doing some automation

457
00:20:48,520 --> 00:20:51,500
for actually analyzing systems seeing if

458
00:20:51,500 --> 00:20:53,720
anybody found this stuff before and if

459
00:20:53,720 --> 00:20:55,430
so it'll give your reports back and

460
00:20:55,430 --> 00:20:59,150
prints it to a nice CSV what I have here

461
00:20:59,150 --> 00:21:01,820
is the equivalent of that where I

462
00:21:01,820 --> 00:21:05,240
submitted this hash to virustotal and it

463
00:21:05,240 --> 00:21:10,820
came back as 40 score of 43 we should

464
00:21:10,820 --> 00:21:12,620
probably look at that right that's

465
00:21:12,620 --> 00:21:14,060
that's not really something you want

466
00:21:14,060 --> 00:21:17,810
there um ever that's just really really

467
00:21:17,810 --> 00:21:20,360
bad ideas and keep in mind virustotal

468
00:21:20,360 --> 00:21:23,270
right now only has 56 AVS that it goes

469
00:21:23,270 --> 00:21:26,300
through so 43 out of 56 it's probably

470
00:21:26,300 --> 00:21:29,960
bad i downloads from said virus share

471
00:21:29,960 --> 00:21:32,090
and i downloaded one that I knew had a

472
00:21:32,090 --> 00:21:34,400
high virustotal hit in order to make the

473
00:21:34,400 --> 00:21:37,070
nice pretty pictures but you're going to

474
00:21:37,070 --> 00:21:39,200
get different scores and the big thing

475
00:21:39,200 --> 00:21:41,390
here is you know following your

476
00:21:41,390 --> 00:21:44,690
intuition one of the things with IR is

477
00:21:44,690 --> 00:21:46,550
everybody's trying to bucket things and

478
00:21:46,550 --> 00:21:48,680
create fundamental processes and

479
00:21:48,680 --> 00:21:51,650
structure and that's great but it's also

480
00:21:51,650 --> 00:21:53,540
similar to forensics where it's also a

481
00:21:53,540 --> 00:21:56,630
bit art mixed in with science the best

482
00:21:56,630 --> 00:21:58,610
way to learn is to do it over and over

483
00:21:58,610 --> 00:22:00,830
and over again until you start seeing

484
00:22:00,830 --> 00:22:03,650
the patterns so this is where one of the

485
00:22:03,650 --> 00:22:06,530
things that's a nice cheat sheet but it

486
00:22:06,530 --> 00:22:07,910
doesn't actually give you any extra

487
00:22:07,910 --> 00:22:11,330
knowledge and help going forward so

488
00:22:11,330 --> 00:22:14,440
let's look what the binary did so um

489
00:22:14,440 --> 00:22:17,050
that actually just plays pretty decent

490
00:22:17,050 --> 00:22:21,320
above we can see I bucketed what it did

491
00:22:21,320 --> 00:22:23,650
to the file system three groups here

492
00:22:23,650 --> 00:22:26,360
processes that it spawned so that

493
00:22:26,360 --> 00:22:27,700
originating process

494
00:22:27,700 --> 00:22:30,980
ended up spawning a child process and

495
00:22:30,980 --> 00:22:32,990
that child process spawned two other

496
00:22:32,990 --> 00:22:35,470
child processes so now we have

497
00:22:35,470 --> 00:22:37,550
originating process all the way down to

498
00:22:37,550 --> 00:22:40,610
the grandchildren processes this is one

499
00:22:40,610 --> 00:22:41,990
of the things that's really hard to

500
00:22:41,990 --> 00:22:44,270
automate when you're looking for

501
00:22:44,270 --> 00:22:47,690
basically the execution chain or kill

502
00:22:47,690 --> 00:22:49,550
chain would however you want to describe

503
00:22:49,550 --> 00:22:52,790
it kill chains also inter used with the

504
00:22:52,790 --> 00:22:56,390
attack chain that happens so you know it

505
00:22:56,390 --> 00:22:59,060
depends what terminology you used to the

506
00:22:59,060 --> 00:23:02,120
reason why that really matters is one of

507
00:23:02,120 --> 00:23:04,430
actually this has been a theme so far in

508
00:23:04,430 --> 00:23:07,360
the conversations is behavioral analysis

509
00:23:07,360 --> 00:23:10,460
versus looking just at the single

510
00:23:10,460 --> 00:23:14,360
infection vector you want to see what

511
00:23:14,360 --> 00:23:16,760
chains off of it what creates the child

512
00:23:16,760 --> 00:23:18,920
processes what do the child processes

513
00:23:18,920 --> 00:23:21,290
touch because these days the originating

514
00:23:21,290 --> 00:23:23,570
process usually isn't the one doing the

515
00:23:23,570 --> 00:23:27,080
damage and that makes it much harder to

516
00:23:27,080 --> 00:23:28,580
find with different I our tools and

517
00:23:28,580 --> 00:23:30,490
security tools that do a lot of scanning

518
00:23:30,490 --> 00:23:33,080
there's a lot of scan based stuff and if

519
00:23:33,080 --> 00:23:35,210
you're not watching the entire time you

520
00:23:35,210 --> 00:23:38,080
miss the creation to child processes and

521
00:23:38,080 --> 00:23:40,790
being able to actually find root cause

522
00:23:40,790 --> 00:23:43,550
for when one of these goes off another

523
00:23:43,550 --> 00:23:47,750
thing that happens here is registry mods

524
00:23:47,750 --> 00:23:50,900
so as we know and we spoke about earlier

525
00:23:50,900 --> 00:23:55,400
today with the ransomware is Maki and

526
00:23:55,400 --> 00:23:58,160
cryptolocker and a few other variants I

527
00:23:58,160 --> 00:24:01,340
think cripta wall was another one end up

528
00:24:01,340 --> 00:24:03,770
writing things to the registry usually

529
00:24:03,770 --> 00:24:05,810
it has two or three registry keys the

530
00:24:05,810 --> 00:24:09,920
first registry key is it ends up adding

531
00:24:09,920 --> 00:24:12,470
an entry to either the run or run once

532
00:24:12,470 --> 00:24:16,490
registry value those are run at login on

533
00:24:16,490 --> 00:24:19,100
a system and what that does is it gives

534
00:24:19,100 --> 00:24:23,000
you consistent persistence you can shut

535
00:24:23,000 --> 00:24:25,130
down the computer you can have AV try to

536
00:24:25,130 --> 00:24:27,110
delete the original files but when you

537
00:24:27,110 --> 00:24:30,290
reboot it's going to end up restarting

538
00:24:30,290 --> 00:24:33,620
the executable from the registry value

539
00:24:33,620 --> 00:24:35,210
because those get called and get red and

540
00:24:35,210 --> 00:24:37,100
it points to where another copy of the

541
00:24:37,100 --> 00:24:39,440
binary is and you end up running over

542
00:24:39,440 --> 00:24:42,190
and over so this is a form of persist

543
00:24:42,190 --> 00:24:44,840
another thing that we see here is a

544
00:24:44,840 --> 00:24:46,490
bunch of new files were created and

545
00:24:46,490 --> 00:24:49,639
speaking of persistence these are your

546
00:24:49,639 --> 00:24:52,370
file system artifacts for persistence so

547
00:24:52,370 --> 00:24:55,100
there's one here in appdata they drop

548
00:24:55,100 --> 00:24:57,649
another one in the startup directory so

549
00:24:57,649 --> 00:24:59,509
that directory is where all your files

550
00:24:59,509 --> 00:25:02,720
that load when you log into your system

551
00:25:02,720 --> 00:25:05,960
will load up for you you know some you

552
00:25:05,960 --> 00:25:08,179
stick your outlook there you set it to

553
00:25:08,179 --> 00:25:09,860
start whenever you log in that's where

554
00:25:09,860 --> 00:25:12,889
that's kind of stored that shortcut also

555
00:25:12,889 --> 00:25:14,870
this gets dropped into another directory

556
00:25:14,870 --> 00:25:18,500
on the c drive etc etc basically the

557
00:25:18,500 --> 00:25:21,039
attacker created about six different

558
00:25:21,039 --> 00:25:24,409
copies of the exact same binary and drop

559
00:25:24,409 --> 00:25:26,029
them in different places in the OS and

560
00:25:26,029 --> 00:25:28,490
then put links in the registry to kick

561
00:25:28,490 --> 00:25:32,809
them off so that is one very effective

562
00:25:32,809 --> 00:25:34,340
way because you're looking for all these

563
00:25:34,340 --> 00:25:37,490
binaries you find one all right are you

564
00:25:37,490 --> 00:25:39,080
going to keep looking to find more are

565
00:25:39,080 --> 00:25:41,120
you going to keep looking to find more I

566
00:25:41,120 --> 00:25:43,730
salute his tenacity but that kind of

567
00:25:43,730 --> 00:25:46,370
paranoia is really not healthy and I'm

568
00:25:46,370 --> 00:25:48,169
very impressed that he went to those

569
00:25:48,169 --> 00:25:51,320
levels what we can see here based on all

570
00:25:51,320 --> 00:25:53,779
of this is you can either spend a few

571
00:25:53,779 --> 00:25:55,730
hours trying to clean the system or your

572
00:25:55,730 --> 00:25:58,490
do it most of us would do nuke it from

573
00:25:58,490 --> 00:26:05,809
orbit next we talked about from the host

574
00:26:05,809 --> 00:26:08,090
point of view so once again I had a nice

575
00:26:08,090 --> 00:26:09,980
fancy tool that does all this stuff for

576
00:26:09,980 --> 00:26:12,620
me how you going to do this without

577
00:26:12,620 --> 00:26:14,149
those how are you going to do this for

578
00:26:14,149 --> 00:26:15,500
free how you're going to do this on

579
00:26:15,500 --> 00:26:17,299
grandma Jo system that doesn't have

580
00:26:17,299 --> 00:26:19,870
access to any of these nice shiny tools

581
00:26:19,870 --> 00:26:24,409
well first and foremost I'm looking for

582
00:26:24,409 --> 00:26:28,370
common things when I spoke about ir and

583
00:26:28,370 --> 00:26:30,110
forensics being a bit more art than

584
00:26:30,110 --> 00:26:31,340
science and you got to kind of follow

585
00:26:31,340 --> 00:26:33,379
your intuition you're really banking on

586
00:26:33,379 --> 00:26:37,029
your experience I spent years working on

587
00:26:37,029 --> 00:26:39,379
working at a financial institution where

588
00:26:39,379 --> 00:26:41,750
I dealt with banking Trojans so Zeus

589
00:26:41,750 --> 00:26:44,870
SpyEye etc I have massive databases of

590
00:26:44,870 --> 00:26:46,879
these things blackwell exploit toolkit

591
00:26:46,879 --> 00:26:48,649
that dropped all this crap angular all

592
00:26:48,649 --> 00:26:51,769
those things I had to create behavioral

593
00:26:51,769 --> 00:26:54,320
analysis for it I had to create

594
00:26:54,320 --> 00:26:55,690
databases that could core

595
00:26:55,690 --> 00:26:58,400
the changes in it to find out where this

596
00:26:58,400 --> 00:27:00,980
crap is so a couple of the places that I

597
00:27:00,980 --> 00:27:03,590
look for first and foremost is things

598
00:27:03,590 --> 00:27:06,230
like the user app data particularly

599
00:27:06,230 --> 00:27:09,260
roaming so if we are on windows 7

600
00:27:09,260 --> 00:27:12,110
windows 8 I don't remember Windows 10

601
00:27:12,110 --> 00:27:14,980
has the same structure in appdata but

602
00:27:14,980 --> 00:27:16,970
depending on whether or not you have

603
00:27:16,970 --> 00:27:19,850
local admin for your user is where the

604
00:27:19,850 --> 00:27:22,460
stuff will get dropped app data for the

605
00:27:22,460 --> 00:27:25,280
active user is extremely common for

606
00:27:25,280 --> 00:27:27,920
banking Trojans and it is one of the

607
00:27:27,920 --> 00:27:30,080
first places I look for persistence

608
00:27:30,080 --> 00:27:34,130
mechanisms because it's that common it's

609
00:27:34,130 --> 00:27:35,900
still comin to this day to the point

610
00:27:35,900 --> 00:27:37,820
where I have scripts that will just go

611
00:27:37,820 --> 00:27:39,290
out and it will grab a few different

612
00:27:39,290 --> 00:27:42,110
directories and just list me the entire

613
00:27:42,110 --> 00:27:44,000
directory and the child directories of

614
00:27:44,000 --> 00:27:45,620
it so that way I can just quickly go

615
00:27:45,620 --> 00:27:47,840
through and say this isn't something

616
00:27:47,840 --> 00:27:50,030
that I already know so now we have to

617
00:27:50,030 --> 00:27:52,400
start a real investigation or a BAM i

618
00:27:52,400 --> 00:27:54,650
found one thing excellent pull that

619
00:27:54,650 --> 00:27:57,920
thread follow it through there's a few

620
00:27:57,920 --> 00:28:00,470
other places to check we spoke about the

621
00:28:00,470 --> 00:28:02,300
startup programs directory that's

622
00:28:02,300 --> 00:28:04,100
another popular persistence mechanism

623
00:28:04,100 --> 00:28:05,600
directory where they drop the binaries

624
00:28:05,600 --> 00:28:08,660
there a lot of times they'll use

625
00:28:08,660 --> 00:28:12,290
something like c / driver / whatever the

626
00:28:12,290 --> 00:28:14,690
malware is because if any of you have

627
00:28:14,690 --> 00:28:17,920
ever run at Dell that's where del often

628
00:28:17,920 --> 00:28:21,440
expands and drops their crap which

629
00:28:21,440 --> 00:28:23,060
depended on who wrote that driver it

630
00:28:23,060 --> 00:28:27,860
could be malware extremely common and

631
00:28:27,860 --> 00:28:30,230
this is one of the first places I look

632
00:28:30,230 --> 00:28:33,290
the second thing I do is I start looking

633
00:28:33,290 --> 00:28:36,200
for more persistence mechanisms once

634
00:28:36,200 --> 00:28:39,110
again this is the start menu one that we

635
00:28:39,110 --> 00:28:42,140
just dropped into so here this is

636
00:28:42,140 --> 00:28:46,310
actually in the the app data directory

637
00:28:46,310 --> 00:28:48,940
so the two that we've done is basically

638
00:28:48,940 --> 00:28:55,340
c / user / muslim using a master /

639
00:28:55,340 --> 00:28:58,610
appdata roaming that's usually where the

640
00:28:58,610 --> 00:29:01,300
first christeson to mechanism goes so

641
00:29:01,300 --> 00:29:04,340
you have the malicious file up on the

642
00:29:04,340 --> 00:29:05,990
internet gets dropped down your system

643
00:29:05,990 --> 00:29:08,330
however it's going to be email exploit

644
00:29:08,330 --> 00:29:09,230
kit whatever

645
00:29:09,230 --> 00:29:12,020
it gets executed the first place

646
00:29:12,020 --> 00:29:14,570
normally copies itself off to is that

647
00:29:14,570 --> 00:29:16,730
app data directory and then it deletes

648
00:29:16,730 --> 00:29:18,890
the originating file from the directory

649
00:29:18,890 --> 00:29:22,549
that it was in most users will be oh it

650
00:29:22,549 --> 00:29:25,419
went away let me read download it etc

651
00:29:25,419 --> 00:29:27,740
once it gets dropped to this directory

652
00:29:27,740 --> 00:29:29,809
it actually starts expanding out and

653
00:29:29,809 --> 00:29:31,700
starting to clone itself all over the

654
00:29:31,700 --> 00:29:34,700
place that nice list of files that we

655
00:29:34,700 --> 00:29:37,490
just spoke about those are all in

656
00:29:37,490 --> 00:29:39,049
different persistence directories and

657
00:29:39,049 --> 00:29:44,240
they were all written by this file next

658
00:29:44,240 --> 00:29:48,140
thing we're going to look at is a couple

659
00:29:48,140 --> 00:29:52,010
of other nice things the malware created

660
00:29:52,010 --> 00:29:53,540
its own directory with a bunch of

661
00:29:53,540 --> 00:29:56,770
gibberish on the actual root C Drive and

662
00:29:56,770 --> 00:30:00,200
inside that drive lo and behold there's

663
00:30:00,200 --> 00:30:04,880
another copy of the malware it's just

664
00:30:04,880 --> 00:30:07,910
all over the system at this point you

665
00:30:07,910 --> 00:30:10,820
can tell them our author is very very

666
00:30:10,820 --> 00:30:12,620
afraid of these binaries being found and

667
00:30:12,620 --> 00:30:14,660
creates backups of backups of backups of

668
00:30:14,660 --> 00:30:18,080
backups I already used my paranoia joke

669
00:30:18,080 --> 00:30:20,630
so I can't reuse it now but it's really

670
00:30:20,630 --> 00:30:25,970
not healthy next up is the registry

671
00:30:25,970 --> 00:30:28,460
actions so one of the things we just

672
00:30:28,460 --> 00:30:30,500
spoke about was the run lunch directory

673
00:30:30,500 --> 00:30:32,990
creating the mechanism for persistence

674
00:30:32,990 --> 00:30:36,770
and starting up on reboot and login this

675
00:30:36,770 --> 00:30:38,419
right here you can see from the values

676
00:30:38,419 --> 00:30:40,250
that what it does is it ends up creating

677
00:30:40,250 --> 00:30:46,220
a value inside that registry key what I

678
00:30:46,220 --> 00:30:48,830
can infer from this is that it is a

679
00:30:48,830 --> 00:30:50,720
purse essence of persistence mechanism

680
00:30:50,720 --> 00:30:53,419
I'm not guessing at this point putting

681
00:30:53,419 --> 00:30:55,370
things into this registry value will

682
00:30:55,370 --> 00:30:57,980
only have one of two things happen it'll

683
00:30:57,980 --> 00:31:01,010
start in boot or it'll break those are

684
00:31:01,010 --> 00:31:02,270
your two options when you drop something

685
00:31:02,270 --> 00:31:05,870
in there and point it very rarely do you

686
00:31:05,870 --> 00:31:08,900
see more legitimate applications use

687
00:31:08,900 --> 00:31:11,840
this usually it's done by a system

688
00:31:11,840 --> 00:31:14,059
administrators who want things to start

689
00:31:14,059 --> 00:31:17,270
on boot so some administrators that have

690
00:31:17,270 --> 00:31:20,720
very complex ad environments will end up

691
00:31:20,720 --> 00:31:22,730
putting scripts in their builds

692
00:31:22,730 --> 00:31:24,260
and pointing it to the run once so every

693
00:31:24,260 --> 00:31:26,030
time you log in it'll correctly mount

694
00:31:26,030 --> 00:31:28,460
your network drive because ad is so

695
00:31:28,460 --> 00:31:29,840
broken in their environment that they

696
00:31:29,840 --> 00:31:31,480
can't do it through that mechanism

697
00:31:31,480 --> 00:31:34,100
there's also things like Wi-Fi fixers

698
00:31:34,100 --> 00:31:36,350
all kinds of stuff that would get

699
00:31:36,350 --> 00:31:39,919
dropped in there these are keys for

700
00:31:39,919 --> 00:31:42,620
background services such as the remote

701
00:31:42,620 --> 00:31:45,470
registry service and their only run once

702
00:31:45,470 --> 00:31:52,429
per boot next up is what happens so we

703
00:31:52,429 --> 00:31:54,559
have the persistence mechanisms we have

704
00:31:54,559 --> 00:31:56,299
the binaries all over the place we have

705
00:31:56,299 --> 00:31:57,559
the registry values shown that it's

706
00:31:57,559 --> 00:32:00,320
going to get run how do we know what get

707
00:32:00,320 --> 00:32:03,850
hit cryptolocker one was kind of nice

708
00:32:03,850 --> 00:32:06,590
they they have I call this the middle

709
00:32:06,590 --> 00:32:07,940
finger directory because it's just

710
00:32:07,940 --> 00:32:10,250
showing you how boned you are this is

711
00:32:10,250 --> 00:32:12,290
every file that it has successfully

712
00:32:12,290 --> 00:32:18,230
encrypted and this is the one that makes

713
00:32:18,230 --> 00:32:23,540
people cry lastly um it didn't actually

714
00:32:23,540 --> 00:32:27,830
I have another picture that um I was

715
00:32:27,830 --> 00:32:29,390
actually almost already shown the

716
00:32:29,390 --> 00:32:31,220
cryptolocker lock screen is the last

717
00:32:31,220 --> 00:32:33,620
thing the user actually sees because at

718
00:32:33,620 --> 00:32:37,549
that point you are owned and its last

719
00:32:37,549 --> 00:32:39,140
thing that you see the cryptolocker

720
00:32:39,140 --> 00:32:42,470
variant ass was already mentioned drops

721
00:32:42,470 --> 00:32:44,809
on the system runs scans for network

722
00:32:44,809 --> 00:32:47,120
drives tries to encrypt them first then

723
00:32:47,120 --> 00:32:49,160
encrypt the local drives because if the

724
00:32:49,160 --> 00:32:50,240
user doesn't know what's going on

725
00:32:50,240 --> 00:32:51,590
they're not going to shut off their

726
00:32:51,590 --> 00:32:53,090
computer and try to stop it from

727
00:32:53,090 --> 00:32:57,380
encrypting things so how do we detect

728
00:32:57,380 --> 00:32:59,750
this attack there was a lot of

729
00:32:59,750 --> 00:33:01,549
information about how if different files

730
00:33:01,549 --> 00:33:03,500
were created different things in the

731
00:33:03,500 --> 00:33:06,230
file system that were changed all these

732
00:33:06,230 --> 00:33:10,250
variants so first and foremost you're

733
00:33:10,250 --> 00:33:11,350
going to work with what tools you have

734
00:33:11,350 --> 00:33:16,820
right here I have broken out the attack

735
00:33:16,820 --> 00:33:19,010
into a few different things in

736
00:33:19,010 --> 00:33:21,559
particular what I'm looking for is

737
00:33:21,559 --> 00:33:24,549
illegitimate use of the Microsoft binary

738
00:33:24,549 --> 00:33:26,990
in this binary that we're talking about

739
00:33:26,990 --> 00:33:29,900
is the V shadow binary there is a 32-bit

740
00:33:29,900 --> 00:33:33,309
in a 64-bit version for each OS and

741
00:33:33,309 --> 00:33:36,320
minor OS revision so this is

742
00:33:36,320 --> 00:33:38,029
a complete list this is just the ones I

743
00:33:38,029 --> 00:33:43,029
pulled off msdn a little while back so

744
00:33:43,029 --> 00:33:47,450
what i can do is either a manual search

745
00:33:47,450 --> 00:33:50,539
with these hashes to look for these

746
00:33:50,539 --> 00:33:53,480
files actually being on a system and

747
00:33:53,480 --> 00:33:54,919
then mark those systems is a higher

748
00:33:54,919 --> 00:33:56,809
criticality because i know that they can

749
00:33:56,809 --> 00:33:59,659
get exploited this way or i can have a

750
00:33:59,659 --> 00:34:02,750
tool or a sim end up alerting me when

751
00:34:02,750 --> 00:34:04,340
one of these binaries are actually

752
00:34:04,340 --> 00:34:08,030
executed that's your choice use the

753
00:34:08,030 --> 00:34:10,040
tools that you have play around with

754
00:34:10,040 --> 00:34:14,449
that stuff in this case what i'm doing

755
00:34:14,449 --> 00:34:19,030
is i'm using the carbon black good and

756
00:34:19,030 --> 00:34:22,550
point respond yeah they change the names

757
00:34:22,550 --> 00:34:24,829
very shortly ago and i'm still getting

758
00:34:24,829 --> 00:34:26,629
used to them this is the one that shows

759
00:34:26,629 --> 00:34:28,520
me what executions happen on the system

760
00:34:28,520 --> 00:34:32,480
registry processing etc so what i can do

761
00:34:32,480 --> 00:34:34,730
is i can write a rule that specifically

762
00:34:34,730 --> 00:34:39,469
says if the VSS admin is executed alert

763
00:34:39,469 --> 00:34:44,270
me well that's cool but depending on how

764
00:34:44,270 --> 00:34:45,679
it's executed is whether or not it

765
00:34:45,679 --> 00:34:47,960
actually gets shown so we should

766
00:34:47,960 --> 00:34:50,030
actually more look at the dependencies

767
00:34:50,030 --> 00:34:53,869
of it what does VSS admin need on that

768
00:34:53,869 --> 00:34:57,530
system to run and then end up being used

769
00:34:57,530 --> 00:35:00,230
and abused by the attacker well we can

770
00:35:00,230 --> 00:35:02,510
look at the DLL that it loads when VSS

771
00:35:02,510 --> 00:35:05,599
admin goes VSS admin can get used in

772
00:35:05,599 --> 00:35:07,579
different queries it can get used in

773
00:35:07,579 --> 00:35:12,829
various different uses but vs SPS dll is

774
00:35:12,829 --> 00:35:18,440
only used when VSS admin is executed so

775
00:35:18,440 --> 00:35:19,940
that's one of the first things i started

776
00:35:19,940 --> 00:35:22,700
to look for set this alert see when an

777
00:35:22,700 --> 00:35:25,310
executor and hows executing lo and

778
00:35:25,310 --> 00:35:27,800
behold this off in an environment of

779
00:35:27,800 --> 00:35:30,290
about five thousand endpoints and i have

780
00:35:30,290 --> 00:35:33,619
false positives there's this file called

781
00:35:33,619 --> 00:35:36,890
we're fault exe which i can't remember

782
00:35:36,890 --> 00:35:40,880
what it does but it also uses that DLL

783
00:35:40,880 --> 00:35:44,960
so I just made it ignore that pretty

784
00:35:44,960 --> 00:35:47,960
much and started to minimize this the

785
00:35:47,960 --> 00:35:49,519
second thing that we know happens

786
00:35:49,519 --> 00:35:51,469
is when this happens you're kicking off

787
00:35:51,469 --> 00:35:55,729
basically a script to infect so what our

788
00:35:55,729 --> 00:35:58,399
scripts run as mostly on Windows systems

789
00:35:58,399 --> 00:36:01,640
their batch files and batch files when

790
00:36:01,640 --> 00:36:04,609
they run run under command exe is the

791
00:36:04,609 --> 00:36:07,130
process so it's almost like you're

792
00:36:07,130 --> 00:36:08,539
running directly from the command line

793
00:36:08,539 --> 00:36:11,119
it's just running as a script form so

794
00:36:11,119 --> 00:36:14,269
what I do here is I look for the command

795
00:36:14,269 --> 00:36:18,429
line execution of the make link command

796
00:36:18,429 --> 00:36:21,259
who here is actually seen make link

797
00:36:21,259 --> 00:36:27,880
happen in a legitimate context and no

798
00:36:27,880 --> 00:36:33,649
all right well you get the point the

799
00:36:33,649 --> 00:36:37,339
last thing that I'd look for is V shadow

800
00:36:37,339 --> 00:36:39,589
I to exe at the command line being run

801
00:36:39,589 --> 00:36:41,390
with that Dash P option in order to

802
00:36:41,390 --> 00:36:44,209
create the pointer and that symlink so

803
00:36:44,209 --> 00:36:46,009
these are three different queries that

804
00:36:46,009 --> 00:36:48,199
you can run in your environment that you

805
00:36:48,199 --> 00:36:51,259
can run as batch scripts you can run it

806
00:36:51,259 --> 00:36:53,809
depending on what your security tools on

807
00:36:53,809 --> 00:36:56,059
the actual system can see here's three

808
00:36:56,059 --> 00:36:58,489
different variants one uses memory ones

809
00:36:58,489 --> 00:37:01,099
particularly looking at a dll one's

810
00:37:01,099 --> 00:37:02,779
looking at a particular executable and

811
00:37:02,779 --> 00:37:04,609
another one is looking for a particular

812
00:37:04,609 --> 00:37:08,179
command line command those are four

813
00:37:08,179 --> 00:37:09,889
different vectors that you can now look

814
00:37:09,889 --> 00:37:14,869
at for this one attack and get I don't

815
00:37:14,869 --> 00:37:16,519
want to say no false positives but I

816
00:37:16,519 --> 00:37:19,309
only ran it in a system of 5000 so I

817
00:37:19,309 --> 00:37:20,959
don't know what your environments going

818
00:37:20,959 --> 00:37:26,559
to look like next we could also look for

819
00:37:26,559 --> 00:37:30,019
that volume Shadow name so we know that

820
00:37:30,019 --> 00:37:33,259
shadow copies are being made what we

821
00:37:33,259 --> 00:37:35,509
know for sure is there have some default

822
00:37:35,509 --> 00:37:37,789
naming schemes if you don't specify

823
00:37:37,789 --> 00:37:40,699
names and you just run the default

824
00:37:40,699 --> 00:37:42,289
commands you're going to end up with

825
00:37:42,289 --> 00:37:43,579
something that looks like hard disk

826
00:37:43,579 --> 00:37:46,159
volume Shadow Copy or hard disk volume

827
00:37:46,159 --> 00:37:49,880
if you've ever looked at the command

828
00:37:49,880 --> 00:37:52,789
line output form you mounting a drive at

829
00:37:52,789 --> 00:37:54,559
boot if any of you have ever gotten that

830
00:37:54,559 --> 00:37:56,299
blue screen of death you've probably

831
00:37:56,299 --> 00:37:58,699
noticed that the actual C Drive that you

832
00:37:58,699 --> 00:38:00,949
have mounted before it gets mounted and

833
00:38:00,949 --> 00:38:03,350
called the C Drive is called a hard disk

834
00:38:03,350 --> 00:38:05,360
because that's the actual name for the

835
00:38:05,360 --> 00:38:07,100
physical asset and it's the same name

836
00:38:07,100 --> 00:38:10,040
used for the virtual asset so when

837
00:38:10,040 --> 00:38:12,230
you're running systems you shouldn't see

838
00:38:12,230 --> 00:38:14,210
this going off and this is another thing

839
00:38:14,210 --> 00:38:18,770
that you can look for so the last thing

840
00:38:18,770 --> 00:38:20,870
I don't know what time it is I don't

841
00:38:20,870 --> 00:38:23,900
know if I'm going over there o'clock

842
00:38:23,900 --> 00:38:25,820
alright sweet I think I only have like

843
00:38:25,820 --> 00:38:28,730
five more slides in this probably the

844
00:38:28,730 --> 00:38:29,720
one that you guys actually care about

845
00:38:29,720 --> 00:38:34,010
how to stop the attack so we went over

846
00:38:34,010 --> 00:38:36,530
the basics of around somewhere we're

847
00:38:36,530 --> 00:38:39,170
over the basics of V shadow some of the

848
00:38:39,170 --> 00:38:42,190
common places it stands for the attack

849
00:38:42,190 --> 00:38:50,480
but how do we stop it this is really

850
00:38:50,480 --> 00:38:53,240
what what I care about mostly at this

851
00:38:53,240 --> 00:38:56,090
stage in my career because I run sec ops

852
00:38:56,090 --> 00:38:59,600
so I'm mostly defense we have to do

853
00:38:59,600 --> 00:39:00,980
offensive things I get to do threat

854
00:39:00,980 --> 00:39:02,930
research i get to poke it's tough but

855
00:39:02,930 --> 00:39:04,610
really matters at the end of the day is

856
00:39:04,610 --> 00:39:08,840
how am i protecting my enterprise so

857
00:39:08,840 --> 00:39:11,800
first and foremost a good backup plan

858
00:39:11,800 --> 00:39:13,820
that has to get put out of the way

859
00:39:13,820 --> 00:39:15,650
before you get technical stuff anything

860
00:39:15,650 --> 00:39:17,720
proactive you can do is really going to

861
00:39:17,720 --> 00:39:18,950
save your bacon it reduces your risk

862
00:39:18,950 --> 00:39:21,710
surface it ends up helping you out in

863
00:39:21,710 --> 00:39:24,770
the long run you can create the shadow

864
00:39:24,770 --> 00:39:26,480
copies manually you can restore from

865
00:39:26,480 --> 00:39:28,900
them this is the mechanism I i would use

866
00:39:28,900 --> 00:39:31,040
there's professional tools that do it

867
00:39:31,040 --> 00:39:33,770
better but these are available on any

868
00:39:33,770 --> 00:39:38,000
windows system there's multiple methods

869
00:39:38,000 --> 00:39:41,030
you can look them up online there's also

870
00:39:41,030 --> 00:39:43,700
whitelisting options and what I'm going

871
00:39:43,700 --> 00:39:45,320
to do is I'm actually going to show you

872
00:39:45,320 --> 00:39:48,530
a white listing option those you know

873
00:39:48,530 --> 00:39:50,270
one of the company's products is a white

874
00:39:50,270 --> 00:39:52,640
listing product I'm not using that one

875
00:39:52,640 --> 00:39:55,010
because that costs money into 1 i'm

876
00:39:55,010 --> 00:39:57,410
going to show you is free so don't tell

877
00:39:57,410 --> 00:39:58,880
marketing or sales because they'll be

878
00:39:58,880 --> 00:40:03,230
very pissed at me uh-huh so well what is

879
00:40:03,230 --> 00:40:05,450
whitelisting like for these kind of

880
00:40:05,450 --> 00:40:08,680
attacks I am I equate it to basically

881
00:40:08,680 --> 00:40:12,200
you know computerize shot-blocking right

882
00:40:12,200 --> 00:40:15,110
you're just going to get slammed you try

883
00:40:15,110 --> 00:40:16,790
to install stuff

884
00:40:16,790 --> 00:40:18,740
you get denied on the more you watch

885
00:40:18,740 --> 00:40:20,660
this you can see the kids soul actually

886
00:40:20,660 --> 00:40:23,990
get crushed short of white listing you

887
00:40:23,990 --> 00:40:25,820
can implement a rule based on your use

888
00:40:25,820 --> 00:40:26,780
case unique to your environment

889
00:40:26,780 --> 00:40:29,210
variables in your desired outcome write

890
00:40:29,210 --> 00:40:30,980
the rules that i'm going to show you are

891
00:40:30,980 --> 00:40:33,710
in a high level format because even if

892
00:40:33,710 --> 00:40:35,810
you aren't using the fancy our tools you

893
00:40:35,810 --> 00:40:38,990
can apply this logic and use your actual

894
00:40:38,990 --> 00:40:40,480
controls in your environment

895
00:40:40,480 --> 00:40:43,280
specifically specifically leveraging

896
00:40:43,280 --> 00:40:45,890
things like GPO witchcraft and a lot of

897
00:40:45,890 --> 00:40:48,770
cursing these are going to kind of work

898
00:40:48,770 --> 00:40:52,940
for you guys so first and foremost user

899
00:40:52,940 --> 00:40:54,980
training right don't click on the bad

900
00:40:54,980 --> 00:40:58,310
links here's a bunch of things that

901
00:40:58,310 --> 00:41:00,350
we're going to end up using as artifacts

902
00:41:00,350 --> 00:41:03,470
to look for and to block what we spoke

903
00:41:03,470 --> 00:41:05,870
about a few minutes ago was the

904
00:41:05,870 --> 00:41:08,660
persistence mechanisms right so if you

905
00:41:08,660 --> 00:41:10,010
remember that nice pretty picture of the

906
00:41:10,010 --> 00:41:12,820
kill chain what we're looking at is

907
00:41:12,820 --> 00:41:16,120
originating execution child processes

908
00:41:16,120 --> 00:41:19,490
file rights violates file rights but the

909
00:41:19,490 --> 00:41:22,730
originating process doesn't end up doing

910
00:41:22,730 --> 00:41:24,320
the damage to the system it's the child

911
00:41:24,320 --> 00:41:28,100
processes so in order to bring down the

912
00:41:28,100 --> 00:41:29,960
malware we have to stop the child

913
00:41:29,960 --> 00:41:34,190
processes the mechanism that I created

914
00:41:34,190 --> 00:41:37,670
for cryptolocker version 1 2 and 3 is

915
00:41:37,670 --> 00:41:40,550
actually a registry block I'm going to

916
00:41:40,550 --> 00:41:41,960
show you a file system block because

917
00:41:41,960 --> 00:41:44,750
this works not just for cryptolocker but

918
00:41:44,750 --> 00:41:46,160
it also works for different kinds of

919
00:41:46,160 --> 00:41:50,060
Trojans so first and foremost let's use

920
00:41:50,060 --> 00:41:53,090
your security policy so you create a

921
00:41:53,090 --> 00:41:54,770
software restriction policy for a single

922
00:41:54,770 --> 00:41:56,870
computer either using local security

923
00:41:56,870 --> 00:41:59,090
policy editor or for your entire domain

924
00:41:59,090 --> 00:42:03,260
by using a group policy editor here I've

925
00:42:03,260 --> 00:42:05,540
local policy editor because they

926
00:42:05,540 --> 00:42:06,950
wouldn't let me play with the domain one

927
00:42:06,950 --> 00:42:12,140
I don't know why uh-huh so first and

928
00:42:12,140 --> 00:42:13,730
foremost you need to create a new policy

929
00:42:13,730 --> 00:42:17,330
right this is boring this is stuff they

930
00:42:17,330 --> 00:42:18,560
got to go through in order to do it

931
00:42:18,560 --> 00:42:20,870
here's a bunch of steps but really

932
00:42:20,870 --> 00:42:24,170
matters is step number five this is

933
00:42:24,170 --> 00:42:25,910
where you end up finding all your

934
00:42:25,910 --> 00:42:27,380
software restriction policies these are

935
00:42:27,380 --> 00:42:28,970
where they're all written these are ones

936
00:42:28,970 --> 00:42:29,960
that get

937
00:42:29,960 --> 00:42:32,810
it out to the different systems and

938
00:42:32,810 --> 00:42:34,490
these are where you're actually going to

939
00:42:34,490 --> 00:42:36,800
revise things tighten it up if you have

940
00:42:36,800 --> 00:42:39,580
false positives create exceptions etc

941
00:42:39,580 --> 00:42:41,660
what you're really doing here is you

942
00:42:41,660 --> 00:42:44,180
create a new path rule and what you're

943
00:42:44,180 --> 00:42:45,770
basically doing is this nice short

944
00:42:45,770 --> 00:42:48,440
process that will end up allowing you to

945
00:42:48,440 --> 00:42:50,030
create this what we're going to look at

946
00:42:50,030 --> 00:42:53,450
is particularly this acute abul in the

947
00:42:53,450 --> 00:42:58,700
app data this is how I kept Zeus out of

948
00:42:58,700 --> 00:43:00,200
a financial institution that I worked

949
00:43:00,200 --> 00:43:03,950
for it was very simple we wrote this and

950
00:43:03,950 --> 00:43:08,000
it stopped for a good year and a half

951
00:43:08,000 --> 00:43:10,339
before spy I came out with a lot of the

952
00:43:10,339 --> 00:43:12,290
code because the code got leaked and now

953
00:43:12,290 --> 00:43:15,200
started you use extra file paths when we

954
00:43:15,200 --> 00:43:16,760
had to revise this but this is very

955
00:43:16,760 --> 00:43:19,160
similar notice that the security level

956
00:43:19,160 --> 00:43:22,339
is disallowed that means it won't run

957
00:43:22,339 --> 00:43:25,220
just as you expected it would it doesn't

958
00:43:25,220 --> 00:43:27,349
create flowers or clowns it doesn't let

959
00:43:27,349 --> 00:43:30,520
things run what really matters here is

960
00:43:30,520 --> 00:43:35,119
choosing the file path this is where

961
00:43:35,119 --> 00:43:36,609
you're going to have collateral damage

962
00:43:36,609 --> 00:43:40,760
things like Spotify Firefox Chrome they

963
00:43:40,760 --> 00:43:43,280
all update out of app data which if any

964
00:43:43,280 --> 00:43:45,650
of you write software no it is against

965
00:43:45,650 --> 00:43:47,330
best practices to do so and it's a

966
00:43:47,330 --> 00:43:48,920
terrible idea to run things out of app

967
00:43:48,920 --> 00:43:51,380
data it's bent ferd config files and

968
00:43:51,380 --> 00:43:54,650
storage not binaries so if you have

969
00:43:54,650 --> 00:43:56,210
those applications your environment

970
00:43:56,210 --> 00:43:57,560
environment you're going to have

971
00:43:57,560 --> 00:43:59,660
collateral damage with this rule so

972
00:43:59,660 --> 00:44:01,550
remember to create some exceptions in

973
00:44:01,550 --> 00:44:04,550
there or sales will be upset and so will

974
00:44:04,550 --> 00:44:09,920
your si staff next up is it is now

975
00:44:09,920 --> 00:44:12,830
implemented there's a pretty short

976
00:44:12,830 --> 00:44:15,230
process you just saved your enterprise a

977
00:44:15,230 --> 00:44:18,680
ton of money and I'll take that in

978
00:44:18,680 --> 00:44:21,140
checks if you have it cash ice cream

979
00:44:21,140 --> 00:44:26,630
whatever form of payment you want in the

980
00:44:26,630 --> 00:44:27,890
words of Doctor Who you know it's

981
00:44:27,890 --> 00:44:30,650
defended just like the earth but really

982
00:44:30,650 --> 00:44:32,810
it comes down to dropping the ban hammer

983
00:44:32,810 --> 00:44:36,980
on things in closing ransomware is

984
00:44:36,980 --> 00:44:39,740
annoyingly effective recent additions of

985
00:44:39,740 --> 00:44:41,270
features such as you're moving shadow

986
00:44:41,270 --> 00:44:43,320
copies to make it even more dangerous

987
00:44:43,320 --> 00:44:45,150
regardless what security products you

988
00:44:45,150 --> 00:44:48,120
use your best defense is user training

989
00:44:48,120 --> 00:44:50,460
and backups rinse and repeat rinse and

990
00:44:50,460 --> 00:44:52,590
repeat or instant repeat anything

991
00:44:52,590 --> 00:44:53,940
preventive that you can implement

992
00:44:53,940 --> 00:44:56,510
proactively whether it's automated tools

993
00:44:56,510 --> 00:44:59,640
manual implementation anything like that

994
00:44:59,640 --> 00:45:01,260
will help you protect your company more

995
00:45:01,260 --> 00:45:03,270
than any kind of shiny tool with an

996
00:45:03,270 --> 00:45:05,670
unlimited marketing budget and no matter

997
00:45:05,670 --> 00:45:08,520
what the sales guy tells you you get to

998
00:45:08,520 --> 00:45:11,010
live in reality nothing's a magic bullet

999
00:45:11,010 --> 00:45:13,290
right so thank you all for your time

1000
00:45:13,290 --> 00:45:15,780
today my motto this you'll see on the

1001
00:45:15,780 --> 00:45:18,210
blog post that I do flag it tag it and

1002
00:45:18,210 --> 00:45:20,670
bag it also known as the double tap as

1003
00:45:20,670 --> 00:45:33,210
needed and questions yes they are um not

1004
00:45:33,210 --> 00:45:36,030
immediately after this I am presenting

1005
00:45:36,030 --> 00:45:39,360
this at sans dfi our next month and

1006
00:45:39,360 --> 00:45:41,190
hopefully at Def Con and black hat this

1007
00:45:41,190 --> 00:45:44,340
year and they have a weird rule about

1008
00:45:44,340 --> 00:45:47,610
releasing the slides so by the end of

1009
00:45:47,610 --> 00:45:48,870
june i'll know whether or not it can

1010
00:45:48,870 --> 00:45:51,060
give them to you then or at end of

1011
00:45:51,060 --> 00:45:54,030
august either way I will release them I

1012
00:45:54,030 --> 00:45:56,610
just am contracted Lee obligated not to

1013
00:45:56,610 --> 00:45:59,360
yet yes

1014
00:46:14,990 --> 00:46:17,520
just because the enterprise doesn't use

1015
00:46:17,520 --> 00:46:19,890
it for its legitimate purposes some

1016
00:46:19,890 --> 00:46:23,670
applications might use it it varies upon

1017
00:46:23,670 --> 00:46:26,099
your environment so first thing you have

1018
00:46:26,099 --> 00:46:28,500
to do is visibility accountability

1019
00:46:28,500 --> 00:46:30,150
argument right increase your visibility

1020
00:46:30,150 --> 00:46:33,000
do you know what applications are run in

1021
00:46:33,000 --> 00:46:35,310
your environment for those of you who

1022
00:46:35,310 --> 00:46:37,650
work in the enterprise I'd like to see a

1023
00:46:37,650 --> 00:46:39,569
hand for anyone that can tell me every

1024
00:46:39,569 --> 00:46:42,290
application running in their environment

1025
00:46:42,290 --> 00:46:47,390
yes that is the answer snarky I know but

1026
00:46:47,390 --> 00:46:49,980
unless you have really good auditing

1027
00:46:49,980 --> 00:46:52,740
tools or something like an endpoint

1028
00:46:52,740 --> 00:46:54,329
product that will give you visibility

1029
00:46:54,329 --> 00:46:56,839
into what's running on each system you

1030
00:46:56,839 --> 00:46:59,369
can't know and therefore you don't know

1031
00:46:59,369 --> 00:47:00,450
your conflicts until you start

1032
00:47:00,450 --> 00:47:02,940
implementing things so trial run small

1033
00:47:02,940 --> 00:47:05,490
groups etc that's the only way you can

1034
00:47:05,490 --> 00:47:06,569
get up to the point of blocking

1035
00:47:06,569 --> 00:47:08,550
something that is kind of built into the

1036
00:47:08,550 --> 00:47:18,500
OS and built cool oh thanks s

