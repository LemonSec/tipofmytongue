1
00:00:00,000 --> 00:00:04,470
it over for a rebuild that's what I was

2
00:00:01,469 --> 00:00:07,230
doing I first started security I've done

3
00:00:04,470 --> 00:00:09,090
the red hunting threat Intel and

4
00:00:07,230 --> 00:00:11,550
currently right now I work for

5
00:00:09,090 --> 00:00:13,769
CrowdStrike and the team that the team

6
00:00:11,550 --> 00:00:16,260
that I'm on we do we do remediation

7
00:00:13,769 --> 00:00:18,660
every day so we you know have customers

8
00:00:16,260 --> 00:00:20,430
and monitor the council configure the

9
00:00:18,660 --> 00:00:21,779
council and do all of that but if

10
00:00:20,430 --> 00:00:23,609
something happens if we see something

11
00:00:21,779 --> 00:00:25,769
that you know got passed the tool or

12
00:00:23,609 --> 00:00:27,660
whatever we'll go in and actually do

13
00:00:25,769 --> 00:00:29,669
remediation so we do this all day every

14
00:00:27,660 --> 00:00:32,790
day love it

15
00:00:29,670 --> 00:00:34,110
yeah just one of the things that I found

16
00:00:32,790 --> 00:00:36,180
that I really like about this particular

17
00:00:34,110 --> 00:00:39,570
job is that you see some really

18
00:00:36,180 --> 00:00:42,480
interesting techniques that you know

19
00:00:39,570 --> 00:00:44,340
attackers use to gain persistence you

20
00:00:42,480 --> 00:00:45,839
know stay there some of the some of the

21
00:00:44,340 --> 00:00:47,250
techniques that they're using are pretty

22
00:00:45,840 --> 00:00:50,820
cool I'm going to talk about one of my

23
00:00:47,250 --> 00:00:53,010
favorite persistence mechanisms for

24
00:00:50,820 --> 00:00:54,930
malware and it's a really really stupid

25
00:00:53,010 --> 00:00:56,070
malware it's just a click jacker that's

26
00:00:54,930 --> 00:00:59,309
it it doesn't do anything other than

27
00:00:56,070 --> 00:01:01,710
that but it uses some really really

28
00:00:59,309 --> 00:01:03,690
awesome and tricky technique to to

29
00:01:01,710 --> 00:01:05,159
launch and maintain persistence so I'll

30
00:01:03,690 --> 00:01:09,149
talk about that so if you want to follow

31
00:01:05,159 --> 00:01:10,680
me I'm happy Wonderbread so a little bit

32
00:01:09,150 --> 00:01:12,479
more about this talk is just moving

33
00:01:10,680 --> 00:01:14,090
beyond you know just simply rebuilding

34
00:01:12,479 --> 00:01:16,350
you got it you have an infection

35
00:01:14,090 --> 00:01:17,700
sometimes you know when I first started

36
00:01:16,350 --> 00:01:19,949
I didn't even know if the machine was

37
00:01:17,700 --> 00:01:21,630
actually infected like this triggered an

38
00:01:19,950 --> 00:01:25,020
alert it wasn't a false positive

39
00:01:21,630 --> 00:01:26,640
thus rebuild that was it I mean it's not

40
00:01:25,020 --> 00:01:28,560
a terrible way to go about doing it if

41
00:01:26,640 --> 00:01:31,110
you like spending a lot of money having

42
00:01:28,560 --> 00:01:33,150
huge support teams rebuild things all

43
00:01:31,110 --> 00:01:34,829
the time I mean it was you know anywhere

44
00:01:33,150 --> 00:01:38,159
from 30 to 100 rebuilds potentially a

45
00:01:34,829 --> 00:01:40,139
month as and it depends on your

46
00:01:38,159 --> 00:01:40,500
environment to like you know what are

47
00:01:40,140 --> 00:01:42,840
you uh

48
00:01:40,500 --> 00:01:45,030
is it a sales environment or is it like

49
00:01:42,840 --> 00:01:48,000
a franchise environment like hotels or

50
00:01:45,030 --> 00:01:49,409
just notorious for just you know the

51
00:01:48,000 --> 00:01:50,369
people that work there don't care they

52
00:01:49,409 --> 00:01:51,960
don't know about computers there's

53
00:01:50,369 --> 00:01:53,100
trying to be courteous to their

54
00:01:51,960 --> 00:01:56,130
customers they're clicking on stuff

55
00:01:53,100 --> 00:01:57,689
they're doing stuff all the time so you

56
00:01:56,130 --> 00:01:58,949
can do this you can you can move beyond

57
00:01:57,689 --> 00:02:01,919
rebuilds and actually dig in and

58
00:01:58,950 --> 00:02:04,439
remediate so what are some of the common

59
00:02:01,920 --> 00:02:06,899
concerns so to remediate or not to

60
00:02:04,439 --> 00:02:07,798
remediate when you go back to your

61
00:02:06,899 --> 00:02:09,568
organization's you're going to be HAP

62
00:02:07,799 --> 00:02:11,580
you're gonna have to argue like we don't

63
00:02:09,568 --> 00:02:11,880
have to rebuild we can actually figure

64
00:02:11,580 --> 00:02:13,470
out

65
00:02:11,880 --> 00:02:15,000
what happened and we can stop the

66
00:02:13,470 --> 00:02:16,470
process we can stop the persistence and

67
00:02:15,000 --> 00:02:18,150
we know confidently that it's not coming

68
00:02:16,470 --> 00:02:19,170
back you're gonna have to argue that but

69
00:02:18,150 --> 00:02:20,400
you're gonna have to come up against

70
00:02:19,170 --> 00:02:23,250
some of the typical arguments so I'll

71
00:02:20,400 --> 00:02:26,370
talk about that a little process flow

72
00:02:23,250 --> 00:02:28,140
it's pretty straightforward you know one

73
00:02:26,370 --> 00:02:29,670
of one of the things that when you're

74
00:02:28,140 --> 00:02:31,559
doing this you really do have to develop

75
00:02:29,670 --> 00:02:33,350
a remediation strategy for every type of

76
00:02:31,560 --> 00:02:35,490
malware variant that you see out there

77
00:02:33,350 --> 00:02:37,829
you're not going to want to just go and

78
00:02:35,490 --> 00:02:40,500
start you know killing stuff deleting

79
00:02:37,830 --> 00:02:43,080
files you've got a you've got a dig in

80
00:02:40,500 --> 00:02:44,880
and see what's all happening you know

81
00:02:43,080 --> 00:02:45,930
you okay here's the bad process you

82
00:02:44,880 --> 00:02:47,910
don't just want to kill it you want to

83
00:02:45,930 --> 00:02:49,470
go figure out well where did that launch

84
00:02:47,910 --> 00:02:50,700
from what file is you know being

85
00:02:49,470 --> 00:02:52,260
launched into memory

86
00:02:50,700 --> 00:02:54,359
what's the persistence mechanism and

87
00:02:52,260 --> 00:02:56,429
develop that strategy and maybe along

88
00:02:54,360 --> 00:02:58,020
the way you realize that maybe it's

89
00:02:56,430 --> 00:02:59,700
bigger than you know what you thought at

90
00:02:58,020 --> 00:03:01,080
first so you want to develop that

91
00:02:59,700 --> 00:03:05,040
strategy almost every time you're

92
00:03:01,080 --> 00:03:07,020
digging in on a host that's infected and

93
00:03:05,040 --> 00:03:09,959
then I'll talk about I have two

94
00:03:07,020 --> 00:03:11,550
different examples of malware and it's

95
00:03:09,960 --> 00:03:13,740
just you know kind of showing what I you

96
00:03:11,550 --> 00:03:15,900
know just slides if I have enough time

97
00:03:13,740 --> 00:03:18,660
at the end of this I'll actually did

98
00:03:15,900 --> 00:03:20,190
find a VM that I had that it's infected

99
00:03:18,660 --> 00:03:21,240
with trick bot so we'll go through that

100
00:03:20,190 --> 00:03:25,530
if I have enough time here I probably

101
00:03:21,240 --> 00:03:27,120
will that'll be fun live demo so there

102
00:03:25,530 --> 00:03:29,100
are definitely some circumstances where

103
00:03:27,120 --> 00:03:30,210
remediation is not an option so we'll

104
00:03:29,100 --> 00:03:31,190
talk about that and then what to do

105
00:03:30,210 --> 00:03:33,540
afterwards

106
00:03:31,190 --> 00:03:35,390
so target audience is pretty much

107
00:03:33,540 --> 00:03:38,760
anybody that is going to be in this room

108
00:03:35,390 --> 00:03:41,489
you know even tech support people but if

109
00:03:38,760 --> 00:03:42,929
your sake analyst sock leader all the

110
00:03:41,490 --> 00:03:46,290
way up to your sister like if there's

111
00:03:42,930 --> 00:03:48,060
any security executives here have you

112
00:03:46,290 --> 00:03:50,549
ever looked at what the cost is to

113
00:03:48,060 --> 00:03:52,110
rebuild one workstation and then amplify

114
00:03:50,550 --> 00:03:53,520
that every time you get an alert amplify

115
00:03:52,110 --> 00:03:55,800
that for every time there's a security

116
00:03:53,520 --> 00:03:57,870
concern it's actually a lot you have to

117
00:03:55,800 --> 00:03:59,790
and then what about the process when

118
00:03:57,870 --> 00:04:02,580
let's say you're a stock analyst and you

119
00:03:59,790 --> 00:04:06,030
find an alert you send a ticket over to

120
00:04:02,580 --> 00:04:08,010
your support team does the host just go

121
00:04:06,030 --> 00:04:09,810
offline do you do you contain the host

122
00:04:08,010 --> 00:04:11,220
right away and a lot of cases no you

123
00:04:09,810 --> 00:04:13,050
just send a ticket over and hope that it

124
00:04:11,220 --> 00:04:15,030
gets done well you know what if it's

125
00:04:13,050 --> 00:04:16,260
Friday late you know this the system

126
00:04:15,030 --> 00:04:18,420
doesn't get rebuilt until Monday or

127
00:04:16,260 --> 00:04:19,950
Tuesday sometimes you have to schedule

128
00:04:18,420 --> 00:04:21,150
it out because they're a salesperson and

129
00:04:19,950 --> 00:04:22,469
they're on the road they're like I I

130
00:04:21,149 --> 00:04:24,179
can't do this right now I have a

131
00:04:22,470 --> 00:04:25,530
presentation to give or whatever rights

132
00:04:24,180 --> 00:04:26,790
where they won't respond to the text

133
00:04:25,530 --> 00:04:28,258
important person trying to get a hold of

134
00:04:26,790 --> 00:04:32,250
them maybe they have to send their

135
00:04:28,259 --> 00:04:33,710
laptop in I worked within a you know had

136
00:04:32,250 --> 00:04:35,460
locations all across the United States

137
00:04:33,710 --> 00:04:40,380
one location

138
00:04:35,460 --> 00:04:41,669
there's a guy in Nova Scotia and he had

139
00:04:40,380 --> 00:04:44,520
to go back to the administrative branch

140
00:04:41,669 --> 00:04:46,380
which was not in Nova Scotia so it was

141
00:04:44,520 --> 00:04:49,799
like a seven-hour drive in a 13 hour

142
00:04:46,380 --> 00:04:52,889
ferry ride to mainland Canada like for a

143
00:04:49,800 --> 00:04:55,830
rebuild that's not really doable right

144
00:04:52,889 --> 00:04:57,449
so so how long does it take to do the

145
00:04:55,830 --> 00:05:00,599
rebuild and is the system completely

146
00:04:57,449 --> 00:05:03,270
down like its contained four days that's

147
00:05:00,600 --> 00:05:05,460
that that's not conducive to business so

148
00:05:03,270 --> 00:05:08,400
not only is this you know good for your

149
00:05:05,460 --> 00:05:11,250
sake analysts to learn and and develop

150
00:05:08,400 --> 00:05:13,650
and and for your sock leaders to empower

151
00:05:11,250 --> 00:05:16,740
your analysts it's also cost-effective

152
00:05:13,650 --> 00:05:18,840
to do this I mean obviously there's some

153
00:05:16,740 --> 00:05:22,289
concerns and I'll just get into that

154
00:05:18,840 --> 00:05:23,880
here in a minute but you know in

155
00:05:22,289 --> 00:05:26,400
definitely empowering your analysts to

156
00:05:23,880 --> 00:05:28,530
actually learn things along the way how

157
00:05:26,400 --> 00:05:30,599
does this malware actually work you know

158
00:05:28,530 --> 00:05:33,690
I'm learning stuff every day so it's

159
00:05:30,599 --> 00:05:35,280
awesome and you know malware authors if

160
00:05:33,690 --> 00:05:38,160
you know what our strategies are for

161
00:05:35,280 --> 00:05:39,059
rebuilding for remediation then you know

162
00:05:38,160 --> 00:05:41,370
maybe you can take something away from

163
00:05:39,060 --> 00:05:42,539
this and and get a little better so if

164
00:05:41,370 --> 00:05:44,130
you're a malware author get better

165
00:05:42,539 --> 00:05:45,349
because that makes me better and we'll

166
00:05:44,130 --> 00:05:48,840
all have fun

167
00:05:45,349 --> 00:05:50,250
so some of the concerns like what if you

168
00:05:48,840 --> 00:05:52,948
miss something totally but totally valid

169
00:05:50,250 --> 00:05:55,050
concern I've missed things I've read you

170
00:05:52,949 --> 00:05:58,919
know remediated stuff you know close my

171
00:05:55,050 --> 00:06:00,960
ticket and I get an alert again and I'm

172
00:05:58,919 --> 00:06:02,250
going what the hell a veneer but what

173
00:06:00,960 --> 00:06:04,198
about what I miss and that's one of

174
00:06:02,250 --> 00:06:05,639
those like for me and I don't know how

175
00:06:04,199 --> 00:06:06,990
you guys are but for me it's like if I

176
00:06:05,639 --> 00:06:09,090
miss some I'm really digging then the

177
00:06:06,990 --> 00:06:10,590
next time like I will absolutely 100%

178
00:06:09,090 --> 00:06:12,119
not miss it a second time that's just

179
00:06:10,590 --> 00:06:14,609
like I won't let it happen because I

180
00:06:12,120 --> 00:06:16,470
want to know like I did I didn't do what

181
00:06:14,610 --> 00:06:18,180
I was supposed to do and I'm not gonna

182
00:06:16,470 --> 00:06:19,470
let that happen again so you know

183
00:06:18,180 --> 00:06:22,650
missing something is a learning

184
00:06:19,470 --> 00:06:24,599
opportunity if if the situation is big

185
00:06:22,650 --> 00:06:25,650
enough you know there's definitely I'll

186
00:06:24,599 --> 00:06:27,570
talk a little bit about this but like

187
00:06:25,650 --> 00:06:30,120
when does it become something that you

188
00:06:27,570 --> 00:06:33,180
don't want to remediate like do you want

189
00:06:30,120 --> 00:06:34,860
to watch you know should you watch your

190
00:06:33,180 --> 00:06:36,650
teeth you know the TTP's of the attacker

191
00:06:34,860 --> 00:06:37,910
of the malware what's it doing there

192
00:06:36,650 --> 00:06:39,830
those are definitely decisions that

193
00:06:37,910 --> 00:06:40,910
you're going to want to make along the

194
00:06:39,830 --> 00:06:42,740
way that's why you develop your

195
00:06:40,910 --> 00:06:45,350
remediation strategy and I'll talk to

196
00:06:42,740 --> 00:06:47,139
that as well but you know you've got

197
00:06:45,350 --> 00:06:48,979
maybe you've got a targeted adversary

198
00:06:47,139 --> 00:06:50,930
sometimes you're going to want to watch

199
00:06:48,979 --> 00:06:52,070
you know a targeted adversary but you've

200
00:06:50,930 --> 00:06:55,449
got a lot of problems at that point

201
00:06:52,070 --> 00:06:59,330
remediation is only only part of that so

202
00:06:55,449 --> 00:07:02,180
yeah so in a rebuild is an only way to

203
00:06:59,330 --> 00:07:05,240
make sure that it's clean that's false I

204
00:07:02,180 --> 00:07:08,000
do this all the time it's it's

205
00:07:05,240 --> 00:07:09,500
definitely not the only way there what

206
00:07:08,000 --> 00:07:11,990
one thing you do have to have is a

207
00:07:09,500 --> 00:07:14,270
barrier to entry to this is some sort of

208
00:07:11,990 --> 00:07:15,710
process execution logging so you know

209
00:07:14,270 --> 00:07:17,900
sis Mon I think it's built into Windows

210
00:07:15,710 --> 00:07:18,948
10 I haven't used that personally so I

211
00:07:17,900 --> 00:07:21,260
don't know how good it is or whatever

212
00:07:18,949 --> 00:07:23,240
but you're gonna you need to know like

213
00:07:21,260 --> 00:07:25,070
if malware launches you're going to need

214
00:07:23,240 --> 00:07:27,260
to know what's happening in that process

215
00:07:25,070 --> 00:07:29,479
chain as it executes what files is it

216
00:07:27,260 --> 00:07:31,820
writing out what you know registry

217
00:07:29,479 --> 00:07:33,229
changes are happening and things like

218
00:07:31,820 --> 00:07:35,120
that so if you have an ADR if you have

219
00:07:33,229 --> 00:07:37,669
system on if you have you know process

220
00:07:35,120 --> 00:07:39,050
execution logging to a degree you you

221
00:07:37,669 --> 00:07:41,210
pretty much have to have that so there's

222
00:07:39,050 --> 00:07:43,460
a bit of a barrier to entry there so if

223
00:07:41,210 --> 00:07:45,200
you don't have the logs then you can't

224
00:07:43,460 --> 00:07:46,460
confidently say I know all of the

225
00:07:45,200 --> 00:07:49,789
binaries that were written out of this

226
00:07:46,460 --> 00:07:51,969
malware right so that's a that's that's

227
00:07:49,789 --> 00:07:55,190
a little bit of a very danger there so

228
00:07:51,970 --> 00:07:58,099
alright so quick process of process flow

229
00:07:55,190 --> 00:08:00,919
so just validate it's an infection I

230
00:07:58,099 --> 00:08:02,810
mean as step one is it is it infected so

231
00:08:00,919 --> 00:08:04,520
you want to validate that once you've

232
00:08:02,810 --> 00:08:06,710
verified that yeah there's something

233
00:08:04,520 --> 00:08:08,419
running on this host you're going to

234
00:08:06,710 --> 00:08:10,810
develop your remediation strategy so

235
00:08:08,419 --> 00:08:14,599
there's that's actually my next slide

236
00:08:10,810 --> 00:08:16,130
next few slides actually so all of the

237
00:08:14,599 --> 00:08:18,349
things that are involved in you know

238
00:08:16,130 --> 00:08:21,469
understanding what's happening on the

239
00:08:18,349 --> 00:08:22,760
host what did happen what's running in

240
00:08:21,470 --> 00:08:24,410
memory all of that stuff you're going to

241
00:08:22,760 --> 00:08:26,690
want to you know develop strategies

242
00:08:24,410 --> 00:08:28,789
there so that's step two conducting the

243
00:08:26,690 --> 00:08:30,830
remediation we'll go through that step 3

244
00:08:28,789 --> 00:08:33,348
and then validation validation is

245
00:08:30,830 --> 00:08:35,449
actually an interesting one because you

246
00:08:33,349 --> 00:08:36,950
know you always have this doubt in your

247
00:08:35,450 --> 00:08:38,570
mind right like you have all the logs

248
00:08:36,950 --> 00:08:40,159
you have everything and you're like but

249
00:08:38,570 --> 00:08:42,589
I'm human maybe I did miss something so

250
00:08:40,159 --> 00:08:44,360
you know validation sometimes comes in

251
00:08:42,589 --> 00:08:46,459
the way of like you just maybe need to

252
00:08:44,360 --> 00:08:47,810
reboot and watch what's happening there

253
00:08:46,459 --> 00:08:48,290
if you have a login you have the

254
00:08:47,810 --> 00:08:51,170
alerting

255
00:08:48,290 --> 00:08:53,480
you're there for a reason you see if any

256
00:08:51,170 --> 00:08:55,880
of that is coming back after a reboot or

257
00:08:53,480 --> 00:08:58,310
something like that I always go through

258
00:08:55,880 --> 00:09:00,380
and just you know look at the do the

259
00:08:58,310 --> 00:09:02,119
remediation and then I look through all

260
00:09:00,380 --> 00:09:03,680
of the log data that I have again and

261
00:09:02,120 --> 00:09:04,670
the tool that I have so I'll look

262
00:09:03,680 --> 00:09:06,349
through that and just kind of go through

263
00:09:04,670 --> 00:09:08,599
step by step every folder

264
00:09:06,350 --> 00:09:10,940
you know delete whatever I'll kind of go

265
00:09:08,600 --> 00:09:12,829
through that usually you can KITT you

266
00:09:10,940 --> 00:09:15,290
can get a pretty good idea you know

267
00:09:12,829 --> 00:09:17,029
you've got one malware family you know

268
00:09:15,290 --> 00:09:19,969
what it does you know trick bot

269
00:09:17,029 --> 00:09:21,139
scheduled tasks run key you know that

270
00:09:19,970 --> 00:09:23,389
you've got everything just because

271
00:09:21,139 --> 00:09:29,540
you've you know run into this particular

272
00:09:23,389 --> 00:09:31,970
malware family before so remediation

273
00:09:29,540 --> 00:09:33,829
strategy your initial triage so there's

274
00:09:31,970 --> 00:09:35,600
a few things to developing the the

275
00:09:33,829 --> 00:09:39,109
remediation strategy here your initial

276
00:09:35,600 --> 00:09:41,420
triage is basically your alert you you

277
00:09:39,110 --> 00:09:44,630
or or whatever it is that tuned you in

278
00:09:41,420 --> 00:09:46,610
to go look so initial infection vector

279
00:09:44,630 --> 00:09:49,459
was it a fish was it an exploit was it a

280
00:09:46,610 --> 00:09:51,410
web shell was it you know anything what

281
00:09:49,459 --> 00:09:53,899
was that initial infection vector you

282
00:09:51,410 --> 00:09:55,699
don't always have to know but it

283
00:09:53,899 --> 00:09:56,899
certainly is good if you do that's if

284
00:09:55,699 --> 00:09:57,979
it's a fish you're gonna want to find

285
00:09:56,899 --> 00:09:59,839
the document if you don't find the

286
00:09:57,980 --> 00:10:02,269
document keep looking did the user

287
00:09:59,839 --> 00:10:03,889
delete it look for your delete event if

288
00:10:02,269 --> 00:10:07,010
you have all that logging you'll you'll

289
00:10:03,889 --> 00:10:08,449
find a delete event on that file so the

290
00:10:07,010 --> 00:10:10,100
initial infection vector is definitely

291
00:10:08,449 --> 00:10:12,229
one of those that I try to find as much

292
00:10:10,100 --> 00:10:16,339
as possible what's the system purpose

293
00:10:12,230 --> 00:10:20,510
what's the primary user you in the

294
00:10:16,339 --> 00:10:24,970
strategy that you're looking at is it is

295
00:10:20,510 --> 00:10:27,410
it a server is it you know a CIOs laptop

296
00:10:24,970 --> 00:10:29,600
does what does this server do is it a

297
00:10:27,410 --> 00:10:31,370
web server so if it's a web server and

298
00:10:29,600 --> 00:10:32,839
things like miss like commands just

299
00:10:31,370 --> 00:10:34,819
mysteriously start running you're like

300
00:10:32,839 --> 00:10:37,189
okay what's maybe a web shell let's go

301
00:10:34,819 --> 00:10:39,199
look in the in the web directories for

302
00:10:37,189 --> 00:10:41,329
things that shouldn't be there you know

303
00:10:39,199 --> 00:10:43,160
yarra scans for typical web shells or

304
00:10:41,329 --> 00:10:44,508
whatever you want to do there so

305
00:10:43,160 --> 00:10:46,310
understanding the system purpose is

306
00:10:44,509 --> 00:10:48,560
absolutely going to help you you know

307
00:10:46,310 --> 00:10:51,589
understand the attack it was it a fish

308
00:10:48,560 --> 00:10:53,149
or was it a exploit you know is

309
00:10:51,589 --> 00:10:55,430
something running in memory is something

310
00:10:53,149 --> 00:10:57,130
you know creating a schedule task and

311
00:10:55,430 --> 00:10:58,540
deleting a schedule task

312
00:10:57,130 --> 00:11:00,220
you know that's not that's all gonna

313
00:10:58,540 --> 00:11:02,980
help and if it's a if it's an important

314
00:11:00,220 --> 00:11:05,020
user you might have this like okay I got

315
00:11:02,980 --> 00:11:07,270
a stop what I'm doing because this is a

316
00:11:05,020 --> 00:11:09,699
user that has the keys to the kingdom so

317
00:11:07,270 --> 00:11:11,949
we need to you know perhaps collectively

318
00:11:09,700 --> 00:11:14,080
bring Minds together and and say how do

319
00:11:11,950 --> 00:11:16,120
we how do we you know figure this one

320
00:11:14,080 --> 00:11:17,620
out because it's maybe it's a developer

321
00:11:16,120 --> 00:11:19,300
and you're a gaming company and this is

322
00:11:17,620 --> 00:11:22,030
developers like the primary person that

323
00:11:19,300 --> 00:11:23,410
you know does all of your main things I

324
00:11:22,030 --> 00:11:26,829
don't know but it changes your strategy

325
00:11:23,410 --> 00:11:28,540
depending on who the user is are you

326
00:11:26,830 --> 00:11:30,970
dealing with malware or is it hands on

327
00:11:28,540 --> 00:11:32,980
keyboard so if you've you know if you've

328
00:11:30,970 --> 00:11:35,050
kind of if you're looking at a web shell

329
00:11:32,980 --> 00:11:38,470
a lot of times that is kind of you know

330
00:11:35,050 --> 00:11:39,969
hands on keyboard if you will if if it's

331
00:11:38,470 --> 00:11:41,920
just malware that might change what you

332
00:11:39,970 --> 00:11:43,420
do if you know that you know it's it's

333
00:11:41,920 --> 00:11:45,250
something run-of-the-mill commodity

334
00:11:43,420 --> 00:11:46,930
maybe it's malware that you've never

335
00:11:45,250 --> 00:11:49,150
seen before is taking a tactic that's

336
00:11:46,930 --> 00:11:50,380
you know you've never seen before but if

337
00:11:49,150 --> 00:11:51,430
it's hands on keyboard maybe that's one

338
00:11:50,380 --> 00:11:52,960
of those where it's like yeah let's

339
00:11:51,430 --> 00:11:54,370
let's switch up like we want to see what

340
00:11:52,960 --> 00:11:56,050
the attacker is actually interested in

341
00:11:54,370 --> 00:11:57,700
you know to a point right like you don't

342
00:11:56,050 --> 00:11:59,469
want them to be interested in all of

343
00:11:57,700 --> 00:12:00,970
your healthcare data and then allow them

344
00:11:59,470 --> 00:12:03,730
to steal the healthcare data right

345
00:12:00,970 --> 00:12:05,440
that's you know you watch for you know a

346
00:12:03,730 --> 00:12:06,790
period of time before you need to pull

347
00:12:05,440 --> 00:12:09,130
the trigger

348
00:12:06,790 --> 00:12:10,630
look at your network connections any of

349
00:12:09,130 --> 00:12:12,310
the you know you're logging should

350
00:12:10,630 --> 00:12:13,390
hopefully have you know if this process

351
00:12:12,310 --> 00:12:15,150
launched in memory what network

352
00:12:13,390 --> 00:12:19,810
connections did it make outbound c2s

353
00:12:15,150 --> 00:12:21,880
where did it communicate how can you

354
00:12:19,810 --> 00:12:24,819
determine the malware variants a lot of

355
00:12:21,880 --> 00:12:27,040
times you know the you know a motet is

356
00:12:24,820 --> 00:12:30,100
starting to come back now

357
00:12:27,040 --> 00:12:32,439
we've missed you you motet they took the

358
00:12:30,100 --> 00:12:35,080
summer off presumably in Sochi or some

359
00:12:32,440 --> 00:12:36,280
other Russian destination but anyway if

360
00:12:35,080 --> 00:12:37,810
you could determine the malware variant

361
00:12:36,280 --> 00:12:39,939
that'll help you you know to develop

362
00:12:37,810 --> 00:12:40,900
your strategy and and kind of understand

363
00:12:39,940 --> 00:12:42,070
what's going on where you're going to

364
00:12:40,900 --> 00:12:44,949
need to look first what you're going to

365
00:12:42,070 --> 00:12:46,600
need to do to remediate so and sometimes

366
00:12:44,950 --> 00:12:48,400
it's a matter of increasing the

367
00:12:46,600 --> 00:12:50,230
Prevention's as well so maybe there's a

368
00:12:48,400 --> 00:12:52,780
really important host that doesn't have

369
00:12:50,230 --> 00:12:54,280
the right Prevention's enabled or it

370
00:12:52,780 --> 00:12:56,199
doesn't have the right firewall rules

371
00:12:54,280 --> 00:12:58,420
and able to you know so maybe you could

372
00:12:56,200 --> 00:13:01,540
just shut down your yeah you know

373
00:12:58,420 --> 00:13:02,890
whatever port on the firewall to you

374
00:13:01,540 --> 00:13:03,939
know make sure that this traffic just

375
00:13:02,890 --> 00:13:05,380
stops coming in and out and you can

376
00:13:03,940 --> 00:13:07,300
remediate what's on the host so

377
00:13:05,380 --> 00:13:09,520
increasing the Prevention's on the host

378
00:13:07,300 --> 00:13:10,359
through your tooling or on the network

379
00:13:09,520 --> 00:13:11,860
side or what

380
00:13:10,360 --> 00:13:16,510
you want to do that's all kind of the

381
00:13:11,860 --> 00:13:18,370
initial part of things so once you get

382
00:13:16,510 --> 00:13:19,839
on the host so you've done the initial

383
00:13:18,370 --> 00:13:22,089
part you're looking at all the log data

384
00:13:19,839 --> 00:13:23,350
you're kind of trying to get an

385
00:13:22,089 --> 00:13:25,209
understanding of what's going on and

386
00:13:23,350 --> 00:13:27,540
what you're in for once you get on the

387
00:13:25,209 --> 00:13:30,459
host running processes persistence

388
00:13:27,540 --> 00:13:32,740
binaries any other files that might be

389
00:13:30,459 --> 00:13:35,439
there like key log files config files

390
00:13:32,740 --> 00:13:36,910
just stuff like that and then you know

391
00:13:35,440 --> 00:13:38,680
try to determine what the functionality

392
00:13:36,910 --> 00:13:40,390
of the malware is is it a worm because

393
00:13:38,680 --> 00:13:42,219
you know if it's a if it's a worming

394
00:13:40,390 --> 00:13:43,449
type malware like maybe you try to take

395
00:13:42,220 --> 00:13:46,209
action more quickly on the running

396
00:13:43,450 --> 00:13:47,529
process so maybe if you know that this

397
00:13:46,209 --> 00:13:50,619
thing's going to move laterally like

398
00:13:47,529 --> 00:13:53,110
really quickly then kill the process as

399
00:13:50,620 --> 00:13:54,670
fast as you can so that that kind of

400
00:13:53,110 --> 00:13:56,260
helps you understand you know what step

401
00:13:54,670 --> 00:13:59,920
you need to take if you understand the

402
00:13:56,260 --> 00:14:01,689
malware functionality but but but really

403
00:13:59,920 --> 00:14:03,219
the the remediation thing breaks down to

404
00:14:01,690 --> 00:14:07,260
the three things here just process

405
00:14:03,220 --> 00:14:07,260
persistence and the binaries on disk

406
00:14:09,029 --> 00:14:12,550
conceptually we talked a little bit

407
00:14:10,630 --> 00:14:15,040
about this but what's the what is the

408
00:14:12,550 --> 00:14:17,399
purpose of this malware like if you can

409
00:14:15,040 --> 00:14:19,269
develop if you can determine the variant

410
00:14:17,399 --> 00:14:21,459
maybe you know that it's a banking

411
00:14:19,269 --> 00:14:23,079
trojan or maybe you know that it's you

412
00:14:21,459 --> 00:14:25,000
know it's it's a worm and that's all its

413
00:14:23,079 --> 00:14:27,939
really doing is trying to trying to worm

414
00:14:25,000 --> 00:14:30,459
you know from host to host with with

415
00:14:27,940 --> 00:14:32,470
trick bot trick BOTS a malware that we

416
00:14:30,459 --> 00:14:34,029
run across all the time now it

417
00:14:32,470 --> 00:14:35,620
definitely has the capabilities to worm

418
00:14:34,029 --> 00:14:36,939
but it has all sorts of different

419
00:14:35,620 --> 00:14:40,120
capabilities it actually comes with

420
00:14:36,940 --> 00:14:42,100
various modules but one of the purposes

421
00:14:40,120 --> 00:14:43,750
of trick bot it's like well how long

422
00:14:42,100 --> 00:14:46,420
until they get ryuk which is a

423
00:14:43,750 --> 00:14:47,800
ransomware variant so if trick bot can

424
00:14:46,420 --> 00:14:50,439
worm its way around the network to try

425
00:14:47,800 --> 00:14:53,589
to find a host that's important enough

426
00:14:50,440 --> 00:14:56,470
for somebody on the other end presumably

427
00:14:53,589 --> 00:14:57,940
in some Russian destination it's a it's

428
00:14:56,470 --> 00:14:59,290
an interest in this particular box and

429
00:14:57,940 --> 00:15:01,240
thinks it's valuable enough to ransom

430
00:14:59,290 --> 00:15:02,680
they'll drop ryuk on it and try to get

431
00:15:01,240 --> 00:15:06,640
you to pay their ransom on your

432
00:15:02,680 --> 00:15:08,109
important system so you know what what

433
00:15:06,640 --> 00:15:09,819
what is the purpose of the activity is

434
00:15:08,110 --> 00:15:10,779
it is it a targeted adversary I mean

435
00:15:09,820 --> 00:15:12,550
obviously if you're in the banking

436
00:15:10,779 --> 00:15:16,899
industry a banking Trojan you know

437
00:15:12,550 --> 00:15:19,029
perhaps targeted maybe maybe not but you

438
00:15:16,899 --> 00:15:20,740
know maybe you're in a sector of like

439
00:15:19,029 --> 00:15:22,420
health care and there's you know you you

440
00:15:20,740 --> 00:15:23,680
know that you have a particular you know

441
00:15:22,420 --> 00:15:25,569
apt 41

442
00:15:23,680 --> 00:15:27,219
being you know super interested in

443
00:15:25,569 --> 00:15:29,410
health care data so maybe you're gonna

444
00:15:27,220 --> 00:15:31,509
have to understand you know conceptually

445
00:15:29,410 --> 00:15:33,790
like is this is this particular thing

446
00:15:31,509 --> 00:15:35,680
targeted it could be a it could be a PT

447
00:15:33,790 --> 00:15:37,029
41 fishing I mean it's low-level stuff

448
00:15:35,680 --> 00:15:41,199
they don't have to exploit all the time

449
00:15:37,029 --> 00:15:42,459
they fish so understanding whether it's

450
00:15:41,199 --> 00:15:43,748
a nod it's a targeted adversary is

451
00:15:42,459 --> 00:15:45,339
definite going to help you out and

452
00:15:43,749 --> 00:15:48,519
understanding what's going on and and

453
00:15:45,339 --> 00:15:50,230
and the strategy of everything so watch

454
00:15:48,519 --> 00:15:52,360
and disrupt we did we kind of talked

455
00:15:50,230 --> 00:15:54,610
about that but also talked about your

456
00:15:52,360 --> 00:15:57,519
threshold before critical reactions so

457
00:15:54,610 --> 00:16:00,670
maybe this is you know they said a

458
00:15:57,519 --> 00:16:02,379
domain admin so do you do you say like

459
00:16:00,670 --> 00:16:04,569
hey this isn't a normal run-of-the-mill

460
00:16:02,379 --> 00:16:05,860
remediation this is a domain admin

461
00:16:04,569 --> 00:16:08,110
they've got the keys to the kingdom like

462
00:16:05,860 --> 00:16:10,540
we definitely need to step in and do

463
00:16:08,110 --> 00:16:12,670
something right you know right away but

464
00:16:10,540 --> 00:16:15,129
let's have a conversation like where do

465
00:16:12,670 --> 00:16:19,118
you say you know raise the alarm bells

466
00:16:15,129 --> 00:16:21,990
for everybody to get involved so

467
00:16:19,119 --> 00:16:25,480
conducting the remediation basically I

468
00:16:21,990 --> 00:16:26,970
say here in this and then after you know

469
00:16:25,480 --> 00:16:29,740
looking at this again I kind of want to

470
00:16:26,970 --> 00:16:31,529
rephrase it like killing the process

471
00:16:29,740 --> 00:16:33,730
isn't always the first step because

472
00:16:31,529 --> 00:16:35,920
actually just recently I killed the

473
00:16:33,730 --> 00:16:37,389
process and that was you know doing my

474
00:16:35,920 --> 00:16:39,459
remediation and then all of a sudden the

475
00:16:37,389 --> 00:16:41,079
process was back and I go look at the

476
00:16:39,459 --> 00:16:43,689
scheduled tasks and it sets around every

477
00:16:41,079 --> 00:16:45,670
60 seconds so maybe the persistence

478
00:16:43,689 --> 00:16:47,290
mechanism of the scheduled tasks is more

479
00:16:45,670 --> 00:16:48,939
important than killing the process first

480
00:16:47,290 --> 00:16:50,529
it just depends on the variant you get

481
00:16:48,939 --> 00:16:52,029
like that's that's developing that

482
00:16:50,529 --> 00:16:53,290
strategy and understanding like if I if

483
00:16:52,029 --> 00:16:54,639
I kill the process is just gonna come

484
00:16:53,290 --> 00:16:58,120
back if I don't kill the scheduled tasks

485
00:16:54,639 --> 00:17:00,100
within 60 seconds so that's not always

486
00:16:58,120 --> 00:17:02,740
the first part it's usually the first

487
00:17:00,100 --> 00:17:04,419
part with this next with this next slide

488
00:17:02,740 --> 00:17:06,909
I talked about a malware variant coder

489
00:17:04,419 --> 00:17:10,390
if you try to kill any of the supporting

490
00:17:06,909 --> 00:17:12,189
files or the Reg keys the the processes

491
00:17:10,390 --> 00:17:14,049
will literally write them back it's just

492
00:17:12,189 --> 00:17:15,819
there's a there's a process and there's

493
00:17:14,049 --> 00:17:18,459
a watcher process and they're constantly

494
00:17:15,819 --> 00:17:20,349
watching the things that it knows this

495
00:17:18,459 --> 00:17:21,939
should be there on disk so it's watching

496
00:17:20,349 --> 00:17:23,648
that if you delete a registry key and

497
00:17:21,939 --> 00:17:26,169
then you'd like you do another you know

498
00:17:23,648 --> 00:17:28,809
reg query on that same key and it's bit

499
00:17:26,169 --> 00:17:30,220
just back it's literally immediate there

500
00:17:28,809 --> 00:17:33,490
is no way time it just writes it right

501
00:17:30,220 --> 00:17:35,649
back out if you delete it so you know a

502
00:17:33,490 --> 00:17:37,059
lot of anti viruses will kind of you

503
00:17:35,649 --> 00:17:37,510
know try to delete a file or delete a

504
00:17:37,059 --> 00:17:39,220
registry

505
00:17:37,510 --> 00:17:40,900
or something like that but the you know

506
00:17:39,220 --> 00:17:45,090
watcher processes just continue to write

507
00:17:40,900 --> 00:17:47,380
it back and it's just like a battle so

508
00:17:45,090 --> 00:17:49,870
with processes

509
00:17:47,380 --> 00:17:52,390
you got process injection so I actually

510
00:17:49,870 --> 00:17:55,659
will talk about it a little bit later

511
00:17:52,390 --> 00:17:57,730
with SPC host so injecting an SVC host

512
00:17:55,660 --> 00:18:01,660
is kind of a good way for malware to

513
00:17:57,730 --> 00:18:02,440
hide I have a pretty good command line

514
00:18:01,660 --> 00:18:04,270
that I'm going to show a little bit

515
00:18:02,440 --> 00:18:06,460
later to basically point that out it's

516
00:18:04,270 --> 00:18:10,270
like it's not even that hard to find

517
00:18:06,460 --> 00:18:11,980
injected processes it well injected SVC

518
00:18:10,270 --> 00:18:13,570
host processes I suppose if you're

519
00:18:11,980 --> 00:18:15,730
injecting into like a normal Explorer

520
00:18:13,570 --> 00:18:19,149
dot exe you know at that point you might

521
00:18:15,730 --> 00:18:21,070
you know kill a user login session but

522
00:18:19,150 --> 00:18:22,410
if the malware is injected into Explorer

523
00:18:21,070 --> 00:18:24,760
you kind of got to do what you got to do

524
00:18:22,410 --> 00:18:27,760
and don't always trust that like running

525
00:18:24,760 --> 00:18:29,920
task list or you know get process is

526
00:18:27,760 --> 00:18:31,420
going to tell you that the malware is

527
00:18:29,920 --> 00:18:34,060
actually running in memory because

528
00:18:31,420 --> 00:18:35,980
malware can just unlink from that table

529
00:18:34,060 --> 00:18:37,389
so when you run a get process you're

530
00:18:35,980 --> 00:18:38,980
looking at like a table where all

531
00:18:37,390 --> 00:18:40,660
processes when they launch they say hey

532
00:18:38,980 --> 00:18:42,730
I'm here at this place right

533
00:18:40,660 --> 00:18:43,720
well that table is just a listing at

534
00:18:42,730 --> 00:18:47,050
there like it's like a directory listing

535
00:18:43,720 --> 00:18:49,000
right so if the malware just says I want

536
00:18:47,050 --> 00:18:50,800
to unlink from that then it's still

537
00:18:49,000 --> 00:18:52,780
running in memory it's got this you know

538
00:18:50,800 --> 00:18:54,700
carved out space in memory but it won't

539
00:18:52,780 --> 00:18:57,580
tell you in a get process or a task list

540
00:18:54,700 --> 00:18:59,920
that that process is running so you know

541
00:18:57,580 --> 00:19:01,210
don't always trust that you can see the

542
00:18:59,920 --> 00:19:09,760
malware actually running in a specific

543
00:19:01,210 --> 00:19:12,760
process so Coulter is a click jacker is

544
00:19:09,760 --> 00:19:14,530
a very dumb malware like it it's got a

545
00:19:12,760 --> 00:19:16,810
lot of super awesome techniques for what

546
00:19:14,530 --> 00:19:19,120
it does it's kind of like a love-hate

547
00:19:16,810 --> 00:19:20,980
relationship with me because like it

548
00:19:19,120 --> 00:19:24,610
does some really cool stuff but it's

549
00:19:20,980 --> 00:19:27,550
really dumb so this is what a process

550
00:19:24,610 --> 00:19:29,229
tree for Koecher looks like it starts in

551
00:19:27,550 --> 00:19:31,960
the registry so the parent process of

552
00:19:29,230 --> 00:19:34,960
MSHDA here is going to be Explorer dot

553
00:19:31,960 --> 00:19:36,790
exe so that MSHDA launches and you're

554
00:19:34,960 --> 00:19:38,170
like well how'd that happen and then it

555
00:19:36,790 --> 00:19:39,730
launches PowerShell and you're like that

556
00:19:38,170 --> 00:19:41,620
looks kind of bad then it launches

557
00:19:39,730 --> 00:19:43,390
register of 32 which launches three more

558
00:19:41,620 --> 00:19:45,250
register of 32 s and you're going yeah

559
00:19:43,390 --> 00:19:46,300
this is all sorts of not supposed to

560
00:19:45,250 --> 00:19:48,220
happen

561
00:19:46,300 --> 00:19:49,730
so that's that's a dead giveaway right

562
00:19:48,220 --> 00:19:52,670
there because none of this is

563
00:19:49,730 --> 00:19:54,140
none of this so we're gonna go look at

564
00:19:52,670 --> 00:19:55,670
the registry or excuse me the running

565
00:19:54,140 --> 00:19:57,620
processes for coaster so you've got

566
00:19:55,670 --> 00:19:58,850
register of 32 so a couple things I just

567
00:19:57,620 --> 00:20:02,419
kind of highlight it hopefully you can

568
00:19:58,850 --> 00:20:05,000
see this it's running out of sis while

569
00:20:02,420 --> 00:20:06,200
64 like why would a normal Windows

570
00:20:05,000 --> 00:20:09,340
process that should be running out of

571
00:20:06,200 --> 00:20:12,710
system 32 be launched and running out of

572
00:20:09,340 --> 00:20:14,510
64 like though no real like application

573
00:20:12,710 --> 00:20:16,310
does that nothing Microsoft does that

574
00:20:14,510 --> 00:20:18,770
you're not even supposed to really see

575
00:20:16,310 --> 00:20:20,360
register 32 like it's just it's supposed

576
00:20:18,770 --> 00:20:21,860
to load something and go away like if

577
00:20:20,360 --> 00:20:25,790
it's running in memory that's all you

578
00:20:21,860 --> 00:20:27,740
know already bad and then you can see

579
00:20:25,790 --> 00:20:30,649
the launch time so register 32 s you

580
00:20:27,740 --> 00:20:32,720
know system process launches goes away

581
00:20:30,650 --> 00:20:34,970
whenever it's needed and this is running

582
00:20:32,720 --> 00:20:37,430
and it's well after any of the other

583
00:20:34,970 --> 00:20:41,000
processes like CSR SS that loads right

584
00:20:37,430 --> 00:20:43,700
when windows starts this one you know is

585
00:20:41,000 --> 00:20:45,890
running at 85 like this I took this long

586
00:20:43,700 --> 00:20:47,810
time ago screenshot but obviously it's

587
00:20:45,890 --> 00:20:49,610
loaded way after any other system

588
00:20:47,810 --> 00:20:50,929
process so that's kind of you know it's

589
00:20:49,610 --> 00:20:52,219
not a dead giveaway but it's kind of you

590
00:20:50,930 --> 00:20:54,080
know building your strategy about what

591
00:20:52,220 --> 00:20:58,610
is this bad or not but I'll help you

592
00:20:54,080 --> 00:21:00,230
determine so I dumped out that prot one

593
00:20:58,610 --> 00:21:01,969
of those registered 32s and just did

594
00:21:00,230 --> 00:21:05,060
some good old-fashioned static analysis

595
00:21:01,970 --> 00:21:07,280
here strings so if you just run proc

596
00:21:05,060 --> 00:21:09,860
dump against that process ID or whatever

597
00:21:07,280 --> 00:21:13,010
you can see here that there's just a lot

598
00:21:09,860 --> 00:21:14,899
of like IP addresses listed in process

599
00:21:13,010 --> 00:21:17,960
memory space I just you know grabbed for

600
00:21:14,900 --> 00:21:20,300
IP addresses that's kind of weird the

601
00:21:17,960 --> 00:21:22,850
first one if you can see it is like HTTP

602
00:21:20,300 --> 00:21:26,510
colon slash slash 185 blah blah blah

603
00:21:22,850 --> 00:21:29,600
slash upload dot PHP you know sweet

604
00:21:26,510 --> 00:21:32,060
that's that's probably bad so looking

605
00:21:29,600 --> 00:21:34,219
again I was just doing this to you know

606
00:21:32,060 --> 00:21:36,590
take screenshots and build this out and

607
00:21:34,220 --> 00:21:38,180
and I literally just grabbed four dot ru

608
00:21:36,590 --> 00:21:40,879
and found stuff and I was like I was

609
00:21:38,180 --> 00:21:42,140
sweet okay so I was literally like I

610
00:21:40,880 --> 00:21:43,160
wanted to grep for ip's because I knew

611
00:21:42,140 --> 00:21:45,350
they'd be in there with a click checker

612
00:21:43,160 --> 00:21:47,210
but I figured out why not you know

613
00:21:45,350 --> 00:21:50,360
expand this if I can and just did argue

614
00:21:47,210 --> 00:21:54,110
yeah a few domains in there as well so I

615
00:21:50,360 --> 00:21:55,310
was kind of fun so I ran a net stat so

616
00:21:54,110 --> 00:21:56,929
we talked about you know looking at your

617
00:21:55,310 --> 00:21:59,810
you know active network connections

618
00:21:56,930 --> 00:22:00,890
remember that 185 that that was in the

619
00:21:59,810 --> 00:22:02,810
first or the

620
00:22:00,890 --> 00:22:05,120
two slides ago so you've got an active

621
00:22:02,810 --> 00:22:08,649
network connection going to over port 80

622
00:22:05,120 --> 00:22:12,050
to 185 117 whatever you look at who is

623
00:22:08,650 --> 00:22:14,540
it's hosted in the Netherlands by some

624
00:22:12,050 --> 00:22:16,129
guy out of Dubai all right yeah and

625
00:22:14,540 --> 00:22:17,690
there's a lot of data are use in there

626
00:22:16,130 --> 00:22:21,890
so yeah something really weird is going

627
00:22:17,690 --> 00:22:23,630
on here probably got something bad this

628
00:22:21,890 --> 00:22:27,710
is a screenshot from the tool that I use

629
00:22:23,630 --> 00:22:28,970
so basically taskkill so if you run so

630
00:22:27,710 --> 00:22:31,190
remember how there was two registered

631
00:22:28,970 --> 00:22:32,810
32s there if you run task hill on just

632
00:22:31,190 --> 00:22:34,160
one of them the other ones a watcher

633
00:22:32,810 --> 00:22:36,830
process it'll literally just start up a

634
00:22:34,160 --> 00:22:40,070
new process what I did find is that you

635
00:22:36,830 --> 00:22:42,409
could do like test kill /p and a pin and

636
00:22:40,070 --> 00:22:44,980
then the process ID and then just do

637
00:22:42,410 --> 00:22:48,290
slash pit and then the other process ID

638
00:22:44,980 --> 00:22:50,150
/f /t and then that'll like kill both of

639
00:22:48,290 --> 00:22:50,690
them off at the same time so that's

640
00:22:50,150 --> 00:22:52,100
pretty cool

641
00:22:50,690 --> 00:22:55,550
also when you're when you're killing

642
00:22:52,100 --> 00:22:57,679
malware use /t that's super important it

643
00:22:55,550 --> 00:22:59,899
kills the entire process tree so any sub

644
00:22:57,680 --> 00:23:01,490
processes off that unless you're killing

645
00:22:59,900 --> 00:23:04,670
like Explorer dot exe I don't know maybe

646
00:23:01,490 --> 00:23:06,110
don't use slash T in that case but you

647
00:23:04,670 --> 00:23:08,240
can also use like PowerShell stop

648
00:23:06,110 --> 00:23:09,889
process or if you wanted to do the

649
00:23:08,240 --> 00:23:15,830
really long obnoxious way you could use

650
00:23:09,890 --> 00:23:19,190
get W my object so persistence this is a

651
00:23:15,830 --> 00:23:21,260
really busy slide but it's like the most

652
00:23:19,190 --> 00:23:24,050
important thing because this is this is

653
00:23:21,260 --> 00:23:26,660
why like coasters really cool so what

654
00:23:24,050 --> 00:23:28,159
happens is have you ever said like well

655
00:23:26,660 --> 00:23:29,330
you don't have Adobe and you download a

656
00:23:28,160 --> 00:23:31,460
PDF and it's like how do you want to

657
00:23:29,330 --> 00:23:34,100
open this like and then you would you

658
00:23:31,460 --> 00:23:36,290
assess ate a PDF file with Adobe or

659
00:23:34,100 --> 00:23:39,800
something like that right so when you do

660
00:23:36,290 --> 00:23:42,550
that in your user profile it registers

661
00:23:39,800 --> 00:23:45,050
that you know dot PDF is associated with

662
00:23:42,550 --> 00:23:46,879
Adobe so in the registry it actually

663
00:23:45,050 --> 00:23:49,040
says like I know how to open up PDF now

664
00:23:46,880 --> 00:23:51,350
because it points to you know C Program

665
00:23:49,040 --> 00:23:54,320
Files Adobe Adobe dot exe or whatever

666
00:23:51,350 --> 00:23:55,879
right so coaster does this so like the

667
00:23:54,320 --> 00:23:57,379
persistence mechanism is to set up a

668
00:23:55,880 --> 00:23:59,750
link file and this and the users like

669
00:23:57,380 --> 00:24:03,380
programs start up folder so it says a

670
00:23:59,750 --> 00:24:06,230
link file to open this 8c 1-1 to a file

671
00:24:03,380 --> 00:24:08,030
that file has like data in it but

672
00:24:06,230 --> 00:24:10,400
there's nothing and it's just a blob of

673
00:24:08,030 --> 00:24:14,300
file but what it does is registers dot

674
00:24:10,400 --> 00:24:17,030
8c 1 to a in the registry as

675
00:24:14,300 --> 00:24:19,669
a as like a file extension a file type

676
00:24:17,030 --> 00:24:23,389
and then it says eventually what I want

677
00:24:19,670 --> 00:24:25,760
to do is open em sh t a JavaScript which

678
00:24:23,390 --> 00:24:30,320
is in that big bubble here so whenever

679
00:24:25,760 --> 00:24:32,030
you open that 8 c11 to a file it says I

680
00:24:30,320 --> 00:24:34,790
want to launch em sh t a Java Script

681
00:24:32,030 --> 00:24:35,178
something like that's that's pretty

682
00:24:34,790 --> 00:24:37,460
awesome

683
00:24:35,179 --> 00:24:39,860
it registers it on its own file type in

684
00:24:37,460 --> 00:24:41,240
the registry to launch malware and then

685
00:24:39,860 --> 00:24:44,178
the malware is stored wholly in the

686
00:24:41,240 --> 00:24:47,570
registry this key if you if you can see

687
00:24:44,179 --> 00:24:51,470
it if you can't then you know sorry H

688
00:24:47,570 --> 00:24:54,110
key current user software / MV g b / DZ

689
00:24:51,470 --> 00:24:57,020
whatever that points to powershell and

690
00:24:54,110 --> 00:24:59,270
then the PowerShell code is literally in

691
00:24:57,020 --> 00:25:01,480
that particular key and that's how it's

692
00:24:59,270 --> 00:25:05,120
launching register of 32 in memory and

693
00:25:01,480 --> 00:25:09,140
click jacking all of your things so like

694
00:25:05,120 --> 00:25:11,750
this is this is really cool like yeah I

695
00:25:09,140 --> 00:25:13,910
don't know it's it's pretty fun to like

696
00:25:11,750 --> 00:25:15,200
piece all of this together cuz I didn't

697
00:25:13,910 --> 00:25:17,929
know how the registry worked like that

698
00:25:15,200 --> 00:25:20,780
before this and now I do and it's

699
00:25:17,929 --> 00:25:23,450
awesome alright maybe you guys is nerdy

700
00:25:20,780 --> 00:25:26,470
there's me Vanessa alright so here's

701
00:25:23,450 --> 00:25:28,340
here's the files that that 8c 1 1 2 a

702
00:25:26,470 --> 00:25:29,960
and that bat file

703
00:25:28,340 --> 00:25:32,540
I guess launches this so maybe there's a

704
00:25:29,960 --> 00:25:36,410
link file and the users startup whatever

705
00:25:32,540 --> 00:25:38,330
programs to launch this bat file and

706
00:25:36,410 --> 00:25:40,970
this bat file just legitimately just

707
00:25:38,330 --> 00:25:45,860
calls this this file here and it loads

708
00:25:40,970 --> 00:25:48,320
so what you do is just basically yeah so

709
00:25:45,860 --> 00:25:50,449
now what we do a little bit differently

710
00:25:48,320 --> 00:25:52,370
is instead of just deleting files will

711
00:25:50,450 --> 00:25:53,570
actually save them off so well like save

712
00:25:52,370 --> 00:25:55,100
them to a different folder and crypt

713
00:25:53,570 --> 00:25:56,540
them and then you know with a key and

714
00:25:55,100 --> 00:25:59,178
then we're like we provide that to our

715
00:25:56,540 --> 00:26:00,740
customers so like if they if you so free

716
00:25:59,179 --> 00:26:02,840
for your use case if you work at an

717
00:26:00,740 --> 00:26:04,040
organization like save this locally just

718
00:26:02,840 --> 00:26:06,500
in case you ever want to have the

719
00:26:04,040 --> 00:26:07,550
malware variants again you know like I

720
00:26:06,500 --> 00:26:09,710
think I've seen I've seen this before

721
00:26:07,550 --> 00:26:11,960
like go search your tickets go hit the

722
00:26:09,710 --> 00:26:15,590
host maybe even copy you know copy them

723
00:26:11,960 --> 00:26:16,910
off to a directory that you you know

724
00:26:15,590 --> 00:26:18,559
save malware to every time you do a

725
00:26:16,910 --> 00:26:20,300
remediation like instead of just

726
00:26:18,559 --> 00:26:21,860
deleting it or whatever just go ahead

727
00:26:20,300 --> 00:26:25,960
and save it off that's you know that's

728
00:26:21,860 --> 00:26:25,959
what we do now which is good

729
00:26:26,060 --> 00:26:32,639
so extreme rat is a pretty standard rat

730
00:26:30,570 --> 00:26:34,439
in this case I just let everything be

731
00:26:32,640 --> 00:26:37,560
named extreme' dot exe but you can

732
00:26:34,440 --> 00:26:39,240
change this to explore SVC host you know

733
00:26:37,560 --> 00:26:41,490
something random it doesn't have to be

734
00:26:39,240 --> 00:26:43,080
like extreme died exe when you download

735
00:26:41,490 --> 00:26:45,720
this rat you customize it installed on a

736
00:26:43,080 --> 00:26:47,970
host you can make it say whatever but

737
00:26:45,720 --> 00:26:49,530
this one actually injects into SVC host

738
00:26:47,970 --> 00:26:51,990
you can actually see that the tool that

739
00:26:49,530 --> 00:26:53,730
we're using gives you a little bit of an

740
00:26:51,990 --> 00:26:55,800
insight into what's happening here so

741
00:26:53,730 --> 00:26:58,440
you have extreme dot exe launches

742
00:26:55,800 --> 00:27:01,200
extreme dot exe which launches SVC host

743
00:26:58,440 --> 00:27:03,900
and then loads extreme dot exe into SBC

744
00:27:01,200 --> 00:27:05,580
host and that the the extreme dot exe

745
00:27:03,900 --> 00:27:07,590
the second one there just goes away like

746
00:27:05,580 --> 00:27:11,909
it just it's already loaded and the SVC

747
00:27:07,590 --> 00:27:14,750
host memory memory space so it's you

748
00:27:11,910 --> 00:27:18,720
know this is like a process injection of

749
00:27:14,750 --> 00:27:21,570
SVC host that is loaded from sis while

750
00:27:18,720 --> 00:27:24,510
64 so they just they loaded it up and

751
00:27:21,570 --> 00:27:27,750
then injected their own you know process

752
00:27:24,510 --> 00:27:29,580
into that so when you're looking at when

753
00:27:27,750 --> 00:27:31,770
you do like a git process or uh you know

754
00:27:29,580 --> 00:27:35,960
something like that task list one of the

755
00:27:31,770 --> 00:27:35,960
things to look for is so SVC host

756
00:27:36,660 --> 00:27:43,050
all the other SBC hosts on the Box start

757
00:27:39,120 --> 00:27:47,399
at 86 the the the I guess this is the

758
00:27:43,050 --> 00:27:50,550
size or whatever how how much memory

759
00:27:47,400 --> 00:27:51,990
space it's taking up is 9,000 that's way

760
00:27:50,550 --> 00:27:53,250
less than the other ones just kind of

761
00:27:51,990 --> 00:27:55,980
you know building like this was this

762
00:27:53,250 --> 00:27:57,060
one's probably bad the other one that

763
00:27:55,980 --> 00:27:58,710
you can't see there I didn't get the

764
00:27:57,060 --> 00:28:01,139
heading so I'm going off a memory here

765
00:27:58,710 --> 00:28:03,810
but 26 I think is the amount of handles

766
00:28:01,140 --> 00:28:05,250
that it has open but it's loaded from 6

767
00:28:03,810 --> 00:28:07,980
while 64 and none of the other ones are

768
00:28:05,250 --> 00:28:11,280
like it's it's already weird so again

769
00:28:07,980 --> 00:28:13,770
this is just kind of a slide that's more

770
00:28:11,280 --> 00:28:15,870
tool specific probably take it out but

771
00:28:13,770 --> 00:28:19,110
this is basically saying like I want to

772
00:28:15,870 --> 00:28:22,110
look for any SVC host that's from system

773
00:28:19,110 --> 00:28:23,610
ah 64 and has a process idea of 2168

774
00:28:22,110 --> 00:28:25,830
and then I just kind of like look at the

775
00:28:23,610 --> 00:28:28,100
tree again and confirm like my suspicion

776
00:28:25,830 --> 00:28:31,139
here is that the process idea of 2168 is

777
00:28:28,100 --> 00:28:33,060
the malicious SVC host and I want to

778
00:28:31,140 --> 00:28:34,260
kill it but I want to make sure that I'm

779
00:28:33,060 --> 00:28:36,780
killing the right one because I don't

780
00:28:34,260 --> 00:28:39,030
want to bring down like the SVC host

781
00:28:36,780 --> 00:28:41,370
that houses your network connection

782
00:28:39,030 --> 00:28:43,320
stuff in memory so if you do that you

783
00:28:41,370 --> 00:28:45,179
immediately lose your shell if you bring

784
00:28:43,320 --> 00:28:47,100
down the wrong SBC host right where the

785
00:28:45,180 --> 00:28:48,750
user you know can't use the system

786
00:28:47,100 --> 00:28:52,919
anymore it reboots that's gonna it's

787
00:28:48,750 --> 00:28:56,160
gonna hinder your remediation so yet

788
00:28:52,920 --> 00:28:58,170
this is just killing this process so the

789
00:28:56,160 --> 00:29:00,900
persistence mechanism if you have

790
00:28:58,170 --> 00:29:02,850
logging for this thing whenever extreme

791
00:29:00,900 --> 00:29:05,400
died exe launches it's doing things like

792
00:29:02,850 --> 00:29:07,469
making registry changes a set value

793
00:29:05,400 --> 00:29:11,160
updates right so you're looking in these

794
00:29:07,470 --> 00:29:13,020
locations for you know pointers of

795
00:29:11,160 --> 00:29:14,490
wherever files are getting launched from

796
00:29:13,020 --> 00:29:17,040
the registry persistence mechanisms

797
00:29:14,490 --> 00:29:20,570
right so just removing those you know

798
00:29:17,040 --> 00:29:24,050
run a reg query and then our reg delete

799
00:29:20,570 --> 00:29:24,050
pretty straightforward

800
00:29:26,340 --> 00:29:32,010
and then yeah cleaning up files it kind

801
00:29:28,110 --> 00:29:33,479
of talked about that just I you know I

802
00:29:32,010 --> 00:29:34,950
saw a DAT file here and I wanted to see

803
00:29:33,480 --> 00:29:36,600
what was in it so I just you know

804
00:29:34,950 --> 00:29:38,070
cattitude that file you know it's not

805
00:29:36,600 --> 00:29:39,389
always going to be like a binary blob or

806
00:29:38,070 --> 00:29:41,730
something like that it could be just

807
00:29:39,390 --> 00:29:43,410
named debt or something and have I don't

808
00:29:41,730 --> 00:29:44,850
know key logs in there or some sort of

809
00:29:43,410 --> 00:29:46,380
config that might help you understand

810
00:29:44,850 --> 00:29:47,850
what's going on so I just figured I'd

811
00:29:46,380 --> 00:29:50,270
cat that didn't really give me anything

812
00:29:47,850 --> 00:29:52,949
so I just did a you know just removed it

813
00:29:50,270 --> 00:29:54,660
so how did this get here I added this in

814
00:29:52,950 --> 00:29:56,130
kind of gratuitously just to show like

815
00:29:54,660 --> 00:29:58,440
event logs are important in this

816
00:29:56,130 --> 00:30:01,500
conversation too because you have a

817
00:29:58,440 --> 00:30:05,160
successful RDP session here 4624 with a

818
00:30:01,500 --> 00:30:08,370
logon type of ten and yeah you can use

819
00:30:05,160 --> 00:30:11,730
just powershell get event log you know

820
00:30:08,370 --> 00:30:12,870
where object the replacement string

821
00:30:11,730 --> 00:30:14,550
eight that's actually a trick that i

822
00:30:12,870 --> 00:30:16,290
learned along the way i didn't know how

823
00:30:14,550 --> 00:30:17,879
to do that at first so I just like

824
00:30:16,290 --> 00:30:20,190
filtered the script and told it to give

825
00:30:17,880 --> 00:30:22,230
me only logon type tens you could take

826
00:30:20,190 --> 00:30:24,990
that back I actually use that from time

827
00:30:22,230 --> 00:30:26,280
to time just to find specific RDP

828
00:30:24,990 --> 00:30:30,630
connections sometimes you want to do

829
00:30:26,280 --> 00:30:33,389
like to logon type two versus ten or

830
00:30:30,630 --> 00:30:35,430
something like that so that's a good one

831
00:30:33,390 --> 00:30:38,070
and in this case you can see that the

832
00:30:35,430 --> 00:30:40,680
source address is ten for whatever

833
00:30:38,070 --> 00:30:42,450
that's not the the local host right so

834
00:30:40,680 --> 00:30:44,520
you can chase down your RDP connection

835
00:30:42,450 --> 00:30:46,560
and find out where this came from

836
00:30:44,520 --> 00:30:49,350
and then I just did I just looked at

837
00:30:46,560 --> 00:30:52,250
like the event log view system ten and

838
00:30:49,350 --> 00:30:52,250
any disk wasn't

839
00:30:59,330 --> 00:31:04,520
doll Don this box so any desk was used

840
00:31:01,750 --> 00:31:07,040
to log in to this system remotely from

841
00:31:04,520 --> 00:31:09,860
that ten-four whatever and that's

842
00:31:07,040 --> 00:31:12,290
probably that could be how extreme DXE

843
00:31:09,860 --> 00:31:14,120
got to that box so just kind of you know

844
00:31:12,290 --> 00:31:18,620
showing that event logs are kind of

845
00:31:14,120 --> 00:31:19,760
important here as well so when is

846
00:31:18,620 --> 00:31:23,209
remediation not an option like

847
00:31:19,760 --> 00:31:25,610
ransomware if the box is ransomed today

848
00:31:23,210 --> 00:31:27,260
you know that you either it I guess it

849
00:31:25,610 --> 00:31:28,550
depends because maybe you can find the

850
00:31:27,260 --> 00:31:30,230
key for that particular ransomware

851
00:31:28,550 --> 00:31:31,879
variant I think there's an entire

852
00:31:30,230 --> 00:31:34,550
website I don't know what it is but it's

853
00:31:31,880 --> 00:31:36,440
specific to like all of the various keys

854
00:31:34,550 --> 00:31:37,970
that have been like reversed out of all

855
00:31:36,440 --> 00:31:40,040
of the various ransom wares that are out

856
00:31:37,970 --> 00:31:42,230
there so you can just go to this website

857
00:31:40,040 --> 00:31:44,899
and find out like hopefully the variant

858
00:31:42,230 --> 00:31:46,880
that you've got hit with has the key

859
00:31:44,900 --> 00:31:49,690
reversed and you can just go decrypt so

860
00:31:46,880 --> 00:31:51,950
maybe you can remediate if it's ransomed

861
00:31:49,690 --> 00:31:54,410
destructive malware like by route which

862
00:31:51,950 --> 00:31:57,200
is a like a file infector so it

863
00:31:54,410 --> 00:31:59,840
literally like patches your SVC host

864
00:31:57,200 --> 00:32:01,640
it'll patch your Explorer dot exe it'll

865
00:31:59,840 --> 00:32:04,699
patch you know any of the system

866
00:32:01,640 --> 00:32:06,290
processes like task list so every time

867
00:32:04,700 --> 00:32:08,060
you run test list it actually launches

868
00:32:06,290 --> 00:32:10,840
the malware again if it does that for

869
00:32:08,060 --> 00:32:13,850
all of the files within system 32 like

870
00:32:10,840 --> 00:32:15,350
you just rebuild like I'm the person up

871
00:32:13,850 --> 00:32:18,169
here saying don't rebuild like just just

872
00:32:15,350 --> 00:32:19,699
rebuild right I'm actually I did find

873
00:32:18,170 --> 00:32:21,440
viroid on a box one time and I did

874
00:32:19,700 --> 00:32:24,050
remediated because it only infected like

875
00:32:21,440 --> 00:32:26,060
three files so I just looked at the

876
00:32:24,050 --> 00:32:28,790
version of Windows it was and then

877
00:32:26,060 --> 00:32:30,950
downloaded those three files you know

878
00:32:28,790 --> 00:32:32,120
off of another system or I mean you

879
00:32:30,950 --> 00:32:33,500
could get it off a virus total and

880
00:32:32,120 --> 00:32:35,419
replace it like you know it's the signed

881
00:32:33,500 --> 00:32:36,770
the signed version if you look at the

882
00:32:35,420 --> 00:32:38,240
binaries that have been patched by by

883
00:32:36,770 --> 00:32:41,810
root they it won't be the signed version

884
00:32:38,240 --> 00:32:43,700
obviously so yeah and then human-like

885
00:32:41,810 --> 00:32:45,169
the destructive are MRF type stuff I

886
00:32:43,700 --> 00:32:47,990
mean what are you gonna do right it's

887
00:32:45,170 --> 00:32:52,990
already it's already rebuilt no we can't

888
00:32:47,990 --> 00:32:56,480
so whatever so post remediation

889
00:32:52,990 --> 00:32:57,620
obviously what does the malware do it

890
00:32:56,480 --> 00:32:59,150
have you been able to determine the

891
00:32:57,620 --> 00:33:01,310
variants do you know what that variant

892
00:32:59,150 --> 00:33:03,200
is capable of does it does it steal

893
00:33:01,310 --> 00:33:05,840
passwords does it steal credit cards

894
00:33:03,200 --> 00:33:07,550
does it worm does it take advantage of

895
00:33:05,840 --> 00:33:09,500
like is it in it is this particular

896
00:33:07,550 --> 00:33:11,360
variant that you're up against exploit

897
00:33:09,500 --> 00:33:12,900
eternal blue like maybe patch eternal

898
00:33:11,360 --> 00:33:17,678
blue

899
00:33:12,900 --> 00:33:19,299
yes yes I still see that a lot a lot of

900
00:33:17,679 --> 00:33:22,150
hosts have not patched to turn a blue in

901
00:33:19,299 --> 00:33:23,440
this world believe it or not that's not

902
00:33:22,150 --> 00:33:26,230
you right nobody here

903
00:33:23,440 --> 00:33:28,450
everybody's patched that by now update

904
00:33:26,230 --> 00:33:29,799
firewall rules you know depending on you

905
00:33:28,450 --> 00:33:32,799
know how the malware came in did it come

906
00:33:29,799 --> 00:33:35,230
in through you know just you know

907
00:33:32,799 --> 00:33:37,179
attacking some sort of you know open

908
00:33:35,230 --> 00:33:38,890
ports where you had a service available

909
00:33:37,179 --> 00:33:40,150
and that you know got through that way

910
00:33:38,890 --> 00:33:42,610
like take a look at all that

911
00:33:40,150 --> 00:33:44,049
holistically and NIST actually has a

912
00:33:42,610 --> 00:33:45,309
publication of all of the post

913
00:33:44,049 --> 00:33:48,220
remediation actions that you could

914
00:33:45,309 --> 00:33:51,639
possibly ever want it's a very long and

915
00:33:48,220 --> 00:33:54,760
dried document right here I try to read

916
00:33:51,640 --> 00:33:56,080
it was unsuccessful but yeah there's a

917
00:33:54,760 --> 00:33:57,460
lot there that if you needed to

918
00:33:56,080 --> 00:34:00,720
reference it for a particular purpose

919
00:33:57,460 --> 00:34:03,700
you could find what you needed there so

920
00:34:00,720 --> 00:34:06,549
that's the end of my presentation but I

921
00:34:03,700 --> 00:34:10,210
think I have a few minutes maybe 15 so

922
00:34:06,549 --> 00:34:12,989
I've got trick bot live so let's go

923
00:34:10,210 --> 00:34:12,990
let's go look at that

924
00:34:30,940 --> 00:34:34,280
so I was playing around with it a little

925
00:34:32,840 --> 00:34:36,679
bit earlier just to kind of confirm that

926
00:34:34,280 --> 00:34:40,190
I did that it was like live trick bot or

927
00:34:36,679 --> 00:34:44,629
whatever so let's run task list and see

928
00:34:40,190 --> 00:34:46,040
what's running in memory I'm just gonna

929
00:34:44,629 --> 00:34:47,899
tell you now that you're not gonna see

930
00:34:46,040 --> 00:34:50,119
any malicious running processes here

931
00:34:47,899 --> 00:34:53,929
because it's injected into SVC host

932
00:34:50,119 --> 00:34:55,399
space so let's do this this is the fun

933
00:34:53,929 --> 00:34:58,369
part so like the extreme rat that I

934
00:34:55,399 --> 00:35:00,770
showed you launched its own SVC host and

935
00:34:58,369 --> 00:35:05,000
then injected itself into SVC hosts like

936
00:35:00,770 --> 00:35:06,520
that what that does is essentially SVC

937
00:35:05,000 --> 00:35:09,050
host

938
00:35:06,520 --> 00:35:10,910
service host that's what stands for so

939
00:35:09,050 --> 00:35:12,770
every time SVC host is loaded in memory

940
00:35:10,910 --> 00:35:15,410
it should have some sort of service

941
00:35:12,770 --> 00:35:18,020
associated with it so tesla s-- if you

942
00:35:15,410 --> 00:35:24,350
do Tesla's SVC fine stringing

943
00:35:18,020 --> 00:35:27,650
svchost.exe love the services that are

944
00:35:24,350 --> 00:35:29,839
loaded at running processes but also it

945
00:35:27,650 --> 00:35:32,750
tells you this is the decom launch

946
00:35:29,840 --> 00:35:37,640
service or the net SVC whatever service

947
00:35:32,750 --> 00:35:39,560
or a policy agent or NA every single one

948
00:35:37,640 --> 00:35:41,660
of these is trick bot because it loads

949
00:35:39,560 --> 00:35:41,990
SVC host and injects its process in

950
00:35:41,660 --> 00:35:44,930
there

951
00:35:41,990 --> 00:35:46,640
you should never see SVC hosted with na

952
00:35:44,930 --> 00:35:49,040
it's always going to have a service

953
00:35:46,640 --> 00:35:51,500
associated with it so like these are all

954
00:35:49,040 --> 00:35:53,359
bad processes it's a dead giveaway and

955
00:35:51,500 --> 00:35:55,550
it makes it super easy with trick bot

956
00:35:53,359 --> 00:35:58,029
and trick BOTS super active like in the

957
00:35:55,550 --> 00:36:01,100
wake of Imhotep just being completely

958
00:35:58,030 --> 00:36:02,600
am ia for the entire summer we saw a lot

959
00:36:01,100 --> 00:36:03,920
trick bot which was you know kind of

960
00:36:02,600 --> 00:36:06,830
cool but it's a dead giveaway every time

961
00:36:03,920 --> 00:36:07,720
same with extreme rat in the example I

962
00:36:06,830 --> 00:36:11,060
showed a minute ago

963
00:36:07,720 --> 00:36:13,220
so with trick bot if you you know look

964
00:36:11,060 --> 00:36:15,259
up any right up on trick bot or you've

965
00:36:13,220 --> 00:36:17,830
come in to come into contact with it

966
00:36:15,260 --> 00:36:21,320
before scheduled task is the most common

967
00:36:17,830 --> 00:36:27,350
persistence mechanism so let's look at

968
00:36:21,320 --> 00:36:30,410
scheduled tasks and if you did this

969
00:36:27,350 --> 00:36:32,089
you'd get like a giant giant wall of you

970
00:36:30,410 --> 00:36:34,910
know command line text or whatever what

971
00:36:32,090 --> 00:36:37,160
I like to do is do a fine string for dot

972
00:36:34,910 --> 00:36:40,038
exe and it basically just shows you

973
00:36:37,160 --> 00:36:44,359
all of the processes that are called as

974
00:36:40,039 --> 00:36:46,280
associated by the scheduled tasks so in

975
00:36:44,359 --> 00:36:48,619
this case I'm gonna scroll to the top

976
00:36:46,280 --> 00:36:50,240
and just kind of look through see if I

977
00:36:48,619 --> 00:37:00,710
see anything that looks out of the

978
00:36:50,240 --> 00:37:06,770
ordinary desk rollaway up yep it was

979
00:37:00,710 --> 00:37:08,359
here a minute ago I swear I actually

980
00:37:06,770 --> 00:37:09,680
don't see it now I've left this running

981
00:37:08,359 --> 00:37:12,529
for a while oh no there it is

982
00:37:09,680 --> 00:37:14,660
so trick bot likes to run out of app

983
00:37:12,530 --> 00:37:18,349
data roaming so I could do like instead

984
00:37:14,660 --> 00:37:20,509
of do find string for exe I could just

985
00:37:18,349 --> 00:37:25,010
search for app data and there's there's

986
00:37:20,510 --> 00:37:26,589
my trick bot so I would go to like app

987
00:37:25,010 --> 00:37:32,839
data roaming

988
00:37:26,589 --> 00:37:34,490
when cysts and there's like this is

989
00:37:32,839 --> 00:37:37,190
really old trick bot I had to go back

990
00:37:34,490 --> 00:37:42,589
into the malware vm archives this is

991
00:37:37,190 --> 00:37:44,480
from November of 2018 based on the time

992
00:37:42,589 --> 00:37:47,359
stamps awesome so that's kind of there

993
00:37:44,480 --> 00:37:49,369
for you so trick bot used to do like

994
00:37:47,359 --> 00:37:52,130
these super long like random you know

995
00:37:49,369 --> 00:37:53,539
numbers and letters usually the letters

996
00:37:52,130 --> 00:37:56,029
were all lowercase but it'd be something

997
00:37:53,539 --> 00:37:57,589
super long so you could even develop a

998
00:37:56,029 --> 00:38:01,220
script that looked for like some sort of

999
00:37:57,589 --> 00:38:03,980
entropy right like if there's a really

1000
00:38:01,220 --> 00:38:05,720
long filename so just like recursively

1001
00:38:03,980 --> 00:38:08,180
search through your user profiles for

1002
00:38:05,720 --> 00:38:09,709
file names that are longer than 15

1003
00:38:08,180 --> 00:38:11,450
characters and then and I'll give you

1004
00:38:09,710 --> 00:38:13,400
like a you know okay it's app data

1005
00:38:11,450 --> 00:38:15,589
roaming when you know when YS or

1006
00:38:13,400 --> 00:38:20,089
whatever so that's one way you could

1007
00:38:15,589 --> 00:38:23,420
kind of like search this out what else

1008
00:38:20,089 --> 00:38:28,400
we got so sometimes trick bot does like

1009
00:38:23,420 --> 00:38:32,510
run keys so I'm just gonna look for the

1010
00:38:28,400 --> 00:38:34,430
user profile and in this version they

1011
00:38:32,510 --> 00:38:37,190
usually did just these like just the

1012
00:38:34,430 --> 00:38:39,890
user run key that was logged on now

1013
00:38:37,190 --> 00:38:42,440
they're doing like the default as well

1014
00:38:39,890 --> 00:38:44,868
so like your default profiles so anytime

1015
00:38:42,440 --> 00:38:46,670
anybody logs in every user profile is

1016
00:38:44,869 --> 00:38:51,279
going to get you know an app data

1017
00:38:46,670 --> 00:38:51,279
roaming win YS whatever folder

1018
00:38:51,290 --> 00:38:58,110
actually so I went into the directory

1019
00:38:55,830 --> 00:39:00,480
above so it's trick bots right there and

1020
00:38:58,110 --> 00:39:02,270
app data roaming as well so it's kind of

1021
00:39:00,480 --> 00:39:07,170
sprayed all over the place at this point

1022
00:39:02,270 --> 00:39:08,640
so let's look at the registry it doesn't

1023
00:39:07,170 --> 00:39:09,900
always do a run key it always does a

1024
00:39:08,640 --> 00:39:21,930
schedule task but it doesn't always do a

1025
00:39:09,900 --> 00:39:25,050
run key yeah like all of that is bad

1026
00:39:21,930 --> 00:39:26,339
so but bundle XPath is a motet so I

1027
00:39:25,050 --> 00:39:27,750
think what happened here was a motet

1028
00:39:26,340 --> 00:39:30,060
infected this box at one point in time

1029
00:39:27,750 --> 00:39:32,190
and he met a trick Bower like super bros

1030
00:39:30,060 --> 00:39:35,160
so you might end would infect and just

1031
00:39:32,190 --> 00:39:36,600
like worm around and then like all a son

1032
00:39:35,160 --> 00:39:38,220
tricked I would show up and I go okay I

1033
00:39:36,600 --> 00:39:44,819
guess even said you know sold off there

1034
00:39:38,220 --> 00:39:46,200
sold out their stuff so at this point I

1035
00:39:44,820 --> 00:39:50,760
would go through and just do like a reg

1036
00:39:46,200 --> 00:39:54,270
delete on you know bundle XPath actually

1037
00:39:50,760 --> 00:39:58,500
so one thing I didn't see was this so in

1038
00:39:54,270 --> 00:40:00,090
where ASP that's a different directory

1039
00:39:58,500 --> 00:40:03,080
it's running right out it's running out

1040
00:40:00,090 --> 00:40:06,240
of AppData local Microsoft Windows

1041
00:40:03,080 --> 00:40:07,740
what's this win Windows ASP I'm just

1042
00:40:06,240 --> 00:40:09,770
gonna go check this out cuz that doesn't

1043
00:40:07,740 --> 00:40:12,808
look good

1044
00:40:09,770 --> 00:40:12,809
[Music]

1045
00:40:20,420 --> 00:40:30,360
is that even there anymore

1046
00:40:23,270 --> 00:40:31,980
nope so that binary doesn't exist or

1047
00:40:30,360 --> 00:40:36,030
that folder I get it looks like a binary

1048
00:40:31,980 --> 00:40:39,750
right yeah so I would delete that key

1049
00:40:36,030 --> 00:40:41,460
for sure it looks like everything in the

1050
00:40:39,750 --> 00:40:43,800
round key just delete the entire rent

1051
00:40:41,460 --> 00:40:45,450
key at this point if you delete the run

1052
00:40:43,800 --> 00:40:47,790
key it'll come back in spurt you know

1053
00:40:45,450 --> 00:40:49,890
it's Microsoft doesn't want there to not

1054
00:40:47,790 --> 00:40:51,360
be a run key I'd also be looking around

1055
00:40:49,890 --> 00:40:53,129
at different places like in theory I

1056
00:40:51,360 --> 00:40:55,590
would have logs to tell me like well the

1057
00:40:53,130 --> 00:40:58,710
only a sub changes were made were of the

1058
00:40:55,590 --> 00:41:00,240
current user so I would have that

1059
00:40:58,710 --> 00:41:03,790
information than that in my back pocket

1060
00:41:00,240 --> 00:41:05,379
but I would also I would all

1061
00:41:03,790 --> 00:41:17,980
looking like the local machine so I'm

1062
00:41:05,380 --> 00:41:20,140
gonna do that real quick okay so just

1063
00:41:17,980 --> 00:41:21,160
infected the user profile so I mean in

1064
00:41:20,140 --> 00:41:22,690
theory if you wanted to take like a

1065
00:41:21,160 --> 00:41:24,580
blast approach you could just delete the

1066
00:41:22,690 --> 00:41:30,010
user profile and the scheduled tasks and

1067
00:41:24,580 --> 00:41:31,779
be good but you could you know you that

1068
00:41:30,010 --> 00:41:32,650
this is basically how trip out operates

1069
00:41:31,780 --> 00:41:38,650
so you kind of have that in your back

1070
00:41:32,650 --> 00:41:39,850
pocket you know so okay well I guess

1071
00:41:38,650 --> 00:41:41,860
that's it I just kind of wanted to show

1072
00:41:39,850 --> 00:41:43,420
you you know just different different

1073
00:41:41,860 --> 00:41:43,750
stuff actually getting on the command

1074
00:41:43,420 --> 00:41:46,570
line

1075
00:41:43,750 --> 00:41:47,920
I switched between just CMD just regular

1076
00:41:46,570 --> 00:41:50,170
like old-school command line and

1077
00:41:47,920 --> 00:41:52,030
PowerShell so sometimes when I'm

1078
00:41:50,170 --> 00:41:54,550
building out like a remediation script I

1079
00:41:52,030 --> 00:41:56,920
want to do things like you know I'll

1080
00:41:54,550 --> 00:41:59,320
want to use PowerShell for where object

1081
00:41:56,920 --> 00:42:02,920
a lot of times so like where last right

1082
00:41:59,320 --> 00:42:04,780
time was in the past 24 hours so that's

1083
00:42:02,920 --> 00:42:09,460
actually a pretty effective tool to use

1084
00:42:04,780 --> 00:42:11,320
is if you get an alert and you go to a

1085
00:42:09,460 --> 00:42:13,630
host you're usually there within you

1086
00:42:11,320 --> 00:42:15,990
know the same day 24 hours 48 hours

1087
00:42:13,630 --> 00:42:18,790
whatever if you do like last right time

1088
00:42:15,990 --> 00:42:21,040
and look through like system32 see

1089
00:42:18,790 --> 00:42:22,990
windows see program data like just

1090
00:42:21,040 --> 00:42:25,180
recursively search through see users or

1091
00:42:22,990 --> 00:42:27,520
see users brandon wonderly like whoever

1092
00:42:25,180 --> 00:42:29,230
the profile is and then say last right

1093
00:42:27,520 --> 00:42:30,850
time within the last day like it you

1094
00:42:29,230 --> 00:42:32,170
really narrow down the files that you're

1095
00:42:30,850 --> 00:42:33,819
actually going to get a result back for

1096
00:42:32,170 --> 00:42:36,240
I mean how many files are written that

1097
00:42:33,820 --> 00:42:38,230
day and it use your profile maybe a lot

1098
00:42:36,240 --> 00:42:39,520
yeah I mean you could you know a lot of

1099
00:42:38,230 --> 00:42:40,750
temp files or something like that but

1100
00:42:39,520 --> 00:42:42,460
you could also in your powershell

1101
00:42:40,750 --> 00:42:45,400
command do like where path does not

1102
00:42:42,460 --> 00:42:48,390
equal temp you know you can you can

1103
00:42:45,400 --> 00:42:48,390
definitely narrow things down

