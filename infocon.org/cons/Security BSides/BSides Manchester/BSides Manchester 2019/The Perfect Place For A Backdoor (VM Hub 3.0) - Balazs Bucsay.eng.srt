1
00:00:03,779 --> 00:00:10,719
so a few words about me I reared for

2
00:00:07,240 --> 00:00:13,240
secu as you can see from the slides I

3
00:00:10,719 --> 00:00:15,610
have a managing security consultant and

4
00:00:13,240 --> 00:00:19,900
of his research lead in the letterhead

5
00:00:15,610 --> 00:00:22,680
of his op SEC I have more than 10 years

6
00:00:19,900 --> 00:00:26,259
of experience in the offensive security

7
00:00:22,680 --> 00:00:28,930
you can find me on Twitter on there X or

8
00:00:26,260 --> 00:00:32,010
e IDE IP and of course on England as

9
00:00:28,930 --> 00:00:34,899
well I have a few strictly technical

10
00:00:32,009 --> 00:00:37,300
certificates I like to do research and

11
00:00:34,899 --> 00:00:40,329
other stuff these are listed on the

12
00:00:37,300 --> 00:00:44,649
slide and I'm a frequent speaker of

13
00:00:40,329 --> 00:00:46,960
other conferences as well I was

14
00:00:44,649 --> 00:00:48,370
fortunate to go around the birds in the

15
00:00:46,960 --> 00:00:50,979
last few years and then give

16
00:00:48,370 --> 00:00:55,328
presentations about different topics all

17
00:00:50,979 --> 00:00:58,960
around the globe today I'm going to talk

18
00:00:55,329 --> 00:01:03,609
about this device which might be

19
00:00:58,960 --> 00:01:08,110
familiar to you is his from Virgin Media

20
00:01:03,609 --> 00:01:10,480
this is the hub 3 or Super Hub 3 this is

21
00:01:08,110 --> 00:01:14,470
the latest the lost version of these

22
00:01:10,480 --> 00:01:17,650
devices as far as I know if you have a

23
00:01:14,470 --> 00:01:19,720
subscription with them for both pant

24
00:01:17,650 --> 00:01:23,320
most probably you will get or you

25
00:01:19,720 --> 00:01:26,320
already got this device hence ends up at

26
00:01:23,320 --> 00:01:35,380
least who has this device yeah many of

27
00:01:26,320 --> 00:01:40,179
you that's great now so I moved to the

28
00:01:35,380 --> 00:01:42,850
UK three years ago in 2016 we moved into

29
00:01:40,180 --> 00:01:46,060
your flats and we decided to get virtual

30
00:01:42,850 --> 00:01:48,009
media and actually we are pretty you

31
00:01:46,060 --> 00:01:50,260
know that service is really good so we

32
00:01:48,010 --> 00:01:52,300
had not no issues but because it was a

33
00:01:50,260 --> 00:01:56,020
new country for me I didn't know anybody

34
00:01:52,300 --> 00:01:59,110
I was four also the time afterward and

35
00:01:56,020 --> 00:01:59,560
we can so I had to do something so what

36
00:01:59,110 --> 00:02:01,690
did I do

37
00:01:59,560 --> 00:02:06,909
I started to play around this this

38
00:02:01,690 --> 00:02:09,728
smaller and after one day I found one

39
00:02:06,909 --> 00:02:14,530
remote command execution bug so this is

40
00:02:09,729 --> 00:02:16,930
how this really started in January 2017

41
00:02:14,530 --> 00:02:20,079
I asked for

42
00:02:16,930 --> 00:02:22,780
research time from NCC it was granted by

43
00:02:20,079 --> 00:02:25,560
by Matt Lewis the research director I

44
00:02:22,780 --> 00:02:29,799
got two weeks and of the first week I

45
00:02:25,560 --> 00:02:32,409
managed to discover more than enough

46
00:02:29,799 --> 00:02:35,950
five issues and then I break the device

47
00:02:32,409 --> 00:02:39,638
so I had to stop it and we had to buy

48
00:02:35,950 --> 00:02:41,649
some some new devices from eBay so it's

49
00:02:39,639 --> 00:02:43,659
really strange at least it was really

50
00:02:41,650 --> 00:02:47,500
strange for me basically if you go on

51
00:02:43,659 --> 00:02:51,970
eBay you can buy the same exit device

52
00:02:47,500 --> 00:02:55,780
I bought sometimes so we both like six

53
00:02:51,970 --> 00:02:58,030
of them and I continued my research this

54
00:02:55,780 --> 00:03:01,419
is a very well known device many many

55
00:02:58,030 --> 00:03:04,450
people are using it if you go on

56
00:03:01,419 --> 00:03:07,139
Wikipedia and read about Virgin Media

57
00:03:04,450 --> 00:03:12,399
you will find that as of end of December

58
00:03:07,139 --> 00:03:16,840
2012 they had almost 5 million customers

59
00:03:12,400 --> 00:03:21,400
cable customers and 4.2 million

60
00:03:16,840 --> 00:03:23,799
customers and broadband internet says at

61
00:03:21,400 --> 00:03:26,709
that time those those customers didn't

62
00:03:23,799 --> 00:03:30,129
have this device but since then because

63
00:03:26,709 --> 00:03:32,560
it's 2019 as you know many met many of

64
00:03:30,129 --> 00:03:35,500
the customers we're upgrading to let's

65
00:03:32,560 --> 00:03:40,500
say or new customers already you know

66
00:03:35,500 --> 00:03:45,040
neighbor even given this device so you

67
00:03:40,500 --> 00:03:47,409
or take I think there are millions there

68
00:03:45,040 --> 00:03:51,668
were millions of of course the verse in

69
00:03:47,409 --> 00:03:53,620
danger when I discover this issue and it

70
00:03:51,669 --> 00:03:58,000
was it was a long journey you will see

71
00:03:53,620 --> 00:04:00,729
why so I had in her duty the the

72
00:03:58,000 --> 00:04:06,340
penetration testing the device I started

73
00:04:00,729 --> 00:04:09,519
to I started discovering so I scan the

74
00:04:06,340 --> 00:04:13,269
device externally and it came back with

75
00:04:09,519 --> 00:04:14,919
nothing so everything is theater nothing

76
00:04:13,269 --> 00:04:18,039
is exposed to the internet which is

77
00:04:14,919 --> 00:04:20,769
abusing you can expose the WI the

78
00:04:18,039 --> 00:04:23,349
administration interface which you

79
00:04:20,769 --> 00:04:26,169
shouldn't do ever is don't do it that's

80
00:04:23,349 --> 00:04:28,570
not a good idea but internally you will

81
00:04:26,169 --> 00:04:31,869
find three different ports port 80 and

82
00:04:28,570 --> 00:04:37,599
443 for Twi

83
00:04:31,869 --> 00:04:41,439
over HTTP and HTTPS and port 5000 which

84
00:04:37,599 --> 00:04:44,889
is a UPnP date I tried to you to break

85
00:04:41,439 --> 00:04:47,110
dominio p.m. PD but I didn't succeed so

86
00:04:44,889 --> 00:04:49,179
that's what that looks fine so I started

87
00:04:47,110 --> 00:04:55,569
to play around the the port 80 and 443

88
00:04:49,179 --> 00:04:59,469
which is basically the same so my goal

89
00:04:55,569 --> 00:05:01,779
was to to easily take over device

90
00:04:59,469 --> 00:05:05,019
execute any kind of comments and codes

91
00:05:01,779 --> 00:05:08,349
on it totally own it which I later did

92
00:05:05,019 --> 00:05:10,689
but when I said the goal I have to

93
00:05:08,349 --> 00:05:13,419
figure out how to do this the best way

94
00:05:10,689 --> 00:05:15,399
to start if you want to do the same on

95
00:05:13,419 --> 00:05:18,188
the different devices or maybe the same

96
00:05:15,399 --> 00:05:20,379
device if you want to do this you should

97
00:05:18,189 --> 00:05:22,929
find those injection those those

98
00:05:20,379 --> 00:05:25,389
functionalities on D on the web UI on

99
00:05:22,929 --> 00:05:27,909
the on the device which are really close

100
00:05:25,389 --> 00:05:30,699
to the OS level for example if you

101
00:05:27,909 --> 00:05:34,808
configure the biomass there you can set

102
00:05:30,699 --> 00:05:37,179
the SSID the the post phrase and so on

103
00:05:34,809 --> 00:05:39,369
if you do Mac filtering then you can set

104
00:05:37,179 --> 00:05:42,039
different backs or do port forwarding

105
00:05:39,369 --> 00:05:44,849
you can set different IPs and ports and

106
00:05:42,039 --> 00:05:47,889
so on and so on those are usually

107
00:05:44,849 --> 00:05:51,279
executing different different OS level

108
00:05:47,889 --> 00:05:53,489
commands in the background ping and

109
00:05:51,279 --> 00:05:56,409
traceroute those are the perfect example

110
00:05:53,489 --> 00:05:58,239
also these devices are owned through

111
00:05:56,409 --> 00:06:00,669
these these functionalities that's how

112
00:05:58,239 --> 00:06:01,989
it is as well basically when you use the

113
00:06:00,669 --> 00:06:04,149
ping and traceroute they didn't

114
00:06:01,989 --> 00:06:06,518
implement the their own thing and trace

115
00:06:04,149 --> 00:06:08,739
within the binaries they just use the

116
00:06:06,519 --> 00:06:12,159
external pink and trace through binaries

117
00:06:08,739 --> 00:06:15,219
on the only on the operating system so I

118
00:06:12,159 --> 00:06:18,369
started to play around with those I set

119
00:06:15,219 --> 00:06:22,719
up a verb proxied everything's here and

120
00:06:18,369 --> 00:06:26,499
what I saw were these requests and as

121
00:06:22,719 --> 00:06:31,509
you can see it says all of them are get

122
00:06:26,499 --> 00:06:34,239
requests and SNMP gets SNMP sets this

123
00:06:31,509 --> 00:06:36,639
the name of the endpoint door or the

124
00:06:34,239 --> 00:06:39,099
function which is really strange because

125
00:06:36,639 --> 00:06:41,569
if you know as an MP that's totally

126
00:06:39,099 --> 00:06:44,029
different for the foe than HTTP

127
00:06:41,569 --> 00:06:48,110
and one has nothing to do with the other

128
00:06:44,029 --> 00:06:49,909
so I was really surprised at the WI

129
00:06:48,110 --> 00:06:53,330
sending the browser is sending so many

130
00:06:49,909 --> 00:06:56,058
of these requests that the verb could

131
00:06:53,330 --> 00:06:59,508
attend to it properly after a while so

132
00:06:56,059 --> 00:07:01,279
it was very strange so I started to look

133
00:06:59,509 --> 00:07:04,309
into this was what's this and it turns

134
00:07:01,279 --> 00:07:09,469
out the that the device the the web

135
00:07:04,309 --> 00:07:11,569
server using SNMP let's say to to set

136
00:07:09,469 --> 00:07:13,729
the configuration to get the

137
00:07:11,569 --> 00:07:16,279
configuration and display on the Indy

138
00:07:13,729 --> 00:07:18,860
browser and to execute different

139
00:07:16,279 --> 00:07:23,979
commands as well different functional

140
00:07:18,860 --> 00:07:27,229
section so as you can see here in the

141
00:07:23,979 --> 00:07:30,619
indicate requests in this example there

142
00:07:27,229 --> 00:07:34,789
is SNMP self there is an OID orbit which

143
00:07:30,619 --> 00:07:38,539
we know from from SNMP there is an equal

144
00:07:34,789 --> 00:07:40,849
sign a value which is one semi call 66

145
00:07:38,539 --> 00:07:43,219
which turns out that's the type of the

146
00:07:40,849 --> 00:07:45,949
value which I don't know in this case

147
00:07:43,219 --> 00:07:48,229
was that but anyways after that there is

148
00:07:45,949 --> 00:07:51,199
the other score an underscore which is

149
00:07:48,229 --> 00:07:54,080
the aunty CSRF token which is kind of

150
00:07:51,199 --> 00:07:57,769
dodgy but it kind of wrote this wrong so

151
00:07:54,080 --> 00:07:59,149
then that's kind of fine and one more

152
00:07:57,769 --> 00:08:01,699
thing that you need to see is the

153
00:07:59,149 --> 00:08:04,279
commercial cookie which is a basic stiff

154
00:08:01,699 --> 00:08:07,009
where encoded string that's a Jesus

155
00:08:04,279 --> 00:08:10,939
drink it's towards some kind of session

156
00:08:07,009 --> 00:08:13,459
identifier like a session ID and a few

157
00:08:10,939 --> 00:08:15,559
other things as well so it's really

158
00:08:13,459 --> 00:08:17,689
strange because SNMP the difference

159
00:08:15,559 --> 00:08:19,490
different concepts they mix it up for

160
00:08:17,689 --> 00:08:21,649
something so I never seen anything like

161
00:08:19,490 --> 00:08:24,259
this I don't know why they did it but

162
00:08:21,649 --> 00:08:30,019
that was that was a choice that they

163
00:08:24,259 --> 00:08:33,919
made with this through HTTP good

164
00:08:30,019 --> 00:08:36,259
the device was able to sense different

165
00:08:33,919 --> 00:08:39,139
values get different values and most

166
00:08:36,259 --> 00:08:43,219
importantly execute functionalities from

167
00:08:39,139 --> 00:08:47,000
the web server web service binary for

168
00:08:43,219 --> 00:08:50,420
example when you use trace rules these

169
00:08:47,000 --> 00:08:54,180
are the difference as a hug teammates or

170
00:08:50,420 --> 00:08:59,490
who IDs that had to be set the first one

171
00:08:54,180 --> 00:09:03,810
the zero one was set to 60 and the path

172
00:08:59,490 --> 00:09:04,529
was to the type 2 is e pattern that's

173
00:09:03,810 --> 00:09:07,500
what it means

174
00:09:04,529 --> 00:09:11,339
I guess that was the most T TR for the

175
00:09:07,500 --> 00:09:13,440
command ii o ID which was sets that was

176
00:09:11,339 --> 00:09:16,800
the hostname the type is 4 which is

177
00:09:13,440 --> 00:09:21,120
train industries that the third one was

178
00:09:16,800 --> 00:09:24,930
31 whatever and the support one was set

179
00:09:21,120 --> 00:09:27,709
to 16 not 16 to another number these are

180
00:09:24,930 --> 00:09:31,410
integers at the end the seventh otto

181
00:09:27,709 --> 00:09:34,560
that was basically the execution of the

182
00:09:31,410 --> 00:09:36,689
of the comment if you sent as value if

183
00:09:34,560 --> 00:09:39,540
you said that maybe to you to a value

184
00:09:36,690 --> 00:09:44,519
that is will exactly the function in the

185
00:09:39,540 --> 00:09:46,560
binary or marina library so i managed to

186
00:09:44,519 --> 00:09:49,620
do the most common execution I got the

187
00:09:46,560 --> 00:09:51,959
binaries I got the libraries I started

188
00:09:49,620 --> 00:09:55,620
to reverse-engineer them I use them

189
00:09:51,959 --> 00:09:59,069
either and as you can see this is using

190
00:09:55,620 --> 00:10:01,500
arm so when you do this kind of remote

191
00:09:59,070 --> 00:10:04,260
command execution once you should look

192
00:10:01,500 --> 00:10:06,779
for strings stretched string injection

193
00:10:04,260 --> 00:10:08,579
points first because if you are trying

194
00:10:06,779 --> 00:10:12,149
to try if you try to play it with

195
00:10:08,579 --> 00:10:14,279
integers there is a higher chance T to

196
00:10:12,149 --> 00:10:16,440
fail because if it is early easy to

197
00:10:14,279 --> 00:10:18,390
validate please do sometimes because

198
00:10:16,440 --> 00:10:21,329
those are just numbers it's not the same

199
00:10:18,390 --> 00:10:23,699
for Strings because in some cases you

200
00:10:21,329 --> 00:10:27,149
tease you need special characters it's

201
00:10:23,699 --> 00:10:28,949
harder to implement whether it's harder

202
00:10:27,149 --> 00:10:31,850
to check whether this trick is wallet in

203
00:10:28,949 --> 00:10:34,170
that in that scenario or even it

204
00:10:31,850 --> 00:10:36,630
sometimes we do invite listing sometimes

205
00:10:34,170 --> 00:10:38,640
you do black listing it depends on the

206
00:10:36,630 --> 00:10:42,120
use case but is it's harder to do in

207
00:10:38,640 --> 00:10:45,680
general than that in integers so as you

208
00:10:42,120 --> 00:10:48,300
can see this assembly sleep ads

209
00:10:45,680 --> 00:10:51,149
basically execute space use commands

210
00:10:48,300 --> 00:10:57,149
first it's using a some

211
00:10:51,149 --> 00:11:00,300
printf that assembles the string that is

212
00:10:57,149 --> 00:11:04,370
to ask placeholders in the string which

213
00:11:00,300 --> 00:11:07,410
are which are the strings that will be

214
00:11:04,370 --> 00:11:11,490
put in there

215
00:11:07,410 --> 00:11:14,939
the return value of the ESL freedom sari

216
00:11:11,490 --> 00:11:20,940
will be executed with the system cool in

217
00:11:14,940 --> 00:11:23,220
DVD system function so based on this if

218
00:11:20,940 --> 00:11:26,250
you can control one of the s lease

219
00:11:23,220 --> 00:11:29,070
holders the percentage s disorders in

220
00:11:26,250 --> 00:11:32,970
the industry that you can do at common

221
00:11:29,070 --> 00:11:38,970
execution this is tax raise from Ida Pro

222
00:11:32,970 --> 00:11:42,120
I I not only this example but kind of D

223
00:11:38,970 --> 00:11:43,860
compile the code as well as you can see

224
00:11:42,120 --> 00:11:46,950
there are three different ways to

225
00:11:43,860 --> 00:11:50,430
execute traceroute whether it's ipv4

226
00:11:46,950 --> 00:11:53,820
ipv6 or DNS which means in this case if

227
00:11:50,430 --> 00:11:56,520
it was the hostname it wasn't an IP then

228
00:11:53,820 --> 00:12:01,140
it goes into this return third branch

229
00:11:56,520 --> 00:12:04,439
and just using a some pretty tough again

230
00:12:01,140 --> 00:12:07,189
there are a few placeholders actually

231
00:12:04,440 --> 00:12:10,760
four placeholders a D or was lost mine

232
00:12:07,190 --> 00:12:16,670
and then it's using system on the string

233
00:12:10,760 --> 00:12:21,750
so if you can if you can inject any of

234
00:12:16,670 --> 00:12:25,079
those placeholders and if you see the B

235
00:12:21,750 --> 00:12:26,970
comment the first arguments after the D

236
00:12:25,080 --> 00:12:28,410
string is a string again which is

237
00:12:26,970 --> 00:12:30,450
hard-coded so you can't really do

238
00:12:28,410 --> 00:12:33,750
anything with that the second one is the

239
00:12:30,450 --> 00:12:36,480
best destination maybe you will you are

240
00:12:33,750 --> 00:12:39,570
able to control that b28

241
00:12:36,480 --> 00:12:41,850
that's again a variable so you might be

242
00:12:39,570 --> 00:12:43,980
able to do something with that but the

243
00:12:41,850 --> 00:12:46,650
fourth ones the last one the bar tab

244
00:12:43,980 --> 00:12:48,420
whatever that that's hard coded so you

245
00:12:46,650 --> 00:12:50,880
can't really do anything with that the

246
00:12:48,420 --> 00:12:53,849
question is can you do anything with the

247
00:12:50,880 --> 00:12:59,640
desk that we 28 and in this case you can

248
00:12:53,850 --> 00:13:04,370
because that one of that is basically

249
00:12:59,640 --> 00:13:07,140
the host thing that you can control so

250
00:13:04,370 --> 00:13:10,470
you know this was working lee was

251
00:13:07,140 --> 00:13:12,750
command execution poverty it is kind

252
00:13:10,470 --> 00:13:14,880
quite easy to difficult how to exploit

253
00:13:12,750 --> 00:13:16,530
this if you have the source code or if

254
00:13:14,880 --> 00:13:17,400
you have the binaries and you can either

255
00:13:16,530 --> 00:13:20,199
is engineered

256
00:13:17,400 --> 00:13:22,270
I didn't have either of those so

257
00:13:20,200 --> 00:13:23,860
have to do it blindly when you do it

258
00:13:22,270 --> 00:13:27,280
blindly there are lots of different

259
00:13:23,860 --> 00:13:29,440
space where you can fail because you

260
00:13:27,280 --> 00:13:31,829
have no idea how it works so you need to

261
00:13:29,440 --> 00:13:34,740
do everything step by step baby steps

262
00:13:31,830 --> 00:13:37,900
and if you are lucky you have feedback

263
00:13:34,740 --> 00:13:39,790
from the device if you are not lucky and

264
00:13:37,900 --> 00:13:42,189
I wasn't you don't have any feedback so

265
00:13:39,790 --> 00:13:44,290
you need to find something out so even

266
00:13:42,190 --> 00:13:47,290
if you mean jackets of all its commands

267
00:13:44,290 --> 00:13:50,439
you can't see the whole foot you have no

268
00:13:47,290 --> 00:13:52,569
idea whether it's drawn or not there are

269
00:13:50,440 --> 00:13:56,110
different ways to do exactly it coding

270
00:13:52,570 --> 00:13:59,620
commands in this scenario in this case

271
00:13:56,110 --> 00:14:03,040
you can use backticks pipes semicolons

272
00:13:59,620 --> 00:14:09,820
or in-line execution as listed on the

273
00:14:03,040 --> 00:14:12,310
slide duty but you can not be sure which

274
00:14:09,820 --> 00:14:15,040
which is going to be working for example

275
00:14:12,310 --> 00:14:16,989
the semicolon didn't didn't work because

276
00:14:15,040 --> 00:14:20,110
that was a restricted connected for some

277
00:14:16,990 --> 00:14:23,020
reason because there was no no feedback

278
00:14:20,110 --> 00:14:25,630
at all I had to figure out how a

279
00:14:23,020 --> 00:14:28,449
different way to do this so first I use

280
00:14:25,630 --> 00:14:30,040
reboot the first time I managed to

281
00:14:28,450 --> 00:14:32,650
reboot the device I was really happy

282
00:14:30,040 --> 00:14:34,540
because I knew something is going on all

283
00:14:32,650 --> 00:14:36,310
right so I had to wait a few minutes

284
00:14:34,540 --> 00:14:38,110
because it's footings really slowly I

285
00:14:36,310 --> 00:14:40,989
had to reproduce everything with the

286
00:14:38,110 --> 00:14:42,940
different comma then I used pink piping

287
00:14:40,990 --> 00:14:46,270
my colleague hosts but I had a buyer

288
00:14:42,940 --> 00:14:48,190
short running and I was looking for ICMP

289
00:14:46,270 --> 00:14:50,590
pockets and when I got first wrench

290
00:14:48,190 --> 00:14:52,570
which I was really happy about it

291
00:14:50,590 --> 00:14:55,300
the other thing that you need to do all

292
00:14:52,570 --> 00:14:58,870
for sometimes the puff is not set

293
00:14:55,300 --> 00:15:01,719
properly so you need to go with full bus

294
00:14:58,870 --> 00:15:03,610
it also pass the binaries it kept for

295
00:15:01,720 --> 00:15:07,030
example if we are using think it can be

296
00:15:03,610 --> 00:15:09,730
honored with user bin or as being

297
00:15:07,030 --> 00:15:14,290
whatever it depends on the on the on the

298
00:15:09,730 --> 00:15:17,110
operating system and how this is done in

299
00:15:14,290 --> 00:15:19,300
my case I couldn't use space it goes

300
00:15:17,110 --> 00:15:22,450
cold singular cold semi colon backslash

301
00:15:19,300 --> 00:15:24,550
either so I had to figure out the

302
00:15:22,450 --> 00:15:27,220
payload which was working properly with

303
00:15:24,550 --> 00:15:29,729
these distributions first of all you

304
00:15:27,220 --> 00:15:30,890
really need backslash backslash is for

305
00:15:29,730 --> 00:15:33,620
escaping

306
00:15:30,890 --> 00:15:37,480
of you come you can bypass them by using

307
00:15:33,620 --> 00:15:39,980
different kind of weights similar codes

308
00:15:37,480 --> 00:15:41,680
if he is an koenings you don't really

309
00:15:39,980 --> 00:15:43,670
need single quotes so that's fine

310
00:15:41,680 --> 00:15:46,219
semicolon I don't know if you remember

311
00:15:43,670 --> 00:15:48,410
but might you send the OID to the value

312
00:15:46,220 --> 00:15:51,920
and the end there was the type of dban

313
00:15:48,410 --> 00:15:54,589
you like to be for string - for integers

314
00:15:51,920 --> 00:15:56,870
for for strings and then there was a

315
00:15:54,590 --> 00:15:59,060
separator in the India but you said the

316
00:15:56,870 --> 00:16:00,680
value this was a semicolon so I could

317
00:15:59,060 --> 00:16:02,959
have used semicolon this case because

318
00:16:00,680 --> 00:16:05,390
that was a separator in the loop that

319
00:16:02,960 --> 00:16:07,970
Center so I had to figure out something

320
00:16:05,390 --> 00:16:11,360
else but instead of stomach oh no you

321
00:16:07,970 --> 00:16:13,610
can use just mm and science or pipes

322
00:16:11,360 --> 00:16:16,340
double pipes rely on execution maybe

323
00:16:13,610 --> 00:16:19,550
backticks the different ways and if you

324
00:16:16,340 --> 00:16:21,710
don't have space you either use

325
00:16:19,550 --> 00:16:24,740
different whites my speech characters

326
00:16:21,710 --> 00:16:28,370
for the best ways to do to use the

327
00:16:24,740 --> 00:16:30,970
environment variable ifs which is

328
00:16:28,370 --> 00:16:35,150
basically a set of my space factors

329
00:16:30,970 --> 00:16:37,730
space tab later you like carriage back

330
00:16:35,150 --> 00:16:39,530
and these kind of things and if you use

331
00:16:37,730 --> 00:16:42,890
that it will understand the commonly

332
00:16:39,530 --> 00:16:46,040
done space that was my one of my

333
00:16:42,890 --> 00:16:48,740
payloads that I sent in this case I used

334
00:16:46,040 --> 00:16:50,660
a wallet host name for no reason that

335
00:16:48,740 --> 00:16:52,790
just just just improve you how it's

336
00:16:50,660 --> 00:16:56,719
birds and then I used the you know

337
00:16:52,790 --> 00:17:00,079
execution where I connected back to my

338
00:16:56,720 --> 00:17:03,290
IP which was my column am I set up a

339
00:17:00,080 --> 00:17:06,670
listener all that was and then the

340
00:17:03,290 --> 00:17:10,149
tenant was running was was drawn on the

341
00:17:06,670 --> 00:17:12,710
other device it connected back to me

342
00:17:10,150 --> 00:17:14,480
redirected everything which was the

343
00:17:12,710 --> 00:17:16,010
content of the shadow file so the

344
00:17:14,480 --> 00:17:20,120
content of each other one was redirected

345
00:17:16,010 --> 00:17:22,190
into the socket so I got the content of

346
00:17:20,119 --> 00:17:27,319
the shadow file and everything else went

347
00:17:22,190 --> 00:17:29,720
deaf no after the remote command

348
00:17:27,319 --> 00:17:33,460
execution was exploited I got like I

349
00:17:29,720 --> 00:17:36,110
mentioned I got all the binaries and

350
00:17:33,460 --> 00:17:38,480
libraries I started to reverse engineer

351
00:17:36,110 --> 00:17:40,840
everything that seems to be interesting

352
00:17:38,480 --> 00:17:42,970
and I found this it was

353
00:17:40,840 --> 00:17:44,918
because which wasn't working in this

354
00:17:42,970 --> 00:17:48,340
forever and I don't think it's working

355
00:17:44,919 --> 00:17:50,230
it works now but it was really

356
00:17:48,340 --> 00:17:55,889
interesting to see this so basically

357
00:17:50,230 --> 00:17:59,080
this is a back door user if you use ie

358
00:17:55,890 --> 00:18:03,700
an omni user that the possibilities

359
00:17:59,080 --> 00:18:05,080
either blank string or solder link and

360
00:18:03,700 --> 00:18:10,299
as far as I know southern link is a

361
00:18:05,080 --> 00:18:13,178
different vendor like a different ISP so

362
00:18:10,299 --> 00:18:15,490
maybe we don't be that isp there is a

363
00:18:13,179 --> 00:18:19,809
backdoor user which you can use of the

364
00:18:15,490 --> 00:18:22,390
wi with the password of suddenly this is

365
00:18:19,809 --> 00:18:25,059
I found that through interests they all

366
00:18:22,390 --> 00:18:27,549
bought this device it is prime

367
00:18:25,059 --> 00:18:29,770
ministership media but really the device

368
00:18:27,549 --> 00:18:31,418
is not virtual media this is a distant

369
00:18:29,770 --> 00:18:35,980
event door which I can't mention it's

370
00:18:31,419 --> 00:18:39,190
for stupid reasons and basically the the

371
00:18:35,980 --> 00:18:43,210
salad is a survival device or different

372
00:18:39,190 --> 00:18:46,210
ISPs Virgin Media belongs the different

373
00:18:43,210 --> 00:18:48,370
group which is Liberty global I believe

374
00:18:46,210 --> 00:18:51,970
and the earthing global has many

375
00:18:48,370 --> 00:18:55,178
different ISPs all around Europe and I

376
00:18:51,970 --> 00:18:57,309
believe in the USS r-- a-- so defendants

377
00:18:55,179 --> 00:18:59,679
under defense they use the same device

378
00:18:57,309 --> 00:19:02,500
for different ISPs the box is different

379
00:18:59,679 --> 00:19:03,970
the logo of them the brand the

380
00:19:02,500 --> 00:19:07,240
configuration is different but the

381
00:19:03,970 --> 00:19:11,200
operating system and the binaries the

382
00:19:07,240 --> 00:19:15,070
firmware is kind of the same this is

383
00:19:11,200 --> 00:19:20,080
basically they don't want to develop the

384
00:19:15,070 --> 00:19:23,649
same things for for different ISPs okay

385
00:19:20,080 --> 00:19:25,418
so looking through the the web UI you

386
00:19:23,649 --> 00:19:27,418
don't need the format for this I was

387
00:19:25,419 --> 00:19:32,080
looking through the JavaScript files I

388
00:19:27,419 --> 00:19:34,210
found a dog based exercise I would

389
00:19:32,080 --> 00:19:36,428
applicated Pompeii's XSS so if you look

390
00:19:34,210 --> 00:19:37,149
into the device and then you click on a

391
00:19:36,429 --> 00:19:39,039
link

392
00:19:37,149 --> 00:19:41,199
crafting link which can come from an

393
00:19:39,039 --> 00:19:43,480
email a fish fishing leave our in

394
00:19:41,200 --> 00:19:46,510
somebody else can send it to you some

395
00:19:43,480 --> 00:19:50,980
house if you click on this for example

396
00:19:46,510 --> 00:19:53,140
which is on the on the slide now if you

397
00:19:50,980 --> 00:19:57,340
load up the sec you are

398
00:19:53,140 --> 00:20:00,280
as you see Google test the trust stretch

399
00:19:57,340 --> 00:20:02,649
test GS and these will execute the

400
00:20:00,280 --> 00:20:05,020
JavaScript from this file so if you

401
00:20:02,650 --> 00:20:07,150
logged in you click on this I can

402
00:20:05,020 --> 00:20:10,110
execute any kind of JavaScript in your

403
00:20:07,150 --> 00:20:13,480
browser I can see your cookies which are

404
00:20:10,110 --> 00:20:16,570
used for authentication as you remember

405
00:20:13,480 --> 00:20:19,660
from the first HTTP president I showed

406
00:20:16,570 --> 00:20:22,139
you and maybe I can log in or I can do

407
00:20:19,660 --> 00:20:26,140
stuff on with your browser

408
00:20:22,140 --> 00:20:27,460
my goal was on out unauthenticated it

409
00:20:26,140 --> 00:20:30,130
was common execution

410
00:20:27,460 --> 00:20:34,090
I had the authenticated remote command

411
00:20:30,130 --> 00:20:38,679
execution part part but I had to make it

412
00:20:34,090 --> 00:20:41,320
somehow to be authenticated so I had

413
00:20:38,679 --> 00:20:44,410
this don't be his XSS basically but that

414
00:20:41,320 --> 00:20:46,840
maybe the authentication you I wasn't

415
00:20:44,410 --> 00:20:48,429
exposed to the Internet's so even if I

416
00:20:46,840 --> 00:20:50,649
had the credentials I come from get

417
00:20:48,429 --> 00:20:52,840
because I don't know the credentials and

418
00:20:50,650 --> 00:20:55,270
that it's not exposed to be that and

419
00:20:52,840 --> 00:20:58,659
maybe remember I mentioned the aunty

420
00:20:55,270 --> 00:21:06,360
CSRF tokens so those were protecting

421
00:20:58,660 --> 00:21:08,890
against against against the malicious

422
00:21:06,360 --> 00:21:12,790
web requests that are coming from a

423
00:21:08,890 --> 00:21:15,580
different website then I look to the de

424
00:21:12,790 --> 00:21:17,649
binary's again I was looking for the

425
00:21:15,580 --> 00:21:22,020
authentication part authorization form

426
00:21:17,650 --> 00:21:26,380
and I know I saw this snippet of code

427
00:21:22,020 --> 00:21:29,710
where you can see if the credential

428
00:21:26,380 --> 00:21:32,500
content which is basically the cookie

429
00:21:29,710 --> 00:21:37,450
the credential cookie if the content of

430
00:21:32,500 --> 00:21:40,330
that because XML configure each tab

431
00:21:37,450 --> 00:21:44,590
configure more toxin or figure you are

432
00:21:40,330 --> 00:21:49,600
logged in right otherwise it says status

433
00:21:44,590 --> 00:21:53,830
denied you are losing so that was really

434
00:21:49,600 --> 00:21:55,928
good stuff because it wasn't just an

435
00:21:53,830 --> 00:21:58,418
authentication or authorization by

436
00:21:55,929 --> 00:22:01,150
passing these kids for the bypass the on

437
00:21:58,419 --> 00:22:03,730
the CSF tokens as well so I didn't have

438
00:22:01,150 --> 00:22:05,679
to eat to Gary about that so it was

439
00:22:03,730 --> 00:22:06,920
really cool because if I send these

440
00:22:05,679 --> 00:22:12,410
cookies

441
00:22:06,920 --> 00:22:14,240
I use maybe DG don't base XSS and then

442
00:22:12,410 --> 00:22:16,970
the remote command execution of them

443
00:22:14,240 --> 00:22:18,890
then I might be able to do some

444
00:22:16,970 --> 00:22:23,480
unauthenticated you most common tax

445
00:22:18,890 --> 00:22:25,660
evasion right the only thing is of

446
00:22:23,480 --> 00:22:28,430
course I don't know if you know course

447
00:22:25,660 --> 00:22:32,000
or search and resource sharing hands up

448
00:22:28,430 --> 00:22:34,340
if you do yeah off of you that's fine

449
00:22:32,000 --> 00:22:37,940
so basically long story short what

450
00:22:34,340 --> 00:22:40,699
course does if you have to defend that

451
00:22:37,940 --> 00:22:43,970
page is open in your browser one webpage

452
00:22:40,700 --> 00:22:49,850
cannot access the other's data right so

453
00:22:43,970 --> 00:22:52,370
I cannot if you have BBC open and my

454
00:22:49,850 --> 00:22:56,389
valid malicious website that I control I

455
00:22:52,370 --> 00:22:58,820
cannot set cookies for poor or BBC I

456
00:22:56,390 --> 00:23:03,800
cannot get the cookies from the BBC site

457
00:22:58,820 --> 00:23:06,260
I cannot get the I cannot load or get

458
00:23:03,800 --> 00:23:08,360
any any content from the other tab from

459
00:23:06,260 --> 00:23:10,280
the other browser right so that's that's

460
00:23:08,360 --> 00:23:13,580
basically the cross-origin resource

461
00:23:10,280 --> 00:23:17,720
sharing in the dishwater measure of

462
00:23:13,580 --> 00:23:19,669
course it's a bigger data so I was

463
00:23:17,720 --> 00:23:22,400
thinking about this maybe I can use the

464
00:23:19,670 --> 00:23:25,250
don't base exercise with the cookies -

465
00:23:22,400 --> 00:23:29,810
cookies and execute these SNMP sets

466
00:23:25,250 --> 00:23:32,180
requests they vote me or somehow I can

467
00:23:29,810 --> 00:23:35,330
do this but there was the course of

468
00:23:32,180 --> 00:23:37,460
course which which was blocking me so I

469
00:23:35,330 --> 00:23:40,460
couldn't I couldn't do this from the

470
00:23:37,460 --> 00:23:42,590
browser even if even if there was a

471
00:23:40,460 --> 00:23:45,440
volley session because somebody just

472
00:23:42,590 --> 00:23:49,189
configured the router and clicked on the

473
00:23:45,440 --> 00:23:50,750
website in the next 10 minutes or in the

474
00:23:49,190 --> 00:23:52,400
next 20 minutes I couldn't do it is

475
00:23:50,750 --> 00:23:54,890
because the the session timeout was

476
00:23:52,400 --> 00:23:59,470
quite low because like 5 or 10 minutes

477
00:23:54,890 --> 00:24:03,950
so the the on top window is very narrow

478
00:23:59,470 --> 00:24:06,770
so I had to I had to stop working on

479
00:24:03,950 --> 00:24:09,470
this I couldn't do an authenticated it

480
00:24:06,770 --> 00:24:12,320
what Robert executional death that's all

481
00:24:09,470 --> 00:24:15,350
the time I wanted to weaponize this the

482
00:24:12,320 --> 00:24:17,960
next points but I couldn't at least not

483
00:24:15,350 --> 00:24:18,530
in a way that I wanted so I did some

484
00:24:17,960 --> 00:24:22,400
other

485
00:24:18,530 --> 00:24:24,740
the device I started to look in the in

486
00:24:22,400 --> 00:24:26,750
the architecture you think you would

487
00:24:24,740 --> 00:24:29,090
think this is a really really basic

488
00:24:26,750 --> 00:24:31,280
device nothing special it's running

489
00:24:29,090 --> 00:24:33,949
Linux and that's it but that's not true

490
00:24:31,280 --> 00:24:40,750
so this is this is basically a Wi-Fi

491
00:24:33,950 --> 00:24:43,520
router on 2.4 and 5g this is a rotor and

492
00:24:40,750 --> 00:24:47,150
the dachsies model so it's it's more

493
00:24:43,520 --> 00:24:49,910
than you were saying I started to look

494
00:24:47,150 --> 00:24:52,460
into define my system and it turns out

495
00:24:49,910 --> 00:24:55,370
there are 14 different partitions of the

496
00:24:52,460 --> 00:24:58,130
flesh and two of those actually four of

497
00:24:55,370 --> 00:25:01,969
those partitions had two differently

498
00:24:58,130 --> 00:25:05,930
losses right one for armed and the other

499
00:25:01,970 --> 00:25:08,210
one was for Intel 886 which was really

500
00:25:05,930 --> 00:25:13,430
strange because I already owned the arm

501
00:25:08,210 --> 00:25:14,570
part so why would you have Intel 86 x86

502
00:25:13,430 --> 00:25:16,970
binarism

503
00:25:14,570 --> 00:25:19,370
the operating system on the flash that

504
00:25:16,970 --> 00:25:23,350
was really strange for me when I checked

505
00:25:19,370 --> 00:25:30,439
the mark-up cache and there was this IP

506
00:25:23,350 --> 00:25:33,169
192 181 68 to file power to 545 for on

507
00:25:30,440 --> 00:25:36,590
that interface which is in red which is

508
00:25:33,170 --> 00:25:39,710
a different Vidan so it was it was quite

509
00:25:36,590 --> 00:25:42,139
strange so I decided that I am going to

510
00:25:39,710 --> 00:25:44,030
ping it and as you can see there is no

511
00:25:42,140 --> 00:25:46,520
latency so it might be

512
00:25:44,030 --> 00:25:49,910
Catman hack for some reason which is

513
00:25:46,520 --> 00:25:52,030
really strange or or tells basically no

514
00:25:49,910 --> 00:25:55,310
wire between the two operating systems

515
00:25:52,030 --> 00:25:59,840
or the really short wire and it turns

516
00:25:55,310 --> 00:26:03,200
out turns out this this CPU does this

517
00:25:59,840 --> 00:26:08,480
dance device is using is an Interpol few

518
00:26:03,200 --> 00:26:10,100
mistakes and in 2016 early 2017 if you

519
00:26:08,480 --> 00:26:12,350
google this this chip

520
00:26:10,100 --> 00:26:14,240
you didn't find much about this I don't

521
00:26:12,350 --> 00:26:17,540
know why probably it wasn't well at that

522
00:26:14,240 --> 00:26:22,670
time but animées it turns out it has

523
00:26:17,540 --> 00:26:26,409
three defense course on the chip one is

524
00:26:22,670 --> 00:26:30,200
part of a physics as we know I already

525
00:26:26,410 --> 00:26:30,690
own that architecture and there is two

526
00:26:30,200 --> 00:26:34,950
other

527
00:26:30,690 --> 00:26:37,290
words which are intel 8 Intel x86 right

528
00:26:34,950 --> 00:26:38,880
so three different course two different

529
00:26:37,290 --> 00:26:41,100
operating systems running on the two

530
00:26:38,880 --> 00:26:42,930
different type of architecture which was

531
00:26:41,100 --> 00:26:46,770
really strange because we are talking

532
00:26:42,930 --> 00:26:49,440
about one CP arm and Intel is integrated

533
00:26:46,770 --> 00:26:54,780
in the same CPU I never seen anything

534
00:26:49,440 --> 00:26:58,620
like this before then I started to think

535
00:26:54,780 --> 00:27:01,500
about maybe I should own the other other

536
00:26:58,620 --> 00:27:03,840
parts other half of the devices well how

537
00:27:01,500 --> 00:27:07,170
can I didn't there are two ways that

538
00:27:03,840 --> 00:27:10,379
I've came up with the leaves v is

539
00:27:07,170 --> 00:27:13,020
basically modifying the FS the

540
00:27:10,380 --> 00:27:16,680
filesystem rewriting it or changing some

541
00:27:13,020 --> 00:27:20,389
stuff on it or the other one is service

542
00:27:16,680 --> 00:27:24,000
exploitation so I went with the lazy V

543
00:27:20,390 --> 00:27:28,410
there are a few partitions that are used

544
00:27:24,000 --> 00:27:31,800
by the secondary architecture one of

545
00:27:28,410 --> 00:27:34,650
them are squash FS which is read-only so

546
00:27:31,800 --> 00:27:37,200
we need to get the the filesystem you

547
00:27:34,650 --> 00:27:40,110
need to dump it if you want to change it

548
00:27:37,200 --> 00:27:42,150
you need to be bundle is really to

549
00:27:40,110 --> 00:27:44,040
recreates before poor file system

550
00:27:42,150 --> 00:27:47,340
because it's read-only and you need to

551
00:27:44,040 --> 00:27:49,470
refresh the flash that's not hard to do

552
00:27:47,340 --> 00:27:51,389
cause it's kind of risky because if they

553
00:27:49,470 --> 00:27:54,510
have some kind of signature signature

554
00:27:51,390 --> 00:27:58,250
checking or any kind of other stuff is

555
00:27:54,510 --> 00:28:01,290
my break the device so I what I did I

556
00:27:58,250 --> 00:28:01,890
mounted the X 3 partition just to see

557
00:28:01,290 --> 00:28:04,920
what it does

558
00:28:01,890 --> 00:28:07,380
I promoted this I rebooted the device at

559
00:28:04,920 --> 00:28:10,260
night practice so after my week

560
00:28:07,380 --> 00:28:13,770
officially after like four days I break

561
00:28:10,260 --> 00:28:17,910
the device because I brought on to the X

562
00:28:13,770 --> 00:28:20,340
3 partition mountainous what I forgot

563
00:28:17,910 --> 00:28:23,070
about the secondary lecture that was

564
00:28:20,340 --> 00:28:26,939
already mounted so when I rebooted the

565
00:28:23,070 --> 00:28:31,710
device it marked the de partition s as

566
00:28:26,940 --> 00:28:34,290
corrupt or it is the FSC case but my

567
00:28:31,710 --> 00:28:37,260
year rebooter your your computer and it

568
00:28:34,290 --> 00:28:39,780
needs to be FSC can you know it is

569
00:28:37,260 --> 00:28:42,200
asking the question from you and you

570
00:28:39,780 --> 00:28:44,639
need to write yes or no

571
00:28:42,200 --> 00:28:46,440
during the boot but

572
00:28:44,640 --> 00:28:49,049
busy for you contrary connect the

573
00:28:46,440 --> 00:28:51,420
keyboard or anything to this so that's

574
00:28:49,049 --> 00:28:53,400
how I break the device every time any

575
00:28:51,420 --> 00:28:56,429
better ability didn't boot because it

576
00:28:53,400 --> 00:28:59,640
was waiting for my yes all summer so now

577
00:28:56,429 --> 00:29:02,010
it was it is quite unpleasant I had to

578
00:28:59,640 --> 00:29:08,940
get a new device so that's my B or there

579
00:29:02,010 --> 00:29:12,090
are lots of these devices we gotta watch

580
00:29:08,940 --> 00:29:15,750
refresh Scott's portion of us if you

581
00:29:12,090 --> 00:29:17,790
decide to recreate this then you need to

582
00:29:15,750 --> 00:29:20,880
make sure that you use the these same

583
00:29:17,790 --> 00:29:22,409
compression algorithms you checked all

584
00:29:20,880 --> 00:29:24,419
the files and everything just to make

585
00:29:22,410 --> 00:29:27,900
sure that it is going to vary because if

586
00:29:24,419 --> 00:29:30,780
you refresh it wrongly then it's not

587
00:29:27,900 --> 00:29:32,520
going to work ever again or of course

588
00:29:30,780 --> 00:29:34,830
you can get the flash you can go back to

589
00:29:32,520 --> 00:29:37,020
the flesh but we need to get out of the

590
00:29:34,830 --> 00:29:43,500
case and it's that's not something that

591
00:29:37,020 --> 00:29:45,960
I can do the other way after I break the

592
00:29:43,500 --> 00:29:47,940
device I had to do the other way the

593
00:29:45,960 --> 00:29:50,700
other way which was basically the

594
00:29:47,940 --> 00:29:52,200
service exploitation I scan the

595
00:29:50,700 --> 00:29:55,790
secondary architecture on the type II

596
00:29:52,200 --> 00:30:00,030
that I showed you I found one really old

597
00:29:55,790 --> 00:30:02,490
Samba which must read of X in no shares

598
00:30:00,030 --> 00:30:04,260
there was a public exploits in

599
00:30:02,490 --> 00:30:07,049
Metasploit which was working against it

600
00:30:04,260 --> 00:30:09,179
but should have been working assets but

601
00:30:07,049 --> 00:30:09,510
it didn't so I couldn't do anything with

602
00:30:09,179 --> 00:30:13,620
it

603
00:30:09,510 --> 00:30:16,590
there was an RPC client bounty the 1210

604
00:30:13,620 --> 00:30:19,559
at 23 TCP port and someone knows

605
00:30:16,590 --> 00:30:23,909
services then I think deeper and I found

606
00:30:19,559 --> 00:30:27,928
these parts which is 5150 yeah I hope

607
00:30:23,910 --> 00:30:30,750
you can sis and if he read in the middle

608
00:30:27,929 --> 00:30:32,460
there is this command system so

609
00:30:30,750 --> 00:30:34,799
basically me the system comedy you can

610
00:30:32,460 --> 00:30:38,760
expect with any kind of operating system

611
00:30:34,799 --> 00:30:44,360
level command so I decided to execute a

612
00:30:38,760 --> 00:30:46,770
proper sshd on port 22 22 and I was it

613
00:30:44,360 --> 00:30:49,080
it was quite trivial because the

614
00:30:46,770 --> 00:30:51,918
depositors for the root user was the

615
00:30:49,080 --> 00:30:54,300
same as the US or the other manufacturer

616
00:30:51,919 --> 00:30:56,220
by the way I had access to the file

617
00:30:54,300 --> 00:30:58,740
system so it was quite easy

618
00:30:56,220 --> 00:31:01,590
Logan as you can see this this this

619
00:30:58,740 --> 00:31:08,880
secretary architecture was running and

620
00:31:01,590 --> 00:31:13,020
still running on intel x86 and the other

621
00:31:08,880 --> 00:31:19,650
part which is doing the logic is armed

622
00:31:13,020 --> 00:31:22,440
v6 then a few months later I came across

623
00:31:19,650 --> 00:31:27,720
this thing which I completely ignored so

624
00:31:22,440 --> 00:31:29,820
far and I was thinking maybe I can do an

625
00:31:27,720 --> 00:31:33,450
authenticated it was common execution

626
00:31:29,820 --> 00:31:36,720
finally so as you remember the only

627
00:31:33,450 --> 00:31:40,710
barrier which was missing here is

628
00:31:36,720 --> 00:31:42,330
bypassing course so I quickly voted out

629
00:31:40,710 --> 00:31:46,020
the device when I realized maybe I

630
00:31:42,330 --> 00:31:48,539
missed something and I sent the request

631
00:31:46,020 --> 00:31:51,539
this was the response friends the host

632
00:31:48,539 --> 00:31:54,658
header was sent to the IP the nice

633
00:31:51,539 --> 00:31:57,658
changed ye the host header from the IP

634
00:31:54,659 --> 00:32:00,690
to whatever doesn't matter as he changed

635
00:31:57,659 --> 00:32:04,400
him and I got the same response can you

636
00:32:00,690 --> 00:32:09,270
tell me what kind of whatever it is this

637
00:32:04,400 --> 00:32:13,049
yeah that's right yes reminding I think

638
00:32:09,270 --> 00:32:16,200
there's a reason why you know this yeah

639
00:32:13,049 --> 00:32:21,320
so the s rebinding and basically this is

640
00:32:16,200 --> 00:32:23,730
this is the distant grill to to cut the

641
00:32:21,320 --> 00:32:27,149
unauthenticated remote command execution

642
00:32:23,730 --> 00:32:30,390
working because with this you can talk

643
00:32:27,150 --> 00:32:32,150
to the device remotely even if it's on

644
00:32:30,390 --> 00:32:34,789
the internal network

645
00:32:32,150 --> 00:32:37,860
so if you don't know the NS rebinding

646
00:32:34,789 --> 00:32:41,370
it's really easy to understand if you

647
00:32:37,860 --> 00:32:43,678
have a hostname that you control then

648
00:32:41,370 --> 00:32:47,850
like you resolve that host name is will

649
00:32:43,679 --> 00:32:50,130
give you an IP if you resolve that

650
00:32:47,850 --> 00:32:53,280
hostname for the second time it might

651
00:32:50,130 --> 00:32:55,350
give you a different IP the browser will

652
00:32:53,280 --> 00:32:58,320
think that it is talking to the same web

653
00:32:55,350 --> 00:33:01,830
page but the IP changed in the meantime

654
00:32:58,320 --> 00:33:04,649
in the background so in this case I

655
00:33:01,830 --> 00:33:06,750
created a Depot which I'm going to show

656
00:33:04,649 --> 00:33:10,050
you I really hope this build it is going

657
00:33:06,750 --> 00:33:14,520
to burn if not I have a video office

658
00:33:10,050 --> 00:33:18,240
so you can see it's like this so

659
00:33:14,520 --> 00:33:21,660
basically I have a domain which is

660
00:33:18,240 --> 00:33:23,790
pointing to to do a website which is

661
00:33:21,660 --> 00:33:27,750
externally available you can open it in

662
00:33:23,790 --> 00:33:29,909
your browser and after after a few

663
00:33:27,750 --> 00:33:33,930
seconds or in this case because I was

664
00:33:29,910 --> 00:33:37,110
lazy and cheap after 20 to 120 seconds

665
00:33:33,930 --> 00:33:39,720
it is going to change the IP behind that

666
00:33:37,110 --> 00:33:42,689
host name and the browser will talk to

667
00:33:39,720 --> 00:33:45,240
the device to the router this router has

668
00:33:42,690 --> 00:33:49,500
by default the same IP all the time

669
00:33:45,240 --> 00:33:52,050
which is 192 mozzies 8:01 that's

670
00:33:49,500 --> 00:33:55,170
basically the default you can change it

671
00:33:52,050 --> 00:33:58,139
of course but nobody changes it so my

672
00:33:55,170 --> 00:34:00,630
exploits is going to change the external

673
00:33:58,140 --> 00:34:02,340
IP to this internal IP and the browser

674
00:34:00,630 --> 00:34:05,360
will think that it is something the same

675
00:34:02,340 --> 00:34:08,340
with sending the request to the same

676
00:34:05,360 --> 00:34:11,179
same device to the same server but it

677
00:34:08,340 --> 00:34:13,830
doesn't so what what my exploit does

678
00:34:11,179 --> 00:34:16,770
when you open these websites because I

679
00:34:13,830 --> 00:34:20,219
sent you a link what it is embedded into

680
00:34:16,770 --> 00:34:22,290
a website that you visit friendly and it

681
00:34:20,219 --> 00:34:24,750
is going to work in the background so

682
00:34:22,290 --> 00:34:27,120
when you have this website it will sense

683
00:34:24,750 --> 00:34:30,449
the cookie do that bypass cookie that I

684
00:34:27,120 --> 00:34:32,909
show you I can do that because i i i

685
00:34:30,449 --> 00:34:36,270
execute my code in my own web browser

686
00:34:32,909 --> 00:34:38,700
right in my old domain then it is going

687
00:34:36,270 --> 00:34:42,300
to wait and in the background i do some

688
00:34:38,699 --> 00:34:44,850
magic to do DNS rebinding so I have my

689
00:34:42,300 --> 00:34:46,770
DNS server which tells for the first

690
00:34:44,850 --> 00:34:49,980
time this is the exid this is the

691
00:34:46,770 --> 00:34:51,630
website then if you ask it again it will

692
00:34:49,980 --> 00:34:54,449
give you the internal IP of the device

693
00:34:51,630 --> 00:34:57,180
so after a few seconds or more than a

694
00:34:54,449 --> 00:35:00,629
few seconds the browser will change the

695
00:34:57,180 --> 00:35:04,649
cache the IP will point to this device

696
00:35:00,630 --> 00:35:07,950
and I am going to start that time I'm

697
00:35:04,650 --> 00:35:10,440
going to execute the the author against

698
00:35:07,950 --> 00:35:14,879
device that time I will send a lots of

699
00:35:10,440 --> 00:35:16,350
SNMP sans requests to set the trace room

700
00:35:14,880 --> 00:35:20,640
things that I showed you in the

701
00:35:16,350 --> 00:35:22,470
beginning there is easy to build execute

702
00:35:20,640 --> 00:35:23,819
the dropper sshd

703
00:35:22,470 --> 00:35:27,569
on the main architecture

704
00:35:23,820 --> 00:35:30,240
the are part exposed at portal 22 then

705
00:35:27,570 --> 00:35:32,490
it will exploit the secondary device the

706
00:35:30,240 --> 00:35:34,890
secondary architecture through that

707
00:35:32,490 --> 00:35:36,509
service that I shown you it will execute

708
00:35:34,890 --> 00:35:39,720
the drop pair on the secondary device

709
00:35:36,510 --> 00:35:43,830
and with some IP tables magic I will

710
00:35:39,720 --> 00:35:47,810
expose dead ports secondary sshd ports

711
00:35:43,830 --> 00:36:21,000
on 4:23 so demo time

712
00:35:47,810 --> 00:36:23,850
fingers crossed so I have my DNS server

713
00:36:21,000 --> 00:36:25,140
running on my server this is not the

714
00:36:23,850 --> 00:36:28,890
people that I just wanted to show you

715
00:36:25,140 --> 00:36:33,060
and here I'm going to scan this device

716
00:36:28,890 --> 00:36:37,560
as you can see you can see it right you

717
00:36:33,060 --> 00:36:40,110
can read it for 23 closed for 23 22

718
00:36:37,560 --> 00:36:43,980
close so everything is closed I have

719
00:36:40,110 --> 00:36:46,670
eaten access on this Olivia Google loads

720
00:36:43,980 --> 00:36:49,920
properly it's fine

721
00:36:46,670 --> 00:36:55,140
and I'm going to look at this this

722
00:36:49,920 --> 00:36:58,440
profited website which is the energy

723
00:36:55,140 --> 00:37:01,529
media how max points the tables they

724
00:36:58,440 --> 00:37:05,040
started the attack I sent the cookie and

725
00:37:01,530 --> 00:37:08,460
as you can see here the muscle it is

726
00:37:05,040 --> 00:37:12,650
going to sense like in every 20 seconds

727
00:37:08,460 --> 00:37:18,000
a request to be to the device with a 404

728
00:37:12,650 --> 00:37:20,460
it is looking for a PNG and if if it's

729
00:37:18,000 --> 00:37:22,650
portal for that that's why because we

730
00:37:20,460 --> 00:37:28,260
don't have that PNG on the server that

731
00:37:22,650 --> 00:37:31,410
that answer that page nicer but might be

732
00:37:28,260 --> 00:37:34,980
changed after a while openness around 60

733
00:37:31,410 --> 00:37:35,940
seconds not work then is we look for

734
00:37:34,980 --> 00:37:39,119
that big picture

735
00:37:35,940 --> 00:37:44,849
this device that I know the DNS

736
00:37:39,119 --> 00:37:46,289
rebinding is and when that happens we

737
00:37:44,849 --> 00:37:47,789
know from the JavaScript that we are

738
00:37:46,289 --> 00:37:50,160
talking to the device instead of the

739
00:37:47,789 --> 00:37:54,539
event page that deserves and we are

740
00:37:50,160 --> 00:37:57,210
going to do the exploitation okay so it

741
00:37:54,539 --> 00:37:59,280
wasn't 404 it was the 200th so we found

742
00:37:57,210 --> 00:38:02,700
the picture and now we are sending a

743
00:37:59,280 --> 00:38:05,460
lots of us and that be stuff I can told

744
00:38:02,700 --> 00:38:07,020
you I was cheap and I was amazing so

745
00:38:05,460 --> 00:38:09,480
that's why I are using this yes

746
00:38:07,020 --> 00:38:12,210
remaining pending there are different

747
00:38:09,480 --> 00:38:14,780
techniques there are more reliable but

748
00:38:12,210 --> 00:38:19,829
more expensive technics in terms of

749
00:38:14,780 --> 00:38:22,950
effort resources so basically you can

750
00:38:19,829 --> 00:38:25,109
you can use those that you can do DSD

751
00:38:22,950 --> 00:38:27,960
binding in a few seconds so when you

752
00:38:25,109 --> 00:38:30,869
move and a malicious web page with this

753
00:38:27,960 --> 00:38:35,760
set up maybe you can be exploited in

754
00:38:30,869 --> 00:38:38,160
three seconds is now 65 7 right so if

755
00:38:35,760 --> 00:38:44,010
you go back and scale it again you can

756
00:38:38,160 --> 00:38:54,868
see now port 23 22 and 23 is open so I

757
00:38:44,010 --> 00:38:59,130
can look in port for 22 you don't really

758
00:38:54,869 --> 00:39:03,420
get a shaft like you you concedes as you

759
00:38:59,130 --> 00:39:16,440
can see I'm root UID 0 this is the ARM

760
00:39:03,420 --> 00:39:20,730
architecture one one core of v6 PI over

761
00:39:16,440 --> 00:39:26,220
six and I look out don't need this

762
00:39:20,730 --> 00:39:30,799
anymore and I log in on port 23 it is

763
00:39:26,220 --> 00:39:30,799
same password and I do the same stuff

764
00:39:38,630 --> 00:39:51,119
two different course but both of them

765
00:39:42,539 --> 00:40:00,890
are autumn which is in town x86 crazy

766
00:39:51,119 --> 00:40:00,890
thing that was the demo and G seconds

767
00:40:03,979 --> 00:40:09,269
the question is here the difficut hands

768
00:40:06,959 --> 00:40:11,549
is way and you won't be hacked this way

769
00:40:09,269 --> 00:40:14,008
because all these issues are fixed

770
00:40:11,549 --> 00:40:15,569
except one which is the s remaining or

771
00:40:14,009 --> 00:40:18,299
maybe that's because s well I haven't

772
00:40:15,569 --> 00:40:20,759
checked for a while so basically the

773
00:40:18,299 --> 00:40:23,400
question is if you do it if you get

774
00:40:20,759 --> 00:40:25,019
hacked and somebody implants it wants

775
00:40:23,400 --> 00:40:28,349
something in the secondary architecture

776
00:40:25,019 --> 00:40:30,718
on the on the auto parts would you have

777
00:40:28,349 --> 00:40:32,219
them would you ever not listen do you

778
00:40:30,719 --> 00:40:34,079
think that the forensics that you do

779
00:40:32,219 --> 00:40:37,739
against your device or somebody else

780
00:40:34,079 --> 00:40:40,680
does it will they be really 50 so I

781
00:40:37,739 --> 00:40:42,180
think it's quite frightening because you

782
00:40:40,680 --> 00:40:44,848
don't know anything about these devices

783
00:40:42,180 --> 00:40:49,049
can have a lots of different issues and

784
00:40:44,849 --> 00:40:51,170
even if if you know and if those issues

785
00:40:49,049 --> 00:40:54,089
an exploitable they can hide their stuff

786
00:40:51,170 --> 00:40:55,499
in the secondary and architecture and

787
00:40:54,089 --> 00:40:57,839
you can't really do anything against

788
00:40:55,499 --> 00:41:00,149
them and from the manufacturer you have

789
00:40:57,839 --> 00:41:03,239
full access to the interfaces you can

790
00:41:00,150 --> 00:41:06,449
change the data you can spoof it you can

791
00:41:03,239 --> 00:41:09,140
sniff it you can do whatever you like in

792
00:41:06,449 --> 00:41:12,539
ANSI C we do responsible disclosure

793
00:41:09,140 --> 00:41:19,019
which is which is great but at the same

794
00:41:12,539 --> 00:41:28,709
time it's kind of annoying so I reported

795
00:41:19,019 --> 00:41:30,479
the the issues on March 12 2013 72 years

796
00:41:28,709 --> 00:41:33,690
ago one and two years ago and it took

797
00:41:30,479 --> 00:41:36,959
around one and a half years to fix all

798
00:41:33,690 --> 00:41:38,519
the issues I mean I understand the

799
00:41:36,959 --> 00:41:41,549
process I think I understand the

800
00:41:38,519 --> 00:41:43,379
processes release know they need to test

801
00:41:41,549 --> 00:41:46,288
if ever they need to make sure that a

802
00:41:43,380 --> 00:41:47,880
detainee speaks had it in Italy to make

803
00:41:46,289 --> 00:41:50,099
sure that everything is working properly

804
00:41:47,880 --> 00:41:50,550
because if they roll out the further

805
00:41:50,099 --> 00:41:54,960
which

806
00:41:50,550 --> 00:41:58,230
often then they will break hundreds or

807
00:41:54,960 --> 00:42:01,110
millions of devices millions of devices

808
00:41:58,230 --> 00:42:04,200
and that's financially not a good idea

809
00:42:01,110 --> 00:42:06,390
so probably that's why they - it's

810
00:42:04,200 --> 00:42:09,930
really slow but one of the half years

811
00:42:06,390 --> 00:42:11,520
that I could publish this talk but not

812
00:42:09,930 --> 00:42:14,299
publish anything about this because we

813
00:42:11,520 --> 00:42:17,850
were waiting on the bad boy

814
00:42:14,300 --> 00:42:20,190
thank you so much if you have any

815
00:42:17,850 --> 00:42:24,870
questions then maybe you can do it mom

816
00:42:20,190 --> 00:42:26,940
we believe we have we have five minutes

817
00:42:24,870 --> 00:42:29,310
so otherwise if you don't want to have

818
00:42:26,940 --> 00:42:33,920
questions here you can find me later no

819
00:42:29,310 --> 00:42:33,920
way or maybe make seven years

