1
00:00:02,930 --> 00:00:08,760
the man himself thank you very much

2
00:00:05,780 --> 00:00:10,890
thank so much for coming so job and said

3
00:00:08,760 --> 00:00:12,780
this<font color="#CCCCCC"> is a pen testing war story I mean</font>

4
00:00:10,890 --> 00:00:14,099
this presentation sort of evolved as I

5
00:00:12,780 --> 00:00:15,950
was writing<font color="#E5E5E5"> it as these things tend</font><font color="#CCCCCC"> to</font>

6
00:00:14,099 --> 00:00:18,350
so we're starting<font color="#E5E5E5"> off with a war story</font>

7
00:00:15,950 --> 00:00:21,390
with about a web application that<font color="#E5E5E5"> had</font>

8
00:00:18,350 --> 00:00:23,609
excel export and the vulnerabilities

9
00:00:21,390 --> 00:00:25,619
that that can present that<font color="#CCCCCC"> in itself is</font>

10
00:00:23,609 --> 00:00:27,750
not<font color="#CCCCCC"> particularly no what was interesting</font>

11
00:00:25,619 --> 00:00:29,070
about this is the it was very restricted

12
00:00:27,750 --> 00:00:30,480
environment in which I was<font color="#E5E5E5"> doing this</font>

13
00:00:29,070 --> 00:00:32,580
test it was very lockdown you weren't

14
00:00:30,480 --> 00:00:34,379
allowed a pen test laptop so it was<font color="#E5E5E5"> like</font>

15
00:00:32,580 --> 00:00:37,229
how did I manage to achieve that with

16
00:00:34,379 --> 00:00:38,909
just<font color="#E5E5E5"> some basic tools and then about the</font>

17
00:00:37,229 --> 00:00:40,470
<font color="#E5E5E5">last third of the talk is really about</font>

18
00:00:38,909 --> 00:00:42,260
where we can go<font color="#CCCCCC"> from there</font><font color="#E5E5E5"> and sort of</font>

19
00:00:40,470 --> 00:00:45,299
taking a generic case of web application

20
00:00:42,260 --> 00:00:46,559
<font color="#CCCCCC">Excel exports is there any way that we</font>

21
00:00:45,299 --> 00:00:48,780
can cut down<font color="#E5E5E5"> on the number of user</font>

22
00:00:46,559 --> 00:00:50,760
warning so all sort of which I'll

23
00:00:48,780 --> 00:00:52,620
explain on the way so where do these

24
00:00:50,760 --> 00:00:55,170
user warnings come from and how can we

25
00:00:52,620 --> 00:00:57,000
try manipulate our payloads to try and

26
00:00:55,170 --> 00:00:58,140
cut those down so I think there's a

27
00:00:57,000 --> 00:00:59,940
little<font color="#E5E5E5"> bit</font><font color="#CCCCCC"> of something for everyone</font>

28
00:00:58,140 --> 00:01:01,080
really so just a quick Who am I so

29
00:00:59,940 --> 00:01:03,330
bidding<font color="#CCCCCC"> computes security for quite a</font>

30
00:01:01,080 --> 00:01:04,769
while<font color="#E5E5E5"> a fraction of which I've</font><font color="#CCCCCC"> been a</font>

31
00:01:03,330 --> 00:01:06,840
pen tester and a fraction<font color="#CCCCCC"> of that I've</font>

32
00:01:04,769 --> 00:01:08,430
been<font color="#E5E5E5"> at NCC and if you can solve those</font>

33
00:01:06,840 --> 00:01:10,229
equations then you'll you can figure out

34
00:01:08,430 --> 00:01:11,579
what those numbers are and then you'll

35
00:01:10,229 --> 00:01:13,140
understand why I like to kind<font color="#CCCCCC"> of keep it</font>

36
00:01:11,579 --> 00:01:18,020
<font color="#E5E5E5">a bit quiet because the numbers are</font>

37
00:01:13,140 --> 00:01:21,210
quite large so<font color="#E5E5E5"> yeah I've been to slough</font>

38
00:01:18,020 --> 00:01:23,490
and I was here<font color="#E5E5E5"> two years ago as well I</font>

39
00:01:21,210 --> 00:01:25,199
did a talk about openssl so don't know

40
00:01:23,490 --> 00:01:27,750
if any of you saw that essentially it

41
00:01:25,200 --> 00:01:30,049
was<font color="#E5E5E5"> about how to manually check for</font>

42
00:01:27,750 --> 00:01:32,670
results that you get from tools

43
00:01:30,049 --> 00:01:35,039
concerning TLS and<font color="#E5E5E5"> SSL and how you can</font>

44
00:01:32,670 --> 00:01:37,710
<font color="#CCCCCC">actually make sure that they are true</font>

45
00:01:35,039 --> 00:01:39,539
positives using openssl and like so I've

46
00:01:37,710 --> 00:01:42,419
got a blog explore security com and

47
00:01:39,539 --> 00:01:44,850
that's my<font color="#E5E5E5"> twitter handle so as I said</font>

48
00:01:42,420 --> 00:01:47,340
this is based on a true story and any

49
00:01:44,850 --> 00:01:49,740
similarity to actual events is

50
00:01:47,340 --> 00:01:52,170
completely intentional obviously I've

51
00:01:49,740 --> 00:01:54,419
changed some technical details done a

52
00:01:52,170 --> 00:01:56,490
bit of obfuscation and stuff so<font color="#CCCCCC"> you</font><font color="#E5E5E5"> can</font>

53
00:01:54,420 --> 00:01:59,219
actually identify anything then please

54
00:01:56,490 --> 00:02:00,389
keep it yourself and let me know<font color="#CCCCCC"> then</font>

55
00:01:59,219 --> 00:02:03,089
I'll we just cut that out of the slides

56
00:02:00,389 --> 00:02:07,530
and edit the video but we<font color="#E5E5E5"> should be</font><font color="#CCCCCC"> good</font>

57
00:02:03,090 --> 00:02:09,300
to go so what's by way of an agenda this

58
00:02:07,530 --> 00:02:10,590
is what what we're going to what we do

59
00:02:09,300 --> 00:02:13,440
is I'm going<font color="#E5E5E5"> to take you</font><font color="#CCCCCC"> from the</font><font color="#E5E5E5"> step</font>

60
00:02:10,590 --> 00:02:15,090
so from csv to CMD is essentially we've

61
00:02:13,440 --> 00:02:16,579
got a web application does excel export

62
00:02:15,090 --> 00:02:18,500
how do we go from

63
00:02:16,580 --> 00:02:21,470
<font color="#E5E5E5">they're to command execution on victim</font>

64
00:02:18,500 --> 00:02:22,730
users I then just wanted<font color="#E5E5E5"> to do as a</font>

65
00:02:21,470 --> 00:02:24,200
proof of concept the report I was

66
00:02:22,730 --> 00:02:26,929
writing something you know better<font color="#E5E5E5"> than</font>

67
00:02:24,200 --> 00:02:29,959
the equivalent of an alert one so so

68
00:02:26,930 --> 00:02:31,460
grab some hashes of the victim user and

69
00:02:29,960 --> 00:02:33,710
and had to go cracking them so that's

70
00:02:31,460 --> 00:02:36,890
from CMD to qwerty so none of that is

71
00:02:33,710 --> 00:02:38,090
particularly difficult but what was what

72
00:02:36,890 --> 00:02:39,470
what was difficult about this particular

73
00:02:38,090 --> 00:02:41,150
engagement was there it was the

74
00:02:39,470 --> 00:02:44,210
environment we weren't allowed<font color="#E5E5E5"> to bring</font>

75
00:02:41,150 --> 00:02:46,130
any<font color="#E5E5E5"> pen test laptops in we had domain</font>

76
00:02:44,210 --> 00:02:47,390
user accounts so with those kind<font color="#CCCCCC"> of</font>

77
00:02:46,130 --> 00:02:49,130
restrictions it made life a bit more

78
00:02:47,390 --> 00:02:50,660
difficult<font color="#E5E5E5"> so</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> actually forced me to</font>

79
00:02:49,130 --> 00:02:53,720
sort<font color="#E5E5E5"> of get into a nitty-gritty of the</font>

80
00:02:50,660 --> 00:02:55,790
<font color="#CCCCCC">topic and and that's what</font><font color="#E5E5E5"> I'm presenting</font>

81
00:02:53,720 --> 00:02:57,200
you know today for for information<font color="#E5E5E5"> and</font>

82
00:02:55,790 --> 00:02:59,630
then at the<font color="#CCCCCC"> end there's a so can we</font>

83
00:02:57,200 --> 00:03:02,149
improve the attack you know<font color="#E5E5E5"> can we make</font>

84
00:02:59,630 --> 00:03:05,420
it a more seamless so that users don't

85
00:03:02,150 --> 00:03:08,690
have to<font color="#E5E5E5"> accept so many warnings so this</font>

86
00:03:05,420 --> 00:03:10,369
<font color="#E5E5E5">is a big big big company the application</font>

87
00:03:08,690 --> 00:03:12,020
was internal this is why there<font color="#CCCCCC"> were all</font>

88
00:03:10,370 --> 00:03:14,660
the restrictions about the testing so

89
00:03:12,020 --> 00:03:16,220
its internal at web app is six classic

90
00:03:14,660 --> 00:03:18,920
ASP kind of like the beginning of

91
00:03:16,220 --> 00:03:21,769
casualty really there<font color="#E5E5E5"> are a lot of</font>

92
00:03:18,920 --> 00:03:22,730
problems with<font color="#E5E5E5"> this and much more severe</font>

93
00:03:21,769 --> 00:03:24,709
problems<font color="#E5E5E5"> that what I'm going to lay out</font>

94
00:03:22,730 --> 00:03:27,709
here you know sequin jection the like

95
00:03:24,709 --> 00:03:30,220
but I'm only going<font color="#E5E5E5"> to focus on one so</font>

96
00:03:27,709 --> 00:03:32,180
the ex LX sport was this is a financial

97
00:03:30,220 --> 00:03:35,000
application so<font color="#E5E5E5"> you know you'd sort of</font>

98
00:03:32,180 --> 00:03:36,260
mess about and plug out some data you

99
00:03:35,000 --> 00:03:38,390
<font color="#E5E5E5">get a page of results then you say</font>

100
00:03:36,260 --> 00:03:39,768
please export this to excel it would it

101
00:03:38,390 --> 00:03:41,510
would it<font color="#CCCCCC"> would download an excel file</font>

102
00:03:39,769 --> 00:03:43,489
except in<font color="#CCCCCC"> this case it didn't</font><font color="#E5E5E5"> it did it</font>

103
00:03:41,510 --> 00:03:45,920
<font color="#E5E5E5">in a horribly complex way it actually</font>

104
00:03:43,489 --> 00:03:48,610
returns some<font color="#E5E5E5"> JavaScript to the to</font><font color="#CCCCCC"> the</font>

105
00:03:45,920 --> 00:03:50,958
browser which which compiled a post that

106
00:03:48,610 --> 00:03:52,670
posted back up to the web app and that

107
00:03:50,959 --> 00:03:54,950
returned you in excel file so in fact

108
00:03:52,670 --> 00:03:56,570
the contents of the excel file were

109
00:03:54,950 --> 00:03:58,100
going back forth back forth it<font color="#CCCCCC"> was it</font>

110
00:03:56,570 --> 00:03:59,989
was disgusting<font color="#E5E5E5"> and just to give</font><font color="#CCCCCC"> you an</font>

111
00:03:58,100 --> 00:04:03,290
idea that's like that's<font color="#E5E5E5"> a snippet of the</font>

112
00:03:59,989 --> 00:04:05,000
final post so<font color="#E5E5E5"> basically the entire excel</font>

113
00:04:03,290 --> 00:04:07,040
file was going was already at the

114
00:04:05,000 --> 00:04:09,140
clients it was so going back up<font color="#CCCCCC"> to the</font>

115
00:04:07,040 --> 00:04:11,480
server to be returned back as an excel

116
00:04:09,140 --> 00:04:13,429
file it<font color="#CCCCCC"> was</font><font color="#E5E5E5"> disgusting so you know this</font>

117
00:04:11,480 --> 00:04:16,130
is<font color="#CCCCCC"> a pretty extreme example</font><font color="#E5E5E5"> of how excel</font>

118
00:04:13,430 --> 00:04:17,780
export works but you cxl export in quite

119
00:04:16,130 --> 00:04:19,339
a<font color="#CCCCCC"> few different</font><font color="#E5E5E5"> web apps out there so</font>

120
00:04:17,779 --> 00:04:20,988
the principles<font color="#CCCCCC"> I'm talking about apply</font>

121
00:04:19,339 --> 00:04:22,789
you know more generally there's there's

122
00:04:20,988 --> 00:04:24,469
nothing<font color="#E5E5E5"> particular hid that only applies</font>

123
00:04:22,790 --> 00:04:27,380
to this particular condition set of

124
00:04:24,470 --> 00:04:28,700
conditions so let's<font color="#CCCCCC"> imagine a request</font>

125
00:04:27,380 --> 00:04:30,500
simplified request there where you

126
00:04:28,700 --> 00:04:31,969
you're doing<font color="#CCCCCC"> your ex LX sport</font>

127
00:04:30,500 --> 00:04:33,800
and you and you've<font color="#E5E5E5"> got some data that</font>

128
00:04:31,970 --> 00:04:35,930
you've got<font color="#E5E5E5"> control over just a</font>

129
00:04:33,800 --> 00:04:40,520
simplified version here and you what's

130
00:04:35,930 --> 00:04:43,250
returned is a in this case a an XLS file

131
00:04:40,520 --> 00:04:45,320
so<font color="#E5E5E5"> several things to point out there</font>

132
00:04:43,250 --> 00:04:47,870
obviously the first point critical risk

133
00:04:45,320 --> 00:04:48,830
is the misspelling of output so

134
00:04:47,870 --> 00:04:53,230
obviously that goes straight<font color="#CCCCCC"> in the</font>

135
00:04:48,830 --> 00:04:55,609
report then you've got HTTP this is it

136
00:04:53,230 --> 00:04:57,800
HTTP as well is an internal<font color="#E5E5E5"> app but</font>

137
00:04:55,610 --> 00:04:59,990
obviously you're gonna raise it the

138
00:04:57,800 --> 00:05:01,100
content type was wrong as well so

139
00:04:59,990 --> 00:05:02,000
there's the potential there you might

140
00:05:01,100 --> 00:05:03,950
think for some cross-site scripting

141
00:05:02,000 --> 00:05:05,990
because if<font color="#CCCCCC"> your hello world is in fact</font>

142
00:05:03,950 --> 00:05:06,919
you know script alert and all that you

143
00:05:05,990 --> 00:05:08,000
might<font color="#E5E5E5"> be able to do something there</font>

144
00:05:06,919 --> 00:05:09,740
unfortunately because of the

145
00:05:08,000 --> 00:05:11,780
content-disposition header that's going

146
00:05:09,740 --> 00:05:12,980
<font color="#E5E5E5">to force it to be a download and so</font>

147
00:05:11,780 --> 00:05:16,400
actually practically speaking that

148
00:05:12,980 --> 00:05:20,570
doesn't really<font color="#E5E5E5"> work and cache control as</font>

149
00:05:16,400 --> 00:05:21,830
well often I find in web apps that where

150
00:05:20,570 --> 00:05:24,950
you the caching control headers are

151
00:05:21,830 --> 00:05:26,450
generally pretty good so in other words

152
00:05:24,950 --> 00:05:29,360
you know it's not being stored by the

153
00:05:26,450 --> 00:05:31,880
browser downloads can can can fall foul

154
00:05:29,360 --> 00:05:32,960
of bad caching headers so pay particular

155
00:05:31,880 --> 00:05:34,190
attention to that if you're looking<font color="#E5E5E5"> at</font>

156
00:05:32,960 --> 00:05:35,510
web apps and everything<font color="#E5E5E5"> kind of looks</font>

157
00:05:34,190 --> 00:05:37,160
<font color="#E5E5E5">all</font><font color="#CCCCCC"> right my caching point of view if</font>

158
00:05:35,510 --> 00:05:38,539
<font color="#E5E5E5">there's file download have a closer look</font>

159
00:05:37,160 --> 00:05:41,270
at that because<font color="#E5E5E5"> that's often done</font>

160
00:05:38,540 --> 00:05:44,419
incorrectly so attack scenarios then in

161
00:05:41,270 --> 00:05:46,070
this particular case you can spoof data

162
00:05:44,419 --> 00:05:48,620
you can basically produce an arbitrary

163
00:05:46,070 --> 00:05:50,180
excel file so this<font color="#E5E5E5"> is just a for</font>

164
00:05:48,620 --> 00:05:52,010
interest really<font color="#E5E5E5"> you know you could</font>

165
00:05:50,180 --> 00:05:53,870
basically force an excel file on someone

166
00:05:52,010 --> 00:05:55,159
that contain data of your<font color="#E5E5E5"> choosing so</font>

167
00:05:53,870 --> 00:05:57,590
you could deceive them into thinking

168
00:05:55,160 --> 00:05:58,940
that you know some sales report was you

169
00:05:57,590 --> 00:06:01,310
know some sales period was better than

170
00:05:58,940 --> 00:06:03,469
<font color="#E5E5E5">actually was just there for information</font>

171
00:06:01,310 --> 00:06:05,570
in<font color="#E5E5E5"> this particular case</font><font color="#CCCCCC"> you could have a</font>

172
00:06:03,470 --> 00:06:06,860
go exploiting Excel vulnerabilities as

173
00:06:05,570 --> 00:06:08,690
well which I'll come to in a second<font color="#E5E5E5"> the</font>

174
00:06:06,860 --> 00:06:11,330
main thrust of this talk is about OS

175
00:06:08,690 --> 00:06:14,540
command execution so what I mean<font color="#CCCCCC"> by</font>

176
00:06:11,330 --> 00:06:16,430
<font color="#E5E5E5">exploiting Excel vulnerabilities so what</font>

177
00:06:14,540 --> 00:06:18,500
I<font color="#E5E5E5"> did here is</font><font color="#CCCCCC"> just send a request which</font>

178
00:06:16,430 --> 00:06:22,040
contained every single value single byte

179
00:06:18,500 --> 00:06:23,840
value or 256 possible values up to the

180
00:06:22,040 --> 00:06:27,800
sower to see what would<font color="#E5E5E5"> happen and back</font>

181
00:06:23,840 --> 00:06:29,359
pain 255 of them so essentially you know

182
00:06:27,800 --> 00:06:31,700
that means that you could craft an excel

183
00:06:29,360 --> 00:06:33,320
file that can contain binary content and

184
00:06:31,700 --> 00:06:35,810
so potentially you know you could

185
00:06:33,320 --> 00:06:38,570
exploit a problem with someone's Excel

186
00:06:35,810 --> 00:06:40,940
out of day Excel instance and and and

187
00:06:38,570 --> 00:06:42,950
you<font color="#E5E5E5"> know get</font><font color="#CCCCCC"> up to mischief there so it</font>

188
00:06:40,940 --> 00:06:44,330
was just<font color="#E5E5E5"> there for interest turns out is</font>

189
00:06:42,950 --> 00:06:46,069
<font color="#E5E5E5">much easier to get come on</font>

190
00:06:44,330 --> 00:06:48,650
execution on the victim anyway because

191
00:06:46,069 --> 00:06:50,449
of something called dde dynamic data

192
00:06:48,650 --> 00:06:53,270
exchange so this is an old Microsoft

193
00:06:50,449 --> 00:06:56,389
Technology and allows applications to

194
00:06:53,270 --> 00:06:59,750
talk to<font color="#E5E5E5"> each other security risk to this</font>

195
00:06:56,389 --> 00:07:03,469
were published in 2014 couple years ago

196
00:06:59,750 --> 00:07:06,349
by<font color="#CCCCCC"> Albion a wax James kettle who I don't</font>

197
00:07:03,469 --> 00:07:09,199
visit James you here or maybe he's

198
00:07:06,349 --> 00:07:11,030
hiding but so this this<font color="#CCCCCC"> particular</font>

199
00:07:09,199 --> 00:07:13,639
aspect of it is<font color="#E5E5E5"> not particularly it is</font>

200
00:07:11,030 --> 00:07:16,008
not novel so let's consider a different

201
00:07:13,639 --> 00:07:17,449
example with our excel export here where

202
00:07:16,009 --> 00:07:21,409
instead<font color="#E5E5E5"> of hello world we've got this</font>

203
00:07:17,449 --> 00:07:25,819
this field here which decodes 2 equals

204
00:07:21,409 --> 00:07:27,919
CMD pipe for<font color="#CCCCCC"> Sasuke ipconfig bang and</font>

205
00:07:25,819 --> 00:07:32,150
then<font color="#CCCCCC"> cell reference and you often see</font>

206
00:07:27,919 --> 00:07:33,530
this cell reference in in on<font color="#E5E5E5"> web web</font>

207
00:07:32,150 --> 00:07:35,359
pages that<font color="#CCCCCC"> are discussing this problem</font>

208
00:07:33,530 --> 00:07:37,190
in fact it's relevant if that could be

209
00:07:35,360 --> 00:07:40,430
fubar it doesn't it doesn't really

210
00:07:37,190 --> 00:07:42,050
matter in a particular context so the

211
00:07:40,430 --> 00:07:45,889
breakdown of that is that you've<font color="#CCCCCC"> got a</font>

212
00:07:42,050 --> 00:07:47,360
<font color="#CCCCCC">service or a program a topic and</font><font color="#E5E5E5"> what's</font>

213
00:07:45,889 --> 00:07:50,599
called an item now these are sort dde

214
00:07:47,360 --> 00:07:52,520
specific terms<font color="#CCCCCC"> to the</font><font color="#E5E5E5"> point about dde is</font>

215
00:07:50,599 --> 00:07:54,259
that you can basically send a message

216
00:07:52,520 --> 00:07:55,969
it's a basically a messaging system that

217
00:07:54,259 --> 00:07:57,169
the app that<font color="#CCCCCC"> the operating system</font>

218
00:07:55,969 --> 00:07:59,029
handles for you so you've got<font color="#E5E5E5"> one</font>

219
00:07:57,169 --> 00:08:00,500
<font color="#CCCCCC">application here one application there</font>

220
00:07:59,029 --> 00:08:01,940
they<font color="#E5E5E5"> can talk to each other using this</font>

221
00:08:00,500 --> 00:08:03,650
messaging system so if you<font color="#E5E5E5"> like there's</font>

222
00:08:01,940 --> 00:08:07,819
a kind of<font color="#CCCCCC"> API between them and there's</font>

223
00:08:03,650 --> 00:08:10,549
what these topics are so when in terms

224
00:08:07,819 --> 00:08:13,729
of<font color="#E5E5E5"> Excel what that is doing is trying to</font>

225
00:08:10,550 --> 00:08:15,139
locate a DD service called CMD with that

226
00:08:13,729 --> 00:08:18,080
particular topic and that particular

227
00:08:15,139 --> 00:08:19,969
item<font color="#E5E5E5"> but that DD fails because there is</font>

228
00:08:18,080 --> 00:08:22,159
no such thing and<font color="#E5E5E5"> so what Excel does is</font>

229
00:08:19,969 --> 00:08:23,750
try and<font color="#E5E5E5"> run that command for you so</font>

230
00:08:22,159 --> 00:08:25,819
<font color="#CCCCCC">we'll look</font><font color="#E5E5E5"> at look at that in more</font>

231
00:08:23,750 --> 00:08:27,919
detail so the warnings that you that you

232
00:08:25,819 --> 00:08:30,020
get when you download what an<font color="#CCCCCC"> Excel</font>

233
00:08:27,919 --> 00:08:31,758
spreadsheet that has this equals CMD

234
00:08:30,020 --> 00:08:34,640
this kind of DD payload they're not

235
00:08:31,759 --> 00:08:36,320
<font color="#CCCCCC">Excel is not not stupid in</font><font color="#E5E5E5"> that regard</font>

236
00:08:34,640 --> 00:08:39,380
it knows<font color="#CCCCCC"> that something is up in</font><font color="#E5E5E5"> this</font>

237
00:08:36,320 --> 00:08:41,719
particular case I<font color="#E5E5E5"> are actual got a</font>

238
00:08:39,380 --> 00:08:44,149
format warning because this was an XLS

239
00:08:41,719 --> 00:08:45,410
file and I had complete control of the

240
00:08:44,149 --> 00:08:48,949
<font color="#E5E5E5">whole spreadsheet so I was returning</font>

241
00:08:45,410 --> 00:08:50,269
like a CSV format inside a dot XLS so

242
00:08:48,949 --> 00:08:51,859
exhale<font color="#E5E5E5"> was actually first of all</font>

243
00:08:50,269 --> 00:08:53,480
complained about the fact that there was

244
00:08:51,860 --> 00:08:55,699
<font color="#E5E5E5">a different file format now if you get</font>

245
00:08:53,480 --> 00:08:57,540
through that warning you get another

246
00:08:55,699 --> 00:09:00,389
security notice about links these

247
00:08:57,540 --> 00:09:02,250
that link is relating to the to the to

248
00:09:00,389 --> 00:09:04,199
<font color="#E5E5E5">the dde call saying you know what do you</font>

249
00:09:02,250 --> 00:09:06,570
want me to do<font color="#CCCCCC"> with that and then finally</font>

250
00:09:04,199 --> 00:09:07,920
<font color="#CCCCCC">you get the remote data is</font><font color="#E5E5E5"> not</font>

251
00:09:06,570 --> 00:09:09,959
accessible now<font color="#E5E5E5"> I know if you've ever</font>

252
00:09:07,920 --> 00:09:11,790
thought about these what these actually

253
00:09:09,959 --> 00:09:13,109
mean if you if you if you you've got to

254
00:09:11,790 --> 00:09:15,389
go doing this kind of exploitation

255
00:09:13,110 --> 00:09:18,389
yourself so<font color="#E5E5E5"> Excel is complaining there</font>

256
00:09:15,389 --> 00:09:21,930
because the DD Inc dde link call fails

257
00:09:18,389 --> 00:09:24,690
there is no you know CMD service<font color="#CCCCCC"> that's</font>

258
00:09:21,930 --> 00:09:26,670
that's running so it says can't get the

259
00:09:24,690 --> 00:09:28,440
data what best I can do is just run this

260
00:09:26,670 --> 00:09:30,300
thing you know what that's that what do

261
00:09:28,440 --> 00:09:31,380
you<font color="#E5E5E5"> me to do so again there's a there's</font>

262
00:09:30,300 --> 00:09:32,430
another warning and<font color="#E5E5E5"> these are the</font>

263
00:09:31,380 --> 00:09:34,230
warnings that we're<font color="#E5E5E5"> going to get look at</font>

264
00:09:32,430 --> 00:09:35,939
the end of the presentation and see

265
00:09:34,230 --> 00:09:39,690
where they come from and see if we can

266
00:09:35,940 --> 00:09:42,180
sort of cut them down so one advantage

267
00:09:39,690 --> 00:09:44,790
for our attacker is that the the<font color="#E5E5E5"> user is</font>

268
00:09:42,180 --> 00:09:46,469
downloading it for themselves so<font color="#CCCCCC"> it you</font>

269
00:09:44,790 --> 00:09:47,969
kind of already you know<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> like a</font>

270
00:09:46,470 --> 00:09:49,920
stored payload you know so you've

271
00:09:47,970 --> 00:09:51,810
managed to upload some malicious data to

272
00:09:49,920 --> 00:09:54,660
this web application you know the name

273
00:09:51,810 --> 00:09:56,250
<font color="#CCCCCC">of a of an employee</font><font color="#E5E5E5"> or something like</font>

274
00:09:54,660 --> 00:09:58,829
that and then someone a month later

275
00:09:56,250 --> 00:10:00,690
downloads and excel export of that so

276
00:09:58,829 --> 00:10:02,130
they're doing<font color="#CCCCCC"> it voluntarily you know</font>

277
00:10:00,690 --> 00:10:03,420
you've got<font color="#E5E5E5"> that to your advantage you</font>

278
00:10:02,130 --> 00:10:04,920
know that that person<font color="#CCCCCC"> has requested that</font>

279
00:10:03,420 --> 00:10:06,329
data themselves has not been pushed on

280
00:10:04,920 --> 00:10:10,380
them that's the<font color="#E5E5E5"> beauty of stored</font>

281
00:10:06,329 --> 00:10:12,870
payloads you know like<font color="#E5E5E5"> XSS so the</font>

282
00:10:10,380 --> 00:10:16,620
command execution so there it is there's

283
00:10:12,870 --> 00:10:18,930
the cell equals CMD /k ipconfig and you

284
00:10:16,620 --> 00:10:21,620
just obviously the /k just persist the

285
00:10:18,930 --> 00:10:23,550
command window just for this screenshot

286
00:10:21,620 --> 00:10:25,889
otherwise it actually runs quite nicely

287
00:10:23,550 --> 00:10:27,899
if you have /c in there so it<font color="#E5E5E5"> just runs</font>

288
00:10:25,889 --> 00:10:29,670
the command an exit it runs at a very

289
00:10:27,899 --> 00:10:33,449
minimized way can't you wouldn't even

290
00:10:29,670 --> 00:10:35,550
<font color="#CCCCCC">noticed it which is quite nice so this</font>

291
00:10:33,449 --> 00:10:37,469
is<font color="#CCCCCC"> like the equivalent of an alert one</font>

292
00:10:35,550 --> 00:10:39,510
in XSS you know let's see if we can do

293
00:10:37,470 --> 00:10:41,490
something better with that so<font color="#E5E5E5"> because I</font>

294
00:10:39,510 --> 00:10:43,050
was on the inside I thought<font color="#E5E5E5"> it</font><font color="#CCCCCC"> might be</font>

295
00:10:41,490 --> 00:10:47,790
quite interesting<font color="#CCCCCC"> to examine some like</font>

296
00:10:43,050 --> 00:10:49,500
some SMB style abuses so one thing<font color="#CCCCCC"> is</font>

297
00:10:47,790 --> 00:10:51,510
that<font color="#E5E5E5"> I could run an arbite recommand by</font>

298
00:10:49,500 --> 00:10:52,649
on a network share and of course<font color="#E5E5E5"> that</font>

299
00:10:51,510 --> 00:10:55,529
networks share is sitting<font color="#E5E5E5"> on the</font>

300
00:10:52,649 --> 00:10:57,540
attackers machine and the one I decided

301
00:10:55,529 --> 00:10:59,430
to<font color="#E5E5E5"> have a lookout just because a bit</font>

302
00:10:57,540 --> 00:11:00,810
more challenging was to to grab domain

303
00:10:59,430 --> 00:11:03,569
user credentials you can imagine that

304
00:11:00,810 --> 00:11:05,489
everyone who exports this particular set

305
00:11:03,569 --> 00:11:07,290
of malicious data you know is having

306
00:11:05,490 --> 00:11:09,600
their domain credentials swiped and by

307
00:11:07,290 --> 00:11:11,099
voice wiped I mean you're collecting the

308
00:11:09,600 --> 00:11:13,410
ntlm v2 hash

309
00:11:11,100 --> 00:11:15,600
which is part of the process of

310
00:11:13,410 --> 00:11:18,120
connecting<font color="#E5E5E5"> to a network share so</font>

311
00:11:15,600 --> 00:11:19,860
obviously an ISP you know would block or

312
00:11:18,120 --> 00:11:23,520
should block these kind of ports from

313
00:11:19,860 --> 00:11:25,080
going out this was a next to the to<font color="#CCCCCC"> the</font>

314
00:11:23,520 --> 00:11:26,250
public at large you know that kind<font color="#E5E5E5"> of</font>

315
00:11:25,080 --> 00:11:28,350
thing you<font color="#CCCCCC"> know</font><font color="#E5E5E5"> shouldn't really work but</font>

316
00:11:26,250 --> 00:11:29,820
right<font color="#E5E5E5"> I was on the inside remember so</font>

317
00:11:28,350 --> 00:11:31,080
that's what I had had a go at now

318
00:11:29,820 --> 00:11:32,670
normally<font color="#CCCCCC"> you know you might fire up</font>

319
00:11:31,080 --> 00:11:33,840
something like responder or<font color="#CCCCCC"> metasploit</font>

320
00:11:32,670 --> 00:11:35,550
and it would sort<font color="#E5E5E5"> of deal with it's</font>

321
00:11:33,840 --> 00:11:37,470
magically and you know it would be great

322
00:11:35,550 --> 00:11:40,109
<font color="#E5E5E5">but I didn't</font><font color="#CCCCCC"> have a pen test laptop I</font>

323
00:11:37,470 --> 00:11:41,670
only had a domain user account but and

324
00:11:40,110 --> 00:11:43,620
<font color="#CCCCCC">this is this doesn't normally happen on</font>

325
00:11:41,670 --> 00:11:45,300
pen test when things go your way there

326
00:11:43,620 --> 00:11:49,920
was<font color="#CCCCCC"> another corporate work station which</font>

327
00:11:45,300 --> 00:11:51,569
had why shark on it and so I was<font color="#E5E5E5"> able to</font>

328
00:11:49,920 --> 00:11:55,079
solve that then became my attacker

329
00:11:51,570 --> 00:11:57,510
machine so had why shark running and

330
00:11:55,080 --> 00:11:59,700
that became the attacker machine so the

331
00:11:57,510 --> 00:12:02,189
victim connected to that and why shot

332
00:11:59,700 --> 00:12:04,260
obviously sniffed the SMB you know style

333
00:12:02,190 --> 00:12:06,600
connection so straight away you get the

334
00:12:04,260 --> 00:12:08,250
domain and<font color="#E5E5E5"> username for free that why</font>

335
00:12:06,600 --> 00:12:10,590
sharks pulled out so let's have a look

336
00:12:08,250 --> 00:12:12,420
<font color="#CCCCCC">at some of these well we'll have</font><font color="#E5E5E5"> a look</font>

337
00:12:10,590 --> 00:12:16,050
at some of those<font color="#CCCCCC"> messages later and and</font>

338
00:12:12,420 --> 00:12:19,110
what they contain so I had I had my wire

339
00:12:16,050 --> 00:12:20,640
capture of an NT<font color="#CCCCCC"> lmv</font><font color="#E5E5E5"> to exchange and I</font>

340
00:12:19,110 --> 00:12:23,190
needed<font color="#E5E5E5"> to</font><font color="#CCCCCC"> know what I need to pull</font><font color="#E5E5E5"> out</font>

341
00:12:20,640 --> 00:12:25,620
in order<font color="#E5E5E5"> to to crack it with you know</font>

342
00:12:23,190 --> 00:12:27,990
<font color="#E5E5E5">with John or hash count or whatever now</font>

343
00:12:25,620 --> 00:12:30,120
because I knew the password in this case

344
00:12:27,990 --> 00:12:31,170
because<font color="#CCCCCC"> I was the victim and I was</font><font color="#E5E5E5"> just</font>

345
00:12:30,120 --> 00:12:33,170
trying<font color="#E5E5E5"> to do this for a proof of concept</font>

346
00:12:31,170 --> 00:12:35,910
I didn't need any sort of heavyweight

347
00:12:33,170 --> 00:12:37,500
cracking going on I<font color="#CCCCCC"> just chose John just</font>

348
00:12:35,910 --> 00:12:39,689
randomly you know there<font color="#E5E5E5"> was there was no</font>

349
00:12:37,500 --> 00:12:42,090
real reason to sort of send this to a

350
00:12:39,690 --> 00:12:44,940
GPU rig because I knew the password so<font color="#E5E5E5"> I</font>

351
00:12:42,090 --> 00:12:47,550
just went to Pentos monkey and looked at

352
00:12:44,940 --> 00:12:49,590
the hash cap sorry the John format so

353
00:12:47,550 --> 00:12:51,420
there<font color="#E5E5E5"> is at the bottom if</font><font color="#CCCCCC"> you can't read</font>

354
00:12:49,590 --> 00:12:53,460
the screenshot so you've got your

355
00:12:51,420 --> 00:12:55,709
username the colon and a set of dollar

356
00:12:53,460 --> 00:12:57,600
delimited fields so everything in red is

357
00:12:55,710 --> 00:12:59,220
an unknown at this moment and what's in

358
00:12:57,600 --> 00:13:02,670
green is unknown and that is just<font color="#E5E5E5"> a</font>

359
00:12:59,220 --> 00:13:04,320
constant net<font color="#CCCCCC"> until mv2 so I already</font><font color="#E5E5E5"> know</font>

360
00:13:02,670 --> 00:13:08,790
from Wireshark just looking at the high

361
00:13:04,320 --> 00:13:11,130
level packet capture what the username

362
00:13:08,790 --> 00:13:13,410
and and domain is so<font color="#E5E5E5"> I can pop that in</font>

363
00:13:11,130 --> 00:13:15,600
<font color="#E5E5E5">straight away just call it domain</font>

364
00:13:13,410 --> 00:13:16,800
doesn't matter so I've now that half of

365
00:13:15,600 --> 00:13:19,560
what I need what about the other half

366
00:13:16,800 --> 00:13:21,359
what is this challenge h<font color="#E5E5E5"> mac md5 and</font>

367
00:13:19,560 --> 00:13:22,650
blob and this is not so<font color="#E5E5E5"> many not</font>

368
00:13:21,360 --> 00:13:24,019
normally<font color="#E5E5E5"> something you need to look at</font>

369
00:13:22,650 --> 00:13:25,429
because<font color="#E5E5E5"> you know respond</font>

370
00:13:24,019 --> 00:13:28,519
or whatever<font color="#E5E5E5"> it is doing it for</font><font color="#CCCCCC"> you but</font><font color="#E5E5E5"> I</font>

371
00:13:25,429 --> 00:13:30,589
had to sort of go in deep dive here so

372
00:13:28,519 --> 00:13:34,069
what<font color="#CCCCCC"> is this ntlm business about well</font>

373
00:13:30,589 --> 00:13:35,769
<font color="#E5E5E5">it's</font><font color="#CCCCCC"> challenge-response the first the</font>

374
00:13:34,069 --> 00:13:38,389
first<font color="#E5E5E5"> sort of command is like a</font>

375
00:13:35,769 --> 00:13:39,499
negotiation it's a bit<font color="#E5E5E5"> like sort of</font><font color="#CCCCCC"> SSL</font>

376
00:13:38,389 --> 00:13:41,989
where you're just<font color="#E5E5E5"> sort of sending up</font>

377
00:13:39,499 --> 00:13:44,779
some some parameters you then get<font color="#E5E5E5"> a</font>

378
00:13:41,989 --> 00:13:46,309
challenge come back from the server as

379
00:13:44,779 --> 00:13:47,509
well<font color="#CCCCCC"> as an agreement of what parameters</font>

380
00:13:46,309 --> 00:13:49,850
going to be used<font color="#E5E5E5"> for the chat and then</font>

381
00:13:47,509 --> 00:13:51,589
<font color="#CCCCCC">the obviously the last bit is the</font>

382
00:13:49,850 --> 00:13:54,649
response and it's the response which

383
00:13:51,589 --> 00:13:56,089
contains some<font color="#E5E5E5"> maths which includes some</font>

384
00:13:54,649 --> 00:13:57,679
calculation involving the password and

385
00:13:56,089 --> 00:13:59,749
it's that<font color="#E5E5E5"> that you're you know that</font>

386
00:13:57,679 --> 00:14:02,420
you're at thats what you're attacking so

387
00:13:59,749 --> 00:14:04,489
ntlm vs NC lmv to just you know out

388
00:14:02,420 --> 00:14:06,769
<font color="#E5E5E5">background in so ntlm is using</font><font color="#CCCCCC"> md4</font>

389
00:14:04,489 --> 00:14:08,540
algorithm and dares and<font color="#E5E5E5"> that sort of</font>

390
00:14:06,769 --> 00:14:09,589
that's<font color="#E5E5E5"> known to</font><font color="#CCCCCC"> be weak because of null</font>

391
00:14:08,540 --> 00:14:11,509
<font color="#CCCCCC">fights and that's probably</font><font color="#E5E5E5"> something</font>

392
00:14:09,589 --> 00:14:13,879
you've seen before you can look up but

393
00:14:11,509 --> 00:14:16,309
we're in ntlm v2 land and that<font color="#E5E5E5"> uses h</font>

394
00:14:13,879 --> 00:14:17,600
<font color="#E5E5E5">mac md5 and this which is a little bit</font>

395
00:14:16,309 --> 00:14:20,679
stronger and there's a lot more that

396
00:14:17,600 --> 00:14:22,730
goes into the computation of the hash

397
00:14:20,679 --> 00:14:24,139
there's it's more than just<font color="#CCCCCC"> the password</font>

398
00:14:22,730 --> 00:14:26,629
in<font color="#CCCCCC"> the challenge there's all sorts of</font>

399
00:14:24,139 --> 00:14:31,029
timestamps and and and that's known

400
00:14:26,629 --> 00:14:33,290
technically<font color="#CCCCCC"> speaking as the blob so</font>

401
00:14:31,029 --> 00:14:34,369
let's see where those actually are in

402
00:14:33,290 --> 00:14:35,839
why sure this is<font color="#E5E5E5"> what I actually have to</font>

403
00:14:34,369 --> 00:14:36,949
do you know go into<font color="#CCCCCC"> that that go into</font>

404
00:14:35,839 --> 00:14:41,110
that capture file and pull these things

405
00:14:36,949 --> 00:14:43,008
out manually so to get to<font color="#E5E5E5"> the focus of</font>

406
00:14:41,110 --> 00:14:44,869
if you've ever looked<font color="#E5E5E5"> at an SMB</font>

407
00:14:43,009 --> 00:14:46,129
exchanging<font color="#E5E5E5"> y shot it's just horrible I</font>

408
00:14:44,869 --> 00:14:47,629
mean it's<font color="#CCCCCC"> just as just packets and</font>

409
00:14:46,129 --> 00:14:48,860
packets of packets so you can quickly

410
00:14:47,629 --> 00:14:52,519
get to<font color="#E5E5E5"> where you need to go with this</font>

411
00:14:48,860 --> 00:14:54,019
ntlm SSP Wireshark filter so this<font color="#E5E5E5"> is the</font>

412
00:14:52,519 --> 00:14:55,699
type 1 message and there's<font color="#CCCCCC"> actually</font>

413
00:14:54,019 --> 00:14:57,589
nothing really of interest in terms of

414
00:14:55,699 --> 00:14:59,059
cracking hashes what it does a leak is

415
00:14:57,589 --> 00:15:01,220
information about the client that's

416
00:14:59,059 --> 00:15:02,420
telling you that it's windows 7 telling

417
00:15:01,220 --> 00:15:04,249
you tell you the client machine your

418
00:15:02,420 --> 00:15:07,639
victim machine is a<font color="#E5E5E5"> Windows 7 machine</font>

419
00:15:04,249 --> 00:15:09,350
other than that not that<font color="#E5E5E5"> useful so the</font>

420
00:15:07,639 --> 00:15:10,490
type to message it's a response from the

421
00:15:09,350 --> 00:15:12,499
server that's the thing<font color="#CCCCCC"> that contains</font>

422
00:15:10,490 --> 00:15:15,290
the challenge and so<font color="#E5E5E5"> that and there it</font>

423
00:15:12,499 --> 00:15:16,939
is so ntlm server challenge that's our

424
00:15:15,290 --> 00:15:19,490
challenge that's that one of our<font color="#E5E5E5"> fields</font>

425
00:15:16,939 --> 00:15:21,199
filled in lil there's also some clues

426
00:15:19,490 --> 00:15:23,139
there that we're talking about ntlm v2

427
00:15:21,199 --> 00:15:28,368
because of some<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the other things</font><font color="#CCCCCC"> that</font>

428
00:15:23,139 --> 00:15:29,989
are in<font color="#E5E5E5"> this in this packet so there we</font>

429
00:15:28,369 --> 00:15:32,839
are so we've got our challenge that's

430
00:15:29,989 --> 00:15:33,980
that's from the second packet and you

431
00:15:32,839 --> 00:15:37,459
can just quickly get that out of wire

432
00:15:33,980 --> 00:15:39,619
shark with with a few right clicks

433
00:15:37,459 --> 00:15:41,268
so what about this<font color="#E5E5E5"> H map md5 and the</font>

434
00:15:39,619 --> 00:15:44,480
blob what unsurprisingly there in this

435
00:15:41,269 --> 00:15:46,519
third message so there's some more clues

436
00:15:44,480 --> 00:15:49,069
that we're<font color="#CCCCCC"> looking at ncl</font><font color="#E5E5E5"> MV to hear</font>

437
00:15:46,519 --> 00:15:50,749
because<font color="#E5E5E5"> there's like a client challenge</font>

438
00:15:49,069 --> 00:15:52,579
which is unique to n zealand v to

439
00:15:50,749 --> 00:15:54,139
remember the show that the challenge

440
00:15:52,579 --> 00:15:56,269
<font color="#CCCCCC">that we're after is</font><font color="#E5E5E5"> a server challenge</font>

441
00:15:54,139 --> 00:15:58,009
this is a client<font color="#E5E5E5"> challenge of no use</font>

442
00:15:56,269 --> 00:16:00,889
here but it just allows that two-way

443
00:15:58,009 --> 00:16:03,860
process we can spot here that all the LM

444
00:16:00,889 --> 00:16:05,449
style hashes are blanked out because you

445
00:16:03,860 --> 00:16:08,179
know<font color="#CCCCCC"> sources windows 7 machine there's</font>

446
00:16:05,449 --> 00:16:11,540
<font color="#E5E5E5">no LM business going on there's the</font>

447
00:16:08,179 --> 00:16:13,999
domain<font color="#E5E5E5"> and the and the username so which</font>

448
00:16:11,540 --> 00:16:15,920
is what why shark pulled out of<font color="#CCCCCC"> that</font>

449
00:16:13,999 --> 00:16:19,369
height with that<font color="#E5E5E5"> high level summary so</font>

450
00:16:15,920 --> 00:16:22,009
we've got this is our type 3 message

451
00:16:19,369 --> 00:16:25,249
when we break open this section here the

452
00:16:22,009 --> 00:16:27,889
ntlm response why shop nicely tells us

453
00:16:25,249 --> 00:16:31,009
that it is ncl<font color="#E5E5E5"> mv2 and inside there is</font>

454
00:16:27,889 --> 00:16:33,379
our hash the<font color="#CCCCCC"> h make md5 and everything</font>

455
00:16:31,009 --> 00:16:35,779
after the hash assuming you can see this

456
00:16:33,379 --> 00:16:37,790
mouse gets everything after the hash is

457
00:16:35,779 --> 00:16:41,269
what's affectionately referred to as the

458
00:16:37,790 --> 00:16:45,469
<font color="#CCCCCC">bob so so it's easy</font><font color="#E5E5E5"> to pull this out</font>

459
00:16:41,269 --> 00:16:47,089
from from wire shop so you know that

460
00:16:45,470 --> 00:16:48,319
you're doing<font color="#E5E5E5"> this correctly if you ever</font>

461
00:16:47,089 --> 00:16:53,540
have to do this manually because it

462
00:16:48,319 --> 00:16:54,889
starts 0 1 0 1 0 0 0 so so there we are

463
00:16:53,540 --> 00:16:57,019
so we've managed<font color="#CCCCCC"> to pull this out</font>

464
00:16:54,889 --> 00:16:58,939
without responded without my supply just

465
00:16:57,019 --> 00:17:00,799
<font color="#E5E5E5">by a bit of sniffing now we have</font>

466
00:16:58,939 --> 00:17:04,908
everything we need so let's pop it into

467
00:17:00,799 --> 00:17:06,619
into John and didn't crack<font color="#E5E5E5"> and now</font>

468
00:17:04,909 --> 00:17:09,220
remember I knew the password so it

469
00:17:06,619 --> 00:17:13,428
should have cracked pop it into hash cat

470
00:17:09,220 --> 00:17:16,819
didn't crack recovered 0 of 1 yeah<font color="#E5E5E5"> okay</font>

471
00:17:13,429 --> 00:17:18,350
so<font color="#CCCCCC"> remember like this is on site and you</font>

472
00:17:16,819 --> 00:17:19,849
know there<font color="#E5E5E5"> was time pressure to be there</font>

473
00:17:18,349 --> 00:17:20,928
and<font color="#E5E5E5"> I had an awful feeling that was</font>

474
00:17:19,849 --> 00:17:22,010
going to be one of<font color="#E5E5E5"> those reports that</font>

475
00:17:20,929 --> 00:17:24,319
may have had the phrase<font color="#CCCCCC"> and attack it</font>

476
00:17:22,010 --> 00:17:25,970
with more time and resources now if

477
00:17:24,319 --> 00:17:27,379
you're a consumer of pen test reports

478
00:17:25,970 --> 00:17:28,700
rather than the generator of them if you

479
00:17:27,380 --> 00:17:30,559
ever see<font color="#CCCCCC"> the expression and</font><font color="#E5E5E5"> attacker</font>

480
00:17:28,700 --> 00:17:32,059
with more time and resources<font color="#E5E5E5"> that means</font>

481
00:17:30,559 --> 00:17:35,178
the tester was not late enough<font color="#E5E5E5"> to do the</font>

482
00:17:32,059 --> 00:17:36,590
job<font color="#CCCCCC"> and there are those key phrases in</font>

483
00:17:35,179 --> 00:17:38,059
pen test reports as well if you want<font color="#CCCCCC"> to</font>

484
00:17:36,590 --> 00:17:41,629
<font color="#CCCCCC">know what they mean then you can talk to</font>

485
00:17:38,059 --> 00:17:42,830
<font color="#E5E5E5">me afterwards but obviously</font><font color="#CCCCCC"> we didn't</font>

486
00:17:41,630 --> 00:17:44,480
want that to be<font color="#CCCCCC"> the case you know</font><font color="#E5E5E5"> what</font>

487
00:17:42,830 --> 00:17:45,620
was going on here<font color="#E5E5E5"> oh one thing to my</font>

488
00:17:44,480 --> 00:17:47,179
advantage is that obviously<font color="#CCCCCC"> I didn't</font>

489
00:17:45,620 --> 00:17:48,479
<font color="#E5E5E5">need to be on site to do this i was now</font>

490
00:17:47,179 --> 00:17:50,100
cracking it i had my hash

491
00:17:48,480 --> 00:17:51,570
had everything<font color="#E5E5E5"> I needed so actually do</font>

492
00:17:50,100 --> 00:17:53,280
some of the reporting time during the

493
00:17:51,570 --> 00:17:56,220
reporting day I had a bit<font color="#E5E5E5"> more</font><font color="#CCCCCC"> of a poke</font>

494
00:17:53,280 --> 00:17:57,629
at this and managed to get it working so

495
00:17:56,220 --> 00:17:59,370
the key thing that I pulled out from

496
00:17:57,630 --> 00:18:01,260
from that was a was an error if I

497
00:17:59,370 --> 00:18:02,820
actually go back a slide you can see the

498
00:18:01,260 --> 00:18:04,580
hash cat is actually complaining about

499
00:18:02,820 --> 00:18:06,870
something not obviously it's not saying

500
00:18:04,580 --> 00:18:08,549
error or something like that it<font color="#E5E5E5"> seems to</font>

501
00:18:06,870 --> 00:18:11,010
<font color="#E5E5E5">be having a go but it says skipping line</font>

502
00:18:08,549 --> 00:18:12,179
that which doesn't<font color="#E5E5E5"> sound very good why</font>

503
00:18:11,010 --> 00:18:16,320
is it<font color="#E5E5E5"> skipping a line and that is</font>

504
00:18:12,179 --> 00:18:18,870
<font color="#E5E5E5">actually a fraction of my of my hash so</font>

505
00:18:16,320 --> 00:18:20,730
I just tried different combinations on

506
00:18:18,870 --> 00:18:23,070
the hash cap website there is some there

507
00:18:20,730 --> 00:18:25,110
are some<font color="#E5E5E5"> test hashes I've got a link to</font>

508
00:18:23,070 --> 00:18:27,030
it later which is a nice way of just

509
00:18:25,110 --> 00:18:29,070
doing a sanity check that everything's

510
00:18:27,030 --> 00:18:31,410
working<font color="#CCCCCC"> ok so these are these are hashes</font>

511
00:18:29,070 --> 00:18:33,059
that all the various millions of formats

512
00:18:31,410 --> 00:18:35,040
that you couldn't you that you can that

513
00:18:33,059 --> 00:18:36,990
you<font color="#E5E5E5"> can crack using hash cat so for ntlm</font>

514
00:18:35,040 --> 00:18:39,149
v2 there is a hash for the admin user

515
00:18:36,990 --> 00:18:40,980
and the password is is password or hash

516
00:18:39,150 --> 00:18:42,809
<font color="#CCCCCC">cat</font><font color="#E5E5E5"> or whatever it says on the page so</font>

517
00:18:40,980 --> 00:18:45,360
that's a known so if i<font color="#CCCCCC"> put if</font><font color="#E5E5E5"> i put that</font>

518
00:18:42,809 --> 00:18:47,580
hash into hash cat it worked it said

519
00:18:45,360 --> 00:18:49,469
recovered one of one but it didn't work

520
00:18:47,580 --> 00:18:51,990
<font color="#CCCCCC">for</font><font color="#E5E5E5"> my hash that</font><font color="#CCCCCC"> I knew the password</font><font color="#E5E5E5"> to</font>

521
00:18:49,470 --> 00:18:55,770
so I then<font color="#E5E5E5"> tried the same hash cat test</font>

522
00:18:51,990 --> 00:18:57,929
case with with<font color="#E5E5E5"> John and that didn't</font><font color="#CCCCCC"> work</font>

523
00:18:55,770 --> 00:18:59,639
so<font color="#E5E5E5"> it worked with hash cat but didn't</font>

524
00:18:57,929 --> 00:19:01,470
work with John so this is getting a bit

525
00:18:59,640 --> 00:19:03,570
confusing now so then I threw that<font color="#E5E5E5"> the</font>

526
00:19:01,470 --> 00:19:06,150
hash that<font color="#E5E5E5"> I that I had from the pen test</font>

527
00:19:03,570 --> 00:19:10,350
job and put<font color="#E5E5E5"> that onto our GPU rig that</font>

528
00:19:06,150 --> 00:19:12,690
we have in an NCC and that worked so so

529
00:19:10,350 --> 00:19:14,100
over<font color="#E5E5E5"> here in GPU land that you can</font>

530
00:19:12,690 --> 00:19:17,100
cracked over here on<font color="#E5E5E5"> my machine it</font>

531
00:19:14,100 --> 00:19:19,980
didn't crack and then<font color="#CCCCCC"> eventually I just</font>

532
00:19:17,100 --> 00:19:21,178
tried the the Smith<font color="#E5E5E5"> der the hash there</font>

533
00:19:19,980 --> 00:19:23,790
which is<font color="#E5E5E5"> the one that got from the out</font>

534
00:19:21,179 --> 00:19:25,230
of this job and I tried it with John but

535
00:19:23,790 --> 00:19:26,790
in a different format I tried it in the

536
00:19:25,230 --> 00:19:28,530
<font color="#E5E5E5">hash cat format and then it worked I</font>

537
00:19:26,790 --> 00:19:30,240
thought oh thank god<font color="#E5E5E5"> okay right I've got</font>

538
00:19:28,530 --> 00:19:31,799
my I've got my proof<font color="#E5E5E5"> of concept that</font>

539
00:19:30,240 --> 00:19:34,470
I've managed to<font color="#E5E5E5"> crack the hash that's</font>

540
00:19:31,799 --> 00:19:37,110
that's good enough but why were all

541
00:19:34,470 --> 00:19:38,880
these mixed results let's go through why

542
00:19:37,110 --> 00:19:41,370
what i was getting these gotchas why was

543
00:19:38,880 --> 00:19:47,730
<font color="#E5E5E5">I getting these sort of bugs so it's</font>

544
00:19:41,370 --> 00:19:50,189
time to activate this person here any

545
00:19:47,730 --> 00:19:51,809
idea who that might be probably not who

546
00:19:50,190 --> 00:19:53,730
you expecting<font color="#CCCCCC"> you know presentation</font>

547
00:19:51,809 --> 00:19:55,980
about computer security black and white

548
00:19:53,730 --> 00:19:57,600
<font color="#E5E5E5">photo so this is</font><font color="#CCCCCC"> John Stewart mill and</font>

549
00:19:55,980 --> 00:20:00,030
he's an English philosopher or was an

550
00:19:57,600 --> 00:20:02,320
English philosopher in 1843 he wrote a

551
00:20:00,030 --> 00:20:05,080
<font color="#CCCCCC">book that basically codified</font>

552
00:20:02,320 --> 00:20:06,939
how we do science really<font color="#E5E5E5"> so Hannah how</font>

553
00:20:05,080 --> 00:20:09,279
do we actually find out what causes<font color="#E5E5E5"> an</font>

554
00:20:06,940 --> 00:20:10,600
effect you know cause and effect and

555
00:20:09,279 --> 00:20:11,590
<font color="#E5E5E5">essentially you know you're trying to</font>

556
00:20:10,600 --> 00:20:13,178
control you've got a controlled

557
00:20:11,590 --> 00:20:15,039
environment where you're changing one

558
00:20:13,179 --> 00:20:17,440
thing and you were looking<font color="#E5E5E5"> at</font><font color="#CCCCCC"> the effect</font>

559
00:20:15,039 --> 00:20:19,419
over here and then he classified a

560
00:20:17,440 --> 00:20:20,620
series of methods and it's intuitive to

561
00:20:19,419 --> 00:20:22,210
us but he was the first version sort of

562
00:20:20,620 --> 00:20:24,008
write it down really and they called

563
00:20:22,210 --> 00:20:26,380
<font color="#E5E5E5">Mills methods so what were the</font>

564
00:20:24,009 --> 00:20:28,059
differences in in between you know did

565
00:20:26,380 --> 00:20:29,470
the the hashes that didn't work and<font color="#E5E5E5"> the</font>

566
00:20:28,059 --> 00:20:31,600
hashes that did work what worthy what

567
00:20:29,470 --> 00:20:33,659
were the circumstances<font color="#CCCCCC"> well for</font><font color="#E5E5E5"> John as</font>

568
00:20:31,600 --> 00:20:36,459
in the Ripper not the philosopher and

569
00:20:33,659 --> 00:20:38,379
this is really<font color="#E5E5E5"> easy because as I've</font>

570
00:20:36,460 --> 00:20:41,080
already explained the hash cracked when

571
00:20:38,379 --> 00:20:42,759
the format who was in this style and<font color="#E5E5E5"> the</font>

572
00:20:41,080 --> 00:20:44,379
hash didn't crack when it was in<font color="#E5E5E5"> this</font>

573
00:20:42,759 --> 00:20:47,080
star and this<font color="#E5E5E5"> is the style i got from</font>

574
00:20:44,379 --> 00:20:48,759
from the from<font color="#CCCCCC"> the cheat sheet what was</font>

575
00:20:47,080 --> 00:20:50,470
confusing about<font color="#CCCCCC"> it is that John did see</font>

576
00:20:48,759 --> 00:20:52,629
was it<font color="#E5E5E5"> seemed to be happy with</font><font color="#CCCCCC"> it when</font>

577
00:20:50,470 --> 00:20:55,360
you put this hash here into John it was

578
00:20:52,629 --> 00:20:57,309
saying loaded the hash<font color="#CCCCCC"> its ntlm v2 but</font>

579
00:20:55,360 --> 00:21:01,209
it just didn't handle<font color="#E5E5E5"> it correctly so to</font>

580
00:20:57,309 --> 00:21:02,350
be fair<font color="#CCCCCC"> to pen test monkey the chief you</font>

581
00:21:01,210 --> 00:21:04,509
<font color="#E5E5E5">look at the cheat sheet it does say</font>

582
00:21:02,350 --> 00:21:05,889
which is<font color="#E5E5E5"> quite old you know it said this</font>

583
00:21:04,509 --> 00:21:08,350
is originally based on<font color="#E5E5E5"> a certain version</font>

584
00:21:05,889 --> 00:21:10,330
of John and I'm not really<font color="#E5E5E5"> going to</font>

585
00:21:08,350 --> 00:21:12,428
change anything afterwards or you know

586
00:21:10,330 --> 00:21:14,080
don't don't blame me if<font color="#E5E5E5"> things change</font>

587
00:21:12,429 --> 00:21:17,230
and so<font color="#E5E5E5"> that was that what the case</font><font color="#CCCCCC"> had</font>

588
00:21:14,080 --> 00:21:18,759
John was expecting wanted this<font color="#E5E5E5"> this</font>

589
00:21:17,230 --> 00:21:21,220
different format and that's what seemed

590
00:21:18,759 --> 00:21:23,710
<font color="#E5E5E5">to do the trick so that's kind of easy</font>

591
00:21:21,220 --> 00:21:25,480
so what about hash cat has bit more to

592
00:21:23,710 --> 00:21:29,200
it<font color="#E5E5E5"> here so why was it that</font><font color="#CCCCCC"> I couldn't</font>

593
00:21:25,480 --> 00:21:31,570
get this thing to to crack so on the for

594
00:21:29,200 --> 00:21:33,399
the admin which is the test hash that

595
00:21:31,570 --> 00:21:38,200
came from the hash<font color="#E5E5E5"> cat website this</font>

596
00:21:33,399 --> 00:21:39,459
cracked locally but my hash that I got

597
00:21:38,200 --> 00:21:41,080
on this pen test job didn't now

598
00:21:39,460 --> 00:21:42,370
remembered I know both the passwords

599
00:21:41,080 --> 00:21:43,720
here the only thing that I could see

600
00:21:42,370 --> 00:21:46,239
that was a significant difference was

601
00:21:43,720 --> 00:21:48,399
<font color="#CCCCCC">the size of that blob in all those date</font>

602
00:21:46,240 --> 00:21:50,169
time stamps all that kind of stuff<font color="#E5E5E5"> so</font>

603
00:21:48,399 --> 00:21:54,070
the the blob over here which is much

604
00:21:50,169 --> 00:21:56,350
much bigger than<font color="#E5E5E5"> what was over here and</font>

605
00:21:54,070 --> 00:22:00,309
another difference when I came to

606
00:21:56,350 --> 00:22:03,250
cracking the Smith jerash was the

607
00:22:00,309 --> 00:22:05,710
difference in product so on the GPU rig

608
00:22:03,250 --> 00:22:07,899
that was<font color="#CCCCCC"> using ocl hash cat and also was</font>

609
00:22:05,710 --> 00:22:09,429
running on<font color="#E5E5E5"> linux and i was using just</font>

610
00:22:07,899 --> 00:22:11,080
hash cat locally here and it was just

611
00:22:09,429 --> 00:22:13,870
running on<font color="#CCCCCC"> windows so Ashley that's got</font>

612
00:22:11,080 --> 00:22:15,668
two differences to it so I kind of zoned

613
00:22:13,870 --> 00:22:16,178
in on this blog just basically because

614
00:22:15,669 --> 00:22:18,639
it<font color="#CCCCCC"> said</font>

615
00:22:16,179 --> 00:22:21,159
about skipping line and I know that this

616
00:22:18,639 --> 00:22:22,748
is<font color="#CCCCCC"> a much much much bigger hash for it</font>

617
00:22:21,159 --> 00:22:24,429
to to deal with so I've got up as

618
00:22:22,749 --> 00:22:27,369
suspicious about that so I kind of wrote

619
00:22:24,429 --> 00:22:31,210
a script to do some analysis so this

620
00:22:27,369 --> 00:22:32,889
script pulls out hashes from what why

621
00:22:31,210 --> 00:22:34,509
shark capture files but more importantly

622
00:22:32,889 --> 00:22:36,610
it allows you to play<font color="#E5E5E5"> around with them</font>

623
00:22:34,509 --> 00:22:39,399
so you can feed this<font color="#E5E5E5"> script called cat</font>

624
00:22:36,610 --> 00:22:41,049
flap either a capture file or a hash

625
00:22:39,399 --> 00:22:42,879
that<font color="#E5E5E5"> you've already got from some other</font>

626
00:22:41,049 --> 00:22:45,190
which<font color="#E5E5E5"> is you know basically not often</font>

627
00:22:42,879 --> 00:22:46,629
confusing<font color="#CCCCCC"> why</font><font color="#E5E5E5"> shard to do this but if</font>

628
00:22:45,190 --> 00:22:48,519
you've got a<font color="#CCCCCC"> Hashem that you're having</font>

629
00:22:46,629 --> 00:22:50,799
<font color="#E5E5E5">difficulty with</font><font color="#CCCCCC"> this is a way to do some</font>

630
00:22:48,519 --> 00:22:53,049
sanity checks so you feed it the<font color="#E5E5E5"> hash</font>

631
00:22:50,799 --> 00:22:55,899
file and you tell it the password<font color="#CCCCCC"> that</font>

632
00:22:53,049 --> 00:22:57,879
you want it to<font color="#CCCCCC"> be so obviously this is a</font>

633
00:22:55,899 --> 00:23:00,789
case where you've grabbed a hash from

634
00:22:57,879 --> 00:23:02,860
somewhere it's a legitimate hash it's a

635
00:23:00,789 --> 00:23:04,029
password<font color="#CCCCCC"> that you don't know you just</font>

636
00:23:02,860 --> 00:23:06,428
want<font color="#E5E5E5"> to make sure whether things are</font>

637
00:23:04,029 --> 00:23:09,070
kind of running correctly so yes you can

638
00:23:06,429 --> 00:23:11,230
feed in the<font color="#E5E5E5"> admin hash from the from</font>

639
00:23:09,070 --> 00:23:12,730
<font color="#E5E5E5">that hash cap website but as we saw that</font>

640
00:23:11,230 --> 00:23:15,129
doesn't<font color="#E5E5E5"> always necessarily correlate</font>

641
00:23:12,730 --> 00:23:16,509
with with with with<font color="#E5E5E5"> the working set of</font>

642
00:23:15,129 --> 00:23:18,699
conditions because this one over here

643
00:23:16,509 --> 00:23:20,470
didn't work so this<font color="#E5E5E5"> allows you to sort</font>

644
00:23:18,700 --> 00:23:25,179
of experiment a bit more<font color="#CCCCCC"> because</font><font color="#E5E5E5"> the</font>

645
00:23:20,470 --> 00:23:27,100
hash<font color="#E5E5E5"> cap test hash is obviously you</font><font color="#CCCCCC"> know</font>

646
00:23:25,179 --> 00:23:29,649
fixed this allows you to actually play

647
00:23:27,100 --> 00:23:31,449
around with the other inputs so in the

648
00:23:29,649 --> 00:23:33,729
hash cap file you can change the

649
00:23:31,450 --> 00:23:35,919
username<font color="#CCCCCC"> you can you can change the</font>

650
00:23:33,730 --> 00:23:37,809
password you can change the blob<font color="#CCCCCC"> and all</font>

651
00:23:35,919 --> 00:23:39,190
that and it will recalculate it so this

652
00:23:37,809 --> 00:23:41,110
allows you to experiment with<font color="#E5E5E5"> it and</font>

653
00:23:39,190 --> 00:23:44,409
<font color="#E5E5E5">it's a bit of a more faithful check as</font>

654
00:23:41,110 --> 00:23:46,240
well because rather than using<font color="#E5E5E5"> the</font>

655
00:23:44,409 --> 00:23:47,470
username admin it is<font color="#CCCCCC"> actually going to</font>

656
00:23:46,240 --> 00:23:49,269
<font color="#CCCCCC">be using the username that</font><font color="#E5E5E5"> you've pulled</font>

657
00:23:47,470 --> 00:23:50,590
out from this this hash it is<font color="#CCCCCC"> actually</font>

658
00:23:49,269 --> 00:23:53,320
going to<font color="#E5E5E5"> be using the real blob that</font>

659
00:23:50,590 --> 00:23:54,759
came from your from your pen test or

660
00:23:53,320 --> 00:23:56,408
what you know whatever<font color="#E5E5E5"> you're doing so</font>

661
00:23:54,759 --> 00:23:59,350
the conditions are much much closer to

662
00:23:56,409 --> 00:24:02,769
<font color="#CCCCCC">the hash that</font><font color="#E5E5E5"> you're trying to crack so</font>

663
00:23:59,350 --> 00:24:05,340
there's a little demo here just to<font color="#CCCCCC"> see</font>

664
00:24:02,769 --> 00:24:05,340
what that's<font color="#E5E5E5"> about</font>

665
00:24:11,360 --> 00:24:23,850
no yeah that's a good<font color="#CCCCCC"> point and yeah</font>

666
00:24:17,940 --> 00:24:33,210
let's go with<font color="#CCCCCC"> the help right so this is</font>

667
00:24:23,850 --> 00:24:36,149
<font color="#E5E5E5">the wireshark capture file and by</font>

668
00:24:33,210 --> 00:24:38,070
putting in that filter<font color="#CCCCCC"> ntlm SSP we jump</font>

669
00:24:36,150 --> 00:24:40,230
straight to the three packets of

670
00:24:38,070 --> 00:24:42,480
interest negotiate challenge and

671
00:24:40,230 --> 00:24:44,820
authentication you can see it's pulled

672
00:24:42,480 --> 00:24:46,980
out to the the username and password in

673
00:24:44,820 --> 00:24:48,960
this in this test case so that's<font color="#CCCCCC"> just to</font>

674
00:24:46,980 --> 00:24:51,660
sort of show you what we're dealing with

675
00:24:48,960 --> 00:24:53,790
here so cat flap is going to just take

676
00:24:51,660 --> 00:24:57,510
that file and it's pulled out the hash

677
00:24:53,790 --> 00:25:01,200
sort of automatically so you've got<font color="#E5E5E5"> the</font>

678
00:24:57,510 --> 00:25:04,950
<font color="#CCCCCC">username</font><font color="#E5E5E5"> ncc and</font><font color="#CCCCCC"> so obviously just set</font>

679
00:25:01,200 --> 00:25:07,010
test conditions domain laptop and

680
00:25:04,950 --> 00:25:11,549
there's that there is the challenge

681
00:25:07,010 --> 00:25:13,500
there is the the hash and this horrible

682
00:25:11,549 --> 00:25:18,540
long thing at the end is<font color="#CCCCCC"> that is the</font>

683
00:25:13,500 --> 00:25:22,320
blob so let's feed that into into a file

684
00:25:18,540 --> 00:25:26,040
and crack it with<font color="#E5E5E5"> John and it cracks so</font>

685
00:25:22,320 --> 00:25:30,230
that's our that's our sort of in the

686
00:25:26,040 --> 00:25:30,230
QWERTY part of the title if you like so

687
00:25:32,120 --> 00:25:36,000
so<font color="#E5E5E5"> let's try cat flap with a change of</font>

688
00:25:34,320 --> 00:25:38,040
password so just to prove<font color="#CCCCCC"> that this</font>

689
00:25:36,000 --> 00:25:40,020
isn't just sort of completely fixed

690
00:25:38,040 --> 00:25:41,879
anyone want to suggest<font color="#E5E5E5"> a password that</font>

691
00:25:40,020 --> 00:25:43,799
is crackable by John because we haven't

692
00:25:41,880 --> 00:25:45,299
got ours to sit<font color="#E5E5E5"> and wait for it all</font>

693
00:25:43,799 --> 00:25:52,770
being it's going to be in our standard

694
00:25:45,299 --> 00:25:53,879
dictionary file<font color="#E5E5E5"> anyone snowflake you</font>

695
00:25:52,770 --> 00:25:56,600
think snowflakes going to be in there

696
00:25:53,880 --> 00:25:56,600
<font color="#CCCCCC">okay let's try that</font>

697
00:25:59,559 --> 00:26:08,200
no it didn't seem<font color="#CCCCCC"> to like that</font><font color="#E5E5E5"> I'll tell</font>

698
00:26:02,919 --> 00:26:12,309
<font color="#E5E5E5">you</font><font color="#CCCCCC"> what let's just</font><font color="#E5E5E5"> put something like</font>

699
00:26:08,200 --> 00:26:16,149
that so what we're<font color="#CCCCCC"> doing here is feeding</font>

700
00:26:12,309 --> 00:26:21,070
cat flap with the hash and a new

701
00:26:16,149 --> 00:26:23,889
password so it recalculates the hash the

702
00:26:21,070 --> 00:26:25,658
end of the response if you like the that

703
00:26:23,889 --> 00:26:27,998
<font color="#E5E5E5">comes back from the client as if the</font>

704
00:26:25,659 --> 00:26:30,039
password were Brazil so if you<font color="#E5E5E5"> look this</font>

705
00:26:27,999 --> 00:26:33,519
is the original hash that was the the

706
00:26:30,039 --> 00:26:35,499
one that had the positive qwerty but

707
00:26:33,519 --> 00:26:36,909
otherwise be a password that you don't

708
00:26:35,499 --> 00:26:39,309
know imagine this is the hash that

709
00:26:36,909 --> 00:26:40,600
<font color="#E5E5E5">you're targeting you and hash cats</font>

710
00:26:39,309 --> 00:26:42,549
failed and you're just<font color="#E5E5E5"> trying to sort of</font>

711
00:26:40,600 --> 00:26:44,199
go why is this painting is this

712
00:26:42,549 --> 00:26:46,330
something that I'm<font color="#E5E5E5"> doing wrong you</font><font color="#CCCCCC"> could</font>

713
00:26:44,200 --> 00:26:48,100
<font color="#CCCCCC">check it by feeding it a password that</font>

714
00:26:46,330 --> 00:26:49,779
you know you know will be<font color="#CCCCCC"> in the</font>

715
00:26:48,100 --> 00:26:52,299
dictionary file so what this is doing is

716
00:26:49,779 --> 00:26:54,549
taking the username the blob the the

717
00:26:52,299 --> 00:26:55,960
challenge and recalculating the hash to

718
00:26:54,549 --> 00:26:57,158
<font color="#CCCCCC">Brazil</font><font color="#E5E5E5"> in this case if you look at the</font>

719
00:26:55,960 --> 00:26:59,159
<font color="#E5E5E5">file closely you'll see the only thing</font>

720
00:26:57,159 --> 00:27:03,179
that's different<font color="#E5E5E5"> is this area here</font>

721
00:26:59,159 --> 00:27:06,970
because that's the recalculated response

722
00:27:03,179 --> 00:27:10,419
so<font color="#E5E5E5"> we put that into John and that's</font>

723
00:27:06,970 --> 00:27:15,700
cracked quickly if you put it into hash

724
00:27:10,419 --> 00:27:18,759
cat it doesn't like it you see there's a

725
00:27:15,700 --> 00:27:20,619
recovered 01 so let's now shorten this

726
00:27:18,759 --> 00:27:21,970
blob that was a bit that was zoning in

727
00:27:20,619 --> 00:27:23,649
on because<font color="#CCCCCC"> that was that was sort of the</font>

728
00:27:21,970 --> 00:27:25,929
obvious difference between the two

729
00:27:23,649 --> 00:27:28,239
hashes that work that were cracking so

730
00:27:25,929 --> 00:27:30,610
let's use the same password Brazil you

731
00:27:28,240 --> 00:27:32,499
can seen it there that the blob I just

732
00:27:30,610 --> 00:27:34,990
cut short in fact this<font color="#E5E5E5"> is the same</font>

733
00:27:32,499 --> 00:27:37,509
number of bytes as the test case in in

734
00:27:34,990 --> 00:27:39,399
in hash cat so so we've got much shorter

735
00:27:37,509 --> 00:27:42,549
blob again we're setting the password to

736
00:27:39,399 --> 00:27:49,629
<font color="#CCCCCC">Brazil and then if you pop it into hash</font>

737
00:27:42,549 --> 00:27:53,168
cat now it cracks so obviously there is

738
00:27:49,629 --> 00:27:54,759
some bug so that's what I discovered so

739
00:27:53,169 --> 00:27:56,559
hash get had a but I had a bug and it

740
00:27:54,759 --> 00:27:59,019
wasn't<font color="#E5E5E5"> handling these these blobs</font>

741
00:27:56,559 --> 00:28:00,908
properly when it was above a certain

742
00:27:59,019 --> 00:28:04,570
size and I sort<font color="#CCCCCC"> of calculated what that</font>

743
00:28:00,909 --> 00:28:07,090
size was and I and I issued a you know I

744
00:28:04,570 --> 00:28:08,889
put<font color="#E5E5E5"> in a request to get it to get it</font>

745
00:28:07,090 --> 00:28:10,509
fixed it<font color="#E5E5E5"> actually came up with a flag of</font>

746
00:28:08,889 --> 00:28:12,490
new feature shouldn't really quite

747
00:28:10,509 --> 00:28:13,560
understand because it seems<font color="#E5E5E5"> to</font><font color="#CCCCCC"> be a bug</font>

748
00:28:12,490 --> 00:28:15,180
to me but anyway

749
00:28:13,560 --> 00:28:16,800
there we go so you know I knew that<font color="#E5E5E5"> it</font>

750
00:28:15,180 --> 00:28:18,780
didn't affect ocl hash care it doesn't

751
00:28:16,800 --> 00:28:21,120
that has it happens I believe much much

752
00:28:18,780 --> 00:28:24,690
later found out like sort of the other

753
00:28:21,120 --> 00:28:26,219
day that that<font color="#CCCCCC"> it doesn't work on so that</font>

754
00:28:24,690 --> 00:28:27,630
didn't affect cash count on<font color="#E5E5E5"> Linux either</font>

755
00:28:26,220 --> 00:28:29,580
so there's a very small footnote<font color="#E5E5E5"> the</font>

756
00:28:27,630 --> 00:28:31,530
hair because you've<font color="#CCCCCC"> just been watching a</font>

757
00:28:29,580 --> 00:28:33,000
demo of hash cat apparently<font color="#CCCCCC"> running in</font>

758
00:28:31,530 --> 00:28:36,660
Linux well I sort of had<font color="#CCCCCC"> to fudge that</font>

759
00:28:33,000 --> 00:28:38,130
book but<font color="#E5E5E5"> promised the heat I promise you</font>

760
00:28:36,660 --> 00:28:40,620
does actually if you were to run that<font color="#E5E5E5"> on</font>

761
00:28:38,130 --> 00:28:42,300
<font color="#E5E5E5">Windows it's a you know you would you</font>

762
00:28:40,620 --> 00:28:44,520
would see that that that that doesn't

763
00:28:42,300 --> 00:28:45,600
<font color="#E5E5E5">work so it turns out that old John</font>

764
00:28:44,520 --> 00:28:47,639
Stuart Mill was right there i<font color="#E5E5E5"> was</font>

765
00:28:45,600 --> 00:28:49,830
looking at two differences there that it

766
00:28:47,640 --> 00:28:51,630
was it<font color="#CCCCCC"> wasn't working</font><font color="#E5E5E5"> with with hash cat</font>

767
00:28:49,830 --> 00:28:53,010
it was working with ocl hash cap and

768
00:28:51,630 --> 00:28:57,060
also the platform made a difference as

769
00:28:53,010 --> 00:28:58,950
well so today we are so<font color="#E5E5E5"> with that</font><font color="#CCCCCC"> SAT</font>

770
00:28:57,060 --> 00:29:00,929
there<font color="#E5E5E5"> for a little while and</font><font color="#CCCCCC"> then hash</font>

771
00:28:58,950 --> 00:29:03,390
<font color="#CCCCCC">cat three turned up and it got fixed and</font>

772
00:29:00,930 --> 00:29:04,860
disappeared so so so that does seem<font color="#CCCCCC"> to</font>

773
00:29:03,390 --> 00:29:06,270
have<font color="#E5E5E5"> been taken into account and I'm</font>

774
00:29:04,860 --> 00:29:09,479
fixed which was cool so that is sort of

775
00:29:06,270 --> 00:29:10,770
explained so what was wrong with my and

776
00:29:09,480 --> 00:29:12,600
it wasn't my<font color="#E5E5E5"> fault it's actually and</font>

777
00:29:10,770 --> 00:29:17,420
that was explained what was wrong with

778
00:29:12,600 --> 00:29:20,219
the with the<font color="#E5E5E5"> cracking operation so um</font>

779
00:29:17,420 --> 00:29:22,500
there's a<font color="#E5E5E5"> mental mv2 theory there's some</font>

780
00:29:20,220 --> 00:29:23,310
sort of bits and bobs<font color="#CCCCCC"> and this is</font><font color="#E5E5E5"> sort</font>

781
00:29:22,500 --> 00:29:24,450
of something<font color="#CCCCCC"> that just grew out of</font>

782
00:29:23,310 --> 00:29:25,919
interesting and<font color="#E5E5E5"> i wanted to take it</font>

783
00:29:24,450 --> 00:29:27,990
<font color="#E5E5E5">further for this for this presentation</font>

784
00:29:25,920 --> 00:29:29,490
can we cut out some of those warnings

785
00:29:27,990 --> 00:29:32,220
this is essentially about<font color="#E5E5E5"> can we can we</font>

786
00:29:29,490 --> 00:29:33,390
<font color="#E5E5E5">play around with this excel export you</font>

787
00:29:32,220 --> 00:29:35,070
know we've seen that<font color="#E5E5E5"> we can grab</font><font color="#CCCCCC"> a hash</font>

788
00:29:33,390 --> 00:29:37,170
and some complications with that

789
00:29:35,070 --> 00:29:38,550
scenario but more generally speaking if

790
00:29:37,170 --> 00:29:40,410
<font color="#CCCCCC">we want to</font><font color="#E5E5E5"> get some command execution on</font>

791
00:29:38,550 --> 00:29:43,530
the victim you know what can what can we

792
00:29:40,410 --> 00:29:46,050
do and can<font color="#CCCCCC"> we make it more streamlined</font>

793
00:29:43,530 --> 00:29:47,690
from the attackers point of view so the

794
00:29:46,050 --> 00:29:50,460
standard sort of warnings that come up

795
00:29:47,690 --> 00:29:52,290
when you have an<font color="#E5E5E5"> Excel spreadsheet that</font>

796
00:29:50,460 --> 00:29:54,840
contains one of these references<font color="#CCCCCC"> like</font>

797
00:29:52,290 --> 00:29:56,639
equals CMD pipe into something you know

798
00:29:54,840 --> 00:29:58,830
<font color="#E5E5E5">wherever first of all you get a</font>

799
00:29:56,640 --> 00:30:00,390
protected view warning and this is

800
00:29:58,830 --> 00:30:01,770
because<font color="#E5E5E5"> it's coming from the internet</font>

801
00:30:00,390 --> 00:30:03,600
the file has<font color="#E5E5E5"> been downloaded come from</font>

802
00:30:01,770 --> 00:30:05,760
the internet and it's not trusted so you

803
00:30:03,600 --> 00:30:07,530
get that warning come up the next

804
00:30:05,760 --> 00:30:09,120
warning you get kind of<font color="#E5E5E5"> varies depends</font>

805
00:30:07,530 --> 00:30:10,470
where you are so that warning the

806
00:30:09,120 --> 00:30:12,510
background there with the yellow bar

807
00:30:10,470 --> 00:30:14,550
that's kind of the first warning that

808
00:30:12,510 --> 00:30:16,230
<font color="#CCCCCC">you might get where it sort of</font>

809
00:30:14,550 --> 00:30:18,240
suspicious of the content it knows that

810
00:30:16,230 --> 00:30:19,650
<font color="#E5E5E5">you might</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> sort of you know calling</font>

811
00:30:18,240 --> 00:30:21,570
malicious program so it gives you a

812
00:30:19,650 --> 00:30:23,610
warning there the second warning that's

813
00:30:21,570 --> 00:30:24,840
ought to be warning there that's

814
00:30:23,610 --> 00:30:26,300
slightly different you see<font color="#CCCCCC"> I haven't</font><font color="#E5E5E5"> got</font>

815
00:30:24,840 --> 00:30:27,620
a<font color="#CCCCCC"> security warning</font>

816
00:30:26,300 --> 00:30:28,940
you know quite so it's not<font color="#E5E5E5"> quite</font><font color="#CCCCCC"> it's</font>

817
00:30:27,620 --> 00:30:31,459
<font color="#E5E5E5">not</font><font color="#CCCCCC"> that one that</font><font color="#E5E5E5"> you get on the bar of</font>

818
00:30:28,940 --> 00:30:33,050
<font color="#E5E5E5">Excel it subtly different that's saying</font>

819
00:30:31,460 --> 00:30:34,820
that that you usually get that kind of

820
00:30:33,050 --> 00:30:38,030
warning when the first warning has been

821
00:30:34,820 --> 00:30:41,030
<font color="#E5E5E5">previously accepted and you're you're</font>

822
00:30:38,030 --> 00:30:42,320
running the file again and it realizes

823
00:30:41,030 --> 00:30:43,670
that<font color="#E5E5E5"> you've still got links and you want</font>

824
00:30:42,320 --> 00:30:45,260
you want to run them again so you get

825
00:30:43,670 --> 00:30:48,400
some<font color="#CCCCCC"> different warnings there depending</font>

826
00:30:45,260 --> 00:30:50,750
<font color="#CCCCCC">on the context and</font><font color="#E5E5E5"> the last warning</font>

827
00:30:48,400 --> 00:30:53,210
which I've already explained you know do

828
00:30:50,750 --> 00:30:55,520
<font color="#E5E5E5">you</font><font color="#CCCCCC"> want</font><font color="#E5E5E5"> to run CMD door</font><font color="#CCCCCC"> XE you get that</font>

829
00:30:53,210 --> 00:30:58,430
warning because<font color="#CCCCCC"> that</font><font color="#E5E5E5"> your equal CMD</font>

830
00:30:55,520 --> 00:31:02,300
which is it treats as a dde call fails

831
00:30:58,430 --> 00:31:05,150
because there is no Deedee's service

832
00:31:02,300 --> 00:31:07,730
listening called CMD so it then offers

833
00:31:05,150 --> 00:31:09,500
to run that so what<font color="#E5E5E5"> can we do</font><font color="#CCCCCC"> about</font>

834
00:31:07,730 --> 00:31:11,210
these warnings well the first<font color="#CCCCCC"> thing to</font>

835
00:31:09,500 --> 00:31:14,330
mention is that we know that users click

836
00:31:11,210 --> 00:31:17,330
through warnings so these are<font color="#CCCCCC"> some stats</font>

837
00:31:14,330 --> 00:31:20,870
from NCC's sort of<font color="#CCCCCC"> piranha tool which</font>

838
00:31:17,330 --> 00:31:23,060
<font color="#E5E5E5">sort in-house tool that is also</font>

839
00:31:20,870 --> 00:31:25,159
available as<font color="#E5E5E5"> a service as well to limit</font>

840
00:31:23,060 --> 00:31:26,720
extend<font color="#CCCCCC"> where where</font><font color="#E5E5E5"> we can do some red</font>

841
00:31:25,160 --> 00:31:28,760
teaming and fishing and things like that

842
00:31:26,720 --> 00:31:30,890
<font color="#E5E5E5">so i may ask someone to pull out some</font>

843
00:31:28,760 --> 00:31:33,140
stats and the stats were pretty

844
00:31:30,890 --> 00:31:35,030
promising from a from a from the

845
00:31:33,140 --> 00:31:37,100
attacker point of view so the<font color="#CCCCCC"> difference</font>

846
00:31:35,030 --> 00:31:38,750
here<font color="#E5E5E5"> is between people who have</font><font color="#CCCCCC"> get open</font>

847
00:31:37,100 --> 00:31:40,189
the spreadsheet and people have opened

848
00:31:38,750 --> 00:31:41,360
<font color="#CCCCCC">the</font><font color="#E5E5E5"> spreadsheet and must have clicked</font>

849
00:31:40,190 --> 00:31:43,250
some warnings the fact that there<font color="#CCCCCC"> is a</font>

850
00:31:41,360 --> 00:31:44,780
difference there means that the thing

851
00:31:43,250 --> 00:31:46,910
definitely didn't also<font color="#E5E5E5"> execute someone</font>

852
00:31:44,780 --> 00:31:48,260
has definitely sort of clicked ok<font color="#E5E5E5"> we</font>

853
00:31:46,910 --> 00:31:50,360
obviously don't<font color="#E5E5E5"> have any visibility as</font>

854
00:31:48,260 --> 00:31:52,010
to what those warnings were but we know

855
00:31:50,360 --> 00:31:54,110
that something happened so in a few

856
00:31:52,010 --> 00:31:56,840
<font color="#CCCCCC">different</font><font color="#E5E5E5"> cases here you know seventy</font>

857
00:31:54,110 --> 00:31:58,370
percent<font color="#E5E5E5"> 75% forty-four percent you</font><font color="#CCCCCC"> know</font>

858
00:31:56,840 --> 00:32:01,250
it's<font color="#E5E5E5"> always a little bit of a you know a</font>

859
00:31:58,370 --> 00:32:02,360
lottery as to who you're up against so

860
00:32:01,250 --> 00:32:04,340
these<font color="#CCCCCC"> people are clicking through</font>

861
00:32:02,360 --> 00:32:06,139
warnings so to an extent<font color="#E5E5E5"> do we have to</font>

862
00:32:04,340 --> 00:32:08,060
<font color="#E5E5E5">worry about the warnings too much not</font>

863
00:32:06,140 --> 00:32:10,430
all the<font color="#CCCCCC"> time</font><font color="#E5E5E5"> we know that that is a that</font>

864
00:32:08,060 --> 00:32:13,700
is<font color="#E5E5E5"> a important vector for forgetting</font>

865
00:32:10,430 --> 00:32:15,650
stuff into<font color="#E5E5E5"> organizations however it</font>

866
00:32:13,700 --> 00:32:18,620
would<font color="#CCCCCC"> be nice to to cut down on those</font>

867
00:32:15,650 --> 00:32:23,480
warnings interestingly enough I was a

868
00:32:18,620 --> 00:32:25,129
with someone who works in a<font color="#CCCCCC"> reasonable</font>

869
00:32:23,480 --> 00:32:26,450
<font color="#CCCCCC">size corporation and I just</font><font color="#E5E5E5"> as I was</font>

870
00:32:25,130 --> 00:32:28,790
<font color="#CCCCCC">preparing this talk so let me just</font><font color="#E5E5E5"> have</font>

871
00:32:26,450 --> 00:32:31,670
a little look at<font color="#E5E5E5"> your Excel settings and</font>

872
00:32:28,790 --> 00:32:33,830
it was set to that so enable all that

873
00:32:31,670 --> 00:32:35,090
<font color="#E5E5E5">grows so sometimes you might be lucky in</font>

874
00:32:33,830 --> 00:32:36,379
there may you know that the

875
00:32:35,090 --> 00:32:38,320
configuration and<font color="#E5E5E5"> the in the</font>

876
00:32:36,380 --> 00:32:40,509
organization may be wide open and

877
00:32:38,320 --> 00:32:42,100
was you<font color="#E5E5E5"> know macros is much more</font>

878
00:32:40,509 --> 00:32:44,889
dangerous<font color="#E5E5E5"> and that's the important point</font>

879
00:32:42,100 --> 00:32:46,990
here dde is not the same as a macro you

880
00:32:44,889 --> 00:32:49,689
could have macro settings to you know

881
00:32:46,990 --> 00:32:52,330
give me<font color="#E5E5E5"> a warning and dde is not going</font>

882
00:32:49,690 --> 00:32:54,960
to<font color="#E5E5E5"> sort of trigger that which is quite</font>

883
00:32:52,330 --> 00:32:57,610
<font color="#E5E5E5">nice from from a red team point of view</font>

884
00:32:54,960 --> 00:32:58,960
so where do these warnings come from so

885
00:32:57,610 --> 00:33:02,860
they are obviously various settings in

886
00:32:58,960 --> 00:33:04,350
it in<font color="#E5E5E5"> Excel so put the protected view</font>

887
00:33:02,860 --> 00:33:07,240
warnings are coming<font color="#E5E5E5"> from the default</font>

888
00:33:04,350 --> 00:33:08,980
part<font color="#E5E5E5"> fault set of tick boxes there where</font>

889
00:33:07,240 --> 00:33:10,330
you know says if this<font color="#E5E5E5"> far looks</font>

890
00:33:08,980 --> 00:33:12,730
suspicious then give me<font color="#E5E5E5"> a warning and</font>

891
00:33:10,330 --> 00:33:14,529
the external content that's the sort of

892
00:33:12,730 --> 00:33:16,720
dynamic links that are making dde cause

893
00:33:14,529 --> 00:33:19,690
and so forth that's in the external

894
00:33:16,720 --> 00:33:21,759
content section there and the default

895
00:33:19,690 --> 00:33:24,909
there is is is prompt and hence the

896
00:33:21,759 --> 00:33:27,190
yellow hence<font color="#E5E5E5"> the yellow bar so while</font>

897
00:33:24,909 --> 00:33:29,799
poking about I<font color="#E5E5E5"> noticed that inside the</font>

898
00:33:27,190 --> 00:33:32,919
Excel spreadsheet if you go to data edit

899
00:33:29,799 --> 00:33:35,529
links go down to<font color="#E5E5E5"> start up prompt at the</font>

900
00:33:32,919 --> 00:33:37,870
bottom<font color="#CCCCCC"> so data edit links you get this</font>

901
00:33:35,529 --> 00:33:40,539
dialog pop-up go to start up prompt and

902
00:33:37,870 --> 00:33:42,820
the default option<font color="#CCCCCC"> was let users choose</font>

903
00:33:40,539 --> 00:33:44,440
to display the alert or not but there

904
00:33:42,820 --> 00:33:46,120
was another option at the bottom don't

905
00:33:44,440 --> 00:33:48,340
display the alerts and update the links

906
00:33:46,120 --> 00:33:51,129
automatically I thought<font color="#CCCCCC"> hmm that's</font>

907
00:33:48,340 --> 00:33:52,928
interesting that<font color="#CCCCCC"> this is a property of</font>

908
00:33:51,129 --> 00:33:55,178
the file<font color="#E5E5E5"> itself so this property goes</font>

909
00:33:52,929 --> 00:33:56,919
with the file and I thought this is like

910
00:33:55,179 --> 00:34:00,789
a network packet with the<font color="#E5E5E5"> evil bit set</font>

911
00:33:56,919 --> 00:34:02,470
to<font color="#CCCCCC"> OFF you know so I had a</font><font color="#E5E5E5"> little</font>

912
00:34:00,789 --> 00:34:05,080
experiment with this turns out<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> not</font>

913
00:34:02,470 --> 00:34:06,759
quite as good<font color="#CCCCCC"> as you as I hoped so it is</font>

914
00:34:05,080 --> 00:34:09,759
a setting of the property so it<font color="#CCCCCC"> is a</font>

915
00:34:06,759 --> 00:34:11,949
setting of<font color="#CCCCCC"> the of the file it follows</font>

916
00:34:09,760 --> 00:34:13,690
the file but it's only effective if the

917
00:34:11,949 --> 00:34:16,210
<font color="#E5E5E5">file has been previously trusted so you</font>

918
00:34:13,690 --> 00:34:17,918
get one warning to say you know<font color="#E5E5E5"> are you</font>

919
00:34:16,210 --> 00:34:19,780
happy with this essentially with this

920
00:34:17,918 --> 00:34:21,429
spreadsheet after that it doesn't give

921
00:34:19,780 --> 00:34:24,190
you<font color="#CCCCCC"> any more warnings when you run it</font>

922
00:34:21,429 --> 00:34:25,389
again which<font color="#E5E5E5"> is you know not ideal you</font>

923
00:34:24,190 --> 00:34:27,819
could if you wanted to do like a<font color="#E5E5E5"> really</font>

924
00:34:25,389 --> 00:34:32,349
low and<font color="#CCCCCC"> slow attack you know you could</font>

925
00:34:27,819 --> 00:34:35,290
have<font color="#CCCCCC"> a file with the same name where the</font>

926
00:34:32,349 --> 00:34:36,849
first payload was just benign just

927
00:34:35,290 --> 00:34:38,079
didn't do anything and then you followed

928
00:34:36,849 --> 00:34:40,800
it up with<font color="#E5E5E5"> something more malicious</font>

929
00:34:38,079 --> 00:34:42,600
later on and<font color="#CCCCCC"> that second</font>

930
00:34:40,800 --> 00:34:47,850
file wouldn't wouldn't have the same

931
00:34:42,600 --> 00:34:49,620
warnings on it so where is this being

932
00:34:47,850 --> 00:34:52,589
stored when you accept the protected

933
00:34:49,620 --> 00:34:54,659
view when you accept the security enable

934
00:34:52,590 --> 00:34:56,429
content warning what's happening well

935
00:34:54,659 --> 00:34:58,740
it's<font color="#CCCCCC"> just interesting the registry as</font>

936
00:34:56,429 --> 00:35:00,870
you<font color="#E5E5E5"> might expect so you get an entry</font>

937
00:34:58,740 --> 00:35:02,759
entry here in trust records you get the

938
00:35:00,870 --> 00:35:03,960
name of<font color="#CCCCCC"> the file and some horrible</font>

939
00:35:02,760 --> 00:35:06,390
binary blob I don't know what half<font color="#E5E5E5"> of</font>

940
00:35:03,960 --> 00:35:09,510
this does but if you once you accept the

941
00:35:06,390 --> 00:35:12,540
protected warning file it has this value

942
00:35:09,510 --> 00:35:14,700
once you accept the security content you

943
00:35:12,540 --> 00:35:16,910
know enable content security warning

944
00:35:14,700 --> 00:35:19,500
then it changes<font color="#CCCCCC"> to this and so that's</font>

945
00:35:16,910 --> 00:35:22,740
I've interests because only the file

946
00:35:19,500 --> 00:35:24,120
name is is stored so where you have

947
00:35:22,740 --> 00:35:26,609
downloads if you were thinking about web

948
00:35:24,120 --> 00:35:28,680
app export for example or maybe<font color="#E5E5E5"> you're</font>

949
00:35:26,610 --> 00:35:30,780
sending attachments or similar if the

950
00:35:28,680 --> 00:35:33,359
file name<font color="#CCCCCC"> is static then that's more of</font>

951
00:35:30,780 --> 00:35:34,380
more interest because if that file and

952
00:35:33,360 --> 00:35:35,760
it could have been obviously<font color="#E5E5E5"> completely</font>

953
00:35:34,380 --> 00:35:37,920
different content but if it's been

954
00:35:35,760 --> 00:35:40,050
<font color="#CCCCCC">previously trusted your file will be</font>

955
00:35:37,920 --> 00:35:41,820
trusted because it's got<font color="#E5E5E5"> the same name</font>

956
00:35:40,050 --> 00:35:43,110
there's no no it's<font color="#E5E5E5"> not like it's hashing</font>

957
00:35:41,820 --> 00:35:45,450
<font color="#E5E5E5">it or anything like that it just</font><font color="#CCCCCC"> goes on</font>

958
00:35:43,110 --> 00:35:48,390
<font color="#E5E5E5">the name so once that file once that</font>

959
00:35:45,450 --> 00:35:51,299
<font color="#E5E5E5">file name is trusted anything afterwards</font>

960
00:35:48,390 --> 00:35:54,390
will will<font color="#E5E5E5"> be</font><font color="#CCCCCC"> subject to less warnings</font>

961
00:35:51,300 --> 00:35:56,370
because you it's as far<font color="#E5E5E5"> as its as</font><font color="#CCCCCC"> Excel</font>

962
00:35:54,390 --> 00:35:57,779
and the operating system is concerned

963
00:35:56,370 --> 00:35:59,520
you're happy with that<font color="#E5E5E5"> even though</font>

964
00:35:57,780 --> 00:36:00,690
you've overwritten the content with

965
00:35:59,520 --> 00:36:03,330
something else that could be malicious

966
00:36:00,690 --> 00:36:05,550
it's it will just to run that so we're

967
00:36:03,330 --> 00:36:08,670
potentially that's a that will reduce

968
00:36:05,550 --> 00:36:12,150
<font color="#E5E5E5">the number of warnings I then how to</font>

969
00:36:08,670 --> 00:36:13,710
poke about with the excel file formats

970
00:36:12,150 --> 00:36:14,970
as well is there<font color="#E5E5E5"> something you know if</font>

971
00:36:13,710 --> 00:36:16,950
you've<font color="#CCCCCC"> got a web app that's exporting</font>

972
00:36:14,970 --> 00:36:19,470
xls is that going<font color="#E5E5E5"> to be different to it</font>

973
00:36:16,950 --> 00:36:20,939
<font color="#CCCCCC">web app is exporting CSV and that's not</font>

974
00:36:19,470 --> 00:36:22,589
<font color="#E5E5E5">something you always have control over</font>

975
00:36:20,940 --> 00:36:24,900
when you're doing your web app testing

976
00:36:22,590 --> 00:36:27,840
because it's it may just be export<font color="#E5E5E5"> see</font>

977
00:36:24,900 --> 00:36:29,910
of a CSV and that's it but there's some

978
00:36:27,840 --> 00:36:31,890
that there could be some import into red

979
00:36:29,910 --> 00:36:33,240
teaming or you know sometimes there may

980
00:36:31,890 --> 00:36:35,250
be different options and your web app

981
00:36:33,240 --> 00:36:36,750
export and so I had a little<font color="#E5E5E5"> poke around</font>

982
00:36:35,250 --> 00:36:39,120
<font color="#E5E5E5">that wasn't all that much difference the</font>

983
00:36:36,750 --> 00:36:41,270
other thing<font color="#E5E5E5"> I noticed with CSV you</font>

984
00:36:39,120 --> 00:36:44,520
didn't get that protected warning

985
00:36:41,270 --> 00:36:45,870
message so<font color="#CCCCCC"> that first</font><font color="#E5E5E5"> warning protected</font>

986
00:36:44,520 --> 00:36:48,210
view this is coming<font color="#CCCCCC"> from the internet</font>

987
00:36:45,870 --> 00:36:50,190
don't not happy about this<font color="#E5E5E5"> the CSV you</font>

988
00:36:48,210 --> 00:36:51,810
don't get<font color="#CCCCCC"> that so it's almost like</font><font color="#E5E5E5"> you</font>

989
00:36:50,190 --> 00:36:54,180
know there's<font color="#CCCCCC"> been a design decision in</font>

990
00:36:51,810 --> 00:36:57,090
Microsoft that CSV is benign and we

991
00:36:54,180 --> 00:37:00,330
no that not to be true so you get one

992
00:36:57,090 --> 00:37:02,430
less warning with CSVs one thing though

993
00:37:00,330 --> 00:37:04,049
is the<font color="#CCCCCC"> CSV can't contain that startup</font>

994
00:37:02,430 --> 00:37:07,049
prop you know that where it says like I

995
00:37:04,050 --> 00:37:08,580
want to<font color="#CCCCCC"> auto update my links and and not</font>

996
00:37:07,050 --> 00:37:09,720
be bothered about it because<font color="#CCCCCC"> of</font><font color="#E5E5E5"> it</font>

997
00:37:08,580 --> 00:37:12,569
because<font color="#CCCCCC"> of what it is just comma</font>

998
00:37:09,720 --> 00:37:15,779
separated values it you can't<font color="#E5E5E5"> store that</font>

999
00:37:12,570 --> 00:37:17,880
value<font color="#E5E5E5"> as a part of the as part of the</font>

1000
00:37:15,780 --> 00:37:20,580
file that's obviously not<font color="#E5E5E5"> something that</font>

1001
00:37:17,880 --> 00:37:22,710
you can<font color="#E5E5E5"> do with with web app export you</font>

1002
00:37:20,580 --> 00:37:24,480
know is<font color="#E5E5E5"> is</font><font color="#CCCCCC"> to is to create the file with</font>

1003
00:37:22,710 --> 00:37:25,920
that setting but in red teaming you<font color="#CCCCCC"> know</font>

1004
00:37:24,480 --> 00:37:28,320
you can't with your crafting<font color="#E5E5E5"> and excel</font>

1005
00:37:25,920 --> 00:37:30,330
file you could<font color="#E5E5E5"> change the data link</font>

1006
00:37:28,320 --> 00:37:31,560
properties and and set that so it may be

1007
00:37:30,330 --> 00:37:33,240
of use so I'm kind<font color="#CCCCCC"> of switching</font><font color="#E5E5E5"> a little</font>

1008
00:37:31,560 --> 00:37:34,620
bit between different scenarios where

1009
00:37:33,240 --> 00:37:36,359
you've got<font color="#CCCCCC"> Weber export and where you</font>

1010
00:37:34,620 --> 00:37:37,620
might<font color="#CCCCCC"> be sending malicious</font><font color="#E5E5E5"> Excel files</font>

1011
00:37:36,360 --> 00:37:39,240
there's a<font color="#E5E5E5"> little bit of an overlap in</font>

1012
00:37:37,620 --> 00:37:41,790
some areas and in other areas there's

1013
00:37:39,240 --> 00:37:44,399
there's some differences the other thing

1014
00:37:41,790 --> 00:37:46,950
I noticed is that if<font color="#CCCCCC"> the CSV format was</font>

1015
00:37:44,400 --> 00:37:48,780
in an XLS file so you<font color="#E5E5E5"> had a dot XLS</font>

1016
00:37:46,950 --> 00:37:50,759
extension but it was actually<font color="#CCCCCC"> in the CSV</font>

1017
00:37:48,780 --> 00:37:53,520
format now<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is actually</font><font color="#E5E5E5"> similar to</font>

1018
00:37:50,760 --> 00:37:56,490
the real<font color="#E5E5E5"> pen test job that that was a</font>

1019
00:37:53,520 --> 00:37:58,259
top of this presentation so here you get

1020
00:37:56,490 --> 00:37:59,700
a format warning as you saw<font color="#E5E5E5"> instead of</font>

1021
00:37:58,260 --> 00:38:01,560
the protected view so even though it's

1022
00:37:59,700 --> 00:38:03,029
coming from the internet the protected

1023
00:38:01,560 --> 00:38:04,440
view warning disappears and instead you

1024
00:38:03,030 --> 00:38:08,910
<font color="#E5E5E5">get a format warning which is a little</font>

1025
00:38:04,440 --> 00:38:10,950
bit sort of less in your face you might

1026
00:38:08,910 --> 00:38:12,450
be more likely to click yes to that all

1027
00:38:10,950 --> 00:38:14,430
the four more security warnings actually

1028
00:38:12,450 --> 00:38:16,500
aren't shown<font color="#E5E5E5"> and all the ones that have</font>

1029
00:38:14,430 --> 00:38:19,290
you know the yellow banner they don't

1030
00:38:16,500 --> 00:38:20,700
they don't come up as a consequence

1031
00:38:19,290 --> 00:38:22,800
though the file can't be trusted because

1032
00:38:20,700 --> 00:38:24,569
you've got<font color="#E5E5E5"> to click those yeses in order</font>

1033
00:38:22,800 --> 00:38:25,890
<font color="#E5E5E5">for it to appear in the registry so if</font>

1034
00:38:24,570 --> 00:38:27,410
you're thinking<font color="#CCCCCC"> about a long-term attack</font>

1035
00:38:25,890 --> 00:38:30,060
where you're following it up with<font color="#E5E5E5"> other</font>

1036
00:38:27,410 --> 00:38:31,589
<font color="#CCCCCC">Excel files that</font><font color="#E5E5E5"> that have more</font>

1037
00:38:30,060 --> 00:38:33,900
malicious payloads you know that's

1038
00:38:31,590 --> 00:38:35,730
that's not<font color="#E5E5E5"> going to work so there wasn't</font>

1039
00:38:33,900 --> 00:38:37,110
really<font color="#E5E5E5"> as it turns out and</font><font color="#CCCCCC"> this is what</font>

1040
00:38:35,730 --> 00:38:38,640
researchers about<font color="#E5E5E5"> I suppose you know</font>

1041
00:38:37,110 --> 00:38:40,830
<font color="#CCCCCC">that didn't really sort</font><font color="#E5E5E5"> of offer offer</font>

1042
00:38:38,640 --> 00:38:43,200
too much so when we have a look at this

1043
00:38:40,830 --> 00:38:45,000
CMD door XE warning as well what can<font color="#E5E5E5"> we</font>

1044
00:38:43,200 --> 00:38:46,649
do about<font color="#E5E5E5"> that so for the first thing I</font>

1045
00:38:45,000 --> 00:38:48,150
thought about<font color="#E5E5E5"> as well what about if we</font>

1046
00:38:46,650 --> 00:38:49,380
use some native functions now there's a

1047
00:38:48,150 --> 00:38:51,390
few here that already been documented

1048
00:38:49,380 --> 00:38:52,890
elsewhere you know that equals hyperlink

1049
00:38:51,390 --> 00:38:54,420
for example is a way of stealing data

1050
00:38:52,890 --> 00:38:57,240
that was in James kettles original

1051
00:38:54,420 --> 00:39:01,380
presentation so you can create<font color="#E5E5E5"> a</font>

1052
00:38:57,240 --> 00:39:03,870
hyperlink to my evil<font color="#E5E5E5"> site com add some</font>

1053
00:39:01,380 --> 00:39:05,340
contents of cells and if someone<font color="#E5E5E5"> clicks</font>

1054
00:39:03,870 --> 00:39:07,089
that hyperlink it all just steal that

1055
00:39:05,340 --> 00:39:08,499
data<font color="#E5E5E5"> and send it off and you</font>

1056
00:39:07,089 --> 00:39:10,989
you know you can read it<font color="#E5E5E5"> you can also</font>

1057
00:39:08,499 --> 00:39:12,700
get<font color="#E5E5E5"> some information about the operating</font>

1058
00:39:10,989 --> 00:39:15,339
system and<font color="#E5E5E5"> some bits and bobs as well if</font>

1059
00:39:12,700 --> 00:39:17,019
you can grab the contents of cells<font color="#E5E5E5"> that</font>

1060
00:39:15,339 --> 00:39:19,630
you have<font color="#E5E5E5"> control over and you put these</font>

1061
00:39:17,019 --> 00:39:22,029
kind of instructions in their equals

1062
00:39:19,630 --> 00:39:23,650
info directory will tell you<font color="#E5E5E5"> about the</font>

1063
00:39:22,029 --> 00:39:24,819
current directory and to answer isn't an

1064
00:39:23,650 --> 00:39:26,859
awful lot there but it's just there for

1065
00:39:24,819 --> 00:39:29,650
information here for something<font color="#E5E5E5"> that was</font>

1066
00:39:26,859 --> 00:39:31,719
new to I<font color="#E5E5E5"> think it's 2013 was the equals</font>

1067
00:39:29,650 --> 00:39:32,950
web service a function I thought well

1068
00:39:31,719 --> 00:39:35,140
that sounds interesting<font color="#E5E5E5"> it's it's</font>

1069
00:39:32,950 --> 00:39:37,718
automatically making an HTTP request to

1070
00:39:35,140 --> 00:39:39,069
you know an arbitrary site unfortunately

1071
00:39:37,719 --> 00:39:40,210
I couldn't get it to do ntlm

1072
00:39:39,069 --> 00:39:42,279
authentication it doesn't seem<font color="#E5E5E5"> to</font>

1073
00:39:40,210 --> 00:39:46,359
support anything very exciting you know

1074
00:39:42,279 --> 00:39:48,309
<font color="#CCCCCC">I tried getting it to you grab a file to</font>

1075
00:39:46,359 --> 00:39:49,989
use UNC past and all that kind of stuff

1076
00:39:48,309 --> 00:39:52,509
and<font color="#E5E5E5"> it wasn't it wasn't happy look it</font>

1077
00:39:49,989 --> 00:39:54,069
looked fairly lockdown to me but the

1078
00:39:52,509 --> 00:39:56,109
only thing I've found of interest was

1079
00:39:54,069 --> 00:39:58,029
that it allows you to steal data without

1080
00:39:56,109 --> 00:39:59,619
someone clicking a hyperlink because

1081
00:39:58,029 --> 00:40:02,499
equals web service it will actually

1082
00:39:59,619 --> 00:40:03,549
automatically go and grab<font color="#CCCCCC"> that so at the</font>

1083
00:40:02,499 --> 00:40:05,618
top there you've<font color="#CCCCCC"> got a hyperlink</font>

1084
00:40:03,549 --> 00:40:07,119
someone's got to click in this equals

1085
00:40:05,619 --> 00:40:09,700
web service it's a way of stealing data

1086
00:40:07,119 --> 00:40:11,769
automatically<font color="#CCCCCC"> and the</font><font color="#E5E5E5"> only other</font>

1087
00:40:09,700 --> 00:40:14,069
function that I could see that yes you

1088
00:40:11,769 --> 00:40:17,618
know sprung out was equals filter XML

1089
00:40:14,069 --> 00:40:20,380
and we all know XML parsing is quite

1090
00:40:17,619 --> 00:40:21,489
dangerous I had a very quick poke at it

1091
00:40:20,380 --> 00:40:23,170
I wouldn't<font color="#E5E5E5"> say it was exhaustive</font>

1092
00:40:21,489 --> 00:40:25,119
couldn't see anything but it's you know

1093
00:40:23,170 --> 00:40:27,579
therefore interest so the in terms of

1094
00:40:25,119 --> 00:40:29,650
functions that<font color="#E5E5E5"> wouldn't produce the CMD</font>

1095
00:40:27,579 --> 00:40:31,299
door XE warning because they are<font color="#CCCCCC"> native</font>

1096
00:40:29,650 --> 00:40:32,650
to excel you know there wasn't all that

1097
00:40:31,299 --> 00:40:34,509
much sort of the right that you know

1098
00:40:32,650 --> 00:40:36,789
<font color="#E5E5E5">that i could see so what about</font>

1099
00:40:34,509 --> 00:40:38,680
alternatives to running CMD door XC<font color="#E5E5E5"> i</font>

1100
00:40:36,789 --> 00:40:40,599
thought you<font color="#CCCCCC"> know could we get a process</font>

1101
00:40:38,680 --> 00:40:42,879
running that a user might sort of trust

1102
00:40:40,599 --> 00:40:45,880
more I just started poking around with

1103
00:40:42,880 --> 00:40:47,140
stuff that<font color="#CCCCCC"> would be of interest you know</font>

1104
00:40:45,880 --> 00:40:49,059
whether someone would be happier

1105
00:40:47,140 --> 00:40:50,979
clicking on<font color="#E5E5E5"> a link that had you know</font>

1106
00:40:49,059 --> 00:40:52,420
powershell door XD I you know I don't

1107
00:40:50,979 --> 00:40:53,859
<font color="#E5E5E5">know but I just thought</font><font color="#CCCCCC"> a little</font><font color="#E5E5E5"> poke</font>

1108
00:40:52,420 --> 00:40:56,410
around to see what you could do one

1109
00:40:53,859 --> 00:40:59,650
thing I<font color="#CCCCCC"> noticed is that in my setup and</font>

1110
00:40:56,410 --> 00:41:01,690
I tried this across various different

1111
00:40:59,650 --> 00:41:04,989
versions of Excel and operating systems

1112
00:41:01,690 --> 00:41:07,599
and when I<font color="#E5E5E5"> fly and ran something like</font>

1113
00:41:04,989 --> 00:41:10,779
equals power shell which obviously isn't

1114
00:41:07,599 --> 00:41:12,700
a DD service listening in the<font color="#E5E5E5"> operating</font>

1115
00:41:10,779 --> 00:41:14,769
system so Excel goes<font color="#CCCCCC"> alright I'll</font><font color="#E5E5E5"> have a</font>

1116
00:41:12,700 --> 00:41:16,899
go running this it says do you want<font color="#E5E5E5"> to</font>

1117
00:41:14,769 --> 00:41:19,720
run power sheet or XE which sounds like

1118
00:41:16,900 --> 00:41:21,430
<font color="#E5E5E5">I'm some kind of superhero and</font>

1119
00:41:19,720 --> 00:41:24,459
and that obviously isn't going to work

1120
00:41:21,430 --> 00:41:27,549
so you can see it's got that 883 kind of

1121
00:41:24,460 --> 00:41:30,460
format to it isn't it I saw as a blog

1122
00:41:27,550 --> 00:41:32,500
posting by<font color="#E5E5E5"> Andy I think at zephyr fish</font>

1123
00:41:30,460 --> 00:41:34,720
and he and and he seemed to<font color="#E5E5E5"> have got the</font>

1124
00:41:32,500 --> 00:41:36,940
the equals power shelter to work fine

1125
00:41:34,720 --> 00:41:38,049
<font color="#CCCCCC">but it didn't in my case so the fact</font>

1126
00:41:36,940 --> 00:41:39,700
that there are two different conditions

1127
00:41:38,050 --> 00:41:41,560
there you've<font color="#E5E5E5"> got to be careful what</font>

1128
00:41:39,700 --> 00:41:44,200
<font color="#E5E5E5">you're running because it could</font><font color="#CCCCCC"> be that</font>

1129
00:41:41,560 --> 00:41:45,310
that on the victim machine if you've<font color="#E5E5E5"> got</font>

1130
00:41:44,200 --> 00:41:47,609
something that's longer than eight

1131
00:41:45,310 --> 00:41:49,509
characters dot X see it's going<font color="#E5E5E5"> to fail</font>

1132
00:41:47,609 --> 00:41:51,880
obviously you can always run powershell

1133
00:41:49,510 --> 00:41:53,109
by by invoking it like this with equal

1134
00:41:51,880 --> 00:41:56,020
CMD well then we're back to where we

1135
00:41:53,109 --> 00:41:58,090
started so<font color="#E5E5E5"> I looked at some XE files in</font>

1136
00:41:56,020 --> 00:41:59,590
the path where<font color="#E5E5E5"> the file names were less</font>

1137
00:41:58,090 --> 00:42:01,480
than<font color="#E5E5E5"> 12 characters you know and there's</font>

1138
00:41:59,590 --> 00:42:03,119
<font color="#E5E5E5">plenty</font><font color="#CCCCCC"> of fun you can have equals</font>

1139
00:42:01,480 --> 00:42:06,400
<font color="#CCCCCC">explorer will open the default browser</font>

1140
00:42:03,119 --> 00:42:08,530
you can schedule tasks you can pull down

1141
00:42:06,400 --> 00:42:10,960
this is java web start so it will go<font color="#E5E5E5"> and</font>

1142
00:42:08,530 --> 00:42:13,119
grab<font color="#CCCCCC"> that and run it and run the ll30 to</font>

1143
00:42:10,960 --> 00:42:15,730
do as an equivalent here invoking this

1144
00:42:13,119 --> 00:42:18,480
dll function is an equivalent way of

1145
00:42:15,730 --> 00:42:21,609
running CMD but without it saying CMD

1146
00:42:18,480 --> 00:42:22,720
trouble is for each of these it was

1147
00:42:21,609 --> 00:42:24,279
still going<font color="#E5E5E5"> to get</font><font color="#CCCCCC"> a warning it's still</font>

1148
00:42:22,720 --> 00:42:28,089
<font color="#E5E5E5">going to</font><font color="#CCCCCC"> say do you</font><font color="#E5E5E5"> want to run</font><font color="#CCCCCC"> explore</font>

1149
00:42:24,280 --> 00:42:29,920
<font color="#CCCCCC">direct see some you know they use a may</font>

1150
00:42:28,089 --> 00:42:30,940
be happier more happy with<font color="#CCCCCC"> that than CMD</font>

1151
00:42:29,920 --> 00:42:32,440
at the end<font color="#CCCCCC"> of the day we're still</font>

1152
00:42:30,940 --> 00:42:33,849
getting a warning and we're<font color="#CCCCCC"> getting that</font>

1153
00:42:32,440 --> 00:42:37,089
warning because none of these<font color="#CCCCCC"> are</font>

1154
00:42:33,849 --> 00:42:40,869
actually dde calls so my next thought

1155
00:42:37,089 --> 00:42:43,240
<font color="#E5E5E5">was well what what you know what what</font>

1156
00:42:40,869 --> 00:42:46,210
what is natively listening on this sort

1157
00:42:43,240 --> 00:42:49,149
of DDE platform you know what can I take

1158
00:42:46,210 --> 00:42:52,089
advantage of so I found<font color="#E5E5E5"> this tool called</font>

1159
00:42:49,150 --> 00:42:54,070
TCL tool command language and it has a

1160
00:42:52,089 --> 00:42:56,650
sort of DDE client and server package

1161
00:42:54,070 --> 00:42:58,330
which i got running and then<font color="#E5E5E5"> I just</font>

1162
00:42:56,650 --> 00:42:59,740
asked it to list the available dde

1163
00:42:58,330 --> 00:43:01,359
services that are you know that the

1164
00:42:59,740 --> 00:43:03,640
operating system was was currently

1165
00:43:01,359 --> 00:43:06,970
supporting with various apps so a few

1166
00:43:03,640 --> 00:43:09,790
<font color="#CCCCCC">things popped out</font><font color="#E5E5E5"> as a excel so Excel</font>

1167
00:43:06,970 --> 00:43:16,089
itself is addy is offering a dde

1168
00:43:09,790 --> 00:43:17,859
interface shell one called folders one

1169
00:43:16,089 --> 00:43:19,299
called<font color="#E5E5E5"> prog man so I had a little look</font>

1170
00:43:17,859 --> 00:43:20,890
at what these actually what these

1171
00:43:19,300 --> 00:43:22,359
actually do because if<font color="#E5E5E5"> I can make calls</font>

1172
00:43:20,890 --> 00:43:24,339
to these then I wouldn't<font color="#E5E5E5"> get that</font>

1173
00:43:22,359 --> 00:43:26,740
warning because Excel would be happy

1174
00:43:24,339 --> 00:43:28,060
that it was<font color="#E5E5E5"> that you know that the call</font>

1175
00:43:26,740 --> 00:43:31,359
was working so I thought well what can I

1176
00:43:28,060 --> 00:43:33,250
do with these so<font color="#E5E5E5"> using the dde client as</font>

1177
00:43:31,359 --> 00:43:34,960
part of TCL add a little bit of a poke

1178
00:43:33,250 --> 00:43:37,900
you know and<font color="#E5E5E5"> I found out</font><font color="#CCCCCC"> that you could</font>

1179
00:43:34,960 --> 00:43:39,310
pull out data which i found kind of

1180
00:43:37,900 --> 00:43:42,040
interesting that you have an<font color="#CCCCCC"> Excel app</font>

1181
00:43:39,310 --> 00:43:43,779
over here<font color="#E5E5E5"> and a program over here and</font>

1182
00:43:42,040 --> 00:43:46,600
this<font color="#E5E5E5"> program can read the contents of</font>

1183
00:43:43,780 --> 00:43:48,760
the worksheet just you<font color="#E5E5E5"> know sort of kind</font>

1184
00:43:46,600 --> 00:43:51,100
<font color="#E5E5E5">of interesting you could also sort of</font>

1185
00:43:48,760 --> 00:43:53,680
programmatically from this dde client

1186
00:43:51,100 --> 00:43:57,490
tell Excel to run a limited form of

1187
00:43:53,680 --> 00:43:59,020
macro so you know<font color="#E5E5E5"> some some alert and</font>

1188
00:43:57,490 --> 00:44:00,459
you can string<font color="#E5E5E5"> them together like this I</font>

1189
00:43:59,020 --> 00:44:02,560
thought that<font color="#CCCCCC"> was interesting because if</font>

1190
00:44:00,460 --> 00:44:04,110
you can<font color="#CCCCCC"> get macros running then you know</font>

1191
00:44:02,560 --> 00:44:07,779
you might be<font color="#E5E5E5"> to get command execution</font>

1192
00:44:04,110 --> 00:44:10,000
and but it turns out this macro format

1193
00:44:07,780 --> 00:44:12,970
is extremely old I mean dde itself is

1194
00:44:10,000 --> 00:44:15,010
very very<font color="#E5E5E5"> old and this is in the what's</font>

1195
00:44:12,970 --> 00:44:16,779
known as the xlm<font color="#CCCCCC"> either get its format</font>

1196
00:44:15,010 --> 00:44:19,180
this is like pre visual basic<font color="#E5E5E5"> there's</font>

1197
00:44:16,780 --> 00:44:21,430
macros before VBS as this is pretty

1198
00:44:19,180 --> 00:44:23,440
dated and there's some interesting

1199
00:44:21,430 --> 00:44:27,430
operations that most important one was

1200
00:44:23,440 --> 00:44:29,890
<font color="#CCCCCC">xik and that is a legitimate macro</font>

1201
00:44:27,430 --> 00:44:32,109
command in xlm world but it did not<font color="#CCCCCC"> want</font>

1202
00:44:29,890 --> 00:44:33,970
to<font color="#E5E5E5"> work in this case unfortunately so</font>

1203
00:44:32,110 --> 00:44:35,200
that was that was a bit of<font color="#E5E5E5"> a shame so I</font>

1204
00:44:33,970 --> 00:44:37,390
started looking at some<font color="#CCCCCC"> of the other</font>

1205
00:44:35,200 --> 00:44:39,669
ones what<font color="#E5E5E5"> does this prog man thing do</font>

1206
00:44:37,390 --> 00:44:42,279
program manager it seems<font color="#E5E5E5"> to control</font>

1207
00:44:39,670 --> 00:44:43,930
shortcuts and<font color="#E5E5E5"> things like that so</font><font color="#CCCCCC"> you</font>

1208
00:44:42,280 --> 00:44:46,150
could you could you can you can with a

1209
00:44:43,930 --> 00:44:48,190
dde call tell the program manager to

1210
00:44:46,150 --> 00:44:49,720
create a shortcut and you know you could

1211
00:44:48,190 --> 00:44:51,790
make it look like something<font color="#E5E5E5"> you know</font>

1212
00:44:49,720 --> 00:44:54,459
something else so here I've just called

1213
00:44:51,790 --> 00:44:55,930
calc I've got a hyperlink a shortcut

1214
00:44:54,460 --> 00:44:57,670
called microsoft word that actually

1215
00:44:55,930 --> 00:44:59,410
points to<font color="#E5E5E5"> calcutta lexi and when you</font>

1216
00:44:57,670 --> 00:45:01,540
start in your<font color="#E5E5E5"> search bar searching for</font>

1217
00:44:59,410 --> 00:45:05,259
word it you know it pops up you know

1218
00:45:01,540 --> 00:45:07,690
pops up in there as an alternative in

1219
00:45:05,260 --> 00:45:12,610
terms of folders and she'll these other

1220
00:45:07,690 --> 00:45:14,800
dde services you could essentially you

1221
00:45:12,610 --> 00:45:16,090
know run a similar attack to what I you

1222
00:45:14,800 --> 00:45:17,470
know what is it in the pen test job

1223
00:45:16,090 --> 00:45:19,000
where you're getting it to connect to a

1224
00:45:17,470 --> 00:45:21,580
network share and as a result of that

1225
00:45:19,000 --> 00:45:23,140
you can still the ntlm you know hashes

1226
00:45:21,580 --> 00:45:26,710
but the trouble with all this is that

1227
00:45:23,140 --> 00:45:28,830
<font color="#E5E5E5">there's sod all documentation it was so</font>

1228
00:45:26,710 --> 00:45:32,140
<font color="#CCCCCC">so hard to pull anything out at all</font>

1229
00:45:28,830 --> 00:45:33,130
probably cuz it's so old and it's kind

1230
00:45:32,140 --> 00:45:35,500
of frustrating because you just think

1231
00:45:33,130 --> 00:45:36,230
there may be something there<font color="#E5E5E5"> and you</font>

1232
00:45:35,500 --> 00:45:39,560
know you

1233
00:45:36,230 --> 00:45:41,330
I basically<font color="#CCCCCC"> ran out of time so the other</font>

1234
00:45:39,560 --> 00:45:42,590
thing I decided<font color="#E5E5E5"> was this is this is all</font>

1235
00:45:41,330 --> 00:45:44,630
very<font color="#E5E5E5"> well and good if I can do this</font>

1236
00:45:42,590 --> 00:45:45,920
using a dde client but if I can't get it

1237
00:45:44,630 --> 00:45:47,810
working in Excel and the whole thing<font color="#CCCCCC"> is</font>

1238
00:45:45,920 --> 00:45:50,180
<font color="#CCCCCC">pointless so what happens when we take</font>

1239
00:45:47,810 --> 00:45:52,009
these dde calls that are in a DD client

1240
00:45:50,180 --> 00:45:54,890
and try<font color="#CCCCCC"> and put them in excel in the</font>

1241
00:45:52,010 --> 00:45:58,280
format equals service topic you know

1242
00:45:54,890 --> 00:46:00,740
item so this could save you hours by<font color="#E5E5E5"> the</font>

1243
00:45:58,280 --> 00:46:02,780
way if you do decide to have a play with

1244
00:46:00,740 --> 00:46:04,759
this because this this really threw me

1245
00:46:02,780 --> 00:46:07,250
when<font color="#E5E5E5"> I was doing my testing I was</font>

1246
00:46:04,760 --> 00:46:08,690
putting in these equals service topic

1247
00:46:07,250 --> 00:46:11,060
you know<font color="#E5E5E5"> these kind of DDE calls and</font>

1248
00:46:08,690 --> 00:46:13,369
nothing was happening I thought well you

1249
00:46:11,060 --> 00:46:16,130
know I don't<font color="#CCCCCC"> why's networking turns out</font>

1250
00:46:13,369 --> 00:46:17,690
for the vast majority that the TCL

1251
00:46:16,130 --> 00:46:19,490
program which<font color="#E5E5E5"> I happen to have running</font>

1252
00:46:17,690 --> 00:46:21,980
as my<font color="#E5E5E5"> DD clients seem to be interfering</font>

1253
00:46:19,490 --> 00:46:24,500
it with some way so if<font color="#E5E5E5"> you are joking</font>

1254
00:46:21,980 --> 00:46:26,420
<font color="#CCCCCC">around then</font><font color="#E5E5E5"> just be wary that you may</font>

1255
00:46:24,500 --> 00:46:28,580
know there could be some interference in

1256
00:46:26,420 --> 00:46:30,320
the messaging system I don't know why

1257
00:46:28,580 --> 00:46:34,069
but but there you go soon<font color="#E5E5E5"> as I close my</font>

1258
00:46:30,320 --> 00:46:35,359
DD client it kind of ran again so so be

1259
00:46:34,070 --> 00:46:39,530
wary of that if you if you decide to

1260
00:46:35,359 --> 00:46:41,029
have a play so I didn't<font color="#E5E5E5"> have all that</font>

1261
00:46:39,530 --> 00:46:44,510
much luck with some<font color="#E5E5E5"> of the things that</font><font color="#CCCCCC"> I</font>

1262
00:46:41,030 --> 00:46:45,980
was that I<font color="#E5E5E5"> just pulled out from my</font>

1263
00:46:44,510 --> 00:46:48,290
experimentation with the client so for

1264
00:46:45,980 --> 00:46:53,060
example if<font color="#E5E5E5"> I tried to take this dde</font>

1265
00:46:48,290 --> 00:46:54,619
client dde call and put it in a sort of

1266
00:46:53,060 --> 00:46:57,200
<font color="#CCCCCC">Excel format where you were kind of</font>

1267
00:46:54,619 --> 00:46:59,090
getting equals folders at properties and

1268
00:46:57,200 --> 00:47:00,439
then trying to feed it some data it

1269
00:46:59,090 --> 00:47:02,119
didn't seem<font color="#CCCCCC"> to be happy</font><font color="#E5E5E5"> I tried doing</font>

1270
00:47:00,440 --> 00:47:04,670
escapes I tried doing all sorts of

1271
00:47:02,119 --> 00:47:06,710
things<font color="#E5E5E5"> and I couldn't get it to work so</font>

1272
00:47:04,670 --> 00:47:08,780
then I<font color="#CCCCCC"> thought well okay well what else</font>

1273
00:47:06,710 --> 00:47:11,180
what else could I do so I then found out

1274
00:47:08,780 --> 00:47:12,560
that<font color="#E5E5E5"> the dde client was not telling me</font>

1275
00:47:11,180 --> 00:47:14,000
<font color="#CCCCCC">about all the services that were</font>

1276
00:47:12,560 --> 00:47:16,580
listening you know<font color="#E5E5E5"> there was this prog</font>

1277
00:47:14,000 --> 00:47:18,200
man excel and so forth it wasn't it

1278
00:47:16,580 --> 00:47:20,270
wasn't actually<font color="#E5E5E5"> complete and I pulled</font>

1279
00:47:18,200 --> 00:47:22,368
out<font color="#E5E5E5"> this tool called DD east by which is</font>

1280
00:47:20,270 --> 00:47:25,580
part of visual studio 6 like I<font color="#CCCCCC"> told you</font>

1281
00:47:22,369 --> 00:47:26,390
this was old and if that's running at

1282
00:47:25,580 --> 00:47:28,759
the time that you're launching

1283
00:47:26,390 --> 00:47:31,940
applications it gives you some hints as

1284
00:47:28,760 --> 00:47:33,920
to what dde<font color="#E5E5E5"> API if you like they're</font>

1285
00:47:31,940 --> 00:47:36,410
exposing so it turns<font color="#E5E5E5"> out the browsers</font>

1286
00:47:33,920 --> 00:47:40,310
are exposing some as well so I Explorer

1287
00:47:36,410 --> 00:47:42,470
and Firefox and there are some methods

1288
00:47:40,310 --> 00:47:45,470
although they're called topics in dde

1289
00:47:42,470 --> 00:47:47,660
world so I<font color="#CCCCCC"> explorer is the name of the</font>

1290
00:47:45,470 --> 00:47:49,160
service and you know these<font color="#CCCCCC"> are the name</font>

1291
00:47:47,660 --> 00:47:49,970
of the topics so I started having a play

1292
00:47:49,160 --> 00:47:53,029
with<font color="#E5E5E5"> that</font>

1293
00:47:49,970 --> 00:47:55,730
so I explore that that that was<font color="#E5E5E5"> quite</font>

1294
00:47:53,030 --> 00:47:58,609
happy working in Excel probably because

1295
00:47:55,730 --> 00:47:59,840
the what the<font color="#CCCCCC"> cut maybe because</font><font color="#E5E5E5"> the</font>

1296
00:47:58,609 --> 00:48:02,690
characters that I were using were much

1297
00:47:59,840 --> 00:48:06,260
simpler so if you put<font color="#E5E5E5"> equals I explore</font>

1298
00:48:02,690 --> 00:48:08,150
and ww openurl<font color="#E5E5E5"> ncc group com for example</font>

1299
00:48:06,260 --> 00:48:11,900
in a spreadsheet it will just you know

1300
00:48:08,150 --> 00:48:14,000
you know point Internet Explorer to that

1301
00:48:11,900 --> 00:48:16,430
URL sort of silently in the background

1302
00:48:14,000 --> 00:48:20,030
so similarly I could do a backslash

1303
00:48:16,430 --> 00:48:23,000
backslash attacker IP network share and

1304
00:48:20,030 --> 00:48:24,560
grab a hash in the same way you could

1305
00:48:23,000 --> 00:48:27,380
also try<font color="#CCCCCC"> and run an executable although</font>

1306
00:48:24,560 --> 00:48:28,790
you just get a dialog prompt almost as

1307
00:48:27,380 --> 00:48:29,810
<font color="#E5E5E5">if</font><font color="#CCCCCC"> you were downloading the file and of</font>

1308
00:48:28,790 --> 00:48:31,759
course the<font color="#E5E5E5"> whole point about this</font><font color="#CCCCCC"> is</font>

1309
00:48:29,810 --> 00:48:33,650
trying to<font color="#E5E5E5"> get rid of prompts so you know</font>

1310
00:48:31,760 --> 00:48:35,150
that wasn't<font color="#E5E5E5"> really too interesting and I</font>

1311
00:48:33,650 --> 00:48:37,490
didn't<font color="#E5E5E5"> really find a way of getting any</font>

1312
00:48:35,150 --> 00:48:40,270
command switches in there either so<font color="#CCCCCC"> you</font>

1313
00:48:37,490 --> 00:48:43,098
<font color="#CCCCCC">know</font><font color="#E5E5E5"> that really isn't going to help us</font>

1314
00:48:40,270 --> 00:48:44,750
so firefox offers a similar sort of

1315
00:48:43,099 --> 00:48:46,940
interface the only thing that I found

1316
00:48:44,750 --> 00:48:50,090
the difference between two was a topic

1317
00:48:46,940 --> 00:48:53,140
called get window info so if you have an

1318
00:48:50,090 --> 00:48:56,780
Excel spreadsheet what has this as<font color="#E5E5E5"> its</font>

1319
00:48:53,140 --> 00:48:58,250
dde call equals<font color="#E5E5E5"> Firefox get window info</font>

1320
00:48:56,780 --> 00:49:02,450
etc and again doesn t matter what<font color="#E5E5E5"> this</font>

1321
00:48:58,250 --> 00:49:04,820
is it will pull out details of the of

1322
00:49:02,450 --> 00:49:08,029
the URL that happens to<font color="#E5E5E5"> be you know that</font>

1323
00:49:04,820 --> 00:49:10,190
you happen to be on so<font color="#E5E5E5"> let's do a little</font>

1324
00:49:08,030 --> 00:49:17,630
<font color="#E5E5E5">bit of a demo with with some excel files</font>

1325
00:49:10,190 --> 00:49:19,700
that trying<font color="#E5E5E5"> to take advantage of DDE so</font>

1326
00:49:17,630 --> 00:49:21,440
somewhere here so just got imagine this

1327
00:49:19,700 --> 00:49:23,980
is like a web app export kind of thing

1328
00:49:21,440 --> 00:49:27,770
so so here<font color="#E5E5E5"> we have a monthly report</font>

1329
00:49:23,980 --> 00:49:34,940
which we're downloading and you know

1330
00:49:27,770 --> 00:49:37,700
saving and heavy let's just oh yeah so

1331
00:49:34,940 --> 00:49:40,339
we downloaded monthly report<font color="#CCCCCC"> dr. csb and</font>

1332
00:49:37,700 --> 00:49:42,109
we open that up and nothing very

1333
00:49:40,339 --> 00:49:44,359
exciting so this is<font color="#E5E5E5"> yeah this is all</font>

1334
00:49:42,109 --> 00:49:48,890
sort<font color="#E5E5E5"> of standard test case if you like</font>

1335
00:49:44,359 --> 00:49:50,779
so this<font color="#E5E5E5"> is our CSV file so Rams of this</font>

1336
00:49:48,890 --> 00:49:55,578
is malicious

1337
00:49:50,779 --> 00:49:59,589
so we're going<font color="#E5E5E5"> to</font><font color="#CCCCCC"> open that actually</font>

1338
00:49:55,579 --> 00:49:59,589
what save it and I've got a copy of it

1339
00:49:59,769 --> 00:50:08,238
sounds working<font color="#CCCCCC"> ya know BR so here we've</font>

1340
00:50:05,659 --> 00:50:09,529
now over wrote that CSV file with a new

1341
00:50:08,239 --> 00:50:14,119
one that's malicious so let's open<font color="#E5E5E5"> that</font>

1342
00:50:09,529 --> 00:50:15,919
up now we've got no protected view

1343
00:50:14,119 --> 00:50:17,299
warning so this has come from<font color="#E5E5E5"> the</font>

1344
00:50:15,919 --> 00:50:20,209
internet we've got no protected view

1345
00:50:17,299 --> 00:50:21,499
warning because this is a CSV file but

1346
00:50:20,209 --> 00:50:23,509
we do have the security warning because

1347
00:50:21,499 --> 00:50:25,098
it realizes there's some kind of content

1348
00:50:23,509 --> 00:50:27,499
in there which is active if you like so

1349
00:50:25,099 --> 00:50:29,839
we if we enable that now<font color="#E5E5E5"> you can see</font>

1350
00:50:27,499 --> 00:50:32,689
back in<font color="#E5E5E5"> the background in the background</font>

1351
00:50:29,839 --> 00:50:34,939
the browser has been navigated away to a

1352
00:50:32,689 --> 00:50:36,049
completely different URL and obviously

1353
00:50:34,939 --> 00:50:37,969
the point of this is through like a

1354
00:50:36,049 --> 00:50:41,538
fishing exercise so imagine that you're

1355
00:50:37,969 --> 00:50:43,309
you're doing your web app export you can

1356
00:50:41,539 --> 00:50:45,169
put in a payload which sauce which in

1357
00:50:43,309 --> 00:50:47,179
the background navigates the user to

1358
00:50:45,169 --> 00:50:48,679
some arbitrary site that site is<font color="#CCCCCC"> our</font>

1359
00:50:47,179 --> 00:50:50,449
fishing site and is<font color="#E5E5E5"> meant to look like</font>

1360
00:50:48,679 --> 00:50:53,539
the original site there's the original

1361
00:50:50,449 --> 00:50:56,169
site but it's got a login prompt there

1362
00:50:53,539 --> 00:50:59,209
so you could quite easily be you know

1363
00:50:56,169 --> 00:51:02,328
downloading a malicious Excel format

1364
00:50:59,209 --> 00:51:04,249
excel file running it you can see

1365
00:51:02,329 --> 00:51:08,150
there's<font color="#CCCCCC"> no nothing</font><font color="#E5E5E5"> obvious there's a</font>

1366
00:51:04,249 --> 00:51:10,038
problem<font color="#CCCCCC"> and in the background you flick</font>

1367
00:51:08,150 --> 00:51:11,959
back to here and you think oh my

1368
00:51:10,039 --> 00:51:13,880
sessions timed out now you know and<font color="#CCCCCC"> you</font>

1369
00:51:11,959 --> 00:51:14,868
put in your credentials and you're

1370
00:51:13,880 --> 00:51:18,109
actually giving it to the to the

1371
00:51:14,869 --> 00:51:20,269
attacker so the cool air is simply have

1372
00:51:18,109 --> 00:51:22,308
you read that but yeah so equals Firefox

1373
00:51:20,269 --> 00:51:23,808
is<font color="#E5E5E5"> just using a dde call so this time</font>

1374
00:51:22,309 --> 00:51:26,779
<font color="#CCCCCC">we're not getting do you want to run</font>

1375
00:51:23,809 --> 00:51:28,969
<font color="#E5E5E5">Firefox talk XE because that is a</font>

1376
00:51:26,779 --> 00:51:30,679
legitimate<font color="#E5E5E5"> call the dde service was</font>

1377
00:51:28,969 --> 00:51:34,869
responding so you don't get the error

1378
00:51:30,679 --> 00:51:38,929
message so here we're never getting off

1379
00:51:34,869 --> 00:51:40,699
so let's do a final demo which is<font color="#E5E5E5"> just</font>

1380
00:51:38,929 --> 00:51:41,890
like if the stars are aligned if you

1381
00:51:40,699 --> 00:51:43,789
like so<font color="#E5E5E5"> this is when everything is</font>

1382
00:51:41,890 --> 00:51:51,348
working correctly so let's just get

1383
00:51:43,789 --> 00:51:55,549
responder running yes so with here we've

1384
00:51:51,349 --> 00:52:01,059
got<font color="#CCCCCC"> an SMB server on so let's</font><font color="#E5E5E5"> now</font>

1385
00:51:55,549 --> 00:52:01,059
download this malicious file

1386
00:52:02,010 --> 00:52:14,080
yeah replace that and open it so here

1387
00:52:12,130 --> 00:52:21,490
we've got a slightly different call in

1388
00:52:14,080 --> 00:52:23,350
here let's go back to our responder and

1389
00:52:21,490 --> 00:52:26,259
there you<font color="#E5E5E5"> go so you've got you've got an</font>

1390
00:52:23,350 --> 00:52:29,440
NT lmv to exchange going on in the

1391
00:52:26,260 --> 00:52:34,090
background with<font color="#E5E5E5"> no warnings and so there</font>

1392
00:52:29,440 --> 00:52:35,830
is the very similar sort of payload to

1393
00:52:34,090 --> 00:52:39,070
the previous one all I'm<font color="#CCCCCC"> doing is</font>

1394
00:52:35,830 --> 00:52:40,600
pointing it to a UNC path and you can

1395
00:52:39,070 --> 00:52:41,800
see that it has actually tried<font color="#CCCCCC"> to open</font>

1396
00:52:40,600 --> 00:52:44,440
it in Firefox that's happened in the

1397
00:52:41,800 --> 00:52:47,620
background it's just got a blank blank

1398
00:52:44,440 --> 00:52:49,830
page so without<font color="#E5E5E5"> any warning that that</font>

1399
00:52:47,620 --> 00:52:56,170
you're<font color="#E5E5E5"> going to do this you know you</font>

1400
00:52:49,830 --> 00:52:58,150
back to stop stealing hashes so for

1401
00:52:56,170 --> 00:53:04,360
<font color="#E5E5E5">farmer presentation we just saw round</font>

1402
00:52:58,150 --> 00:53:06,340
this up so exactly what happened there

1403
00:53:04,360 --> 00:53:09,370
because I got absolutely no warnings

1404
00:53:06,340 --> 00:53:11,530
whatsoever so in order to get rid of

1405
00:53:09,370 --> 00:53:14,560
some<font color="#CCCCCC"> of the security warnings I had to</font>

1406
00:53:11,530 --> 00:53:17,800
have previously downloaded out<font color="#E5E5E5"> file with</font>

1407
00:53:14,560 --> 00:53:19,000
them and accepted the warning before so

1408
00:53:17,800 --> 00:53:22,510
remember<font color="#CCCCCC"> that this needn't have</font>

1409
00:53:19,000 --> 00:53:24,970
previously been malicious and this is

1410
00:53:22,510 --> 00:53:26,980
kind of sort<font color="#E5E5E5"> of rather exceptional the</font>

1411
00:53:24,970 --> 00:53:29,980
main I think the main warning that you

1412
00:53:26,980 --> 00:53:31,240
can tackle potentially is the is the CMD

1413
00:53:29,980 --> 00:53:32,350
<font color="#CCCCCC">door XE warning i think that's the one</font>

1414
00:53:31,240 --> 00:53:36,279
<font color="#E5E5E5">that you probably got the most control</font>

1415
00:53:32,350 --> 00:53:38,319
over so what lessons have we learnt

1416
00:53:36,280 --> 00:53:40,360
there so excel export is definitely

1417
00:53:38,320 --> 00:53:41,710
something to pay attention to with web

1418
00:53:40,360 --> 00:53:43,810
apps and I you know<font color="#CCCCCC"> I don't</font><font color="#E5E5E5"> know whether</font>

1419
00:53:41,710 --> 00:53:45,070
how many of<font color="#E5E5E5"> us pen testers and what kind</font>

1420
00:53:43,810 --> 00:53:47,590
of background here but if<font color="#CCCCCC"> you're new</font><font color="#E5E5E5"> to</font>

1421
00:53:45,070 --> 00:53:50,320
<font color="#E5E5E5">it definitely sort of look that up csv</font>

1422
00:53:47,590 --> 00:53:53,380
is definitely not a benign format dde is

1423
00:53:50,320 --> 00:53:54,820
not the same as macros so Excel files

1424
00:53:53,380 --> 00:53:57,580
that are being if you're talking<font color="#E5E5E5"> about</font>

1425
00:53:54,820 --> 00:54:00,610
emailing you know from<font color="#E5E5E5"> a red team point</font>

1426
00:53:57,580 --> 00:54:02,529
of view emailing<font color="#CCCCCC"> Excel files then even</font>

1427
00:54:00,610 --> 00:54:04,720
if they're catching macros then you can

1428
00:54:02,530 --> 00:54:07,180
you know possibly bypass that with using

1429
00:54:04,720 --> 00:54:10,540
dde calls in some case it's possible to

1430
00:54:07,180 --> 00:54:11,980
cut down<font color="#CCCCCC"> the Excel warnings and I excel</font>

1431
00:54:10,540 --> 00:54:13,570
may have<font color="#E5E5E5"> more</font><font color="#CCCCCC"> to give in this area this</font>

1432
00:54:11,980 --> 00:54:15,070
is kind of working progress you know I

1433
00:54:13,570 --> 00:54:19,000
as far as I could<font color="#CCCCCC"> you know I kind of</font>

1434
00:54:15,070 --> 00:54:20,260
finish this on Tuesday you<font color="#CCCCCC"> know I pushed</font>

1435
00:54:19,000 --> 00:54:21,820
<font color="#E5E5E5">it as far as I</font><font color="#CCCCCC"> could you know</font>

1436
00:54:20,260 --> 00:54:23,110
unfortunate there was no like obvious

1437
00:54:21,820 --> 00:54:25,030
sort of command execution that I could

1438
00:54:23,110 --> 00:54:26,470
find but you've seen<font color="#E5E5E5"> the</font><font color="#CCCCCC"> principles you</font>

1439
00:54:25,030 --> 00:54:28,900
can see<font color="#E5E5E5"> that if you</font><font color="#CCCCCC"> are making</font><font color="#E5E5E5"> d D</font>

1440
00:54:26,470 --> 00:54:30,370
equals you don't get warnings that<font color="#CCCCCC"> their</font>

1441
00:54:28,900 --> 00:54:31,420
that they're running and if you can poke

1442
00:54:30,370 --> 00:54:33,549
the right thing there may be something

1443
00:54:31,420 --> 00:54:34,840
more here so please you know go<font color="#E5E5E5"> away and</font>

1444
00:54:33,550 --> 00:54:36,760
explore this I'm certain going<font color="#E5E5E5"> to have a</font>

1445
00:54:34,840 --> 00:54:38,530
little more of a poke there's certainly

1446
00:54:36,760 --> 00:54:40,420
applies to red teaming as well not just

1447
00:54:38,530 --> 00:54:41,920
<font color="#E5E5E5">where our export because you know</font>

1448
00:54:40,420 --> 00:54:45,520
<font color="#E5E5E5">ultimately you're trying to get command</font>

1449
00:54:41,920 --> 00:54:46,870
execution and just at the end there this

1450
00:54:45,520 --> 00:54:48,910
is more about the sort<font color="#CCCCCC"> of problems I had</font>

1451
00:54:46,870 --> 00:54:50,350
with cracking hashes you know the closer

1452
00:54:48,910 --> 00:54:52,149
that you can get to developing test

1453
00:54:50,350 --> 00:54:54,339
cases that match your environment you

1454
00:54:52,150 --> 00:54:56,740
<font color="#E5E5E5">know that the better read errors wow</font>

1455
00:54:54,340 --> 00:54:58,000
it's so quickly too it's so easy to it

1456
00:54:56,740 --> 00:54:59,979
<font color="#E5E5E5">could be telling</font><font color="#CCCCCC"> you what's wrong and</font>

1457
00:54:58,000 --> 00:55:02,290
<font color="#CCCCCC">you're</font><font color="#E5E5E5"> just so so obsessed with the fact</font>

1458
00:54:59,980 --> 00:55:05,110
that it hasn't actually worked that you

1459
00:55:02,290 --> 00:55:06,940
kind of forget the error message so

1460
00:55:05,110 --> 00:55:09,610
quick word on defense the original

1461
00:55:06,940 --> 00:55:11,830
article said that we should prefix the

1462
00:55:09,610 --> 00:55:14,200
eat anything beginning with equals with

1463
00:55:11,830 --> 00:55:17,049
a with an apostrophe that will cast the

1464
00:55:14,200 --> 00:55:18,970
sellers text but we know<font color="#E5E5E5"> and this has</font>

1465
00:55:17,050 --> 00:55:20,560
actually got a little<font color="#E5E5E5"> bit more of</font><font color="#CCCCCC"> a an</font>

1466
00:55:18,970 --> 00:55:22,779
uplift sort of in the<font color="#E5E5E5"> last couple of</font>

1467
00:55:20,560 --> 00:55:23,950
months<font color="#E5E5E5"> this this sort of topic went</font>

1468
00:55:22,780 --> 00:55:25,150
quite quiet for a while which is<font color="#E5E5E5"> why I</font>

1469
00:55:23,950 --> 00:55:26,500
decided to talk<font color="#CCCCCC"> about it and</font><font color="#E5E5E5"> then</font>

1470
00:55:25,150 --> 00:55:28,840
funnily enough it sort of popped up

1471
00:55:26,500 --> 00:55:30,430
again so lots of<font color="#E5E5E5"> these different pay all</font>

1472
00:55:28,840 --> 00:55:32,170
these different payloads work so you can

1473
00:55:30,430 --> 00:55:33,700
see there that we we've got cells that

1474
00:55:32,170 --> 00:55:35,380
are working without an equal sign and

1475
00:55:33,700 --> 00:55:36,460
all sorts of stuff and with this is

1476
00:55:35,380 --> 00:55:39,280
beginning to feel<font color="#CCCCCC"> like cross-site</font>

1477
00:55:36,460 --> 00:55:40,690
scripting blacklisting here so obviously

1478
00:55:39,280 --> 00:55:42,490
what we want to do is sort of validate

1479
00:55:40,690 --> 00:55:45,190
against a white list of known unknown

1480
00:55:42,490 --> 00:55:46,270
good which should be of no surprise so

1481
00:55:45,190 --> 00:55:48,700
when the slides eventually<font color="#E5E5E5"> make their</font>

1482
00:55:46,270 --> 00:55:50,740
way<font color="#E5E5E5"> to the</font><font color="#CCCCCC"> Internet there's a few</font>

1483
00:55:48,700 --> 00:55:53,680
references and things to to look out of

1484
00:55:50,740 --> 00:55:56,740
<font color="#E5E5E5">some dde some hash gap test files where</font>

1485
00:55:53,680 --> 00:55:58,390
this cat flap script is and some

1486
00:55:56,740 --> 00:56:00,520
appendices about how I'm pulling out

1487
00:55:58,390 --> 00:56:03,270
data from Wireshark and actually how I'm

1488
00:56:00,520 --> 00:56:07,050
sort<font color="#CCCCCC"> of recalculating the ntlm v2 and</font>

1489
00:56:03,270 --> 00:56:11,759
that's it so I don't<font color="#CCCCCC"> know whether anyone</font>

1490
00:56:07,050 --> 00:56:11,760
has any any questions

1491
00:56:16,329 --> 00:56:21,229
so I'm<font color="#E5E5E5"> not</font><font color="#CCCCCC"> exactly doing a</font><font color="#E5E5E5"> root dance</font>

1492
00:56:18,769 --> 00:56:22,669
here all right but there's some I feel

1493
00:56:21,229 --> 00:56:23,868
like there's some progress you know and

1494
00:56:22,669 --> 00:56:25,578
trying to cut down those warnings and

1495
00:56:23,869 --> 00:56:27,380
there may be more so<font color="#E5E5E5"> this is a bit of an</font>

1496
00:56:25,579 --> 00:56:28,519
open<font color="#E5E5E5"> calls people to go and have a look</font>

1497
00:56:27,380 --> 00:56:30,169
because I<font color="#CCCCCC"> think</font><font color="#E5E5E5"> there may be there may</font>

1498
00:56:28,519 --> 00:56:35,379
be more defined it's just so difficult

1499
00:56:30,169 --> 00:56:42,618
because it's just<font color="#CCCCCC"> undocumented oh yes</font>

1500
00:56:35,380 --> 00:56:45,079
<font color="#E5E5E5">yeah nope so the</font><font color="#CCCCCC"> question was whether i</font>

1501
00:56:42,619 --> 00:56:47,149
look to anything other than excel<font color="#CCCCCC"> no of</font>

1502
00:56:45,079 --> 00:56:48,829
not I know<font color="#E5E5E5"> that word is also a dde</font>

1503
00:56:47,149 --> 00:56:50,479
server and one of the things<font color="#E5E5E5"> I was</font>

1504
00:56:48,829 --> 00:56:52,939
<font color="#E5E5E5">thinking</font><font color="#CCCCCC"> about is whether</font><font color="#E5E5E5"> you could you</font>

1505
00:56:50,479 --> 00:56:54,859
could actually leverage when XL opens

1506
00:56:52,939 --> 00:56:57,399
whether you could make a dde call to

1507
00:56:54,859 --> 00:56:59,659
excel itself in order to get things

1508
00:56:57,399 --> 00:57:03,259
operating so it could be<font color="#E5E5E5"> that word has</font>

1509
00:56:59,659 --> 00:57:05,029
some more interesting methods if you

1510
00:57:03,259 --> 00:57:07,819
like exposed you know topics<font color="#CCCCCC"> tease</font><font color="#E5E5E5"> the</font>

1511
00:57:05,029 --> 00:57:10,099
dde term and<font color="#CCCCCC"> I've not had to look at it</font>

1512
00:57:07,819 --> 00:57:14,890
now<font color="#E5E5E5"> no so that could well be something</font>

1513
00:57:10,099 --> 00:57:14,890
<font color="#CCCCCC">that says deserves further investigation</font>

1514
00:57:16,149 --> 00:57:19,880
yeah I did I think I you know I<font color="#E5E5E5"> couldn't</font>

1515
00:57:18,679 --> 00:57:22,599
see anything well let's say that when I

1516
00:57:19,880 --> 00:57:25,729
had<font color="#CCCCCC"> outlook running and I ran the dde</font>

1517
00:57:22,599 --> 00:57:27,649
services list it didn't display anything

1518
00:57:25,729 --> 00:57:29,419
but as I've as I've shown that wasn't

1519
00:57:27,649 --> 00:57:31,969
exhaustive because that that wasn't

1520
00:57:29,419 --> 00:57:33,709
listing for example that<font color="#CCCCCC"> Firefox had</font>

1521
00:57:31,969 --> 00:57:34,909
some services exposed it wasn't listing

1522
00:57:33,709 --> 00:57:36,469
it wasn't listening<font color="#CCCCCC"> the Internet</font>

1523
00:57:34,909 --> 00:57:38,389
<font color="#CCCCCC">Explorer so I don't really</font><font color="#E5E5E5"> know what's</font>

1524
00:57:36,469 --> 00:57:41,899
happening in the dde mechanism which

1525
00:57:38,389 --> 00:57:43,819
whether that client was was able to<font color="#E5E5E5"> know</font>

1526
00:57:41,899 --> 00:57:46,069
those services were running but

1527
00:57:43,819 --> 00:57:47,899
obviously in some cases that it's not

1528
00:57:46,069 --> 00:57:49,489
over it's not advertising it so this and

1529
00:57:47,899 --> 00:57:51,229
of course you<font color="#E5E5E5"> had any research</font><font color="#CCCCCC"> funding</font>

1530
00:57:49,489 --> 00:57:53,419
like that you know but you don't<font color="#CCCCCC"> even</font>

1531
00:57:51,229 --> 00:57:55,399
know what's there it's so so there may

1532
00:57:53,419 --> 00:57:58,519
be more to give I you know I took it as

1533
00:57:55,399 --> 00:58:01,058
far<font color="#E5E5E5"> as I could in the time available you</font>

1534
00:57:58,519 --> 00:58:01,058
know go and<font color="#E5E5E5"> have a look</font>

1535
00:58:08,870 --> 00:58:13,170
so the question<font color="#CCCCCC"> was whether that how</font>

1536
00:58:11,280 --> 00:58:15,450
essential is that's a pipe character so

1537
00:58:13,170 --> 00:58:18,180
in in terms<font color="#E5E5E5"> of XL to get excel to do a</font>

1538
00:58:15,450 --> 00:58:20,879
dde call that's the format so that you

1539
00:58:18,180 --> 00:58:22,770
have equals CMD that's the name or you

1540
00:58:20,880 --> 00:58:24,630
know as we've seen<font color="#CCCCCC"> Firefox for example</font>

1541
00:58:22,770 --> 00:58:26,520
and in that<font color="#E5E5E5"> case</font><font color="#CCCCCC"> it doesn't refer to the</font>

1542
00:58:24,630 --> 00:58:30,390
executable that is referring to<font color="#E5E5E5"> you know</font>

1543
00:58:26,520 --> 00:58:33,509
a dde service you then distinguished

1544
00:58:30,390 --> 00:58:35,100
that with a pipe to say now that's the

1545
00:58:33,510 --> 00:58:37,230
service<font color="#E5E5E5"> I want to call this is the topic</font>

1546
00:58:35,100 --> 00:58:39,600
that I want to<font color="#E5E5E5"> send to it so as far as</font>

1547
00:58:37,230 --> 00:58:47,360
I'm aware in terms of DDE in<font color="#CCCCCC"> excel that</font>

1548
00:58:39,600 --> 00:58:47,360
pipe is a is essential oh hello Andy

1549
00:58:47,810 --> 00:58:57,810
yeah no no of not the only thing<font color="#CCCCCC"> is yeah</font>

1550
00:58:56,250 --> 00:59:00,540
because<font color="#E5E5E5"> i saw that conversation I mean</font>

1551
00:58:57,810 --> 00:59:03,180
he was raising the fact that you had

1552
00:59:00,540 --> 00:59:04,770
other payloads which did other things

1553
00:59:03,180 --> 00:59:07,319
you need so for example like the equals

1554
00:59:04,770 --> 00:59:09,420
web service for example doesn't rely on

1555
00:59:07,320 --> 00:59:12,840
a on a pipe character but could steal

1556
00:59:09,420 --> 00:59:14,850
but could steal data so as far as I'm

1557
00:59:12,840 --> 00:59:18,480
aware in terms of DDE that pipe

1558
00:59:14,850 --> 00:59:20,819
character is is essential yeah in<font color="#CCCCCC"> Excel</font>

1559
00:59:18,480 --> 00:59:23,690
I think that's yeah that's that's the

1560
00:59:20,820 --> 00:59:48,060
that's a sort of constant if you like

1561
00:59:23,690 --> 00:59:51,330
hello at least re right no and so the

1562
00:59:48,060 --> 00:59:54,180
question was like so so so can we take

1563
00:59:51,330 --> 01:00:02,779
advantage<font color="#CCCCCC"> of a I bc dollar so you mean</font>

1564
00:59:54,180 --> 01:00:05,009
sort of<font color="#E5E5E5"> do a network connection yeah</font>

1565
01:00:02,780 --> 01:00:07,650
well<font color="#CCCCCC"> i think i think they are i think</font>

1566
01:00:05,010 --> 01:00:09,810
it's you know the mechanism the dde uses

1567
01:00:07,650 --> 01:00:11,460
not necessarily<font color="#CCCCCC"> i mean</font><font color="#E5E5E5"> obviously to use</font>

1568
01:00:09,810 --> 01:00:12,720
the term RPC generically remote

1569
01:00:11,460 --> 01:00:14,130
procedure call it

1570
01:00:12,720 --> 01:00:15,390
is obviously a remote procedure call

1571
01:00:14,130 --> 01:00:18,780
some description but i think the

1572
01:00:15,390 --> 01:00:28,109
mechanism within dde world is is<font color="#E5E5E5"> very</font>

1573
01:00:18,780 --> 01:00:29,190
different<font color="#E5E5E5"> oh I see</font><font color="#CCCCCC"> what you mean I think</font>

1574
01:00:28,110 --> 01:00:30,630
<font color="#CCCCCC">I thought yeah so you'll see you're</font>

1575
01:00:29,190 --> 01:00:33,810
saying whether whether I could have a

1576
01:00:30,630 --> 01:00:36,270
client over here and and and I could

1577
01:00:33,810 --> 01:00:38,430
sort of programmatically poke something

1578
01:00:36,270 --> 01:00:40,080
over here on but but not<font color="#E5E5E5"> on the same</font>

1579
01:00:38,430 --> 01:00:44,129
machine but over on a net I see what you

1580
01:00:40,080 --> 01:00:52,140
mean right okay don't know didn't<font color="#E5E5E5"> get</font>

1581
01:00:44,130 --> 01:00:53,760
that far I was yeah yeah I'm not that

1582
01:00:52,140 --> 01:00:55,440
not that I'm aware not<font color="#E5E5E5"> then went as far</font>

1583
01:00:53,760 --> 01:00:57,030
I've only looked at it locally I've only

1584
01:00:55,440 --> 01:00:58,770
looked at sub dde running locally

1585
01:00:57,030 --> 01:01:01,050
because the focus of the presentation

1586
01:00:58,770 --> 01:01:04,410
was about you know if you can get

1587
01:01:01,050 --> 01:01:05,850
something running in terms of an excel

1588
01:01:04,410 --> 01:01:07,890
file that you download from a web app

1589
01:01:05,850 --> 01:01:09,750
that's obviously all local and I kind of

1590
01:01:07,890 --> 01:01:12,210
kept it with that scenario my<font color="#CCCCCC"> no I</font>

1591
01:01:09,750 --> 01:01:13,830
flicked occasionally to red teaming and

1592
01:01:12,210 --> 01:01:15,420
and the like but that's<font color="#CCCCCC"> the focus are</font>

1593
01:01:13,830 --> 01:01:18,990
not I've not looked that no I don't know

1594
01:01:15,420 --> 01:01:27,260
whether that's possible to be honest hmm

1595
01:01:18,990 --> 01:01:27,259
please do<font color="#CCCCCC"> poof lunch</font>

