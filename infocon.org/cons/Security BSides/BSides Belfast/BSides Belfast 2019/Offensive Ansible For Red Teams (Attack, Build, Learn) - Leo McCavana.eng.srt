1
00:00:00,530 --> 00:00:02,590
you

2
00:00:03,460 --> 00:00:06,650
hi everybody thanks for coming along

3
00:00:06,650 --> 00:00:08,230
today I'm gonna be talking about

4
00:00:08,230 --> 00:00:12,440
offensive ansible for red team's people

5
00:00:12,440 --> 00:00:13,970
have asked me one of preparing for this

6
00:00:13,970 --> 00:00:16,219
why have you got it attack they'll learn

7
00:00:16,219 --> 00:00:18,860
fine well let's get to the good stuff

8
00:00:18,860 --> 00:00:20,779
first you know like how come he actually

9
00:00:20,779 --> 00:00:24,100
uses that as a tool to actually attack

10
00:00:24,100 --> 00:00:28,210
infrastructure so that's good so a

11
00:00:28,210 --> 00:00:31,970
little bit about me is that edward has

12
00:00:31,970 --> 00:00:33,920
likely said I'm a Red Team operator for

13
00:00:33,920 --> 00:00:36,589
a fortune 500 company I've been in

14
00:00:36,589 --> 00:00:38,650
intersect for a bit 15 years now and

15
00:00:38,650 --> 00:00:42,559
I've had a different sort of path into

16
00:00:42,559 --> 00:00:45,350
this area I had done everything from the

17
00:00:45,350 --> 00:00:47,299
tech writings security architecture

18
00:00:47,299 --> 00:00:50,089
OPSEC pan testing and everything else in

19
00:00:50,089 --> 00:00:50,440
between

20
00:00:50,440 --> 00:00:53,120
previously bad programmer made every

21
00:00:53,120 --> 00:00:55,339
mistake in the book and developing so

22
00:00:55,339 --> 00:00:59,500
called new media when DVDs were a thing

23
00:00:59,500 --> 00:01:02,869
currently I am in a red team and I love

24
00:01:02,869 --> 00:01:07,539
automation occasional t-shirt winner

25
00:01:07,539 --> 00:01:09,409
doing some stuff for all their

26
00:01:09,409 --> 00:01:11,810
organizations like CERN and this is what

27
00:01:11,810 --> 00:01:15,380
I get in return so good stuff also like

28
00:01:15,380 --> 00:01:17,479
psych one not very fast but I'm there

29
00:01:17,479 --> 00:01:21,950
anyhow okay so I talking about today

30
00:01:21,950 --> 00:01:23,780
DevOps tolling on principles for

31
00:01:23,780 --> 00:01:25,640
offensive purposes so just to break that

32
00:01:25,640 --> 00:01:29,679
down a bit I think that red teams are

33
00:01:29,679 --> 00:01:31,909
changing and if they're not they should

34
00:01:31,909 --> 00:01:34,969
do if there's a lot more development my

35
00:01:34,969 --> 00:01:37,130
it's based on DevOps principles agile

36
00:01:37,130 --> 00:01:39,259
all of that sort of thing we need to

37
00:01:39,259 --> 00:01:41,450
follow suit and I'll be talking about

38
00:01:41,450 --> 00:01:43,520
how those principles and some of the

39
00:01:43,520 --> 00:01:46,429
tooling things such as like ansible how

40
00:01:46,429 --> 00:01:48,310
they can be used for offensive purpose

41
00:01:48,310 --> 00:01:51,890
so as I recall it using it in a

42
00:01:51,890 --> 00:01:55,159
professionally evil manner full

43
00:01:55,159 --> 00:01:59,749
disclosure I used to get automation for

44
00:01:59,749 --> 00:02:02,990
most so some attitudes to it I remember

45
00:02:02,990 --> 00:02:05,329
being challenged one day by an

46
00:02:05,329 --> 00:02:07,340
individual where I work out what

47
00:02:07,340 --> 00:02:08,810
happened we automated you out of a job

48
00:02:08,810 --> 00:02:11,090
this is a miss doing OPSEC pam testing

49
00:02:11,090 --> 00:02:13,489
on the expectation that you could

50
00:02:13,489 --> 00:02:15,409
automate absolutely everything to do

51
00:02:15,409 --> 00:02:16,280
with

52
00:02:16,280 --> 00:02:20,630
good luck with that so join the red team

53
00:02:20,630 --> 00:02:24,320
and I find that I in order to actually

54
00:02:24,320 --> 00:02:25,820
break things and achieve operational

55
00:02:25,820 --> 00:02:28,640
goals I'm obviously having a t-bill

56
00:02:28,640 --> 00:02:31,220
things a lot so that's everything from

57
00:02:31,220 --> 00:02:33,770
small tools to do enumeration right

58
00:02:33,770 --> 00:02:37,370
there up to spinning up some attack

59
00:02:37,370 --> 00:02:40,970
infrastructures so it's pretty good for

60
00:02:40,970 --> 00:02:45,050
that I'm not a programmer as such but we

61
00:02:45,050 --> 00:02:46,550
know enough to get by which is good

62
00:02:46,550 --> 00:02:54,200
enough okay why do I actually like all

63
00:02:54,200 --> 00:02:56,870
things DevOps from an offensive security

64
00:02:56,870 --> 00:03:00,380
perspective Automation is the big thing

65
00:03:00,380 --> 00:03:04,040
for me I have done a lot of stuff where

66
00:03:04,040 --> 00:03:06,260
it's some manual laborious activity

67
00:03:06,260 --> 00:03:08,300
where you're setting something up the

68
00:03:08,300 --> 00:03:10,970
hard way maybe that's good if you're

69
00:03:10,970 --> 00:03:12,710
learning something from scratch for

70
00:03:12,710 --> 00:03:14,450
instances will want to more depth later

71
00:03:14,450 --> 00:03:16,010
about high data set of an Active

72
00:03:16,010 --> 00:03:18,740
Directory in an automated fashion that's

73
00:03:18,740 --> 00:03:20,540
okay if you need to learn at once and

74
00:03:20,540 --> 00:03:22,700
learn the principles behind it but if

75
00:03:22,700 --> 00:03:24,800
you're doing that again again again it

76
00:03:24,800 --> 00:03:26,240
just gets a bit boring and it's not the

77
00:03:26,240 --> 00:03:27,140
best use of your time

78
00:03:27,140 --> 00:03:32,390
so just they prove a point in here take

79
00:03:32,390 --> 00:03:34,700
a look at this one if you want to

80
00:03:34,700 --> 00:03:38,180
actually spin up maybe some stuff in a

81
00:03:38,180 --> 00:03:39,680
virtual box or if you're gonna do it

82
00:03:39,680 --> 00:03:43,459
with terraform and if a lot of mind will

83
00:03:43,459 --> 00:03:46,220
work to do in here potentially if you're

84
00:03:46,220 --> 00:03:48,440
downloading isel's and things like

85
00:03:48,440 --> 00:03:51,860
that's installing prerequisites adding

86
00:03:51,860 --> 00:03:53,840
Active Directory rules all of that

87
00:03:53,840 --> 00:03:56,030
lovely good stuff that's gonna take an

88
00:03:56,030 --> 00:03:58,370
age the stuff I'm gonna be showing you

89
00:03:58,370 --> 00:04:01,940
today is I'll be the slightly best in a

90
00:04:01,940 --> 00:04:05,120
local lab environment with VirtualBox

91
00:04:05,120 --> 00:04:07,040
and vagrants and then been able to

92
00:04:07,040 --> 00:04:08,060
configure up the ansible

93
00:04:08,060 --> 00:04:11,390
it's largely machine time where you just

94
00:04:11,390 --> 00:04:13,340
tell it what you do what you want to do

95
00:04:13,340 --> 00:04:15,860
and offer oh go go grab your lunch

96
00:04:15,860 --> 00:04:17,870
coffee or whatever and come back with in

97
00:04:17,870 --> 00:04:19,820
a bit right under two hours for a

98
00:04:19,820 --> 00:04:21,589
specific setup that I've got for you

99
00:04:21,589 --> 00:04:24,470
here which will be pretty good but

100
00:04:24,470 --> 00:04:26,810
there's also other ways I've been able

101
00:04:26,810 --> 00:04:28,310
to speed that up in the cloud but today

102
00:04:28,310 --> 00:04:29,210
it's just

103
00:04:29,210 --> 00:04:30,530
going to be a local lab that I've got

104
00:04:30,530 --> 00:04:34,280
here and you can probably tell I like

105
00:04:34,280 --> 00:04:37,130
cats so you can okay speed and

106
00:04:37,130 --> 00:04:39,620
consistency I just want the thing done

107
00:04:39,620 --> 00:04:42,259
quick like for instance if you need to

108
00:04:42,259 --> 00:04:44,539
spend up a machine in the cloud with

109
00:04:44,539 --> 00:04:47,509
terraform it's done like that even

110
00:04:47,509 --> 00:04:49,460
better than doing it locally which is

111
00:04:49,460 --> 00:04:52,849
really really nice people are human we

112
00:04:52,849 --> 00:04:56,660
all make mistakes and you've got a long

113
00:04:56,660 --> 00:04:58,729
list of tasks to do to spin up a server

114
00:04:58,729 --> 00:05:01,759
or a series of servers what's the

115
00:05:01,759 --> 00:05:03,560
chances may be overlooking something or

116
00:05:03,560 --> 00:05:05,539
thinking oh I'll do the third that's

117
00:05:05,539 --> 00:05:06,770
when you're going to get problems that

118
00:05:06,770 --> 00:05:09,550
you have the actually sit back just die

119
00:05:09,550 --> 00:05:12,680
debug things if you're doing the

120
00:05:12,680 --> 00:05:14,870
automated way with tooling such as

121
00:05:14,870 --> 00:05:18,590
ansible it's the same thing done over

122
00:05:18,590 --> 00:05:20,210
and over and over again which is nice

123
00:05:20,210 --> 00:05:25,460
and also this raises up to get on with

124
00:05:25,460 --> 00:05:27,110
the business of hacking or as I call it

125
00:05:27,110 --> 00:05:30,229
hacker sysadmin we want to be learning

126
00:05:30,229 --> 00:05:31,849
new things we want to be achieving

127
00:05:31,849 --> 00:05:36,169
operational goals so ansible can help

128
00:05:36,169 --> 00:05:38,240
with all of this can be used for more

129
00:05:38,240 --> 00:05:41,380
exciting things beyond hacker sysadmin

130
00:05:41,380 --> 00:05:44,990
but let's see what we can do with it so

131
00:05:44,990 --> 00:05:48,530
what really is ansible it's the easiest

132
00:05:48,530 --> 00:05:50,150
way of explain it's an IT automation

133
00:05:50,150 --> 00:05:53,889
tool covers configuration provisioning

134
00:05:53,889 --> 00:05:57,409
application deployment etc whereby you

135
00:05:57,409 --> 00:05:59,719
actually have one mean machine that

136
00:05:59,719 --> 00:06:01,130
actually controls a bunch of other

137
00:06:01,130 --> 00:06:03,889
servers etc and I could call out the

138
00:06:03,889 --> 00:06:06,229
ansible controller its job is say right

139
00:06:06,229 --> 00:06:08,690
ok I've got a real estate here of X

140
00:06:08,690 --> 00:06:11,360
number of servers I want you to do these

141
00:06:11,360 --> 00:06:14,150
jobs for me in this order and just go

142
00:06:14,150 --> 00:06:16,490
with it so it's pretty neat for that

143
00:06:16,490 --> 00:06:17,210
sort of thing

144
00:06:17,210 --> 00:06:20,300
Automation how does that differ from

145
00:06:20,300 --> 00:06:23,199
terraform been asked that quite a bit

146
00:06:23,199 --> 00:06:26,690
and there's maybe some crossover in some

147
00:06:26,690 --> 00:06:28,880
small areas but I'll show you more I

148
00:06:28,880 --> 00:06:31,310
think those limitations are later Tara

149
00:06:31,310 --> 00:06:32,930
forms actually to build the actual

150
00:06:32,930 --> 00:06:35,469
infrastructure

151
00:06:35,469 --> 00:06:38,719
that's just basically getting the raw

152
00:06:38,719 --> 00:06:40,820
machines up and running for instance

153
00:06:40,820 --> 00:06:42,680
later in a demo you

154
00:06:42,680 --> 00:06:44,300
be able to see where I've actually taken

155
00:06:44,300 --> 00:06:46,340
a bunch of ISIL files downloaded off the

156
00:06:46,340 --> 00:06:49,280
web and then using tool called vagrant

157
00:06:49,280 --> 00:06:50,990
locally it does that spinning up

158
00:06:50,990 --> 00:06:53,150
terraform sort of similar it will

159
00:06:53,150 --> 00:06:54,860
actually get your machine up and running

160
00:06:54,860 --> 00:06:56,990
but it's not necessarily configured how

161
00:06:56,990 --> 00:06:59,360
you actually wanted to do the tasks you

162
00:06:59,360 --> 00:07:00,650
have in hand whether that's actually a

163
00:07:00,650 --> 00:07:03,680
fishing server record the c2 channel

164
00:07:03,680 --> 00:07:06,590
whatever okay so I would say that the

165
00:07:06,590 --> 00:07:08,240
two tools are actually very very

166
00:07:08,240 --> 00:07:10,610
complementary another question I've been

167
00:07:10,610 --> 00:07:13,610
asked is that ye fixated on ansible leo

168
00:07:13,610 --> 00:07:15,620
there are other tools such as puppet and

169
00:07:15,620 --> 00:07:18,680
chef I'm not gonna disagree with any of

170
00:07:18,680 --> 00:07:20,660
those tools I'll be really honest folks

171
00:07:20,660 --> 00:07:23,060
I haven't used them a whole lot but the

172
00:07:23,060 --> 00:07:25,550
big thing I actually I would say that

173
00:07:25,550 --> 00:07:27,470
about ansible why I actually like in

174
00:07:27,470 --> 00:07:29,300
comparison to those other tools

175
00:07:29,300 --> 00:07:31,940
it's agentless and what that really

176
00:07:31,940 --> 00:07:34,340
means is that if I want to control a

177
00:07:34,340 --> 00:07:35,630
couple of hundred maybe a couple of

178
00:07:35,630 --> 00:07:38,330
thousand servers I don't need to install

179
00:07:38,330 --> 00:07:41,120
anything specific on those boxes if

180
00:07:41,120 --> 00:07:44,300
they're Windows I can communicate over a

181
00:07:44,300 --> 00:07:47,389
Windows RM and then on anything that

182
00:07:47,389 --> 00:07:51,260
takes SSH in the next slash Macworld

183
00:07:51,260 --> 00:07:54,380
that will actually work integration

184
00:07:54,380 --> 00:07:56,740
perspective although it's Navy

185
00:07:56,740 --> 00:07:59,750
independence of tools such as terraform

186
00:07:59,750 --> 00:08:01,550
and vagrant for getting that raw machine

187
00:08:01,550 --> 00:08:04,490
up and running it works very very well

188
00:08:04,490 --> 00:08:06,500
with that I think it's just a great

189
00:08:06,500 --> 00:08:08,449
handover you've built the raw machines

190
00:08:08,449 --> 00:08:10,460
and I actually that's configure them to

191
00:08:10,460 --> 00:08:14,389
go to war everything is defined in

192
00:08:14,389 --> 00:08:18,680
simple text files we call a me llamo yet

193
00:08:18,680 --> 00:08:20,389
another markup language something like a

194
00:08:20,389 --> 00:08:23,090
scummy number some people have actually

195
00:08:23,090 --> 00:08:25,639
said that it's a declarative language

196
00:08:25,639 --> 00:08:28,280
mmm I'm gonna disagree with that I would

197
00:08:28,280 --> 00:08:31,520
say it's procedural well it's largely on

198
00:08:31,520 --> 00:08:33,200
the basis that you tell it what you want

199
00:08:33,200 --> 00:08:34,760
and you don't need to be worried about

200
00:08:34,760 --> 00:08:37,309
what's going on behind the scenes so if

201
00:08:37,309 --> 00:08:39,529
you have issued a command to talk to X

202
00:08:39,529 --> 00:08:42,649
number of servers in the background it's

203
00:08:42,649 --> 00:08:45,130
running maybe a lot of pipe and stuff

204
00:08:45,130 --> 00:08:47,779
after it's made an ssh connection or

205
00:08:47,779 --> 00:08:49,940
it's running powershell if you're in a

206
00:08:49,940 --> 00:08:53,209
Windows world it isolates you from all

207
00:08:53,209 --> 00:08:55,700
of that sort of stuff it's got a series

208
00:08:55,700 --> 00:08:57,060
of module

209
00:08:57,060 --> 00:09:00,450
there's hundreds of them thing is doc

210
00:09:00,450 --> 00:09:02,820
sensible calm it will just mention

211
00:09:02,820 --> 00:09:04,589
hundreds of different modules that you

212
00:09:04,589 --> 00:09:06,029
can actually utilize really really good

213
00:09:06,029 --> 00:09:11,040
source of information so with that out

214
00:09:11,040 --> 00:09:11,730
of the way

215
00:09:11,730 --> 00:09:15,300
what's what is that that makes ansible

216
00:09:15,300 --> 00:09:16,459
work

217
00:09:16,459 --> 00:09:18,930
there's loads of terms and not going to

218
00:09:18,930 --> 00:09:21,149
cover all of them but the basic sort of

219
00:09:21,149 --> 00:09:23,430
building blocks first of all is what we

220
00:09:23,430 --> 00:09:26,070
call rules and that's really like a

221
00:09:26,070 --> 00:09:29,880
collection of tasks that have a common

222
00:09:29,880 --> 00:09:32,250
purpose friends since you may actually

223
00:09:32,250 --> 00:09:34,680
have a rule where you've got a lure the

224
00:09:34,680 --> 00:09:37,050
commands in there that are used to

225
00:09:37,050 --> 00:09:39,540
actually create a domain controller or

226
00:09:39,540 --> 00:09:42,000
you've got another rule that's actually

227
00:09:42,000 --> 00:09:44,490
going to be able to spin up a single

228
00:09:44,490 --> 00:09:47,310
server and installation obviously

229
00:09:47,310 --> 00:09:48,750
there's going to be a lot of individual

230
00:09:48,750 --> 00:09:50,640
tasks associated with that but logically

231
00:09:50,640 --> 00:09:52,320
they're grouped into rules so you can

232
00:09:52,320 --> 00:09:55,010
see on screen here and hope it's

233
00:09:55,010 --> 00:09:58,830
reasonably easy to see if I can remember

234
00:09:58,830 --> 00:10:03,390
to turn this on I've got one idea in

235
00:10:03,390 --> 00:10:05,850
here about a power play but rules common

236
00:10:05,850 --> 00:10:09,060
member server MS sequel that looks

237
00:10:09,060 --> 00:10:10,680
incredibly simple it's not just all of

238
00:10:10,680 --> 00:10:13,140
it that's it that's what they call a

239
00:10:13,140 --> 00:10:15,360
rule and that points to a load of tasks

240
00:10:15,360 --> 00:10:18,660
in the background so you can see where a

241
00:10:18,660 --> 00:10:21,140
given rule has a lot of support files

242
00:10:21,140 --> 00:10:26,579
and default files variables handlers

243
00:10:26,579 --> 00:10:28,290
that will actually trigger specific

244
00:10:28,290 --> 00:10:30,810
actions such as restarting services and

245
00:10:30,810 --> 00:10:31,860
things like that

246
00:10:31,860 --> 00:10:35,250
tasks and variables so there's a lot of

247
00:10:35,250 --> 00:10:37,170
stuff underneath the hood there the

248
00:10:37,170 --> 00:10:40,110
tasks this is the bit right call it

249
00:10:40,110 --> 00:10:42,600
procedural what you've actually got in

250
00:10:42,600 --> 00:10:45,720
here is in this case this is actually

251
00:10:45,720 --> 00:10:49,110
taken from a rule to spin up sequel

252
00:10:49,110 --> 00:10:51,540
server installation it's just telling

253
00:10:51,540 --> 00:10:53,850
you okay well resource name is sequel

254
00:10:53,850 --> 00:10:55,589
set up wearable I find all the files

255
00:10:55,589 --> 00:10:57,779
that I actually need and it's pulling

256
00:10:57,779 --> 00:10:59,550
these from a load of variables so these

257
00:10:59,550 --> 00:11:01,380
can all be customized according whatever

258
00:11:01,380 --> 00:11:06,120
way you want okay so there's loads of

259
00:11:06,120 --> 00:11:08,400
different types of tasks that you're

260
00:11:08,400 --> 00:11:10,300
going to actually have and stunning up

261
00:11:10,300 --> 00:11:12,250
an installation in here so that's just

262
00:11:12,250 --> 00:11:15,960
one of them reel it into sequel server

263
00:11:15,960 --> 00:11:20,200
playbooks is where aim you get to sort

264
00:11:20,200 --> 00:11:22,270
of put things into action all of those

265
00:11:22,270 --> 00:11:25,120
roles and their associated tasks you

266
00:11:25,120 --> 00:11:26,440
grip them together and it's what they

267
00:11:26,440 --> 00:11:28,780
call a playbook and say right I want you

268
00:11:28,780 --> 00:11:31,450
to go off and perform this role or this

269
00:11:31,450 --> 00:11:34,260
series of rules against the series of

270
00:11:34,260 --> 00:11:36,130
machines that I'm actually gonna tell

271
00:11:36,130 --> 00:11:38,350
you about think of it as like a play

272
00:11:38,350 --> 00:11:41,530
because how you would have like a sort

273
00:11:41,530 --> 00:11:44,050
of do is used in sport quite a lot but

274
00:11:44,050 --> 00:11:45,610
highlight them to the key moves to win a

275
00:11:45,610 --> 00:11:48,610
game and done the right way will

276
00:11:48,610 --> 00:11:50,650
actually see in here today a playbook

277
00:11:50,650 --> 00:11:52,270
that can actually be used for offensive

278
00:11:52,270 --> 00:11:54,250
purposes think of them as the links

279
00:11:54,250 --> 00:11:56,800
between us them a list of servers and

280
00:11:56,800 --> 00:11:58,300
all the rules that need to actually get

281
00:11:58,300 --> 00:12:03,790
implemented so moving along making use

282
00:12:03,790 --> 00:12:05,920
of ansible on the red team talking about

283
00:12:05,920 --> 00:12:07,210
it from three perspectives

284
00:12:07,210 --> 00:12:10,570
first of all attacking with ansible sort

285
00:12:10,570 --> 00:12:14,200
of talk about accessing data lateral and

286
00:12:14,200 --> 00:12:15,370
what I would also called vertical

287
00:12:15,370 --> 00:12:17,710
movement as well I'm gonna show you how

288
00:12:17,710 --> 00:12:20,650
to actually spin up an ad lab by the way

289
00:12:20,650 --> 00:12:23,080
the examples in here today are a bit

290
00:12:23,080 --> 00:12:25,030
attacking when those and things like

291
00:12:25,030 --> 00:12:25,420
that

292
00:12:25,420 --> 00:12:28,870
it's not so that's exclusively designed

293
00:12:28,870 --> 00:12:30,550
to be used for Windows is talked about

294
00:12:30,550 --> 00:12:33,280
earlier there but access over as this H

295
00:12:33,280 --> 00:12:37,300
etc you could use this against a Linux

296
00:12:37,300 --> 00:12:39,610
real estate and so it's just a nice

297
00:12:39,610 --> 00:12:43,870
little example today and also we'll be

298
00:12:43,870 --> 00:12:46,600
talking briefly about high ansible can

299
00:12:46,600 --> 00:12:48,490
be used in the cloud as well again I'm

300
00:12:48,490 --> 00:12:51,100
talking my building a local lab but as

301
00:12:51,100 --> 00:12:53,950
red team's we do use ansible quite a bit

302
00:12:53,950 --> 00:12:55,990
to configure a complete attack

303
00:12:55,990 --> 00:12:59,140
infrastructure so let's talk a bit

304
00:12:59,140 --> 00:13:01,750
attack in here so we've got a bit of a

305
00:13:01,750 --> 00:13:04,330
scenario in here where assume that I've

306
00:13:04,330 --> 00:13:09,730
got root access to a Linux server not

307
00:13:09,730 --> 00:13:12,910
picking one or right Retta where I've

308
00:13:12,910 --> 00:13:15,460
got root access to assume that somehow

309
00:13:15,460 --> 00:13:19,090
I've got access to it what I want to do

310
00:13:19,090 --> 00:13:22,060
is can I actually utilize what I've got

311
00:13:22,060 --> 00:13:23,209
in here

312
00:13:23,209 --> 00:13:26,209
take any of these so we've got a domain

313
00:13:26,209 --> 00:13:29,360
controller member servers business

314
00:13:29,360 --> 00:13:31,279
catch-all term for a file server web

315
00:13:31,279 --> 00:13:33,499
server or a bundle of loaded stuff in

316
00:13:33,499 --> 00:13:35,480
here and then obviously at Windows 10

317
00:13:35,480 --> 00:13:37,639
workstation so that's our starting point

318
00:13:37,639 --> 00:13:38,990
so let's take a look what we can

319
00:13:38,990 --> 00:13:42,439
actually do now if I'm on that Windows

320
00:13:42,439 --> 00:13:45,410
are sorry that Linux box I want to find

321
00:13:45,410 --> 00:13:48,800
out what on earth have I got something

322
00:13:48,800 --> 00:13:50,179
we would actually do in a red team is

323
00:13:50,179 --> 00:13:51,410
that one we've got a certain level of

324
00:13:51,410 --> 00:13:54,589
access we want the understand where are

325
00:13:54,589 --> 00:13:57,920
you at what do you have what can you do

326
00:13:57,920 --> 00:13:59,389
with what you have where do you need to

327
00:13:59,389 --> 00:14:00,679
go so like we're doing a bit of a

328
00:14:00,679 --> 00:14:02,929
situation wrapping here in this case I'm

329
00:14:02,929 --> 00:14:05,420
just doing a whit chancel I'm there low

330
00:14:05,420 --> 00:14:08,389
and behold there's user slash bin slash

331
00:14:08,389 --> 00:14:11,660
ansible also interesting some other key

332
00:14:11,660 --> 00:14:13,220
files in here there's a configuration

333
00:14:13,220 --> 00:14:15,980
file I will be talking about that file

334
00:14:15,980 --> 00:14:18,079
later and one of the dangerous defaults

335
00:14:18,079 --> 00:14:20,420
has actually got actually I'll tell you

336
00:14:20,420 --> 00:14:22,639
and I by default when you install

337
00:14:22,639 --> 00:14:23,920
ansible

338
00:14:23,920 --> 00:14:26,839
the configuration file has logging

339
00:14:26,839 --> 00:14:28,819
turned off you have to explicitly turn

340
00:14:28,819 --> 00:14:31,759
it on so if there's any defenders in the

341
00:14:31,759 --> 00:14:33,529
room that's a good thing to actually

342
00:14:33,529 --> 00:14:36,410
take a look at first other bits and

343
00:14:36,410 --> 00:14:38,029
pieces as well I'm looking for a host

344
00:14:38,029 --> 00:14:40,399
file I'm not talking about at C hosts or

345
00:14:40,399 --> 00:14:42,589
anything like that I'm talking about a

346
00:14:42,589 --> 00:14:44,209
list of hosts that are specific to

347
00:14:44,209 --> 00:14:46,040
ansible so this controller is

348
00:14:46,040 --> 00:14:47,559
controlling a bunch of machines

349
00:14:47,559 --> 00:14:50,149
technically it's called an inventory and

350
00:14:50,149 --> 00:14:53,149
that files stored in a file called hosts

351
00:14:53,149 --> 00:14:56,269
not always in at C ansible hosts it

352
00:14:56,269 --> 00:14:58,309
could actually be in any node other

353
00:14:58,309 --> 00:15:00,649
number of locations on the machine so do

354
00:15:00,649 --> 00:15:02,990
take a look for that and I'm gonna hone

355
00:15:02,990 --> 00:15:06,290
in on the host file in here to see what

356
00:15:06,290 --> 00:15:07,790
goodies that it'll actually show me in

357
00:15:07,790 --> 00:15:12,379
here an inventory file is just a list of

358
00:15:12,379 --> 00:15:14,649
boxes that a given controller has

359
00:15:14,649 --> 00:15:18,740
control over and yes you will see them

360
00:15:18,740 --> 00:15:20,600
nicely grouped up together into

361
00:15:20,600 --> 00:15:23,179
different sort of functional areas great

362
00:15:23,179 --> 00:15:24,740
thing about this is that whenever you

363
00:15:24,740 --> 00:15:26,749
want here she attacks something or

364
00:15:26,749 --> 00:15:28,540
indeed use it for so-called legitimate

365
00:15:28,540 --> 00:15:32,480
DevOps purposes you can in your attack

366
00:15:32,480 --> 00:15:35,089
construction at different parts of that

367
00:15:35,089 --> 00:15:37,160
inventory you can do all of them

368
00:15:37,160 --> 00:15:40,250
Red Team scenario not always good but

369
00:15:40,250 --> 00:15:42,139
you can be more specific focusing on

370
00:15:42,139 --> 00:15:44,779
maybe some subgroups or individual

371
00:15:44,779 --> 00:15:47,149
machines within those subgroups so this

372
00:15:47,149 --> 00:15:51,379
is a roadmap to us as it says in here

373
00:15:51,379 --> 00:15:54,500
spoiler alert the very very nature

374
00:15:54,500 --> 00:15:57,230
ansible is they allow it to be doing a

375
00:15:57,230 --> 00:15:59,389
lot of admin configuration deployment

376
00:15:59,389 --> 00:16:02,300
stuff this is actually going to actually

377
00:16:02,300 --> 00:16:05,889
have complete roots life system access

378
00:16:05,889 --> 00:16:09,910
to anything in that real estate so

379
00:16:09,910 --> 00:16:12,920
already alarm bells are ringing in here

380
00:16:12,920 --> 00:16:15,459
at the main controllers mmm interesting

381
00:16:15,459 --> 00:16:18,110
but maybe that's just too obvious I

382
00:16:18,110 --> 00:16:20,060
don't necessarily always want to

383
00:16:20,060 --> 00:16:22,870
actually go ask it to demean controller

384
00:16:22,870 --> 00:16:24,980
maybe I actually want to go after some

385
00:16:24,980 --> 00:16:26,899
dealer because that's more sometimes

386
00:16:26,899 --> 00:16:29,180
rather a lot more relevant to a red team

387
00:16:29,180 --> 00:16:33,920
goal you're after data and so um for

388
00:16:33,920 --> 00:16:35,990
today's purposes in here we are actually

389
00:16:35,990 --> 00:16:37,790
going to show you how we can become a

390
00:16:37,790 --> 00:16:39,709
dummy an administrator on this

391
00:16:39,709 --> 00:16:41,779
thumping some hashes oh but again

392
00:16:41,779 --> 00:16:44,209
there's a load of other things people

393
00:16:44,209 --> 00:16:46,670
have asked me is that okay is it ansible

394
00:16:46,670 --> 00:16:48,769
it's actually vulnerable in here or what

395
00:16:48,769 --> 00:16:50,389
you know what other attacks have you got

396
00:16:50,389 --> 00:16:52,279
but it's not like a Metasploit point

397
00:16:52,279 --> 00:16:53,930
should click go it's not an attack

398
00:16:53,930 --> 00:16:55,790
framework it's a management and

399
00:16:55,790 --> 00:16:57,860
configuration framework for machines and

400
00:16:57,860 --> 00:17:01,399
my view in this one is that if you

401
00:17:01,399 --> 00:17:02,990
actually have a really good handle on

402
00:17:02,990 --> 00:17:04,880
how to actually do stuff at the

403
00:17:04,880 --> 00:17:07,849
command-line antiderivatives together

404
00:17:07,849 --> 00:17:09,859
and shell scripting allosaurus good

405
00:17:09,859 --> 00:17:10,280
stuff

406
00:17:10,280 --> 00:17:13,159
well then ansible is the way to make all

407
00:17:13,159 --> 00:17:14,959
of that actually happening and just a

408
00:17:14,959 --> 00:17:16,760
really interesting talk earlier there

409
00:17:16,760 --> 00:17:18,740
from yo Keem and normally talking about

410
00:17:18,740 --> 00:17:20,900
how they actually had some scripts that

411
00:17:20,900 --> 00:17:23,449
actually pull down additional components

412
00:17:23,449 --> 00:17:25,179
malware all that sort of stuff

413
00:17:25,179 --> 00:17:28,280
this sort of stuff as well is going to

414
00:17:28,280 --> 00:17:30,500
be very very good i will be showing you

415
00:17:30,500 --> 00:17:32,870
a demo of hyatt actually can do a number

416
00:17:32,870 --> 00:17:38,780
of tasks so interesting you can as i

417
00:17:38,780 --> 00:17:41,539
said talk about using play books which

418
00:17:41,539 --> 00:17:44,659
is just what you say right here's a list

419
00:17:44,659 --> 00:17:45,500
of servers

420
00:17:45,500 --> 00:17:48,590
here's a playbook relating to a series

421
00:17:48,590 --> 00:17:50,530
of roles who often do

422
00:17:50,530 --> 00:17:54,070
you can also do ad hoc commands which is

423
00:17:54,070 --> 00:17:55,810
interesting there be fun to do a better

424
00:17:55,810 --> 00:17:57,880
set rep once you're actually on

425
00:17:57,880 --> 00:18:02,170
understate someone liners for instance

426
00:18:02,170 --> 00:18:03,550
then here I'm sure you can see it at the

427
00:18:03,550 --> 00:18:06,580
bottom ansible all now and I'm pointing

428
00:18:06,580 --> 00:18:10,090
it to my hosts file in here - ends for

429
00:18:10,090 --> 00:18:13,390
module and setup this will return

430
00:18:13,390 --> 00:18:15,460
pretty much everything known to man and

431
00:18:15,460 --> 00:18:18,520
woman about this box except the patches

432
00:18:18,520 --> 00:18:21,130
I'll get to that later so it's going to

433
00:18:21,130 --> 00:18:22,600
tell you about everything to do with

434
00:18:22,600 --> 00:18:25,300
processors it's sort of what that

435
00:18:25,300 --> 00:18:27,400
operating systems got installed all

436
00:18:27,400 --> 00:18:28,930
sorts of stuff in here

437
00:18:28,930 --> 00:18:31,420
very very useful if you want to see if

438
00:18:31,420 --> 00:18:33,910
there's any other wider bigger issues as

439
00:18:33,910 --> 00:18:39,790
well and in here system info and there's

440
00:18:39,790 --> 00:18:41,830
nothing really new in here but this is

441
00:18:41,830 --> 00:18:44,140
not an exploit framework it's a way of

442
00:18:44,140 --> 00:18:45,640
actually launched in some specific

443
00:18:45,640 --> 00:18:49,840
commands system info might even if I

444
00:18:49,840 --> 00:18:53,160
actually had the ability maybe just do

445
00:18:53,160 --> 00:18:55,750
sort of Nebat SSH based access or

446
00:18:55,750 --> 00:18:58,360
windows RM access straight into that I

447
00:18:58,360 --> 00:19:01,510
could do a bundle of like PowerShell

448
00:19:01,510 --> 00:19:03,630
commands locally on those machines

449
00:19:03,630 --> 00:19:05,920
that's probably gonna ring anon alarm

450
00:19:05,920 --> 00:19:09,130
bell with that with the defenders what

451
00:19:09,130 --> 00:19:11,320
I'm actually seeing in here is that the

452
00:19:11,320 --> 00:19:13,540
answer the controller it's actually

453
00:19:13,540 --> 00:19:15,940
known to be an administrator it needs to

454
00:19:15,940 --> 00:19:18,280
be able to do these things and perhaps

455
00:19:18,280 --> 00:19:20,620
there's nibby mm-hmm

456
00:19:20,620 --> 00:19:22,330
I sort of there's not going to be as

457
00:19:22,330 --> 00:19:25,600
much stuff raised on on dashboards if it

458
00:19:25,600 --> 00:19:27,640
sees that oh here's a command from the

459
00:19:27,640 --> 00:19:30,820
controller to another machine in here to

460
00:19:30,820 --> 00:19:33,580
do something well yes as expect that

461
00:19:33,580 --> 00:19:34,960
you're gonna be transferring files and

462
00:19:34,960 --> 00:19:37,710
configuring things this looks normal so

463
00:19:37,710 --> 00:19:41,530
I would prefer to do it this way because

464
00:19:41,530 --> 00:19:43,600
we're working off the land and here as

465
00:19:43,600 --> 00:19:45,750
quietly as possible

466
00:19:45,750 --> 00:19:49,030
okay so scenario in here that I want to

467
00:19:49,030 --> 00:19:50,830
show you today is that you want to be

468
00:19:50,830 --> 00:19:52,240
able to create a user with elevated

469
00:19:52,240 --> 00:19:55,540
privileges again here isn't the add-on

470
00:19:55,540 --> 00:19:57,040
here is that you know you're not always

471
00:19:57,040 --> 00:19:58,929
gonna won't be going after to me in

472
00:19:58,929 --> 00:20:01,760
admin but for today I'm interested in it

473
00:20:01,760 --> 00:20:05,270
and a cop we want to move laterally so

474
00:20:05,270 --> 00:20:07,010
we could move to older machines in there

475
00:20:07,010 --> 00:20:09,350
or we could decide you know what we want

476
00:20:09,350 --> 00:20:11,300
to go further up the food chain and go

477
00:20:11,300 --> 00:20:13,480
for Jimmy and admins all of us or stuff

478
00:20:13,480 --> 00:20:16,160
so breaking things dying what do I

479
00:20:16,160 --> 00:20:18,380
actually need to do in here by the way

480
00:20:18,380 --> 00:20:20,690
no surprises I came last in art class

481
00:20:20,690 --> 00:20:22,520
for choice of graphics and things so

482
00:20:22,520 --> 00:20:24,590
bear with me in that what I want to do

483
00:20:24,590 --> 00:20:27,320
in here is a malicious binary night

484
00:20:27,320 --> 00:20:29,810
there are umpteen different c2

485
00:20:29,810 --> 00:20:31,700
frameworks you could utilize for this

486
00:20:31,700 --> 00:20:34,910
and yes meterpreter may actually pop

487
00:20:34,910 --> 00:20:37,100
things and dashboards not really too

488
00:20:37,100 --> 00:20:38,840
concerned about that today it's just

489
00:20:38,840 --> 00:20:40,970
good for a really quick demo use

490
00:20:40,970 --> 00:20:43,520
whatever c2 framework of your choice in

491
00:20:43,520 --> 00:20:45,620
here but the point is we are actually

492
00:20:45,620 --> 00:20:47,600
going to get a malicious binary

493
00:20:47,600 --> 00:20:52,240
transferred on to our Red Hat books and

494
00:20:52,240 --> 00:20:55,450
that can actually be used in a play book

495
00:20:55,450 --> 00:20:58,520
transfer that all the way down onto a

496
00:20:58,520 --> 00:21:00,320
given target machine in that inventory

497
00:21:00,320 --> 00:21:03,920
and then that seems somehow more safe

498
00:21:03,920 --> 00:21:06,590
because it's expected to be doing that

499
00:21:06,590 --> 00:21:08,540
sort of stuff and then it's gonna be

500
00:21:08,540 --> 00:21:09,620
calling back home

501
00:21:09,620 --> 00:21:13,250
I love amateur pad or listener okay okay

502
00:21:13,250 --> 00:21:15,050
so I'm not going to show you all of that

503
00:21:15,050 --> 00:21:16,580
stuff today we're going to focus on

504
00:21:16,580 --> 00:21:19,460
really the stuff a bit ansible itself so

505
00:21:19,460 --> 00:21:21,470
let's get the better but generating the

506
00:21:21,470 --> 00:21:25,270
motors payload so here's an interesting

507
00:21:25,270 --> 00:21:29,060
playbook that can be find on that box

508
00:21:29,060 --> 00:21:31,700
and I can be find white because I put it

509
00:21:31,700 --> 00:21:34,850
there obviously you're just gonna have

510
00:21:34,850 --> 00:21:36,170
to be very very careful you're gonna

511
00:21:36,170 --> 00:21:37,910
need to do some sitrep in there to see

512
00:21:37,910 --> 00:21:40,460
well you know what sort of things are

513
00:21:40,460 --> 00:21:43,400
actually there you don't obviously want

514
00:21:43,400 --> 00:21:45,230
to go in and create a play book with

515
00:21:45,230 --> 00:21:47,750
comments rattled on it pull in this box

516
00:21:47,750 --> 00:21:50,810
that's not very wise so I've used some

517
00:21:50,810 --> 00:21:53,060
bits of obfuscation in here to make this

518
00:21:53,060 --> 00:21:56,900
kind of normal in this case I would have

519
00:21:56,900 --> 00:22:00,290
developed this offline SSH the the file

520
00:22:00,290 --> 00:22:03,230
or secure copied over to the Red Hat

521
00:22:03,230 --> 00:22:05,870
controller box and then we can start

522
00:22:05,870 --> 00:22:09,380
there so I'm I've told that I don't want

523
00:22:09,380 --> 00:22:11,030
to gather all that setup information

524
00:22:11,030 --> 00:22:11,900
takes too long

525
00:22:11,900 --> 00:22:14,300
moving along Leo and I if I want to put

526
00:22:14,300 --> 00:22:15,260
some militia

527
00:22:15,260 --> 00:22:19,150
binary on device such as a Windows box

528
00:22:19,150 --> 00:22:22,040
ideally you want that to be something

529
00:22:22,040 --> 00:22:24,550
that's not going to be monitored for

530
00:22:24,550 --> 00:22:26,390
antivirus or other endpoint protection

531
00:22:26,390 --> 00:22:28,550
controls again you're gonna need to

532
00:22:28,550 --> 00:22:30,230
spend a bit of time investigating that

533
00:22:30,230 --> 00:22:33,230
but for today's purposes created a

534
00:22:33,230 --> 00:22:35,510
folder in here called software packages

535
00:22:35,510 --> 00:22:38,270
slash library mmm maybe there's some

536
00:22:38,270 --> 00:22:40,850
deployment packages in here so hopefully

537
00:22:40,850 --> 00:22:43,640
that looks kind of normal but you know

538
00:22:43,640 --> 00:22:46,700
take a look at your own sort of specific

539
00:22:46,700 --> 00:22:48,520
environments and try and plan then

540
00:22:48,520 --> 00:22:52,070
damage but this one when copping my one

541
00:22:52,070 --> 00:22:54,440
of us creating this demo I actually did

542
00:22:54,440 --> 00:22:56,240
something pretty lame use cert you tell

543
00:22:56,240 --> 00:22:59,360
on the actual victim boxes I'm gonna

544
00:22:59,360 --> 00:23:02,450
know because common files like our

545
00:23:02,450 --> 00:23:05,900
common apps I got probably will ring a

546
00:23:05,900 --> 00:23:08,960
bell on a defense of dashboard somewhere

547
00:23:08,960 --> 00:23:11,240
so I thought right okay when copy and

548
00:23:11,240 --> 00:23:13,550
let it do all the hard work for me its

549
00:23:13,550 --> 00:23:15,950
so-called expected behavior and so we

550
00:23:15,950 --> 00:23:19,340
should be good so I'm picking an Oracle

551
00:23:19,340 --> 00:23:23,770
9 ok so some thing called client setup I

552
00:23:23,770 --> 00:23:25,730
obviously if someone's gonna be that

553
00:23:25,730 --> 00:23:27,650
interest that you're gonna gag grab of

554
00:23:27,650 --> 00:23:29,360
that binary you're gonna strip it die

555
00:23:29,360 --> 00:23:30,980
and see what it is and if this

556
00:23:30,980 --> 00:23:34,370
interpreter sort of axion here you're

557
00:23:34,370 --> 00:23:35,870
gonna find it pretty cool alright quick

558
00:23:35,870 --> 00:23:38,510
nice we are so again there's other

559
00:23:38,510 --> 00:23:39,770
things that were taken into

560
00:23:39,770 --> 00:23:41,480
consideration here nibby of actually

561
00:23:41,480 --> 00:23:43,700
encrypt that that binary you've done a

562
00:23:43,700 --> 00:23:44,960
few other things the obfuscated code

563
00:23:44,960 --> 00:23:47,240
that sort of stuff and then once it's

564
00:23:47,240 --> 00:23:49,430
actually on we want that to be activated

565
00:23:49,430 --> 00:23:53,870
no she activated it I want the actually

566
00:23:53,870 --> 00:23:57,320
get enhanced privileges and I'm gonna go

567
00:23:57,320 --> 00:23:59,180
for the kill in here with Adam Ian admin

568
00:23:59,180 --> 00:24:01,340
a kind night I had actually thought

569
00:24:01,340 --> 00:24:04,250
about specifying a command in here to

570
00:24:04,250 --> 00:24:06,500
actually define the accounts and design

571
00:24:06,500 --> 00:24:09,140
at their relevant group but maybe not

572
00:24:09,140 --> 00:24:10,670
the wisest thing to put it in here

573
00:24:10,670 --> 00:24:12,440
because this is actually going to be put

574
00:24:12,440 --> 00:24:13,430
on that victim

575
00:24:13,430 --> 00:24:16,730
ansible box and if anybody stumbles upon

576
00:24:16,730 --> 00:24:19,390
it and sees creds sitting there that's

577
00:24:19,390 --> 00:24:23,950
really really bad stuff so far right ok

578
00:24:23,950 --> 00:24:27,320
do this with actually an answerable

579
00:24:27,320 --> 00:24:28,640
ad-hoc command

580
00:24:28,640 --> 00:24:31,549
my can there's gonna be partial logging

581
00:24:31,549 --> 00:24:34,520
on your Windows environment hopefully

582
00:24:34,520 --> 00:24:38,000
but again I'm creating them and here the

583
00:24:38,000 --> 00:24:39,500
knowledge that I've gained so far in

584
00:24:39,500 --> 00:24:42,049
here that this is actually expected

585
00:24:42,049 --> 00:24:44,780
behavior you may actually have processes

586
00:24:44,780 --> 00:24:46,610
running on that to mean controller there

587
00:24:46,610 --> 00:24:47,960
may be going to be doing a partial

588
00:24:47,960 --> 00:24:50,900
command to import a bunch of new users

589
00:24:50,900 --> 00:24:52,720
and sign them members of groups

590
00:24:52,720 --> 00:24:54,770
obviously you're gonna be looking ident

591
00:24:54,770 --> 00:24:56,809
here for anything with an enhanced level

592
00:24:56,809 --> 00:24:58,670
of privileges such as to me an admin

593
00:24:58,670 --> 00:25:01,370
again but the point is in here it's

594
00:25:01,370 --> 00:25:03,530
better to do it this way then actually

595
00:25:03,530 --> 00:25:05,360
have something that will actually be

596
00:25:05,360 --> 00:25:09,470
quite visible inside the actual playbook

597
00:25:09,470 --> 00:25:13,190
and also stuff like that can be really

598
00:25:13,190 --> 00:25:15,140
really easy showing up in ansible log

599
00:25:15,140 --> 00:25:17,720
files I will talk about log file stuff

600
00:25:17,720 --> 00:25:20,750
later so well so so those are the two ad

601
00:25:20,750 --> 00:25:23,390
hoc commands to create the demeanor I

602
00:25:23,390 --> 00:25:25,760
started to create the user and then H

603
00:25:25,760 --> 00:25:29,870
they give them the main admin probes so

604
00:25:29,870 --> 00:25:34,370
my I want to take that playbook and let

605
00:25:34,370 --> 00:25:38,360
it go my actually being specific here in

606
00:25:38,360 --> 00:25:41,330
that playbook that I want it to run with

607
00:25:41,330 --> 00:25:42,980
those nice new creds that I've actually

608
00:25:42,980 --> 00:25:45,260
got because that will hopefully return

609
00:25:45,260 --> 00:25:47,179
me a reverse shell in the context of

610
00:25:47,179 --> 00:25:49,120
that user that a special event here

611
00:25:49,120 --> 00:25:52,190
again more obfuscation and here sis DB

612
00:25:52,190 --> 00:25:55,370
utils obviously you should actually have

613
00:25:55,370 --> 00:25:58,130
a really really good handle on what

614
00:25:58,130 --> 00:26:01,010
accounts are actually in your inventory

615
00:26:01,010 --> 00:26:04,299
a your Active Directory and seem like

616
00:26:04,299 --> 00:26:06,620
this should actually be pop monoid

617
00:26:06,620 --> 00:26:09,820
swoosh it but again I'm blending in here

618
00:26:09,820 --> 00:26:16,010
okay so demo time sequence will not be

619
00:26:16,010 --> 00:26:17,780
shortened there's some stuff later

620
00:26:17,780 --> 00:26:19,549
actually show you is that because it

621
00:26:19,549 --> 00:26:21,049
depends and dying loading thousand

622
00:26:21,049 --> 00:26:22,520
things can take a bit of time and they

623
00:26:22,520 --> 00:26:24,679
were speeded up so to speak this one

624
00:26:24,679 --> 00:26:30,770
isn't okay so up at the top we've

625
00:26:30,770 --> 00:26:34,520
actually got our a session on the

626
00:26:34,520 --> 00:26:37,340
console controller down in here I've got

627
00:26:37,340 --> 00:26:39,140
the meterpreter set up it's already

628
00:26:39,140 --> 00:26:42,559
fired off the commands on here to set up

629
00:26:42,559 --> 00:26:46,519
user and sanam sysadmin cribs nice plan

630
00:26:46,519 --> 00:26:49,340
that playbook it's transferring that

631
00:26:49,340 --> 00:26:51,559
file on to the given machine in this

632
00:26:51,559 --> 00:26:53,360
case the domain controller that's

633
00:26:53,360 --> 00:26:56,210
activating it and look see down in here

634
00:26:56,210 --> 00:26:58,370
we've got a meterpreter session okay so

635
00:26:58,370 --> 00:27:00,110
hopefully they'll pop up yeah there we

636
00:27:00,110 --> 00:27:02,090
go you can see it's in the context of

637
00:27:02,090 --> 00:27:06,559
this STD utils let's confirm that yep

638
00:27:06,559 --> 00:27:09,919
that's good and pretty Liam but it'll

639
00:27:09,919 --> 00:27:14,090
work in this kiss get system now I'm

640
00:27:14,090 --> 00:27:16,789
gonna do a hash dump night that's just

641
00:27:16,789 --> 00:27:19,580
for real demonstration purposes you may

642
00:27:19,580 --> 00:27:21,700
want to do that a bit more stealthy I

643
00:27:21,700 --> 00:27:24,379
using volume Shadow Copy or something

644
00:27:24,379 --> 00:27:26,149
like that but in this case that was

645
00:27:26,149 --> 00:27:29,059
quick it was actually easy again it's

646
00:27:29,059 --> 00:27:30,769
all done to what you actually know about

647
00:27:30,769 --> 00:27:32,389
your target environment suitors so

648
00:27:32,389 --> 00:27:34,909
that's just one way of actually how do

649
00:27:34,909 --> 00:27:37,399
you actually use ansible for an

650
00:27:37,399 --> 00:27:39,999
offensive attacking perspective in there

651
00:27:39,999 --> 00:27:44,179
as I said it's really don't see your own

652
00:27:44,179 --> 00:27:46,220
imagination and what you actually need

653
00:27:46,220 --> 00:27:49,700
to achieve your operational goals so

654
00:27:49,700 --> 00:27:51,980
putting that inventory to work for you

655
00:27:51,980 --> 00:27:53,809
there's loads of other things that we

656
00:27:53,809 --> 00:27:56,480
could have done in here we could have

657
00:27:56,480 --> 00:27:59,509
actually set up a cron job on that

658
00:27:59,509 --> 00:28:02,779
ansible controller to pull down key data

659
00:28:02,779 --> 00:28:05,899
from boxes on in the inventory let's say

660
00:28:05,899 --> 00:28:07,730
that parts of that inventory were

661
00:28:07,730 --> 00:28:11,179
maintaining daily sales figures maybe

662
00:28:11,179 --> 00:28:12,919
and you have points that actually opens

663
00:28:12,919 --> 00:28:16,460
credit cards you get the idea if

664
00:28:16,460 --> 00:28:18,619
anything interesting is stored in those

665
00:28:18,619 --> 00:28:21,350
boxes we could actually have something

666
00:28:21,350 --> 00:28:23,450
that will actually pull all that off and

667
00:28:23,450 --> 00:28:27,649
bring it back to me if you want it to be

668
00:28:27,649 --> 00:28:29,179
a bit more stealthy and you can actually

669
00:28:29,179 --> 00:28:31,429
put some of those machines to work for

670
00:28:31,429 --> 00:28:34,399
you potential one on there things such

671
00:28:34,399 --> 00:28:35,990
as a sharp point if you want to use that

672
00:28:35,990 --> 00:28:37,789
to enumerate I'm your Active Directory

673
00:28:37,789 --> 00:28:41,600
installation interesting and again I

674
00:28:41,600 --> 00:28:43,730
hear something out in here none of these

675
00:28:43,730 --> 00:28:46,460
types of things are actually new at all

676
00:28:46,460 --> 00:28:49,909
just think ansible it's just the way I

677
00:28:49,909 --> 00:28:53,600
say automate a lot of this stuff I could

678
00:28:53,600 --> 00:28:55,970
have actually like an we'll see Morgan

679
00:28:55,970 --> 00:28:58,640
a type but all the stuff in manually I

680
00:28:58,640 --> 00:29:00,620
would have to go off to each and every

681
00:29:00,620 --> 00:29:02,870
individual machine I could have watched

682
00:29:02,870 --> 00:29:04,610
something together with Bosch or

683
00:29:04,610 --> 00:29:07,550
something but this is pretty neat allows

684
00:29:07,550 --> 00:29:09,410
me to set up an entire playbook on off

685
00:29:09,410 --> 00:29:10,300
you go

686
00:29:10,300 --> 00:29:13,130
also what I was doing in there

687
00:29:13,130 --> 00:29:15,980
I was issuing those ansible commands

688
00:29:15,980 --> 00:29:19,520
from the ansible controller I it is

689
00:29:19,520 --> 00:29:21,860
possible that you could actually talk to

690
00:29:21,860 --> 00:29:24,950
those victim machines controlled by

691
00:29:24,950 --> 00:29:25,400
ansible

692
00:29:25,400 --> 00:29:26,480
directly from your own tak

693
00:29:26,480 --> 00:29:29,870
infrastructure I would say maybe not the

694
00:29:29,870 --> 00:29:32,750
best operationally but perhaps there are

695
00:29:32,750 --> 00:29:35,390
no firewall rules in place that would

696
00:29:35,390 --> 00:29:37,880
restrict me from doing that I can that's

697
00:29:37,880 --> 00:29:38,960
something you're gonna find out from

698
00:29:38,960 --> 00:29:40,310
your own sort of reconnaissance

699
00:29:40,310 --> 00:29:43,190
activities so and that's obviously

700
00:29:43,190 --> 00:29:44,360
something as well that you'd want to

701
00:29:44,360 --> 00:29:46,130
take a look at if you're actually

702
00:29:46,130 --> 00:29:49,220
examining logs on a box that is

703
00:29:49,220 --> 00:29:52,130
controlled by ansible you want to see

704
00:29:52,130 --> 00:29:53,870
well word that that connection come from

705
00:29:53,870 --> 00:29:55,730
well you take a look at the IP address

706
00:29:55,730 --> 00:29:57,950
of the machine name well that's not the

707
00:29:57,950 --> 00:29:59,930
answer book controller that's the sort

708
00:29:59,930 --> 00:30:01,250
of stuff it should be popping up on

709
00:30:01,250 --> 00:30:06,620
defensive dashboard okay some things in

710
00:30:06,620 --> 00:30:08,770
here probably have already covered again

711
00:30:08,770 --> 00:30:13,820
cats are busy here so they're keeping

712
00:30:13,820 --> 00:30:15,620
under the radar before you do any of

713
00:30:15,620 --> 00:30:18,980
this know exactly what it is in here

714
00:30:18,980 --> 00:30:20,630
that you're looking at have you any

715
00:30:20,630 --> 00:30:22,460
appreciation for the types of activity

716
00:30:22,460 --> 00:30:25,040
conducted on earth it's what's what do

717
00:30:25,040 --> 00:30:26,480
you know about except that so-called

718
00:30:26,480 --> 00:30:29,210
normal behavior I mentioned previously

719
00:30:29,210 --> 00:30:32,150
there but not using a cert util on those

720
00:30:32,150 --> 00:30:34,910
victim boxes get ansible to do the dirty

721
00:30:34,910 --> 00:30:37,820
work for you and use a module called

722
00:30:37,820 --> 00:30:41,420
wind copy it's so called seen as normal

723
00:30:41,420 --> 00:30:43,940
perhaps in that sort of context and a

724
00:30:43,940 --> 00:30:45,950
little bit blending in as well so he's

725
00:30:45,950 --> 00:30:49,100
soft not playback I actually had it was

726
00:30:49,100 --> 00:30:52,970
actually going to have no creds in it

727
00:30:52,970 --> 00:30:55,010
the language is pretty neutral the

728
00:30:55,010 --> 00:30:58,310
functional which was interesting at the

729
00:30:58,310 --> 00:31:01,400
fenders in here I can apologize about

730
00:31:01,400 --> 00:31:03,110
the graphics folks

731
00:31:03,110 --> 00:31:05,450
my god hopefully there's no hoodies in

732
00:31:05,450 --> 00:31:08,899
here okay a few of the things that are

733
00:31:08,899 --> 00:31:10,909
sort of normal like sort of activities

734
00:31:10,909 --> 00:31:12,679
for blue teams in here baseline what a

735
00:31:12,679 --> 00:31:15,380
so-called normal behavior that is a very

736
00:31:15,380 --> 00:31:17,720
sweeping term and I apologies if that's

737
00:31:17,720 --> 00:31:19,880
actually sort of simplified like that

738
00:31:19,880 --> 00:31:22,220
but you really really do need to

739
00:31:22,220 --> 00:31:24,409
understand what is normal behavior if

740
00:31:24,409 --> 00:31:26,899
you've got an inventory that's actually

741
00:31:26,899 --> 00:31:28,070
control with ansible

742
00:31:28,070 --> 00:31:30,980
you know where where is the ounce of a

743
00:31:30,980 --> 00:31:33,230
controller what sort of activities does

744
00:31:33,230 --> 00:31:35,779
it actually do does it normally do

745
00:31:35,779 --> 00:31:37,549
software installations or does it

746
00:31:37,549 --> 00:31:40,100
normally to users on two systems what is

747
00:31:40,100 --> 00:31:41,299
it so just understand what you're

748
00:31:41,299 --> 00:31:43,159
actually doing with it so anything

749
00:31:43,159 --> 00:31:45,529
outside of that should stick I'd file

750
00:31:45,529 --> 00:31:47,809
integrity monitoring so if anybody's

751
00:31:47,809 --> 00:31:50,389
creating accounts or tampering with

752
00:31:50,389 --> 00:31:52,909
files good stuff they actually have on

753
00:31:52,909 --> 00:31:56,000
board their turn on logging on your

754
00:31:56,000 --> 00:31:58,460
ansible controller as I said by default

755
00:31:58,460 --> 00:32:02,840
it's turned off which is pretty bad so

756
00:32:02,840 --> 00:32:04,909
you're gonna want to take a look to see

757
00:32:04,909 --> 00:32:07,850
in there ansible is actually configured

758
00:32:07,850 --> 00:32:10,190
with a log file and then go after those

759
00:32:10,190 --> 00:32:11,840
log files and examine see if there's any

760
00:32:11,840 --> 00:32:14,659
telltale signs in there and obviously in

761
00:32:14,659 --> 00:32:16,039
a Windows environment too

762
00:32:16,039 --> 00:32:17,510
you're going to need to take a look at

763
00:32:17,510 --> 00:32:20,840
your partial tech logs and you're going

764
00:32:20,840 --> 00:32:22,669
to be looking as well for so-called

765
00:32:22,669 --> 00:32:25,340
ansible related traffic which is really

766
00:32:25,340 --> 00:32:29,029
SSH and when RM by the way like was any

767
00:32:29,029 --> 00:32:31,070
of that traffic coming from something

768
00:32:31,070 --> 00:32:32,809
that's not designated as a controller

769
00:32:32,809 --> 00:32:35,090
and again you could maybe restrict that

770
00:32:35,090 --> 00:32:38,659
with some firewall rules so moving on to

771
00:32:38,659 --> 00:32:41,330
learning 9 we're going to set up a local

772
00:32:41,330 --> 00:32:42,769
lab in here

773
00:32:42,769 --> 00:32:44,690
it's all gonna be based in VirtualBox

774
00:32:44,690 --> 00:32:46,519
you could actually use terraform all

775
00:32:46,519 --> 00:32:47,899
that sort of good stuff but again this

776
00:32:47,899 --> 00:32:52,899
is local if you want to be able to maybe

777
00:32:52,899 --> 00:32:55,070
model an environment that's going to be

778
00:32:55,070 --> 00:32:57,889
so-called see if you want the model up

779
00:32:57,889 --> 00:33:01,070
in that attack before you take it into

780
00:33:01,070 --> 00:33:03,799
your real attack environment a maybe you

781
00:33:03,799 --> 00:33:05,990
want to try it some new cool privilege

782
00:33:05,990 --> 00:33:08,470
escalation type stuff all of us or stuff

783
00:33:08,470 --> 00:33:12,740
having built some personal labs and

784
00:33:12,740 --> 00:33:16,510
things at home this is a long

785
00:33:16,510 --> 00:33:19,640
process it's good to learn to do it once

786
00:33:19,640 --> 00:33:22,130
but it really is a waste of my time

787
00:33:22,130 --> 00:33:24,530
doing this sort of thing I will actually

788
00:33:24,530 --> 00:33:26,690
be publishing some stuff up and it get

789
00:33:26,690 --> 00:33:28,179
hub great all my own personal stuff

790
00:33:28,179 --> 00:33:31,429
later stand by for that how they

791
00:33:31,429 --> 00:33:34,429
actually do all of this but you know

792
00:33:34,429 --> 00:33:36,470
this is really cool in the sense that

793
00:33:36,470 --> 00:33:38,120
it's making use of those freely

794
00:33:38,120 --> 00:33:40,070
available windows isel's the trial

795
00:33:40,070 --> 00:33:42,950
versions that allows 480 days it's

796
00:33:42,950 --> 00:33:45,710
technically free so it is instead of

797
00:33:45,710 --> 00:33:48,770
your time so that's an interesting way

798
00:33:48,770 --> 00:33:52,429
to learn some stuff so you can see and

799
00:33:52,429 --> 00:33:55,970
here my lab setup it's just based again

800
00:33:55,970 --> 00:33:57,890
on they surprise surprise those cm3

801
00:33:57,890 --> 00:33:59,270
machines that we were attacking earlier

802
00:33:59,270 --> 00:34:01,760
at the main controller a member server

803
00:34:01,760 --> 00:34:02,780
and a workstation

804
00:34:02,780 --> 00:34:05,120
I'm the really good thing about this is

805
00:34:05,120 --> 00:34:06,620
that if you're dealing with there's a

806
00:34:06,620 --> 00:34:08,780
hundred need a trial version business

807
00:34:08,780 --> 00:34:11,780
with Microsoft so what we can actually

808
00:34:11,780 --> 00:34:16,310
do for instance with vagrant locally and

809
00:34:16,310 --> 00:34:18,199
we can say right hold everything

810
00:34:18,199 --> 00:34:22,040
bring it all down destroy those boxes

811
00:34:22,040 --> 00:34:24,409
and I bring them back up again and off

812
00:34:24,409 --> 00:34:26,000
it'll go and get you fresh installation

813
00:34:26,000 --> 00:34:27,859
and we're all rocking and rolling which

814
00:34:27,859 --> 00:34:31,940
is good okay so building out our boxes

815
00:34:31,940 --> 00:34:34,219
I'm actually gonna skip past the demo of

816
00:34:34,219 --> 00:34:35,869
this one in the interest of time in here

817
00:34:35,869 --> 00:34:38,119
today vagrant is something you would use

818
00:34:38,119 --> 00:34:41,270
locally to spin up a little boxes if

819
00:34:41,270 --> 00:34:42,560
you're doing this in the cloud you would

820
00:34:42,560 --> 00:34:45,469
use terraform good thing a bit vagrant

821
00:34:45,469 --> 00:34:47,570
if anybody's interested in it you can

822
00:34:47,570 --> 00:34:49,429
actually pull down a load of pre-built

823
00:34:49,429 --> 00:34:53,480
boxes from vagrant quite a google lot

824
00:34:53,480 --> 00:34:54,739
and it'll take you to it I've actually

825
00:34:54,739 --> 00:34:57,500
used these in some of the demos today

826
00:34:57,500 --> 00:35:01,910
it's quick and handy soidiers so I'm

827
00:35:01,910 --> 00:35:03,230
just gonna skip past that that's the

828
00:35:03,230 --> 00:35:05,510
vagrant file that this e tells it okay

829
00:35:05,510 --> 00:35:07,250
well what machines do I want built with

830
00:35:07,250 --> 00:35:09,350
whatever networking requirements they've

831
00:35:09,350 --> 00:35:11,780
got so on this kiss sir private network

832
00:35:11,780 --> 00:35:16,310
running inside VirtualBox on machine

833
00:35:16,310 --> 00:35:18,830
which interns at their ten-year-old

834
00:35:18,830 --> 00:35:20,690
Toshiba laptop that still actually works

835
00:35:20,690 --> 00:35:24,200
so demo in here I'll just screwin

836
00:35:24,200 --> 00:35:25,310
through it very very quickly I'm not

837
00:35:25,310 --> 00:35:26,930
going to go through all of it in here I

838
00:35:26,930 --> 00:35:29,240
will show you how will actually check on

839
00:35:29,240 --> 00:35:29,690
that

840
00:35:29,690 --> 00:35:31,940
and said right vagrant up go create me

841
00:35:31,940 --> 00:35:35,319
the raw basic machines in here so it's

842
00:35:35,319 --> 00:35:38,690
I'm gonna focus primarily on DC b-sides

843
00:35:38,690 --> 00:35:42,200
in here obviously it's going to make

844
00:35:42,200 --> 00:35:43,819
sure that there's no port forwarding

845
00:35:43,819 --> 00:35:45,619
conflicts for things such as three three

846
00:35:45,619 --> 00:35:48,650
at nine and stuff like that so it's

847
00:35:48,650 --> 00:35:50,450
literally as good as that now why would

848
00:35:50,450 --> 00:35:51,920
say is that technically after this

849
00:35:51,920 --> 00:35:54,770
actually runs you've actually got a box

850
00:35:54,770 --> 00:35:56,780
you can start to log into but it's

851
00:35:56,780 --> 00:35:59,300
pretty useless to us right now it's

852
00:35:59,300 --> 00:36:02,089
actually not doing very much for us so

853
00:36:02,089 --> 00:36:04,369
this is where I've actually brought in

854
00:36:04,369 --> 00:36:08,240
here ansible yeah thanks very much for

855
00:36:08,240 --> 00:36:09,890
bringing up the boxes vagrant or

856
00:36:09,890 --> 00:36:12,349
terraform but now I want to configure

857
00:36:12,349 --> 00:36:14,660
that this stuff I've actually been

858
00:36:14,660 --> 00:36:17,000
working on for a while I've collected a

859
00:36:17,000 --> 00:36:18,440
lot of stuff from a lot of different

860
00:36:18,440 --> 00:36:20,359
sources actually one of the things

861
00:36:20,359 --> 00:36:22,010
actually delay in me actually published

862
00:36:22,010 --> 00:36:23,180
and there's nothing github I want to

863
00:36:23,180 --> 00:36:24,710
make sure the right people get the right

864
00:36:24,710 --> 00:36:26,300
attribution whenever I actually publish

865
00:36:26,300 --> 00:36:27,980
all of this I saw lots of different

866
00:36:27,980 --> 00:36:31,579
things isolate it and I thought what if

867
00:36:31,579 --> 00:36:33,800
I bring all of this together do this and

868
00:36:33,800 --> 00:36:36,170
hopefully it will work for me so stand

869
00:36:36,170 --> 00:36:38,420
like that so we can see in here

870
00:36:38,420 --> 00:36:39,800
something that's going to actually run

871
00:36:39,800 --> 00:36:41,530
three play books

872
00:36:41,530 --> 00:36:44,030
so that's corresponding to three rules

873
00:36:44,030 --> 00:36:46,160
at the main controller a member server

874
00:36:46,160 --> 00:36:49,730
and a workstation concentrate primarily

875
00:36:49,730 --> 00:36:51,819
on the domain controller stuff in here

876
00:36:51,819 --> 00:36:55,339
it's gonna have three pieces associated

877
00:36:55,339 --> 00:36:56,990
with it some software i've called it

878
00:36:56,990 --> 00:36:58,700
obviously at night didn't DM it

879
00:36:58,700 --> 00:37:01,339
correctly but prerequisites that it

880
00:37:01,339 --> 00:37:03,650
needs for a Windows server some stuff

881
00:37:03,650 --> 00:37:05,300
that's actually common for everything

882
00:37:05,300 --> 00:37:07,190
I'm standing up and then the really good

883
00:37:07,190 --> 00:37:10,250
stuff for domain controller so here's

884
00:37:10,250 --> 00:37:11,990
where I would call it's all procedural

885
00:37:11,990 --> 00:37:15,920
in here so reboots actually in here that

886
00:37:15,920 --> 00:37:17,420
we've actually follow setting up with

887
00:37:17,420 --> 00:37:20,210
the Mian in here this is actually quite

888
00:37:20,210 --> 00:37:22,130
long again when you can read that to

889
00:37:22,130 --> 00:37:22,970
your heart's content

890
00:37:22,970 --> 00:37:25,069
once it's available and I get repo so

891
00:37:25,069 --> 00:37:27,260
this is everything relating to the

892
00:37:27,260 --> 00:37:28,579
establishment of that do me and

893
00:37:28,579 --> 00:37:30,010
controller hide a I want it configured

894
00:37:30,010 --> 00:37:34,700
and in this case that is actually being

895
00:37:34,700 --> 00:37:36,770
communicated over windows RM

896
00:37:36,770 --> 00:37:39,980
which all on that victim box be running

897
00:37:39,980 --> 00:37:43,550
a load of partial commands so this

898
00:37:43,550 --> 00:37:46,880
in there okay so I need to him that add

899
00:37:46,880 --> 00:37:48,710
an inventory which I've already got in

900
00:37:48,710 --> 00:37:52,220
here and no I actually want to say right

901
00:37:52,220 --> 00:37:54,710
go build that for me please while I go

902
00:37:54,710 --> 00:37:56,180
off and do something else more

903
00:37:56,180 --> 00:37:59,120
interesting hopefully this will actually

904
00:37:59,120 --> 00:38:07,340
yep so I'm Gavin that ansible a book

905
00:38:07,340 --> 00:38:08,840
called lab setup which is an

906
00:38:08,840 --> 00:38:10,130
amalgamation of those three other

907
00:38:10,130 --> 00:38:12,860
specific play books off you go and do

908
00:38:12,860 --> 00:38:15,350
this night if you're doing this box

909
00:38:15,350 --> 00:38:17,600
fresh we still have a load of stuff to

910
00:38:17,600 --> 00:38:19,490
download from the web they'll take a bit

911
00:38:19,490 --> 00:38:21,470
of time so this is a shortened sequence

912
00:38:21,470 --> 00:38:23,630
so you can see and hear a lot of things

913
00:38:23,630 --> 00:38:25,850
change this false basically I've already

914
00:38:25,850 --> 00:38:27,710
done that Leo I don't need to reinstall

915
00:38:27,710 --> 00:38:29,090
that but this just to give you an idea

916
00:38:29,090 --> 00:38:30,650
of the steps that it's actually running

917
00:38:30,650 --> 00:38:33,130
through in here to set that all up so

918
00:38:33,130 --> 00:38:35,600
lots of interesting stuff to do with

919
00:38:35,600 --> 00:38:38,300
partial firewall rules all of that

920
00:38:38,300 --> 00:38:44,690
lovely good stuff so reboots all that

921
00:38:44,690 --> 00:38:45,910
sort of thing

922
00:38:45,910 --> 00:38:48,170
ensuring us a domain controller so

923
00:38:48,170 --> 00:38:49,370
always yeah it's just previously gone

924
00:38:49,370 --> 00:38:52,040
from the prerequisites and to everything

925
00:38:52,040 --> 00:38:55,000
else I need now to make that operational

926
00:38:55,000 --> 00:38:58,910
DNS forwarders because I want them to

927
00:38:58,910 --> 00:39:00,200
actually have web access to download

928
00:39:00,200 --> 00:39:03,710
other stuff and then and here's well for

929
00:39:03,710 --> 00:39:05,900
a bit of fun I've actually put in some

930
00:39:05,900 --> 00:39:08,450
stuff to create some groups to play with

931
00:39:08,450 --> 00:39:11,000
and I are really nice sort of

932
00:39:11,000 --> 00:39:13,460
development of this would be to bring in

933
00:39:13,460 --> 00:39:17,480
a complete sort of inventory oh of users

934
00:39:17,480 --> 00:39:20,150
kind groups all that sort of stuff I've

935
00:39:20,150 --> 00:39:22,160
done some in here but that's a work in

936
00:39:22,160 --> 00:39:23,990
progress and you can see that's actually

937
00:39:23,990 --> 00:39:26,150
finished now I'm jumping into my

938
00:39:26,150 --> 00:39:29,060
VirtualBox in here all three servers are

939
00:39:29,060 --> 00:39:31,760
actually running and I'm just going to

940
00:39:31,760 --> 00:39:36,170
just go into recording to login to them

941
00:39:36,170 --> 00:39:38,240
so you can actually see that this is a

942
00:39:38,240 --> 00:39:40,460
workstation vagrants already logged into

943
00:39:40,460 --> 00:39:43,390
it it'll get kicked out in a second and

944
00:39:43,390 --> 00:39:47,080
what I can actually do in here is just

945
00:39:47,080 --> 00:39:48,890
hopefully interact with it we're about

946
00:39:48,890 --> 00:39:51,050
to get the Windows desktop in here and

947
00:39:51,050 --> 00:39:53,210
we'll get a message really soon in here

948
00:39:53,210 --> 00:39:55,260
that it's actually

949
00:39:55,260 --> 00:39:57,059
join the dummy and and all of that

950
00:39:57,059 --> 00:39:59,790
lovely good stuff Rowand but for three

951
00:39:59,790 --> 00:40:02,880
machines in here I was on a 72 megabit

952
00:40:02,880 --> 00:40:06,420
download internet connection

953
00:40:06,420 --> 00:40:09,000
it was taking me roughly about two hours

954
00:40:09,000 --> 00:40:12,780
to configure that three machine setup so

955
00:40:12,780 --> 00:40:14,280
your manage may vary so you can see in

956
00:40:14,280 --> 00:40:16,980
here workstation b-sides hack lab dot

957
00:40:16,980 --> 00:40:21,180
local nice so it's all there so it is so

958
00:40:21,180 --> 00:40:23,339
hopefully now I will be able to see or

959
00:40:23,339 --> 00:40:26,819
demean controller as well and just take

960
00:40:26,819 --> 00:40:28,740
a quick look at our server manager and

961
00:40:28,740 --> 00:40:30,420
then we'll actually take a look just to

962
00:40:30,420 --> 00:40:33,329
make sure that Active Directory has

963
00:40:33,329 --> 00:40:36,299
actually been set up there you have it

964
00:40:36,299 --> 00:40:37,680
it's all there

965
00:40:37,680 --> 00:40:40,020
we can see the two machines server

966
00:40:40,020 --> 00:40:40,859
b-sides

967
00:40:40,859 --> 00:40:44,430
and also the workstations as well and

968
00:40:44,430 --> 00:40:48,839
our users so we're all good there so you

969
00:40:48,839 --> 00:40:50,520
can start using that straightaway under

970
00:40:50,520 --> 00:40:52,470
stead if that x ID on you as in the

971
00:40:52,470 --> 00:40:55,290
trial rip it down obviously snapshot

972
00:40:55,290 --> 00:40:57,059
anything before on if you need any data

973
00:40:57,059 --> 00:41:00,150
off it alot lovely good stuff and you're

974
00:41:00,150 --> 00:41:03,450
ready to go so you can start your hack

975
00:41:03,450 --> 00:41:06,270
and slash research you can use that for

976
00:41:06,270 --> 00:41:08,970
any number of things you sharpen up your

977
00:41:08,970 --> 00:41:11,579
enumeration skills you want to try it

978
00:41:11,579 --> 00:41:13,020
some privilege escalation

979
00:41:13,020 --> 00:41:15,240
it's all there so it is so have a go at

980
00:41:15,240 --> 00:41:18,990
it so onto the last piece in here for

981
00:41:18,990 --> 00:41:22,079
the Clyde everything I've done here so

982
00:41:22,079 --> 00:41:24,599
far has been locally in a nice isolated

983
00:41:24,599 --> 00:41:29,099
lab with ansible I can configure

984
00:41:29,099 --> 00:41:31,470
machines anywhere whether it's on a

985
00:41:31,470 --> 00:41:33,240
local box or something to stop on the

986
00:41:33,240 --> 00:41:36,510
Clyde so I would say that you know this

987
00:41:36,510 --> 00:41:39,030
is gonna be equally useful to swim or

988
00:41:39,030 --> 00:41:40,589
actually building infrastructure up in

989
00:41:40,589 --> 00:41:43,200
the Clyde to attack some systems coming

990
00:41:43,200 --> 00:41:45,440
in from the outside so to speak

991
00:41:45,440 --> 00:41:48,750
terraform I actually love it because you

992
00:41:48,750 --> 00:41:51,180
can actually spin up machines in less

993
00:41:51,180 --> 00:41:53,700
than a minute the raw machines so no

994
00:41:53,700 --> 00:41:56,240
messing around with local ISO files but

995
00:41:56,240 --> 00:41:58,619
obviously if you're going to a clone

996
00:41:58,619 --> 00:42:00,540
environment you're going to have to

997
00:42:00,540 --> 00:42:02,520
start paying for it as well the

998
00:42:02,520 --> 00:42:04,589
terraform good first had basic sort of

999
00:42:04,589 --> 00:42:08,480
deployment of the machines my

1000
00:42:08,480 --> 00:42:10,710
terraform if you're spinning machines up

1001
00:42:10,710 --> 00:42:12,569
in the Clyde you can see and here this

1002
00:42:12,569 --> 00:42:14,640
is actually a digital ocean droplet and

1003
00:42:14,640 --> 00:42:15,839
there's full accreditation to this

1004
00:42:15,839 --> 00:42:17,910
person in here a really really good

1005
00:42:17,910 --> 00:42:19,529
source about doing all of the sort of

1006
00:42:19,529 --> 00:42:21,839
stuff it's got a digitalocean droplet in

1007
00:42:21,839 --> 00:42:25,140
here and then this section here called

1008
00:42:25,140 --> 00:42:27,950
provisional remote exact like this is

1009
00:42:27,950 --> 00:42:30,710
where there's a bit of crossover with

1010
00:42:30,710 --> 00:42:33,359
ansible you said well why on earth would

1011
00:42:33,359 --> 00:42:34,529
you actually need this little I put

1012
00:42:34,529 --> 00:42:36,990
everything in here where it's going to

1013
00:42:36,990 --> 00:42:39,059
be after you download and cobalt strike

1014
00:42:39,059 --> 00:42:41,640
and I'm done I don't need any of that

1015
00:42:41,640 --> 00:42:43,140
stuff that you're talking about an ounce

1016
00:42:43,140 --> 00:42:45,869
of all at all I would actually argue

1017
00:42:45,869 --> 00:42:48,180
once that's good for getting basic stuff

1018
00:42:48,180 --> 00:42:50,519
up and running what about the lifetime

1019
00:42:50,519 --> 00:42:53,279
of your attack infrastructure you're not

1020
00:42:53,279 --> 00:42:54,720
just gonna be spinning up a bunch of

1021
00:42:54,720 --> 00:42:56,759
servers you're gonna want to near be

1022
00:42:56,759 --> 00:42:59,579
take a look at that box over time to

1023
00:42:59,579 --> 00:43:01,440
make sure it's probably patched or if

1024
00:43:01,440 --> 00:43:03,710
there's been any intrusions and as well

1025
00:43:03,710 --> 00:43:06,089
also if there's going to be any servers

1026
00:43:06,089 --> 00:43:07,529
in there that are going to be serving up

1027
00:43:07,529 --> 00:43:09,869
malware etc you're gonna want to be able

1028
00:43:09,869 --> 00:43:11,789
to pull those log files down and

1029
00:43:11,789 --> 00:43:13,079
understand well higher my I've actually

1030
00:43:13,079 --> 00:43:15,660
been attacked I've actually had that

1031
00:43:15,660 --> 00:43:18,450
doing some stuff prepping for this last

1032
00:43:18,450 --> 00:43:20,940
week I'm just saying some stuff attempts

1033
00:43:20,940 --> 00:43:24,450
to brute force a web app which was which

1034
00:43:24,450 --> 00:43:26,039
is interesting so we want the actually

1035
00:43:26,039 --> 00:43:28,349
see those log files as well talked about

1036
00:43:28,349 --> 00:43:29,789
earlier if we're actually using that

1037
00:43:29,789 --> 00:43:32,039
inventory to go after some really useful

1038
00:43:32,039 --> 00:43:34,650
data on that a test it we want to be

1039
00:43:34,650 --> 00:43:36,930
able to pull all that back you can't

1040
00:43:36,930 --> 00:43:38,940
really do that with terraform and Simba

1041
00:43:38,940 --> 00:43:40,859
will be really really cool for that so

1042
00:43:40,859 --> 00:43:43,079
when the box is doing its job I need

1043
00:43:43,079 --> 00:43:46,079
some stuff brought back to me so that's

1044
00:43:46,079 --> 00:43:47,220
where I would say that's you know like

1045
00:43:47,220 --> 00:43:49,890
that's where ansible has the edge so you

1046
00:43:49,890 --> 00:43:52,140
can take a look in here this one is

1047
00:43:52,140 --> 00:43:53,400
something a craft that last night

1048
00:43:53,400 --> 00:43:56,249
actually I bite we've got a web server

1049
00:43:56,249 --> 00:43:58,470
on our client infrastructure running

1050
00:43:58,470 --> 00:44:01,079
nginx I like it because it's nice and

1051
00:44:01,079 --> 00:44:03,749
lightweight compared to Apache I want to

1052
00:44:03,749 --> 00:44:05,069
actually bring back those log files

1053
00:44:05,069 --> 00:44:07,380
maybe I want to type that into an Elk's

1054
00:44:07,380 --> 00:44:09,299
stack or if you've got several million

1055
00:44:09,299 --> 00:44:13,739
quid to put on Splunk go for it so you

1056
00:44:13,739 --> 00:44:16,559
can see in here it's bringing everything

1057
00:44:16,559 --> 00:44:19,349
down from data state and I can I just

1058
00:44:19,349 --> 00:44:21,059
say well para machine II and store that

1059
00:44:21,059 --> 00:44:22,020
off

1060
00:44:22,020 --> 00:44:24,540
which is really nice another really

1061
00:44:24,540 --> 00:44:26,040
interesting thing I know I'm cutting on

1062
00:44:26,040 --> 00:44:30,119
time in here because configuration

1063
00:44:30,119 --> 00:44:32,520
templates they're nerdy words further

1064
00:44:32,520 --> 00:44:34,980
called ginger - templates and it's

1065
00:44:34,980 --> 00:44:36,510
nothing against people with red hair

1066
00:44:36,510 --> 00:44:40,680
promise I like this stuff let's say that

1067
00:44:40,680 --> 00:44:44,430
you've actually got configuration files

1068
00:44:44,430 --> 00:44:46,950
maybe for running an engine X web server

1069
00:44:46,950 --> 00:44:48,630
where you need to do a lot of

1070
00:44:48,630 --> 00:44:50,930
customization on impera machine bases

1071
00:44:50,930 --> 00:44:54,119
you can copy that file over and then you

1072
00:44:54,119 --> 00:44:57,000
can be really useful and do some bastard

1073
00:44:57,000 --> 00:44:59,329
or sad or whatever it is you want to

1074
00:44:59,329 --> 00:45:02,099
customize that if you actually use

1075
00:45:02,099 --> 00:45:04,500
ansible templating it will say right I'm

1076
00:45:04,500 --> 00:45:06,869
taking that file I'm moving it over and

1077
00:45:06,869 --> 00:45:08,819
I will customize it for you at the same

1078
00:45:08,819 --> 00:45:11,609
time that's the real time see ever saw

1079
00:45:11,609 --> 00:45:13,190
this folks

1080
00:45:13,190 --> 00:45:17,790
so in summary ansible is a DevOps tool

1081
00:45:17,790 --> 00:45:20,609
red team's if they aren't agile and

1082
00:45:20,609 --> 00:45:23,040
utilizing DevOps tooling right now they

1083
00:45:23,040 --> 00:45:27,510
should be and the DevOps teams as well

1084
00:45:27,510 --> 00:45:29,790
know that or should know that this can

1085
00:45:29,790 --> 00:45:32,369
be used for good but if you've got an

1086
00:45:32,369 --> 00:45:33,630
answerable controller that's purely

1087
00:45:33,630 --> 00:45:35,520
locked though and pretty configured it

1088
00:45:35,520 --> 00:45:37,260
can actually be used as a weapon against

1089
00:45:37,260 --> 00:45:39,210
an organization it could actually end up

1090
00:45:39,210 --> 00:45:43,109
being the weakest link and also as you

1091
00:45:43,109 --> 00:45:45,809
saw in there it can be used to automate

1092
00:45:45,809 --> 00:45:48,329
some of the more mundane tasks Frias

1093
00:45:48,329 --> 00:45:50,130
better you want to spin up at your own

1094
00:45:50,130 --> 00:45:53,130
local Learning Labs so with that please

1095
00:45:53,130 --> 00:45:58,020
don't shoot me this next slide brilliant

1096
00:45:58,020 --> 00:45:59,609
I'm Mia Rizzo

1097
00:45:59,609 --> 00:46:02,720
any questions

1098
00:46:03,380 --> 00:46:07,109
any questions for Leo over there in the

1099
00:46:07,109 --> 00:46:19,289
back I am I just did a good question

1100
00:46:19,289 --> 00:46:20,789
cause you mentioned that like the

1101
00:46:20,789 --> 00:46:23,400
ansible controller is important for like

1102
00:46:23,400 --> 00:46:25,530
blue teams to lock down it was wondering

1103
00:46:25,530 --> 00:46:27,869
like as an attacker what's kind of the

1104
00:46:27,869 --> 00:46:30,089
most like out of all the ways to

1105
00:46:30,089 --> 00:46:32,460
configure sorry can you speak up a bit

1106
00:46:32,460 --> 00:46:33,930
oh sorry so I'm out of all the ways to

1107
00:46:33,930 --> 00:46:35,880
configure like these kind of keys to the

1108
00:46:35,880 --> 00:46:37,950
kingdom bet to them infrastructure sir

1109
00:46:37,950 --> 00:46:39,780
like for in regards to access management

1110
00:46:39,780 --> 00:46:41,849
whether that's rotating keys or like

1111
00:46:41,849 --> 00:46:43,289
provisioning them through like the

1112
00:46:43,289 --> 00:46:46,140
service and I what's what do you not

1113
00:46:46,140 --> 00:46:47,640
like isn't attacker the most like what

1114
00:46:47,640 --> 00:46:49,170
gets in your way the most in terms of

1115
00:46:49,170 --> 00:46:51,839
getting access to these not an attacker

1116
00:46:51,839 --> 00:46:55,230
it's a double-edged sword of medic we

1117
00:46:55,230 --> 00:46:56,849
all like to be able to compromise things

1118
00:46:56,849 --> 00:46:58,980
but sometimes when you compromise that's

1119
00:46:58,980 --> 00:47:02,880
a bad thing to really if there's maybe

1120
00:47:02,880 --> 00:47:04,260
some indications on here that I've been

1121
00:47:04,260 --> 00:47:06,240
able to get past things and here maybe

1122
00:47:06,240 --> 00:47:09,240
there's no network segmentation maybe

1123
00:47:09,240 --> 00:47:11,339
there is no two-factor authentication to

1124
00:47:11,339 --> 00:47:13,470
get SSH access to that ansible

1125
00:47:13,470 --> 00:47:15,900
controller box those are some things

1126
00:47:15,900 --> 00:47:19,200
maybe that we're lacking in there sure

1127
00:47:19,200 --> 00:47:27,180
thank you yep any more I mean where we

1128
00:47:27,180 --> 00:47:32,309
were back sorry just a question do you

1129
00:47:32,309 --> 00:47:34,650
see other products and lower down civil

1130
00:47:34,650 --> 00:47:36,470
being as Vaughn will disturb with attack

1131
00:47:36,470 --> 00:47:39,089
I'm here see I didn't hear ansible

1132
00:47:39,089 --> 00:47:41,880
itself is not a vulnerable product out

1133
00:47:41,880 --> 00:47:44,670
of the out of the box it's high it's

1134
00:47:44,670 --> 00:47:46,470
actually configured you could say that a

1135
00:47:46,470 --> 00:47:49,170
bit any software not specifically for

1136
00:47:49,170 --> 00:47:51,390
provisioning automation configuration

1137
00:47:51,390 --> 00:47:53,789
etc or what I'm recommending is that

1138
00:47:53,789 --> 00:47:56,279
just like any other software when you

1139
00:47:56,279 --> 00:47:58,859
actually deploy it do take a look about

1140
00:47:58,859 --> 00:48:00,809
how you can actually lock down access to

1141
00:48:00,809 --> 00:48:02,789
it's about you know like for instance if

1142
00:48:02,789 --> 00:48:03,960
you're dealing with a real estate in

1143
00:48:03,960 --> 00:48:06,660
there of God know so many servers do you

1144
00:48:06,660 --> 00:48:08,279
have actually firewall rules to say I

1145
00:48:08,279 --> 00:48:11,240
would only listen to you and you alone

1146
00:48:11,240 --> 00:48:14,450
the logging stuff etc it's really as I

1147
00:48:14,450 --> 00:48:16,700
think it was what Brian mentioned in his

1148
00:48:16,700 --> 00:48:18,800
keynote speech earlier on there really

1149
00:48:18,800 --> 00:48:20,359
should actually be some sort of

1150
00:48:20,359 --> 00:48:22,369
pre-flight checklist things that need to

1151
00:48:22,369 --> 00:48:23,950
be done before you let the server go

1152
00:48:23,950 --> 00:48:27,170
wild it's just that it's nothing really

1153
00:48:27,170 --> 00:48:30,650
new in that respect all right it's

1154
00:48:30,650 --> 00:48:32,390
lunchtime we are five minutes late so

1155
00:48:32,390 --> 00:48:35,180
guys have fun and girls with the lunch

1156
00:48:35,180 --> 00:48:37,130
thank you very much leo and give him a

1157
00:48:37,130 --> 00:48:39,550
warm man

