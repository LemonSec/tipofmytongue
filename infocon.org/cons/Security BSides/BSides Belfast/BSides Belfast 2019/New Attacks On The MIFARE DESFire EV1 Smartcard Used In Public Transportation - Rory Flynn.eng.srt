1
00:00:02,260 --> 00:00:05,660
okay hello everyone my name is Rory

2
00:00:05,660 --> 00:00:08,210
Flynn and this is figgity writes new

3
00:00:08,210 --> 00:00:11,269
attacks on the Mifare DESFire ev1 smart

4
00:00:11,269 --> 00:00:14,419
card used in public transportation so a

5
00:00:14,419 --> 00:00:17,150
bit about me I'm a security engineer in

6
00:00:17,150 --> 00:00:19,640
Dublin for those of you who aren't from

7
00:00:19,640 --> 00:00:24,080
Ireland or geographically unaware Dublin

8
00:00:24,080 --> 00:00:27,310
is about two hours by bus from Belfast

9
00:00:27,310 --> 00:00:31,460
you cross a little border there but mojo

10
00:00:31,460 --> 00:00:32,839
is kind of ruined the rest of this joke

11
00:00:32,839 --> 00:00:36,679
so maybe if besides is in January next

12
00:00:36,679 --> 00:00:40,489
one so I've just finished four years of

13
00:00:40,489 --> 00:00:41,960
computer science and Trinity College

14
00:00:41,960 --> 00:00:46,039
Dublin um I am a CTF player and I also

15
00:00:46,039 --> 00:00:49,699
co-founded Trinity CTF which is a CTF or

16
00:00:49,699 --> 00:00:50,769
Oneida Trinity

17
00:00:50,769 --> 00:00:53,300
I've made a few small security

18
00:00:53,300 --> 00:00:55,969
disclosures nothing too big to companies

19
00:00:55,969 --> 00:00:58,789
in the past um and this is also my first

20
00:00:58,789 --> 00:01:06,619
ever conference talk so so big thanks to

21
00:01:06,619 --> 00:01:09,520
besides both of us for the opportunity

22
00:01:09,520 --> 00:01:12,770
so what's the Mifare DESFire ev1 it's a

23
00:01:12,770 --> 00:01:15,500
bit of a mouthful it's the chip in a lot

24
00:01:15,500 --> 00:01:20,509
of public transport cards so for example

25
00:01:20,509 --> 00:01:22,939
the leap card is used in Dublin and

26
00:01:22,939 --> 00:01:24,530
other places in the Republic of Ireland

27
00:01:24,530 --> 00:01:27,799
and the Oyster card is used in London

28
00:01:27,799 --> 00:01:29,539
and both of these cards contain the

29
00:01:29,539 --> 00:01:32,869
Mifare as far an Eevee one more

30
00:01:32,869 --> 00:01:33,979
specifically it's a contactless

31
00:01:33,979 --> 00:01:36,289
smartcard chip originally made by

32
00:01:36,289 --> 00:01:39,009
Philips but then later acquired by an XP

33
00:01:39,009 --> 00:01:41,689
the Mifare brawn there's an entire range

34
00:01:41,689 --> 00:01:43,429
of smart cards not just the DESFire ev1

35
00:01:43,429 --> 00:01:47,270
the Mifare range has 77 percent of the

36
00:01:47,270 --> 00:01:48,829
transport ticketing sector so it's

37
00:01:48,829 --> 00:01:52,490
pretty much a huge monopoly the Mifare

38
00:01:52,490 --> 00:01:53,899
cards you may have heard them before

39
00:01:53,899 --> 00:01:55,549
because they have a certain reputation

40
00:01:55,549 --> 00:01:58,460
for security the Mifare classic was

41
00:01:58,460 --> 00:02:01,820
fully cracked around 2008 2009 by

42
00:02:01,820 --> 00:02:03,649
various researchers i'm is now

43
00:02:03,649 --> 00:02:05,119
considered fully broken

44
00:02:05,119 --> 00:02:06,829
no one should use it for access control

45
00:02:06,829 --> 00:02:10,038
or for public transport applications

46
00:02:10,038 --> 00:02:12,360
NXP actually sued radboud university

47
00:02:12,360 --> 00:02:15,390
knee my knee Megan who did this research

48
00:02:15,390 --> 00:02:19,470
in Dutch course in 2008 as a nine to

49
00:02:19,470 --> 00:02:22,099
prevent publication of that research

50
00:02:22,099 --> 00:02:24,870
there's a great contemporary account of

51
00:02:24,870 --> 00:02:28,980
that kind of process and how nxp came to

52
00:02:28,980 --> 00:02:31,890
see the researchers and in the paper

53
00:02:31,890 --> 00:02:34,500
called the fall of a tiny star by these

54
00:02:34,500 --> 00:02:39,540
two people so moving on to other DES

55
00:02:39,540 --> 00:02:41,849
fire I sorry other my fire cards the

56
00:02:41,849 --> 00:02:46,010
future the next generation of cards so

57
00:02:46,010 --> 00:02:49,590
we had the the DES fire some call it the

58
00:02:49,590 --> 00:02:51,510
ev0 it's a model before the one we're

59
00:02:51,510 --> 00:02:54,810
talking about today so some researchers

60
00:02:54,810 --> 00:02:57,810
in Brewer University to become in

61
00:02:57,810 --> 00:03:00,420
Germany finally could do differential

62
00:03:00,420 --> 00:03:02,940
power analysis so this is where you do

63
00:03:02,940 --> 00:03:05,340
really finite power measurements to

64
00:03:05,340 --> 00:03:08,190
determine and what operations for

65
00:03:08,190 --> 00:03:10,709
processor and the card is doing and from

66
00:03:10,709 --> 00:03:12,090
this they were able to determine the

67
00:03:12,090 --> 00:03:13,799
master key for any card just by

68
00:03:13,799 --> 00:03:15,569
measuring power when it's communicating

69
00:03:15,569 --> 00:03:19,260
with a with a reader so the card I'm

70
00:03:19,260 --> 00:03:20,910
talking about today that as far evreyone

71
00:03:20,910 --> 00:03:23,190
is currently uncracked and there has

72
00:03:23,190 --> 00:03:25,470
been some research about the tree random

73
00:03:25,470 --> 00:03:28,079
number generator from these people but

74
00:03:28,079 --> 00:03:29,940
we haven't seen any practical attacks

75
00:03:29,940 --> 00:03:34,349
just yes so it's in that context that I

76
00:03:34,349 --> 00:03:37,049
give legal disclaimers yes there are

77
00:03:37,049 --> 00:03:39,660
multiple so the first legal disclaimer

78
00:03:39,660 --> 00:03:41,879
um I carried out this research from my

79
00:03:41,879 --> 00:03:43,859
computer science undergrad project and

80
00:03:43,859 --> 00:03:46,410
however this talk today is in a personal

81
00:03:46,410 --> 00:03:48,419
capacity it doesn't represent my

82
00:03:48,419 --> 00:03:49,669
employer and it doesn't necessarily

83
00:03:49,669 --> 00:03:52,169
represent the opinions of Trinity

84
00:03:52,169 --> 00:03:55,829
College Dublin the second legal

85
00:03:55,829 --> 00:03:57,239
disclaimer is that none of the

86
00:03:57,239 --> 00:03:59,459
information presented here today wasn't

87
00:03:59,459 --> 00:04:02,900
aimed under non-disclosure agreement I

88
00:04:02,900 --> 00:04:05,609
didn't interact with any system that I

89
00:04:05,609 --> 00:04:07,410
didn't have fully permission to to

90
00:04:07,410 --> 00:04:10,829
interact with and I legitimately pay for

91
00:04:10,829 --> 00:04:12,120
all my public transport thanks for

92
00:04:12,120 --> 00:04:13,300
asking

93
00:04:13,300 --> 00:04:15,709
so the overall aim of my research

94
00:04:15,709 --> 00:04:17,269
project was to see if I can attack a

95
00:04:17,269 --> 00:04:19,370
simulated ticketing system using the

96
00:04:19,370 --> 00:04:24,830
Mifare DESFire ev1 so the documentation

97
00:04:24,830 --> 00:04:27,080
through this is all under NDA as I

98
00:04:27,080 --> 00:04:29,030
mentioned so you would have to sign an

99
00:04:29,030 --> 00:04:31,220
NDA if you wanted to learn even just how

100
00:04:31,220 --> 00:04:34,070
to use the caret . and so that's

101
00:04:34,070 --> 00:04:35,570
obviously not acceptable if I want to

102
00:04:35,570 --> 00:04:36,889
talk about it later

103
00:04:36,889 --> 00:04:39,590
so some open-source developers have made

104
00:04:39,590 --> 00:04:43,910
a fully compatible C API for further

105
00:04:43,910 --> 00:04:45,970
DESFire ev1 so you can create

106
00:04:45,970 --> 00:04:49,370
applications different for different

107
00:04:49,370 --> 00:04:51,410
types of scenarios and it obviously

108
00:04:51,410 --> 00:04:53,150
handles all of the like cryptographic

109
00:04:53,150 --> 00:04:56,150
state and the complex stuff so you can

110
00:04:56,150 --> 00:04:57,590
clean gain a lot of information about

111
00:04:57,590 --> 00:05:00,430
how the card works from this library so

112
00:05:00,430 --> 00:05:03,289
then I used Lib free fare to create a

113
00:05:03,289 --> 00:05:05,510
simulated public transporta on blank

114
00:05:05,510 --> 00:05:10,910
DESFire ev1 cards for various standard

115
00:05:10,910 --> 00:05:12,650
things you'd want to do for a public

116
00:05:12,650 --> 00:05:14,930
transport like topping up a card tagging

117
00:05:14,930 --> 00:05:17,930
on ticketing that sort of thing and then

118
00:05:17,930 --> 00:05:19,729
use this device which is called the

119
00:05:19,729 --> 00:05:23,750
proxmark 3 to snoop on communications

120
00:05:23,750 --> 00:05:26,330
between my genuine Reader and my genuine

121
00:05:26,330 --> 00:05:28,849
card to basically analyze it at that

122
00:05:28,849 --> 00:05:32,990
protocol level the proxmark 3 I think

123
00:05:32,990 --> 00:05:35,090
there might be a new version out now but

124
00:05:35,090 --> 00:05:38,810
it's basically a our microcontroller and

125
00:05:38,810 --> 00:05:42,200
an FPGA the FPGA does all of the fasts

126
00:05:42,200 --> 00:05:44,800
like radio related stuff

127
00:05:44,800 --> 00:05:47,180
demodulation modulation that sort of

128
00:05:47,180 --> 00:05:49,610
thing and then the you have the

129
00:05:49,610 --> 00:05:51,800
microcontroller for your your programs

130
00:05:51,800 --> 00:05:56,720
as well so the DES fire eveyone is

131
00:05:56,720 --> 00:05:59,510
fundamentally an authenticated file

132
00:05:59,510 --> 00:06:02,870
system using cryptography a card is

133
00:06:02,870 --> 00:06:05,030
divided up into a number of apps these

134
00:06:05,030 --> 00:06:06,500
apps might serve a purpose so you might

135
00:06:06,500 --> 00:06:08,630
have one for particular transport

136
00:06:08,630 --> 00:06:10,479
operator and another for another one

137
00:06:10,479 --> 00:06:13,580
another app for bike rental that sort of

138
00:06:13,580 --> 00:06:16,340
thing these apps have a number of files

139
00:06:16,340 --> 00:06:18,500
associated with them

140
00:06:18,500 --> 00:06:21,270
and these files grant permissions to

141
00:06:21,270 --> 00:06:24,090
particular keys within the app so

142
00:06:24,090 --> 00:06:25,350
there's a number of cryptographic keys

143
00:06:25,350 --> 00:06:27,360
associated with enough and then those

144
00:06:27,360 --> 00:06:29,070
keys are given permission to do

145
00:06:29,070 --> 00:06:31,139
particular operations such as like read

146
00:06:31,139 --> 00:06:34,290
write read only write only read and rice

147
00:06:34,290 --> 00:06:37,320
or change configuration that sort of

148
00:06:37,320 --> 00:06:39,389
thing there's different types of files

149
00:06:39,389 --> 00:06:41,190
as well which I'll get into during the

150
00:06:41,190 --> 00:06:45,020
presentation so there's various

151
00:06:45,020 --> 00:06:47,669
communications modes you can use when

152
00:06:47,669 --> 00:06:50,389
communicating with such as for eveyone

153
00:06:50,389 --> 00:06:52,710
broadly we're only concerned with the

154
00:06:52,710 --> 00:06:55,710
bottom two categories there the on the

155
00:06:55,710 --> 00:06:59,400
right legacy mode and modern mode so

156
00:06:59,400 --> 00:07:01,560
debug mode plain texts like no one

157
00:07:01,560 --> 00:07:03,630
should be really using that in a real

158
00:07:03,630 --> 00:07:06,780
life system no one really does so it's

159
00:07:06,780 --> 00:07:09,050
mostly for debugging your application

160
00:07:09,050 --> 00:07:11,940
legacy modes you can use three days or

161
00:07:11,940 --> 00:07:17,370
single days in legacy mode and those can

162
00:07:17,370 --> 00:07:20,789
be broken into max communications or

163
00:07:20,789 --> 00:07:23,070
inside for communications the modern

164
00:07:23,070 --> 00:07:25,380
modes then you can use another variant

165
00:07:25,380 --> 00:07:27,570
of three days it's basically the same

166
00:07:27,570 --> 00:07:30,690
thing but it's in a modern mode and you

167
00:07:30,690 --> 00:07:33,000
can use AES and same goes for those two

168
00:07:33,000 --> 00:07:36,840
modes as well max and in Seyfert we

169
00:07:36,840 --> 00:07:38,729
found you can find through non invasive

170
00:07:38,729 --> 00:07:40,470
methods that the leap carrot is

171
00:07:40,470 --> 00:07:42,810
currently using legacy modes and the

172
00:07:42,810 --> 00:07:45,090
Oyster card is currently using modern

173
00:07:45,090 --> 00:07:51,870
modes so the communications will use

174
00:07:51,870 --> 00:07:54,180
cipher block chaining and this is kind

175
00:07:54,180 --> 00:07:57,300
of important later so if you're

176
00:07:57,300 --> 00:07:59,820
operating in a in ciphered mode for

177
00:07:59,820 --> 00:08:01,889
example you're basically transmitting

178
00:08:01,889 --> 00:08:03,660
the cipher text output of the CBC

179
00:08:03,660 --> 00:08:06,900
operation whereas if you're using CBC

180
00:08:06,900 --> 00:08:09,210
marked mode you're transmitting

181
00:08:09,210 --> 00:08:11,699
plaintext but you're also transmitting a

182
00:08:11,699 --> 00:08:14,970
part of the final block of ciphertext to

183
00:08:14,970 --> 00:08:17,760
basically prove that you authenticate it

184
00:08:17,760 --> 00:08:20,340
that plaintext that you're authorized to

185
00:08:20,340 --> 00:08:25,860
send that plaintext so there is a number

186
00:08:25,860 --> 00:08:28,440
of keys associated with with the app

187
00:08:28,440 --> 00:08:29,820
with each app

188
00:08:29,820 --> 00:08:32,130
however you don't use them directly in

189
00:08:32,130 --> 00:08:36,510
the CBC operation instead you negotiate

190
00:08:36,510 --> 00:08:39,330
a session key with the card the card on

191
00:08:39,330 --> 00:08:39,659
the reader

192
00:08:39,659 --> 00:08:41,940
negotiate a session key and they do this

193
00:08:41,940 --> 00:08:43,229
through a process where they kind of

194
00:08:43,229 --> 00:08:44,850
prove to each other that they both know

195
00:08:44,850 --> 00:08:47,400
the key and the byproduct of this is a

196
00:08:47,400 --> 00:08:51,300
random of hopefully fully random session

197
00:08:51,300 --> 00:08:53,370
key that's unique to that particular

198
00:08:53,370 --> 00:08:55,940
session

199
00:08:56,810 --> 00:08:59,040
so that brings me to the first attack

200
00:08:59,040 --> 00:09:01,980
which is credit replay attack so this

201
00:09:01,980 --> 00:09:04,920
attack is mostly relevant to top up

202
00:09:04,920 --> 00:09:07,170
machines there's top of machines on the

203
00:09:07,170 --> 00:09:10,760
O'Connell Street in Dublin and so

204
00:09:10,760 --> 00:09:12,840
obviously in operation you do with your

205
00:09:12,840 --> 00:09:14,910
card all the time is you use it as a

206
00:09:14,910 --> 00:09:17,340
story to follow you and you top you have

207
00:09:17,340 --> 00:09:21,390
to top up and put money on the card so I

208
00:09:21,390 --> 00:09:24,510
wrote kind of a simulation of this for

209
00:09:24,510 --> 00:09:28,530
the Mifare DESFire basically simulating

210
00:09:28,530 --> 00:09:33,980
where someone's phone is going off here

211
00:09:33,980 --> 00:09:43,070
it's not mine I think that would be curl

212
00:09:43,070 --> 00:09:45,120
whoever's looking for their phone it's

213
00:09:45,120 --> 00:09:52,100
here Thanks no worries no worries

214
00:09:52,100 --> 00:09:56,970
yep so basically this is a an app that I

215
00:09:56,970 --> 00:10:00,120
wrote for crediting a certain file by a

216
00:10:00,120 --> 00:10:01,860
certain amount and this is using legacy

217
00:10:01,860 --> 00:10:05,490
mode so it basically just increases it

218
00:10:05,490 --> 00:10:07,410
sends a command to the card let me see

219
00:10:07,410 --> 00:10:10,950
if I can get my ex yeah so no that's

220
00:10:10,950 --> 00:10:17,730
refusing laser no come on there we go so

221
00:10:17,730 --> 00:10:21,570
yeah a nice little laser pointer so

222
00:10:21,570 --> 00:10:24,330
basically this command will say top of

223
00:10:24,330 --> 00:10:28,560
file number 1 by 2 and and then commit

224
00:10:28,560 --> 00:10:30,060
the transaction are we going to more use

225
00:10:30,060 --> 00:10:33,060
of it what transactions mean later hmm

226
00:10:33,060 --> 00:10:36,300
so if we run this if we run this

227
00:10:36,300 --> 00:10:38,520
particular piece of code and then we

228
00:10:38,520 --> 00:10:41,400
observe using the the proxmark what

229
00:10:41,400 --> 00:10:43,440
bytes get transmitted between the caret

230
00:10:43,440 --> 00:10:45,810
and the reader we can see you know we

231
00:10:45,810 --> 00:10:48,450
got this huge kind of dump of stuff and

232
00:10:48,450 --> 00:10:50,190
I've kind of tried to interpret here

233
00:10:50,190 --> 00:10:55,110
what the those mean so here you can see

234
00:10:55,110 --> 00:10:56,840
that there's an authentication procedure

235
00:10:56,840 --> 00:10:59,310
application selection integration

236
00:10:59,310 --> 00:11:00,930
procedure that's where the session key

237
00:11:00,930 --> 00:11:02,460
is negotiated that I mentioned earlier

238
00:11:02,460 --> 00:11:05,730
and then we have a credit command so

239
00:11:05,730 --> 00:11:08,580
this is legacy mode encrypted with 3

240
00:11:08,580 --> 00:11:11,100
days so that's actually one block of

241
00:11:11,100 --> 00:11:13,500
encrypted 3 days saying top-up file

242
00:11:13,500 --> 00:11:16,740
number 1 by 2 literally just increment

243
00:11:16,740 --> 00:11:19,770
the value in this file by 2 and then we

244
00:11:19,770 --> 00:11:22,680
commit the transaction so if we run that

245
00:11:22,680 --> 00:11:27,420
again we got a different credit command

246
00:11:27,420 --> 00:11:30,330
so this is because the session key for

247
00:11:30,330 --> 00:11:32,700
the second run and the first run are

248
00:11:32,700 --> 00:11:34,500
different because you've negotiated a

249
00:11:34,500 --> 00:11:37,710
new session key so this prevents you

250
00:11:37,710 --> 00:11:40,440
being able to just take the credit

251
00:11:40,440 --> 00:11:42,180
command and just play that back to the

252
00:11:42,180 --> 00:11:44,700
car at a later date and increment your

253
00:11:44,700 --> 00:11:48,210
balance so that's good well whatever

254
00:11:48,210 --> 00:11:50,640
happens if we credit twice in the same

255
00:11:50,640 --> 00:11:53,910
authentication session so if we just

256
00:11:53,910 --> 00:11:56,580
issue that credit command twice so this

257
00:11:56,580 --> 00:11:57,889
has a cumulative effect

258
00:11:57,889 --> 00:12:01,160
so this script should increment by 2 and

259
00:12:01,160 --> 00:12:06,379
then by 2 again so we should get 4 so

260
00:12:06,379 --> 00:12:08,089
something yeah strange happens they're

261
00:12:08,089 --> 00:12:10,759
getting cryptids of the same value and

262
00:12:10,759 --> 00:12:13,999
this introduces a replayability within

263
00:12:13,999 --> 00:12:16,669
the session where an attacker can replay

264
00:12:16,669 --> 00:12:18,980
the credit command multiple times to

265
00:12:18,980 --> 00:12:20,839
accumulate balance that they are not

266
00:12:20,839 --> 00:12:26,929
authorized to do so so what's the reason

267
00:12:26,929 --> 00:12:29,569
for this so before each command is is

268
00:12:29,569 --> 00:12:31,699
transmitted and the initialization

269
00:12:31,699 --> 00:12:35,749
vector for the CBC mode is reset to all

270
00:12:35,749 --> 00:12:41,389
null bytes and basically why you should

271
00:12:41,389 --> 00:12:43,309
use an initialization vector in general

272
00:12:43,309 --> 00:12:47,629
with a random nonce is to prevent the

273
00:12:47,629 --> 00:12:50,089
same plaintext getting encrypted to the

274
00:12:50,089 --> 00:12:55,910
same ciphertext so how would this look

275
00:12:55,910 --> 00:12:58,790
in reality um so I've introduced the

276
00:12:58,790 --> 00:13:00,949
concept of this relay in the middle it's

277
00:13:00,949 --> 00:13:02,239
kind of like a mom in the middle attack

278
00:13:02,239 --> 00:13:06,470
so you place this device between the

279
00:13:06,470 --> 00:13:08,660
genuine top of machine from the genuine

280
00:13:08,660 --> 00:13:12,290
card and you relay commands and and

281
00:13:12,290 --> 00:13:16,100
basically raw bytes and between the

282
00:13:16,100 --> 00:13:18,139
genuine machine the genuine top of

283
00:13:18,139 --> 00:13:20,899
machine and the genuine card and you can

284
00:13:20,899 --> 00:13:23,389
also do some processing which I'll

285
00:13:23,389 --> 00:13:27,529
mention there so in this scenario the

286
00:13:27,529 --> 00:13:29,449
top of machine issues one credit command

287
00:13:29,449 --> 00:13:31,399
because you've topped up by two year-old

288
00:13:31,399 --> 00:13:33,980
in a genuine way that goes we like that

289
00:13:33,980 --> 00:13:36,769
through to the genuine card or before we

290
00:13:36,769 --> 00:13:38,389
commit the transaction so when the relay

291
00:13:38,389 --> 00:13:40,189
sees that there's a commit transaction

292
00:13:40,189 --> 00:13:42,410
command coming through we just replay

293
00:13:42,410 --> 00:13:44,509
the credit command the same credit

294
00:13:44,509 --> 00:13:47,809
command multiple times to the carat in

295
00:13:47,809 --> 00:13:49,579
this way we can increment the balance

296
00:13:49,579 --> 00:13:54,589
and beyond that authorized by the top of

297
00:13:54,589 --> 00:13:58,879
machine so the affected modes for this

298
00:13:58,879 --> 00:14:03,529
attack are the legacy modes this is

299
00:14:03,529 --> 00:14:06,049
because that reset of the initialization

300
00:14:06,049 --> 00:14:07,930
vector to zero

301
00:14:07,930 --> 00:14:10,090
before each command transmission only

302
00:14:10,090 --> 00:14:13,840
happens in legacy mode in modern mode

303
00:14:13,840 --> 00:14:16,450
you don't resize you resize to zero at

304
00:14:16,450 --> 00:14:21,030
the start of the entire communication

305
00:14:21,690 --> 00:14:24,900
some modern mode is unaffected by this

306
00:14:24,900 --> 00:14:28,090
so the second attack is the faked ok

307
00:14:28,090 --> 00:14:32,290
response and this attack mostly concerns

308
00:14:32,290 --> 00:14:35,920
barriers so fire based systems you

309
00:14:35,920 --> 00:14:38,230
approach with your transport card you

310
00:14:38,230 --> 00:14:40,300
tag on it deducts the balance and

311
00:14:40,300 --> 00:14:43,540
records that you've made a journey and

312
00:14:43,540 --> 00:14:46,390
you can proceed to your train when you

313
00:14:46,390 --> 00:14:48,970
exit the train on the other side at the

314
00:14:48,970 --> 00:14:52,270
end of your journey and it will record

315
00:14:52,270 --> 00:14:54,010
that you've finished your journey and

316
00:14:54,010 --> 00:14:55,810
give you back a certain amount of

317
00:14:55,810 --> 00:15:00,580
balance so to mimic this I implemented a

318
00:15:00,580 --> 00:15:03,430
simple tag on program and lip reefer

319
00:15:03,430 --> 00:15:06,430
it's basically just writes h4 hello g4

320
00:15:06,430 --> 00:15:09,190
goodbye just showing kind of a tag on

321
00:15:09,190 --> 00:15:13,570
behavior so let's look at that with the

322
00:15:13,570 --> 00:15:15,900
proxmark see what bites are transmitted

323
00:15:15,900 --> 00:15:20,910
so we can see I forget my laser pointer

324
00:15:21,630 --> 00:15:24,810
come on

325
00:15:25,740 --> 00:15:30,730
well we can see that when the reader

326
00:15:30,730 --> 00:15:33,730
writes data to the carriage the carried

327
00:15:33,730 --> 00:15:36,700
responds with 0 0 which is ok I wrote

328
00:15:36,700 --> 00:15:39,960
that data to that sector thank you

329
00:15:39,960 --> 00:15:44,650
so there's other data there right so

330
00:15:44,650 --> 00:15:47,050
there's the final 2 bytes that's a CRC

331
00:15:47,050 --> 00:15:49,480
it's just for data corruption checking

332
00:15:49,480 --> 00:15:51,460
I'm so it's not actually a cryptographic

333
00:15:51,460 --> 00:15:57,220
tag or anything so yeah so the this is

334
00:15:57,220 --> 00:15:59,140
ultimately spoof Abel right because the

335
00:15:59,140 --> 00:16:01,420
card could just lie and say yeah I wrote

336
00:16:01,420 --> 00:16:02,050
that data

337
00:16:02,050 --> 00:16:06,040
definitely so an attack for this looks

338
00:16:06,040 --> 00:16:08,950
something like this so we have the

339
00:16:08,950 --> 00:16:13,780
genuine entrance barrier and we have our

340
00:16:13,780 --> 00:16:15,640
relay again we allow everything through

341
00:16:15,640 --> 00:16:17,870
to the card that is a read

342
00:16:17,870 --> 00:16:20,930
and then when the entrance buyer says

343
00:16:20,930 --> 00:16:22,880
okay write this data saying you made

344
00:16:22,880 --> 00:16:25,640
this journey and that um that we

345
00:16:25,640 --> 00:16:28,460
deducted your balance the relay just

346
00:16:28,460 --> 00:16:30,740
responds for the card saying yeah I

347
00:16:30,740 --> 00:16:36,290
totally wrote that thank you so yes so

348
00:16:36,290 --> 00:16:38,720
that response is spoofed so we've gotten

349
00:16:38,720 --> 00:16:41,930
through the barrier now what we've

350
00:16:41,930 --> 00:16:43,160
gotten through the barrier but the card

351
00:16:43,160 --> 00:16:44,720
isn't tagged on we don't have a valid

352
00:16:44,720 --> 00:16:48,740
ticket um so on the other side right the

353
00:16:48,740 --> 00:16:50,690
exit barrier should say you've got no

354
00:16:50,690 --> 00:16:51,650
ticket you know

355
00:16:51,650 --> 00:16:53,660
you don't you're committing an offense

356
00:16:53,660 --> 00:16:58,250
here so you would think that so I

357
00:16:58,250 --> 00:16:59,870
discussed this with my friend Connell

358
00:16:59,870 --> 00:17:01,820
during the year while I was working on

359
00:17:01,820 --> 00:17:05,660
the undergrad project and Connell said

360
00:17:05,660 --> 00:17:08,839
well one time that the barrier was

361
00:17:08,839 --> 00:17:11,119
broken when he entered the station and

362
00:17:11,119 --> 00:17:14,000
when he exited it it charged him maximum

363
00:17:14,000 --> 00:17:18,920
fare so this is what transport operators

364
00:17:18,920 --> 00:17:20,810
will do if he don't have a valid tag

365
00:17:20,810 --> 00:17:23,420
down ticket they'll just charge you the

366
00:17:23,420 --> 00:17:25,069
maximum fare assuming that you went the

367
00:17:25,069 --> 00:17:26,869
full length of the line the maximum

368
00:17:26,869 --> 00:17:30,560
length so hot tip to Connell for that

369
00:17:30,560 --> 00:17:33,380
tip because this enables us to do the

370
00:17:33,380 --> 00:17:36,080
exact same thing at the other side so

371
00:17:36,080 --> 00:17:38,120
when the barrier tries to write the fine

372
00:17:38,120 --> 00:17:43,790
of you know five or six euro or if

373
00:17:43,790 --> 00:17:47,590
you're in the UK like a million pounds

374
00:17:47,590 --> 00:17:51,620
the yeah the relay responds for you and

375
00:17:51,620 --> 00:17:53,690
you're like okay I definitely have that

376
00:17:53,690 --> 00:17:57,380
fine on my record and the barrier opens

377
00:17:57,380 --> 00:17:59,990
so in this way you can commit fraud on

378
00:17:59,990 --> 00:18:04,070
public transport you're welcome so the

379
00:18:04,070 --> 00:18:06,320
defected loads for this again are just

380
00:18:06,320 --> 00:18:08,660
the legacy modes and the reasoning for

381
00:18:08,660 --> 00:18:14,990
this is that in modern modes the cards

382
00:18:14,990 --> 00:18:17,750
response is associated with encrypted

383
00:18:17,750 --> 00:18:20,360
data or a Mac I'm depending on what mode

384
00:18:20,360 --> 00:18:22,640
you're operating in so the barrier can

385
00:18:22,640 --> 00:18:24,770
actually check like hey did you actually

386
00:18:24,770 --> 00:18:26,670
write off enough

387
00:18:26,670 --> 00:18:31,140
so modern modes are unaffected by this

388
00:18:31,140 --> 00:18:36,360
particular attack so the third attack is

389
00:18:36,360 --> 00:18:40,260
the suspended commish and this attack

390
00:18:40,260 --> 00:18:45,059
relates to barrier lift systems so I'm

391
00:18:45,059 --> 00:18:47,760
not sure if Belfast has a barrier lift

392
00:18:47,760 --> 00:18:51,540
system transport example but an example

393
00:18:51,540 --> 00:18:52,980
of this in Dublin is the Lewis right

394
00:18:52,980 --> 00:18:55,020
there's no one stopping you from getting

395
00:18:55,020 --> 00:18:57,240
on a Lewis without a ticket you're on

396
00:18:57,240 --> 00:18:59,010
the honor system and you will be checked

397
00:18:59,010 --> 00:19:02,070
as well that you've tagged on to a

398
00:19:02,070 --> 00:19:05,669
reader on the side of the platform and

399
00:19:05,669 --> 00:19:07,559
that you tag off then at the end of the

400
00:19:07,559 --> 00:19:09,419
journey so there's no barriers involved

401
00:19:09,419 --> 00:19:12,240
so it's kind of a different dynamic so

402
00:19:12,240 --> 00:19:16,049
let's see if we can travel for free on

403
00:19:16,049 --> 00:19:19,650
such systems this is an example of I

404
00:19:19,650 --> 00:19:23,190
think the Netherlands you just tagged on

405
00:19:23,190 --> 00:19:25,140
to your train there's no barriers down

406
00:19:25,140 --> 00:19:30,510
below yeah so I rewrote the target on

407
00:19:30,510 --> 00:19:33,540
application to use a modern mode AES and

408
00:19:33,540 --> 00:19:38,280
also teased transactions so just to

409
00:19:38,280 --> 00:19:40,650
explain what transactions there who has

410
00:19:40,650 --> 00:19:44,370
heard of a database transaction ok a

411
00:19:44,370 --> 00:19:46,140
good for you these are almost the exact

412
00:19:46,140 --> 00:19:48,030
same as database transactions so for

413
00:19:48,030 --> 00:19:49,610
those of you don't know what they are a

414
00:19:49,610 --> 00:19:52,799
database transaction essentially until

415
00:19:52,799 --> 00:19:55,080
you commit it none of the changes have

416
00:19:55,080 --> 00:19:56,790
been made so you can make a series of

417
00:19:56,790 --> 00:19:59,520
changes to your database and until you

418
00:19:59,520 --> 00:20:01,830
commit that transaction none of it has

419
00:20:01,830 --> 00:20:05,280
happened so there's a simple similar

420
00:20:05,280 --> 00:20:09,660
idea with the transport smart cards and

421
00:20:09,660 --> 00:20:12,510
that's an anti tearing mechanism so

422
00:20:12,510 --> 00:20:15,900
transactions are used to prevent data

423
00:20:15,900 --> 00:20:18,690
corruption when you for example remove

424
00:20:18,690 --> 00:20:21,630
your card in the middle of all of these

425
00:20:21,630 --> 00:20:23,309
data rights going on and you end up with

426
00:20:23,309 --> 00:20:26,070
like a corrupt card so they have this

427
00:20:26,070 --> 00:20:29,730
idea of committing a transaction as the

428
00:20:29,730 --> 00:20:33,179
final step and to ensure that your card

429
00:20:33,179 --> 00:20:37,260
doesn't end up in a corrupt state so

430
00:20:37,260 --> 00:20:39,570
here I kind of tried to to write that

431
00:20:39,570 --> 00:20:40,500
logic in

432
00:20:40,500 --> 00:20:43,020
live free fur it's the same hellogoodbye

433
00:20:43,020 --> 00:20:46,200
example and what using transactions and

434
00:20:46,200 --> 00:20:49,260
also using a modern a modern encryption

435
00:20:49,260 --> 00:20:53,100
mode that as far evreyone and which

436
00:20:53,100 --> 00:20:54,600
hopefully will result in a successful

437
00:20:54,600 --> 00:20:57,179
attack so the thing we notice here is

438
00:20:57,179 --> 00:21:00,740
that the commit transaction and command

439
00:21:00,740 --> 00:21:03,090
is always the last thing in the

440
00:21:03,090 --> 00:21:05,820
transmission almost always because if

441
00:21:05,820 --> 00:21:07,650
you think about it that's the last thing

442
00:21:07,650 --> 00:21:09,750
you want to do is just say okay finalize

443
00:21:09,750 --> 00:21:12,990
because otherwise you know someone could

444
00:21:12,990 --> 00:21:15,330
remove the power from the card after the

445
00:21:15,330 --> 00:21:19,860
commit transaction so this diagram looks

446
00:21:19,860 --> 00:21:22,289
a lot more complex and that's because it

447
00:21:22,289 --> 00:21:25,789
is it's kind of awful to explain as well

448
00:21:25,789 --> 00:21:29,850
but someone just I was going through

449
00:21:29,850 --> 00:21:31,980
this presentation yesterday with a few

450
00:21:31,980 --> 00:21:34,289
friends and they said well you should

451
00:21:34,289 --> 00:21:35,730
have called this Schrodinger's commit

452
00:21:35,730 --> 00:21:39,299
because you can kind of commit and not

453
00:21:39,299 --> 00:21:42,679
commit you know it's kind of like life

454
00:21:42,679 --> 00:21:46,080
but you have you have a tag on point

455
00:21:46,080 --> 00:21:48,809
right which is like this yoke umm so

456
00:21:48,809 --> 00:21:52,110
that's on the left in this diagram you

457
00:21:52,110 --> 00:21:53,490
have your relay in the middle again on

458
00:21:53,490 --> 00:21:56,520
your genuine card so you allow all of

459
00:21:56,520 --> 00:21:58,169
these commands to go through to the

460
00:21:58,169 --> 00:21:59,940
carriage right including the right data

461
00:21:59,940 --> 00:22:02,880
once and until we can miss this

462
00:22:02,880 --> 00:22:04,220
transaction

463
00:22:04,220 --> 00:22:06,570
none of that data has been written to

464
00:22:06,570 --> 00:22:09,960
permanent memory yes so what we can do

465
00:22:09,960 --> 00:22:13,500
in a barrier lift system is have a relay

466
00:22:13,500 --> 00:22:17,820
and we get to the commit transaction

467
00:22:17,820 --> 00:22:21,179
point and we just store that command in

468
00:22:21,179 --> 00:22:24,360
the memory of the relay keep our genuine

469
00:22:24,360 --> 00:22:27,750
card powered on and then keep pirate on

470
00:22:27,750 --> 00:22:30,059
throughout our journey if we get

471
00:22:30,059 --> 00:22:32,340
inspected on that journey we can allow

472
00:22:32,340 --> 00:22:33,960
the commit transaction come on through

473
00:22:33,960 --> 00:22:36,330
to the card this gives us a valid tagged

474
00:22:36,330 --> 00:22:38,940
on card however if we get to the end of

475
00:22:38,940 --> 00:22:39,870
our journey and we haven't been

476
00:22:39,870 --> 00:22:42,380
inspected we can just power off the card

477
00:22:42,380 --> 00:22:44,640
simulating you're kind of an error or a

478
00:22:44,640 --> 00:22:47,909
corruption and that write data never

479
00:22:47,909 --> 00:22:51,539
happened it's as if the card was never

480
00:22:51,539 --> 00:22:53,460
tagged on so that's

481
00:22:53,460 --> 00:22:57,899
that's one way to do fraud so um this

482
00:22:57,899 --> 00:23:00,090
attack affects both legacy and modern

483
00:23:00,090 --> 00:23:02,700
modes and it's kind of more of a logical

484
00:23:02,700 --> 00:23:09,690
attack so I went through a disclosure

485
00:23:09,690 --> 00:23:12,360
process obviously with the card

486
00:23:12,360 --> 00:23:16,260
manufacturer nxp um obviously this was

487
00:23:16,260 --> 00:23:18,090
in the context of the legal action over

488
00:23:18,090 --> 00:23:22,679
the Mifare classic so my supervisor in

489
00:23:22,679 --> 00:23:26,070
Trinity was a great help kind of for

490
00:23:26,070 --> 00:23:29,570
giving me legitimacy to the process and

491
00:23:29,570 --> 00:23:33,929
organizing for it to take place so I

492
00:23:33,929 --> 00:23:36,299
decided to send the final PDF of the

493
00:23:36,299 --> 00:23:38,520
paper to an XPS product security

494
00:23:38,520 --> 00:23:40,500
incident response team this is something

495
00:23:40,500 --> 00:23:42,029
they set up after the Mifare classic

496
00:23:42,029 --> 00:23:45,690
debacle and so they have a defined

497
00:23:45,690 --> 00:23:48,450
procedure for security researchers to

498
00:23:48,450 --> 00:23:51,450
report vulnerabilities to and XP and an

499
00:23:51,450 --> 00:23:55,080
XP do a really wide range of products

500
00:23:55,080 --> 00:23:56,640
they make a lot of processors crypto

501
00:23:56,640 --> 00:23:58,470
processors I think the Yubikey

502
00:23:58,470 --> 00:24:01,980
was using an XP tip as well so it's

503
00:24:01,980 --> 00:24:04,140
really a huge organization so it's well

504
00:24:04,140 --> 00:24:05,789
worth their while having this system oh

505
00:24:05,789 --> 00:24:07,770
I'm so they sent us in an out

506
00:24:07,770 --> 00:24:10,320
acknowledgement of receipt the next

507
00:24:10,320 --> 00:24:14,220
morning Fairplay that's great and after

508
00:24:14,220 --> 00:24:16,590
five days you know reading the paper

509
00:24:16,590 --> 00:24:18,210
obviously it's pretty long paper and

510
00:24:18,210 --> 00:24:21,960
they gave us an initial response so they

511
00:24:21,960 --> 00:24:23,669
said the attacks one and two which are

512
00:24:23,669 --> 00:24:26,130
the credit replay and the faked ok

513
00:24:26,130 --> 00:24:28,640
response they're known to an XP

514
00:24:28,640 --> 00:24:31,440
customers are told not to use backward

515
00:24:31,440 --> 00:24:35,190
compatibility modes and not only that

516
00:24:35,190 --> 00:24:36,419
but the Chrome Common Criteria

517
00:24:36,419 --> 00:24:39,690
evaluation for the card says not to use

518
00:24:39,690 --> 00:24:41,850
these modes I would dispute that point

519
00:24:41,850 --> 00:24:45,149
count criteria evaluation says not use

520
00:24:45,149 --> 00:24:47,669
single des it doesn't apply to the the

521
00:24:47,669 --> 00:24:51,120
three days legacy mode and they also

522
00:24:51,120 --> 00:24:53,250
said that the NDA documentation is much

523
00:24:53,250 --> 00:24:54,870
more explicit about telling people

524
00:24:54,870 --> 00:24:56,520
enough to use backwards compatibility

525
00:24:56,520 --> 00:24:58,380
modes I don't have sighted that

526
00:24:58,380 --> 00:25:00,510
documentation but we have to trust that

527
00:25:00,510 --> 00:25:01,020
it's correct

528
00:25:01,020 --> 00:25:04,500
so attack number three technology its

529
00:25:04,500 --> 00:25:05,790
new to an XP

530
00:25:05,790 --> 00:25:07,820
and they did say however it would affect

531
00:25:07,820 --> 00:25:10,470
likely affect other smart cards using

532
00:25:10,470 --> 00:25:13,350
that transaction-oriented model and what

533
00:25:13,350 --> 00:25:15,090
I next people consider countermeasures

534
00:25:15,090 --> 00:25:16,920
and new designs just implementing a

535
00:25:16,920 --> 00:25:20,670
Timex on the carrot they also kind of

536
00:25:20,670 --> 00:25:24,690
like left the ball in our course by

537
00:25:24,690 --> 00:25:28,440
saying like okay so this is what we know

538
00:25:28,440 --> 00:25:30,930
we don't know about that one okay keep

539
00:25:30,930 --> 00:25:32,480
us updated what you would want to do

540
00:25:32,480 --> 00:25:35,640
about your findings which in the context

541
00:25:35,640 --> 00:25:38,760
that the Mifare classic stuff is ominous

542
00:25:38,760 --> 00:25:43,740
AF so we requested a conference call to

543
00:25:43,740 --> 00:25:46,770
discuss a bit further with NIT P on that

544
00:25:46,770 --> 00:25:49,530
call we asked directly an XP confirmed

545
00:25:49,530 --> 00:25:51,150
that they don't plan to notify customers

546
00:25:51,150 --> 00:25:55,470
of of these attacks and we were aware

547
00:25:55,470 --> 00:25:59,790
that despite an XPS advice about

548
00:25:59,790 --> 00:26:01,620
backward compatibility modes that the

549
00:26:01,620 --> 00:26:06,690
leap card was using a legacy encryption

550
00:26:06,690 --> 00:26:08,670
was possibly vulnerable to these attacks

551
00:26:08,670 --> 00:26:12,720
and nxp have them listed as a customer

552
00:26:12,720 --> 00:26:14,970
success story on their website so we

553
00:26:14,970 --> 00:26:18,270
asked for a contact in the national

554
00:26:18,270 --> 00:26:20,760
transporters already of ireland and to

555
00:26:20,760 --> 00:26:22,410
just kind of do disclosure with them as

556
00:26:22,410 --> 00:26:25,860
well and we also told NH p that we plan

557
00:26:25,860 --> 00:26:32,100
to publish in four to five months so we

558
00:26:32,100 --> 00:26:33,870
went through the disclosure process with

559
00:26:33,870 --> 00:26:36,210
the MTA the National Transport Authority

560
00:26:36,210 --> 00:26:37,860
in Ireland they're responsible for the

561
00:26:37,860 --> 00:26:41,340
leap card system which covers a few

562
00:26:41,340 --> 00:26:43,170
different operators in Dublin its Dublin

563
00:26:43,170 --> 00:26:47,910
bus Irish rail and the Lewis system so

564
00:26:47,910 --> 00:26:50,310
we got a contact through an XP and also

565
00:26:50,310 --> 00:26:51,990
through the Irish national cybersecurity

566
00:26:51,990 --> 00:26:53,520
center we were kind of putting out

567
00:26:53,520 --> 00:26:57,180
multiple failures at the same time so we

568
00:26:57,180 --> 00:26:59,130
met with them in person it was a really

569
00:26:59,130 --> 00:27:01,850
productive conversation

570
00:27:01,850 --> 00:27:03,889
on a really technical level so we were

571
00:27:03,889 --> 00:27:04,999
able to talk with some of their

572
00:27:04,999 --> 00:27:08,600
engineers who work directly with with

573
00:27:08,600 --> 00:27:11,749
the leap card systems so attack one

574
00:27:11,749 --> 00:27:13,580
doesn't affect the leap card because

575
00:27:13,580 --> 00:27:15,080
they don't use this thing called a value

576
00:27:15,080 --> 00:27:18,259
file a value file is the is the only

577
00:27:18,259 --> 00:27:19,669
file you can use with the credited

578
00:27:19,669 --> 00:27:22,340
operation so they just write bounces

579
00:27:22,340 --> 00:27:24,320
directly as bytes to the cards on a

580
00:27:24,320 --> 00:27:27,440
standard file so attack 1 doesn't affect

581
00:27:27,440 --> 00:27:30,970
them by attacks 2 & 3 do affect them and

582
00:27:30,970 --> 00:27:34,039
what we discussed you know feasibility

583
00:27:34,039 --> 00:27:36,679
of things we actually gave them a demo

584
00:27:36,679 --> 00:27:40,009
of attack 1 yeah long story

585
00:27:40,009 --> 00:27:43,429
two attacks 2 & 3 do affect them um and

586
00:27:43,429 --> 00:27:45,919
we kind of discussed the practicalities

587
00:27:45,919 --> 00:27:49,399
of the attack right so right like our

588
00:27:49,399 --> 00:27:52,369
demo was like a bunch of wires and a

589
00:27:52,369 --> 00:27:55,369
laptop and you know multiple cards like

590
00:27:55,369 --> 00:27:58,759
elastic bonded to a reader and you know

591
00:27:58,759 --> 00:28:01,639
it was it was hard to imagine probably

592
00:28:01,639 --> 00:28:04,700
someone practically doing this like

593
00:28:04,700 --> 00:28:06,259
going out to their books and being like

594
00:28:06,259 --> 00:28:10,190
hey and like a massive array of wires

595
00:28:10,190 --> 00:28:13,309
coming out of their cars but you know so

596
00:28:13,309 --> 00:28:16,399
that was part of the discussion and we

597
00:28:16,399 --> 00:28:17,899
also discussed the possible back-end

598
00:28:17,899 --> 00:28:20,479
mitigations they could do so how could

599
00:28:20,479 --> 00:28:23,389
they detect someone using attack 2 & 3

600
00:28:23,389 --> 00:28:25,519
and we talked about like balance

601
00:28:25,519 --> 00:28:28,009
reconciliations so all of the barriers

602
00:28:28,009 --> 00:28:29,359
and stations and stuff

603
00:28:29,359 --> 00:28:31,970
I'm upload on a batch basis all of their

604
00:28:31,970 --> 00:28:33,859
transactions so there is a possibility

605
00:28:33,859 --> 00:28:36,799
of detecting well those balances don't

606
00:28:36,799 --> 00:28:41,059
add up I'm on the backend and possibly

607
00:28:41,059 --> 00:28:42,739
taking action against that person or

608
00:28:42,739 --> 00:28:50,179
blocking the card so I gave an XP and

609
00:28:50,179 --> 00:28:52,039
NTA a right to reply to this

610
00:28:52,039 --> 00:28:54,710
presentation and both of them are

611
00:28:54,710 --> 00:28:57,019
availing of that today so I'll just read

612
00:28:57,019 --> 00:29:00,349
verbatim what they've supplied so an XP

613
00:29:00,349 --> 00:29:03,799
is supplied these two slides so NXP

614
00:29:03,799 --> 00:29:05,330
likes to thank the researchers for their

615
00:29:05,330 --> 00:29:07,489
responsible disclosure we acknowledge

616
00:29:07,489 --> 00:29:10,309
all three vulnerabilities attacks number

617
00:29:10,309 --> 00:29:12,799
one and number two are not new they're

618
00:29:12,799 --> 00:29:14,509
related to the first generation dies

619
00:29:14,509 --> 00:29:15,110
fire

620
00:29:15,110 --> 00:29:18,380
I'm a three ICD 4G secure messaging

621
00:29:18,380 --> 00:29:21,140
protocol that nxp recommended already

622
00:29:21,140 --> 00:29:23,419
for several years since 2009 to no

623
00:29:23,419 --> 00:29:26,210
longer use the new versions

624
00:29:26,210 --> 00:29:29,179
eveyone eb-2 of the chip still support

625
00:29:29,179 --> 00:29:30,649
the old vulnerable protocol for

626
00:29:30,649 --> 00:29:32,720
backwards compatibility reasons however

627
00:29:32,720 --> 00:29:34,779
unless the old protocol is actually used

628
00:29:34,779 --> 00:29:39,140
the attack is not applicable attack

629
00:29:39,140 --> 00:29:41,240
number three is not specific for this

630
00:29:41,240 --> 00:29:44,809
product will only work when neither the

631
00:29:44,809 --> 00:29:47,360
entrance nor the exit is gated so our

632
00:29:47,360 --> 00:29:50,240
list system can be detected by back-end

633
00:29:50,240 --> 00:29:52,580
systems if this anomalous behavior takes

634
00:29:52,580 --> 00:29:54,440
place repeatedly and it can then lead to

635
00:29:54,440 --> 00:29:57,649
black listing the card it will also be

636
00:29:57,649 --> 00:29:59,779
solved from card side in the next

637
00:29:59,779 --> 00:30:01,940
generation of my ideas for that is under

638
00:30:01,940 --> 00:30:02,600
development

639
00:30:02,600 --> 00:30:04,700
a timeout is implemented to prevent the

640
00:30:04,700 --> 00:30:10,880
withholding of the transaction so an ta

641
00:30:10,880 --> 00:30:14,059
also gave us a statement I've kind of

642
00:30:14,059 --> 00:30:15,380
summarized their points because it's

643
00:30:15,380 --> 00:30:19,010
kind of lone also I have like 15 minutes

644
00:30:19,010 --> 00:30:22,820
left so I kind of need to fill time so

645
00:30:22,820 --> 00:30:25,880
here's the statement from n ta n ta was

646
00:30:25,880 --> 00:30:27,769
happy to work with Rory and T City on

647
00:30:27,769 --> 00:30:29,419
this investigation and wants to thank

648
00:30:29,419 --> 00:30:31,039
them for following best practice in how

649
00:30:31,039 --> 00:30:32,720
these vulnerabilities were reported and

650
00:30:32,720 --> 00:30:34,639
to meet with n ta to discuss their

651
00:30:34,639 --> 00:30:36,980
findings n ta is conscious that the

652
00:30:36,980 --> 00:30:38,360
security of the leap card scheme is

653
00:30:38,360 --> 00:30:40,700
dependent on a complex supply chain over

654
00:30:40,700 --> 00:30:43,639
which n th is not a full control an NT a

655
00:30:43,639 --> 00:30:45,409
is very aware that vulnerabilities and

656
00:30:45,409 --> 00:30:47,090
underlying technologies could seriously

657
00:30:47,090 --> 00:30:49,000
damage the reputation of this game

658
00:30:49,000 --> 00:30:51,769
regarding the exploits NT a has a series

659
00:30:51,769 --> 00:30:53,539
of black and mitigations in place for

660
00:30:53,539 --> 00:30:54,860
the attacks that were demonstrated

661
00:30:54,860 --> 00:30:57,230
including automated alerts and we have

662
00:30:57,230 --> 00:30:58,549
discussed one of the issues with the

663
00:30:58,549 --> 00:31:00,620
card manufacturer as its remediation is

664
00:31:00,620 --> 00:31:02,840
outside of our control leap cards can

665
00:31:02,840 --> 00:31:04,669
also be blocked if necessary which is a

666
00:31:04,669 --> 00:31:07,340
mitigating factor however there is a

667
00:31:07,340 --> 00:31:08,899
financial incentive for people to

668
00:31:08,899 --> 00:31:12,019
utilize these exploits so an ta is

669
00:31:12,019 --> 00:31:13,610
concerned about the potential impacts

670
00:31:13,610 --> 00:31:15,409
should they be weaponized or made more

671
00:31:15,409 --> 00:31:19,880
portable currently the transport

672
00:31:19,880 --> 00:31:21,320
operators have Revenue inspectors that

673
00:31:21,320 --> 00:31:23,210
patrol the transport network and would

674
00:31:23,210 --> 00:31:25,370
detect where a card was not updated if

675
00:31:25,370 --> 00:31:27,620
the tag on was route was not written to

676
00:31:27,620 --> 00:31:28,050
the

677
00:31:28,050 --> 00:31:29,880
before the inspector reached the

678
00:31:29,880 --> 00:31:32,130
cardholder on the other hand currently

679
00:31:32,130 --> 00:31:33,810
it would require less effort to not tag

680
00:31:33,810 --> 00:31:35,760
on at all rather than use utilize these

681
00:31:35,760 --> 00:31:38,370
exploits however there will always be

682
00:31:38,370 --> 00:31:40,200
someone who tries to fair of age no

683
00:31:40,200 --> 00:31:41,880
matter how secure the ticketing system

684
00:31:41,880 --> 00:31:44,340
for example the Lewes tram network is

685
00:31:44,340 --> 00:31:46,110
entirely open and on the railway there

686
00:31:46,110 --> 00:31:48,450
are many unmanned stations meaning the

687
00:31:48,450 --> 00:31:49,980
customers can enter without paying if

688
00:31:49,980 --> 00:31:51,780
they really want to so for the time

689
00:31:51,780 --> 00:31:53,180
being we don't think that these issues

690
00:31:53,180 --> 00:31:55,530
greatly increase our risk and revenue

691
00:31:55,530 --> 00:31:57,330
protection methods for countering fare

692
00:31:57,330 --> 00:31:59,640
evasion such as onboard inspections will

693
00:31:59,640 --> 00:32:02,070
continue to be required however we

694
00:32:02,070 --> 00:32:03,930
recognize that this is only true until

695
00:32:03,930 --> 00:32:07,950
the next exploit is discovered so I have

696
00:32:07,950 --> 00:32:10,110
a few people to thank and many thanks to

697
00:32:10,110 --> 00:32:12,030
my supervisor dr. Steven Farrell

698
00:32:12,030 --> 00:32:15,090
eternally he was my supervisor for the

699
00:32:15,090 --> 00:32:16,590
whole project and was really helpful

700
00:32:16,590 --> 00:32:19,170
with coordinating disclosure with the

701
00:32:19,170 --> 00:32:21,690
various parties I'm thanks to Bari

702
00:32:21,690 --> 00:32:24,270
Dorgan and Patricio Simeone at the MTA

703
00:32:24,270 --> 00:32:27,870
and thanks to Hans the young a10 XP for

704
00:32:27,870 --> 00:32:30,180
being our contact for the responsible

705
00:32:30,180 --> 00:32:33,180
disclosure and thanks also to Angie

706
00:32:33,180 --> 00:32:36,510
Watson who is with the AI TSO and he

707
00:32:36,510 --> 00:32:40,080
helped us draft a pre disclosure earlier

708
00:32:40,080 --> 00:32:44,820
this week to the NC NC s ce c isp thread

709
00:32:44,820 --> 00:32:48,270
sharing program also to Kevin Foley who

710
00:32:48,270 --> 00:32:51,050
helped us wit contacts at the MTA and

711
00:32:51,050 --> 00:32:53,820
there's huge open source work that went

712
00:32:53,820 --> 00:32:56,730
on and that really helped with this

713
00:32:56,730 --> 00:32:59,010
project and contributors to the proxmark

714
00:32:59,010 --> 00:33:00,750
projects and the live free fair projects

715
00:33:00,750 --> 00:33:03,930
in particular and we're great so thank

716
00:33:03,930 --> 00:33:06,450
you to them and thank you very much for

717
00:33:06,450 --> 00:33:09,060
listening you can download the

718
00:33:09,060 --> 00:33:12,000
presentation from that QR code yes so

719
00:33:12,000 --> 00:33:15,470
thank you very much and any questions

720
00:33:15,470 --> 00:33:20,439
[Applause]

721
00:33:21,380 --> 00:33:23,690
exactly no I'm not click enough - you're

722
00:33:23,690 --> 00:33:26,480
good after - that was really great thank

723
00:33:26,480 --> 00:33:28,039
you very much for a first-time talk it

724
00:33:28,039 --> 00:33:29,929
was brilliant guys anyone any questions

725
00:33:29,929 --> 00:33:36,309
I think we all are

726
00:33:40,809 --> 00:33:43,370
is there any great talk by the way thank

727
00:33:43,370 --> 00:33:45,529
you is there any sort of small-scale

728
00:33:45,529 --> 00:33:48,200
version of that relay that can be bought

729
00:33:48,200 --> 00:33:50,210
online Oh

730
00:33:50,210 --> 00:33:51,980
or do you if not do you think it would

731
00:33:51,980 --> 00:33:53,720
be feasible to build something smaller I

732
00:33:53,720 --> 00:33:55,460
think it would absolutely be feasible so

733
00:33:55,460 --> 00:33:57,289
the reason like there's not a demo here

734
00:33:57,289 --> 00:34:00,710
today is because the demo that we did

735
00:34:00,710 --> 00:34:02,690
have was kind of fudged because it was

736
00:34:02,690 --> 00:34:05,000
all running in user space so we have to

737
00:34:05,000 --> 00:34:08,300
manually increase the time I've for a

738
00:34:08,300 --> 00:34:10,040
transaction so I didn't feel comfortable

739
00:34:10,040 --> 00:34:12,079
kind of displaying something that was

740
00:34:12,079 --> 00:34:12,649
fudged

741
00:34:12,649 --> 00:34:14,359
but in hardware obviously you don't have

742
00:34:14,359 --> 00:34:17,300
those limitations so like one of the the

743
00:34:17,300 --> 00:34:18,739
reasons we were running into timing

744
00:34:18,739 --> 00:34:23,119
issues with the with the relay that we

745
00:34:23,119 --> 00:34:28,040
did have was the proxmark was using like

746
00:34:28,040 --> 00:34:30,379
usb polling and there's like a time on

747
00:34:30,379 --> 00:34:32,659
laughs so I wasn't working all the time

748
00:34:32,659 --> 00:34:34,668
I think it definitely can be

749
00:34:34,668 --> 00:34:37,879
miniaturized and in like hardware that

750
00:34:37,879 --> 00:34:39,918
could fit in a wallet which is obviously

751
00:34:39,918 --> 00:34:42,379
you know it's a lot easier to disguise a

752
00:34:42,379 --> 00:34:44,659
wallet and a lot of people keep their

753
00:34:44,659 --> 00:34:46,849
cards in their wallets and so I think

754
00:34:46,849 --> 00:34:49,550
yes it could it could be done but you

755
00:34:49,550 --> 00:34:51,349
know whether like it's worth your while

756
00:34:51,349 --> 00:34:57,460
going through that process yeah okay

757
00:34:57,579 --> 00:35:01,550
guys any other questions oh nice one say

758
00:35:01,550 --> 00:35:04,730
there's talked is about TransLink the

759
00:35:04,730 --> 00:35:06,680
how to go of them yet are you discussed

760
00:35:06,680 --> 00:35:08,240
anything with them unfortunately I'm not

761
00:35:08,240 --> 00:35:10,880
a regular visitor to Northern Ireland I

762
00:35:10,880 --> 00:35:12,800
should be more often though it's a

763
00:35:12,800 --> 00:35:15,560
beautiful part of the country so I

764
00:35:15,560 --> 00:35:17,599
haven't talked to TransLink as I

765
00:35:17,599 --> 00:35:22,339
mentioned the are pre disclosure to NCS

766
00:35:22,339 --> 00:35:23,720
see

767
00:35:23,720 --> 00:35:26,119
I am told that there is a few transport

768
00:35:26,119 --> 00:35:28,069
operators that are signed up to those

769
00:35:28,069 --> 00:35:30,170
alerts so they got a kind of a advance

770
00:35:30,170 --> 00:35:30,920
alert

771
00:35:30,920 --> 00:35:33,829
earlier in the week obviously ideally an

772
00:35:33,829 --> 00:35:35,900
XP would be talking to these people but

773
00:35:35,900 --> 00:35:38,740
they're not so that's their choice um

774
00:35:38,740 --> 00:35:42,170
yeah if anyone wants to contact me as I

775
00:35:42,170 --> 00:35:48,430
said email and Twitter there Thanks

776
00:35:48,430 --> 00:35:54,800
anyone else nope okay I'm gonna keep his

777
00:35:54,800 --> 00:35:55,940
captive here for a couple of minutes

778
00:35:55,940 --> 00:35:57,319
anyway we're just waiting on lunch can

779
00:35:57,319 --> 00:35:59,630
wait so rather than everybody highlight

780
00:35:59,630 --> 00:36:01,280
and give the staff no room if you don't

781
00:36:01,280 --> 00:36:03,140
mind just chilling here for a few months

782
00:36:03,140 --> 00:36:04,880
once again Roy thank you very much for

783
00:36:04,880 --> 00:36:06,250
your talk was really good

784
00:36:06,250 --> 00:36:10,599
[Applause]

