1
00:00:12,880 --> 00:00:15,280
all right

2
00:00:15,280 --> 00:00:16,960
there we go

3
00:00:16,960 --> 00:00:18,080
good now

4
00:00:18,080 --> 00:00:18,960
okay

5
00:00:18,960 --> 00:00:20,480
so i have i have a router and i've got

6
00:00:20,480 --> 00:00:22,320
an upstream connection a thousand bytes

7
00:00:22,320 --> 00:00:25,199
i transmit 2 000 bytes the router breaks

8
00:00:25,199 --> 00:00:28,080
it down into two smaller chunks transmit

9
00:00:28,080 --> 00:00:30,960
them one at a time across another then

10
00:00:30,960 --> 00:00:32,000
when it reaches the router on the other

11
00:00:32,000 --> 00:00:33,520
side it doesn't put them back together

12
00:00:33,520 --> 00:00:35,280
it makes it all the way to your

13
00:00:35,280 --> 00:00:37,600
workstation or your server or whatever

14
00:00:37,600 --> 00:00:40,160
the final destination of the packet is

15
00:00:40,160 --> 00:00:41,840
it's responsible for putting that back

16
00:00:41,840 --> 00:00:45,360
together so hackers figured out that

17
00:00:45,360 --> 00:00:47,120
different operating systems treat these

18
00:00:47,120 --> 00:00:48,399
things differently and so they could use

19
00:00:48,399 --> 00:00:50,559
this to evade packets so let's say that

20
00:00:50,559 --> 00:00:52,480
let's pretend these are bytes right

21
00:00:52,480 --> 00:00:53,920
they're actually going to be eight byte

22
00:00:53,920 --> 00:00:55,680
chunks that it transmits let's pretend

23
00:00:55,680 --> 00:00:57,600
each of these are

24
00:00:57,600 --> 00:00:59,120
bytes and i want to transmit let's say

25
00:00:59,120 --> 00:01:02,079
12 bytes across a network what an

26
00:01:02,079 --> 00:01:04,559
attacker can do is he can send

27
00:01:04,559 --> 00:01:05,920
three bytes

28
00:01:05,920 --> 00:01:08,720
with an offset right so the offset is

29
00:01:08,720 --> 00:01:11,439
each chunk is broken down and so the end

30
00:01:11,439 --> 00:01:14,000
point when it puts them back together

31
00:01:14,000 --> 00:01:15,360
it's going to get these pieces of a

32
00:01:15,360 --> 00:01:18,080
puzzle and the offset says okay put this

33
00:01:18,080 --> 00:01:20,799
this bit here and put this bit here so

34
00:01:20,799 --> 00:01:22,080
it knows how to put these things back

35
00:01:22,080 --> 00:01:23,759
into the right order so what the

36
00:01:23,759 --> 00:01:25,680
attacker says all right we'll transmit

37
00:01:25,680 --> 00:01:26,560
these

38
00:01:26,560 --> 00:01:28,320
three bytes here in position one at an

39
00:01:28,320 --> 00:01:30,640
offset of zero we'll transmit these

40
00:01:30,640 --> 00:01:32,159
packets at

41
00:01:32,159 --> 00:01:35,360
an offset of five these two bytes here

42
00:01:35,360 --> 00:01:37,439
and then we'll transmit these three

43
00:01:37,439 --> 00:01:40,400
bytes at an offset of position seven

44
00:01:40,400 --> 00:01:42,960
and then these four bytes at an offset

45
00:01:42,960 --> 00:01:45,119
of position two and these five and so

46
00:01:45,119 --> 00:01:46,720
forth right so if they transmit these

47
00:01:46,720 --> 00:01:47,759
packets

48
00:01:47,759 --> 00:01:49,520
then when the receiver puts them back

49
00:01:49,520 --> 00:01:50,560
together

50
00:01:50,560 --> 00:01:52,079
they've got to make some choices right

51
00:01:52,079 --> 00:01:54,240
what what bite is going to end up in

52
00:01:54,240 --> 00:01:57,759
this first spot well one of the four or

53
00:01:57,759 --> 00:02:00,240
the of these six fragments is what

54
00:02:00,240 --> 00:02:02,960
they're called six fragments only one of

55
00:02:02,960 --> 00:02:04,479
those fragments is claiming that they

56
00:02:04,479 --> 00:02:06,719
have a byte for position one

57
00:02:06,719 --> 00:02:08,479
but in position two

58
00:02:08,479 --> 00:02:10,560
there's actually two that are saying

59
00:02:10,560 --> 00:02:12,000
i've got a byte for you i've got some

60
00:02:12,000 --> 00:02:13,920
data for that position so who's gonna

61
00:02:13,920 --> 00:02:17,280
win right um the operating system like

62
00:02:17,280 --> 00:02:18,480
windows could say all right i'm gonna

63
00:02:18,480 --> 00:02:21,520
take whoever arrived first or the

64
00:02:21,520 --> 00:02:22,959
operating system like cisco could say

65
00:02:22,959 --> 00:02:25,280
i'm going to take whoever arrived last

66
00:02:25,280 --> 00:02:27,120
in which case the two different

67
00:02:27,120 --> 00:02:29,680
operating systems have a different view

68
00:02:29,680 --> 00:02:31,680
of the world right they they're going to

69
00:02:31,680 --> 00:02:34,239
see different packets and so if your

70
00:02:34,239 --> 00:02:36,080
intrusion detection system the things

71
00:02:36,080 --> 00:02:38,160
that's looking for attacks

72
00:02:38,160 --> 00:02:41,760
sees all these packets in four and is

73
00:02:41,760 --> 00:02:44,080
saying are there attacks here but

74
00:02:44,080 --> 00:02:45,680
the end point that's actually going to

75
00:02:45,680 --> 00:02:48,080
process the pact sees what's in packet

76
00:02:48,080 --> 00:02:49,040
two

77
00:02:49,040 --> 00:02:50,400
well then

78
00:02:50,400 --> 00:02:53,040
your ids says oh there's nothing evil

79
00:02:53,040 --> 00:02:55,920
here but the end point says there's evil

80
00:02:55,920 --> 00:02:58,000
here and so this is one of the ways that

81
00:02:58,000 --> 00:03:01,360
um this is it's been a problem but um so

82
00:03:01,360 --> 00:03:03,040
this has been known for for years

83
00:03:03,040 --> 00:03:04,879
fragment over

84
00:03:04,879 --> 00:03:06,640
fragment overlap attacks have been known

85
00:03:06,640 --> 00:03:08,000
for years and there's the best way to

86
00:03:08,000 --> 00:03:09,519
solve this by the way

87
00:03:09,519 --> 00:03:10,959
is to put something in the front of your

88
00:03:10,959 --> 00:03:13,120
network that reassembles all of these

89
00:03:13,120 --> 00:03:15,120
packets and just puts out a unique

90
00:03:15,120 --> 00:03:17,599
stream into your internal network okay

91
00:03:17,599 --> 00:03:20,319
but the thing is that even today right

92
00:03:20,319 --> 00:03:23,760
this can be a problem because well um

93
00:03:23,760 --> 00:03:26,959
although ids's what idss will also do

94
00:03:26,959 --> 00:03:28,480
your intrusion detection systems they

95
00:03:28,480 --> 00:03:29,360
will

96
00:03:29,360 --> 00:03:31,280
reassemble all these packets in all of

97
00:03:31,280 --> 00:03:34,080
these different flavors to so they can

98
00:03:34,080 --> 00:03:35,760
see every view of the world and they'll

99
00:03:35,760 --> 00:03:37,360
inspect all of the views of the world so

100
00:03:37,360 --> 00:03:38,720
they'll say there's definitely attack

101
00:03:38,720 --> 00:03:39,599
here

102
00:03:39,599 --> 00:03:41,120
right but

103
00:03:41,120 --> 00:03:44,080
we use wireshark to once we see get that

104
00:03:44,080 --> 00:03:45,280
alert we're going to pull it up in

105
00:03:45,280 --> 00:03:46,400
wireshark we're going to do it and which

106
00:03:46,400 --> 00:03:47,360
one of these

107
00:03:47,360 --> 00:03:49,840
what does wireshark do wireshark has one

108
00:03:49,840 --> 00:03:51,040
view of the world and it's not

109
00:03:51,040 --> 00:03:52,640
selectable and it's hard coded into the

110
00:03:52,640 --> 00:03:53,519
product

111
00:03:53,519 --> 00:03:55,439
so these this is what the different

112
00:03:55,439 --> 00:03:58,319
operating systems would see so windows

113
00:03:58,319 --> 00:04:00,480
sun mac os they would all see this

114
00:04:00,480 --> 00:04:02,400
stream of packets

115
00:04:02,400 --> 00:04:03,360
the

116
00:04:03,360 --> 00:04:05,840
cisco-based products see this linux

117
00:04:05,840 --> 00:04:08,799
operating systems see this and so forth

118
00:04:08,799 --> 00:04:10,000
there's some asterisks next to these

119
00:04:10,000 --> 00:04:11,360
because some of the operating systems

120
00:04:11,360 --> 00:04:13,760
have changed their behavior in recent

121
00:04:13,760 --> 00:04:14,480
years

122
00:04:14,480 --> 00:04:16,238
as the way they process these things but

123
00:04:16,238 --> 00:04:17,759
the problem is that wireshark is

124
00:04:17,759 --> 00:04:19,199
hard-coded

125
00:04:19,199 --> 00:04:21,839
that it will only show you

126
00:04:21,839 --> 00:04:23,280
this frame which

127
00:04:23,280 --> 00:04:25,759
um so when you're analyzing your packets

128
00:04:25,759 --> 00:04:28,080
in wireshark right you your your ids

129
00:04:28,080 --> 00:04:30,080
just said hey there's an attack that's

130
00:04:30,080 --> 00:04:31,840
going on in your network against a

131
00:04:31,840 --> 00:04:34,400
windows system and you say

132
00:04:34,400 --> 00:04:35,759
analyst i want to understand what's

133
00:04:35,759 --> 00:04:36,720
going on

134
00:04:36,720 --> 00:04:38,639
you download the packets you open them

135
00:04:38,639 --> 00:04:41,520
up in wireshark wire shark isn't showing

136
00:04:41,520 --> 00:04:43,440
you what your windows system saw right

137
00:04:43,440 --> 00:04:46,400
wireshark is showing you what well what

138
00:04:46,400 --> 00:04:51,360
aix operating systems freebsd hbux and

139
00:04:51,360 --> 00:04:54,080
vms with those operating systems all so

140
00:04:54,080 --> 00:04:55,520
those operating systems on your network

141
00:04:55,520 --> 00:04:57,360
are completely safe right but if you're

142
00:04:57,360 --> 00:05:00,400
using i don't know mac or windows or

143
00:05:00,400 --> 00:05:02,080
linux or cisco

144
00:05:02,080 --> 00:05:03,440
that's not what you're seeing when

145
00:05:03,440 --> 00:05:04,639
you're looking at wireshark so what

146
00:05:04,639 --> 00:05:06,160
reassembler does

147
00:05:06,160 --> 00:05:08,800
one packet in six packets out right so

148
00:05:08,800 --> 00:05:10,560
it will

149
00:05:10,560 --> 00:05:12,320
write those six p caps so you can look

150
00:05:12,320 --> 00:05:14,880
at each of the different

151
00:05:14,880 --> 00:05:17,280
packets in each of the reassemble format

152
00:05:17,280 --> 00:05:18,639
the other thing it does

153
00:05:18,639 --> 00:05:22,000
is it scans networks and it'll tell you

154
00:05:22,000 --> 00:05:25,199
what a remote network is using

155
00:05:25,199 --> 00:05:27,039
so if

156
00:05:27,039 --> 00:05:28,960
like me you're on the offensive side of

157
00:05:28,960 --> 00:05:30,160
the house and

158
00:05:30,160 --> 00:05:32,720
and your customer you want to avoid some

159
00:05:32,720 --> 00:05:34,320
intrusion detection systems on your

160
00:05:34,320 --> 00:05:36,000
customers network

161
00:05:36,000 --> 00:05:38,400
then i can use reassembler to scan

162
00:05:38,400 --> 00:05:40,720
a given company and say hey reach out to

163
00:05:40,720 --> 00:05:43,280
this company and fragment some packets

164
00:05:43,280 --> 00:05:45,680
and overlap them in different ways

165
00:05:45,680 --> 00:05:48,000
and tell me which of those different

166
00:05:48,000 --> 00:05:50,639
reassembly policies that we saw um is it

167
00:05:50,639 --> 00:05:53,280
being used and so here we can see that i

168
00:05:53,280 --> 00:05:55,039
scan facebook comes back says oh they're

169
00:05:55,039 --> 00:05:56,960
using the linux policy

170
00:05:56,960 --> 00:06:00,479
here amazon using the bsd policy and

171
00:06:00,479 --> 00:06:02,479
here when i ask for google it's saying

172
00:06:02,479 --> 00:06:04,240
sorry they're they're doing something

173
00:06:04,240 --> 00:06:06,240
they've get written their own tcp stack

174
00:06:06,240 --> 00:06:08,479
there that is not using any of the known

175
00:06:08,479 --> 00:06:10,880
reassembly policies so it'll scan those

176
00:06:10,880 --> 00:06:12,479
things so based upon that i can come

177
00:06:12,479 --> 00:06:14,400
back to here i can then look and see how

178
00:06:14,400 --> 00:06:16,880
would i overlap my fragments and that's

179
00:06:16,880 --> 00:06:18,720
reassembler and again you can get that

180
00:06:18,720 --> 00:06:21,759
for free on my website or github's

181
00:06:21,759 --> 00:06:24,560
website i don't own that one yet

182
00:06:24,560 --> 00:06:26,319
so i don't think i ever will all right

183
00:06:26,319 --> 00:06:29,360
so domain stats is on as a third tool

184
00:06:29,360 --> 00:06:31,120
that you can also get on my github page

185
00:06:31,120 --> 00:06:32,560
what domain stats

186
00:06:32,560 --> 00:06:33,520
is

187
00:06:33,520 --> 00:06:36,639
intended to do is to supplement your

188
00:06:36,639 --> 00:06:39,759
internal intrusion detection systems so

189
00:06:39,759 --> 00:06:42,400
um you know you have soft elgs zeke you

190
00:06:42,400 --> 00:06:43,680
have all these different tools that

191
00:06:43,680 --> 00:06:45,120
you've got that are monitoring your

192
00:06:45,120 --> 00:06:47,039
networks or maybe you have commercial

193
00:06:47,039 --> 00:06:49,199
security event management platforms that

194
00:06:49,199 --> 00:06:50,960
are collecting up all of these logs for

195
00:06:50,960 --> 00:06:52,560
these other things the idea of domain

196
00:06:52,560 --> 00:06:55,440
stats is it's going to be another server

197
00:06:55,440 --> 00:06:56,800
that you stand up on your network and

198
00:06:56,800 --> 00:06:58,319
you'll integrate it in

199
00:06:58,319 --> 00:07:00,720
with any of these other products and

200
00:07:00,720 --> 00:07:02,560
every time it sees a domain

201
00:07:02,560 --> 00:07:03,919
on your network

202
00:07:03,919 --> 00:07:06,479
a request for a host name google

203
00:07:06,479 --> 00:07:08,639
facebook whatever it'll send off that

204
00:07:08,639 --> 00:07:10,960
request to domain stats domain stats

205
00:07:10,960 --> 00:07:11,680
will

206
00:07:11,680 --> 00:07:12,800
look it up

207
00:07:12,800 --> 00:07:14,560
come up with some statistics on it and

208
00:07:14,560 --> 00:07:16,400
then give you back some information that

209
00:07:16,400 --> 00:07:18,000
you can then integrate in with your

210
00:07:18,000 --> 00:07:19,919
normal alerting

211
00:07:19,919 --> 00:07:24,560
it's looking for dgas dgas are

212
00:07:24,560 --> 00:07:26,720
dynamically generate you have a dynamic

213
00:07:26,720 --> 00:07:28,880
generation algorithm that is choosing

214
00:07:28,880 --> 00:07:30,960
host names randomly right if i'm an

215
00:07:30,960 --> 00:07:32,080
attacker

216
00:07:32,080 --> 00:07:34,000
and i want to set up a command and

217
00:07:34,000 --> 00:07:38,080
control network and i'm not going to buy

218
00:07:38,120 --> 00:07:40,800
mybotnet.com and send have all of my

219
00:07:40,800 --> 00:07:42,840
bots report back to buy net

220
00:07:42,840 --> 00:07:45,520
mybotnet.com because the fbi is going to

221
00:07:45,520 --> 00:07:48,000
come and take down my botnet.com and

222
00:07:48,000 --> 00:07:49,759
then i've lost control of all my bots

223
00:07:49,759 --> 00:07:51,759
right so instead what i'm going to do is

224
00:07:51,759 --> 00:07:54,479
i'm going to program all of the bots to

225
00:07:54,479 --> 00:07:57,120
have multiple names that they can choose

226
00:07:57,120 --> 00:07:58,879
and then go back to that same location

227
00:07:58,879 --> 00:08:01,039
so they take down my botnet we'll all

228
00:08:01,039 --> 00:08:03,360
meet at this next location this new

229
00:08:03,360 --> 00:08:05,360
random name that they're going to choose

230
00:08:05,360 --> 00:08:08,720
it's important that my bots don't

231
00:08:08,720 --> 00:08:10,800
randomly and accidentally choose

232
00:08:10,800 --> 00:08:13,680
google.com right because well i can't go

233
00:08:13,680 --> 00:08:15,919
buy that um hostname so

234
00:08:15,919 --> 00:08:16,720
these

235
00:08:16,720 --> 00:08:19,199
names tend to be very random looking

236
00:08:19,199 --> 00:08:20,960
right and they are made up of numbers

237
00:08:20,960 --> 00:08:22,639
they just look they look different they

238
00:08:22,639 --> 00:08:24,720
don't look like domains that we would

239
00:08:24,720 --> 00:08:26,800
ever choose because if they did then

240
00:08:26,800 --> 00:08:28,639
somebody might have chosen it and well

241
00:08:28,639 --> 00:08:31,280
then we can't purchase it so these dgo

242
00:08:31,280 --> 00:08:32,880
demands they they look different here

243
00:08:32,880 --> 00:08:35,440
you see a couple of examples of the kind

244
00:08:35,440 --> 00:08:37,360
of names that we see with command and

245
00:08:37,360 --> 00:08:39,120
control channels

246
00:08:39,120 --> 00:08:41,440
malware payload droppers and other

247
00:08:41,440 --> 00:08:43,679
things that are associated with malware

248
00:08:43,679 --> 00:08:45,519
these also appear in certificate names

249
00:08:45,519 --> 00:08:47,600
associated with malware so the ssl

250
00:08:47,600 --> 00:08:49,680
certificates and things like that

251
00:08:49,680 --> 00:08:51,360
actually these

252
00:08:51,360 --> 00:08:53,600
i'm sure nobody recognizes these but um

253
00:08:53,600 --> 00:08:55,839
these were disclosed by sands last year

254
00:08:55,839 --> 00:08:56,880
you see uh

255
00:08:56,880 --> 00:08:58,959
sands got popped with a phishing

256
00:08:58,959 --> 00:09:00,640
attack sometime last year and then they

257
00:09:00,640 --> 00:09:02,480
they did several broadcasts where they

258
00:09:02,480 --> 00:09:04,080
disclosed all the information they said

259
00:09:04,080 --> 00:09:05,360
so here's the

260
00:09:05,360 --> 00:09:06,800
domains that the attackers were using

261
00:09:06,800 --> 00:09:08,560
the malware that they used and they went

262
00:09:08,560 --> 00:09:09,760
through a full disclosure and showing

263
00:09:09,760 --> 00:09:10,959
everything that

264
00:09:10,959 --> 00:09:12,080
that happened would turn out to be

265
00:09:12,080 --> 00:09:14,320
pretty good so here's some actual

266
00:09:14,320 --> 00:09:16,240
domains that were used in this track and

267
00:09:16,240 --> 00:09:17,920
you can see that you know they don't

268
00:09:17,920 --> 00:09:19,040
look

269
00:09:19,040 --> 00:09:20,480
they don't look like domains that we

270
00:09:20,480 --> 00:09:22,399
would ever type right they're random

271
00:09:22,399 --> 00:09:23,279
looking

272
00:09:23,279 --> 00:09:25,600
well so one of the things that domain

273
00:09:25,600 --> 00:09:27,120
stats does is it

274
00:09:27,120 --> 00:09:28,720
identifies whether or not these are

275
00:09:28,720 --> 00:09:30,640
random by

276
00:09:30,640 --> 00:09:32,000
using what i call the the wheel of

277
00:09:32,000 --> 00:09:34,399
fortune method right i used to skip

278
00:09:34,399 --> 00:09:36,240
school a lot growing up and pretend to

279
00:09:36,240 --> 00:09:38,160
be sick and then watch wheel of fortune

280
00:09:38,160 --> 00:09:39,839
right and so i know

281
00:09:39,839 --> 00:09:42,480
that ivana just turned the letter q

282
00:09:42,480 --> 00:09:44,480
that the letter that's gonna after that

283
00:09:44,480 --> 00:09:45,680
is the letter

284
00:09:45,680 --> 00:09:47,760
u right i know if it ends in the letter

285
00:09:47,760 --> 00:09:49,600
r but there's a pretty good chance that

286
00:09:49,600 --> 00:09:51,519
the letter e is going to come before

287
00:09:51,519 --> 00:09:52,560
that

288
00:09:52,560 --> 00:09:54,160
and so i can

289
00:09:54,160 --> 00:09:55,760
measure the probability of certain

290
00:09:55,760 --> 00:09:57,360
character pairs

291
00:09:57,360 --> 00:09:58,640
and see

292
00:09:58,640 --> 00:10:01,120
well do those pairs

293
00:10:01,120 --> 00:10:04,079
is it likely that in oops a name i'm

294
00:10:04,079 --> 00:10:05,760
going to have

295
00:10:05,760 --> 00:10:08,240
a g followed by an o or an o followed by

296
00:10:08,240 --> 00:10:10,160
an o or an o followed by a g right

297
00:10:10,160 --> 00:10:12,000
what's the probability of each of those

298
00:10:12,000 --> 00:10:13,839
character pairs and then i can measure

299
00:10:13,839 --> 00:10:15,760
them so i build a table

300
00:10:15,760 --> 00:10:18,000
called a frequency table that comes with

301
00:10:18,000 --> 00:10:19,519
this tool called freak and it just

302
00:10:19,519 --> 00:10:21,600
measures these probabilities of these

303
00:10:21,600 --> 00:10:22,640
characters so here i'm measuring

304
00:10:22,640 --> 00:10:24,160
google.com and it gives me back some

305
00:10:24,160 --> 00:10:26,320
scores of six and four

306
00:10:26,320 --> 00:10:29,360
youtube i get back 10 and six and so

307
00:10:29,360 --> 00:10:30,959
that's what the scores look like for its

308
00:10:30,959 --> 00:10:33,440
if it's probably not a malicious domain

309
00:10:33,440 --> 00:10:35,120
but then when i start putting in some

310
00:10:35,120 --> 00:10:37,360
random looking characters here that we

311
00:10:37,360 --> 00:10:38,640
would see and these these are all

312
00:10:38,640 --> 00:10:40,000
legitimate

313
00:10:40,000 --> 00:10:41,839
um malware domains that i just grabbed

314
00:10:41,839 --> 00:10:43,360
off of a website that says here's some

315
00:10:43,360 --> 00:10:45,600
known bad actors on the internet just

316
00:10:45,600 --> 00:10:46,959
plug those in and you can see the scores

317
00:10:46,959 --> 00:10:51,200
drop way down right so twos fours threes

318
00:10:51,200 --> 00:10:53,360
right and so generally speaking if you

319
00:10:53,360 --> 00:10:55,200
get below a five on your first score

320
00:10:55,200 --> 00:10:56,640
below and a four on the second one then

321
00:10:56,640 --> 00:10:58,160
it's and it's likely

322
00:10:58,160 --> 00:11:00,480
a dga or a dynamically generated

323
00:11:00,480 --> 00:11:03,519
algorithm um so this will identify those

324
00:11:03,519 --> 00:11:05,680
as one of the things that domain stats

325
00:11:05,680 --> 00:11:06,800
does the other thing it does is it looks

326
00:11:06,800 --> 00:11:08,480
at the creation date

327
00:11:08,480 --> 00:11:10,160
of the domain when was the domain

328
00:11:10,160 --> 00:11:11,279
registered and here we're looking for

329
00:11:11,279 --> 00:11:15,120
what we call baby domains um

330
00:11:15,120 --> 00:11:16,560
so

331
00:11:16,560 --> 00:11:18,320
the other thing is if i want to stand up

332
00:11:18,320 --> 00:11:20,320
a legitimate organization a legitimate

333
00:11:20,320 --> 00:11:22,959
company and i might buy the domain stand

334
00:11:22,959 --> 00:11:24,560
up the website with great intentions and

335
00:11:24,560 --> 00:11:26,800
then it takes a year or two before you

336
00:11:26,800 --> 00:11:29,279
can actually get any customers to come

337
00:11:29,279 --> 00:11:30,959
to your website so

338
00:11:30,959 --> 00:11:33,760
having a website that is only

339
00:11:33,760 --> 00:11:36,959
i don't know days old weeks old months

340
00:11:36,959 --> 00:11:39,279
old and having lots of people know about

341
00:11:39,279 --> 00:11:40,880
it and go to it is

342
00:11:40,880 --> 00:11:43,360
not that common um things like

343
00:11:43,360 --> 00:11:44,800
google.com

344
00:11:44,800 --> 00:11:48,880
google.com was registered in 1997.

345
00:11:48,880 --> 00:11:51,839
uh youtube in 2005 right the the baby of

346
00:11:51,839 --> 00:11:54,560
the group here is snapchat and it is

347
00:11:54,560 --> 00:11:57,680
almost 10 years old now um that domain

348
00:11:57,680 --> 00:11:59,680
name but if we look at some domains that

349
00:11:59,680 --> 00:12:01,440
are associated with malware and

350
00:12:01,440 --> 00:12:02,720
specifically i'll look at the ones that

351
00:12:02,720 --> 00:12:05,440
were were disclosed in that sans uh sans

352
00:12:05,440 --> 00:12:07,760
fishing disclosure um you know the

353
00:12:07,760 --> 00:12:11,600
registrations are well recent um this

354
00:12:11,600 --> 00:12:14,959
they actually disclosed this on 7 24

355
00:12:14,959 --> 00:12:17,200
um 2020 is the day of the attack

356
00:12:17,200 --> 00:12:21,200
the registration date of this domain

357
00:12:21,200 --> 00:12:24,160
724 just hours before it was used in the

358
00:12:24,160 --> 00:12:26,480
phishing attempt right it was they

359
00:12:26,480 --> 00:12:28,480
purchased that domain and stood it up so

360
00:12:28,480 --> 00:12:29,519
if i can

361
00:12:29,519 --> 00:12:31,440
take every host name that you give me

362
00:12:31,440 --> 00:12:33,279
and i can look up when was this thing

363
00:12:33,279 --> 00:12:35,680
registered and determine is it

364
00:12:35,680 --> 00:12:37,279
is it is a domain that's been around for

365
00:12:37,279 --> 00:12:38,959
a while or

366
00:12:38,959 --> 00:12:40,720
is it a brand new domain and identify

367
00:12:40,720 --> 00:12:42,480
those baby domains then that's something

368
00:12:42,480 --> 00:12:43,839
that is useful to you so that's what

369
00:12:43,839 --> 00:12:45,760
domain stats does right you stand up it

370
00:12:45,760 --> 00:12:47,360
acts like a web server

371
00:12:47,360 --> 00:12:48,880
and then you'd send requests to your web

372
00:12:48,880 --> 00:12:51,360
server so here i'm asking for google.com

373
00:12:51,360 --> 00:12:52,959
i just got it running on my localhost

374
00:12:52,959 --> 00:12:55,279
ask hey what's google.com and i get back

375
00:12:55,279 --> 00:12:58,480
some a json response right json response

376
00:12:58,480 --> 00:13:01,040
so it's easily integrated into your uh

377
00:13:01,040 --> 00:13:03,120
your event management platforms it's got

378
00:13:03,120 --> 00:13:04,480
some alerts

379
00:13:04,480 --> 00:13:05,839
and then it's got some things like the

380
00:13:05,839 --> 00:13:07,279
category the category is always going to

381
00:13:07,279 --> 00:13:08,079
be

382
00:13:08,079 --> 00:13:10,720
is it new or is it established

383
00:13:10,720 --> 00:13:12,240
established in this case means it's two

384
00:13:12,240 --> 00:13:14,480
years old but that's tunable you can set

385
00:13:14,480 --> 00:13:15,920
you can whatever's

386
00:13:15,920 --> 00:13:17,440
established for you but i think two

387
00:13:17,440 --> 00:13:20,320
years is probably um a good number the

388
00:13:20,320 --> 00:13:22,000
alerts you can see here it's telling it

389
00:13:22,000 --> 00:13:23,920
this is your first contact

390
00:13:23,920 --> 00:13:26,320
meaning that no one in your organization

391
00:13:26,320 --> 00:13:30,320
has ever looked up google.com before

392
00:13:30,320 --> 00:13:32,399
all right so this is a brand new system

393
00:13:32,399 --> 00:13:34,800
i just stood this up for the um for

394
00:13:34,800 --> 00:13:36,800
capturing these sprint screens but you

395
00:13:36,800 --> 00:13:38,240
can imagine that

396
00:13:38,240 --> 00:13:41,120
on over a while over a number of months

397
00:13:41,120 --> 00:13:42,399
at first everything is going to be a

398
00:13:42,399 --> 00:13:44,480
first contact but once this system

399
00:13:44,480 --> 00:13:47,279
stabilizes and it learns what's normal

400
00:13:47,279 --> 00:13:49,680
for your organization well then it's got

401
00:13:49,680 --> 00:13:50,959
a list of the domains that you've gone

402
00:13:50,959 --> 00:13:52,880
to and if you've never gone to this

403
00:13:52,880 --> 00:13:55,120
domain before

404
00:13:55,120 --> 00:13:56,800
like you would for a phishing attempt or

405
00:13:56,800 --> 00:13:58,000
commanding control channel that just

406
00:13:58,000 --> 00:13:59,600
happened then it's going to identify

407
00:13:59,600 --> 00:14:01,360
that as one of its alerts that's in the

408
00:14:01,360 --> 00:14:02,720
alert section here i'll get the

409
00:14:02,720 --> 00:14:04,320
categories established here you can see

410
00:14:04,320 --> 00:14:06,160
the frequency scores and the rest of

411
00:14:06,160 --> 00:14:08,079
this is some of the detail how it looked

412
00:14:08,079 --> 00:14:11,440
up this information this is seen by the

413
00:14:11,440 --> 00:14:13,600
seen by internet or internet storm

414
00:14:13,600 --> 00:14:16,320
center isc it is how it looked these

415
00:14:16,320 --> 00:14:18,240
things up i can explain that in a little

416
00:14:18,240 --> 00:14:20,399
bit more detail later but there we see

417
00:14:20,399 --> 00:14:22,800
the date that this thing was ever

418
00:14:22,800 --> 00:14:25,199
first seen on the internet which is the

419
00:14:25,199 --> 00:14:27,199
registration date of google.com there's

420
00:14:27,199 --> 00:14:29,199
that 1997 date again

421
00:14:29,199 --> 00:14:30,560
and this is the first time it was ever

422
00:14:30,560 --> 00:14:32,560
seen by you right so the first time that

423
00:14:32,560 --> 00:14:34,079
uh your organization ever saw that

424
00:14:34,079 --> 00:14:36,079
domain so we'll we can take this stuff

425
00:14:36,079 --> 00:14:37,920
we can integrate these in here you can

426
00:14:37,920 --> 00:14:40,079
see i go to runcode.ninja an amazing

427
00:14:40,079 --> 00:14:41,920
website with lots of great ctf

428
00:14:41,920 --> 00:14:43,120
challenges looking forward to that

429
00:14:43,120 --> 00:14:45,120
coming back up soon

430
00:14:45,120 --> 00:14:46,959
runcode.ninja i go there the first time

431
00:14:46,959 --> 00:14:48,480
i get the your first contact my next

432
00:14:48,480 --> 00:14:50,480
request to run code.ninja that your

433
00:14:50,480 --> 00:14:53,120
first contact alert goes away so i can

434
00:14:53,120 --> 00:14:55,680
see when i go to a domain for the first

435
00:14:55,680 --> 00:14:57,440
time

436
00:14:57,440 --> 00:15:00,000
so here's some some lookups of those

437
00:15:00,000 --> 00:15:02,160
domains that were in that phishing

438
00:15:02,160 --> 00:15:04,560
disclosure so had sans been running this

439
00:15:04,560 --> 00:15:06,800
at the time then this is what their

440
00:15:06,800 --> 00:15:08,800
analysts would have seen um in their

441
00:15:08,800 --> 00:15:10,000
list they would have seen an alert that

442
00:15:10,000 --> 00:15:12,160
says hey i want you to know this is your

443
00:15:12,160 --> 00:15:15,680
first contact at a domain which has some

444
00:15:15,680 --> 00:15:17,920
suspect frequency scores it looks like a

445
00:15:17,920 --> 00:15:20,880
dga to me you've never gone there before

446
00:15:20,880 --> 00:15:23,199
and this is a brand new domain so this

447
00:15:23,199 --> 00:15:24,560
is not a domain that's been on there so

448
00:15:24,560 --> 00:15:26,079
three alerts there to to give you a

449
00:15:26,079 --> 00:15:28,560
strong indicator of compromise um and

450
00:15:28,560 --> 00:15:30,240
then here's here's the second domain

451
00:15:30,240 --> 00:15:32,000
you'll notice this one has low frequency

452
00:15:32,000 --> 00:15:34,240
scores so the difference between suspect

453
00:15:34,240 --> 00:15:36,800
frequency scores and low is

454
00:15:36,800 --> 00:15:39,759
suspect says one of those two scores was

455
00:15:39,759 --> 00:15:42,560
below its threshold low means both of

456
00:15:42,560 --> 00:15:45,920
those scores were below their threshold

457
00:15:45,920 --> 00:15:47,360
is what those mean

458
00:15:47,360 --> 00:15:48,399
okay

459
00:15:48,399 --> 00:15:50,000
this tool is ready today you can

460
00:15:50,000 --> 00:15:52,160
download it

461
00:15:52,160 --> 00:15:55,519
the name resolution is limited to really

462
00:15:55,519 --> 00:15:58,079
rdap and me giving you so when you

463
00:15:58,079 --> 00:15:59,279
download it

464
00:15:59,279 --> 00:16:02,240
it'll preload the born on dates what

465
00:16:02,240 --> 00:16:04,240
we'll call the the date registration for

466
00:16:04,240 --> 00:16:05,839
all of uh for about the top 1 million

467
00:16:05,839 --> 00:16:06,959
domains

468
00:16:06,959 --> 00:16:08,480
and then the rest it'll look up over

469
00:16:08,480 --> 00:16:11,120
rdap and rdap has

470
00:16:11,120 --> 00:16:13,360
limited support for a certain number of

471
00:16:13,360 --> 00:16:14,560
domains so

472
00:16:14,560 --> 00:16:16,160
it doesn't do very well with like the

473
00:16:16,160 --> 00:16:17,279
country

474
00:16:17,279 --> 00:16:19,120
codes like the

475
00:16:19,120 --> 00:16:21,040
dot uk domains and things like that it

476
00:16:21,040 --> 00:16:22,800
doesn't do very well actually there's no

477
00:16:22,800 --> 00:16:24,800
doubt uk um it doesn't do well for the

478
00:16:24,800 --> 00:16:26,800
country codes um that are on and looking

479
00:16:26,800 --> 00:16:28,880
those up but

480
00:16:28,880 --> 00:16:30,959
it that those protocols will be added to

481
00:16:30,959 --> 00:16:33,120
the when they add those those countries

482
00:16:33,120 --> 00:16:35,600
to the rdap support then

483
00:16:35,600 --> 00:16:39,040
then the tool will support it as well

484
00:16:39,040 --> 00:16:42,079
there are some plans for for having rdap

485
00:16:42,079 --> 00:16:43,519
actually resolve through the sans

486
00:16:43,519 --> 00:16:46,079
internet storm center

487
00:16:46,079 --> 00:16:48,320
and then have them actually look up with

488
00:16:48,320 --> 00:16:50,480
a paid service that goes directly to who

489
00:16:50,480 --> 00:16:51,440
is

490
00:16:51,440 --> 00:16:52,880
and if we do that that'll have an

491
00:16:52,880 --> 00:16:54,800
additional advantage in that you'll be

492
00:16:54,800 --> 00:16:56,399
able to get an alert that says all right

493
00:16:56,399 --> 00:16:58,000
of all the people that are running

494
00:16:58,000 --> 00:17:00,160
domain stats you're the first person to

495
00:17:00,160 --> 00:17:01,680
ever look up this domain so you could

496
00:17:01,680 --> 00:17:04,079
have you know this is new to you new to

497
00:17:04,079 --> 00:17:06,079
the web and it's new to all of the

498
00:17:06,079 --> 00:17:08,400
domain stats users if we centralize that

499
00:17:08,400 --> 00:17:11,520
but um but that the the um having that

500
00:17:11,520 --> 00:17:13,280
centralized login has been delayed for a

501
00:17:13,280 --> 00:17:14,880
while i don't know when we'll get

502
00:17:14,880 --> 00:17:16,319
internet storm center to

503
00:17:16,319 --> 00:17:18,400
host that for us

504
00:17:18,400 --> 00:17:20,319
um so where do you get this again it's

505
00:17:20,319 --> 00:17:22,559
on my website it's got zeke integration

506
00:17:22,559 --> 00:17:24,079
scripts so if you want to integrate this

507
00:17:24,079 --> 00:17:26,400
with zeek you can do it it's got docker

508
00:17:26,400 --> 00:17:28,720
scripts so you can um you can run this

509
00:17:28,720 --> 00:17:30,400
within a docker and all of these are

510
00:17:30,400 --> 00:17:31,280
there so

511
00:17:31,280 --> 00:17:32,720
this is all you have to do if you want

512
00:17:32,720 --> 00:17:34,720
to run in a docker is just docker build

513
00:17:34,720 --> 00:17:36,480
and then point it at my github page and

514
00:17:36,480 --> 00:17:38,799
it'll it'll build that docker file for

515
00:17:38,799 --> 00:17:40,400
you and you can run it in the docker

516
00:17:40,400 --> 00:17:41,520
some additional instructions on the

517
00:17:41,520 --> 00:17:43,760
website for getting it installed

518
00:17:43,760 --> 00:17:46,240
it comes with some elastic pipelines so

519
00:17:46,240 --> 00:17:47,760
you can ingest this information into

520
00:17:47,760 --> 00:17:49,840
security onion and you get some nice

521
00:17:49,840 --> 00:17:51,600
alerting at a security one so here you

522
00:17:51,600 --> 00:17:53,440
can see my suspect frequency scores my

523
00:17:53,440 --> 00:17:55,760
low frequency scores first contacts are

524
00:17:55,760 --> 00:17:57,280
all alerted through this elastic

525
00:17:57,280 --> 00:17:58,320
pipeline

526
00:17:58,320 --> 00:17:59,360
and here's

527
00:17:59,360 --> 00:18:02,080
another look at some more security onion

528
00:18:02,080 --> 00:18:03,679
then it just makes it so much prettier

529
00:18:03,679 --> 00:18:05,360
right than than looking at a json

530
00:18:05,360 --> 00:18:07,600
response so we can see over time the

531
00:18:07,600 --> 00:18:10,720
kind of domains that i'm getting okay

532
00:18:10,720 --> 00:18:12,160
uh another tool

533
00:18:12,160 --> 00:18:14,000
um that you can download for free on my

534
00:18:14,000 --> 00:18:16,240
github it's called api ifi

535
00:18:16,240 --> 00:18:18,640
um api if i what like my goal here is

536
00:18:18,640 --> 00:18:20,799
just to save you one command a day right

537
00:18:20,799 --> 00:18:22,320
we whenever you're doing incident

538
00:18:22,320 --> 00:18:24,880
response or network monitoring and you

539
00:18:24,880 --> 00:18:27,039
see an alert you see some domain that's

540
00:18:27,039 --> 00:18:28,400
on on the network

541
00:18:28,400 --> 00:18:30,240
right we've all got some go to commands

542
00:18:30,240 --> 00:18:32,880
something that that we do first

543
00:18:32,880 --> 00:18:34,240
to see

544
00:18:34,240 --> 00:18:36,000
you know what what's up with this domain

545
00:18:36,000 --> 00:18:38,400
where is this right um maybe well

546
00:18:38,400 --> 00:18:39,760
hopefully it's not a ping right

547
00:18:39,760 --> 00:18:40,880
hopefully you're not just pinging the

548
00:18:40,880 --> 00:18:43,440
host to see well are they up because

549
00:18:43,440 --> 00:18:44,559
we're not it's not our job to

550
00:18:44,559 --> 00:18:46,400
troubleshoot their network right but but

551
00:18:46,400 --> 00:18:48,480
maybe you might look and see well where

552
00:18:48,480 --> 00:18:50,799
is this domain from um

553
00:18:50,799 --> 00:18:52,880
is what's my route to them maybe a trace

554
00:18:52,880 --> 00:18:54,320
route information

555
00:18:54,320 --> 00:18:56,480
or look up the registration date of it

556
00:18:56,480 --> 00:18:58,080
things like that that we wouldn't do

557
00:18:58,080 --> 00:19:01,200
with domain so what api ifi is is well

558
00:19:01,200 --> 00:19:03,840
it's just a web server that you can

559
00:19:03,840 --> 00:19:05,760
configure to run any one command for a

560
00:19:05,760 --> 00:19:06,880
domain

561
00:19:06,880 --> 00:19:08,320
that you give it or an ip address that

562
00:19:08,320 --> 00:19:09,679
you give it it'll run that command and

563
00:19:09,679 --> 00:19:11,360
then give you a json response so that

564
00:19:11,360 --> 00:19:13,840
you can incorporate that into your seam

565
00:19:13,840 --> 00:19:15,520
so it looks kind of like this it's got

566
00:19:15,520 --> 00:19:17,360
an a configuration file where you give

567
00:19:17,360 --> 00:19:19,280
it the command you want to run

568
00:19:19,280 --> 00:19:20,160
and then

569
00:19:20,160 --> 00:19:22,320
web info this asterisk web info is going

570
00:19:22,320 --> 00:19:24,400
to be replaced by whatever it is that

571
00:19:24,400 --> 00:19:26,720
you put on the url

572
00:19:26,720 --> 00:19:28,880
who's thinking command injection attacks

573
00:19:28,880 --> 00:19:30,320
all right all right so whatever you put

574
00:19:30,320 --> 00:19:32,960
in the url here right is going to be

575
00:19:32,960 --> 00:19:35,440
replaced with who is and then that

576
00:19:35,440 --> 00:19:37,440
command it'll take the results you can

577
00:19:37,440 --> 00:19:39,600
have it capture the information

578
00:19:39,600 --> 00:19:41,440
and run it through a regular expression

579
00:19:41,440 --> 00:19:43,200
so it'll give you back just pieces of

580
00:19:43,200 --> 00:19:44,720
that information so here you can see the

581
00:19:44,720 --> 00:19:46,720
kind of json response

582
00:19:46,720 --> 00:19:48,720
i'm using to get back just the creation

583
00:19:48,720 --> 00:19:49,919
date

584
00:19:49,919 --> 00:19:51,600
on this so this is doing something very

585
00:19:51,600 --> 00:19:53,360
similar to what domain stats is doing

586
00:19:53,360 --> 00:19:56,320
for looking up that domain

587
00:19:56,320 --> 00:19:57,840
and actually

588
00:19:57,840 --> 00:19:59,600
there is a version of this so you can

589
00:19:59,600 --> 00:20:01,919
either enable or disable command

590
00:20:01,919 --> 00:20:03,120
injection attacks so if you were

591
00:20:03,120 --> 00:20:05,440
actually looking for a little

592
00:20:05,440 --> 00:20:07,840
website that was very hackable right

593
00:20:07,840 --> 00:20:09,679
where you could inject commands so in

594
00:20:09,679 --> 00:20:10,559
here

595
00:20:10,559 --> 00:20:12,080
instead of typing in a domain you type

596
00:20:12,080 --> 00:20:13,919
in a command and then it'll run it on

597
00:20:13,919 --> 00:20:14,720
your

598
00:20:14,720 --> 00:20:16,400
instead of the command it's doing you

599
00:20:16,400 --> 00:20:17,919
can enable or disable that in the

600
00:20:17,919 --> 00:20:19,760
configuration files

601
00:20:19,760 --> 00:20:22,400
i have written it so that it um it is it

602
00:20:22,400 --> 00:20:24,960
should not be command injectable and i

603
00:20:24,960 --> 00:20:26,720
won't say it's not because

604
00:20:26,720 --> 00:20:27,679
right

605
00:20:27,679 --> 00:20:29,919
but if the libraries that are supposed

606
00:20:29,919 --> 00:20:31,280
intended to protect against command

607
00:20:31,280 --> 00:20:33,120
injection actually work then it would

608
00:20:33,120 --> 00:20:35,440
not be command injectable okay

609
00:20:35,440 --> 00:20:36,400
it comes with several different

610
00:20:36,400 --> 00:20:38,400
configurations but one of them that i

611
00:20:38,400 --> 00:20:41,120
found to be fun at least on uh the

612
00:20:41,120 --> 00:20:43,919
networks i was monitoring with this was

613
00:20:43,919 --> 00:20:46,400
monitoring tracebacks right so let's

614
00:20:46,400 --> 00:20:48,400
let's say that i see a an attacker come

615
00:20:48,400 --> 00:20:49,919
into my network i got an ip address from

616
00:20:49,919 --> 00:20:52,480
an attacker um i want to know what is

617
00:20:52,480 --> 00:20:54,960
the infrastructure between me

618
00:20:54,960 --> 00:20:57,679
and the attacker and then figure out

619
00:20:57,679 --> 00:21:00,480
which other ip addresses on my network

620
00:21:00,480 --> 00:21:02,400
share that same infrastructure where

621
00:21:02,400 --> 00:21:04,559
what other ip addresses are also

622
00:21:04,559 --> 00:21:07,600
associated with the attacker right so it

623
00:21:07,600 --> 00:21:09,679
might be that you know an attacker comes

624
00:21:09,679 --> 00:21:11,919
in they could go through one path and

625
00:21:11,919 --> 00:21:14,159
another hacker and if they go through

626
00:21:14,159 --> 00:21:15,840
everything is the exact same path except

627
00:21:15,840 --> 00:21:17,520
for that last hop right the only thing

628
00:21:17,520 --> 00:21:19,120
that changes between them is that last

629
00:21:19,120 --> 00:21:19,919
hop

630
00:21:19,919 --> 00:21:20,960
well then

631
00:21:20,960 --> 00:21:22,720
they have all of the same infrastructure

632
00:21:22,720 --> 00:21:24,640
it's it's very likely that those

633
00:21:24,640 --> 00:21:28,240
attackers are um on the same network or

634
00:21:28,240 --> 00:21:30,559
at least in the same area they're

635
00:21:30,559 --> 00:21:32,799
sharing a lot of internet infrastructure

636
00:21:32,799 --> 00:21:35,280
so uh what if i just do a trace route

637
00:21:35,280 --> 00:21:37,200
for every ip address that i see on my

638
00:21:37,200 --> 00:21:39,520
network or every hostnet well

639
00:21:39,520 --> 00:21:41,679
the problem with that is if we look and

640
00:21:41,679 --> 00:21:43,679
see how long does it take to run a trace

641
00:21:43,679 --> 00:21:45,919
route to a network like let's let's just

642
00:21:45,919 --> 00:21:47,679
do a trace route and see show me all the

643
00:21:47,679 --> 00:21:50,000
connections that between me and google

644
00:21:50,000 --> 00:21:51,760
here if i run that once it takes a

645
00:21:51,760 --> 00:21:53,919
minute and six seconds

646
00:21:53,919 --> 00:21:56,159
to do that for google and so i want to

647
00:21:56,159 --> 00:21:58,080
do that for every ip address i see on my

648
00:21:58,080 --> 00:22:00,240
network as i see them that sounds like

649
00:22:00,240 --> 00:22:02,640
that's a losing proposition proposition

650
00:22:02,640 --> 00:22:04,720
well can i make it faster well there are

651
00:22:04,720 --> 00:22:06,320
some options you can pass to traceroute

652
00:22:06,320 --> 00:22:07,200
so

653
00:22:07,200 --> 00:22:10,720
dash n says don't do dns lookups of host

654
00:22:10,720 --> 00:22:13,280
names just look up the ip address

655
00:22:13,280 --> 00:22:14,880
you can use a dash f to say you know

656
00:22:14,880 --> 00:22:18,159
what skip the first x number of hops

657
00:22:18,159 --> 00:22:20,159
i know what my infrastructure looks like

658
00:22:20,159 --> 00:22:22,159
so i don't need to trace route my

659
00:22:22,159 --> 00:22:24,240
internal router and then my internet

660
00:22:24,240 --> 00:22:25,919
service providers router i just i'm

661
00:22:25,919 --> 00:22:27,679
going to skip the first five hops right

662
00:22:27,679 --> 00:22:29,679
and then just start tracing from there

663
00:22:29,679 --> 00:22:30,880
to see what the network is the other

664
00:22:30,880 --> 00:22:33,919
thing i can do is by default traceroute

665
00:22:33,919 --> 00:22:36,400
will map that same network three times

666
00:22:36,400 --> 00:22:38,240
it'll send three packets out to try and

667
00:22:38,240 --> 00:22:39,679
discover the network so i'm going to

668
00:22:39,679 --> 00:22:41,200
reduce that to just

669
00:22:41,200 --> 00:22:42,880
one packet right now i'm only going to

670
00:22:42,880 --> 00:22:45,120
do it once and so if i do that same

671
00:22:45,120 --> 00:22:47,120
thing right with google and i'm also

672
00:22:47,120 --> 00:22:49,520
going to do tcp port 80

673
00:22:49,520 --> 00:22:51,919
as i do this all right now i've now i'm

674
00:22:51,919 --> 00:22:54,640
down to well less than a second here in

675
00:22:54,640 --> 00:22:56,640
order to do that same trace route

676
00:22:56,640 --> 00:23:00,640
so maybe that's a little more doable

677
00:23:00,640 --> 00:23:01,600
um

678
00:23:01,600 --> 00:23:02,960
there's all kinds of configuration

679
00:23:02,960 --> 00:23:04,559
changes that you've got inside of api

680
00:23:04,559 --> 00:23:07,120
ifi and oh did i drop the slide oh so

681
00:23:07,120 --> 00:23:08,720
how effective um is it so this is what

682
00:23:08,720 --> 00:23:10,559
that the api configuration looks like

683
00:23:10,559 --> 00:23:12,400
i'm gonna put in there traceroute dash t

684
00:23:12,400 --> 00:23:15,440
80 and then plug web info in there i've

685
00:23:15,440 --> 00:23:17,440
got some regular expression options so i

686
00:23:17,440 --> 00:23:20,799
can parse out um just the ip addresses

687
00:23:20,799 --> 00:23:23,360
of the infrastructure and then when i um

688
00:23:23,360 --> 00:23:25,919
use this api if i configure and then i

689
00:23:25,919 --> 00:23:28,000
ask for sans.org i can just see all

690
00:23:28,000 --> 00:23:30,480
right hop 3 is this ip address hop 4 is

691
00:23:30,480 --> 00:23:32,480
this ip address hop 5 is this ip address

692
00:23:32,480 --> 00:23:34,080
i get back a json response that i can

693
00:23:34,080 --> 00:23:35,440
incorporate in there

694
00:23:35,440 --> 00:23:37,039
all right so

695
00:23:37,039 --> 00:23:38,159
how

696
00:23:38,159 --> 00:23:40,400
effective could this be at looking at

697
00:23:40,400 --> 00:23:42,640
your network all right so i just took

698
00:23:42,640 --> 00:23:44,720
some ip addresses off of a list of known

699
00:23:44,720 --> 00:23:46,320
bad actors and if you just looked at

700
00:23:46,320 --> 00:23:47,840
these ip addresses

701
00:23:47,840 --> 00:23:55,520
93 174 93 0 80 82 70 89 247 174 0. would

702
00:23:55,520 --> 00:23:56,880
you would you say those are on the same

703
00:23:56,880 --> 00:23:58,799
network right would you immediately say

704
00:23:58,799 --> 00:24:00,080
oh those

705
00:24:00,080 --> 00:24:02,000
those are the same attacker i should

706
00:24:02,000 --> 00:24:03,360
worry about those

707
00:24:03,360 --> 00:24:04,640
i don't think that just by looking at

708
00:24:04,640 --> 00:24:06,880
those ip addresses you would think that

709
00:24:06,880 --> 00:24:08,640
they were coming from the same location

710
00:24:08,640 --> 00:24:09,600
but here

711
00:24:09,600 --> 00:24:11,840
i ran those through this let it do its

712
00:24:11,840 --> 00:24:14,000
trace routes and then um here i'm

713
00:24:14,000 --> 00:24:16,159
actually dumping i'm using a tool called

714
00:24:16,159 --> 00:24:18,720
dump cache that comes with apify just to

715
00:24:18,720 --> 00:24:21,360
say dump dump what's in your database

716
00:24:21,360 --> 00:24:23,120
i'm asking it to

717
00:24:23,120 --> 00:24:26,559
dump the the json responses here and

718
00:24:26,559 --> 00:24:28,240
look for this one ip address that's in

719
00:24:28,240 --> 00:24:29,679
the list and then

720
00:24:29,679 --> 00:24:32,559
show me dash c1 says show me context

721
00:24:32,559 --> 00:24:34,799
show me the line before it and the line

722
00:24:34,799 --> 00:24:37,200
after it and so here you can see it's

723
00:24:37,200 --> 00:24:38,480
giving me the results for that ip

724
00:24:38,480 --> 00:24:40,480
address the line before it align after

725
00:24:40,480 --> 00:24:42,880
it and you can see that these

726
00:24:42,880 --> 00:24:45,120
have the exact same hops the exact same

727
00:24:45,120 --> 00:24:48,240
infrastructure um is shared there now it

728
00:24:48,240 --> 00:24:49,279
could be

729
00:24:49,279 --> 00:24:52,080
at least they look like they do at this

730
00:24:52,080 --> 00:24:54,080
point it could be that they have

731
00:24:54,080 --> 00:24:57,200
20 hops on both of these um both of

732
00:24:57,200 --> 00:24:58,559
these networks

733
00:24:58,559 --> 00:25:01,039
and that beyond 10 none of the routers

734
00:25:01,039 --> 00:25:03,360
are responding um to it so that's that's

735
00:25:03,360 --> 00:25:05,600
a possibility um but

736
00:25:05,600 --> 00:25:07,120
and the fact that they have they

737
00:25:07,120 --> 00:25:09,440
probably don't have 20 hops right um and

738
00:25:09,440 --> 00:25:11,360
the fact that they share 10 is some

739
00:25:11,360 --> 00:25:13,600
strong indicator that they're they're uh

740
00:25:13,600 --> 00:25:16,320
likely at least perhaps related maybe i

741
00:25:16,320 --> 00:25:17,360
should

742
00:25:17,360 --> 00:25:19,480
pivot my investigation if

743
00:25:19,480 --> 00:25:22,400
80.82 is attacking me maybe i should

744
00:25:22,400 --> 00:25:24,159
pivot my investigation and then go look

745
00:25:24,159 --> 00:25:26,880
at this other ip address as well okay

746
00:25:26,880 --> 00:25:30,000
um so that's apify so ap ifi comes with

747
00:25:30,000 --> 00:25:31,919
uh several pre-configured config or

748
00:25:31,919 --> 00:25:33,279
commands that you can run in the

749
00:25:33,279 --> 00:25:34,799
configuration tool

750
00:25:34,799 --> 00:25:36,640
it can look up whois records it can do

751
00:25:36,640 --> 00:25:38,080
the trace routes

752
00:25:38,080 --> 00:25:39,600
it can do a full trace route it can do a

753
00:25:39,600 --> 00:25:42,959
geoip lookup so if

754
00:25:55,039 --> 00:25:56,720
it's a json response

755
00:25:56,720 --> 00:25:58,000
so you can incorporate that into your

756
00:25:58,000 --> 00:26:00,320
sim platforms okay

757
00:26:00,320 --> 00:26:02,480
um the other two tools another two tools

758
00:26:02,480 --> 00:26:04,640
i want to tell you about is srumdum and

759
00:26:04,640 --> 00:26:06,480
ese to csv

760
00:26:06,480 --> 00:26:08,480
so what these tools are really focused

761
00:26:08,480 --> 00:26:10,480
on i can't remember if i put a slide in

762
00:26:10,480 --> 00:26:12,480
yeah so this slide here you've gone to

763
00:26:12,480 --> 00:26:14,400
your task manager on your windows

764
00:26:14,400 --> 00:26:16,320
systems before and if on your task

765
00:26:16,320 --> 00:26:18,159
manager you've got this app history

766
00:26:18,159 --> 00:26:19,679
right um the app history tab have you

767
00:26:19,679 --> 00:26:21,039
ever looked at that

768
00:26:21,039 --> 00:26:23,360
app history tab it's usually a bunch of

769
00:26:23,360 --> 00:26:25,679
useless information right it shows you

770
00:26:25,679 --> 00:26:27,840
over here the metro application all

771
00:26:27,840 --> 00:26:30,000
these applications that we don't use

772
00:26:30,000 --> 00:26:31,440
on our operating system are over here on

773
00:26:31,440 --> 00:26:33,279
the left and then the statistics are all

774
00:26:33,279 --> 00:26:34,880
zero because nobody uses those

775
00:26:34,880 --> 00:26:36,799
applications right

776
00:26:36,799 --> 00:26:38,400
so it doesn't seem like there's much

777
00:26:38,400 --> 00:26:40,559
useful data there but actually

778
00:26:40,559 --> 00:26:42,640
um this app history doesn't just record

779
00:26:42,640 --> 00:26:44,640
the app history for these applications

780
00:26:44,640 --> 00:26:47,360
it records the app history for every

781
00:26:47,360 --> 00:26:50,320
process that is running on your computer

782
00:26:50,320 --> 00:26:52,240
for whatever this date here at the top

783
00:26:52,240 --> 00:26:54,960
here it says uh resource usage from 10

784
00:26:54,960 --> 00:26:56,960
10 2009 so when i made this print screen

785
00:26:56,960 --> 00:26:58,880
that was 30 days

786
00:26:58,880 --> 00:27:01,600
of information right um so this was done

787
00:27:01,600 --> 00:27:04,080
on november 9th so 30 days worth of

788
00:27:04,080 --> 00:27:05,440
information it's keeping in that

789
00:27:05,440 --> 00:27:06,720
database

790
00:27:06,720 --> 00:27:08,240
and it's not just those applications

791
00:27:08,240 --> 00:27:10,720
this is every process that's on on your

792
00:27:10,720 --> 00:27:13,279
system so how do i get the information

793
00:27:13,279 --> 00:27:14,880
of every process that's run on my

794
00:27:14,880 --> 00:27:16,880
computer for the last 30 days out of the

795
00:27:16,880 --> 00:27:18,480
serum database so i wrote these two

796
00:27:18,480 --> 00:27:22,799
tools called srumdump and esc to csv

797
00:27:22,799 --> 00:27:25,520
srumdump was actually

798
00:27:25,520 --> 00:27:27,120
written with

799
00:27:27,120 --> 00:27:28,240
with

800
00:27:28,240 --> 00:27:30,000
law enforcement in mind

801
00:27:30,000 --> 00:27:32,320
the idea is i wanted to present you with

802
00:27:32,320 --> 00:27:34,720
a graphic user interface that is very

803
00:27:34,720 --> 00:27:36,799
simple to use right you just point click

804
00:27:36,799 --> 00:27:38,480
and have it export everything to an

805
00:27:38,480 --> 00:27:40,399
excel spreadsheet and then you can do

806
00:27:40,399 --> 00:27:42,799
all of the additional analysis in

807
00:27:42,799 --> 00:27:44,880
in an excel spreadsheet

808
00:27:44,880 --> 00:27:47,279
so it's really focused on ease of use

809
00:27:47,279 --> 00:27:50,159
esc to csv is for the uh for the network

810
00:27:50,159 --> 00:27:52,880
admin who um

811
00:27:52,880 --> 00:27:54,480
needs to pull the logs from everything i

812
00:27:54,480 --> 00:27:55,440
don't know about you but i've done some

813
00:27:55,440 --> 00:27:57,600
incident response work even in the last

814
00:27:57,600 --> 00:27:59,440
three months right where i show up at

815
00:27:59,440 --> 00:28:00,960
the customer site and they've been

816
00:28:00,960 --> 00:28:02,399
compromised and i'd say hey all right

817
00:28:02,399 --> 00:28:04,720
let's start looking at some logs

818
00:28:04,720 --> 00:28:06,720
and they looked you like

819
00:28:06,720 --> 00:28:08,559
logs what are

820
00:28:08,559 --> 00:28:10,559
what what are these logs you speak of

821
00:28:10,559 --> 00:28:12,480
where where would i find such logs i'm

822
00:28:12,480 --> 00:28:14,720
like hopefully you've turned on logging

823
00:28:14,720 --> 00:28:16,399
of some sorts right so

824
00:28:16,399 --> 00:28:19,279
still in many organizations there's just

825
00:28:19,279 --> 00:28:20,720
an in effect

826
00:28:20,720 --> 00:28:22,480
they're not capturing all the data they

827
00:28:22,480 --> 00:28:24,159
could and even in

828
00:28:24,159 --> 00:28:26,720
organizations that do have logging

829
00:28:26,720 --> 00:28:29,520
process level logging on every point in

830
00:28:29,520 --> 00:28:32,080
the host right the unless you've got a

831
00:28:32,080 --> 00:28:35,200
good um a good edr that's really

832
00:28:35,200 --> 00:28:37,760
monitoring every single process it's

833
00:28:37,760 --> 00:28:40,399
it's not common to find every process on

834
00:28:40,399 --> 00:28:43,600
every host logged so esc to csv i can

835
00:28:43,600 --> 00:28:45,919
use something like ps exec or

836
00:28:45,919 --> 00:28:48,640
cape would be a better option to reach

837
00:28:48,640 --> 00:28:51,120
out to every host on the network and say

838
00:28:51,120 --> 00:28:53,919
hey give me a list of every process

839
00:28:53,919 --> 00:28:56,080
that's run on every host

840
00:28:56,080 --> 00:28:58,240
in the last 30 days and write all these

841
00:28:58,240 --> 00:29:00,640
things to a centralized share and then i

842
00:29:00,640 --> 00:29:02,799
can take that centralized share and

843
00:29:02,799 --> 00:29:04,559
analyze every process for the last 30

844
00:29:04,559 --> 00:29:06,399
days so it's it's intended to be

845
00:29:06,399 --> 00:29:10,080
powerful so esc to csv has got a modular

846
00:29:10,080 --> 00:29:12,480
plug-in framework so it doesn't just

847
00:29:12,480 --> 00:29:14,640
dump this rum it can also dump like

848
00:29:14,640 --> 00:29:17,279
browser history um edge browser history

849
00:29:17,279 --> 00:29:20,240
or really anything that's in an ese

850
00:29:20,240 --> 00:29:22,799
formatted database is uh is what it's

851
00:29:22,799 --> 00:29:25,679
intended to be able to dump okay um so

852
00:29:25,679 --> 00:29:27,360
here's a look at the strum interface you

853
00:29:27,360 --> 00:29:28,640
run it it's got a nice graphical user

854
00:29:28,640 --> 00:29:31,480
interface you have to reach out to the

855
00:29:31,480 --> 00:29:33,600
srudb.dat file which is in your windows

856
00:29:33,600 --> 00:29:35,520
system32

857
00:29:35,520 --> 00:29:37,440
and then it also wants to know like

858
00:29:37,440 --> 00:29:40,080
where do you want to put the spreadsheet

859
00:29:40,080 --> 00:29:41,200
and

860
00:29:41,200 --> 00:29:43,120
the spreadsheet can have has a template

861
00:29:43,120 --> 00:29:45,039
that comes with it so if you only want

862
00:29:45,039 --> 00:29:46,799
to dump some information out of it you

863
00:29:46,799 --> 00:29:48,640
can modify the template and then also

864
00:29:48,640 --> 00:29:50,399
wants to know where your uh where your

865
00:29:50,399 --> 00:29:52,720
registry files are used because it does

866
00:29:52,720 --> 00:29:54,159
do things like look up the names of

867
00:29:54,159 --> 00:29:57,279
wireless networks and look up the name

868
00:29:57,279 --> 00:29:59,039
look at the names of of users and things

869
00:29:59,039 --> 00:30:00,159
like that

870
00:30:00,159 --> 00:30:02,240
on on the internet

871
00:30:02,240 --> 00:30:02,960
so

872
00:30:02,960 --> 00:30:04,399
it'll ask for that information as well

873
00:30:04,399 --> 00:30:05,760
if you don't know that information if

874
00:30:05,760 --> 00:30:09,120
you run strum dump as an administrator

875
00:30:09,120 --> 00:30:10,480
then

876
00:30:10,480 --> 00:30:12,960
when you try and access the srudb.dat it

877
00:30:12,960 --> 00:30:14,000
says hey

878
00:30:14,000 --> 00:30:15,360
you're trying to access this and it's

879
00:30:15,360 --> 00:30:17,120
locked by the operating system so that

880
00:30:17,120 --> 00:30:19,200
this is that file along with the

881
00:30:19,200 --> 00:30:20,880
registry file you can't just browse out

882
00:30:20,880 --> 00:30:22,799
and select those actually you can

883
00:30:22,799 --> 00:30:25,919
and if you try and access those files

884
00:30:25,919 --> 00:30:27,360
the operating system lets you copy them

885
00:30:27,360 --> 00:30:29,360
but they actually are corrupt copies

886
00:30:29,360 --> 00:30:31,600
right you don't get complete access so

887
00:30:31,600 --> 00:30:33,200
you do need to

888
00:30:33,200 --> 00:30:35,600
make a backup copy of those files first

889
00:30:35,600 --> 00:30:37,200
if you run it as an administrator it

890
00:30:37,200 --> 00:30:38,880
will um you can click this auto extract

891
00:30:38,880 --> 00:30:40,799
button and it will

892
00:30:40,799 --> 00:30:42,399
use um

893
00:30:42,399 --> 00:30:45,120
it it'll it'll use the shadow copies uh

894
00:30:45,120 --> 00:30:46,399
on that you have on your system to make

895
00:30:46,399 --> 00:30:48,159
a backup copy of these locked files so

896
00:30:48,159 --> 00:30:49,679
that uh that so it's got that and then

897
00:30:49,679 --> 00:30:51,440
it'll extract all the information builds

898
00:30:51,440 --> 00:30:52,880
a nice spreadsheet this is the kind of

899
00:30:52,880 --> 00:30:54,640
information you can get at some you can

900
00:30:54,640 --> 00:30:56,399
see that there's multiple tabs here so

901
00:30:56,399 --> 00:30:58,240
i've got a network usage tab an

902
00:30:58,240 --> 00:31:00,159
application resource usage tab network

903
00:31:00,159 --> 00:31:02,000
connections network

904
00:31:02,000 --> 00:31:04,000
push notification data and the kind of

905
00:31:04,000 --> 00:31:06,159
information i get is well i ran this

906
00:31:06,159 --> 00:31:09,120
process so at some point i had netcat

907
00:31:09,120 --> 00:31:10,960
running on of course i'm a sans

908
00:31:10,960 --> 00:31:12,240
instructor we had to mention netcat

909
00:31:12,240 --> 00:31:14,240
right so we got netcat

910
00:31:14,240 --> 00:31:16,960
running on this process i can get the

911
00:31:16,960 --> 00:31:18,960
security identifier of this and if you

912
00:31:18,960 --> 00:31:20,399
provided it with the registry file it

913
00:31:20,399 --> 00:31:21,840
looks up and it'll tell you this is the

914
00:31:21,840 --> 00:31:23,840
user that's associated with that so

915
00:31:23,840 --> 00:31:25,279
it'll give you the names of the sid

916
00:31:25,279 --> 00:31:27,840
it'll tell you that netcat

917
00:31:27,840 --> 00:31:30,799
used the open wi-fi connection so you

918
00:31:30,799 --> 00:31:32,960
have a wireless network named open wi-fi

919
00:31:32,960 --> 00:31:36,159
it used that in um when it was running

920
00:31:36,159 --> 00:31:39,279
and uh it transmitted this much data

921
00:31:39,279 --> 00:31:42,000
across the network right so that is

922
00:31:42,000 --> 00:31:44,000
that's a lot of detail that you have in

923
00:31:44,000 --> 00:31:45,519
task manager

924
00:31:45,519 --> 00:31:46,480
that

925
00:31:46,480 --> 00:31:48,640
looks like a table that's full of zeros

926
00:31:48,640 --> 00:31:50,880
right so strum has a lot of great

927
00:31:50,880 --> 00:31:52,399
information and that's just the network

928
00:31:52,399 --> 00:31:53,679
usage tab

929
00:31:53,679 --> 00:31:56,480
you can go to other tabs and see

930
00:31:56,480 --> 00:31:59,120
what the percentage of the battery was

931
00:31:59,120 --> 00:32:00,399
that was on the system right so the

932
00:32:00,399 --> 00:32:02,640
battery's fully charged and i've talked

933
00:32:02,640 --> 00:32:04,399
to law enforcement that's used that when

934
00:32:04,399 --> 00:32:07,600
um in places where um the

935
00:32:07,600 --> 00:32:09,200
person has said that

936
00:32:09,200 --> 00:32:11,679
their laptop was there at their house in

937
00:32:11,679 --> 00:32:14,080
the docking station the entire time

938
00:32:14,080 --> 00:32:16,480
right and that their laptop was never

939
00:32:16,480 --> 00:32:18,240
taken somewhere else where crime was

940
00:32:18,240 --> 00:32:20,480
committed but then they can look at the

941
00:32:20,480 --> 00:32:22,480
battery usage as they say yeah

942
00:32:22,480 --> 00:32:24,640
apparently that's not the case because

943
00:32:24,640 --> 00:32:27,279
your battery ran down to 10 and then it

944
00:32:27,279 --> 00:32:29,360
came back up to um so there's all kinds

945
00:32:29,360 --> 00:32:31,600
of useful data that's in there again esc

946
00:32:31,600 --> 00:32:33,440
to csv is the command line version of

947
00:32:33,440 --> 00:32:35,840
this um it also has the ability to

948
00:32:35,840 --> 00:32:38,960
acquire locked files using uh the volume

949
00:32:38,960 --> 00:32:41,200
shadow copies so if you are an

950
00:32:41,200 --> 00:32:42,799
administrator you can use that dash a

951
00:32:42,799 --> 00:32:43,760
option

952
00:32:43,760 --> 00:32:45,279
you can list all of the tables that are

953
00:32:45,279 --> 00:32:47,600
in an ase database you can dump all the

954
00:32:47,600 --> 00:32:50,080
tables or you can dump um specific

955
00:32:50,080 --> 00:32:51,200
tables so you don't have to dump

956
00:32:51,200 --> 00:32:52,159
everything

957
00:32:52,159 --> 00:32:56,559
um and it it does have plugins right um

958
00:32:56,559 --> 00:32:58,559
when when i published this i had i had

959
00:32:58,559 --> 00:33:00,399
visions of the entire internet community

960
00:33:00,399 --> 00:33:02,960
then sending me new plugins to plug in

961
00:33:02,960 --> 00:33:04,320
of course it only has the two plugins

962
00:33:04,320 --> 00:33:06,720
that i've written um at this point uh

963
00:33:06,720 --> 00:33:09,039
which is it will dump this rum and it

964
00:33:09,039 --> 00:33:11,840
can drop your uh your your edge browser

965
00:33:11,840 --> 00:33:13,840
history which is the spartan database

966
00:33:13,840 --> 00:33:14,720
okay

967
00:33:14,720 --> 00:33:16,640
um so you can combine this with ese to

968
00:33:16,640 --> 00:33:20,640
csv and ps exec or s or or cape

969
00:33:20,640 --> 00:33:23,039
and then run this on every process in

970
00:33:23,039 --> 00:33:24,799
your system collect up all this process

971
00:33:24,799 --> 00:33:26,399
essentially the way you do that is

972
00:33:26,399 --> 00:33:28,159
you're going to stand up a share right

973
00:33:28,159 --> 00:33:29,200
and then you're going to specify that

974
00:33:29,200 --> 00:33:31,519
the output of esc to csv is going to be

975
00:33:31,519 --> 00:33:33,039
some centralized share and it'll be

976
00:33:33,039 --> 00:33:35,840
written to that spot

977
00:33:35,840 --> 00:33:37,279
the seven tool i want to mention i think

978
00:33:37,279 --> 00:33:39,679
this is my last tool is where'd you go

979
00:33:39,679 --> 00:33:42,159
okay where'd you go is a laptop um

980
00:33:42,159 --> 00:33:44,799
historical location tracker this is

981
00:33:44,799 --> 00:33:46,240
actually

982
00:33:46,240 --> 00:33:48,960
a tool that we develop in the class that

983
00:33:48,960 --> 00:33:51,440
i've written in the sans sec 573 right

984
00:33:51,440 --> 00:33:53,440
we talk about how to um to write code in

985
00:33:53,440 --> 00:33:55,200
python and some of the things that we

986
00:33:55,200 --> 00:33:56,480
talk about in that class is how to

987
00:33:56,480 --> 00:33:58,559
access the windows registry

988
00:33:58,559 --> 00:34:01,840
and how to talk to online websites and

989
00:34:01,840 --> 00:34:03,519
submit things to apis to be able to get

990
00:34:03,519 --> 00:34:06,320
responses back and so we combine those

991
00:34:06,320 --> 00:34:08,320
tools into this is one of the tools that

992
00:34:08,320 --> 00:34:10,719
uh we write a large portion of in in the

993
00:34:10,719 --> 00:34:11,679
course

994
00:34:11,679 --> 00:34:14,719
um so what esc to csv does is it will

995
00:34:14,719 --> 00:34:17,280
pull your wireless history from various

996
00:34:17,280 --> 00:34:18,800
locations on your system it'll pull it

997
00:34:18,800 --> 00:34:21,520
from your registry right so

998
00:34:21,520 --> 00:34:23,359
we've all seen on our phones that or our

999
00:34:23,359 --> 00:34:25,839
laptops it recognizes when we're around

1000
00:34:25,839 --> 00:34:27,599
a wireless network that we've been on

1001
00:34:27,599 --> 00:34:28,960
before

1002
00:34:28,960 --> 00:34:30,639
that preferred network list of wireless

1003
00:34:30,639 --> 00:34:32,800
networks is stored in your registry on a

1004
00:34:32,800 --> 00:34:35,280
windows system so it will just go

1005
00:34:35,280 --> 00:34:37,839
through all of those wireless networks

1006
00:34:37,839 --> 00:34:39,760
it will get the

1007
00:34:39,760 --> 00:34:41,839
bss id which you can think of as a mac

1008
00:34:41,839 --> 00:34:43,679
address right which is a unique

1009
00:34:43,679 --> 00:34:46,159
identifier for the wireless access point

1010
00:34:46,159 --> 00:34:47,679
and it will submit that to online

1011
00:34:47,679 --> 00:34:49,520
websites i can do it through google and

1012
00:34:49,520 --> 00:34:52,159
i can do it through um through wiggle

1013
00:34:52,159 --> 00:34:53,918
and it can look up what the physical

1014
00:34:53,918 --> 00:34:56,480
location of those wireless networks are

1015
00:34:56,480 --> 00:34:57,920
the other thing that i kept in the

1016
00:34:57,920 --> 00:35:00,560
registry is the very first time that you

1017
00:35:00,560 --> 00:35:02,240
connected to that because when it when

1018
00:35:02,240 --> 00:35:03,200
you connect to it the first time it

1019
00:35:03,200 --> 00:35:05,040
creates a profile a network profile so i

1020
00:35:05,040 --> 00:35:06,800
can get the data that network profile

1021
00:35:06,800 --> 00:35:08,560
and then the last time you've connected

1022
00:35:08,560 --> 00:35:10,640
which is also there so let's say you go

1023
00:35:10,640 --> 00:35:12,079
on a business trip and you're in a

1024
00:35:12,079 --> 00:35:14,160
location for a week you arrive you

1025
00:35:14,160 --> 00:35:15,440
connect to the wireless network on the

1026
00:35:15,440 --> 00:35:18,400
hotel you leave i get the first i i can

1027
00:35:18,400 --> 00:35:19,760
place you at that

1028
00:35:19,760 --> 00:35:21,599
period of time or at that location for

1029
00:35:21,599 --> 00:35:23,520
that period of time so

1030
00:35:23,520 --> 00:35:25,359
where'd you go pulls information from

1031
00:35:25,359 --> 00:35:28,000
the registry it also looks for wlan auto

1032
00:35:28,000 --> 00:35:30,720
config logs and your network diagnostics

1033
00:35:30,720 --> 00:35:32,800
this is this is pretty cool if um on a

1034
00:35:32,800 --> 00:35:34,079
windows system

1035
00:35:34,079 --> 00:35:36,560
if you've ever had that uh uh

1036
00:35:36,560 --> 00:35:38,160
you're trying to connect somewhere and

1037
00:35:38,160 --> 00:35:39,119
you're not getting there and then it

1038
00:35:39,119 --> 00:35:41,119
says would you like to diagnose

1039
00:35:41,119 --> 00:35:42,880
your network connection and you click

1040
00:35:42,880 --> 00:35:44,720
the diagnose my network connection

1041
00:35:44,720 --> 00:35:45,680
button

1042
00:35:45,680 --> 00:35:47,040
one of the things it does during the

1043
00:35:47,040 --> 00:35:49,520
diagnosis process is it turns on your

1044
00:35:49,520 --> 00:35:51,119
wireless network

1045
00:35:51,119 --> 00:35:53,359
card and it records

1046
00:35:53,359 --> 00:35:55,040
all of the wireless networks that are

1047
00:35:55,040 --> 00:35:56,880
within range

1048
00:35:56,880 --> 00:35:59,040
of you at that point in time along with

1049
00:35:59,040 --> 00:36:01,520
your the signal strength to those so i

1050
00:36:01,520 --> 00:36:03,440
can take that information i can submit

1051
00:36:03,440 --> 00:36:06,880
that to a google api and i can well you

1052
00:36:06,880 --> 00:36:08,560
were you were here when you clicked the

1053
00:36:08,560 --> 00:36:10,560
wireless diagnosis information and and

1054
00:36:10,560 --> 00:36:13,040
put you at that location also as you saw

1055
00:36:13,040 --> 00:36:14,320
in the srum

1056
00:36:14,320 --> 00:36:15,839
right it

1057
00:36:15,839 --> 00:36:18,480
you ran netcat at this date and time and

1058
00:36:18,480 --> 00:36:20,240
at that time you were running

1059
00:36:20,240 --> 00:36:22,320
over this wireless network so those

1060
00:36:22,320 --> 00:36:24,560
wireless networks are also recorded in

1061
00:36:24,560 --> 00:36:26,400
the strum we can place you at uh

1062
00:36:26,400 --> 00:36:28,960
locations at that point in time so it

1063
00:36:28,960 --> 00:36:30,320
pulls the information from all of these

1064
00:36:30,320 --> 00:36:31,839
different things and it builds a little

1065
00:36:31,839 --> 00:36:32,720
map

1066
00:36:32,720 --> 00:36:34,800
puts little pins on there it says his

1067
00:36:34,800 --> 00:36:37,200
laptop was here laptop was here laptop

1068
00:36:37,200 --> 00:36:39,359
was here again you can get this at my

1069
00:36:39,359 --> 00:36:41,520
github page where'd you go

1070
00:36:41,520 --> 00:36:43,680
and the last thing i'll mention is i i'm

1071
00:36:43,680 --> 00:36:46,079
happy to support these tools right um if

1072
00:36:46,079 --> 00:36:47,520
i didn't want people to use them then i

1073
00:36:47,520 --> 00:36:48,960
wouldn't have um

1074
00:36:48,960 --> 00:36:50,640
of tricked you into coming to this talk

1075
00:36:50,640 --> 00:36:52,960
and told you all about them right um so

1076
00:36:52,960 --> 00:36:56,000
i i hope that you'll

1077
00:37:07,040 --> 00:37:09,119
information security download python and

1078
00:37:09,119 --> 00:37:11,680
i'm happy to uh teach you to build your

1079
00:37:11,680 --> 00:37:13,040
own tools like this or modify these

1080
00:37:13,040 --> 00:37:14,640
tools that you're doing it okay that's

1081
00:37:14,640 --> 00:37:16,400
all i have

1082
00:37:16,400 --> 00:37:20,160
any questions any questions

1083
00:37:20,160 --> 00:37:23,160
yep

1084
00:37:34,160 --> 00:37:39,240
recently at work had um

1085
00:38:01,760 --> 00:38:03,520
yeah that's a great question so the

1086
00:38:03,520 --> 00:38:04,880
question if you if you couldn't hear it

1087
00:38:04,880 --> 00:38:05,680
was

1088
00:38:05,680 --> 00:38:09,200
uh how does um freak.py work for

1089
00:38:09,200 --> 00:38:12,000
non-english characters um or things that

1090
00:38:12,000 --> 00:38:13,200
um so

1091
00:38:13,200 --> 00:38:14,920
the table that comes with it

1092
00:38:14,920 --> 00:38:17,760
freaktable.um or freak2018.

1093
00:38:17,760 --> 00:38:20,560
i built that table by just feeding it

1094
00:38:20,560 --> 00:38:23,280
text from i i fed it uh the complete

1095
00:38:23,280 --> 00:38:25,520
works of charles dickens little women

1096
00:38:25,520 --> 00:38:26,720
war and peace

1097
00:38:26,720 --> 00:38:29,440
um uh hermann mel uh herman melville's

1098
00:38:29,440 --> 00:38:32,000
uh moby dick and several other which is

1099
00:38:32,000 --> 00:38:33,920
i also fed it um a bunch of technical

1100
00:38:33,920 --> 00:38:36,480
documents and uh

1101
00:38:36,480 --> 00:38:38,960
debates between al gore and george bush

1102
00:38:38,960 --> 00:38:40,400
and um

1103
00:38:40,400 --> 00:38:43,119
a bunch of just if i could find a big

1104
00:38:43,119 --> 00:38:44,240
bunch of

1105
00:38:44,240 --> 00:38:47,200
people with lots of words

1106
00:38:47,200 --> 00:38:48,880
fed it in there um and so at the

1107
00:38:48,880 --> 00:38:51,520
frequency table is based upon that but

1108
00:38:51,520 --> 00:38:53,440
the frequency tool the frequency table

1109
00:38:53,440 --> 00:38:56,079
also has the ability to create your own

1110
00:38:56,079 --> 00:38:57,440
so if you have

1111
00:38:57,440 --> 00:39:00,160
um if you have mandarin right and it's

1112
00:39:00,160 --> 00:39:02,640
just based upon this character follows

1113
00:39:02,640 --> 00:39:05,119
this character and so if you have a

1114
00:39:05,119 --> 00:39:07,119
mandarin a bunch of mandarin you feed it

1115
00:39:07,119 --> 00:39:09,040
mandarin it will learn that this

1116
00:39:09,040 --> 00:39:10,320
character follows the scare and it does

1117
00:39:10,320 --> 00:39:12,480
have unicode support so or utf-8

1118
00:39:12,480 --> 00:39:15,119
character support so you feed it these

1119
00:39:15,119 --> 00:39:17,280
things now the tables that that comes

1120
00:39:17,280 --> 00:39:19,359
with this tool is just english but you

1121
00:39:19,359 --> 00:39:20,880
can build any table that you want to and

1122
00:39:20,880 --> 00:39:22,960
doing it i have seen people

1123
00:39:22,960 --> 00:39:25,440
using freak tables for finding

1124
00:39:25,440 --> 00:39:27,280
other things so one of the things i

1125
00:39:27,280 --> 00:39:29,280
think was pretty cool is

1126
00:39:29,280 --> 00:39:31,359
you know like metasploit

1127
00:39:31,359 --> 00:39:32,160
um

1128
00:39:32,160 --> 00:39:33,920
generates random host names when when

1129
00:39:33,920 --> 00:39:35,599
the pale when you get popped by

1130
00:39:35,599 --> 00:39:37,359
metasploit or other

1131
00:39:37,359 --> 00:39:39,119
pieces of command and control backdoors

1132
00:39:39,119 --> 00:39:42,079
they generate executables random exe

1133
00:39:42,079 --> 00:39:44,880
names and then they run those processes

1134
00:39:44,880 --> 00:39:46,560
so i've seen people build frequency

1135
00:39:46,560 --> 00:39:49,119
tables that you take all of the names of

1136
00:39:49,119 --> 00:39:50,880
the standard executables that comes on

1137
00:39:50,880 --> 00:39:51,920
windows

1138
00:39:51,920 --> 00:39:53,200
and you build a frequency table for

1139
00:39:53,200 --> 00:39:55,280
those names and then you analyze

1140
00:39:55,280 --> 00:39:57,119
every executable in your network with

1141
00:39:57,119 --> 00:39:59,839
freak.py i've seen people build some

1142
00:39:59,839 --> 00:40:02,400
frequency tables for certificate names

1143
00:40:02,400 --> 00:40:03,680
and so that the kind of names that you

1144
00:40:03,680 --> 00:40:05,839
would see inside of ssl certs and things

1145
00:40:05,839 --> 00:40:07,520
like that and identify things that just

1146
00:40:07,520 --> 00:40:10,400
don't conform to

1147
00:40:10,400 --> 00:40:13,040
standard names that we have on there so

1148
00:40:13,040 --> 00:40:14,400
um you can build you can build any

1149
00:40:14,400 --> 00:40:16,240
tables that you want to with freak.py

1150
00:40:16,240 --> 00:40:18,319
and it will measure the probability of

1151
00:40:18,319 --> 00:40:19,760
character following character that's a

1152
00:40:19,760 --> 00:40:21,680
good question thanks

1153
00:40:21,680 --> 00:40:25,480
other questions yep

1154
00:40:35,280 --> 00:40:36,880
yeah so the question is how does domain

1155
00:40:36,880 --> 00:40:38,880
stats work against

1156
00:40:38,880 --> 00:40:41,200
shortened domains it depends upon where

1157
00:40:41,200 --> 00:40:43,839
you're feeding it from right so

1158
00:40:43,839 --> 00:40:44,880
um

1159
00:40:44,880 --> 00:40:46,560
ultimately you're going to have to have

1160
00:40:46,560 --> 00:40:48,079
something on your network like an event

1161
00:40:48,079 --> 00:40:50,880
management platform or or zeek or

1162
00:40:50,880 --> 00:40:53,280
something else that

1163
00:40:53,280 --> 00:40:56,400
takes a domain name and sends it off

1164
00:40:56,400 --> 00:40:57,920
to

1165
00:40:57,920 --> 00:41:00,480
domain stats now with domain name

1166
00:41:00,480 --> 00:41:02,240
shorteners right you're going to make a

1167
00:41:02,240 --> 00:41:04,800
request for the the domain name

1168
00:41:04,800 --> 00:41:07,280
and then you'll get back the actual host

1169
00:41:07,280 --> 00:41:09,680
name and then send a second request off

1170
00:41:09,680 --> 00:41:11,839
to that actual hostname where you get

1171
00:41:11,839 --> 00:41:13,599
redirected to it so that's going to have

1172
00:41:13,599 --> 00:41:15,760
both of those requests and

1173
00:41:15,760 --> 00:41:16,960
if you're

1174
00:41:16,960 --> 00:41:18,480
if you're just monitoring all dns

1175
00:41:18,480 --> 00:41:19,920
traffic you get both of those but i

1176
00:41:19,920 --> 00:41:21,280
would imagine that

1177
00:41:21,280 --> 00:41:23,280
there's maybe a way to just just get one

1178
00:41:23,280 --> 00:41:24,800
to the other i don't know how i'd do

1179
00:41:24,800 --> 00:41:27,119
that but

1180
00:41:30,560 --> 00:41:31,839
yeah yeah you could do some kind of

1181
00:41:31,839 --> 00:41:33,359
filtering where you look for a list of

1182
00:41:33,359 --> 00:41:35,440
known filters and ignore those but once

1183
00:41:35,440 --> 00:41:36,400
you see them

1184
00:41:36,400 --> 00:41:38,720
they're going anywhere okay

1185
00:41:38,720 --> 00:41:41,520
any other questions

1186
00:41:42,240 --> 00:41:44,160
all right well um i hope you find these

1187
00:41:44,160 --> 00:41:45,440
tools useful

1188
00:41:45,440 --> 00:41:47,280
if it is some additional feature or

1189
00:41:47,280 --> 00:41:49,520
something yeah i this would be useful to

1190
00:41:49,520 --> 00:41:50,240
me

1191
00:41:50,240 --> 00:41:52,640
if you just did this one other thing

1192
00:41:52,640 --> 00:41:53,440
then

1193
00:41:53,440 --> 00:41:55,599
just send me an email and i'll invite

1194
00:41:55,599 --> 00:41:56,640
you to come to my class and then i'll

1195
00:41:56,640 --> 00:41:58,560
teach you how to do that

1196
00:41:58,560 --> 00:42:00,319
no

1197
00:42:00,319 --> 00:42:03,839
no that's it all right thank you

