1
00:00:12,639 --> 00:00:14,160
thank you

2
00:00:14,160 --> 00:00:17,039
so much robert wilson i'm the uh

3
00:00:17,039 --> 00:00:19,039
director of security operations and

4
00:00:19,039 --> 00:00:21,680
incident response for what i now have to

5
00:00:21,680 --> 00:00:24,480
call u of sc we're not allowed to call

6
00:00:24,480 --> 00:00:27,920
ourselves usc anymore um so that's a

7
00:00:27,920 --> 00:00:29,439
whole big question that we can talk

8
00:00:29,439 --> 00:00:32,800
about afterwards um so right up the road

9
00:00:32,800 --> 00:00:35,120
up interstate 20.

10
00:00:35,120 --> 00:00:36,160
um

11
00:00:36,160 --> 00:00:39,360
so today i'm going to talk about

12
00:00:39,360 --> 00:00:42,719
lsas but first i wanted to tie this back

13
00:00:42,719 --> 00:00:45,360
to the miter attack framework

14
00:00:45,360 --> 00:00:46,800
just because

15
00:00:46,800 --> 00:00:48,879
anytime i give one of these talks i want

16
00:00:48,879 --> 00:00:50,160
to

17
00:00:50,160 --> 00:00:51,920
kind of see

18
00:00:51,920 --> 00:00:54,079
what people know and whether or not

19
00:00:54,079 --> 00:00:55,520
they've heard about the miter attack

20
00:00:55,520 --> 00:00:58,000
framework i think we're far enough along

21
00:00:58,000 --> 00:00:59,600
since it's been released where almost

22
00:00:59,600 --> 00:01:01,039
everyone does

23
00:01:01,039 --> 00:01:02,879
but if there's anyone that's a student

24
00:01:02,879 --> 00:01:04,720
or they're they're switching into going

25
00:01:04,720 --> 00:01:05,438
to

26
00:01:05,438 --> 00:01:08,799
cyber security or whatever um

27
00:01:08,799 --> 00:01:10,560
tying things back to the miter attack

28
00:01:10,560 --> 00:01:13,360
framework allows us to work with a

29
00:01:13,360 --> 00:01:16,320
common taxonomy for

30
00:01:16,320 --> 00:01:18,320
tactics and techniques

31
00:01:18,320 --> 00:01:21,600
so it allows my friend kenny from breach

32
00:01:21,600 --> 00:01:23,600
quest is here so i can go and talk to

33
00:01:23,600 --> 00:01:25,040
kenny about

34
00:01:25,040 --> 00:01:27,439
credential dumping and we'll all be

35
00:01:27,439 --> 00:01:29,439
talking about the same thing so the

36
00:01:29,439 --> 00:01:31,920
specific technique and sub technique

37
00:01:31,920 --> 00:01:33,759
that i'm going to talk about today

38
00:01:33,759 --> 00:01:37,040
is uh dumping lsas memory

39
00:01:37,040 --> 00:01:37,759
so

40
00:01:37,759 --> 00:01:39,040
um

41
00:01:39,040 --> 00:01:41,360
i have to talk about windows a little

42
00:01:41,360 --> 00:01:42,079
bit

43
00:01:42,079 --> 00:01:44,640
um because this sub technique that we're

44
00:01:44,640 --> 00:01:46,720
going to talk about lsas

45
00:01:46,720 --> 00:01:49,040
is a windows problem

46
00:01:49,040 --> 00:01:50,479
so i'm going to tell you right off the

47
00:01:50,479 --> 00:01:51,280
bat

48
00:01:51,280 --> 00:01:55,040
uh lsas is way more complex

49
00:01:55,040 --> 00:01:57,119
than something like

50
00:01:57,119 --> 00:02:00,560
in linux where you have etsy password

51
00:02:00,560 --> 00:02:02,240
and etsy shadow

52
00:02:02,240 --> 00:02:04,479
separated from each other elsas is a

53
00:02:04,479 --> 00:02:06,159
huge

54
00:02:06,159 --> 00:02:08,720
set of um

55
00:02:08,720 --> 00:02:11,038
modules that do a bunch of different

56
00:02:11,038 --> 00:02:12,560
things and

57
00:02:12,560 --> 00:02:16,160
uh protecting windows is not easy at all

58
00:02:16,160 --> 00:02:17,599
uh just

59
00:02:17,599 --> 00:02:19,040
if you don't

60
00:02:19,040 --> 00:02:20,959
work if you if you didn't come into this

61
00:02:20,959 --> 00:02:24,239
from being a system administrator which

62
00:02:24,239 --> 00:02:25,680
i know a lot of people started off as

63
00:02:25,680 --> 00:02:28,800
sysadmins windows is complex so i've

64
00:02:28,800 --> 00:02:31,040
actually spoken here a couple previous

65
00:02:31,040 --> 00:02:32,000
times

66
00:02:32,000 --> 00:02:34,480
about the windows firewall and doing

67
00:02:34,480 --> 00:02:36,640
some event forwarding stuff

68
00:02:36,640 --> 00:02:38,080
windows

69
00:02:38,080 --> 00:02:40,319
has a lot of

70
00:02:40,319 --> 00:02:42,160
technologies that people might not be

71
00:02:42,160 --> 00:02:44,560
familiar with but it also has a huge

72
00:02:44,560 --> 00:02:47,840
attack surface and it's used pretty much

73
00:02:47,840 --> 00:02:50,239
everywhere so almost everyone if you're

74
00:02:50,239 --> 00:02:51,599
doing security stuff you're going to run

75
00:02:51,599 --> 00:02:53,599
into protecting windows

76
00:02:53,599 --> 00:02:56,160
um so one of the issues with it is that

77
00:02:56,160 --> 00:02:58,319
it's built for compatibility

78
00:02:58,319 --> 00:02:59,519
so

79
00:02:59,519 --> 00:03:00,800
a lot of the things that i'm going to

80
00:03:00,800 --> 00:03:04,000
talk about are not turned on by default

81
00:03:04,000 --> 00:03:06,480
the microsoft isn't going to help you

82
00:03:06,480 --> 00:03:08,560
unless you buy a certain license which

83
00:03:08,560 --> 00:03:10,959
we'll talk about also

84
00:03:10,959 --> 00:03:13,440
the other thing is the general this

85
00:03:13,440 --> 00:03:16,560
morning was talking about

86
00:03:16,640 --> 00:03:19,360
protecting 1.4 million endpoints right

87
00:03:19,360 --> 00:03:21,920
so combination of whatever it is linux

88
00:03:21,920 --> 00:03:23,920
windows all that kind of stuff

89
00:03:23,920 --> 00:03:25,040
most

90
00:03:25,040 --> 00:03:27,840
organizations are not going to have 1.4

91
00:03:27,840 --> 00:03:30,239
million endpoints right so

92
00:03:30,239 --> 00:03:33,120
my sister works at a law office

93
00:03:33,120 --> 00:03:35,920
in camden they have five machines all

94
00:03:35,920 --> 00:03:37,599
windows computers

95
00:03:37,599 --> 00:03:39,040
um

96
00:03:39,040 --> 00:03:41,920
they have no idea what lss is

97
00:03:41,920 --> 00:03:43,920
and none of the things that i'm going to

98
00:03:43,920 --> 00:03:45,360
talk about are turned on in their

99
00:03:45,360 --> 00:03:47,680
environment i can almost guarantee you

100
00:03:47,680 --> 00:03:51,040
so if you do consulting work or you work

101
00:03:51,040 --> 00:03:52,799
for a mssp

102
00:03:52,799 --> 00:03:56,319
or you're in an organization and you get

103
00:03:56,319 --> 00:03:57,519
into doing

104
00:03:57,519 --> 00:03:58,480
um

105
00:03:58,480 --> 00:04:00,400
security architecture

106
00:04:00,400 --> 00:04:03,040
lsas is one of the most important things

107
00:04:03,040 --> 00:04:04,640
that you need to

108
00:04:04,640 --> 00:04:06,959
know and um

109
00:04:06,959 --> 00:04:08,640
think about how it is that you can

110
00:04:08,640 --> 00:04:11,040
detect activities that happen against it

111
00:04:11,040 --> 00:04:12,319
and then how you can turn on some

112
00:04:12,319 --> 00:04:15,760
preventive controls so windows you know

113
00:04:15,760 --> 00:04:17,918
apple apple is a hardware company and

114
00:04:17,918 --> 00:04:19,040
they can say all right we're not going

115
00:04:19,040 --> 00:04:21,279
to support this anymore and it's gone

116
00:04:21,279 --> 00:04:23,759
microsoft almost never does that

117
00:04:23,759 --> 00:04:24,800
so

118
00:04:24,800 --> 00:04:27,360
a lot of this technology is actually

119
00:04:27,360 --> 00:04:28,479
remnants

120
00:04:28,479 --> 00:04:32,320
of you know nt351 all the way

121
00:04:32,320 --> 00:04:34,960
to you know whatever it is now 27 years

122
00:04:34,960 --> 00:04:36,880
later

123
00:04:36,880 --> 00:04:37,600
so

124
00:04:37,600 --> 00:04:40,639
lsas itself

125
00:04:41,199 --> 00:04:43,199
it's part of the

126
00:04:43,199 --> 00:04:44,880
security authority

127
00:04:44,880 --> 00:04:47,600
and the lss process mostly runs in user

128
00:04:47,600 --> 00:04:49,120
mode

129
00:04:49,120 --> 00:04:50,960
so i'm gonna i'm not gonna read all

130
00:04:50,960 --> 00:04:52,800
these things but

131
00:04:52,800 --> 00:04:55,520
lsas can be thought of as basically a

132
00:04:55,520 --> 00:04:57,199
treasure chest that's running on your

133
00:04:57,199 --> 00:04:58,320
endpoint

134
00:04:58,320 --> 00:04:59,360
and

135
00:04:59,360 --> 00:05:01,440
let me be specific that i'm going to

136
00:05:01,440 --> 00:05:03,759
talk about this from an endpoint

137
00:05:03,759 --> 00:05:05,759
perspective meaning a workstation

138
00:05:05,759 --> 00:05:08,240
perspective and not a domain controller

139
00:05:08,240 --> 00:05:09,120
so

140
00:05:09,120 --> 00:05:11,440
um on your input on your windows

141
00:05:11,440 --> 00:05:14,080
endpoint your machine at home if you run

142
00:05:14,080 --> 00:05:17,120
windows lsas has access

143
00:05:17,120 --> 00:05:18,080
to

144
00:05:18,080 --> 00:05:21,280
all of these authentication providers um

145
00:05:21,280 --> 00:05:22,400
so

146
00:05:22,400 --> 00:05:23,919
they're going to have you know care bros

147
00:05:23,919 --> 00:05:26,479
tickets are going to be in their hashes

148
00:05:26,479 --> 00:05:28,320
passwords if you if you haven't turned

149
00:05:28,320 --> 00:05:29,919
off w digest

150
00:05:29,919 --> 00:05:32,160
all that stuff is going to be in there

151
00:05:32,160 --> 00:05:34,240
um

152
00:05:34,240 --> 00:05:36,639
that thing is the treasure chest for

153
00:05:36,639 --> 00:05:38,240
credentials

154
00:05:38,240 --> 00:05:41,360
that is the thing where

155
00:05:41,360 --> 00:05:43,520
someone gets access to your machine if

156
00:05:43,520 --> 00:05:45,199
they want to get credentials to do

157
00:05:45,199 --> 00:05:48,080
something like lateral movement

158
00:05:48,080 --> 00:05:50,400
lsas is the thing that they want to hit

159
00:05:50,400 --> 00:05:53,039
so at a certain point in the kill chain

160
00:05:53,039 --> 00:05:54,720
um one of the things that you might want

161
00:05:54,720 --> 00:05:55,840
to do

162
00:05:55,840 --> 00:05:58,160
is grab credentials

163
00:05:58,160 --> 00:06:00,720
and and then pivot using a credential

164
00:06:00,720 --> 00:06:02,160
that you've gotten from your from a

165
00:06:02,160 --> 00:06:05,440
machine so in a domain environment

166
00:06:05,440 --> 00:06:08,160
an lsas attack

167
00:06:08,160 --> 00:06:10,720
you want somebody to have logged in as a

168
00:06:10,720 --> 00:06:13,759
domain admin to a workstation you dump

169
00:06:13,759 --> 00:06:15,520
lsas memory

170
00:06:15,520 --> 00:06:17,680
run some kind of tool

171
00:06:17,680 --> 00:06:20,080
get credentials and then make a lateral

172
00:06:20,080 --> 00:06:21,199
move

173
00:06:21,199 --> 00:06:23,680
so i i have to anytime you talk about

174
00:06:23,680 --> 00:06:24,880
windows

175
00:06:24,880 --> 00:06:26,720
especially having to do with

176
00:06:26,720 --> 00:06:29,199
authentication you have to mention

177
00:06:29,199 --> 00:06:31,360
uh and i probably don't know how to

178
00:06:31,360 --> 00:06:32,880
pronounce his last name because i'm

179
00:06:32,880 --> 00:06:35,199
southern and

180
00:06:35,199 --> 00:06:37,440
i think it's cyphus so steve cyphus

181
00:06:37,440 --> 00:06:39,840
works for win for microsoft and has for

182
00:06:39,840 --> 00:06:41,199
a long time

183
00:06:41,199 --> 00:06:42,720
um on twitter

184
00:06:42,720 --> 00:06:44,319
sometimes someone will ask him a

185
00:06:44,319 --> 00:06:47,120
question like how does care bros work

186
00:06:47,120 --> 00:06:49,199
and he will go on a

187
00:06:49,199 --> 00:06:51,440
30 to 40

188
00:06:51,440 --> 00:06:54,800
tweet thread about what is the history

189
00:06:54,800 --> 00:06:57,280
of why microsoft picked

190
00:06:57,280 --> 00:06:59,680
care bros for authentication and go back

191
00:06:59,680 --> 00:07:01,199
to

192
00:07:01,199 --> 00:07:02,800
how did things get included in windows

193
00:07:02,800 --> 00:07:06,080
2000 all that kind of stuff so if you're

194
00:07:06,080 --> 00:07:08,400
on twitter which i strongly recommend

195
00:07:08,400 --> 00:07:10,160
that you are if you were doing security

196
00:07:10,160 --> 00:07:11,199
stuff

197
00:07:11,199 --> 00:07:15,280
steve cyphus is someone to follow

198
00:07:15,280 --> 00:07:18,960
so why is it that we care about lsas

199
00:07:18,960 --> 00:07:20,800
in addition to

200
00:07:20,800 --> 00:07:24,080
the fact that that it stores credentials

201
00:07:24,080 --> 00:07:27,199
there is a french gentleman who wrote a

202
00:07:27,199 --> 00:07:29,199
tool several years ago

203
00:07:29,199 --> 00:07:32,080
in order to learn c was

204
00:07:32,080 --> 00:07:33,759
his stated reason

205
00:07:33,759 --> 00:07:37,440
so he learned a lot about uh win32 apis

206
00:07:37,440 --> 00:07:39,599
the c language all that kind of stuff

207
00:07:39,599 --> 00:07:42,479
and wrote me me cats so

208
00:07:42,479 --> 00:07:44,400
if you're in the sands world i guarantee

209
00:07:44,400 --> 00:07:47,440
you that you've run across this in 504

210
00:07:47,440 --> 00:07:50,319
um mimikatz has been around a long time

211
00:07:50,319 --> 00:07:53,360
um mimikatz has the capability of

212
00:07:53,360 --> 00:07:56,240
reading lss dump files

213
00:07:56,240 --> 00:07:57,199
so

214
00:07:57,199 --> 00:07:58,960
uh

215
00:07:58,960 --> 00:08:01,919
is there anyone in here who does not

216
00:08:01,919 --> 00:08:04,800
know that you can dump memory from

217
00:08:04,800 --> 00:08:06,240
processes

218
00:08:06,240 --> 00:08:07,280
is that

219
00:08:07,280 --> 00:08:09,440
pretty a pretty normal thing for y'all

220
00:08:09,440 --> 00:08:10,319
to

221
00:08:10,319 --> 00:08:11,199
get

222
00:08:11,199 --> 00:08:12,800
or is there anyone that's never heard of

223
00:08:12,800 --> 00:08:15,440
that concept

224
00:08:15,840 --> 00:08:18,560
okay all right so

225
00:08:18,560 --> 00:08:20,479
even if you don't feel comfortable

226
00:08:20,479 --> 00:08:22,800
uh admitting it i didn't know about that

227
00:08:22,800 --> 00:08:27,360
you know 10 years ago or whatever um so

228
00:08:27,360 --> 00:08:29,440
me me cats can read in those dump files

229
00:08:29,440 --> 00:08:32,159
so this specific attack technique that

230
00:08:32,159 --> 00:08:34,000
we're talking about is

231
00:08:34,000 --> 00:08:35,919
use some

232
00:08:35,919 --> 00:08:36,799
thing

233
00:08:36,799 --> 00:08:39,200
and there i'll give a couple of examples

234
00:08:39,200 --> 00:08:41,200
dump the

235
00:08:41,200 --> 00:08:43,360
memory of the elsas process and reading

236
00:08:43,360 --> 00:08:46,399
it read it into mimikats

237
00:08:46,399 --> 00:08:48,560
in order to get credentials

238
00:08:48,560 --> 00:08:49,279
so

239
00:08:49,279 --> 00:08:50,800
and then there's the other way to do it

240
00:08:50,800 --> 00:08:52,959
which is basically to get direct

241
00:08:52,959 --> 00:08:56,959
process access to lsas but that

242
00:08:56,959 --> 00:08:59,120
hopefully would get called faster

243
00:08:59,120 --> 00:08:59,920
so

244
00:08:59,920 --> 00:09:03,440
mimikats as i said volatility which is

245
00:09:03,440 --> 00:09:05,120
used for

246
00:09:05,120 --> 00:09:06,880
forensics purposes normally but you

247
00:09:06,880 --> 00:09:08,880
could also use it in this case to get

248
00:09:08,880 --> 00:09:11,040
credentials

249
00:09:11,040 --> 00:09:13,519
people there's people are constantly

250
00:09:13,519 --> 00:09:16,480
writing new iterations of

251
00:09:16,480 --> 00:09:20,080
tools to do these attacks to get around

252
00:09:20,080 --> 00:09:23,200
signature based and uh behavioral based

253
00:09:23,200 --> 00:09:25,760
detections um there's a lot of them that

254
00:09:25,760 --> 00:09:28,480
are written in net right now

255
00:09:28,480 --> 00:09:30,320
um

256
00:09:30,320 --> 00:09:31,839
there's some powershell stuff that you

257
00:09:31,839 --> 00:09:34,640
can do in order to dump it uh it's

258
00:09:34,640 --> 00:09:36,399
extremely easy if you have

259
00:09:36,399 --> 00:09:38,959
administrative rights to a computer to a

260
00:09:38,959 --> 00:09:41,760
windows computer you go into task

261
00:09:41,760 --> 00:09:42,720
manager

262
00:09:42,720 --> 00:09:45,279
and uh you can create a process dump an

263
00:09:45,279 --> 00:09:49,279
else with lsas for lsas you can also run

264
00:09:49,279 --> 00:09:50,720
uh

265
00:09:50,720 --> 00:09:53,360
cis internals prop dump drop

266
00:09:53,360 --> 00:09:56,560
the the ram out uh sorry not the ram the

267
00:09:56,560 --> 00:09:58,240
memory from the process

268
00:09:58,240 --> 00:10:01,279
uh there's also some fairly unique

269
00:10:01,279 --> 00:10:02,959
things

270
00:10:02,959 --> 00:10:04,480
that came out

271
00:10:04,480 --> 00:10:07,600
a few years ago where you can there's a

272
00:10:07,600 --> 00:10:11,120
dll that's com services dll where you

273
00:10:11,120 --> 00:10:13,040
can use run dll

274
00:10:13,040 --> 00:10:14,160
run

275
00:10:14,160 --> 00:10:17,600
this com services that makes a win32 api

276
00:10:17,600 --> 00:10:19,600
call to minidump

277
00:10:19,600 --> 00:10:22,000
which will allow you to dump ram

278
00:10:22,000 --> 00:10:24,320
i can tell you that there's a lot of av

279
00:10:24,320 --> 00:10:28,240
tools that still won't catch that

280
00:10:28,720 --> 00:10:30,720
but the general principle

281
00:10:30,720 --> 00:10:32,480
is you need to get

282
00:10:32,480 --> 00:10:33,839
the live

283
00:10:33,839 --> 00:10:36,399
memory out of the lss process that's

284
00:10:36,399 --> 00:10:38,000
where the stuff is going to be that you

285
00:10:38,000 --> 00:10:39,680
want if you want to steal their

286
00:10:39,680 --> 00:10:41,200
credentials

287
00:10:41,200 --> 00:10:43,040
i thought that i would also quickly

288
00:10:43,040 --> 00:10:44,079
mention

289
00:10:44,079 --> 00:10:46,800
the concept of a malicious password

290
00:10:46,800 --> 00:10:47,760
filter

291
00:10:47,760 --> 00:10:50,800
so this is a domain attack and it has a

292
00:10:50,800 --> 00:10:53,279
different miter it's miter

293
00:10:53,279 --> 00:10:55,839
155602

294
00:10:55,839 --> 00:10:57,519
which is specifically just for a

295
00:10:57,519 --> 00:10:59,600
malicious password filter

296
00:10:59,600 --> 00:11:03,839
so in a active directory domain you can

297
00:11:03,839 --> 00:11:07,040
have a password filter which is a dll

298
00:11:07,040 --> 00:11:09,440
that gets loaded that will check to see

299
00:11:09,440 --> 00:11:12,000
whether or not

300
00:11:12,399 --> 00:11:14,640
your passwords that your users are

301
00:11:14,640 --> 00:11:16,399
changing

302
00:11:16,399 --> 00:11:18,959
are on some kind of bad list so as an

303
00:11:18,959 --> 00:11:21,839
example we would put gamecocks

304
00:11:21,839 --> 00:11:23,519
as something that somebody should never

305
00:11:23,519 --> 00:11:24,640
be able to

306
00:11:24,640 --> 00:11:27,040
put as their password because it's too

307
00:11:27,040 --> 00:11:28,320
easy to figure out that somebody that

308
00:11:28,320 --> 00:11:30,720
goes to usc would have gamecocks is the

309
00:11:30,720 --> 00:11:33,519
password we also might put

310
00:11:33,519 --> 00:11:37,360
uh tigers or you know whatever wildcats

311
00:11:37,360 --> 00:11:39,839
since we got beaten by kentucky

312
00:11:39,839 --> 00:11:42,640
horribly last last week

313
00:11:42,640 --> 00:11:44,160
but in general

314
00:11:44,160 --> 00:11:47,279
if you can create a malicious password

315
00:11:47,279 --> 00:11:48,640
filter they would basically write

316
00:11:48,640 --> 00:11:51,279
everything off somewhere else

317
00:11:51,279 --> 00:11:54,560
so i changed my password to go clemson

318
00:11:54,560 --> 00:11:56,800
it writes it off to a file somewhere

319
00:11:56,800 --> 00:11:57,839
um

320
00:11:57,839 --> 00:12:00,560
that would be used for stealth

321
00:12:00,560 --> 00:12:02,800
uh you know a ransomware attacker

322
00:12:02,800 --> 00:12:05,120
wouldn't use a malicious password filter

323
00:12:05,120 --> 00:12:06,639
somebody that wants to stay on the net

324
00:12:06,639 --> 00:12:08,880
that by design would stay on the network

325
00:12:08,880 --> 00:12:10,320
a long time would use something like

326
00:12:10,320 --> 00:12:11,839
that

327
00:12:11,839 --> 00:12:13,680
all right so this is the most

328
00:12:13,680 --> 00:12:14,959
interesting

329
00:12:14,959 --> 00:12:17,120
current one to me

330
00:12:17,120 --> 00:12:19,760
in windows 7

331
00:12:19,760 --> 00:12:22,079
there's a new global flag that was added

332
00:12:22,079 --> 00:12:24,880
that's called silent process exit

333
00:12:24,880 --> 00:12:28,560
so when a process in windows exits

334
00:12:28,560 --> 00:12:31,519
there's a new flag that can be hooked

335
00:12:31,519 --> 00:12:34,079
to do three

336
00:12:34,079 --> 00:12:36,560
a choice of three different things

337
00:12:36,560 --> 00:12:39,120
one of them is it can be used to launch

338
00:12:39,120 --> 00:12:40,560
a process

339
00:12:40,560 --> 00:12:44,000
it can do a

340
00:12:44,160 --> 00:12:45,680
mini dump

341
00:12:45,680 --> 00:12:47,360
or it can pop up some kind of

342
00:12:47,360 --> 00:12:48,720
notification

343
00:12:48,720 --> 00:12:51,279
so it seems like the first people that

344
00:12:51,279 --> 00:12:53,519
were investigating this we're using it

345
00:12:53,519 --> 00:12:55,120
for persistence

346
00:12:55,120 --> 00:12:59,360
so you get your evil code on the machine

347
00:12:59,360 --> 00:13:00,639
you

348
00:13:00,639 --> 00:13:02,959
process kill the process

349
00:13:02,959 --> 00:13:06,639
and then for persistence purposes

350
00:13:06,639 --> 00:13:09,760
at that process is death a new process

351
00:13:09,760 --> 00:13:10,959
gets started

352
00:13:10,959 --> 00:13:12,880
so that's the launch monitor process

353
00:13:12,880 --> 00:13:13,680
thing

354
00:13:13,680 --> 00:13:16,480
in our case what you would do is you

355
00:13:16,480 --> 00:13:18,399
would set lsas

356
00:13:18,399 --> 00:13:19,279
to

357
00:13:19,279 --> 00:13:20,480
mini dump

358
00:13:20,480 --> 00:13:21,760
to a file

359
00:13:21,760 --> 00:13:23,680
on process exit

360
00:13:23,680 --> 00:13:25,120
so the reason that you would want to do

361
00:13:25,120 --> 00:13:27,040
something like that primarily is to get

362
00:13:27,040 --> 00:13:29,200
get around detection

363
00:13:29,200 --> 00:13:33,040
um because it's not your process isn't

364
00:13:33,040 --> 00:13:36,639
calling anything into lsas to cause it

365
00:13:36,639 --> 00:13:38,480
to dump memory

366
00:13:38,480 --> 00:13:40,880
it's doing it itself

367
00:13:40,880 --> 00:13:42,480
so in that scenario you would want to

368
00:13:42,480 --> 00:13:46,399
look for lss dump files

369
00:13:46,720 --> 00:13:49,279
that seems to be the the current

370
00:13:49,279 --> 00:13:51,120
quote-unquote cool one

371
00:13:51,120 --> 00:13:53,279
and there's a company called deep

372
00:13:53,279 --> 00:13:56,240
instinct some researchers deep instinct

373
00:13:56,240 --> 00:13:59,120
who have an excellent um

374
00:13:59,120 --> 00:14:00,959
medium article i believe or maybe it's

375
00:14:00,959 --> 00:14:02,399
on their website

376
00:14:02,399 --> 00:14:04,800
so if you just look up deep instinct lcs

377
00:14:04,800 --> 00:14:07,120
dump they talk about using silent

378
00:14:07,120 --> 00:14:10,240
process exit for an attack

379
00:14:10,240 --> 00:14:12,000
all right so

380
00:14:12,000 --> 00:14:13,519
remember at the beginning i said

381
00:14:13,519 --> 00:14:15,120
microsoft doesn't do any of this stuff

382
00:14:15,120 --> 00:14:16,800
for you

383
00:14:16,800 --> 00:14:19,760
they have written a lot of stuff into

384
00:14:19,760 --> 00:14:20,959
the os

385
00:14:20,959 --> 00:14:24,399
but none of them are turned on until you

386
00:14:24,399 --> 00:14:26,480
start messing with it with the exception

387
00:14:26,480 --> 00:14:28,560
of the w digest thing

388
00:14:28,560 --> 00:14:31,199
so w digest there we don't need to get

389
00:14:31,199 --> 00:14:33,199
into too much detail but it's a it's an

390
00:14:33,199 --> 00:14:35,360
older way of doing things everything's

391
00:14:35,360 --> 00:14:36,959
plain text and memory all that kind of

392
00:14:36,959 --> 00:14:38,079
stuff

393
00:14:38,079 --> 00:14:40,399
um

394
00:14:40,480 --> 00:14:42,880
if you

395
00:14:42,880 --> 00:14:46,240
use things like the cis um

396
00:14:46,240 --> 00:14:48,720
secure configuration baselines or stigs

397
00:14:48,720 --> 00:14:50,639
or whatever they're going to be things

398
00:14:50,639 --> 00:14:53,760
in there about debug rights

399
00:14:53,760 --> 00:14:56,240
that kind of stuff is for defense in

400
00:14:56,240 --> 00:14:57,360
depth

401
00:14:57,360 --> 00:14:58,560
and to me

402
00:14:58,560 --> 00:15:00,399
one of the interesting things is why

403
00:15:00,399 --> 00:15:03,360
would why does the cis

404
00:15:03,360 --> 00:15:05,760
benchmark say that only administrators

405
00:15:05,760 --> 00:15:08,079
should be in d we should have debug

406
00:15:08,079 --> 00:15:09,440
rights when

407
00:15:09,440 --> 00:15:11,680
the vast majority of the time you don't

408
00:15:11,680 --> 00:15:12,399
necessarily

409
00:15:12,399 --> 00:15:15,360
need that either

410
00:15:15,680 --> 00:15:17,360
somebody that has admin rights is

411
00:15:17,360 --> 00:15:18,720
probably going to be able to do

412
00:15:18,720 --> 00:15:21,519
privileged escalation a system anyway so

413
00:15:21,519 --> 00:15:23,839
don't even let administrators do debug

414
00:15:23,839 --> 00:15:25,839
however you should obviously test that

415
00:15:25,839 --> 00:15:28,639
in your environment

416
00:15:29,600 --> 00:15:32,000
this gets back to my sister's lawyer's

417
00:15:32,000 --> 00:15:34,000
office also

418
00:15:34,000 --> 00:15:36,720
they have no idea what run as ppl is

419
00:15:36,720 --> 00:15:38,880
and there's a lot of people that don't

420
00:15:38,880 --> 00:15:40,639
know this

421
00:15:40,639 --> 00:15:42,639
even windows admins

422
00:15:42,639 --> 00:15:44,639
and your windows admin system

423
00:15:44,639 --> 00:15:47,199
administrator help desk people

424
00:15:47,199 --> 00:15:50,639
that that is actually the first security

425
00:15:50,639 --> 00:15:55,040
step in all of this windows stuff a

426
00:15:55,040 --> 00:15:56,959
competent

427
00:15:56,959 --> 00:15:59,120
windows administrator

428
00:15:59,120 --> 00:16:00,800
is worth

429
00:16:00,800 --> 00:16:03,040
tons of people on our side doing

430
00:16:03,040 --> 00:16:04,320
detection

431
00:16:04,320 --> 00:16:07,839
right because if that's done properly

432
00:16:07,839 --> 00:16:11,040
then the event the investment is there

433
00:16:11,040 --> 00:16:12,880
then we in the sock

434
00:16:12,880 --> 00:16:15,839
don't have to do as much theoretically

435
00:16:15,839 --> 00:16:17,199
um

436
00:16:17,199 --> 00:16:19,120
but half of them that i've talked to

437
00:16:19,120 --> 00:16:21,600
don't know what run as ppo is

438
00:16:21,600 --> 00:16:24,480
it was introduced in vista

439
00:16:24,480 --> 00:16:27,839
and um it's run as protected process

440
00:16:27,839 --> 00:16:28,720
light

441
00:16:28,720 --> 00:16:29,600
there's

442
00:16:29,600 --> 00:16:31,759
you can look up the msdn article about

443
00:16:31,759 --> 00:16:32,720
the

444
00:16:32,720 --> 00:16:35,120
what exactly the different protection

445
00:16:35,120 --> 00:16:36,480
levels are

446
00:16:36,480 --> 00:16:38,480
but one of them specifically has to do

447
00:16:38,480 --> 00:16:41,199
with lsas and there's a registry key

448
00:16:41,199 --> 00:16:42,880
that is not on

449
00:16:42,880 --> 00:16:45,839
by default that you turn on so all it is

450
00:16:45,839 --> 00:16:48,320
is run as ppl1

451
00:16:48,320 --> 00:16:52,399
and what that does is it basically stops

452
00:16:52,399 --> 00:16:54,560
certain dlls from being able to load

453
00:16:54,560 --> 00:16:56,399
into

454
00:16:56,399 --> 00:16:57,199
um

455
00:16:57,199 --> 00:16:59,519
lsas stopping

456
00:16:59,519 --> 00:17:02,720
process injection however if you do

457
00:17:02,720 --> 00:17:04,480
something like run duo

458
00:17:04,480 --> 00:17:06,559
and you have old

459
00:17:06,559 --> 00:17:08,480
dlls or any kind of third-party

460
00:17:08,480 --> 00:17:11,679
authentication that you hook in windows

461
00:17:11,679 --> 00:17:14,880
it has to be windows qualified and

462
00:17:14,880 --> 00:17:17,039
if you try and do old stuff it'll bomb

463
00:17:17,039 --> 00:17:19,359
so it has it has to be tested

464
00:17:19,359 --> 00:17:21,280
uh credential guard was something that

465
00:17:21,280 --> 00:17:23,039
was introduced in windows 10 which is

466
00:17:23,039 --> 00:17:26,000
primarily well only works with the main

467
00:17:26,000 --> 00:17:27,199
accounts

468
00:17:27,199 --> 00:17:28,559
um

469
00:17:28,559 --> 00:17:31,600
it is one of these things that microsoft

470
00:17:31,600 --> 00:17:34,720
has come out with in the last

471
00:17:34,720 --> 00:17:36,720
six or seven years that use

472
00:17:36,720 --> 00:17:38,880
virtualization in order to protect

473
00:17:38,880 --> 00:17:41,280
something so there's application guard

474
00:17:41,280 --> 00:17:43,600
device guard credential guard

475
00:17:43,600 --> 00:17:45,919
some other kind of guard i'm sure

476
00:17:45,919 --> 00:17:47,440
credential guard

477
00:17:47,440 --> 00:17:52,080
abstracts out lsas into an isolated

478
00:17:52,080 --> 00:17:54,880
container

479
00:17:54,880 --> 00:17:56,160
where

480
00:17:56,160 --> 00:17:58,400
only certain activities can happen and

481
00:17:58,400 --> 00:18:01,840
you can't directly read it however

482
00:18:01,840 --> 00:18:05,280
there is a mimikatz driver that can do

483
00:18:05,280 --> 00:18:07,360
some of this kind of stuff so

484
00:18:07,360 --> 00:18:09,280
you you have to you have to be really

485
00:18:09,280 --> 00:18:10,320
careful

486
00:18:10,320 --> 00:18:13,200
and all of these controls are additive

487
00:18:13,200 --> 00:18:14,720
and you have to test them in in your

488
00:18:14,720 --> 00:18:17,280
environment and all that kind of stuff

489
00:18:17,280 --> 00:18:19,039
so the main thing that i want you all to

490
00:18:19,039 --> 00:18:21,440
do is to know that this stuff is the is

491
00:18:21,440 --> 00:18:23,360
there because there's a lot of people

492
00:18:23,360 --> 00:18:25,760
that don't they just have no idea or if

493
00:18:25,760 --> 00:18:28,240
you come across this in something like

494
00:18:28,240 --> 00:18:29,440
the

495
00:18:29,440 --> 00:18:31,600
secure configuration baseline documents

496
00:18:31,600 --> 00:18:34,160
for something this is why

497
00:18:34,160 --> 00:18:36,480
you don't want processes to be able to

498
00:18:36,480 --> 00:18:38,559
inject into lsas because of the stuff

499
00:18:38,559 --> 00:18:42,160
that's stored in lsat's memory

500
00:18:42,160 --> 00:18:45,600
there's another thing which gets to

501
00:18:45,600 --> 00:18:47,760
what i was talking about

502
00:18:47,760 --> 00:18:50,160
microsoft will do more for you if you

503
00:18:50,160 --> 00:18:51,760
pay

504
00:18:51,760 --> 00:18:55,120
right they're a services company

505
00:18:55,120 --> 00:18:57,120
in addition to being a software company

506
00:18:57,120 --> 00:19:02,480
so in the e3 licensing e3 a3 g3

507
00:19:02,480 --> 00:19:04,480
and above

508
00:19:04,480 --> 00:19:05,400
for

509
00:19:05,400 --> 00:19:08,840
m365 you get some additional what are

510
00:19:08,840 --> 00:19:12,880
called attack surface reduction rules

511
00:19:12,880 --> 00:19:14,320
asr

512
00:19:14,320 --> 00:19:16,799
one of them is don't let bad stuff

513
00:19:16,799 --> 00:19:18,720
happen to lsas i don't remember what the

514
00:19:18,720 --> 00:19:21,200
exact name is but that that's basically

515
00:19:21,200 --> 00:19:23,600
what it comes down to only allow certain

516
00:19:23,600 --> 00:19:25,360
microsoft vetted

517
00:19:25,360 --> 00:19:27,280
uh

518
00:19:27,280 --> 00:19:29,360
dlls process

519
00:19:29,360 --> 00:19:31,520
to connect to

520
00:19:31,520 --> 00:19:33,039
lsas

521
00:19:33,039 --> 00:19:35,200
obviously this has to be tested

522
00:19:35,200 --> 00:19:39,360
which is a repeated thing

523
00:19:39,360 --> 00:19:41,200
but if you don't pay

524
00:19:41,200 --> 00:19:43,679
you get no management tools in order to

525
00:19:43,679 --> 00:19:45,280
test all this stuff so you can turn it

526
00:19:45,280 --> 00:19:47,760
on in audit mode and it'll write out and

527
00:19:47,760 --> 00:19:49,480
say

528
00:19:49,480 --> 00:19:52,720
ubc.dll connected to lsas

529
00:19:52,720 --> 00:19:55,760
duo dot blah blah blah dll connected to

530
00:19:55,760 --> 00:19:58,799
lsas and then you can turn it on and

531
00:19:58,799 --> 00:20:01,600
it'll block it if it doesn't meet

532
00:20:01,600 --> 00:20:02,799
microsoft's

533
00:20:02,799 --> 00:20:05,440
specification you know has to be signed

534
00:20:05,440 --> 00:20:07,679
go through the driver quality

535
00:20:07,679 --> 00:20:09,200
thing with microsoft all that kind of

536
00:20:09,200 --> 00:20:11,280
stuff but if you don't pay

537
00:20:11,280 --> 00:20:13,120
um you have to do it through group

538
00:20:13,120 --> 00:20:14,720
policy in the registry and it's not

539
00:20:14,720 --> 00:20:16,640
pretty

540
00:20:16,640 --> 00:20:17,919
okay

541
00:20:17,919 --> 00:20:18,799
that

542
00:20:18,799 --> 00:20:21,120
there's a big debate amongst people that

543
00:20:21,120 --> 00:20:23,760
do microsoft stuff about when is it

544
00:20:23,760 --> 00:20:25,520
they're going to start taking these some

545
00:20:25,520 --> 00:20:26,960
of these security technologies and

546
00:20:26,960 --> 00:20:28,320
moving them down

547
00:20:28,320 --> 00:20:30,559
into the lower licensing levels

548
00:20:30,559 --> 00:20:32,640
and i think it's unfortunate but it's

549
00:20:32,640 --> 00:20:34,640
because they can make money off of them

550
00:20:34,640 --> 00:20:36,159
partially because they're a services

551
00:20:36,159 --> 00:20:38,480
company

552
00:20:39,360 --> 00:20:42,240
all right so for detection purposes if

553
00:20:42,240 --> 00:20:43,919
you run mimikats

554
00:20:43,919 --> 00:20:46,240
and you haven't turned off defender

555
00:20:46,240 --> 00:20:48,640
or even you know you're using symantec

556
00:20:48,640 --> 00:20:50,400
or whatever it's probably gonna get

557
00:20:50,400 --> 00:20:51,440
caught

558
00:20:51,440 --> 00:20:52,720
um so

559
00:20:52,720 --> 00:20:55,919
don't get in the habit of turning off av

560
00:20:55,919 --> 00:20:57,520
you know it's a

561
00:20:57,520 --> 00:20:59,440
the layered defense thing all that kind

562
00:20:59,440 --> 00:21:00,480
of stuff

563
00:21:00,480 --> 00:21:04,159
um if you're not familiar with sysmon

564
00:21:04,159 --> 00:21:06,080
you need to know what it is even if you

565
00:21:06,080 --> 00:21:10,480
don't use it because the concept

566
00:21:10,880 --> 00:21:13,360
is becoming like the

567
00:21:13,360 --> 00:21:14,880
mitre framework

568
00:21:14,880 --> 00:21:17,200
if i talk to somebody i expect for them

569
00:21:17,200 --> 00:21:19,520
to know what cismon is if they're a

570
00:21:19,520 --> 00:21:20,720
defender

571
00:21:20,720 --> 00:21:23,520
um because it's becoming standard

572
00:21:23,520 --> 00:21:26,159
uh mark russonovich is

573
00:21:26,159 --> 00:21:29,039
they're working on a version for linux

574
00:21:29,039 --> 00:21:30,400
which maybe is going to replace some of

575
00:21:30,400 --> 00:21:32,000
the stuff in audit d and all that kind

576
00:21:32,000 --> 00:21:35,280
of stuff um so microsoft is putting

577
00:21:35,280 --> 00:21:36,960
since they bought cis internals whenever

578
00:21:36,960 --> 00:21:38,880
it was um they're putting a lot of

579
00:21:38,880 --> 00:21:40,640
investment into this kind of stuff and

580
00:21:40,640 --> 00:21:42,240
actually um

581
00:21:42,240 --> 00:21:44,520
if you have the good fortune of running

582
00:21:44,520 --> 00:21:48,960
e5 or a5 or g5 or whatever and you run

583
00:21:48,960 --> 00:21:51,280
defender for endpoint the what used to

584
00:21:51,280 --> 00:21:53,760
be called defender atp

585
00:21:53,760 --> 00:21:56,080
all of that telemetry is coming kind of

586
00:21:56,080 --> 00:21:59,120
from sysmon

587
00:21:59,120 --> 00:22:00,480
so the stuff that you're going to be

588
00:22:00,480 --> 00:22:02,799
looking for then is

589
00:22:02,799 --> 00:22:06,240
event id 10 in sysmon

590
00:22:06,240 --> 00:22:07,760
and but we don't have enough time to get

591
00:22:07,760 --> 00:22:09,520
into all the details about that but

592
00:22:09,520 --> 00:22:10,960
basically

593
00:22:10,960 --> 00:22:12,960
you want to look for something injected

594
00:22:12,960 --> 00:22:15,440
injecting itself into

595
00:22:15,440 --> 00:22:18,400
lsas to do something

596
00:22:18,400 --> 00:22:20,720
if you have the money to run edr that's

597
00:22:20,720 --> 00:22:22,720
a good way to do detections obviously

598
00:22:22,720 --> 00:22:25,600
but things have to be tweaked

599
00:22:25,600 --> 00:22:27,039
one of the things that i've been talking

600
00:22:27,039 --> 00:22:29,280
about is how you have to test things and

601
00:22:29,280 --> 00:22:30,640
come back to it

602
00:22:30,640 --> 00:22:33,280
so i would be remiss if i didn't

603
00:22:33,280 --> 00:22:35,760
mention detection lab so there's a

604
00:22:35,760 --> 00:22:37,760
gentleman named chris long

605
00:22:37,760 --> 00:22:40,480
whose twitter handle is centurion who

606
00:22:40,480 --> 00:22:42,240
has a

607
00:22:42,240 --> 00:22:44,080
set of

608
00:22:44,080 --> 00:22:46,400
vms that can be created with vague

609
00:22:46,400 --> 00:22:48,080
vagrant and packer

610
00:22:48,080 --> 00:22:49,840
and i think there's terraform for doing

611
00:22:49,840 --> 00:22:52,720
it in aws and maybe some azure stuff

612
00:22:52,720 --> 00:22:55,840
it sets up a domain sets up splunk

613
00:22:55,840 --> 00:22:57,200
sysmon

614
00:22:57,200 --> 00:22:59,280
a couple of clients

615
00:22:59,280 --> 00:23:00,880
and you can test all the stuff comes

616
00:23:00,880 --> 00:23:02,640
with atomic red team

617
00:23:02,640 --> 00:23:04,960
so if you're there are red canary people

618
00:23:04,960 --> 00:23:06,880
here i know today

619
00:23:06,880 --> 00:23:09,280
so atomic red team is an awesome way to

620
00:23:09,280 --> 00:23:12,240
test this kind of stuff

621
00:23:13,280 --> 00:23:15,919
one of the things also is to start start

622
00:23:15,919 --> 00:23:18,720
thinking about maturity and how do you

623
00:23:18,720 --> 00:23:20,880
how do you move from

624
00:23:20,880 --> 00:23:22,320
i don't know anything about this stuff

625
00:23:22,320 --> 00:23:23,280
at all

626
00:23:23,280 --> 00:23:24,799
to

627
00:23:24,799 --> 00:23:27,840
moving up a maturity scale or whatever

628
00:23:27,840 --> 00:23:29,200
you want to

629
00:23:29,200 --> 00:23:30,400
talk about

630
00:23:30,400 --> 00:23:32,240
where what you're really doing is

631
00:23:32,240 --> 00:23:34,640
determining what is normal for my

632
00:23:34,640 --> 00:23:36,880
environment and what isn't normal

633
00:23:36,880 --> 00:23:38,720
and one of the things that that has to

634
00:23:38,720 --> 00:23:41,200
be based off of is iteration

635
00:23:41,200 --> 00:23:42,480
so

636
00:23:42,480 --> 00:23:44,799
these techniques change over time and

637
00:23:44,799 --> 00:23:46,640
none none of this stuff

638
00:23:46,640 --> 00:23:48,559
unfortunately

639
00:23:48,559 --> 00:23:51,200
to go back to the debug rights run as

640
00:23:51,200 --> 00:23:53,600
ppo all that those are never going to go

641
00:23:53,600 --> 00:23:55,039
away probably

642
00:23:55,039 --> 00:23:57,760
however new techniques come out new

643
00:23:57,760 --> 00:24:00,000
tools get turned on from microsoft's

644
00:24:00,000 --> 00:24:01,120
perspective

645
00:24:01,120 --> 00:24:02,880
so if it

646
00:24:02,880 --> 00:24:05,600
i'm not a grc person at all but if you

647
00:24:05,600 --> 00:24:07,440
have grc kind of people they need to put

648
00:24:07,440 --> 00:24:09,840
this in the rotation of stuff we need to

649
00:24:09,840 --> 00:24:10,799
come back

650
00:24:10,799 --> 00:24:12,960
every year and run atomic red team and

651
00:24:12,960 --> 00:24:15,360
see if there's new tests for dumping lss

652
00:24:15,360 --> 00:24:17,200
something like that

653
00:24:17,200 --> 00:24:20,720
um but one of my pet peeves is the

654
00:24:20,720 --> 00:24:22,720
thought that these kinds of things can

655
00:24:22,720 --> 00:24:23,600
be

656
00:24:23,600 --> 00:24:26,080
like a light switch you know like

657
00:24:26,080 --> 00:24:28,400
where else is protected now

658
00:24:28,400 --> 00:24:32,000
which you can't do that with

659
00:24:32,000 --> 00:24:34,799
basically anything

660
00:24:34,799 --> 00:24:39,039
all of these have to go into iterations

661
00:24:39,760 --> 00:24:42,640
which also allows you to move toward

662
00:24:42,640 --> 00:24:44,640
underlying principles which is one of

663
00:24:44,640 --> 00:24:46,159
the things that the mitre attack

664
00:24:46,159 --> 00:24:49,200
framework helps helps with

665
00:24:49,200 --> 00:24:52,799
so the underlying principle here is that

666
00:24:52,799 --> 00:24:54,400
lsas

667
00:24:54,400 --> 00:24:57,440
memory is going to get dumped

668
00:24:57,440 --> 00:25:00,240
and at a certain point does it matter

669
00:25:00,240 --> 00:25:03,279
what technique somebody uses in order to

670
00:25:03,279 --> 00:25:05,279
dump lsas memory

671
00:25:05,279 --> 00:25:07,279
or is it the fact that they're dumping

672
00:25:07,279 --> 00:25:09,679
the memory as the important thing right

673
00:25:09,679 --> 00:25:10,559
so

674
00:25:10,559 --> 00:25:12,000
people write

675
00:25:12,000 --> 00:25:13,520
i don't know there's one called sharp

676
00:25:13,520 --> 00:25:15,360
dumper i think which is written in c

677
00:25:15,360 --> 00:25:16,320
sharp

678
00:25:16,320 --> 00:25:17,039
so

679
00:25:17,039 --> 00:25:19,120
you could you can recompile it every you

680
00:25:19,120 --> 00:25:21,760
could recompile it every day new hash

681
00:25:21,760 --> 00:25:23,039
etc

682
00:25:23,039 --> 00:25:24,400
um so

683
00:25:24,400 --> 00:25:25,840
something that's looking for the hash of

684
00:25:25,840 --> 00:25:28,720
me me cats or whatever won't catch it

685
00:25:28,720 --> 00:25:31,600
however if it's going to dump it has to

686
00:25:31,600 --> 00:25:33,840
talk to lsas has to get the memory out

687
00:25:33,840 --> 00:25:35,039
of there and the memory has to go

688
00:25:35,039 --> 00:25:36,240
somewhere

689
00:25:36,240 --> 00:25:37,440
so that's what i'm talking about

690
00:25:37,440 --> 00:25:39,919
underlying principles

691
00:25:39,919 --> 00:25:42,240
so the registry key to do the silent

692
00:25:42,240 --> 00:25:45,120
process exit

693
00:25:45,120 --> 00:25:47,200
still has to dump the memory

694
00:25:47,200 --> 00:25:48,159
um

695
00:25:48,159 --> 00:25:50,159
sharp dumper still has to dump memory

696
00:25:50,159 --> 00:25:53,279
when 32 api all that kind of stuff and

697
00:25:53,279 --> 00:25:54,480
you know why people are trying to get

698
00:25:54,480 --> 00:25:55,840
this is because they want to do lateral

699
00:25:55,840 --> 00:25:57,279
movement

700
00:25:57,279 --> 00:25:58,880
so you also want to use preventive

701
00:25:58,880 --> 00:26:00,640
controls like lapse

702
00:26:00,640 --> 00:26:03,039
if you're not familiar with that

703
00:26:03,039 --> 00:26:05,520
to randomize the local admin passwords

704
00:26:05,520 --> 00:26:07,039
on all your machines

705
00:26:07,039 --> 00:26:08,640
jason fawson

706
00:26:08,640 --> 00:26:10,640
who's the sans instructor

707
00:26:10,640 --> 00:26:13,279
or sans fellow or whatever level he's at

708
00:26:13,279 --> 00:26:15,279
um has some awesome powershell scripts

709
00:26:15,279 --> 00:26:18,480
to do that also

710
00:26:18,480 --> 00:26:20,080
however

711
00:26:20,080 --> 00:26:21,919
there was a discussion i believe on

712
00:26:21,919 --> 00:26:25,200
tuesday on twitter where florian roth

713
00:26:25,200 --> 00:26:28,799
who is the one of the inventors of sigma

714
00:26:28,799 --> 00:26:31,039
which you all should also know about

715
00:26:31,039 --> 00:26:32,480
is

716
00:26:32,480 --> 00:26:34,320
just because you're going to detect the

717
00:26:34,320 --> 00:26:37,039
method doesn't mean that you have to

718
00:26:37,039 --> 00:26:39,279
stop detecting tools

719
00:26:39,279 --> 00:26:41,760
so detecting netcat

720
00:26:41,760 --> 00:26:43,200
by hash

721
00:26:43,200 --> 00:26:45,520
is much faster than detecting an

722
00:26:45,520 --> 00:26:48,400
arbitrary port that gets created

723
00:26:48,400 --> 00:26:49,919
like how in the world are you going to

724
00:26:49,919 --> 00:26:52,159
figure out what created an arbitrary

725
00:26:52,159 --> 00:26:53,039
port

726
00:26:53,039 --> 00:26:56,640
unless you're doing os sec or something

727
00:26:56,640 --> 00:26:58,400
and looking for new ports listening and

728
00:26:58,400 --> 00:27:01,760
all that kind of stuff so unfortunately

729
00:27:01,760 --> 00:27:03,520
even if you're getting toward detecting

730
00:27:03,520 --> 00:27:04,720
the method

731
00:27:04,720 --> 00:27:07,120
detecting tools is faster

732
00:27:07,120 --> 00:27:09,120
and a lot of these things are known

733
00:27:09,120 --> 00:27:10,880
so your

734
00:27:10,880 --> 00:27:14,240
our jobs unfortunately are not easy and

735
00:27:14,240 --> 00:27:15,840
as i said there's no light switch that

736
00:27:15,840 --> 00:27:18,159
you can switch it's a process an

737
00:27:18,159 --> 00:27:21,440
iterative process

738
00:27:21,440 --> 00:27:22,399
so

739
00:27:22,399 --> 00:27:24,000
i know that that was a lot because we

740
00:27:24,000 --> 00:27:26,720
had to get all this done in a very short

741
00:27:26,720 --> 00:27:29,279
period of time so i wanted to give you

742
00:27:29,279 --> 00:27:31,440
quite a number of twitter accounts that

743
00:27:31,440 --> 00:27:32,960
you can follow

744
00:27:32,960 --> 00:27:35,120
um

745
00:27:35,120 --> 00:27:36,240
clement

746
00:27:36,240 --> 00:27:38,240
labrow

747
00:27:38,240 --> 00:27:39,840
has written the best thing that i've

748
00:27:39,840 --> 00:27:43,360
ever seen about protected process light

749
00:27:43,360 --> 00:27:45,919
where he goes into how can you actually

750
00:27:45,919 --> 00:27:48,080
get around it in user mode without

751
00:27:48,080 --> 00:27:50,080
having admin rights

752
00:27:50,080 --> 00:27:53,600
there's a bunch of cool stuff

753
00:27:54,159 --> 00:27:57,360
the red canary threat detection report

754
00:27:57,360 --> 00:28:01,200
will go into you know where is this

755
00:28:01,200 --> 00:28:03,760
and the dvi are where is this technique

756
00:28:03,760 --> 00:28:06,000
you know in the top 10 all that kind of

757
00:28:06,000 --> 00:28:08,080
unfortunate you know

758
00:28:08,080 --> 00:28:11,360
people need credentials so even if this

759
00:28:11,360 --> 00:28:13,039
is not in the top 10 it's never going

760
00:28:13,039 --> 00:28:15,440
away and it gets abused all the time

761
00:28:15,440 --> 00:28:18,080
all right so my contact stuff's down at

762
00:28:18,080 --> 00:28:20,159
the bottom fr columba

763
00:28:20,159 --> 00:28:20,960
on

764
00:28:20,960 --> 00:28:25,919
twitter and infosec episeicy.org

765
00:28:25,919 --> 00:28:26,720
so

766
00:28:26,720 --> 00:28:29,520
i have two minutes a minute something

767
00:28:29,520 --> 00:28:30,399
like that

768
00:28:30,399 --> 00:28:32,480
um

769
00:28:32,480 --> 00:28:35,279
i will ask a question and then y'all can

770
00:28:35,279 --> 00:28:37,440
ask me maybe one question

771
00:28:37,440 --> 00:28:40,000
and uh captain marvel here will take the

772
00:28:40,000 --> 00:28:41,279
um

773
00:28:41,279 --> 00:28:43,360
take this to whoever can answer this

774
00:28:43,360 --> 00:28:44,720
question

775
00:28:44,720 --> 00:28:45,520
so

776
00:28:45,520 --> 00:28:46,960
uh

777
00:28:46,960 --> 00:28:49,760
when what version of windows was

778
00:28:49,760 --> 00:28:54,158
protected process light introduced

779
00:28:54,640 --> 00:28:57,440
yes yep vista

780
00:28:57,440 --> 00:28:59,039
all right

781
00:28:59,039 --> 00:29:01,440
um so that's a alpha

782
00:29:01,440 --> 00:29:05,440
adapter i think a wi-fi adapter

783
00:29:05,679 --> 00:29:06,880
would be cool

784
00:29:06,880 --> 00:29:08,640
all right so does anyone have any

785
00:29:08,640 --> 00:29:10,960
questions in the

786
00:29:10,960 --> 00:29:15,360
30 seconds or so that i have

787
00:29:15,360 --> 00:29:17,120
i will say it doesn't appear that there

788
00:29:17,120 --> 00:29:19,200
are any usc students in here but if

789
00:29:19,200 --> 00:29:20,720
there are

790
00:29:20,720 --> 00:29:22,799
please talk to me because

791
00:29:22,799 --> 00:29:24,880
our sock is run by students

792
00:29:24,880 --> 00:29:25,760
and

793
00:29:25,760 --> 00:29:27,679
if i don't know you and you go to usc i

794
00:29:27,679 --> 00:29:29,600
would like to meet you

795
00:29:29,600 --> 00:29:33,158
so i'll be outside

