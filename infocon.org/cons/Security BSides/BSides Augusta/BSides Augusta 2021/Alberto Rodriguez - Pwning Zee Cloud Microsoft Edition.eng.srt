1
00:00:12,160 --> 00:00:14,400
all

2
00:00:14,920 --> 00:00:17,119
right all right we're we're near the

3
00:00:17,119 --> 00:00:19,119
finale of b-sides i think i'm second to

4
00:00:19,119 --> 00:00:21,600
last so uh pretty good stuff uh great

5
00:00:21,600 --> 00:00:23,119
talk if matt's still around that was

6
00:00:23,119 --> 00:00:24,480
awesome detection engineering

7
00:00:24,480 --> 00:00:25,840
methodology

8
00:00:25,840 --> 00:00:28,000
all right so exploiting the microsoft

9
00:00:28,000 --> 00:00:30,960
cloud um this is a pretty cool topic you

10
00:00:30,960 --> 00:00:33,040
know from from my personal vantage point

11
00:00:33,040 --> 00:00:35,680
because as everything starts to migrate

12
00:00:35,680 --> 00:00:38,079
over to the cloud i think the industry

13
00:00:38,079 --> 00:00:40,160
is going to see a lot more microsoft

14
00:00:40,160 --> 00:00:41,920
exploitation right

15
00:00:41,920 --> 00:00:43,600
you know aws has been around for a while

16
00:00:43,600 --> 00:00:45,520
i think we had a talk earlier

17
00:00:45,520 --> 00:00:47,680
about that so this is kind of the other

18
00:00:47,680 --> 00:00:50,719
flavor to that so who am i alberto

19
00:00:50,719 --> 00:00:53,199
rodriguez i currently work for a company

20
00:00:53,199 --> 00:00:55,920
called 6gen based out of maryland and

21
00:00:55,920 --> 00:00:58,079
i'm a director of also an offensive

22
00:00:58,079 --> 00:00:59,840
operator where i do

23
00:00:59,840 --> 00:01:02,160
you know red team and type stuff so i'll

24
00:01:02,160 --> 00:01:03,600
actually talk about some of the things

25
00:01:03,600 --> 00:01:05,680
i've done on engagements here

26
00:01:05,680 --> 00:01:08,400
i'm also a lead instructor at thrive dx

27
00:01:08,400 --> 00:01:10,479
formerly known as hacker u if anyone's

28
00:01:10,479 --> 00:01:12,479
familiar with that i was in the army

29
00:01:12,479 --> 00:01:14,320
which is why i see some of you familiar

30
00:01:14,320 --> 00:01:16,560
faces here spent a few years there

31
00:01:16,560 --> 00:01:18,960
conducting cyberspace operations and

32
00:01:18,960 --> 00:01:21,439
i've spoken at other conferences there

33
00:01:21,439 --> 00:01:23,920
are two notable ones there so this is my

34
00:01:23,920 --> 00:01:25,600
first time my b-side's really excited to

35
00:01:25,600 --> 00:01:26,400
be here

36
00:01:26,400 --> 00:01:28,479
and thank you for taking the time

37
00:01:28,479 --> 00:01:31,200
all right so on the agenda for today

38
00:01:31,200 --> 00:01:33,600
we're going to talk about why this is so

39
00:01:33,600 --> 00:01:35,280
important for everyone to sort of listen

40
00:01:35,280 --> 00:01:36,560
on

41
00:01:36,560 --> 00:01:38,240
the microsoft cloud as a whole give you

42
00:01:38,240 --> 00:01:39,439
a little bit of background of the

43
00:01:39,439 --> 00:01:42,000
architecture realistically speaking you

44
00:01:42,000 --> 00:01:43,600
know you got things like azure active

45
00:01:43,600 --> 00:01:45,840
direct directory and how that relates to

46
00:01:45,840 --> 00:01:48,240
on-premise active directory spoiler

47
00:01:48,240 --> 00:01:50,320
they're like not even related uh in

48
00:01:50,320 --> 00:01:52,560
terms of the capability there

49
00:01:52,560 --> 00:01:54,960
then we're to get into how attackers are

50
00:01:54,960 --> 00:01:57,040
conducting reconnaissance on your cloud

51
00:01:57,040 --> 00:01:59,200
infrastructure how they're attacking

52
00:01:59,200 --> 00:02:01,280
that cloud infrastructure and then for

53
00:02:01,280 --> 00:02:02,960
the defenders in the room you'll get

54
00:02:02,960 --> 00:02:05,200
some quick wins and tools that you can

55
00:02:05,200 --> 00:02:07,439
implement in your organization so i

56
00:02:07,439 --> 00:02:09,598
typically like to do my slides you know

57
00:02:09,598 --> 00:02:11,840
sort of like a cheat sheet for y'all so

58
00:02:11,840 --> 00:02:13,440
it'll include links it'll include

59
00:02:13,440 --> 00:02:15,360
pictures of github repos you can go and

60
00:02:15,360 --> 00:02:17,840
get after uh so i think this will be up

61
00:02:17,840 --> 00:02:19,920
on my github towards the end as well so

62
00:02:19,920 --> 00:02:22,080
you guys can pull it down and be able to

63
00:02:22,080 --> 00:02:23,599
play around with some of these defender

64
00:02:23,599 --> 00:02:26,879
and offensive tools as well

65
00:02:27,599 --> 00:02:29,360
all right so the microsoft cloud this is

66
00:02:29,360 --> 00:02:30,640
actually pretty cool how they got the

67
00:02:30,640 --> 00:02:32,000
three screens right in front of you you

68
00:02:32,000 --> 00:02:33,920
know you never have to look to the side

69
00:02:33,920 --> 00:02:35,760
the microsoft cloud right we're talking

70
00:02:35,760 --> 00:02:40,480
microsoft 365 azure and office 365 right

71
00:02:40,480 --> 00:02:42,800
software as a service has pretty much

72
00:02:42,800 --> 00:02:45,680
taken up a lot of of industry you know

73
00:02:45,680 --> 00:02:46,879
octa

74
00:02:46,879 --> 00:02:49,680
different uh you know salesforce for for

75
00:02:49,680 --> 00:02:51,120
those that are not really in a tech

76
00:02:51,120 --> 00:02:54,400
realm so to speak uh the cloud every day

77
00:02:54,400 --> 00:02:57,200
holds more and more sensitive data by

78
00:02:57,200 --> 00:02:59,040
show of hands anyone familiar with the

79
00:02:59,040 --> 00:03:01,840
recent exploitation uh the brute force

80
00:03:01,840 --> 00:03:03,680
attack by azure that was recently

81
00:03:03,680 --> 00:03:05,200
discovered

82
00:03:05,200 --> 00:03:07,680
yeah that you know microsoft has decided

83
00:03:07,680 --> 00:03:10,159
to quote unquote mitigate this specific

84
00:03:10,159 --> 00:03:13,040
technique after secureworks released uh

85
00:03:13,040 --> 00:03:15,120
the poc we're going to talk about that a

86
00:03:15,120 --> 00:03:17,200
little bit um you know we're going to

87
00:03:17,200 --> 00:03:19,440
talk about the differences between azure

88
00:03:19,440 --> 00:03:21,040
active directory

89
00:03:21,040 --> 00:03:23,760
and just active directory right the

90
00:03:23,760 --> 00:03:26,080
actual active directory component of

91
00:03:26,080 --> 00:03:27,840
things it's more of an identity

92
00:03:27,840 --> 00:03:29,680
management think of it as octa you know

93
00:03:29,680 --> 00:03:31,120
a lot of times you have companies like

94
00:03:31,120 --> 00:03:33,440
duo anyone familiar with duo dual like

95
00:03:33,440 --> 00:03:34,879
the multi-factor you know they're like

96
00:03:34,879 --> 00:03:37,120
the nice little green icon well duo

97
00:03:37,120 --> 00:03:39,040
loves to charge people for mfa but did

98
00:03:39,040 --> 00:03:41,360
you know you can just go out get azure

99
00:03:41,360 --> 00:03:43,440
active directory for your enterprise for

100
00:03:43,440 --> 00:03:45,760
free believe it or not and you can

101
00:03:45,760 --> 00:03:47,760
implement multi-factor authentication

102
00:03:47,760 --> 00:03:50,560
using sam authentication right so this

103
00:03:50,560 --> 00:03:52,400
is an identity service that you can

104
00:03:52,400 --> 00:03:54,239
implement in your organization to deal

105
00:03:54,239 --> 00:03:56,480
with authentication to multiple

106
00:03:56,480 --> 00:03:59,120
applications across your enterprise

107
00:03:59,120 --> 00:04:01,680
and we're now introducing which matt

108
00:04:01,680 --> 00:04:04,319
actually had up uh windows 11 and how

109
00:04:04,319 --> 00:04:07,760
that ties into the cloud as well

110
00:04:07,760 --> 00:04:10,640
the actual microsoft cloud little by

111
00:04:10,640 --> 00:04:13,599
little is ramping up on some of this the

112
00:04:13,599 --> 00:04:15,680
tactics you know it's sort of the new

113
00:04:15,680 --> 00:04:18,399
game in town aws has been around for a

114
00:04:18,399 --> 00:04:20,720
while gcp has been around for a while

115
00:04:20,720 --> 00:04:23,280
let's not forget what are the other guys

116
00:04:23,280 --> 00:04:26,479
oracle thank you uh can't forget oracle

117
00:04:26,479 --> 00:04:29,199
as well right so those cloud providers

118
00:04:29,199 --> 00:04:30,960
have been around for a while and

119
00:04:30,960 --> 00:04:33,520
microsoft's particularly azure is now

120
00:04:33,520 --> 00:04:35,440
starting to ramp up more and more every

121
00:04:35,440 --> 00:04:37,199
day so you can see some of the tactics

122
00:04:37,199 --> 00:04:39,280
that are known sort of listed here i

123
00:04:39,280 --> 00:04:41,759
recommend you sort of keep track of the

124
00:04:41,759 --> 00:04:44,160
beast as it grows over time

125
00:04:44,160 --> 00:04:46,639
here you take a look at office 365 and

126
00:04:46,639 --> 00:04:48,800
then how it differs from azure active

127
00:04:48,800 --> 00:04:50,800
directory right the identity service

128
00:04:50,800 --> 00:04:52,800
versus the software as a service

129
00:04:52,800 --> 00:04:55,840
component with office and onedrive and

130
00:04:55,840 --> 00:04:58,639
all that good stuff we all know and love

131
00:04:58,639 --> 00:05:00,639
uh but these stacked tactics are

132
00:05:00,639 --> 00:05:02,560
starting to add up this diagram here is

133
00:05:02,560 --> 00:05:05,680
actually from a microsoft mvp uh you

134
00:05:05,680 --> 00:05:07,280
know kind of a private security

135
00:05:07,280 --> 00:05:09,360
consultant i i referenced them there at

136
00:05:09,360 --> 00:05:11,440
the bottom and he's tracking even more

137
00:05:11,440 --> 00:05:14,000
than meyer was right just different ways

138
00:05:14,000 --> 00:05:16,560
on how your configurations in the cloud

139
00:05:16,560 --> 00:05:18,479
can be dangerous to the enterprise and

140
00:05:18,479 --> 00:05:19,919
how they can bring a risk to your

141
00:05:19,919 --> 00:05:21,120
enterprise

142
00:05:21,120 --> 00:05:23,440
so reconnaissance uh

143
00:05:23,440 --> 00:05:24,880
you know from the beginning you can

144
00:05:24,880 --> 00:05:27,280
actually go to this known url and it's

145
00:05:27,280 --> 00:05:29,919
referenced there and you can type in a

146
00:05:29,919 --> 00:05:32,960
specific username and domain and verify

147
00:05:32,960 --> 00:05:35,039
whether that organization based on that

148
00:05:35,039 --> 00:05:37,440
domain name let's say my organization is

149
00:05:37,440 --> 00:05:38,800
i don't know

150
00:05:38,800 --> 00:05:42,160
a-rod at sixgen.io you can verify

151
00:05:42,160 --> 00:05:44,479
whether that organization has an azure

152
00:05:44,479 --> 00:05:47,199
active directory enterprise all right i

153
00:05:47,199 --> 00:05:48,880
it's kind of small

154
00:05:48,880 --> 00:05:50,800
not that small but you can see it says

155
00:05:50,800 --> 00:05:53,360
managed which means that specific domain

156
00:05:53,360 --> 00:05:55,919
is tied to an azure id tenant

157
00:05:55,919 --> 00:05:58,479
and that means i can now interact with

158
00:05:58,479 --> 00:06:00,960
microsoft online i can enumerate users

159
00:06:00,960 --> 00:06:02,800
and further my reconnaissance all right

160
00:06:02,800 --> 00:06:04,720
so some of the reconnaissance there

161
00:06:04,720 --> 00:06:06,479
username and numeration we can do it

162
00:06:06,479 --> 00:06:08,319
passively right we can go out and get

163
00:06:08,319 --> 00:06:09,919
different usernames and emails they're

164
00:06:09,919 --> 00:06:12,240
all public depending on the organization

165
00:06:12,240 --> 00:06:14,080
my favorite are schools schools

166
00:06:14,080 --> 00:06:16,400
typically have like a directory

167
00:06:16,400 --> 00:06:18,560
right where they list every teacher

168
00:06:18,560 --> 00:06:20,479
every you know principal assistant

169
00:06:20,479 --> 00:06:22,319
principal and pretty much everyone that

170
00:06:22,319 --> 00:06:23,919
works for the school district is all

171
00:06:23,919 --> 00:06:25,600
openly online when you go against those

172
00:06:25,600 --> 00:06:28,080
targets uh breaches social media i think

173
00:06:28,080 --> 00:06:30,160
you guys kind of understand that passive

174
00:06:30,160 --> 00:06:32,400
reconnaissance perspective

175
00:06:32,400 --> 00:06:33,759
and then you can go

176
00:06:33,759 --> 00:06:36,319
interact with the microsoft online

177
00:06:36,319 --> 00:06:38,880
service and you can check

178
00:06:38,880 --> 00:06:41,520
what usernames actually exist um there

179
00:06:41,520 --> 00:06:44,000
are many tools out there the one here

180
00:06:44,000 --> 00:06:46,800
o365 enum it's a python script

181
00:06:46,800 --> 00:06:49,199
referenced out there on github and you

182
00:06:49,199 --> 00:06:51,360
can actually interact with microsoft

183
00:06:51,360 --> 00:06:54,560
online verify whether username exists or

184
00:06:54,560 --> 00:06:57,120
not okay one of the defense mechanisms

185
00:06:57,120 --> 00:06:59,840
microsoft came out was okay hey look if

186
00:06:59,840 --> 00:07:01,599
we got tons of people hitting for this

187
00:07:01,599 --> 00:07:04,160
specific domain we actually we're going

188
00:07:04,160 --> 00:07:06,720
to block that ip as you'll see later

189
00:07:06,720 --> 00:07:08,800
attackers can get creative to sort of

190
00:07:08,800 --> 00:07:11,599
you know evade that specific

191
00:07:11,599 --> 00:07:13,360
smart lockout right

192
00:07:13,360 --> 00:07:15,199
black heroes information security they

193
00:07:15,199 --> 00:07:17,360
created a tool called fire prox which

194
00:07:17,360 --> 00:07:19,039
essentially you're proxying your traffic

195
00:07:19,039 --> 00:07:21,680
through multiple virtual private servers

196
00:07:21,680 --> 00:07:24,160
and you're able to you know keep cycling

197
00:07:24,160 --> 00:07:26,160
your ip ever so often so that way

198
00:07:26,160 --> 00:07:27,919
microsoft doesn't block you

199
00:07:27,919 --> 00:07:29,440
or they may block you but it doesn't

200
00:07:29,440 --> 00:07:30,800
matter because you have a new ip so

201
00:07:30,800 --> 00:07:32,800
you're able to constantly enumerate

202
00:07:32,800 --> 00:07:35,680
users by simply interacting with the

203
00:07:35,680 --> 00:07:38,240
cloud service pretty cool pretty easy so

204
00:07:38,240 --> 00:07:39,919
now you've got yourself a big list right

205
00:07:39,919 --> 00:07:41,680
from like a-rod all the way down to

206
00:07:41,680 --> 00:07:44,000
fulanito and you can see where i'm going

207
00:07:44,000 --> 00:07:45,280
with this

208
00:07:45,280 --> 00:07:48,879
dns let's talk dns uh pretty awesome

209
00:07:48,879 --> 00:07:50,879
actually when you build let's say an

210
00:07:50,879 --> 00:07:52,960
azure vm you can

211
00:07:52,960 --> 00:07:56,319
get a valid domain that azure is

212
00:07:56,319 --> 00:07:58,879
controlling on your behalf okay as an

213
00:07:58,879 --> 00:08:02,560
example uh azure web no let me pick uh

214
00:08:02,560 --> 00:08:04,000
man i don't have it here all right

215
00:08:04,000 --> 00:08:05,199
there's too many that's that's the

216
00:08:05,199 --> 00:08:07,520
reality so when you register for these

217
00:08:07,520 --> 00:08:10,080
services yes you can tie it to your own

218
00:08:10,080 --> 00:08:12,400
domain names but some of these services

219
00:08:12,400 --> 00:08:15,120
let's say the file storage service there

220
00:08:15,120 --> 00:08:18,000
are tied to a specific domain that is

221
00:08:18,000 --> 00:08:21,199
controlled by microsoft so what if as

222
00:08:21,199 --> 00:08:22,400
attackers

223
00:08:22,400 --> 00:08:25,759
we can simply grab that service

224
00:08:25,759 --> 00:08:28,160
cycle through different permutations

225
00:08:28,160 --> 00:08:29,680
let's say i don't know let's say we're

226
00:08:29,680 --> 00:08:31,520
looking for army can you guys see that

227
00:08:31,520 --> 00:08:34,159
yeah you can so on this specific tool

228
00:08:34,159 --> 00:08:36,559
which is a tool written by carl fawson

229
00:08:36,559 --> 00:08:38,000
out of netspy

230
00:08:38,000 --> 00:08:39,839
he wrote a tool that's able to interact

231
00:08:39,839 --> 00:08:42,240
with all these dns different dnses tied

232
00:08:42,240 --> 00:08:44,720
to azure services and we're cycling

233
00:08:44,720 --> 00:08:46,000
through every different every

234
00:08:46,000 --> 00:08:48,240
permutation of the word army right so as

235
00:08:48,240 --> 00:08:49,360
you can see

236
00:08:49,360 --> 00:08:52,080
you know it's army.microsoft.com

237
00:08:52,080 --> 00:08:54,720
test army etc etc

238
00:08:54,720 --> 00:08:57,440
so instead of army it would be company

239
00:08:57,440 --> 00:08:59,680
name right or it would be

240
00:08:59,680 --> 00:09:02,240
you know github whatever

241
00:09:02,240 --> 00:09:04,399
relates to the target you're going after

242
00:09:04,399 --> 00:09:06,959
you can find these endpoints that are

243
00:09:06,959 --> 00:09:08,399
public facing

244
00:09:08,399 --> 00:09:09,680
and you can see

245
00:09:09,680 --> 00:09:11,680
what permissions they have whether right

246
00:09:11,680 --> 00:09:14,320
access read access i'm able to interact

247
00:09:14,320 --> 00:09:15,920
with some certain web page one of my

248
00:09:15,920 --> 00:09:18,160
favorites is finding test git labs right

249
00:09:18,160 --> 00:09:19,920
where they might be open and you're able

250
00:09:19,920 --> 00:09:21,440
to i don't know leverage some sort of

251
00:09:21,440 --> 00:09:24,640
ssrf vulnerability etc uh so through dns

252
00:09:24,640 --> 00:09:26,560
reconnaissance interacting with

253
00:09:26,560 --> 00:09:29,920
microsoft services we can find assets

254
00:09:29,920 --> 00:09:33,200
that are tied to the organization

255
00:09:33,200 --> 00:09:35,600
so a tax we're gonna harvest credentials

256
00:09:35,600 --> 00:09:37,680
right how can we do that one of the most

257
00:09:37,680 --> 00:09:39,920
common strategies is password spraying

258
00:09:39,920 --> 00:09:42,720
where we're able to get you know one or

259
00:09:42,720 --> 00:09:45,360
two or three really good passwords and

260
00:09:45,360 --> 00:09:47,680
send them against our you know username

261
00:09:47,680 --> 00:09:49,839
list that we created in the beginning

262
00:09:49,839 --> 00:09:51,680
right and we can come up with hopefully

263
00:09:51,680 --> 00:09:53,839
some possible solutions in this example

264
00:09:53,839 --> 00:09:55,600
you got d rios

265
00:09:55,600 --> 00:09:57,920
right uh who had a password of miami

266
00:09:57,920 --> 00:10:00,800
heat 365 uh 305 right with three

267
00:10:00,800 --> 00:10:03,120
exclamation points why because a lot of

268
00:10:03,120 --> 00:10:06,000
times organizations and people like to

269
00:10:06,000 --> 00:10:08,320
put passwords that are easy to remember

270
00:10:08,320 --> 00:10:10,000
their sports you know their favorite

271
00:10:10,000 --> 00:10:11,839
sports if i'm going against a team in

272
00:10:11,839 --> 00:10:13,920
miami i'm going to try miami heat the

273
00:10:13,920 --> 00:10:16,399
dolphins we have hockey in miami i don't

274
00:10:16,399 --> 00:10:18,720
think so the panthers right the panthers

275
00:10:18,720 --> 00:10:19,760
all right so i'm going to try different

276
00:10:19,760 --> 00:10:22,000
variations i'm going to try you know the

277
00:10:22,000 --> 00:10:24,720
seasons fall spring summer all of this

278
00:10:24,720 --> 00:10:27,040
still applies to password spraying and

279
00:10:27,040 --> 00:10:28,160
i'm going to get a valid set of

280
00:10:28,160 --> 00:10:29,920
credentials right i can also do

281
00:10:29,920 --> 00:10:32,320
credential stuffing in i'm gonna go out

282
00:10:32,320 --> 00:10:34,160
whether it's a dark web deep web

283
00:10:34,160 --> 00:10:36,000
whatever web you want to believe in i'm

284
00:10:36,000 --> 00:10:37,600
gonna go and get some public breach

285
00:10:37,600 --> 00:10:39,760
creds and i'm gonna test them out the

286
00:10:39,760 --> 00:10:42,240
more recent the better right

287
00:10:42,240 --> 00:10:44,800
and not only that but i'm also going to

288
00:10:44,800 --> 00:10:47,519
submit permutations based on those names

289
00:10:47,519 --> 00:10:49,120
one of the things i like to do is you

290
00:10:49,120 --> 00:10:51,360
know add those people that use the one

291
00:10:51,360 --> 00:10:53,279
exclamation point at the end

292
00:10:53,279 --> 00:10:55,279
add two exclamation points at the end

293
00:10:55,279 --> 00:10:56,560
that's the money maker right there

294
00:10:56,560 --> 00:10:58,959
believe that let me know if it works

295
00:10:58,959 --> 00:11:01,200
all right second thing we're gonna try

296
00:11:01,200 --> 00:11:03,279
some fishing i think fishing is you know

297
00:11:03,279 --> 00:11:05,600
arguably the most popular initial entry

298
00:11:05,600 --> 00:11:07,680
vector i mean it's just so easy

299
00:11:07,680 --> 00:11:10,079
i don't say it's so easy but it's one of

300
00:11:10,079 --> 00:11:12,320
the easiest uh initial entry vectors

301
00:11:12,320 --> 00:11:14,800
right believe it or not we can fish for

302
00:11:14,800 --> 00:11:16,880
internal access right we can send an

303
00:11:16,880 --> 00:11:19,440
email that hopefully bypasses those

304
00:11:19,440 --> 00:11:21,680
email security vendors out there

305
00:11:21,680 --> 00:11:22,880
and

306
00:11:22,880 --> 00:11:25,519
maybe execute an hta right and then boom

307
00:11:25,519 --> 00:11:29,279
code execution on a host um but one of

308
00:11:29,279 --> 00:11:31,040
the other things we can do is we can

309
00:11:31,040 --> 00:11:33,360
fish for valid set of credentials now

310
00:11:33,360 --> 00:11:36,399
credential let's think of it as matter

311
00:11:36,399 --> 00:11:38,880
right credential matter

312
00:11:38,880 --> 00:11:40,560
it's not just username and password so

313
00:11:40,560 --> 00:11:42,720
you can actually fish for

314
00:11:42,720 --> 00:11:45,200
authenticated tokens refresh tokens we

315
00:11:45,200 --> 00:11:47,600
can find ways to get an authenticated

316
00:11:47,600 --> 00:11:50,000
session to send us tokens and we're

317
00:11:50,000 --> 00:11:52,000
going to see that a little bit later

318
00:11:52,000 --> 00:11:54,399
let's say we entice a user you know we

319
00:11:54,399 --> 00:11:56,079
send an email hey we need you to sign up

320
00:11:56,079 --> 00:11:58,480
for this thing go take a look as soon as

321
00:11:58,480 --> 00:12:00,800
they go to that specific link

322
00:12:00,800 --> 00:12:02,160
they could be sitting in the middle of

323
00:12:02,160 --> 00:12:04,320
their transaction they could be giving

324
00:12:04,320 --> 00:12:06,079
credits to the wrong person right so

325
00:12:06,079 --> 00:12:08,079
it's just another way of fishing you're

326
00:12:08,079 --> 00:12:10,560
not just fishing for that initial beacon

327
00:12:10,560 --> 00:12:12,079
you're also fishing for credentials

328
00:12:12,079 --> 00:12:14,240
because that can further your operations

329
00:12:14,240 --> 00:12:17,360
uh i think this was eight months ago now

330
00:12:17,360 --> 00:12:19,279
where i was able to fish credentials use

331
00:12:19,279 --> 00:12:21,200
them on a public-facing vpn without

332
00:12:21,200 --> 00:12:23,760
multi-factor authentication directly

333
00:12:23,760 --> 00:12:26,639
into the vpn subnet pivot over to the ad

334
00:12:26,639 --> 00:12:28,560
game over right it's just another way to

335
00:12:28,560 --> 00:12:30,800
get credentials

336
00:12:30,800 --> 00:12:33,200
uh so there's a great tool called evil

337
00:12:33,200 --> 00:12:35,440
engine x2 that everyone should be aware

338
00:12:35,440 --> 00:12:36,800
of or at least write detection

339
00:12:36,800 --> 00:12:38,880
engineering rules for similar to how

340
00:12:38,880 --> 00:12:41,600
this works but essentially

341
00:12:41,600 --> 00:12:43,200
did this turn off

342
00:12:43,200 --> 00:12:45,519
maybe am i good all right

343
00:12:45,519 --> 00:12:47,519
essentially if you're able to fish a

344
00:12:47,519 --> 00:12:50,399
user to go through your malicious server

345
00:12:50,399 --> 00:12:51,920
you can sit in the middle of that

346
00:12:51,920 --> 00:12:54,160
transaction and capture the credentials

347
00:12:54,160 --> 00:12:55,760
as they are interacting with the

348
00:12:55,760 --> 00:12:58,079
microsoft service okay i do have a demo

349
00:12:58,079 --> 00:13:00,240
for this but i won't show it because

350
00:13:00,240 --> 00:13:02,000
it will take too long but i will show a

351
00:13:02,000 --> 00:13:04,639
different demo later but it's a pretty

352
00:13:04,639 --> 00:13:06,800
easy tactic to perform as an attacker if

353
00:13:06,800 --> 00:13:09,279
you're able to entice a user into

354
00:13:09,279 --> 00:13:11,200
surfing to where you want them to surf

355
00:13:11,200 --> 00:13:13,040
which as you guys all know you know a

356
00:13:13,040 --> 00:13:14,639
lot of folks out there are gonna you

357
00:13:14,639 --> 00:13:17,600
know get curious if you will

358
00:13:17,600 --> 00:13:19,600
a really up-and-coming tactic is

359
00:13:19,600 --> 00:13:21,680
actually phishing

360
00:13:21,680 --> 00:13:23,920
users into accepting enterprise

361
00:13:23,920 --> 00:13:25,519
applications this is going to be one of

362
00:13:25,519 --> 00:13:29,040
the hey defenders like go fix this now

363
00:13:29,040 --> 00:13:30,880
but it's one of the ways that an

364
00:13:30,880 --> 00:13:33,519
attacker can get in is

365
00:13:33,519 --> 00:13:36,240
if you approve a malicious application

366
00:13:36,240 --> 00:13:37,839
into your enterprise

367
00:13:37,839 --> 00:13:40,480
and users start you know signing up for

368
00:13:40,480 --> 00:13:41,199
it

369
00:13:41,199 --> 00:13:42,880
you're going to be able to get whatever

370
00:13:42,880 --> 00:13:44,560
access that application may have and

371
00:13:44,560 --> 00:13:45,760
we're going to see this a little bit

372
00:13:45,760 --> 00:13:48,560
later but this is real you know

373
00:13:48,560 --> 00:13:50,320
something i use in engagement like you

374
00:13:50,320 --> 00:13:52,639
see all those check boxes there yeah i

375
00:13:52,639 --> 00:13:53,839
got a little

376
00:13:53,839 --> 00:13:56,000
it was too much i know i could have just

377
00:13:56,000 --> 00:13:57,920
gone for the user email right i can give

378
00:13:57,920 --> 00:14:00,079
api access to that application i can say

379
00:14:00,079 --> 00:14:02,880
hey i want to be able to read users that

380
00:14:02,880 --> 00:14:04,959
accept me as an application

381
00:14:04,959 --> 00:14:06,560
read the user emails i want to be able

382
00:14:06,560 --> 00:14:08,000
to read their con you know their

383
00:14:08,000 --> 00:14:10,639
contacts right so i can like dump global

384
00:14:10,639 --> 00:14:12,720
i want to be able to maybe send emails

385
00:14:12,720 --> 00:14:14,399
so now i can send internal phishing

386
00:14:14,399 --> 00:14:16,800
emails right between parties i want to

387
00:14:16,800 --> 00:14:19,440
be able to write to a specific onenote

388
00:14:19,440 --> 00:14:21,600
et cetera so just just to get the brains

389
00:14:21,600 --> 00:14:23,040
going of different things you can do i

390
00:14:23,040 --> 00:14:25,680
mean the api coverage there is so big

391
00:14:25,680 --> 00:14:27,440
that you probably just want to sit down

392
00:14:27,440 --> 00:14:29,040
on a weekend honestly and get everything

393
00:14:29,040 --> 00:14:31,600
you can do

394
00:14:31,600 --> 00:14:34,079
and microsoft is now this is a microsoft

395
00:14:34,079 --> 00:14:35,519
picture by the way microsoft's starting

396
00:14:35,519 --> 00:14:37,440
to crack down and educate people on

397
00:14:37,440 --> 00:14:39,600
these enterprise applications right if

398
00:14:39,600 --> 00:14:42,079
an attacker is able to just go right in

399
00:14:42,079 --> 00:14:45,440
uh you know via a legitimate application

400
00:14:45,440 --> 00:14:47,279
accepted by the company well that's a

401
00:14:47,279 --> 00:14:50,480
little bit difficult to sort of identify

402
00:14:50,480 --> 00:14:52,240
especially if you're an application that

403
00:14:52,240 --> 00:14:54,399
just has tons of enterprise applications

404
00:14:54,399 --> 00:14:56,399
within your azure tenant

405
00:14:56,399 --> 00:14:57,839
all right cool let's go into a quick

406
00:14:57,839 --> 00:14:59,920
demo here uh and this is just going to

407
00:14:59,920 --> 00:15:02,399
be short and sweet on the right i have a

408
00:15:02,399 --> 00:15:05,760
tool called o365 steeler which is a uh i

409
00:15:05,760 --> 00:15:07,279
think it's like a django application

410
00:15:07,279 --> 00:15:09,680
written by ultra security essentially

411
00:15:09,680 --> 00:15:11,199
it's able to

412
00:15:11,199 --> 00:15:13,199
you know capture

413
00:15:13,199 --> 00:15:15,680
the token it's going to do everything

414
00:15:15,680 --> 00:15:17,360
for you on the left is going to be the

415
00:15:17,360 --> 00:15:19,600
victim so the victim is going to receive

416
00:15:19,600 --> 00:15:21,680
a link right however they receive it

417
00:15:21,680 --> 00:15:23,120
whether it's an open redirect

418
00:15:23,120 --> 00:15:24,639
vulnerability that you leverage whether

419
00:15:24,639 --> 00:15:26,240
you send it to their inbox whether you

420
00:15:26,240 --> 00:15:28,399
put it on a forum whether you send it on

421
00:15:28,399 --> 00:15:30,480
some public slack channel or discord be

422
00:15:30,480 --> 00:15:31,920
careful with those right

423
00:15:31,920 --> 00:15:33,839
if you're authenticated

424
00:15:33,839 --> 00:15:35,279
you're going to be prompted with some so

425
00:15:35,279 --> 00:15:36,720
let's run through this demo as i walk

426
00:15:36,720 --> 00:15:40,120
you through it

427
00:15:41,360 --> 00:15:43,279
i'm going to turn on auto refresh so as

428
00:15:43,279 --> 00:15:44,560
i get you know

429
00:15:44,560 --> 00:15:46,639
things come in i can

430
00:15:46,639 --> 00:15:49,279
get get the cash and i'm going to log in

431
00:15:49,279 --> 00:15:54,199
as a rodriguez at deaftestcompany.com

432
00:15:54,240 --> 00:15:57,199
i did not have mfa enabled because i was

433
00:15:57,199 --> 00:16:00,079
too lazy to enable it for the test but

434
00:16:00,079 --> 00:16:01,440
you should definitely have mfa on your

435
00:16:01,440 --> 00:16:04,079
prod uh here's an example of those

436
00:16:04,079 --> 00:16:06,079
enterprise apps so

437
00:16:06,079 --> 00:16:09,279
realistic scenario fished a

438
00:16:09,279 --> 00:16:11,040
school district

439
00:16:11,040 --> 00:16:13,920
and the teachers were signing up for

440
00:16:13,920 --> 00:16:16,000
this really cool service that was going

441
00:16:16,000 --> 00:16:17,759
to get them to donate books i know a low

442
00:16:17,759 --> 00:16:21,440
blow but it worked so bear with me

443
00:16:21,440 --> 00:16:23,120
so a lot of teachers were like trying to

444
00:16:23,120 --> 00:16:25,040
sign up right and they wanted free books

445
00:16:25,040 --> 00:16:26,160
so

446
00:16:26,160 --> 00:16:28,639
they consent this specific application

447
00:16:28,639 --> 00:16:31,199
on behalf of the organization right

448
00:16:31,199 --> 00:16:34,480
so once they consent and they accept

449
00:16:34,480 --> 00:16:37,360
you'll see on the right and this is all

450
00:16:37,360 --> 00:16:39,839
you know free stuff so if i had more

451
00:16:39,839 --> 00:16:41,600
stuff i would get more data

452
00:16:41,600 --> 00:16:43,040
but there you know i'm logged in i just

453
00:16:43,040 --> 00:16:44,880
redirect the user on the right you can

454
00:16:44,880 --> 00:16:47,519
see me with the access token refresh

455
00:16:47,519 --> 00:16:50,240
token i can now essentially grab that

456
00:16:50,240 --> 00:16:52,800
information and use it and log in as

457
00:16:52,800 --> 00:16:55,440
that user if this user had emails those

458
00:16:55,440 --> 00:16:57,199
emails will start coming down if they

459
00:16:57,199 --> 00:16:58,880
had contacts those will start coming

460
00:16:58,880 --> 00:17:01,279
down depending on what you gave api

461
00:17:01,279 --> 00:17:03,600
access to one of the things i found

462
00:17:03,600 --> 00:17:05,199
yesterday actually i was telling the

463
00:17:05,199 --> 00:17:08,240
guys last night testing was

464
00:17:08,240 --> 00:17:10,079
once that enterprise application is

465
00:17:10,079 --> 00:17:12,480
authorized in your enterprise by one

466
00:17:12,480 --> 00:17:13,679
person

467
00:17:13,679 --> 00:17:16,640
anyone else that tries to

468
00:17:16,640 --> 00:17:19,439
give application access to this specific

469
00:17:19,439 --> 00:17:20,400
uh

470
00:17:20,400 --> 00:17:22,959
application does doesn't have to anymore

471
00:17:22,959 --> 00:17:24,400
so as you can see here i'm logging in

472
00:17:24,400 --> 00:17:26,640
with someone else john doe

473
00:17:26,640 --> 00:17:29,120
and as soon as they enter their password

474
00:17:29,120 --> 00:17:31,280
that information is going to come in on

475
00:17:31,280 --> 00:17:33,760
the right why because that enterprise

476
00:17:33,760 --> 00:17:35,600
application is already on the approved

477
00:17:35,600 --> 00:17:37,760
list so that user is not going to

478
00:17:37,760 --> 00:17:39,919
receive that banner the moment of truth

479
00:17:39,919 --> 00:17:41,120
you know what i mean so if you're able

480
00:17:41,120 --> 00:17:42,880
to get one

481
00:17:42,880 --> 00:17:45,120
everyone else would just trickle down uh

482
00:17:45,120 --> 00:17:46,880
as well so just something to keep in

483
00:17:46,880 --> 00:17:49,200
mind from the defensive and offensive

484
00:17:49,200 --> 00:17:50,480
side of things i thought it was pretty

485
00:17:50,480 --> 00:17:51,840
cool i just figured this out last night

486
00:17:51,840 --> 00:17:53,760
i'm like oh that's interesting it needs

487
00:17:53,760 --> 00:17:55,600
to tell me i only need one person to

488
00:17:55,600 --> 00:17:57,760
allow this app registration to actually

489
00:17:57,760 --> 00:17:59,280
occur and then i'm good to go that's

490
00:17:59,280 --> 00:18:00,480
awesome

491
00:18:00,480 --> 00:18:01,919
cool

492
00:18:01,919 --> 00:18:04,080
so that's the phishing side of azure and

493
00:18:04,080 --> 00:18:06,000
all its dangers now let's talk about

494
00:18:06,000 --> 00:18:07,679
different attacks i mean

495
00:18:07,679 --> 00:18:09,200
since i

496
00:18:09,200 --> 00:18:11,520
received the approval uh to speak here

497
00:18:11,520 --> 00:18:14,480
with you guys at b-sides until shoot

498
00:18:14,480 --> 00:18:16,799
just last week i've been keeping track

499
00:18:16,799 --> 00:18:19,360
of all the different zero days that have

500
00:18:19,360 --> 00:18:21,200
been released at least that i've you

501
00:18:21,200 --> 00:18:23,520
know been made aware of uh just to name

502
00:18:23,520 --> 00:18:24,559
a couple

503
00:18:24,559 --> 00:18:27,039
the one on the top left college student

504
00:18:27,039 --> 00:18:29,679
i think the person is like 21 years old

505
00:18:29,679 --> 00:18:32,160
remote code execution on azure tenant

506
00:18:32,160 --> 00:18:32,960
right

507
00:18:32,960 --> 00:18:35,039
zero day vulnerability

508
00:18:35,039 --> 00:18:37,840
they got 30 grand out of it pretty cool

509
00:18:37,840 --> 00:18:41,120
right chaos db who saw this one come up

510
00:18:41,120 --> 00:18:44,720
like every azure user could read uh

511
00:18:44,720 --> 00:18:48,000
you know cosmo databases from any azure

512
00:18:48,000 --> 00:18:49,520
you know customer

513
00:18:49,520 --> 00:18:50,799
they said

514
00:18:50,799 --> 00:18:53,679
that only the researchers that found

515
00:18:53,679 --> 00:18:56,480
this were able to successfully use this

516
00:18:56,480 --> 00:18:58,080
vulnerability

517
00:18:58,080 --> 00:18:59,200
don't know if that's true or not

518
00:18:59,200 --> 00:19:01,520
hopefully it's true but that was a zero

519
00:19:01,520 --> 00:19:04,720
day that was disclosed uh this person a

520
00:19:04,720 --> 00:19:07,039
few few weeks back as well

521
00:19:07,039 --> 00:19:10,559
remote code execution 40 grand

522
00:19:10,559 --> 00:19:12,799
just recently

523
00:19:12,799 --> 00:19:14,320
there was a

524
00:19:14,320 --> 00:19:17,280
specific port on linux unix devices on

525
00:19:17,280 --> 00:19:19,360
azure that if that port was exposed out

526
00:19:19,360 --> 00:19:20,640
to the public

527
00:19:20,640 --> 00:19:22,799
anyone could very easily get code

528
00:19:22,799 --> 00:19:25,200
execution on your linux machines

529
00:19:25,200 --> 00:19:27,360
and then just recently

530
00:19:27,360 --> 00:19:29,919
uh security researchers out of secure

531
00:19:29,919 --> 00:19:32,640
works found that you can submit

532
00:19:32,640 --> 00:19:34,799
authentication you can essentially brute

533
00:19:34,799 --> 00:19:35,919
force

534
00:19:35,919 --> 00:19:37,600
the azure

535
00:19:37,600 --> 00:19:40,559
azure ad users without showing up on

536
00:19:40,559 --> 00:19:43,039
logs or getting locked out right so like

537
00:19:43,039 --> 00:19:44,720
that's another thing that could just run

538
00:19:44,720 --> 00:19:46,400
forever and harvest credentials on your

539
00:19:46,400 --> 00:19:48,720
behalf so out of these attacks these

540
00:19:48,720 --> 00:19:50,720
zero days are definitely

541
00:19:50,720 --> 00:19:52,400
you know something we need to consider

542
00:19:52,400 --> 00:19:54,320
as we migrate to the cloud

543
00:19:54,320 --> 00:19:55,760
you know a lot of people were

544
00:19:55,760 --> 00:19:57,360
complaining about the linux one right

545
00:19:57,360 --> 00:19:59,440
like oh my gosh linuxrc and i'm like

546
00:19:59,440 --> 00:20:00,320
okay

547
00:20:00,320 --> 00:20:02,640
why did you have that random 5000 and

548
00:20:02,640 --> 00:20:04,720
some poor exposed to the public that's

549
00:20:04,720 --> 00:20:06,480
not even on by default if anyone's built

550
00:20:06,480 --> 00:20:09,840
an azure vm before you have to manually

551
00:20:09,840 --> 00:20:12,240
tell it when you build it i want ssh

552
00:20:12,240 --> 00:20:15,120
open i want https open et cetera so

553
00:20:15,120 --> 00:20:17,440
again you can mitigate some of these

554
00:20:17,440 --> 00:20:19,600
attacks by simply doing your good cyber

555
00:20:19,600 --> 00:20:22,080
security hygiene and not allowing or

556
00:20:22,080 --> 00:20:23,520
exposing certain ports when you don't

557
00:20:23,520 --> 00:20:24,480
have to

558
00:20:24,480 --> 00:20:26,960
not only do you have the azure firewall

559
00:20:26,960 --> 00:20:28,559
in place but you should have something

560
00:20:28,559 --> 00:20:30,080
else in front of it to sort of monitor

561
00:20:30,080 --> 00:20:32,480
that traffic anyways

562
00:20:32,480 --> 00:20:34,880
all right so some quick wins uh if you

563
00:20:34,880 --> 00:20:36,880
don't have mfa in 2021 as an

564
00:20:36,880 --> 00:20:39,039
organization that just like let's just

565
00:20:39,039 --> 00:20:40,960
stop the con right now

566
00:20:40,960 --> 00:20:43,440
go get in your car drive you know click

567
00:20:43,440 --> 00:20:45,200
do the clickety click i think the guy

568
00:20:45,200 --> 00:20:47,679
wi-fi lingering or not lingering around

569
00:20:47,679 --> 00:20:49,360
because mfa is going to stop a lot of

570
00:20:49,360 --> 00:20:51,360
these attacks from happening

571
00:20:51,360 --> 00:20:53,760
it's not a bl solution but it greatly

572
00:20:53,760 --> 00:20:56,400
greatly you know helps your risk level

573
00:20:56,400 --> 00:20:58,400
conditional access policies another

574
00:20:58,400 --> 00:21:00,720
great feature of azure particularly when

575
00:21:00,720 --> 00:21:03,039
it's tied to mfa right you can actually

576
00:21:03,039 --> 00:21:05,520
set specific conditions that if you're

577
00:21:05,520 --> 00:21:07,679
on this specific environment under these

578
00:21:07,679 --> 00:21:09,600
subnets or you have the specific user

579
00:21:09,600 --> 00:21:10,960
agent et cetera

580
00:21:10,960 --> 00:21:13,120
you know we want you to implement mfa

581
00:21:13,120 --> 00:21:15,200
specially this gets dangerous when you

582
00:21:15,200 --> 00:21:17,679
have service accounts or access tokens

583
00:21:17,679 --> 00:21:19,120
and you want them to do certain things

584
00:21:19,120 --> 00:21:21,280
automatically but all of a sudden now

585
00:21:21,280 --> 00:21:22,960
you're like oh it's a service account i

586
00:21:22,960 --> 00:21:25,440
don't want it to you know have mfa well

587
00:21:25,440 --> 00:21:27,360
they are ax you know there's enterprise

588
00:21:27,360 --> 00:21:29,120
applications there's service accounts

589
00:21:29,120 --> 00:21:30,960
service principles they're called in

590
00:21:30,960 --> 00:21:33,039
azure land that you can employ to sort

591
00:21:33,039 --> 00:21:34,799
of mitigate against this

592
00:21:34,799 --> 00:21:36,640
and then pim pym is great privileged

593
00:21:36,640 --> 00:21:38,720
identity management essentially it's

594
00:21:38,720 --> 00:21:41,440
like a battle buddy system if stefan and

595
00:21:41,440 --> 00:21:44,159
i want to do any administrative action

596
00:21:44,159 --> 00:21:46,799
he has to log in with mfa i gotta log in

597
00:21:46,799 --> 00:21:49,840
with mfa and then i have to submit

598
00:21:49,840 --> 00:21:52,000
to azure id i have to submit a

599
00:21:52,000 --> 00:21:54,080
privileged identity request saying hey i

600
00:21:54,080 --> 00:21:56,000
want to perform administrative actions

601
00:21:56,000 --> 00:21:58,240
and then that request goes to stefan

602
00:21:58,240 --> 00:22:00,159
stefan has to approve it and oh by the

603
00:22:00,159 --> 00:22:01,679
way you can also set it to like a

604
00:22:01,679 --> 00:22:03,919
specified time stephen can say okay dude

605
00:22:03,919 --> 00:22:06,480
you can have admin time for an hour or

606
00:22:06,480 --> 00:22:07,760
whatever you guys decide as an

607
00:22:07,760 --> 00:22:10,480
organization that's not you know being

608
00:22:10,480 --> 00:22:12,240
too micromanaging in your enterprise

609
00:22:12,240 --> 00:22:14,159
that's just limiting the attack surface

610
00:22:14,159 --> 00:22:16,240
significantly i once compromised an

611
00:22:16,240 --> 00:22:18,559
azure tenant and they had pin deployed

612
00:22:18,559 --> 00:22:20,640
even though i had a global administrator

613
00:22:20,640 --> 00:22:22,320
in azure i couldn't do anything because

614
00:22:22,320 --> 00:22:24,080
the person i kept submitting the request

615
00:22:24,080 --> 00:22:24,880
to

616
00:22:24,880 --> 00:22:26,559
wasn't clicking and then i got caught

617
00:22:26,559 --> 00:22:27,840
and it was towards the end so that's

618
00:22:27,840 --> 00:22:29,360
okay right

619
00:22:29,360 --> 00:22:31,760
but hey it works uh you got security

620
00:22:31,760 --> 00:22:34,240
defaults security defaults are awesome

621
00:22:34,240 --> 00:22:35,760
all right a lot of people don't enable

622
00:22:35,760 --> 00:22:37,200
security defaults which are not enabled

623
00:22:37,200 --> 00:22:39,679
by default i don't know why

624
00:22:39,679 --> 00:22:41,440
uh but they don't enable security

625
00:22:41,440 --> 00:22:43,679
defaults because it implements mfa

626
00:22:43,679 --> 00:22:45,840
across the organization and we all know

627
00:22:45,840 --> 00:22:48,080
execs don't like that and like oh we're

628
00:22:48,080 --> 00:22:50,080
bringing in azure to our enterprise you

629
00:22:50,080 --> 00:22:51,840
know we can't bring too much change to

630
00:22:51,840 --> 00:22:54,559
the users differences of opinion i think

631
00:22:54,559 --> 00:22:56,000
you should enable it across the board

632
00:22:56,000 --> 00:22:58,000
and let people mold to security not the

633
00:22:58,000 --> 00:22:59,919
other way around but that's cool

634
00:22:59,919 --> 00:23:02,159
all right uh here are those enterprise

635
00:23:02,159 --> 00:23:03,760
applications i don't yeah you guys can

636
00:23:03,760 --> 00:23:05,200
see that i couldn't see it from here but

637
00:23:05,200 --> 00:23:06,720
essentially

638
00:23:06,720 --> 00:23:09,039
you can limit these applications to as

639
00:23:09,039 --> 00:23:11,679
they come in your users have to accept

640
00:23:11,679 --> 00:23:13,520
them right

641
00:23:13,520 --> 00:23:15,440
this specific school district they

642
00:23:15,440 --> 00:23:17,360
didn't have this enabled and they

643
00:23:17,360 --> 00:23:19,039
actually had students

644
00:23:19,039 --> 00:23:21,280
in their programming class registering

645
00:23:21,280 --> 00:23:23,919
azure applications as soon as i saw that

646
00:23:23,919 --> 00:23:25,360
i was like wow that's really cool that

647
00:23:25,360 --> 00:23:27,840
they're doing that in school and two you

648
00:23:27,840 --> 00:23:29,440
need to enable that check box because no

649
00:23:29,440 --> 00:23:30,559
student should be registering

650
00:23:30,559 --> 00:23:31,679
applications on behalf of your

651
00:23:31,679 --> 00:23:34,320
organization

652
00:23:34,840 --> 00:23:37,120
right again

653
00:23:37,120 --> 00:23:38,400
there's a lot of settings for these

654
00:23:38,400 --> 00:23:40,640
enterprise apps um you really should

655
00:23:40,640 --> 00:23:42,480
just go down the list and make sure that

656
00:23:42,480 --> 00:23:44,559
the settings that you have are secure in

657
00:23:44,559 --> 00:23:47,039
nature and that you know you're gonna

658
00:23:47,039 --> 00:23:48,720
accept that risk as your enterprise if

659
00:23:48,720 --> 00:23:50,960
you deploy azure if you deploy this

660
00:23:50,960 --> 00:23:53,120
microsoft cloud by default it's not

661
00:23:53,120 --> 00:23:56,000
going to come secure so instead of like

662
00:23:56,000 --> 00:23:57,440
repeating what we did with active

663
00:23:57,440 --> 00:23:59,440
directory right default configs are not

664
00:23:59,440 --> 00:24:01,840
good let's just avoid it now deploy

665
00:24:01,840 --> 00:24:03,120
azure id

666
00:24:03,120 --> 00:24:04,799
not default let's go in there let's

667
00:24:04,799 --> 00:24:06,320
clean it up get it hardened and then

668
00:24:06,320 --> 00:24:09,039
utilize the technology

669
00:24:09,039 --> 00:24:10,400
uh one of the things you really want to

670
00:24:10,400 --> 00:24:13,039
do is slogging so for the longest time

671
00:24:13,039 --> 00:24:14,960
audit login was not enabled by default

672
00:24:14,960 --> 00:24:17,200
okay they fixed that went for microsoft

673
00:24:17,200 --> 00:24:18,720
right they did fix that but you

674
00:24:18,720 --> 00:24:20,480
definitely want to analyze those logs

675
00:24:20,480 --> 00:24:22,080
don't just have them there you have to

676
00:24:22,080 --> 00:24:23,840
have some sort of process even though

677
00:24:23,840 --> 00:24:25,279
it's small let's say you don't have the

678
00:24:25,279 --> 00:24:27,760
resources i get it it's expensive you

679
00:24:27,760 --> 00:24:29,679
don't have the people i got you

680
00:24:29,679 --> 00:24:32,880
do something once a week once a month

681
00:24:32,880 --> 00:24:34,720
something is better than nothing start

682
00:24:34,720 --> 00:24:36,720
whenever you can there's a great tool

683
00:24:36,720 --> 00:24:39,679
called dfr osec there's the get help for

684
00:24:39,679 --> 00:24:42,080
that if you want to check it out

685
00:24:42,080 --> 00:24:44,320
you can enumerate your attack surface so

686
00:24:44,320 --> 00:24:46,799
who's familiar bloodhound

687
00:24:46,799 --> 00:24:48,880
now they have an azure hound injector

688
00:24:48,880 --> 00:24:50,799
right it works with the same bloodhound

689
00:24:50,799 --> 00:24:53,520
gui but the azure hound ingester pulls

690
00:24:53,520 --> 00:24:55,120
out to your tenant

691
00:24:55,120 --> 00:24:56,720
does all the enumeration brings that

692
00:24:56,720 --> 00:24:58,400
data back and just then now you're able

693
00:24:58,400 --> 00:25:00,400
to see what's up right

694
00:25:00,400 --> 00:25:02,080
they also have road tools and other

695
00:25:02,080 --> 00:25:04,720
great tools storm spotter created by the

696
00:25:04,720 --> 00:25:06,720
azure red team

697
00:25:06,720 --> 00:25:09,039
if you're a defensive organization

698
00:25:09,039 --> 00:25:11,600
get these tools in place start analyzing

699
00:25:11,600 --> 00:25:13,200
another one of my favorites is scout

700
00:25:13,200 --> 00:25:15,279
suite there on the right

701
00:25:15,279 --> 00:25:17,279
here's a picture of it where you're able

702
00:25:17,279 --> 00:25:19,600
to run scout suite logged in to your

703
00:25:19,600 --> 00:25:22,159
azure tenant and it'll tell you based on

704
00:25:22,159 --> 00:25:24,320
its logic where it's misconfigured and

705
00:25:24,320 --> 00:25:27,200
where it's dangerous right so okay maybe

706
00:25:27,200 --> 00:25:29,039
you're not too familiar with microsoft

707
00:25:29,039 --> 00:25:31,120
the tactics etc

708
00:25:31,120 --> 00:25:32,720
but there are tools out there that can

709
00:25:32,720 --> 00:25:35,039
help you to enumerate this information

710
00:25:35,039 --> 00:25:37,200
and it'll tell you hey go check out this

711
00:25:37,200 --> 00:25:39,039
configuration like why do you have this

712
00:25:39,039 --> 00:25:41,120
default configuration set right and you

713
00:25:41,120 --> 00:25:42,799
can get after it before

714
00:25:42,799 --> 00:25:44,320
you show up on the news and then you

715
00:25:44,320 --> 00:25:46,159
have to call stefan all right cool so

716
00:25:46,159 --> 00:25:47,840
that concludes my talk short and sweet

717
00:25:47,840 --> 00:25:49,840
and to the point i hope you enjoy it if

718
00:25:49,840 --> 00:25:51,360
you have any questions i'll stick around

719
00:25:51,360 --> 00:25:52,880
some of the resources are there on the

720
00:25:52,880 --> 00:25:54,320
right you can reach out to me on like

721
00:25:54,320 --> 00:25:56,240
linkedin twitter whatever thank you guys

722
00:25:56,240 --> 00:25:57,679
for being such a good crowd i appreciate

723
00:25:57,679 --> 00:26:00,840
the time

