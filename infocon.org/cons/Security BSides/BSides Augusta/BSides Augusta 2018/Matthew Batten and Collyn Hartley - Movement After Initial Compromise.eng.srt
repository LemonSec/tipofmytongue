1
00:00:13,309 --> 00:00:16,529
all right so my name is Matt batten

2
00:00:16,529 --> 00:00:18,000
we're talking about movement after

3
00:00:18,000 --> 00:00:19,920
initial compromise so we're talking

4
00:00:19,920 --> 00:00:21,600
about once you compromise the system you

5
00:00:21,600 --> 00:00:24,230
to call back we're gonna do right after

6
00:00:24,230 --> 00:00:26,550
that picture neither of us have babies

7
00:00:26,550 --> 00:00:28,260
everyone always ask that we don't have

8
00:00:28,260 --> 00:00:29,939
twins we're saying that it's our first

9
00:00:29,939 --> 00:00:32,488
time presenting so we're newbies and go

10
00:00:32,488 --> 00:00:40,170
easy on us yeah all right so there's a

11
00:00:40,170 --> 00:00:42,149
picture of a Harley and I had my wedding

12
00:00:42,149 --> 00:00:43,680
I just got married you may see next

13
00:00:43,680 --> 00:00:46,649
pictures yeah we've gone to a bunch of

14
00:00:46,649 --> 00:00:48,270
talks and then we realized that I talk

15
00:00:48,270 --> 00:00:50,760
like this would be beneficial and it's

16
00:00:50,760 --> 00:00:53,190
what I've wanted to see and hopefully

17
00:00:53,190 --> 00:00:56,610
you guys enjoy it so again my name is

18
00:00:56,610 --> 00:00:58,440
Matt bad and I go by sleep zero in

19
00:00:58,440 --> 00:01:00,750
cobalt strike that's interactive mode so

20
00:01:00,750 --> 00:01:02,399
it's kind of a double meaning

21
00:01:02,399 --> 00:01:05,339
I don't sleep a lot either but I also in

22
00:01:05,339 --> 00:01:07,110
interactive mode which is not good

23
00:01:07,110 --> 00:01:10,560
tradecraft we'll explain that later so

24
00:01:10,560 --> 00:01:12,740
my handles sleep zero I have a github

25
00:01:12,740 --> 00:01:15,240
what I have on there right now my most

26
00:01:15,240 --> 00:01:18,030
recent ones I called mr. BSD why but

27
00:01:18,030 --> 00:01:20,130
it's a Python script that takes all the

28
00:01:20,130 --> 00:01:22,650
logs and a beacon and actually outputs

29
00:01:22,650 --> 00:01:24,119
it a CSV that you can upload to whatever

30
00:01:24,119 --> 00:01:26,549
you want like database later and then I

31
00:01:26,549 --> 00:01:28,920
currently work at six gen that's under a

32
00:01:28,920 --> 00:01:31,680
CEO my team is amazing a bunch of

33
00:01:31,680 --> 00:01:34,320
brilliant minds and I get to work from

34
00:01:34,320 --> 00:01:36,600
home which is a benefit and I've never

35
00:01:36,600 --> 00:01:38,640
been around such smart individuals who

36
00:01:38,640 --> 00:01:39,960
teach me stuff every day

37
00:01:39,960 --> 00:01:43,079
I'm really blessed to work with them so

38
00:01:43,079 --> 00:01:45,360
I'm a husband again so there's my wife

39
00:01:45,360 --> 00:01:46,409
she didn't know I was gonna put that

40
00:01:46,409 --> 00:01:49,049
picture on the bottom right so that was

41
00:01:49,049 --> 00:01:51,299
I said Def Con this year her hugging

42
00:01:51,299 --> 00:01:55,409
r2d2 and our wedding in May I'm at dads

43
00:01:55,409 --> 00:01:58,020
my cat I love dogs too but he's just

44
00:01:58,020 --> 00:01:59,340
always angry I want to put that picture

45
00:01:59,340 --> 00:02:04,649
in there all right it's calling heartily

46
00:02:04,649 --> 00:02:06,479
I know I just go by Hartley cuz I'm

47
00:02:06,479 --> 00:02:08,940
still currently active duty military and

48
00:02:08,940 --> 00:02:11,008
my parents didn't know spoke properly so

49
00:02:11,008 --> 00:02:11,880
no one pronounces it

50
00:02:11,880 --> 00:02:15,750
um also I'm not married just older

51
00:02:15,750 --> 00:02:17,670
brother chillip sisters must take pride

52
00:02:17,670 --> 00:02:19,530
in them red teamer penetration tester

53
00:02:19,530 --> 00:02:23,790
and my dog alright so what we're going

54
00:02:23,790 --> 00:02:24,990
to cover so we're gonna talk about

55
00:02:24,990 --> 00:02:26,310
initial recon once on the compromise

56
00:02:26,310 --> 00:02:27,780
system right so we're talking about

57
00:02:27,780 --> 00:02:30,420
after the fact of can I call that and

58
00:02:30,420 --> 00:02:31,890
talk about lateral movement it's how to

59
00:02:31,890 --> 00:02:33,390
move the systems around that network

60
00:02:33,390 --> 00:02:36,030
that your own 440 so sitting data

61
00:02:36,030 --> 00:02:37,830
through an artery already compromised

62
00:02:37,830 --> 00:02:40,590
system to a target right you don't want

63
00:02:40,590 --> 00:02:42,450
all that come from your attack by form

64
00:02:42,450 --> 00:02:43,590
you want to hide where you're coming

65
00:02:43,590 --> 00:02:45,330
from we're gonna talk about tradecraft

66
00:02:45,330 --> 00:02:47,970
while doing this and also what tools are

67
00:02:47,970 --> 00:02:51,960
being used today right so send the stage

68
00:02:51,960 --> 00:02:54,270
eyes on your computer soon your dadoes

69
00:02:54,270 --> 00:02:56,910
so since stage you're already

70
00:02:56,910 --> 00:02:58,830
compromised system and to go into it so

71
00:02:58,830 --> 00:03:01,950
this is a bash bunny and a lot of people

72
00:03:01,950 --> 00:03:03,210
here probably already are aware of what

73
00:03:03,210 --> 00:03:05,310
it is you do a lot with it it changes

74
00:03:05,310 --> 00:03:06,750
colors when you plug it in so you'll

75
00:03:06,750 --> 00:03:08,460
know it goes from you know you go from

76
00:03:08,460 --> 00:03:10,710
red to green or purple and when you plug

77
00:03:10,710 --> 00:03:12,060
it in you can wait twelve seconds and

78
00:03:12,060 --> 00:03:14,460
your powershell one-liner will run or

79
00:03:14,460 --> 00:03:16,500
it'll go to a web server that you have a

80
00:03:16,500 --> 00:03:18,570
payload waiting on that will call to

81
00:03:18,570 --> 00:03:21,240
your situ right and I mean this sounds

82
00:03:21,240 --> 00:03:23,250
like a lot and the way it like an

83
00:03:23,250 --> 00:03:25,410
example would be a secretary at a

84
00:03:25,410 --> 00:03:27,990
company you you show up Bob's a

85
00:03:27,990 --> 00:03:30,180
secretary Bob I need access to your

86
00:03:30,180 --> 00:03:33,510
servers Bob says well Sarah didn't send

87
00:03:33,510 --> 00:03:35,700
me the email was Sarah's last name Sarah

88
00:03:35,700 --> 00:03:37,170
Smith thank you Bob do you have a

89
00:03:37,170 --> 00:03:38,250
business card yeah

90
00:03:38,250 --> 00:03:41,010
here Thanks I take a picture I said no

91
00:03:41,010 --> 00:03:43,050
operate in a hotel room he already has a

92
00:03:43,050 --> 00:03:44,520
system compromising inside but we want

93
00:03:44,520 --> 00:03:46,080
more and then they'll end up sending an

94
00:03:46,080 --> 00:03:46,650
email

95
00:03:46,650 --> 00:03:49,950
spooky mail to Bob from Sarah allowing

96
00:03:49,950 --> 00:03:52,260
me access to the server room it's very

97
00:03:52,260 --> 00:03:54,300
common so phishing emails and physical

98
00:03:54,300 --> 00:03:55,709
access plugging bash bunnies and rubber

99
00:03:55,709 --> 00:03:59,160
duckies in its common way rubber duckies

100
00:03:59,160 --> 00:04:01,350
and they're seen as keyboard right as

101
00:04:01,350 --> 00:04:03,000
soon as a keyboard and it'll run through

102
00:04:03,000 --> 00:04:04,890
my goats your power show and call out to

103
00:04:04,890 --> 00:04:06,990
your seats here the web server you can

104
00:04:06,990 --> 00:04:10,200
actually stop it from just by looking

105
00:04:10,200 --> 00:04:11,910
the manufacturer model of your keyboard

106
00:04:11,910 --> 00:04:13,980
a lot of people don't do that that's a

107
00:04:13,980 --> 00:04:15,990
lot of work for large organizations to

108
00:04:15,990 --> 00:04:17,880
new ones we're gonna save our USB right

109
00:04:17,880 --> 00:04:22,860
now no work so questions ask yourself so

110
00:04:22,860 --> 00:04:24,090
Who am I

111
00:04:24,090 --> 00:04:25,260
right

112
00:04:25,260 --> 00:04:29,580
so it's pretty deep but who am I on this

113
00:04:29,580 --> 00:04:30,840
network where am I

114
00:04:30,840 --> 00:04:33,240
what's around me can I get system of my

115
00:04:33,240 --> 00:04:36,390
the current box in one and an example in

116
00:04:36,390 --> 00:04:38,880
this one when I was taken to a CP a lot

117
00:04:38,880 --> 00:04:41,250
of times I had popped my own box and I

118
00:04:41,250 --> 00:04:43,140
even be aware of it and I would just run

119
00:04:43,140 --> 00:04:44,880
tools immediately I'll get a shell I

120
00:04:44,880 --> 00:04:46,880
would just start running tools and just

121
00:04:46,880 --> 00:04:49,500
cause havoc in my own box and you know

122
00:04:49,500 --> 00:04:50,970
embarrassed I was by myself

123
00:04:50,970 --> 00:04:52,890
so 30 minutes later I'd be like wow I'm

124
00:04:52,890 --> 00:04:56,010
an idiot you know and like I hope people

125
00:04:56,010 --> 00:04:57,570
admit that here I admit when I mess up

126
00:04:57,570 --> 00:05:04,140
so he posed the questions the beginning

127
00:05:04,140 --> 00:05:06,150
of the talk the commands everyone go

128
00:05:06,150 --> 00:05:08,280
through are gonna be able what you're

129
00:05:08,280 --> 00:05:11,070
gonna use to answer those questions we

130
00:05:11,070 --> 00:05:12,690
will be showing outputs and shots of

131
00:05:12,690 --> 00:05:14,340
from them and so you can actually see

132
00:05:14,340 --> 00:05:16,230
the output but someone's I like to pick

133
00:05:16,230 --> 00:05:17,580
out cuz I'm my favorite I'll be having

134
00:05:17,580 --> 00:05:19,110
that group domain admins laughs domain

135
00:05:19,110 --> 00:05:20,940
this will cause traffic amend network op

136
00:05:20,940 --> 00:05:23,280
is in a query the DC on the network so

137
00:05:23,280 --> 00:05:25,940
but that is very common because machines

138
00:05:25,940 --> 00:05:29,040
that works that works clearly doing it

139
00:05:29,040 --> 00:05:30,840
frequently on what it does though it

140
00:05:30,840 --> 00:05:32,850
allows you to see all the domain tab and

141
00:05:32,850 --> 00:05:34,590
that work is gonna be like your goal

142
00:05:34,590 --> 00:05:36,540
system is the highest privilege level

143
00:05:36,540 --> 00:05:38,760
it's nice to get but that's not gonna be

144
00:05:38,760 --> 00:05:41,160
moving box to box box to the DC it's

145
00:05:41,160 --> 00:05:43,650
gonna be very system moving around

146
00:05:43,650 --> 00:05:45,270
network is your according to its local

147
00:05:45,270 --> 00:05:48,330
the next one I like is the net Sh

148
00:05:48,330 --> 00:05:51,750
firewall show config because box the box

149
00:05:51,750 --> 00:05:53,250
like now if Windows Defender can be on

150
00:05:53,250 --> 00:05:57,060
each box there can be multiplied you'd

151
00:05:57,060 --> 00:05:59,070
like to know how their config are they

152
00:05:59,070 --> 00:06:00,690
operational and then what they are

153
00:06:00,690 --> 00:06:02,610
because you can do your OS are type of

154
00:06:02,610 --> 00:06:09,120
the network so you can get through it so

155
00:06:09,120 --> 00:06:11,520
the phone that this is just another list

156
00:06:11,520 --> 00:06:13,170
and I hope you guys understand and know

157
00:06:13,170 --> 00:06:14,930
that these lists are all gonna be

158
00:06:14,930 --> 00:06:17,070
commands that we're not uploading right

159
00:06:17,070 --> 00:06:18,480
they're already gonna be built into

160
00:06:18,480 --> 00:06:19,620
Windows built in the command line

161
00:06:19,620 --> 00:06:21,350
they have PowerShell equivalents so

162
00:06:21,350 --> 00:06:23,670
you're not gonna be doing anything yeah

163
00:06:23,670 --> 00:06:25,650
married that someone command I wouldn't

164
00:06:25,650 --> 00:06:28,650
be doing it is out of these commands my

165
00:06:28,650 --> 00:06:33,120
PO am hi exactly yeah my own his box

166
00:06:33,120 --> 00:06:34,920
he wouldn't spent that 30 minutes on a

167
00:06:34,920 --> 00:06:36,960
test it was a test rather than osep

168
00:06:36,960 --> 00:06:39,000
wasting time trying to figure out

169
00:06:39,000 --> 00:06:41,340
is what is actually attacking and the

170
00:06:41,340 --> 00:06:43,290
arktech egg it's a very good one it

171
00:06:43,290 --> 00:06:46,230
shows you you know who who the box is

172
00:06:46,230 --> 00:06:47,430
actually the targets interacting with

173
00:06:47,430 --> 00:06:49,380
and back addressed and you can actually

174
00:06:49,380 --> 00:06:52,140
do a lot of exfil and get a lot

175
00:06:52,140 --> 00:06:55,440
information from that itself so like I

176
00:06:55,440 --> 00:06:59,400
stated before you'd be what so as you

177
00:06:59,400 --> 00:07:00,960
know we're in the command line pick

178
00:07:00,960 --> 00:07:02,370
we're looking shell before

179
00:07:02,370 --> 00:07:04,920
so these his commands and enumeration

180
00:07:04,920 --> 00:07:07,260
commands I don't think Oh ball strike so

181
00:07:07,260 --> 00:07:09,720
when you have a beacon you actually have

182
00:07:09,720 --> 00:07:11,580
to push up before your command because

183
00:07:11,580 --> 00:07:12,980
it's a window man

184
00:07:12,980 --> 00:07:15,270
like I said that group don't mavin

185
00:07:15,270 --> 00:07:17,310
splashed it man you said up there on the

186
00:07:17,310 --> 00:07:20,430
top right Batman fans so as you see our

187
00:07:20,430 --> 00:07:22,830
dummy anthem is Joker that's gonna be

188
00:07:22,830 --> 00:07:24,750
our target for the rest of the talk will

189
00:07:24,750 --> 00:07:25,950
user examples we're gonna go after

190
00:07:25,950 --> 00:07:28,680
diminish or using like the Pope and try

191
00:07:28,680 --> 00:07:30,720
to accomplish that another one I like is

192
00:07:30,720 --> 00:07:33,450
a net user slash domain because if you

193
00:07:33,450 --> 00:07:34,890
can't always get a domain admin you know

194
00:07:34,890 --> 00:07:37,169
that's keys domain haven't but if you

195
00:07:37,169 --> 00:07:38,940
can't a regular user still contributes

196
00:07:38,940 --> 00:07:40,890
the network without looking it really

197
00:07:40,890 --> 00:07:42,720
suspicious because especially if you

198
00:07:42,720 --> 00:07:44,700
have roaming profiles in a job where you

199
00:07:44,700 --> 00:07:46,440
move around a lot and the same desk

200
00:07:46,440 --> 00:07:48,510
isn't always open you will be able to

201
00:07:48,510 --> 00:07:50,520
login to multiple work stations within

202
00:07:50,520 --> 00:07:54,109
that actual network and it won't look

203
00:07:55,040 --> 00:07:58,380
alright um what the net start command is

204
00:07:58,380 --> 00:08:00,690
a big one we're on ear as a blue team or

205
00:08:00,690 --> 00:08:02,550
or red teamer um it's not like it's a

206
00:08:02,550 --> 00:08:03,900
red teamer is you can see everything

207
00:08:03,900 --> 00:08:05,460
that's starred me I was on that Windows

208
00:08:05,460 --> 00:08:08,400
target as it's being booted but as a

209
00:08:08,400 --> 00:08:10,140
blue team or if you're looking at it say

210
00:08:10,140 --> 00:08:13,500
we have a service it's our person it's

211
00:08:13,500 --> 00:08:15,900
named something silly it blend in there

212
00:08:15,900 --> 00:08:17,310
but it's bronze woman's about the

213
00:08:17,310 --> 00:08:19,229
machine every day 7:30 or whenever the

214
00:08:19,229 --> 00:08:21,450
whenever the machine is actually doing

215
00:08:21,450 --> 00:08:22,620
you will be able to see that there

216
00:08:22,620 --> 00:08:23,729
you'll see that there you be like Oh

217
00:08:23,729 --> 00:08:25,260
what is this I haven't seen this before

218
00:08:25,260 --> 00:08:26,160
I've been doing the job for a while

219
00:08:26,160 --> 00:08:27,090
that's googling

220
00:08:27,090 --> 00:08:29,400
oh it's nothing known and I might be

221
00:08:29,400 --> 00:08:33,089
compromised okay

222
00:08:33,089 --> 00:08:35,700
my favorite part is the also out of this

223
00:08:35,700 --> 00:08:37,770
slide is the top left that's tak tak a

224
00:08:37,770 --> 00:08:39,750
you know this is a big command for both

225
00:08:39,750 --> 00:08:42,030
red and blue teamers the switches for

226
00:08:42,030 --> 00:08:44,219
that attack a is gonna be showing both

227
00:08:44,219 --> 00:08:46,530
TCP and you to be protocol the attack in

228
00:08:46,530 --> 00:08:48,240
is gonna list it in numerical value by

229
00:08:48,240 --> 00:08:50,490
port and the o is gonna show you your

230
00:08:50,490 --> 00:08:52,140
pit so as you see here we have our

231
00:08:52,140 --> 00:08:52,800
beacon we

232
00:08:52,800 --> 00:08:54,420
do this with our beacon so you can see

233
00:08:54,420 --> 00:08:56,339
our connection as a blue Timur why

234
00:08:56,339 --> 00:08:58,260
seeing a connection that isn't is from

235
00:08:58,260 --> 00:08:59,250
IP knob on your network

236
00:08:59,250 --> 00:09:00,630
that's pretty so that's pretty

237
00:09:00,630 --> 00:09:02,070
self-explanatory you don't want that

238
00:09:02,070 --> 00:09:06,089
very suspicious but also as a red

239
00:09:06,089 --> 00:09:07,620
scamper if you know a blue team or a

240
00:09:07,620 --> 00:09:09,570
hunt team is employed to location or if

241
00:09:09,570 --> 00:09:10,829
you think you've been compromised

242
00:09:10,829 --> 00:09:12,720
you can see that process idea that your

243
00:09:12,720 --> 00:09:14,399
actual beacon is running under you can

244
00:09:14,399 --> 00:09:16,230
kill that and what do your clean up and

245
00:09:16,230 --> 00:09:17,459
then kill that and try to get out of

246
00:09:17,459 --> 00:09:19,320
there before you're getting caught with

247
00:09:19,320 --> 00:09:21,980
your hand in the cookie jar

248
00:09:22,010 --> 00:09:25,829
all right so an SSH firewall show config

249
00:09:25,829 --> 00:09:27,839
on the last slide as well or show state

250
00:09:27,839 --> 00:09:29,610
but you can actually see Windows

251
00:09:29,610 --> 00:09:32,519
Defender so I disabled right remote

252
00:09:32,519 --> 00:09:34,920
admin mode disabled but it's just well

253
00:09:34,920 --> 00:09:36,480
that means you won't run to see what the

254
00:09:36,480 --> 00:09:38,700
firewalls configurations are and why and

255
00:09:38,700 --> 00:09:41,279
then a random thing I just thought about

256
00:09:41,279 --> 00:09:43,339
that on our slides I was talking was a

257
00:09:43,339 --> 00:09:46,290
net help message is actually a really

258
00:09:46,290 --> 00:09:48,390
useful net command a lot of people don't

259
00:09:48,390 --> 00:09:50,880
utilize and I thought about for my last

260
00:09:50,880 --> 00:09:53,670
test so when you do commands on a COBOL

261
00:09:53,670 --> 00:09:55,470
strike beacon or even I'm meterpreter

262
00:09:55,470 --> 00:09:56,970
with Windows sometimes will give you an

263
00:09:56,970 --> 00:09:59,760
error code that it'll say like 3 you can

264
00:09:59,760 --> 00:10:01,560
actually do a net space help message

265
00:10:01,560 --> 00:10:04,890
together a CLP msg space in the number

266
00:10:04,890 --> 00:10:07,770
and I'll actually tell you what the air

267
00:10:07,770 --> 00:10:09,720
is so it's like access denied which is

268
00:10:09,720 --> 00:10:12,149
the most common right it's like 5 to 3

269
00:10:12,149 --> 00:10:13,980
or 5 you remember but you'll see that

270
00:10:13,980 --> 00:10:15,209
it's super helpful so if you get that

271
00:10:15,209 --> 00:10:16,500
number back you do a net help message

272
00:10:16,500 --> 00:10:20,010
you know immediately a route print so

273
00:10:20,010 --> 00:10:21,420
it's going to show you the pathways or

274
00:10:21,420 --> 00:10:23,910
the route route table right and then you

275
00:10:23,910 --> 00:10:25,950
can actually do a dashboard as well just

276
00:10:25,950 --> 00:10:29,220
good ipv4 so I've shown ipv6 and ipv4 to

277
00:10:29,220 --> 00:10:34,470
the Gateway and everything there a task

278
00:10:34,470 --> 00:10:36,630
list so it's going to show all the tasks

279
00:10:36,630 --> 00:10:39,149
and process IDs associated with it so of

280
00:10:39,149 --> 00:10:41,459
all the services like what actually

281
00:10:41,459 --> 00:10:43,649
starts or tasks and then the driver

282
00:10:43,649 --> 00:10:46,140
query some share all the drivers on the

283
00:10:46,140 --> 00:10:48,089
target something cool about driver query

284
00:10:48,089 --> 00:10:49,800
you can actually like a driver query

285
00:10:49,800 --> 00:10:53,010
space /f space slash things like CEO

286
00:10:53,010 --> 00:10:55,260
created see you're not / oh and you can

287
00:10:55,260 --> 00:10:56,730
actually output it to a CSV for like

288
00:10:56,730 --> 00:10:59,730
later on post exploitation so it me

289
00:10:59,730 --> 00:11:02,640
super useful and that that top one we

290
00:11:02,640 --> 00:11:04,290
actually found out from a Dave

291
00:11:04,290 --> 00:11:05,939
previously when we spoke

292
00:11:05,939 --> 00:11:07,979
I was a speaker earlier he point out

293
00:11:07,979 --> 00:11:09,929
that it's actually going well to a woman

294
00:11:09,929 --> 00:11:13,909
exploit and then uh going our tech a

295
00:11:13,909 --> 00:11:16,619
also um they point out some really

296
00:11:16,619 --> 00:11:17,999
awesome the first three octets and your

297
00:11:17,999 --> 00:11:20,759
Mac you actually will know from the UI

298
00:11:20,759 --> 00:11:25,019
organizational unique identifier right

299
00:11:25,019 --> 00:11:27,299
I'll actually tell you like what what

300
00:11:27,299 --> 00:11:29,519
type of um or where I guess the

301
00:11:29,519 --> 00:11:31,079
organization came from right what is

302
00:11:31,079 --> 00:11:32,729
specifies so you get more details that

303
00:11:32,729 --> 00:11:34,949
way I'm just going to associate the Mac

304
00:11:34,949 --> 00:11:35,849
and our cash

305
00:11:35,849 --> 00:11:39,419
so what's around it set is your Scooby

306
00:11:39,419 --> 00:11:42,389
your environmental variables so the

307
00:11:42,389 --> 00:11:44,129
reason I you said the actual reason the

308
00:11:44,129 --> 00:11:46,470
truth is I run it because I'm lazy to do

309
00:11:46,470 --> 00:11:49,699
system info and I forget to you know

310
00:11:49,699 --> 00:11:52,709
find string and then do the specific OS

311
00:11:52,709 --> 00:11:54,449
I just mostly I just probably wanted to

312
00:11:54,449 --> 00:11:56,069
the LS and the domain controller so I

313
00:11:56,069 --> 00:11:58,259
just I run set I just look at the output

314
00:11:58,259 --> 00:11:59,309
and there it is

315
00:11:59,309 --> 00:12:01,529
it's got some tasks with query I'm gonna

316
00:12:01,529 --> 00:12:03,509
FL list but the slash B is important at

317
00:12:03,509 --> 00:12:04,970
the end because actually show you what

318
00:12:04,970 --> 00:12:07,919
user the scheduled tasks or running on

319
00:12:07,919 --> 00:12:09,749
your ass so that's why that B is really

320
00:12:09,749 --> 00:12:14,609
important so disrespect your

321
00:12:14,609 --> 00:12:16,829
surroundings I thought it's fine no one

322
00:12:16,829 --> 00:12:20,549
else well it's fine Who am I so shows

323
00:12:20,549 --> 00:12:21,929
you who you are on the current system

324
00:12:21,929 --> 00:12:24,929
echo logon server so that shows you your

325
00:12:24,929 --> 00:12:28,349
domain controller but so somebody's

326
00:12:28,349 --> 00:12:29,639
gonna argue with me or say buddy well

327
00:12:29,639 --> 00:12:30,899
you know that doesn't always work

328
00:12:30,899 --> 00:12:32,369
understand the time like you're right

329
00:12:32,369 --> 00:12:34,439
yeah probably 90 percent 80 percent and

330
00:12:34,439 --> 00:12:37,409
you can actually do a nlnl test space

331
00:12:37,409 --> 00:12:41,669
like get the DC name I believe is what

332
00:12:41,669 --> 00:12:43,859
is being you you do and I'll test help

333
00:12:43,859 --> 00:12:45,869
it'll tell you as well but that'll give

334
00:12:45,869 --> 00:12:47,579
you a hundred cent but I run heck along

335
00:12:47,579 --> 00:12:48,779
the server I could use me more actually

336
00:12:48,779 --> 00:12:50,399
show the user as well so you can see

337
00:12:50,399 --> 00:12:55,099
Batman Batman okay so at this point we

338
00:12:55,099 --> 00:12:58,529
we were on a system we know what the

339
00:12:58,529 --> 00:13:00,329
environment is another firewall we knew

340
00:13:00,329 --> 00:13:01,949
everything so now we're gonna get into a

341
00:13:01,949 --> 00:13:03,779
method of just prove especially F

342
00:13:03,779 --> 00:13:06,809
privilege escalation just to I know the

343
00:13:06,809 --> 00:13:07,979
talk isn't about that but we're gonna do

344
00:13:07,979 --> 00:13:09,599
it once so because none of some of the

345
00:13:09,599 --> 00:13:11,220
protests collation I mean why don't move

346
00:13:11,220 --> 00:13:12,839
in later in the video actually requires

347
00:13:12,839 --> 00:13:14,459
higher privilege and just a basic user

348
00:13:14,459 --> 00:13:16,409
on the machine so what we're gonna go

349
00:13:16,409 --> 00:13:18,959
through using powerup it's part of a

350
00:13:18,959 --> 00:13:19,590
power school

351
00:13:19,590 --> 00:13:23,040
toolkit spec drops they've created it so

352
00:13:23,040 --> 00:13:26,520
here we're gonna go to power sploit

353
00:13:26,520 --> 00:13:30,600
toolkit provost is what we want to

354
00:13:30,600 --> 00:13:33,630
accomplish with this script we're gonna

355
00:13:33,630 --> 00:13:36,000
import power up top ps1 and then invoke

356
00:13:36,000 --> 00:13:39,120
all checks it's just a command powerup

357
00:13:39,120 --> 00:13:40,500
what this does it's gonna run on the

358
00:13:40,500 --> 00:13:42,000
target system and it's gonna look for

359
00:13:42,000 --> 00:13:43,500
any misconfigurations by the

360
00:13:43,500 --> 00:13:45,300
administrator that I can take advantage

361
00:13:45,300 --> 00:13:47,550
of in order to actually accomplish a

362
00:13:47,550 --> 00:13:51,810
task of privilege escalation runs by

363
00:13:51,810 --> 00:13:53,010
pretty fast reduced bullet

364
00:13:53,010 --> 00:13:54,300
let's go back up to it but the Miss

365
00:13:54,300 --> 00:13:56,279
configuration in this video is to deal

366
00:13:56,279 --> 00:13:59,790
hijacking so after we run this it's

367
00:13:59,790 --> 00:14:01,230
really nice it tells you the abuse

368
00:14:01,230 --> 00:14:02,250
function you're gonna have to run

369
00:14:02,250 --> 00:14:05,220
through powerup it's right tack hijack

370
00:14:05,220 --> 00:14:07,560
DLL and then it gives you the complete

371
00:14:07,560 --> 00:14:09,390
you don't have to go and guess the past

372
00:14:09,390 --> 00:14:13,680
so you can come in and run it and then

373
00:14:13,680 --> 00:14:15,270
you will it will populate a beacon for

374
00:14:15,270 --> 00:14:19,490
you with that escalated privilege level

375
00:14:20,300 --> 00:14:22,529
so the next we can't talk about power up

376
00:14:22,529 --> 00:14:24,030
without talking about Goku because you

377
00:14:24,030 --> 00:14:26,160
know if anyone's familiar with Dragon

378
00:14:26,160 --> 00:14:28,080
Ball Z that one scene takes at least 13

379
00:14:28,080 --> 00:14:32,280
episodes so so what happens when you do

380
00:14:32,280 --> 00:14:34,170
deal out hijacking is first a

381
00:14:34,170 --> 00:14:37,589
self-deleting batch file is created with

382
00:14:37,589 --> 00:14:39,089
the command you want to import you can

383
00:14:39,089 --> 00:14:40,200
import any command because when you're

384
00:14:40,200 --> 00:14:41,550
when you're creating it you can do tax

385
00:14:41,550 --> 00:14:43,680
taxi command and that will allow you to

386
00:14:43,680 --> 00:14:46,080
import different commands so it creates

387
00:14:46,080 --> 00:14:48,120
a self-deluding batch file and hides it

388
00:14:48,120 --> 00:14:49,830
within a path on the network after it

389
00:14:49,830 --> 00:14:51,420
does that at one the target box after it

390
00:14:51,420 --> 00:14:54,810
does that it creates a c++ dll which

391
00:14:54,810 --> 00:14:56,820
then append the abuse function that we

392
00:14:56,820 --> 00:14:59,160
saw earlier for the right right tak

393
00:14:59,160 --> 00:15:00,870
hijack dll and then once that deal

394
00:15:00,870 --> 00:15:02,880
executes it caused that batch file and

395
00:15:02,880 --> 00:15:04,350
then that is what gives you your

396
00:15:04,350 --> 00:15:06,270
privilege escalation callback back

397
00:15:06,270 --> 00:15:08,490
within coal strike because that is how

398
00:15:08,490 --> 00:15:12,780
we use it on this time alright so um

399
00:15:12,780 --> 00:15:14,820
we're gonna talk about different ways to

400
00:15:14,820 --> 00:15:15,990
do remote code execution because we're

401
00:15:15,990 --> 00:15:18,839
talking about lateral movement so Linux

402
00:15:18,839 --> 00:15:20,010
stands for windows management

403
00:15:20,010 --> 00:15:22,230
instrumentation console so to leave

404
00:15:22,230 --> 00:15:24,959
utilizing WMI and you and that's that's

405
00:15:24,959 --> 00:15:26,070
the command that you would actually put

406
00:15:26,070 --> 00:15:27,390
in a COBOL strike we're gonna show you

407
00:15:27,390 --> 00:15:29,070
Metasploit examples later as well a

408
00:15:29,070 --> 00:15:30,330
different way so we're not just going to

409
00:15:30,330 --> 00:15:32,459
do one see - so I don't you think we're

410
00:15:32,459 --> 00:15:33,180
doing that

411
00:15:33,180 --> 00:15:35,340
I thought was funny Toy Story remote

412
00:15:35,340 --> 00:15:36,420
code remote

413
00:15:36,420 --> 00:15:40,230
fine but that's the actual command and

414
00:15:40,230 --> 00:15:41,760
we'll see we're gonna show you so I put

415
00:15:41,760 --> 00:15:43,860
Tori XE on a remote art on the target

416
00:15:43,860 --> 00:15:46,620
right I put in a system32 this is

417
00:15:46,620 --> 00:15:47,760
horrible tradecraft I would never

418
00:15:47,760 --> 00:15:49,470
actually do this things I would do

419
00:15:49,470 --> 00:15:51,450
instead would be to look what's there

420
00:15:51,450 --> 00:15:53,310
already and then I would add a 32 at the

421
00:15:53,310 --> 00:15:55,350
end of it I would time stop it probably

422
00:15:55,350 --> 00:15:57,990
I would time stomp another excusable or

423
00:15:57,990 --> 00:16:00,030
DL whatever I put in there and it would

424
00:16:00,030 --> 00:16:00,990
get it would give it the same time

425
00:16:00,990 --> 00:16:02,400
because everyone right as soon as your

426
00:16:02,400 --> 00:16:03,840
starts acting up first thing you do is

427
00:16:03,840 --> 00:16:05,610
you know task manager whatever look at

428
00:16:05,610 --> 00:16:07,290
the time what's the most recent delete

429
00:16:07,290 --> 00:16:09,540
that that when this would get rid of

430
00:16:09,540 --> 00:16:13,440
that right so told IX e it's on the

431
00:16:13,440 --> 00:16:18,720
target so in this video I'm going to we

432
00:16:18,720 --> 00:16:20,070
make a shell so I'm on the dot 12

433
00:16:20,070 --> 00:16:22,410
currently as administrator of the system

434
00:16:22,410 --> 00:16:23,580
I've already compromised it's called

435
00:16:23,580 --> 00:16:27,060
Batman and first I'm going to remote

436
00:16:27,060 --> 00:16:29,880
derp I'm a remote during the target to

437
00:16:29,880 --> 00:16:31,080
see that the file is actually there

438
00:16:31,080 --> 00:16:34,080
because I don't want to use women and it

439
00:16:34,080 --> 00:16:35,910
possibly got deleted already or they

440
00:16:35,910 --> 00:16:38,700
knew or maybe I lost the beacon or a

441
00:16:38,700 --> 00:16:41,490
shell to that target and then I just

442
00:16:41,490 --> 00:16:43,230
want to call it again to interact with

443
00:16:43,230 --> 00:16:45,150
it because I need something off of it so

444
00:16:45,150 --> 00:16:47,220
I go through I dropped everything on

445
00:16:47,220 --> 00:16:49,770
system 32 right there yep there it is

446
00:16:49,770 --> 00:16:51,890
cool I know

447
00:16:51,890 --> 00:16:54,330
and then um I'm gonna go and I'm gonna

448
00:16:54,330 --> 00:16:57,600
do the command which I do you like shell

449
00:16:57,600 --> 00:17:00,740
women space node node I'm gonna classify

450
00:17:00,740 --> 00:17:04,380
the target IP address right and so I'm

451
00:17:04,380 --> 00:17:06,990
gonna come up with a second you can see

452
00:17:06,990 --> 00:17:08,280
I'm on the dot 12 sigh peas are

453
00:17:08,280 --> 00:17:09,780
important so the beacons are up top

454
00:17:09,780 --> 00:17:12,210
let me see they're compromised so

455
00:17:12,210 --> 00:17:14,069
specify and I want to go to the dot

456
00:17:14,069 --> 00:17:17,250
eight and I'm calling on that executable

457
00:17:17,250 --> 00:17:20,780
that's in the system 32 directory

458
00:17:28,339 --> 00:17:31,649
something to point out so I said this as

459
00:17:31,649 --> 00:17:35,399
an SMB beacon and does anybody know why

460
00:17:35,399 --> 00:17:37,379
I would do an S so not AIT's a domain

461
00:17:37,379 --> 00:17:38,879
controller so here's a question I guess

462
00:17:38,879 --> 00:17:41,129
I give stuff out for right does anybody

463
00:17:41,129 --> 00:17:45,360
know why I would use SMB beacon instead

464
00:17:45,360 --> 00:17:50,100
of a beacon on for 80 or 443 on a domain

465
00:17:50,100 --> 00:17:55,980
controller go ahead exactly yeah give

466
00:17:55,980 --> 00:17:58,919
you give him a book yeah I'll get to you

467
00:17:58,919 --> 00:18:00,359
later that actually we'll keep talking

468
00:18:00,359 --> 00:18:03,210
so I'm not walking around sorry but uh

469
00:18:03,210 --> 00:18:05,100
yeah so like I did you make controller

470
00:18:05,100 --> 00:18:06,899
you don't see traffic on you know 80 or

471
00:18:06,899 --> 00:18:08,909
443 likewise it's too sad talking out on

472
00:18:08,909 --> 00:18:10,980
domain controller y'see why is he

473
00:18:10,980 --> 00:18:12,749
talking to the system's like any blue

474
00:18:12,749 --> 00:18:14,999
team or network admin would see that

475
00:18:14,999 --> 00:18:16,230
traffic and like something's wrong with

476
00:18:16,230 --> 00:18:17,909
their domain controller we we need to do

477
00:18:17,909 --> 00:18:20,639
something awesome I call bat game I was

478
00:18:20,639 --> 00:18:22,169
explaining that so you see dot eight I

479
00:18:22,169 --> 00:18:24,269
had a link to it so it's just there it's

480
00:18:24,269 --> 00:18:25,980
a binding SMD beacon so I actually have

481
00:18:25,980 --> 00:18:29,070
to link to the target to get access so

482
00:18:29,070 --> 00:18:31,649
if I do four for three like reverse TCP

483
00:18:31,649 --> 00:18:34,409
or 80 it'll it'll actually call back to

484
00:18:34,409 --> 00:18:35,850
me I'll immediately get the beacon

485
00:18:35,850 --> 00:18:38,639
because I did SMB it's binding and I

486
00:18:38,639 --> 00:18:40,409
think I did a random high port yeah five

487
00:18:40,409 --> 00:18:42,509
five six five five so the traffic's

488
00:18:42,509 --> 00:18:45,929
normal on that network so no no it's a

489
00:18:45,929 --> 00:18:47,279
little reason like like my twitter

490
00:18:47,279 --> 00:18:48,809
handle sleep zero which I got because I

491
00:18:48,809 --> 00:18:50,669
did that a lot and I got in trouble for

492
00:18:50,669 --> 00:18:53,429
it because I'm I'm super I just like

493
00:18:53,429 --> 00:18:54,600
getting things done and going through

494
00:18:54,600 --> 00:18:56,999
and you're sleeping you're jitter you

495
00:18:56,999 --> 00:18:58,559
have to space that out as well which

496
00:18:58,559 --> 00:19:00,749
sleep is how many seconds until it calls

497
00:19:00,749 --> 00:19:02,940
back jitter is plus or minus a second so

498
00:19:02,940 --> 00:19:05,820
like a good thing to do you know set

499
00:19:05,820 --> 00:19:07,619
your sleep to 10 minutes jitter to 10

500
00:19:07,619 --> 00:19:10,100
minutes some still pretty short but I

501
00:19:10,100 --> 00:19:12,480
always keep things short normally I want

502
00:19:12,480 --> 00:19:14,639
to do this stuff so now that'll do 10

503
00:19:14,639 --> 00:19:16,080
minutes plus or minus anytime between

504
00:19:16,080 --> 00:19:18,710
the next 10 minutes

505
00:19:21,130 --> 00:19:23,530
I next run a few more ways of remote

506
00:19:23,530 --> 00:19:25,750
code execution just one of the preface

507
00:19:25,750 --> 00:19:27,100
like what we're going through these

508
00:19:27,100 --> 00:19:29,440
three types is because we just wanna

509
00:19:29,440 --> 00:19:31,060
show you the first two ways you know who

510
00:19:31,060 --> 00:19:31,360
we were

511
00:19:31,360 --> 00:19:33,280
we got the privilege escalation and now

512
00:19:33,280 --> 00:19:34,270
we're taking advantage that pretty late

513
00:19:34,270 --> 00:19:37,660
so the second day we're gonna do is a

514
00:19:37,660 --> 00:19:40,930
schedule and a score a remote system so

515
00:19:40,930 --> 00:19:42,880
the first the first line up there is a

516
00:19:42,880 --> 00:19:44,650
sketch - slash create this is obviously

517
00:19:44,650 --> 00:19:46,570
creating your task a slash Tina's gonna

518
00:19:46,570 --> 00:19:49,630
be your task name my partner made this

519
00:19:49,630 --> 00:19:50,860
slide as you can tell because it's Matt

520
00:19:50,860 --> 00:19:54,340
dot exe the tab /tr is gonna be the task

521
00:19:54,340 --> 00:19:56,380
what you actually want to run Matt dot

522
00:19:56,380 --> 00:20:00,070
exe and then that's gonna see when you

523
00:20:00,070 --> 00:20:01,180
want to run it you want to run it once

524
00:20:01,180 --> 00:20:03,070
do you want to want it on idle on

525
00:20:03,070 --> 00:20:04,720
startup there's many ways you can

526
00:20:04,720 --> 00:20:06,490
specify so you can use this as a method

527
00:20:06,490 --> 00:20:08,140
of privilege escalation I mean uh

528
00:20:08,140 --> 00:20:11,350
persistent or lateral movement so the

529
00:20:11,350 --> 00:20:12,910
second command is gonna be us kicking

530
00:20:12,910 --> 00:20:14,980
off so the reasons we note I'm specified

531
00:20:14,980 --> 00:20:17,380
once because seasonless for a lateral

532
00:20:17,380 --> 00:20:18,970
movement so we're gonna kick it off get

533
00:20:18,970 --> 00:20:21,070
our stuff one time and then we're gonna

534
00:20:21,070 --> 00:20:23,470
go in and delete it because or what we

535
00:20:23,470 --> 00:20:25,090
want to use it for that's proper

536
00:20:25,090 --> 00:20:26,110
tradecraft you don't want to leave a

537
00:20:26,110 --> 00:20:28,360
task schedule you can easily clear that

538
00:20:28,360 --> 00:20:33,130
as a set so as I went over the first

539
00:20:33,130 --> 00:20:34,480
command this is us actually going

540
00:20:34,480 --> 00:20:37,990
through creating the task itself tilde

541
00:20:37,990 --> 00:20:40,330
XE is the executor we want to call we're

542
00:20:40,330 --> 00:20:42,160
utilizing the same executable that we

543
00:20:42,160 --> 00:20:44,560
use in our last video like I said we're

544
00:20:44,560 --> 00:20:46,390
gonna do it once and start calm if

545
00:20:46,390 --> 00:20:47,950
you're only doing it once don't specify

546
00:20:47,950 --> 00:20:49,840
the time because in the beginning we

547
00:20:49,840 --> 00:20:51,520
specify the time it air it out like

548
00:20:51,520 --> 00:20:54,550
three or four times so we learned that

549
00:20:54,550 --> 00:20:55,750
and then we're gonna run this under

550
00:20:55,750 --> 00:20:57,970
system so we can run this a system

551
00:20:57,970 --> 00:20:59,950
because gives us privilege escalation

552
00:20:59,950 --> 00:21:02,140
and lateral moving onto a target box it

553
00:21:02,140 --> 00:21:05,280
completes multiple goals at once

554
00:21:10,570 --> 00:21:12,830
this is us kicking kicking it off

555
00:21:12,830 --> 00:21:15,799
ourselves the task one arad the name of

556
00:21:15,799 --> 00:21:17,960
the task we created and then we want to

557
00:21:17,960 --> 00:21:28,370
run it on the dot eight yes that means

558
00:21:28,370 --> 00:21:30,440
it executes immediately once we tell it

559
00:21:30,440 --> 00:21:33,410
to so there is there is no time there's

560
00:21:33,410 --> 00:21:35,030
no time it's just we have to add the

561
00:21:35,030 --> 00:21:36,230
flag because when we weren't having the

562
00:21:36,230 --> 00:21:37,820
flag it air it out so we wouldn't had

563
00:21:37,820 --> 00:21:39,410
the start time flag we've read up on a

564
00:21:39,410 --> 00:21:41,540
little bit more and when we realize that

565
00:21:41,540 --> 00:21:44,570
if we don't specify time we executed

566
00:21:44,570 --> 00:21:46,250
ourselves that gives us the ability to

567
00:21:46,250 --> 00:21:53,120
an older systems easties at a lot okay

568
00:21:53,120 --> 00:21:55,370
as you see we're on the dot eight use

569
00:21:55,370 --> 00:21:57,950
their system so that's we're running as

570
00:21:57,950 --> 00:22:00,470
in one computer Joker as you steal the

571
00:22:00,470 --> 00:22:02,480
enumeration command it gives you the

572
00:22:02,480 --> 00:22:03,950
process idea we're running under so if

573
00:22:03,950 --> 00:22:05,179
you have to kill it at some point we can

574
00:22:05,179 --> 00:22:08,110
and it s to be linked so obviously had

575
00:22:08,110 --> 00:22:10,340
linked to it ourselves cool thing about

576
00:22:10,340 --> 00:22:13,250
SMB links is the traffic is only to the

577
00:22:13,250 --> 00:22:15,650
SMB link when you decide it to so say

578
00:22:15,650 --> 00:22:18,020
you have your callback here are HTTP

579
00:22:18,020 --> 00:22:19,940
callback set to ten minutes that will

580
00:22:19,940 --> 00:22:22,040
call back every 10 minutes but unless

581
00:22:22,040 --> 00:22:23,960
we're interacting with the SMB beacon it

582
00:22:23,960 --> 00:22:26,210
will not call back at all it'll just

583
00:22:26,210 --> 00:22:27,470
wait it's just waiting for us to tell

584
00:22:27,470 --> 00:22:27,950
what to do

585
00:22:27,950 --> 00:22:29,540
waiting for us to send it instructions

586
00:22:29,540 --> 00:22:31,580
it's not constantly hitting our machine

587
00:22:31,580 --> 00:22:35,570
back the next day we're gonna do it is a

588
00:22:35,570 --> 00:22:39,140
service create or SC the first command

589
00:22:39,140 --> 00:22:40,880
up there like our last prod this is

590
00:22:40,880 --> 00:22:42,710
going to be service create a target you

591
00:22:42,710 --> 00:22:45,290
want to go to we're creating mat again

592
00:22:45,290 --> 00:22:47,929
and the Bionic path is the path to our

593
00:22:47,929 --> 00:22:51,710
executable and then we're gonna kick off

594
00:22:51,710 --> 00:22:53,870
the service ourself but for time of the

595
00:22:53,870 --> 00:22:56,000
video and then delete it off the target

596
00:22:56,000 --> 00:22:57,590
so like I said in the beginning tie it

597
00:22:57,590 --> 00:23:00,500
back to the net start command it run

598
00:23:00,500 --> 00:23:02,570
don't start up this would pop up it's a

599
00:23:02,570 --> 00:23:03,950
service that's starting with a box

600
00:23:03,950 --> 00:23:05,780
originally turned off so if you want to

601
00:23:05,780 --> 00:23:07,850
use it for persistence box turns on

602
00:23:07,850 --> 00:23:09,799
service is created hey we got our

603
00:23:09,799 --> 00:23:12,250
callback at the beginning of the day

604
00:23:12,250 --> 00:23:14,980
that's so it's not catching our listener

605
00:23:14,980 --> 00:23:20,950
for me this is the video example um

606
00:23:20,950 --> 00:23:22,330
we're gonna go in I'll create the

607
00:23:22,330 --> 00:23:22,900
service

608
00:23:22,900 --> 00:23:25,870
god I love baby turtles because we're

609
00:23:25,870 --> 00:23:28,360
still using our turtle executable I

610
00:23:28,360 --> 00:23:31,480
believe in this video we do actually

611
00:23:31,480 --> 00:23:35,460
change the path to the temp directory

612
00:23:38,700 --> 00:23:41,020
the reason we use the temp directory is

613
00:23:41,020 --> 00:23:43,390
because when you log long temp directory

614
00:23:43,390 --> 00:23:45,280
stood up and at the bar when the box is

615
00:23:45,280 --> 00:23:47,500
like rebooted turned off you log off for

616
00:23:47,500 --> 00:23:49,930
the day that's just gonna be gonna be

617
00:23:49,930 --> 00:23:51,190
wiped clean that's good

618
00:23:51,190 --> 00:23:52,390
that's just good for tradecraft because

619
00:23:52,390 --> 00:23:53,830
say you know you've always been on a

620
00:23:53,830 --> 00:23:56,320
bike as red tee box before or you don't

621
00:23:56,320 --> 00:23:58,210
take all your artifacts all you don't do

622
00:23:58,210 --> 00:23:59,560
go through every single process of

623
00:23:59,560 --> 00:24:02,080
cleanup and oops I've started a service

624
00:24:02,080 --> 00:24:04,510
I left it on the Box my ex sees in the

625
00:24:04,510 --> 00:24:05,890
Box what do I do

626
00:24:05,890 --> 00:24:08,110
oh it's in the directory you log off it

627
00:24:08,110 --> 00:24:10,390
cya so it does it for you you don't have

628
00:24:10,390 --> 00:24:13,960
to actually go and do it yourself create

629
00:24:13,960 --> 00:24:16,180
our service I love baby turtles up in

630
00:24:16,180 --> 00:24:21,940
path windows temp turtle exe we're very

631
00:24:21,940 --> 00:24:29,320
impatient so to see the certs created

632
00:24:29,320 --> 00:24:32,650
before you go and run yeah creation

633
00:24:32,650 --> 00:24:34,690
success before you can go and kick it

634
00:24:34,690 --> 00:24:36,340
off yourself so we're just sitting there

635
00:24:36,340 --> 00:24:52,030
like Twitter and say that here so this

636
00:24:52,030 --> 00:24:53,320
is our command to actually go kick it

637
00:24:53,320 --> 00:24:57,400
off right all the target target start

638
00:24:57,400 --> 00:24:59,500
this Turtles because that's what we

639
00:24:59,500 --> 00:25:02,890
named this time we were pretty pretty

640
00:25:02,890 --> 00:25:05,620
you know quick to the bleep up up to our

641
00:25:05,620 --> 00:25:12,690
first we were actually so quick quick

642
00:25:12,690 --> 00:25:14,920
the service we try to link to it three

643
00:25:14,920 --> 00:25:17,140
times it didn't work fourth time the

644
00:25:17,140 --> 00:25:19,030
service actually kicked off and running

645
00:25:19,030 --> 00:25:21,190
on the machine so you see the child

646
00:25:21,190 --> 00:25:23,920
beacon there's our system callback on

647
00:25:23,920 --> 00:25:25,630
the domain controller and there's our

648
00:25:25,630 --> 00:25:27,809
process ID at the top right

649
00:25:27,809 --> 00:25:30,570
and just to prove it to well now we're

650
00:25:30,570 --> 00:25:32,669
going that's just to prove that target

651
00:25:32,669 --> 00:25:34,590
machine for dual even very last we're

652
00:25:34,590 --> 00:25:36,049
gonna go in and we're gonna delete of

653
00:25:36,049 --> 00:25:39,719
service I love baby turtles just so no

654
00:25:39,719 --> 00:25:41,190
one can see that when they're running

655
00:25:41,190 --> 00:25:45,179
start on the box so like we said before

656
00:25:45,179 --> 00:25:46,859
we're not gonna do all about strike

657
00:25:46,859 --> 00:25:48,509
we're gonna do different c2 because we

658
00:25:48,509 --> 00:25:50,340
know some people don't use that some

659
00:25:50,340 --> 00:25:52,710
people use interpreter because it's free

660
00:25:52,710 --> 00:25:56,249
open source so we're gonna do a PS exec

661
00:25:56,249 --> 00:25:58,259
which is nice because most of what we're

662
00:25:58,259 --> 00:26:00,779
doing is already built into Windows or

663
00:26:00,779 --> 00:26:02,969
part of a system kernel suite so it's

664
00:26:02,969 --> 00:26:08,609
Windows sign execute how to use that via

665
00:26:08,609 --> 00:26:11,759
interpreter to move to a target on the

666
00:26:11,759 --> 00:26:20,279
Box SMB

667
00:26:20,279 --> 00:26:22,979
PS exec one thing to do with meterpreter

668
00:26:22,979 --> 00:26:24,719
I really like is your show options it's

669
00:26:24,719 --> 00:26:26,399
gonna tell you what you need what you

670
00:26:26,399 --> 00:26:29,429
want to add so it already has four four

671
00:26:29,429 --> 00:26:31,200
five because that's what pas exec works

672
00:26:31,200 --> 00:26:36,299
with we set the our host wrong the first

673
00:26:36,299 --> 00:26:39,419
time we were gonna target our own box so

674
00:26:39,419 --> 00:26:40,830
that's why we like to have that in the

675
00:26:40,830 --> 00:26:43,559
beginning of the talk I type that he is

676
00:26:43,559 --> 00:26:45,539
the one who typed that and then so you

677
00:26:45,539 --> 00:26:47,519
don't have to use the username and

678
00:26:47,519 --> 00:26:50,129
password but we're just we had it so at

679
00:26:50,129 --> 00:26:53,399
this point why not use it show options

680
00:26:53,399 --> 00:26:55,049
because sometimes not everything is

681
00:26:55,049 --> 00:26:56,549
gonna populate for you so show options

682
00:26:56,549 --> 00:26:58,830
before you exploit it so you know it's

683
00:26:58,830 --> 00:27:00,479
gonna run properly and everything is

684
00:27:00,479 --> 00:27:03,440
populated you can type run or X

685
00:27:03,440 --> 00:27:06,839
accomplish the same task within as you

686
00:27:06,839 --> 00:27:12,589
see don't use port four four four four

687
00:27:12,589 --> 00:27:15,299
we didn't change it because this is a

688
00:27:15,299 --> 00:27:17,759
demonstration video but do not use that

689
00:27:17,759 --> 00:27:18,089
port

690
00:27:18,089 --> 00:27:20,489
it's what meterpreter uses by default

691
00:27:20,489 --> 00:27:23,190
obviously it's terrible tradecraft

692
00:27:23,190 --> 00:27:25,739
as you see our session is open well

693
00:27:25,739 --> 00:27:27,359
connected to the dot eight there's the

694
00:27:27,359 --> 00:27:28,559
port that it touches on the dot eight

695
00:27:28,559 --> 00:27:30,599
and just for a proof of concept where

696
00:27:30,599 --> 00:27:33,029
you get UID or system we went in the

697
00:27:33,029 --> 00:27:34,799
shell so we're in action with the box of

698
00:27:34,799 --> 00:27:37,169
the man shell we have the host name and

699
00:27:37,169 --> 00:27:39,450
so just proof of concept we are on that

700
00:27:39,450 --> 00:27:42,169
target from our dot six

701
00:27:42,169 --> 00:27:45,539
all right so when are M another way to

702
00:27:45,539 --> 00:27:48,240
loudly move it so from those two ports

703
00:27:48,240 --> 00:27:51,240
of five nine eight five and five 986 I'm

704
00:27:51,240 --> 00:27:52,409
a nine eight six is encrypted

705
00:27:52,409 --> 00:27:55,110
you can send encrypted traffic over five

706
00:27:55,110 --> 00:27:56,789
nine eighty five a lot of people argue

707
00:27:56,789 --> 00:27:58,530
that randomly for some reason that's

708
00:27:58,530 --> 00:28:01,710
great knowledge to have I guess and so

709
00:28:01,710 --> 00:28:04,950
Windows Server 2008 wrs right windows

710
00:28:04,950 --> 00:28:05,640
remote shell

711
00:28:05,640 --> 00:28:07,770
there's command at the bottom we don't

712
00:28:07,770 --> 00:28:09,240
have an example or a video example from

713
00:28:09,240 --> 00:28:11,429
one to win RM but I love I love this uh

714
00:28:11,429 --> 00:28:13,200
this I'm a meme I asked you to save your

715
00:28:13,200 --> 00:28:15,840
picture but 106 Windows Server security

716
00:28:15,840 --> 00:28:19,080
keep out or enter I'm signing out of cop

717
00:28:19,080 --> 00:28:23,960
it's very true it makes me happy alright

718
00:28:23,960 --> 00:28:26,250
so remote registry this is another way

719
00:28:26,250 --> 00:28:27,870
to establish persistence and move

720
00:28:27,870 --> 00:28:29,760
laterally right and we're actually going

721
00:28:29,760 --> 00:28:33,090
to create a registry key remotely to the

722
00:28:33,090 --> 00:28:34,200
target and then we're going to kick it

723
00:28:34,200 --> 00:28:35,940
off by rebooting it you'll see you next

724
00:28:35,940 --> 00:28:38,909
so I put goat exe on the desktop portal

725
00:28:38,909 --> 00:28:40,470
tradecraft let's just say you guys get a

726
00:28:40,470 --> 00:28:42,720
free picture I want to show you and then

727
00:28:42,720 --> 00:28:44,940
um so the services actually has to be

728
00:28:44,940 --> 00:28:46,559
enabled right remote registry that's to

729
00:28:46,559 --> 00:28:48,090
being able and the services for you be

730
00:28:48,090 --> 00:28:50,070
able to do this and there's a dude

731
00:28:50,070 --> 00:28:52,020
running with the register because like

732
00:28:52,020 --> 00:28:54,799
yes okay so we're gonna use meterpreter

733
00:28:54,799 --> 00:28:58,679
alright so so currently a I have a shell

734
00:28:58,679 --> 00:29:00,450
right if you look at it so my attack

735
00:29:00,450 --> 00:29:02,100
platform my attack machine the Kali box

736
00:29:02,100 --> 00:29:04,200
was a dot six I have a shell back from

737
00:29:04,200 --> 00:29:06,659
ten and I believe I'm going after the

738
00:29:06,659 --> 00:29:08,429
dot twelve okay so that's kind of

739
00:29:08,429 --> 00:29:09,710
confusing so I'm dot six

740
00:29:09,710 --> 00:29:11,970
all right this is my shell with the dot

741
00:29:11,970 --> 00:29:14,490
ten and I'm creating a registry key

742
00:29:14,490 --> 00:29:16,710
using the host name Batman and calm

743
00:29:16,710 --> 00:29:19,679
which is the dot twelve okay so I create

744
00:29:19,679 --> 00:29:22,169
the registry key I call it wolf and I'm

745
00:29:22,169 --> 00:29:23,970
calling on goat exe which is on that

746
00:29:23,970 --> 00:29:27,809
desktop and um after I created it asked

747
00:29:27,809 --> 00:29:29,159
me overwrite it because I did the video

748
00:29:29,159 --> 00:29:31,500
like a second time third time make it

749
00:29:31,500 --> 00:29:33,840
pretty and then and then I shut it down

750
00:29:33,840 --> 00:29:35,640
remotely so that's through command

751
00:29:35,640 --> 00:29:39,480
prompt right so you you do shutdown /m

752
00:29:39,480 --> 00:29:41,549
so you're saying the system Batman comm

753
00:29:41,549 --> 00:29:44,159
tech are ft0

754
00:29:44,159 --> 00:29:45,929
so you're saying time now so that's you

755
00:29:45,929 --> 00:29:47,130
restart your box remotely you can do

756
00:29:47,130 --> 00:29:50,190
through PowerShell as well and some of

757
00:29:50,190 --> 00:29:52,860
the box reboots on the target so in the

758
00:29:52,860 --> 00:29:54,210
Box reboots it will actually kick off

759
00:29:54,210 --> 00:29:54,720
the register

760
00:29:54,720 --> 00:29:57,770
key that we just created on it all right

761
00:29:57,770 --> 00:30:00,360
so the registry key stores all you know

762
00:30:00,360 --> 00:30:02,250
windows configurations and stuff and

763
00:30:02,250 --> 00:30:04,080
that's good to know it takes me a second

764
00:30:04,080 --> 00:30:06,059
I'm gonna show you so I kill the

765
00:30:06,059 --> 00:30:07,890
listener and I restart it because I use

766
00:30:07,890 --> 00:30:09,600
the same payload that I originally used

767
00:30:09,600 --> 00:30:11,549
we're just gonna call back 2.6 on the

768
00:30:11,549 --> 00:30:15,150
same port which is dumb but so I did so

769
00:30:15,150 --> 00:30:17,280
I'm waiting for the call back from the

770
00:30:17,280 --> 00:30:19,470
dot 12 so I restart my listener I'm

771
00:30:19,470 --> 00:30:20,580
gonna show you the attack machine and

772
00:30:20,580 --> 00:30:22,650
what the user sees there's like some

773
00:30:22,650 --> 00:30:24,600
people they don't I haven't worked to us

774
00:30:24,600 --> 00:30:26,070
before like what the user doesn't see

775
00:30:26,070 --> 00:30:29,070
anything there's a crazy pop-up reliable

776
00:30:29,070 --> 00:30:32,610
movement and there's not so user go die

777
00:30:32,610 --> 00:30:34,320
you see and watch the other side you're

778
00:30:34,320 --> 00:30:37,289
gonna see my shell pop and it should be

779
00:30:37,289 --> 00:30:43,250
for the dot 12 boom and there it is

780
00:30:43,250 --> 00:30:50,669
yeah thanks Goods 6 is exciting when I

781
00:30:50,669 --> 00:30:52,919
happens when a row operation it's super

782
00:30:52,919 --> 00:30:59,159
funny and yeah gives you that high yeah

783
00:30:59,159 --> 00:31:00,750
this is me showing you that's 2.12 on

784
00:31:00,750 --> 00:31:01,950
the target that's what the user sees

785
00:31:01,950 --> 00:31:03,799
nothing happened I'm gonna do they're

786
00:31:03,799 --> 00:31:05,070
cool

787
00:31:05,070 --> 00:31:08,340
so decom I'm not the subject matter

788
00:31:08,340 --> 00:31:10,380
expert on this but I didn't feel like it

789
00:31:10,380 --> 00:31:12,240
was okay for me to do this talk without

790
00:31:12,240 --> 00:31:15,059
mentioning it Matt Nelson document in it

791
00:31:15,059 --> 00:31:17,340
and there's a lot of resources out there

792
00:31:17,340 --> 00:31:19,169
and it's it's really awesome and it's

793
00:31:19,169 --> 00:31:21,299
pretty recent but I'm not gonna try to

794
00:31:21,299 --> 00:31:22,770
pretend you like I'm smart enough to

795
00:31:22,770 --> 00:31:30,059
explain it really detailed alright so

796
00:31:30,059 --> 00:31:31,890
next up we're going into me me cats I'm

797
00:31:31,890 --> 00:31:33,510
sure like everyone in the blue world in

798
00:31:33,510 --> 00:31:35,309
red world has heard of me me cats a

799
00:31:35,309 --> 00:31:36,419
certain point in their career whether

800
00:31:36,419 --> 00:31:39,030
they're doing with HP SS AV or it is

801
00:31:39,030 --> 00:31:42,240
theirs we're through a method of being

802
00:31:42,240 --> 00:31:45,030
able to run me me cats and utilize us

803
00:31:45,030 --> 00:31:47,490
without having to put the executable on

804
00:31:47,490 --> 00:31:49,980
the target box itself and so nothing

805
00:31:49,980 --> 00:31:51,960
will flag we're just using like I said

806
00:31:51,960 --> 00:31:55,530
before Windows one asana executables to

807
00:31:55,530 --> 00:31:57,299
accomplish our goal so in the top left

808
00:31:57,299 --> 00:32:00,720
you're gonna see praça dos an exe so

809
00:32:00,720 --> 00:32:02,159
process something else apps because the

810
00:32:02,159 --> 00:32:03,809
vectors would me me Cass is gonna take

811
00:32:03,809 --> 00:32:07,090
advantage of you see our profile

812
00:32:07,090 --> 00:32:08,590
top left that's what we're moving like

813
00:32:08,590 --> 00:32:10,600
the target the dump is the mini dump

814
00:32:10,600 --> 00:32:12,460
that's the result of the target and then

815
00:32:12,460 --> 00:32:16,600
me me cats exe is being ran on our

816
00:32:16,600 --> 00:32:18,520
windows attack platform on the right

817
00:32:18,520 --> 00:32:20,650
hand side it within command line and the

818
00:32:20,650 --> 00:32:22,990
result is gonna be the clear text

819
00:32:22,990 --> 00:32:26,260
passwords sha-1 hashes and in Salem

820
00:32:26,260 --> 00:32:30,330
hashes ask to reboot me and actually

821
00:32:30,330 --> 00:32:32,610
kind of like our first test together

822
00:32:32,610 --> 00:32:34,900
this one our first test together and he

823
00:32:34,900 --> 00:32:37,900
kinda has a story that will explain more

824
00:32:37,900 --> 00:32:40,900
on what happens with me so it's a real

825
00:32:40,900 --> 00:32:42,370
real world example it was really cool

826
00:32:42,370 --> 00:32:44,050
first time I got to main admin I'll

827
00:32:44,050 --> 00:32:46,060
never forget and it was utilizing this

828
00:32:46,060 --> 00:32:49,690
and a target it was a file server so I

829
00:32:49,690 --> 00:32:51,490
got default creds I knew would work I

830
00:32:51,490 --> 00:32:52,060
got in the system

831
00:32:52,060 --> 00:32:53,500
I saw a file server that hadn't been

832
00:32:53,500 --> 00:32:55,840
restarted and probably like a year and

833
00:32:55,840 --> 00:32:58,480
then I brought I knew that domain admin

834
00:32:58,480 --> 00:33:00,100
most likely logged in that file server

835
00:33:00,100 --> 00:33:01,720
right so there's this creds are stored

836
00:33:01,720 --> 00:33:03,760
in there in the else ass I couldn't get

837
00:33:03,760 --> 00:33:05,080
a remote code execution like we were

838
00:33:05,080 --> 00:33:06,370
showing stuff earlier I couldn't get

839
00:33:06,370 --> 00:33:06,940
that working

840
00:33:06,940 --> 00:33:09,670
so I actually already peed through RDP

841
00:33:09,670 --> 00:33:11,890
just pretty crazy

842
00:33:11,890 --> 00:33:14,680
I thought I was really dumb and I was

843
00:33:14,680 --> 00:33:16,270
just like I'm gonna do it when I waited

844
00:33:16,270 --> 00:33:18,010
till the guy was with wasn't sitting

845
00:33:18,010 --> 00:33:19,290
next to me because it was embarrassing

846
00:33:19,290 --> 00:33:22,450
but I already p3 RDP and I'm at my share

847
00:33:22,450 --> 00:33:25,030
and then a proc dump is the windows

848
00:33:25,030 --> 00:33:26,470
you know it's windows sign so it's not

849
00:33:26,470 --> 00:33:29,470
gonna flag and I moved proc them onto

850
00:33:29,470 --> 00:33:31,720
the target machine the file server ran

851
00:33:31,720 --> 00:33:34,360
again CL SAS created my mini dump file

852
00:33:34,360 --> 00:33:36,460
right I pulled it off the target and

853
00:33:36,460 --> 00:33:39,010
went back through RDP sessions through

854
00:33:39,010 --> 00:33:41,560
the shares and a pulled it back to my

855
00:33:41,560 --> 00:33:44,230
box and I sat there for three hours

856
00:33:44,230 --> 00:33:47,050
and realized I kept running a mini dumb

857
00:33:47,050 --> 00:33:49,030
against dump file I had to get the

858
00:33:49,030 --> 00:33:50,410
credits and three hours went by and I

859
00:33:50,410 --> 00:33:52,810
couldn't get it working in architecture

860
00:33:52,810 --> 00:33:55,000
matters on the target and I didn't

861
00:33:55,000 --> 00:33:56,830
realized that it was an x86 target and I

862
00:33:56,830 --> 00:33:59,380
had a 64 Cali attack platform so I

863
00:33:59,380 --> 00:34:01,300
actually had to move the dump file to

864
00:34:01,300 --> 00:34:04,840
x86 machine I just did XP I think and

865
00:34:04,840 --> 00:34:07,330
then I ran me cats against it and got

866
00:34:07,330 --> 00:34:09,280
clear text cries this is my first domain

867
00:34:09,280 --> 00:34:11,370
admin it's free it's free awesome

868
00:34:11,370 --> 00:34:13,799
alright

869
00:34:13,799 --> 00:34:16,409
so responder so you can't you can't not

870
00:34:16,409 --> 00:34:17,699
talk about responder with lateral

871
00:34:17,699 --> 00:34:20,639
movement it's an amazing tool and it

872
00:34:20,639 --> 00:34:23,309
blew my mind for some I use it my first

873
00:34:23,309 --> 00:34:25,529
Python script I made I actually

874
00:34:25,529 --> 00:34:28,168
automated a post or blog by a bike

875
00:34:28,168 --> 00:34:28,969
leader

876
00:34:28,969 --> 00:34:33,299
it was responder to crack map exact to

877
00:34:33,299 --> 00:34:35,940
Intel relay and I used a PowerShell

878
00:34:35,940 --> 00:34:38,149
one-liner that I appreciated with

879
00:34:38,149 --> 00:34:41,339
invocation I believe which is a great

880
00:34:41,339 --> 00:34:42,389
way to obfuscate your power so am i

881
00:34:42,389 --> 00:34:44,309
right other than your own ways that no

882
00:34:44,309 --> 00:34:47,760
one knows about but so lmn are it's a

883
00:34:47,760 --> 00:34:49,409
link-local multicast name resolution

884
00:34:49,409 --> 00:34:52,879
right mouthful NBT and ask that's some

885
00:34:52,879 --> 00:34:56,339
NetBIOS name server and the the main

886
00:34:56,339 --> 00:34:57,779
difference that you want to get all

887
00:34:57,779 --> 00:35:01,140
those two is NetBIOS name server is ipv4

888
00:35:01,140 --> 00:35:03,569
only and that's really they're pretty

889
00:35:03,569 --> 00:35:07,529
much the same other than that I thought

890
00:35:07,529 --> 00:35:11,099
oh so funny gift no one laughs yeah so

891
00:35:11,099 --> 00:35:14,069
hahaha so this is responded running on a

892
00:35:14,069 --> 00:35:16,589
party network right so I run responder

893
00:35:16,589 --> 00:35:19,130
and I'm gonna show you that on the

894
00:35:19,130 --> 00:35:21,539
target machine that I want he's gonna go

895
00:35:21,539 --> 00:35:23,520
to food food is not an actual network

896
00:35:23,520 --> 00:35:25,650
resource so it's not Gina so when he

897
00:35:25,650 --> 00:35:27,450
queries for when he's like hey I want

898
00:35:27,450 --> 00:35:29,670
food since I'm gonna be running

899
00:35:29,670 --> 00:35:32,160
responder I'm like hey you know that's

900
00:35:32,160 --> 00:35:34,770
you know that's me like come here and

901
00:35:34,770 --> 00:35:36,240
then he'll say here's my hash cuz you

902
00:35:36,240 --> 00:35:37,380
know on the on the network you're not

903
00:35:37,380 --> 00:35:38,400
just passing everything in clear-text

904
00:35:38,400 --> 00:35:40,920
gets an algorithm it's hash you might

905
00:35:40,920 --> 00:35:41,970
not know that I shouldn't assume

906
00:35:41,970 --> 00:35:44,970
everything so I guess through a

907
00:35:44,970 --> 00:35:47,099
algorithm and it creates a hash for the

908
00:35:47,099 --> 00:35:49,799
user and then it actually passes that so

909
00:35:49,799 --> 00:35:50,789
I'm like hey man that's me

910
00:35:50,789 --> 00:35:54,960
boom username hash right just wait you

911
00:35:54,960 --> 00:35:56,190
know wait stop that has to be signing

912
00:35:56,190 --> 00:35:57,720
you can go into that and like everyone's

913
00:35:57,720 --> 00:36:00,359
like yeah sounds awesome but everyone

914
00:36:00,359 --> 00:36:01,920
who has an actual network you know has

915
00:36:01,920 --> 00:36:04,170
legacy systems and you know you need

916
00:36:04,170 --> 00:36:07,200
Samba so you can't really turn on this

917
00:36:07,200 --> 00:36:09,240
to be signing but whatever sounds good

918
00:36:09,240 --> 00:36:12,359
so run figure uh py is and responding uh

919
00:36:12,359 --> 00:36:14,789
tools folder and I'll actually show you

920
00:36:14,789 --> 00:36:17,700
the OS domain and whatnot SP signs on or

921
00:36:17,700 --> 00:36:20,609
off because next time would you after

922
00:36:20,609 --> 00:36:21,750
this I'm gonna show you how multi relay

923
00:36:21,750 --> 00:36:23,640
work so I'm gonna put it all together I

924
00:36:23,640 --> 00:36:25,049
didn't want just talk about responder

925
00:36:25,049 --> 00:36:26,640
not show how to get a shell

926
00:36:26,640 --> 00:36:28,950
utilizing it you can pull that hash from

927
00:36:28,950 --> 00:36:31,230
the previous slide offline and crack it

928
00:36:31,230 --> 00:36:33,660
as well right which everyone loves try

929
00:36:33,660 --> 00:36:34,410
do so

930
00:36:34,410 --> 00:36:36,390
so there's outputs my demon control has

931
00:36:36,390 --> 00:36:38,309
us to be signing on the other two don't

932
00:36:38,309 --> 00:36:41,910
right all right multi relay so we put

933
00:36:41,910 --> 00:36:44,250
this gift because we're you know since

934
00:36:44,250 --> 00:36:44,940
we're doing this talk we're gonna

935
00:36:44,940 --> 00:36:46,230
pretend like this we got on our first

936
00:36:46,230 --> 00:36:48,720
try was not true it took a little bit a

937
00:36:48,720 --> 00:36:50,460
few hours and we realized what we're

938
00:36:50,460 --> 00:36:51,599
doing wrong like what eighty-eights we

939
00:36:51,599 --> 00:36:53,789
were and we got it working so actually

940
00:36:53,789 --> 00:36:56,039
relay your hash is that it collects to a

941
00:36:56,039 --> 00:36:59,369
target to get a shell or you command the

942
00:36:59,369 --> 00:37:02,099
stuff to but this is this is it all

943
00:37:02,099 --> 00:37:04,589
coming together so in the beginning it

944
00:37:04,589 --> 00:37:05,910
happens pretty quickly beginning to see

945
00:37:05,910 --> 00:37:07,710
me edit the responder comm file so the

946
00:37:07,710 --> 00:37:09,539
configuration file for responder right

947
00:37:09,539 --> 00:37:12,869
multi relay uses the SMB and HTTP to

948
00:37:12,869 --> 00:37:14,940
pass the hash so I have to actually turn

949
00:37:14,940 --> 00:37:17,880
HP and SMB off when the responder dot

950
00:37:17,880 --> 00:37:20,309
configuration file so you're gonna see

951
00:37:20,309 --> 00:37:23,970
that so there's a target it's a dot

952
00:37:23,970 --> 00:37:26,519
twelve Batman again and I'm the

953
00:37:26,519 --> 00:37:27,660
administrator on there right so that's

954
00:37:27,660 --> 00:37:29,579
the target and then you'll see I turn

955
00:37:29,579 --> 00:37:32,279
off HP and SMB because I have to use it

956
00:37:32,279 --> 00:37:35,970
for multi relay control ship T and Cali

957
00:37:35,970 --> 00:37:37,349
and the terminal will actually give you

958
00:37:37,349 --> 00:37:39,450
another side terminal like I have super

959
00:37:39,450 --> 00:37:42,119
useful tip I love I don't understand

960
00:37:42,119 --> 00:37:45,119
people that can do a million terminals

961
00:37:45,119 --> 00:37:47,009
so I just do control shift T and go

962
00:37:47,009 --> 00:37:50,099
through it but so a multi relay you can

963
00:37:50,099 --> 00:37:51,539
specify the target so you TAC team the

964
00:37:51,539 --> 00:37:54,029
target you can do a whole you know Class

965
00:37:54,029 --> 00:37:56,250
C or you can specify a whole class C or

966
00:37:56,250 --> 00:37:57,930
you just do one target you can specify

967
00:37:57,930 --> 00:37:59,910
what users that you only want to pass

968
00:37:59,910 --> 00:38:02,700
the hash as as well or so for this one I

969
00:38:02,700 --> 00:38:04,529
did all users I did one target so I'm

970
00:38:04,529 --> 00:38:07,470
saying any user that passes a hash on

971
00:38:07,470 --> 00:38:09,599
this network that is vulnerable to

972
00:38:09,599 --> 00:38:12,029
responder and me poisoning it I'm gonna

973
00:38:12,029 --> 00:38:14,039
patch this target or pass to this target

974
00:38:14,039 --> 00:38:17,309
to get a shell so you'll see me I'm

975
00:38:17,309 --> 00:38:21,029
running on the interface I'm listening

976
00:38:21,029 --> 00:38:22,769
I think for this one I did hi everyone

977
00:38:22,769 --> 00:38:25,069
so you trying to access the network

978
00:38:25,069 --> 00:38:28,319
network resource that's not there so hi

979
00:38:28,319 --> 00:38:32,759
everyone okay the responder runs there's

980
00:38:32,759 --> 00:38:36,460
there's my shell yeah all right

981
00:38:36,460 --> 00:38:38,710
anyways you need a bunch with it at that

982
00:38:38,710 --> 00:38:40,390
point you can pass off to mature pure

983
00:38:40,390 --> 00:38:42,610
COBOL strike wherever you want it's a

984
00:38:42,610 --> 00:38:47,950
really useful next we're gonna go over a

985
00:38:47,950 --> 00:38:50,080
or for this is a good way to kind of

986
00:38:50,080 --> 00:38:51,940
obfuscate your traffic right port

987
00:38:51,940 --> 00:38:53,170
forwarding for the most part is

988
00:38:53,170 --> 00:38:54,670
funneling your traffic through a

989
00:38:54,670 --> 00:38:56,290
callback you already have so no one will

990
00:38:56,290 --> 00:38:58,480
see your attack platform so like we've

991
00:38:58,480 --> 00:39:00,430
been doing we have our attack at dot six

992
00:39:00,430 --> 00:39:01,870
is our attack platform we're gonna be

993
00:39:01,870 --> 00:39:03,520
following through either the dot 12.10

994
00:39:03,520 --> 00:39:05,290
Hyundai eight to get to another one of

995
00:39:05,290 --> 00:39:07,150
those boxes on the network so they can't

996
00:39:07,150 --> 00:39:09,280
see our any of the traffic from our dot

997
00:39:09,280 --> 00:39:11,230
six originally the different types are

998
00:39:11,230 --> 00:39:15,430
SSH Metasploit P link proxy chains about

999
00:39:15,430 --> 00:39:18,340
today are waiting proxy chains because

1000
00:39:18,340 --> 00:39:20,140
there's a two of the most common SI toos

1001
00:39:20,140 --> 00:39:23,440
that we see out there okay poor form of

1002
00:39:23,440 --> 00:39:25,420
socks or your see on the right is there

1003
00:39:25,420 --> 00:39:26,710
is a follow you have to edit on your

1004
00:39:26,710 --> 00:39:28,930
cally box it's a proxy chance comm

1005
00:39:28,930 --> 00:39:30,400
you're gonna have to make sure that the

1006
00:39:30,400 --> 00:39:32,560
IP is your host box if it matches up

1007
00:39:32,560 --> 00:39:33,970
with the port that you're gonna create

1008
00:39:33,970 --> 00:39:35,100
the socks proxy lon

1009
00:39:35,100 --> 00:39:37,600
within COBOL strike so as you see we

1010
00:39:37,600 --> 00:39:40,480
have port 8000 in our project news file

1011
00:39:40,480 --> 00:39:44,650
port 8000 Sox command on cobalt strike

1012
00:39:44,650 --> 00:39:46,630
just to demonstrate this is a quick

1013
00:39:46,630 --> 00:39:48,100
video we're just gonna do it in map skin

1014
00:39:48,100 --> 00:39:49,960
so proxy chains you have to type that

1015
00:39:49,960 --> 00:39:51,490
before you want to do the command and

1016
00:39:51,490 --> 00:39:52,780
the traffic you want to funnel through

1017
00:39:52,780 --> 00:39:54,670
your beacon so we're gonna do in map

1018
00:39:54,670 --> 00:39:56,860
we're gonna scan a target that we don't

1019
00:39:56,860 --> 00:39:59,230
have a beacon on through and push that

1020
00:39:59,230 --> 00:40:00,190
traffic through the beacon

1021
00:40:00,190 --> 00:40:02,380
so the ports we're just can't forward

1022
00:40:02,380 --> 00:40:08,970
just for demonstration r22 3389 and five

1023
00:40:08,970 --> 00:40:15,910
that's gonna be the target IP open so

1024
00:40:15,910 --> 00:40:19,390
you do get actual results back and um

1025
00:40:19,390 --> 00:40:20,920
one thing I wanna point out from earlier

1026
00:40:20,920 --> 00:40:23,710
I forgot to mention so for responder a

1027
00:40:23,710 --> 00:40:24,490
real life

1028
00:40:24,490 --> 00:40:25,930
instant as well or something and

1029
00:40:25,930 --> 00:40:27,520
companies they'll have switches and

1030
00:40:27,520 --> 00:40:29,260
they'll say for security is enabled and

1031
00:40:29,260 --> 00:40:31,510
we unplugged that Ethernet in a switch

1032
00:40:31,510 --> 00:40:33,640
you know a lockdown which most likely

1033
00:40:33,640 --> 00:40:36,160
probably won't after like three but you

1034
00:40:36,160 --> 00:40:38,020
know if a different device plugs into

1035
00:40:38,020 --> 00:40:39,670
that it'll know but due to MAC address

1036
00:40:39,670 --> 00:40:43,600
right but all in any good operator a

1037
00:40:43,600 --> 00:40:44,890
person has to do or

1038
00:40:44,890 --> 00:40:46,690
hacker whatever you wanna call them they

1039
00:40:46,690 --> 00:40:48,220
just unplug the ethernet from the switch

1040
00:40:48,220 --> 00:40:50,620
plug it into their own laptop

1041
00:40:50,620 --> 00:40:53,470
we run TCP dump for Wireshark clone

1042
00:40:53,470 --> 00:40:56,710
their IP address and MAC address now

1043
00:40:56,710 --> 00:40:58,300
they plug their laptop into the same

1044
00:40:58,300 --> 00:40:59,920
Ethernet port and their that device they

1045
00:40:59,920 --> 00:41:02,110
unplugged and a lot of people that like

1046
00:41:02,110 --> 00:41:04,150
blows their mind there's a lot of places

1047
00:41:04,150 --> 00:41:05,380
where they don't understand that and

1048
00:41:05,380 --> 00:41:07,270
then you run responder so I'm on the

1049
00:41:07,270 --> 00:41:08,590
network now I'm going to responder I'm

1050
00:41:08,590 --> 00:41:09,820
just collecting wherever hash this as

1051
00:41:09,820 --> 00:41:11,650
they go across I wanted to mention that

1052
00:41:11,650 --> 00:41:15,880
grout to earlier like I said the second

1053
00:41:15,880 --> 00:41:17,410
demonstration at 4-4 is gonna be through

1054
00:41:17,410 --> 00:41:20,740
interpreter thing a lot what this is a

1055
00:41:20,740 --> 00:41:22,270
creating your payload from interpreter

1056
00:41:22,270 --> 00:41:24,250
right we used MSF venom of the payload

1057
00:41:24,250 --> 00:41:26,800
of verse TCP d2l host is gonna be your

1058
00:41:26,800 --> 00:41:28,990
attacking host I'm your listening host

1059
00:41:28,990 --> 00:41:30,580
sorry and your output is gonna be

1060
00:41:30,580 --> 00:41:34,440
whatever you want all right

1061
00:41:34,440 --> 00:41:38,470
and then you output that payload to the

1062
00:41:38,470 --> 00:41:40,450
document or the executable name that's

1063
00:41:40,450 --> 00:41:41,890
very important and then you have to make

1064
00:41:41,890 --> 00:41:44,170
sure we did this side by side because we

1065
00:41:44,170 --> 00:41:45,670
started multi handler which is your

1066
00:41:45,670 --> 00:41:48,130
listener all that has to be the same as

1067
00:41:48,130 --> 00:41:49,660
what's in your payload because you will

1068
00:41:49,660 --> 00:41:51,490
not be able uh if they're not the same

1069
00:41:51,490 --> 00:41:53,680
for it not to see my people catch your

1070
00:41:53,680 --> 00:41:58,840
callback once you execute so what we

1071
00:41:58,840 --> 00:42:00,310
showed here is like we'd tie this back

1072
00:42:00,310 --> 00:42:01,750
to physical access so if you have

1073
00:42:01,750 --> 00:42:03,610
stumbling to a computer is very skilled

1074
00:42:03,610 --> 00:42:05,200
to get onto a computer like infiltrates

1075
00:42:05,200 --> 00:42:07,540
the actual company itself we can host a

1076
00:42:07,540 --> 00:42:09,370
payload using Python attack in as a

1077
00:42:09,370 --> 00:42:12,460
module simple HTTP server and what that

1078
00:42:12,460 --> 00:42:14,290
does is it whatever files from the

1079
00:42:14,290 --> 00:42:16,180
directory you run the command so you

1080
00:42:16,180 --> 00:42:19,720
have your insider threat in the network

1081
00:42:19,720 --> 00:42:22,360
browsers to your IP address on that port

1082
00:42:22,360 --> 00:42:24,850
as you see Kathy HD shows up you see the

1083
00:42:24,850 --> 00:42:26,830
get request and they can go to go ahead

1084
00:42:26,830 --> 00:42:30,420
download and execute that on the target

1085
00:42:33,480 --> 00:42:36,070
so so first we're starting a multi

1086
00:42:36,070 --> 00:42:38,290
handler we ran it ran our listener

1087
00:42:38,290 --> 00:42:40,720
executed cat that exe on the target box

1088
00:42:40,720 --> 00:42:42,370
I'll just perfect on Sept it's always

1089
00:42:42,370 --> 00:42:45,340
nice to get UID she'll play my hostname

1090
00:42:45,340 --> 00:42:47,500
just say who you are where you are make

1091
00:42:47,500 --> 00:42:49,090
sure what you're targeting is in scope

1092
00:42:49,090 --> 00:42:51,220
of your assessment and then last is the

1093
00:42:51,220 --> 00:42:52,990
actual getting to the port forward ad so

1094
00:42:52,990 --> 00:42:54,130
you're gonna run the port forward ad

1095
00:42:54,130 --> 00:42:56,080
don't want this within shell run this

1096
00:42:56,080 --> 00:42:57,280
within like your meterpreter session

1097
00:42:57,280 --> 00:42:58,070
itself

1098
00:42:58,070 --> 00:43:01,280
port for Dad you have your L port the

1099
00:43:01,280 --> 00:43:02,930
port you want to go after and then tack

1100
00:43:02,930 --> 00:43:04,670
R is gonna be the host you're trying to

1101
00:43:04,670 --> 00:43:07,520
attack for so we tie this in with that

1102
00:43:07,520 --> 00:43:08,660
scanning we did earlier through our

1103
00:43:08,660 --> 00:43:10,340
socks proxy we saw four four five is

1104
00:43:10,340 --> 00:43:12,710
open so like exploit like a turtle blue

1105
00:43:12,710 --> 00:43:15,200
that that can go after four four four

1106
00:43:15,200 --> 00:43:17,720
five that's how you can get it there

1107
00:43:17,720 --> 00:43:19,280
without seeing it come from our tack box

1108
00:43:19,280 --> 00:43:22,160
itself so you like you could an example

1109
00:43:22,160 --> 00:43:23,480
we just attacking yourself it blows

1110
00:43:23,480 --> 00:43:24,980
people's mind the first time used port

1111
00:43:24,980 --> 00:43:27,290
forwarding I'm a blue my mind where I

1112
00:43:27,290 --> 00:43:30,410
attack the machine I forwarded my port

1113
00:43:30,410 --> 00:43:32,690
445 to a target port for four or five I

1114
00:43:32,690 --> 00:43:34,700
was the first time I learned it and then

1115
00:43:34,700 --> 00:43:37,520
you exploit your so in your medicine or

1116
00:43:37,520 --> 00:43:39,440
matter procession you're actually or

1117
00:43:39,440 --> 00:43:40,820
EGIS Metasploit framework you're

1118
00:43:40,820 --> 00:43:42,910
actually saying I'm attacking myself

1119
00:43:42,910 --> 00:43:45,440
that's your that's your our host the

1120
00:43:45,440 --> 00:43:47,870
target right you're saying you you tak

1121
00:43:47,870 --> 00:43:50,090
you're yourself on that port that you

1122
00:43:50,090 --> 00:43:51,560
forwarded so if you didn't pour that

1123
00:43:51,560 --> 00:43:52,790
pour it you're just actually attacking

1124
00:43:52,790 --> 00:43:55,850
yourself it's kind of a mind freak thing

1125
00:43:55,850 --> 00:44:01,370
we first do it so can't talk about loud

1126
00:44:01,370 --> 00:44:03,560
moving again without bloodhound spectra

1127
00:44:03,560 --> 00:44:06,590
ops guys are amazing and I just thought

1128
00:44:06,590 --> 00:44:07,970
was funny having the dog's head bouncing

1129
00:44:07,970 --> 00:44:10,820
was about house but there's us connect

1130
00:44:10,820 --> 00:44:12,650
here in neo4j at the bottom left right

1131
00:44:12,650 --> 00:44:15,290
it's a sania for Jaso a graphical

1132
00:44:15,290 --> 00:44:17,690
management and like platform so it just

1133
00:44:17,690 --> 00:44:19,220
makes pretty pictures for all that data

1134
00:44:19,220 --> 00:44:21,260
that you look like utilizing bloodhound

1135
00:44:21,260 --> 00:44:24,590
so you start your neo4j it takes a lot

1136
00:44:24,590 --> 00:44:25,730
to configure it but they have a really

1137
00:44:25,730 --> 00:44:28,400
good write-up to go to that and read it

1138
00:44:28,400 --> 00:44:31,160
and then so this is actually me running

1139
00:44:31,160 --> 00:44:33,980
bloodhound through your cobalt strike so

1140
00:44:33,980 --> 00:44:35,540
when I run it through cobalt strike

1141
00:44:35,540 --> 00:44:38,360
actually drops a zip on the target and

1142
00:44:38,360 --> 00:44:40,820
that dot zip I was then pulled back and

1143
00:44:40,820 --> 00:44:44,780
upload the CSVs into the neo4j console

1144
00:44:44,780 --> 00:44:46,190
right and then it'll give me the pretty

1145
00:44:46,190 --> 00:44:48,740
picture the issue with that is you're

1146
00:44:48,740 --> 00:44:51,170
actually you know you're dropping a file

1147
00:44:51,170 --> 00:44:54,230
on the target so if you drop on the

1148
00:44:54,230 --> 00:44:55,700
desktop and users on there they're gonna

1149
00:44:55,700 --> 00:44:58,070
see it and a lot of operators aren't

1150
00:44:58,070 --> 00:44:59,210
aware of that the first time they

1151
00:44:59,210 --> 00:45:02,510
utilize a tool and then something really

1152
00:45:02,510 --> 00:45:04,820
cool actually learn not too long ago was

1153
00:45:04,820 --> 00:45:07,160
that you can do you use this like REST

1154
00:45:07,160 --> 00:45:09,980
API you can actually do a reverse port

1155
00:45:09,980 --> 00:45:11,990
forward through COBOL strike

1156
00:45:11,990 --> 00:45:13,520
so you reverse port forward like it's

1157
00:45:13,520 --> 00:45:16,040
like 7/4 m4 or 787-8 can't remember but

1158
00:45:16,040 --> 00:45:18,200
you do reverse port 4th for that port

1159
00:45:18,200 --> 00:45:20,510
and then when you run it you do like in

1160
00:45:20,510 --> 00:45:23,599
the bloodhound right and then it'll be

1161
00:45:23,599 --> 00:45:28,730
like tack URI HTTP colon 1 2 7 0 1 7 8 7

1162
00:45:28,730 --> 00:45:31,849
8 quotes space tech user quote or

1163
00:45:31,849 --> 00:45:33,920
calling past space you put username

1164
00:45:33,920 --> 00:45:36,910
password to your neo4j it'll actually

1165
00:45:36,910 --> 00:45:40,130
take all that data and just pipe it in

1166
00:45:40,130 --> 00:45:43,940
your neo4j without dropping the zip on

1167
00:45:43,940 --> 00:45:45,740
the target so that's really cool and

1168
00:45:45,740 --> 00:45:48,920
super useful and uh I thought it was

1169
00:45:48,920 --> 00:45:52,430
super badass and there's and that's what

1170
00:45:52,430 --> 00:45:54,380
looks like the output right green or

1171
00:45:54,380 --> 00:45:57,619
users yellows the groups and the Reds of

1172
00:45:57,619 --> 00:45:59,750
the system that we compromised so this

1173
00:45:59,750 --> 00:46:01,130
is an example of the shortest path for

1174
00:46:01,130 --> 00:46:04,609
the high-value targets and it just makes

1175
00:46:04,609 --> 00:46:05,810
it all pretty for you so you can click

1176
00:46:05,810 --> 00:46:06,920
and no actually tell you the pathway you

1177
00:46:06,920 --> 00:46:12,380
need to go and then I didn't want to say

1178
00:46:12,380 --> 00:46:13,520
all this data and put it all out there

1179
00:46:13,520 --> 00:46:15,140
without giving the references where a

1180
00:46:15,140 --> 00:46:18,619
lot of material came from people smarter

1181
00:46:18,619 --> 00:46:20,480
than me in specific areas and I do their

1182
00:46:20,480 --> 00:46:22,460
work or the ones I really came up with

1183
00:46:22,460 --> 00:46:24,440
this and then I just use their tools and

1184
00:46:24,440 --> 00:46:26,359
I want people to know about them and

1185
00:46:26,359 --> 00:46:29,900
talk about it and we're gonna post all

1186
00:46:29,900 --> 00:46:32,599
this later as well and then but so these

1187
00:46:32,599 --> 00:46:34,550
are the people who influenced me a lot

1188
00:46:34,550 --> 00:46:38,000
and who I follow on Twitter and they

1189
00:46:38,000 --> 00:46:38,869
might not even know it

1190
00:46:38,869 --> 00:46:41,450
so I on them a little they're awesome

1191
00:46:41,450 --> 00:46:44,060
you know that's why I imagine hack for

1192
00:46:44,060 --> 00:46:45,440
the network which is like funding me I

1193
00:46:45,440 --> 00:46:46,670
love to I eat from the office he's my

1194
00:46:46,670 --> 00:46:49,250
favorite so I just imagine like because

1195
00:46:49,250 --> 00:46:50,270
you just pretend to be a bunch of

1196
00:46:50,270 --> 00:46:51,970
different people it's pretty fun and

1197
00:46:51,970 --> 00:46:54,470
then if you enjoyed this talk I'd like

1198
00:46:54,470 --> 00:46:57,230
to know more these slides will be

1199
00:46:57,230 --> 00:46:59,060
available we're not sure we're going to

1200
00:46:59,060 --> 00:47:00,770
posting me out probably on my github

1201
00:47:00,770 --> 00:47:02,660
other things later and then obviously

1202
00:47:02,660 --> 00:47:05,900
this video is gonna be available feel

1203
00:47:05,900 --> 00:47:07,940
free to message us on Twitter I'm super

1204
00:47:07,940 --> 00:47:09,920
interactive I love collaborating if

1205
00:47:09,920 --> 00:47:12,530
anybody has any cool ideas you know I

1206
00:47:12,530 --> 00:47:14,030
write in Python I'm currently writing

1207
00:47:14,030 --> 00:47:16,160
some like implants and stuff and see and

1208
00:47:16,160 --> 00:47:18,080
I'm trying to create my own situ right

1209
00:47:18,080 --> 00:47:20,150
now just like super let's like on the

1210
00:47:20,150 --> 00:47:21,740
side fun but if you might wants like

1211
00:47:21,740 --> 00:47:23,839
work with me on that'd be pretty cool

1212
00:47:23,839 --> 00:47:25,160
you might Internet

1213
00:47:25,160 --> 00:47:48,890
sit and yeah some have any questions you

1214
00:47:48,890 --> 00:47:51,559
have that one you ask in sorry about

1215
00:47:51,559 --> 00:48:06,470
your end zone oh well with women W my

1216
00:48:06,470 --> 00:48:08,809
commands that are the artifacts to let

1217
00:48:08,809 --> 00:48:11,089
the I from define off the top of my head

1218
00:48:11,089 --> 00:48:13,760
I do not have to actually look into that

1219
00:48:13,760 --> 00:48:16,549
I know like there's a blue teamers out

1220
00:48:16,549 --> 00:48:20,180
there for me my itself I do not know the

1221
00:48:20,180 --> 00:48:21,530
artifacts that are all left on the

1222
00:48:21,530 --> 00:48:23,630
target that's why I do normally when I'm

1223
00:48:23,630 --> 00:48:24,890
doing my red team assessments I have

1224
00:48:24,890 --> 00:48:26,900
Google right I mean forth or something

1225
00:48:26,900 --> 00:48:29,720
oh cool that so awful for women itself

1226
00:48:29,720 --> 00:48:32,539
off the time no I do not know be shut

1227
00:48:32,539 --> 00:48:34,760
down I mean you can walk down W mind

1228
00:48:34,760 --> 00:48:36,470
pretty low but as for like tools like

1229
00:48:36,470 --> 00:48:38,450
interpretation like how to set up your

1230
00:48:38,450 --> 00:48:40,730
configuration like monitoring like

1231
00:48:40,730 --> 00:48:43,400
processes and stuff that's that's a lot

1232
00:48:43,400 --> 00:48:46,069
of information that we hard on the red

1233
00:48:46,069 --> 00:48:48,109
team and a super it gets super deep in a

1234
00:48:48,109 --> 00:48:52,130
blue team yeah man

1235
00:48:52,130 --> 00:48:55,690
mouse have any questions

1236
00:48:57,070 --> 00:49:01,270
good man please

1237
00:49:17,530 --> 00:49:22,290
yeah it's awesome

1238
00:49:31,309 --> 00:49:33,839
actually thank you for that now I don't

1239
00:49:33,839 --> 00:49:36,450
have to Google anything I can alright

1240
00:49:36,450 --> 00:49:40,680
soon have any other questions yeah no

1241
00:49:40,680 --> 00:49:42,539
all right thank you for calling oh thank

1242
00:49:42,539 --> 00:49:43,760
you for coming

1243
00:49:43,760 --> 00:49:51,329
[Applause]

