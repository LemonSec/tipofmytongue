1
00:00:13,710 --> 00:00:17,050
good afternoon we're going to talk

2
00:00:17,050 --> 00:00:19,960
windows event forwarding and a sec today

3
00:00:19,960 --> 00:00:24,310
so first thing that I want to talk about

4
00:00:24,310 --> 00:00:26,919
is why specifically I wanted to talk

5
00:00:26,919 --> 00:00:30,960
about this so one of the things about

6
00:00:30,960 --> 00:00:35,710
decides Augusta is that coming here over

7
00:00:35,710 --> 00:00:38,559
the the last several years there's a lot

8
00:00:38,559 --> 00:00:42,190
of defensive talks and there's a lot of

9
00:00:42,190 --> 00:00:44,680
people who are students or maybe

10
00:00:44,680 --> 00:00:47,559
starting off in their career and you

11
00:00:47,559 --> 00:00:49,900
come to this conference so I wanted to

12
00:00:49,900 --> 00:00:54,489
kind of pick something that is something

13
00:00:54,489 --> 00:00:56,940
that I think a lot of people can do and

14
00:00:56,940 --> 00:01:00,760
the title for this presentation is you

15
00:01:00,760 --> 00:01:02,500
can do this

16
00:01:02,500 --> 00:01:08,890
so just presents an organization that

17
00:01:08,890 --> 00:01:11,500
has less than let's say a thousand

18
00:01:11,500 --> 00:01:16,360
employees okay so maybe half

19
00:01:16,360 --> 00:01:19,210
is anyone here support less than maybe

20
00:01:19,210 --> 00:01:24,370
200 okay all right so a lot of the

21
00:01:24,370 --> 00:01:28,000
presentations that you see and if you're

22
00:01:28,000 --> 00:01:31,210
on Twitter and you are going to other

23
00:01:31,210 --> 00:01:34,590
conferences people are talking about

24
00:01:34,590 --> 00:01:38,290
supporting organizations that have

25
00:01:38,290 --> 00:01:41,710
10,000 endpoints that might not those

26
00:01:41,710 --> 00:01:43,360
types of techniques might not be

27
00:01:43,360 --> 00:01:46,659
applicable to what you do so the

28
00:01:46,659 --> 00:01:49,659
unfortunate thing that happens is once

29
00:01:49,659 --> 00:01:51,570
you start engaging with the community

30
00:01:51,570 --> 00:01:55,720
there's this thing called the perfection

31
00:01:55,720 --> 00:01:59,650
fallacy or the Nirvana fallacy where if

32
00:01:59,650 --> 00:02:03,190
you if your solution doesn't fix

33
00:02:03,190 --> 00:02:04,990
everything someone is going to show up

34
00:02:04,990 --> 00:02:08,949
and say but that doesn't scale or you

35
00:02:08,949 --> 00:02:10,269
know that's not going to fix this

36
00:02:10,269 --> 00:02:12,909
problem it always comes up with patching

37
00:02:12,909 --> 00:02:16,239
right so the one across stuff the MS

38
00:02:16,239 --> 00:02:19,000
1710 you know some people come out and

39
00:02:19,000 --> 00:02:21,129
say just patch our machines somebody

40
00:02:21,129 --> 00:02:23,769
immediately comes out and says you don't

41
00:02:23,769 --> 00:02:26,920
know my environment well you're the best

42
00:02:26,920 --> 00:02:30,160
person to understand your environment

43
00:02:30,160 --> 00:02:33,250
and people coming out and talking about

44
00:02:33,250 --> 00:02:35,200
that you know immediately responding

45
00:02:35,200 --> 00:02:38,380
back with this perfection fallacy and

46
00:02:38,380 --> 00:02:40,900
all that kind of stuff is like us having

47
00:02:40,900 --> 00:02:44,440
a health care discussion and I say

48
00:02:44,440 --> 00:02:46,510
everyone needs to wash their hands and

49
00:02:46,510 --> 00:02:48,610
someone comes up immediately and says

50
00:02:48,610 --> 00:02:50,410
washing your hands doesn't cure cancer

51
00:02:50,410 --> 00:02:53,980
right it's it's not helpful so given

52
00:02:53,980 --> 00:02:55,930
that specifically in the United States

53
00:02:55,930 --> 00:02:59,140
the vast majority of organizations are

54
00:02:59,140 --> 00:03:04,770
actually really small so in my

55
00:03:04,770 --> 00:03:09,220
professional career I support a agency

56
00:03:09,220 --> 00:03:11,620
that does economic development and a lot

57
00:03:11,620 --> 00:03:13,330
of the people that we interact with are

58
00:03:13,330 --> 00:03:15,550
actually really small so the ten

59
00:03:15,550 --> 00:03:18,160
thousand in point thing doesn't

60
00:03:18,160 --> 00:03:21,100
represent you trying to do security for

61
00:03:21,100 --> 00:03:23,310
an accounting firm in Augusta Georgia

62
00:03:23,310 --> 00:03:26,950
where you have 250 staff members right

63
00:03:26,950 --> 00:03:30,310
so the other thing that happens is a lot

64
00:03:30,310 --> 00:03:32,320
of times especially in smaller

65
00:03:32,320 --> 00:03:35,170
organizations IT is responsible for

66
00:03:35,170 --> 00:03:37,480
security or there might only be one

67
00:03:37,480 --> 00:03:40,630
security person or you know some

68
00:03:40,630 --> 00:03:43,690
combination of things like that so one

69
00:03:43,690 --> 00:03:46,180
of my arguments also is that the vast

70
00:03:46,180 --> 00:03:47,739
majority of the things that you do with

71
00:03:47,739 --> 00:03:51,269
security are directly applicable to

72
00:03:51,269 --> 00:03:54,610
traditional IT right so you have the CIA

73
00:03:54,610 --> 00:03:58,560
triad which is just fancy you know

74
00:03:58,560 --> 00:04:00,430
that's the other thing that happens

75
00:04:00,430 --> 00:04:01,930
during presentations there's lots of

76
00:04:01,930 --> 00:04:04,650
acronyms right the CIA triad

77
00:04:04,650 --> 00:04:06,760
confidentiality integrity and

78
00:04:06,760 --> 00:04:11,260
availability integrity integrity and

79
00:04:11,260 --> 00:04:12,989
availability is a direct IT

80
00:04:12,989 --> 00:04:17,200
responsibility right machines go down IT

81
00:04:17,200 --> 00:04:22,900
is responsible for it so security things

82
00:04:22,900 --> 00:04:26,430
don't necessarily have to be so

83
00:04:26,430 --> 00:04:29,169
separated from security until you start

84
00:04:29,169 --> 00:04:30,940
to get into these big scale things and

85
00:04:30,940 --> 00:04:32,590
separation of duties and all that kind

86
00:04:32,590 --> 00:04:35,290
of stuff right so the other thing that's

87
00:04:35,290 --> 00:04:37,690
important is to begin to really

88
00:04:37,690 --> 00:04:39,099
understand what's normal in your

89
00:04:39,099 --> 00:04:41,789
environment and

90
00:04:41,840 --> 00:04:44,480
doing things like monitoring endpoint

91
00:04:44,480 --> 00:04:46,370
logs which is primarily what I'm going

92
00:04:46,370 --> 00:04:48,650
to talk about is one of the best things

93
00:04:48,650 --> 00:04:50,540
that you can do so we just had an

94
00:04:50,540 --> 00:04:53,020
excellent presentation in this room from

95
00:04:53,020 --> 00:04:56,720
people doing red teaming right the those

96
00:04:56,720 --> 00:04:58,520
techniques that they were using would

97
00:04:58,520 --> 00:05:01,070
have lit up the majority of environments

98
00:05:01,070 --> 00:05:04,449
that are doing endpoint monitoring if

99
00:05:04,449 --> 00:05:07,940
those people also look at what's normal

100
00:05:07,940 --> 00:05:10,280
on your network right so using the

101
00:05:10,280 --> 00:05:12,350
theoretical example of the accounting

102
00:05:12,350 --> 00:05:16,490
firm in Augusta how many times is

103
00:05:16,490 --> 00:05:18,919
someone that works in an accounting firm

104
00:05:18,919 --> 00:05:23,930
gonna run Who am I never it's highly

105
00:05:23,930 --> 00:05:25,310
unlikely they're even going to run the

106
00:05:25,310 --> 00:05:29,270
net command so once you start you

107
00:05:29,270 --> 00:05:31,070
determine what's normal for your

108
00:05:31,070 --> 00:05:33,830
environment techniques like endpoint

109
00:05:33,830 --> 00:05:36,919
monitoring my argument is that you

110
00:05:36,919 --> 00:05:39,380
should immediately alert on things like

111
00:05:39,380 --> 00:05:46,160
who am i net the scheduled tasks stuff

112
00:05:46,160 --> 00:05:49,970
nedeth net sh those are not normal

113
00:05:49,970 --> 00:05:52,639
things for even Durer when's the last

114
00:05:52,639 --> 00:05:56,180
time that you sat down at someone's desk

115
00:05:56,180 --> 00:05:59,030
to you know do whatever especially if

116
00:05:59,030 --> 00:06:00,680
you come from a helpdesk background and

117
00:06:00,680 --> 00:06:05,900
then went into security a executive vice

118
00:06:05,900 --> 00:06:08,389
president of a corporation isn't going

119
00:06:08,389 --> 00:06:10,789
to sit down and write and hit dirt you

120
00:06:10,789 --> 00:06:14,690
know type dirt so everything that I'm

121
00:06:14,690 --> 00:06:16,370
going to talk about is quote free

122
00:06:16,370 --> 00:06:18,380
meaning that it's either built into

123
00:06:18,380 --> 00:06:21,160
Windows or it's an open-source free

124
00:06:21,160 --> 00:06:25,669
project and this idea that you can do it

125
00:06:25,669 --> 00:06:29,630
is primarily that like what Dave Kennedy

126
00:06:29,630 --> 00:06:32,060
was talking about this morning y'all are

127
00:06:32,060 --> 00:06:35,840
the person that's eventually going to

128
00:06:35,840 --> 00:06:37,280
make the decisions about these things

129
00:06:37,280 --> 00:06:39,860
right so you want to automate as much as

130
00:06:39,860 --> 00:06:42,800
possible to bubble up to the person that

131
00:06:42,800 --> 00:06:44,330
determines what's normal for your

132
00:06:44,330 --> 00:06:51,409
environment so why me I a lot of people

133
00:06:51,409 --> 00:06:53,300
view the about me thing so what I

134
00:06:53,300 --> 00:06:55,639
specifically wanted to talk about is why

135
00:06:55,639 --> 00:06:57,560
why do I consider myself someone that

136
00:06:57,560 --> 00:06:59,990
can talk about this topic I have a lot

137
00:06:59,990 --> 00:07:01,550
of experience with windows

138
00:07:01,550 --> 00:07:07,069
I'm started off you know in the NetWare

139
00:07:07,069 --> 00:07:10,520
days with windows 3-1 and in t35 them on

140
00:07:10,520 --> 00:07:14,120
all that stuff I'm one of those Gen X

141
00:07:14,120 --> 00:07:17,990
Slackware Linux people who you know used

142
00:07:17,990 --> 00:07:19,400
it when you could burn up your monitor

143
00:07:19,400 --> 00:07:21,349
and destroy your hard drive or whatever

144
00:07:21,349 --> 00:07:26,240
I like to take tests so that's the GX

145
00:07:26,240 --> 00:07:29,479
stuff as I said I'm an IT Director for a

146
00:07:29,479 --> 00:07:33,889
state agency for the state that is

147
00:07:33,889 --> 00:07:37,250
across the river which you can and I

148
00:07:37,250 --> 00:07:39,199
don't work for the Department of Revenue

149
00:07:39,199 --> 00:07:41,779
and South Carolina some of you will know

150
00:07:41,779 --> 00:07:45,949
wow that's funny I use left with event

151
00:07:45,949 --> 00:07:48,830
forwarding an O SEC every day so the

152
00:07:48,830 --> 00:07:51,879
first part is the Windows Event for me

153
00:07:51,879 --> 00:07:55,069
right so how many people use Windows

154
00:07:55,069 --> 00:08:00,430
Event now not not very many okay so

155
00:08:00,430 --> 00:08:02,839
Windows Event forwarding is built into

156
00:08:02,839 --> 00:08:07,430
the operating system so a lot of people

157
00:08:07,430 --> 00:08:08,569
have talked about this over the last

158
00:08:08,569 --> 00:08:11,810
couple of years and that there's a

159
00:08:11,810 --> 00:08:13,849
variety of reasons for it and one of the

160
00:08:13,849 --> 00:08:16,550
the primary thing is because it's

161
00:08:16,550 --> 00:08:19,449
built-in it doesn't require an agent

162
00:08:19,449 --> 00:08:21,800
those of you who have Active Directory

163
00:08:21,800 --> 00:08:24,080
domains which is probably going to be

164
00:08:24,080 --> 00:08:27,409
all of you these configurations can help

165
00:08:27,409 --> 00:08:31,250
via group policy so basically what

166
00:08:31,250 --> 00:08:33,979
you're doing is you're setting up an

167
00:08:33,979 --> 00:08:36,049
agent or sorry you're setting up a

168
00:08:36,049 --> 00:08:38,089
Windows Event collector server which

169
00:08:38,089 --> 00:08:39,828
we'll talk talk about a little bit more

170
00:08:39,828 --> 00:08:42,320
in a minute that the clients are gonna

171
00:08:42,320 --> 00:08:45,410
send their logs to you so given that

172
00:08:45,410 --> 00:08:47,300
this is a lightning talk and we're gonna

173
00:08:47,300 --> 00:08:50,449
have a ton of time to get into technical

174
00:08:50,449 --> 00:08:52,310
detail what I wanted to really emphasize

175
00:08:52,310 --> 00:08:56,540
is to learn from people they do this all

176
00:08:56,540 --> 00:09:01,790
the time so the nsa's IAD which now is

177
00:09:01,790 --> 00:09:04,130
just cybersecurity or something they

178
00:09:04,130 --> 00:09:07,910
changed a lot of their names created a

179
00:09:07,910 --> 00:09:09,110
paper

180
00:09:09,110 --> 00:09:11,300
five years ago maybe spotting the

181
00:09:11,300 --> 00:09:12,589
adversary with Windows Event log

182
00:09:12,589 --> 00:09:16,310
monitoring it's an excellent paper the

183
00:09:16,310 --> 00:09:18,320
Australian signals Directorate also has

184
00:09:18,320 --> 00:09:21,680
one it gets into what what are the

185
00:09:21,680 --> 00:09:23,899
actual group policies that you need to

186
00:09:23,899 --> 00:09:27,290
set up in order for this to work all the

187
00:09:27,290 --> 00:09:29,899
way down to you what types of events do

188
00:09:29,899 --> 00:09:31,579
you want to subscribe to you and what is

189
00:09:31,579 --> 00:09:33,019
the reason for subscribing to those

190
00:09:33,019 --> 00:09:33,910
events

191
00:09:33,910 --> 00:09:36,920
Jessica pain works for Microsoft

192
00:09:36,920 --> 00:09:42,470
that's her twitter handle jane MSFT she

193
00:09:42,470 --> 00:09:45,680
has a presentation called monitoring

194
00:09:45,680 --> 00:09:47,360
what matters it's a video where she

195
00:09:47,360 --> 00:09:49,700
talks about when his event monitoring

196
00:09:49,700 --> 00:09:53,269
she also is the sponsor of this thing

197
00:09:53,269 --> 00:09:56,860
called the waffles project which is a

198
00:09:56,860 --> 00:10:01,399
probably a I mean it is it's not a it's

199
00:10:01,399 --> 00:10:03,620
a Microsoft tool that's used but it's

200
00:10:03,620 --> 00:10:05,540
not something that you can buy on its

201
00:10:05,540 --> 00:10:09,529
own github and then Palantir regardless

202
00:10:09,529 --> 00:10:11,089
of what you think about what the work

203
00:10:11,089 --> 00:10:14,570
that Palantir you know whatever the

204
00:10:14,570 --> 00:10:18,140
internal windows team at Palantir is

205
00:10:18,140 --> 00:10:22,279
awesome so they have a github which has

206
00:10:22,279 --> 00:10:25,579
everything that they use event

207
00:10:25,579 --> 00:10:28,699
forwarding for in addition to some

208
00:10:28,699 --> 00:10:31,519
papers on how to set it up all of these

209
00:10:31,519 --> 00:10:33,980
papers are going to be similar to the

210
00:10:33,980 --> 00:10:37,459
NSA paper the Palantir paper is a little

211
00:10:37,459 --> 00:10:40,730
bit newer they're they're using this

212
00:10:40,730 --> 00:10:44,779
actually to monitor in the neighborhood

213
00:10:44,779 --> 00:10:48,529
of 10,000 endpoints i believe so even

214
00:10:48,529 --> 00:10:49,760
though i'm talking about using it at a

215
00:10:49,760 --> 00:10:52,959
smaller scale it's it is scalable

216
00:10:52,959 --> 00:10:55,550
microsoft's recommendation is do not put

217
00:10:55,550 --> 00:10:58,610
not put more than 10,000 endpoints on

218
00:10:58,610 --> 00:11:01,760
one collector so if you're supporting

219
00:11:01,760 --> 00:11:06,800
250 machines only requires one vm so the

220
00:11:06,800 --> 00:11:08,449
other thing is

221
00:11:08,449 --> 00:11:12,260
bucyk right so a lot of you anyone at a

222
00:11:12,260 --> 00:11:16,670
sec or know about a sec okay this site

223
00:11:16,670 --> 00:11:18,350
has been around for quite a while it was

224
00:11:18,350 --> 00:11:21,170
originally written by Daniel CID it's

225
00:11:21,170 --> 00:11:22,670
all log based

226
00:11:22,670 --> 00:11:26,149
it's job is to it's a host intrusion

227
00:11:26,149 --> 00:11:29,660
detection system it's basically reading

228
00:11:29,660 --> 00:11:34,070
logs off of whatever device you know the

229
00:11:34,070 --> 00:11:36,920
logs come from and then performing some

230
00:11:36,920 --> 00:11:39,290
kind of action so the majority of the

231
00:11:39,290 --> 00:11:42,040
time what that's going to be is an alert

232
00:11:42,040 --> 00:11:46,760
although in the UNIX base you know what

233
00:11:46,760 --> 00:11:50,420
a Linux BSD it can fire off active

234
00:11:50,420 --> 00:11:52,459
response so if you're using it on the

235
00:11:52,459 --> 00:11:55,100
web server you can use it to write to

236
00:11:55,100 --> 00:11:57,589
you IP tables there are some stuff that

237
00:11:57,589 --> 00:11:58,910
you can do in Windows but it doesn't

238
00:11:58,910 --> 00:12:03,680
work very well so the server is Linux

239
00:12:03,680 --> 00:12:08,410
based generally the Windows client

240
00:12:08,410 --> 00:12:10,490
Windows is the only thing that requires

241
00:12:10,490 --> 00:12:11,930
a client the rest of them you basically

242
00:12:11,930 --> 00:12:14,660
have to compile but it's it's not

243
00:12:14,660 --> 00:12:17,480
difficult if you're used to you doing

244
00:12:17,480 --> 00:12:20,660
stuff in Linux atomic core is actually

245
00:12:20,660 --> 00:12:23,750
kind of the current maintainer of a lot

246
00:12:23,750 --> 00:12:25,399
of the Oh sex stuff there was a lot of

247
00:12:25,399 --> 00:12:30,890
forks of Oh sec but its first three

248
00:12:30,890 --> 00:12:34,550
atomic core was uh or wazoo however you

249
00:12:34,550 --> 00:12:37,850
want to pronounce at alienvault the

250
00:12:37,850 --> 00:12:41,120
wazoo and alienvault actually have a a

251
00:12:41,120 --> 00:12:44,060
suit like a pseudo sim kind of

252
00:12:44,060 --> 00:12:46,220
environment that is using Oh suck and

253
00:12:46,220 --> 00:12:48,290
then my favorite of course since we're

254
00:12:48,290 --> 00:12:51,699
here in Augusta is security onion so

255
00:12:51,699 --> 00:12:54,949
you've seen it mentioned in 401 and 504

256
00:12:54,949 --> 00:12:57,829
if you take sans classes the other thing

257
00:12:57,829 --> 00:12:59,180
that comes up sometimes when you're

258
00:12:59,180 --> 00:13:01,690
talking about those sec is why not use

259
00:13:01,690 --> 00:13:06,910
OS query so go ahead is my argument

260
00:13:06,910 --> 00:13:10,100
whatever you're going to use to be your

261
00:13:10,100 --> 00:13:14,750
endpoint monitoring it's better to begin

262
00:13:14,750 --> 00:13:17,899
down a path and then iterate you know so

263
00:13:17,899 --> 00:13:21,079
we chose to go the Oh sec path some

264
00:13:21,079 --> 00:13:24,070
people made to choose to go os query

265
00:13:24,070 --> 00:13:26,810
there's a lot of functionality that's

266
00:13:26,810 --> 00:13:28,820
the same like OS career you can do you

267
00:13:28,820 --> 00:13:31,100
follow integrity monitoring and things

268
00:13:31,100 --> 00:13:33,410
like that but my personal preference is

269
00:13:33,410 --> 00:13:35,089
those that cuz I've used it for a long

270
00:13:35,089 --> 00:13:35,650
time

271
00:13:35,650 --> 00:13:39,250
so the two things together right so one

272
00:13:39,250 --> 00:13:41,170
of the problems with OSAC is key

273
00:13:41,170 --> 00:13:44,830
management maintaining a set clients

274
00:13:44,830 --> 00:13:46,380
isn't fun

275
00:13:46,380 --> 00:13:49,330
so what what you what you do is you're

276
00:13:49,330 --> 00:13:52,600
enrolling an agent with the OS X server

277
00:13:52,600 --> 00:13:55,210
and then the communication gets set up

278
00:13:55,210 --> 00:14:01,360
so that the log information gets sent

279
00:14:01,360 --> 00:14:04,300
via the agent to the OS X server and

280
00:14:04,300 --> 00:14:08,020
then there's a log monitor that is going

281
00:14:08,020 --> 00:14:09,400
to do the interpretation based off of

282
00:14:09,400 --> 00:14:11,410
your rules and then perform whatever

283
00:14:11,410 --> 00:14:14,890
kind of action there is so the

284
00:14:14,890 --> 00:14:17,380
architecture that I'm proposing to use

285
00:14:17,380 --> 00:14:20,110
in this case is use Windows event

286
00:14:20,110 --> 00:14:24,040
forwarding set up the policies based off

287
00:14:24,040 --> 00:14:25,330
of the things that are written in those

288
00:14:25,330 --> 00:14:28,390
papers yet all of your logs going to one

289
00:14:28,390 --> 00:14:31,270
collector and then maintain the

290
00:14:31,270 --> 00:14:33,760
connection between your Windows Event

291
00:14:33,760 --> 00:14:37,660
collector and the OS X server that way

292
00:14:37,660 --> 00:14:39,760
you don't have to put agents on your

293
00:14:39,760 --> 00:14:43,570
endpoints you still have to monitor the

294
00:14:43,570 --> 00:14:46,120
Windows Event collector to determine

295
00:14:46,120 --> 00:14:47,650
whether or not you have agents dropping

296
00:14:47,650 --> 00:14:49,750
off and things like that are sorry you

297
00:14:49,750 --> 00:14:52,120
have clients dropping off but you don't

298
00:14:52,120 --> 00:14:53,529
have to do the key management you don't

299
00:14:53,529 --> 00:14:57,690
have to do any of that kind of stuff so

300
00:14:57,690 --> 00:15:01,750
use the guidance from the those papers

301
00:15:01,750 --> 00:15:04,420
NSA Palantir Microsoft has excellent

302
00:15:04,420 --> 00:15:10,240
guidance security logs application

303
00:15:10,240 --> 00:15:12,580
crashes app Locker device car or task

304
00:15:12,580 --> 00:15:15,250
scheduler all that kind of stuff the

305
00:15:15,250 --> 00:15:17,140
other thing that I highly recommend that

306
00:15:17,140 --> 00:15:20,370
you integrate with this is sis Mon so

307
00:15:20,370 --> 00:15:25,779
sis Mon can be extremely chatty but disk

308
00:15:25,779 --> 00:15:29,730
space as they say is relatively cheap so

309
00:15:29,730 --> 00:15:32,620
if we're also talking about smaller

310
00:15:32,620 --> 00:15:37,029
environments it might not be bad to

311
00:15:37,029 --> 00:15:39,459
start out with getting more data and

312
00:15:39,459 --> 00:15:43,650
then pull it back as needed

313
00:15:44,250 --> 00:15:46,540
because the more information that you

314
00:15:46,540 --> 00:15:48,460
get the better off you're going to be

315
00:15:48,460 --> 00:15:50,950
you can make the determination of you

316
00:15:50,950 --> 00:15:52,390
you don't need this anymore or whatever

317
00:15:52,390 --> 00:15:57,340
so the examples from earlier today like

318
00:15:57,340 --> 00:15:58,390
Dave Kennedy was talking about

319
00:15:58,390 --> 00:16:00,070
PowerShell talking out to the Internet

320
00:16:00,070 --> 00:16:01,330
you can get that kind of information

321
00:16:01,330 --> 00:16:04,420
from sis Mon right a rule and O SEC and

322
00:16:04,420 --> 00:16:08,710
get an alert without no special devices

323
00:16:08,710 --> 00:16:14,190
required no nothing but brain power so

324
00:16:14,190 --> 00:16:16,960
the way to do this is the typical way

325
00:16:16,960 --> 00:16:20,080
that you go about doing any kind of ite

326
00:16:20,080 --> 00:16:23,410
or security infrastructure project take

327
00:16:23,410 --> 00:16:27,130
a small number of machines I would argue

328
00:16:27,130 --> 00:16:30,070
that part of this process you need to

329
00:16:30,070 --> 00:16:34,840
evaluate your tiers of computers right

330
00:16:34,840 --> 00:16:37,540
so you have you have computers that have

331
00:16:37,540 --> 00:16:39,910
access to certain types of data and in

332
00:16:39,910 --> 00:16:41,500
your environment you might have some

333
00:16:41,500 --> 00:16:43,270
group of computers that has access to

334
00:16:43,270 --> 00:16:46,900
PII like your accounts payable or your

335
00:16:46,900 --> 00:16:50,230
HR people or whatever set everything in

336
00:16:50,230 --> 00:16:52,030
two tiers and then start working from

337
00:16:52,030 --> 00:16:55,390
that everything's done via group policy

338
00:16:55,390 --> 00:16:58,600
as I said once the stuff starts coming

339
00:16:58,600 --> 00:17:02,260
through you can actually go into the

340
00:17:02,260 --> 00:17:04,480
event log viewer on the collector and

341
00:17:04,480 --> 00:17:07,240
user you know just look at it to make

342
00:17:07,240 --> 00:17:10,230
sure that stuff's working in this case

343
00:17:10,230 --> 00:17:15,849
you can do a push or pull which the

344
00:17:15,849 --> 00:17:19,959
papers will talk about I would suggest

345
00:17:19,959 --> 00:17:23,230
using the pull push method so your

346
00:17:23,230 --> 00:17:26,380
clients check in with the collector they

347
00:17:26,380 --> 00:17:28,930
get the subscription that says please

348
00:17:28,930 --> 00:17:34,680
send me your 46:24 from the security log

349
00:17:34,680 --> 00:17:37,270
once that once they've done the check-in

350
00:17:37,270 --> 00:17:39,280
they have some period of time where

351
00:17:39,280 --> 00:17:41,470
they're going to send their logs to the

352
00:17:41,470 --> 00:17:44,080
collector so that can handle

353
00:17:44,080 --> 00:17:45,970
theoretically it could handle remote

354
00:17:45,970 --> 00:17:47,830
clients that are going to be out and

355
00:17:47,830 --> 00:17:52,780
come back in stuff like that it uses win

356
00:17:52,780 --> 00:17:55,300
RM which you might be familiar with with

357
00:17:55,300 --> 00:18:02,260
PowerShell remoting 5985 or 59 to 86

358
00:18:02,260 --> 00:18:04,779
who knows the difference between the two

359
00:18:04,779 --> 00:18:07,380
of those and it's not that one of them

360
00:18:07,380 --> 00:18:11,279
isn't encrypted

361
00:18:17,840 --> 00:18:24,279
59 86 uses TLS right so 5985 doesn't

362
00:18:24,279 --> 00:18:28,099
however which this comes up at capably

363
00:18:28,099 --> 00:18:29,869
and I believe Jason folson talks about

364
00:18:29,869 --> 00:18:32,659
this in his in his Windows class once

365
00:18:32,659 --> 00:18:37,340
the connection is set up in on 45985 the

366
00:18:37,340 --> 00:18:39,109
communication actually is encrypted with

367
00:18:39,109 --> 00:18:43,489
a EES symmetric key so even though the

368
00:18:43,489 --> 00:18:45,590
initial connection isn't encrypted

369
00:18:45,590 --> 00:18:48,979
between the endpoint and the other side

370
00:18:48,979 --> 00:18:50,960
either with PowerShell remoting or with

371
00:18:50,960 --> 00:18:53,179
this the communications actually are

372
00:18:53,179 --> 00:18:58,129
encrypted so OSAC the asian itself is

373
00:18:58,129 --> 00:19:00,679
fairly lightweight you are going to

374
00:19:00,679 --> 00:19:03,529
produce a lot of logs doing this right

375
00:19:03,529 --> 00:19:10,960
so disk disk space those cheap as I said

376
00:19:10,960 --> 00:19:13,849
osek itself is included with security

377
00:19:13,849 --> 00:19:17,269
onion including some visualizations in

378
00:19:17,269 --> 00:19:21,320
the new elasticsearch Kabana

379
00:19:21,320 --> 00:19:25,519
stuff I would argue that you need to

380
00:19:25,519 --> 00:19:27,739
monitor your domain controllers and the

381
00:19:27,739 --> 00:19:32,149
wefts collector so installing the OSAC

382
00:19:32,149 --> 00:19:34,059
agent actually on the domain controller

383
00:19:34,059 --> 00:19:37,759
will get you things like all of your

384
00:19:37,759 --> 00:19:44,929
logins going to your OS X Server and the

385
00:19:44,929 --> 00:19:46,489
built-in rules with osek are gonna

386
00:19:46,489 --> 00:19:49,279
include things like security group

387
00:19:49,279 --> 00:19:54,619
changed so if someone changes the

388
00:19:54,619 --> 00:19:56,919
content of the domain admins group

389
00:19:56,919 --> 00:20:00,200
without doing any kind of customization

390
00:20:00,200 --> 00:20:02,349
at all you're going to get an alert that

391
00:20:02,349 --> 00:20:05,570
this security group changed New Year's

392
00:20:05,570 --> 00:20:08,359
is logging in you can use a

393
00:20:08,359 --> 00:20:13,009
functionality in a sec that are lists so

394
00:20:13,009 --> 00:20:15,139
that you have a list of all of your

395
00:20:15,139 --> 00:20:17,809
sensitive accounts and if you see an

396
00:20:17,809 --> 00:20:22,219
interactive log in from a higher tiered

397
00:20:22,219 --> 00:20:26,659
user onto a end-users machine like a

398
00:20:26,659 --> 00:20:29,179
domain admin should not login to a

399
00:20:29,179 --> 00:20:30,770
workstation

400
00:20:30,770 --> 00:20:33,110
right so you can actually make those SEC

401
00:20:33,110 --> 00:20:34,940
alert on something like that so that you

402
00:20:34,940 --> 00:20:38,200
because you have an operational problem

403
00:20:38,200 --> 00:20:43,490
the clients talk over 15:14 UDP which

404
00:20:43,490 --> 00:20:45,860
actually in this case uses a very bad

405
00:20:45,860 --> 00:20:49,970
algorithm but Daniel SIDS argument about

406
00:20:49,970 --> 00:20:51,700
that is he's never seen any exploits

407
00:20:51,700 --> 00:20:56,090
against those SEC agent using Blowfish

408
00:20:56,090 --> 00:20:59,150
for encryption however apparently that

409
00:20:59,150 --> 00:21:04,430
is a PCI problem so what's happened

410
00:21:04,430 --> 00:21:09,140
recently is virtual security who maybe

411
00:21:09,140 --> 00:21:12,170
in Virginia area is working with atomic

412
00:21:12,170 --> 00:21:15,890
Corp to introduce perfect forward

413
00:21:15,890 --> 00:21:19,130
secrecy support using we socket which is

414
00:21:19,130 --> 00:21:22,610
part is what signal uses so those of you

415
00:21:22,610 --> 00:21:24,680
that are concerned about Oh SEC using

416
00:21:24,680 --> 00:21:27,470
blue fish to encrypt its traffic they

417
00:21:27,470 --> 00:21:29,990
will they'll soon be a implementation

418
00:21:29,990 --> 00:21:33,530
using and we suck it use the base line

419
00:21:33,530 --> 00:21:38,380
rules just like with with then porting

420
00:21:38,380 --> 00:21:42,470
at the beginning so then what happens is

421
00:21:42,470 --> 00:21:44,420
like what we were talking about how

422
00:21:44,420 --> 00:21:46,010
likely is it that somebody's gonna run

423
00:21:46,010 --> 00:21:46,700
Who am I

424
00:21:46,700 --> 00:21:50,990
not very likely so there's no rule in

425
00:21:50,990 --> 00:21:55,550
OSAC for Who am I so what you have to do

426
00:21:55,550 --> 00:21:57,050
is you have to go in there and start

427
00:21:57,050 --> 00:21:59,000
writing rules based off of your

428
00:21:59,000 --> 00:22:03,890
environment and so I want to show a few

429
00:22:03,890 --> 00:22:07,270
different examples of some custom rules

430
00:22:07,270 --> 00:22:11,840
so this is actually showing so you've

431
00:22:11,840 --> 00:22:15,470
got a you've got a user GIS dude on your

432
00:22:15,470 --> 00:22:16,910
domain

433
00:22:16,910 --> 00:22:20,120
they're running ESRI product product

434
00:22:20,120 --> 00:22:22,760
yes awry for some reason doesn't sign

435
00:22:22,760 --> 00:22:27,970
their dll's so this is showing that

436
00:22:27,970 --> 00:22:32,690
AppLocker blocked DLL load on one of

437
00:22:32,690 --> 00:22:35,870
your endpoints no endpoint agent on gif

438
00:22:35,870 --> 00:22:39,620
dudes computer that AppLocker log is

439
00:22:39,620 --> 00:22:41,420
getting sent to the collector and then

440
00:22:41,420 --> 00:22:43,789
the collector is talking to Oh sack and

441
00:22:43,789 --> 00:22:47,359
sex giving you the alert it's actually

442
00:22:47,359 --> 00:22:49,070
not very difficult to do it all to write

443
00:22:49,070 --> 00:22:51,440
a rule like that and there's tons of

444
00:22:51,440 --> 00:22:55,820
examples so one of the other things that

445
00:22:55,820 --> 00:22:58,999
has been talked about today is app

446
00:22:58,999 --> 00:23:01,100
Locker bypasses application whitelisting

447
00:23:01,100 --> 00:23:05,359
dice bypasses using built in whatever

448
00:23:05,359 --> 00:23:08,720
they're called law bins is one word that

449
00:23:08,720 --> 00:23:11,629
people use living off the land stuff

450
00:23:11,629 --> 00:23:15,049
using native tools if you're using

451
00:23:15,049 --> 00:23:18,080
system on and there obviously there's

452
00:23:18,080 --> 00:23:19,659
going to be ways of getting around this

453
00:23:19,659 --> 00:23:24,789
right but if you don't fall for the

454
00:23:24,789 --> 00:23:29,479
perfection fallacy having this rule is

455
00:23:29,479 --> 00:23:31,489
better than not knowing about it at all

456
00:23:31,489 --> 00:23:35,059
and then it might be that this is a

457
00:23:35,059 --> 00:23:39,279
developer and you need to turn it off

458
00:23:39,279 --> 00:23:42,710
for their machine msbuild running on an

459
00:23:42,710 --> 00:23:46,099
accountant's machine is a problem right

460
00:23:46,099 --> 00:23:48,429
there's no need there's no reason for

461
00:23:48,429 --> 00:23:53,239
somebody to do that multiple windows

462
00:23:53,239 --> 00:23:56,599
error events in this case windows of day

463
00:23:56,599 --> 00:23:58,970
failed to check for updates I'm pretty

464
00:23:58,970 --> 00:24:03,919
sure that that is a indicating that it

465
00:24:03,919 --> 00:24:05,509
couldn't talk to the debian sus machine

466
00:24:05,509 --> 00:24:08,690
so that that's useful for security and

467
00:24:08,690 --> 00:24:11,690
it's also useful for IT not talking to

468
00:24:11,690 --> 00:24:15,739
wsus is bad and then on the security

469
00:24:15,739 --> 00:24:17,259
side because they're not getting patches

470
00:24:17,259 --> 00:24:20,869
not talking to wsus as bad on the IT

471
00:24:20,869 --> 00:24:22,669
side why are that why it cannot talk to

472
00:24:22,669 --> 00:24:24,649
it

473
00:24:24,649 --> 00:24:26,389
the other thing PowerShell everyone

474
00:24:26,389 --> 00:24:29,090
loves to talk about how PowerShell can

475
00:24:29,090 --> 00:24:34,460
be used and abused I would say that you

476
00:24:34,460 --> 00:24:36,889
could probably in a small environment if

477
00:24:36,889 --> 00:24:39,519
you're using system on you can turn on

478
00:24:39,519 --> 00:24:43,519
PowerShell detection and just see what

479
00:24:43,519 --> 00:24:46,039
happens and you will be surprised

480
00:24:46,039 --> 00:24:51,200
probably that once you get rid of the

481
00:24:51,200 --> 00:24:52,639
alerts that are going to be based off of

482
00:24:52,639 --> 00:24:54,919
the things that the OS is doing nobody's

483
00:24:54,919 --> 00:24:56,020
using power

484
00:24:56,020 --> 00:24:58,690
developers are gonna use PowerShell you

485
00:24:58,690 --> 00:25:01,180
just put them into a category on their

486
00:25:01,180 --> 00:25:01,600
own

487
00:25:01,600 --> 00:25:03,820
um admins are gonna be using PowerShell

488
00:25:03,820 --> 00:25:06,880
put them on a category on their own in

489
00:25:06,880 --> 00:25:09,040
this case you've got a client

490
00:25:09,040 --> 00:25:13,110
why does Dropbox create a scheduled task

491
00:25:13,110 --> 00:25:17,680
to update itself and do you even know

492
00:25:17,680 --> 00:25:20,080
that that happens whenever they somebody

493
00:25:20,080 --> 00:25:23,860
puts drop Dropbox on their machine once

494
00:25:23,860 --> 00:25:25,570
you set up these rules you will start to

495
00:25:25,570 --> 00:25:28,080
detect you know why does this Intel

496
00:25:28,080 --> 00:25:32,590
graphics driver run PowerShell to talk

497
00:25:32,590 --> 00:25:34,330
out over the Internet

498
00:25:34,330 --> 00:25:36,720
doesn't you know doesn't make any sense

499
00:25:36,720 --> 00:25:39,190
actually they're just assuming that they

500
00:25:39,190 --> 00:25:40,900
can do whatever they want but it's your

501
00:25:40,900 --> 00:25:43,450
network so once you start alerting on it

502
00:25:43,450 --> 00:25:44,980
then you can make decisions about what

503
00:25:44,980 --> 00:25:49,960
you want to do alright so the overall

504
00:25:49,960 --> 00:25:51,700
thing is getting more endpoint

505
00:25:51,700 --> 00:25:56,170
visibility using built-in stuff those

506
00:25:56,170 --> 00:25:58,900
sec has a ton of alerts built in already

507
00:25:58,900 --> 00:26:02,620
like the group changes all that kind of

508
00:26:02,620 --> 00:26:07,590
stuff writing more rules for things like

509
00:26:07,620 --> 00:26:12,190
speed that windows changes occur right

510
00:26:12,190 --> 00:26:15,220
so you've got things like Windows

511
00:26:15,220 --> 00:26:20,110
Defender Network guard or whatever that

512
00:26:20,110 --> 00:26:21,660
stuff is going to get written to

513
00:26:21,660 --> 00:26:24,340
somewhere in the Windows Event log and

514
00:26:24,340 --> 00:26:26,410
if it's written to the event log then

515
00:26:26,410 --> 00:26:27,760
you can write an alert for it

516
00:26:27,760 --> 00:26:30,070
so once something comes out you figure

517
00:26:30,070 --> 00:26:33,340
out what B if event log entry is and

518
00:26:33,340 --> 00:26:36,340
write an alert the other thing that's

519
00:26:36,340 --> 00:26:38,020
going to happen by virtue of you doing

520
00:26:38,020 --> 00:26:39,580
this is that you're going to learn more

521
00:26:39,580 --> 00:26:42,190
about your network and you're going to

522
00:26:42,190 --> 00:26:46,000
have a ton of data so while you begin

523
00:26:46,000 --> 00:26:49,360
with using OSAC to get alerts you can

524
00:26:49,360 --> 00:26:52,120
also take all that event log data and

525
00:26:52,120 --> 00:26:55,060
start putting it into a sim once you get

526
00:26:55,060 --> 00:26:56,830
one or if you already have them on put

527
00:26:56,830 --> 00:26:59,740
it in there use elq security onion

528
00:26:59,740 --> 00:27:03,180
whatever whatever you want to use

529
00:27:03,180 --> 00:27:06,400
fortunately i'm almost out of time so

530
00:27:06,400 --> 00:27:08,720
i'm i will be

531
00:27:08,720 --> 00:27:13,850
you answer questions outside but I'm

532
00:27:13,850 --> 00:27:15,470
gonna ask y'all a couple of questions

533
00:27:15,470 --> 00:27:19,220
say that you can get these books Don

534
00:27:19,220 --> 00:27:21,320
Murdock who was in the back of the room

535
00:27:21,320 --> 00:27:24,500
and left has an excellent book called

536
00:27:24,500 --> 00:27:27,049
the blue team handbook incident response

537
00:27:27,049 --> 00:27:32,990
Edition so the first question that I'm

538
00:27:32,990 --> 00:27:36,080
gonna ask is about networking so it's

539
00:27:36,080 --> 00:27:38,740
it's not entry-level but it kind of is

540
00:27:38,740 --> 00:27:45,980
what protocols number is UDP gentleman

541
00:27:45,980 --> 00:27:49,150
in the orange shirt yeah you yep

542
00:27:49,150 --> 00:27:58,460
either either yeah one yeah 17 or 11

543
00:27:58,460 --> 00:28:03,320
depending on your number system all

544
00:28:03,320 --> 00:28:07,580
right so is there anyone in here that

545
00:28:07,580 --> 00:28:10,280
considers themselves to be a super

546
00:28:10,280 --> 00:28:16,580
Windows guru yeah all right well I'll

547
00:28:16,580 --> 00:28:17,840
ask this question and we'll see if

548
00:28:17,840 --> 00:28:23,320
anybody what all system

549
00:28:25,920 --> 00:28:28,800
be fully realized except for in

550
00:28:28,800 --> 00:28:36,900
partially sequel server that is not it

551
00:28:36,900 --> 00:28:42,900
but it's related to that and FS so who

552
00:28:42,900 --> 00:28:46,320
said that okay so it's actually Windows

553
00:28:46,320 --> 00:28:51,210
a future store with us re FS is the one

554
00:28:51,210 --> 00:28:55,650
that you can actually use but when FS I

555
00:28:55,650 --> 00:28:58,830
think gates identified as one of his

556
00:28:58,830 --> 00:29:03,540
biggest disappointments cuz it was being

557
00:29:03,540 --> 00:29:09,030
bit Vista kind of sucked but alright

558
00:29:09,030 --> 00:29:21,140
having one more thing what a big yes yep

559
00:29:21,140 --> 00:29:23,240
yep

560
00:29:23,240 --> 00:29:25,500
yeah actually has nothing to do with

561
00:29:25,500 --> 00:29:27,810
computers byte order or all that kind of

562
00:29:27,810 --> 00:29:32,280
stuff a lot of the old school computer

563
00:29:32,280 --> 00:29:35,430
Wizards were literary nerds lots of

564
00:29:35,430 --> 00:29:37,650
jokes and stuff like that so it actually

565
00:29:37,650 --> 00:29:41,400
comes from Gulliver's Travels alright so

566
00:29:41,400 --> 00:29:44,340
I want to thank you and thank besides

567
00:29:44,340 --> 00:29:47,250
Augusta and like I said I'll be outside

568
00:29:47,250 --> 00:29:50,430
if y'all want to talk about this and I'm

569
00:29:50,430 --> 00:29:54,690
on Twitter the Twitter's fr Columba or

570
00:29:54,690 --> 00:29:55,740
you can email me at

571
00:29:55,740 --> 00:29:58,830
InfoSec at epicycle org

572
00:29:58,830 --> 00:30:07,349
[Applause]

