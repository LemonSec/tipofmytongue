1
00:00:11,040 --> 00:00:14,340
everybody to characteristics of emotech

2
00:00:14,340 --> 00:00:17,039
infections I am Brad Duncan I'm a threat

3
00:00:17,039 --> 00:00:18,779
intelligence analyst with Palo Alto

4
00:00:18,779 --> 00:00:22,320
networks unit 42 team uh I also

5
00:00:22,320 --> 00:00:24,180
volunteer for the internet Storm Center

6
00:00:24,180 --> 00:00:28,260
do some Diaries their infosec blogs for

7
00:00:28,260 --> 00:00:31,320
lack of a better term I tweet at malware

8
00:00:31,320 --> 00:00:33,480
underscore traffic on Twitter usually

9
00:00:33,480 --> 00:00:36,540
very dry boring technical tweets every

10
00:00:36,540 --> 00:00:37,980
once in a while I'll post a meme or

11
00:00:37,980 --> 00:00:42,500
something and then I'll post a lot of

12
00:00:42,500 --> 00:00:45,360
pcapp and malware samples to my blog at

13
00:00:45,360 --> 00:00:50,160
malware traffic Dash analysis.net

14
00:00:50,160 --> 00:00:52,879
foreign

15
00:00:54,559 --> 00:00:58,020
it's interesting when I submitted this

16
00:00:58,020 --> 00:00:59,219
proposal

17
00:00:59,219 --> 00:01:02,399
for this talk to the committee imotet

18
00:01:02,399 --> 00:01:07,380
was active and very much uh daily uh

19
00:01:07,380 --> 00:01:11,040
spammer where we would get various email

20
00:01:11,040 --> 00:01:14,180
examples for emotech on a daily basis

21
00:01:14,180 --> 00:01:16,500
submitted to virus total and I would see

22
00:01:16,500 --> 00:01:21,840
it in my spam traps and now it's uh

23
00:01:21,840 --> 00:01:24,479
since about mid-july it's been quiet the

24
00:01:24,479 --> 00:01:26,640
botnet the infrastructure behind

25
00:01:26,640 --> 00:01:29,640
neemotet is still there it's still alive

26
00:01:29,640 --> 00:01:32,040
it's still occasionally doing things but

27
00:01:32,040 --> 00:01:34,579
it's not spamming so this

28
00:01:34,579 --> 00:01:38,280
emotec is uh what I would call dormant

29
00:01:38,280 --> 00:01:40,500
right now

30
00:01:40,500 --> 00:01:43,140
but we'll look at what emoted is

31
00:01:43,140 --> 00:01:45,840
um I'll describe how my lab environment

32
00:01:45,840 --> 00:01:47,540
is set up

33
00:01:47,540 --> 00:01:51,119
to look at some examples of emotec

34
00:01:51,119 --> 00:01:53,520
infection traffic which is uh we'll have

35
00:01:53,520 --> 00:01:55,619
two examples that we'll cover here and

36
00:01:55,619 --> 00:01:58,619
then other malware that is active that's

37
00:01:58,619 --> 00:02:01,740
kind of filling that hole that emotec

38
00:02:01,740 --> 00:02:04,259
left has left open since it's gone

39
00:02:04,259 --> 00:02:06,799
dormant

40
00:02:06,920 --> 00:02:10,679
so originally discovered in 2014

41
00:02:10,679 --> 00:02:15,060
the emotech is uh was first a banking

42
00:02:15,060 --> 00:02:16,980
Trojan discovered as a banking Trojan

43
00:02:16,980 --> 00:02:19,620
and it's kind of morphed uh it's a what

44
00:02:19,620 --> 00:02:21,959
we call a modular malware which means

45
00:02:21,959 --> 00:02:25,620
that uh um it has functions that are

46
00:02:25,620 --> 00:02:27,720
sent as separate modules from the

47
00:02:27,720 --> 00:02:29,879
initial infection so for example you

48
00:02:29,879 --> 00:02:33,599
have a Spam bot module that will usually

49
00:02:33,599 --> 00:02:36,360
appear in my lab environment we'll see

50
00:02:36,360 --> 00:02:39,300
it uh spam bot activity happen on an

51
00:02:39,300 --> 00:02:41,640
infected Windows host approximately 30

52
00:02:41,640 --> 00:02:43,800
to 45 minutes after the initial

53
00:02:43,800 --> 00:02:45,480
infection

54
00:02:45,480 --> 00:02:48,300
but uh it is back door it is a spam bot

55
00:02:48,300 --> 00:02:52,080
and it does uh provide follow-up malware

56
00:02:52,080 --> 00:02:54,780
usually Cobalt strike but we've uh we've

57
00:02:54,780 --> 00:02:59,040
seen other types of malware as well this

58
00:02:59,040 --> 00:03:01,140
the Cobalt strength ties in with the

59
00:03:01,140 --> 00:03:03,900
emotec being an initial access broker

60
00:03:03,900 --> 00:03:06,239
which means the criminal group behind

61
00:03:06,239 --> 00:03:08,420
emotet likes to

62
00:03:08,420 --> 00:03:11,580
make extra money I guess by selling

63
00:03:11,580 --> 00:03:14,280
access to the hosts the infected Windows

64
00:03:14,280 --> 00:03:17,040
hosts that are part of its botnet and

65
00:03:17,040 --> 00:03:19,500
then these other criminals will use

66
00:03:19,500 --> 00:03:21,900
Cobalt strike to then map out the

67
00:03:21,900 --> 00:03:23,220
environment

68
00:03:23,220 --> 00:03:26,280
and uh see if there's anything of a high

69
00:03:26,280 --> 00:03:28,800
value Target and then usually it'll drop

70
00:03:28,800 --> 00:03:31,680
ransomware uh whoever the

71
00:03:31,680 --> 00:03:35,159
additional criminal is so

72
00:03:35,159 --> 00:03:37,140
uh when you hear stories about Conti

73
00:03:37,140 --> 00:03:39,959
ransomware uh attacks in the past year

74
00:03:39,959 --> 00:03:41,940
or so some of those can be directly

75
00:03:41,940 --> 00:03:44,819
attributed to an initial imhotet

76
00:03:44,819 --> 00:03:49,980
infection by someone who was tricked by

77
00:03:49,980 --> 00:03:54,200
a emoted Spam body email

78
00:03:54,959 --> 00:03:58,080
so there are currently two emoted

79
00:03:58,080 --> 00:04:01,680
botnets they act exactly the same I'm

80
00:04:01,680 --> 00:04:04,319
not sure how certain people who track

81
00:04:04,319 --> 00:04:06,299
these things uh separate these two

82
00:04:06,299 --> 00:04:09,239
botnets out they call it epoch4 for one

83
00:04:09,239 --> 00:04:11,700
botnet Epoch five for the other botnet

84
00:04:11,700 --> 00:04:13,739
the reason they call it four and five is

85
00:04:13,739 --> 00:04:17,699
because before the 2021 takedown of

86
00:04:17,699 --> 00:04:19,798
emotech where it was gone for about 11

87
00:04:19,798 --> 00:04:22,560
months came back in November of last

88
00:04:22,560 --> 00:04:25,500
year before that

89
00:04:25,500 --> 00:04:28,020
uh absence there were three botnets and

90
00:04:28,020 --> 00:04:30,240
they were called Epoch one Epoch II and

91
00:04:30,240 --> 00:04:32,880
Epoch three uh just nicknames by

92
00:04:32,880 --> 00:04:36,360
security researchers uh for the

93
00:04:36,360 --> 00:04:39,060
infrastructure behind emoted

94
00:04:39,060 --> 00:04:42,960
uh in recent years as I've said imotet

95
00:04:42,960 --> 00:04:45,900
infections have been publicly documented

96
00:04:45,900 --> 00:04:50,699
as leading to ransomware now here is the

97
00:04:50,699 --> 00:04:53,820
chain of events for atypical emotec

98
00:04:53,820 --> 00:04:56,040
infection for the last few months last

99
00:04:56,040 --> 00:04:58,620
two or three months

100
00:04:58,620 --> 00:05:00,900
it was consistently something like this

101
00:05:00,900 --> 00:05:05,759
before it went quiet in mid-july 2022.

102
00:05:05,759 --> 00:05:07,680
so you would have a thread hijacked

103
00:05:07,680 --> 00:05:09,360
email and sometimes these emails

104
00:05:09,360 --> 00:05:11,340
wouldn't be threat hijacked but they're

105
00:05:11,340 --> 00:05:14,460
always impersonating somebody

106
00:05:14,460 --> 00:05:17,360
some stolen email address

107
00:05:17,360 --> 00:05:20,780
that was taken from a previously

108
00:05:20,780 --> 00:05:23,520
emotec infected host because part of

109
00:05:23,520 --> 00:05:26,160
what emotec does when it affects a

110
00:05:26,160 --> 00:05:28,380
Windows host is if you have a email

111
00:05:28,380 --> 00:05:31,199
client like Outlook or Thunderbird and

112
00:05:31,199 --> 00:05:33,660
you've got a bunch of emails in there

113
00:05:33,660 --> 00:05:35,520
it will take that information and we'll

114
00:05:35,520 --> 00:05:38,639
send it up to the botnet and then the uh

115
00:05:38,639 --> 00:05:41,940
emote botnet that infrastructure will

116
00:05:41,940 --> 00:05:44,039
regurgitate that information and use it

117
00:05:44,039 --> 00:05:47,520
for thread hijacked emails impersonating

118
00:05:47,520 --> 00:05:50,880
a legitimate a sender and including

119
00:05:50,880 --> 00:05:54,080
those email chains

120
00:05:54,600 --> 00:05:57,120
but these emails

121
00:05:57,120 --> 00:05:58,500
um

122
00:05:58,500 --> 00:06:00,419
for the last two or three months before

123
00:06:00,419 --> 00:06:02,880
it went silent always contained

124
00:06:02,880 --> 00:06:05,759
attachments so it was either a password

125
00:06:05,759 --> 00:06:08,280
protected zip archive sometimes not

126
00:06:08,280 --> 00:06:10,199
password protected but mostly password

127
00:06:10,199 --> 00:06:13,620
protected that contain an Excel

128
00:06:13,620 --> 00:06:15,360
spreadsheet a Microsoft Excel

129
00:06:15,360 --> 00:06:19,620
spreadsheet specially crafted to with a

130
00:06:19,620 --> 00:06:22,199
macro with malicious code designed to

131
00:06:22,199 --> 00:06:27,479
infect a vulnerable computer with emotec

132
00:06:27,479 --> 00:06:31,500
a vulnerable computer and a victim would

133
00:06:31,500 --> 00:06:33,840
enable macros on a vulnerable Windows

134
00:06:33,840 --> 00:06:36,240
host and that would generate traffic to

135
00:06:36,240 --> 00:06:38,660
retrieve a Windows binary

136
00:06:38,660 --> 00:06:42,600
Windows dll File in this case for emotec

137
00:06:42,600 --> 00:06:44,580
and it would run it on the infected

138
00:06:44,580 --> 00:06:47,539
Windows host now you would see traffic

139
00:06:47,539 --> 00:06:50,000
wouldn't be just one

140
00:06:50,000 --> 00:06:54,600
HTTP or HTTP request it'd usually be

141
00:06:54,600 --> 00:06:57,960
about three or four or five URLs that

142
00:06:57,960 --> 00:07:01,979
would retrieve emotec dlls and this

143
00:07:01,979 --> 00:07:06,318
would be a redundancy because

144
00:07:06,720 --> 00:07:09,319
these URLs will change frequently

145
00:07:09,319 --> 00:07:12,419
because they're easily detectable as

146
00:07:12,419 --> 00:07:14,280
hosting malware they'll get taken

147
00:07:14,280 --> 00:07:16,560
offline

148
00:07:16,560 --> 00:07:19,560
so therefore you have usually four or

149
00:07:19,560 --> 00:07:22,560
five different URLs that are all

150
00:07:22,560 --> 00:07:26,160
triggered to retrieve an emotec dll and

151
00:07:26,160 --> 00:07:28,139
hopefully one of them will still be

152
00:07:28,139 --> 00:07:30,419
active

153
00:07:30,419 --> 00:07:33,300
and then once the motet dll is run

154
00:07:33,300 --> 00:07:35,039
that's when we start seeing the command

155
00:07:35,039 --> 00:07:38,039
control traffic to servers on the IMO 10

156
00:07:38,039 --> 00:07:40,979
botnet and then from there you see the

157
00:07:40,979 --> 00:07:42,720
follow-up activity like spam bot

158
00:07:42,720 --> 00:07:45,240
activity or Cobalt strike from what I've

159
00:07:45,240 --> 00:07:47,940
seen in my lab and then possibly in a

160
00:07:47,940 --> 00:07:50,099
worst case scenario something like

161
00:07:50,099 --> 00:07:52,979
ransomware

162
00:07:52,979 --> 00:07:55,919
so here's an example of an email that

163
00:07:55,919 --> 00:07:59,039
has a password protected zip archive as

164
00:07:59,039 --> 00:08:01,440
an attachment and this is a thread

165
00:08:01,440 --> 00:08:06,120
hijacked email between it was stolen on

166
00:08:06,120 --> 00:08:09,720
a formerly infected Windows host that I

167
00:08:09,720 --> 00:08:11,759
infected with emotec my lab environment

168
00:08:11,759 --> 00:08:15,300
I'll populate my mail client with emails

169
00:08:15,300 --> 00:08:18,000
back and forth between email accounts

170
00:08:18,000 --> 00:08:19,259
that I control

171
00:08:19,259 --> 00:08:23,699
and one of them was a in this case it

172
00:08:23,699 --> 00:08:28,259
was Gmail account that I used uh named

173
00:08:28,259 --> 00:08:31,680
with a nickname Dom uh don Bertram

174
00:08:31,680 --> 00:08:35,640
and what we do here and Martin uh

175
00:08:35,640 --> 00:08:38,219
somebody I forget was the name of the

176
00:08:38,219 --> 00:08:40,260
recipient I've got everything shaded out

177
00:08:40,260 --> 00:08:42,979
here because I'm not going to share my

178
00:08:42,979 --> 00:08:46,620
honey pot email addresses with you guys

179
00:08:46,620 --> 00:08:48,899
at least not publicly

180
00:08:48,899 --> 00:08:51,480
so if anybody's curious you can ask me

181
00:08:51,480 --> 00:08:53,160
about there is a couple I will share

182
00:08:53,160 --> 00:08:55,980
publicly here in this presentation but

183
00:08:55,980 --> 00:08:59,820
those are considered burned

184
00:08:59,820 --> 00:09:02,760
we have a uh you can't see it because I

185
00:09:02,760 --> 00:09:04,560
haven't scrolled down but we have uh the

186
00:09:04,560 --> 00:09:06,540
legitimate email chain between these two

187
00:09:06,540 --> 00:09:09,779
email accounts that I control

188
00:09:09,779 --> 00:09:13,140
that I've set up and uh it says hello

189
00:09:13,140 --> 00:09:16,800
Martin archive password 723 have a great

190
00:09:16,800 --> 00:09:18,839
day Don Bertram

191
00:09:18,839 --> 00:09:21,420
and then whatever you know great work on

192
00:09:21,420 --> 00:09:22,980
this morning's presentation whatever

193
00:09:22,980 --> 00:09:26,240
that email chain was

194
00:09:26,820 --> 00:09:30,120
now if you guys got an email like this

195
00:09:30,120 --> 00:09:32,940
from someone that you knew or at least

196
00:09:32,940 --> 00:09:34,380
that claimed to be some though from

197
00:09:34,380 --> 00:09:36,480
someone that you knew this would be uh

198
00:09:36,480 --> 00:09:38,940
relatively easy to detect uh just

199
00:09:38,940 --> 00:09:40,500
because if you look at the from line of

200
00:09:40,500 --> 00:09:43,260
this it says Don Bertram as the name or

201
00:09:43,260 --> 00:09:44,820
the nickname but if you look at the

202
00:09:44,820 --> 00:09:46,920
email that is not Dom Bertram's Gmail

203
00:09:46,920 --> 00:09:50,600
account email it is uh

204
00:09:50,600 --> 00:09:53,959
something.it is an Italian

205
00:09:53,959 --> 00:09:58,640
email provider an Italian email address

206
00:09:59,779 --> 00:10:03,660
you open that password protected zip

207
00:10:03,660 --> 00:10:06,899
archive and then within that password

208
00:10:06,899 --> 00:10:09,180
protected zip archive there is an Excel

209
00:10:09,180 --> 00:10:11,940
spreadsheet that Excel spreadsheet for

210
00:10:11,940 --> 00:10:14,160
the last two or three months at emotech

211
00:10:14,160 --> 00:10:16,980
was actively spamming was sending out

212
00:10:16,980 --> 00:10:18,959
Excel spreadsheets that looked exactly

213
00:10:18,959 --> 00:10:20,640
like this

214
00:10:20,640 --> 00:10:23,339
um I think uh sometimes the the little

215
00:10:23,339 --> 00:10:25,200
gray shaded area with the warning would

216
00:10:25,200 --> 00:10:28,260
be yellow or to be pink but it it would

217
00:10:28,260 --> 00:10:30,120
look exactly the same and you'll notice

218
00:10:30,120 --> 00:10:33,720
that there are seven spreadsheets tabs

219
00:10:33,720 --> 00:10:37,260
in this particular spreadsheet

220
00:10:37,260 --> 00:10:40,680
and if you look at the workbook

221
00:10:40,680 --> 00:10:43,800
properties you'll see a couple of uh

222
00:10:43,800 --> 00:10:46,079
consistent things like the author I

223
00:10:46,079 --> 00:10:49,860
think was always in this case dream

224
00:10:49,860 --> 00:10:51,180
and

225
00:10:51,180 --> 00:10:52,079
um

226
00:10:52,079 --> 00:10:54,360
last modified I don't know I think they

227
00:10:54,360 --> 00:10:57,180
were all RGS sgk but the thing with this

228
00:10:57,180 --> 00:11:00,000
is the work the sheets in the workbook

229
00:11:00,000 --> 00:11:02,220
were all protected

230
00:11:02,220 --> 00:11:05,160
so I can't go in and look at the macro

231
00:11:05,160 --> 00:11:08,100
code for this particular spreadsheet

232
00:11:08,100 --> 00:11:10,440
without knowing whatever password that

233
00:11:10,440 --> 00:11:12,779
was used to protect these particular

234
00:11:12,779 --> 00:11:15,360
sheets in this workbook

235
00:11:15,360 --> 00:11:18,779
so the only easy way quick and easy way

236
00:11:18,779 --> 00:11:20,940
for me to figure out what what those

237
00:11:20,940 --> 00:11:24,420
URLs is is to detonate it in a

238
00:11:24,420 --> 00:11:28,399
environment or a sandbox

239
00:11:28,620 --> 00:11:31,140
So speaking of lab environments we'll

240
00:11:31,140 --> 00:11:33,180
look at my lab environment that I will

241
00:11:33,180 --> 00:11:35,579
use to

242
00:11:35,579 --> 00:11:39,480
um detonate emotent malware to check it

243
00:11:39,480 --> 00:11:42,000
in the environment now I will use active

244
00:11:42,000 --> 00:11:44,220
directory environments a lot of

245
00:11:44,220 --> 00:11:47,160
sandboxes especially the free ones or

246
00:11:47,160 --> 00:11:49,519
relatively cheap ones that are available

247
00:11:49,519 --> 00:11:52,320
even a lot of the

248
00:11:52,320 --> 00:11:54,899
Enterprise solutions for example Palo

249
00:11:54,899 --> 00:11:58,560
Alto networks has a live type of sandbox

250
00:11:58,560 --> 00:12:01,260
environment called Wildfire but that's a

251
00:12:01,260 --> 00:12:04,380
single Standalone Windows host right or

252
00:12:04,380 --> 00:12:06,060
maybe it's running them on two different

253
00:12:06,060 --> 00:12:09,000
ones you know one Windows 10 one maybe

254
00:12:09,000 --> 00:12:11,579
Windows 7 or something like that but

255
00:12:11,579 --> 00:12:13,920
it's not an active directory environment

256
00:12:13,920 --> 00:12:16,019
I like to use active directory

257
00:12:16,019 --> 00:12:18,959
environments because that's how you see

258
00:12:18,959 --> 00:12:21,120
Cobalt strike

259
00:12:21,120 --> 00:12:24,600
so a malware like emotec or cacbot or

260
00:12:24,600 --> 00:12:25,760
iced ID

261
00:12:25,760 --> 00:12:30,180
is not going to send Cobalt strike to

262
00:12:30,180 --> 00:12:33,360
sell that access to that host to an

263
00:12:33,360 --> 00:12:35,459
initial access broker because a

264
00:12:35,459 --> 00:12:37,680
standalone Windows host is generally not

265
00:12:37,680 --> 00:12:41,040
part of a high value Target right you

266
00:12:41,040 --> 00:12:42,540
want an active directory environment

267
00:12:42,540 --> 00:12:45,959
with hundreds of clients and various

268
00:12:45,959 --> 00:12:48,120
interesting servers that could be uh

269
00:12:48,120 --> 00:12:50,839
that could be either exploited or

270
00:12:50,839 --> 00:12:53,519
targeted for ransomware

271
00:12:53,519 --> 00:12:55,800
but uh what I'll generally do in a

272
00:12:55,800 --> 00:12:58,019
virtualized environment in this MacBook

273
00:12:58,019 --> 00:13:01,139
that I have here for example I'm running

274
00:13:01,139 --> 00:13:03,240
either

275
00:13:03,240 --> 00:13:08,100
VMware Fusion or virtualbox those are

276
00:13:08,100 --> 00:13:10,860
two of them on a Linux host I can run

277
00:13:10,860 --> 00:13:15,720
the KVM system in qemu I've tried that

278
00:13:15,720 --> 00:13:18,180
before with uh with the relatively good

279
00:13:18,180 --> 00:13:20,180
success

280
00:13:20,180 --> 00:13:22,220
and then

281
00:13:22,220 --> 00:13:26,339
those are generally it I do have a

282
00:13:26,339 --> 00:13:29,100
physical environment that I'll use for

283
00:13:29,100 --> 00:13:31,079
certain families of malware that are

284
00:13:31,079 --> 00:13:35,279
very resistant to running properly in a

285
00:13:35,279 --> 00:13:38,399
virtual environment so instead of uh I'm

286
00:13:38,399 --> 00:13:42,360
not I'm not as technically proficient as

287
00:13:42,360 --> 00:13:45,200
some people who can alter their virtual

288
00:13:45,200 --> 00:13:48,839
environments to disguise the fact that

289
00:13:48,839 --> 00:13:51,180
they're virtual right so I I just it's

290
00:13:51,180 --> 00:13:54,600
easier for me just to you know pick up a

291
00:13:54,600 --> 00:13:57,120
couple of laptops on eBay and an old

292
00:13:57,120 --> 00:13:59,339
Cisco switch and you know just set up an

293
00:13:59,339 --> 00:14:02,160
environment in my home lab and this is

294
00:14:02,160 --> 00:14:05,399
how I do it here plus the benefit of

295
00:14:05,399 --> 00:14:08,579
having a physical setup like this

296
00:14:08,579 --> 00:14:10,980
is that you can add as many windows

297
00:14:10,980 --> 00:14:14,459
clients as you have ports in your switch

298
00:14:14,459 --> 00:14:17,700
and then I could usually just do a span

299
00:14:17,700 --> 00:14:22,019
port on a Cisco switch to any one of

300
00:14:22,019 --> 00:14:23,880
those clients if I'm detonating what's

301
00:14:23,880 --> 00:14:25,440
that on there I can just span that Port

302
00:14:25,440 --> 00:14:27,899
into another Port where I'm monitoring

303
00:14:27,899 --> 00:14:30,839
it on a computer that I'm using TCB dump

304
00:14:30,839 --> 00:14:35,360
or Wireshark to record the pcap

305
00:14:35,360 --> 00:14:38,399
I like to have fun with my virtual

306
00:14:38,399 --> 00:14:42,860
environments it's not all just uh

307
00:14:42,860 --> 00:14:45,300
monotonous although there is monotony

308
00:14:45,300 --> 00:14:47,880
and routine although it is routine uh

309
00:14:47,880 --> 00:14:49,740
stuff that I do every day I'd like to

310
00:14:49,740 --> 00:14:53,120
have a little fun so uh for example uh

311
00:14:53,120 --> 00:14:55,740
for a while there a short while I was

312
00:14:55,740 --> 00:14:58,139
using an environment uh that was Batman

313
00:14:58,139 --> 00:15:00,959
and Robin right so

314
00:15:00,959 --> 00:15:04,740
um this is not the this is not the

315
00:15:04,740 --> 00:15:07,380
modern Batman right the the the guy

316
00:15:07,380 --> 00:15:10,260
that's facing the whispery deep voice

317
00:15:10,260 --> 00:15:13,680
this is the Adam West Batman of the late

318
00:15:13,680 --> 00:15:17,699
1960s uh with uh Adam West and Bert Ward

319
00:15:17,699 --> 00:15:21,540
right so this is uh Batman would use

320
00:15:21,540 --> 00:15:24,180
aol.com right he's a little older

321
00:15:24,180 --> 00:15:27,959
generation uh and then Robin who's a

322
00:15:27,959 --> 00:15:29,820
little more young a little more hip he

323
00:15:29,820 --> 00:15:31,380
would use something relatively newer

324
00:15:31,380 --> 00:15:33,600
like Yahoo

325
00:15:33,600 --> 00:15:36,240
at least that's the way I see it

326
00:15:36,240 --> 00:15:37,380
um

327
00:15:37,380 --> 00:15:39,180
so I'll come up with these conversations

328
00:15:39,180 --> 00:15:41,820
off the top of my head uh this is uh

329
00:15:41,820 --> 00:15:43,560
this is one of the an example of the

330
00:15:43,560 --> 00:15:47,279
emails that I'll send where um and I try

331
00:15:47,279 --> 00:15:50,040
and imitate the Adam West uh version of

332
00:15:50,040 --> 00:15:52,320
Batman uh vocally but it doesn't work

333
00:15:52,320 --> 00:15:55,019
out it sounds more like the Christopher

334
00:15:55,019 --> 00:15:57,779
Lloyd character uh Doc in Back to the

335
00:15:57,779 --> 00:15:59,600
Future it's like

336
00:15:59,600 --> 00:16:02,399
we gotta defeat the Joker it doesn't

337
00:16:02,399 --> 00:16:04,620
sound anything like Adam West

338
00:16:04,620 --> 00:16:07,980
but this is type of emails that uh that

339
00:16:07,980 --> 00:16:09,660
all Less in between these two accounts

340
00:16:09,660 --> 00:16:13,019
I'm using Thunderbird to uh

341
00:16:13,019 --> 00:16:13,760
to

342
00:16:13,760 --> 00:16:18,120
uh as the email client in my environment

343
00:16:18,120 --> 00:16:21,240
and you can see uh what I have up here

344
00:16:21,240 --> 00:16:24,180
uh I started near the end of June I had

345
00:16:24,180 --> 00:16:25,380
this going for a couple of weeks those

346
00:16:25,380 --> 00:16:27,000
accounts are still there though so feel

347
00:16:27,000 --> 00:16:30,000
free feel free to send anything you want

348
00:16:30,000 --> 00:16:33,980
to any of these emails

349
00:16:34,139 --> 00:16:36,300
doubt I'll be I'll doubt I'll be using

350
00:16:36,300 --> 00:16:38,880
it much after today

351
00:16:38,880 --> 00:16:41,279
but uh you can see some of these emails

352
00:16:41,279 --> 00:16:43,680
have attachments and they're uh they're

353
00:16:43,680 --> 00:16:45,720
all reply based emails these are thread

354
00:16:45,720 --> 00:16:47,579
hijacked emails

355
00:16:47,579 --> 00:16:50,459
um I I shouldn't say thread hijacked

356
00:16:50,459 --> 00:16:53,399
emails uh sometimes that are not exactly

357
00:16:53,399 --> 00:16:57,320
thread hijacked like this one

358
00:16:57,360 --> 00:17:00,480
so yeah it's uh

359
00:17:00,480 --> 00:17:02,519
please open the attached document it's

360
00:17:02,519 --> 00:17:05,699
got a Excel spreadsheet and this is

361
00:17:05,699 --> 00:17:08,760
emotech right and uh but there is no uh

362
00:17:08,760 --> 00:17:10,980
email chain on this one

363
00:17:10,980 --> 00:17:16,619
the subject is r e and then the

364
00:17:16,619 --> 00:17:20,280
the uh recipient's email address

365
00:17:20,280 --> 00:17:24,119
and there uh there is no actual

366
00:17:24,119 --> 00:17:26,939
uh legitimate email chain that has gone

367
00:17:26,939 --> 00:17:28,740
back and forth here so we'll kind of see

368
00:17:28,740 --> 00:17:31,080
that sometimes with emotec it will just

369
00:17:31,080 --> 00:17:33,360
uh put your email address to kind of

370
00:17:33,360 --> 00:17:37,440
pretend that there was a conversation

371
00:17:37,440 --> 00:17:40,620
anyway the attachment whether it's a

372
00:17:40,620 --> 00:17:42,299
within a zip archive that's password

373
00:17:42,299 --> 00:17:44,580
protected or whether it's directly

374
00:17:44,580 --> 00:17:47,640
attached to the email itself is the same

375
00:17:47,640 --> 00:17:50,160
type of Excel spreadsheet that we looked

376
00:17:50,160 --> 00:17:52,640
at earlier

377
00:17:52,679 --> 00:17:55,400
now

378
00:17:55,440 --> 00:17:58,620
this exact email

379
00:17:58,620 --> 00:18:02,160
from July 11th

380
00:18:02,160 --> 00:18:04,740
with this exact attachment

381
00:18:04,740 --> 00:18:07,260
I ran it earlier this week

382
00:18:07,260 --> 00:18:09,660
remember how I said there's uh usually

383
00:18:09,660 --> 00:18:11,880
four or five urls

384
00:18:11,880 --> 00:18:14,820
that are generated after by the macro

385
00:18:14,820 --> 00:18:18,419
code in that malicious document well we

386
00:18:18,419 --> 00:18:20,960
do have

387
00:18:21,179 --> 00:18:28,100
we do have https and HTTP based urls

388
00:18:28,100 --> 00:18:31,860
and one of those actually worked

389
00:18:31,860 --> 00:18:34,980
one of the HTTP URLs now what's

390
00:18:34,980 --> 00:18:37,020
interesting here

391
00:18:37,020 --> 00:18:39,780
is uh when I ran this just through my

392
00:18:39,780 --> 00:18:42,900
home internet to check my internet

393
00:18:42,900 --> 00:18:45,360
service provider it was blocked

394
00:18:45,360 --> 00:18:47,880
so I tethered through my phone

395
00:18:47,880 --> 00:18:50,640
and my phone allowed this to that

396
00:18:50,640 --> 00:18:51,900
internet connection through my phone

397
00:18:51,900 --> 00:18:54,900
allowed this this Windows dll to come

398
00:18:54,900 --> 00:18:58,020
through right this is this is a URL that

399
00:18:58,020 --> 00:19:01,140
has been hosting malware since as early

400
00:19:01,140 --> 00:19:02,600
as

401
00:19:02,600 --> 00:19:05,400
July 11th

402
00:19:05,400 --> 00:19:08,520
and it's still active

403
00:19:08,520 --> 00:19:10,980
all right it took that URL

404
00:19:10,980 --> 00:19:14,100
that macro code from that malicious uh

405
00:19:14,100 --> 00:19:17,100
Microsoft Excel document and it saved it

406
00:19:17,100 --> 00:19:20,520
saves it to a under the infected users

407
00:19:20,520 --> 00:19:23,400
app data local directory it creates a

408
00:19:23,400 --> 00:19:25,919
new directory of random alphabetic

409
00:19:25,919 --> 00:19:27,419
characters

410
00:19:27,419 --> 00:19:31,020
and it saves it and it runs it and it

411
00:19:31,020 --> 00:19:33,660
remains persistent through a Windows

412
00:19:33,660 --> 00:19:35,940
registry update through the most

413
00:19:35,940 --> 00:19:37,940
commonly used

414
00:19:37,940 --> 00:19:40,559
Windows registry update to keep malware

415
00:19:40,559 --> 00:19:44,880
persistent it's the hkey current user

416
00:19:44,880 --> 00:19:46,919
software Microsoft Windows current

417
00:19:46,919 --> 00:19:49,980
version run that particular you know

418
00:19:49,980 --> 00:19:54,799
under the HK CU registry hive

419
00:19:55,440 --> 00:19:57,679
and red server

420
00:19:57,679 --> 00:20:00,539
32.exe is what is used to run it so it

421
00:20:00,539 --> 00:20:03,000
doesn't have an entry point like you

422
00:20:03,000 --> 00:20:07,440
would use if you were using run dll32

423
00:20:08,160 --> 00:20:10,799
so with that in mind let's take a look

424
00:20:10,799 --> 00:20:14,880
at our first example now the Wireshark

425
00:20:14,880 --> 00:20:17,160
displays that are showing here that I'm

426
00:20:17,160 --> 00:20:18,419
showing here and there are some of you

427
00:20:18,419 --> 00:20:20,299
that I see that have uh

428
00:20:20,299 --> 00:20:22,559
participated in the workshop that I ran

429
00:20:22,559 --> 00:20:25,679
earlier this week it is my customized

430
00:20:25,679 --> 00:20:28,860
Wireshark column display all right and

431
00:20:28,860 --> 00:20:30,960
you can find out how to set that up in

432
00:20:30,960 --> 00:20:33,780
the same way that I use it by looking at

433
00:20:33,780 --> 00:20:36,419
the Wireshark Workshop videos that I

434
00:20:36,419 --> 00:20:39,120
have posted through my employer Palo

435
00:20:39,120 --> 00:20:41,160
Alto networks if you Google Wireshark

436
00:20:41,160 --> 00:20:42,960
Workshop Duncan you should find that

437
00:20:42,960 --> 00:20:46,740
link to all that has a Palo Alto

438
00:20:46,740 --> 00:20:49,799
networks page that is on my blog posts

439
00:20:49,799 --> 00:20:51,840
and articles

440
00:20:51,840 --> 00:20:53,880
through the company

441
00:20:53,880 --> 00:20:56,100
that I've used to do that now this first

442
00:20:56,100 --> 00:20:58,440
infection example

443
00:20:58,440 --> 00:21:02,100
is from the 7th of June

444
00:21:02,100 --> 00:21:06,600
so I've posted the traffic online at my

445
00:21:06,600 --> 00:21:10,140
malware trafficanalysis.net blog I did a

446
00:21:10,140 --> 00:21:15,539
tweet about it through the unit 42 Intel

447
00:21:15,539 --> 00:21:17,039
handle

448
00:21:17,039 --> 00:21:19,740
on Twitter dumpsterfire though Twitter

449
00:21:19,740 --> 00:21:24,419
is it is it is very useful you may have

450
00:21:24,419 --> 00:21:27,059
heard of the term infosec Twitter that's

451
00:21:27,059 --> 00:21:30,840
uh that is a thing figure about anywhere

452
00:21:30,840 --> 00:21:33,200
from 50 to 100

453
00:21:33,200 --> 00:21:36,419
Twitter accounts that that are primarily

454
00:21:36,419 --> 00:21:39,059
geared towards tweeting

455
00:21:39,059 --> 00:21:42,419
or retweeting technical information now

456
00:21:42,419 --> 00:21:46,500
granted the unit 42 Intel handles uh

457
00:21:46,500 --> 00:21:48,000
specifically you know it's doing more

458
00:21:48,000 --> 00:21:50,280
than just these type of tweets it's a

459
00:21:50,280 --> 00:21:52,320
little promotional as well and promoting

460
00:21:52,320 --> 00:21:55,500
the unit 42 blog and everything but uh

461
00:21:55,500 --> 00:21:58,559
my particular uh you know I'll retweet

462
00:21:58,559 --> 00:22:00,659
this through my Twitter handle as well

463
00:22:00,659 --> 00:22:02,640
the at malware underscore traffic

464
00:22:02,640 --> 00:22:05,700
there's a lot of people on Twitter like

465
00:22:05,700 --> 00:22:07,980
I said about 50 to 100 that consistently

466
00:22:07,980 --> 00:22:12,080
tweet technical details

467
00:22:12,980 --> 00:22:16,559
but this particular pcap that is

468
00:22:16,559 --> 00:22:20,159
available on my blog site

469
00:22:20,159 --> 00:22:23,280
is an active directory environment

470
00:22:23,280 --> 00:22:28,799
and I'm using crypto punch.data as a uh

471
00:22:28,799 --> 00:22:31,440
as a domain that is not registered by

472
00:22:31,440 --> 00:22:33,720
the way I'll go through I'll go through

473
00:22:33,720 --> 00:22:36,059
a domain registrar just to check to make

474
00:22:36,059 --> 00:22:38,580
sure that whatever domains I'm setting

475
00:22:38,580 --> 00:22:40,440
up for my active directory environments

476
00:22:40,440 --> 00:22:44,280
are not already registered because I

477
00:22:44,280 --> 00:22:47,100
have posted information before on stuff

478
00:22:47,100 --> 00:22:49,980
that I didn't realize was registered by

479
00:22:49,980 --> 00:22:52,020
somebody and have got an email saying

480
00:22:52,020 --> 00:22:53,659
hey uh

481
00:22:53,659 --> 00:22:57,600
you uh you you're posting this uh

482
00:22:57,600 --> 00:23:00,179
information that implies that our

483
00:23:00,179 --> 00:23:03,179
network is compromised and uh they asked

484
00:23:03,179 --> 00:23:05,520
me to take it down and I can only say

485
00:23:05,520 --> 00:23:07,039
yes

486
00:23:07,039 --> 00:23:09,240
but this is the active directory

487
00:23:09,240 --> 00:23:10,919
environment

488
00:23:10,919 --> 00:23:14,580
I want to infect my an active directory

489
00:23:14,580 --> 00:23:16,980
environment with the emotec because if I

490
00:23:16,980 --> 00:23:19,799
don't I won't see Cobalt strike if they

491
00:23:19,799 --> 00:23:22,740
send it and it's about a 50 50 shot if

492
00:23:22,740 --> 00:23:24,240
they actually send it sometimes less

493
00:23:24,240 --> 00:23:26,520
than that depends on what time of the

494
00:23:26,520 --> 00:23:27,860
day

495
00:23:27,860 --> 00:23:30,840
U.S time wherever what time of the day

496
00:23:30,840 --> 00:23:34,080
that I am infecting a Windows host as to

497
00:23:34,080 --> 00:23:36,419
whether I might or might not see Cobalt

498
00:23:36,419 --> 00:23:38,720
strike

499
00:23:39,419 --> 00:23:42,200
foreign

500
00:23:42,299 --> 00:23:44,280
so I have this in Wireshark this

501
00:23:44,280 --> 00:23:45,720
particular P CAP

502
00:23:45,720 --> 00:23:49,500
from the 7th of June 2022

503
00:23:49,500 --> 00:23:54,000
there are two https URLs and one HTTP

504
00:23:54,000 --> 00:23:58,440
URL that that were generated by the

505
00:23:58,440 --> 00:24:04,039
Excel Macro for that emotec dll

506
00:24:05,400 --> 00:24:07,919
and those are here

507
00:24:07,919 --> 00:24:11,039
now we don't know what those uh two

508
00:24:11,039 --> 00:24:13,320
first two URLs are

509
00:24:13,320 --> 00:24:18,059
unless you submit the uh the malware to

510
00:24:18,059 --> 00:24:20,280
a Sandbox environment that has some sort

511
00:24:20,280 --> 00:24:23,039
of uh man in the middle set up to where

512
00:24:23,039 --> 00:24:25,380
you can uh

513
00:24:25,380 --> 00:24:28,500
decrypt that https traffic which is what

514
00:24:28,500 --> 00:24:31,460
I did in this case

515
00:24:32,940 --> 00:24:35,640
so the only one that we could look at

516
00:24:35,640 --> 00:24:38,100
that we could actually follow the TCP

517
00:24:38,100 --> 00:24:40,140
stream for and see if something was

518
00:24:40,140 --> 00:24:41,700
returned

519
00:24:41,700 --> 00:24:48,780
is uh visibly is that last HTTP URL

520
00:24:48,780 --> 00:24:51,059
so in Wireshark this is one of the first

521
00:24:51,059 --> 00:24:54,020
tricks that I learned as a analyst

522
00:24:54,020 --> 00:24:56,520
using Wireshark when I was first

523
00:24:56,520 --> 00:24:59,580
starting out was you follow the TCP

524
00:24:59,580 --> 00:25:02,220
Stream So you left click on that

525
00:25:02,220 --> 00:25:06,000
particular frame in your column display

526
00:25:06,000 --> 00:25:09,059
and you follow the TCP string bring up a

527
00:25:09,059 --> 00:25:12,000
menu and follow the TCP stream in this

528
00:25:12,000 --> 00:25:15,960
case this particular URL did not return

529
00:25:15,960 --> 00:25:17,840
anything

530
00:25:17,840 --> 00:25:22,919
so the emotec dll or dlls would have

531
00:25:22,919 --> 00:25:25,200
been through the https traffic that's

532
00:25:25,200 --> 00:25:27,480
not going to be available in the pcap if

533
00:25:27,480 --> 00:25:30,960
you go to that blog entry on my site I

534
00:25:30,960 --> 00:25:33,080
retrieve the two

535
00:25:33,080 --> 00:25:35,700
dlls that were actually retrieved over

536
00:25:35,700 --> 00:25:38,640
https from the infected Windows host

537
00:25:38,640 --> 00:25:41,059
itself

538
00:25:42,419 --> 00:25:47,100
if we go back to our pcap and use the

539
00:25:47,100 --> 00:25:49,740
basic web filter

540
00:25:49,740 --> 00:25:53,340
you'll see that there is https activity

541
00:25:53,340 --> 00:25:56,520
to various IP addresses over TCP port

542
00:25:56,520 --> 00:26:01,820
8080 and TCP Port 443

543
00:26:03,480 --> 00:26:05,279
and that's just a list of everything

544
00:26:05,279 --> 00:26:07,679
right there all right you'll notice that

545
00:26:07,679 --> 00:26:10,679
there are a lot of IP addresses over

546
00:26:10,679 --> 00:26:13,440
those two various reports it's not

547
00:26:13,440 --> 00:26:16,919
limited to Port 443 or 8080 those are

548
00:26:16,919 --> 00:26:18,960
just the most common ones sometimes

549
00:26:18,960 --> 00:26:21,480
they'll see it over https traffic over

550
00:26:21,480 --> 00:26:25,260
TCP port 7080.

551
00:26:26,100 --> 00:26:27,480
now

552
00:26:27,480 --> 00:26:28,380
um

553
00:26:28,380 --> 00:26:32,340
one of the things that you can trigger

554
00:26:32,340 --> 00:26:36,179
of an alert for on the network traffic

555
00:26:36,179 --> 00:26:40,620
is the certificate data from the

556
00:26:40,620 --> 00:26:42,299
certificates that are used to establish

557
00:26:42,299 --> 00:26:45,000
that TLS connection this is TLS version

558
00:26:45,000 --> 00:26:48,600
1.2 so there is a certificate that is

559
00:26:48,600 --> 00:26:49,460
sent

560
00:26:49,460 --> 00:26:52,919
that we can actually see the data for if

561
00:26:52,919 --> 00:26:55,620
if this were TLS version 1.3 we could

562
00:26:55,620 --> 00:26:57,779
not do this

563
00:26:57,779 --> 00:27:00,140
so I would filter on

564
00:27:00,140 --> 00:27:02,340
tls.handshake.type equals 11 and in this

565
00:27:02,340 --> 00:27:05,279
case I'm just going anything with that

566
00:27:05,279 --> 00:27:06,440
particular

567
00:27:06,440 --> 00:27:10,799
data which I filter for that to look at

568
00:27:10,799 --> 00:27:13,260
the certificate data for any https

569
00:27:13,260 --> 00:27:17,760
traffic over TCP port 8080.

570
00:27:17,760 --> 00:27:19,919
if I go to the frame details and I'll

571
00:27:19,919 --> 00:27:23,220
expand my way down to look at the

572
00:27:23,220 --> 00:27:25,679
certificate data

573
00:27:25,679 --> 00:27:27,419
so I'm going through transport layer

574
00:27:27,419 --> 00:27:30,000
security handshake protocol certificate

575
00:27:30,000 --> 00:27:32,340
handshake protocol certificate going all

576
00:27:32,340 --> 00:27:34,500
the way down until I see the certificate

577
00:27:34,500 --> 00:27:36,900
issuer data and there's a bunch of RDS

578
00:27:36,900 --> 00:27:39,179
sequence items

579
00:27:39,179 --> 00:27:42,659
and these are the sequence items uh

580
00:27:42,659 --> 00:27:44,880
illustrate they they have the values of

581
00:27:44,880 --> 00:27:47,400
the issuer data for this particular

582
00:27:47,400 --> 00:27:49,200
certificate

583
00:27:49,200 --> 00:27:55,080
and this is a self-signed certificate

584
00:27:55,080 --> 00:27:59,820
so uh when you set up an https server or

585
00:27:59,820 --> 00:28:02,100
web server that does https you need to

586
00:28:02,100 --> 00:28:05,220
have a certificate a public and a

587
00:28:05,220 --> 00:28:08,100
private in order to establish that TLS

588
00:28:08,100 --> 00:28:09,600
connection

589
00:28:09,600 --> 00:28:13,620
so this is the public certificate

590
00:28:13,620 --> 00:28:16,679
and you can actually you could have when

591
00:28:16,679 --> 00:28:18,900
this was still active you could go you

592
00:28:18,900 --> 00:28:21,600
could have gone uh back in June on June

593
00:28:21,600 --> 00:28:25,320
7th you could have uh plugged that IP

594
00:28:25,320 --> 00:28:27,059
address and Port into your web browser

595
00:28:27,059 --> 00:28:31,320
and it would go to the site now any

596
00:28:31,320 --> 00:28:33,659
uh web browsers any normal web browser

597
00:28:33,659 --> 00:28:35,640
is going to look at that and say hey

598
00:28:35,640 --> 00:28:38,820
this is this is a big security risk

599
00:28:38,820 --> 00:28:40,799
because this is a self-signed

600
00:28:40,799 --> 00:28:42,900
certificate it is not a recognized

601
00:28:42,900 --> 00:28:47,000
certificate Authority so Chrome Mozilla

602
00:28:47,000 --> 00:28:50,720
Firefox I'm sorry Chrome Firefox

603
00:28:50,720 --> 00:28:53,880
Microsoft Edge Safari they're not going

604
00:28:53,880 --> 00:28:54,960
to show it

605
00:28:54,960 --> 00:28:57,000
immediately but they'll let you accept

606
00:28:57,000 --> 00:28:59,700
the risk and continue now what we can do

607
00:28:59,700 --> 00:29:02,159
on this particular page that shows up we

608
00:29:02,159 --> 00:29:06,500
can click on that view certificate link

609
00:29:07,080 --> 00:29:09,720
and we would find out that everything

610
00:29:09,720 --> 00:29:13,020
that we saw in Wireshark that we could

611
00:29:13,020 --> 00:29:16,080
find out in Wireshark we would find here

612
00:29:16,080 --> 00:29:16,919
thank you

613
00:29:16,919 --> 00:29:19,980
and you could use something like openssh

614
00:29:19,980 --> 00:29:22,500
to generate these types of certificates

615
00:29:22,500 --> 00:29:24,480
which is what I assume that the

616
00:29:24,480 --> 00:29:25,980
criminals do when they set these up

617
00:29:25,980 --> 00:29:28,919
because it's completely free now this

618
00:29:28,919 --> 00:29:31,260
traffic doesn't use a web browser to

619
00:29:31,260 --> 00:29:35,159
establish that connection for that https

620
00:29:35,159 --> 00:29:37,500
data to go back and forth right it's the

621
00:29:37,500 --> 00:29:40,020
malware itself that's doing that

622
00:29:40,020 --> 00:29:42,779
so it's not using a web browser so there

623
00:29:42,779 --> 00:29:46,380
is absolutely no problem whatsoever for

624
00:29:46,380 --> 00:29:49,500
malware to establish a command controls

625
00:29:49,500 --> 00:29:52,740
Channel over https traffic for a server

626
00:29:52,740 --> 00:29:54,779
that's using a self-signed certificate

627
00:29:54,779 --> 00:29:56,940
and we see that commonly

628
00:29:56,940 --> 00:30:00,179
we commonly see that and they're I

629
00:30:00,179 --> 00:30:02,159
believe the emerging threats open rule

630
00:30:02,159 --> 00:30:06,000
Set uh has a at least an informational

631
00:30:06,000 --> 00:30:09,299
signature that triggers on certificate

632
00:30:09,299 --> 00:30:12,960
issuer data that comes over uh prior to

633
00:30:12,960 --> 00:30:15,480
that TLS connection being established

634
00:30:15,480 --> 00:30:17,539
where it's triggering on stuff like

635
00:30:17,539 --> 00:30:20,340
example.com or Global Security as an

636
00:30:20,340 --> 00:30:22,939
organization

637
00:30:25,140 --> 00:30:27,659
for this particular pcap this particular

638
00:30:27,659 --> 00:30:30,720
example you know we've seen emotec but

639
00:30:30,720 --> 00:30:33,380
the more interesting thing with an email

640
00:30:33,380 --> 00:30:36,539
infection is do we see Cobalt strike

641
00:30:36,539 --> 00:30:39,059
with uh emotec or any other malware

642
00:30:39,059 --> 00:30:41,840
because Cobalt strike is that precursor

643
00:30:41,840 --> 00:30:46,380
to other activity this is an initial

644
00:30:46,380 --> 00:30:49,320
access broker providing access to that

645
00:30:49,320 --> 00:30:51,360
infected Windows host to another

646
00:30:51,360 --> 00:30:53,760
criminal group

647
00:30:53,760 --> 00:30:58,200
so we see this uh because emotech always

648
00:30:58,200 --> 00:31:00,960
uses IP addresses for its command

649
00:31:00,960 --> 00:31:04,260
control traffic without domains without

650
00:31:04,260 --> 00:31:06,120
any Associated domains if you start

651
00:31:06,120 --> 00:31:11,399
seeing a bunch of https entries

652
00:31:11,399 --> 00:31:13,020
as you were looking through Wireshark

653
00:31:13,020 --> 00:31:16,559
using this particular basic web filter

654
00:31:16,559 --> 00:31:18,799
and you see multiple

655
00:31:18,799 --> 00:31:22,440
https entries uh multiple entries per

656
00:31:22,440 --> 00:31:25,919
minute it's probably Cobalt strike and

657
00:31:25,919 --> 00:31:29,159
what we have here is uh I forget how

658
00:31:29,159 --> 00:31:30,840
many minutes this is after the initial

659
00:31:30,840 --> 00:31:32,100
infection

660
00:31:32,100 --> 00:31:35,880
what we see uh https traffic to

661
00:31:35,880 --> 00:31:38,880
lentgen.com

662
00:31:40,140 --> 00:31:42,299
now I already knew I already can look at

663
00:31:42,299 --> 00:31:44,039
this and know that yeah this is Cobalt

664
00:31:44,039 --> 00:31:45,779
strike traffic but

665
00:31:45,779 --> 00:31:48,659
uh and the certificate is a let's

666
00:31:48,659 --> 00:31:50,580
encrypt certificate for this uh

667
00:31:50,580 --> 00:31:54,059
particular web server but

668
00:31:54,059 --> 00:31:59,460
um it isn't uh just uh I who have uh you

669
00:31:59,460 --> 00:32:02,399
know used the unit 42 Intel handle

670
00:32:02,399 --> 00:32:04,860
through Twitter to tweet that there were

671
00:32:04,860 --> 00:32:07,860
have been other accounts that have also

672
00:32:07,860 --> 00:32:11,340
discovered this as a Cobalt strike

673
00:32:11,340 --> 00:32:14,059
domain

674
00:32:14,760 --> 00:32:17,760
foreign

675
00:32:21,179 --> 00:32:23,279
is it turns an infected Windows host

676
00:32:23,279 --> 00:32:25,200
into a Spam bot

677
00:32:25,200 --> 00:32:28,580
and if you're not already familiar with

678
00:32:28,580 --> 00:32:34,799
TCP ports 465 587 and 25. those are TCP

679
00:32:34,799 --> 00:32:39,559
ports associated with SMTP traffic

680
00:32:44,100 --> 00:32:47,039
when I use my basic web filter and I

681
00:32:47,039 --> 00:32:50,580
start seeing entries that show TCP Port

682
00:32:50,580 --> 00:32:55,620
465 and 587 and 25 then I know okay I've

683
00:32:55,620 --> 00:32:57,320
got some spam bot activity here

684
00:32:57,320 --> 00:32:59,880
especially if I'm not seeing any actual

685
00:32:59,880 --> 00:33:02,279
domains that are coming up here so I can

686
00:33:02,279 --> 00:33:04,679
filter an easy way to check and see if

687
00:33:04,679 --> 00:33:08,580
you have possible spam bot activity

688
00:33:08,580 --> 00:33:10,500
in a pcap

689
00:33:10,500 --> 00:33:13,260
on a traffic that you're investigating

690
00:33:13,260 --> 00:33:15,419
for a possibly infected Windows host is

691
00:33:15,419 --> 00:33:19,740
to filter on SMTP and we'll notice here

692
00:33:19,740 --> 00:33:22,919
that uh basically you'll see the SMTP

693
00:33:22,919 --> 00:33:26,100
commands that establish the TLs tunnel

694
00:33:26,100 --> 00:33:28,019
and then everything after that is

695
00:33:28,019 --> 00:33:30,480
encrypted

696
00:33:30,480 --> 00:33:34,860
so and you'll see more than one in this

697
00:33:34,860 --> 00:33:37,860
case I see three separate public IP

698
00:33:37,860 --> 00:33:39,120
addresses

699
00:33:39,120 --> 00:33:43,019
to those SMTP based TCP ports using

700
00:33:43,019 --> 00:33:47,460
those TCP ports associated with SMTP

701
00:33:47,460 --> 00:33:51,140
now a Windows client on a normal basis

702
00:33:51,140 --> 00:33:55,500
even if it's set up to to get SMTP

703
00:33:55,500 --> 00:33:57,840
traffic from a single mail server for

704
00:33:57,840 --> 00:34:00,000
its mail client it's not going to go to

705
00:34:00,000 --> 00:34:00,919
different

706
00:34:00,919 --> 00:34:03,480
IP addresses

707
00:34:03,480 --> 00:34:05,820
for SMTP traffic you're not going to see

708
00:34:05,820 --> 00:34:08,699
three four five or normally with emotec

709
00:34:08,699 --> 00:34:10,800
you're seeing dozens of different IP

710
00:34:10,800 --> 00:34:13,679
addresses and dozens of DNS queries to

711
00:34:13,679 --> 00:34:17,760
various mail server domains every minute

712
00:34:17,760 --> 00:34:19,619
every minute or two

713
00:34:19,619 --> 00:34:21,540
and that's not normal that's spam bot

714
00:34:21,540 --> 00:34:23,960
activity

715
00:34:24,179 --> 00:34:28,739
now with the spambot activity regardless

716
00:34:28,739 --> 00:34:31,500
of the malware if there is any

717
00:34:31,500 --> 00:34:34,199
unencrypted SMTP traffic and there's an

718
00:34:34,199 --> 00:34:36,300
email that's sent over you can do a

719
00:34:36,300 --> 00:34:38,460
quick check by filtering on

720
00:34:38,460 --> 00:34:41,460
smtp.data.fragment

721
00:34:41,639 --> 00:34:45,060
in this example we do not see that

722
00:34:45,060 --> 00:34:47,760
so every everything that was sent over

723
00:34:47,760 --> 00:34:51,780
SMTP for this particular example was all

724
00:34:51,780 --> 00:34:53,159
encrypted

725
00:34:53,159 --> 00:34:56,219
and uh quite literally I think if I

726
00:34:56,219 --> 00:34:57,720
would have waited long enough I would

727
00:34:57,720 --> 00:35:00,359
have found some unencrypted SMTP traffic

728
00:35:00,359 --> 00:35:03,240
but uh we're talking uh we're talking

729
00:35:03,240 --> 00:35:05,339
hundreds of megabytes or gigabytes of

730
00:35:05,339 --> 00:35:07,020
data depending on how long you have to

731
00:35:07,020 --> 00:35:10,140
wait it generates a lot of traffic

732
00:35:10,140 --> 00:35:14,460
emotec spambot activity generates a lot

733
00:35:14,460 --> 00:35:17,420
of traffic

734
00:35:18,000 --> 00:35:20,160
so for this particular example this

735
00:35:20,160 --> 00:35:22,140
first example of emotec

736
00:35:22,140 --> 00:35:25,980
uh we see https traffic for the emotec

737
00:35:25,980 --> 00:35:27,119
dll

738
00:35:27,119 --> 00:35:29,839
one unsuccessful

739
00:35:29,839 --> 00:35:33,780
https request we see command control

740
00:35:33,780 --> 00:35:37,920
traffic for emotech over https using

741
00:35:37,920 --> 00:35:39,839
that self-signed certificate and it's

742
00:35:39,839 --> 00:35:42,480
always that specific self-signed

743
00:35:42,480 --> 00:35:46,079
certificate issuer right example.com it

744
00:35:46,079 --> 00:35:48,359
Department all that stuff right it's

745
00:35:48,359 --> 00:35:51,320
that that particular set of

746
00:35:51,320 --> 00:35:54,660
values for the certificate issuer is not

747
00:35:54,660 --> 00:35:58,140
unique to emotech but emotec always uses

748
00:35:58,140 --> 00:36:01,879
that particular set of values

749
00:36:02,280 --> 00:36:05,460
and then we saw https Cobalt strike

750
00:36:05,460 --> 00:36:06,420
traffic

751
00:36:06,420 --> 00:36:09,000
and you'll notice that that doesn't stay

752
00:36:09,000 --> 00:36:11,760
up very long before it stops in my

753
00:36:11,760 --> 00:36:13,619
particular environment because I'm

754
00:36:13,619 --> 00:36:15,300
generally just using one domain

755
00:36:15,300 --> 00:36:18,540
controller and one client right so it's

756
00:36:18,540 --> 00:36:21,000
not going to take somebody very long to

757
00:36:21,000 --> 00:36:23,720
quickly map out that environment

758
00:36:23,720 --> 00:36:27,240
and say oh you know good Lord this is

759
00:36:27,240 --> 00:36:29,640
nothing worth my time and then uh just

760
00:36:29,640 --> 00:36:32,339
quit and then we see encrypted SMTP

761
00:36:32,339 --> 00:36:36,859
traffic for uh spambot activity

762
00:36:37,680 --> 00:36:41,220
so let's look at our second example

763
00:36:41,220 --> 00:36:44,520
of emotech traffic this one is from the

764
00:36:44,520 --> 00:36:48,560
fifth of July

765
00:36:49,320 --> 00:36:51,660
a little a little less than a month

766
00:36:51,660 --> 00:36:53,880
after the previous example in this one

767
00:36:53,880 --> 00:36:57,560
I've actually got uh 10 examples of

768
00:36:57,560 --> 00:36:59,820
emotec mouse spam

769
00:36:59,820 --> 00:37:03,900
from the uh from the days leading up to

770
00:37:03,900 --> 00:37:08,220
January I'm sorry July 5th and then we

771
00:37:08,220 --> 00:37:09,960
have this one this one does not contain

772
00:37:09,960 --> 00:37:12,540
Cobalt strike but it does contain spam

773
00:37:12,540 --> 00:37:13,800
bot activity

774
00:37:13,800 --> 00:37:16,800
and it does contain

775
00:37:16,800 --> 00:37:19,560
some emoted dlls that were sent over

776
00:37:19,560 --> 00:37:22,380
unencrypted HTTP which we can export

777
00:37:22,380 --> 00:37:24,839
from the pcapp

778
00:37:24,839 --> 00:37:27,900
and there is some unencrypted SMTP

779
00:37:27,900 --> 00:37:31,619
traffic that contains email examples

780
00:37:31,619 --> 00:37:34,440
spammed out by this host

781
00:37:34,440 --> 00:37:38,220
that is now or was then part of an

782
00:37:38,220 --> 00:37:41,339
emotec botnet

783
00:37:41,339 --> 00:37:44,160
so if I load this in Wireshark with my

784
00:37:44,160 --> 00:37:47,579
special link crafted customized

785
00:37:47,579 --> 00:37:49,380
Wireshark column display and the filters

786
00:37:49,380 --> 00:37:51,599
that I use

787
00:37:51,599 --> 00:37:55,880
use my basic web filter and I can see

788
00:37:55,880 --> 00:38:00,780
three HTTP URLs and one https apparently

789
00:38:00,780 --> 00:38:03,599
a URL once again this is TLS encrypted

790
00:38:03,599 --> 00:38:06,240
traffic I can see the domain

791
00:38:06,240 --> 00:38:09,900
uh if it's TLS version 1.2 I can see the

792
00:38:09,900 --> 00:38:12,359
domain in the certificate issue

793
00:38:12,359 --> 00:38:15,000
but um

794
00:38:15,000 --> 00:38:18,500
if I follow the TCP stream for any one

795
00:38:18,500 --> 00:38:23,780
of those green lines up there those urls

796
00:38:24,359 --> 00:38:27,900
on July 5th I would uh I would see that

797
00:38:27,900 --> 00:38:30,720
there was a Windows executable file or

798
00:38:30,720 --> 00:38:33,359
Windows dll File that was returned from

799
00:38:33,359 --> 00:38:37,079
that server uh this particular one uh

800
00:38:37,079 --> 00:38:40,920
Zona information.es

801
00:38:43,680 --> 00:38:47,040
which I believe es is uh Spain if I'm

802
00:38:47,040 --> 00:38:50,160
not mistaken right so this is a domain

803
00:38:50,160 --> 00:38:53,460
this is a legitimate domain these URLs

804
00:38:53,460 --> 00:38:54,720
that are hosting

805
00:38:54,720 --> 00:38:58,560
these emotec dll files are almost always

806
00:38:58,560 --> 00:39:00,660
legitimate websites that have been

807
00:39:00,660 --> 00:39:04,740
compromised and being used to host

808
00:39:04,740 --> 00:39:08,820
these uh these emoted dll files

809
00:39:08,820 --> 00:39:10,680
the command control servers are

810
00:39:10,680 --> 00:39:12,560
different those are specially

811
00:39:12,560 --> 00:39:16,140
established usually through fraud

812
00:39:16,140 --> 00:39:17,820
accounts through some sort of service

813
00:39:17,820 --> 00:39:21,140
provider somewhere but these

814
00:39:21,140 --> 00:39:23,160
you wouldn't want to block everything

815
00:39:23,160 --> 00:39:26,880
from this uh particular site then again

816
00:39:26,880 --> 00:39:28,500
maybe you would

817
00:39:28,500 --> 00:39:31,920
but uh this particular URL yes you could

818
00:39:31,920 --> 00:39:35,339
block it you could safely block it

819
00:39:35,339 --> 00:39:37,980
so you'll notice that a Windows

820
00:39:37,980 --> 00:39:40,500
executable file or a Windows dll File

821
00:39:40,500 --> 00:39:44,040
the first two bytes of either one of

822
00:39:44,040 --> 00:39:46,140
those files shows up as the ASCII

823
00:39:46,140 --> 00:39:48,660
characters m z

824
00:39:48,660 --> 00:39:50,880
and then you'll usually see a line that

825
00:39:50,880 --> 00:39:54,119
says this program cannot be run in DOS

826
00:39:54,119 --> 00:39:56,700
mode maybe not that exact wording but

827
00:39:56,700 --> 00:39:59,880
something along those lines

828
00:39:59,880 --> 00:40:02,520
and then you may see some text strings

829
00:40:02,520 --> 00:40:04,619
that indicate some of the packed

830
00:40:04,619 --> 00:40:06,920
executable headers for this particular

831
00:40:06,920 --> 00:40:10,200
packed executable or uh

832
00:40:10,200 --> 00:40:13,200
p-e-d-l-l

833
00:40:13,920 --> 00:40:18,119
now again we can export

834
00:40:18,119 --> 00:40:19,800
these objects that were sent over

835
00:40:19,800 --> 00:40:22,380
unencrypted hddb traffic

836
00:40:22,380 --> 00:40:26,220
by using the export objects function in

837
00:40:26,220 --> 00:40:27,900
Wireshark

838
00:40:27,900 --> 00:40:29,960
all right so I could go to my file menu

839
00:40:29,960 --> 00:40:33,780
my export objects menu and then select

840
00:40:33,780 --> 00:40:37,440
HTTP objects and you'll notice when you

841
00:40:37,440 --> 00:40:40,440
do that with this particular pcap that

842
00:40:40,440 --> 00:40:45,300
all three of those unencrypted HTTP URLs

843
00:40:45,300 --> 00:40:46,940
returned

844
00:40:46,940 --> 00:40:50,099
525 kilobyte file

845
00:40:50,099 --> 00:40:50,940
um

846
00:40:50,940 --> 00:40:53,339
and what I can do with these is when I

847
00:40:53,339 --> 00:40:56,579
save these I can do a in a Linux

848
00:40:56,579 --> 00:40:58,260
environment for example I could do a

849
00:40:58,260 --> 00:41:01,200
file command to check to confirm that

850
00:41:01,200 --> 00:41:04,800
these are uh you know executable or dll

851
00:41:04,800 --> 00:41:08,160
files in this case it's a 64-bit Windows

852
00:41:08,160 --> 00:41:10,800
dll File I'll find that by using the

853
00:41:10,800 --> 00:41:13,020
file command I'll do a Shaw sum command

854
00:41:13,020 --> 00:41:15,720
to get that Shaw 256 hash

855
00:41:15,720 --> 00:41:18,480
and then

856
00:41:18,480 --> 00:41:20,820
I'll check that file hash and virus

857
00:41:20,820 --> 00:41:23,460
total or better yet I'll just do a

858
00:41:23,460 --> 00:41:24,900
Google search

859
00:41:24,900 --> 00:41:28,800
to see if that particular file has been

860
00:41:28,800 --> 00:41:30,480
submitted to any of the publicly

861
00:41:30,480 --> 00:41:34,200
available online sandboxes

862
00:41:34,200 --> 00:41:36,000
and then check and see if the

863
00:41:36,000 --> 00:41:38,460
information that they have matches the

864
00:41:38,460 --> 00:41:41,280
indicators that I'm seeing in this pcap

865
00:41:41,280 --> 00:41:43,859
the Zenni know does anyone know why that

866
00:41:43,859 --> 00:41:46,680
I wouldn't just submit

867
00:41:46,680 --> 00:41:49,980
this Windows executable file or this

868
00:41:49,980 --> 00:41:54,859
Windows dll File to virus total directly

869
00:42:00,119 --> 00:42:01,680
yeah

870
00:42:01,680 --> 00:42:04,320
tip your head he knows that

871
00:42:04,320 --> 00:42:07,980
you found his malware yeah exactly right

872
00:42:07,980 --> 00:42:10,380
that's what you were saying as well that

873
00:42:10,380 --> 00:42:12,440
yeah you don't want to do it because

874
00:42:12,440 --> 00:42:16,140
this uh you know if it is a targeted

875
00:42:16,140 --> 00:42:17,400
attack right

876
00:42:17,400 --> 00:42:20,099
this I don't care if you know what SEMA

877
00:42:20,099 --> 00:42:22,200
did submit that stuff to virus total

878
00:42:22,200 --> 00:42:24,119
because these things are generally have

879
00:42:24,119 --> 00:42:26,760
a different file hash every anyway each

880
00:42:26,760 --> 00:42:30,500
time you retrieve that dll from that URL

881
00:42:30,500 --> 00:42:32,940
uh there's some sort of hash busting or

882
00:42:32,940 --> 00:42:36,320
something going on there where it's uh

883
00:42:36,320 --> 00:42:38,640
generating a slightly different file

884
00:42:38,640 --> 00:42:41,040
every time but you're exactly right and

885
00:42:41,040 --> 00:42:42,599
that's another one of the things that

886
00:42:42,599 --> 00:42:45,720
we're taught early on when you're doing

887
00:42:45,720 --> 00:42:48,240
some you know near real-time analysis

888
00:42:48,240 --> 00:42:50,460
and investigations of suspicious

889
00:42:50,460 --> 00:42:54,480
activity is yeah don't submit the file

890
00:42:54,480 --> 00:42:56,880
sample to virustotal or anything else

891
00:42:56,880 --> 00:43:00,300
online check that shot 256 hash first uh

892
00:43:00,300 --> 00:43:01,859
sir if you'd like to come up you can

893
00:43:01,859 --> 00:43:07,700
pick one of these three items here

894
00:43:09,780 --> 00:43:12,500
thank you

895
00:43:15,720 --> 00:43:20,040
now in this particular example I have

896
00:43:20,040 --> 00:43:23,940
unencrypted SMTP traffic that contains

897
00:43:23,940 --> 00:43:25,440
emails

898
00:43:25,440 --> 00:43:28,680
that are the same type of thread

899
00:43:28,680 --> 00:43:30,540
hijacked emails that I was discussing

900
00:43:30,540 --> 00:43:33,300
earlier right I can filter on

901
00:43:33,300 --> 00:43:36,300
smtp.data.fragment

902
00:43:37,079 --> 00:43:40,140
and we can see that there are what are

903
00:43:40,140 --> 00:43:42,900
there 9 10 examples here

904
00:43:42,900 --> 00:43:46,280
eight examples nine

905
00:43:46,980 --> 00:43:49,440
I can follow the TCP stream for any one

906
00:43:49,440 --> 00:43:52,020
of those and I can see some of the SMTP

907
00:43:52,020 --> 00:43:55,079
traffic that led to this all right I can

908
00:43:55,079 --> 00:43:57,960
see that it is a

909
00:43:57,960 --> 00:43:58,740
um

910
00:43:58,740 --> 00:44:01,560
uh Japanese uh mail server that this is

911
00:44:01,560 --> 00:44:04,560
uh this is uh being used so what's

912
00:44:04,560 --> 00:44:07,200
happening here is that infected

913
00:44:07,200 --> 00:44:10,020
host that's acting as a Spam bot it's

914
00:44:10,020 --> 00:44:12,240
not sending it directly from itself it's

915
00:44:12,240 --> 00:44:15,960
using this uh Japanese email account

916
00:44:15,960 --> 00:44:18,540
that's been compromised to relay the

917
00:44:18,540 --> 00:44:22,079
message to that address that email

918
00:44:22,079 --> 00:44:26,940
address that ends in Dot gov.cl

919
00:44:26,940 --> 00:44:29,760
and the beauty of this is

920
00:44:29,760 --> 00:44:31,800
and I've had this happen to me with the

921
00:44:31,800 --> 00:44:35,040
email accounts that I'll use uh uh you

922
00:44:35,040 --> 00:44:37,920
know as spambot traps so I'm infecting a

923
00:44:37,920 --> 00:44:41,579
Windows host and uh not only does it

924
00:44:41,579 --> 00:44:43,680
Steely email data it seals the username

925
00:44:43,680 --> 00:44:46,200
and password for that email account

926
00:44:46,200 --> 00:44:49,260
and then I'll uh I'll start seeing

927
00:44:49,260 --> 00:44:51,000
bounce back emails in these email

928
00:44:51,000 --> 00:44:52,380
accounts

929
00:44:52,380 --> 00:44:56,819
that uh from email addresses that are no

930
00:44:56,819 --> 00:44:59,220
longer active right I don't see these

931
00:44:59,220 --> 00:45:04,200
emails sent in my sent box in my sent

932
00:45:04,200 --> 00:45:07,079
queue because it's not being sent from

933
00:45:07,079 --> 00:45:09,359
that account that account is being used

934
00:45:09,359 --> 00:45:12,000
as a relay so the only way I will know

935
00:45:12,000 --> 00:45:14,880
if my account has been compromised and

936
00:45:14,880 --> 00:45:17,040
is spamming is if I get these bounce

937
00:45:17,040 --> 00:45:20,099
back emails from email accounts that no

938
00:45:20,099 --> 00:45:22,859
longer exist or no longer work and I've

939
00:45:22,859 --> 00:45:26,099
had that I've had my uh the email the

940
00:45:26,099 --> 00:45:28,319
various email providers shut some of my

941
00:45:28,319 --> 00:45:30,420
email accounts down because they've been

942
00:45:30,420 --> 00:45:33,660
used as uh you know for spam activity

943
00:45:33,660 --> 00:45:35,940
and I wasn't aware of it and it's like

944
00:45:35,940 --> 00:45:38,220
oh I'm sorry change the password can I

945
00:45:38,220 --> 00:45:40,700
have it back

946
00:45:42,180 --> 00:45:47,040
you can export these emails from uh from

947
00:45:47,040 --> 00:45:49,680
the PCAT right we can go file export

948
00:45:49,680 --> 00:45:53,099
objects and this time select IMF

949
00:45:53,099 --> 00:45:57,500
IMF stands for internet mail format

950
00:45:57,780 --> 00:46:01,020
this brings up your IMF object list it

951
00:46:01,020 --> 00:46:04,500
has all of those email files in the EML

952
00:46:04,500 --> 00:46:08,660
format and you can use an email client

953
00:46:08,660 --> 00:46:12,060
I use Thunderbird I don't think I think

954
00:46:12,060 --> 00:46:15,180
Outlook Outlook might open them I don't

955
00:46:15,180 --> 00:46:17,040
know if the windows based Outlook will I

956
00:46:17,040 --> 00:46:20,099
know the Mac based Outlook will but I'm

957
00:46:20,099 --> 00:46:21,660
not sure about the windows windows is

958
00:46:21,660 --> 00:46:23,880
kind of Windows based Outlook is kind of

959
00:46:23,880 --> 00:46:26,220
screwy

960
00:46:26,220 --> 00:46:29,400
I'm not saying that officially

961
00:46:29,400 --> 00:46:32,160
but anyway this is uh this is the type

962
00:46:32,160 --> 00:46:34,560
of thing that we uh for that uh Batman

963
00:46:34,560 --> 00:46:37,200
uh email that was spoof that I showed

964
00:46:37,200 --> 00:46:38,760
earlier this is the part that wasn't

965
00:46:38,760 --> 00:46:41,220
being shown

966
00:46:41,220 --> 00:46:44,460
right so uh this is obviously it's going

967
00:46:44,460 --> 00:46:48,660
to a DOT CL email address

968
00:46:48,660 --> 00:46:50,700
I'm not uh certain does anybody know

969
00:46:50,700 --> 00:46:52,500
what country that is

970
00:46:52,500 --> 00:46:55,500
Chile okay so we're uh we're looking at

971
00:46:55,500 --> 00:46:59,359
uh I believe Spanish here right

972
00:46:59,359 --> 00:47:02,220
and this is not a thread hijacked email

973
00:47:02,220 --> 00:47:05,119
but this is pretending to be an email

974
00:47:05,119 --> 00:47:07,980
that was uh you know formally sent to

975
00:47:07,980 --> 00:47:10,859
that recipient from a

976
00:47:10,859 --> 00:47:15,380
you know whoever Patricia sochin is

977
00:47:15,540 --> 00:47:18,900
what that was uh that name was taken

978
00:47:18,900 --> 00:47:23,280
from a uh address book stolen from a

979
00:47:23,280 --> 00:47:27,079
previously infected emotech host

980
00:47:28,020 --> 00:47:31,200
so other malware that we see now that

981
00:47:31,200 --> 00:47:33,420
emoted is quiet once again ever since

982
00:47:33,420 --> 00:47:36,599
mid-july quite literally July 15th was

983
00:47:36,599 --> 00:47:39,240
the last evidence that I have of email

984
00:47:39,240 --> 00:47:42,660
that was sent from epoch4 or Epoch 5

985
00:47:42,660 --> 00:47:45,480
either one of those botnets so the

986
00:47:45,480 --> 00:47:46,920
infrastructure that botnet

987
00:47:46,920 --> 00:47:49,020
infrastructure is still alive

988
00:47:49,020 --> 00:47:51,240
and still occasionally uh you know you

989
00:47:51,240 --> 00:47:52,339
get a heartbeat or something

990
00:47:52,339 --> 00:47:55,319
metaphorically speaking from it

991
00:47:55,319 --> 00:47:57,960
but uh it's not really doing anything

992
00:47:57,960 --> 00:48:00,660
the other malware that has also been

993
00:48:00,660 --> 00:48:03,599
active while emotec was active but seems

994
00:48:03,599 --> 00:48:06,119
to be even more active now is uh

995
00:48:06,119 --> 00:48:09,720
bumblebee iced ID and cackbot

996
00:48:09,720 --> 00:48:14,598
those three malware families yes sir

997
00:48:16,020 --> 00:48:18,359
how it was shut down I don't know how it

998
00:48:18,359 --> 00:48:20,280
was shut down and I wouldn't even say it

999
00:48:20,280 --> 00:48:22,920
was shut down it just stopped right it

1000
00:48:22,920 --> 00:48:25,619
just kind of decided to go to sleep and

1001
00:48:25,619 --> 00:48:27,300
we would see that occasionally right

1002
00:48:27,300 --> 00:48:29,280
sometimes you'd see a week or two of a

1003
00:48:29,280 --> 00:48:32,640
break where there would be no spamming

1004
00:48:32,640 --> 00:48:35,160
and like we're still seeing now the

1005
00:48:35,160 --> 00:48:36,839
button and infrastructure would still be

1006
00:48:36,839 --> 00:48:38,520
there those servers would still be

1007
00:48:38,520 --> 00:48:42,480
online but uh the current theory amongst

1008
00:48:42,480 --> 00:48:45,900
uh some people uh as we fellow security

1009
00:48:45,900 --> 00:48:48,119
researchers as we kind of chatted is uh

1010
00:48:48,119 --> 00:48:51,420
you know possibly the whole uh Ukraine

1011
00:48:51,420 --> 00:48:57,240
conflict might be a reason that this is

1012
00:48:57,240 --> 00:49:01,160
emotet has been attributed to some

1013
00:49:01,160 --> 00:49:04,200
russia-based threat actor

1014
00:49:04,200 --> 00:49:06,680
starting

1015
00:49:07,740 --> 00:49:09,660
I don't know

1016
00:49:09,660 --> 00:49:12,060
I don't know I mean it's uh at this

1017
00:49:12,060 --> 00:49:14,460
point information uh emotec is an

1018
00:49:14,460 --> 00:49:17,220
information stealer so but it's not

1019
00:49:17,220 --> 00:49:20,760
specifically banking malware at this

1020
00:49:20,760 --> 00:49:23,099
point in time so

1021
00:49:23,099 --> 00:49:25,560
um I think it

1022
00:49:25,560 --> 00:49:28,200
nobody knows the exact reason why

1023
00:49:28,200 --> 00:49:32,118
emotech has now gone dormant

1024
00:49:32,940 --> 00:49:36,660
if he likes her you can pick one of the

1025
00:49:36,660 --> 00:49:38,880
I neglected to mention this at the

1026
00:49:38,880 --> 00:49:41,400
beginning but uh I gotta give away some

1027
00:49:41,400 --> 00:49:43,319
prizes I figure anyone who's uh

1028
00:49:43,319 --> 00:49:45,180
interested enough to pay attention

1029
00:49:45,180 --> 00:49:47,460
through my drone of this highly

1030
00:49:47,460 --> 00:49:50,220
technical information and uh is curious

1031
00:49:50,220 --> 00:49:51,900
enough to ask a question they deserve a

1032
00:49:51,900 --> 00:49:54,740
reward sir

1033
00:49:59,760 --> 00:50:02,359
yes sir

1034
00:50:10,079 --> 00:50:12,420
record for stuff in his videos do you

1035
00:50:12,420 --> 00:50:15,540
ever use security hunting or elastic or

1036
00:50:15,540 --> 00:50:18,060
so the question is do I ever use uh

1037
00:50:18,060 --> 00:50:20,400
other security tools like security Union

1038
00:50:20,400 --> 00:50:23,700
or elasticsearch or whatever the the

1039
00:50:23,700 --> 00:50:25,500
short answer is no

1040
00:50:25,500 --> 00:50:28,800
the longer answer is occasionally I have

1041
00:50:28,800 --> 00:50:30,780
used security Union

1042
00:50:30,780 --> 00:50:33,480
I

1043
00:50:33,480 --> 00:50:37,220
before I joined Palo Alto networks I had

1044
00:50:37,220 --> 00:50:39,599
gotten access to the emerging threats

1045
00:50:39,599 --> 00:50:41,460
Pro rule set

1046
00:50:41,460 --> 00:50:44,880
and I am a big big fan of security Union

1047
00:50:44,880 --> 00:50:49,020
so um I have used security onion I don't

1048
00:50:49,020 --> 00:50:51,599
do it so much anymore but I'll use that

1049
00:50:51,599 --> 00:50:53,339
in conjunction with the emerging threat

1050
00:50:53,339 --> 00:50:55,440
opens or the emerging threat Pro rule

1051
00:50:55,440 --> 00:50:59,520
set if there's traffic that I don't know

1052
00:50:59,520 --> 00:51:03,119
what it is right and I need to see if

1053
00:51:03,119 --> 00:51:06,240
there's any network-based signatures on

1054
00:51:06,240 --> 00:51:08,819
the traffic to help me identify the

1055
00:51:08,819 --> 00:51:09,780
malware

1056
00:51:09,780 --> 00:51:12,839
but uh realistically what happens is uh

1057
00:51:12,839 --> 00:51:16,260
now I've got access to uh restricted

1058
00:51:16,260 --> 00:51:17,940
Channels with fellow security

1059
00:51:17,940 --> 00:51:19,800
researchers where I can just reach out

1060
00:51:19,800 --> 00:51:21,780
and grab somebody or poke somebody and

1061
00:51:21,780 --> 00:51:24,480
say hey in poke who pokes people anymore

1062
00:51:24,480 --> 00:51:27,960
online but uh metaphorically I can just

1063
00:51:27,960 --> 00:51:30,660
reach out and say hey do you or you guys

1064
00:51:30,660 --> 00:51:33,300
know what this is and usually somebody

1065
00:51:33,300 --> 00:51:36,000
much smarter than me will be able to

1066
00:51:36,000 --> 00:51:39,059
find that out and then I can I can share

1067
00:51:39,059 --> 00:51:40,859
that information and

1068
00:51:40,859 --> 00:51:42,599
nine times out of ten it's something

1069
00:51:42,599 --> 00:51:44,760
that's already posted online

1070
00:51:44,760 --> 00:51:46,800
but uh sometimes this stuff can be hard

1071
00:51:46,800 --> 00:51:49,020
to find so if you'd like to come up uh

1072
00:51:49,020 --> 00:51:51,359
if you want to get

1073
00:51:51,359 --> 00:51:54,740
the last prize

1074
00:51:55,020 --> 00:51:57,599
and I see despite that being the last

1075
00:51:57,599 --> 00:51:59,280
prize we still have some more questions

1076
00:51:59,280 --> 00:52:02,119
yes ma'am

1077
00:52:03,839 --> 00:52:06,380
thank you

1078
00:52:08,700 --> 00:52:10,700
um

1079
00:52:16,579 --> 00:52:21,300
estimated emails yeah of uh you mean

1080
00:52:21,300 --> 00:52:24,380
just like overall yes

1081
00:52:25,319 --> 00:52:27,720
I don't have an esta an actual amount

1082
00:52:27,720 --> 00:52:30,180
estimated but what I can tell you

1083
00:52:30,180 --> 00:52:34,260
the volume of emotech emails that uh get

1084
00:52:34,260 --> 00:52:36,359
sent out whenever the spam bot is active

1085
00:52:36,359 --> 00:52:38,880
whenever the botnet is active telling

1086
00:52:38,880 --> 00:52:42,240
the botnet post to start spamming all

1087
00:52:42,240 --> 00:52:44,579
right so what will happen is on a single

1088
00:52:44,579 --> 00:52:47,339
host when I'm doing it and this sounds

1089
00:52:47,339 --> 00:52:49,319
kind of bad because what I'm doing is

1090
00:52:49,319 --> 00:52:51,240
I'm detonating this malware in a live

1091
00:52:51,240 --> 00:52:54,119
environment uh I'm doing something like

1092
00:52:54,119 --> 00:52:56,220
tethering through my phone or going over

1093
00:52:56,220 --> 00:52:59,760
a VPN but these emails are getting sent

1094
00:52:59,760 --> 00:53:03,059
out now I comfort Myself by saying well

1095
00:53:03,059 --> 00:53:04,800
if I'm not doing it somebody else is

1096
00:53:04,800 --> 00:53:06,180
doing it right

1097
00:53:06,180 --> 00:53:08,520
but uh you know really that's just a

1098
00:53:08,520 --> 00:53:10,319
kind of a cop-out

1099
00:53:10,319 --> 00:53:13,500
but what happens is I can get an idea of

1100
00:53:13,500 --> 00:53:15,540
what's Happening you know live in real

1101
00:53:15,540 --> 00:53:17,880
time and what will be happening remember

1102
00:53:17,880 --> 00:53:19,740
how I said there was a lot of you know

1103
00:53:19,740 --> 00:53:21,300
hundreds of megabytes of gigabytes of

1104
00:53:21,300 --> 00:53:23,760
traffic within an hour or two's uh worth

1105
00:53:23,760 --> 00:53:26,160
of time so if you look at the traffic

1106
00:53:26,160 --> 00:53:30,300
you're seeing quite literally uh you

1107
00:53:30,300 --> 00:53:33,000
know dozens of emails sent every second

1108
00:53:33,000 --> 00:53:35,460
from one single host

1109
00:53:35,460 --> 00:53:39,059
dozens of emails sent

1110
00:53:39,059 --> 00:53:41,339
almost every second

1111
00:53:41,339 --> 00:53:43,740
you know up to that much so there's an

1112
00:53:43,740 --> 00:53:45,599
ebb and flow to it

1113
00:53:45,599 --> 00:53:48,599
but uh so you know if I don't shut these

1114
00:53:48,599 --> 00:53:50,760
off after a certain amount of time you

1115
00:53:50,760 --> 00:53:52,140
know they'll be sending gigabytes of

1116
00:53:52,140 --> 00:53:55,160
data out of spam bot traffic hundreds

1117
00:53:55,160 --> 00:53:58,079
thousands of emails just from one single

1118
00:53:58,079 --> 00:54:00,319
host

1119
00:54:00,660 --> 00:54:03,780
now multiply that by how many hosts may

1120
00:54:03,780 --> 00:54:06,720
be active at any given time on uh you

1121
00:54:06,720 --> 00:54:09,300
know either one of those bot Nets

1122
00:54:09,300 --> 00:54:11,780
and you've got uh you know you've got

1123
00:54:11,780 --> 00:54:13,980
conceivably hundreds of thousands of

1124
00:54:13,980 --> 00:54:17,160
messages that are going out every single

1125
00:54:17,160 --> 00:54:20,099
day that these botnets are active

1126
00:54:20,099 --> 00:54:21,780
spamming out and that's probably

1127
00:54:21,780 --> 00:54:24,240
hundreds of thousands just as a general

1128
00:54:24,240 --> 00:54:27,660
figures probably a conservative estimate

1129
00:54:27,660 --> 00:54:30,359
in my personal opinion but you're not

1130
00:54:30,359 --> 00:54:35,280
going to get a good number because uh

1131
00:54:35,280 --> 00:54:38,900
from security vendors

1132
00:54:39,300 --> 00:54:41,880
from security vendors because we're all

1133
00:54:41,880 --> 00:54:44,880
looking at different uh different uh

1134
00:54:44,880 --> 00:54:47,160
different customer base right so there's

1135
00:54:47,160 --> 00:54:48,900
no centralized Authority that's

1136
00:54:48,900 --> 00:54:51,480
tabulating that information so we can

1137
00:54:51,480 --> 00:54:53,880
only guess but I can I can give you that

1138
00:54:53,880 --> 00:54:56,520
as a conservative estimate you said you

1139
00:54:56,520 --> 00:54:57,780
had another question

1140
00:54:57,780 --> 00:55:00,780
okay

1141
00:55:06,000 --> 00:55:09,180
gotcha gotcha yeah just uh anyone that

1142
00:55:09,180 --> 00:55:10,680
isn't able to answer can grab me after

1143
00:55:10,680 --> 00:55:14,000
that you sir with the glasses

1144
00:55:22,619 --> 00:55:25,859
how soon after I detonate the malware am

1145
00:55:25,859 --> 00:55:27,839
I starting to see the spambot activity

1146
00:55:27,839 --> 00:55:31,140
or the Cobalt strike spam bot activity

1147
00:55:31,140 --> 00:55:34,319
almost always consistently whenever the

1148
00:55:34,319 --> 00:55:37,260
spam bot uh span the botnets are active

1149
00:55:37,260 --> 00:55:39,660
pushing out spam bot 30 to 45 minutes

1150
00:55:39,660 --> 00:55:42,059
almost consistently within that time

1151
00:55:42,059 --> 00:55:44,520
frame whenever the the it's actively

1152
00:55:44,520 --> 00:55:46,740
sending out spam

1153
00:55:46,740 --> 00:55:51,119
uh Cobalt strike can be anytime so uh

1154
00:55:51,119 --> 00:55:53,460
sometimes it'll be you know within 10-15

1155
00:55:53,460 --> 00:55:56,579
minutes uh other times it could be hours

1156
00:55:56,579 --> 00:56:00,359
and hours later and uh if I were to ever

1157
00:56:00,359 --> 00:56:02,520
let these hosts run for like weeks at a

1158
00:56:02,520 --> 00:56:05,000
time I may be able to give you a uh

1159
00:56:05,000 --> 00:56:08,579
different answer but uh normally you

1160
00:56:08,579 --> 00:56:10,740
know I can let these things run for you

1161
00:56:10,740 --> 00:56:12,660
know if it's not spamming I'll let it

1162
00:56:12,660 --> 00:56:15,059
run just see okay when do I start seeing

1163
00:56:15,059 --> 00:56:18,119
something interesting other than spam

1164
00:56:18,119 --> 00:56:20,420
body I'm sorry command control traffic

1165
00:56:20,420 --> 00:56:23,460
and for Cobalt strike I think what

1166
00:56:23,460 --> 00:56:26,220
happens is when these criminals are

1167
00:56:26,220 --> 00:56:29,339
selling access to the botnet to other

1168
00:56:29,339 --> 00:56:31,380
criminals and using Cobalt strike for

1169
00:56:31,380 --> 00:56:33,180
that it kind of all goes out at the same

1170
00:56:33,180 --> 00:56:36,480
time so I've had two different hosts uh

1171
00:56:36,480 --> 00:56:39,660
using two different public IPS that get

1172
00:56:39,660 --> 00:56:41,819
hit you know all infect them about the

1173
00:56:41,819 --> 00:56:42,960
same time

1174
00:56:42,960 --> 00:56:45,839
or even different times of the day and

1175
00:56:45,839 --> 00:56:47,460
when they get when they start getting

1176
00:56:47,460 --> 00:56:50,460
the Cobalt strike for example it will be

1177
00:56:50,460 --> 00:56:52,140
the same time regardless of when I

1178
00:56:52,140 --> 00:56:53,940
started the infection so I think those

1179
00:56:53,940 --> 00:56:56,160
Cobalt strike deployments are going to

1180
00:56:56,160 --> 00:56:58,859
multiple machines at the same time and

1181
00:56:58,859 --> 00:57:01,680
it's just based on uh whatever the

1182
00:57:01,680 --> 00:57:04,440
threat actor is doing to distribute that

1183
00:57:04,440 --> 00:57:08,700
access to hosts in the botnet

1184
00:57:08,700 --> 00:57:10,980
you sir in the green shirt

1185
00:57:10,980 --> 00:57:14,359
okay anyone else

1186
00:57:14,520 --> 00:57:17,119
yes

1187
00:57:22,520 --> 00:57:25,380
how often do I see tiered exploitation I

1188
00:57:25,380 --> 00:57:28,380
see it quite frequently okay almost uh

1189
00:57:28,380 --> 00:57:32,940
almost uh you know let's say uh 15 of

1190
00:57:32,940 --> 00:57:36,020
the time at least yes sir

1191
00:57:39,240 --> 00:57:41,779
yes

1192
00:57:45,020 --> 00:57:48,420
Microsoft has disabled the macros by

1193
00:57:48,420 --> 00:57:50,760
default and you are correct uh what

1194
00:57:50,760 --> 00:57:54,240
we're seeing a lot of right now is uh uh

1195
00:57:54,240 --> 00:57:58,380
attachments uh that are disk images ISO

1196
00:57:58,380 --> 00:58:00,900
files and they will have a window

1197
00:58:00,900 --> 00:58:02,640
shortcut and they'll have a hidden file

1198
00:58:02,640 --> 00:58:06,359
somewhere on the image that is a Mount

1199
00:58:06,359 --> 00:58:09,000
usually a malware dll you double click

1200
00:58:09,000 --> 00:58:10,859
the Windows shortcut the only visible

1201
00:58:10,859 --> 00:58:13,920
file it runs the malware whatever it is

1202
00:58:13,920 --> 00:58:17,280
CAC bot bumblebee uh iced ID whatever

1203
00:58:17,280 --> 00:58:19,380
but I think that's it I will take

1204
00:58:19,380 --> 00:58:21,540
anybody else's question thank you guys

1205
00:58:21,540 --> 00:58:23,720
very much

1206
00:58:23,720 --> 00:58:25,980
[Applause]

