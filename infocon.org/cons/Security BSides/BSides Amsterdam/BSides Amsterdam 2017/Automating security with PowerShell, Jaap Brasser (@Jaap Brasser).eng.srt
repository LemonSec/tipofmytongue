1
00:00:04,350 --> 00:00:12,748
<font color="#E5E5E5">okay I'm just</font><font color="#CCCCCC"> going to keep on going</font>

2
00:00:07,779 --> 00:00:15,129
right away<font color="#E5E5E5"> everyone okay with that good</font>

3
00:00:12,749 --> 00:00:18,670
<font color="#E5E5E5">so today</font><font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> here</font><font color="#CCCCCC"> to talk</font><font color="#E5E5E5"> about</font>

4
00:00:15,129 --> 00:00:21,700
automating security<font color="#E5E5E5"> using PowerShell</font>

5
00:00:18,670 --> 00:00:23,500
my name is<font color="#E5E5E5"> yap</font><font color="#CCCCCC"> I'm a</font><font color="#E5E5E5"> little bit short on</font>

6
00:00:21,700 --> 00:00:25,810
time today<font color="#E5E5E5"> with everything I want the</font>

7
00:00:23,500 --> 00:00:28,990
show so tumbleweed I will explain<font color="#E5E5E5"> who I</font>

8
00:00:25,810 --> 00:00:32,168
<font color="#E5E5E5">am later and otherwise check out my</font>

9
00:00:28,990 --> 00:00:34,530
Twitter<font color="#CCCCCC"> or my blog</font><font color="#E5E5E5"> so the agenda</font><font color="#CCCCCC"> of</font>

10
00:00:32,168 --> 00:00:36,819
today<font color="#E5E5E5"> there will</font><font color="#CCCCCC"> be a lot of</font><font color="#E5E5E5"> PowerShell</font>

11
00:00:34,530 --> 00:00:39,120
<font color="#E5E5E5">PowerShell is my hammer I love using</font>

12
00:00:36,820 --> 00:00:42,190
PowerShell because it's what I know

13
00:00:39,120 --> 00:00:44,769
so this presentation will feature a lot

14
00:00:42,190 --> 00:00:47,140
<font color="#E5E5E5">of PowerShell just to get an idea</font><font color="#CCCCCC"> how</font>

15
00:00:44,769 --> 00:00:51,640
many<font color="#E5E5E5"> people actually use PowerShell so I</font>

16
00:00:47,140 --> 00:00:56,850
know what a level is here<font color="#E5E5E5"> all right</font><font color="#CCCCCC"> I'd</font>

17
00:00:51,640 --> 00:00:56,850
say about<font color="#CCCCCC"> 50% you know optimistic Sam</font>

18
00:00:57,239 --> 00:01:02,858
<font color="#E5E5E5">okay so at first I'll</font><font color="#CCCCCC"> be talking</font><font color="#E5E5E5"> about</font>

19
00:01:01,030 --> 00:01:05,710
PowerShell how it's being used both

20
00:01:02,859 --> 00:01:08,229
offensively and<font color="#CCCCCC"> defensively then I'll</font>

21
00:01:05,710 --> 00:01:10,839
show a demo using<font color="#E5E5E5"> mimikatz</font>

22
00:01:08,229 --> 00:01:16,390
and how we can how we can<font color="#E5E5E5"> see what is</font>

23
00:01:10,840 --> 00:01:18,579
<font color="#E5E5E5">being executed</font><font color="#CCCCCC"> then I'll move on to a</font>

24
00:01:16,390 --> 00:01:23,289
bit about offensive and defensive

25
00:01:18,579 --> 00:01:26,969
<font color="#E5E5E5">PowerShell</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> will do a demo to show how</font>

26
00:01:23,289 --> 00:01:29,590
to how to<font color="#E5E5E5"> work with obfuscated code and</font>

27
00:01:26,969 --> 00:01:32,829
at the end<font color="#CCCCCC"> hopefully I'll have some</font><font color="#E5E5E5"> time</font>

28
00:01:29,590 --> 00:01:35,770
for<font color="#E5E5E5"> Q&A and after every demo</font><font color="#CCCCCC"> I'll just</font>

29
00:01:32,829 --> 00:01:37,298
check if anyone<font color="#E5E5E5"> has any questions</font><font color="#CCCCCC"> if</font>

30
00:01:35,770 --> 00:01:39,280
there's any questions I'll do a quick

31
00:01:37,299 --> 00:01:45,189
<font color="#E5E5E5">one two questions and move on with the</font>

32
00:01:39,280 --> 00:01:47,289
presentation good<font color="#E5E5E5"> so PowerShell has been</font>

33
00:01:45,189 --> 00:01:50,609
around for quite<font color="#E5E5E5"> some time it's</font>

34
00:01:47,289 --> 00:01:54,280
obviously a Microsoft Microsoft product

35
00:01:50,609 --> 00:01:56,619
<font color="#E5E5E5">we've reached version 5</font><font color="#CCCCCC"> with</font><font color="#E5E5E5"> the release</font>

36
00:01:54,280 --> 00:02:00,579
of<font color="#E5E5E5"> Windows release of Windows 10 and</font>

37
00:01:56,619 --> 00:02:02,829
Server 2016<font color="#E5E5E5"> and with version 5 we got a</font>

38
00:02:00,579 --> 00:02:06,119
lot of cool benefits<font color="#E5E5E5"> from a security</font>

39
00:02:02,829 --> 00:02:08,619
<font color="#E5E5E5">point of view they really double</font><font color="#CCCCCC"> down on</font>

40
00:02:06,119 --> 00:02:10,658
what will<font color="#E5E5E5"> be locked when it's executed</font>

41
00:02:08,619 --> 00:02:12,659
<font color="#CCCCCC">so in</font><font color="#E5E5E5"> previous versions of PowerShell</font>

42
00:02:10,658 --> 00:02:15,340
what you had you could<font color="#CCCCCC"> set up</font>

43
00:02:12,659 --> 00:02:16,299
<font color="#E5E5E5">transcription using PowerShell profiles</font>

44
00:02:15,340 --> 00:02:19,300
and<font color="#E5E5E5"> stuff like</font>

45
00:02:16,300 --> 00:02:19,780
but it was<font color="#E5E5E5"> very easy</font><font color="#CCCCCC"> to to get a gown</font>

46
00:02:19,300 --> 00:02:22,020
death

47
00:02:19,780 --> 00:02:25,780
they've been some projects on github

48
00:02:22,020 --> 00:02:30,930
<font color="#CCCCCC">called</font><font color="#E5E5E5"> NPS not PowerShell which was just</font>

49
00:02:25,780 --> 00:02:33,130
a simple a simple c-sharp program<font color="#CCCCCC"> that's</font>

50
00:02:30,930 --> 00:02:34,900
loaded the<font color="#E5E5E5"> PowerShell engine and then</font>

51
00:02:33,130 --> 00:02:38,320
you could execute power shell code<font color="#E5E5E5"> with</font>

52
00:02:34,900 --> 00:02:41,770
no more logging<font color="#E5E5E5"> so starting from version</font>

53
00:02:38,320 --> 00:02:43,150
<font color="#E5E5E5">5 it's no longer about it's so possible</font>

54
00:02:41,770 --> 00:02:45,700
<font color="#E5E5E5">to do it but if you have</font><font color="#CCCCCC"> login</font>

55
00:02:43,150 --> 00:02:49,690
configured<font color="#CCCCCC"> which I'll show is very</font><font color="#E5E5E5"> easy</font>

56
00:02:45,700 --> 00:02:55,560
<font color="#CCCCCC">to do</font><font color="#E5E5E5"> you'll be</font><font color="#CCCCCC"> able to see what is</font>

57
00:02:49,690 --> 00:02:55,560
<font color="#E5E5E5">going on on your system am</font><font color="#CCCCCC"> i</font><font color="#E5E5E5"> doing this</font>

58
00:03:16,560 --> 00:03:28,270
<font color="#CCCCCC">ok let's see where did I leave off</font>

59
00:03:22,410 --> 00:03:30,550
<font color="#E5E5E5">logging yep I love logging so in the</font>

60
00:03:28,270 --> 00:03:34,030
demo I<font color="#E5E5E5"> will be showing a</font><font color="#CCCCCC"> recorder the</font>

61
00:03:30,550 --> 00:03:35,950
<font color="#E5E5E5">video I'll use mimikatz who here is</font>

62
00:03:34,030 --> 00:03:38,260
familiar with<font color="#E5E5E5"> me me</font><font color="#CCCCCC"> cats</font><font color="#E5E5E5"> I think pretty</font>

63
00:03:35,950 --> 00:03:40,260
<font color="#CCCCCC">much every security</font><font color="#E5E5E5"> conference someone</font>

64
00:03:38,260 --> 00:03:44,760
will demo<font color="#E5E5E5"> something with me me</font><font color="#CCCCCC"> cats so</font>

65
00:03:40,260 --> 00:03:44,760
I'll I'll be<font color="#CCCCCC"> the</font><font color="#E5E5E5"> one this time</font>

66
00:03:46,500 --> 00:03:52,360
so<font color="#CCCCCC"> me me cats and PowerShell logging</font>

67
00:03:49,930 --> 00:03:55,840
<font color="#E5E5E5">I'll first explain what kind of what</font>

68
00:03:52,360 --> 00:03:56,760
<font color="#E5E5E5">kind of system I have I have Server 2008</font>

69
00:03:55,840 --> 00:03:59,320
r2

70
00:03:56,760 --> 00:04:03,790
it's an old operating system<font color="#E5E5E5"> I</font>

71
00:03:59,320 --> 00:04:05,489
deliberately chose<font color="#E5E5E5"> 2008</font><font color="#CCCCCC"> to show the</font>

72
00:04:03,790 --> 00:04:08,320
benefit of<font color="#CCCCCC"> actually installing</font>

73
00:04:05,489 --> 00:04:11,230
<font color="#E5E5E5">installing PowerShell 5 on top of it</font>

74
00:04:08,320 --> 00:04:14,170
actually<font color="#CCCCCC"> it's running PowerShell 5.1 but</font>

75
00:04:11,230 --> 00:04:16,719
<font color="#E5E5E5">it's not a huge difference</font><font color="#CCCCCC"> one thing to</font>

76
00:04:14,170 --> 00:04:19,358
consider if<font color="#E5E5E5"> you have Windows systems is</font>

77
00:04:16,720 --> 00:04:21,730
that PowerShell will not automatically

78
00:04:19,358 --> 00:04:23,289
be patched by Windows<font color="#E5E5E5"> Update so if you</font>

79
00:04:21,730 --> 00:04:27,039
want to have a new version of PowerShell

80
00:04:23,290 --> 00:04:28,720
you actually<font color="#E5E5E5"> actively have to have some</font>

81
00:04:27,039 --> 00:04:31,020
kind<font color="#CCCCCC"> of strategy to</font><font color="#E5E5E5"> deploy it in your</font>

82
00:04:28,720 --> 00:04:31,020
environment

83
00:04:32,940 --> 00:04:38,520
<font color="#E5E5E5">all right let's see if it actually other</font>

84
00:04:35,560 --> 00:04:41,710
place<font color="#E5E5E5"> there we go</font>

85
00:04:38,520 --> 00:04:44,039
so first things first<font color="#E5E5E5"> I'm going to</font>

86
00:04:41,710 --> 00:04:47,560
enable logging<font color="#CCCCCC"> I said it was really easy</font>

87
00:04:44,040 --> 00:04:50,020
<font color="#CCCCCC">it's basically to get to</font><font color="#E5E5E5"> see keys</font><font color="#CCCCCC"> the</font>

88
00:04:47,560 --> 00:04:53,560
top one<font color="#E5E5E5"> is skip</font><font color="#CCCCCC"> lock</font><font color="#E5E5E5"> invocation logging</font>

89
00:04:50,020 --> 00:04:55,570
<font color="#CCCCCC">that means</font><font color="#E5E5E5"> that's the the most robust</font>

90
00:04:53,560 --> 00:04:58,450
way<font color="#CCCCCC"> of logging</font><font color="#E5E5E5"> so in enable that and</font>

91
00:04:55,570 --> 00:05:01,090
<font color="#E5E5E5">skip</font><font color="#CCCCCC"> lock logging skip work logging will</font>

92
00:04:58,450 --> 00:05:04,690
enable logging in<font color="#E5E5E5"> the Windows Event log</font>

93
00:05:01,090 --> 00:05:08,770
in a<font color="#E5E5E5"> PowerShell operational log so this</font>

94
00:05:04,690 --> 00:05:11,530
is<font color="#E5E5E5"> set</font><font color="#CCCCCC"> up I'll be working with a power</font>

95
00:05:08,770 --> 00:05:13,390
sploit module<font color="#E5E5E5"> this is a power module</font>

96
00:05:11,530 --> 00:05:21,010
that<font color="#E5E5E5"> use a lot of</font><font color="#CCCCCC"> Metasploit</font>

97
00:05:13,390 --> 00:05:22,780
functionality<font color="#E5E5E5"> I'll import it there's a</font>

98
00:05:21,010 --> 00:05:42,370
lot<font color="#E5E5E5"> of commands available here sorry for</font>

99
00:05:22,780 --> 00:05:44,200
<font color="#CCCCCC">the static alright so okay so mimikatz</font>

100
00:05:42,370 --> 00:05:46,180
<font color="#E5E5E5">I'm</font><font color="#CCCCCC"> showing some examples here of how</font>

101
00:05:44,200 --> 00:05:47,140
you can use it<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> very simple invoked</font>

102
00:05:46,180 --> 00:05:51,190
as mimikatz

103
00:05:47,140 --> 00:05:52,599
and then you can execute it<font color="#CCCCCC"> so let's see</font>

104
00:05:51,190 --> 00:05:54,729
when I'm actually going to<font color="#E5E5E5"> type it</font>

105
00:05:52,600 --> 00:05:58,240
should be coming<font color="#E5E5E5"> soon there we go invoke</font>

106
00:05:54,729 --> 00:06:02,460
mimikatz<font color="#CCCCCC"> and this will</font><font color="#E5E5E5"> just be executing</font>

107
00:05:58,240 --> 00:06:02,460
<font color="#CCCCCC">mimikatz</font><font color="#E5E5E5"> and dumping my credentials</font>

108
00:06:02,880 --> 00:06:08,790
<font color="#E5E5E5">because it's a little bit hard to read</font>

109
00:06:05,140 --> 00:06:08,789
and we were<font color="#E5E5E5"> working with plain text</font>

110
00:06:09,390 --> 00:06:16,630
<font color="#E5E5E5">let's see</font><font color="#CCCCCC"> the operational log I didn't</font>

111
00:06:13,720 --> 00:06:23,200
do any<font color="#E5E5E5"> different configuration</font><font color="#CCCCCC"> it's set</font>

112
00:06:16,630 --> 00:06:25,300
to 15 15 megabytes<font color="#E5E5E5"> size of 50 megabytes</font>

113
00:06:23,200 --> 00:06:27,669
<font color="#E5E5E5">and it automatically goes over so if you</font>

114
00:06:25,300 --> 00:06:30,970
have a lot of<font color="#E5E5E5"> events it will just do</font>

115
00:06:27,669 --> 00:06:33,099
<font color="#E5E5E5">circular logging</font><font color="#CCCCCC"> alright Here I am</font>

116
00:06:30,970 --> 00:06:34,990
<font color="#E5E5E5">showing mimikatz so you can see my</font>

117
00:06:33,100 --> 00:06:37,240
<font color="#CCCCCC">username and</font><font color="#E5E5E5"> password it's a little bit</font>

118
00:06:34,990 --> 00:06:40,930
small it's<font color="#E5E5E5"> administrator and besides</font>

119
00:06:37,240 --> 00:06:43,040
Amsterdam<font color="#E5E5E5"> so it's it's very good it has</font>

120
00:06:40,930 --> 00:06:49,520
numbers and capital<font color="#CCCCCC"> letters so</font>

121
00:06:43,040 --> 00:06:52,040
what else do we need so<font color="#CCCCCC"> we</font><font color="#E5E5E5"> can see here</font>

122
00:06:49,520 --> 00:06:53,719
the oldest<font color="#E5E5E5"> record number is number seven</font>

123
00:06:52,040 --> 00:06:57,320
thousand so<font color="#CCCCCC"> we can see that</font><font color="#E5E5E5"> it has</font>

124
00:06:53,720 --> 00:06:59,450
<font color="#CCCCCC">already rolled over to show what will</font>

125
00:06:57,320 --> 00:07:02,540
<font color="#E5E5E5">happen if I execute mimikatz five times</font>

126
00:06:59,450 --> 00:07:04,820
in a go we will<font color="#E5E5E5"> see that a lot of events</font>

127
00:07:02,540 --> 00:07:07,850
will be generated in<font color="#E5E5E5"> the event log so</font>

128
00:07:04,820 --> 00:07:12,340
this will<font color="#CCCCCC"> done it</font><font color="#E5E5E5"> actually takes</font><font color="#CCCCCC"> longer</font>

129
00:07:07,850 --> 00:07:15,800
to<font color="#E5E5E5"> run but</font><font color="#CCCCCC"> like</font><font color="#E5E5E5"> hopefully cut it short</font>

130
00:07:12,340 --> 00:07:19,820
it will run<font color="#E5E5E5"> five times</font><font color="#CCCCCC"> and every time</font><font color="#E5E5E5"> a</font>

131
00:07:15,800 --> 00:07:23,930
<font color="#CCCCCC">skip</font><font color="#E5E5E5"> book is running it will it will log</font>

132
00:07:19,820 --> 00:07:26,300
it in the event<font color="#CCCCCC"> log and</font><font color="#E5E5E5"> every time he</font>

133
00:07:23,930 --> 00:07:29,180
does<font color="#E5E5E5"> that</font><font color="#CCCCCC"> you can see here</font><font color="#E5E5E5"> it again five</font>

134
00:07:26,300 --> 00:07:33,440
times<font color="#E5E5E5"> and it's now up to</font><font color="#CCCCCC"> 340</font><font color="#E5E5E5"> thousand</font>

135
00:07:29,180 --> 00:07:36,110
events that have<font color="#CCCCCC"> been</font><font color="#E5E5E5"> lost since because</font>

136
00:07:33,440 --> 00:07:38,900
<font color="#E5E5E5">of circular logging so the fact that we</font>

137
00:07:36,110 --> 00:07:41,420
enable<font color="#E5E5E5"> the most verbose logging also</font>

138
00:07:38,900 --> 00:07:45,440
means<font color="#E5E5E5"> that every time one command is</font>

139
00:07:41,420 --> 00:07:48,080
being executed<font color="#CCCCCC"> we get about 10</font><font color="#E5E5E5"> megabytes</font>

140
00:07:45,440 --> 00:07:50,780
of logging so it's a lot of<font color="#CCCCCC"> logging</font><font color="#E5E5E5"> so</font>

141
00:07:48,080 --> 00:07:56,150
we should<font color="#E5E5E5"> probably turn that off which</font>

142
00:07:50,780 --> 00:07:59,090
is what<font color="#E5E5E5"> I'm</font><font color="#CCCCCC"> doing here so</font><font color="#E5E5E5"> I said the</font>

143
00:07:56,150 --> 00:08:00,739
<font color="#E5E5E5">invocation</font><font color="#CCCCCC"> skipper logging to</font><font color="#E5E5E5"> zero so we</font>

144
00:07:59,090 --> 00:08:03,650
have<font color="#E5E5E5"> a little bit less</font><font color="#CCCCCC"> for both logging</font>

145
00:08:00,740 --> 00:08:05,690
<font color="#E5E5E5">but</font><font color="#CCCCCC"> we'll actually</font><font color="#E5E5E5"> be</font><font color="#CCCCCC"> able to get the</font>

146
00:08:03,650 --> 00:08:08,630
information<font color="#CCCCCC"> we want because right now</font>

147
00:08:05,690 --> 00:08:12,260
before<font color="#E5E5E5"> we weren't able to see what had</font>

148
00:08:08,630 --> 00:08:15,380
<font color="#E5E5E5">been executed so I</font><font color="#CCCCCC"> cleared the event log</font>

149
00:08:12,260 --> 00:08:17,210
so we<font color="#E5E5E5"> can start from</font><font color="#CCCCCC"> scratch</font><font color="#E5E5E5"> and because</font>

150
00:08:15,380 --> 00:08:19,070
how he configured the logging I open a

151
00:08:17,210 --> 00:08:21,409
new<font color="#CCCCCC"> powershell because otherwise it uses</font>

152
00:08:19,070 --> 00:08:25,400
<font color="#E5E5E5">the old settings</font><font color="#CCCCCC"> it only checks it when</font>

153
00:08:21,410 --> 00:08:28,340
when the session<font color="#CCCCCC"> loads so</font><font color="#E5E5E5"> I execute mini</font>

154
00:08:25,400 --> 00:08:30,620
cuts again and get the passwords<font color="#E5E5E5"> just</font>

155
00:08:28,340 --> 00:08:32,689
like the same<font color="#E5E5E5"> way</font><font color="#CCCCCC"> I'll check the event</font>

156
00:08:30,620 --> 00:08:35,929
log<font color="#E5E5E5"> and I can see one of</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> first</font>

157
00:08:32,690 --> 00:08:39,500
<font color="#CCCCCC">events in there was invoke mimikatz</font><font color="#E5E5E5"> so</font>

158
00:08:35,929 --> 00:08:41,239
we can use this to take a look<font color="#CCCCCC"> what kind</font>

159
00:08:39,500 --> 00:08:44,780
of commands are being executed on your

160
00:08:41,240 --> 00:08:47,620
system<font color="#E5E5E5"> and based on</font><font color="#CCCCCC"> that we can</font><font color="#E5E5E5"> tie</font>

161
00:08:44,780 --> 00:08:47,620
actions to that

162
00:08:50,590 --> 00:08:56,180
so any questions<font color="#CCCCCC"> about what I've shown</font>

163
00:08:53,810 --> 00:08:58,790
here<font color="#CCCCCC"> I know</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> forms is really small</font>

164
00:08:56,180 --> 00:09:01,520
I didn't know how big<font color="#E5E5E5"> the</font><font color="#CCCCCC"> scheme would</font>

165
00:08:58,790 --> 00:09:03,740
be<font color="#CCCCCC"> here so what I've done</font><font color="#E5E5E5"> I set</font><font color="#CCCCCC"> up our</font>

166
00:09:01,520 --> 00:09:06,530
<font color="#CCCCCC">share logging I use mimikatz to dump the</font>

167
00:09:03,740 --> 00:09:08,960
credentials<font color="#CCCCCC"> I then he</font><font color="#E5E5E5"> configured the</font>

168
00:09:06,530 --> 00:09:13,189
logging<font color="#CCCCCC"> because I was generating too too</font>

169
00:09:08,960 --> 00:09:15,050
<font color="#E5E5E5">many events and I don't want to buy a</font>

170
00:09:13,190 --> 00:09:18,320
<font color="#CCCCCC">new sound</font><font color="#E5E5E5"> just to be able to store my</font>

171
00:09:15,050 --> 00:09:20,510
PowerShell logging<font color="#CCCCCC"> I followed what was</font>

172
00:09:18,320 --> 00:09:21,800
happening in<font color="#E5E5E5"> event log and because of</font>

173
00:09:20,510 --> 00:09:43,910
<font color="#E5E5E5">that</font><font color="#CCCCCC"> I could see</font><font color="#E5E5E5"> that the invoke</font>

174
00:09:21,800 --> 00:09:49,069
mimikatz had gone on my system yes so

175
00:09:43,910 --> 00:09:52,400
the question<font color="#E5E5E5"> was let me face</font><font color="#CCCCCC"> it the</font>

176
00:09:49,070 --> 00:09:54,380
<font color="#E5E5E5">question was can</font><font color="#CCCCCC"> we also see what kind</font>

177
00:09:52,400 --> 00:09:57,220
of commands<font color="#E5E5E5"> have been</font><font color="#CCCCCC"> executed to alsace</font>

178
00:09:54,380 --> 00:09:59,990
<font color="#E5E5E5">and can we go into that level of detail</font>

179
00:09:57,220 --> 00:10:01,820
<font color="#E5E5E5">it depends if</font><font color="#CCCCCC"> it's being executed</font><font color="#E5E5E5"> by the</font>

180
00:09:59,990 --> 00:10:05,750
<font color="#E5E5E5">PowerShell engine you'll be able to see</font>

181
00:10:01,820 --> 00:10:08,060
it in the logging<font color="#CCCCCC"> if it's outside of</font>

182
00:10:05,750 --> 00:10:14,360
PowerShell then it's no<font color="#CCCCCC"> longer in the</font>

183
00:10:08,060 --> 00:10:16,339
logging<font color="#CCCCCC"> if LSS is in here I didn't dig</font>

184
00:10:14,360 --> 00:10:19,820
through all<font color="#CCCCCC"> the events so I'm</font><font color="#E5E5E5"> actually</font>

185
00:10:16,340 --> 00:10:22,850
<font color="#E5E5E5">not</font><font color="#CCCCCC"> sure in what in what sense we can</font>

186
00:10:19,820 --> 00:10:25,180
see what has been<font color="#E5E5E5"> executed there does</font>

187
00:10:22,850 --> 00:10:32,200
<font color="#E5E5E5">that answer your question</font>

188
00:10:25,180 --> 00:10:36,079
<font color="#E5E5E5">all right so offensive PowerShell</font>

189
00:10:32,200 --> 00:10:38,630
because because<font color="#CCCCCC"> of</font><font color="#E5E5E5"> this logging</font><font color="#CCCCCC"> a trend</font>

190
00:10:36,080 --> 00:10:42,320
<font color="#CCCCCC">I've been seeing I've been seeing more</font>

191
00:10:38,630 --> 00:10:43,070
is that<font color="#E5E5E5"> people in the past two or three</font>

192
00:10:42,320 --> 00:10:44,690
<font color="#E5E5E5">years</font>

193
00:10:43,070 --> 00:10:46,820
PowerShell has really been packing up

194
00:10:44,690 --> 00:10:49,940
there's<font color="#CCCCCC"> been a lot of pen testing</font>

195
00:10:46,820 --> 00:10:52,430
frameworks<font color="#E5E5E5"> now we're showing up</font><font color="#CCCCCC"> that at</font>

196
00:10:49,940 --> 00:10:55,730
least one<font color="#E5E5E5"> of the components of</font><font color="#CCCCCC"> power is</font>

197
00:10:52,430 --> 00:10:57,319
using PowerShell if not if<font color="#CCCCCC"> not</font>

198
00:10:55,730 --> 00:11:00,890
everything<font color="#E5E5E5"> at</font><font color="#CCCCCC"> least something is</font>

199
00:10:57,320 --> 00:11:03,320
PowerShell<font color="#E5E5E5"> is that because</font><font color="#CCCCCC"> of the</font>

200
00:11:00,890 --> 00:11:03,720
logging it also becomes easier to<font color="#E5E5E5"> see</font>

201
00:11:03,320 --> 00:11:05,970
<font color="#E5E5E5">what</font>

202
00:11:03,720 --> 00:11:09,029
happening<font color="#E5E5E5"> in the</font><font color="#CCCCCC"> environment and have</font>

203
00:11:05,970 --> 00:11:11,730
hurt situations<font color="#E5E5E5"> at companies were</font><font color="#CCCCCC"> at</font>

204
00:11:09,029 --> 00:11:13,079
<font color="#E5E5E5">blue and get the team competitions where</font>

205
00:11:11,730 --> 00:11:16,560
the blue team<font color="#E5E5E5"> is trying to figure</font><font color="#CCCCCC"> out</font>

206
00:11:13,079 --> 00:11:19,079
<font color="#E5E5E5">what the</font><font color="#CCCCCC"> GAT team is doing and there's</font>

207
00:11:16,560 --> 00:11:20,609
been some big<font color="#E5E5E5"> successes for blue</font><font color="#CCCCCC"> team's</font>

208
00:11:19,079 --> 00:11:22,170
<font color="#E5E5E5">because of the</font><font color="#CCCCCC"> PowerShell logging</font>

209
00:11:20,610 --> 00:11:25,410
<font color="#E5E5E5">because they could just follow step by</font>

210
00:11:22,170 --> 00:11:27,979
step how they were going<font color="#CCCCCC"> to in an</font>

211
00:11:25,410 --> 00:11:27,980
environment

212
00:11:28,879 --> 00:11:34,680
unfortunately in in the real world

213
00:11:32,029 --> 00:11:37,529
even if PowerShell logging is available

214
00:11:34,680 --> 00:11:40,349
<font color="#CCCCCC">I personally haven't seen a lot of</font>

215
00:11:37,529 --> 00:11:41,519
<font color="#E5E5E5">Server 2008 where anyone actually went</font>

216
00:11:40,350 --> 00:11:44,129
<font color="#CCCCCC">through</font><font color="#E5E5E5"> the trouble</font><font color="#CCCCCC"> of installing</font>

217
00:11:41,519 --> 00:11:46,199
PowerShell<font color="#CCCCCC"> 5 so in the real world</font><font color="#E5E5E5"> it's</font>

218
00:11:44,129 --> 00:11:48,810
<font color="#E5E5E5">still pretty good tool</font><font color="#CCCCCC"> for an attacker</font>

219
00:11:46,199 --> 00:11:54,139
<font color="#CCCCCC">it's easy to use I mean</font><font color="#E5E5E5"> even I can</font><font color="#CCCCCC"> use</font>

220
00:11:48,810 --> 00:11:54,138
it so that<font color="#E5E5E5"> that has</font><font color="#CCCCCC"> to say something and</font>

221
00:11:54,529 --> 00:11:58,800
because it's available on so<font color="#E5E5E5"> many</font>

222
00:11:56,670 --> 00:12:01,500
platforms and it is also available

223
00:11:58,800 --> 00:12:03,508
<font color="#CCCCCC">online X and Mac but yeah it's the same</font>

224
00:12:01,500 --> 00:12:08,449
<font color="#E5E5E5">thing as Server 2008 nobody in so sit</font>

225
00:12:03,509 --> 00:12:12,660
<font color="#CCCCCC">there</font><font color="#E5E5E5"> so it it is a very easy target</font>

226
00:12:08,449 --> 00:12:15,660
<font color="#CCCCCC">it's more it's a lot more versatile than</font>

227
00:12:12,660 --> 00:12:19,740
<font color="#E5E5E5">using</font><font color="#CCCCCC"> W skipped or C skip to get your</font>

228
00:12:15,660 --> 00:12:22,019
code executed and as has been<font color="#E5E5E5"> shown</font>

229
00:12:19,740 --> 00:12:24,029
<font color="#CCCCCC">today it's very</font><font color="#E5E5E5"> easy to just download</font>

230
00:12:22,019 --> 00:12:29,100
arbitrary code from the internet and

231
00:12:24,029 --> 00:12:31,230
just<font color="#E5E5E5"> directly executed because logging</font>

232
00:12:29,100 --> 00:12:33,449
<font color="#E5E5E5">gives us the</font><font color="#CCCCCC"> information in a previous</font>

233
00:12:31,230 --> 00:12:37,709
<font color="#CCCCCC">example</font><font color="#E5E5E5"> I just showed that I typed</font>

234
00:12:33,449 --> 00:12:39,628
invoke mimikatz<font color="#CCCCCC"> and okay</font><font color="#E5E5E5"> if you do that</font>

235
00:12:37,709 --> 00:12:42,089
we<font color="#E5E5E5"> can</font><font color="#CCCCCC"> just make a simple regular</font>

236
00:12:39,629 --> 00:12:45,449
expression if<font color="#CCCCCC"> mimic at C being</font><font color="#E5E5E5"> executed</font>

237
00:12:42,089 --> 00:12:48,420
<font color="#E5E5E5">and another bunch of malicious commands</font>

238
00:12:45,449 --> 00:12:50,849
that take<font color="#E5E5E5"> your monitoring alert or do</font>

239
00:12:48,420 --> 00:12:53,219
something<font color="#E5E5E5"> with the system but</font><font color="#CCCCCC"> then</font>

240
00:12:50,850 --> 00:12:55,079
there's also<font color="#E5E5E5"> the</font><font color="#CCCCCC"> side</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> education</font>

241
00:12:53,220 --> 00:12:58,620
<font color="#E5E5E5">because if there's good logging then</font>

242
00:12:55,079 --> 00:13:02,099
obfuscation<font color="#E5E5E5"> becomes becomes a good tool</font>

243
00:12:58,620 --> 00:13:05,399
<font color="#CCCCCC">to hide what you're doing and to show</font>

244
00:13:02,100 --> 00:13:07,800
what<font color="#CCCCCC"> we can do against that</font><font color="#E5E5E5"> I borrowed</font>

245
00:13:05,399 --> 00:13:11,279
some<font color="#E5E5E5"> escapes from Lee</font><font color="#CCCCCC"> Holmes I'm not</font>

246
00:13:07,800 --> 00:13:16,560
sure if anyone<font color="#E5E5E5"> saw his talk on on black</font>

247
00:13:11,279 --> 00:13:21,610
<font color="#E5E5E5">hat</font><font color="#CCCCCC"> he used</font>

248
00:13:16,560 --> 00:13:24,819
<font color="#CCCCCC">he used mathematics to determine how</font>

249
00:13:21,610 --> 00:13:28,810
different escaped<font color="#E5E5E5"> s from from known code</font>

250
00:13:24,820 --> 00:13:33,010
<font color="#E5E5E5">so if you take</font><font color="#CCCCCC"> skip the posit or E</font><font color="#E5E5E5"> and</font>

251
00:13:28,810 --> 00:13:34,569
you analyze how the how<font color="#CCCCCC"> the different</font>

252
00:13:33,010 --> 00:13:37,689
characters<font color="#CCCCCC"> that are used in</font><font color="#E5E5E5"> the script</font>

253
00:13:34,570 --> 00:13:40,600
<font color="#E5E5E5">or distributor</font><font color="#CCCCCC"> then can calculate how</font>

254
00:13:37,690 --> 00:13:42,340
different<font color="#E5E5E5"> a piece of code is from that</font>

255
00:13:40,600 --> 00:13:45,550
and based on<font color="#CCCCCC"> that</font><font color="#E5E5E5"> you could establish</font>

256
00:13:42,340 --> 00:13:53,020
<font color="#E5E5E5">okay this is</font><font color="#CCCCCC"> item malicious or someone</font>

257
00:13:45,550 --> 00:13:55,510
doesn't<font color="#CCCCCC"> know how</font><font color="#E5E5E5"> to code and</font><font color="#CCCCCC"> then</font><font color="#E5E5E5"> we've</font>

258
00:13:53,020 --> 00:14:04,270
arrived<font color="#CCCCCC"> to the next demo</font><font color="#E5E5E5"> so obfuscation</font>

259
00:13:55,510 --> 00:14:06,910
<font color="#E5E5E5">and how we can detect this so here we go</font>

260
00:14:04,270 --> 00:14:08,680
so<font color="#CCCCCC"> the first</font><font color="#E5E5E5"> thing I do I have two</font>

261
00:14:06,910 --> 00:14:11,949
<font color="#E5E5E5">folders I have one folder that's</font>

262
00:14:08,680 --> 00:14:14,770
<font color="#E5E5E5">randomly</font><font color="#CCCCCC"> Pastore with about</font><font color="#E5E5E5"> 300 skips in</font>

263
00:14:11,950 --> 00:14:16,810
there<font color="#E5E5E5"> and I have another folder with a</font>

264
00:14:14,770 --> 00:14:21,280
couple<font color="#E5E5E5"> of standard scripts and I put</font>

265
00:14:16,810 --> 00:14:24,339
invoke mimikatz<font color="#E5E5E5"> invoke mimikatz</font><font color="#CCCCCC"> scaped</font>

266
00:14:21,280 --> 00:14:26,910
in there as well<font color="#CCCCCC"> so the first thing I'll</font>

267
00:14:24,340 --> 00:14:31,330
do is I'll count the characters that<font color="#E5E5E5"> are</font>

268
00:14:26,910 --> 00:14:34,329
<font color="#E5E5E5">that</font><font color="#CCCCCC"> are</font><font color="#E5E5E5"> in this</font><font color="#CCCCCC"> sketch so I put it in a</font>

269
00:14:31,330 --> 00:14:38,850
variable<font color="#E5E5E5"> global global characters and</font>

270
00:14:34,330 --> 00:14:41,440
I'll just load<font color="#CCCCCC"> up my entire repo story</font>

271
00:14:38,850 --> 00:14:45,850
so let's take a<font color="#E5E5E5"> look what</font><font color="#CCCCCC"> the top 10</font>

272
00:14:41,440 --> 00:14:48,430
characters<font color="#CCCCCC"> are and we see it's just a</font>

273
00:14:45,850 --> 00:14:51,640
<font color="#E5E5E5">little bit</font><font color="#CCCCCC"> off the side</font><font color="#E5E5E5"> but it's just</font><font color="#CCCCCC"> a</font>

274
00:14:48,430 --> 00:14:53,260
bit the normal letter so et<font color="#E5E5E5"> are all the</font>

275
00:14:51,640 --> 00:14:59,830
letters if you play<font color="#E5E5E5"> Scrabble you won't</font>

276
00:14:53,260 --> 00:15:02,860
get any points<font color="#CCCCCC"> for it so here's a bit</font>

277
00:14:59,830 --> 00:15:06,490
more code what we're doing here<font color="#E5E5E5"> we're</font>

278
00:15:02,860 --> 00:15:10,060
going<font color="#CCCCCC"> to use the</font><font color="#E5E5E5"> factors similarity and</font>

279
00:15:06,490 --> 00:15:11,200
we're going<font color="#CCCCCC"> to take a look at how to</font>

280
00:15:10,060 --> 00:15:13,150
escape the<font color="#E5E5E5"> weights</font>

281
00:15:11,200 --> 00:15:15,520
against the entire<font color="#CCCCCC"> equipo story how</font>

282
00:15:13,150 --> 00:15:19,000
different<font color="#E5E5E5"> how different is that code and</font>

283
00:15:15,520 --> 00:15:20,949
based<font color="#CCCCCC"> on that we can establish okay is</font>

284
00:15:19,000 --> 00:15:23,620
<font color="#CCCCCC">this</font><font color="#E5E5E5"> going to be malicious</font><font color="#CCCCCC"> or is this</font>

285
00:15:20,950 --> 00:15:27,979
going<font color="#E5E5E5"> to be just regular code like we</font>

286
00:15:23,620 --> 00:15:30,619
would<font color="#E5E5E5"> expect so we're going to</font>

287
00:15:27,979 --> 00:15:32,629
<font color="#E5E5E5">into a</font><font color="#CCCCCC"> pouch your</font><font color="#E5E5E5"> objects and we're</font>

288
00:15:30,619 --> 00:15:36,169
going<font color="#E5E5E5"> to run this against the</font><font color="#CCCCCC"> repo story</font>

289
00:15:32,629 --> 00:15:38,359
with<font color="#E5E5E5"> six normal</font><font color="#CCCCCC"> skips</font><font color="#E5E5E5"> and one is invoke</font>

290
00:15:36,169 --> 00:15:43,759
mimikatz<font color="#E5E5E5"> and we'll take a look what the</font>

291
00:15:38,359 --> 00:15:51,559
<font color="#CCCCCC">Giza odds are if I'm going to press on</font>

292
00:15:43,759 --> 00:15:53,359
<font color="#CCCCCC">enter</font><font color="#E5E5E5"> there we go and what we would</font>

293
00:15:51,559 --> 00:15:55,249
<font color="#CCCCCC">expect to see is that the normal skips</font>

294
00:15:53,359 --> 00:15:57,439
<font color="#E5E5E5">they're going to get</font><font color="#CCCCCC"> a good score close</font>

295
00:15:55,249 --> 00:15:59,239
<font color="#CCCCCC">to a hundred</font><font color="#E5E5E5"> percent similar to the</font>

296
00:15:57,439 --> 00:16:03,469
keyboard story of course never a hundred

297
00:15:59,239 --> 00:16:05,749
percent<font color="#CCCCCC"> and</font><font color="#E5E5E5"> skips that are out</font><font color="#CCCCCC"> of out of</font>

298
00:16:03,470 --> 00:16:09,019
<font color="#E5E5E5">bounds are using obfuscation</font><font color="#CCCCCC"> are using</font>

299
00:16:05,749 --> 00:16:11,509
silly ways to try to avoid detection<font color="#CCCCCC"> are</font>

300
00:16:09,019 --> 00:16:14,929
going<font color="#E5E5E5"> to show up like invoke mimikatz</font>

301
00:16:11,509 --> 00:16:17,089
<font color="#E5E5E5">over here it has</font><font color="#CCCCCC"> a score of 57 percent</font>

302
00:16:14,929 --> 00:16:19,999
similar so it's actually<font color="#CCCCCC"> quite different</font>

303
00:16:17,089 --> 00:16:24,049
<font color="#CCCCCC">and</font><font color="#E5E5E5"> in part this is because it's using a</font>

304
00:16:19,999 --> 00:16:26,629
lot<font color="#CCCCCC"> of a lot of c-sharp</font><font color="#E5E5E5"> code other part</font>

305
00:16:24,049 --> 00:16:30,169
is that<font color="#CCCCCC"> it uses a</font><font color="#E5E5E5"> lot of</font><font color="#CCCCCC"> base64 in there</font>

306
00:16:26,629 --> 00:16:32,720
as well<font color="#E5E5E5"> and that is</font><font color="#CCCCCC"> not something you</font>

307
00:16:30,169 --> 00:16:35,529
would<font color="#E5E5E5"> using the regular code unless you</font>

308
00:16:32,720 --> 00:16:35,529
have a<font color="#E5E5E5"> very good reason</font>

309
00:16:36,879 --> 00:16:50,989
<font color="#CCCCCC">alright so the next thing</font><font color="#E5E5E5"> I'll do if the</font>

310
00:16:44,989 --> 00:16:54,829
video<font color="#E5E5E5"> continues there we go the next</font>

311
00:16:50,989 --> 00:16:59,329
<font color="#CCCCCC">thing I'll do is this</font><font color="#E5E5E5"> is one</font><font color="#CCCCCC"> of one of</font>

312
00:16:54,829 --> 00:17:01,339
<font color="#E5E5E5">my users for using obfuscation in any</font>

313
00:16:59,329 --> 00:17:02,988
<font color="#CCCCCC">useful way what I</font><font color="#E5E5E5"> like</font><font color="#CCCCCC"> to do is</font>

314
00:17:01,339 --> 00:17:05,629
sometimes<font color="#CCCCCC"> I'd like</font><font color="#E5E5E5"> to compress my</font>

315
00:17:02,989 --> 00:17:08,269
<font color="#CCCCCC">escapes if I'm in environments where</font>

316
00:17:05,628 --> 00:17:11,839
<font color="#CCCCCC">it's necessary</font><font color="#E5E5E5"> to have</font><font color="#CCCCCC"> the code be as</font>

317
00:17:08,269 --> 00:17:15,378
small as<font color="#E5E5E5"> possible</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> I've made it</font>

318
00:17:11,839 --> 00:17:18,500
<font color="#E5E5E5">compressed base64 of an existing script</font>

319
00:17:15,378 --> 00:17:23,569
<font color="#E5E5E5">so it's just a whole bunch of</font><font color="#CCCCCC"> garbage</font>

320
00:17:18,500 --> 00:17:26,628
<font color="#E5E5E5">and I'm going to compare how that what</font>

321
00:17:23,569 --> 00:17:28,369
<font color="#E5E5E5">kind of score this would get so we can</font>

322
00:17:26,628 --> 00:17:30,678
see<font color="#E5E5E5"> even though I didn't do anything</font>

323
00:17:28,369 --> 00:17:33,739
special<font color="#E5E5E5"> just make it base64 we can</font>

324
00:17:30,679 --> 00:17:36,799
already see that<font color="#E5E5E5"> it's rating has dropped</font>

325
00:17:33,740 --> 00:17:40,429
to<font color="#E5E5E5"> 72%</font><font color="#CCCCCC"> to give you an indication</font>

326
00:17:36,799 --> 00:17:41,030
<font color="#E5E5E5">anything under</font><font color="#CCCCCC"> 85</font><font color="#E5E5E5"> percent is suspicious</font>

327
00:17:40,429 --> 00:17:43,550
<font color="#E5E5E5">anything</font>

328
00:17:41,030 --> 00:17:47,930
under<font color="#E5E5E5"> 80 is definitely something</font><font color="#CCCCCC"> you</font>

329
00:17:43,550 --> 00:17:51,200
<font color="#CCCCCC">want to</font><font color="#E5E5E5"> look at so here I'm showing that</font>

330
00:17:47,930 --> 00:17:55,400
it's just a regular<font color="#E5E5E5"> scape just to delete</font>

331
00:17:51,200 --> 00:17:57,740
some old files<font color="#CCCCCC"> nothing special</font><font color="#E5E5E5"> in ISE I</font>

332
00:17:55,400 --> 00:17:59,810
see is one of the script editors for

333
00:17:57,740 --> 00:18:02,540
<font color="#CCCCCC">PowerShell</font><font color="#E5E5E5"> there's a module called I see</font>

334
00:17:59,810 --> 00:18:06,919
steroids<font color="#E5E5E5"> and you can convert a script</font>

335
00:18:02,540 --> 00:18:09,230
into obfuscated code<font color="#E5E5E5"> and then you get</font>

336
00:18:06,920 --> 00:18:11,180
<font color="#E5E5E5">something</font><font color="#CCCCCC"> like</font><font color="#E5E5E5"> this but I wouldn't know</font>

337
00:18:09,230 --> 00:18:14,170
what this is doing<font color="#E5E5E5"> anymore I mean LS</font>

338
00:18:11,180 --> 00:18:14,170
what what the hell is that

339
00:18:15,820 --> 00:18:24,200
so I've gotten this to<font color="#CCCCCC"> disk as well and</font>

340
00:18:19,070 --> 00:18:28,669
I'm once again going<font color="#E5E5E5"> to take a look what</font>

341
00:18:24,200 --> 00:18:32,690
this<font color="#E5E5E5"> is what kind of score it is going</font>

342
00:18:28,670 --> 00:18:35,870
<font color="#E5E5E5">to get you can see by using this</font>

343
00:18:32,690 --> 00:18:37,610
application<font color="#CCCCCC"> it already drops to</font><font color="#E5E5E5"> 64</font>

344
00:18:35,870 --> 00:18:49,429
<font color="#E5E5E5">percent while the regular</font><font color="#CCCCCC"> script would</font>

345
00:18:37,610 --> 00:18:52,219
be about 90 97 90<font color="#CCCCCC"> 98%</font><font color="#E5E5E5"> there</font><font color="#CCCCCC"> we go</font><font color="#E5E5E5"> so</font>

346
00:18:49,430 --> 00:18:54,290
what I've<font color="#CCCCCC"> shown here I use the</font><font color="#E5E5E5"> script</font>

347
00:18:52,220 --> 00:18:56,930
<font color="#CCCCCC">that's</font><font color="#E5E5E5"> available in the</font><font color="#CCCCCC"> powershell</font>

348
00:18:54,290 --> 00:18:58,909
gallery to determine the character

349
00:18:56,930 --> 00:19:00,830
frequency<font color="#E5E5E5"> so when we're</font><font color="#CCCCCC"> looking at the</font>

350
00:18:58,910 --> 00:19:03,770
character frequency we exclude stuff

351
00:19:00,830 --> 00:19:07,570
<font color="#E5E5E5">like whitespace and line endings then I</font>

352
00:19:03,770 --> 00:19:10,879
used<font color="#CCCCCC"> vector frequency to take a look at</font>

353
00:19:07,570 --> 00:19:14,689
how the character frequency relates to

354
00:19:10,880 --> 00:19:17,000
my entire repository then<font color="#E5E5E5"> I encoded</font>

355
00:19:14,690 --> 00:19:19,580
existing scripts and I looked at the

356
00:19:17,000 --> 00:19:22,220
different<font color="#E5E5E5"> methods of of obfuscation so</font>

357
00:19:19,580 --> 00:19:25,510
in one I used<font color="#CCCCCC"> compression and base 64</font>

358
00:19:22,220 --> 00:19:28,850
the second example I used<font color="#E5E5E5"> built-in</font>

359
00:19:25,510 --> 00:19:31,790
<font color="#CCCCCC">belphin method in icy steroids to</font>

360
00:19:28,850 --> 00:19:37,100
obfuscate escapes<font color="#E5E5E5"> something else you can</font>

361
00:19:31,790 --> 00:19:38,590
do in<font color="#E5E5E5"> in</font><font color="#CCCCCC"> powersploit it's powersploit or</font>

362
00:19:37,100 --> 00:19:41,510
<font color="#E5E5E5">Empire which one was it</font>

363
00:19:38,590 --> 00:19:45,889
<font color="#E5E5E5">Empire in Empire and other PowerShell</font>

364
00:19:41,510 --> 00:19:48,560
module<font color="#E5E5E5"> there's also it's also a function</font>

365
00:19:45,890 --> 00:19:51,650
<font color="#E5E5E5">called invoke obfuscation</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> you can</font>

366
00:19:48,560 --> 00:19:53,840
obfuscate<font color="#E5E5E5"> your scripts in a lot of other</font>

367
00:19:51,650 --> 00:19:54,590
different<font color="#CCCCCC"> wastes and I've</font><font color="#E5E5E5"> just shown</font>

368
00:19:53,840 --> 00:19:56,658
here the

369
00:19:54,590 --> 00:19:59,418
just to give<font color="#E5E5E5"> you an indication</font><font color="#CCCCCC"> of how</font>

370
00:19:56,659 --> 00:20:01,520
<font color="#CCCCCC">you can see if something is suspicious</font>

371
00:19:59,419 --> 00:20:05,870
code<font color="#CCCCCC"> without even</font><font color="#E5E5E5"> knowing what is being</font>

372
00:20:01,520 --> 00:20:15,279
executed so any questions about this

373
00:20:05,870 --> 00:20:15,279
demo<font color="#E5E5E5"> okay</font>

374
00:20:19,690 --> 00:20:25,510
so then defensive<font color="#CCCCCC"> powershell how can we</font>

375
00:20:23,740 --> 00:20:28,330
use how can we use PowerShell

376
00:20:25,510 --> 00:20:31,270
defensively<font color="#CCCCCC"> or one of the recent example</font>

377
00:20:28,330 --> 00:20:33,340
so when<font color="#E5E5E5"> I was put in</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> position of</font>

378
00:20:31,270 --> 00:20:37,990
<font color="#E5E5E5">having to use PowerShell defensively was</font>

379
00:20:33,340 --> 00:20:39,750
with one<font color="#CCCCCC"> Akai and everyone is familiar</font>

380
00:20:37,990 --> 00:20:43,870
with<font color="#E5E5E5"> one Akai and what happened there</font>

381
00:20:39,750 --> 00:20:45,790
good it was<font color="#CCCCCC"> not good you you would think</font>

382
00:20:43,870 --> 00:20:47,770
that SMB one would not<font color="#CCCCCC"> be enabled</font>

383
00:20:45,790 --> 00:20:50,530
everywhere<font color="#E5E5E5"> but we had we had some</font>

384
00:20:47,770 --> 00:20:52,740
<font color="#CCCCCC">clients that were very unhappy</font><font color="#E5E5E5"> when when</font>

385
00:20:50,530 --> 00:20:56,160
this<font color="#E5E5E5"> all happened</font>

386
00:20:52,740 --> 00:20:58,870
but this was one of<font color="#E5E5E5"> the cases where</font>

387
00:20:56,160 --> 00:21:01,000
detection was not really<font color="#E5E5E5"> that important</font>

388
00:20:58,870 --> 00:21:03,189
<font color="#CCCCCC">because we we knew what was going on on</font>

389
00:21:01,000 --> 00:21:06,160
<font color="#E5E5E5">those systems</font><font color="#CCCCCC"> that what we use</font>

390
00:21:03,190 --> 00:21:08,440
PowerShell for we use it as an impromptu

391
00:21:06,160 --> 00:21:13,270
configuration tool to make sure that

392
00:21:08,440 --> 00:21:16,840
everything got either<font color="#CCCCCC"> got</font><font color="#E5E5E5"> smb1 disabled</font>

393
00:21:13,270 --> 00:21:19,570
or got pets to a correct<font color="#E5E5E5"> level so we</font>

394
00:21:16,840 --> 00:21:24,040
used a number of escapes there<font color="#E5E5E5"> that we</font>

395
00:21:19,570 --> 00:21:26,620
<font color="#CCCCCC">combined to figure out which systems are</font>

396
00:21:24,040 --> 00:21:32,530
vulnerable which systems are patched<font color="#E5E5E5"> and</font>

397
00:21:26,620 --> 00:21:37,590
based on<font color="#CCCCCC"> that first based on</font><font color="#E5E5E5"> the data</font>

398
00:21:32,530 --> 00:21:41,470
<font color="#E5E5E5">get the data we gathered we continued on</font>

399
00:21:37,590 --> 00:21:43,689
using custom<font color="#E5E5E5"> scripts to to deploy the</font>

400
00:21:41,470 --> 00:21:47,020
patches and<font color="#E5E5E5"> to make</font><font color="#CCCCCC"> sure</font><font color="#E5E5E5"> that the</font>

401
00:21:43,690 --> 00:21:49,510
systems were configured correctly and

402
00:21:47,020 --> 00:21:55,410
could no longer be targeted by one<font color="#CCCCCC"> okay</font>

403
00:21:49,510 --> 00:21:55,410
so<font color="#CCCCCC"> that is</font><font color="#E5E5E5"> how we used it defensively</font>

404
00:21:57,900 --> 00:22:05,170
<font color="#CCCCCC">I've reached the end</font><font color="#E5E5E5"> of the of this do</font>

405
00:22:03,250 --> 00:22:14,910
<font color="#E5E5E5">you have any questions in regards</font><font color="#CCCCCC"> to</font>

406
00:22:05,170 --> 00:22:14,910
what I've discussed any questions

407
00:22:18,270 --> 00:22:22,529
<font color="#E5E5E5">Thanks this your first question today</font>

408
00:22:20,590 --> 00:22:25,600
<font color="#CCCCCC">god</font><font color="#E5E5E5"> yeah I know right</font>

409
00:22:22,529 --> 00:22:28,210
so<font color="#E5E5E5"> you've shown us a lot</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> things</font><font color="#CCCCCC"> what</font>

410
00:22:25,600 --> 00:22:30,039
<font color="#CCCCCC">powershell can do may be a bit more</font><font color="#E5E5E5"> of a</font>

411
00:22:28,210 --> 00:22:31,809
<font color="#CCCCCC">personal note</font><font color="#E5E5E5"> how did you get into</font>

412
00:22:30,039 --> 00:22:35,490
<font color="#E5E5E5">powershell and why do you prefer it so</font>

413
00:22:31,809 --> 00:22:41,860
much why is this your hammer so to speak

414
00:22:35,490 --> 00:22:44,020
<font color="#CCCCCC">I kind of I was put on a project where</font>

415
00:22:41,860 --> 00:22:48,639
<font color="#E5E5E5">we had to migrate some stuff of a server</font>

416
00:22:44,020 --> 00:22:49,990
<font color="#E5E5E5">and there was there was no way to get it</font>

417
00:22:48,640 --> 00:22:53,500
off because it was<font color="#E5E5E5"> a proprietary</font>

418
00:22:49,990 --> 00:22:54,940
<font color="#CCCCCC">Symantec product and we didn't have</font>

419
00:22:53,500 --> 00:22:57,870
<font color="#E5E5E5">vendor support anymore</font>

420
00:22:54,940 --> 00:23:00,190
and we needed<font color="#CCCCCC"> to</font><font color="#E5E5E5"> get stuff off there and</font>

421
00:22:57,870 --> 00:23:01,870
they just<font color="#E5E5E5"> said you</font><font color="#CCCCCC"> guys have two months</font>

422
00:23:00,190 --> 00:23:04,120
<font color="#E5E5E5">you can figure out</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> strategy how to</font>

423
00:23:01,870 --> 00:23:06,039
do it we don't<font color="#CCCCCC"> care if</font><font color="#E5E5E5"> you just have to</font>

424
00:23:04,120 --> 00:23:07,870
<font color="#CCCCCC">double click every file individually or</font>

425
00:23:06,039 --> 00:23:10,000
you're<font color="#E5E5E5"> going to do something in an</font>

426
00:23:07,870 --> 00:23:13,350
automated way<font color="#E5E5E5"> so we used the combination</font>

427
00:23:10,000 --> 00:23:17,020
of vbscript<font color="#E5E5E5"> it was a few</font><font color="#CCCCCC"> years ago</font>

428
00:23:13,350 --> 00:23:20,500
vbscript and<font color="#CCCCCC"> powershell to to get that</font>

429
00:23:17,020 --> 00:23:24,070
migration done and what<font color="#E5E5E5"> it ended up</font>

430
00:23:20,500 --> 00:23:26,470
being was a pretty<font color="#CCCCCC"> easy job because</font>

431
00:23:24,070 --> 00:23:29,950
<font color="#E5E5E5">after</font><font color="#CCCCCC"> we prepared</font><font color="#E5E5E5"> the escapes it took us</font>

432
00:23:26,470 --> 00:23:32,230
about<font color="#E5E5E5"> 3-4 months we spent the year</font>

433
00:23:29,950 --> 00:23:34,210
afterwards<font color="#E5E5E5"> performing all the migrations</font>

434
00:23:32,230 --> 00:23:36,669
in a fully<font color="#E5E5E5"> automated way and all we were</font>

435
00:23:34,210 --> 00:23:40,690
doing<font color="#CCCCCC"> were was</font><font color="#E5E5E5"> let's just say I was</font>

436
00:23:36,669 --> 00:23:44,080
<font color="#E5E5E5">drinking coffee while the migrations</font>

437
00:23:40,690 --> 00:23:46,450
were taking<font color="#E5E5E5"> place so that was my first</font>

438
00:23:44,080 --> 00:23:51,279
time I really saw the benefit of

439
00:23:46,450 --> 00:23:53,679
automation and that I that I actually

440
00:23:51,279 --> 00:23:56,890
<font color="#E5E5E5">put it</font><font color="#CCCCCC"> in practice the reason it was</font>

441
00:23:53,679 --> 00:23:58,539
PowerShell<font color="#CCCCCC"> it was new at the time and it</font>

442
00:23:56,890 --> 00:24:06,039
was on the<font color="#E5E5E5"> Windows</font><font color="#CCCCCC"> platform so</font>

443
00:23:58,539 --> 00:24:08,440
PowerShell was the logical choice so I

444
00:24:06,039 --> 00:24:11,020
know you played with the logging the new

445
00:24:08,440 --> 00:24:13,360
logging stuff impartially<font color="#CCCCCC"> five and um</font>

446
00:24:11,020 --> 00:24:17,590
<font color="#E5E5E5">what logging level did you get</font><font color="#CCCCCC"> but well</font>

447
00:24:13,360 --> 00:24:20,289
<font color="#E5E5E5">I know</font><font color="#CCCCCC"> that the option can't does get D</font>

448
00:24:17,590 --> 00:24:22,178
obfuscated when the actual<font color="#E5E5E5"> PowerShell</font>

449
00:24:20,289 --> 00:24:25,658
command<font color="#CCCCCC"> runs that's</font><font color="#E5E5E5"> correct</font>

450
00:24:22,179 --> 00:24:27,250
so in your experience<font color="#E5E5E5"> what's the best</font>

451
00:24:25,659 --> 00:24:29,080
logging level to continue<font color="#CCCCCC"> to capture</font>

452
00:24:27,250 --> 00:24:32,159
that's to capture that without losing

453
00:24:29,080 --> 00:24:32,158
<font color="#CCCCCC">out</font><font color="#E5E5E5"> information</font>

454
00:24:36,070 --> 00:24:41,929
my strategy for<font color="#CCCCCC"> for systems where</font><font color="#E5E5E5"> it's</font>

455
00:24:39,500 --> 00:24:44,420
<font color="#CCCCCC">actually can't</font><font color="#E5E5E5"> go enough to have this</font>

456
00:24:41,930 --> 00:24:48,820
kind of logging enabled is to enable

457
00:24:44,420 --> 00:24:51,290
event forwarding<font color="#CCCCCC"> forward your events to</font>

458
00:24:48,820 --> 00:24:53,659
<font color="#E5E5E5">for what your events to a different</font>

459
00:24:51,290 --> 00:24:55,220
server<font color="#E5E5E5"> just at the highest logging level</font>

460
00:24:53,660 --> 00:24:59,180
the first one I<font color="#CCCCCC"> configured with</font>

461
00:24:55,220 --> 00:25:01,130
<font color="#E5E5E5">invocation logging and then figure</font><font color="#CCCCCC"> out</font>

462
00:24:59,180 --> 00:25:02,600
on that server which events can<font color="#CCCCCC"> be</font>

463
00:25:01,130 --> 00:25:06,320
discarded<font color="#E5E5E5"> and which ones you actually</font>

464
00:25:02,600 --> 00:25:16,550
<font color="#CCCCCC">want so I would enable</font><font color="#E5E5E5"> for critical</font>

465
00:25:06,320 --> 00:25:19,280
systems the highest level<font color="#E5E5E5"> of logging I</font>

466
00:25:16,550 --> 00:25:21,710
have kind<font color="#E5E5E5"> of a</font><font color="#CCCCCC"> follow-up</font><font color="#E5E5E5"> or comment on</font>

467
00:25:19,280 --> 00:25:23,330
<font color="#E5E5E5">that and that is if if you're in a</font>

468
00:25:21,710 --> 00:25:24,830
situation<font color="#CCCCCC"> where invocation logging is</font>

469
00:25:23,330 --> 00:25:26,600
too much<font color="#E5E5E5"> information or where you're</font>

470
00:25:24,830 --> 00:25:28,159
repeating a lot<font color="#CCCCCC"> of information because</font>

471
00:25:26,600 --> 00:25:30,199
you know you<font color="#E5E5E5"> have a bunch of script logs</font>

472
00:25:28,160 --> 00:25:31,760
executing one over the other

473
00:25:30,200 --> 00:25:33,470
you could complement<font color="#E5E5E5"> the strategy of</font>

474
00:25:31,760 --> 00:25:36,140
<font color="#CCCCCC">using script log logging without</font>

475
00:25:33,470 --> 00:25:38,150
invocation logging<font color="#CCCCCC"> with something like</font>

476
00:25:36,140 --> 00:25:41,000
this one for<font color="#E5E5E5"> example</font><font color="#CCCCCC"> that will</font><font color="#E5E5E5"> also give</font>

477
00:25:38,150 --> 00:25:43,040
you at<font color="#CCCCCC"> least a snapshot</font><font color="#E5E5E5"> of changes to</font>

478
00:25:41,000 --> 00:25:44,690
the<font color="#CCCCCC"> environment which is what invocation</font>

479
00:25:43,040 --> 00:25:47,690
logging is trying is trying to<font color="#E5E5E5"> achieve</font>

480
00:25:44,690 --> 00:25:50,660
<font color="#CCCCCC">so that's kind of an alternative</font><font color="#E5E5E5"> yeah</font>

481
00:25:47,690 --> 00:25:53,240
and<font color="#CCCCCC"> Bachman there's also quite nice if</font>

482
00:25:50,660 --> 00:26:01,970
for<font color="#E5E5E5"> very</font><font color="#CCCCCC"> short-term logging</font><font color="#E5E5E5"> to see what</font>

483
00:25:53,240 --> 00:26:04,160
what's going<font color="#E5E5E5"> on so yeah definitely so I</font>

484
00:26:01,970 --> 00:26:05,330
would<font color="#E5E5E5"> be</font><font color="#CCCCCC"> very happy</font><font color="#E5E5E5"> if someone even if</font>

485
00:26:04,160 --> 00:26:13,460
<font color="#E5E5E5">you don't have a question raise</font><font color="#CCCCCC"> your</font>

486
00:26:05,330 --> 00:26:15,649
<font color="#E5E5E5">hand on the guide</font><font color="#CCCCCC"> side</font><font color="#E5E5E5"> afterwards this</font>

487
00:26:13,460 --> 00:26:17,210
<font color="#E5E5E5">is more of a comment</font><font color="#CCCCCC"> slash follow-on to</font>

488
00:26:15,650 --> 00:26:19,850
both those comments<font color="#CCCCCC"> but we use both</font>

489
00:26:17,210 --> 00:26:21,440
system on and PowerShell logging<font color="#E5E5E5"> but the</font>

490
00:26:19,850 --> 00:26:24,139
cool<font color="#CCCCCC"> thing about</font><font color="#E5E5E5"> the event forwarding is</font>

491
00:26:21,440 --> 00:26:27,320
you can there's some specific XML<font color="#CCCCCC"> that</font>

492
00:26:24,140 --> 00:26:29,330
you can use to tune event forwarding<font color="#CCCCCC"> on</font>

493
00:26:27,320 --> 00:26:31,189
the server so say you have

494
00:26:29,330 --> 00:26:32,629
administrators using a lot of<font color="#CCCCCC"> the same</font>

495
00:26:31,190 --> 00:26:35,360
scripts<font color="#E5E5E5"> all the time throughout the day</font>

496
00:26:32,630 --> 00:26:39,320
you<font color="#E5E5E5"> can take those tune them out and</font>

497
00:26:35,360 --> 00:26:41,419
then still have<font color="#CCCCCC"> a large still have</font>

498
00:26:39,320 --> 00:26:43,010
logging turned on at a higher level<font color="#CCCCCC"> so</font>

499
00:26:41,420 --> 00:26:44,300
you're not<font color="#CCCCCC"> getting a lot of</font><font color="#E5E5E5"> logs sent to</font>

500
00:26:43,010 --> 00:26:45,980
<font color="#CCCCCC">your event server</font>

501
00:26:44,300 --> 00:26:48,590
and we also use system on<font color="#E5E5E5"> to answer your</font>

502
00:26:45,980 --> 00:26:53,230
<font color="#E5E5E5">question what the process access turned</font>

503
00:26:48,590 --> 00:26:53,230
on<font color="#E5E5E5"> to see what's being injected into LSS</font>

504
00:26:53,470 --> 00:27:01,890
thank you okay thanks thanks<font color="#E5E5E5"> yep thank</font>

505
00:27:00,980 --> 00:27:07,409
you

506
00:27:01,890 --> 00:27:07,409
[Applause]

