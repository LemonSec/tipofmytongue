1
00:00:00,000 --> 00:00:05,600
I have I went through City College San
Francisco de mi associate degree

2
00:00:05,600 --> 00:00:10,559
whenever a couple years ago have also
given past talks it besides the last

3
00:00:10,559 --> 00:00:15,280
couple years in San Francisco b-side
delayed New York nasa ames couple other

4
00:00:15,280 --> 00:00:19,810
smaller conferences so we're basically
going to go over some of the more

5
00:00:19,810 --> 00:00:23,310
prominent variance to be seen in the
last couple of years of ransomware some

6
00:00:23,310 --> 00:00:27,909
of the victims of compromise from the
sea to set up in the design of the use

7
00:00:27,910 --> 00:00:32,520
and kind of like what we've done in the
past and a little bit of the current

8
00:00:32,520 --> 00:00:41,469
aspect for checking in knocking things
off line I have some questions about

9
00:00:41,469 --> 00:00:45,469
stuff that really current and I might or
might not be able to answer them due to

10
00:00:45,469 --> 00:00:50,340
write a job and what we do there so if I
can answer your question sorry

11
00:00:52,510 --> 00:00:57,140
step back and look at the old school
what used to see back in the day

12
00:00:57,140 --> 00:01:01,899
ransomware basically would come on
infected system give you this little pop

13
00:01:01,899 --> 00:01:09,240
and screen that says the FBI official
looking at addressing the web camera

14
00:01:09,240 --> 00:01:13,140
along with it the thing about this one
with it wasn't really random where it

15
00:01:13,140 --> 00:01:15,840
was basically is the lock screen there
come up on your system and it's really

16
00:01:15,840 --> 00:01:19,270
easy to take off by going to safe mode
in this removing a virus from their

17
00:01:19,270 --> 00:01:24,750
registry they're worth a couple people
who I guess turn themselves in the law

18
00:01:24,750 --> 00:01:30,140
enforcement at some point I'm saying it
was legit to me so you know gotta work

19
00:01:30,140 --> 00:01:36,520
for the better good I guess now we all
know probably crypto Walker pretty much

20
00:01:36,520 --> 00:01:42,158
the biggest guy that came out swinging
there in about 2015 it so it was like

21
00:01:42,159 --> 00:01:46,689
the first one that actually came through
and drifted you system using a 2048 bit

22
00:01:46,689 --> 00:01:53,270
RSA encryption key and it's also
essentially what every locker infection

23
00:01:53,270 --> 00:02:00,329
is now referred to even though nowhere
more so as I was saying we started

24
00:02:00,329 --> 00:02:04,589
seeing you know at the end of 2013 mania
delivered to the game of his youth

25
00:02:04,590 --> 00:02:10,550
botnet and used da Silva demand
generated algorithm which is basically

26
00:02:10,550 --> 00:02:12,880
like a bunch of letters and numbers math
together to

27
00:02:12,880 --> 00:02:18,840
a domain name not usually something that
you would type in by hand it would treat

28
00:02:18,840 --> 00:02:22,030
thousands of these domains that one can
actually only register one of them to

29
00:02:22,030 --> 00:02:23,840
actually be the seats here

30
00:02:23,840 --> 00:02:27,670
the point of it was essentially and this
is what kind of one of the domain looks

31
00:02:27,670 --> 00:02:33,149
like ways to you put a bunch of domains
out there to kind of hard to find the

32
00:02:33,150 --> 00:02:37,630
CPU and in the list of the mall and can
anyone actually spot the really bad part

33
00:02:37,630 --> 00:02:46,040
of this domain here where I didn't have
anything to do with the mediator anyway

34
00:02:46,040 --> 00:02:51,970
so in like mid 2014 said about June of
that year the game of his you thought it

35
00:02:51,970 --> 00:02:57,690
was taken down basically that took down
crypto walker with it and it also allows

36
00:02:57,690 --> 00:03:05,870
the encryption keys to be serviced by
the FBI had to get down to about anyone

37
00:03:05,870 --> 00:03:09,760
that was still encrypted with a walker
here essentially decrypt all of their

38
00:03:09,760 --> 00:03:15,890
file right around the exact same time
that it went down we started to see new

39
00:03:15,890 --> 00:03:26,019
variants emerging one of these will be
touring Locker Hurt Locker is mainly

40
00:03:26,020 --> 00:03:31,090
seen in like Australia New Zealand and
certain parts of Europe and with many

41
00:03:31,090 --> 00:03:38,240
sent through email this guy either red
light ticket or a tax notices look

42
00:03:38,240 --> 00:03:43,959
something along the lines of this one of
the things that they did know we've made

43
00:03:43,959 --> 00:03:47,510
it really easy you cannot get out of
line with these early common naming

44
00:03:47,510 --> 00:03:51,269
convention for all of this heat you
doing and he's awake that similar in the

45
00:03:51,270 --> 00:03:58,190
realm of like a NSW would you like the
New South Wales and then post ago and

46
00:03:58,190 --> 00:04:04,350
then or net info one of those DoD's so
you can see the example that data base

47
00:04:04,350 --> 00:04:11,560
hyping it w hype and go . organized post
dot com their remaining meant to look

48
00:04:11,560 --> 00:04:15,340
like official-looking doing or not but
it's really easy to mass bought these

49
00:04:15,340 --> 00:04:20,048
because we essentially knew what the
naming convention wife so it wasn't

50
00:04:20,048 --> 00:04:25,169
really a threat for the most part
through a lot of our client base

51
00:04:25,170 --> 00:04:33,950
for it started to see like operating
system so basically this started out

52
00:04:33,950 --> 00:04:40,940
attacking you video game extension so
gamers would get all their files but

53
00:04:40,940 --> 00:04:45,050
then they started to use or in the
beginning they were using another DJB

54
00:04:45,050 --> 00:04:48,830
domain for the seat two years this
century but something like this said the

55
00:04:48,830 --> 00:04:52,229
subdomain is a bunch of letters /
together the main bunch of letters and

56
00:04:52,230 --> 00:04:56,490
numbers match together once again any
type of lexical analysis on these

57
00:04:56,490 --> 00:04:57,530
domains

58
00:04:57,530 --> 00:05:01,080
you know and it doesn't seem stemming
and all that will easily detect any

59
00:05:01,080 --> 00:05:08,419
queries dreamin' any network so it kind
of error on their part the changes in

60
00:05:08,420 --> 00:05:13,360
later very James instead of the use more
of a compromise website approach to go

61
00:05:13,360 --> 00:05:13,950
about it

62
00:05:13,950 --> 00:05:20,479
to this kind of help blend and will have
it better than your network traffic and

63
00:05:20,480 --> 00:05:25,270
its enjoy this is your standard test
equip lock screen and the first version

64
00:05:25,270 --> 00:05:32,849
testing these asymmetric a jetski that
allowed Dallas you basically put out

65
00:05:32,850 --> 00:05:37,960
test i decrypt unfortunately when he put
something out like that the malware

66
00:05:37,960 --> 00:05:44,159
office just fix their flaws like
anything they get put out there so the

67
00:05:44,160 --> 00:05:47,470
next big one that we actually saw with
crypto all which is kind of more than

68
00:05:47,470 --> 00:06:03,070
their recent mid 2014 2015 and when it
was really big for whatever so basically

69
00:06:03,070 --> 00:06:07,630
crypto while they're in cities in DJ's
what they did was they compromised

70
00:06:07,630 --> 00:06:12,070
servers usually through WordPress most
likely to like the red slider plugin

71
00:06:12,070 --> 00:06:16,659
which allows you had a vulnerability
that allows you to extract out the

72
00:06:16,660 --> 00:06:23,570
database with all the logon idea and the
password and then they also started

73
00:06:23,570 --> 00:06:29,200
using tour and ITV which i think he
knows the internet the invisible

74
00:06:29,200 --> 00:06:32,050
something like that

75
00:06:32,050 --> 00:06:41,960
but it basically another anonymous you
know hide your relocation service so the

76
00:06:41,960 --> 00:06:49,870
exploitation of the whole group of a big
number of events that could happen but

77
00:06:49,870 --> 00:06:50,979
most likely it either

78
00:06:50,979 --> 00:06:55,710
fishing or compromise the main imelda
tightening would essentially happens is

79
00:06:55,710 --> 00:06:59,539
you have to use everything gets the fish
they land on a webpage has injected

80
00:06:59,539 --> 00:07:03,740
coating of pages some type of mouth
advertising the Cincinnati next break at

81
00:07:03,740 --> 00:07:09,509
then once they get exploitative
whichever way a call out to the right

82
00:07:09,509 --> 00:07:13,840
they can get their IP address return for
the location of the user and then that

83
00:07:13,840 --> 00:07:20,229
pretty pussy in a minute into a
encrypted hash and basically goes to

84
00:07:20,229 --> 00:07:25,750
these set of servers in this usually you
know five ten fifteen of the Chinese and

85
00:07:25,750 --> 00:07:30,550
he gets taken down and then behind those
services called today the tour and I TV

86
00:07:30,550 --> 00:07:40,449
networks this is kind of an exactly like
a real dog what it would look like a B C

87
00:07:40,449 --> 00:07:45,449
and hear you scream from infection so
essentially this is here

88
00:07:45,449 --> 00:07:51,729
exploit kept firing up which is angered
by the sub-domain and then you have it

89
00:07:51,729 --> 00:07:57,250
all here their IP address IP I can
address yes or whatever and then all of

90
00:07:57,250 --> 00:08:03,360
these are all of the compromise domains
that actually host the binary so we're

91
00:08:03,360 --> 00:08:07,840
the cool things actually with this
little part right here and every single

92
00:08:07,840 --> 00:08:14,388
crypto all sample there's always a call
to address this domain or my external IP

93
00:08:14,389 --> 00:08:22,719
dot com or chrome IIP and they do this
essentially for geolocation and a couple

94
00:08:22,719 --> 00:08:27,960
reasons that they do it one is depending
on where you at so pretty much anywhere

95
00:08:27,960 --> 00:08:33,519
in eastern europe or some part of Iran's
I believe the encryption won't happen

96
00:08:33,519 --> 00:08:36,690
because they basically don't want to
infect themselves to the family or

97
00:08:36,690 --> 00:08:42,940
whatever reason and it also west to
display their anti-war message in the

98
00:08:42,940 --> 00:08:45,080
native language of radioactive

99
00:08:45,080 --> 00:08:49,400
orkut and English if you're in Spain and
Spanish it you know you get the point

100
00:08:49,400 --> 00:08:56,380
the other part of it is that it creates
a unique identifier for the other system

101
00:08:56,380 --> 00:09:01,780
imposed basically look something like
this in a in a POST request to face

102
00:09:01,780 --> 00:09:04,780
Italy questionid the campaign number

103
00:09:05,440 --> 00:09:12,350
indy five of the system altogether and
then and then the IP address attached to

104
00:09:12,350 --> 00:09:16,290
it and this is all set to the head of
CTU

105
00:09:16,910 --> 00:09:23,319
basically fingerprint the system is also
so they can only make it seem like one

106
00:09:23,320 --> 00:09:26,860
IP address get infected at times it
makes it hard to the research going on

107
00:09:26,860 --> 00:09:35,770
so as I was saying that there's three
primary demands that we use IP address

108
00:09:35,770 --> 00:09:41,800
the current my IP and my external IP dot
com IP address is actually the main when

109
00:09:41,800 --> 00:09:45,370
it was always used in the other two were
used as backups in case the summaries an

110
00:09:45,370 --> 00:09:51,700
IP address can be reached so is actually
really cool because why they were being

111
00:09:51,700 --> 00:09:55,880
really nice he gave us a really cool
indicated the kind of go by basically

112
00:09:55,880 --> 00:10:01,650
could go to someplace like match.com
rate and do a search for the domain IP

113
00:10:01,650 --> 00:10:08,959
address but essentially what ever do is
get a return that you see in a minute

114
00:10:08,960 --> 00:10:14,750
but there's no real use of a PPI with my
worries it gets a little rough to do

115
00:10:14,750 --> 00:10:19,290
this manually all the time which will go
into here in a minute but essentially

116
00:10:19,290 --> 00:10:23,959
what you end up with is a list like this
and this is all the files that like

117
00:10:23,960 --> 00:10:29,410
Mauer dot com has that have IP address
and the network information right so we

118
00:10:29,410 --> 00:10:33,850
take a look now there's a term for the
domain and an employee see the anti

119
00:10:33,850 --> 00:10:38,950
virus core is easy if you look at it
clearly that but even like some of the

120
00:10:38,950 --> 00:10:47,050
antivirus engines what detecting these
attachments or whatever is malicious but

121
00:10:47,050 --> 00:10:50,109
if we go and take a look at this guy

122
00:10:50,110 --> 00:10:56,149
with C you know I P address and then
it's pretty clear that making these

123
00:10:56,149 --> 00:11:02,010
calls my check this site that I had
earlier all the domains where the

124
00:11:02,010 --> 00:11:10,589
military's financed or so another
another thing I'm pretty sure that most

125
00:11:10,589 --> 00:11:16,730
EU total so essentially what we were
doing in the beginning with that going

126
00:11:16,730 --> 00:11:20,360
to malware dot com in like taping an IP
address in like finding all the domains

127
00:11:20,360 --> 00:11:25,360
that are bad but it's very tedious and I
basically didn't sleep for a couple

128
00:11:25,360 --> 00:11:31,540
months total in another part of the
highest total called by the store

129
00:11:31,540 --> 00:11:34,540
intelligence to the back end of it

130
00:11:35,339 --> 00:11:39,649
the VTI allows you to do some really
cool stuff like this so you can create a

131
00:11:39,649 --> 00:11:44,250
set of your or anything you want and
basically any sample that virus still

132
00:11:44,250 --> 00:11:49,430
has either retroactive with your new you
can go back and fine so I create a set

133
00:11:49,430 --> 00:11:53,899
of rules that basically look for any
sample that made a call to any of the

134
00:11:53,899 --> 00:12:00,110
night main right addresses and UCI p.m.
diode at the bottom there and that was

135
00:12:00,110 --> 00:12:04,720
mainly what I was using at the time now
I know why they changed from a different

136
00:12:04,720 --> 00:12:10,370
actor group or whatever medical thing is
you can set up by running JSON RSS feed

137
00:12:10,370 --> 00:12:14,440
about it you can get notifications are
all these come in right away but then

138
00:12:14,440 --> 00:12:18,740
again you also have to tape of IRA Stoll
intelligence and it's not inexpensive

139
00:12:18,740 --> 00:12:27,570
but not always a cost-effective means
for smaller companies take a look we're

140
00:12:27,570 --> 00:12:32,399
going to see you like so these are some
of the rules I got hit on my role said

141
00:12:32,399 --> 00:12:37,949
generic name but you can tell by the
poor as I PMPO right so I knew there was

142
00:12:37,949 --> 00:12:43,109
a potential crib and crypto all because
it had on you know the crypto IP address

143
00:12:43,110 --> 00:12:47,550
and then go to various roles they can
basically identify all these

144
00:12:47,550 --> 00:12:56,109
exponentially fast so we look at this
guy basically in the file information

145
00:12:56,110 --> 00:13:01,399
once again you know we can see like the
full URL path while the binary this

146
00:13:01,399 --> 00:13:02,180
story

147
00:13:02,180 --> 00:13:09,120
they make it seem kind of nonchalant but
as you can see his mother called our IP

148
00:13:09,120 --> 00:13:18,360
addresses turn into a binary think you
doing all this work but it it still kind

149
00:13:18,360 --> 00:13:23,310
of like a really slow and tedious
process and very manual so it wasn't

150
00:13:23,310 --> 00:13:31,839
really efficient for real-time so then
see what we do in in the DNS world we

151
00:13:31,839 --> 00:13:39,339
can kind of care domains together using
a couple of set to one is our current in

152
00:13:39,339 --> 00:13:43,750
the other related domain to occur
occurrence basically happens when

153
00:13:43,750 --> 00:13:47,700
someone crazy domain I think of it like
if you land on my Google and all of the

154
00:13:47,700 --> 00:13:51,709
requests that happen in the background
is basically a coworker and anything

155
00:13:51,709 --> 00:13:55,369
that like basically you know when demand
is another domain like this happened

156
00:13:55,370 --> 00:13:59,920
right off the bat related domain is one
way they're create an almost the same

157
00:13:59,920 --> 00:14:06,209
time frame but it's a little bit more
spread out but we're talking

158
00:14:06,209 --> 00:14:07,390
milliseconds

159
00:14:07,390 --> 00:14:15,029
so this is kind of like a look like one
of our internal tools that we have the

160
00:14:15,029 --> 00:14:20,290
actor ipaddress.com domain so the top of
it is basically like DNS queries per

161
00:14:20,290 --> 00:14:24,719
hour over the course of whatever time
frame that is a couple weeks or

162
00:14:24,720 --> 00:14:29,980
something but it could see this all
these related domains down here

163
00:14:31,490 --> 00:14:38,180
legitimate website to actually use these
r IP addresses for all sorts of things

164
00:14:38,180 --> 00:14:43,640
like update by news server whatever so
one of the problems that we had to get

165
00:14:43,640 --> 00:14:49,579
through with basically creating a script
and then changing it to not block any

166
00:14:49,579 --> 00:14:55,810
legitimate domain so we kinda had to sit
there and show you that you know we came

167
00:14:55,810 --> 00:15:00,890
up with them and we had to be trained
this is that we get auto block all these

168
00:15:00,890 --> 00:15:05,579
domain he would basically being seen
that work worried right around the same

169
00:15:05,579 --> 00:15:10,219
time as IP address is eventually went to
build up the training said anything that

170
00:15:10,220 --> 00:15:14,080
was called out of that domain afterward
but essentially crippled

171
00:15:14,080 --> 00:15:21,270
RFP rate was 8.05 percent so since you
use it as a pivot point to find all the

172
00:15:21,270 --> 00:15:25,730
other domains and the great thing is
that this particular one is actually the

173
00:15:25,730 --> 00:15:30,650
least noisiest of all the IP address
domain that there are like the other two

174
00:15:30,650 --> 00:15:35,020
that I was mentioning earlier super
crazy loud I mean I quit talking like

175
00:15:35,020 --> 00:15:40,230
you know million to create an hour by
extremely legitimate domain video

176
00:15:40,230 --> 00:15:44,510
Weather Channel whatever show me to
really easy to build up our training

177
00:15:44,510 --> 00:15:48,360
said about what was it was it because
most of the legitimate companies don't

178
00:15:48,360 --> 00:15:58,620
use it to take you one thing they can't
make it any easier to get that kind of a

179
00:15:58,620 --> 00:16:03,210
blown-up version of the bottom section
of that last night and you can see

180
00:16:03,210 --> 00:16:05,660
there's like the first two related
domains

181
00:16:05,660 --> 00:16:10,980
the other two ride he addresses that I
was talking about and then we have the

182
00:16:10,980 --> 00:16:20,010
Microsoft Microsoft try Google stuff so
we basically had to build up my god no

183
00:16:20,010 --> 00:16:23,800
whitelist to make sure that these things
like then inadvertently end up in our

184
00:16:23,800 --> 00:16:26,120
dbl

185
00:16:26,120 --> 00:16:29,580
a great thing was with it I guess we
essentially built all this man

186
00:16:29,580 --> 00:16:35,860
identified all of the all the good
domain we ended up with essentially all

187
00:16:35,860 --> 00:16:45,010
of these domain actually basically a bit
identify these within you know second

188
00:16:45,010 --> 00:16:51,790
actually being seen to essentially what
we did was we had a script ran against

189
00:16:51,790 --> 00:16:56,250
the IP address and we will likely be
seen this before have we not seen it if

190
00:16:56,250 --> 00:17:00,060
we hadn't seen it before then we would
get a notification to the analyst team

191
00:17:00,060 --> 00:17:04,970
that there was new to maintain and then
we would go and validate by looking at

192
00:17:04,970 --> 00:17:11,520
the traffic that see the Jetta trying to
find the actual binary on the system and

193
00:17:11,520 --> 00:17:14,800
then it was bad we would block it
basically the training seconds updated

194
00:17:14,800 --> 00:17:18,560
and the more that we did this letter
there was human involvement going on and

195
00:17:18,560 --> 00:17:21,059
eventually became a completely automated
system

196
00:17:21,059 --> 00:17:25,259
where you know over the course of every
day a week or whatever we would

197
00:17:25,259 --> 00:17:32,059
automatically within seconds and Adam in
GBO but the real thing is like removing

198
00:17:32,059 --> 00:17:38,639
the false positives out of it and that
was actually the the time consuming part

199
00:17:38,639 --> 00:17:47,490
it's probably about a month of manual
processing you change it around town so

200
00:17:47,490 --> 00:17:52,860
this is basically what a the traffic
patterns look like to compromise domain

201
00:17:52,860 --> 00:18:01,289
so needs braces aren't really that busy
up until this point and this point there

202
00:18:01,289 --> 00:18:05,889
they start to get more traffic and then
that's where the calls are going to

203
00:18:05,889 --> 00:18:10,748
redirect them fected systems and you can
see like moving you know this way like

204
00:18:10,749 --> 00:18:16,509
it definitely increases and you can also
see that the traffic is almost identical

205
00:18:16,509 --> 00:18:24,389
running from vote and that's because you
know they're from the same sample set so

206
00:18:24,389 --> 00:18:26,629
pretty much mainly

