1
00:00:00,030 --> 00:00:04,830
really<font color="#CCCCCC"> and it's really</font><font color="#E5E5E5"> inspiring</font>

2
00:00:01,829 --> 00:00:06,989
<font color="#E5E5E5">especially</font><font color="#CCCCCC"> the part about the why right</font>

3
00:00:04,830 --> 00:00:10,530
<font color="#CCCCCC">you know kind</font><font color="#E5E5E5"> of doing some inward</font>

4
00:00:06,990 --> 00:00:12,660
reflection<font color="#E5E5E5"> to the talk on you know my</font>

5
00:00:10,530 --> 00:00:15,149
own why and things like that<font color="#CCCCCC"> right so I</font>

6
00:00:12,660 --> 00:00:17,130
thought<font color="#E5E5E5"> that was</font><font color="#CCCCCC"> pretty awesome</font><font color="#E5E5E5"> so lucky</font>

7
00:00:15,150 --> 00:00:19,920
to<font color="#E5E5E5"> have them come out is the mic working</font>

8
00:00:17,130 --> 00:00:21,299
<font color="#E5E5E5">okay everyone can hear me okay</font><font color="#CCCCCC"> okay</font><font color="#E5E5E5"> cool</font>

9
00:00:19,920 --> 00:00:22,650
<font color="#E5E5E5">sounds good</font>

10
00:00:21,300 --> 00:00:24,600
we're gonna give it<font color="#CCCCCC"> just like one more</font>

11
00:00:22,650 --> 00:00:26,459
minute<font color="#E5E5E5"> for</font><font color="#CCCCCC"> people to kind of come in if</font>

12
00:00:24,600 --> 00:00:34,079
they<font color="#E5E5E5"> want</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> and but thanks thanks for</font>

13
00:00:26,460 --> 00:00:35,969
<font color="#E5E5E5">coming</font><font color="#CCCCCC"> out and yeah so yeah</font><font color="#E5E5E5"> all those</font>

14
00:00:34,079 --> 00:00:39,829
inspirational quotes<font color="#CCCCCC"> make me feel like</font>

15
00:00:35,969 --> 00:00:39,829
I'm not<font color="#E5E5E5"> doing enough with my life</font>

16
00:00:40,850 --> 00:00:50,570
we're ready<font color="#E5E5E5"> to quit your job</font><font color="#CCCCCC"> I don't</font>

17
00:00:47,280 --> 00:00:50,570
know if how's the morale the story but

18
00:01:48,130 --> 00:01:54,530
okay so it's 10:30 on my clock so I'm

19
00:01:51,590 --> 00:01:56,510
gonna get<font color="#E5E5E5"> rolling</font><font color="#CCCCCC"> you guys are in the</font>

20
00:01:54,530 --> 00:01:58,520
talk<font color="#E5E5E5"> blue</font><font color="#CCCCCC"> clouded</font><font color="#E5E5E5"> death</font><font color="#CCCCCC"> we're</font><font color="#E5E5E5"> just</font>

21
00:01:56,510 --> 00:02:03,979
talking<font color="#CCCCCC"> about red teaming</font><font color="#E5E5E5"> Azure</font>

22
00:01:58,520 --> 00:02:06,050
environments<font color="#E5E5E5"> so everyone can hear</font><font color="#CCCCCC"> me</font>

23
00:02:03,979 --> 00:02:06,590
okay I presume and<font color="#E5E5E5"> so I'm gonna keep</font>

24
00:02:06,050 --> 00:02:10,130
<font color="#CCCCCC">moving</font>

25
00:02:06,590 --> 00:02:11,870
so just<font color="#E5E5E5"> pretend yeah it's good enough</font>

26
00:02:10,130 --> 00:02:14,180
good enough<font color="#CCCCCC"> all</font><font color="#E5E5E5"> right</font>

27
00:02:11,870 --> 00:02:16,010
project gotcha okay yeah<font color="#E5E5E5"> that's not a</font>

28
00:02:14,180 --> 00:02:21,170
<font color="#E5E5E5">problem for me</font><font color="#CCCCCC"> I've been told I'm too</font>

29
00:02:16,010 --> 00:02:23,359
out<font color="#E5E5E5"> so</font><font color="#CCCCCC"> this whole about</font><font color="#E5E5E5"> myself not</font>

30
00:02:21,170 --> 00:02:26,208
really<font color="#E5E5E5"> you know huge people person so I</font>

31
00:02:23,360 --> 00:02:27,950
I used to work at<font color="#E5E5E5"> homeland I worked in</font>

32
00:02:26,209 --> 00:02:31,730
their security<font color="#CCCCCC"> operations</font><font color="#E5E5E5"> center and</font>

33
00:02:27,950 --> 00:02:33,170
I've<font color="#CCCCCC"> let a bunch</font><font color="#E5E5E5"> of their defensive</font>

34
00:02:31,730 --> 00:02:34,640
hunting down a PT's in the network

35
00:02:33,170 --> 00:02:37,220
trying to get them out<font color="#E5E5E5"> for quite</font><font color="#CCCCCC"> a few</font>

36
00:02:34,640 --> 00:02:38,988
years and then I worked at NSA and I was

37
00:02:37,220 --> 00:02:41,030
doing mostly offensive work which is

38
00:02:38,989 --> 00:02:44,120
<font color="#E5E5E5">really more of my passion</font><font color="#CCCCCC"> kind</font><font color="#E5E5E5"> of been</font>

39
00:02:41,030 --> 00:02:45,680
<font color="#E5E5E5">you know involved</font><font color="#CCCCCC"> in hacking and</font><font color="#E5E5E5"> the</font>

40
00:02:44,120 --> 00:02:51,140
<font color="#E5E5E5">hacking scene since I was</font><font color="#CCCCCC"> really young</font>

41
00:02:45,680 --> 00:02:54,350
<font color="#CCCCCC">so</font><font color="#E5E5E5"> yeah so and then I I worked at Adobe</font>

42
00:02:51,140 --> 00:02:55,700
inside<font color="#E5E5E5"> their</font><font color="#CCCCCC"> experienced cloud</font><font color="#E5E5E5"> business</font>

43
00:02:54,350 --> 00:02:57,530
unit<font color="#E5E5E5"> and I built out a red team</font>

44
00:02:55,700 --> 00:03:02,600
capability there so I worked<font color="#E5E5E5"> there quite</font>

45
00:02:57,530 --> 00:03:04,820
a<font color="#CCCCCC"> few years so</font><font color="#E5E5E5"> I'm Bryce and</font><font color="#CCCCCC"> tweak</font><font color="#E5E5E5"> Fox</font>

46
00:03:02,600 --> 00:03:06,650
is<font color="#CCCCCC"> who I am on Twitter</font><font color="#E5E5E5"> after</font><font color="#CCCCCC"> this talk</font>

47
00:03:04,820 --> 00:03:10,220
I'm<font color="#CCCCCC"> gonna take all the slides but</font><font color="#E5E5E5"> could</font>

48
00:03:06,650 --> 00:03:11,840
push them up to<font color="#E5E5E5"> SlideShare or whatever</font>

49
00:03:10,220 --> 00:03:14,150
I'm<font color="#CCCCCC"> using now and</font><font color="#E5E5E5"> tweet out the link so</font>

50
00:03:11,840 --> 00:03:20,570
if you<font color="#E5E5E5"> guys want the slides you</font><font color="#CCCCCC"> know</font>

51
00:03:14,150 --> 00:03:23,450
<font color="#E5E5E5">happy to share those so so now I am</font>

52
00:03:20,570 --> 00:03:26,600
actually<font color="#CCCCCC"> the president of stage</font><font color="#E5E5E5"> 2</font>

53
00:03:23,450 --> 00:03:28,640
<font color="#E5E5E5">security so we</font><font color="#CCCCCC"> do a lot of red teaming</font>

54
00:03:26,600 --> 00:03:30,320
against AWS environments and<font color="#E5E5E5"> also some</font>

55
00:03:28,640 --> 00:03:32,000
Azure environments and then we also have

56
00:03:30,320 --> 00:03:35,829
some security<font color="#E5E5E5"> engineers that help with</font>

57
00:03:32,000 --> 00:03:39,650
securing those environments<font color="#E5E5E5"> so and then</font>

58
00:03:35,829 --> 00:03:44,980
also I lead b-side Salt Lake City<font color="#CCCCCC"> so I'm</font>

59
00:03:39,650 --> 00:03:48,920
the lead organizer for that<font color="#E5E5E5"> so yeah so</font>

60
00:03:44,980 --> 00:03:54,839
yeah<font color="#CCCCCC"> things are good I</font><font color="#E5E5E5"> have a training</font>

61
00:03:48,920 --> 00:03:57,149
at blackhat it is sold out<font color="#E5E5E5"> so sorry and</font>

62
00:03:54,840 --> 00:04:01,830
and<font color="#E5E5E5"> if</font><font color="#CCCCCC"> will</font><font color="#E5E5E5"> probably be at</font><font color="#CCCCCC"> your up to if</font>

63
00:03:57,150 --> 00:04:03,900
you<font color="#E5E5E5"> really want to go to it so</font><font color="#CCCCCC"> all right</font>

64
00:04:01,830 --> 00:04:06,870
<font color="#E5E5E5">so we're just gonna talk</font><font color="#CCCCCC"> I try</font><font color="#E5E5E5"> to keep</font>

65
00:04:03,900 --> 00:04:09,780
this pretty<font color="#CCCCCC"> high-level so and try</font><font color="#E5E5E5"> to</font>

66
00:04:06,870 --> 00:04:11,880
keep<font color="#E5E5E5"> it pretty accessible</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> you know</font>

67
00:04:09,780 --> 00:04:13,620
the cloud your boss talks about the

68
00:04:11,880 --> 00:04:15,420
cloud this<font color="#CCCCCC"> is</font><font color="#E5E5E5"> what he envisions</font><font color="#CCCCCC"> you know</font>

69
00:04:13,620 --> 00:04:16,918
it's just this one thing<font color="#E5E5E5"> but the reality</font>

70
00:04:15,420 --> 00:04:18,418
<font color="#CCCCCC">when you</font><font color="#E5E5E5"> go to implement</font><font color="#CCCCCC"> you kind</font><font color="#E5E5E5"> of</font>

71
00:04:16,918 --> 00:04:20,639
realize it's a<font color="#E5E5E5"> little bit more complex</font>

72
00:04:18,418 --> 00:04:22,889
than<font color="#CCCCCC"> that right so so the way that I</font>

73
00:04:20,639 --> 00:04:24,690
generally<font color="#E5E5E5"> break up cloud is into three</font>

74
00:04:22,889 --> 00:04:26,880
segments regardless<font color="#CCCCCC"> the provider</font><font color="#E5E5E5"> you</font>

75
00:04:24,690 --> 00:04:28,440
have<font color="#E5E5E5"> kind of the portal portion and</font>

76
00:04:26,880 --> 00:04:31,800
<font color="#E5E5E5">that's what you is kind of the customer</font>

77
00:04:28,440 --> 00:04:33,510
of the cloud<font color="#E5E5E5"> sees and interact</font><font color="#CCCCCC"> with and</font>

78
00:04:31,800 --> 00:04:35,340
then you have this kind<font color="#CCCCCC"> of</font><font color="#E5E5E5"> control plane</font>

79
00:04:33,510 --> 00:04:37,770
which is a lot<font color="#E5E5E5"> of the api's and some of</font>

80
00:04:35,340 --> 00:04:39,869
those<font color="#E5E5E5"> are exposed to you as a user of</font>

81
00:04:37,770 --> 00:04:42,150
the<font color="#CCCCCC"> cloud and some are kind of just</font>

82
00:04:39,870 --> 00:04:43,650
internal use only<font color="#CCCCCC"> and then the data is</font>

83
00:04:42,150 --> 00:04:46,500
<font color="#E5E5E5">kind of where all your data or VMs</font>

84
00:04:43,650 --> 00:04:48,510
reside right<font color="#CCCCCC"> so if you look at it</font><font color="#E5E5E5"> from</font>

85
00:04:46,500 --> 00:04:50,729
this<font color="#E5E5E5"> perspective the admin of a cloud</font>

86
00:04:48,510 --> 00:04:53,219
portal logs<font color="#E5E5E5"> into the web UI he takes</font>

87
00:04:50,729 --> 00:04:56,039
some<font color="#CCCCCC"> action</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> reaches out to</font><font color="#E5E5E5"> API is</font>

88
00:04:53,220 --> 00:04:58,590
in<font color="#CCCCCC"> the control plane which then spin up</font>

89
00:04:56,040 --> 00:05:01,020
or deploy services in the data<font color="#E5E5E5"> plane</font>

90
00:04:58,590 --> 00:05:02,820
<font color="#E5E5E5">right and then in the data plane you</font>

91
00:05:01,020 --> 00:05:05,370
know<font color="#E5E5E5"> common services would be</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> load</font>

92
00:05:02,820 --> 00:05:08,099
balancer<font color="#CCCCCC"> maybe some type of like lambda</font>

93
00:05:05,370 --> 00:05:09,720
AWS function or<font color="#CCCCCC"> as</font><font color="#E5E5E5"> your function for an</font>

94
00:05:08,100 --> 00:05:12,600
app or<font color="#E5E5E5"> maybe you're just</font><font color="#CCCCCC"> using</font><font color="#E5E5E5"> it to</font>

95
00:05:09,720 --> 00:05:14,729
<font color="#E5E5E5">deploy VMs like you would I</font><font color="#CCCCCC"> SAS</font><font color="#E5E5E5"> write</font>

96
00:05:12,600 --> 00:05:15,840
infrastructure the service and<font color="#E5E5E5"> then</font>

97
00:05:14,729 --> 00:05:18,740
there's often<font color="#E5E5E5"> kind of a storage</font>

98
00:05:15,840 --> 00:05:23,099
<font color="#E5E5E5">component there like a s3 bucket or a</font>

99
00:05:18,740 --> 00:05:26,100
blob storage for a sure yeah so just<font color="#E5E5E5"> FYI</font>

100
00:05:23,100 --> 00:05:28,350
<font color="#CCCCCC">I've kind of given a similar talk which</font>

101
00:05:26,100 --> 00:05:30,479
<font color="#CCCCCC">is all as AWS focused a couple years ago</font>

102
00:05:28,350 --> 00:05:36,780
and that's on youtube if you<font color="#CCCCCC"> want to</font>

103
00:05:30,479 --> 00:05:38,550
watch it so as besides 2017<font color="#E5E5E5"> so there's</font>

104
00:05:36,780 --> 00:05:40,530
just<font color="#E5E5E5"> an</font><font color="#CCCCCC"> overwhelming amount</font><font color="#E5E5E5"> of cloud</font>

105
00:05:38,550 --> 00:05:43,590
<font color="#E5E5E5">services though so we are not gonna dive</font>

106
00:05:40,530 --> 00:05:45,960
into every detail here so depending<font color="#CCCCCC"> on</font>

107
00:05:43,590 --> 00:05:48,450
the customer and<font color="#CCCCCC"> which</font><font color="#E5E5E5"> services they're</font>

108
00:05:45,960 --> 00:05:50,729
using inside of<font color="#CCCCCC"> asher's cloud</font><font color="#E5E5E5"> there's a</font>

109
00:05:48,450 --> 00:05:52,440
lot<font color="#E5E5E5"> of possibilities</font><font color="#CCCCCC"> here and each</font><font color="#E5E5E5"> one</font>

110
00:05:50,729 --> 00:05:56,130
<font color="#CCCCCC">of these kind of has their own security</font>

111
00:05:52,440 --> 00:05:57,810
implement<font color="#CCCCCC"> the concerns</font><font color="#E5E5E5"> right so I'm just</font>

112
00:05:56,130 --> 00:06:01,130
<font color="#E5E5E5">going to talk</font><font color="#CCCCCC"> about the ones that I see</font>

113
00:05:57,810 --> 00:06:01,130
<font color="#E5E5E5">most commonly used right</font>

114
00:06:01,930 --> 00:06:08,780
and a lot of times inside the<font color="#CCCCCC"> eye sauce</font>

115
00:06:06,590 --> 00:06:11,030
like the<font color="#E5E5E5"> VM still have an agent which</font>

116
00:06:08,780 --> 00:06:14,150
kind<font color="#CCCCCC"> of reaches back to</font><font color="#E5E5E5"> the control</font>

117
00:06:11,030 --> 00:06:15,710
plane and toxify those<font color="#E5E5E5"> api's right so I</font>

118
00:06:14,150 --> 00:06:17,210
<font color="#E5E5E5">don't know if you guys</font><font color="#CCCCCC"> are maybe</font><font color="#E5E5E5"> will</font>

119
00:06:15,710 --> 00:06:17,690
talk more about that<font color="#E5E5E5"> as we</font><font color="#CCCCCC"> go into this</font>

120
00:06:17,210 --> 00:06:21,590
talk

121
00:06:17,690 --> 00:06:23,560
<font color="#E5E5E5">so</font><font color="#CCCCCC"> Russell oftentimes have this</font>

122
00:06:21,590 --> 00:06:25,820
development<font color="#E5E5E5"> pipeline that's built out</font>

123
00:06:23,560 --> 00:06:27,350
<font color="#CCCCCC">continuous</font><font color="#E5E5E5"> integration pipeline and</font>

124
00:06:25,820 --> 00:06:29,659
developers are<font color="#CCCCCC"> using this to push their</font>

125
00:06:27,350 --> 00:06:31,310
code<font color="#CCCCCC"> and updates</font><font color="#E5E5E5"> to the cloud services</font><font color="#CCCCCC"> I</font>

126
00:06:29,660 --> 00:06:33,980
don't know if you guys<font color="#E5E5E5"> are</font><font color="#CCCCCC"> probably</font>

127
00:06:31,310 --> 00:06:36,530
aware<font color="#E5E5E5"> of</font><font color="#CCCCCC"> like Jenkins and other CI type</font>

128
00:06:33,980 --> 00:06:38,090
tools<font color="#E5E5E5"> deployment type tools</font><font color="#CCCCCC"> all right</font>

129
00:06:36,530 --> 00:06:40,340
those kind<font color="#E5E5E5"> of build your pipeline and</font>

130
00:06:38,090 --> 00:06:46,190
those usually<font color="#CCCCCC"> customize for each</font>

131
00:06:40,340 --> 00:06:47,510
<font color="#E5E5E5">organization and then lastly but you</font>

132
00:06:46,190 --> 00:06:48,920
know not<font color="#E5E5E5"> really lastly when you're</font>

133
00:06:47,510 --> 00:06:50,420
running<font color="#E5E5E5"> a</font><font color="#CCCCCC"> company you</font><font color="#E5E5E5"> have the users</font>

134
00:06:48,920 --> 00:06:51,800
right which are accessing<font color="#E5E5E5"> these services</font>

135
00:06:50,420 --> 00:06:56,440
<font color="#E5E5E5">generally from</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> internet</font>

136
00:06:51,800 --> 00:07:00,560
<font color="#E5E5E5">right all right so that's kind of</font><font color="#CCCCCC"> my</font>

137
00:06:56,440 --> 00:07:02,150
cloud 101 over<font color="#E5E5E5"> you high level the</font><font color="#CCCCCC"> Kem</font>

138
00:07:00,560 --> 00:07:03,860
now will die for<font color="#CCCCCC"> more than components</font>

139
00:07:02,150 --> 00:07:07,580
<font color="#E5E5E5">but just so you guys get kind of get</font>

140
00:07:03,860 --> 00:07:09,290
some more<font color="#CCCCCC"> perspective on</font><font color="#E5E5E5"> the importance</font>

141
00:07:07,580 --> 00:07:10,520
of securing this stuff which I mean

142
00:07:09,290 --> 00:07:12,320
throughout<font color="#E5E5E5"> a</font><font color="#CCCCCC"> cybersecurity</font><font color="#E5E5E5"> conference</font>

143
00:07:10,520 --> 00:07:16,609
you probably are aware<font color="#E5E5E5"> of this stuff but</font>

144
00:07:12,320 --> 00:07:18,590
this<font color="#E5E5E5"> is pretty pretty funny things on</font>

145
00:07:16,610 --> 00:07:20,960
the<font color="#CCCCCC"> internet if</font><font color="#E5E5E5"> you search right so like</font>

146
00:07:18,590 --> 00:07:23,750
you<font color="#CCCCCC"> know if you don't probably</font><font color="#E5E5E5"> manage</font>

147
00:07:20,960 --> 00:07:25,549
<font color="#E5E5E5">access to these</font><font color="#CCCCCC"> accounts people</font><font color="#E5E5E5"> can use</font>

148
00:07:23,750 --> 00:07:26,600
<font color="#E5E5E5">your services</font><font color="#CCCCCC"> and rack you up huge bills</font>

149
00:07:25,550 --> 00:07:29,630
<font color="#CCCCCC">right</font>

150
00:07:26,600 --> 00:07:30,950
I mean<font color="#E5E5E5"> maybe they'll knock it off</font>

151
00:07:29,630 --> 00:07:33,469
<font color="#E5E5E5">because your account got hacked but</font>

152
00:07:30,950 --> 00:07:37,400
maybe you'll be responsible<font color="#E5E5E5"> for it</font><font color="#CCCCCC"> so I</font>

153
00:07:33,470 --> 00:07:41,500
have seen<font color="#CCCCCC"> yeah I've personally seen</font><font color="#E5E5E5"> half</font>

154
00:07:37,400 --> 00:07:45,440
a million dollars<font color="#CCCCCC"> in bills racked up so</font>

155
00:07:41,500 --> 00:07:46,730
the and then even<font color="#E5E5E5"> worse is entire</font>

156
00:07:45,440 --> 00:07:49,610
startups have been put<font color="#E5E5E5"> out of</font><font color="#CCCCCC"> business</font>

157
00:07:46,730 --> 00:07:53,270
<font color="#E5E5E5">right</font><font color="#CCCCCC"> so there was a group and they got</font>

158
00:07:49,610 --> 00:07:54,919
<font color="#E5E5E5">access to companies route AWS keys which</font>

159
00:07:53,270 --> 00:07:56,840
generally you're not supposed to use

160
00:07:54,919 --> 00:08:00,740
because it's<font color="#CCCCCC"> really hard to rotate or do</font>

161
00:07:56,840 --> 00:08:02,929
anything<font color="#CCCCCC"> and</font><font color="#E5E5E5"> do they this basically sent</font>

162
00:08:00,740 --> 00:08:04,760
<font color="#E5E5E5">ransom like said pay us money or we're</font>

163
00:08:02,930 --> 00:08:06,169
<font color="#E5E5E5">going to destroy your infrastructure and</font>

164
00:08:04,760 --> 00:08:08,510
they kind<font color="#CCCCCC"> of thought they were joking</font>

165
00:08:06,169 --> 00:08:10,130
<font color="#CCCCCC">and no they</font><font color="#E5E5E5"> went in and all their</font>

166
00:08:08,510 --> 00:08:11,419
backups were also an ad about<font color="#CCCCCC"> so they</font>

167
00:08:10,130 --> 00:08:12,500
deleted<font color="#E5E5E5"> all their backups and they</font>

168
00:08:11,419 --> 00:08:14,090
<font color="#E5E5E5">deleted all their via</font>

169
00:08:12,500 --> 00:08:17,450
and destroyed the<font color="#CCCCCC"> entire company</font><font color="#E5E5E5"> that</font>

170
00:08:14,090 --> 00:08:20,179
went<font color="#CCCCCC"> out of</font><font color="#E5E5E5"> business overnight so so I</font>

171
00:08:17,450 --> 00:08:21,289
<font color="#E5E5E5">mean there's real-world impacts for some</font>

172
00:08:20,180 --> 00:08:24,680
of the silly<font color="#E5E5E5"> stuff that you'll see in</font>

173
00:08:21,290 --> 00:08:28,010
this<font color="#E5E5E5"> presentation today all right cool</font>

174
00:08:24,680 --> 00:08:30,980
<font color="#E5E5E5">so just starting out really</font><font color="#CCCCCC"> high-level</font>

175
00:08:28,010 --> 00:08:33,319
<font color="#CCCCCC">right</font><font color="#E5E5E5"> so you have developers and admins</font>

176
00:08:30,980 --> 00:08:35,000
and they're using<font color="#E5E5E5"> services</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> and on the</font>

177
00:08:33,320 --> 00:08:36,890
internet we have you know we live in<font color="#CCCCCC"> a</font>

178
00:08:35,000 --> 00:08:38,270
very SAS cloud-based environment and

179
00:08:36,890 --> 00:08:41,030
people they need to get their jobs done

180
00:08:38,270 --> 00:08:43,218
right but<font color="#CCCCCC"> unfortunately some users</font>

181
00:08:41,030 --> 00:08:46,459
occasionally make mistakes<font color="#CCCCCC"> right so</font>

182
00:08:43,219 --> 00:08:49,580
though like you know<font color="#E5E5E5"> post code to github</font>

183
00:08:46,460 --> 00:08:52,130
<font color="#E5E5E5">right and the code will contain keys or</font>

184
00:08:49,580 --> 00:08:53,980
secrets or certificates which can be

185
00:08:52,130 --> 00:08:56,990
used to<font color="#E5E5E5"> interface with cloud services</font>

186
00:08:53,980 --> 00:08:58,910
enabling some level of privilege<font color="#E5E5E5"> so so I</font>

187
00:08:56,990 --> 00:09:00,860
give<font color="#E5E5E5"> you literally take that</font><font color="#CCCCCC"> Google dork</font>

188
00:08:58,910 --> 00:09:04,550
<font color="#E5E5E5">and search for it you will find people's</font>

189
00:09:00,860 --> 00:09:08,210
keys on the<font color="#CCCCCC"> internet</font><font color="#E5E5E5"> right</font><font color="#CCCCCC"> now</font><font color="#E5E5E5"> so it's</font>

190
00:09:04,550 --> 00:09:11,120
not<font color="#E5E5E5"> good but yeah so people make</font>

191
00:09:08,210 --> 00:09:13,130
mistakes<font color="#E5E5E5"> so also sometimes you'll find</font>

192
00:09:11,120 --> 00:09:17,620
<font color="#E5E5E5">similar type keys on paceman or other</font>

193
00:09:13,130 --> 00:09:20,660
services<font color="#E5E5E5"> and so you know just generally</font>

194
00:09:17,620 --> 00:09:22,730
trying<font color="#E5E5E5"> to build a solid CI pipeline and</font>

195
00:09:20,660 --> 00:09:25,969
make sure people<font color="#CCCCCC"> I don't know people</font>

196
00:09:22,730 --> 00:09:28,220
<font color="#E5E5E5">just</font><font color="#CCCCCC"> make mistakes</font><font color="#E5E5E5"> right so so another</font>

197
00:09:25,970 --> 00:09:30,650
thing<font color="#CCCCCC"> is is which we</font><font color="#E5E5E5"> just kind of</font>

198
00:09:28,220 --> 00:09:32,570
<font color="#CCCCCC">touched on is the repos but specifically</font>

199
00:09:30,650 --> 00:09:33,890
<font color="#E5E5E5">companies will say okay we're not going</font>

200
00:09:32,570 --> 00:09:35,750
<font color="#CCCCCC">to</font><font color="#E5E5E5"> use like a cloud service we're just</font>

201
00:09:33,890 --> 00:09:37,580
gonna have like<font color="#CCCCCC"> our own server which is</font>

202
00:09:35,750 --> 00:09:40,100
kind of<font color="#E5E5E5"> like</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> you know like bitbucket</font>

203
00:09:37,580 --> 00:09:42,710
or<font color="#CCCCCC"> gitlab</font><font color="#E5E5E5"> or something like that but</font>

204
00:09:40,100 --> 00:09:44,240
then they're spinning<font color="#E5E5E5"> up you know VMs</font>

205
00:09:42,710 --> 00:09:45,470
inside the cloud up<font color="#E5E5E5"> and down and so they</font>

206
00:09:44,240 --> 00:09:47,690
kind<font color="#CCCCCC"> of make the access</font><font color="#E5E5E5"> that's over</font>

207
00:09:45,470 --> 00:09:50,750
pretty wide<font color="#E5E5E5"> right so that's another</font>

208
00:09:47,690 --> 00:09:52,460
scenario where I've seen and the the big

209
00:09:50,750 --> 00:09:54,770
<font color="#E5E5E5">thing is you</font><font color="#CCCCCC"> know</font><font color="#E5E5E5"> you could affect</font><font color="#CCCCCC"> that</font>

210
00:09:52,460 --> 00:09:56,210
<font color="#E5E5E5">CI pipeline potentially but oftentimes</font>

211
00:09:54,770 --> 00:09:58,490
<font color="#E5E5E5">these</font><font color="#CCCCCC"> also have secrets which allow you</font>

212
00:09:56,210 --> 00:09:59,870
to<font color="#E5E5E5"> interface</font><font color="#CCCCCC"> with all the</font><font color="#E5E5E5"> cloud services</font>

213
00:09:58,490 --> 00:10:02,990
<font color="#E5E5E5">to so you can go in and pull those out</font>

214
00:09:59,870 --> 00:10:07,730
<font color="#CCCCCC">so</font><font color="#E5E5E5"> which is what that screenshot kind of</font>

215
00:10:02,990 --> 00:10:08,990
shows<font color="#E5E5E5"> so and then more just going</font>

216
00:10:07,730 --> 00:10:11,240
against the<font color="#CCCCCC"> pipeline which there's been</font>

217
00:10:08,990 --> 00:10:13,280
<font color="#CCCCCC">a lot of talks about</font><font color="#E5E5E5"> hacking</font><font color="#CCCCCC"> Jenkins and</font>

218
00:10:11,240 --> 00:10:15,110
<font color="#E5E5E5">other services like</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> so generally</font>

219
00:10:13,280 --> 00:10:17,270
<font color="#CCCCCC">speaking you</font><font color="#E5E5E5"> should have that stuff</font>

220
00:10:15,110 --> 00:10:19,690
<font color="#E5E5E5">locked down</font><font color="#CCCCCC"> so only</font><font color="#E5E5E5"> developers get into</font>

221
00:10:17,270 --> 00:10:19,689
it but

222
00:10:20,400 --> 00:10:25,079
and then just another thing we're not

223
00:10:22,440 --> 00:10:29,130
really<font color="#CCCCCC"> gonna dive into deep today on but</font>

224
00:10:25,080 --> 00:10:31,680
I just want<font color="#E5E5E5"> to make</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> aware is just</font>

225
00:10:29,130 --> 00:10:34,170
additional attacks of hacking the client

226
00:10:31,680 --> 00:10:36,300
and leveraging whatever authorization

227
00:10:34,170 --> 00:10:38,969
they have to pivot<font color="#E5E5E5"> back</font><font color="#CCCCCC"> into</font><font color="#E5E5E5"> the cloud</font>

228
00:10:36,300 --> 00:10:40,439
<font color="#E5E5E5">I'll still apply here right so so like</font>

229
00:10:38,970 --> 00:10:42,600
if the<font color="#E5E5E5"> hacker can get access</font><font color="#CCCCCC"> to an</font>

230
00:10:40,440 --> 00:10:44,430
admins box or developers box<font color="#CCCCCC"> whatever</font>

231
00:10:42,600 --> 00:10:46,020
the developer admin can<font color="#E5E5E5"> do potentially</font>

232
00:10:44,430 --> 00:10:47,609
<font color="#CCCCCC">if they were well you spend</font><font color="#E5E5E5"> the time</font><font color="#CCCCCC"> of</font>

233
00:10:46,020 --> 00:10:50,760
<font color="#E5E5E5">resources the hackers can do</font><font color="#CCCCCC"> too right</font>

234
00:10:47,610 --> 00:10:52,650
<font color="#CCCCCC">so and that's you</font><font color="#E5E5E5"> know as</font><font color="#CCCCCC"> simple as you</font>

235
00:10:50,760 --> 00:10:54,630
<font color="#E5E5E5">know potentially sending macros in and</font>

236
00:10:52,650 --> 00:10:57,089
waiting<font color="#E5E5E5"> for people</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> run them or other</font>

237
00:10:54,630 --> 00:10:59,370
common you know<font color="#E5E5E5"> type of</font><font color="#CCCCCC"> tax right but</font>

238
00:10:57,089 --> 00:11:00,990
then taking<font color="#CCCCCC"> a more focused look when you</font>

239
00:10:59,370 --> 00:11:02,730
<font color="#E5E5E5">get on the end point</font><font color="#CCCCCC"> what does</font><font color="#E5E5E5"> this user</font>

240
00:11:00,990 --> 00:11:04,200
actually<font color="#E5E5E5"> do do they have access</font><font color="#CCCCCC"> to any</font>

241
00:11:02,730 --> 00:11:08,850
cloud services<font color="#E5E5E5"> can we harvest those</font>

242
00:11:04,200 --> 00:11:11,460
credentials<font color="#E5E5E5"> can</font><font color="#CCCCCC"> we use them</font><font color="#E5E5E5"> all that all</font>

243
00:11:08,850 --> 00:11:13,830
right<font color="#CCCCCC"> and then just this is</font><font color="#E5E5E5"> my spaghetti</font>

244
00:11:11,460 --> 00:11:15,930
map of all the ways you<font color="#E5E5E5"> get pwned</font><font color="#CCCCCC"> right</font>

245
00:11:13,830 --> 00:11:17,910
so there's all those<font color="#E5E5E5"> points that you</font>

246
00:11:15,930 --> 00:11:22,739
know if they're<font color="#CCCCCC"> not all</font><font color="#E5E5E5"> considerations</font>

247
00:11:17,910 --> 00:11:28,740
<font color="#CCCCCC">insecure</font><font color="#E5E5E5"> then you know you may lead</font><font color="#CCCCCC"> to a</font>

248
00:11:22,740 --> 00:11:32,400
doomsday<font color="#E5E5E5"> scenario okay so that's my</font>

249
00:11:28,740 --> 00:11:34,589
intro<font color="#E5E5E5"> so so we're going to talk for a</font>

250
00:11:32,400 --> 00:11:36,390
minute about storage and I spend some

251
00:11:34,589 --> 00:11:38,970
time talking<font color="#E5E5E5"> about Azure storage because</font>

252
00:11:36,390 --> 00:11:40,589
a lot of<font color="#E5E5E5"> the other services and a lot of</font>

253
00:11:38,970 --> 00:11:43,260
<font color="#E5E5E5">the ways you're going to build your</font>

254
00:11:40,589 --> 00:11:45,300
cloud services are<font color="#E5E5E5"> get them some way</font>

255
00:11:43,260 --> 00:11:48,240
interface with Azure storage solution

256
00:11:45,300 --> 00:11:52,050
<font color="#E5E5E5">right</font><font color="#CCCCCC"> so generally speaking</font><font color="#E5E5E5"> you're gonna</font>

257
00:11:48,240 --> 00:11:53,730
have<font color="#E5E5E5"> an app right or your VMs and if</font>

258
00:11:52,050 --> 00:11:55,380
they want to<font color="#E5E5E5"> persist data for a long</font>

259
00:11:53,730 --> 00:11:57,750
time and share it then they're gonna use

260
00:11:55,380 --> 00:12:00,870
Azure storage solution right to do that

261
00:11:57,750 --> 00:12:02,700
<font color="#E5E5E5">and maybe what your Isis or your app is</font>

262
00:12:00,870 --> 00:12:04,290
<font color="#E5E5E5">really just a web server or web app</font>

263
00:12:02,700 --> 00:12:05,580
that's kind<font color="#CCCCCC"> of feeding you know letting</font>

264
00:12:04,290 --> 00:12:07,770
use<font color="#E5E5E5"> your to interface</font><font color="#CCCCCC"> with it but</font>

265
00:12:05,580 --> 00:12:10,770
eventually<font color="#E5E5E5"> the data is gonna land inside</font>

266
00:12:07,770 --> 00:12:12,959
this bucket<font color="#CCCCCC"> or these source containers</font>

267
00:12:10,770 --> 00:12:15,270
so so if the<font color="#E5E5E5"> hacker can get access</font><font color="#CCCCCC"> to</font>

268
00:12:12,959 --> 00:12:16,859
the storage<font color="#CCCCCC"> they you</font><font color="#E5E5E5"> know they can they</font>

269
00:12:15,270 --> 00:12:18,360
<font color="#CCCCCC">don't really</font><font color="#E5E5E5"> need to hack your app right</font>

270
00:12:16,860 --> 00:12:22,620
<font color="#E5E5E5">they can kind of bypass and get the data</font>

271
00:12:18,360 --> 00:12:25,400
directly so and there's different<font color="#E5E5E5"> types</font>

272
00:12:22,620 --> 00:12:27,930
of storage<font color="#E5E5E5"> inside</font><font color="#CCCCCC"> add</font><font color="#E5E5E5"> your solutions</font>

273
00:12:25,400 --> 00:12:29,010
the most common though is<font color="#E5E5E5"> the blob so</font>

274
00:12:27,930 --> 00:12:31,650
that's what we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to focus on</font>

275
00:12:29,010 --> 00:12:33,360
that's<font color="#E5E5E5"> kind of the</font><font color="#CCCCCC"> azure</font><font color="#E5E5E5"> equivalent to</font>

276
00:12:31,650 --> 00:12:34,019
as three buckets if you're acquainted

277
00:12:33,360 --> 00:12:39,989
with

278
00:12:34,019 --> 00:12:41,550
three buckets<font color="#E5E5E5"> in AWS so okay and</font><font color="#CCCCCC"> so I</font>

279
00:12:39,989 --> 00:12:44,879
<font color="#E5E5E5">just want to kind of pull</font><font color="#CCCCCC"> it out</font><font color="#E5E5E5"> there's</font>

280
00:12:41,550 --> 00:12:46,559
these three concepts here so you<font color="#E5E5E5"> have</font>

281
00:12:44,879 --> 00:12:48,509
the<font color="#E5E5E5"> storage</font><font color="#CCCCCC"> account name so</font><font color="#E5E5E5"> that's</font>

282
00:12:46,559 --> 00:12:50,129
something that's<font color="#CCCCCC"> a unique identifier</font>

283
00:12:48,509 --> 00:12:51,749
<font color="#CCCCCC">right like if you tried</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> register that</font>

284
00:12:50,129 --> 00:12:53,429
<font color="#E5E5E5">same name right now</font><font color="#CCCCCC"> I sure would not let</font>

285
00:12:51,749 --> 00:12:55,589
you do that right because it's

286
00:12:53,429 --> 00:12:57,509
registered to<font color="#E5E5E5"> my account and then inside</font>

287
00:12:55,589 --> 00:12:59,549
of<font color="#E5E5E5"> that</font><font color="#CCCCCC"> you can't create</font><font color="#E5E5E5"> these container</font>

288
00:12:57,509 --> 00:13:00,389
names right which is kind<font color="#CCCCCC"> of where</font>

289
00:12:59,549 --> 00:13:03,509
you're going<font color="#CCCCCC"> to be storing your data</font>

290
00:13:00,389 --> 00:13:04,949
<font color="#E5E5E5">like a folder and then under</font><font color="#CCCCCC"> those</font>

291
00:13:03,509 --> 00:13:08,699
you're gonna<font color="#E5E5E5"> have your file name which</font>

292
00:13:04,949 --> 00:13:13,889
is<font color="#E5E5E5"> called blob name right so so just</font>

293
00:13:08,699 --> 00:13:18,628
kind of we want to discover in insecure

294
00:13:13,889 --> 00:13:19,829
or unsecured blob storage<font color="#E5E5E5"> right so the</font>

295
00:13:18,629 --> 00:13:23,519
first<font color="#E5E5E5"> thing we need to</font><font color="#CCCCCC"> figure out is</font>

296
00:13:19,829 --> 00:13:26,429
what<font color="#CCCCCC"> is the account</font><font color="#E5E5E5"> name right</font><font color="#CCCCCC"> so that's</font>

297
00:13:23,519 --> 00:13:29,279
<font color="#E5E5E5">part of its like part of the fqdn</font><font color="#CCCCCC"> right</font>

298
00:13:26,429 --> 00:13:31,738
so we could take common tools for

299
00:13:29,279 --> 00:13:34,230
brute-forcing<font color="#CCCCCC"> fqt</font><font color="#E5E5E5"> ends and try and brute</font>

300
00:13:31,739 --> 00:13:38,040
<font color="#E5E5E5">force out storage names if if we</font><font color="#CCCCCC"> wanted</font>

301
00:13:34,230 --> 00:13:41,999
<font color="#CCCCCC">to so</font><font color="#E5E5E5"> what I like what I</font><font color="#CCCCCC"> like to</font><font color="#E5E5E5"> use is</font>

302
00:13:38,040 --> 00:13:44,639
go Buster<font color="#E5E5E5"> it</font><font color="#CCCCCC"> it is very fast at</font><font color="#E5E5E5"> doing</font>

303
00:13:41,999 --> 00:13:50,209
this type of<font color="#E5E5E5"> brute force</font><font color="#CCCCCC"> um and while</font>

304
00:13:44,639 --> 00:13:52,920
still<font color="#E5E5E5"> being mostly reliable right so but</font>

305
00:13:50,209 --> 00:13:55,258
so that's<font color="#E5E5E5"> kind of what I use and usually</font>

306
00:13:52,920 --> 00:13:56,790
use that<font color="#E5E5E5"> with combination of like</font>

307
00:13:55,259 --> 00:14:00,749
dictionary but you could do is straight

308
00:13:56,790 --> 00:14:02,939
like brute force<font color="#E5E5E5"> but so I started to try</font>

309
00:14:00,749 --> 00:14:04,829
<font color="#CCCCCC">and do some of</font><font color="#E5E5E5"> the computational math to</font>

310
00:14:02,939 --> 00:14:06,089
just kind of do some metrics on how<font color="#E5E5E5"> long</font>

311
00:14:04,829 --> 00:14:09,329
it would<font color="#E5E5E5"> take if</font><font color="#CCCCCC"> you just</font><font color="#E5E5E5"> want</font><font color="#CCCCCC"> to do</font>

312
00:14:06,089 --> 00:14:15,980
brute<font color="#E5E5E5"> force</font><font color="#CCCCCC"> all that blob storage space</font>

313
00:14:09,329 --> 00:14:18,748
right<font color="#CCCCCC"> because you can</font><font color="#E5E5E5"> only write</font><font color="#CCCCCC"> sorry</font>

314
00:14:15,980 --> 00:14:20,850
so for the storage<font color="#E5E5E5"> account name you can</font>

315
00:14:18,749 --> 00:14:23,040
only use lowercase letters and<font color="#CCCCCC"> numbers</font>

316
00:14:20,850 --> 00:14:25,290
and it's got to<font color="#E5E5E5"> be between 3 and 24</font>

317
00:14:23,040 --> 00:14:27,959
characters<font color="#E5E5E5"> so you can see you know every</font>

318
00:14:25,290 --> 00:14:28,980
time<font color="#CCCCCC"> you add a character</font><font color="#E5E5E5"> the amount of</font>

319
00:14:27,959 --> 00:14:32,669
<font color="#E5E5E5">time it's</font><font color="#CCCCCC"> going</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> take to brute force</font>

320
00:14:28,980 --> 00:14:37,169
<font color="#E5E5E5">that all the possible storage count</font>

321
00:14:32,669 --> 00:14:38,730
names goes up exponentially<font color="#E5E5E5"> so and then</font>

322
00:14:37,169 --> 00:14:41,459
<font color="#CCCCCC">into if you get a hit and you figure out</font>

323
00:14:38,730 --> 00:14:42,419
what the storage<font color="#CCCCCC"> account name is you</font>

324
00:14:41,459 --> 00:14:44,309
still need<font color="#CCCCCC"> to figure out</font><font color="#E5E5E5"> what the</font>

325
00:14:42,419 --> 00:14:46,709
container name is and so you could also

326
00:14:44,309 --> 00:14:47,969
use go Buster to kind of do a derby<font color="#E5E5E5"> like</font>

327
00:14:46,709 --> 00:14:52,319
directory file guessing

328
00:14:47,970 --> 00:14:54,930
type attack<font color="#E5E5E5"> figure that out and then</font><font color="#CCCCCC"> you</font>

329
00:14:52,319 --> 00:14:58,229
<font color="#CCCCCC">also</font><font color="#E5E5E5"> need figure out the names but you</font>

330
00:14:54,930 --> 00:14:59,878
can do a an<font color="#E5E5E5"> argument here</font><font color="#CCCCCC"> often if it</font>

331
00:14:58,230 --> 00:15:03,800
enables listings to kind of<font color="#E5E5E5"> list files</font>

332
00:14:59,879 --> 00:15:03,800
if you<font color="#E5E5E5"> get those other two parameters so</font>

333
00:15:04,430 --> 00:15:12,508
<font color="#E5E5E5">so brute forcing all three of those is</font>

334
00:15:08,730 --> 00:15:14,459
<font color="#E5E5E5">you know very it's possible and I've had</font>

335
00:15:12,509 --> 00:15:16,439
some luck fair on engagements doing some

336
00:15:14,459 --> 00:15:18,540
of that but it's you<font color="#CCCCCC"> know if you can</font>

337
00:15:16,439 --> 00:15:20,490
give yourself<font color="#E5E5E5"> a leg up</font><font color="#CCCCCC"> that would</font><font color="#E5E5E5"> be you</font>

338
00:15:18,540 --> 00:15:22,980
<font color="#E5E5E5">know there's an easier</font><font color="#CCCCCC"> way to to</font>

339
00:15:20,490 --> 00:15:24,329
<font color="#E5E5E5">basically do this right so so if you</font>

340
00:15:22,980 --> 00:15:25,829
kind<font color="#CCCCCC"> of</font><font color="#E5E5E5"> look at it</font><font color="#CCCCCC"> oftentimes they'll</font>

341
00:15:24,329 --> 00:15:27,750
<font color="#E5E5E5">have a web service which is kind of</font>

342
00:15:25,829 --> 00:15:30,540
<font color="#E5E5E5">linking</font><font color="#CCCCCC"> to the storage</font><font color="#E5E5E5"> right and</font>

343
00:15:27,750 --> 00:15:32,009
sometimes<font color="#CCCCCC"> it's</font><font color="#E5E5E5"> like a full proxy where</font>

344
00:15:30,540 --> 00:15:34,230
<font color="#E5E5E5">it's not</font><font color="#CCCCCC"> letting you see where it's</font>

345
00:15:32,009 --> 00:15:36,569
storing the data<font color="#CCCCCC"> but other</font><font color="#E5E5E5"> times due to</font>

346
00:15:34,230 --> 00:15:39,360
efficiencies it allows the user<font color="#CCCCCC"> to kind</font>

347
00:15:36,569 --> 00:15:43,319
<font color="#E5E5E5">of directly interact with the blobs with</font>

348
00:15:39,360 --> 00:15:44,639
the containers this blob storage<font color="#E5E5E5"> so that</font>

349
00:15:43,319 --> 00:15:46,319
<font color="#CCCCCC">it doesn't have</font><font color="#E5E5E5"> to have the web app</font>

350
00:15:44,639 --> 00:15:47,910
taking the load of<font color="#E5E5E5"> uploading like large</font>

351
00:15:46,319 --> 00:15:51,449
files all<font color="#CCCCCC"> the time right and there is a</font>

352
00:15:47,910 --> 00:15:53,579
way to<font color="#CCCCCC"> issue</font><font color="#E5E5E5"> secure kind of like limited</font>

353
00:15:51,449 --> 00:15:59,099
use tokens<font color="#E5E5E5"> so that people can seamlessly</font>

354
00:15:53,579 --> 00:16:02,339
store stuff<font color="#E5E5E5"> and blob storage so so so</font>

355
00:15:59,100 --> 00:16:05,189
the<font color="#CCCCCC"> so we want to discover what that is</font>

356
00:16:02,339 --> 00:16:07,589
<font color="#E5E5E5">so I wrote this script it's on the</font>

357
00:16:05,189 --> 00:16:10,769
internet and I'll tweet out<font color="#CCCCCC"> a link</font><font color="#E5E5E5"> to it</font>

358
00:16:07,589 --> 00:16:12,779
<font color="#CCCCCC">too and the first thing all this does is</font>

359
00:16:10,769 --> 00:16:16,350
you<font color="#E5E5E5"> just give it</font><font color="#CCCCCC"> an</font><font color="#E5E5E5"> IP address and then</font>

360
00:16:12,779 --> 00:16:18,029
it goes<font color="#CCCCCC"> and pulls</font><font color="#E5E5E5"> these files which</font>

361
00:16:16,350 --> 00:16:20,040
basically<font color="#E5E5E5"> have all</font><font color="#CCCCCC"> the net blocks for</font>

362
00:16:18,029 --> 00:16:22,949
AWS<font color="#E5E5E5"> and</font><font color="#CCCCCC"> azure</font><font color="#E5E5E5"> and then tells you like</font>

363
00:16:20,040 --> 00:16:24,540
yes this IP is<font color="#CCCCCC"> Asscher or AWS and it's</font>

364
00:16:22,949 --> 00:16:26,430
in this<font color="#E5E5E5"> region</font><font color="#CCCCCC"> so it just</font><font color="#E5E5E5"> helps you</font>

365
00:16:24,540 --> 00:16:28,889
verify the target is<font color="#CCCCCC"> actually what you</font>

366
00:16:26,430 --> 00:16:30,329
think it<font color="#E5E5E5"> is right</font><font color="#CCCCCC"> not</font><font color="#E5E5E5"> anything you</font>

367
00:16:28,889 --> 00:16:31,860
couldn't do<font color="#CCCCCC"> by hand but just kind of</font>

368
00:16:30,329 --> 00:16:33,959
saves you some<font color="#CCCCCC"> time</font>

369
00:16:31,860 --> 00:16:37,019
right and then I wrote<font color="#E5E5E5"> this other tool</font>

370
00:16:33,959 --> 00:16:41,369
called<font color="#CCCCCC"> lower Slav and this</font><font color="#E5E5E5"> is just a web</font>

371
00:16:37,019 --> 00:16:44,100
spider<font color="#E5E5E5"> so it it will just</font><font color="#CCCCCC"> go through and</font>

372
00:16:41,370 --> 00:16:47,309
spider the target<font color="#CCCCCC"> website and it</font><font color="#E5E5E5"> will</font>

373
00:16:44,100 --> 00:16:50,970
look specifically for<font color="#CCCCCC"> Atos buckets and</font>

374
00:16:47,309 --> 00:16:52,410
<font color="#E5E5E5">as your storage account names right and</font>

375
00:16:50,970 --> 00:16:54,389
then let you know what it<font color="#E5E5E5"> is so you can</font>

376
00:16:52,410 --> 00:16:56,730
<font color="#CCCCCC">see in this screenshot it spidered the</font>

377
00:16:54,389 --> 00:16:58,500
<font color="#CCCCCC">web site it sees it's linking out to a</font>

378
00:16:56,730 --> 00:17:01,150
resource and lets you<font color="#E5E5E5"> know what that is</font>

379
00:16:58,500 --> 00:17:04,329
inside the<font color="#E5E5E5"> log file so</font>

380
00:17:01,150 --> 00:17:05,859
so now you know if they<font color="#E5E5E5"> link directly to</font>

381
00:17:04,329 --> 00:17:07,210
<font color="#E5E5E5">it from the web service that</font><font color="#CCCCCC"> kind of</font>

382
00:17:05,859 --> 00:17:09,969
gives you<font color="#E5E5E5"> a leg</font><font color="#CCCCCC"> up and</font><font color="#E5E5E5"> then you only</font>

383
00:17:07,210 --> 00:17:11,710
need<font color="#E5E5E5"> to</font><font color="#CCCCCC"> brute force</font><font color="#E5E5E5"> kind of</font><font color="#CCCCCC"> sum some of</font>

384
00:17:09,970 --> 00:17:14,290
the like filename type blob names

385
00:17:11,710 --> 00:17:18,130
<font color="#E5E5E5">parameters things like that right so you</font>

386
00:17:14,290 --> 00:17:20,800
can save yourself<font color="#CCCCCC"> some time there you</font>

387
00:17:18,130 --> 00:17:22,300
could do a<font color="#E5E5E5"> similar thing</font><font color="#CCCCCC"> with</font><font color="#E5E5E5"> like if</font>

388
00:17:20,800 --> 00:17:25,569
you use burp suite a lot to<font color="#E5E5E5"> text</font><font color="#CCCCCC"> Web</font>

389
00:17:22,300 --> 00:17:26,919
<font color="#CCCCCC">Apps</font><font color="#E5E5E5"> but then there is an extension for</font>

390
00:17:25,569 --> 00:17:31,240
<font color="#E5E5E5">burp suite but doesn't</font><font color="#CCCCCC"> actually support</font>

391
00:17:26,920 --> 00:17:33,940
<font color="#E5E5E5">any</font><font color="#CCCCCC"> asher or like any other targets like</font>

392
00:17:31,240 --> 00:17:37,540
<font color="#CCCCCC">digitalocean</font><font color="#E5E5E5"> or whatever so you'd</font><font color="#CCCCCC"> have</font>

393
00:17:33,940 --> 00:17:41,220
<font color="#E5E5E5">to add that in anyways so but this this</font>

394
00:17:37,540 --> 00:17:41,220
out of the box does support<font color="#E5E5E5"> this so</font>

395
00:17:41,430 --> 00:17:54,850
<font color="#CCCCCC">alright cool so</font><font color="#E5E5E5"> storage</font><font color="#CCCCCC"> access</font><font color="#E5E5E5"> right so</font>

396
00:17:51,820 --> 00:17:58,750
we're the hacker here we want<font color="#E5E5E5"> to access</font>

397
00:17:54,850 --> 00:18:01,149
<font color="#CCCCCC">storage we've been able to find a</font>

398
00:17:58,750 --> 00:18:08,050
certificate or<font color="#E5E5E5"> some other type</font><font color="#CCCCCC"> of secret</font>

399
00:18:01,150 --> 00:18:11,140
<font color="#CCCCCC">and we want to use</font><font color="#E5E5E5"> that right so so the</font>

400
00:18:08,050 --> 00:18:13,360
first<font color="#CCCCCC"> thing is asher</font><font color="#E5E5E5"> as opposed to kind</font>

401
00:18:11,140 --> 00:18:15,100
of AWS it relies on these<font color="#E5E5E5"> management</font>

402
00:18:13,360 --> 00:18:17,229
certificates a lot to authenticate<font color="#E5E5E5"> to</font>

403
00:18:15,100 --> 00:18:20,709
<font color="#E5E5E5">the services so</font><font color="#CCCCCC"> you want to be</font>

404
00:18:17,230 --> 00:18:22,870
particularly aware that anything<font color="#E5E5E5"> like</font>

405
00:18:20,710 --> 00:18:25,000
dot publish settings type<font color="#E5E5E5"> file is kind</font>

406
00:18:22,870 --> 00:18:26,379
<font color="#CCCCCC">of an export and will</font><font color="#E5E5E5"> also contain that</font>

407
00:18:25,000 --> 00:18:27,730
certificate<font color="#CCCCCC"> so if you see any those</font>

408
00:18:26,380 --> 00:18:29,710
files<font color="#CCCCCC"> you definitely</font><font color="#E5E5E5"> want</font><font color="#CCCCCC"> to pull them</font>

409
00:18:27,730 --> 00:18:32,590
<font color="#CCCCCC">back and then you</font><font color="#E5E5E5"> can reuse those to</font>

410
00:18:29,710 --> 00:18:34,900
access<font color="#E5E5E5"> right so you can also look for</font>

411
00:18:32,590 --> 00:18:37,300
<font color="#E5E5E5">configuration files</font><font color="#CCCCCC"> a lot of times when</font>

412
00:18:34,900 --> 00:18:39,400
developers are coding they're like

413
00:18:37,300 --> 00:18:41,320
<font color="#CCCCCC">donnetta apps you'll find the web config</font>

414
00:18:39,400 --> 00:18:44,740
file and<font color="#E5E5E5"> if that's integrated with</font><font color="#CCCCCC"> Azure</font>

415
00:18:41,320 --> 00:18:49,659
it will also<font color="#E5E5E5"> contain</font><font color="#CCCCCC"> like kind</font><font color="#E5E5E5"> of either</font>

416
00:18:44,740 --> 00:18:51,670
<font color="#E5E5E5">as</font><font color="#CCCCCC"> SAS your URL URI</font><font color="#E5E5E5"> or</font><font color="#CCCCCC"> a like access</font>

417
00:18:49,660 --> 00:18:57,940
token<font color="#E5E5E5"> which you can use to</font><font color="#CCCCCC"> access</font><font color="#E5E5E5"> the</font>

418
00:18:51,670 --> 00:19:00,880
storage and I just wanted to<font color="#E5E5E5"> kind of</font>

419
00:18:57,940 --> 00:19:03,250
because I guess it's<font color="#E5E5E5"> this kind of second</font>

420
00:19:00,880 --> 00:19:05,440
<font color="#CCCCCC">nature if you do a lot of a sure work</font>

421
00:19:03,250 --> 00:19:06,550
right but if you<font color="#E5E5E5"> haven't actually</font><font color="#CCCCCC"> used</font>

422
00:19:05,440 --> 00:19:09,040
that<font color="#E5E5E5"> sure a lot I just wanted to make</font>

423
00:19:06,550 --> 00:19:10,600
<font color="#E5E5E5">sure you guys realize this</font><font color="#CCCCCC"> is like</font>

424
00:19:09,040 --> 00:19:12,760
<font color="#E5E5E5">really trivial once you find those</font>

425
00:19:10,600 --> 00:19:13,899
secrets to leverage right so you

426
00:19:12,760 --> 00:19:15,790
literally just go to Microsoft

427
00:19:13,900 --> 00:19:18,610
website you download the storage

428
00:19:15,790 --> 00:19:20,830
<font color="#CCCCCC">Explorer which is a free app right</font><font color="#E5E5E5"> you</font>

429
00:19:18,610 --> 00:19:22,209
boot up<font color="#CCCCCC"> the app</font><font color="#E5E5E5"> and then</font><font color="#CCCCCC"> it ask you when</font>

430
00:19:20,830 --> 00:19:23,679
you<font color="#E5E5E5"> boot up</font><font color="#CCCCCC"> the app what type of</font>

431
00:19:22,210 --> 00:19:26,470
<font color="#E5E5E5">credential you have so you just kind of</font>

432
00:19:23,680 --> 00:19:29,500
select it and then you input<font color="#E5E5E5"> the</font>

433
00:19:26,470 --> 00:19:30,880
credential<font color="#CCCCCC"> and you just map down to</font>

434
00:19:29,500 --> 00:19:34,630
those<font color="#E5E5E5"> storage and now you can start</font>

435
00:19:30,880 --> 00:19:36,550
upload download files<font color="#E5E5E5"> right so so let's</font>

436
00:19:34,630 --> 00:19:37,960
<font color="#CCCCCC">lay</font><font color="#E5E5E5"> that easy there's some other</font>

437
00:19:36,550 --> 00:19:40,300
<font color="#E5E5E5">third-party software that's a little bit</font>

438
00:19:37,960 --> 00:19:42,670
slicker than a storage<font color="#E5E5E5"> Explorer but this</font>

439
00:19:40,300 --> 00:19:53,500
is kind of the easy way you go<font color="#E5E5E5"> right and</font>

440
00:19:42,670 --> 00:19:56,500
<font color="#E5E5E5">kind</font><font color="#CCCCCC"> of the Microsoft appreciate DS so</font>

441
00:19:53,500 --> 00:19:59,140
these are virtual<font color="#E5E5E5"> hard disks</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> if</font>

442
00:19:56,500 --> 00:20:02,410
you if you've ever used hyper-v<font color="#E5E5E5"> or my</font>

443
00:19:59,140 --> 00:20:04,090
<font color="#CCCCCC">Microsoft virtualization solutions I you</font>

444
00:20:02,410 --> 00:20:05,770
might be acquainted with these<font color="#E5E5E5"> they're</font>

445
00:20:04,090 --> 00:20:11,110
<font color="#CCCCCC">very like pretty much</font><font color="#E5E5E5"> the same thing</font>

446
00:20:05,770 --> 00:20:13,660
<font color="#CCCCCC">yeah sure</font><font color="#E5E5E5"> right so for most of the</font>

447
00:20:11,110 --> 00:20:16,389
history<font color="#CCCCCC"> of a sure</font><font color="#E5E5E5"> your VHD files were</font>

448
00:20:13,660 --> 00:20:19,540
just stored inside<font color="#CCCCCC"> of blob storage right</font>

449
00:20:16,390 --> 00:20:21,580
so if you<font color="#E5E5E5"> got an over permissive access</font>

450
00:20:19,540 --> 00:20:23,620
token<font color="#E5E5E5"> for</font><font color="#CCCCCC"> blob storage you could</font>

451
00:20:21,580 --> 00:20:25,178
literally<font color="#E5E5E5"> go in and down start</font>

452
00:20:23,620 --> 00:20:30,600
downloading<font color="#E5E5E5"> the heart the virtual</font><font color="#CCCCCC"> hard</font>

453
00:20:25,179 --> 00:20:35,530
disk for<font color="#CCCCCC"> the AI sauce the VMs right and</font>

454
00:20:30,600 --> 00:20:37,090
when you<font color="#CCCCCC"> download them what I do is I do</font>

455
00:20:35,530 --> 00:20:42,550
a lot of testing against Linux targets

456
00:20:37,090 --> 00:20:45,399
right<font color="#E5E5E5"> almost exclusively right so so I</font>

457
00:20:42,550 --> 00:20:47,440
mean I look for you know<font color="#E5E5E5"> SSH private</font>

458
00:20:45,400 --> 00:20:49,300
Keys those shouldn't be on Isis VMs in

459
00:20:47,440 --> 00:20:54,280
the cloud but you'd be surprised<font color="#E5E5E5"> and</font>

460
00:20:49,300 --> 00:20:57,460
then also I<font color="#CCCCCC"> I look for password hashes</font>

461
00:20:54,280 --> 00:20:59,740
and<font color="#CCCCCC"> sight</font><font color="#E5E5E5"> shadow files and I just kind</font>

462
00:20:57,460 --> 00:21:02,080
of I I guess I didn't put the grep

463
00:20:59,740 --> 00:21:05,770
command<font color="#CCCCCC"> but I</font><font color="#E5E5E5"> just kind of grep for like</font>

464
00:21:02,080 --> 00:21:08,110
you know<font color="#E5E5E5"> : dollar sign one dollar sign</font>

465
00:21:05,770 --> 00:21:11,350
and<font color="#E5E5E5"> then it's a fine that had different</font>

466
00:21:08,110 --> 00:21:12,729
hash types because you're gonna like

467
00:21:11,350 --> 00:21:14,678
forensic<font color="#CCCCCC"> we</font><font color="#E5E5E5"> extract the files out of the</font>

468
00:21:12,730 --> 00:21:21,100
VHD or you can just<font color="#CCCCCC"> go</font><font color="#E5E5E5"> up and</font><font color="#CCCCCC"> get</font><font color="#E5E5E5"> the</font>

469
00:21:14,679 --> 00:21:23,260
hash quick<font color="#E5E5E5"> right so so so and then you</font>

470
00:21:21,100 --> 00:21:24,159
<font color="#E5E5E5">know throw that into hash kak hash cat</font>

471
00:21:23,260 --> 00:21:27,840
GPU

472
00:21:24,160 --> 00:21:27,840
type system<font color="#E5E5E5"> and kind</font><font color="#CCCCCC"> of break that and</font>

473
00:21:28,370 --> 00:21:34,709
so this is<font color="#CCCCCC"> C alright so also it's</font>

474
00:21:32,910 --> 00:21:38,100
important<font color="#CCCCCC"> to review</font><font color="#E5E5E5"> the code</font><font color="#CCCCCC"> I feel like</font>

475
00:21:34,710 --> 00:21:40,500
a lot of the assessments that<font color="#E5E5E5"> I've</font>

476
00:21:38,100 --> 00:21:42,959
worked on<font color="#E5E5E5"> in the past</font><font color="#CCCCCC"> still</font><font color="#E5E5E5"> have secrets</font>

477
00:21:40,500 --> 00:21:45,030
hard-coded into the code base<font color="#E5E5E5"> so if you</font>

478
00:21:42,960 --> 00:21:46,710
can get<font color="#E5E5E5"> access to the code</font><font color="#CCCCCC"> base by a one</font>

479
00:21:45,030 --> 00:21:49,080
target generally those secrets will

480
00:21:46,710 --> 00:21:54,450
<font color="#CCCCCC">enable</font><font color="#E5E5E5"> you more access throughout the</font>

481
00:21:49,080 --> 00:21:55,889
subscription in<font color="#CCCCCC"> Asscher so okay there I</font>

482
00:21:54,450 --> 00:21:58,950
did I did put a string in there<font color="#E5E5E5"> to grab</font>

483
00:21:55,890 --> 00:22:00,840
<font color="#E5E5E5">okay great</font><font color="#CCCCCC"> so grep for the secrets and</font>

484
00:21:58,950 --> 00:22:01,200
<font color="#E5E5E5">you can use PowerShell to grab so there</font>

485
00:22:00,840 --> 00:22:03,169
you go

486
00:22:01,200 --> 00:22:06,840
I'm more of<font color="#E5E5E5"> like a Linux type guy</font><font color="#CCCCCC"> so</font>

487
00:22:03,170 --> 00:22:09,570
<font color="#CCCCCC">alright</font><font color="#E5E5E5"> but after they've done a really</font>

488
00:22:06,840 --> 00:22:11,189
<font color="#CCCCCC">good job with moving to this managed</font>

489
00:22:09,570 --> 00:22:13,139
<font color="#CCCCCC">disk</font><font color="#E5E5E5"> platform is</font>

490
00:22:11,190 --> 00:22:16,410
but whether you're<font color="#CCCCCC"> a particular target</font>

491
00:22:13,140 --> 00:22:18,750
is<font color="#CCCCCC"> implementing they're</font><font color="#E5E5E5"> not highly</font>

492
00:22:16,410 --> 00:22:21,510
dependent right so so but<font color="#CCCCCC"> we've managed</font>

493
00:22:18,750 --> 00:22:23,940
<font color="#CCCCCC">dis by</font><font color="#E5E5E5"> default they no longer store the</font>

494
00:22:21,510 --> 00:22:28,890
VHD files on in blob storage<font color="#E5E5E5"> and this</font>

495
00:22:23,940 --> 00:22:33,270
was rolled out like June 2017<font color="#E5E5E5"> so so if</font>

496
00:22:28,890 --> 00:22:34,830
you are actively<font color="#CCCCCC"> using Azure there's</font>

497
00:22:33,270 --> 00:22:36,929
other<font color="#CCCCCC"> advantages for using manage disks</font>

498
00:22:34,830 --> 00:22:39,030
but this there's a slight security

499
00:22:36,929 --> 00:22:40,830
advantage here right<font color="#CCCCCC"> so that</font><font color="#E5E5E5"> you no</font>

500
00:22:39,030 --> 00:22:42,389
longer<font color="#E5E5E5"> have</font><font color="#CCCCCC"> those VHDs</font><font color="#E5E5E5"> and blob storage</font>

501
00:22:40,830 --> 00:22:44,040
and so even if blobstore she's

502
00:22:42,390 --> 00:22:55,679
compromised they can't download hard

503
00:22:44,040 --> 00:22:58,950
<font color="#E5E5E5">disks</font><font color="#CCCCCC"> so right so</font><font color="#E5E5E5"> okay great</font><font color="#CCCCCC"> so that's</font>

504
00:22:55,679 --> 00:23:04,230
<font color="#E5E5E5">kind of the fine secrets look at it from</font>

505
00:22:58,950 --> 00:23:07,950
the storage angle<font color="#E5E5E5"> right so you don't</font>

506
00:23:04,230 --> 00:23:10,950
<font color="#CCCCCC">really like I don't know</font><font color="#E5E5E5"> as a guy who's</font>

507
00:23:07,950 --> 00:23:14,010
been doing red teaming offensive stuff

508
00:23:10,950 --> 00:23:15,540
for a long time using<font color="#CCCCCC"> web gooeys is</font><font color="#E5E5E5"> okay</font>

509
00:23:14,010 --> 00:23:19,290
if you have to but generally speaking

510
00:23:15,540 --> 00:23:21,149
<font color="#E5E5E5">you</font><font color="#CCCCCC"> want</font><font color="#E5E5E5"> to more like a console type guy</font>

511
00:23:19,290 --> 00:23:23,970
<font color="#E5E5E5">right so I just wanted to show</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> guys</font>

512
00:23:21,150 --> 00:23:26,010
if<font color="#E5E5E5"> you got</font><font color="#CCCCCC"> access to an</font><font color="#E5E5E5"> endpoint</font><font color="#CCCCCC"> what</font>

513
00:23:23,970 --> 00:23:28,260
you would look for<font color="#E5E5E5"> on the end point to</font>

514
00:23:26,010 --> 00:23:31,890
<font color="#CCCCCC">kind</font><font color="#E5E5E5"> of get further access inside of an</font>

515
00:23:28,260 --> 00:23:33,660
azure<font color="#E5E5E5"> subscription right so so if you</font>

516
00:23:31,890 --> 00:23:36,960
can get<font color="#E5E5E5"> access to an end point like the</font>

517
00:23:33,660 --> 00:23:40,010
admin or dev boxes<font color="#CCCCCC"> oftentimes they'll</font>

518
00:23:36,960 --> 00:23:41,809
set up<font color="#E5E5E5"> this PowerShell CLI special</font>

519
00:23:40,010 --> 00:23:46,090
which allow them to interface<font color="#CCCCCC"> with that</font>

520
00:23:41,809 --> 00:23:49,790
<font color="#CCCCCC">Dasher</font><font color="#E5E5E5"> that the control plane and</font>

521
00:23:46,090 --> 00:23:52,010
throughout the services<font color="#E5E5E5"> so you know a</font>

522
00:23:49,790 --> 00:23:53,840
lot of times you'll<font color="#E5E5E5"> see them do a</font><font color="#CCCCCC"> zSpace</font>

523
00:23:52,010 --> 00:23:56,540
<font color="#CCCCCC">login right</font><font color="#E5E5E5"> on the box</font>

524
00:23:53,840 --> 00:23:58,549
<font color="#E5E5E5">and then that well they can do</font><font color="#CCCCCC"> tech</font><font color="#E5E5E5"> tech</font>

525
00:23:56,540 --> 00:24:00,580
<font color="#CCCCCC">username</font><font color="#E5E5E5"> tech tech password but they can</font>

526
00:23:58,549 --> 00:24:04,610
<font color="#E5E5E5">also just kind</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> copy and paste this</font>

527
00:24:00,580 --> 00:24:07,460
URL and<font color="#E5E5E5"> then login using</font><font color="#CCCCCC"> this token</font><font color="#E5E5E5"> to</font>

528
00:24:04,610 --> 00:24:13,250
<font color="#CCCCCC">their</font><font color="#E5E5E5"> asher to the management portal for</font>

529
00:24:07,460 --> 00:24:15,169
a sure<font color="#E5E5E5"> so and once they do that there's</font>

530
00:24:13,250 --> 00:24:17,929
actually a cookie in the browser<font color="#E5E5E5"> which</font>

531
00:24:15,169 --> 00:24:20,150
gives sort<font color="#E5E5E5"> right which which as long as</font>

532
00:24:17,929 --> 00:24:22,070
<font color="#E5E5E5">that cookie</font><font color="#CCCCCC"> is valid</font><font color="#E5E5E5"> if you pick that</font>

533
00:24:20,150 --> 00:24:24,110
<font color="#E5E5E5">cookie off the end point you could</font>

534
00:24:22,070 --> 00:24:25,700
<font color="#CCCCCC">potentially or you inject inside the</font>

535
00:24:24,110 --> 00:24:27,918
browser using cobalt strike or<font color="#CCCCCC"> something</font>

536
00:24:25,700 --> 00:24:29,630
like<font color="#E5E5E5"> that you could kind of do a man in</font>

537
00:24:27,919 --> 00:24:34,480
the browser<font color="#E5E5E5"> type attack and also access</font>

538
00:24:29,630 --> 00:24:35,690
the Azure subscription<font color="#E5E5E5"> that way so oh</font>

539
00:24:34,480 --> 00:24:41,840
yeah

540
00:24:35,690 --> 00:24:43,220
still the cookie right<font color="#CCCCCC"> so but then once</font>

541
00:24:41,840 --> 00:24:44,928
the client<font color="#E5E5E5"> gets authenticated you they</font>

542
00:24:43,220 --> 00:24:46,370
get<font color="#E5E5E5"> back this message right so that's</font>

543
00:24:44,929 --> 00:24:48,380
<font color="#E5E5E5">all fine</font><font color="#CCCCCC"> and dandy but</font><font color="#E5E5E5"> from a hackers</font>

544
00:24:46,370 --> 00:24:51,320
perspective<font color="#E5E5E5"> if I get access</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> a devs</font>

545
00:24:48,380 --> 00:24:54,799
box<font color="#E5E5E5"> I want to know how to replicate this</font>

546
00:24:51,320 --> 00:24:56,809
right so so just there's a dot<font color="#E5E5E5"> as your</font>

547
00:24:54,799 --> 00:24:59,110
folder right under the users profile

548
00:24:56,809 --> 00:25:01,520
windows like sequel and users<font color="#E5E5E5"> Bryce</font>

549
00:24:59,110 --> 00:25:03,889
<font color="#CCCCCC">Dasher gets created right and inside</font>

550
00:25:01,520 --> 00:25:06,020
there you'll<font color="#E5E5E5"> get this</font><font color="#CCCCCC"> Azure profile</font><font color="#E5E5E5"> that</font>

551
00:25:03,890 --> 00:25:07,700
JSON file now have information<font color="#CCCCCC"> about the</font>

552
00:25:06,020 --> 00:25:09,530
subscription so you can go pull<font color="#E5E5E5"> that</font>

553
00:25:07,700 --> 00:25:10,820
back off the<font color="#E5E5E5"> box kind of get more</font>

554
00:25:09,530 --> 00:25:12,830
information<font color="#E5E5E5"> about this description but</font>

555
00:25:10,820 --> 00:25:15,139
the<font color="#CCCCCC"> really cool part is if you're quick</font>

556
00:25:12,830 --> 00:25:17,629
<font color="#E5E5E5">you</font><font color="#CCCCCC"> can actually</font><font color="#E5E5E5"> steal these token files</font>

557
00:25:15,140 --> 00:25:19,700
off<font color="#CCCCCC"> the endpoint</font><font color="#E5E5E5"> and if you read if you</font>

558
00:25:17,630 --> 00:25:20,720
use those on<font color="#E5E5E5"> your box you know as long</font>

559
00:25:19,700 --> 00:25:22,970
<font color="#E5E5E5">as there's no other mitigating controls</font>

560
00:25:20,720 --> 00:25:25,460
<font color="#E5E5E5">you can</font><font color="#CCCCCC"> also access the subscription</font>

561
00:25:22,970 --> 00:25:28,220
using that<font color="#CCCCCC"> right these do</font><font color="#E5E5E5"> have a TTL if</font>

562
00:25:25,460 --> 00:25:31,940
they<font color="#CCCCCC"> die right so this is more</font><font color="#E5E5E5"> like a</font>

563
00:25:28,220 --> 00:25:37,160
same-day type op thing but it is

564
00:25:31,940 --> 00:25:40,160
<font color="#CCCCCC">possible just pull those off so I know</font>

565
00:25:37,160 --> 00:25:43,610
someone's gonna<font color="#E5E5E5"> ask that it's it's I</font>

566
00:25:40,160 --> 00:25:45,120
don't<font color="#E5E5E5"> know</font><font color="#CCCCCC"> sorry I</font><font color="#E5E5E5"> didn't know it</font><font color="#CCCCCC"> but I</font>

567
00:25:43,610 --> 00:25:47,100
<font color="#E5E5E5">don't know right now</font>

568
00:25:45,120 --> 00:25:48,719
and then if you<font color="#E5E5E5"> get access to the</font>

569
00:25:47,100 --> 00:25:50,730
<font color="#E5E5E5">description I'd usually just do a Z</font>

570
00:25:48,720 --> 00:25:51,180
<font color="#E5E5E5">account show and that's kind of</font><font color="#CCCCCC"> your Who</font>

571
00:25:50,730 --> 00:25:52,800
am I

572
00:25:51,180 --> 00:25:53,790
equivalent<font color="#E5E5E5"> right because a lot of times</font>

573
00:25:52,800 --> 00:25:56,040
when you're pulling<font color="#E5E5E5"> these creds off the</font>

574
00:25:53,790 --> 00:25:56,700
<font color="#CCCCCC">box you're actually</font><font color="#E5E5E5"> not really sure who</font>

575
00:25:56,040 --> 00:26:00,120
they belong<font color="#E5E5E5"> to</font>

576
00:25:56,700 --> 00:26:02,670
so this kind<font color="#CCCCCC"> of helps</font><font color="#E5E5E5"> you out so so on</font>

577
00:26:00,120 --> 00:26:04,379
the<font color="#E5E5E5"> flip side I mean maybe you want to</font>

578
00:26:02,670 --> 00:26:06,450
monitor for<font color="#E5E5E5"> that on the</font><font color="#CCCCCC"> Azure side right</font>

579
00:26:04,380 --> 00:26:12,090
so usually users don't<font color="#E5E5E5"> need</font><font color="#CCCCCC"> to know who</font>

580
00:26:06,450 --> 00:26:19,230
they are<font color="#CCCCCC"> right</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> okay</font>

581
00:26:12,090 --> 00:26:20,429
<font color="#E5E5E5">all right so okay so</font><font color="#CCCCCC"> data</font><font color="#E5E5E5"> control so I</font>

582
00:26:19,230 --> 00:26:22,710
just kind of wanted<font color="#CCCCCC"> to</font><font color="#E5E5E5"> talk to you guys</font>

583
00:26:20,430 --> 00:26:24,720
like<font color="#E5E5E5"> there's all like we're just talking</font>

584
00:26:22,710 --> 00:26:26,850
about<font color="#E5E5E5"> cloud kind of specific stuff in</font>

585
00:26:24,720 --> 00:26:29,100
this talk<font color="#CCCCCC"> and I'm mostly trying</font><font color="#E5E5E5"> to keep</font>

586
00:26:26,850 --> 00:26:31,260
it<font color="#E5E5E5"> focused on Azure right but there's</font>

587
00:26:29,100 --> 00:26:33,689
this whole<font color="#CCCCCC"> world of like pen testing and</font>

588
00:26:31,260 --> 00:26:35,700
red teaming that I'm kind of<font color="#CCCCCC"> completely</font>

589
00:26:33,690 --> 00:26:37,860
ignoring right which would<font color="#CCCCCC"> be you have a</font>

590
00:26:35,700 --> 00:26:39,570
nice ass like a VM sitting out there<font color="#E5E5E5"> on</font>

591
00:26:37,860 --> 00:26:41,429
<font color="#E5E5E5">the</font><font color="#CCCCCC"> Internet right if you can find some</font>

592
00:26:39,570 --> 00:26:44,899
type of<font color="#E5E5E5"> web application vulnerability</font>

593
00:26:41,430 --> 00:26:47,280
like an<font color="#E5E5E5"> X X</font><font color="#CCCCCC"> ee or or some other way</font><font color="#E5E5E5"> to</font>

594
00:26:44,900 --> 00:26:50,520
you know get privileged information

595
00:26:47,280 --> 00:26:52,770
maybe<font color="#E5E5E5"> you can SSH into that Isis server</font>

596
00:26:50,520 --> 00:26:54,389
right<font color="#E5E5E5"> or maybe you can find some type of</font>

597
00:26:52,770 --> 00:26:55,950
<font color="#E5E5E5">struts vulnerability and just get code</font>

598
00:26:54,390 --> 00:26:58,020
<font color="#CCCCCC">execution</font><font color="#E5E5E5"> straight through through that</font>

599
00:26:55,950 --> 00:27:00,180
app right and then when you're<font color="#CCCCCC"> on that</font>

600
00:26:58,020 --> 00:27:03,150
<font color="#E5E5E5">though that's cool you're inside like a</font>

601
00:27:00,180 --> 00:27:07,170
<font color="#E5E5E5">single VM right but that's not like</font>

602
00:27:03,150 --> 00:27:08,280
super useful<font color="#E5E5E5"> so I mean because maybe</font>

603
00:27:07,170 --> 00:27:10,170
that's<font color="#E5E5E5"> not really your intended target</font>

604
00:27:08,280 --> 00:27:12,090
<font color="#CCCCCC">right maybe your target is some super</font>

605
00:27:10,170 --> 00:27:13,440
<font color="#E5E5E5">secure server but then maybe they have</font>

606
00:27:12,090 --> 00:27:15,360
some test server<font color="#E5E5E5"> sitting next to it you</font>

607
00:27:13,440 --> 00:27:17,040
get<font color="#E5E5E5"> on the test server</font><font color="#CCCCCC"> right but if you</font>

608
00:27:15,360 --> 00:27:18,570
can<font color="#CCCCCC"> pivot back up into</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> control plane</font>

609
00:27:17,040 --> 00:27:19,770
then<font color="#E5E5E5"> you can probably use your access in</font>

610
00:27:18,570 --> 00:27:21,810
the control plane just to pivot<font color="#E5E5E5"> on the</font>

611
00:27:19,770 --> 00:27:26,540
target<font color="#CCCCCC"> that you want to be on so gently</font>

612
00:27:21,810 --> 00:27:29,070
<font color="#E5E5E5">so so if you get</font><font color="#CCCCCC"> access to an e/m</font><font color="#E5E5E5"> right</font>

613
00:27:26,540 --> 00:27:31,170
asher does have this metadata service

614
00:27:29,070 --> 00:27:34,320
that you can query<font color="#E5E5E5"> this is like really</font>

615
00:27:31,170 --> 00:27:36,420
<font color="#E5E5E5">useful in AWS land</font><font color="#CCCCCC"> it as your land not</font>

616
00:27:34,320 --> 00:27:38,250
<font color="#E5E5E5">so much right it doesn't return very</font>

617
00:27:36,420 --> 00:27:42,120
useful information it<font color="#E5E5E5"> doesn't usually</font>

618
00:27:38,250 --> 00:27:43,470
contain credentials<font color="#CCCCCC"> but</font><font color="#E5E5E5"> but there's that</font>

619
00:27:42,120 --> 00:27:46,409
agent<font color="#E5E5E5"> that we talked about that is</font>

620
00:27:43,470 --> 00:27:48,500
installed<font color="#E5E5E5"> on</font><font color="#CCCCCC"> the VMS and</font><font color="#E5E5E5"> it does store</font>

621
00:27:46,410 --> 00:27:55,290
configuration data under slash var slash

622
00:27:48,500 --> 00:27:58,119
slash W waging<font color="#E5E5E5"> W a agent right so cool</font>

623
00:27:55,290 --> 00:28:00,789
things is like when people test

624
00:27:58,119 --> 00:28:02,109
<font color="#CCCCCC">VMS four different extensions</font><font color="#E5E5E5"> like all</font>

625
00:28:00,789 --> 00:28:04,149
that data<font color="#E5E5E5"> gets logged under this</font>

626
00:28:02,109 --> 00:28:05,799
directory<font color="#CCCCCC"> so you can see what the admins</font>

627
00:28:04,149 --> 00:28:09,369
are doing right and potentially maybe

628
00:28:05,799 --> 00:28:12,279
the admins are even using the control

629
00:28:09,369 --> 00:28:14,799
<font color="#E5E5E5">pane to pass into the data playing the</font>

630
00:28:12,279 --> 00:28:16,419
<font color="#CCCCCC">VM</font><font color="#E5E5E5"> some like commands to run and maybe</font>

631
00:28:14,799 --> 00:28:18,789
<font color="#E5E5E5">those commands also contain more secrets</font>

632
00:28:16,419 --> 00:28:21,119
<font color="#CCCCCC">right so you want to look there</font><font color="#E5E5E5"> for that</font>

633
00:28:18,789 --> 00:28:23,589
there was<font color="#E5E5E5"> actually a vulnerability</font>

634
00:28:21,119 --> 00:28:25,749
reported to Microsoft which they fixed

635
00:28:23,589 --> 00:28:29,229
or if you enabled certain features in

636
00:28:25,749 --> 00:28:31,839
<font color="#CCCCCC">your Isis VM it actually also stored</font>

637
00:28:29,229 --> 00:28:34,419
credentials in here by default<font color="#CCCCCC"> right so</font>

638
00:28:31,839 --> 00:28:38,019
like<font color="#E5E5E5"> that was like an azure mistake</font>

639
00:28:34,419 --> 00:28:39,849
<font color="#E5E5E5">right but they've since 6at so anyways I</font>

640
00:28:38,019 --> 00:28:41,919
always go<font color="#E5E5E5"> to a directory troll through</font>

641
00:28:39,849 --> 00:28:46,859
the files try and find secrets<font color="#CCCCCC"> right so</font>

642
00:28:41,919 --> 00:28:49,119
that's<font color="#CCCCCC"> just like</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> God try that</font><font color="#E5E5E5"> right</font>

643
00:28:46,859 --> 00:28:51,399
<font color="#CCCCCC">and then I just want to show you the</font>

644
00:28:49,119 --> 00:28:53,228
<font color="#CCCCCC">reverse right if you can get a secret to</font>

645
00:28:51,399 --> 00:28:54,819
the control plane how<font color="#E5E5E5"> would you get</font><font color="#CCCCCC"> to</font>

646
00:28:53,229 --> 00:28:57,549
<font color="#E5E5E5">the data playing this is really just</font>

647
00:28:54,819 --> 00:28:59,199
<font color="#CCCCCC">evil system</font><font color="#E5E5E5"> administration right so I</font>

648
00:28:57,549 --> 00:29:01,599
mean you have<font color="#E5E5E5"> some access</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the control</font>

649
00:28:59,199 --> 00:29:03,729
plane like either via the<font color="#E5E5E5"> portal or via</font>

650
00:29:01,599 --> 00:29:05,198
if some API and now you're just<font color="#E5E5E5"> trying</font>

651
00:29:03,729 --> 00:29:09,429
<font color="#CCCCCC">to get into</font><font color="#E5E5E5"> the VM so you can get the</font>

652
00:29:05,199 --> 00:29:10,839
data or more<font color="#E5E5E5"> secrets right</font><font color="#CCCCCC"> they have</font>

653
00:29:09,429 --> 00:29:12,879
this slick feature and<font color="#CCCCCC"> azure</font>

654
00:29:10,839 --> 00:29:14,859
called capture image this is actually

655
00:29:12,879 --> 00:29:16,619
like yeah pretty slick<font color="#E5E5E5"> so you can</font>

656
00:29:14,859 --> 00:29:20,438
<font color="#E5E5E5">capture an image of a running our</font>

657
00:29:16,619 --> 00:29:22,059
depends on the<font color="#E5E5E5"> VM type and then you can</font>

658
00:29:20,439 --> 00:29:25,719
<font color="#E5E5E5">download that and kind</font><font color="#CCCCCC"> of do your VHD</font>

659
00:29:22,059 --> 00:29:27,369
analysis like<font color="#E5E5E5"> you would before</font><font color="#CCCCCC"> it's also</font>

660
00:29:25,719 --> 00:29:29,229
kind<font color="#CCCCCC"> of this technique</font><font color="#E5E5E5"> which is a</font>

661
00:29:27,369 --> 00:29:33,309
slightly<font color="#E5E5E5"> called more complex and</font><font color="#CCCCCC"> ashur</font>

662
00:29:29,229 --> 00:29:35,499
than it is<font color="#CCCCCC"> in AWS but where your I</font><font color="#E5E5E5"> don't</font>

663
00:29:33,309 --> 00:29:37,629
<font color="#E5E5E5">really recommend this but if you if you</font>

664
00:29:35,499 --> 00:29:39,819
power<font color="#E5E5E5"> off</font><font color="#CCCCCC"> of via</font><font color="#E5E5E5"> you can mount the hard</font>

665
00:29:37,629 --> 00:29:42,968
disk<font color="#E5E5E5"> and you can modify</font><font color="#CCCCCC"> it like</font>

666
00:29:39,819 --> 00:29:44,469
oftentimes<font color="#E5E5E5"> I'll just add a sh key right</font>

667
00:29:42,969 --> 00:29:45,969
because you can attend multiple SSH keys

668
00:29:44,469 --> 00:29:48,309
and<font color="#CCCCCC"> two if they're using</font><font color="#E5E5E5"> that to</font>

669
00:29:45,969 --> 00:29:50,019
authenticate to a<font color="#CCCCCC"> linux</font><font color="#E5E5E5"> server and then</font>

670
00:29:48,309 --> 00:29:51,428
<font color="#E5E5E5">you can boot back up the</font><font color="#CCCCCC"> VM but in Azure</font>

671
00:29:50,019 --> 00:29:53,049
<font color="#CCCCCC">land generally you have</font><font color="#E5E5E5"> to kind of</font>

672
00:29:51,429 --> 00:29:54,579
destroy a lot<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the configuration data</font>

673
00:29:53,049 --> 00:29:55,809
for that<font color="#E5E5E5"> VM so you need to make</font><font color="#CCCCCC"> sure you</font>

674
00:29:54,579 --> 00:29:58,359
know what<font color="#E5E5E5"> that all is and then you have</font>

675
00:29:55,809 --> 00:30:02,889
<font color="#CCCCCC">to go back and recreate that and AWS</font>

676
00:29:58,359 --> 00:30:04,359
it's it's more seamless<font color="#E5E5E5"> and then</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> sure</font>

677
00:30:02,889 --> 00:30:06,218
actually<font color="#E5E5E5"> provides features to reset</font>

678
00:30:04,359 --> 00:30:08,559
passwords<font color="#CCCCCC"> if you have the right rights</font>

679
00:30:06,219 --> 00:30:10,599
<font color="#E5E5E5">inside of the console so you could</font>

680
00:30:08,559 --> 00:30:11,928
technically use those I'll be it they

681
00:30:10,599 --> 00:30:13,970
may be<font color="#CCCCCC"> monitored by</font>

682
00:30:11,929 --> 00:30:22,999
<font color="#CCCCCC">a defensive</font><font color="#E5E5E5"> team so you know use caution</font>

683
00:30:13,970 --> 00:30:25,279
<font color="#CCCCCC">right there so</font><font color="#E5E5E5"> okay yeah and yeah you</font>

684
00:30:22,999 --> 00:30:27,139
<font color="#CCCCCC">could</font><font color="#E5E5E5"> actually load extensions which the</font>

685
00:30:25,279 --> 00:30:31,190
agent will load up<font color="#E5E5E5"> which will then let</font>

686
00:30:27,139 --> 00:30:32,570
<font color="#E5E5E5">you to execute</font><font color="#CCCCCC"> more commands so you can</font>

687
00:30:31,190 --> 00:30:34,429
also<font color="#E5E5E5"> use those to run custom scripts</font>

688
00:30:32,570 --> 00:30:36,649
<font color="#E5E5E5">like the command here will download a</font>

689
00:30:34,429 --> 00:30:38,480
script off github and then run it inside

690
00:30:36,649 --> 00:30:44,860
<font color="#E5E5E5">a VM so you can get more code execution</font>

691
00:30:38,480 --> 00:30:48,470
there so all right cool

692
00:30:44,860 --> 00:30:50,869
<font color="#E5E5E5">all right so persistence we found some</font>

693
00:30:48,470 --> 00:30:53,299
type of<font color="#E5E5E5"> secret we hacked a VM we have</font>

694
00:30:50,869 --> 00:30:57,049
some level<font color="#E5E5E5"> of access</font><font color="#CCCCCC"> but and</font><font color="#E5E5E5"> we want to</font>

695
00:30:53,299 --> 00:31:00,019
keep access for as long<font color="#CCCCCC"> as possible</font>

696
00:30:57,049 --> 00:31:01,730
<font color="#E5E5E5">right</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> we're like doing not</font><font color="#CCCCCC"> doing pen</font>

697
00:31:00,019 --> 00:31:04,009
testing now we're<font color="#E5E5E5"> doing more like red</font>

698
00:31:01,730 --> 00:31:06,740
teaming<font color="#CCCCCC"> long-term engagement</font><font color="#E5E5E5"> right we</font>

699
00:31:04,009 --> 00:31:10,970
want to stay<font color="#E5E5E5"> and or</font><font color="#CCCCCC"> Nations stay D right</font>

700
00:31:06,740 --> 00:31:14,600
so so let's say the attacker

701
00:31:10,970 --> 00:31:16,669
we found some credential and we we were

702
00:31:14,600 --> 00:31:19,129
<font color="#E5E5E5">able</font><font color="#CCCCCC"> to use</font><font color="#E5E5E5"> that to access the</font><font color="#CCCCCC"> blob</font>

703
00:31:16,669 --> 00:31:22,850
storage<font color="#E5E5E5"> right the first thing that</font><font color="#CCCCCC"> I</font>

704
00:31:19,129 --> 00:31:25,039
would<font color="#E5E5E5"> do is I would generate a SAS URL</font>

705
00:31:22,850 --> 00:31:27,408
<font color="#E5E5E5">right so if you just right-click inside</font>

706
00:31:25,039 --> 00:31:30,230
of this console and generate<font color="#E5E5E5"> an SAS URL</font>

707
00:31:27,409 --> 00:31:32,360
you can<font color="#CCCCCC"> actually use this</font><font color="#E5E5E5"> URL and you</font>

708
00:31:30,230 --> 00:31:33,710
can<font color="#E5E5E5"> say it never expires</font><font color="#CCCCCC"> right or you</font>

709
00:31:32,360 --> 00:31:37,008
can say expires in two years or whatever

710
00:31:33,710 --> 00:31:38,629
you want<font color="#E5E5E5"> and you</font><font color="#CCCCCC"> can use that URL</font><font color="#E5E5E5"> to</font>

711
00:31:37,009 --> 00:31:44,869
<font color="#E5E5E5">continue to reallocate</font><font color="#CCCCCC"> to the blob</font>

712
00:31:38,629 --> 00:31:46,730
storage right<font color="#E5E5E5"> and yeah you can you can</font>

713
00:31:44,869 --> 00:31:48,230
revoke these but<font color="#E5E5E5"> you have to</font><font color="#CCCCCC"> rotate your</font>

714
00:31:46,730 --> 00:31:50,360
access token<font color="#CCCCCC"> which</font><font color="#E5E5E5"> is kind of like</font>

715
00:31:48,230 --> 00:31:52,940
<font color="#E5E5E5">higher up the</font><font color="#CCCCCC"> chain and generally</font>

716
00:31:50,360 --> 00:31:54,740
speaking orgs are<font color="#CCCCCC"> there they're really</font>

717
00:31:52,940 --> 00:32:01,789
<font color="#CCCCCC">good at rotating those or more likely</font>

718
00:31:54,740 --> 00:32:03,799
<font color="#E5E5E5">really horrible at</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> right</font><font color="#CCCCCC"> and then if</font>

719
00:32:01,789 --> 00:32:05,840
you're able<font color="#E5E5E5"> to get access where you can</font>

720
00:32:03,799 --> 00:32:08,059
<font color="#E5E5E5">modify any type</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> service principle</font>

721
00:32:05,840 --> 00:32:10,720
<font color="#CCCCCC">which is kind of</font><font color="#E5E5E5"> like a really high</font>

722
00:32:08,059 --> 00:32:12,619
level<font color="#E5E5E5"> as your type account</font><font color="#CCCCCC"> right so that</font>

723
00:32:10,720 --> 00:32:14,929
you can actually assign<font color="#E5E5E5"> multiple</font>

724
00:32:12,619 --> 00:32:18,350
passwords to the same<font color="#E5E5E5"> service</font><font color="#CCCCCC"> principle</font>

725
00:32:14,929 --> 00:32:20,029
account<font color="#CCCCCC"> right so which it is technically</font>

726
00:32:18,350 --> 00:32:22,668
viewable to<font color="#E5E5E5"> the user if you go into the</font>

727
00:32:20,029 --> 00:32:25,100
UI<font color="#E5E5E5"> but it's like pretty nested down</font>

728
00:32:22,669 --> 00:32:25,520
there right<font color="#CCCCCC"> so but</font><font color="#E5E5E5"> you're gonna keep it</font>

729
00:32:25,100 --> 00:32:27,290
pending

730
00:32:25,520 --> 00:32:32,210
passwords are keys to<font color="#CCCCCC"> that same service</font>

731
00:32:27,290 --> 00:32:34,010
<font color="#CCCCCC">principle account some yeah so their</font>

732
00:32:32,210 --> 00:32:35,510
<font color="#CCCCCC">passwords still works fine</font><font color="#E5E5E5"> now you have</font>

733
00:32:34,010 --> 00:32:39,620
like<font color="#CCCCCC"> a skeleton key password which also</font>

734
00:32:35,510 --> 00:32:41,990
works<font color="#E5E5E5"> with the account so so it is</font>

735
00:32:39,620 --> 00:32:47,290
<font color="#E5E5E5">visible in the console but it's pretty</font>

736
00:32:41,990 --> 00:32:47,290
nested generally never gets detected<font color="#E5E5E5"> so</font>

737
00:32:48,820 --> 00:32:59,360
<font color="#CCCCCC">alright</font><font color="#E5E5E5"> see</font><font color="#CCCCCC"> okay sounds</font><font color="#E5E5E5"> good</font><font color="#CCCCCC"> alright so</font>

738
00:32:57,320 --> 00:33:00,919
I I kind of I<font color="#E5E5E5"> just wanted to dig a</font>

739
00:32:59,360 --> 00:33:03,379
little bit deeper<font color="#E5E5E5"> all that stuff that</font>

740
00:33:00,920 --> 00:33:05,180
<font color="#E5E5E5">you've seen now</font><font color="#CCCCCC"> it may not really be</font>

741
00:33:03,380 --> 00:33:07,280
common<font color="#E5E5E5"> knowledge but it's pretty</font>

742
00:33:05,180 --> 00:33:09,890
<font color="#CCCCCC">straightforward it's been out there and</font>

743
00:33:07,280 --> 00:33:12,080
<font color="#E5E5E5">in the space and I</font><font color="#CCCCCC"> just kind of wanted</font>

744
00:33:09,890 --> 00:33:14,900
<font color="#CCCCCC">to dig a little deeper and try and show</font>

745
00:33:12,080 --> 00:33:16,760
you<font color="#CCCCCC"> guys something that probably</font><font color="#E5E5E5"> a</font>

746
00:33:14,900 --> 00:33:17,630
<font color="#E5E5E5">little crazy like probably really</font>

747
00:33:16,760 --> 00:33:22,910
shouldn't use<font color="#CCCCCC"> it</font><font color="#E5E5E5"> on a red team</font>

748
00:33:17,630 --> 00:33:25,040
engagement<font color="#E5E5E5"> but it does work</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> the the</font>

749
00:33:22,910 --> 00:33:28,400
agent<font color="#E5E5E5"> that you have installed by default</font>

750
00:33:25,040 --> 00:33:32,120
on<font color="#E5E5E5"> most of these</font><font color="#CCCCCC"> Ice SVM's</font><font color="#E5E5E5"> right well</font>

751
00:33:28,400 --> 00:33:34,250
how it operates is<font color="#CCCCCC"> that it pulls from an</font>

752
00:33:32,120 --> 00:33:36,649
<font color="#CCCCCC">API from the control plane for taskings</font>

753
00:33:34,250 --> 00:33:39,440
right<font color="#E5E5E5"> so periodically it makes this</font>

754
00:33:36,650 --> 00:33:41,180
query so say<font color="#E5E5E5"> control planes yet is there</font>

755
00:33:39,440 --> 00:33:43,210
anything you want<font color="#CCCCCC"> me to do it says no</font>

756
00:33:41,180 --> 00:33:47,110
and<font color="#E5E5E5"> then doesn't</font><font color="#CCCCCC"> do anything right</font><font color="#E5E5E5"> or</font>

757
00:33:43,210 --> 00:33:50,750
just some type of<font color="#CCCCCC"> dog</font><font color="#E5E5E5"> some type of</font>

758
00:33:47,110 --> 00:33:53,719
<font color="#E5E5E5">process and I kind of wanted to show you</font>

759
00:33:50,750 --> 00:33:56,600
some of<font color="#CCCCCC"> the tools</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> techniques I</font><font color="#E5E5E5"> used</font>

760
00:33:53,720 --> 00:33:59,480
<font color="#E5E5E5">to do this investigation</font><font color="#CCCCCC"> so like more</font>

761
00:33:56,600 --> 00:34:01,399
<font color="#CCCCCC">like a teaching you how to fish rather</font>

762
00:33:59,480 --> 00:34:05,840
than a like you know<font color="#E5E5E5"> giving you the fish</font>

763
00:34:01,400 --> 00:34:07,970
type scenario<font color="#E5E5E5"> right so so</font><font color="#CCCCCC"> I've some of</font>

764
00:34:05,840 --> 00:34:09,799
<font color="#E5E5E5">this little basic I apologize I</font><font color="#CCCCCC"> just</font>

765
00:34:07,970 --> 00:34:14,330
want to<font color="#E5E5E5"> kind of make</font><font color="#CCCCCC"> sure all on the</font>

766
00:34:09,800 --> 00:34:15,890
same page<font color="#E5E5E5"> right so and you could</font><font color="#CCCCCC"> go read</font>

767
00:34:14,330 --> 00:34:19,668
documentation<font color="#E5E5E5"> about how the agent works</font>

768
00:34:15,889 --> 00:34:22,790
I'll be<font color="#E5E5E5"> it's pretty loose</font><font color="#CCCCCC"> but you could</font>

769
00:34:19,668 --> 00:34:24,589
also review the source code<font color="#E5E5E5"> right so so</font>

770
00:34:22,790 --> 00:34:28,219
<font color="#E5E5E5">anyway so you're on a box and</font><font color="#CCCCCC"> you find a</font>

771
00:34:24,590 --> 00:34:30,919
<font color="#E5E5E5">new process you just run</font><font color="#CCCCCC"> like PS aux</font><font color="#E5E5E5"> fww</font>

772
00:34:28,219 --> 00:34:32,629
<font color="#CCCCCC">that's a or dub dub that's what I run</font>

773
00:34:30,918 --> 00:34:34,819
right so<font color="#E5E5E5"> because it kind of gives you a</font>

774
00:34:32,630 --> 00:34:37,250
<font color="#E5E5E5">process tree on most</font><font color="#CCCCCC"> most targets of</font>

775
00:34:34,820 --> 00:34:39,260
what process was spawned<font color="#E5E5E5"> by what other</font>

776
00:34:37,250 --> 00:34:39,710
process<font color="#E5E5E5"> right so</font><font color="#CCCCCC"> we can see in the</font>

777
00:34:39,260 --> 00:34:44,060
<font color="#E5E5E5">process</font>

778
00:34:39,710 --> 00:34:45,980
<font color="#CCCCCC">three that there's this waa agent</font>

779
00:34:44,060 --> 00:34:48,020
process<font color="#E5E5E5"> right and</font><font color="#CCCCCC"> then we could also see</font>

780
00:34:45,980 --> 00:34:50,839
<font color="#CCCCCC">that it's a demon because it has a tack</font>

781
00:34:48,020 --> 00:34:57,050
demon argument<font color="#E5E5E5"> and</font><font color="#CCCCCC"> that it's a</font><font color="#E5E5E5"> Python</font>

782
00:34:50,839 --> 00:34:59,119
process<font color="#CCCCCC"> right so</font><font color="#E5E5E5"> so we can you know use</font>

783
00:34:57,050 --> 00:35:02,060
the<font color="#CCCCCC"> file command</font><font color="#E5E5E5"> to type up find out</font>

784
00:34:59,119 --> 00:35:03,950
what type of file this<font color="#E5E5E5"> binary is and it</font>

785
00:35:02,060 --> 00:35:05,960
lets us know<font color="#E5E5E5"> it's not an elf</font><font color="#CCCCCC"> binary</font><font color="#E5E5E5"> it's</font>

786
00:35:03,950 --> 00:35:08,149
<font color="#E5E5E5">just a Python script so we could go in</font>

787
00:35:05,960 --> 00:35:09,980
and do source code review<font color="#CCCCCC"> I would hire</font>

788
00:35:08,150 --> 00:35:11,000
if you<font color="#E5E5E5"> guys are really interested</font><font color="#CCCCCC"> I</font>

789
00:35:09,980 --> 00:35:12,710
<font color="#CCCCCC">would definitely go look at the source</font>

790
00:35:11,000 --> 00:35:15,770
code there's some pretty interesting

791
00:35:12,710 --> 00:35:19,070
<font color="#E5E5E5">stuff</font><font color="#CCCCCC"> so which I'm not</font><font color="#E5E5E5"> gonna talk</font><font color="#CCCCCC"> about</font>

792
00:35:15,770 --> 00:35:21,050
but<font color="#CCCCCC"> the I will show you some cool stuff</font>

793
00:35:19,070 --> 00:35:26,210
<font color="#CCCCCC">so the and then</font><font color="#E5E5E5"> you know on the</font><font color="#CCCCCC"> box you</font>

794
00:35:21,050 --> 00:35:29,900
<font color="#E5E5E5">can you can also do net stat tech NL</font><font color="#CCCCCC"> TPU</font>

795
00:35:26,210 --> 00:35:31,790
<font color="#E5E5E5">to see what's listening and and ATP you</font>

796
00:35:29,900 --> 00:35:34,190
to see what's active<font color="#E5E5E5"> connections in the</font>

797
00:35:31,790 --> 00:35:35,900
<font color="#E5E5E5">box so so we start digging we see this</font>

798
00:35:34,190 --> 00:35:37,790
unknown service that we want<font color="#CCCCCC"> to</font><font color="#E5E5E5"> know</font>

799
00:35:35,900 --> 00:35:40,490
more<font color="#CCCCCC"> about what</font><font color="#E5E5E5"> the service does on the</font>

800
00:35:37,790 --> 00:35:43,279
<font color="#CCCCCC">Linux target so we know</font><font color="#E5E5E5"> it's</font>

801
00:35:40,490 --> 00:35:48,169
python-based<font color="#CCCCCC"> right so</font><font color="#E5E5E5"> I don't know if</font>

802
00:35:43,280 --> 00:35:50,930
you guys are<font color="#CCCCCC"> aware but</font><font color="#E5E5E5"> python has a</font>

803
00:35:48,170 --> 00:35:53,930
debugger<font color="#E5E5E5"> built into it and it's kind of</font>

804
00:35:50,930 --> 00:35:58,520
it's pretty<font color="#E5E5E5"> slick right so if you do</font>

805
00:35:53,930 --> 00:36:00,290
like<font color="#CCCCCC"> attack em and then the</font><font color="#E5E5E5"> PDB you can</font>

806
00:35:58,520 --> 00:36:02,390
load<font color="#CCCCCC"> up the debugging</font><font color="#E5E5E5"> module and you</font><font color="#CCCCCC"> can</font>

807
00:36:00,290 --> 00:36:08,109
<font color="#E5E5E5">step through the Python script</font><font color="#CCCCCC"> right</font>

808
00:36:02,390 --> 00:36:11,089
<font color="#E5E5E5">because like if you look at the</font><font color="#CCCCCC"> waa</font>

809
00:36:08,109 --> 00:36:12,710
agent code<font color="#CCCCCC"> the script it has a lot of</font>

810
00:36:11,089 --> 00:36:15,170
<font color="#E5E5E5">different functions</font><font color="#CCCCCC"> right but they don't</font>

811
00:36:12,710 --> 00:36:17,510
execute<font color="#CCCCCC"> unless certain conditions are</font>

812
00:36:15,170 --> 00:36:20,000
true inside of the<font color="#CCCCCC"> ISS the VM</font>

813
00:36:17,510 --> 00:36:21,020
<font color="#CCCCCC">environment</font><font color="#E5E5E5"> right so you might be</font>

814
00:36:20,000 --> 00:36:22,250
confused when<font color="#E5E5E5"> you're</font><font color="#CCCCCC"> looking at the</font>

815
00:36:21,020 --> 00:36:24,080
script<font color="#E5E5E5"> because you see a particular</font>

816
00:36:22,250 --> 00:36:25,490
section has a vulnerability or<font color="#E5E5E5"> something</font>

817
00:36:24,080 --> 00:36:26,839
<font color="#E5E5E5">really interesting</font><font color="#CCCCCC"> you're trying to</font>

818
00:36:25,490 --> 00:36:31,669
figure<font color="#CCCCCC"> how to jump to</font><font color="#E5E5E5"> it so you can use</font>

819
00:36:26,839 --> 00:36:33,020
<font color="#E5E5E5">the Python debugger to kind of get</font><font color="#CCCCCC"> ya to</font>

820
00:36:31,670 --> 00:36:36,859
figure out what how the code is<font color="#E5E5E5"> working</font>

821
00:36:33,020 --> 00:36:39,080
<font color="#E5E5E5">right</font><font color="#CCCCCC"> and step through it the</font><font color="#E5E5E5"> there's</font>

822
00:36:36,859 --> 00:36:41,390
another project called<font color="#CCCCCC"> PI right</font><font color="#E5E5E5"> which is</font>

823
00:36:39,080 --> 00:36:43,940
really cool<font color="#E5E5E5"> but you do have to install</font>

824
00:36:41,390 --> 00:36:45,560
some dependencies on the box nothing

825
00:36:43,940 --> 00:36:47,240
<font color="#E5E5E5">crazy but like you have</font><font color="#CCCCCC"> to have gdb</font>

826
00:36:45,560 --> 00:36:49,549
working and a couple other things but

827
00:36:47,240 --> 00:36:52,879
<font color="#CCCCCC">pyrites</font><font color="#E5E5E5"> cool because you know the</font><font color="#CCCCCC"> Python</font>

828
00:36:49,550 --> 00:36:53,570
debugger<font color="#CCCCCC"> you start the</font><font color="#E5E5E5"> process and then</font>

829
00:36:52,880 --> 00:36:55,460
<font color="#CCCCCC">you step</font><font color="#E5E5E5"> through</font>

830
00:36:53,570 --> 00:36:57,980
kind<font color="#E5E5E5"> of line by line</font><font color="#CCCCCC"> right but pyrite</font>

831
00:36:55,460 --> 00:37:00,640
will actually inject your debugger<font color="#E5E5E5"> into</font>

832
00:36:57,980 --> 00:37:03,860
an already<font color="#E5E5E5"> existing running process so</font>

833
00:37:00,640 --> 00:37:06,080
<font color="#E5E5E5">so if you really want to get hardcore</font>

834
00:37:03,860 --> 00:37:08,300
into debugging<font color="#E5E5E5"> Python processes pyrite</font>

835
00:37:06,080 --> 00:37:10,460
is like definitely<font color="#E5E5E5"> the way to go but</font><font color="#CCCCCC"> um</font>

836
00:37:08,300 --> 00:37:15,830
<font color="#E5E5E5">but this is this is good for most use</font>

837
00:37:10,460 --> 00:37:18,230
case<font color="#E5E5E5"> so and then I really like this tool</font>

838
00:37:15,830 --> 00:37:22,279
called cystic<font color="#E5E5E5"> I feel like not enough</font>

839
00:37:18,230 --> 00:37:24,800
people<font color="#E5E5E5"> know</font><font color="#CCCCCC"> about it slash use it you</font>

840
00:37:22,280 --> 00:37:27,590
know<font color="#E5E5E5"> on Windows everyone when they want</font>

841
00:37:24,800 --> 00:37:29,510
to investigate<font color="#CCCCCC"> Windows processes do you</font>

842
00:37:27,590 --> 00:37:30,740
have<font color="#CCCCCC"> the sysinternals</font><font color="#E5E5E5"> tool suite which I</font>

843
00:37:29,510 --> 00:37:33,500
think a lot<font color="#CCCCCC"> of people are acquainted</font>

844
00:37:30,740 --> 00:37:34,640
<font color="#E5E5E5">with and they use you know</font><font color="#CCCCCC"> pokémon or</font>

845
00:37:33,500 --> 00:37:36,770
something like<font color="#E5E5E5"> that and they'll get a</font>

846
00:37:34,640 --> 00:37:38,900
full like they'll run the<font color="#E5E5E5"> startup</font><font color="#CCCCCC"> Pro</font>

847
00:37:36,770 --> 00:37:41,090
<font color="#E5E5E5">c'mon they'll run</font><font color="#CCCCCC"> the binary they'll</font>

848
00:37:38,900 --> 00:37:43,400
figure out<font color="#E5E5E5"> everything that</font><font color="#CCCCCC"> the process</font>

849
00:37:41,090 --> 00:37:44,870
does<font color="#CCCCCC"> every registry key</font><font color="#E5E5E5"> it touches every</font>

850
00:37:43,400 --> 00:37:46,130
file it makes every network connection

851
00:37:44,870 --> 00:37:46,819
it makes and they'll get<font color="#CCCCCC"> a log of that</font>

852
00:37:46,130 --> 00:37:49,310
<font color="#E5E5E5">right</font>

853
00:37:46,820 --> 00:37:52,340
<font color="#E5E5E5">cystic is like that exact same thing but</font>

854
00:37:49,310 --> 00:37:55,040
over on<font color="#E5E5E5"> the Linux side right and it's</font>

855
00:37:52,340 --> 00:37:58,520
free<font color="#CCCCCC"> to use so and you can usually just</font>

856
00:37:55,040 --> 00:38:00,830
<font color="#E5E5E5">app get it right I'll be it no yeah you</font>

857
00:37:58,520 --> 00:38:02,990
just<font color="#E5E5E5"> have to get it so or use your</font>

858
00:38:00,830 --> 00:38:04,790
package manager install it but basically

859
00:38:02,990 --> 00:38:06,259
<font color="#E5E5E5">you create these capture file this is</font>

860
00:38:04,790 --> 00:38:08,930
the<font color="#CCCCCC"> way I use it</font><font color="#E5E5E5"> right like I create a</font>

861
00:38:06,260 --> 00:38:11,540
capture<font color="#E5E5E5"> file I start a capture file I</font>

862
00:38:08,930 --> 00:38:13,339
start up the process<font color="#CCCCCC"> I keep one of them</font>

863
00:38:11,540 --> 00:38:16,430
done doing whatever I'm doing inside<font color="#E5E5E5"> the</font>

864
00:38:13,340 --> 00:38:19,190
process<font color="#E5E5E5"> you know control</font><font color="#CCCCCC"> see and then</font>

865
00:38:16,430 --> 00:38:20,690
I'll read the capture file using taxi

866
00:38:19,190 --> 00:38:22,790
means<font color="#CCCCCC"> Carver so that's kind of like a</font>

867
00:38:20,690 --> 00:38:25,490
specific<font color="#E5E5E5"> code that's trying to carve</font>

868
00:38:22,790 --> 00:38:26,450
data out of<font color="#CCCCCC"> it</font><font color="#E5E5E5"> like you can use one</font>

869
00:38:25,490 --> 00:38:27,830
Carver to see all the network

870
00:38:26,450 --> 00:38:28,850
connections you<font color="#E5E5E5"> can use another Carver</font>

871
00:38:27,830 --> 00:38:29,830
to see you all the files<font color="#E5E5E5"> that were</font>

872
00:38:28,850 --> 00:38:32,960
written to<font color="#E5E5E5"> disk</font>

873
00:38:29,830 --> 00:38:34,640
<font color="#E5E5E5">and so you can start to build out</font><font color="#CCCCCC"> that</font>

874
00:38:32,960 --> 00:38:35,390
<font color="#CCCCCC">timeline</font><font color="#E5E5E5"> of everything this process is</font>

875
00:38:34,640 --> 00:38:37,279
<font color="#E5E5E5">doing</font><font color="#CCCCCC"> lebackes</font>

876
00:38:35,390 --> 00:38:39,230
you know potentially you<font color="#E5E5E5"> could even use</font>

877
00:38:37,280 --> 00:38:41,720
<font color="#E5E5E5">this</font><font color="#CCCCCC"> for like</font><font color="#E5E5E5"> malware analysis type</font>

878
00:38:39,230 --> 00:38:44,840
purposes<font color="#E5E5E5"> right if you're trying to do</font>

879
00:38:41,720 --> 00:38:48,770
<font color="#CCCCCC">analysis</font><font color="#E5E5E5"> of like a</font><font color="#CCCCCC"> Linux</font><font color="#E5E5E5"> base power</font>

880
00:38:44,840 --> 00:38:53,840
<font color="#E5E5E5">right so I don't know how</font><font color="#CCCCCC"> things pretty</font>

881
00:38:48,770 --> 00:38:56,150
slick so so we<font color="#E5E5E5"> use</font><font color="#CCCCCC"> Cystic on the proc</font><font color="#E5E5E5"> we</font>

882
00:38:53,840 --> 00:38:59,300
see that the proc is storing a lot<font color="#CCCCCC"> of</font>

883
00:38:56,150 --> 00:39:00,770
<font color="#E5E5E5">data in /var lib waa agent which we</font>

884
00:38:59,300 --> 00:39:04,720
<font color="#CCCCCC">already talked about</font><font color="#E5E5E5"> as far</font><font color="#CCCCCC"> as like a</font>

885
00:39:00,770 --> 00:39:06,920
place to<font color="#CCCCCC"> look for credentials</font><font color="#E5E5E5"> and then</font>

886
00:39:04,720 --> 00:39:07,640
we also<font color="#E5E5E5"> noticed it makes certain</font><font color="#CCCCCC"> network</font>

887
00:39:06,920 --> 00:39:10,609
connect

888
00:39:07,640 --> 00:39:11,808
right so we start<font color="#E5E5E5"> up TCP dump</font><font color="#CCCCCC"> and we</font>

889
00:39:10,609 --> 00:39:14,900
just start capturing the network

890
00:39:11,809 --> 00:39:18,969
connections<font color="#CCCCCC"> so so the</font><font color="#E5E5E5"> way</font><font color="#CCCCCC"> that the agent</font>

891
00:39:14,900 --> 00:39:21,469
works is basically<font color="#E5E5E5"> inside of Asher's</font>

892
00:39:18,969 --> 00:39:23,329
control plane they basically have as

893
00:39:21,469 --> 00:39:26,059
<font color="#E5E5E5">part of the</font><font color="#CCCCCC"> fabric for Azure which is</font>

894
00:39:23,329 --> 00:39:27,380
kind<font color="#E5E5E5"> of their term for the parts of</font>

895
00:39:26,059 --> 00:39:29,900
azure that are outside<font color="#E5E5E5"> the</font><font color="#CCCCCC"> scope</font><font color="#E5E5E5"> of the</font>

896
00:39:27,380 --> 00:39:31,909
customer<font color="#E5E5E5"> right so they basically have</font>

897
00:39:29,900 --> 00:39:33,679
this magic IP<font color="#E5E5E5"> right and so when you talk</font>

898
00:39:31,909 --> 00:39:36,650
to<font color="#CCCCCC"> this IP you can talk to this API and</font>

899
00:39:33,679 --> 00:39:39,499
<font color="#CCCCCC">that's kind of an API specific for that</font>

900
00:39:36,650 --> 00:39:42,589
<font color="#CCCCCC">for</font><font color="#E5E5E5"> VMs</font><font color="#CCCCCC"> to talk to the control plane</font>

901
00:39:39,499 --> 00:39:44,538
right so we just<font color="#CCCCCC"> can fill if we do a</font>

902
00:39:42,589 --> 00:39:48,949
packet capture<font color="#CCCCCC"> we pull that back off the</font>

903
00:39:44,539 --> 00:39:51,679
box and then<font color="#E5E5E5"> we load up</font><font color="#CCCCCC"> T speed why</font>

904
00:39:48,949 --> 00:39:54,049
don't put TCP<font color="#CCCCCC"> to Wireshark</font><font color="#E5E5E5"> right then we</font>

905
00:39:51,679 --> 00:39:56,509
can<font color="#E5E5E5"> use this filter just to look at</font>

906
00:39:54,049 --> 00:40:04,640
things<font color="#E5E5E5"> talking to the control plane to</font>

907
00:39:56,509 --> 00:40:06,829
that specific API<font color="#E5E5E5"> okay so we see there's</font>

908
00:40:04,640 --> 00:40:09,049
the agent<font color="#CCCCCC"> and when it starts up it</font>

909
00:40:06,829 --> 00:40:11,209
starts<font color="#CCCCCC"> talking to this address</font><font color="#E5E5E5"> and the</font>

910
00:40:09,049 --> 00:40:12,949
control plane<font color="#E5E5E5"> that's a magic address</font>

911
00:40:11,209 --> 00:40:14,178
<font color="#E5E5E5">don't get confused it's not like it's</font>

912
00:40:12,949 --> 00:40:18,109
something routable on the Internet

913
00:40:14,179 --> 00:40:19,909
right<font color="#E5E5E5"> it's something</font><font color="#CCCCCC"> that kind of</font><font color="#E5E5E5"> gets</font>

914
00:40:18,109 --> 00:40:24,199
translated inside of those<font color="#CCCCCC"> asher's</font>

915
00:40:19,909 --> 00:40:25,849
environment so so let's just talk<font color="#CCCCCC"> about</font>

916
00:40:24,199 --> 00:40:27,259
<font color="#E5E5E5">how this works</font><font color="#CCCCCC"> so we we started looking</font>

917
00:40:25,849 --> 00:40:30,140
<font color="#E5E5E5">at the packet capture a little bit more</font>

918
00:40:27,259 --> 00:40:33,709
<font color="#E5E5E5">right</font><font color="#CCCCCC"> hey so we see we</font><font color="#E5E5E5"> get a</font><font color="#CCCCCC"> lot of</font>

919
00:40:30,140 --> 00:40:36,589
<font color="#E5E5E5">these get requests for goal</font><font color="#CCCCCC"> state right</font>

920
00:40:33,709 --> 00:40:38,239
and that's just it pulling<font color="#E5E5E5"> to see if</font>

921
00:40:36,589 --> 00:40:39,589
there's<font color="#E5E5E5"> a tasking right like is there</font>

922
00:40:38,239 --> 00:40:43,039
something<font color="#CCCCCC"> that the</font><font color="#E5E5E5"> data plane wants me</font>

923
00:40:39,589 --> 00:40:44,989
to do yes or<font color="#E5E5E5"> no right</font><font color="#CCCCCC"> and for</font><font color="#E5E5E5"> the most</font>

924
00:40:43,039 --> 00:40:46,849
<font color="#CCCCCC">part it just</font><font color="#E5E5E5"> returns back with a</font>

925
00:40:44,989 --> 00:40:53,449
response<font color="#E5E5E5"> which basically means do</font>

926
00:40:46,849 --> 00:40:55,849
nothing<font color="#E5E5E5"> right so but</font><font color="#CCCCCC"> whoo-hoo but when</font>

927
00:40:53,449 --> 00:40:59,599
we issued that<font color="#E5E5E5"> command by a PowerShell</font>

928
00:40:55,849 --> 00:41:00,739
<font color="#E5E5E5">to execute a script on a VM we got a</font>

929
00:40:59,599 --> 00:41:04,099
<font color="#E5E5E5">different response we got this</font>

930
00:41:00,739 --> 00:41:06,979
incarnation<font color="#E5E5E5"> equals to basically inside</font>

931
00:41:04,099 --> 00:41:11,179
of X inside<font color="#E5E5E5"> of an X if now soap</font><font color="#CCCCCC"> request</font>

932
00:41:06,979 --> 00:41:12,828
response<font color="#E5E5E5"> right so so that kind of</font>

933
00:41:11,179 --> 00:41:15,589
signaled that the agent<font color="#E5E5E5"> needs</font><font color="#CCCCCC"> to take a</font>

934
00:41:12,829 --> 00:41:16,400
different<font color="#E5E5E5"> go down a different path of</font>

935
00:41:15,589 --> 00:41:19,130
code right

936
00:41:16,400 --> 00:41:20,430
and so the<font color="#CCCCCC"> aja at once it gets</font><font color="#E5E5E5"> that</font>

937
00:41:19,130 --> 00:41:22,860
response it

938
00:41:20,430 --> 00:41:24,839
comes back<font color="#E5E5E5"> it pulls some</font><font color="#CCCCCC"> host config</font>

939
00:41:22,860 --> 00:41:27,350
data right using this get<font color="#E5E5E5"> request and</font>

940
00:41:24,840 --> 00:41:30,120
then it also pulls some certificates

941
00:41:27,350 --> 00:41:32,220
<font color="#E5E5E5">albeit these these are kind of like</font>

942
00:41:30,120 --> 00:41:32,640
public certs they're not as far as<font color="#CCCCCC"> I can</font>

943
00:41:32,220 --> 00:41:34,560
tell

944
00:41:32,640 --> 00:41:37,890
<font color="#CCCCCC">useful</font><font color="#E5E5E5"> from like an offensive standpoint</font>

945
00:41:34,560 --> 00:41:40,580
<font color="#E5E5E5">so so there's mostly to verify packages</font>

946
00:41:37,890 --> 00:41:45,270
they're going to come down<font color="#E5E5E5"> so and then</font>

947
00:41:40,580 --> 00:41:47,100
it will actually get the<font color="#CCCCCC"> config for</font><font color="#E5E5E5"> the</font>

948
00:41:45,270 --> 00:41:48,300
extension<font color="#CCCCCC"> that it wants to run</font><font color="#E5E5E5"> so these</font>

949
00:41:47,100 --> 00:41:53,250
are the commands that<font color="#E5E5E5"> it's going</font><font color="#CCCCCC"> to run</font>

950
00:41:48,300 --> 00:41:56,160
<font color="#E5E5E5">basically right so so and that's kind of</font>

951
00:41:53,250 --> 00:42:00,480
<font color="#E5E5E5">the fourth part of the request right yep</font>

952
00:41:56,160 --> 00:42:05,339
<font color="#E5E5E5">okay so so kind of putting that all</font>

953
00:42:00,480 --> 00:42:07,380
together<font color="#E5E5E5"> the journey right so imagine</font>

954
00:42:05,340 --> 00:42:08,970
your<font color="#CCCCCC"> task you're part of a red team</font>

955
00:42:07,380 --> 00:42:11,100
<font color="#CCCCCC">you're supposed to look at</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> SAS</font>

956
00:42:08,970 --> 00:42:14,850
environment you do a bunch<font color="#CCCCCC"> of O's in it</font>

957
00:42:11,100 --> 00:42:17,520
<font color="#E5E5E5">and you find creds in a repo right so</font>

958
00:42:14,850 --> 00:42:20,549
that's<font color="#E5E5E5"> honestly more common than it</font>

959
00:42:17,520 --> 00:42:23,160
should be<font color="#E5E5E5"> right so so but the goal</font><font color="#CCCCCC"> is to</font>

960
00:42:20,550 --> 00:42:25,860
<font color="#CCCCCC">get</font><font color="#E5E5E5"> to this VM that's like has the red</font>

961
00:42:23,160 --> 00:42:27,390
tiny red box<font color="#CCCCCC"> around it</font><font color="#E5E5E5"> right it's not</font>

962
00:42:25,860 --> 00:42:29,370
accessible by the internet<font color="#E5E5E5"> but you know</font>

963
00:42:27,390 --> 00:42:34,350
it's<font color="#E5E5E5"> inside one of their Azure accounts</font>

964
00:42:29,370 --> 00:42:37,680
<font color="#E5E5E5">right so so then we can</font><font color="#CCCCCC"> use the credit</font>

965
00:42:34,350 --> 00:42:39,630
in the repo to access storage<font color="#E5E5E5"> pull back</font>

966
00:42:37,680 --> 00:42:41,810
hard<font color="#CCCCCC"> disks</font><font color="#E5E5E5"> and then find additional</font>

967
00:42:39,630 --> 00:42:44,280
certificates or stored inside

968
00:42:41,810 --> 00:42:47,279
configuration files inside<font color="#E5E5E5"> the VHDs</font>

969
00:42:44,280 --> 00:42:49,290
right<font color="#E5E5E5"> so and using those certificates we</font>

970
00:42:47,280 --> 00:42:54,600
use those<font color="#E5E5E5"> to access this description via</font>

971
00:42:49,290 --> 00:42:56,550
the<font color="#E5E5E5"> control plane</font><font color="#CCCCCC"> so and then we can</font>

972
00:42:54,600 --> 00:43:00,029
execute custom scripts on our<font color="#E5E5E5"> intended</font>

973
00:42:56,550 --> 00:43:01,500
target<font color="#E5E5E5"> right so via the extensions so so</font>

974
00:43:00,030 --> 00:43:05,670
you can<font color="#CCCCCC"> see</font><font color="#E5E5E5"> it's kind of a multi-step</font>

975
00:43:01,500 --> 00:43:07,020
thing<font color="#E5E5E5"> but have you guys ever been part</font>

976
00:43:05,670 --> 00:43:08,670
of<font color="#E5E5E5"> how many you raise the hands have</font>

977
00:43:07,020 --> 00:43:12,360
been<font color="#E5E5E5"> a part of like a pen test before</font><font color="#CCCCCC"> I</font>

978
00:43:08,670 --> 00:43:15,930
<font color="#CCCCCC">don't work</font><font color="#E5E5E5"> right like some of you okay</font>

979
00:43:12,360 --> 00:43:18,660
all<font color="#E5E5E5"> right okay</font><font color="#CCCCCC"> so do from my experience</font>

980
00:43:15,930 --> 00:43:21,210
do<font color="#CCCCCC"> you pen test</font><font color="#E5E5E5"> generally stay secret a</font>

981
00:43:18,660 --> 00:43:23,910
<font color="#CCCCCC">torx</font><font color="#E5E5E5"> or does eventually everyone find</font>

982
00:43:21,210 --> 00:43:27,120
out the pen test is<font color="#E5E5E5"> going on right so</font>

983
00:43:23,910 --> 00:43:29,879
the<font color="#E5E5E5"> from my experience a lot of times</font>

984
00:43:27,120 --> 00:43:32,339
everybody<font color="#E5E5E5"> finds out right so and they</font>

985
00:43:29,880 --> 00:43:34,050
find out what the goal is<font color="#E5E5E5"> right so let's</font>

986
00:43:32,340 --> 00:43:36,030
<font color="#CCCCCC">just take the assumption that</font>

987
00:43:34,050 --> 00:43:38,700
the defenders<font color="#E5E5E5"> know you're coming for</font>

988
00:43:36,030 --> 00:43:39,900
<font color="#E5E5E5">this a box</font><font color="#CCCCCC"> right they know that you want</font>

989
00:43:38,700 --> 00:43:41,819
to<font color="#E5E5E5"> get on the box so they've taken</font>

990
00:43:39,900 --> 00:43:45,320
additional<font color="#E5E5E5"> precautions on this</font>

991
00:43:41,820 --> 00:43:50,100
particular<font color="#E5E5E5"> target</font><font color="#CCCCCC"> to to</font><font color="#E5E5E5"> fortify it right</font>

992
00:43:45,320 --> 00:43:52,650
so so they're doing file integrity

993
00:43:50,100 --> 00:43:55,620
monitoring on the<font color="#E5E5E5"> box</font><font color="#CCCCCC"> so if you can't</font>

994
00:43:52,650 --> 00:43:57,300
really<font color="#E5E5E5"> modify any core files without it</font>

995
00:43:55,620 --> 00:43:59,430
being detected and you<font color="#CCCCCC"> know</font><font color="#E5E5E5"> you'd be</font>

996
00:43:57,300 --> 00:44:03,090
busted<font color="#E5E5E5"> and being shamed to death</font><font color="#CCCCCC"> right</font>

997
00:43:59,430 --> 00:44:04,620
so<font color="#CCCCCC"> and then let's say they've got os</font>

998
00:44:03,090 --> 00:44:05,820
query kind of running on the box and

999
00:44:04,620 --> 00:44:07,380
it's monitoring all the running

1000
00:44:05,820 --> 00:44:09,060
processes<font color="#E5E5E5"> so you don't want to start up</font>

1001
00:44:07,380 --> 00:44:11,220
a<font color="#CCCCCC"> new process on the</font><font color="#E5E5E5"> box that</font><font color="#CCCCCC"> would</font><font color="#E5E5E5"> be</font>

1002
00:44:09,060 --> 00:44:12,840
unexpected<font color="#E5E5E5"> right because then you know</font>

1003
00:44:11,220 --> 00:44:16,009
<font color="#E5E5E5">they're gonna</font><font color="#CCCCCC"> find that</font><font color="#E5E5E5"> see it's your</font>

1004
00:44:12,840 --> 00:44:18,180
<font color="#E5E5E5">malware and then get caught right on</font>

1005
00:44:16,010 --> 00:44:19,590
<font color="#CCCCCC">they're also</font><font color="#E5E5E5"> watching your net stack</font>

1006
00:44:18,180 --> 00:44:21,720
<font color="#E5E5E5">connections so you don't really want to</font>

1007
00:44:19,590 --> 00:44:23,490
make a connection<font color="#E5E5E5"> back to your back to</font>

1008
00:44:21,720 --> 00:44:24,899
you on the<font color="#CCCCCC"> Internet right because maybe</font>

1009
00:44:23,490 --> 00:44:26,549
you're<font color="#E5E5E5"> not coming</font><font color="#CCCCCC"> from a normal source</font>

1010
00:44:24,900 --> 00:44:28,320
<font color="#E5E5E5">maybe the server doesn't really even</font>

1011
00:44:26,550 --> 00:44:33,840
ever supposed<font color="#CCCCCC"> to talk</font><font color="#E5E5E5"> to the</font><font color="#CCCCCC"> Internet</font>

1012
00:44:28,320 --> 00:44:36,540
<font color="#E5E5E5">right so so</font><font color="#CCCCCC"> so how would you practically</font>

1013
00:44:33,840 --> 00:44:39,120
do this<font color="#CCCCCC"> alright are you</font><font color="#E5E5E5"> guys mostly on</font>

1014
00:44:36,540 --> 00:44:40,770
the defense side<font color="#CCCCCC"> raising hands</font><font color="#E5E5E5"> I see a</font>

1015
00:44:39,120 --> 00:44:42,000
lot of nods<font color="#CCCCCC"> okay all right</font><font color="#E5E5E5"> so let's talk</font>

1016
00:44:40,770 --> 00:44:43,890
more<font color="#CCCCCC"> about the</font><font color="#E5E5E5"> practical how you would</font>

1017
00:44:42,000 --> 00:44:45,600
<font color="#E5E5E5">implement this right</font><font color="#CCCCCC"> so one thing that</font>

1018
00:44:43,890 --> 00:44:48,359
I've seen on Linux side that's pretty

1019
00:44:45,600 --> 00:44:51,390
sweet<font color="#E5E5E5"> is a double stack right and it's</font>

1020
00:44:48,360 --> 00:44:53,040
open<font color="#CCCCCC"> source so double stacked at i/o</font><font color="#E5E5E5"> so</font>

1021
00:44:51,390 --> 00:44:55,230
it actually<font color="#E5E5E5"> will do all these features</font>

1022
00:44:53,040 --> 00:44:56,730
<font color="#CCCCCC">for you right here so specifically when</font>

1023
00:44:55,230 --> 00:44:58,530
I'm talking about bypassing I'm talking

1024
00:44:56,730 --> 00:45:00,630
about bypassing<font color="#E5E5E5"> like a fully implemented</font>

1025
00:44:58,530 --> 00:45:01,950
<font color="#CCCCCC">Hubbell stack implementation and how</font>

1026
00:45:00,630 --> 00:45:05,130
many of you raise the hands have heard

1027
00:45:01,950 --> 00:45:08,399
of salt before<font color="#CCCCCC"> or salt</font><font color="#E5E5E5"> sac yeah so all</font>

1028
00:45:05,130 --> 00:45:09,840
Hubbell stack is is like extension to

1029
00:45:08,400 --> 00:45:11,490
solve<font color="#E5E5E5"> so if you already have</font><font color="#CCCCCC"> your</font><font color="#E5E5E5"> salt</font>

1030
00:45:09,840 --> 00:45:13,500
minions deployed<font color="#E5E5E5"> then you implement</font>

1031
00:45:11,490 --> 00:45:15,299
<font color="#CCCCCC">Hubble on top of that and it uses that</font>

1032
00:45:13,500 --> 00:45:16,830
salt infrastructure to kind<font color="#E5E5E5"> of do all</font>

1033
00:45:15,300 --> 00:45:18,960
<font color="#E5E5E5">these security functions on your targets</font>

1034
00:45:16,830 --> 00:45:20,759
so and it's kind of designed<font color="#CCCCCC"> from the</font>

1035
00:45:18,960 --> 00:45:23,660
ground up<font color="#CCCCCC"> to send data</font><font color="#E5E5E5"> back to like a</font>

1036
00:45:20,760 --> 00:45:26,940
<font color="#CCCCCC">Splunk or</font><font color="#E5E5E5"> elk type infrastructure so</font>

1037
00:45:23,660 --> 00:45:28,049
<font color="#E5E5E5">that I mean this is</font><font color="#CCCCCC"> gonna be</font><font color="#E5E5E5"> a side side</font>

1038
00:45:26,940 --> 00:45:31,710
<font color="#CCCCCC">rant for</font><font color="#E5E5E5"> a second</font>

1039
00:45:28,050 --> 00:45:33,840
so as a red teamer right like oftentimes

1040
00:45:31,710 --> 00:45:35,460
<font color="#CCCCCC">I get to the target that I'm going</font><font color="#E5E5E5"> to if</font>

1041
00:45:33,840 --> 00:45:37,950
I'm<font color="#CCCCCC"> persistent enough and I have enough</font>

1042
00:45:35,460 --> 00:45:39,750
time<font color="#E5E5E5"> right but one thing that is truly</font>

1043
00:45:37,950 --> 00:45:41,700
scary if if the goal<font color="#CCCCCC"> is to stay in the</font>

1044
00:45:39,750 --> 00:45:43,770
<font color="#E5E5E5">network for</font><font color="#CCCCCC"> a long period of time</font><font color="#E5E5E5"> is</font>

1045
00:45:41,700 --> 00:45:45,419
when you have systems like<font color="#E5E5E5"> this and</font>

1046
00:45:43,770 --> 00:45:47,910
they're sending data off to<font color="#CCCCCC"> Splunk or</font>

1047
00:45:45,420 --> 00:45:50,520
<font color="#E5E5E5">elk</font><font color="#CCCCCC"> there's a large amount of</font>

1048
00:45:47,910 --> 00:45:51,839
telemetry data about like processes and

1049
00:45:50,520 --> 00:45:54,720
network<font color="#E5E5E5"> connections which are</font><font color="#CCCCCC"> being</font>

1050
00:45:51,839 --> 00:45:56,490
logged<font color="#CCCCCC"> right</font><font color="#E5E5E5"> if eventually anybody makes</font>

1051
00:45:54,720 --> 00:45:59,520
a mistake<font color="#E5E5E5"> or the blue team eventually</font>

1052
00:45:56,490 --> 00:46:02,189
<font color="#E5E5E5">gets lucky</font><font color="#CCCCCC"> and they find you on a box</font>

1053
00:45:59,520 --> 00:46:04,288
<font color="#E5E5E5">they can kind of make a profile of what</font>

1054
00:46:02,190 --> 00:46:06,510
<font color="#E5E5E5">your TTP's look like and they</font><font color="#CCCCCC"> can use</font>

1055
00:46:04,289 --> 00:46:08,130
<font color="#CCCCCC">that</font><font color="#E5E5E5"> telemetry data to kind</font><font color="#CCCCCC"> of map back</font>

1056
00:46:06,510 --> 00:46:12,480
everything<font color="#CCCCCC"> you did over the last year</font>

1057
00:46:08,130 --> 00:46:14,309
<font color="#E5E5E5">right so so from my standpoint</font><font color="#CCCCCC"> you know</font>

1058
00:46:12,480 --> 00:46:17,460
scary we're kind of in this recorded

1059
00:46:14,309 --> 00:46:19,440
<font color="#E5E5E5">future type status we're in highly</font>

1060
00:46:17,460 --> 00:46:20,789
monitored environments<font color="#CCCCCC"> you know it's not</font>

1061
00:46:19,440 --> 00:46:24,000
just did I get<font color="#CCCCCC"> caught today</font>

1062
00:46:20,789 --> 00:46:25,799
it's did I do<font color="#E5E5E5"> something last month which</font>

1063
00:46:24,000 --> 00:46:27,930
is<font color="#E5E5E5"> also going to be linked together with</font>

1064
00:46:25,799 --> 00:46:33,960
what I do today and is that important in

1065
00:46:27,930 --> 00:46:35,940
<font color="#CCCCCC">the context of what I'm getting by</font>

1066
00:46:33,960 --> 00:46:37,470
telemetry<font color="#E5E5E5"> and endpoint agents like red</font>

1067
00:46:35,940 --> 00:46:39,359
<font color="#CCCCCC">teams and nation-states they're gonna</font>

1068
00:46:37,470 --> 00:46:41,730
have<font color="#E5E5E5"> to severely like up their games</font>

1069
00:46:39,359 --> 00:46:45,839
<font color="#CCCCCC">right</font><font color="#E5E5E5"> so especially</font><font color="#CCCCCC"> if they</font><font color="#E5E5E5"> don't want</font>

1070
00:46:41,730 --> 00:46:51,569
to be attributed<font color="#E5E5E5"> so</font><font color="#CCCCCC"> all right so come</font>

1071
00:46:45,839 --> 00:46:53,910
<font color="#E5E5E5">back to this talk</font><font color="#CCCCCC"> as you're so trying</font><font color="#E5E5E5"> to</font>

1072
00:46:51,569 --> 00:46:55,619
bypass<font color="#E5E5E5"> all these type features if you</font>

1073
00:46:53,910 --> 00:47:00,480
<font color="#E5E5E5">want these features check out Hubble</font>

1074
00:46:55,619 --> 00:47:02,069
stack<font color="#E5E5E5"> public stock to i/o so okay</font><font color="#CCCCCC"> so but</font>

1075
00:47:00,480 --> 00:47:04,950
it kind of<font color="#E5E5E5"> dawned on me sometimes I have</font>

1076
00:47:02,069 --> 00:47:08,940
these<font color="#E5E5E5"> like crazy ideas and oftentimes</font>

1077
00:47:04,950 --> 00:47:10,649
<font color="#E5E5E5">they work out which is even scarier</font><font color="#CCCCCC"> so I</font>

1078
00:47:08,940 --> 00:47:12,750
was like I don't<font color="#E5E5E5"> need to go install</font>

1079
00:47:10,650 --> 00:47:14,420
software<font color="#E5E5E5"> on this box this box already</font>

1080
00:47:12,750 --> 00:47:18,210
has an agent that's looking for updates

1081
00:47:14,420 --> 00:47:23,549
<font color="#CCCCCC">like let's</font><font color="#E5E5E5"> just give it updates right so</font>

1082
00:47:18,210 --> 00:47:25,410
so so I use the<font color="#CCCCCC"> credentials to</font><font color="#E5E5E5"> make my</font>

1083
00:47:23,549 --> 00:47:27,630
<font color="#E5E5E5">own kind of beachhead inside of the</font>

1084
00:47:25,410 --> 00:47:30,210
<font color="#E5E5E5">target Network right so cutting in the</font>

1085
00:47:27,630 --> 00:47:31,680
same logical<font color="#CCCCCC"> network segment</font><font color="#E5E5E5"> you know</font>

1086
00:47:30,210 --> 00:47:34,319
this is an<font color="#E5E5E5"> environment where there's a</font>

1087
00:47:31,680 --> 00:47:35,640
lot<font color="#E5E5E5"> of VM so spinning one more up didn't</font>

1088
00:47:34,319 --> 00:47:37,619
really<font color="#E5E5E5"> matter you don't have to do that</font>

1089
00:47:35,640 --> 00:47:39,328
to execute this<font color="#E5E5E5"> but it's kind</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> what I</font>

1090
00:47:37,619 --> 00:47:41,789
did<font color="#E5E5E5"> here</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> then I put</font><font color="#CCCCCC"> my mouth on that</font>

1091
00:47:39,329 --> 00:47:44,160
<font color="#E5E5E5">box just in case I lost</font><font color="#CCCCCC"> access to</font><font color="#E5E5E5"> the</font>

1092
00:47:41,789 --> 00:47:46,440
control plane or the subscription for

1093
00:47:44,160 --> 00:47:53,460
<font color="#E5E5E5">the persistence methods I just one add</font>

1094
00:47:46,440 --> 00:47:55,140
another foothold<font color="#E5E5E5"> right so so okay cool</font>

1095
00:47:53,460 --> 00:47:56,430
<font color="#CCCCCC">so that's kind of our setup there</font><font color="#E5E5E5"> so we</font>

1096
00:47:55,140 --> 00:47:58,259
have this beachhead it's really common

1097
00:47:56,430 --> 00:47:59,308
for attackers to<font color="#E5E5E5"> do this generally for a</font>

1098
00:47:58,260 --> 00:48:01,890
beachhead you're looking for something

1099
00:47:59,309 --> 00:48:02,940
<font color="#E5E5E5">that's</font><font color="#CCCCCC"> like a basically</font><font color="#E5E5E5"> no value right</font>

1100
00:48:01,890 --> 00:48:04,140
as an attacker you<font color="#E5E5E5"> don't really care</font>

1101
00:48:02,940 --> 00:48:07,710
about<font color="#E5E5E5"> it other than</font><font color="#CCCCCC"> it's a pivot in the</font>

1102
00:48:04,140 --> 00:48:08,910
network and<font color="#E5E5E5"> and you generally you like</font>

1103
00:48:07,710 --> 00:48:11,220
to find ones that<font color="#CCCCCC"> are</font><font color="#E5E5E5"> poorly monitored</font>

1104
00:48:08,910 --> 00:48:13,170
or<font color="#E5E5E5"> poorly managed</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> because then you</font>

1105
00:48:11,220 --> 00:48:14,490
can<font color="#E5E5E5"> be more liberal with</font><font color="#CCCCCC"> what you do on</font>

1106
00:48:13,170 --> 00:48:15,840
<font color="#CCCCCC">it and not worry about getting caught</font>

1107
00:48:14,490 --> 00:48:17,609
<font color="#E5E5E5">right so in this instance would be</font>

1108
00:48:15,840 --> 00:48:19,470
<font color="#E5E5E5">something that doesn't</font><font color="#CCCCCC"> have like Hubble</font>

1109
00:48:17,610 --> 00:48:23,880
<font color="#E5E5E5">on a or all those monitoring tools right</font>

1110
00:48:19,470 --> 00:48:25,319
<font color="#E5E5E5">so and then what you can do is we</font>

1111
00:48:23,880 --> 00:48:27,180
remember we can execute commands<font color="#E5E5E5"> on</font><font color="#CCCCCC"> the</font>

1112
00:48:25,320 --> 00:48:29,880
target<font color="#E5E5E5"> right by having it run these</font>

1113
00:48:27,180 --> 00:48:30,839
custom scripts<font color="#E5E5E5"> so we have it executes</font>

1114
00:48:29,880 --> 00:48:32,820
and<font color="#E5E5E5"> iptables</font>

1115
00:48:30,840 --> 00:48:36,480
<font color="#CCCCCC">role on the target right and the</font>

1116
00:48:32,820 --> 00:48:39,570
iptables rule<font color="#CCCCCC"> what it does it says hey</font>

1117
00:48:36,480 --> 00:48:42,750
on<font color="#E5E5E5"> your outbound</font><font color="#CCCCCC"> table</font><font color="#E5E5E5"> anytime you go to</font>

1118
00:48:39,570 --> 00:48:44,790
connect to this magic as your fabric IP

1119
00:48:42,750 --> 00:48:46,710
<font color="#E5E5E5">don't connect there that's not where you</font>

1120
00:48:44,790 --> 00:48:48,420
<font color="#CCCCCC">actually want to go right</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> want to</font>

1121
00:48:46,710 --> 00:48:50,040
come on over<font color="#CCCCCC"> to my server my beachhead</font>

1122
00:48:48,420 --> 00:48:52,380
server<font color="#E5E5E5"> right to get to get your</font>

1123
00:48:50,040 --> 00:48:55,380
communications instead<font color="#E5E5E5"> right so that's</font>

1124
00:48:52,380 --> 00:48:57,120
<font color="#E5E5E5">what that that IP tables</font><font color="#CCCCCC"> role does</font><font color="#E5E5E5"> there</font>

1125
00:48:55,380 --> 00:48:59,760
now the really cool<font color="#CCCCCC"> part about this</font><font color="#E5E5E5"> is</font>

1126
00:48:57,120 --> 00:49:03,600
when you<font color="#CCCCCC"> look at the net stat is you</font>

1127
00:48:59,760 --> 00:49:05,640
still see the the 168 address<font color="#E5E5E5"> right it</font>

1128
00:49:03,600 --> 00:49:08,370
doesn't like the IP table happens after

1129
00:49:05,640 --> 00:49:10,589
the net set so<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> def blends</font><font color="#E5E5E5"> in and</font>

1130
00:49:08,370 --> 00:49:12,359
then it's<font color="#E5E5E5"> not a process</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> mean if</font>

1131
00:49:10,590 --> 00:49:14,730
they're monitoring your IP table rules

1132
00:49:12,360 --> 00:49:16,110
then you would get<font color="#CCCCCC"> caught but if they're</font>

1133
00:49:14,730 --> 00:49:17,790
<font color="#E5E5E5">monitoring processes and network</font>

1134
00:49:16,110 --> 00:49:22,500
connections<font color="#CCCCCC"> this</font><font color="#E5E5E5"> will fly under the</font>

1135
00:49:17,790 --> 00:49:26,430
radar<font color="#CCCCCC"> right</font><font color="#E5E5E5"> so so and then on our</font>

1136
00:49:22,500 --> 00:49:28,110
beachhead<font color="#CCCCCC"> I just forget</font><font color="#E5E5E5"> I just for</font>

1137
00:49:26,430 --> 00:49:30,390
<font color="#CCCCCC">example sake I</font><font color="#E5E5E5"> use man and middle proxy</font>

1138
00:49:28,110 --> 00:49:31,980
on it right and I implemented<font color="#E5E5E5"> this other</font>

1139
00:49:30,390 --> 00:49:35,100
outbound rule that<font color="#E5E5E5"> just basically says</font>

1140
00:49:31,980 --> 00:49:37,470
<font color="#E5E5E5">men in the middle so target sends data</font>

1141
00:49:35,100 --> 00:49:40,259
<font color="#E5E5E5">the to that box that data box sends it</font>

1142
00:49:37,470 --> 00:49:42,390
to<font color="#CCCCCC"> the man in</font><font color="#E5E5E5"> the middle plus man in the</font>

1143
00:49:40,260 --> 00:49:44,190
middle proxy process and then when it

1144
00:49:42,390 --> 00:49:45,540
<font color="#E5E5E5">sends the data out another IP tables</font>

1145
00:49:44,190 --> 00:49:46,680
rule says you<font color="#CCCCCC"> don't</font><font color="#E5E5E5"> want to send</font><font color="#CCCCCC"> that</font>

1146
00:49:45,540 --> 00:49:49,200
out<font color="#CCCCCC"> to the internet you want to send</font>

1147
00:49:46,680 --> 00:49:52,319
<font color="#CCCCCC">that</font><font color="#E5E5E5"> back</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the to the control plane</font>

1148
00:49:49,200 --> 00:49:54,419
right so so that's<font color="#E5E5E5"> kind of what that</font>

1149
00:49:52,320 --> 00:49:58,410
redirection rule does there<font color="#E5E5E5"> on that on</font>

1150
00:49:54,420 --> 00:50:00,720
<font color="#CCCCCC">our beachhead so and then what we do is</font>

1151
00:49:58,410 --> 00:50:02,100
<font color="#CCCCCC">we go use our access into the console we</font>

1152
00:50:00,720 --> 00:50:03,299
say hey we<font color="#CCCCCC"> want to</font><font color="#E5E5E5"> run this custom</font>

1153
00:50:02,100 --> 00:50:05,730
script on the beachhead

1154
00:50:03,300 --> 00:50:08,010
and when that flow comes down through

1155
00:50:05,730 --> 00:50:10,920
<font color="#E5E5E5">that data control through the control</font>

1156
00:50:08,010 --> 00:50:12,420
plane to the data plane<font color="#E5E5E5"> that actually</font>

1157
00:50:10,920 --> 00:50:14,070
<font color="#CCCCCC">vai manah in the</font><font color="#E5E5E5"> old proxy gets passed</font>

1158
00:50:12,420 --> 00:50:15,360
into<font color="#E5E5E5"> our target and then our target</font>

1159
00:50:14,070 --> 00:50:18,060
<font color="#CCCCCC">executes that intent</font>

1160
00:50:15,360 --> 00:50:19,770
<font color="#CCCCCC">come and write</font><font color="#E5E5E5"> and I just wrote a file</font>

1161
00:50:18,060 --> 00:50:26,190
out<font color="#E5E5E5"> to slash temp for this trivial</font>

1162
00:50:19,770 --> 00:50:27,990
example but<font color="#CCCCCC"> mitigation so I'm horrible</font>

1163
00:50:26,190 --> 00:50:29,280
at mitigation so I brought<font color="#E5E5E5"> another</font>

1164
00:50:27,990 --> 00:50:31,620
person in for the<font color="#E5E5E5"> training that's gonna</font>

1165
00:50:29,280 --> 00:50:33,690
go over<font color="#CCCCCC"> that so sorry I know most of you</font>

1166
00:50:31,620 --> 00:50:36,509
<font color="#CCCCCC">blue team guys but the big thing I take</font>

1167
00:50:33,690 --> 00:50:39,120
aways here is like logging logging

1168
00:50:36,510 --> 00:50:41,310
logging<font color="#E5E5E5"> right so I mean from</font><font color="#CCCCCC"> my</font>

1169
00:50:39,120 --> 00:50:43,049
standpoint if<font color="#CCCCCC"> you if you</font><font color="#E5E5E5"> don't log it</font>

1170
00:50:41,310 --> 00:50:45,509
like it's gonna be really hard to<font color="#E5E5E5"> catch</font>

1171
00:50:43,050 --> 00:50:48,920
it and not<font color="#E5E5E5"> today maybe you won't catch</font>

1172
00:50:45,510 --> 00:50:51,480
<font color="#E5E5E5">you today but maybe tomorrow</font><font color="#CCCCCC"> right so</font>

1173
00:50:48,920 --> 00:50:54,090
there's ways<font color="#E5E5E5"> to enable verbose logging</font>

1174
00:50:51,480 --> 00:50:56,760
in both AWS and<font color="#E5E5E5"> Azure and usually those</font>

1175
00:50:54,090 --> 00:50:59,280
get stored to blob storage<font color="#E5E5E5"> so make sure</font>

1176
00:50:56,760 --> 00:51:00,360
<font color="#E5E5E5">wherever you're storing that a lot of</font>

1177
00:50:59,280 --> 00:51:03,840
times I recommend<font color="#E5E5E5"> that's a completely</font>

1178
00:51:00,360 --> 00:51:05,220
<font color="#E5E5E5">different AWS or Azure account but you</font>

1179
00:51:03,840 --> 00:51:07,050
know just make sure that's secure<font color="#CCCCCC"> right</font>

1180
00:51:05,220 --> 00:51:12,149
you don't want someone to<font color="#E5E5E5"> go modify</font><font color="#CCCCCC"> your</font>

1181
00:51:07,050 --> 00:51:13,740
logs<font color="#CCCCCC"> and limit</font><font color="#E5E5E5"> access especially the</font>

1182
00:51:12,150 --> 00:51:15,030
pipeline stuff like no<font color="#E5E5E5"> reason anyone</font>

1183
00:51:13,740 --> 00:51:16,560
needs<font color="#CCCCCC"> to get</font><font color="#E5E5E5"> to your</font><font color="#CCCCCC"> jenkins except for</font>

1184
00:51:15,030 --> 00:51:20,520
like<font color="#E5E5E5"> your trusted off and that's never</font>

1185
00:51:16,560 --> 00:51:22,710
works things<font color="#E5E5E5"> like that right so</font><font color="#CCCCCC"> oh and</font>

1186
00:51:20,520 --> 00:51:26,610
encrypt secrets right<font color="#E5E5E5"> like I don't know</font>

1187
00:51:22,710 --> 00:51:29,040
<font color="#E5E5E5">I don't understand why but like</font>

1188
00:51:26,610 --> 00:51:31,620
<font color="#CCCCCC">oftentimes often see code bases where</font>

1189
00:51:29,040 --> 00:51:33,390
parts<font color="#CCCCCC"> of it have the secrets encrypted</font>

1190
00:51:31,620 --> 00:51:35,370
and<font color="#E5E5E5"> then other parts just they're</font><font color="#CCCCCC"> just</font>

1191
00:51:33,390 --> 00:51:39,210
plain<font color="#CCCCCC"> text still</font><font color="#E5E5E5"> so fully rolling that</font>

1192
00:51:35,370 --> 00:51:43,080
out is pretty vital<font color="#E5E5E5"> right so that's</font>

1193
00:51:39,210 --> 00:51:45,180
<font color="#E5E5E5">pretty common still</font><font color="#CCCCCC"> alright thanks for</font>

1194
00:51:43,080 --> 00:51:47,460
<font color="#CCCCCC">coming out I'm Bryce</font><font color="#E5E5E5"> I'm gonna post the</font>

1195
00:51:45,180 --> 00:51:50,009
slides<font color="#E5E5E5"> using my</font><font color="#CCCCCC"> twitter tweet</font><font color="#E5E5E5"> fox so</font>

1196
00:51:47,460 --> 00:51:52,980
from the slides I'll post them<font color="#E5E5E5"> up if you</font>

1197
00:51:50,010 --> 00:51:56,040
need anything I'm just<font color="#CCCCCC"> hit me up</font><font color="#E5E5E5"> on</font>

1198
00:51:52,980 --> 00:51:58,910
Twitter I'm happy to help<font color="#E5E5E5"> and thanks for</font>

1199
00:51:56,040 --> 00:51:58,910
<font color="#E5E5E5">coming out appreciate it</font>

