1
00:00:02,179 --> 00:00:06,298
okay well we're<font color="#E5E5E5"> going to go ahead and</font>

2
00:00:03,959 --> 00:00:08,010
get started<font color="#E5E5E5"> I hear me ok we get the mic</font>

3
00:00:06,299 --> 00:00:10,050
issue without so my name is Casey Smith

4
00:00:08,010 --> 00:00:12,090
smack Nelson so we're going<font color="#E5E5E5"> to be</font>

5
00:00:10,050 --> 00:00:14,849
talking about Windows operating system

6
00:00:12,090 --> 00:00:16,590
archaeology we are going to be<font color="#E5E5E5"> talking</font>

7
00:00:14,849 --> 00:00:19,680
about<font color="#E5E5E5"> the component object model today</font>

8
00:00:16,590 --> 00:00:21,900
and calm which has been around<font color="#E5E5E5"> in with</font>

9
00:00:19,680 --> 00:00:22,980
those for a very long time so we're

10
00:00:21,900 --> 00:00:24,599
going to take a<font color="#E5E5E5"> look at it from an</font>

11
00:00:22,980 --> 00:00:26,160
offensive perspective and deep into

12
00:00:24,600 --> 00:00:28,710
perspective so we found a lot<font color="#E5E5E5"> of ways to</font>

13
00:00:26,160 --> 00:00:30,359
abuse calm functionality these aren't

14
00:00:28,710 --> 00:00:33,989
exploits these are things that are built

15
00:00:30,359 --> 00:00:36,989
into the wacom is instrumented so just

16
00:00:33,989 --> 00:00:38,640
briefly about myself you can exactly on

17
00:00:36,989 --> 00:00:40,919
twitter<font color="#CCCCCC"> apps FBI recently joined the</font>

18
00:00:38,640 --> 00:00:43,800
<font color="#CCCCCC">mandiant red team i have a blog post</font>

19
00:00:40,920 --> 00:00:45,030
there's<font color="#CCCCCC"> the</font><font color="#E5E5E5"> URL so feel free to connect</font>

20
00:00:43,800 --> 00:00:46,349
<font color="#CCCCCC">with me on twitter if</font><font color="#E5E5E5"> you have questions</font>

21
00:00:45,030 --> 00:00:48,629
or will be around for<font color="#E5E5E5"> those will begin</font>

22
00:00:46,350 --> 00:00:50,280
in the after party so things<font color="#CCCCCC"> i really</font>

23
00:00:48,629 --> 00:00:52,800
<font color="#CCCCCC">enjoyed researching or like whitelisting</font>

24
00:00:50,280 --> 00:00:55,860
bypasses were interesting ways to get

25
00:00:52,800 --> 00:00:59,069
things to execute so yeah and then I'm

26
00:00:55,860 --> 00:01:02,879
not<font color="#E5E5E5"> Nelson so</font><font color="#CCCCCC"> to handle I may operate ER</font>

27
00:00:59,070 --> 00:01:04,979
and security researcher /<font color="#E5E5E5"> Specter off my</font>

28
00:01:02,879 --> 00:01:07,289
blog I don't have nearly as awesome of

29
00:01:04,979 --> 00:01:09,720
the background<font color="#E5E5E5"> is Casey does I used to</font>

30
00:01:07,290 --> 00:01:13,229
<font color="#E5E5E5">be a sysadmin</font><font color="#CCCCCC"> pause</font><font color="#E5E5E5"> in college and I</font>

31
00:01:09,720 --> 00:01:17,400
graduated and it came for<font color="#E5E5E5"> security as a</font>

32
00:01:13,229 --> 00:01:19,740
component though nothing crazy<font color="#CCCCCC"> okay so</font>

33
00:01:17,400 --> 00:01:21,600
so what we hope to cut away with her

34
00:01:19,740 --> 00:01:23,429
objectives with this off really we

35
00:01:21,600 --> 00:01:26,309
wanted<font color="#CCCCCC"> you to</font><font color="#E5E5E5"> start looking</font><font color="#CCCCCC"> at</font><font color="#E5E5E5"> calm the</font>

36
00:01:23,430 --> 00:01:28,380
way we<font color="#E5E5E5"> D like we really have maybe an</font>

37
00:01:26,310 --> 00:01:30,869
unhealthy obsession with weird calm

38
00:01:28,380 --> 00:01:32,670
objects but we think it's imported from

39
00:01:30,869 --> 00:01:33,750
like an operator for as a red team

40
00:01:32,670 --> 00:01:34,920
because these are things you could use

41
00:01:33,750 --> 00:01:36,360
that are built in native to the

42
00:01:34,920 --> 00:01:38,490
operating system and so we wanted to

43
00:01:36,360 --> 00:01:40,280
like foster the curiosity and get other

44
00:01:38,490 --> 00:01:42,360
people researching this along with<font color="#E5E5E5"> us</font>

45
00:01:40,280 --> 00:01:43,890
the other thing we wanted to do<font color="#CCCCCC"> is</font>

46
00:01:42,360 --> 00:01:45,119
provide several references so there's a

47
00:01:43,890 --> 00:01:47,399
lot<font color="#CCCCCC"> of documents in here we're</font><font color="#E5E5E5"> going to</font>

48
00:01:45,119 --> 00:01:49,710
post some of our code snippets and the

49
00:01:47,399 --> 00:01:51,060
slides after the talk today so we wanted

50
00:01:49,710 --> 00:01:52,710
to get<font color="#E5E5E5"> this sort along the records you</font>

51
00:01:51,060 --> 00:01:54,509
guys up resource to come back keep your

52
00:01:52,710 --> 00:01:55,559
calm and then call intention to<font color="#E5E5E5"> the</font>

53
00:01:54,509 --> 00:01:57,149
attack so there's still<font color="#CCCCCC"> a lot of</font>

54
00:01:55,560 --> 00:01:59,969
interesting way you'll<font color="#CCCCCC"> see when we get</font>

55
00:01:57,149 --> 00:02:01,829
into malicious calm tactics that you can

56
00:01:59,969 --> 00:02:05,610
execute code on<font color="#E5E5E5"> a system or remote</font>

57
00:02:01,829 --> 00:02:07,529
system so<font color="#CCCCCC"> all right first</font><font color="#E5E5E5"> we're going to</font>

58
00:02:05,610 --> 00:02:08,669
talk about overview so to set the

59
00:02:07,530 --> 00:02:10,470
grounds that everybody needs to

60
00:02:08,669 --> 00:02:11,038
understand what it is<font color="#CCCCCC"> rebuilt using</font>

61
00:02:10,470 --> 00:02:12,390
<font color="#CCCCCC">history</font>

62
00:02:11,038 --> 00:02:15,268
we'll<font color="#E5E5E5"> talk about our research</font>

63
00:02:12,390 --> 00:02:16,768
methodology so how do we<font color="#CCCCCC"> go about poking</font>

64
00:02:15,269 --> 00:02:18,450
around and looking at things inside of

65
00:02:16,769 --> 00:02:20,459
comp to learn so we really want<font color="#E5E5E5"> to teach</font>

66
00:02:18,450 --> 00:02:22,950
you<font color="#CCCCCC"> how to do that</font><font color="#E5E5E5"> and then also the</font>

67
00:02:20,459 --> 00:02:25,829
<font color="#CCCCCC">malicious comp tactics ways to execute</font>

68
00:02:22,950 --> 00:02:29,119
things that you may not expect or would

69
00:02:25,829 --> 00:02:32,220
<font color="#E5E5E5">be difficult for a defender to detect so</font>

70
00:02:29,120 --> 00:02:33,810
so the combo reviews is a very very

71
00:02:32,220 --> 00:02:35,879
brief background<font color="#E5E5E5"> I would reference James</font>

72
00:02:33,810 --> 00:02:37,920
workshops talk that he<font color="#CCCCCC"> did it infiltrate</font>

73
00:02:35,879 --> 00:02:40,200
this year or troopers if you want a<font color="#E5E5E5"> good</font>

74
00:02:37,920 --> 00:02:42,388
30 to 40 minute overview of<font color="#CCCCCC"> kamma so</font><font color="#E5E5E5"> I</font>

75
00:02:40,200 --> 00:02:43,738
don't repeat some of what he's presented

76
00:02:42,389 --> 00:02:45,900
in his talk and it's a reference<font color="#CCCCCC"> for</font>

77
00:02:43,739 --> 00:02:47,040
that later but the two main<font color="#E5E5E5"> things we</font>

78
00:02:45,900 --> 00:02:49,500
were to look<font color="#E5E5E5"> at her what's called calm</font>

79
00:02:47,040 --> 00:02:51,900
registration and resolution so how do

80
00:02:49,500 --> 00:02:53,730
you get<font color="#E5E5E5"> an object onto a box and then</font>

81
00:02:51,900 --> 00:02:55,290
how do<font color="#E5E5E5"> you create those objects when</font>

82
00:02:53,730 --> 00:02:59,189
you're ready to<font color="#CCCCCC"> use those inside of an</font>

83
00:02:55,290 --> 00:03:01,620
application<font color="#E5E5E5"> so all right you put an</font>

84
00:02:59,189 --> 00:03:02,819
object model been around since 1993 may

85
00:03:01,620 --> 00:03:05,970
be older than some of the people in this

86
00:03:02,819 --> 00:03:07,798
<font color="#CCCCCC">room the idea here is this</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> not a new</font>

87
00:03:05,970 --> 00:03:10,439
technology in Windows and Windows is

88
00:03:07,799 --> 00:03:12,900
heavily dependent on<font color="#CCCCCC"> comm explorer.exe</font>

89
00:03:10,439 --> 00:03:15,000
for example if you if you ever fire up

90
00:03:12,900 --> 00:03:16,199
process monitors from sysinternals and

91
00:03:15,000 --> 00:03:18,389
look at<font color="#E5E5E5"> all the objects that are being</font>

92
00:03:16,199 --> 00:03:21,299
resolved it's substantial so there's a

93
00:03:18,389 --> 00:03:22,680
lot of embedded activity going<font color="#CCCCCC"> on calm</font>

94
00:03:21,299 --> 00:03:24,919
it's been around for a long time<font color="#CCCCCC"> so</font>

95
00:03:22,680 --> 00:03:28,519
that's what<font color="#E5E5E5"> I call to the archeology so</font>

96
00:03:24,919 --> 00:03:30,989
so really really brief history of calm

97
00:03:28,519 --> 00:03:32,549
how these objects you can just in

98
00:03:30,989 --> 00:03:34,530
Windows there's a number of file

99
00:03:32,549 --> 00:03:37,650
extension some of these you've probably

100
00:03:34,530 --> 00:03:42,030
heard of others you<font color="#E5E5E5"> may be new to you so</font>

101
00:03:37,650 --> 00:03:45,709
you Sicily have like dll oceaxe type

102
00:03:42,030 --> 00:03:48,060
libraries executable files and recently

103
00:03:45,709 --> 00:03:49,769
there's a file we've been working with

104
00:03:48,060 --> 00:03:51,720
called FCP while some of you have heard

105
00:03:49,769 --> 00:03:55,139
<font color="#E5E5E5">of STDs or seen them so a couple of you</font>

106
00:03:51,720 --> 00:03:57,000
have seen these these are<font color="#CCCCCC"> xml file that</font>

107
00:03:55,139 --> 00:03:59,790
actually lets you create<font color="#CCCCCC"> calm</font><font color="#E5E5E5"> objects</font>

108
00:03:57,000 --> 00:04:01,979
and run<font color="#E5E5E5"> VV or jscript so the reason we</font>

109
00:03:59,790 --> 00:04:03,388
talk about FCT files that's something

110
00:04:01,979 --> 00:04:05,879
that<font color="#CCCCCC"> Matt my youth squad Bay when we're</font>

111
00:04:03,389 --> 00:04:07,889
doing<font color="#E5E5E5"> a quick proof of concept on how to</font>

112
00:04:05,879 --> 00:04:10,349
get<font color="#E5E5E5"> calm execution we usually whip up a</font>

113
00:04:07,889 --> 00:04:12,540
SCT file either locally or hosted on<font color="#CCCCCC"> the</font>

114
00:04:10,349 --> 00:04:14,369
internet and get<font color="#E5E5E5"> that run so i'm going</font>

115
00:04:12,540 --> 00:04:17,339
to show you the minute well what an<font color="#E5E5E5"> xml</font>

116
00:04:14,370 --> 00:04:19,769
suq looks like and the cop had this idea

117
00:04:17,339 --> 00:04:21,719
of location transparency so the idea is

118
00:04:19,769 --> 00:04:24,540
that as a developer they wanted it to be

119
00:04:21,719 --> 00:04:26,219
an easy to<font color="#CCCCCC"> use a way to instrument</font>

120
00:04:24,540 --> 00:04:28,890
check so whether that object<font color="#E5E5E5"> is in the</font>

121
00:04:26,220 --> 00:04:31,500
same process in another process on

122
00:04:28,890 --> 00:04:34,020
another computer the call that method

123
00:04:31,500 --> 00:04:38,610
calls all looks very similar at the

124
00:04:34,020 --> 00:04:41,099
binary level in<font color="#CCCCCC"> comm so this is an</font>

125
00:04:38,610 --> 00:04:44,700
example of an FCT file comp<font color="#E5E5E5"> script with</font>

126
00:04:41,100 --> 00:04:46,890
Bob and it was a way for you to back at

127
00:04:44,700 --> 00:04:49,500
<font color="#CCCCCC">calm object not by a binary addition by</font>

128
00:04:46,890 --> 00:04:51,750
a text file<font color="#CCCCCC"> and you can see one way you</font>

129
00:04:49,500 --> 00:04:54,120
might call and calm object like this is

130
00:04:51,750 --> 00:04:55,560
using<font color="#CCCCCC"> its we called red yes v r32 if i</font>

131
00:04:54,120 --> 00:04:57,240
could<font color="#E5E5E5"> reference we belong if you want to</font>

132
00:04:55,560 --> 00:05:00,660
learn more about that but what's

133
00:04:57,240 --> 00:05:02,310
interesting here is the xml definition

134
00:05:00,660 --> 00:05:05,460
is the<font color="#CCCCCC"> dupatta</font><font color="#E5E5E5"> we the first eight lines</font>

135
00:05:02,310 --> 00:05:08,250
of code but the<font color="#CCCCCC"> object itself is going</font>

136
00:05:05,460 --> 00:05:10,140
to run wise<font color="#CCCCCC"> 9 through 11 so whatever you</font>

137
00:05:08,250 --> 00:05:12,710
can do is<font color="#CCCCCC"> chase earth or be easier if</font>

138
00:05:10,140 --> 00:05:15,360
<font color="#E5E5E5">you can do it by the object without</font>

139
00:05:12,710 --> 00:05:18,270
calling the sea script or windows script

140
00:05:15,360 --> 00:05:19,800
host w<font color="#E5E5E5"> script so</font><font color="#CCCCCC"> I'm really interested</font>

141
00:05:18,270 --> 00:05:21,539
it will talk about this later<font color="#E5E5E5"> on how do</font>

142
00:05:19,800 --> 00:05:24,360
i how do<font color="#E5E5E5"> I didn't expand the</font>

143
00:05:21,540 --> 00:05:26,990
capabilities of chase script or vbscript

144
00:05:24,360 --> 00:05:30,030
so those are some things will look at

145
00:05:26,990 --> 00:05:32,310
the class<font color="#CCCCCC"> might ease</font><font color="#E5E5E5"> that you make it</font>

146
00:05:30,030 --> 00:05:33,780
real lucky you you can yeah<font color="#E5E5E5"> it's the</font>

147
00:05:32,310 --> 00:05:36,060
idea was that should be globally make

148
00:05:33,780 --> 00:05:37,770
something to do in that you can generate

149
00:05:36,060 --> 00:05:39,780
<font color="#E5E5E5">there's an API call to generate one</font>

150
00:05:37,770 --> 00:05:43,140
unique to that system or unique across

151
00:05:39,780 --> 00:05:45,659
time so<font color="#E5E5E5"> I generally make them up as I go</font>

152
00:05:43,140 --> 00:05:47,849
but yeah it can be<font color="#CCCCCC"> whatever it wants to</font>

153
00:05:45,660 --> 00:05:49,350
be or should be followed if your design

154
00:05:47,850 --> 00:05:52,280
and<font color="#E5E5E5"> calm optics fall the right pattern</font>

155
00:05:49,350 --> 00:05:55,410
creates us yep so the<font color="#CCCCCC"> question was just</font>

156
00:05:52,280 --> 00:05:57,989
<font color="#E5E5E5">you know is that if we reverse it have</font>

157
00:05:55,410 --> 00:05:59,490
to be unique for the system so we'll go

158
00:05:57,990 --> 00:06:03,300
we'll<font color="#CCCCCC"> go over some of</font><font color="#E5E5E5"> the implications</font>

159
00:05:59,490 --> 00:06:06,240
in using the same quad Heidi now

160
00:06:03,300 --> 00:06:07,710
<font color="#E5E5E5">duplicating an inner carry the load what</font>

161
00:06:06,240 --> 00:06:18,870
I<font color="#E5E5E5"> think</font><font color="#CCCCCC"> is you click</font><font color="#E5E5E5"> the microphone</font>

162
00:06:07,710 --> 00:06:21,419
inputs oh yeah sure yeah<font color="#E5E5E5"> okay look at</font>

163
00:06:18,870 --> 00:06:23,520
<font color="#E5E5E5">Sam oh thank you okay all right is that</font>

164
00:06:21,420 --> 00:06:26,940
too loud is that<font color="#E5E5E5"> okay</font><font color="#CCCCCC"> all right all</font>

165
00:06:23,520 --> 00:06:28,469
<font color="#CCCCCC">right</font><font color="#E5E5E5"> so the way that</font><font color="#CCCCCC"> calm resolves</font>

166
00:06:26,940 --> 00:06:32,010
objects<font color="#E5E5E5"> don't feel like that's so loud</font>

167
00:06:28,470 --> 00:06:34,650
is theirs to registry hives so there's

168
00:06:32,010 --> 00:06:37,380
hklm HQ local machine there's eight key

169
00:06:34,650 --> 00:06:38,190
current user those combined into a

170
00:06:37,380 --> 00:06:41,340
registry

171
00:06:38,190 --> 00:06:44,190
<font color="#CCCCCC">he called</font><font color="#E5E5E5"> H key classes</font><font color="#CCCCCC"> root HD classes</font>

172
00:06:41,340 --> 00:06:45,299
root really is a blend of both of<font color="#CCCCCC"> those</font>

173
00:06:44,190 --> 00:06:48,270
I<font color="#CCCCCC"> think you said it</font><font color="#E5E5E5"> well it's like a</font>

174
00:06:45,300 --> 00:06:50,760
virtual class so the<font color="#E5E5E5"> idea is when you're</font>

175
00:06:48,270 --> 00:06:52,140
searching for something for calm the

176
00:06:50,760 --> 00:06:53,820
thing that's interesting about finding

177
00:06:52,140 --> 00:06:55,650
these objects<font color="#E5E5E5"> would be per user calm</font>

178
00:06:53,820 --> 00:06:58,380
objects where they resolved an eight key

179
00:06:55,650 --> 00:07:00,330
current user first you have to be an

180
00:06:58,380 --> 00:07:02,219
administrator to write something to hklm

181
00:07:00,330 --> 00:07:03,960
so that's that's what's interesting here

182
00:07:02,220 --> 00:07:06,630
is if you can create<font color="#E5E5E5"> something in HGC</font>

183
00:07:03,960 --> 00:07:08,789
you that would hijack<font color="#E5E5E5"> or allow you to</font>

184
00:07:06,630 --> 00:07:10,350
<font color="#E5E5E5">get</font><font color="#CCCCCC"> access to actually your code instead</font>

185
00:07:08,790 --> 00:07:11,820
of what was intended for that<font color="#CCCCCC"> context</font>

186
00:07:10,350 --> 00:07:14,880
and<font color="#E5E5E5"> now to go over some</font><font color="#CCCCCC"> of those tactics</font>

187
00:07:11,820 --> 00:07:16,469
in a moment so really just put this

188
00:07:14,880 --> 00:07:19,290
slide in for reference<font color="#E5E5E5"> to those of you</font>

189
00:07:16,470 --> 00:07:22,740
who are blue team or defenders looking

190
00:07:19,290 --> 00:07:24,510
at<font color="#E5E5E5"> calm objects what are those paths or</font>

191
00:07:22,740 --> 00:07:25,830
what are all the different attributes

192
00:07:24,510 --> 00:07:27,570
that the<font color="#E5E5E5"> calm optic would have so this</font>

193
00:07:25,830 --> 00:07:29,580
<font color="#E5E5E5">is really just in the deck for reference</font>

194
00:07:27,570 --> 00:07:31,950
there's a good couple good msdn articles

195
00:07:29,580 --> 00:07:36,479
<font color="#E5E5E5">to describe exactly what keys are needed</font>

196
00:07:31,950 --> 00:07:38,820
for a common object so some important

197
00:07:36,480 --> 00:07:40,260
components and calm object resolution

198
00:07:38,820 --> 00:07:41,730
and so we'll go over in<font color="#E5E5E5"> this slide a</font>

199
00:07:40,260 --> 00:07:44,490
couple of<font color="#CCCCCC"> things that</font><font color="#E5E5E5"> we want to look at</font>

200
00:07:41,730 --> 00:07:46,680
as far as like class ID we mentioned or

201
00:07:44,490 --> 00:07:48,780
clsid which is a good can<font color="#E5E5E5"> be made up I</font>

202
00:07:46,680 --> 00:07:50,160
generally make them up because I'm just

203
00:07:48,780 --> 00:07:51,419
<font color="#E5E5E5">writing proof of concept testing but</font>

204
00:07:50,160 --> 00:07:54,240
again we talked about<font color="#E5E5E5"> how those could be</font>

205
00:07:51,419 --> 00:07:56,099
generated<font color="#CCCCCC"> with an API call program ID is</font>

206
00:07:54,240 --> 00:07:57,720
a string so a friendly name for the

207
00:07:56,100 --> 00:07:59,760
comma objective<font color="#E5E5E5"> you have used to</font>

208
00:07:57,720 --> 00:08:03,419
instantiate so like scripting dictionary

209
00:07:59,760 --> 00:08:05,340
or you know a wscript.shell those would

210
00:08:03,419 --> 00:08:08,969
be the progid associated with a calm

211
00:08:05,340 --> 00:08:10,619
object the monikers would be the way

212
00:08:08,970 --> 00:08:12,240
you're going to invoke the instance of

213
00:08:10,620 --> 00:08:15,630
that<font color="#E5E5E5"> object so like for example that</font>

214
00:08:12,240 --> 00:08:17,850
moniker there says scriptlet colon<font color="#E5E5E5"> https</font>

215
00:08:15,630 --> 00:08:20,430
<font color="#E5E5E5">let's saying go find a calm scriptlet at</font>

216
00:08:17,850 --> 00:08:22,530
this URL and create that calm objected

217
00:08:20,430 --> 00:08:25,230
so calm is really instrumented to go

218
00:08:22,530 --> 00:08:27,719
fetch this file<font color="#E5E5E5"> XML file from</font><font color="#CCCCCC"> the</font>

219
00:08:25,230 --> 00:08:30,120
internet executed on the system inside

220
00:08:27,720 --> 00:08:31,350
of reg s BR 32 or some of the other

221
00:08:30,120 --> 00:08:33,150
tools so this really<font color="#E5E5E5"> really fascinating</font>

222
00:08:31,350 --> 00:08:35,610
<font color="#CCCCCC">way that you look at monikers and how</font>

223
00:08:33,150 --> 00:08:36,809
they're used<font color="#E5E5E5"> to create those objects the</font>

224
00:08:35,610 --> 00:08:39,000
two calls that we're going to abuse

225
00:08:36,809 --> 00:08:40,679
quite a bit our get object<font color="#CCCCCC"> and create</font>

226
00:08:39,000 --> 00:08:42,270
objects and so it's important<font color="#E5E5E5"> to</font>

227
00:08:40,679 --> 00:08:45,569
understand you can pass when you call

228
00:08:42,270 --> 00:08:48,360
get object<font color="#E5E5E5"> you could pass that triplet</font>

229
00:08:45,570 --> 00:08:50,040
moniker to that function<font color="#E5E5E5"> calling would</font>

230
00:08:48,360 --> 00:08:51,260
create that object so here's here's some

231
00:08:50,040 --> 00:08:56,180
examples of how to do<font color="#E5E5E5"> that with</font>

232
00:08:51,260 --> 00:08:58,460
run dll 32 you're calling<font color="#CCCCCC"> ghetto ex and</font>

233
00:08:56,180 --> 00:09:01,010
you pass that<font color="#E5E5E5"> path it's going to go</font><font color="#CCCCCC"> out</font>

234
00:08:58,460 --> 00:09:04,850
<font color="#CCCCCC">and fix that calm definition and created</font>

235
00:09:01,010 --> 00:09:06,980
in memory for you so there are other

236
00:09:04,850 --> 00:09:08,510
monikers so there's w my monikers so

237
00:09:06,980 --> 00:09:09,770
like<font color="#CCCCCC"> wind management system or something</font>

238
00:09:08,510 --> 00:09:12,110
<font color="#E5E5E5">like that those are other there's a</font>

239
00:09:09,770 --> 00:09:16,310
bunch of these on the system<font color="#E5E5E5"> that can be</font>

240
00:09:12,110 --> 00:09:18,560
<font color="#E5E5E5">used to invoke different calls here's</font>

241
00:09:16,310 --> 00:09:19,699
here's really<font color="#E5E5E5"> like we did a search like</font>

242
00:09:18,560 --> 00:09:22,310
the other day just<font color="#E5E5E5"> like here's here's</font>

243
00:09:19,700 --> 00:09:24,020
one<font color="#E5E5E5"> comm object that's got you know half</font>

244
00:09:22,310 --> 00:09:25,040
a dozen or so different keys some of

245
00:09:24,020 --> 00:09:28,160
these<font color="#CCCCCC"> are more important than others</font>

246
00:09:25,040 --> 00:09:29,089
with in<font color="#E5E5E5"> terms of abuse of a comma but</font>

247
00:09:28,160 --> 00:09:31,430
that's<font color="#E5E5E5"> what it looks like in the</font>

248
00:09:29,090 --> 00:09:33,230
registry hide this is<font color="#CCCCCC"> in hklm we've got</font>

249
00:09:31,430 --> 00:09:35,300
the class ID and then we've got

250
00:09:33,230 --> 00:09:37,970
different sub keys that will define like

251
00:09:35,300 --> 00:09:40,219
what dll is loaded where's the scriptlet

252
00:09:37,970 --> 00:09:41,810
defined treat as which matter go over a

253
00:09:40,220 --> 00:09:42,890
little bit later so that's just<font color="#CCCCCC"> leslie</font>

254
00:09:41,810 --> 00:09:47,300
you would see in<font color="#E5E5E5"> the hive if you're</font>

255
00:09:42,890 --> 00:09:49,400
querying for<font color="#E5E5E5"> comma objects typically</font>

256
00:09:47,300 --> 00:09:51,890
developers when they create these comics

257
00:09:49,400 --> 00:09:53,540
will use a couple<font color="#E5E5E5"> of tools to register</font>

258
00:09:51,890 --> 00:09:55,550
the<font color="#E5E5E5"> com object and this is where</font><font color="#CCCCCC"> I found</font>

259
00:09:53,540 --> 00:09:58,699
a number<font color="#E5E5E5"> of like</font><font color="#CCCCCC"> white listing bypasses</font>

260
00:09:55,550 --> 00:10:02,479
is by abusing these three tools in

261
00:09:58,700 --> 00:10:04,790
general so reg SVR 32red jsm or red svcs

262
00:10:02,480 --> 00:10:06,860
like if a developer<font color="#E5E5E5"> writes a calm object</font>

263
00:10:04,790 --> 00:10:08,120
<font color="#CCCCCC">in.net</font><font color="#E5E5E5"> they want to register it they</font>

264
00:10:06,860 --> 00:10:09,980
would use one of these<font color="#E5E5E5"> tools that would</font>

265
00:10:08,120 --> 00:10:14,210
<font color="#E5E5E5">then create all of those keys in the</font>

266
00:10:09,980 --> 00:10:15,380
registry for you so what does<font color="#E5E5E5"> it take</font>

267
00:10:14,210 --> 00:10:17,390
you through briefly just so you get a

268
00:10:15,380 --> 00:10:19,490
<font color="#CCCCCC">sense of what's happening when you go</font>

269
00:10:17,390 --> 00:10:21,290
and execute a calm object these are some

270
00:10:19,490 --> 00:10:23,240
of the different calls or function calls

271
00:10:21,290 --> 00:10:25,699
that happen this is from<font color="#CCCCCC"> the</font><font color="#E5E5E5"> comm</font>

272
00:10:23,240 --> 00:10:27,140
specification from 1995<font color="#CCCCCC"> you really want</font>

273
00:10:25,700 --> 00:10:31,400
some gripping reading tear into that

274
00:10:27,140 --> 00:10:33,410
document but you can see<font color="#CCCCCC"> that the the</font>

275
00:10:31,400 --> 00:10:35,000
function calls in the client would be

276
00:10:33,410 --> 00:10:36,709
first they would call essentially<font color="#E5E5E5"> I want</font>

277
00:10:35,000 --> 00:10:38,840
to create an object so create instance

278
00:10:36,710 --> 00:10:40,910
which is then going to<font color="#E5E5E5"> go figure</font><font color="#CCCCCC"> out in</font>

279
00:10:38,840 --> 00:10:42,260
the registry which is like step<font color="#E5E5E5"> 6 down</font>

280
00:10:40,910 --> 00:10:45,560
there look at<font color="#E5E5E5"> the registry find out</font>

281
00:10:42,260 --> 00:10:47,600
which dll contains viscom object load

282
00:10:45,560 --> 00:10:49,459
<font color="#CCCCCC">that object into memory and pass back of</font>

283
00:10:47,600 --> 00:10:52,150
reference<font color="#E5E5E5"> to that object to the client</font>

284
00:10:49,460 --> 00:10:54,080
that called the<font color="#E5E5E5"> comm component so</font>

285
00:10:52,150 --> 00:10:55,790
looking up in<font color="#E5E5E5"> the registries an</font>

286
00:10:54,080 --> 00:10:57,170
important artifact as a defender to see

287
00:10:55,790 --> 00:10:59,060
well if they call their created this

288
00:10:57,170 --> 00:11:00,439
object where is<font color="#E5E5E5"> it in the</font><font color="#CCCCCC"> registry</font>

289
00:10:59,060 --> 00:11:02,869
because you often have<font color="#E5E5E5"> to persist that</font>

290
00:11:00,440 --> 00:11:06,070
definition on in the file or the

291
00:11:02,870 --> 00:11:09,050
registration so all right

292
00:11:06,070 --> 00:11:10,700
normally until<font color="#E5E5E5"> Microsoft came out with</font>

293
00:11:09,050 --> 00:11:12,349
this thing called registration freecom

294
00:11:10,700 --> 00:11:14,149
which we'll talk about which allows you

295
00:11:12,350 --> 00:11:15,680
to create calm objects<font color="#E5E5E5"> that do not exist</font>

296
00:11:14,149 --> 00:11:17,779
in the registry now that's important as

297
00:11:15,680 --> 00:11:20,510
a red team because I don't want<font color="#CCCCCC"> to put</font>

298
00:11:17,779 --> 00:11:22,250
registry keys on disk or in the registry

299
00:11:20,510 --> 00:11:23,779
I want<font color="#E5E5E5"> to create an object of running</font>

300
00:11:22,250 --> 00:11:26,420
dll or execute something without leaving

301
00:11:23,779 --> 00:11:28,100
those artifacts behind so registration

302
00:11:26,420 --> 00:11:29,630
freecom is the<font color="#CCCCCC"> technique</font><font color="#E5E5E5"> that you can</font>

303
00:11:28,100 --> 00:11:32,060
use to do that so there's a couple

304
00:11:29,630 --> 00:11:33,920
different things that we've<font color="#CCCCCC"> found that</font>

305
00:11:32,060 --> 00:11:35,689
we can use to avoid registration of a

306
00:11:33,920 --> 00:11:37,520
calm object so the comma object normally

307
00:11:35,690 --> 00:11:38,839
lives in the registry this is I'm going

308
00:11:37,520 --> 00:11:40,310
<font color="#E5E5E5">to present two or three techniques you</font>

309
00:11:38,839 --> 00:11:46,040
can run a calm object without those

310
00:11:40,310 --> 00:11:48,680
artifacts so first of all the goal here

311
00:11:46,040 --> 00:11:52,339
with the inside of VB script or jscript

312
00:11:48,680 --> 00:11:54,010
how could I load a.net dll and executed

313
00:11:52,339 --> 00:11:56,810
the reason<font color="#E5E5E5"> I want to do that is because</font>

314
00:11:54,010 --> 00:12:00,290
jscript and VB script by default don't

315
00:11:56,810 --> 00:12:03,680
have win32<font color="#E5E5E5"> API calls so I can't like run</font>

316
00:12:00,290 --> 00:12:06,020
a shellcode blob in a vbscript normally

317
00:12:03,680 --> 00:12:07,579
but if i can get vbscript to load my

318
00:12:06,020 --> 00:12:10,310
<font color="#E5E5E5">dotnet assembly which gives me full</font>

319
00:12:07,580 --> 00:12:12,200
access to the win32<font color="#E5E5E5"> api now i can run</font>

320
00:12:10,310 --> 00:12:13,489
shellcode in jscript or vb script and

321
00:12:12,200 --> 00:12:15,500
that's<font color="#CCCCCC"> interesting to me and so that's</font>

322
00:12:13,490 --> 00:12:17,270
what these two or three tactics is I'm

323
00:12:15,500 --> 00:12:20,209
going to talk about allow us<font color="#E5E5E5"> to do with</font>

324
00:12:17,270 --> 00:12:23,180
a calm object so imagine somebody runs

325
00:12:20,209 --> 00:12:25,969
red<font color="#E5E5E5"> SVR 32 it reaches out pulls down a</font>

326
00:12:23,180 --> 00:12:27,620
text file and execute shellcode I mean

327
00:12:25,970 --> 00:12:29,510
that's<font color="#E5E5E5"> what the capability we're talking</font>

328
00:12:27,620 --> 00:12:32,060
about here so glad to<font color="#E5E5E5"> the next slide so</font>

329
00:12:29,510 --> 00:12:35,959
the first first one is<font color="#E5E5E5"> this activation</font><font color="#CCCCCC"> X</font>

330
00:12:32,060 --> 00:12:39,410
or activation context so<font color="#CCCCCC"> a ctc TX object</font>

331
00:12:35,959 --> 00:12:41,660
<font color="#CCCCCC">ok it's built into Windows you can</font>

332
00:12:39,410 --> 00:12:43,790
create it<font color="#CCCCCC"> I'll show you some example</font>

333
00:12:41,660 --> 00:12:46,100
code I've got on my github page it

334
00:12:43,790 --> 00:12:47,839
requires two artifacts to be on dist in

335
00:12:46,100 --> 00:12:50,930
order to get this trick to work so first

336
00:12:47,839 --> 00:12:52,790
you'd have to drop the dll and second

337
00:12:50,930 --> 00:12:54,500
you'd have to have<font color="#CCCCCC"> a manifest and then</font>

338
00:12:52,790 --> 00:12:58,099
you would<font color="#CCCCCC"> just say ok i'm going to</font>

339
00:12:54,500 --> 00:13:00,350
create<font color="#E5E5E5"> the activex object tell it where</font>

340
00:12:58,100 --> 00:13:02,930
the deal is and<font color="#E5E5E5"> then it will load that</font>

341
00:13:00,350 --> 00:13:05,930
dotnet dll into the process without

342
00:13:02,930 --> 00:13:07,609
having it all those<font color="#E5E5E5"> com you know class</font>

343
00:13:05,930 --> 00:13:09,709
ID and all the registration components

344
00:13:07,610 --> 00:13:12,200
in<font color="#CCCCCC"> the registry so there's an example of</font>

345
00:13:09,709 --> 00:13:14,119
that on my github page the next slide

346
00:13:12,200 --> 00:13:17,390
shows the code it would be<font color="#E5E5E5"> like three</font>

347
00:13:14,120 --> 00:13:18,400
lines of code so in this example we we

348
00:13:17,390 --> 00:13:20,740
use I'm used

349
00:13:18,400 --> 00:13:23,050
quite a bit like we take a tool called

350
00:13:20,740 --> 00:13:25,510
cert you till we encode a file to basics

351
00:13:23,050 --> 00:13:28,540
before drop it to disk use certain till

352
00:13:25,510 --> 00:13:31,120
decode it to a binary and then you can

353
00:13:28,540 --> 00:13:33,520
call<font color="#E5E5E5"> these three lines so activation you</font>

354
00:13:31,120 --> 00:13:35,920
know the first<font color="#E5E5E5"> line of my 350 to create</font>

355
00:13:33,520 --> 00:13:38,800
that object point it to the manifest<font color="#E5E5E5"> and</font>

356
00:13:35,920 --> 00:13:40,449
now you've got access to the win32 API

357
00:13:38,800 --> 00:13:42,310
using a tool of this example called

358
00:13:40,450 --> 00:13:43,860
dynamic wrapper acts which is a dll that

359
00:13:42,310 --> 00:13:46,000
gives<font color="#E5E5E5"> you some pretty fascinating</font>

360
00:13:43,860 --> 00:13:48,700
capabilities inside of jscript<font color="#CCCCCC"> or</font>

361
00:13:46,000 --> 00:13:51,250
<font color="#CCCCCC">vbscript so that's that's one way to do</font>

362
00:13:48,700 --> 00:13:53,920
that<font color="#CCCCCC"> is is the actc TX object it's</font>

363
00:13:51,250 --> 00:13:55,660
really pretty cool this one I like even

364
00:13:53,920 --> 00:13:58,540
more it's something called registration

365
00:13:55,660 --> 00:14:00,610
helper and so all you would do in

366
00:13:58,540 --> 00:14:02,530
jscript here would be<font color="#E5E5E5"> say create the</font>

367
00:14:00,610 --> 00:14:04,780
variable with the system<font color="#CCCCCC"> enterprise</font>

368
00:14:02,530 --> 00:14:07,270
<font color="#CCCCCC">services registration class ID or</font>

369
00:14:04,780 --> 00:14:09,970
program ID and then you just say a

370
00:14:07,270 --> 00:14:11,470
install assembly give it the<font color="#CCCCCC"> DLL you</font>

371
00:14:09,970 --> 00:14:13,030
want it to run its going to consume and

372
00:14:11,470 --> 00:14:14,830
load that and give you full<font color="#E5E5E5"> access to</font>

373
00:14:13,030 --> 00:14:17,530
the data API inside of<font color="#E5E5E5"> j scripted</font>

374
00:14:14,830 --> 00:14:20,200
vbscript again pretty cool stuff does

375
00:14:17,530 --> 00:14:22,020
require a special binary so you do have

376
00:14:20,200 --> 00:14:24,340
to have<font color="#CCCCCC"> a couple of functions exposed</font>

377
00:14:22,020 --> 00:14:25,900
and that's on the github page as a

378
00:14:24,340 --> 00:14:28,450
reference<font color="#E5E5E5"> to you have to have a register</font>

379
00:14:25,900 --> 00:14:30,699
function it is unregister function but

380
00:14:28,450 --> 00:14:32,530
you would<font color="#E5E5E5"> give</font><font color="#CCCCCC"> that and essentially when</font>

381
00:14:30,700 --> 00:14:34,060
you invoke that object and call it stall

382
00:14:32,530 --> 00:14:35,829
assembly it's going to try and<font color="#E5E5E5"> call this</font>

383
00:14:34,060 --> 00:14:37,359
register function then run whatever<font color="#E5E5E5"> code</font>

384
00:14:35,830 --> 00:14:38,950
is there if you don't<font color="#E5E5E5"> have</font>

385
00:14:37,360 --> 00:14:40,720
administrative rights it will fall<font color="#CCCCCC"> down</font>

386
00:14:38,950 --> 00:14:42,610
and just run the unregister piece you're

387
00:14:40,720 --> 00:14:43,840
able to use this<font color="#E5E5E5"> to like bypass white</font>

388
00:14:42,610 --> 00:14:48,880
<font color="#E5E5E5">with seeing other inks virus type</font>

389
00:14:43,840 --> 00:14:52,000
solutions pretty cool stuff so now this

390
00:14:48,880 --> 00:14:53,740
came out about maybe three<font color="#E5E5E5"> weeks ago and</font>

391
00:14:52,000 --> 00:14:55,630
i'm not sure people really understand

392
00:14:53,740 --> 00:14:58,570
the implications of this but this<font color="#E5E5E5"> is</font>

393
00:14:55,630 --> 00:15:02,340
<font color="#E5E5E5">really James 40oz work what he was able</font>

394
00:14:58,570 --> 00:15:05,040
<font color="#E5E5E5">to do is inside of AJ script file</font>

395
00:15:02,340 --> 00:15:07,900
serialized a.net assembly<font color="#E5E5E5"> the text</font>

396
00:15:05,040 --> 00:15:09,849
deliver that to the target<font color="#E5E5E5"> and then that</font>

397
00:15:07,900 --> 00:15:12,970
will rehydrate or you can<font color="#E5E5E5"> create that in</font>

398
00:15:09,850 --> 00:15:15,340
memory on the target<font color="#E5E5E5"> and execute there's</font>

399
00:15:12,970 --> 00:15:17,350
no vol left on disk so we've actually

400
00:15:15,340 --> 00:15:21,460
been able to run<font color="#E5E5E5"> Mimi cats entirely</font>

401
00:15:17,350 --> 00:15:24,070
inside of C script w script reg SVR 32

402
00:15:21,460 --> 00:15:26,590
full binary execution full PE loader

403
00:15:24,070 --> 00:15:29,890
using this tactic so this<font color="#CCCCCC"> is really an</font>

404
00:15:26,590 --> 00:15:31,120
important sort of game changer I think

405
00:15:29,890 --> 00:15:32,319
and I think<font color="#E5E5E5"> that would agree like this</font>

406
00:15:31,120 --> 00:15:34,570
one really change things

407
00:15:32,320 --> 00:15:37,390
significantly with what you can actually

408
00:15:34,570 --> 00:15:40,930
do with calm objects in JavaScript and

409
00:15:37,390 --> 00:15:43,300
jscript so check this out on github net

410
00:15:40,930 --> 00:15:46,599
to jscript you create a custom assembly

411
00:15:43,300 --> 00:15:48,180
it has a little builder turns out a text

412
00:15:46,600 --> 00:15:51,750
file and then you can run that on

413
00:15:48,180 --> 00:15:54,579
another target really fascinating stuff

414
00:15:51,750 --> 00:15:56,260
<font color="#CCCCCC">okay so I think we're</font><font color="#E5E5E5"> going to at</font><font color="#CCCCCC"> this</font>

415
00:15:54,580 --> 00:15:58,060
point switch you know switch gears a

416
00:15:56,260 --> 00:15:59,439
little bit that's a little<font color="#CCCCCC"> bit of</font><font color="#E5E5E5"> calm</font>

417
00:15:58,060 --> 00:16:01,089
overview some background hopefully

418
00:15:59,440 --> 00:16:02,830
that's helpful set the stage for some of

419
00:16:01,090 --> 00:16:04,840
these militias tactics and methodology

420
00:16:02,830 --> 00:16:06,280
that<font color="#CCCCCC"> maps going to go over some give</font>

421
00:16:04,840 --> 00:16:10,870
this to you is<font color="#E5E5E5"> this recording a favor</font>

422
00:16:06,280 --> 00:16:13,990
good<font color="#E5E5E5"> all</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> you hear me</font><font color="#CCCCCC"> okay awesome</font>

423
00:16:10,870 --> 00:16:15,880
<font color="#CCCCCC">okay so some of the methodology examples</font>

424
00:16:13,990 --> 00:16:21,160
for abusing calm and we talked about

425
00:16:15,880 --> 00:16:23,140
<font color="#CCCCCC">earlier</font><font color="#E5E5E5"> how things like explore it</font>

426
00:16:21,160 --> 00:16:24,640
primarily<font color="#CCCCCC"> interacts with pop so if</font><font color="#E5E5E5"> you</font>

427
00:16:23,140 --> 00:16:26,310
<font color="#E5E5E5">run croque-madame and start explore</font>

428
00:16:24,640 --> 00:16:28,630
you'll see it resolve a bunch of object

429
00:16:26,310 --> 00:16:30,910
so this is<font color="#CCCCCC"> just a filter and example</font>

430
00:16:28,630 --> 00:16:32,980
filter for explorer we're primarily

431
00:16:30,910 --> 00:16:35,319
interested in load failures for HK see

432
00:16:32,980 --> 00:16:37,840
you so from an operational perspective

433
00:16:35,320 --> 00:16:39,400
what this means is that if you're going

434
00:16:37,840 --> 00:16:41,140
<font color="#CCCCCC">to use</font><font color="#E5E5E5"> a comma object you're going to</font>

435
00:16:39,400 --> 00:16:42,939
hijack it that's going<font color="#E5E5E5"> to mean that your</font>

436
00:16:41,140 --> 00:16:45,100
code is<font color="#E5E5E5"> going to run and the legitimate</font>

437
00:16:42,940 --> 00:16:46,990
codes not meaning if you hijack the

438
00:16:45,100 --> 00:16:50,290
conduct that its<font color="#E5E5E5"> way all to icon files</font>

439
00:16:46,990 --> 00:16:52,090
and windows the icons are going to show

440
00:16:50,290 --> 00:16:54,430
what things are going to break so

441
00:16:52,090 --> 00:16:55,810
looking<font color="#E5E5E5"> for load failures that exists</font>

442
00:16:54,430 --> 00:16:57,370
already are good because they're not

443
00:16:55,810 --> 00:16:59,050
already loaded meaning you're not<font color="#E5E5E5"> going</font>

444
00:16:57,370 --> 00:17:02,260
to impact the system when<font color="#E5E5E5"> you run your</font>

445
00:16:59,050 --> 00:17:05,909
actual code so<font color="#CCCCCC"> we this quite a bit</font><font color="#E5E5E5"> we</font>

446
00:17:02,260 --> 00:17:09,129
still isn't troll pokémon look you're

447
00:17:05,910 --> 00:17:10,660
so this is what it looks like no tree

448
00:17:09,130 --> 00:17:14,050
ads will talk about this later this<font color="#E5E5E5"> is a</font>

449
00:17:10,660 --> 00:17:16,120
<font color="#CCCCCC">q1 so in fact every 32 we'll go over</font>

450
00:17:14,050 --> 00:17:17,230
<font color="#E5E5E5">some of the key you</font><font color="#CCCCCC"> know how</font><font color="#E5E5E5"> they can</font>

451
00:17:16,119 --> 00:17:20,050
<font color="#CCCCCC">actually be of use from a</font><font color="#E5E5E5"> licious</font>

452
00:17:17,230 --> 00:17:21,400
standpoint<font color="#E5E5E5"> so this</font><font color="#CCCCCC"> is just what X poor</font>

453
00:17:20,050 --> 00:17:23,198
is looking for all these<font color="#E5E5E5"> different</font>

454
00:17:21,400 --> 00:17:29,140
properties there an exists that<font color="#E5E5E5"> I'd be a</font>

455
00:17:23,199 --> 00:17:31,480
really good one okay so<font color="#CCCCCC"> some types of</font>

456
00:17:29,140 --> 00:17:35,440
excavation tools<font color="#E5E5E5"> James poor Shah again</font>

457
00:17:31,480 --> 00:17:37,810
put out OE you net really good tool for

458
00:17:35,440 --> 00:17:39,670
looking at the existing<font color="#CCCCCC"> Cobb Jex their</font>

459
00:17:37,810 --> 00:17:41,679
interfaces and how they're registered

460
00:17:39,670 --> 00:17:44,920
it's really good we're getting<font color="#E5E5E5"> an idea</font>

461
00:17:41,680 --> 00:17:46,090
of how you know specific comics are

462
00:17:44,920 --> 00:17:48,039
actually registering

463
00:17:46,090 --> 00:17:50,918
methods and properties exist for<font color="#CCCCCC"> those</font>

464
00:17:48,039 --> 00:17:53,440
<font color="#CCCCCC">specific one and then just internals</font>

465
00:17:50,919 --> 00:17:55,840
proc amount of process explorer both

466
00:17:53,440 --> 00:17:58,929
really good<font color="#CCCCCC"> they're Microsoft signed to</font>

467
00:17:55,840 --> 00:18:01,090
and believe<font color="#E5E5E5"> it or not they use comp</font><font color="#CCCCCC"> too</font>

468
00:17:58,929 --> 00:18:04,510
so you can<font color="#E5E5E5"> use those to perform</font><font color="#CCCCCC"> calm</font>

469
00:18:01,090 --> 00:18:07,240
hijack a lot of people<font color="#E5E5E5"> have those on</font>

470
00:18:04,510 --> 00:18:08,408
their<font color="#CCCCCC"> systems so that any of the other</font>

471
00:18:07,240 --> 00:18:09,880
thing we would out here<font color="#CCCCCC"> to is just</font>

472
00:18:08,409 --> 00:18:11,320
exploring in<font color="#CCCCCC"> PowerShell we were talking</font>

473
00:18:09,880 --> 00:18:13,809
about<font color="#E5E5E5"> that like lot of times that you</font>

474
00:18:11,320 --> 00:18:15,490
can<font color="#E5E5E5"> create new objects calm and give</font><font color="#CCCCCC"> it</font>

475
00:18:13,809 --> 00:18:17,110
the program ID and create those objects

476
00:18:15,490 --> 00:18:18,820
so then explore the methods<font color="#E5E5E5"> and</font>

477
00:18:17,110 --> 00:18:21,250
properties that are exposed and<font color="#E5E5E5"> see what</font>

478
00:18:18,820 --> 00:18:24,220
might be interested in titles objects

479
00:18:21,250 --> 00:18:25,120
yep so the militia tactics overview

480
00:18:24,220 --> 00:18:27,940
we're going to kind<font color="#CCCCCC"> of cover some</font>

481
00:18:25,120 --> 00:18:30,299
persistence<font color="#CCCCCC"> viacom you know lateral</font>

482
00:18:27,940 --> 00:18:33,340
movement some privilege escalation

483
00:18:30,299 --> 00:18:34,629
office add-in so NWR put out a really

484
00:18:33,340 --> 00:18:36,158
good blog post recently that kind of

485
00:18:34,630 --> 00:18:38,169
<font color="#E5E5E5">highlights the use of this that</font><font color="#CCCCCC"> i don't</font>

486
00:18:36,159 --> 00:18:40,809
think<font color="#CCCCCC"> it's been publicly known or we</font>

487
00:18:38,169 --> 00:18:42,010
talked<font color="#E5E5E5"> about so we're going to kind of</font>

488
00:18:40,809 --> 00:18:44,200
cover some of that stuff how you might

489
00:18:42,010 --> 00:18:46,419
go about looking for other potential

490
00:18:44,200 --> 00:18:49,179
vectors in<font color="#CCCCCC"> the same area so we'll go</font>

491
00:18:46,419 --> 00:18:51,580
over what we found<font color="#CCCCCC"> i'll be the first one</font>

492
00:18:49,179 --> 00:18:53,140
to tell you that there's a nauseating

493
00:18:51,580 --> 00:18:54,490
amount of stuff to abuse in common

494
00:18:53,140 --> 00:18:57,070
windows and so this<font color="#E5E5E5"> is a small</font>

495
00:18:54,490 --> 00:18:58,270
percentage of it so waikiki says the

496
00:18:57,070 --> 00:19:01,210
beginning we're hoping this is going to

497
00:18:58,270 --> 00:19:02,740
act<font color="#E5E5E5"> as a reference</font><font color="#CCCCCC"> for you guys if you</font>

498
00:19:01,210 --> 00:19:04,779
find this interesting to go and poke

499
00:19:02,740 --> 00:19:06,669
around<font color="#E5E5E5"> and expose some of the stuff</font>

500
00:19:04,779 --> 00:19:09,159
that's out there because attackers are

501
00:19:06,669 --> 00:19:12,750
using it people aren't looking<font color="#CCCCCC"> for it so</font>

502
00:19:09,159 --> 00:19:12,750
it's really need to light shined on it

503
00:19:13,710 --> 00:19:19,570
so persistence viacom hijacking there

504
00:19:16,960 --> 00:19:22,419
are two two methods that<font color="#CCCCCC"> i currently</font><font color="#E5E5E5"> use</font>

505
00:19:19,570 --> 00:19:24,220
for specifically one being treated so

506
00:19:22,419 --> 00:19:26,860
microsoft introduced there's a key

507
00:19:24,220 --> 00:19:29,860
called treat as for calm what this does

508
00:19:26,860 --> 00:19:31,719
is it it was<font color="#E5E5E5"> designed to act as a layer</font>

509
00:19:29,860 --> 00:19:34,928
of abstraction for old and new<font color="#E5E5E5"> calm</font>

510
00:19:31,720 --> 00:19:37,299
objects so if there's a comic<font color="#E5E5E5"> that an</font>

511
00:19:34,929 --> 00:19:39,490
enterprise has created that they<font color="#E5E5E5"> use</font>

512
00:19:37,299 --> 00:19:41,320
<font color="#E5E5E5">internally but some service needs you</font>

513
00:19:39,490 --> 00:19:42,700
know to use this older version and

514
00:19:41,320 --> 00:19:45,490
there's a newer version you can add a

515
00:19:42,700 --> 00:19:47,710
tree<font color="#CCCCCC"> as a kind</font><font color="#E5E5E5"> of point you know the</font>

516
00:19:45,490 --> 00:19:51,220
specific calm exact needs to result to

517
00:19:47,710 --> 00:19:52,809
this older older version what that means

518
00:19:51,220 --> 00:19:54,760
is<font color="#E5E5E5"> that we can take an existing qobject</font>

519
00:19:52,809 --> 00:19:57,039
out of treat as key and then<font color="#E5E5E5"> point it to</font>

520
00:19:54,760 --> 00:19:58,520
another column ject so if you<font color="#E5E5E5"> had a tree</font>

521
00:19:57,039 --> 00:20:01,010
as key to w

522
00:19:58,520 --> 00:20:02,690
script shell and point at the class ID

523
00:20:01,010 --> 00:20:04,550
for another<font color="#E5E5E5"> column object when you</font>

524
00:20:02,690 --> 00:20:06,740
instantiate w script that show it's

525
00:20:04,550 --> 00:20:08,480
going to resolve<font color="#E5E5E5"> the class ID it's going</font>

526
00:20:06,740 --> 00:20:09,860
to see that that tree dies and it's

527
00:20:08,480 --> 00:20:12,590
<font color="#E5E5E5">going to say</font><font color="#CCCCCC"> okay I need</font><font color="#E5E5E5"> to go over here</font>

528
00:20:09,860 --> 00:20:15,620
<font color="#CCCCCC">i need</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> entry this</font><font color="#E5E5E5"> column object so</font>

529
00:20:12,590 --> 00:20:17,810
it's a really nice redirect<font color="#E5E5E5"> either one</font>

530
00:20:15,620 --> 00:20:20,060
<font color="#E5E5E5">is I'm com humor hijacking so Windows</font>

531
00:20:17,810 --> 00:20:21,500
has scheduled tasks that run any time

532
00:20:20,060 --> 00:20:24,080
you use your login or any time the

533
00:20:21,500 --> 00:20:25,820
<font color="#CCCCCC">system starts</font><font color="#E5E5E5"> up attackers have been</font>

534
00:20:24,080 --> 00:20:28,250
<font color="#CCCCCC">using you know scheduled tasks or</font>

535
00:20:25,820 --> 00:20:30,020
persistence for a while most of<font color="#CCCCCC"> its</font><font color="#E5E5E5"> been</font>

536
00:20:28,250 --> 00:20:31,280
creating a new<font color="#E5E5E5"> scheduled task or abusing</font>

537
00:20:30,020 --> 00:20:34,070
some sort of functionality within the

538
00:20:31,280 --> 00:20:35,450
<font color="#E5E5E5">test itself and if you have</font><font color="#CCCCCC"> anybody gone</font>

539
00:20:34,070 --> 00:20:37,899
into a scheduled task and look at its

540
00:20:35,450 --> 00:20:40,820
action and it just says custom handler

541
00:20:37,900 --> 00:20:44,210
so if you<font color="#CCCCCC"> look</font><font color="#E5E5E5"> at the XML and scheduled</font>

542
00:20:40,820 --> 00:20:46,100
task as a custom hammer set what that

543
00:20:44,210 --> 00:20:48,050
actually showing most of the time is

544
00:20:46,100 --> 00:20:51,139
that<font color="#E5E5E5"> it's using some sort of comma</font>

545
00:20:48,050 --> 00:20:54,110
object<font color="#CCCCCC"> projection doodle specify class</font>

546
00:20:51,140 --> 00:20:56,810
ID you can hijack that class IV for a

547
00:20:54,110 --> 00:20:59,060
task that runs when<font color="#CCCCCC"> you user logs in and</font>

548
00:20:56,810 --> 00:21:00,800
all of a sudden<font color="#E5E5E5"> now you've got code run</font>

549
00:20:59,060 --> 00:21:02,629
<font color="#E5E5E5">England that specific user logs in</font>

550
00:21:00,800 --> 00:21:04,730
there's no you're not dropping you know

551
00:21:02,630 --> 00:21:10,640
any files down other than a registry

552
00:21:04,730 --> 00:21:13,820
change so this<font color="#E5E5E5"> is what the tree adds</font>

553
00:21:10,640 --> 00:21:15,230
persuasiveness looks like this is<font color="#CCCCCC"> just a</font>

554
00:21:13,820 --> 00:21:17,540
dot reg so it's<font color="#E5E5E5"> just through just</font>

555
00:21:15,230 --> 00:21:20,300
register changes the three ones to look

556
00:21:17,540 --> 00:21:22,850
at is backing so you can back a contact

557
00:21:20,300 --> 00:21:24,560
via the registry only so we talked about

558
00:21:22,850 --> 00:21:27,020
<font color="#E5E5E5">some of the registration components and</font>

559
00:21:24,560 --> 00:21:29,840
how you can register per user college X

560
00:21:27,020 --> 00:21:31,129
<font color="#CCCCCC">in the HKS to you hive what this is</font>

561
00:21:29,840 --> 00:21:34,429
showing is that we're creating our own

562
00:21:31,130 --> 00:21:36,950
com object called bandit<font color="#CCCCCC"> I'm giving</font><font color="#E5E5E5"> it a</font>

563
00:21:34,430 --> 00:21:39,610
random class ID and then there's a fun

564
00:21:36,950 --> 00:21:42,530
middle one it's called scriptlet URL

565
00:21:39,610 --> 00:21:44,870
from the<font color="#E5E5E5"> blue side</font><font color="#CCCCCC"> I I've never seen</font>

566
00:21:42,530 --> 00:21:46,310
this<font color="#E5E5E5"> legitimately</font><font color="#CCCCCC"> exists on the</font>

567
00:21:44,870 --> 00:21:49,760
operating system i don't know why they

568
00:21:46,310 --> 00:21:53,210
exist but<font color="#CCCCCC"> it does so it's a really a web</font>

569
00:21:49,760 --> 00:21:54,470
link to<font color="#CCCCCC"> a host a conscript would so</font><font color="#E5E5E5"> you</font>

570
00:21:53,210 --> 00:21:58,250
can throw<font color="#CCCCCC"> that</font><font color="#E5E5E5"> in there and then add the</font>

571
00:21:54,470 --> 00:22:00,020
tree as key for this 373<font color="#E5E5E5"> class idea</font>

572
00:21:58,250 --> 00:22:03,200
there that's just a calm object that

573
00:22:00,020 --> 00:22:05,240
gets loaded or instantiated you know

574
00:22:03,200 --> 00:22:07,070
when<font color="#E5E5E5"> I'll user logs in via like it got</font>

575
00:22:05,240 --> 00:22:09,380
pretty sure<font color="#E5E5E5"> Explorer loads that specific</font>

576
00:22:07,070 --> 00:22:12,110
object so we're just<font color="#E5E5E5"> adding a tree as</font>

577
00:22:09,380 --> 00:22:14,780
key so that's valid object to point

578
00:22:12,110 --> 00:22:17,570
to our new newly created object that

579
00:22:14,780 --> 00:22:20,120
reaches out and run a<font color="#E5E5E5"> calm scriptlet yes</font>

580
00:22:17,570 --> 00:22:21,379
you're not<font color="#E5E5E5"> really think you'd be script</font>

581
00:22:20,120 --> 00:22:23,649
from the internet yep<font color="#E5E5E5"> what should be</font>

582
00:22:21,380 --> 00:22:26,210
terrified and combine<font color="#CCCCCC"> that with the</font>

583
00:22:23,650 --> 00:22:28,429
stuff that force<font color="#E5E5E5"> I'll put</font><font color="#CCCCCC"> out for you</font>

584
00:22:26,210 --> 00:22:33,980
know<font color="#E5E5E5"> serials I fear I can't even</font>

585
00:22:28,429 --> 00:22:36,470
generation<font color="#CCCCCC"> yet words are hard yeah so</font>

586
00:22:33,980 --> 00:22:38,090
you<font color="#E5E5E5"> can that essentially equates to you</font>

587
00:22:36,470 --> 00:22:39,650
know running<font color="#E5E5E5"> full shell code so kind of</font>

588
00:22:38,090 --> 00:22:41,449
combining those two techniques mix for

589
00:22:39,650 --> 00:22:44,480
really a my opinion a frightening

590
00:22:41,450 --> 00:22:47,030
experience<font color="#E5E5E5"> like you said early i don't</font>

591
00:22:44,480 --> 00:22:50,419
think people<font color="#E5E5E5"> fully understand you know</font>

592
00:22:47,030 --> 00:22:53,980
the implications of this this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> a demo</font>

593
00:22:50,419 --> 00:23:05,480
so this<font color="#E5E5E5"> is a devotion sort of or not</font>

594
00:22:53,980 --> 00:23:09,370
uber fail<font color="#E5E5E5"> yeah or we fail a demo and</font>

595
00:23:05,480 --> 00:23:09,370
still<font color="#CCCCCC"> be recorded and you filled its own</font>

596
00:23:11,980 --> 00:23:17,419
<font color="#CCCCCC">okay so this is just the same you know</font>

597
00:23:15,049 --> 00:23:18,799
registry entry that was almost lied<font color="#CCCCCC"> that</font>

598
00:23:17,419 --> 00:23:20,270
<font color="#CCCCCC">i showed you</font><font color="#E5E5E5"> just kind of highlighting</font>

599
00:23:18,799 --> 00:23:22,910
the<font color="#CCCCCC"> com script with this is hosted on</font>

600
00:23:20,270 --> 00:23:24,650
github you can if you want to type that

601
00:23:22,910 --> 00:23:25,850
<font color="#CCCCCC">out you can go look</font><font color="#E5E5E5"> at it</font><font color="#CCCCCC"> i could</font>

602
00:23:24,650 --> 00:23:29,059
probably give<font color="#CCCCCC"> you a link if you</font><font color="#E5E5E5"> want to</font>

603
00:23:25,850 --> 00:23:30,590
look at<font color="#E5E5E5"> it</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> as a normal user you can</font>

604
00:23:29,059 --> 00:23:33,040
use red you<font color="#E5E5E5"> can use whatever method you</font>

605
00:23:30,590 --> 00:23:35,980
want to<font color="#E5E5E5"> actually import those entries</font>

606
00:23:33,040 --> 00:23:39,110
these are signed out like<font color="#E5E5E5"> i mentioned</font>

607
00:23:35,980 --> 00:23:41,540
it's adding a tree as key and to an

608
00:23:39,110 --> 00:23:44,870
existing valid object that's loaded by

609
00:23:41,540 --> 00:23:46,850
explorer pointing that specific you know

610
00:23:44,870 --> 00:23:49,399
<font color="#CCCCCC">object to our class IE that we created</font>

611
00:23:46,850 --> 00:23:54,490
and when that user logs back in its

612
00:23:49,400 --> 00:23:58,970
going to get executed relatively quickly

613
00:23:54,490 --> 00:24:02,260
so simple only things that change are a

614
00:23:58,970 --> 00:24:04,160
few registry keys everything else is

615
00:24:02,260 --> 00:24:06,790
it's fetching something from the

616
00:24:04,160 --> 00:24:06,790
internet so

617
00:24:13,430 --> 00:24:22,650
okay so evasion this is fine there are a

618
00:24:21,240 --> 00:24:24,960
lot of components in Windows that rely

619
00:24:22,650 --> 00:24:29,220
on creating get object much of which can

620
00:24:24,960 --> 00:24:31,440
be abused to our liking so obviously

621
00:24:29,220 --> 00:24:34,350
<font color="#CCCCCC">combine com script wits with you know</font>

622
00:24:31,440 --> 00:24:36,480
get<font color="#E5E5E5"> objects</font><font color="#CCCCCC"> grid object and the script</font>

623
00:24:34,350 --> 00:24:38,120
and script with monikers you can do a

624
00:24:36,480 --> 00:24:43,500
lot of really dangerous stuff

625
00:24:38,120 --> 00:24:44,939
specifically vbscript injection this is

626
00:24:43,500 --> 00:24:48,600
humorous to me I don't know that occult

627
00:24:44,940 --> 00:24:50,550
injection on every window system there's

628
00:24:48,600 --> 00:24:53,850
this thing called HUD PR end up VBS that

629
00:24:50,550 --> 00:24:54,960
exists<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> Microsoft signed so it's got</font>

630
00:24:53,850 --> 00:24:58,740
a digital<font color="#E5E5E5"> signature I belong to</font>

631
00:24:54,960 --> 00:25:00,420
<font color="#E5E5E5">Microsoft</font><font color="#CCCCCC"> it's there as you can see</font>

632
00:24:58,740 --> 00:25:02,610
we're running this script and we're

633
00:25:00,420 --> 00:25:05,550
giving<font color="#E5E5E5"> it the script moniker pointing it</font>

634
00:25:02,610 --> 00:25:08,550
to a just a google short link to<font color="#E5E5E5"> that</font>

635
00:25:05,550 --> 00:25:11,070
github that guess that has a cop script

636
00:25:08,550 --> 00:25:14,700
will host it at it when you run it it

637
00:25:11,070 --> 00:25:18,090
runs our<font color="#CCCCCC"> RM our payload on the next</font>

638
00:25:14,700 --> 00:25:21,120
slide I'll kind<font color="#E5E5E5"> of see why infinite</font>

639
00:25:18,090 --> 00:25:23,060
wisdom they're taking<font color="#E5E5E5"> a an argument that</font>

640
00:25:21,120 --> 00:25:28,439
<font color="#CCCCCC">you're passing to the script and calling</font>

641
00:25:23,060 --> 00:25:30,870
get object<font color="#CCCCCC"> on it yeah like I don't</font><font color="#E5E5E5"> know</font>

642
00:25:28,440 --> 00:25:32,100
so taking something user-supplied and

643
00:25:30,870 --> 00:25:34,290
then what are we calling the object on

644
00:25:32,100 --> 00:25:35,969
it meaning it's just<font color="#E5E5E5"> gonna it's going to</font>

645
00:25:34,290 --> 00:25:37,620
execute whatever you provide it as long

646
00:25:35,970 --> 00:25:40,470
as it's in the format<font color="#CCCCCC"> it's expecting</font>

647
00:25:37,620 --> 00:25:42,659
meaning more or less a comp scriptlet

648
00:25:40,470 --> 00:25:44,040
this was this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> a fun guy he's a lot of</font>

649
00:25:42,660 --> 00:25:46,110
defenders<font color="#CCCCCC"> like from a Red Sea more like</font>

650
00:25:44,040 --> 00:25:49,050
a lot of defenders are now watching for

651
00:25:46,110 --> 00:25:50,669
reg SVR 32 or other techniques to

652
00:25:49,050 --> 00:25:52,590
execute and so if you're doing like

653
00:25:50,670 --> 00:25:55,560
command line auditing or command line

654
00:25:52,590 --> 00:25:58,290
detection this would<font color="#E5E5E5"> be one to watch for</font>

655
00:25:55,560 --> 00:26:01,110
now because you can run that<font color="#CCCCCC"> vb script</font>

656
00:25:58,290 --> 00:26:02,760
with the URL generally<font color="#CCCCCC"> urls on command</font>

657
00:26:01,110 --> 00:26:04,530
line would<font color="#CCCCCC"> be worth investigating but</font>

658
00:26:02,760 --> 00:26:06,930
yeah you're able to pass that remote

659
00:26:04,530 --> 00:26:10,860
scriptlet and get it to execute from the

660
00:26:06,930 --> 00:26:12,420
signed default you know up friend it's

661
00:26:10,860 --> 00:26:14,580
pretty cool yep and that is without any

662
00:26:12,420 --> 00:26:16,500
changes to their registry so the next

663
00:26:14,580 --> 00:26:19,830
example<font color="#E5E5E5"> we're going to cover budget</font>

664
00:26:16,500 --> 00:26:21,420
choirs and some user land changes this

665
00:26:19,830 --> 00:26:23,970
specific one doesn't so it's kind of a

666
00:26:21,420 --> 00:26:25,410
risk versus reward trade-off of so I

667
00:26:23,970 --> 00:26:26,279
want to<font color="#E5E5E5"> make</font><font color="#CCCCCC"> changes to the</font><font color="#E5E5E5"> system so i</font>

668
00:26:25,410 --> 00:26:27,690
can<font color="#CCCCCC"> actually have</font>

669
00:26:26,279 --> 00:26:30,389
a command-line logging or do I want<font color="#E5E5E5"> to</font>

670
00:26:27,690 --> 00:26:31,950
use<font color="#E5E5E5"> this to you know just inject what I</font>

671
00:26:30,389 --> 00:26:37,678
want to execute within the width of

672
00:26:31,950 --> 00:26:40,559
actual argument so this next example we

673
00:26:37,679 --> 00:26:43,229
<font color="#E5E5E5">kind of talked about you know common</font>

674
00:26:40,559 --> 00:26:46,918
looks in HK see you first as long as the

675
00:26:43,229 --> 00:26:48,929
integrity process is you know medium so

676
00:26:46,919 --> 00:26:50,099
a high integrity processor systems not

677
00:26:48,929 --> 00:26:53,849
going to look in the current user high

678
00:26:50,099 --> 00:26:54,840
for obvious reasons insert asterisk

679
00:26:53,849 --> 00:26:59,418
there because there are certain

680
00:26:54,840 --> 00:27:02,099
situations where it will but yeah so

681
00:26:59,419 --> 00:27:04,619
this specific one is what we're<font color="#CCCCCC"> doing is</font>

682
00:27:02,099 --> 00:27:06,989
we're creating our own so on windows<font color="#E5E5E5"> 7</font>

683
00:27:04,619 --> 00:27:08,968
<font color="#E5E5E5">if you go and look at the class ID you</font>

684
00:27:06,989 --> 00:27:11,960
know registry structure in HK see you it

685
00:27:08,969 --> 00:27:13,889
doesn't exist Windows<font color="#CCCCCC"> 10 does have a few</font>

686
00:27:11,960 --> 00:27:16,830
meaning that there are some per user

687
00:27:13,889 --> 00:27:19,189
convicts registered since<font color="#E5E5E5"> Windows looks</font>

688
00:27:16,830 --> 00:27:21,449
in each case to you first for the

689
00:27:19,190 --> 00:27:24,779
required information to instantiate a

690
00:27:21,450 --> 00:27:27,149
common object we can we<font color="#E5E5E5"> can add what it</font>

691
00:27:24,779 --> 00:27:29,399
looking for so it'll say hey I'm looking

692
00:27:27,149 --> 00:27:31,488
for scripting that dictionary it's not

693
00:27:29,399 --> 00:27:34,918
<font color="#E5E5E5">HKC use now I'm going to go look in hklm</font>

694
00:27:31,489 --> 00:27:36,210
if we give it HP if we give its Krypton

695
00:27:34,919 --> 00:27:37,889
that dictionary<font color="#E5E5E5"> and HK see you it's</font>

696
00:27:36,210 --> 00:27:40,339
<font color="#E5E5E5">going to load it for us that's exactly</font>

697
00:27:37,889 --> 00:27:42,738
<font color="#E5E5E5">what this is doing so we're hijacking a</font>

698
00:27:40,339 --> 00:27:45,629
context that<font color="#CCCCCC"> windows is looking for</font>

699
00:27:42,739 --> 00:27:48,299
specifically and just giving<font color="#CCCCCC"> it our</font>

700
00:27:45,629 --> 00:27:53,580
payload via the script what URL key that

701
00:27:48,299 --> 00:27:56,190
we talked about make sure<font color="#CCCCCC"> that you're</font>

702
00:27:53,580 --> 00:27:57,330
hijacking some common object like this

703
00:27:56,190 --> 00:27:59,519
it's not<font color="#CCCCCC"> going to be something that's</font>

704
00:27:57,330 --> 00:28:02,549
<font color="#E5E5E5">going to break core functionality look</font>

705
00:27:59,519 --> 00:28:04,409
for some obscure com opt if it wouldn't

706
00:28:02,549 --> 00:28:05,908
be<font color="#E5E5E5"> reference often scripting God</font>

707
00:28:04,409 --> 00:28:07,679
dictionaries not may be a good choice

708
00:28:05,909 --> 00:28:10,469
but it's a good example for this yeah

709
00:28:07,679 --> 00:28:12,149
<font color="#E5E5E5">this proof of concept so windows realize</font>

710
00:28:10,469 --> 00:28:13,889
you're really heavily on<font color="#CCCCCC"> comm so if you</font>

711
00:28:12,149 --> 00:28:15,570
<font color="#CCCCCC">hi I've had instances where I've</font>

712
00:28:13,889 --> 00:28:17,218
hijacked the wrong thing and then all

713
00:28:15,570 --> 00:28:18,809
the<font color="#E5E5E5"> sudden nothing works and I have like</font>

714
00:28:17,219 --> 00:28:22,799
<font color="#CCCCCC">three hundred and</font><font color="#E5E5E5"> twenty calculators</font>

715
00:28:18,809 --> 00:28:25,950
running then you have to like revert

716
00:28:22,799 --> 00:28:28,080
your vm<font color="#CCCCCC"> and it's a bad time so tread</font>

717
00:28:25,950 --> 00:28:32,700
cautiously there so the way that this

718
00:28:28,080 --> 00:28:35,460
works is slmgr a VBS this can go for any

719
00:28:32,700 --> 00:28:36,839
anything<font color="#CCCCCC"> that looks for a calm object so</font>

720
00:28:35,460 --> 00:28:38,639
we talked about persistence how<font color="#E5E5E5"> I was</font>

721
00:28:36,839 --> 00:28:39,450
looking for this specific column<font color="#CCCCCC"> be</font>

722
00:28:38,639 --> 00:28:41,580
<font color="#CCCCCC">checked want to use our</font>

723
00:28:39,450 --> 00:28:43,590
logged<font color="#E5E5E5"> in and we can hijack it this is a</font>

724
00:28:41,580 --> 00:28:46,039
similar thing only this<font color="#E5E5E5"> is in the aspect</font>

725
00:28:43,590 --> 00:28:48,449
of getting around coming online logging

726
00:28:46,039 --> 00:28:52,379
so this is<font color="#E5E5E5"> vbscript that exists on</font>

727
00:28:48,450 --> 00:28:54,029
<font color="#CCCCCC">Windows it's signed what it does one of</font>

728
00:28:52,380 --> 00:28:57,090
the first things actually does is create

729
00:28:54,029 --> 00:28:59,789
scripting got dictionary to use so if we

730
00:28:57,090 --> 00:29:01,590
create<font color="#E5E5E5"> that nhk you know current user</font>

731
00:28:59,789 --> 00:29:03,480
<font color="#E5E5E5">hive we create scripting that dictionary</font>

732
00:29:01,590 --> 00:29:06,000
and give<font color="#CCCCCC"> it you know the script what URL</font>

733
00:29:03,480 --> 00:29:08,340
to our payload you keep in mind you

734
00:29:06,000 --> 00:29:09,690
don't have to do scriptlet URL to the

735
00:29:08,340 --> 00:29:10,889
internet so some people are like<font color="#E5E5E5"> well</font>

736
00:29:09,690 --> 00:29:12,809
<font color="#CCCCCC">i'm just going to</font><font color="#E5E5E5"> look for network</font>

737
00:29:10,889 --> 00:29:14,219
connections and you know<font color="#CCCCCC"> i'm going</font><font color="#E5E5E5"> to</font>

738
00:29:12,809 --> 00:29:16,769
<font color="#E5E5E5">look for</font><font color="#CCCCCC"> comm script with you can in</font>

739
00:29:14,220 --> 00:29:19,080
proc server 32<font color="#CCCCCC"> dzieki that actually</font>

740
00:29:16,769 --> 00:29:20,940
points to the dll that the<font color="#CCCCCC"> comm that you</font>

741
00:29:19,080 --> 00:29:22,889
know that it's going<font color="#E5E5E5"> to look forward to</font>

742
00:29:20,940 --> 00:29:24,990
load of cum object I'm you can point

743
00:29:22,889 --> 00:29:27,510
that to your dll you can write your<font color="#CCCCCC"> own</font>

744
00:29:24,990 --> 00:29:29,220
dll that has you know<font color="#CCCCCC"> to exports is</font>

745
00:29:27,510 --> 00:29:31,230
<font color="#E5E5E5">looking for and when it goes</font><font color="#CCCCCC"> to load</font>

746
00:29:29,220 --> 00:29:32,519
that key it's going to run your dll this

747
00:29:31,230 --> 00:29:34,769
is just nice if you don't have to drop a

748
00:29:32,519 --> 00:29:39,600
binary on disk this<font color="#E5E5E5"> is not the only</font>

749
00:29:34,769 --> 00:29:41,399
method of abusing it so we create those

750
00:29:39,600 --> 00:29:43,049
keys import them and now all you can see

751
00:29:41,399 --> 00:29:45,449
from a<font color="#E5E5E5"> command-line logging perspective</font>

752
00:29:43,049 --> 00:29:47,908
the only thing<font color="#E5E5E5"> I started was slmgr</font><font color="#CCCCCC"> at</font>

753
00:29:45,450 --> 00:29:49,799
<font color="#E5E5E5">VBS and our payload is getting executed</font>

754
00:29:47,909 --> 00:29:53,519
so all the malicious stuffs happening is

755
00:29:49,799 --> 00:29:56,668
happening on the back end when SL gri

756
00:29:53,519 --> 00:29:58,110
VBS runs it goes<font color="#CCCCCC"> with try students</font><font color="#E5E5E5"> the</font>

757
00:29:56,669 --> 00:30:00,240
<font color="#E5E5E5">in Shh scripting that dictionary it says</font>

758
00:29:58,110 --> 00:30:01,590
okay I need I have this progid now<font color="#E5E5E5"> I</font>

759
00:30:00,240 --> 00:30:03,409
need to<font color="#E5E5E5"> go in the registry and finance</font>

760
00:30:01,590 --> 00:30:06,269
class ID and find what server I need to

761
00:30:03,409 --> 00:30:07,919
initiate and all this stuff books in HK

762
00:30:06,269 --> 00:30:10,740
see you and it says hey<font color="#CCCCCC"> I found it</font>

763
00:30:07,919 --> 00:30:12,389
that's because you quit there and

764
00:30:10,740 --> 00:30:13,740
instead<font color="#E5E5E5"> of giving it what it needed we</font>

765
00:30:12,389 --> 00:30:17,399
gave it our payload then it gets

766
00:30:13,740 --> 00:30:20,010
executed so tyranny does not change<font color="#E5E5E5"> the</font>

767
00:30:17,399 --> 00:30:21,449
signature of the file obviously you're

768
00:30:20,010 --> 00:30:25,019
not modifying the contents of it or

769
00:30:21,450 --> 00:30:26,130
anything so most people or some of<font color="#E5E5E5"> the</font>

770
00:30:25,019 --> 00:30:29,429
command my perspective we're going to

771
00:30:26,130 --> 00:30:31,260
does not really think twice about it<font color="#E5E5E5"> so</font>

772
00:30:29,429 --> 00:30:34,110
I<font color="#E5E5E5"> really good thing to look forward be</font>

773
00:30:31,260 --> 00:30:35,908
you know here are the scripts that<font color="#CCCCCC"> exist</font>

774
00:30:34,110 --> 00:30:37,590
<font color="#E5E5E5">on the system's here are the</font><font color="#CCCCCC"> comm</font>

775
00:30:35,909 --> 00:30:39,120
objects they're looking to<font color="#CCCCCC"> indent she</font>

776
00:30:37,590 --> 00:30:40,769
ate maybe we should look at and see are

777
00:30:39,120 --> 00:30:43,529
these objects being created in HK see

778
00:30:40,769 --> 00:30:44,940
you or not jean skirts<font color="#CCCCCC"> or w script</font>

779
00:30:43,529 --> 00:30:47,760
making<font color="#E5E5E5"> network columns would be another</font>

780
00:30:44,940 --> 00:30:49,320
good indicator for somebody something

781
00:30:47,760 --> 00:30:51,179
somebody running these it's patching

782
00:30:49,320 --> 00:30:52,929
strippers from the internet it's also

783
00:30:51,179 --> 00:30:56,330
doing

784
00:30:52,930 --> 00:30:58,280
so also<font color="#E5E5E5"> clever clever way to bypass app</font>

785
00:30:56,330 --> 00:30:59,750
locker so Casey's doing a lot of really

786
00:30:58,280 --> 00:31:01,340
excellent work on<font color="#CCCCCC"> AppLocker and getting</font>

787
00:30:59,750 --> 00:31:05,060
around it this is another clever way of

788
00:31:01,340 --> 00:31:07,580
circumventing it again the same the same

789
00:31:05,060 --> 00:31:09,260
bug exists in multiple<font color="#CCCCCC"> scripts so the</font>

790
00:31:07,580 --> 00:31:11,810
with the script that exists on Windows

791
00:31:09,260 --> 00:31:13,280
to set up when RM does the same thing

792
00:31:11,810 --> 00:31:15,169
and instantiate scripting that

793
00:31:13,280 --> 00:31:18,050
dictionary that instantiates other

794
00:31:15,170 --> 00:31:19,790
objects as well there are more scripts

795
00:31:18,050 --> 00:31:21,620
other than<font color="#E5E5E5"> those two</font><font color="#CCCCCC"> that in st. GA calm</font>

796
00:31:19,790 --> 00:31:23,810
objects so if you guys<font color="#E5E5E5"> are feeling</font>

797
00:31:21,620 --> 00:31:26,600
froggy you<font color="#E5E5E5"> can go look at them I'm</font>

798
00:31:23,810 --> 00:31:29,000
tinker with it no sir<font color="#CCCCCC"> saucon says we're</font>

799
00:31:26,600 --> 00:31:31,310
create object get<font color="#CCCCCC"> object and those are</font>

800
00:31:29,000 --> 00:31:35,240
interesting<font color="#CCCCCC"> tom classes you could hijack</font>

801
00:31:31,310 --> 00:31:38,659
in the situation yes so who's familiar

802
00:31:35,240 --> 00:31:41,240
with a math I so<font color="#E5E5E5"> Windows 10 they</font>

803
00:31:38,660 --> 00:31:43,700
implemented the anti malware scan

804
00:31:41,240 --> 00:31:47,210
interface and<font color="#CCCCCC"> now idea behind a msi just</font>

805
00:31:43,700 --> 00:31:49,640
a quick overview what's your kind of you

806
00:31:47,210 --> 00:31:51,770
know being visibility at a very low

807
00:31:49,640 --> 00:31:54,110
level of<font color="#E5E5E5"> what's happening for scripting</font>

808
00:31:51,770 --> 00:31:56,960
<font color="#CCCCCC">components so the</font><font color="#E5E5E5"> windows scripting</font><font color="#CCCCCC"> host</font>

809
00:31:54,110 --> 00:31:59,240
and power<font color="#E5E5E5"> custom specifically</font><font color="#CCCCCC"> PowerShell</font>

810
00:31:56,960 --> 00:32:04,010
has been a huge thing<font color="#E5E5E5"> of everybody's</font>

811
00:31:59,240 --> 00:32:06,170
using militias PowerShell now AMS<font color="#E5E5E5"> I was</font>

812
00:32:04,010 --> 00:32:09,020
introduced to kind of hook so everybody

813
00:32:06,170 --> 00:32:11,150
is<font color="#E5E5E5"> doing all this obfuscation encryption</font>

814
00:32:09,020 --> 00:32:14,210
decryption all is crazy crazy stuff that

815
00:32:11,150 --> 00:32:16,370
<font color="#E5E5E5">takes time to develop a mess I hooks</font>

816
00:32:14,210 --> 00:32:18,830
right before the interpreter evaluates

817
00:32:16,370 --> 00:32:20,840
the code meaning all of that encoded and

818
00:32:18,830 --> 00:32:24,550
encrypted content has to be decoded and

819
00:32:20,840 --> 00:32:27,770
decrypted for runtime and my<font color="#CCCCCC"> site hooks</font>

820
00:32:24,550 --> 00:32:29,360
<font color="#CCCCCC">quote-unquote hooks right before</font>

821
00:32:27,770 --> 00:32:31,280
execution meaning all that's already

822
00:32:29,360 --> 00:32:33,320
decoded and decrypted<font color="#CCCCCC"> and it can safely</font>

823
00:32:31,280 --> 00:32:38,540
evaluate if the contents actually safe

824
00:32:33,320 --> 00:32:40,159
or not so it's really solid it stops me

825
00:32:38,540 --> 00:32:43,310
me cats and powershell for<font color="#CCCCCC"> the most part</font>

826
00:32:40,160 --> 00:32:44,840
it hooks when a scripting host this is

827
00:32:43,310 --> 00:32:47,770
an example<font color="#CCCCCC"> of where you can see that</font>

828
00:32:44,840 --> 00:32:50,840
this is this paste bin link here is just

829
00:32:47,770 --> 00:32:53,840
the<font color="#CCCCCC"> verdi it's a text document microsoft</font>

830
00:32:50,840 --> 00:32:56,540
put out that it's an<font color="#E5E5E5"> msi test file to</font>

831
00:32:53,840 --> 00:32:58,820
trigger a msi so as this works is when

832
00:32:56,540 --> 00:33:01,310
you start powershell msi is loaded into

833
00:32:58,820 --> 00:33:04,909
the current process and then when it

834
00:33:01,310 --> 00:33:05,810
gets to a point of executing code what

835
00:33:04,910 --> 00:33:08,870
is<font color="#E5E5E5"> actually half</font>

836
00:33:05,810 --> 00:33:11,750
if using a version of a<font color="#E5E5E5"> comedy act of</font>

837
00:33:08,870 --> 00:33:14,419
itself to execute methods of you know

838
00:33:11,750 --> 00:33:17,930
scanning for evaluating the content

839
00:33:14,420 --> 00:33:20,420
that's being pastor executed so what we

840
00:33:17,930 --> 00:33:22,940
can do here is that is the class ID for

841
00:33:20,420 --> 00:33:24,170
a mess is that it's<font color="#E5E5E5"> looking to you know</font>

842
00:33:22,940 --> 00:33:25,940
it<font color="#CCCCCC"> wasn't a process and then it's</font>

843
00:33:24,170 --> 00:33:29,540
instantiating this collage<font color="#CCCCCC"> X so</font><font color="#E5E5E5"> I can</font>

844
00:33:25,940 --> 00:33:31,340
scan the content because it's medium

845
00:33:29,540 --> 00:33:33,290
integrity it's running on a user like

846
00:33:31,340 --> 00:33:35,060
<font color="#E5E5E5">its users process it's looking at HK see</font>

847
00:33:33,290 --> 00:33:39,050
you first like everything else meaning

848
00:33:35,060 --> 00:33:41,690
we can create that specific class ID by

849
00:33:39,050 --> 00:33:43,790
hand and then just point it at a random

850
00:33:41,690 --> 00:33:45,590
vol de<font color="#CCCCCC"> l'eau doesn't have to exist if</font>

851
00:33:43,790 --> 00:33:47,330
you want to get<font color="#E5E5E5"> code execution whenever</font>

852
00:33:45,590 --> 00:33:48,980
a mess<font color="#E5E5E5"> I tried to scan something you can</font>

853
00:33:47,330 --> 00:33:52,070
put<font color="#E5E5E5"> that as a legitimate or not</font>

854
00:33:48,980 --> 00:33:53,540
legitimate see look to that would give

855
00:33:52,070 --> 00:33:55,149
you code execution whenever it tries to

856
00:33:53,540 --> 00:33:57,710
<font color="#CCCCCC">actually see</font><font color="#E5E5E5"> an content which is fun</font>

857
00:33:55,150 --> 00:33:59,600
this go away a mess like that dll is

858
00:33:57,710 --> 00:34:02,390
just a deal law doesn't exist so when it

859
00:33:59,600 --> 00:34:04,730
queries in proc server 32 key you<font color="#E5E5E5"> can</font>

860
00:34:02,390 --> 00:34:06,470
see<font color="#CCCCCC"> i</font><font color="#E5E5E5"> need to look here for this column</font>

861
00:34:04,730 --> 00:34:08,260
<font color="#E5E5E5">object and it's going to say oh ho scale</font>

862
00:34:06,470 --> 00:34:11,659
doesn't exist so it's<font color="#E5E5E5"> not going to load</font>

863
00:34:08,260 --> 00:34:14,690
and it just fails open meaning after we

864
00:34:11,659 --> 00:34:16,850
import this<font color="#CCCCCC"> to to just to really small</font>

865
00:34:14,690 --> 00:34:19,670
changes you can see now that<font color="#CCCCCC"> the we</font>

866
00:34:16,850 --> 00:34:23,150
restart powershell<font color="#CCCCCC"> MSI's reload</font><font color="#E5E5E5"> into the</font>

867
00:34:19,670 --> 00:34:24,590
process and we reevaluate that msi test

868
00:34:23,150 --> 00:34:28,760
sample we can see a no<font color="#E5E5E5"> longer gets</font>

869
00:34:24,590 --> 00:34:31,940
flagged by msi<font color="#E5E5E5"> i hope this gets fixed</font>

870
00:34:28,760 --> 00:34:37,640
they fix all the other bypasses so

871
00:34:31,940 --> 00:34:39,260
hopefully this one does too so<font color="#CCCCCC"> much</font><font color="#E5E5E5"> this</font>

872
00:34:37,639 --> 00:34:41,620
office add-in again<font color="#CCCCCC"> i</font><font color="#E5E5E5"> said at the</font>

873
00:34:39,260 --> 00:34:45,050
<font color="#E5E5E5">beginning NWR put out a really good</font>

874
00:34:41,620 --> 00:34:48,830
article just a few<font color="#E5E5E5"> days ago about using</font>

875
00:34:45,050 --> 00:34:51,050
office add-ins for persistent<font color="#E5E5E5"> i need to</font>

876
00:34:48,830 --> 00:34:53,210
<font color="#E5E5E5">find</font><font color="#CCCCCC"> the blog post there there's</font><font color="#E5E5E5"> been a</font>

877
00:34:51,050 --> 00:34:54,440
lot of malware so there are comp believe

878
00:34:53,210 --> 00:34:56,420
it<font color="#CCCCCC"> or</font><font color="#E5E5E5"> not if you go and look at</font><font color="#CCCCCC"> calm</font>

879
00:34:54,440 --> 00:34:58,040
there are common objects true anything

880
00:34:56,420 --> 00:35:01,040
more<font color="#E5E5E5"> or less anything</font><font color="#CCCCCC"> your heart desires</font>

881
00:34:58,040 --> 00:35:03,200
to do in<font color="#CCCCCC"> windows who's familiar with the</font>

882
00:35:01,040 --> 00:35:05,750
alwah cruel attack so creating malicious

883
00:35:03,200 --> 00:35:07,160
outlet rules to persist on box that's

884
00:35:05,750 --> 00:35:09,320
always fun because they wipe the box

885
00:35:07,160 --> 00:35:10,670
these are such their outlook profile

886
00:35:09,320 --> 00:35:12,260
back up and then all of a sudden<font color="#CCCCCC"> the</font>

887
00:35:10,670 --> 00:35:14,600
world is executed and<font color="#E5E5E5"> you're back on</font>

888
00:35:12,260 --> 00:35:16,880
their box there are calm objects to

889
00:35:14,600 --> 00:35:18,560
interact with<font color="#CCCCCC"> outlook</font><font color="#E5E5E5"> Word Excel meaning</font>

890
00:35:16,880 --> 00:35:19,430
you can programmatically create those

891
00:35:18,560 --> 00:35:24,589
rules we have

892
00:35:19,430 --> 00:35:26,629
object you can run macros so word macros

893
00:35:24,589 --> 00:35:29,450
even if they're disabled without

894
00:35:26,630 --> 00:35:30,980
notification if you have code execution

895
00:35:29,450 --> 00:35:35,149
on the system more<font color="#E5E5E5"> or less for</font>

896
00:35:30,980 --> 00:35:38,300
persistence you can execute a vba macro

897
00:35:35,150 --> 00:35:41,540
via the order<font color="#CCCCCC"> Excel Kyle objects</font><font color="#E5E5E5"> and it</font>

898
00:35:38,300 --> 00:35:47,990
will run regardless of if you know

899
00:35:41,540 --> 00:35:50,420
macros are disabled or not actually

900
00:35:47,990 --> 00:35:53,868
using that tactic so she never<font color="#CCCCCC"> replies</font>

901
00:35:50,420 --> 00:35:55,280
yep and this is the oh yeah<font color="#CCCCCC"> alright so</font>

902
00:35:53,869 --> 00:35:57,920
this is really<font color="#CCCCCC"> interesting so privilege</font>

903
00:35:55,280 --> 00:36:00,470
escalation this was a a CBE that came

904
00:35:57,920 --> 00:36:03,380
out earlier<font color="#E5E5E5"> I</font><font color="#CCCCCC"> think was in March</font><font color="#E5E5E5"> and so</font>

905
00:36:00,470 --> 00:36:06,078
this was a calm object that you could

906
00:36:03,380 --> 00:36:09,140
<font color="#E5E5E5">create or request a calm object to be</font>

907
00:36:06,079 --> 00:36:11,510
created rather in another user session

908
00:36:09,140 --> 00:36:12,859
so this becomes really interesting<font color="#E5E5E5"> when</font>

909
00:36:11,510 --> 00:36:14,720
you're<font color="#E5E5E5"> thinking about a terminal server</font>

910
00:36:12,859 --> 00:36:16,759
or rdp situation where you have an

911
00:36:14,720 --> 00:36:21,109
aggregated box where multiple accounts

912
00:36:16,760 --> 00:36:23,059
are on and the a normal user happens to

913
00:36:21,109 --> 00:36:25,490
be on at the same<font color="#E5E5E5"> time and say a domain</font>

914
00:36:23,059 --> 00:36:28,040
admin or<font color="#CCCCCC"> helpdesk</font><font color="#E5E5E5"> somebody with more</font>

915
00:36:25,490 --> 00:36:29,750
privileged access<font color="#CCCCCC"> requests to run mimi</font>

916
00:36:28,040 --> 00:36:31,369
caps in their session and it would work

917
00:36:29,750 --> 00:36:33,859
just fine<font color="#E5E5E5"> for example create whatever</font>

918
00:36:31,369 --> 00:36:36,109
process you wanted so the way this would

919
00:36:33,859 --> 00:36:41,390
work and<font color="#E5E5E5"> I encourage you to read the</font>

920
00:36:36,109 --> 00:36:42,950
<font color="#CCCCCC">details the CBE is 2017 0-100 found by</font>

921
00:36:41,390 --> 00:36:44,960
James Porsche and I just borrowed a

922
00:36:42,950 --> 00:36:47,390
slide from his presentation to kind of

923
00:36:44,960 --> 00:36:48,799
articulate this pretty well over on the

924
00:36:47,390 --> 00:36:51,200
<font color="#CCCCCC">lap</font><font color="#E5E5E5"> year since we have a normal</font><font color="#CCCCCC"> user</font>

925
00:36:48,799 --> 00:36:53,950
Alice who requests I want<font color="#E5E5E5"> to create this</font>

926
00:36:51,200 --> 00:36:55,848
particular<font color="#CCCCCC"> com objected to have a</font>

927
00:36:53,950 --> 00:36:59,839
<font color="#E5E5E5">property that would let you create a</font>

928
00:36:55,849 --> 00:37:02,180
<font color="#CCCCCC">process in another user session so when</font>

929
00:36:59,839 --> 00:37:04,279
that came out one of<font color="#E5E5E5"> our colleagues</font>

930
00:37:02,180 --> 00:37:06,169
Julian realized this pretty quickly he

931
00:37:04,280 --> 00:37:08,270
was<font color="#E5E5E5"> on an assessment and he has a really</font>

932
00:37:06,170 --> 00:37:10,549
good<font color="#E5E5E5"> blog post that articulated like</font>

933
00:37:08,270 --> 00:37:13,460
within a week of<font color="#E5E5E5"> the patch coming out</font>

934
00:37:10,549 --> 00:37:16,130
like in most organizations there's a lag

935
00:37:13,460 --> 00:37:18,710
between patch obviously availability and

936
00:37:16,130 --> 00:37:20,780
deployment right so he was able to

937
00:37:18,710 --> 00:37:22,609
actually use this to escalate from a

938
00:37:20,780 --> 00:37:24,440
normal user account to a domain admin

939
00:37:22,609 --> 00:37:27,109
because he happened to be on a server

940
00:37:24,440 --> 00:37:29,750
2012 box it was vulnerable to this so

941
00:37:27,109 --> 00:37:32,359
it's really a fascinating abuse of

942
00:37:29,750 --> 00:37:33,110
functionality if you will for<font color="#E5E5E5"> calm that</font>

943
00:37:32,359 --> 00:37:35,090
has been fixed

944
00:37:33,110 --> 00:37:36,830
but there are probably more of<font color="#E5E5E5"> these</font>

945
00:37:35,090 --> 00:37:39,080
situations<font color="#CCCCCC"> that will continue</font><font color="#E5E5E5"> to arrive</font>

946
00:37:36,830 --> 00:37:41,750
so<font color="#E5E5E5"> be sure to check out Julian's blog</font>

947
00:37:39,080 --> 00:37:43,460
he's on<font color="#CCCCCC"> twitter uh nope sled if you want</font>

948
00:37:41,750 --> 00:37:45,920
to<font color="#E5E5E5"> check out some of his research there</font>

949
00:37:43,460 --> 00:37:47,510
too so that was really how<font color="#E5E5E5"> many of you</font>

950
00:37:45,920 --> 00:37:48,800
<font color="#E5E5E5">have heard of that one or aware of it</font>

951
00:37:47,510 --> 00:37:50,120
<font color="#CCCCCC">okay so it's definitely we're</font><font color="#E5E5E5"> walking in</font>

952
00:37:48,800 --> 00:37:52,670
wanted to raise awareness<font color="#E5E5E5"> for this one</font>

953
00:37:50,120 --> 00:37:57,200
<font color="#E5E5E5">very recent bug that came out so be on</font>

954
00:37:52,670 --> 00:37:59,840
the lookout for that<font color="#E5E5E5"> one yep so that</font>

955
00:37:57,200 --> 00:38:03,020
kind<font color="#CCCCCC"> of highlights you know this just</font>

956
00:37:59,840 --> 00:38:04,790
from 11<font color="#E5E5E5"> edge of the spectrum to the</font>

957
00:38:03,020 --> 00:38:05,690
other of<font color="#E5E5E5"> the kind of abuse that</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> can</font>

958
00:38:04,790 --> 00:38:08,690
take with calm so you've got

959
00:38:05,690 --> 00:38:10,190
functionality<font color="#E5E5E5"> abuse you know some of the</font>

960
00:38:08,690 --> 00:38:11,450
registry manipulation stuff that we

961
00:38:10,190 --> 00:38:13,820
talked about<font color="#E5E5E5"> all the way to the</font><font color="#CCCCCC"> other</font>

962
00:38:11,450 --> 00:38:17,419
end of legitimate vulnerability

963
00:38:13,820 --> 00:38:19,790
exploitation<font color="#E5E5E5"> via a serviceable bug by</font>

964
00:38:17,420 --> 00:38:22,370
Microsoft so the attack service for

965
00:38:19,790 --> 00:38:25,370
comment massive it's existed for a long

966
00:38:22,370 --> 00:38:26,720
time<font color="#E5E5E5"> it's full legacy code so it's not</font>

967
00:38:25,370 --> 00:38:28,549
something people we're looking at I

968
00:38:26,720 --> 00:38:29,959
think project zero<font color="#E5E5E5"> story and truly kind</font>

969
00:38:28,550 --> 00:38:33,620
of take a deep dive into it which is

970
00:38:29,960 --> 00:38:35,720
really<font color="#CCCCCC"> great because it's ugly and it</font>

971
00:38:33,620 --> 00:38:38,630
really needs to<font color="#E5E5E5"> be looked at lateral</font>

972
00:38:35,720 --> 00:38:41,060
movement this is another fun one back to

973
00:38:38,630 --> 00:38:42,560
<font color="#E5E5E5">kind of the functionality</font><font color="#CCCCCC"> of use so</font>

974
00:38:41,060 --> 00:38:44,630
lateral movement techniques have become

975
00:38:42,560 --> 00:38:47,299
relatively stagnant over the last<font color="#E5E5E5"> few</font>

976
00:38:44,630 --> 00:38:49,070
years so you've got TS exact<font color="#CCCCCC"> wmi and you</font>

977
00:38:47,300 --> 00:38:51,830
know kind of standard trade crappy

978
00:38:49,070 --> 00:38:53,270
things that I Packers are using the

979
00:38:51,830 --> 00:38:54,560
fenders catch on to that and<font color="#CCCCCC"> you</font><font color="#E5E5E5"> know</font>

980
00:38:53,270 --> 00:38:57,650
they<font color="#CCCCCC"> can kind of community signatures</font>

981
00:38:54,560 --> 00:39:00,230
down to a specific technique I don't

982
00:38:57,650 --> 00:39:02,330
<font color="#E5E5E5">like being I don't like keeping things</font>

983
00:39:00,230 --> 00:39:03,680
stagnant and getting<font color="#CCCCCC"> signatures all the</font>

984
00:39:02,330 --> 00:39:05,569
<font color="#CCCCCC">time so it's a lot of</font><font color="#E5E5E5"> work</font><font color="#CCCCCC"> to kind of</font>

985
00:39:03,680 --> 00:39:07,940
devise methods for getting around so no

986
00:39:05,570 --> 00:39:10,790
static signatures especially when it's

987
00:39:07,940 --> 00:39:12,920
based off of a technique so viewing or

988
00:39:10,790 --> 00:39:15,350
manipulating a technique is kind of

989
00:39:12,920 --> 00:39:17,180
difficult so I set out to kind<font color="#E5E5E5"> of find</font>

990
00:39:15,350 --> 00:39:19,670
an alternate way of getting code

991
00:39:17,180 --> 00:39:21,589
execution remotely since we are looking

992
00:39:19,670 --> 00:39:23,540
at<font color="#CCCCCC"> com there's a thing called decom</font>

993
00:39:21,590 --> 00:39:25,430
which is<font color="#E5E5E5"> just</font><font color="#CCCCCC"> a distributed component</font>

994
00:39:23,540 --> 00:39:29,570
object model and it's essentially remote

995
00:39:25,430 --> 00:39:31,399
<font color="#CCCCCC">calm it's over</font><font color="#E5E5E5"> RPC you have to be</font>

996
00:39:29,570 --> 00:39:33,140
authenticated for the most part so there

997
00:39:31,400 --> 00:39:34,850
are three objects that<font color="#E5E5E5"> I identified</font>

998
00:39:33,140 --> 00:39:36,740
there are more so<font color="#CCCCCC"> i can i</font><font color="#E5E5E5"> encourage you</font>

999
00:39:34,850 --> 00:39:40,480
<font color="#E5E5E5">to go check this out there are three</font>

1000
00:39:36,740 --> 00:39:40,479
objects that contain interesting methods

1001
00:39:40,670 --> 00:39:45,630
have a<font color="#CCCCCC"> fight nextstep okay so yeah three</font>

1002
00:39:43,320 --> 00:39:48,710
interesting<font color="#E5E5E5"> methods they're all all the</font>

1003
00:39:45,630 --> 00:39:52,140
methods are shellexecute functionality

1004
00:39:48,710 --> 00:39:53,790
meaning you can pass it<font color="#E5E5E5"> you clearly</font>

1005
00:39:52,140 --> 00:39:55,940
<font color="#CCCCCC">shell execution or a binary Zoomer</font>

1006
00:39:53,790 --> 00:39:59,250
command you<font color="#CCCCCC"> can run whatever you want</font>

1007
00:39:55,940 --> 00:40:00,870
this is exposed over decom the reason

1008
00:39:59,250 --> 00:40:03,810
that<font color="#E5E5E5"> this works for these three objects</font>

1009
00:40:00,870 --> 00:40:06,029
two of them<font color="#E5E5E5"> are you know calm objects</font>

1010
00:40:03,810 --> 00:40:09,180
that interface directly with the windows

1011
00:40:06,030 --> 00:40:11,760
shell the other one is<font color="#CCCCCC"> the nmt snappin</font>

1012
00:40:09,180 --> 00:40:14,100
so you know if you're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to connect</font>

1013
00:40:11,760 --> 00:40:16,170
to<font color="#CCCCCC"> Event Viewer instance or get the</font>

1014
00:40:14,100 --> 00:40:18,540
<font color="#E5E5E5">Event Viewer instance remotely you could</font>

1015
00:40:16,170 --> 00:40:19,860
do<font color="#CCCCCC"> that you</font><font color="#E5E5E5"> can open em empty or event</font>

1016
00:40:18,540 --> 00:40:21,290
viewer the MSC connect to remote

1017
00:40:19,860 --> 00:40:23,670
computer and it just magically works

1018
00:40:21,290 --> 00:40:25,170
that's what's happening so these objects

1019
00:40:23,670 --> 00:40:27,510
<font color="#E5E5E5">don't how to explicit launch or</font>

1020
00:40:25,170 --> 00:40:29,250
activation permission I don't know if

1021
00:40:27,510 --> 00:40:32,880
<font color="#CCCCCC">this is on purpose or if it was</font>

1022
00:40:29,250 --> 00:40:34,860
oversight or or what the deal is but the

1023
00:40:32,880 --> 00:40:36,960
vast majority of context or decom

1024
00:40:34,860 --> 00:40:39,390
objects have explicit launch or access

1025
00:40:36,960 --> 00:40:41,040
<font color="#E5E5E5">permissions set meaning administrators</font>

1026
00:40:39,390 --> 00:40:44,490
aren't allowed to remotely into this

1027
00:40:41,040 --> 00:40:45,990
object you know this specific you know

1028
00:40:44,490 --> 00:40:48,629
permission sets allowed to only

1029
00:40:45,990 --> 00:40:50,339
instantiate or not you know you know do

1030
00:40:48,630 --> 00:40:52,350
XYZ so kind of locks it down a little

1031
00:40:50,340 --> 00:40:54,750
bit these objects don't<font color="#E5E5E5"> have any set so</font>

1032
00:40:52,350 --> 00:40:57,720
it folds back to administrators can

1033
00:40:54,750 --> 00:40:59,190
accentuate and activate in their kind of

1034
00:40:57,720 --> 00:41:04,080
interact with these objects remotely

1035
00:40:59,190 --> 00:41:06,420
what that means is<font color="#E5E5E5"> we can</font><font color="#CCCCCC"> yeah we can</font>

1036
00:41:04,080 --> 00:41:08,370
instantiate these objects remotely I'm

1037
00:41:06,420 --> 00:41:10,500
given<font color="#E5E5E5"> it's a lot of movement techniques</font>

1038
00:41:08,370 --> 00:41:13,230
so you've got local admin on the system

1039
00:41:10,500 --> 00:41:15,480
already this is just<font color="#E5E5E5"> a different way</font><font color="#CCCCCC"> of</font>

1040
00:41:13,230 --> 00:41:18,930
getting code execution that's not using

1041
00:41:15,480 --> 00:41:21,510
like w my or PS exec or any of that kind

1042
00:41:18,930 --> 00:41:23,190
of standard stuff so what you're seeing

1043
00:41:21,510 --> 00:41:26,520
here is<font color="#CCCCCC"> Lucas using.net you get the</font>

1044
00:41:23,190 --> 00:41:28,140
<font color="#E5E5E5">types from the class ID and we're</font><font color="#CCCCCC"> giving</font>

1045
00:41:26,520 --> 00:41:30,690
it to class ideas that object we want to

1046
00:41:28,140 --> 00:41:32,160
view and<font color="#E5E5E5"> then an IP address and that's</font>

1047
00:41:30,690 --> 00:41:34,320
going<font color="#E5E5E5"> to be it's going to initiate the</font>

1048
00:41:32,160 --> 00:41:37,799
object on<font color="#CCCCCC"> the remote host and return us</font>

1049
00:41:34,320 --> 00:41:40,080
back a handle so<font color="#CCCCCC"> if you do that and then</font>

1050
00:41:37,800 --> 00:41:42,990
you with the methods and<font color="#CCCCCC"> properties</font>

1051
00:41:40,080 --> 00:41:44,130
festa<font color="#CCCCCC"> Civic object and they will</font><font color="#E5E5E5"> be for</font>

1052
00:41:42,990 --> 00:41:47,580
the<font color="#E5E5E5"> remote computer</font><font color="#CCCCCC"> from your current</font>

1053
00:41:44,130 --> 00:41:49,530
instance so create the incident this

1054
00:41:47,580 --> 00:41:52,170
<font color="#E5E5E5">particular one requires you instantiate</font>

1055
00:41:49,530 --> 00:41:54,520
an item this is a portion<font color="#CCCCCC"> of the windows</font>

1056
00:41:52,170 --> 00:41:56,350
shell has other interest

1057
00:41:54,520 --> 00:41:57,970
methods and properties like its service

1058
00:41:56,350 --> 00:41:59,680
running so you can check and<font color="#E5E5E5"> see</font><font color="#CCCCCC"> if a</font>

1059
00:41:57,970 --> 00:42:02,950
services running you<font color="#CCCCCC"> can stop a service</font>

1060
00:41:59,680 --> 00:42:04,690
you<font color="#E5E5E5"> can start a service there's a lot</font><font color="#CCCCCC"> of</font>

1061
00:42:02,950 --> 00:42:06,790
functionality for things you can do with

1062
00:42:04,690 --> 00:42:10,510
explore that you<font color="#E5E5E5"> can do remotely</font><font color="#CCCCCC"> via</font>

1063
00:42:06,790 --> 00:42:12,490
<font color="#CCCCCC">these objects one of them specifically I</font>

1064
00:42:10,510 --> 00:42:15,700
don't know why does exist document that

1065
00:42:12,490 --> 00:42:18,009
application that shellexecute you just

1066
00:42:15,700 --> 00:42:20,080
pass it command line parameters for you

1067
00:42:18,010 --> 00:42:21,880
know executing or out<font color="#E5E5E5"> show command so</font>

1068
00:42:20,080 --> 00:42:25,000
this is<font color="#CCCCCC"> just example we watch the mdx</font>

1069
00:42:21,880 --> 00:42:29,380
<font color="#E5E5E5">qxc calcutta XD and a rams calc on the</font>

1070
00:42:25,000 --> 00:42:32,290
remote host pretty<font color="#CCCCCC"> straightforward again</font>

1071
00:42:29,380 --> 00:42:34,900
it's our<font color="#CCCCCC"> pc so the firewall does kind of</font>

1072
00:42:32,290 --> 00:42:37,000
tinker with this there are<font color="#E5E5E5"> ways around</font>

1073
00:42:34,900 --> 00:42:40,390
it but the<font color="#CCCCCC"> Windows Firewall does</font>

1074
00:42:37,000 --> 00:42:42,100
relatively kind of it restricts which

1075
00:42:40,390 --> 00:42:45,040
objects you can abused and how you can

1076
00:42:42,100 --> 00:42:46,630
abuse<font color="#E5E5E5"> in pretty calm I often see people</font>

1077
00:42:45,040 --> 00:42:48,009
disabled the Windows Firewall because

1078
00:42:46,630 --> 00:42:50,140
they're running semantics firewall and

1079
00:42:48,010 --> 00:42:54,250
it's uber wheat and Microsoft isn't as

1080
00:42:50,140 --> 00:42:56,500
their excuse every single time I've used

1081
00:42:54,250 --> 00:42:58,570
this he has some sort<font color="#E5E5E5"> of Av firewall or</font>

1082
00:42:56,500 --> 00:43:01,960
custom other firewall it does not

1083
00:42:58,570 --> 00:43:03,820
prevent this for some reasons another

1084
00:43:01,960 --> 00:43:06,040
thing<font color="#CCCCCC"> to consider is admins need to be</font>

1085
00:43:03,820 --> 00:43:08,470
able<font color="#E5E5E5"> to remotely inches up as well so</font>

1086
00:43:06,040 --> 00:43:10,330
<font color="#E5E5E5">admins are using</font><font color="#CCCCCC"> nmc snappings to</font>

1087
00:43:08,470 --> 00:43:12,819
connect<font color="#E5E5E5"> the computers</font><font color="#CCCCCC"> to you scheduled</font>

1088
00:43:10,330 --> 00:43:15,430
tasks or you know if you event logs or

1089
00:43:12,820 --> 00:43:17,770
do whatever they want<font color="#CCCCCC"> they have to allow</font>

1090
00:43:15,430 --> 00:43:19,629
do you come in<font color="#E5E5E5"> and that's that's a</font>

1091
00:43:17,770 --> 00:43:20,890
pretty common configuration thing in the

1092
00:43:19,630 --> 00:43:23,830
<font color="#CCCCCC">Windows Firewall if they are using</font>

1093
00:43:20,890 --> 00:43:26,259
another windows firewall places will

1094
00:43:23,830 --> 00:43:29,110
often explicitly allow be calm and RPC

1095
00:43:26,260 --> 00:43:32,590
<font color="#CCCCCC">in which means you can you can diffuse</font>

1096
00:43:29,110 --> 00:43:40,690
as much as you want any questions<font color="#E5E5E5"> on</font>

1097
00:43:32,590 --> 00:43:44,770
that so I use James for<font color="#E5E5E5"> Shaw's</font><font color="#CCCCCC"> oliva net</font>

1098
00:43:40,690 --> 00:43:46,600
to go through the<font color="#CCCCCC"> ecomm objects</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> I</font>

1099
00:43:44,770 --> 00:43:49,150
was just<font color="#CCCCCC"> looking for</font><font color="#E5E5E5"> specific ones that</font>

1100
00:43:46,600 --> 00:43:50,770
had no explicit launcher access

1101
00:43:49,150 --> 00:43:53,230
permissions and I just went<font color="#E5E5E5"> one by one</font>

1102
00:43:50,770 --> 00:43:55,630
and instantiate of them and recursively

1103
00:43:53,230 --> 00:43:57,760
<font color="#E5E5E5">looked all the properties and and</font>

1104
00:43:55,630 --> 00:43:59,890
documents or properties and methods that

1105
00:43:57,760 --> 00:44:04,470
it that existed so this one<font color="#CCCCCC"> was kind of</font>

1106
00:43:59,890 --> 00:44:04,470
<font color="#CCCCCC">buried</font><font color="#E5E5E5"> document application shellexecute</font>

1107
00:44:04,590 --> 00:44:09,690
the class ID when you identify

1108
00:44:08,110 --> 00:44:12,040
two objects i don't i<font color="#CCCCCC"> don't think</font>

1109
00:44:09,690 --> 00:44:14,230
specifically that one the other<font color="#E5E5E5"> Explorer</font>

1110
00:44:12,040 --> 00:44:17,740
one they don't have prodigies associated

1111
00:44:14,230 --> 00:44:19,240
with<font color="#E5E5E5"> them and so in jamesport all school</font>

1112
00:44:17,740 --> 00:44:21,490
you can view the class ID for that

1113
00:44:19,240 --> 00:44:24,759
specific object and<font color="#E5E5E5"> Justin seen to it</font>

1114
00:44:21,490 --> 00:44:26,410
that way there's also you've got get

1115
00:44:24,760 --> 00:44:29,650
type some class ID there's also a done

1116
00:44:26,410 --> 00:44:32,589
ms it forget type from progid so we were

1117
00:44:29,650 --> 00:44:34,420
doing new object calm and then the

1118
00:44:32,590 --> 00:44:36,010
progid for<font color="#CCCCCC"> cobb ject that's what's</font>

1119
00:44:34,420 --> 00:44:38,890
<font color="#E5E5E5">happening on the back end</font><font color="#CCCCCC"> and so you can</font>

1120
00:44:36,010 --> 00:44:41,560
<font color="#E5E5E5">kind of mini void that time you know</font>

1121
00:44:38,890 --> 00:44:42,640
agency and she ate it remotely if you're

1122
00:44:41,560 --> 00:44:44,320
sick you're tinkering with different

1123
00:44:42,640 --> 00:44:46,060
objects and you might be<font color="#CCCCCC"> onto something</font>

1124
00:44:44,320 --> 00:44:52,210
that allows for some sort<font color="#E5E5E5"> of remote</font>

1125
00:44:46,060 --> 00:44:54,310
interaction<font color="#E5E5E5"> alright so now what does all</font>

1126
00:44:52,210 --> 00:44:57,730
this<font color="#E5E5E5"> mean like how are we feeling about</font>

1127
00:44:54,310 --> 00:44:59,440
calm so we wanted to again draw

1128
00:44:57,730 --> 00:45:02,110
attention to some of<font color="#E5E5E5"> the tactics that</font>

1129
00:44:59,440 --> 00:45:04,360
adversaries are using with calm give you

1130
00:45:02,110 --> 00:45:06,250
some tool sets to explore learn maybe

1131
00:45:04,360 --> 00:45:10,060
how to research and find some of these

1132
00:45:06,250 --> 00:45:11,680
on your<font color="#CCCCCC"> own and hopefully provide</font>

1133
00:45:10,060 --> 00:45:12,970
questions be a reference so there's a

1134
00:45:11,680 --> 00:45:14,379
lot<font color="#CCCCCC"> of</font><font color="#E5E5E5"> good links in here like I said</font>

1135
00:45:12,970 --> 00:45:16,509
we'll post we had some code earlier

1136
00:45:14,380 --> 00:45:18,040
we're going to release to get repo later

1137
00:45:16,510 --> 00:45:19,870
on it has all these different samples

1138
00:45:18,040 --> 00:45:21,400
the reason we have<font color="#E5E5E5"> those samples is for</font>

1139
00:45:19,870 --> 00:45:22,930
you guys to be able<font color="#CCCCCC"> that run and</font><font color="#E5E5E5"> test</font>

1140
00:45:21,400 --> 00:45:24,970
and look for indicators and look for

1141
00:45:22,930 --> 00:45:26,740
things the way it made show up in your

1142
00:45:24,970 --> 00:45:28,779
environment so those are tools that you

1143
00:45:26,740 --> 00:45:31,930
can use to test like running<font color="#CCCCCC"> the</font>

1144
00:45:28,780 --> 00:45:34,150
<font color="#E5E5E5">vbscript that we hijacked or testing com</font>

1145
00:45:31,930 --> 00:45:36,250
<font color="#E5E5E5">hijack so I think we're doing really</font>

1146
00:45:34,150 --> 00:45:38,680
good on time just a couple<font color="#E5E5E5"> of shout outs</font>

1147
00:45:36,250 --> 00:45:39,820
again we really think for<font color="#CCCCCC"> jeans for show</font>

1148
00:45:38,680 --> 00:45:41,890
on his research I encourage you to

1149
00:45:39,820 --> 00:45:43,450
<font color="#E5E5E5">follow him on Twitter look at his get</font>

1150
00:45:41,890 --> 00:45:46,000
repos you've done some amazing work<font color="#E5E5E5"> or</font>

1151
00:45:43,450 --> 00:45:47,710
<font color="#CCCCCC">comp research also some of the former</font>

1152
00:45:46,000 --> 00:45:49,540
team members<font color="#E5E5E5"> that APD</font><font color="#CCCCCC"> had helped us with</font>

1153
00:45:47,710 --> 00:45:50,710
our research and<font color="#CCCCCC"> also gave</font><font color="#E5E5E5"> us some</font>

1154
00:45:49,540 --> 00:45:52,630
feedback on this talk before we

1155
00:45:50,710 --> 00:45:54,040
presented this so I hope<font color="#CCCCCC"> this is helpful</font>

1156
00:45:52,630 --> 00:45:55,780
I think<font color="#CCCCCC"> at this time we'll open it up</font>

1157
00:45:54,040 --> 00:45:58,270
for questions<font color="#E5E5E5"> so</font><font color="#CCCCCC"> if there's any</font>

1158
00:45:55,780 --> 00:46:00,850
questions let us know first question

1159
00:45:58,270 --> 00:46:03,250
gets a book up there we go all right

1160
00:46:00,850 --> 00:46:05,790
I'll come see me after so<font color="#CCCCCC"> sends any</font><font color="#E5E5E5"> idea</font>

1161
00:46:03,250 --> 00:46:10,150
reference material going<font color="#E5E5E5"> to detection</font>

1162
00:46:05,790 --> 00:46:12,730
tools are added more detail uh you know

1163
00:46:10,150 --> 00:46:14,620
not<font color="#CCCCCC"> no</font><font color="#E5E5E5"> I don't think we have a lot</font><font color="#CCCCCC"> of</font>

1164
00:46:12,730 --> 00:46:16,420
really good references where detection

1165
00:46:14,620 --> 00:46:18,400
is more on creation and locating those

1166
00:46:16,420 --> 00:46:20,290
objects in the registry so as far as

1167
00:46:18,400 --> 00:46:21,400
like detection at scale or detecting

1168
00:46:20,290 --> 00:46:22,600
across the enterprise I don't

1169
00:46:21,400 --> 00:46:24,430
any really good references for those

1170
00:46:22,600 --> 00:46:26,440
good question though so one thing<font color="#CCCCCC"> you</font>

1171
00:46:24,430 --> 00:46:28,899
can potentially look at is at least

1172
00:46:26,440 --> 00:46:33,130
monitoring the current user awkward

1173
00:46:28,900 --> 00:46:36,280
<font color="#E5E5E5">classes clsid have handbook for any new</font>

1174
00:46:33,130 --> 00:46:39,400
creation<font color="#E5E5E5"> windows has the one drives</font>

1175
00:46:36,280 --> 00:46:40,990
registered there on<font color="#E5E5E5"> Windows 10 any of</font>

1176
00:46:39,400 --> 00:46:42,520
you creations or additions outside of

1177
00:46:40,990 --> 00:46:43,859
what you typically have in your

1178
00:46:42,520 --> 00:46:46,390
<font color="#E5E5E5">enterprise would be something to</font>

1179
00:46:43,860 --> 00:46:48,090
eventually look at specifically ones

1180
00:46:46,390 --> 00:46:50,920
that are looking<font color="#E5E5E5"> for script what URL</font>

1181
00:46:48,090 --> 00:46:52,510
that should never exist<font color="#E5E5E5"> if you're gone</font>

1182
00:46:50,920 --> 00:46:55,000
that early that day yeah that's an

1183
00:46:52,510 --> 00:46:56,530
indicator of itself that even the script

1184
00:46:55,000 --> 00:46:58,990
with URLs don't like<font color="#CCCCCC"> miocene</font><font color="#E5E5E5"> never</font>

1185
00:46:56,530 --> 00:47:00,580
really used so<font color="#E5E5E5"> I haven't seen anybody</font>

1186
00:46:58,990 --> 00:47:01,959
using column script looks like for

1187
00:47:00,580 --> 00:47:04,810
production used like we use them for

1188
00:47:01,960 --> 00:47:06,160
<font color="#CCCCCC">pocs but like if you if you do please</font>

1189
00:47:04,810 --> 00:47:08,770
let<font color="#E5E5E5"> me know</font><font color="#CCCCCC"> i'm</font><font color="#E5E5E5"> curious i've found</font>

1190
00:47:06,160 --> 00:47:10,359
anybody that needs those<font color="#E5E5E5"> xml documents</font>

1191
00:47:08,770 --> 00:47:12,640
that can be run in plenty of<font color="#E5E5E5"> other</font>

1192
00:47:10,360 --> 00:47:14,980
containers<font color="#E5E5E5"> you will so like one article</font>

1193
00:47:12,640 --> 00:47:17,259
the<font color="#E5E5E5"> internet I'm like 1995 about it and</font>

1194
00:47:14,980 --> 00:47:18,850
<font color="#CCCCCC">that's it yeah pretty fascinating so</font>

1195
00:47:17,260 --> 00:47:24,450
there's another question here<font color="#E5E5E5"> somewhere</font>

1196
00:47:18,850 --> 00:47:26,830
yep yeah<font color="#E5E5E5"> video we're injecting</font><font color="#CCCCCC"> HD HD you</font>

1197
00:47:24,450 --> 00:47:30,009
and you're<font color="#CCCCCC"> talking about by doing that</font>

1198
00:47:26,830 --> 00:47:33,250
for the malware detection and you said

1199
00:47:30,010 --> 00:47:34,600
there wasn't 646 be something like not

1200
00:47:33,250 --> 00:47:39,340
even checking initially to you and just

1201
00:47:34,600 --> 00:47:41,890
checking fishtail with 64 then it's<font color="#E5E5E5"> hard</font>

1202
00:47:39,340 --> 00:47:44,800
to aim at Haifa yes yes so this question

1203
00:47:41,890 --> 00:47:46,509
<font color="#E5E5E5">was for a mess</font><font color="#CCCCCC"> I would a fixed be you</font>

1204
00:47:44,800 --> 00:47:49,120
know checking hklm and not looking at

1205
00:47:46,510 --> 00:47:51,490
HOA to you the answer is<font color="#CCCCCC"> yes that's not</font>

1206
00:47:49,120 --> 00:47:55,120
something<font color="#E5E5E5"> as a Windows consumer you can</font>

1207
00:47:51,490 --> 00:47:56,529
probably<font color="#E5E5E5"> do obviously a detection</font>

1208
00:47:55,120 --> 00:47:58,569
mechanisms that would be look to that

1209
00:47:56,530 --> 00:48:01,000
specific class ID be created in HK see

1210
00:47:58,570 --> 00:48:03,970
you it's<font color="#E5E5E5"> really kind of falls on the</font>

1211
00:48:01,000 --> 00:48:06,190
Microsoft how<font color="#CCCCCC"> windows overall results</font>

1212
00:48:03,970 --> 00:48:09,069
column object so in order to fix that

1213
00:48:06,190 --> 00:48:11,200
they would have two more or less address

1214
00:48:09,070 --> 00:48:13,390
the larger problem of<font color="#E5E5E5"> calm looking in</font>

1215
00:48:11,200 --> 00:48:15,310
the current user hive which isn't really

1216
00:48:13,390 --> 00:48:18,310
fixable because there are legitimate

1217
00:48:15,310 --> 00:48:20,500
freezer<font color="#CCCCCC"> conduct they could put simply</font>

1218
00:48:18,310 --> 00:48:22,600
<font color="#E5E5E5">proof in so there are some objects that</font>

1219
00:48:20,500 --> 00:48:24,940
present you can creating them in hkg you

1220
00:48:22,600 --> 00:48:27,100
if you go<font color="#E5E5E5"> to create it in HD you despite</font>

1221
00:48:24,940 --> 00:48:29,440
having full access set specific height

1222
00:48:27,100 --> 00:48:30,940
and you go to create the the class ID

1223
00:48:29,440 --> 00:48:32,920
and it<font color="#E5E5E5"> smells you access is denied</font>

1224
00:48:30,940 --> 00:48:34,750
Windows Defender does that so if you try

1225
00:48:32,920 --> 00:48:37,810
and hijack the pod<font color="#E5E5E5"> you four minutes</font>

1226
00:48:34,750 --> 00:48:39,910
I'm<font color="#E5E5E5"> emoji to go jump in a lake msi's</font>

1227
00:48:37,810 --> 00:48:41,170
doesn't so I would expect<font color="#E5E5E5"> Microsoft they</font>

1228
00:48:39,910 --> 00:48:43,980
stay in depth addressing this issue

1229
00:48:41,170 --> 00:48:46,270
would be to you know put restrictions on

1230
00:48:43,980 --> 00:48:50,530
adding a specific class hiding in the

1231
00:48:46,270 --> 00:48:55,920
<font color="#E5E5E5">car you drive to other questions</font>

1232
00:48:50,530 --> 00:48:55,920
feedback comments yes question so<font color="#E5E5E5"> it's a</font>

1233
00:49:01,260 --> 00:49:07,210
good question also some situations like

1234
00:49:04,660 --> 00:49:09,160
where you're running like and though<font color="#CCCCCC"> in</font>

1235
00:49:07,210 --> 00:49:11,350
all<font color="#E5E5E5"> those examples like like calc would</font>

1236
00:49:09,160 --> 00:49:14,290
be the child process of like see scraper

1237
00:49:11,350 --> 00:49:16,660
w script or reg s v r32 so if you're

1238
00:49:14,290 --> 00:49:18,279
creating the process could your courier

1239
00:49:16,660 --> 00:49:21,940
creating a child process using like

1240
00:49:18,280 --> 00:49:23,920
wscript.shell Ron or exact but some of

1241
00:49:21,940 --> 00:49:26,380
these tactics like earlier on the.net

1242
00:49:23,920 --> 00:49:28,480
and jscript it would all stay in<font color="#CCCCCC"> the</font>

1243
00:49:26,380 --> 00:49:30,760
same process and show up as the trusted

1244
00:49:28,480 --> 00:49:33,340
by near so it's just you just CC script

1245
00:49:30,760 --> 00:49:35,320
running and you wouldn't feed me me cats

1246
00:49:33,340 --> 00:49:36,910
for example in the process list so

1247
00:49:35,320 --> 00:49:39,700
you're fully in memory of that process

1248
00:49:36,910 --> 00:49:41,290
that consumed that comp scriptlet does

1249
00:49:39,700 --> 00:49:42,879
<font color="#E5E5E5">that</font><font color="#CCCCCC"> answer the</font><font color="#E5E5E5"> question for the lateral</font>

1250
00:49:41,290 --> 00:49:44,470
movement stuff if you're using the<font color="#E5E5E5"> two</font>

1251
00:49:42,880 --> 00:49:47,020
objects<font color="#E5E5E5"> that kind of interface with the</font>

1252
00:49:44,470 --> 00:49:50,140
windows shell those processes your

1253
00:49:47,020 --> 00:49:51,850
spawning remotely execute has a child of

1254
00:49:50,140 --> 00:49:55,509
<font color="#CCCCCC">explored</font><font color="#E5E5E5"> ID XP so if you're running</font>

1255
00:49:51,850 --> 00:49:57,520
something yell calculator XD XD is not

1256
00:49:55,510 --> 00:50:00,550
going to<font color="#E5E5E5"> welcome gear running as a child</font>

1257
00:49:57,520 --> 00:50:03,310
copies of<font color="#CCCCCC"> it other</font><font color="#E5E5E5"> cord right so that's</font>

1258
00:50:00,550 --> 00:50:07,150
another thing<font color="#CCCCCC"> to kind</font><font color="#E5E5E5"> of be wary up in</font>

1259
00:50:03,310 --> 00:50:09,130
<font color="#E5E5E5">that regard yes question when you return</font>

1260
00:50:07,150 --> 00:50:11,200
video through the generations<font color="#CCCCCC"> I was</font>

1261
00:50:09,130 --> 00:50:13,630
recording with<font color="#CCCCCC"> the</font><font color="#E5E5E5"> higher cruisers use</font>

1262
00:50:11,200 --> 00:50:16,149
your head<font color="#E5E5E5"> walk in at the time yep Sinta</font>

1263
00:50:13,630 --> 00:50:17,740
yeah so so think of somebody running

1264
00:50:16,150 --> 00:50:19,630
that in a loop that<font color="#E5E5E5"> just waits and</font>

1265
00:50:17,740 --> 00:50:21,009
listens yeah but you're right it whether

1266
00:50:19,630 --> 00:50:23,380
<font color="#E5E5E5">you have to have that simultaneous</font>

1267
00:50:21,010 --> 00:50:30,670
connection for that particular<font color="#CCCCCC"> CPU to be</font>

1268
00:50:23,380 --> 00:50:32,170
trigger<font color="#CCCCCC"> yep other questions thanks</font><font color="#E5E5E5"> again</font>

1269
00:50:30,670 --> 00:50:33,640
to be sides are having us and thank you

1270
00:50:32,170 --> 00:50:35,050
guys for coming out and<font color="#CCCCCC"> we'll be around</font>

1271
00:50:33,640 --> 00:50:39,180
<font color="#E5E5E5">for questions I think we're between you</font>

1272
00:50:35,050 --> 00:50:39,180
and lunch so enjoy your lunch thank

1273
00:50:39,790 --> 00:50:41,850
you

