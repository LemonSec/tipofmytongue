1
00:00:00,240 --> 00:00:02,000
let's get started with our next talk

2
00:00:02,000 --> 00:00:03,120
from mark

3
00:00:03,120 --> 00:00:06,399
marzins marinsky michael epping

4
00:00:06,399 --> 00:00:08,160
sorry if i butchered your names i owe

5
00:00:08,160 --> 00:00:10,160
you guys a beer so um

6
00:00:10,160 --> 00:00:12,160
let's uh let's get started with hiding

7
00:00:12,160 --> 00:00:13,920
in the clouds how attackers can use

8
00:00:13,920 --> 00:00:15,920
applications for sustained persistence

9
00:00:15,920 --> 00:00:18,720
and how to find them

10
00:00:19,600 --> 00:00:20,960
so michael's going to be driving the

11
00:00:20,960 --> 00:00:22,720
slides and some of the demos and i'm

12
00:00:22,720 --> 00:00:24,080
going to do my best to

13
00:00:24,080 --> 00:00:26,480
watch the chat as well as watch the

14
00:00:26,480 --> 00:00:27,599
discord

15
00:00:27,599 --> 00:00:29,359
so if anyone has any questions they can

16
00:00:29,359 --> 00:00:31,439
uh post it there and i'll try to

17
00:00:31,439 --> 00:00:34,880
keep an eye on it might be all set

18
00:00:34,880 --> 00:00:37,600
yep good to go okay cool so uh hi

19
00:00:37,600 --> 00:00:39,440
everybody so uh welcome to hiding in the

20
00:00:39,440 --> 00:00:40,800
clouds how attackers can use

21
00:00:40,800 --> 00:00:42,879
applications for sustained persistence

22
00:00:42,879 --> 00:00:45,600
and how to find it i am mark marzinski

23
00:00:45,600 --> 00:00:46,879
i'm here with michael upping and we are

24
00:00:46,879 --> 00:00:48,239
program managers

25
00:00:48,239 --> 00:00:50,399
in the identity division at microsoft so

26
00:00:50,399 --> 00:00:51,600
we are responsible for

27
00:00:51,600 --> 00:00:53,280
active directory active directory

28
00:00:53,280 --> 00:00:54,879
federation services and

29
00:00:54,879 --> 00:00:58,719
azure active directory so um

30
00:00:58,719 --> 00:01:00,079
let me go to the next slide there

31
00:01:00,079 --> 00:01:02,879
michael so uh we work on a team

32
00:01:02,879 --> 00:01:06,159
that is working with customers on their

33
00:01:06,159 --> 00:01:07,920
deployments of azure active directory

34
00:01:07,920 --> 00:01:09,520
and we take those learnings and

35
00:01:09,520 --> 00:01:10,960
uh the feedback from those deployments

36
00:01:10,960 --> 00:01:12,479
we work it back into the product to make

37
00:01:12,479 --> 00:01:12,960
it

38
00:01:12,960 --> 00:01:14,479
easier and better for everybody else so

39
00:01:14,479 --> 00:01:16,640
if you have office 365

40
00:01:16,640 --> 00:01:20,000
i know people in b-sides sometimes don't

41
00:01:20,000 --> 00:01:21,280
spend a lot of time in the identity

42
00:01:21,280 --> 00:01:22,960
space like michael and i do if you have

43
00:01:22,960 --> 00:01:24,320
office 365

44
00:01:24,320 --> 00:01:27,600
you have azure active directory so uh

45
00:01:27,600 --> 00:01:28,640
mike and i have worked with a lot of

46
00:01:28,640 --> 00:01:30,400
customers on this issue so i think we

47
00:01:30,400 --> 00:01:31,520
have some good stuff here we're gonna

48
00:01:31,520 --> 00:01:32,880
share so what we're first gonna cover

49
00:01:32,880 --> 00:01:33,520
here

50
00:01:33,520 --> 00:01:36,320
is what is application consent and why

51
00:01:36,320 --> 00:01:38,000
you should care about it if you aren't

52
00:01:38,000 --> 00:01:40,159
already and then i'm going to talk about

53
00:01:40,159 --> 00:01:41,759
what are some of those key permissions

54
00:01:41,759 --> 00:01:43,200
you should be looking for

55
00:01:43,200 --> 00:01:44,720
and then michael's going to go into how

56
00:01:44,720 --> 00:01:46,960
to find um some of the stuff in your

57
00:01:46,960 --> 00:01:48,320
environment and then lastly we're going

58
00:01:48,320 --> 00:01:50,079
to cover some best practices and things

59
00:01:50,079 --> 00:01:51,439
you can go do so there's a lot of stuff

60
00:01:51,439 --> 00:01:52,640
in this talk

61
00:01:52,640 --> 00:01:53,920
we're going to make the slides available

62
00:01:53,920 --> 00:01:56,159
at the very end and uh hopefully we have

63
00:01:56,159 --> 00:01:57,439
lots of good things you can go back and

64
00:01:57,439 --> 00:01:58,719
do in your environment to protect

65
00:01:58,719 --> 00:02:00,240
yourself so okay

66
00:02:00,240 --> 00:02:02,000
why should you care about applications

67
00:02:02,000 --> 00:02:03,920
if you haven't been doing so already so

68
00:02:03,920 --> 00:02:05,360
on average

69
00:02:05,360 --> 00:02:08,800
the organization will have 140 apps

70
00:02:08,800 --> 00:02:11,840
but this can why be a number that varies

71
00:02:11,840 --> 00:02:12,879
greatly

72
00:02:12,879 --> 00:02:14,400
depending on the size of your

73
00:02:14,400 --> 00:02:15,840
organization so some of the customers

74
00:02:15,840 --> 00:02:16,160
that

75
00:02:16,160 --> 00:02:17,840
michael and i work with are extremely

76
00:02:17,840 --> 00:02:19,680
large and it's not uncommon for them to

77
00:02:19,680 --> 00:02:21,200
have thousands and thousands and

78
00:02:21,200 --> 00:02:22,640
thousands of applications one of the

79
00:02:22,640 --> 00:02:24,080
customers i'm working with

80
00:02:24,080 --> 00:02:26,319
um is modernizing their applications to

81
00:02:26,319 --> 00:02:27,840
move to azure ad as their identity

82
00:02:27,840 --> 00:02:28,480
provider

83
00:02:28,480 --> 00:02:29,599
and they think it's going to take them

84
00:02:29,599 --> 00:02:31,920
from anywhere from seven to nine years

85
00:02:31,920 --> 00:02:33,599
to move all their applications to modern

86
00:02:33,599 --> 00:02:35,599
authentication so 140 is just kind of

87
00:02:35,599 --> 00:02:36,959
like a low number but you probably know

88
00:02:36,959 --> 00:02:38,000
better than anyone

89
00:02:38,000 --> 00:02:39,760
how many applications you have in your

90
00:02:39,760 --> 00:02:41,599
environment and

91
00:02:41,599 --> 00:02:45,120
87 of users today can consent to

92
00:02:45,120 --> 00:02:47,120
applications and the the active

93
00:02:47,120 --> 00:02:48,640
consenting to an application which we'll

94
00:02:48,640 --> 00:02:50,879
get into here shortly

95
00:02:50,879 --> 00:02:53,599
isn't necessarily necessarily bad or

96
00:02:53,599 --> 00:02:54,560
malicious

97
00:02:54,560 --> 00:02:57,040
but there is some things that allows an

98
00:02:57,040 --> 00:02:58,959
application to do in your environment

99
00:02:58,959 --> 00:03:00,959
which you may or may not want them to do

100
00:03:00,959 --> 00:03:02,879
as blue teamers right so michael and i

101
00:03:02,879 --> 00:03:04,640
um are really all about this blue team

102
00:03:04,640 --> 00:03:05,840
defense there's a lot of good stuff in

103
00:03:05,840 --> 00:03:07,599
here that you may not be aware of

104
00:03:07,599 --> 00:03:10,000
but you need to as a as those architects

105
00:03:10,000 --> 00:03:11,440
those security folks and those blue team

106
00:03:11,440 --> 00:03:12,319
defenders that

107
00:03:12,319 --> 00:03:13,280
just because you can send to an

108
00:03:13,280 --> 00:03:14,879
application means an application can do

109
00:03:14,879 --> 00:03:16,239
stuff and you may or may not want that

110
00:03:16,239 --> 00:03:17,680
depending on your environment

111
00:03:17,680 --> 00:03:19,200
and your organization and your business

112
00:03:19,200 --> 00:03:20,720
model risk tolerance and things like

113
00:03:20,720 --> 00:03:21,360
that

114
00:03:21,360 --> 00:03:23,280
and then 80 of employees are using

115
00:03:23,280 --> 00:03:24,560
non-approved apps from work you've

116
00:03:24,560 --> 00:03:26,799
probably heard this before this is the

117
00:03:26,799 --> 00:03:29,599
shadow it type of thing where um you

118
00:03:29,599 --> 00:03:30,000
know

119
00:03:30,000 --> 00:03:31,360
and again doesn't mean that they're

120
00:03:31,360 --> 00:03:33,599
they're malicious um it could be just

121
00:03:33,599 --> 00:03:34,159
like

122
00:03:34,159 --> 00:03:37,360
we want people to use box or onedrive

123
00:03:37,360 --> 00:03:39,200
and this business unit is using dropbox

124
00:03:39,200 --> 00:03:40,319
because that's the link that they got

125
00:03:40,319 --> 00:03:41,360
and they didn't know any better and now

126
00:03:41,360 --> 00:03:42,799
we have application you know corporate

127
00:03:42,799 --> 00:03:44,159
data on these different things that

128
00:03:44,159 --> 00:03:45,440
there shouldn't be so

129
00:03:45,440 --> 00:03:46,799
if you haven't started to look at your

130
00:03:46,799 --> 00:03:49,200
applications and data you really really

131
00:03:49,200 --> 00:03:50,879
should so let's talk about what we mean

132
00:03:50,879 --> 00:03:51,760
by when we say

133
00:03:51,760 --> 00:03:55,200
application consent so you're probably

134
00:03:55,200 --> 00:03:56,080
pretty familiar

135
00:03:56,080 --> 00:03:58,560
with this um on your mobile phone right

136
00:03:58,560 --> 00:03:59,120
so you

137
00:03:59,120 --> 00:04:01,439
so you add an application to your phone

138
00:04:01,439 --> 00:04:02,720
um from the app store

139
00:04:02,720 --> 00:04:05,120
or wherever and it says it's asking for

140
00:04:05,120 --> 00:04:06,640
a bunch of permissions that it wants to

141
00:04:06,640 --> 00:04:07,200
be able

142
00:04:07,200 --> 00:04:09,840
to to do so wants to be able to maybe

143
00:04:09,840 --> 00:04:11,760
access your camera because it's gonna

144
00:04:11,760 --> 00:04:12,959
take your picture and you can then

145
00:04:12,959 --> 00:04:14,959
modify it and put funny faces or

146
00:04:14,959 --> 00:04:16,079
whatever you're gonna do on it

147
00:04:16,079 --> 00:04:18,639
and it also wants it access to your

148
00:04:18,639 --> 00:04:20,320
photo library so you can edit past

149
00:04:20,320 --> 00:04:21,600
photos and it also

150
00:04:21,600 --> 00:04:23,520
wants access to your contacts so that

151
00:04:23,520 --> 00:04:24,720
way you can send

152
00:04:24,720 --> 00:04:26,720
that funny photo directly from this

153
00:04:26,720 --> 00:04:28,639
application to your to your co-workers

154
00:04:28,639 --> 00:04:29,919
or friends and family and things like

155
00:04:29,919 --> 00:04:30,560
that

156
00:04:30,560 --> 00:04:33,919
so uh the application consent model um

157
00:04:33,919 --> 00:04:36,160
in azure id and and most cloud apps so

158
00:04:36,160 --> 00:04:37,840
michael and i are going to talk about

159
00:04:37,840 --> 00:04:40,320
um azure id perspective but this applies

160
00:04:40,320 --> 00:04:42,000
to any oauth or open id connect

161
00:04:42,000 --> 00:04:43,199
applications as well so it's not

162
00:04:43,199 --> 00:04:45,280
specific to azure id but

163
00:04:45,280 --> 00:04:46,400
this is what we're going to talk from

164
00:04:46,400 --> 00:04:48,160
from our point of view so this consent

165
00:04:48,160 --> 00:04:49,600
model of application consent and

166
00:04:49,600 --> 00:04:50,160
permissions

167
00:04:50,160 --> 00:04:52,560
is a very very similar model in azure

168
00:04:52,560 --> 00:04:54,479
directory so we have an application

169
00:04:54,479 --> 00:04:56,560
and it's going to want to have access to

170
00:04:56,560 --> 00:04:58,080
organizational data

171
00:04:58,080 --> 00:04:59,759
and that organizational data is going to

172
00:04:59,759 --> 00:05:02,800
be exposed via resource apis

173
00:05:02,800 --> 00:05:04,240
and there's different permission levels

174
00:05:04,240 --> 00:05:05,360
for those apis and we're going to get

175
00:05:05,360 --> 00:05:07,039
into all this here in a little bit

176
00:05:07,039 --> 00:05:08,479
and those permissions can be granted

177
00:05:08,479 --> 00:05:10,320
through the process called application

178
00:05:10,320 --> 00:05:11,759
consent and we have two different types

179
00:05:11,759 --> 00:05:12,639
of consent

180
00:05:12,639 --> 00:05:14,639
we have admin consent and we have end

181
00:05:14,639 --> 00:05:16,320
user consent

182
00:05:16,320 --> 00:05:17,600
but let's talk about some of these

183
00:05:17,600 --> 00:05:18,960
different terms so this is kind of like

184
00:05:18,960 --> 00:05:20,160
a high level thing but let's kind of dig

185
00:05:20,160 --> 00:05:21,520
in to align ourselves

186
00:05:21,520 --> 00:05:24,639
to that open id oauth type of spec so

187
00:05:24,639 --> 00:05:26,320
the first thing here is we have a

188
00:05:26,320 --> 00:05:28,800
term called a client application this is

189
00:05:28,800 --> 00:05:30,400
going to be a it could be a mobile app

190
00:05:30,400 --> 00:05:31,680
it could be a web app it could be an

191
00:05:31,680 --> 00:05:32,639
application that's running in the

192
00:05:32,639 --> 00:05:34,080
background that's going to be requesting

193
00:05:34,080 --> 00:05:34,880
that data

194
00:05:34,880 --> 00:05:36,960
on behalf of that user and then we have

195
00:05:36,960 --> 00:05:38,240
the resource application

196
00:05:38,240 --> 00:05:40,880
which is going to be usually a web api

197
00:05:40,880 --> 00:05:42,560
that exposes this data

198
00:05:42,560 --> 00:05:44,960
or functionality in our in our case here

199
00:05:44,960 --> 00:05:46,639
um at azure id it's going to be called

200
00:05:46,639 --> 00:05:47,919
the microsoft

201
00:05:47,919 --> 00:05:50,560
uh graph and then we have permissions

202
00:05:50,560 --> 00:05:52,080
which is what the client application

203
00:05:52,080 --> 00:05:54,639
is asking to be able to perform on that

204
00:05:54,639 --> 00:05:56,319
data owned by that resource so here we

205
00:05:56,319 --> 00:05:57,600
have a screenshot of this and you may

206
00:05:57,600 --> 00:05:59,120
have seen this in your environment where

207
00:05:59,120 --> 00:06:00,400
we have an application here called

208
00:06:00,400 --> 00:06:02,720
contoso test app and this application

209
00:06:02,720 --> 00:06:04,319
wants to be able to read

210
00:06:04,319 --> 00:06:06,319
users and shared contacts their

211
00:06:06,319 --> 00:06:08,400
calendars and sign in and read their

212
00:06:08,400 --> 00:06:10,319
profile this is going through the

213
00:06:10,319 --> 00:06:12,400
microsoft graph so another example is

214
00:06:12,400 --> 00:06:13,440
like onedrive

215
00:06:13,440 --> 00:06:14,560
some application wants to read the

216
00:06:14,560 --> 00:06:15,840
user's onedrive files all through the

217
00:06:15,840 --> 00:06:17,759
microsoft graph so this is kind of

218
00:06:17,759 --> 00:06:19,680
the dialog box that you'll see here as

219
00:06:19,680 --> 00:06:20,960
an admin or an end user and michael's

220
00:06:20,960 --> 00:06:22,160
going to show you a demo of this here in

221
00:06:22,160 --> 00:06:22,800
a little bit

222
00:06:22,800 --> 00:06:24,960
to kind of go over um you know walk you

223
00:06:24,960 --> 00:06:26,000
through this if you've never seen this

224
00:06:26,000 --> 00:06:27,199
before

225
00:06:27,199 --> 00:06:30,319
but let's talk about some consent

226
00:06:30,319 --> 00:06:33,759
terminology so that dialog box that we

227
00:06:33,759 --> 00:06:34,000
just

228
00:06:34,000 --> 00:06:37,360
showed you is called the consent prompt

229
00:06:37,360 --> 00:06:40,240
um and then we have the act of saying

230
00:06:40,240 --> 00:06:40,720
yes

231
00:06:40,720 --> 00:06:42,479
it's called the consent grant so it's

232
00:06:42,479 --> 00:06:44,479
pretty straightforward

233
00:06:44,479 --> 00:06:47,280
now here is where we differ a little bit

234
00:06:47,280 --> 00:06:48,000
from that

235
00:06:48,000 --> 00:06:50,000
phone type of model that you may or may

236
00:06:50,000 --> 00:06:51,360
not be used to i'm guessing here

237
00:06:51,360 --> 00:06:53,440
everyone is probably used to that model

238
00:06:53,440 --> 00:06:56,400
so the process of administrator consent

239
00:06:56,400 --> 00:06:57,360
is when someone with

240
00:06:57,360 --> 00:06:59,919
administrative permissions is going to

241
00:06:59,919 --> 00:07:02,080
be granting access to an application

242
00:07:02,080 --> 00:07:04,400
and we do this because of two different

243
00:07:04,400 --> 00:07:05,360
reasons

244
00:07:05,360 --> 00:07:07,759
the first reason is the application may

245
00:07:07,759 --> 00:07:09,919
be asking for permissions

246
00:07:09,919 --> 00:07:12,479
that are highly privileged and we don't

247
00:07:12,479 --> 00:07:13,520
want end users

248
00:07:13,520 --> 00:07:15,520
to have the ability to say that's okay

249
00:07:15,520 --> 00:07:16,800
because they don't maybe understand

250
00:07:16,800 --> 00:07:18,000
what's being asked they don't understand

251
00:07:18,000 --> 00:07:19,440
what the risk is to the business they

252
00:07:19,440 --> 00:07:21,039
shouldn't be able to to do this so maybe

253
00:07:21,039 --> 00:07:22,400
the application

254
00:07:22,400 --> 00:07:25,440
is asking for the ability to read and

255
00:07:25,440 --> 00:07:27,280
write to all mailboxes

256
00:07:27,280 --> 00:07:28,880
and maybe that reason is because it's an

257
00:07:28,880 --> 00:07:30,479
e-discovery app

258
00:07:30,479 --> 00:07:32,720
right we don't want end users to be able

259
00:07:32,720 --> 00:07:34,479
to say like that's okay that's that's

260
00:07:34,479 --> 00:07:35,840
quite a bit of permissions

261
00:07:35,840 --> 00:07:37,599
an admin will have to go in there and

262
00:07:37,599 --> 00:07:39,199
say that this is a this is a very

263
00:07:39,199 --> 00:07:40,639
privileged operation

264
00:07:40,639 --> 00:07:42,000
um an admin is gonna have to say it's

265
00:07:42,000 --> 00:07:43,680
okay before we can add that to our to

266
00:07:43,680 --> 00:07:44,960
our directory

267
00:07:44,960 --> 00:07:46,560
the other reason why you want to do this

268
00:07:46,560 --> 00:07:48,479
as an administrator

269
00:07:48,479 --> 00:07:51,759
is because when an administrator does a

270
00:07:51,759 --> 00:07:54,000
consent grant for an application

271
00:07:54,000 --> 00:07:56,479
they're actually consenting to this for

272
00:07:56,479 --> 00:07:58,240
all of the users

273
00:07:58,240 --> 00:08:00,000
in their directory so then users will

274
00:08:00,000 --> 00:08:01,440
not see the consent

275
00:08:01,440 --> 00:08:04,000
dialog box when they go to use that

276
00:08:04,000 --> 00:08:05,680
application as an end user so the best

277
00:08:05,680 --> 00:08:07,599
example i can think about this for

278
00:08:07,599 --> 00:08:11,039
is the native mail client in ios

279
00:08:11,039 --> 00:08:12,240
so if you're going to use it with

280
00:08:12,240 --> 00:08:14,639
exchange online a user you know opens up

281
00:08:14,639 --> 00:08:16,400
the mail app they put their username and

282
00:08:16,400 --> 00:08:17,440
password in they do the whole

283
00:08:17,440 --> 00:08:18,560
authentication flow

284
00:08:18,560 --> 00:08:20,400
and then the application prompts them

285
00:08:20,400 --> 00:08:22,000
for that consent grant experience and it

286
00:08:22,000 --> 00:08:23,120
wants to be able to like read to their

287
00:08:23,120 --> 00:08:24,639
mailbox right to their mailbox some you

288
00:08:24,639 --> 00:08:26,000
know basic stuff right just

289
00:08:26,000 --> 00:08:27,199
whatever it can do and the user can say

290
00:08:27,199 --> 00:08:28,560
yes they can do that and then they go

291
00:08:28,560 --> 00:08:29,840
ahead and click through

292
00:08:29,840 --> 00:08:32,320
and now the native mail app on their ios

293
00:08:32,320 --> 00:08:33,120
device

294
00:08:33,120 --> 00:08:35,440
now gets mail but we could say as

295
00:08:35,440 --> 00:08:37,120
administrators or defenders we can say

296
00:08:37,120 --> 00:08:38,719
you know what we trust this application

297
00:08:38,719 --> 00:08:40,479
and we're okay if people use that

298
00:08:40,479 --> 00:08:42,080
and we want to improve that end user

299
00:08:42,080 --> 00:08:44,080
experience we're going to go in there as

300
00:08:44,080 --> 00:08:45,519
administrators and do an administrative

301
00:08:45,519 --> 00:08:46,240
consent

302
00:08:46,240 --> 00:08:48,080
for this application now the next person

303
00:08:48,080 --> 00:08:49,839
that goes to use that native mail app

304
00:08:49,839 --> 00:08:50,880
for the first time

305
00:08:50,880 --> 00:08:52,480
they will not have to consent to the

306
00:08:52,480 --> 00:08:54,399
application because as administrators

307
00:08:54,399 --> 00:08:57,440
we've already done that consent

308
00:08:57,440 --> 00:09:00,399
okay so there's two different types of

309
00:09:00,399 --> 00:09:02,560
permissions that we're going to

310
00:09:02,560 --> 00:09:04,320
consent grant applications can have and

311
00:09:04,320 --> 00:09:05,600
we can send to that

312
00:09:05,600 --> 00:09:08,399
the first one here is what we want most

313
00:09:08,399 --> 00:09:10,320
applications to be using

314
00:09:10,320 --> 00:09:12,880
which is the delegated permissions model

315
00:09:12,880 --> 00:09:14,080
and this requires

316
00:09:14,080 --> 00:09:16,320
for an application to work the user must

317
00:09:16,320 --> 00:09:17,120
be signed in

318
00:09:17,120 --> 00:09:19,120
and present for the application to make

319
00:09:19,120 --> 00:09:21,120
calls on behalf of that user so this is

320
00:09:21,120 --> 00:09:22,000
what

321
00:09:22,000 --> 00:09:24,560
most end users can consent to and if

322
00:09:24,560 --> 00:09:25,760
it's a higher

323
00:09:25,760 --> 00:09:27,519
privileged permission this is what

324
00:09:27,519 --> 00:09:29,279
requires an admin to get involved to

325
00:09:29,279 --> 00:09:30,480
consent to this

326
00:09:30,480 --> 00:09:33,360
application now this is where people

327
00:09:33,360 --> 00:09:35,120
tend to get a little tripped up because

328
00:09:35,120 --> 00:09:35,680
of the

329
00:09:35,680 --> 00:09:37,279
effective permissions model of this

330
00:09:37,279 --> 00:09:38,959
delegated permissions

331
00:09:38,959 --> 00:09:41,360
this is the intersection of the users

332
00:09:41,360 --> 00:09:42,800
underlying permissions and what the

333
00:09:42,800 --> 00:09:44,640
application can be congrated

334
00:09:44,640 --> 00:09:47,120
to so what do i mean by that let's say

335
00:09:47,120 --> 00:09:48,640
this application

336
00:09:48,640 --> 00:09:52,080
is the best search application ever

337
00:09:52,080 --> 00:09:53,600
right it's the best thing ever for

338
00:09:53,600 --> 00:09:55,200
searching sharepoint sites

339
00:09:55,200 --> 00:09:56,880
and it's asking for the ability to read

340
00:09:56,880 --> 00:09:58,880
all sharepoint sites

341
00:09:58,880 --> 00:10:00,560
so user consents to this let's say it

342
00:10:00,560 --> 00:10:01,760
has the permissions to do this they can

343
00:10:01,760 --> 00:10:02,720
send to that

344
00:10:02,720 --> 00:10:04,399
application or they're going to use an

345
00:10:04,399 --> 00:10:04,910
application

346
00:10:04,910 --> 00:10:06,240
[Music]

347
00:10:06,240 --> 00:10:09,120
they are not getting the ability to

348
00:10:09,120 --> 00:10:09,680
search

349
00:10:09,680 --> 00:10:12,480
all of sharepoint the effective model is

350
00:10:12,480 --> 00:10:13,839
the intersection

351
00:10:13,839 --> 00:10:16,800
of the application and that user so if

352
00:10:16,800 --> 00:10:18,800
the user only has the ability to read

353
00:10:18,800 --> 00:10:20,720
certain sharepoint sites when they're

354
00:10:20,720 --> 00:10:22,240
using that application

355
00:10:22,240 --> 00:10:24,399
they too only have the ability to use

356
00:10:24,399 --> 00:10:25,440
that search

357
00:10:25,440 --> 00:10:26,800
on the sharepoint sites that they have

358
00:10:26,800 --> 00:10:28,480
so what i'm trying to say is

359
00:10:28,480 --> 00:10:30,320
they're not grant you're not granting

360
00:10:30,320 --> 00:10:32,399
people more permissions

361
00:10:32,399 --> 00:10:34,079
than they normally would have using the

362
00:10:34,079 --> 00:10:35,440
delegated permission model it's still

363
00:10:35,440 --> 00:10:36,560
what the user has

364
00:10:36,560 --> 00:10:38,880
and what the application is able to do

365
00:10:38,880 --> 00:10:40,720
now this is sometimes called

366
00:10:40,720 --> 00:10:43,040
scopes oauth 2 permission grants or app

367
00:10:43,040 --> 00:10:44,480
plus user permissions

368
00:10:44,480 --> 00:10:45,600
and we really really want to use

369
00:10:45,600 --> 00:10:47,120
applications to have the delegated

370
00:10:47,120 --> 00:10:48,640
permission model

371
00:10:48,640 --> 00:10:50,560
now the second type of bishop model is

372
00:10:50,560 --> 00:10:52,800
called application permissions

373
00:10:52,800 --> 00:10:54,240
and these are used by apps without

374
00:10:54,240 --> 00:10:55,760
anyone being signed in or present so

375
00:10:55,760 --> 00:10:56,880
these can run

376
00:10:56,880 --> 00:10:59,519
fully in the background no user required

377
00:10:59,519 --> 00:11:01,760
and whatever permissions that you grant

378
00:11:01,760 --> 00:11:03,920
to an application in the application

379
00:11:03,920 --> 00:11:05,200
permission model

380
00:11:05,200 --> 00:11:07,760
that is the permissions that application

381
00:11:07,760 --> 00:11:08,720
has the ability

382
00:11:08,720 --> 00:11:12,000
to do so if there's some application

383
00:11:12,000 --> 00:11:15,120
that is asking for the ability to do

384
00:11:15,120 --> 00:11:17,760
directory read write all that

385
00:11:17,760 --> 00:11:19,600
application has the ability to do

386
00:11:19,600 --> 00:11:21,519
directory rewrite all there is no

387
00:11:21,519 --> 00:11:23,600
intersection like whatever we grant this

388
00:11:23,600 --> 00:11:25,519
it can do so these are extremely

389
00:11:25,519 --> 00:11:26,959
powerful permissions that we want to

390
00:11:26,959 --> 00:11:29,360
make sure we understand why applications

391
00:11:29,360 --> 00:11:31,519
need those permissions and why it has to

392
00:11:31,519 --> 00:11:32,720
have this permission model we really

393
00:11:32,720 --> 00:11:33,760
really want to use that delegate

394
00:11:33,760 --> 00:11:34,720
permission model because with

395
00:11:34,720 --> 00:11:36,000
intersection

396
00:11:36,000 --> 00:11:39,200
um application permissions are also

397
00:11:39,200 --> 00:11:40,959
always always required admin to consent

398
00:11:40,959 --> 00:11:42,720
to end users cannot consent to this

399
00:11:42,720 --> 00:11:45,360
and this is sometimes called roles app

400
00:11:45,360 --> 00:11:48,160
roles or app only permissions

401
00:11:48,160 --> 00:11:50,800
okay so we have this nice slide here

402
00:11:50,800 --> 00:11:51,519
that kind of

403
00:11:51,519 --> 00:11:53,200
is a summary of everything i just talked

404
00:11:53,200 --> 00:11:54,800
about in those previous two slides so

405
00:11:54,800 --> 00:11:55,600
just to kind of

406
00:11:55,600 --> 00:11:56,959
recap because this is kind of a lot of

407
00:11:56,959 --> 00:11:58,160
information if you've never looked at

408
00:11:58,160 --> 00:11:58,959
this before

409
00:11:58,959 --> 00:12:00,560
we have two types of permissions we have

410
00:12:00,560 --> 00:12:02,639
delegated and application permissions

411
00:12:02,639 --> 00:12:04,320
and that delegated model is going to be

412
00:12:04,320 --> 00:12:06,480
for those mobile apps those web apps

413
00:12:06,480 --> 00:12:08,320
or those spa you know single page

414
00:12:08,320 --> 00:12:09,839
applications and

415
00:12:09,839 --> 00:12:11,920
users can grant or can consent to this

416
00:12:11,920 --> 00:12:12,880
or admins

417
00:12:12,880 --> 00:12:14,560
can consent to this for all users in the

418
00:12:14,560 --> 00:12:16,639
organization and this requires a user to

419
00:12:16,639 --> 00:12:18,160
be signed in and present and that

420
00:12:18,160 --> 00:12:19,519
effective permission model

421
00:12:19,519 --> 00:12:21,200
is the combination of what the end user

422
00:12:21,200 --> 00:12:23,600
has as well as what the application has

423
00:12:23,600 --> 00:12:26,079
the application permission model is when

424
00:12:26,079 --> 00:12:27,519
runs as a service

425
00:12:27,519 --> 00:12:29,279
and only can be consented to by the

426
00:12:29,279 --> 00:12:31,279
administrator or whatever permissions

427
00:12:31,279 --> 00:12:34,160
we grant that is what that application

428
00:12:34,160 --> 00:12:35,680
has the ability to do so they're very

429
00:12:35,680 --> 00:12:37,120
very powerful so we want applications to

430
00:12:37,120 --> 00:12:38,880
use the delegated permissions

431
00:12:38,880 --> 00:12:40,560
not application permissions if we can

432
00:12:40,560 --> 00:12:42,320
help it and with that

433
00:12:42,320 --> 00:12:43,680
michael's going to show you a quick demo

434
00:12:43,680 --> 00:12:46,160
of this consent framework

435
00:12:46,160 --> 00:12:48,399
yep so i'm going to switch over here to

436
00:12:48,399 --> 00:12:49,839
my browser so what i'm going to show

437
00:12:49,839 --> 00:12:50,880
here first

438
00:12:50,880 --> 00:12:53,760
is i'm a standard end user and what i'm

439
00:12:53,760 --> 00:12:54,800
going to do is i'm going to go to an

440
00:12:54,800 --> 00:12:55,519
application

441
00:12:55,519 --> 00:12:58,399
that has an sso experience with office

442
00:12:58,399 --> 00:13:00,639
365. so this application's never been

443
00:13:00,639 --> 00:13:02,639
created in my directory before

444
00:13:02,639 --> 00:13:04,880
i'm a normal end user i want to sign in

445
00:13:04,880 --> 00:13:07,360
with my office 365 account

446
00:13:07,360 --> 00:13:11,200
um but in my tenant my normal end users

447
00:13:11,200 --> 00:13:12,160
are not allowed to

448
00:13:12,160 --> 00:13:13,920
consent to permissions on behalf of

449
00:13:13,920 --> 00:13:15,680
themselves

450
00:13:15,680 --> 00:13:17,440
so what you see here is kind of the

451
00:13:17,440 --> 00:13:19,360
standard consent experience where

452
00:13:19,360 --> 00:13:20,959
it shows like what permissions it's

453
00:13:20,959 --> 00:13:22,720
asking for uh

454
00:13:22,720 --> 00:13:24,000
you know we can see that it's asking for

455
00:13:24,000 --> 00:13:25,920
some permissions to read the user's

456
00:13:25,920 --> 00:13:26,720
groups

457
00:13:26,720 --> 00:13:29,040
to read the user's profile a couple

458
00:13:29,040 --> 00:13:31,120
other types of permissions

459
00:13:31,120 --> 00:13:32,959
but the user doesn't have the ability to

460
00:13:32,959 --> 00:13:34,959
actually go and consent to this

461
00:13:34,959 --> 00:13:38,000
for themselves there's also a feature

462
00:13:38,000 --> 00:13:39,040
where you can have

463
00:13:39,040 --> 00:13:40,880
a workflow where the user can enter a

464
00:13:40,880 --> 00:13:42,079
justification

465
00:13:42,079 --> 00:13:45,199
say like i need this for work

466
00:13:45,199 --> 00:13:46,720
and click request approval and this will

467
00:13:46,720 --> 00:13:47,839
send a notification to your

468
00:13:47,839 --> 00:13:48,880
administrators and then the

469
00:13:48,880 --> 00:13:50,639
administrators can go and decide if they

470
00:13:50,639 --> 00:13:51,360
want to grant

471
00:13:51,360 --> 00:13:53,360
that access but out of the box this

472
00:13:53,360 --> 00:13:54,880
feature is not turned on so

473
00:13:54,880 --> 00:13:56,160
typically your users are going to kind

474
00:13:56,160 --> 00:13:58,320
of run into a brick wall here and maybe

475
00:13:58,320 --> 00:13:59,920
they need to open a help desk ticket or

476
00:13:59,920 --> 00:14:00,639
maybe they just

477
00:14:00,639 --> 00:14:01,920
never actually get to use that

478
00:14:01,920 --> 00:14:04,160
application in this case i have the

479
00:14:04,160 --> 00:14:05,920
feature turned on so i'll click i'll

480
00:14:05,920 --> 00:14:07,680
click the request button

481
00:14:07,680 --> 00:14:09,440
and that's going to generate a request

482
00:14:09,440 --> 00:14:10,959
send it to my administrators

483
00:14:10,959 --> 00:14:12,720
but at this point i don't i don't get

484
00:14:12,720 --> 00:14:14,720
access to the application

485
00:14:14,720 --> 00:14:18,320
so over on my administrator side

486
00:14:18,320 --> 00:14:21,040
if i go over to the admin consent area

487
00:14:21,040 --> 00:14:23,120
we should see that that request came in

488
00:14:23,120 --> 00:14:24,800
uh so we can see that there's this app

489
00:14:24,800 --> 00:14:26,240
that's being requested

490
00:14:26,240 --> 00:14:28,800
who's requesting it um but really what i

491
00:14:28,800 --> 00:14:30,320
want to show is what does the experience

492
00:14:30,320 --> 00:14:31,839
look like when an administrator actually

493
00:14:31,839 --> 00:14:33,360
decides that they are going to go

494
00:14:33,360 --> 00:14:35,839
do the admin consent so i'm a global

495
00:14:35,839 --> 00:14:36,800
administrator

496
00:14:36,800 --> 00:14:38,800
in this browser window so i'm going to

497
00:14:38,800 --> 00:14:41,120
go in here and specify which account i'm

498
00:14:41,120 --> 00:14:42,320
signing in with

499
00:14:42,320 --> 00:14:45,360
and here i am able to

500
00:14:45,360 --> 00:14:47,360
see the same permissions so it's roughly

501
00:14:47,360 --> 00:14:48,720
the same experience

502
00:14:48,720 --> 00:14:50,480
but i have this new checkbox because i'm

503
00:14:50,480 --> 00:14:52,560
a global administrator that's consent on

504
00:14:52,560 --> 00:14:54,320
behalf of your organization

505
00:14:54,320 --> 00:14:56,720
so like mark talked about basically what

506
00:14:56,720 --> 00:14:58,240
this is going to do is

507
00:14:58,240 --> 00:15:01,040
it's going to uh codify this app as

508
00:15:01,040 --> 00:15:02,320
something that's allowed

509
00:15:02,320 --> 00:15:04,560
or my end users are allowed to use in

510
00:15:04,560 --> 00:15:05,680
our environment

511
00:15:05,680 --> 00:15:08,079
so any subsequent end users who come to

512
00:15:08,079 --> 00:15:09,519
use this application they're not going

513
00:15:09,519 --> 00:15:10,959
to see the consent screen they'll be

514
00:15:10,959 --> 00:15:12,320
able to just sign right in

515
00:15:12,320 --> 00:15:13,680
because this is an approved app just

516
00:15:13,680 --> 00:15:16,079
like that ios mail app use case

517
00:15:16,079 --> 00:15:18,639
so in this case i'm going to hit accept

518
00:15:18,639 --> 00:15:19,279
and

519
00:15:19,279 --> 00:15:20,959
the admin consent at this point should

520
00:15:20,959 --> 00:15:23,199
be complete and users no longer will see

521
00:15:23,199 --> 00:15:27,839
the consent screen

522
00:15:29,680 --> 00:15:32,639
all right um so yes uh that's if you've

523
00:15:32,639 --> 00:15:34,240
never seen consent before

524
00:15:34,240 --> 00:15:35,600
that's the consent experience so let's

525
00:15:35,600 --> 00:15:37,360
talk about um

526
00:15:37,360 --> 00:15:38,800
what happens when you click consent but

527
00:15:38,800 --> 00:15:40,560
before we get to that michael bill made

528
00:15:40,560 --> 00:15:42,000
a comment that

529
00:15:42,000 --> 00:15:45,199
microsoft is using a mac slapping face

530
00:15:45,199 --> 00:15:48,480
so um good good eye bill

531
00:15:48,480 --> 00:15:50,160
so there's a few people on our team that

532
00:15:50,160 --> 00:15:52,240
use uh mac laptops

533
00:15:52,240 --> 00:15:54,639
mike and i happen to be both of them and

534
00:15:54,639 --> 00:15:56,240
we have lots of customers that actually

535
00:15:56,240 --> 00:15:56,880
have

536
00:15:56,880 --> 00:15:58,480
macs in their environment and we do a

537
00:15:58,480 --> 00:15:59,839
lot of stuff with them to help improve

538
00:15:59,839 --> 00:16:01,519
the mac experience as well

539
00:16:01,519 --> 00:16:04,079
um from a like identity side so i

540
00:16:04,079 --> 00:16:05,600
actually just posted in the chat

541
00:16:05,600 --> 00:16:07,759
we have this new apple sso plug-in that

542
00:16:07,759 --> 00:16:09,519
will help cut down on the prompts

543
00:16:09,519 --> 00:16:11,360
uh you're getting on those ios and mac

544
00:16:11,360 --> 00:16:12,800
devices so i just pasted that chat in

545
00:16:12,800 --> 00:16:13,759
there and if you have any questions

546
00:16:13,759 --> 00:16:15,279
about azure id in general

547
00:16:15,279 --> 00:16:17,680
or mac on azure 80 in general michael

548
00:16:17,680 --> 00:16:19,680
and i are both very uh able to answer

549
00:16:19,680 --> 00:16:20,959
those questions you can post into

550
00:16:20,959 --> 00:16:22,000
discord and we're happy

551
00:16:22,000 --> 00:16:24,480
to answer those after this talk as well

552
00:16:24,480 --> 00:16:26,079
okay

553
00:16:26,079 --> 00:16:29,440
so we click consent what actually

554
00:16:29,440 --> 00:16:30,240
happens

555
00:16:30,240 --> 00:16:33,040
under the hood so the first thing is uh

556
00:16:33,040 --> 00:16:34,720
in azure id there's two parts there's

557
00:16:34,720 --> 00:16:35,519
called there's a

558
00:16:35,519 --> 00:16:37,040
application registrations and there's

559
00:16:37,040 --> 00:16:38,240
enterprise apps and we're doing some

560
00:16:38,240 --> 00:16:39,680
work to kind of make this a little bit

561
00:16:39,680 --> 00:16:40,800
easier for you

562
00:16:40,800 --> 00:16:43,040
but um hold on go back go back michael

563
00:16:43,040 --> 00:16:44,800
we've got a lot to go through

564
00:16:44,800 --> 00:16:48,079
so um what actually happens okay so the

565
00:16:48,079 --> 00:16:50,560
application registration is the

566
00:16:50,560 --> 00:16:52,160
definition

567
00:16:52,160 --> 00:16:54,000
of an application you can think of this

568
00:16:54,000 --> 00:16:55,600
as like this is the

569
00:16:55,600 --> 00:16:58,480
the back of the house configuration of

570
00:16:58,480 --> 00:17:00,240
the application so this is like is this

571
00:17:00,240 --> 00:17:01,600
application gonna be a

572
00:17:01,600 --> 00:17:03,759
a single tenant application like only

573
00:17:03,759 --> 00:17:05,199
for us is this gonna be an application

574
00:17:05,199 --> 00:17:06,720
that's a multi-tenant application is it

575
00:17:06,720 --> 00:17:08,079
gonna be able to use

576
00:17:08,079 --> 00:17:09,839
azure id credentials do you want to be

577
00:17:09,839 --> 00:17:11,359
able to use azure credentials and

578
00:17:11,359 --> 00:17:13,520
and microsoft accounts so this is all

579
00:17:13,520 --> 00:17:15,039
going to be part of the definition of

580
00:17:15,039 --> 00:17:16,480
the application itself

581
00:17:16,480 --> 00:17:17,919
which is only going to live in one

582
00:17:17,919 --> 00:17:19,760
tenant and then in the

583
00:17:19,760 --> 00:17:21,280
enterprise apps is where you're going to

584
00:17:21,280 --> 00:17:23,839
have the service principles

585
00:17:23,839 --> 00:17:25,919
and this is the representation of that

586
00:17:25,919 --> 00:17:27,039
application

587
00:17:27,039 --> 00:17:28,559
in the tenant so you can think of the

588
00:17:28,559 --> 00:17:30,240
enterprise apps

589
00:17:30,240 --> 00:17:33,440
area as the front of the house so this

590
00:17:33,440 --> 00:17:34,960
is where you can apply like conditional

591
00:17:34,960 --> 00:17:36,559
access policies to the application to

592
00:17:36,559 --> 00:17:37,039
say

593
00:17:37,039 --> 00:17:38,799
in order to actually get to this

594
00:17:38,799 --> 00:17:41,120
application you need to do mfa

595
00:17:41,120 --> 00:17:42,640
you need to come from an applica or a

596
00:17:42,640 --> 00:17:44,960
device that's either in tune managed or

597
00:17:44,960 --> 00:17:46,160
all kinds of stuff like that so that's

598
00:17:46,160 --> 00:17:47,760
all going to be in the enterprise app

599
00:17:47,760 --> 00:17:49,600
space so to give you an example of this

600
00:17:49,600 --> 00:17:51,520
let's say michael and i are working on a

601
00:17:51,520 --> 00:17:53,120
time keeping application

602
00:17:53,120 --> 00:17:55,360
so in our tenant tenant one we're gonna

603
00:17:55,360 --> 00:17:57,120
have an app registration

604
00:17:57,120 --> 00:17:59,280
of the timekeeping application and then

605
00:17:59,280 --> 00:18:01,440
we also use that application

606
00:18:01,440 --> 00:18:02,720
to keep track of our time on the

607
00:18:02,720 --> 00:18:04,240
projects that we work on so we're going

608
00:18:04,240 --> 00:18:05,039
to have that

609
00:18:05,039 --> 00:18:07,760
service principle in the enterprise apps

610
00:18:07,760 --> 00:18:08,720
of our tenant

611
00:18:08,720 --> 00:18:10,720
and then we sell this application to

612
00:18:10,720 --> 00:18:11,840
other companies so they can do

613
00:18:11,840 --> 00:18:13,200
timekeeping as well

614
00:18:13,200 --> 00:18:16,640
so in 10 and 2 10 and 3 10 n they will

615
00:18:16,640 --> 00:18:17,120
have

616
00:18:17,120 --> 00:18:19,919
a service principle in their enterprise

617
00:18:19,919 --> 00:18:20,559
app

618
00:18:20,559 --> 00:18:22,960
of this application they will not see

619
00:18:22,960 --> 00:18:24,559
anything in app registrations

620
00:18:24,559 --> 00:18:26,960
for this app specifically so if you go

621
00:18:26,960 --> 00:18:29,520
look in your um azure ad directory

622
00:18:29,520 --> 00:18:31,280
you will find enterprise apps for things

623
00:18:31,280 --> 00:18:32,799
like exchange online

624
00:18:32,799 --> 00:18:35,360
salesforce workday things of that nature

625
00:18:35,360 --> 00:18:36,799
you will not see anything in app

626
00:18:36,799 --> 00:18:38,559
registrations but

627
00:18:38,559 --> 00:18:40,000
let's say you are moving your line of

628
00:18:40,000 --> 00:18:41,280
business application so there's an

629
00:18:41,280 --> 00:18:42,559
application that you made

630
00:18:42,559 --> 00:18:44,480
just for your tenant or maybe it's an

631
00:18:44,480 --> 00:18:46,160
application that you're selling to other

632
00:18:46,160 --> 00:18:49,360
companies um you'll see that app in the

633
00:18:49,360 --> 00:18:51,440
app registrations as well as seeing it

634
00:18:51,440 --> 00:18:51,679
in

635
00:18:51,679 --> 00:18:54,720
enterprise app so um this is confusing

636
00:18:54,720 --> 00:18:55,919
let us know in the chat we're happy to

637
00:18:55,919 --> 00:18:56,880
talk a little bit more and help and

638
00:18:56,880 --> 00:18:58,080
discord but this should hopefully

639
00:18:58,080 --> 00:18:58,960
explain why

640
00:18:58,960 --> 00:19:00,559
when you look at your tenant you don't

641
00:19:00,559 --> 00:19:03,039
see those sales force in exchange online

642
00:19:03,039 --> 00:19:04,640
and sharepoint things like that

643
00:19:04,640 --> 00:19:06,640
in your app registrations you only see

644
00:19:06,640 --> 00:19:08,080
that in your enterprise

645
00:19:08,080 --> 00:19:10,720
apps okay so service principles are

646
00:19:10,720 --> 00:19:12,720
really really important because

647
00:19:12,720 --> 00:19:15,039
applications can be off authorized to

648
00:19:15,039 --> 00:19:15,760
access data

649
00:19:15,760 --> 00:19:17,840
you can go to the next slide michael so

650
00:19:17,840 --> 00:19:19,840
a service principle

651
00:19:19,840 --> 00:19:23,360
in this model is a security principle

652
00:19:23,360 --> 00:19:25,120
so service principles can be granted

653
00:19:25,120 --> 00:19:26,559
access to things so we already covered

654
00:19:26,559 --> 00:19:27,280
the two

655
00:19:27,280 --> 00:19:28,480
um ones you're probably thinking of

656
00:19:28,480 --> 00:19:30,080
which is that app only permissions as

657
00:19:30,080 --> 00:19:32,080
well as the delegated permission grants

658
00:19:32,080 --> 00:19:34,240
but service principles can also be on

659
00:19:34,240 --> 00:19:36,160
azure key vault acls

660
00:19:36,160 --> 00:19:39,039
service principles can hold role

661
00:19:39,039 --> 00:19:39,760
assignments

662
00:19:39,760 --> 00:19:41,760
in azure service principles can hold

663
00:19:41,760 --> 00:19:43,200
directory role assignments in the

664
00:19:43,200 --> 00:19:43,760
directory

665
00:19:43,760 --> 00:19:45,600
and service principles can be owners of

666
00:19:45,600 --> 00:19:47,679
things like groups

667
00:19:47,679 --> 00:19:50,400
um application and other service

668
00:19:50,400 --> 00:19:52,080
principles so service principles

669
00:19:52,080 --> 00:19:54,080
are very very powerful things we want to

670
00:19:54,080 --> 00:19:55,440
make sure we have a good understanding

671
00:19:55,440 --> 00:19:57,039
of what applications have been consented

672
00:19:57,039 --> 00:19:58,160
to in our environment

673
00:19:58,160 --> 00:19:59,360
and what are those permissions because

674
00:19:59,360 --> 00:20:00,960
they can do lots and lots of things in

675
00:20:00,960 --> 00:20:02,400
their environment

676
00:20:02,400 --> 00:20:05,520
so you go to the next slide so

677
00:20:05,520 --> 00:20:08,080
i know somebody here right now is

678
00:20:08,080 --> 00:20:09,840
probably

679
00:20:09,840 --> 00:20:11,919
thinking just like grandpa simpson and

680
00:20:11,919 --> 00:20:13,520
they're like i know

681
00:20:13,520 --> 00:20:15,520
that the cloud was a problem from the

682
00:20:15,520 --> 00:20:17,600
start and now i have all these

683
00:20:17,600 --> 00:20:18,720
applications

684
00:20:18,720 --> 00:20:21,120
in my tenant i don't understand how any

685
00:20:21,120 --> 00:20:22,400
of them got there because people have

686
00:20:22,400 --> 00:20:23,600
been assigned to them

687
00:20:23,600 --> 00:20:25,760
i don't know who got assigned to them so

688
00:20:25,760 --> 00:20:26,640
i have like

689
00:20:26,640 --> 00:20:28,159
some people can access applications some

690
00:20:28,159 --> 00:20:29,600
people can't and i have all these

691
00:20:29,600 --> 00:20:30,400
permissions

692
00:20:30,400 --> 00:20:31,760
that can do things in my directory and i

693
00:20:31,760 --> 00:20:33,360
have no idea how this happened like i

694
00:20:33,360 --> 00:20:34,240
know

695
00:20:34,240 --> 00:20:36,400
this is the cloud's fault and we should

696
00:20:36,400 --> 00:20:38,159
never done the cloud to begin with

697
00:20:38,159 --> 00:20:41,360
and uh it's not as bad as it seems we

698
00:20:41,360 --> 00:20:42,559
have some stuff we'll give you that will

699
00:20:42,559 --> 00:20:43,919
help make this easier and there's some

700
00:20:43,919 --> 00:20:45,280
knobs you can turn that will make this

701
00:20:45,280 --> 00:20:47,679
easier as well but i dare you to ask

702
00:20:47,679 --> 00:20:49,919
the same questions about your on-prem

703
00:20:49,919 --> 00:20:51,360
apps as well

704
00:20:51,360 --> 00:20:53,120
it's actually usually for most customers

705
00:20:53,120 --> 00:20:54,720
it's worse because there isn't a central

706
00:20:54,720 --> 00:20:56,080
place where applications are coming

707
00:20:56,080 --> 00:20:56,559
through

708
00:20:56,559 --> 00:20:58,240
it's worse because we don't know who's

709
00:20:58,240 --> 00:21:00,000
accessing what applications it's worse

710
00:21:00,000 --> 00:21:00,880
because we actually don't know what

711
00:21:00,880 --> 00:21:02,000
permissions those applications

712
00:21:02,000 --> 00:21:03,600
have asked for an application may have

713
00:21:03,600 --> 00:21:05,520
asked for something like domain admin

714
00:21:05,520 --> 00:21:05,760
and

715
00:21:05,760 --> 00:21:07,039
what permissions is it using can you

716
00:21:07,039 --> 00:21:08,400
even tell you you don't know so things

717
00:21:08,400 --> 00:21:09,440
like that so it's actually probably

718
00:21:09,440 --> 00:21:11,440
going to be worse on-prem

719
00:21:11,440 --> 00:21:13,520
but um in the cloud we have some stuff

720
00:21:13,520 --> 00:21:14,640
that's going to help you

721
00:21:14,640 --> 00:21:17,600
um with this so why are we talking a lot

722
00:21:17,600 --> 00:21:18,480
about this

723
00:21:18,480 --> 00:21:19,600
in all this because we're talking about

724
00:21:19,600 --> 00:21:21,039
all this stuff about this application

725
00:21:21,039 --> 00:21:22,400
it's like why should you care about any

726
00:21:22,400 --> 00:21:23,840
of these things that we just said

727
00:21:23,840 --> 00:21:25,840
let's get into the malware part of this

728
00:21:25,840 --> 00:21:28,799
as well as that sustained persistence so

729
00:21:28,799 --> 00:21:30,480
typical malware campaigns have been

730
00:21:30,480 --> 00:21:32,640
right where we have the the subject is

731
00:21:32,640 --> 00:21:34,880
we're trying to get you to you know

732
00:21:34,880 --> 00:21:36,960
entice you to open this mail we have

733
00:21:36,960 --> 00:21:38,000
some sort of like

734
00:21:38,000 --> 00:21:40,960
attachment and we want you to run this

735
00:21:40,960 --> 00:21:41,919
because

736
00:21:41,919 --> 00:21:44,000
we can run that macro in our environment

737
00:21:44,000 --> 00:21:45,200
and you know we

738
00:21:45,200 --> 00:21:46,240
have that spoof stuff and now we're

739
00:21:46,240 --> 00:21:48,480
starting to see those covid19

740
00:21:48,480 --> 00:21:50,640
theme campaigns so these people are

741
00:21:50,640 --> 00:21:52,400
trying to impersonate the the cdc

742
00:21:52,400 --> 00:21:53,679
they're trying to prey on people's

743
00:21:53,679 --> 00:21:56,080
fear and again we still want them they

744
00:21:56,080 --> 00:21:57,360
want you to run that

745
00:21:57,360 --> 00:21:59,039
that word document that attachment so

746
00:21:59,039 --> 00:22:00,400
they can run that macro

747
00:22:00,400 --> 00:22:01,600
and they're trying to take it take

748
00:22:01,600 --> 00:22:03,120
advantage of people's fear with covet

749
00:22:03,120 --> 00:22:04,240
19.

750
00:22:04,240 --> 00:22:05,919
so this is what they've been doing but

751
00:22:05,919 --> 00:22:07,360
what we're starting to see people move

752
00:22:07,360 --> 00:22:08,000
to

753
00:22:08,000 --> 00:22:09,600
is instead of this traditional fishing

754
00:22:09,600 --> 00:22:12,159
where we eventually try to run a macro

755
00:22:12,159 --> 00:22:15,280
they're trying to get you to consent to

756
00:22:15,280 --> 00:22:16,159
a malicious

757
00:22:16,159 --> 00:22:18,320
application which this has a few

758
00:22:18,320 --> 00:22:19,520
different things that we want to make

759
00:22:19,520 --> 00:22:20,159
sure

760
00:22:20,159 --> 00:22:21,440
we think about but this is kind of an

761
00:22:21,440 --> 00:22:23,600
example we've seen right so this covet

762
00:22:23,600 --> 00:22:25,520
19 bonus attachment go ahead and click

763
00:22:25,520 --> 00:22:26,880
on that and now we have this

764
00:22:26,880 --> 00:22:28,640
application consent grant that we've

765
00:22:28,640 --> 00:22:29,600
seen for other things and this

766
00:22:29,600 --> 00:22:31,039
application is called

767
00:22:31,039 --> 00:22:34,559
office 365 access that logo

768
00:22:34,559 --> 00:22:37,360
looks a little bit kind of okay but

769
00:22:37,360 --> 00:22:38,559
looks a little odd to me

770
00:22:38,559 --> 00:22:39,919
and let's look you know it's asking for

771
00:22:39,919 --> 00:22:41,679
some stuff read my profile read my

772
00:22:41,679 --> 00:22:43,039
contacts and then if you start looking

773
00:22:43,039 --> 00:22:44,720
through these consent prompts

774
00:22:44,720 --> 00:22:46,240
it wants to be able to also read your

775
00:22:46,240 --> 00:22:48,320
mail it wants to be able to read all my

776
00:22:48,320 --> 00:22:49,039
notebooks

777
00:22:49,039 --> 00:22:50,240
and it wants to be able to read and

778
00:22:50,240 --> 00:22:51,600
write to my mailbox settings which can

779
00:22:51,600 --> 00:22:53,039
have all kinds of access right

780
00:22:53,039 --> 00:22:54,320
and just it's a quite a bit of

781
00:22:54,320 --> 00:22:56,880
permissions and if a user clicks on this

782
00:22:56,880 --> 00:22:58,320
remember that this is a delegated

783
00:22:58,320 --> 00:23:00,240
permission request

784
00:23:00,240 --> 00:23:01,840
it has the same ability for these

785
00:23:01,840 --> 00:23:03,760
permissions and what that end user has

786
00:23:03,760 --> 00:23:05,840
the ability to do so this end user

787
00:23:05,840 --> 00:23:08,480
has the ability to update their mailbox

788
00:23:08,480 --> 00:23:10,000
rules and change forwarding rules like

789
00:23:10,000 --> 00:23:11,520
that's something that end users have the

790
00:23:11,520 --> 00:23:12,720
ability to do and need to do

791
00:23:12,720 --> 00:23:14,320
and now this application has this

792
00:23:14,320 --> 00:23:15,760
ability to do this as well

793
00:23:15,760 --> 00:23:17,760
and this is where that sustained

794
00:23:17,760 --> 00:23:18,799
persistence

795
00:23:18,799 --> 00:23:21,679
comes into the mix because if you click

796
00:23:21,679 --> 00:23:23,840
accept to this then user clicks accept

797
00:23:23,840 --> 00:23:25,200
and there's no we're not doing any other

798
00:23:25,200 --> 00:23:26,559
proper stuff we'll get to here and

799
00:23:26,559 --> 00:23:27,360
shortly

800
00:23:27,360 --> 00:23:29,600
um this application has the ability to

801
00:23:29,600 --> 00:23:30,640
do that so let's say you

802
00:23:30,640 --> 00:23:32,640
find this application is bad and

803
00:23:32,640 --> 00:23:34,000
malicious and you go there and you

804
00:23:34,000 --> 00:23:35,679
remove it you delete it

805
00:23:35,679 --> 00:23:39,280
great it doesn't remove the persistent

806
00:23:39,280 --> 00:23:41,039
mechanisms that it's in so if it added a

807
00:23:41,039 --> 00:23:42,799
mailbox forwarding rule

808
00:23:42,799 --> 00:23:45,279
to say anytime mail comes in with

809
00:23:45,279 --> 00:23:46,320
payment or whatever

810
00:23:46,320 --> 00:23:49,039
send it to this external domain it

811
00:23:49,039 --> 00:23:50,000
doesn't clean those rules

812
00:23:50,000 --> 00:23:54,080
up so from a sustained persistence model

813
00:23:54,080 --> 00:23:55,679
just because you they got you to click

814
00:23:55,679 --> 00:23:57,120
on this application and you remove the

815
00:23:57,120 --> 00:23:59,360
application you still need to remove

816
00:23:59,360 --> 00:24:01,919
those existing things that made changes

817
00:24:01,919 --> 00:24:03,440
to in your environment

818
00:24:03,440 --> 00:24:06,720
and this gets even worse if it's from an

819
00:24:06,720 --> 00:24:07,840
application that has

820
00:24:07,840 --> 00:24:10,240
admin permissions because permissions

821
00:24:10,240 --> 00:24:11,679
that you can grant you

822
00:24:11,679 --> 00:24:14,559
as an admin can be equivalent to just

823
00:24:14,559 --> 00:24:16,720
like an admin account so let's say

824
00:24:16,720 --> 00:24:18,159
an attacker got a hold of an admin

825
00:24:18,159 --> 00:24:19,840
account and they knew they were only

826
00:24:19,840 --> 00:24:21,120
going to have access to this account

827
00:24:21,120 --> 00:24:24,159
for 5 10 15 minutes

828
00:24:24,159 --> 00:24:26,000
and they went in and they granted

829
00:24:26,000 --> 00:24:27,440
consent

830
00:24:27,440 --> 00:24:29,279
to a application that has the ability to

831
00:24:29,279 --> 00:24:31,520
do things like directory read write all

832
00:24:31,520 --> 00:24:33,760
and then they lost access to that

833
00:24:33,760 --> 00:24:34,960
account

834
00:24:34,960 --> 00:24:37,279
that application basically has the same

835
00:24:37,279 --> 00:24:38,400
permissions

836
00:24:38,400 --> 00:24:42,000
as an admin so it can be very very um

837
00:24:42,000 --> 00:24:43,279
powerful in your environment so you want

838
00:24:43,279 --> 00:24:45,520
to look for this okay so what are those

839
00:24:45,520 --> 00:24:47,039
key permissions you should be looking

840
00:24:47,039 --> 00:24:49,279
for in your applications

841
00:24:49,279 --> 00:24:51,840
so anything that's like a star mail.star

842
00:24:51,840 --> 00:24:52,880
mailbox settings star

843
00:24:52,880 --> 00:24:54,559
contacts people file star anything

844
00:24:54,559 --> 00:24:56,480
that's that directory read write all

845
00:24:56,480 --> 00:24:58,320
that type of stuff anytime you have read

846
00:24:58,320 --> 00:25:00,799
write all you really want to make sure

847
00:25:00,799 --> 00:25:02,720
we understand what those permissions are

848
00:25:02,720 --> 00:25:05,120
used for now just because an application

849
00:25:05,120 --> 00:25:07,200
is asking for the ability to read all

850
00:25:07,200 --> 00:25:08,400
mail or maybe

851
00:25:08,400 --> 00:25:10,000
do like some of these permissions

852
00:25:10,000 --> 00:25:12,720
membership read hidden things like that

853
00:25:12,720 --> 00:25:15,360
doesn't mean it's bad it just means that

854
00:25:15,360 --> 00:25:17,120
it has a lot of permissions

855
00:25:17,120 --> 00:25:18,080
and something like i talked about

856
00:25:18,080 --> 00:25:20,240
earlier which is like an e-discovery app

857
00:25:20,240 --> 00:25:21,679
it's probably going to need the ability

858
00:25:21,679 --> 00:25:24,080
to read and write to all the mailboxes

859
00:25:24,080 --> 00:25:25,679
maybe if it's a governance tool it's

860
00:25:25,679 --> 00:25:26,960
going to need to be able to read those

861
00:25:26,960 --> 00:25:28,320
hidden group memberships it's going to

862
00:25:28,320 --> 00:25:29,440
have a lot of permission

863
00:25:29,440 --> 00:25:31,760
so just because an application is asking

864
00:25:31,760 --> 00:25:33,520
for these types of permissions

865
00:25:33,520 --> 00:25:35,279
doesn't mean it's malicious it just

866
00:25:35,279 --> 00:25:36,559
means it has a lot of power and we want

867
00:25:36,559 --> 00:25:37,840
to make sure we understand

868
00:25:37,840 --> 00:25:40,799
exactly why the application needs these

869
00:25:40,799 --> 00:25:42,080
types of permissions because usually

870
00:25:42,080 --> 00:25:43,679
it doesn't and people just don't know

871
00:25:43,679 --> 00:25:45,120
we'll get into that a little bit here

872
00:25:45,120 --> 00:25:47,360
uh shortly but these are really really

873
00:25:47,360 --> 00:25:48,640
key permissions to look for want to make

874
00:25:48,640 --> 00:25:50,720
sure if you have any applications

875
00:25:50,720 --> 00:25:51,919
in your environment that have these

876
00:25:51,919 --> 00:25:54,400
permissions you as defenders

877
00:25:54,400 --> 00:25:56,880
really really want to understand why

878
00:25:56,880 --> 00:25:58,159
does it have those permissions and does

879
00:25:58,159 --> 00:26:00,320
it really need that

880
00:26:00,320 --> 00:26:03,440
okay some other lower level permissions

881
00:26:03,440 --> 00:26:06,159
that i want everybody to think about is

882
00:26:06,159 --> 00:26:07,679
user.read open id

883
00:26:07,679 --> 00:26:09,120
email and profile these are like very

884
00:26:09,120 --> 00:26:10,720
very basic permissions that

885
00:26:10,720 --> 00:26:12,640
are considered low impact that people

886
00:26:12,640 --> 00:26:15,039
can just go ahead and use

887
00:26:15,039 --> 00:26:17,840
but the question you have to ask is are

888
00:26:17,840 --> 00:26:20,320
you okay with end users consenting to

889
00:26:20,320 --> 00:26:21,760
these applications

890
00:26:21,760 --> 00:26:23,440
to begin with so the example i have for

891
00:26:23,440 --> 00:26:25,679
you is we had a customer

892
00:26:25,679 --> 00:26:27,760
that some end user wanted to use like a

893
00:26:27,760 --> 00:26:29,679
directory application or whatever

894
00:26:29,679 --> 00:26:31,360
and it asks for these permissions and

895
00:26:31,360 --> 00:26:33,120
basically like wants to read the gal

896
00:26:33,120 --> 00:26:35,200
right any end user can read the gal

897
00:26:35,200 --> 00:26:36,400
wants to read the gal

898
00:26:36,400 --> 00:26:38,400
user click yes the user and user had

899
00:26:38,400 --> 00:26:39,919
those permissions it uses that delegated

900
00:26:39,919 --> 00:26:40,960
permission model

901
00:26:40,960 --> 00:26:43,760
the application read the gal and about

902
00:26:43,760 --> 00:26:44,799
six months later

903
00:26:44,799 --> 00:26:46,400
one of their executives was using that

904
00:26:46,400 --> 00:26:48,320
same directory application

905
00:26:48,320 --> 00:26:51,200
and they were very very surprised to see

906
00:26:51,200 --> 00:26:52,480
their first name

907
00:26:52,480 --> 00:26:55,279
their last name their email address and

908
00:26:55,279 --> 00:26:55,840
their

909
00:26:55,840 --> 00:26:57,440
gal profile picture was on this

910
00:26:57,440 --> 00:26:59,919
directory site and what was the reaction

911
00:26:59,919 --> 00:27:01,600
we've been hacked we've been hacked our

912
00:27:01,600 --> 00:27:03,120
data's been pushed this site what's

913
00:27:03,120 --> 00:27:04,159
going on here

914
00:27:04,159 --> 00:27:05,360
they haven't been hacked right this is

915
00:27:05,360 --> 00:27:07,840
just basic information that end users

916
00:27:07,840 --> 00:27:09,440
have the ability to do they can read the

917
00:27:09,440 --> 00:27:11,120
gal they need to be able to do that

918
00:27:11,120 --> 00:27:13,279
but you as a as an organization from a

919
00:27:13,279 --> 00:27:14,640
risk perspective need to make those

920
00:27:14,640 --> 00:27:15,760
decisions are

921
00:27:15,760 --> 00:27:17,760
even though the permission impact here

922
00:27:17,760 --> 00:27:19,279
is low this is just basic stuff end

923
00:27:19,279 --> 00:27:20,640
users can look at

924
00:27:20,640 --> 00:27:22,799
do you want them to be able to consent

925
00:27:22,799 --> 00:27:25,360
to this type of information because

926
00:27:25,360 --> 00:27:26,720
you may not want them to be able to do

927
00:27:26,720 --> 00:27:27,840
that because people don't understand the

928
00:27:27,840 --> 00:27:29,039
impact

929
00:27:29,039 --> 00:27:30,240
and with that michael's going to show

930
00:27:30,240 --> 00:27:32,320
you a demo here to kind of really hammer

931
00:27:32,320 --> 00:27:32,960
home

932
00:27:32,960 --> 00:27:34,640
what applications can do in your

933
00:27:34,640 --> 00:27:35,679
environment from a permission

934
00:27:35,679 --> 00:27:38,000
perspective

935
00:27:38,000 --> 00:27:41,520
okay so just from a getting started

936
00:27:41,520 --> 00:27:43,440
standpoint one of the things you can do

937
00:27:43,440 --> 00:27:45,120
in the azure id portal is actually go

938
00:27:45,120 --> 00:27:46,720
and look at the permissions that have

939
00:27:46,720 --> 00:27:47,440
been

940
00:27:47,440 --> 00:27:49,360
assigned on your applications and check

941
00:27:49,360 --> 00:27:52,080
and see if they've been admin consented

942
00:27:52,080 --> 00:27:54,159
so looking at this application that we

943
00:27:54,159 --> 00:27:56,559
have in one of these lab tenants

944
00:27:56,559 --> 00:27:58,240
we already can see that this thing has

945
00:27:58,240 --> 00:28:00,559
some suspicious stuff going on

946
00:28:00,559 --> 00:28:02,000
you can see that it's kind of got a

947
00:28:02,000 --> 00:28:03,919
misspelling in it so that's probably not

948
00:28:03,919 --> 00:28:04,320
good

949
00:28:04,320 --> 00:28:06,240
uh so this might be something that is

950
00:28:06,240 --> 00:28:08,320
concerning and if we start looking at

951
00:28:08,320 --> 00:28:09,279
the permissions

952
00:28:09,279 --> 00:28:11,279
uh there's a couple things we notice

953
00:28:11,279 --> 00:28:12,559
there's a lot of permissions that have

954
00:28:12,559 --> 00:28:13,679
read write all

955
00:28:13,679 --> 00:28:15,360
uh so there's a lot of write permissions

956
00:28:15,360 --> 00:28:17,200
in here including directory read write

957
00:28:17,200 --> 00:28:18,880
all which is very dangerous

958
00:28:18,880 --> 00:28:21,120
um this is kind of like being a global

959
00:28:21,120 --> 00:28:21,919
admin in

960
00:28:21,919 --> 00:28:24,880
in uh in the application and then if we

961
00:28:24,880 --> 00:28:27,120
look at the type of permissions again

962
00:28:27,120 --> 00:28:28,320
we're seeing those application

963
00:28:28,320 --> 00:28:29,600
permissions

964
00:28:29,600 --> 00:28:31,279
so delegated are the ones that we want

965
00:28:31,279 --> 00:28:33,039
to try to use if we're giving

966
00:28:33,039 --> 00:28:34,480
application permissions

967
00:28:34,480 --> 00:28:37,440
these are very broad permissions so for

968
00:28:37,440 --> 00:28:37,919
example

969
00:28:37,919 --> 00:28:40,480
mailbox settings.read write basically

970
00:28:40,480 --> 00:28:43,120
gives the application the ability to set

971
00:28:43,120 --> 00:28:45,840
things like rules like mailbox rules on

972
00:28:45,840 --> 00:28:48,159
any mailbox in the tenant

973
00:28:48,159 --> 00:28:50,559
so let's take a look at what that looks

974
00:28:50,559 --> 00:28:51,440
like

975
00:28:51,440 --> 00:28:54,880
if i'm an application so

976
00:28:54,880 --> 00:28:58,000
going over here i actually set up

977
00:28:58,000 --> 00:29:00,000
a demo app in my lab that has that

978
00:29:00,000 --> 00:29:02,240
setting mailboxsettings.readwrite as an

979
00:29:02,240 --> 00:29:03,360
app permission

980
00:29:03,360 --> 00:29:06,000
so this app that i'm going to demo with

981
00:29:06,000 --> 00:29:07,200
has the ability to go

982
00:29:07,200 --> 00:29:09,120
touch any mailbox and set mail

983
00:29:09,120 --> 00:29:11,120
forwarding rules on it essentially

984
00:29:11,120 --> 00:29:14,000
so you know we're not 100 sure how the

985
00:29:14,000 --> 00:29:15,360
setting got put in maybe an

986
00:29:15,360 --> 00:29:16,240
administrator got

987
00:29:16,240 --> 00:29:18,399
tricked maybe an admin consented to this

988
00:29:18,399 --> 00:29:19,360
because they didn't really know what

989
00:29:19,360 --> 00:29:20,240
they were doing

990
00:29:20,240 --> 00:29:22,960
or uh something happened where this app

991
00:29:22,960 --> 00:29:24,399
got an application

992
00:29:24,399 --> 00:29:26,880
mailbox setting.read permission so not

993
00:29:26,880 --> 00:29:28,480
ideal

994
00:29:28,480 --> 00:29:30,799
so if we pop open postman i'm going to

995
00:29:30,799 --> 00:29:32,799
pretend to be the application here

996
00:29:32,799 --> 00:29:34,720
so what i'm going to do here first is

997
00:29:34,720 --> 00:29:36,240
get an access token

998
00:29:36,240 --> 00:29:38,159
so what i've just done is i've gotten an

999
00:29:38,159 --> 00:29:39,840
access token in the context of the

1000
00:29:39,840 --> 00:29:40,559
application

1001
00:29:40,559 --> 00:29:43,520
no user signed in there's no no user

1002
00:29:43,520 --> 00:29:44,159
interaction

1003
00:29:44,159 --> 00:29:46,080
no administrator interaction i'm going

1004
00:29:46,080 --> 00:29:47,520
to take this access token

1005
00:29:47,520 --> 00:29:49,919
and in the context of the application

1006
00:29:49,919 --> 00:29:51,279
i'm going to create a mail forwarding

1007
00:29:51,279 --> 00:29:52,159
rule

1008
00:29:52,159 --> 00:29:54,480
so i've got a user here uh so same demo

1009
00:29:54,480 --> 00:29:56,000
user i've been using so luke

1010
00:29:56,000 --> 00:29:58,159
michael epping.com and i'm going to make

1011
00:29:58,159 --> 00:30:00,720
a call to microsoft graph api

1012
00:30:00,720 --> 00:30:03,440
to set a forwarding rule on his inbox so

1013
00:30:03,440 --> 00:30:04,960
again no user interaction here like

1014
00:30:04,960 --> 00:30:06,320
luke's never signed in

1015
00:30:06,320 --> 00:30:07,679
nobody signed into this thing this

1016
00:30:07,679 --> 00:30:09,440
application just has permission to do

1017
00:30:09,440 --> 00:30:10,480
this

1018
00:30:10,480 --> 00:30:12,640
so i run the graph api command and it's

1019
00:30:12,640 --> 00:30:15,120
done there's a mail forwarding rule

1020
00:30:15,120 --> 00:30:16,559
so what does this look like from an end

1021
00:30:16,559 --> 00:30:18,720
user perspective so if i go

1022
00:30:18,720 --> 00:30:23,039
back to luke and go to his mailbox

1023
00:30:23,039 --> 00:30:26,080
view outlook settings and rules

1024
00:30:26,080 --> 00:30:27,039
we can see that there's a mail

1025
00:30:27,039 --> 00:30:28,960
forwarding rule here i can set any

1026
00:30:28,960 --> 00:30:30,480
parameters on this i want

1027
00:30:30,480 --> 00:30:32,640
i can make it look sort of official try

1028
00:30:32,640 --> 00:30:34,880
to try to encourage the end user not to

1029
00:30:34,880 --> 00:30:36,320
modify this make it look really

1030
00:30:36,320 --> 00:30:38,000
legitimate

1031
00:30:38,000 --> 00:30:40,880
but if i go back to postman and i look

1032
00:30:40,880 --> 00:30:43,039
at the actual contents of the rule

1033
00:30:43,039 --> 00:30:44,480
we can see here that it's forwarding to

1034
00:30:44,480 --> 00:30:46,320
my gmail address and i just use help

1035
00:30:46,320 --> 00:30:47,840
desk as a placeholder

1036
00:30:47,840 --> 00:30:49,679
so essentially what we have here is an

1037
00:30:49,679 --> 00:30:51,600
application that has permissions to

1038
00:30:51,600 --> 00:30:54,000
modify mailbox rules on a user account

1039
00:30:54,000 --> 00:30:56,960
with no human interaction so once the

1040
00:30:56,960 --> 00:30:58,799
permission is given this application can

1041
00:30:58,799 --> 00:30:59,279
do this

1042
00:30:59,279 --> 00:31:01,679
at any time to any mailbox so even if i

1043
00:31:01,679 --> 00:31:02,960
delete this application

1044
00:31:02,960 --> 00:31:04,480
this mail forwarding rule that's being

1045
00:31:04,480 --> 00:31:06,080
used for data exfiltration

1046
00:31:06,080 --> 00:31:09,039
is not going away

1047
00:31:10,320 --> 00:31:12,639
okay

1048
00:31:14,640 --> 00:31:19,840
so let me just fire my slides back up

1049
00:31:20,159 --> 00:31:22,000
so how do we actually investigate these

1050
00:31:22,000 --> 00:31:23,760
illicit consent grants so we have these

1051
00:31:23,760 --> 00:31:25,519
in our environment already but we need

1052
00:31:25,519 --> 00:31:26,960
to actually go discover them

1053
00:31:26,960 --> 00:31:29,039
uh so at this point like maybe an

1054
00:31:29,039 --> 00:31:30,399
administrator and your tenant has

1055
00:31:30,399 --> 00:31:32,399
already consented to something

1056
00:31:32,399 --> 00:31:34,320
maybe it already exists what do we do

1057
00:31:34,320 --> 00:31:35,600
about it

1058
00:31:35,600 --> 00:31:37,840
so there are multiple ways to

1059
00:31:37,840 --> 00:31:38,960
investigate this

1060
00:31:38,960 --> 00:31:40,960
uh some that are like really easy to do

1061
00:31:40,960 --> 00:31:42,559
in a one-off scenario

1062
00:31:42,559 --> 00:31:44,399
but if you have a lot of applications in

1063
00:31:44,399 --> 00:31:46,240
your tenant like hundreds or potentially

1064
00:31:46,240 --> 00:31:48,480
thousands in the case of a really large

1065
00:31:48,480 --> 00:31:50,720
uh azure ad tenant we need something a

1066
00:31:50,720 --> 00:31:52,240
little more automated

1067
00:31:52,240 --> 00:31:53,919
but the first thing is you can use the

1068
00:31:53,919 --> 00:31:55,519
office 365 portal

1069
00:31:55,519 --> 00:31:57,360
um there's an audit log tool in the

1070
00:31:57,360 --> 00:31:59,039
office 365 portal

1071
00:31:59,039 --> 00:32:00,559
that you can lose you can use to look

1072
00:32:00,559 --> 00:32:02,960
for all sorts of things you can look for

1073
00:32:02,960 --> 00:32:04,240
applications getting added to the

1074
00:32:04,240 --> 00:32:07,279
directory consents being done

1075
00:32:07,279 --> 00:32:09,039
you can use the security and compliance

1076
00:32:09,039 --> 00:32:11,279
center audit logs to look for admin

1077
00:32:11,279 --> 00:32:11,840
consent

1078
00:32:11,840 --> 00:32:14,559
actions uh you know any actions taken by

1079
00:32:14,559 --> 00:32:16,159
your global administrators it's very

1080
00:32:16,159 --> 00:32:17,760
powerful

1081
00:32:17,760 --> 00:32:19,840
so there's a lot you can do there in the

1082
00:32:19,840 --> 00:32:22,000
azure id portal like i showed you

1083
00:32:22,000 --> 00:32:23,519
there's an enterprise app section where

1084
00:32:23,519 --> 00:32:24,960
you can go and look at the permissions

1085
00:32:24,960 --> 00:32:26,480
that are on any of the applications in

1086
00:32:26,480 --> 00:32:27,760
your directory

1087
00:32:27,760 --> 00:32:30,159
there's also audit logs in azure ad

1088
00:32:30,159 --> 00:32:32,240
azure id retains audit logs for 30 days

1089
00:32:32,240 --> 00:32:34,880
but there's ways to export these to

1090
00:32:34,880 --> 00:32:38,080
like sim tools splunk whatever so you

1091
00:32:38,080 --> 00:32:38,880
can invest

1092
00:32:38,880 --> 00:32:41,039
so you can keep them for longer to do

1093
00:32:41,039 --> 00:32:43,840
investigations past the 30-day mark

1094
00:32:43,840 --> 00:32:45,200
but then if we want to actually

1095
00:32:45,200 --> 00:32:47,120
investigate what exists at the point in

1096
00:32:47,120 --> 00:32:47,679
time

1097
00:32:47,679 --> 00:32:49,519
we've written a powershell script so

1098
00:32:49,519 --> 00:32:50,880
basically what this powershell script

1099
00:32:50,880 --> 00:32:52,480
allows you to do and i'll i'll demo it

1100
00:32:52,480 --> 00:32:53,519
in a little bit

1101
00:32:53,519 --> 00:32:55,600
but what it allows you to do is actually

1102
00:32:55,600 --> 00:32:57,360
pull a list of all the permissions that

1103
00:32:57,360 --> 00:32:59,279
are in your directory currently

1104
00:32:59,279 --> 00:33:01,840
and export them to an excel file and you

1105
00:33:01,840 --> 00:33:03,200
know parse through it

1106
00:33:03,200 --> 00:33:05,120
you can do pivot tables you know any

1107
00:33:05,120 --> 00:33:06,799
sort of data analysis that's available

1108
00:33:06,799 --> 00:33:07,919
in excel

1109
00:33:07,919 --> 00:33:10,480
and really comb through this and

1110
00:33:10,480 --> 00:33:11,120
hopefully

1111
00:33:11,120 --> 00:33:13,279
what the excel the excel file also helps

1112
00:33:13,279 --> 00:33:15,360
you do is prioritize

1113
00:33:15,360 --> 00:33:17,279
and then finally there's casb solutions

1114
00:33:17,279 --> 00:33:18,640
as well so in

1115
00:33:18,640 --> 00:33:21,039
uh at microsoft we have microsoft cloud

1116
00:33:21,039 --> 00:33:22,559
app security which is our casb

1117
00:33:22,559 --> 00:33:24,000
product there's other ones out there on

1118
00:33:24,000 --> 00:33:26,720
the market but these also allow you to

1119
00:33:26,720 --> 00:33:28,799
investigate so with microsoft cloud fc

1120
00:33:28,799 --> 00:33:31,519
security you can create policies to

1121
00:33:31,519 --> 00:33:33,760
investigate risky app consents and even

1122
00:33:33,760 --> 00:33:36,879
revoke or block them

1123
00:33:37,760 --> 00:33:40,559
so start with high risk users and apps

1124
00:33:40,559 --> 00:33:43,279
that have lots of users assigned to them

1125
00:33:43,279 --> 00:33:45,440
the reason for this is in really really

1126
00:33:45,440 --> 00:33:47,039
large tenants you may have a ton of

1127
00:33:47,039 --> 00:33:48,880
applications and you want to prioritize

1128
00:33:48,880 --> 00:33:49,519
like what's

1129
00:33:49,519 --> 00:33:51,519
most risky so mark showed the slide

1130
00:33:51,519 --> 00:33:53,440
earlier where he outlined like

1131
00:33:53,440 --> 00:33:55,600
permissions that we we say are

1132
00:33:55,600 --> 00:33:57,200
relatively high risk

1133
00:33:57,200 --> 00:33:59,760
uh ideally you'd investigate everything

1134
00:33:59,760 --> 00:34:00,240
but

1135
00:34:00,240 --> 00:34:02,080
sometimes there's a lot going on in an

1136
00:34:02,080 --> 00:34:03,360
environment and you want to start with

1137
00:34:03,360 --> 00:34:04,720
what's most high risk

1138
00:34:04,720 --> 00:34:06,880
so in the script in the excel output

1139
00:34:06,880 --> 00:34:08,000
we've tried to help you

1140
00:34:08,000 --> 00:34:10,239
do this prioritization so that you have

1141
00:34:10,239 --> 00:34:12,159
a list of applications that have lots of

1142
00:34:12,159 --> 00:34:13,599
users assigned to them

1143
00:34:13,599 --> 00:34:15,918
uh they're they have riskier permissions

1144
00:34:15,918 --> 00:34:17,839
they have application permissions

1145
00:34:17,839 --> 00:34:19,280
you know like all the red flags we're

1146
00:34:19,280 --> 00:34:21,520
kind of looking for uh so in the excel

1147
00:34:21,520 --> 00:34:22,639
file you'll see there's a high risk

1148
00:34:22,639 --> 00:34:25,199
users tab and also a high risk apps tab

1149
00:34:25,199 --> 00:34:27,520
uh definitely use these uh and start

1150
00:34:27,520 --> 00:34:29,199
with those applications but

1151
00:34:29,199 --> 00:34:30,719
don't stop there like you really want to

1152
00:34:30,719 --> 00:34:32,159
get a handle on this for your entire

1153
00:34:32,159 --> 00:34:34,000
environment

1154
00:34:34,000 --> 00:34:34,960
and you want to look for write

1155
00:34:34,960 --> 00:34:36,719
permissions that that's one of the other

1156
00:34:36,719 --> 00:34:37,199
things

1157
00:34:37,199 --> 00:34:39,918
to keep in mind is read permissions can

1158
00:34:39,918 --> 00:34:41,440
be dangerous but the right permissions

1159
00:34:41,440 --> 00:34:43,440
are like really really dangerous

1160
00:34:43,440 --> 00:34:45,199
you want to look for things like

1161
00:34:45,199 --> 00:34:47,119
applications that have right permissions

1162
00:34:47,119 --> 00:34:49,679
or delegated right permissions that have

1163
00:34:49,679 --> 00:34:51,520
a lot of power over a user like things

1164
00:34:51,520 --> 00:34:53,359
like modifying the user's mailbox and

1165
00:34:53,359 --> 00:34:56,000
things like that

1166
00:34:56,239 --> 00:34:58,880
okay so let's take a look at the excel

1167
00:34:58,880 --> 00:35:00,560
file

1168
00:35:00,560 --> 00:35:02,400
this is just an export from my lab

1169
00:35:02,400 --> 00:35:04,880
tenant uh but basically what this excel

1170
00:35:04,880 --> 00:35:06,079
file consists of

1171
00:35:06,079 --> 00:35:08,400
is a big bucket of data about every

1172
00:35:08,400 --> 00:35:09,280
consent grant

1173
00:35:09,280 --> 00:35:11,200
that exists in the tenant and then we

1174
00:35:11,200 --> 00:35:12,880
have a few tabs that we auto-generate

1175
00:35:12,880 --> 00:35:13,599
that have

1176
00:35:13,599 --> 00:35:16,240
pivot tables and pivot charts on them

1177
00:35:16,240 --> 00:35:16,800
and

1178
00:35:16,800 --> 00:35:18,800
we've done some classification for you

1179
00:35:18,800 --> 00:35:20,079
so that you can see

1180
00:35:20,079 --> 00:35:22,480
what applications are considered to have

1181
00:35:22,480 --> 00:35:23,920
low risk permissions

1182
00:35:23,920 --> 00:35:26,800
how many have uh delegated permissions

1183
00:35:26,800 --> 00:35:28,839
to all principles so this is an admin

1184
00:35:28,839 --> 00:35:30,880
consent and then how many have

1185
00:35:30,880 --> 00:35:32,800
individual user consents

1186
00:35:32,800 --> 00:35:34,240
and then how many have application

1187
00:35:34,240 --> 00:35:36,640
permissions so for example

1188
00:35:36,640 --> 00:35:38,720
there's some you know graph api

1189
00:35:38,720 --> 00:35:40,400
permissions that have been granted to

1190
00:35:40,400 --> 00:35:42,400
all users in this tenant and some

1191
00:35:42,400 --> 00:35:43,760
application permissions

1192
00:35:43,760 --> 00:35:45,040
these are things we probably want to

1193
00:35:45,040 --> 00:35:47,440
look into if you're better at pivot

1194
00:35:47,440 --> 00:35:49,040
tables than i am when i wrote the script

1195
00:35:49,040 --> 00:35:50,800
all the raw data is there so you can do

1196
00:35:50,800 --> 00:35:52,800
any of your own analysis but hopefully

1197
00:35:52,800 --> 00:35:53,920
this is something to help you get

1198
00:35:53,920 --> 00:35:54,960
started

1199
00:35:54,960 --> 00:35:57,040
so like i mentioned we have we also have

1200
00:35:57,040 --> 00:35:58,160
these high-risk user

1201
00:35:58,160 --> 00:36:01,200
and uh high-risk apps tabs so there's

1202
00:36:01,200 --> 00:36:02,720
some logic built into the script to

1203
00:36:02,720 --> 00:36:04,640
basically look for users who have lots

1204
00:36:04,640 --> 00:36:05,920
of permissions

1205
00:36:05,920 --> 00:36:08,240
uh you know lots of consent grants in

1206
00:36:08,240 --> 00:36:10,000
the environment and then flag them so

1207
00:36:10,000 --> 00:36:11,920
that you can investigate these users

1208
00:36:11,920 --> 00:36:12,560
well

1209
00:36:12,560 --> 00:36:15,280
you know and help you prioritize in this

1210
00:36:15,280 --> 00:36:16,640
environment i don't have a ton of users

1211
00:36:16,640 --> 00:36:18,160
but there could be a bunch in here

1212
00:36:18,160 --> 00:36:19,839
at different risk levels like medium low

1213
00:36:19,839 --> 00:36:21,760
but really like the high risk users are

1214
00:36:21,760 --> 00:36:23,119
the place to start

1215
00:36:23,119 --> 00:36:24,880
and then probably even more important is

1216
00:36:24,880 --> 00:36:26,160
high risk applications

1217
00:36:26,160 --> 00:36:27,839
so again those applications that have

1218
00:36:27,839 --> 00:36:29,280
lots of users assigned

1219
00:36:29,280 --> 00:36:31,280
so if you see this all users thing again

1220
00:36:31,280 --> 00:36:32,720
this means that there was an admin

1221
00:36:32,720 --> 00:36:33,680
consent done

1222
00:36:33,680 --> 00:36:35,760
which means that any user in your tenant

1223
00:36:35,760 --> 00:36:37,599
can access this application

1224
00:36:37,599 --> 00:36:39,440
and you use any of the effective

1225
00:36:39,440 --> 00:36:41,280
permissions that that app has

1226
00:36:41,280 --> 00:36:43,760
or the application has some application

1227
00:36:43,760 --> 00:36:44,640
permissions

1228
00:36:44,640 --> 00:36:46,880
so can act without a user signed in at

1229
00:36:46,880 --> 00:36:48,640
all

1230
00:36:48,640 --> 00:36:50,560
um and then for other applications there

1231
00:36:50,560 --> 00:36:52,320
may be a subset of your users who are

1232
00:36:52,320 --> 00:36:54,160
allowed to sign into that application

1233
00:36:54,160 --> 00:36:56,240
so we just have a nice descending table

1234
00:36:56,240 --> 00:36:57,680
to hopefully make it easier to

1235
00:36:57,680 --> 00:37:00,319
prioritize

1236
00:37:06,839 --> 00:37:09,200
okay so some other indicators of

1237
00:37:09,200 --> 00:37:10,960
compromise to look for

1238
00:37:10,960 --> 00:37:13,680
uh apps trying to blend in i i've seen

1239
00:37:13,680 --> 00:37:15,520
apps before that look like sharepoint

1240
00:37:15,520 --> 00:37:17,040
but they have like a one instead of the

1241
00:37:17,040 --> 00:37:17,760
i

1242
00:37:17,760 --> 00:37:19,920
um you know you saw in our lab tenant we

1243
00:37:19,920 --> 00:37:21,359
have wood groove

1244
00:37:21,359 --> 00:37:23,599
instead of wood grove uh you know apps

1245
00:37:23,599 --> 00:37:25,359
will try to blend in they'll try to look

1246
00:37:25,359 --> 00:37:26,880
like a legitimate application they'll

1247
00:37:26,880 --> 00:37:28,320
try to look like one drive they'll try

1248
00:37:28,320 --> 00:37:30,160
to look like sharepoint they'll even use

1249
00:37:30,160 --> 00:37:32,000
like very similar logos all sorts of

1250
00:37:32,000 --> 00:37:33,119
stuff like that

1251
00:37:33,119 --> 00:37:35,280
um so keep an eye out for things like

1252
00:37:35,280 --> 00:37:36,400
that uh

1253
00:37:36,400 --> 00:37:38,240
keep an eye out for suspicious activity

1254
00:37:38,240 --> 00:37:39,599
like if you're analyzing your sign-in

1255
00:37:39,599 --> 00:37:41,359
logs for your applications

1256
00:37:41,359 --> 00:37:43,040
um you know look for things like users

1257
00:37:43,040 --> 00:37:44,960
signing in at odd times of the day

1258
00:37:44,960 --> 00:37:47,280
uh users signing in from odd locations

1259
00:37:47,280 --> 00:37:49,200
uh you know you know your environment

1260
00:37:49,200 --> 00:37:51,280
and you should really know like what the

1261
00:37:51,280 --> 00:37:52,960
typical usage pattern in your

1262
00:37:52,960 --> 00:37:55,200
environment is and then be able to flag

1263
00:37:55,200 --> 00:37:55,920
things that

1264
00:37:55,920 --> 00:37:58,960
fall outside that usage pattern

1265
00:37:58,960 --> 00:38:00,880
so deviation from the user's normal

1266
00:38:00,880 --> 00:38:02,960
behavior is the user logging into all

1267
00:38:02,960 --> 00:38:04,560
sorts of applications that they really

1268
00:38:04,560 --> 00:38:06,160
shouldn't be like do you have a user in

1269
00:38:06,160 --> 00:38:07,760
finance who's doing lots of stuff with

1270
00:38:07,760 --> 00:38:08,720
graph api

1271
00:38:08,720 --> 00:38:10,320
that might be like a little unusual are

1272
00:38:10,320 --> 00:38:12,480
they accessing like azure id powershell

1273
00:38:12,480 --> 00:38:14,240
that might be a little unusual

1274
00:38:14,240 --> 00:38:16,560
um so you know your users you know what

1275
00:38:16,560 --> 00:38:18,320
they're generally getting up to

1276
00:38:18,320 --> 00:38:20,720
keep an eye out for for users doing

1277
00:38:20,720 --> 00:38:23,440
things that you normally wouldn't expect

1278
00:38:23,440 --> 00:38:25,280
and date and time of applications being

1279
00:38:25,280 --> 00:38:26,640
created

1280
00:38:26,640 --> 00:38:28,079
so if you know that there was a

1281
00:38:28,079 --> 00:38:30,000
compromise look at your look at your

1282
00:38:30,000 --> 00:38:30,560
logs

1283
00:38:30,560 --> 00:38:32,480
and see was an application created in my

1284
00:38:32,480 --> 00:38:34,800
tenant around that time or just

1285
00:38:34,800 --> 00:38:36,720
previously to some sort of incident

1286
00:38:36,720 --> 00:38:38,000
and use that as part of your

1287
00:38:38,000 --> 00:38:39,839
investigation look at who added the

1288
00:38:39,839 --> 00:38:40,720
application

1289
00:38:40,720 --> 00:38:43,599
what permissions were granted to it all

1290
00:38:43,599 --> 00:38:47,839
those sorts of things

1291
00:38:50,079 --> 00:38:51,599
so you also need to determine the

1292
00:38:51,599 --> 00:38:54,480
magnitude and scope of the attack

1293
00:38:54,480 --> 00:38:55,920
so one of the things that you can do and

1294
00:38:55,920 --> 00:38:57,520
this is a tip from

1295
00:38:57,520 --> 00:39:00,560
microsoft start team i believe so and

1296
00:39:00,560 --> 00:39:01,920
that's one of our incident response

1297
00:39:01,920 --> 00:39:03,599
teams but basically what you can do is

1298
00:39:03,599 --> 00:39:04,720
use the

1299
00:39:04,720 --> 00:39:08,000
office 365 content search or audit log

1300
00:39:08,000 --> 00:39:09,920
and content search tool

1301
00:39:09,920 --> 00:39:11,280
and you can scope it to a specific

1302
00:39:11,280 --> 00:39:14,720
service so like if you have a breach

1303
00:39:14,720 --> 00:39:17,040
go in here do an audit log search see

1304
00:39:17,040 --> 00:39:18,880
everything that a particular user was up

1305
00:39:18,880 --> 00:39:20,560
to around the time of an incident

1306
00:39:20,560 --> 00:39:22,320
and scope it to a specific service if

1307
00:39:22,320 --> 00:39:24,960
you're able it makes the the search tool

1308
00:39:24,960 --> 00:39:26,800
execute much more quickly if you can

1309
00:39:26,800 --> 00:39:28,000
scope down what you're looking

1310
00:39:28,000 --> 00:39:30,240
for

1311
00:39:32,240 --> 00:39:34,320
and if you have a confirmation of of an

1312
00:39:34,320 --> 00:39:35,440
attack start your

1313
00:39:35,440 --> 00:39:38,400
your incident response process so does

1314
00:39:38,400 --> 00:39:40,160
your incident response process

1315
00:39:40,160 --> 00:39:43,280
cover app consent scenarios so

1316
00:39:43,280 --> 00:39:45,200
all the stuff we've been talking about

1317
00:39:45,200 --> 00:39:46,560
are these things

1318
00:39:46,560 --> 00:39:49,200
factored into your incident response so

1319
00:39:49,200 --> 00:39:50,079
do you disable

1320
00:39:50,079 --> 00:39:52,079
the malicious service principle are you

1321
00:39:52,079 --> 00:39:53,920
revoking the oauth consents that are

1322
00:39:53,920 --> 00:39:54,560
done

1323
00:39:54,560 --> 00:39:56,079
there's powershell commands you can use

1324
00:39:56,079 --> 00:39:57,599
to revoke the oauth

1325
00:39:57,599 --> 00:40:00,400
consents um are you revoking the service

1326
00:40:00,400 --> 00:40:02,880
april assignment with powershell

1327
00:40:02,880 --> 00:40:04,400
are you disabling sign in for accounts

1328
00:40:04,400 --> 00:40:05,920
that have accessed the application

1329
00:40:05,920 --> 00:40:07,680
or accounts that may have consented to

1330
00:40:07,680 --> 00:40:09,520
the application or done an admin consent

1331
00:40:09,520 --> 00:40:10,720
to the application

1332
00:40:10,720 --> 00:40:12,000
and are you then investigating

1333
00:40:12,000 --> 00:40:13,760
persistence mechanisms so if the

1334
00:40:13,760 --> 00:40:15,440
application has the ability to

1335
00:40:15,440 --> 00:40:17,760
modify mailbox settings like i showed

1336
00:40:17,760 --> 00:40:19,520
maybe you need to look at like are there

1337
00:40:19,520 --> 00:40:21,359
any weird mailbox rules on some of the

1338
00:40:21,359 --> 00:40:22,560
mailboxes

1339
00:40:22,560 --> 00:40:24,079
you need to investigate what may have

1340
00:40:24,079 --> 00:40:25,520
been done with the permissions that were

1341
00:40:25,520 --> 00:40:27,040
granted to the elicit

1342
00:40:27,040 --> 00:40:31,119
uh the illicitly consented application

1343
00:40:31,359 --> 00:40:34,240
okay back to you mark yeah so let's

1344
00:40:34,240 --> 00:40:35,520
cover some best practices but

1345
00:40:35,520 --> 00:40:36,640
that big one there at the very end

1346
00:40:36,640 --> 00:40:38,000
michael talked about is removing the

1347
00:40:38,000 --> 00:40:38,880
persistence is

1348
00:40:38,880 --> 00:40:41,599
is super super key sometimes customers

1349
00:40:41,599 --> 00:40:43,280
discover there's an app that's malicious

1350
00:40:43,280 --> 00:40:45,839
and then they're like i dumped the

1351
00:40:45,839 --> 00:40:46,400
memory

1352
00:40:46,400 --> 00:40:48,079
we ran everything on the box we did

1353
00:40:48,079 --> 00:40:49,440
timeline analysis

1354
00:40:49,440 --> 00:40:52,000
like it looks clean and it's like it's

1355
00:40:52,000 --> 00:40:52,960
not on the box

1356
00:40:52,960 --> 00:40:55,359
right it's in the service so that's uh

1357
00:40:55,359 --> 00:40:56,640
super super

1358
00:40:56,640 --> 00:40:59,839
important to realize okay uh what are

1359
00:40:59,839 --> 00:41:01,520
some best practices we can do for this

1360
00:41:01,520 --> 00:41:03,440
so the first one here is you can set

1361
00:41:03,440 --> 00:41:06,319
policies so any app consent policy that

1362
00:41:06,319 --> 00:41:08,000
the user is going to

1363
00:41:08,000 --> 00:41:10,000
get um get prompted with you can you

1364
00:41:10,000 --> 00:41:11,200
have three different choices and it's a

1365
00:41:11,200 --> 00:41:13,440
little hard to see depending on

1366
00:41:13,440 --> 00:41:15,520
your bandwidth here but the the bottom

1367
00:41:15,520 --> 00:41:17,119
uh there it goes the bottom one

1368
00:41:17,119 --> 00:41:19,119
is allow users to consent for any

1369
00:41:19,119 --> 00:41:20,240
application

1370
00:41:20,240 --> 00:41:21,920
um so any user can consent to any

1371
00:41:21,920 --> 00:41:23,359
application permissions that delegate

1372
00:41:23,359 --> 00:41:24,000
permissions

1373
00:41:24,000 --> 00:41:25,920
um they can just consent to it the top

1374
00:41:25,920 --> 00:41:27,599
button is don't allow users to consent

1375
00:41:27,599 --> 00:41:29,200
anything an admin has to go in and

1376
00:41:29,200 --> 00:41:30,400
approve everything

1377
00:41:30,400 --> 00:41:32,160
the the goldilocks one is kind of this

1378
00:41:32,160 --> 00:41:33,520
middle one that which which is now the

1379
00:41:33,520 --> 00:41:34,560
default

1380
00:41:34,560 --> 00:41:35,920
in which we recommend but i've seen

1381
00:41:35,920 --> 00:41:37,680
customers set to the the bottom one

1382
00:41:37,680 --> 00:41:38,880
which is allow anyone to consent to

1383
00:41:38,880 --> 00:41:39,839
anything because they didn't understand

1384
00:41:39,839 --> 00:41:40,880
what was going on

1385
00:41:40,880 --> 00:41:43,920
and this is if there's a low permission

1386
00:41:43,920 --> 00:41:45,680
which you can define which are those low

1387
00:41:45,680 --> 00:41:47,119
impact permissions

1388
00:41:47,119 --> 00:41:49,359
and the application is from a verified

1389
00:41:49,359 --> 00:41:50,560
publisher so that's

1390
00:41:50,560 --> 00:41:52,560
they've the application vendor has

1391
00:41:52,560 --> 00:41:54,319
connected their tenant to their

1392
00:41:54,319 --> 00:41:55,839
microsoft partner network so you get the

1393
00:41:55,839 --> 00:41:57,200
little like blue check box

1394
00:41:57,200 --> 00:41:59,359
in the uh in the app if it's one of

1395
00:41:59,359 --> 00:42:01,520
those you can let people consent to it

1396
00:42:01,520 --> 00:42:02,960
which means like hey we're we're we

1397
00:42:02,960 --> 00:42:04,319
trust this application it's not some

1398
00:42:04,319 --> 00:42:05,359
fly-by-night thing

1399
00:42:05,359 --> 00:42:07,680
we're okay with it so you can set those

1400
00:42:07,680 --> 00:42:08,800
but pick a thing

1401
00:42:08,800 --> 00:42:10,000
and make sure you set it so you

1402
00:42:10,000 --> 00:42:12,079
understand what people can do in your

1403
00:42:12,079 --> 00:42:12,640
environment

1404
00:42:12,640 --> 00:42:14,880
to begin with then also if you have a

1405
00:42:14,880 --> 00:42:16,560
cloud app security

1406
00:42:16,560 --> 00:42:17,680
you can go ahead and use this to

1407
00:42:17,680 --> 00:42:19,839
automatically revoke any applications

1408
00:42:19,839 --> 00:42:21,920
when app risk is detected so that's the

1409
00:42:21,920 --> 00:42:23,359
first thing you can do

1410
00:42:23,359 --> 00:42:27,359
the second thing is this step up consent

1411
00:42:27,359 --> 00:42:30,319
so when risky consent is being asked for

1412
00:42:30,319 --> 00:42:30,640
the

1413
00:42:30,640 --> 00:42:32,240
admin will have to go in and approve

1414
00:42:32,240 --> 00:42:33,920
this this is on by default so somebody

1415
00:42:33,920 --> 00:42:34,480
uh chris

1416
00:42:34,480 --> 00:42:36,560
asks in the chat is there a way for

1417
00:42:36,560 --> 00:42:38,319
admins to be able to like review the

1418
00:42:38,319 --> 00:42:39,680
configuration before

1419
00:42:39,680 --> 00:42:41,359
actually going forward this is exactly

1420
00:42:41,359 --> 00:42:42,960
what this is this is that middle ground

1421
00:42:42,960 --> 00:42:44,160
you can do um

1422
00:42:44,160 --> 00:42:46,800
for that and only administrators would

1423
00:42:46,800 --> 00:42:48,560
be able to consent to an application

1424
00:42:48,560 --> 00:42:50,319
if it's not one of those from a verified

1425
00:42:50,319 --> 00:42:51,680
publisher or if it's not one of those

1426
00:42:51,680 --> 00:42:52,800
application permissions that's

1427
00:42:52,800 --> 00:42:53,680
considered like low

1428
00:42:53,680 --> 00:42:56,400
impact the other thing here with this is

1429
00:42:56,400 --> 00:42:57,599
an audit event

1430
00:42:57,599 --> 00:43:00,480
will be logged as well so this is really

1431
00:43:00,480 --> 00:43:01,040
really

1432
00:43:01,040 --> 00:43:04,240
useful if you see somebody maybe

1433
00:43:04,240 --> 00:43:06,400
clicked on an application that was

1434
00:43:06,400 --> 00:43:07,920
considered risky

1435
00:43:07,920 --> 00:43:09,440
and it showed up in the audit log but

1436
00:43:09,440 --> 00:43:10,800
you know they weren't able to consent to

1437
00:43:10,800 --> 00:43:11,680
that

1438
00:43:11,680 --> 00:43:13,839
maybe they just got a phishing email

1439
00:43:13,839 --> 00:43:15,040
right and maybe they're getting

1440
00:43:15,040 --> 00:43:17,440
other phishing emails right so just

1441
00:43:17,440 --> 00:43:19,280
because a user

1442
00:43:19,280 --> 00:43:21,359
wasn't able to consent to this

1443
00:43:21,359 --> 00:43:22,560
application

1444
00:43:22,560 --> 00:43:25,119
and is pending an admin that is really

1445
00:43:25,119 --> 00:43:27,280
good information for us as defenders to

1446
00:43:27,280 --> 00:43:28,480
take a look at because now maybe that

1447
00:43:28,480 --> 00:43:30,079
domain is suspicious maybe the email

1448
00:43:30,079 --> 00:43:31,520
address itself is suspicious we can

1449
00:43:31,520 --> 00:43:32,720
maybe look at other people that have

1450
00:43:32,720 --> 00:43:33,599
gotten that mail right

1451
00:43:33,599 --> 00:43:34,960
so make sure you're looking at your

1452
00:43:34,960 --> 00:43:38,480
autolog for these types of events

1453
00:43:38,480 --> 00:43:41,040
all right next is how do we detect these

1454
00:43:41,040 --> 00:43:42,400
applications so those those two

1455
00:43:42,400 --> 00:43:43,680
configurations things we just talked

1456
00:43:43,680 --> 00:43:44,480
about is

1457
00:43:44,480 --> 00:43:46,560
going forward right this is what the new

1458
00:43:46,560 --> 00:43:47,920
applications are gonna get

1459
00:43:47,920 --> 00:43:49,440
now how we look at what's already

1460
00:43:49,440 --> 00:43:50,880
happened in our environment so the first

1461
00:43:50,880 --> 00:43:51,599
one there

1462
00:43:51,599 --> 00:43:52,720
michael already walked us through this

1463
00:43:52,720 --> 00:43:54,960
which is that really really nice script

1464
00:43:54,960 --> 00:43:58,079
um i i pasted the link in the chat but

1465
00:43:58,079 --> 00:43:59,359
you can get it here as well

1466
00:43:59,359 --> 00:44:01,119
and this dumps out all those permissions

1467
00:44:01,119 --> 00:44:02,160
you can look through them do the pivot

1468
00:44:02,160 --> 00:44:03,760
tables all that kind of good stuff

1469
00:44:03,760 --> 00:44:06,319
um that's a good place to start the

1470
00:44:06,319 --> 00:44:07,920
issue with that is you have to do it all

1471
00:44:07,920 --> 00:44:08,720
the time right like

1472
00:44:08,720 --> 00:44:11,280
some admin has to go in and run this and

1473
00:44:11,280 --> 00:44:12,960
look at this and then make a decision

1474
00:44:12,960 --> 00:44:14,400
and you have to keep doing it

1475
00:44:14,400 --> 00:44:16,800
over and over again a better thing you

1476
00:44:16,800 --> 00:44:17,680
can do

1477
00:44:17,680 --> 00:44:21,280
is using azure monitor or a seam tool of

1478
00:44:21,280 --> 00:44:22,800
your choice where you're piping those

1479
00:44:22,800 --> 00:44:24,240
audit logs to it and you take a look at

1480
00:44:24,240 --> 00:44:25,599
but an azure monitor

1481
00:44:25,599 --> 00:44:28,000
you can automatically send notifications

1482
00:44:28,000 --> 00:44:29,680
when an app is requiring high

1483
00:44:29,680 --> 00:44:30,560
permissions

1484
00:44:30,560 --> 00:44:33,200
an app has been authorized by more than

1485
00:44:33,200 --> 00:44:35,040
whatever amount so let's say it's

1486
00:44:35,040 --> 00:44:37,280
that good example there is that apple um

1487
00:44:37,280 --> 00:44:38,720
mail app right

1488
00:44:38,720 --> 00:44:40,240
a bunch of people are consenting to that

1489
00:44:40,240 --> 00:44:42,400
they can let's take a look at that

1490
00:44:42,400 --> 00:44:43,839
that's something we're okay with as an

1491
00:44:43,839 --> 00:44:45,359
organization let's go ahead and do admin

1492
00:44:45,359 --> 00:44:46,640
consent for everybody improve our end

1493
00:44:46,640 --> 00:44:48,000
user experience you can do that with

1494
00:44:48,000 --> 00:44:49,200
azure monitor

1495
00:44:49,200 --> 00:44:50,640
and then the best is something like a

1496
00:44:50,640 --> 00:44:52,079
kasbi solution michael kind of talked

1497
00:44:52,079 --> 00:44:53,119
about that earlier

1498
00:44:53,119 --> 00:44:55,680
um microsoft's one is called mcas but it

1499
00:44:55,680 --> 00:44:56,640
doesn't really matter you can use

1500
00:44:56,640 --> 00:44:57,920
whatever you want

1501
00:44:57,920 --> 00:45:00,560
and then again it has stuff that's like

1502
00:45:00,560 --> 00:45:02,480
apps authorized by external users that

1503
00:45:02,480 --> 00:45:04,000
high level stuff you can revoke

1504
00:45:04,000 --> 00:45:06,160
it when things are people are acting odd

1505
00:45:06,160 --> 00:45:07,760
so that's kind of like the best solution

1506
00:45:07,760 --> 00:45:09,440
you can do is that mcas but

1507
00:45:09,440 --> 00:45:12,079
um the script is great to do script that

1508
00:45:12,079 --> 00:45:13,119
automate yourself

1509
00:45:13,119 --> 00:45:15,280
even better use azure monitor or seem to

1510
00:45:15,280 --> 00:45:17,520
go through and look through that stuff

1511
00:45:17,520 --> 00:45:21,280
all right uh next thing here is

1512
00:45:21,280 --> 00:45:23,520
start getting in front of this with your

1513
00:45:23,520 --> 00:45:24,880
developers which are going to be your

1514
00:45:24,880 --> 00:45:26,000
internal developers

1515
00:45:26,000 --> 00:45:28,160
as well as the external vendors that

1516
00:45:28,160 --> 00:45:29,599
you're probably working with so we are

1517
00:45:29,599 --> 00:45:30,720
adding new

1518
00:45:30,720 --> 00:45:33,839
permissions all of the time to microsoft

1519
00:45:33,839 --> 00:45:34,720
graph

1520
00:45:34,720 --> 00:45:38,319
so we want to make sure we're using

1521
00:45:38,319 --> 00:45:41,599
least privilege right this is not

1522
00:45:41,599 --> 00:45:45,040
a new problem i'm sure everybody on this

1523
00:45:45,040 --> 00:45:48,079
on this call here has had an application

1524
00:45:48,079 --> 00:45:50,000
that the business unit bought and

1525
00:45:50,000 --> 00:45:51,839
they're like please install this for us

1526
00:45:51,839 --> 00:45:53,119
and you look at this thing and it like

1527
00:45:53,119 --> 00:45:55,359
wants enterprise admin domain admin and

1528
00:45:55,359 --> 00:45:56,960
scheme admin you're like what in the

1529
00:45:56,960 --> 00:45:58,560
world is this thing doing i thought this

1530
00:45:58,560 --> 00:46:00,000
was just like sending mail or something

1531
00:46:00,000 --> 00:46:02,880
right so developers are going to do this

1532
00:46:02,880 --> 00:46:03,839
because

1533
00:46:03,839 --> 00:46:06,079
they just don't know right they they

1534
00:46:06,079 --> 00:46:07,680
don't know what permissions they need so

1535
00:46:07,680 --> 00:46:08,640
they're going to be like give me

1536
00:46:08,640 --> 00:46:09,599
everything

1537
00:46:09,599 --> 00:46:12,560
just in case right we we don't want them

1538
00:46:12,560 --> 00:46:14,079
to do that so anytime you see

1539
00:46:14,079 --> 00:46:16,160
directory star that is not using least

1540
00:46:16,160 --> 00:46:17,440
privilege but i think everyone here

1541
00:46:17,440 --> 00:46:18,560
probably knew that already so we have

1542
00:46:18,560 --> 00:46:20,240
some links here if you go to akita ms

1543
00:46:20,240 --> 00:46:21,760
slash graph best practices

1544
00:46:21,760 --> 00:46:24,560
as well as ak ms identity platform

1545
00:46:24,560 --> 00:46:26,720
checklist there's some good stuff here

1546
00:46:26,720 --> 00:46:29,839
for your developers

1547
00:46:29,839 --> 00:46:32,319
um those that are using teams teams has

1548
00:46:32,319 --> 00:46:34,160
grown quite a bit

1549
00:46:34,160 --> 00:46:36,720
uh in the in the last six months go to

1550
00:46:36,720 --> 00:46:38,960
akms slash rsc

1551
00:46:38,960 --> 00:46:40,720
teams there's lots of app specific

1552
00:46:40,720 --> 00:46:42,000
guidance for creating apps

1553
00:46:42,000 --> 00:46:44,640
in teams but if you have uh another good

1554
00:46:44,640 --> 00:46:45,839
thing to use here

1555
00:46:45,839 --> 00:46:48,400
is if you go to ak ms identity developer

1556
00:46:48,400 --> 00:46:49,119
series

1557
00:46:49,119 --> 00:46:52,480
it's about a two and a half hour youtube

1558
00:46:52,480 --> 00:46:55,760
video that goes into how to how to do

1559
00:46:55,760 --> 00:46:57,440
development with azure id covers like

1560
00:46:57,440 --> 00:46:58,960
the libraries you should be using which

1561
00:46:58,960 --> 00:47:00,800
is you want to use the msal library

1562
00:47:00,800 --> 00:47:02,480
it covers this permission model to cover

1563
00:47:02,480 --> 00:47:04,000
some stuff from your developers

1564
00:47:04,000 --> 00:47:05,440
so you want to make sure your developers

1565
00:47:05,440 --> 00:47:08,000
take a look at that but you as defenders

1566
00:47:08,000 --> 00:47:10,720
should also watch this this is really go

1567
00:47:10,720 --> 00:47:12,160
in-depth in some of the stuff we talked

1568
00:47:12,160 --> 00:47:13,280
about as well as some other things we

1569
00:47:13,280 --> 00:47:14,319
didn't even talk about which is like the

1570
00:47:14,319 --> 00:47:15,520
libraries and things like that that

1571
00:47:15,520 --> 00:47:16,720
people can be using so

1572
00:47:16,720 --> 00:47:18,400
go watch that it's really really helpful

1573
00:47:18,400 --> 00:47:20,559
but again for your um

1574
00:47:20,559 --> 00:47:21,599
applications you want to make sure

1575
00:47:21,599 --> 00:47:24,480
they're using least privilege and also

1576
00:47:24,480 --> 00:47:27,119
when you have third-party isv apps

1577
00:47:27,119 --> 00:47:28,400
they're going to be using sometimes

1578
00:47:28,400 --> 00:47:29,680
those higher permission models i've had

1579
00:47:29,680 --> 00:47:31,839
several of my customers push back

1580
00:47:31,839 --> 00:47:34,160
on some third parties and say we're not

1581
00:47:34,160 --> 00:47:35,440
granting you those permissions that's

1582
00:47:35,440 --> 00:47:36,800
way too much your app doesn't need that

1583
00:47:36,800 --> 00:47:38,480
you need to be using lower permissions

1584
00:47:38,480 --> 00:47:39,680
no different than when someone wants

1585
00:47:39,680 --> 00:47:41,200
domain admin or enterprise admin you

1586
00:47:41,200 --> 00:47:42,000
push back

1587
00:47:42,000 --> 00:47:45,280
same thing for this okay

1588
00:47:45,280 --> 00:47:48,400
um last thing here if you see an

1589
00:47:48,400 --> 00:47:51,440
application and it looks suspicious

1590
00:47:51,440 --> 00:47:53,920
you can report it through mcas or this

1591
00:47:53,920 --> 00:47:55,680
consent screen as well so that check box

1592
00:47:55,680 --> 00:47:57,520
right below for an admin there where it

1593
00:47:57,520 --> 00:47:58,800
says um

1594
00:47:58,800 --> 00:48:00,000
the thing's still coming through for me

1595
00:48:00,000 --> 00:48:01,680
but it says does this app look

1596
00:48:01,680 --> 00:48:02,480
suspicious

1597
00:48:02,480 --> 00:48:04,880
report it here you click on that you can

1598
00:48:04,880 --> 00:48:06,319
report those applications that

1599
00:48:06,319 --> 00:48:08,160
you think are phishing or suspicious to

1600
00:48:08,160 --> 00:48:09,599
us and then we will

1601
00:48:09,599 --> 00:48:11,119
um go take a look at them and take

1602
00:48:11,119 --> 00:48:12,160
action on them and remove them for

1603
00:48:12,160 --> 00:48:13,680
everybody and things like that so

1604
00:48:13,680 --> 00:48:15,359
um if you see something please please

1605
00:48:15,359 --> 00:48:16,880
say something

1606
00:48:16,880 --> 00:48:19,440
all right got a few minutes left here so

1607
00:48:19,440 --> 00:48:21,040
what are our go do's

1608
00:48:21,040 --> 00:48:24,319
so first go back at a bare minimum

1609
00:48:24,319 --> 00:48:26,480
run that powershell script look at your

1610
00:48:26,480 --> 00:48:27,839
applications you have

1611
00:48:27,839 --> 00:48:29,280
go ahead and you know look for those

1612
00:48:29,280 --> 00:48:30,480
dangerous permissions look for those

1613
00:48:30,480 --> 00:48:31,680
high privileged users

1614
00:48:31,680 --> 00:48:34,559
and set those um the right types of

1615
00:48:34,559 --> 00:48:36,319
risk-based step up for your things for

1616
00:48:36,319 --> 00:48:38,079
going forward so you can do that

1617
00:48:38,079 --> 00:48:41,119
by default um in the wrist space part

1618
00:48:41,119 --> 00:48:41,440
but

1619
00:48:41,440 --> 00:48:42,880
you know those three radio buttons the

1620
00:48:42,880 --> 00:48:44,400
block everything allow everything or do

1621
00:48:44,400 --> 00:48:45,280
the middle one

1622
00:48:45,280 --> 00:48:46,880
go take a look at this make sure

1623
00:48:46,880 --> 00:48:48,319
everyone agrees on

1624
00:48:48,319 --> 00:48:49,599
what are those permission models we want

1625
00:48:49,599 --> 00:48:51,440
to do and make sure we're

1626
00:48:51,440 --> 00:48:53,599
um understanding what that's going to do

1627
00:48:53,599 --> 00:48:54,880
in our environment

1628
00:48:54,880 --> 00:48:59,040
then go explain to people this consent

1629
00:48:59,040 --> 00:49:00,640
phishing and how the end user can send

1630
00:49:00,640 --> 00:49:02,319
frameworks and the admin consent

1631
00:49:02,319 --> 00:49:03,920
frameworks because people don't

1632
00:49:03,920 --> 00:49:05,839
typically understand that now i didn't

1633
00:49:05,839 --> 00:49:07,839
we don't want to scare you that like

1634
00:49:07,839 --> 00:49:10,079
this consent phishing is a humongous

1635
00:49:10,079 --> 00:49:11,599
problem that everyone's getting hit with

1636
00:49:11,599 --> 00:49:12,480
and we should go

1637
00:49:12,480 --> 00:49:13,599
stop everything we're doing and take

1638
00:49:13,599 --> 00:49:15,359
care of this that's not the case the

1639
00:49:15,359 --> 00:49:17,119
most common attacks we see

1640
00:49:17,119 --> 00:49:18,960
are password spray where people have an

1641
00:49:18,960 --> 00:49:20,559
easily guessable password using legacy

1642
00:49:20,559 --> 00:49:21,920
authentication protocols

1643
00:49:21,920 --> 00:49:24,400
people have reused their password like

1644
00:49:24,400 --> 00:49:25,599
that stuff is still the

1645
00:49:25,599 --> 00:49:28,079
um most common the traditional phishing

1646
00:49:28,079 --> 00:49:29,440
are the most common things that we see

1647
00:49:29,440 --> 00:49:30,800
still from an identity attack

1648
00:49:30,800 --> 00:49:32,079
perspective but this is something that's

1649
00:49:32,079 --> 00:49:34,160
emerging if we want to make sure people

1650
00:49:34,160 --> 00:49:35,040
are aware of this

1651
00:49:35,040 --> 00:49:36,400
and we want to make sure those incident

1652
00:49:36,400 --> 00:49:38,319
response plans we have

1653
00:49:38,319 --> 00:49:40,000
um take this into account because it's

1654
00:49:40,000 --> 00:49:41,599
not just as easy as just deleting the

1655
00:49:41,599 --> 00:49:43,280
application gotta go look to see what it

1656
00:49:43,280 --> 00:49:43,599
did

1657
00:49:43,599 --> 00:49:44,880
and what types of permissions it had in

1658
00:49:44,880 --> 00:49:46,960
our environment then

1659
00:49:46,960 --> 00:49:48,319
we want to make sure we go ahead and

1660
00:49:48,319 --> 00:49:50,000
educate our developers on the best

1661
00:49:50,000 --> 00:49:51,520
practices around using

1662
00:49:51,520 --> 00:49:53,520
least privilege um so we have some links

1663
00:49:53,520 --> 00:49:55,440
for you there and here i'll paste this

1664
00:49:55,440 --> 00:49:56,480
right now in the chat

1665
00:49:56,480 --> 00:49:58,480
here is a link to all the slides that

1666
00:49:58,480 --> 00:50:00,880
michael and i just covered today

1667
00:50:00,880 --> 00:50:02,319
and then lastly here we have some other

1668
00:50:02,319 --> 00:50:04,640
resources for you um that we couldn't

1669
00:50:04,640 --> 00:50:06,240
talk about that we just ran out of time

1670
00:50:06,240 --> 00:50:07,440
because we could do a whole day on our

1671
00:50:07,440 --> 00:50:08,720
day there's lots and lots of good stuff

1672
00:50:08,720 --> 00:50:09,280
here but

1673
00:50:09,280 --> 00:50:10,720
here is some the consent framework

1674
00:50:10,720 --> 00:50:12,480
here's how you can investigate consent

1675
00:50:12,480 --> 00:50:13,280
grants

1676
00:50:13,280 --> 00:50:15,040
manually we have some links to some

1677
00:50:15,040 --> 00:50:16,480
security steps here so lots of good

1678
00:50:16,480 --> 00:50:17,119
stuff here

1679
00:50:17,119 --> 00:50:18,640
that we're just putting here in the

1680
00:50:18,640 --> 00:50:20,160
resources that you guys can take a look

1681
00:50:20,160 --> 00:50:20,559
at

1682
00:50:20,559 --> 00:50:21,839
um after the talk and with that we have

1683
00:50:21,839 --> 00:50:23,359
about i don't know five or ten minutes

1684
00:50:23,359 --> 00:50:24,400
left for any questions we've been trying

1685
00:50:24,400 --> 00:50:25,119
to keep an eye on

1686
00:50:25,119 --> 00:50:28,160
the chat as we go but um um we'll be

1687
00:50:28,160 --> 00:50:29,520
watching discord

1688
00:50:29,520 --> 00:50:31,359
um this is me on twitter i'm matt mark

1689
00:50:31,359 --> 00:50:33,119
morrow michael happening there's someone

1690
00:50:33,119 --> 00:50:34,720
impersonating him so he's underscore

1691
00:50:34,720 --> 00:50:36,960
michael apping um

1692
00:50:36,960 --> 00:50:38,240
we can fix that okay so the link

1693
00:50:38,240 --> 00:50:40,319
requires a login let me fix that

1694
00:50:40,319 --> 00:50:42,240
real quick while michael if you're able

1695
00:50:42,240 --> 00:50:43,920
to watch any of the questions that come

1696
00:50:43,920 --> 00:50:45,119
in

1697
00:50:45,119 --> 00:50:48,000
let me fix that right now the one

1698
00:50:48,000 --> 00:50:49,040
question i see is

1699
00:50:49,040 --> 00:50:50,800
is there a way to implement a review

1700
00:50:50,800 --> 00:50:52,079
process where an admin

1701
00:50:52,079 --> 00:50:54,079
tier 2 engineer will review and a

1702
00:50:54,079 --> 00:50:57,680
configuration manager to approve

1703
00:50:57,680 --> 00:51:00,480
which i think is a good question uh so

1704
00:51:00,480 --> 00:51:02,160
if i'm reading the question correctly i

1705
00:51:02,160 --> 00:51:02,480
think

1706
00:51:02,480 --> 00:51:05,280
what you would want is for the engineer

1707
00:51:05,280 --> 00:51:07,040
to review the permissions and then make

1708
00:51:07,040 --> 00:51:08,800
recommendations

1709
00:51:08,800 --> 00:51:10,480
so your tier two engineers like if they

1710
00:51:10,480 --> 00:51:12,079
have help desk permissions or things

1711
00:51:12,079 --> 00:51:13,280
like that they should be able to run the

1712
00:51:13,280 --> 00:51:14,160
script

1713
00:51:14,160 --> 00:51:16,400
um they won't have permissions to go

1714
00:51:16,400 --> 00:51:18,640
like admin consent to things or revoke

1715
00:51:18,640 --> 00:51:19,760
permissions

1716
00:51:19,760 --> 00:51:21,839
but they can execute the script and

1717
00:51:21,839 --> 00:51:23,760
review what is in it

1718
00:51:23,760 --> 00:51:25,520
so nothing stopping you from

1719
00:51:25,520 --> 00:51:27,440
implementing a process where like your

1720
00:51:27,440 --> 00:51:29,520
tier 2 engineers

1721
00:51:29,520 --> 00:51:32,160
might run the script do some analysis

1722
00:51:32,160 --> 00:51:33,599
you can delegate permissions to them

1723
00:51:33,599 --> 00:51:36,079
like view permissions to them in mcas if

1724
00:51:36,079 --> 00:51:37,920
you have if you're using mcas as your

1725
00:51:37,920 --> 00:51:39,280
cosby solution

1726
00:51:39,280 --> 00:51:41,280
um so you can do things like that to

1727
00:51:41,280 --> 00:51:42,480
give them the ability to

1728
00:51:42,480 --> 00:51:43,760
investigate and then make

1729
00:51:43,760 --> 00:51:45,520
recommendations to someone who's got

1730
00:51:45,520 --> 00:51:47,359
uh you know the higher powers to go

1731
00:51:47,359 --> 00:51:51,839
actually make modifications

1732
00:51:54,240 --> 00:51:56,480
all right i just updated that link so

1733
00:51:56,480 --> 00:51:57,599
hopefully now

1734
00:51:57,599 --> 00:51:59,680
you can get to the slide deck um maybe

1735
00:51:59,680 --> 00:52:01,520
give another minute or two

1736
00:52:01,520 --> 00:52:03,119
but you should be all set let me check

1737
00:52:03,119 --> 00:52:04,640
discord here

1738
00:52:04,640 --> 00:52:07,680
no questions over there

1739
00:52:10,880 --> 00:52:19,839
yep i haven't seen any other questions

1740
00:52:20,800 --> 00:52:22,640
and someone can give us an act that the

1741
00:52:22,640 --> 00:52:23,920
link works now um

1742
00:52:23,920 --> 00:52:26,079
when you try it that's that'd be helpful

1743
00:52:26,079 --> 00:52:28,720
it should be good

1744
00:52:29,359 --> 00:52:33,839
okay works for them okay cool

1745
00:52:53,760 --> 00:52:55,119
all right cool thank you thank you so

1746
00:52:55,119 --> 00:52:57,440
much michael and mark that's a great

1747
00:52:57,440 --> 00:53:00,160
talk

