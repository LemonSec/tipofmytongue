1
00:00:40,329 --> 00:00:45,129
hey thank you everybody how are you

2
00:00:42,739 --> 00:00:45,129
doing today

3
00:00:45,290 --> 00:00:49,280
well I guess to start off how many

4
00:00:47,690 --> 00:00:53,120
people in here do we have on like the

5
00:00:49,280 --> 00:00:56,510
blue team defenders couple handfuls any

6
00:00:53,120 --> 00:01:00,589
penetration testers or red teamers okay

7
00:00:56,510 --> 00:01:02,960
a couple there - any students okay cool

8
00:01:00,589 --> 00:01:07,280
all right anybody that's an audit or any

9
00:01:02,960 --> 00:01:08,390
other management things like that so

10
00:01:07,280 --> 00:01:11,750
pretty good variety a lot of blue

11
00:01:08,390 --> 00:01:14,270
teamers so that this talk will first

12
00:01:11,750 --> 00:01:16,340
start out Who am I I'm a hacker Matt

13
00:01:14,270 --> 00:01:19,820
done a penetration tester

14
00:01:16,340 --> 00:01:22,610
I run offensive consulting team

15
00:01:19,820 --> 00:01:24,320
I build hackers so I take interns and

16
00:01:22,610 --> 00:01:29,330
regular IT people and I turn them evil

17
00:01:24,320 --> 00:01:33,199
and steal them from my IT department and

18
00:01:29,330 --> 00:01:34,850
I love open source software all right so

19
00:01:33,200 --> 00:01:37,610
I want to set some expectations for this

20
00:01:34,850 --> 00:01:39,408
talk I gave it to my wife last night and

21
00:01:37,610 --> 00:01:43,580
she does a lot of presentations and she

22
00:01:39,409 --> 00:01:47,390
was like wow that's terrible and I'm

23
00:01:43,580 --> 00:01:48,979
like it's like love o'clock and so

24
00:01:47,390 --> 00:01:49,970
this morning I made some tweaks to it

25
00:01:48,979 --> 00:01:52,489
and hopefully will be a little bit

26
00:01:49,970 --> 00:01:55,220
better and I'm trying to fit a lot of

27
00:01:52,489 --> 00:01:58,640
information in but well I'll do the best

28
00:01:55,220 --> 00:02:02,259
I can all right so what I'm going to

29
00:01:58,640 --> 00:02:06,020
talk about it's mostly from a looking at

30
00:02:02,259 --> 00:02:07,729
offensive a couple offensive tactics how

31
00:02:06,020 --> 00:02:13,010
to think offensively to secure your

32
00:02:07,729 --> 00:02:14,480
network and so the talk I had a lot more

33
00:02:13,010 --> 00:02:16,399
details but it's got to be a little bit

34
00:02:14,480 --> 00:02:21,018
higher level because of the tight time

35
00:02:16,400 --> 00:02:22,700
constraints any any offensive techniques

36
00:02:21,019 --> 00:02:24,440
that I'll be sharing during this

37
00:02:22,700 --> 00:02:26,329
presentation you need permission to

38
00:02:24,440 --> 00:02:27,920
perform first if you don't have

39
00:02:26,330 --> 00:02:31,000
permission you could be committing a

40
00:02:27,920 --> 00:02:33,829
crime so don't be you know cracking your

41
00:02:31,000 --> 00:02:36,650
Active Directory database passwords to

42
00:02:33,830 --> 00:02:40,489
see you have shitty passwords or things

43
00:02:36,650 --> 00:02:42,230
like that without permission and I'll

44
00:02:40,489 --> 00:02:43,459
talk about network discovery that I

45
00:02:42,230 --> 00:02:44,899
think is something that sometime

46
00:02:43,459 --> 00:02:48,319
overlooked with like vulnerability

47
00:02:44,900 --> 00:02:50,120
management programs will talk about

48
00:02:48,319 --> 00:02:53,268
attacking a defending a

49
00:02:50,120 --> 00:02:56,379
common password issues and stealing

50
00:02:53,269 --> 00:02:59,180
credentials from memory and also

51
00:02:56,379 --> 00:03:01,970
analyzing Active Directory environments

52
00:02:59,180 --> 00:03:04,970
and then we'll finish up with talking

53
00:03:01,970 --> 00:03:06,950
about using a minor attack framework to

54
00:03:04,970 --> 00:03:09,470
think offensively and tune your defense

55
00:03:06,950 --> 00:03:13,399
or if you're an attacker to tune how

56
00:03:09,470 --> 00:03:16,310
you're performing your engagements all

57
00:03:13,400 --> 00:03:18,140
right so when I'm first enumerated

58
00:03:16,310 --> 00:03:20,480
Network some of the things that I look

59
00:03:18,140 --> 00:03:22,458
for are items that don't belong an

60
00:03:20,480 --> 00:03:25,548
Internet so if I'm doing an external

61
00:03:22,459 --> 00:03:27,890
penetration test I want to look for you

62
00:03:25,549 --> 00:03:29,329
know Citrix management interfaces that

63
00:03:27,890 --> 00:03:31,488
are accidentally exposed to internet and

64
00:03:29,329 --> 00:03:32,599
have default credentials and this is

65
00:03:31,489 --> 00:03:34,250
something that I see with a lot of

66
00:03:32,599 --> 00:03:36,140
vulnerability management programs is

67
00:03:34,250 --> 00:03:37,549
that things like that will be missed

68
00:03:36,140 --> 00:03:39,828
because they won't hit on a

69
00:03:37,549 --> 00:03:41,900
vulnerability scanner but if you are

70
00:03:39,829 --> 00:03:43,310
doing like an nmap scan and evaluating

71
00:03:41,900 --> 00:03:44,989
the things on your external network

72
00:03:43,310 --> 00:03:48,530
outside of the vulnerability is that's

73
00:03:44,989 --> 00:03:50,659
something that you could pick up default

74
00:03:48,530 --> 00:03:52,879
or non-existent passwords I go in a lot

75
00:03:50,659 --> 00:03:55,630
of environments like colleges like this

76
00:03:52,879 --> 00:03:57,888
and I can log in to half the security

77
00:03:55,630 --> 00:04:00,380
security cameras with the password admin

78
00:03:57,889 --> 00:04:06,730
admin from the guest wireless network

79
00:04:00,380 --> 00:04:08,930
sometimes that's kind of scary you know

80
00:04:06,730 --> 00:04:10,578
other things with the numeration you can

81
00:04:08,930 --> 00:04:12,530
look for things are incorrect Network

82
00:04:10,579 --> 00:04:13,879
statements so oftentimes I think it's

83
00:04:12,530 --> 00:04:17,529
hard to understand what is on our

84
00:04:13,879 --> 00:04:20,659
networks unless we're auditing them and

85
00:04:17,529 --> 00:04:22,969
so we might find IOT devices or

86
00:04:20,660 --> 00:04:24,260
thermostats plugged into the corporate

87
00:04:22,970 --> 00:04:26,530
network and maybe they should be on a

88
00:04:24,260 --> 00:04:28,460
different belay on that's isolated

89
00:04:26,530 --> 00:04:30,590
anything that looks really old that

90
00:04:28,460 --> 00:04:33,590
always interests me so oftentimes I'll

91
00:04:30,590 --> 00:04:35,119
find things and I'll go to ITA team and

92
00:04:33,590 --> 00:04:36,440
be like what's this I'm like oh I should

93
00:04:35,120 --> 00:04:39,169
have been taken off the network three

94
00:04:36,440 --> 00:04:41,419
years ago and that's the potential to

95
00:04:39,169 --> 00:04:42,710
have you know some vulnerabilities or or

96
00:04:41,419 --> 00:04:46,639
something I can take advantage of

97
00:04:42,710 --> 00:04:48,830
they're a couple simple ways to find

98
00:04:46,639 --> 00:04:52,580
things are using schools like nmap and

99
00:04:48,830 --> 00:04:55,460
eyewitness and that how many people here

100
00:04:52,580 --> 00:04:56,780
are familiar with nmap almost everybody

101
00:04:55,460 --> 00:04:58,280
great so I won't go into too many

102
00:04:56,780 --> 00:05:01,520
details with that but it's a port

103
00:04:58,280 --> 00:05:03,308
scanner so you can use it to see what

104
00:05:01,520 --> 00:05:04,899
systems and services are running

105
00:05:03,309 --> 00:05:06,339
on different network segments you can

106
00:05:04,899 --> 00:05:09,749
also do a little bit of vulnerability

107
00:05:06,339 --> 00:05:12,309
scanning with a lot of other things

108
00:05:09,749 --> 00:05:16,169
here's an example of you know an map

109
00:05:12,309 --> 00:05:18,219
being run that's we got some open ports

110
00:05:16,169 --> 00:05:20,289
you know there's a lot of documentation

111
00:05:18,219 --> 00:05:22,899
on a map if you want if you're want to

112
00:05:20,289 --> 00:05:25,719
utilize it on larger networks more

113
00:05:22,899 --> 00:05:28,089
quickly or to fit your use case and that

114
00:05:25,719 --> 00:05:29,379
can be found it then map website there's

115
00:05:28,089 --> 00:05:32,469
a bunch of blogs I'm sure you guys are

116
00:05:29,379 --> 00:05:34,449
familiar with those one thing I do that

117
00:05:32,469 --> 00:05:37,748
to take my end map day to the next level

118
00:05:34,449 --> 00:05:39,549
I'm pretty visual person so oftentimes

119
00:05:37,749 --> 00:05:41,049
I'll be looking at a network and I want

120
00:05:39,549 --> 00:05:44,049
to understand what's on the network

121
00:05:41,049 --> 00:05:46,808
quickly and if I have like a thousand or

122
00:05:44,049 --> 00:05:48,849
a hundred or three hundred web web ports

123
00:05:46,809 --> 00:05:50,979
hit I might want to see very quickly

124
00:05:48,849 --> 00:05:53,139
what all those systems are so I'll run

125
00:05:50,979 --> 00:05:55,479
it school like I witness which will go

126
00:05:53,139 --> 00:05:59,409
out and takes load webpages and

127
00:05:55,479 --> 00:06:01,508
screenshot them and so I can see very

128
00:05:59,409 --> 00:06:04,359
quickly okay where the VPN portal at

129
00:06:01,509 --> 00:06:07,989
portals at is there like Outlook Web

130
00:06:04,359 --> 00:06:09,938
Access page pretty quickly by generating

131
00:06:07,989 --> 00:06:12,008
report with eyewitness and it generates

132
00:06:09,939 --> 00:06:14,559
an HTML report like the one in this

133
00:06:12,009 --> 00:06:16,509
example and I write has a screenshot of

134
00:06:14,559 --> 00:06:19,149
the web page the left side it has some

135
00:06:16,509 --> 00:06:21,579
web request info and if it's a device

136
00:06:19,149 --> 00:06:23,769
that's in its database of default

137
00:06:21,579 --> 00:06:26,739
passwords it might tell you hey this is

138
00:06:23,769 --> 00:06:29,139
a tomcat server typically the password

139
00:06:26,739 --> 00:06:32,018
for that's Tom Tomcat and you could try

140
00:06:29,139 --> 00:06:36,419
that you can also have the tool

141
00:06:32,019 --> 00:06:39,789
I guess the passwords if you want to

142
00:06:36,419 --> 00:06:41,229
again you need permission to do that if

143
00:06:39,789 --> 00:06:43,029
you do that against systems you know on

144
00:06:41,229 --> 00:06:47,079
that and you log in and that could be a

145
00:06:43,029 --> 00:06:50,409
problem so what how to utilize what you

146
00:06:47,079 --> 00:06:52,119
find from your enumeration is be looking

147
00:06:50,409 --> 00:06:53,979
for gaps or other systems that don't

148
00:06:52,119 --> 00:06:57,309
belong in places if there are why are

149
00:06:53,979 --> 00:07:00,669
they there and get them off of there if

150
00:06:57,309 --> 00:07:03,909
there's old systems get rid of them

151
00:07:00,669 --> 00:07:06,519
isolate them update them if there's

152
00:07:03,909 --> 00:07:08,558
default logins figure out who owns is

153
00:07:06,519 --> 00:07:10,719
responsible for those systems and make

154
00:07:08,559 --> 00:07:14,259
them change them so that the printer

155
00:07:10,719 --> 00:07:16,800
can't be used is you know a beacon point

156
00:07:14,259 --> 00:07:16,800
into your network

157
00:07:17,020 --> 00:07:21,250
all right now talk a little bit about

158
00:07:18,310 --> 00:07:24,370
weak passwords so when I'm talking about

159
00:07:21,250 --> 00:07:27,160
weak passwords anything that's default

160
00:07:24,370 --> 00:07:28,630
easily gassed or easily cracked this is

161
00:07:27,160 --> 00:07:30,370
one of my favorite types of things to

162
00:07:28,630 --> 00:07:34,390
attack because it's pretty easy I'm

163
00:07:30,370 --> 00:07:35,980
pretty lazy but a default passwords we

164
00:07:34,390 --> 00:07:39,580
talked about those admin end and things

165
00:07:35,980 --> 00:07:42,930
like that easy to guess passwords so

166
00:07:39,580 --> 00:07:46,690
these are passwords like season and year

167
00:07:42,930 --> 00:07:49,000
company name one so if I get a list of

168
00:07:46,690 --> 00:07:51,010
users for your organization one of the

169
00:07:49,000 --> 00:07:53,590
first things I'm going to do is find

170
00:07:51,010 --> 00:07:57,370
your VPN or your Outlook Web Access your

171
00:07:53,590 --> 00:07:59,739
office 365 and try you know right now

172
00:07:57,370 --> 00:08:01,420
fall 2019 against everybody's account

173
00:07:59,740 --> 00:08:07,540
see if that hits if anybody has that

174
00:08:01,420 --> 00:08:10,330
password password reuse so if I land on

175
00:08:07,540 --> 00:08:13,090
a system and the user has local

176
00:08:10,330 --> 00:08:15,130
administrator access and I can have full

177
00:08:13,090 --> 00:08:16,989
control that system I might dump the

178
00:08:15,130 --> 00:08:19,450
local passwords or hashes on that system

179
00:08:16,990 --> 00:08:22,030
if they're reused across the whole

180
00:08:19,450 --> 00:08:24,130
network or across several accounts that

181
00:08:22,030 --> 00:08:26,260
allows me to move laterally very quickly

182
00:08:24,130 --> 00:08:29,409
through the network so that's something

183
00:08:26,260 --> 00:08:31,180
to watch out for and so why should we

184
00:08:29,410 --> 00:08:34,360
care about weak passwords I'm in a lot

185
00:08:31,180 --> 00:08:37,330
of environments where where the IT

186
00:08:34,360 --> 00:08:38,860
passwords are actually really good but

187
00:08:37,330 --> 00:08:41,530
the user passwords aren't necessarily

188
00:08:38,860 --> 00:08:45,730
good and typically of IT stances well

189
00:08:41,530 --> 00:08:47,140
who cares about the basic users and the

190
00:08:45,730 --> 00:08:48,670
reason that we need to care about them

191
00:08:47,140 --> 00:08:50,800
is because it only takes one weak link

192
00:08:48,670 --> 00:08:52,329
for me to get into a network only one

193
00:08:50,800 --> 00:08:54,250
account that doesn't have two factor

194
00:08:52,330 --> 00:08:56,920
authentication enabled I get into an

195
00:08:54,250 --> 00:08:59,080
email or a VPN and I'm on the network

196
00:08:56,920 --> 00:09:01,300
and it typically isn't very difficult

197
00:08:59,080 --> 00:09:04,510
for for myself or for an attacker once

198
00:09:01,300 --> 00:09:06,400
you're initially in the network to move

199
00:09:04,510 --> 00:09:10,990
up the ladder and Gainax

200
00:09:06,400 --> 00:09:13,350
full access to the network and so one

201
00:09:10,990 --> 00:09:16,060
way I talked a little bit about like I

202
00:09:13,350 --> 00:09:17,890
like to guess commonly is passwords

203
00:09:16,060 --> 00:09:20,859
using a technique called password

204
00:09:17,890 --> 00:09:22,930
guessing or spray and that's like

205
00:09:20,860 --> 00:09:26,050
password brute forcing but done at a

206
00:09:22,930 --> 00:09:27,370
rate below a lockout threshold so not so

207
00:09:26,050 --> 00:09:28,609
I'm not locking everybody out of an

208
00:09:27,370 --> 00:09:30,769
organization it all

209
00:09:28,610 --> 00:09:32,810
so is a little less likely to be

210
00:09:30,769 --> 00:09:36,680
detected if I'm not walking a lot of

211
00:09:32,810 --> 00:09:39,380
accounts out and standard password

212
00:09:36,680 --> 00:09:42,890
complexity requirements don't block easy

213
00:09:39,380 --> 00:09:46,070
to guess passwords by themselves so it's

214
00:09:42,890 --> 00:09:47,779
still a very effective technique and

215
00:09:46,070 --> 00:09:49,630
some of the tools that you can use to do

216
00:09:47,779 --> 00:09:52,519
password guessing or password spraying

217
00:09:49,630 --> 00:09:54,470
burp suite is a web application testing

218
00:09:52,519 --> 00:09:56,990
tool as capabilities to do passwords

219
00:09:54,470 --> 00:09:58,790
spray one of my co-workers wrote the

220
00:09:56,990 --> 00:10:01,130
tool spray Charles which is a

221
00:09:58,790 --> 00:10:03,050
command-line Linux utility to do

222
00:10:01,130 --> 00:10:05,350
password spray and it has modules for

223
00:10:03,050 --> 00:10:09,469
things like Outlook Outlook Web Access

224
00:10:05,350 --> 00:10:11,000
office 365 and it's set up so you can

225
00:10:09,470 --> 00:10:13,459
put in the lock out thresholds and I'll

226
00:10:11,000 --> 00:10:15,110
stay below those you can also route the

227
00:10:13,459 --> 00:10:20,029
traffic through a proxy if you want to

228
00:10:15,110 --> 00:10:23,690
be more stealthy the main password spray

229
00:10:20,029 --> 00:10:25,670
is a utility the powershell based

230
00:10:23,690 --> 00:10:27,829
password spraying tool that you can use

231
00:10:25,670 --> 00:10:32,079
on an internal or each potential that

232
00:10:27,829 --> 00:10:34,519
external network on a Windows network

233
00:10:32,079 --> 00:10:36,019
all right and so what do we what do I do

234
00:10:34,519 --> 00:10:37,970
with passwords when I get them or an

235
00:10:36,019 --> 00:10:40,550
attacker gets up we log into things

236
00:10:37,970 --> 00:10:43,250
right so I'll get an email okay I get

237
00:10:40,550 --> 00:10:45,649
into the VPN does anything not have to

238
00:10:43,250 --> 00:10:47,600
factor on it if it has to factor on it

239
00:10:45,649 --> 00:10:51,260
as a person not enrolled yet but I can

240
00:10:47,600 --> 00:10:52,279
enroll myself my fate my new favorite

241
00:10:51,260 --> 00:10:53,329
well it's not my new favorite things

242
00:10:52,279 --> 00:10:55,459
something I've been having a lot of

243
00:10:53,329 --> 00:10:57,349
success with lately is I get one basic

244
00:10:55,459 --> 00:11:00,079
account I log in to the helpdesk

245
00:10:57,350 --> 00:11:01,820
ticketing system and I create a ticket I

246
00:11:00,079 --> 00:11:03,349
say hey oh man this excel file I'm

247
00:11:01,820 --> 00:11:05,269
having trouble loading all the data in

248
00:11:03,350 --> 00:11:07,640
it can you please help me and I submit

249
00:11:05,269 --> 00:11:09,140
the ticket as a regular user I delete

250
00:11:07,640 --> 00:11:11,209
you know the helpdesk response from

251
00:11:09,140 --> 00:11:13,730
their email and then the helpdesk looks

252
00:11:11,209 --> 00:11:15,319
at it and I launch the malware on their

253
00:11:13,730 --> 00:11:20,329
system and now I have helped us ask

254
00:11:15,320 --> 00:11:23,360
access from a basic user account another

255
00:11:20,329 --> 00:11:25,189
thing I made you is use tools to see

256
00:11:23,360 --> 00:11:26,209
what I can do with my passwords so once

257
00:11:25,190 --> 00:11:28,760
I have credentials

258
00:11:26,209 --> 00:11:32,029
I want to utilize them across the

259
00:11:28,760 --> 00:11:34,600
network crack mapping Zack is a Linux

260
00:11:32,029 --> 00:11:37,250
tool that's very easy very easy to take

261
00:11:34,600 --> 00:11:39,920
passwords are hashes and try to use them

262
00:11:37,250 --> 00:11:42,320
to connect to systems you can use sequel

263
00:11:39,920 --> 00:11:44,599
queries you can run commands on system

264
00:11:42,320 --> 00:11:47,600
can steal passwords with me me cats all

265
00:11:44,600 --> 00:11:49,340
kind of things how one example I might

266
00:11:47,600 --> 00:11:51,950
use is okay I've gotten a local

267
00:11:49,340 --> 00:11:54,260
administrator password is that valid on

268
00:11:51,950 --> 00:11:56,240
another system and so here you gonna see

269
00:11:54,260 --> 00:11:58,850
an example I'm using the password

270
00:11:56,240 --> 00:12:01,430
administrator and password I pointed at

271
00:11:58,850 --> 00:12:03,560
the system they came back as green that

272
00:12:01,430 --> 00:12:05,089
means the password is valid if it's got

273
00:12:03,560 --> 00:12:06,739
the yellow pone it means I have local

274
00:12:05,090 --> 00:12:09,980
administrator access on that computer

275
00:12:06,740 --> 00:12:12,470
and potential control that system to

276
00:12:09,980 --> 00:12:15,890
steal more passwords from launch other

277
00:12:12,470 --> 00:12:17,540
attacks from it whatever they'll also

278
00:12:15,890 --> 00:12:20,780
tell you if the account password is

279
00:12:17,540 --> 00:12:24,230
valid but just accounts disabled or if

280
00:12:20,780 --> 00:12:25,970
the password is invalid well and that's

281
00:12:24,230 --> 00:12:27,800
just like one example there you can do

282
00:12:25,970 --> 00:12:30,740
that manually or there's many other

283
00:12:27,800 --> 00:12:32,630
tools defending against weak passwords

284
00:12:30,740 --> 00:12:35,450
so so we talked a little bit about weak

285
00:12:32,630 --> 00:12:37,160
passwords that there are a lot of ways

286
00:12:35,450 --> 00:12:39,020
it's not very difficult to defend

287
00:12:37,160 --> 00:12:41,630
against weak passwords what I recommend

288
00:12:39,020 --> 00:12:43,790
doing first is evaluating the passwords

289
00:12:41,630 --> 00:12:45,920
that you have where do you stand once

290
00:12:43,790 --> 00:12:48,589
we'll to do that is called des internals

291
00:12:45,920 --> 00:12:51,979
it's a PowerShell module and what it

292
00:12:48,590 --> 00:12:53,720
does is it takes a copy of your Active

293
00:12:51,980 --> 00:12:56,180
Directory database the passwords in it

294
00:12:53,720 --> 00:12:58,040
and you can do some password cracking

295
00:12:56,180 --> 00:13:00,260
against it if you want it want to you

296
00:12:58,040 --> 00:13:03,800
can feed it like a password dictionary

297
00:13:00,260 --> 00:13:05,569
and see you know if it has anybody using

298
00:13:03,800 --> 00:13:07,520
weak passwords you don't have to do that

299
00:13:05,570 --> 00:13:09,740
if you don't have authorization to crack

300
00:13:07,520 --> 00:13:11,090
people's passwords you can actually run

301
00:13:09,740 --> 00:13:13,250
it I'll show you how many people have

302
00:13:11,090 --> 00:13:16,100
the same password and that can be a good

303
00:13:13,250 --> 00:13:18,050
indication of our users using weak

304
00:13:16,100 --> 00:13:20,060
passwords because if you have a group of

305
00:13:18,050 --> 00:13:21,589
10 20 passwords are the same their user

306
00:13:20,060 --> 00:13:24,680
accounts they're probably using

307
00:13:21,590 --> 00:13:27,410
something like 1 or 2019 you can also

308
00:13:24,680 --> 00:13:29,270
see while you're your IT people your

309
00:13:27,410 --> 00:13:31,310
admins that have their mortal account

310
00:13:29,270 --> 00:13:32,900
and on their admin account are they

311
00:13:31,310 --> 00:13:35,979
using the same password for both of

312
00:13:32,900 --> 00:13:35,980
those I've been

313
00:13:38,350 --> 00:13:43,180
situations where we got access to a

314
00:13:40,570 --> 00:13:45,310
mortal account and we saw that this

315
00:13:43,180 --> 00:13:47,439
username was similar to an admin account

316
00:13:45,310 --> 00:13:49,689
we tried the password on the admin

317
00:13:47,440 --> 00:13:51,190
account it was the same and then we had

318
00:13:49,690 --> 00:13:55,720
you know a lot more access to the

319
00:13:51,190 --> 00:13:58,240
network the best way though it's

320
00:13:55,720 --> 00:14:00,160
actually block that to deal with bad

321
00:13:58,240 --> 00:14:02,230
passwords is just to prevent them and

322
00:14:00,160 --> 00:14:05,560
you can use password filtering tools

323
00:14:02,230 --> 00:14:07,180
cred defenses and open source of open

324
00:14:05,560 --> 00:14:10,569
source one there's you can do it

325
00:14:07,180 --> 00:14:12,310
manually with Windows mixes and n front

326
00:14:10,570 --> 00:14:14,530
or paid products I don't think they're

327
00:14:12,310 --> 00:14:15,939
very expensive for what people I've

328
00:14:14,530 --> 00:14:17,140
talked to they'll use them before but

329
00:14:15,940 --> 00:14:19,240
basically you give it a list of

330
00:14:17,140 --> 00:14:22,390
passwords that meet complexity

331
00:14:19,240 --> 00:14:25,690
requirements but but you don't want to

332
00:14:22,390 --> 00:14:28,540
allow like you know the sports team in

333
00:14:25,690 --> 00:14:30,070
the area and your season and year you

334
00:14:28,540 --> 00:14:32,410
could even give it a list of the top

335
00:14:30,070 --> 00:14:34,360
10,000 bad passwords things like that

336
00:14:32,410 --> 00:14:37,240
they're very configurable and that'll

337
00:14:34,360 --> 00:14:38,980
actually prevent people from selecting

338
00:14:37,240 --> 00:14:41,200
bad passwords the networks that use

339
00:14:38,980 --> 00:14:43,600
these I have some banks that use these

340
00:14:41,200 --> 00:14:45,070
it's impossible to guess passwords there

341
00:14:43,600 --> 00:14:47,200
and it's very difficult to crack

342
00:14:45,070 --> 00:14:50,830
passwords if you have pretty strict

343
00:14:47,200 --> 00:14:52,900
rules in place so deal with a local

344
00:14:50,830 --> 00:14:56,140
admin password reuse the best way to

345
00:14:52,900 --> 00:14:58,300
deal with that is to have a solution

346
00:14:56,140 --> 00:15:01,000
that manages the passwords for you and

347
00:14:58,300 --> 00:15:02,530
randomize them Microsoft laughs is a

348
00:15:01,000 --> 00:15:03,640
solution that does that probably if

349
00:15:02,530 --> 00:15:06,850
you're on the defense you're familiar

350
00:15:03,640 --> 00:15:08,620
with that some smaller shops sometimes I

351
00:15:06,850 --> 00:15:11,290
find familiar with schools like that but

352
00:15:08,620 --> 00:15:14,470
it's a free solution that will manage

353
00:15:11,290 --> 00:15:17,010
local Minister your passwords and the

354
00:15:14,470 --> 00:15:19,420
polite if on to each system

355
00:15:17,010 --> 00:15:22,150
alright so detecting bad password

356
00:15:19,420 --> 00:15:23,979
activity a couple things to look for

357
00:15:22,150 --> 00:15:25,720
there's more things you can look for but

358
00:15:23,980 --> 00:15:28,960
windows event ID

359
00:15:25,720 --> 00:15:30,610
46:25 login failure if you see a lot of

360
00:15:28,960 --> 00:15:31,930
those or more than normal it might mean

361
00:15:30,610 --> 00:15:35,680
that somebody is running past for

362
00:15:31,930 --> 00:15:37,420
guessing against you and the the number

363
00:15:35,680 --> 00:15:39,160
you know threshold will vary upon your

364
00:15:37,420 --> 00:15:41,439
organization now if you're

365
00:15:39,160 --> 00:15:43,689
authenticating through some other

366
00:15:41,440 --> 00:15:47,260
methods it won't trigger that and that

367
00:15:43,690 --> 00:15:50,080
ID it'll trigger event ID 47 71 so if

368
00:15:47,260 --> 00:15:51,529
you're doing password guesses against

369
00:15:50,080 --> 00:15:53,839
the LDAP service

370
00:15:51,529 --> 00:15:55,939
guess I'll trigger that different event

371
00:15:53,839 --> 00:15:57,470
IDs so if you're only looking at 46 25

372
00:15:55,939 --> 00:16:00,259
you might be missing pass we're guessing

373
00:15:57,470 --> 00:16:02,360
in tums you may also want to watch

374
00:16:00,259 --> 00:16:04,189
successes a lot of places I work with

375
00:16:02,360 --> 00:16:05,480
are able to detect pass for guessing

376
00:16:04,189 --> 00:16:07,819
particularly if it's coming from one IP

377
00:16:05,480 --> 00:16:10,069
address but they often cannot tell me

378
00:16:07,819 --> 00:16:13,309
which accounts I compromised and that's

379
00:16:10,069 --> 00:16:16,459
pretty important you know it's okay so

380
00:16:13,309 --> 00:16:19,430
maybe you've locked the attacker but so

381
00:16:16,459 --> 00:16:21,410
they compromised any accounts and that

382
00:16:19,430 --> 00:16:24,378
goes to having all the logs you need so

383
00:16:21,410 --> 00:16:27,230
other times I'll find the alert won't

384
00:16:24,379 --> 00:16:29,720
trigger because maybe the VPN or another

385
00:16:27,230 --> 00:16:32,930
external service isn't feeding in the

386
00:16:29,720 --> 00:16:34,610
same sim or the logs aren't there and so

387
00:16:32,930 --> 00:16:39,439
it's not triggering a triggering an

388
00:16:34,610 --> 00:16:41,149
alert another way to detect a bad

389
00:16:39,439 --> 00:16:43,009
password activity on your network is to

390
00:16:41,149 --> 00:16:45,769
have honey accounts that are never used

391
00:16:43,009 --> 00:16:48,589
so creating like a disabled account here

392
00:16:45,769 --> 00:16:51,410
yeah creating a con disabling it that

393
00:16:48,589 --> 00:16:52,910
way if somebody dumps your user your

394
00:16:51,410 --> 00:16:54,019
user database and there's all your

395
00:16:52,910 --> 00:16:56,420
usernames and it's guessing and

396
00:16:54,019 --> 00:16:58,040
passwords against all of them you would

397
00:16:56,420 --> 00:17:00,490
get a failed attempt on that account

398
00:16:58,040 --> 00:17:02,990
which should never be logged into I

399
00:17:00,490 --> 00:17:05,799
thought that way before I met iteration

400
00:17:02,990 --> 00:17:09,439
test which I thought was pretty cool I

401
00:17:05,799 --> 00:17:11,089
like to get caught I mean I it's a it

402
00:17:09,439 --> 00:17:14,959
means it's good for my clients and

403
00:17:11,089 --> 00:17:16,789
they're improving them so once we have

404
00:17:14,959 --> 00:17:18,559
credentials or have some kind of access

405
00:17:16,789 --> 00:17:21,020
to a network we want to go deeper and

406
00:17:18,559 --> 00:17:22,908
one way to do that is with by stealing

407
00:17:21,020 --> 00:17:24,709
credentials from memory so a lot of

408
00:17:22,909 --> 00:17:28,640
systems will hold passwords or other

409
00:17:24,709 --> 00:17:30,860
authentication mechanisms in memory and

410
00:17:28,640 --> 00:17:37,070
we can steal those to further access on

411
00:17:30,860 --> 00:17:38,918
the network so Munich hats is like one

412
00:17:37,070 --> 00:17:41,330
of the most popular tools to do that

413
00:17:38,919 --> 00:17:43,789
here's an example of running me me cats

414
00:17:41,330 --> 00:17:45,439
on a Windows 7 system and by default you

415
00:17:43,789 --> 00:17:48,260
can get clear text credentials from that

416
00:17:45,440 --> 00:17:49,940
you can see the highlighted red there

417
00:17:48,260 --> 00:17:51,919
that the Pat that's the password and

418
00:17:49,940 --> 00:17:55,789
then the hashes are above that by

419
00:17:51,919 --> 00:17:57,980
default Windows 10 that's disabled can't

420
00:17:55,789 --> 00:18:00,110
can be re-enabled so you want to watch

421
00:17:57,980 --> 00:18:02,600
that but in this case we just get the

422
00:18:00,110 --> 00:18:04,310
hash we can still use the hash or we can

423
00:18:02,600 --> 00:18:05,840
try to crack it or try to pass

424
00:18:04,310 --> 00:18:08,330
but we don't have the clear text

425
00:18:05,840 --> 00:18:08,990
password which can limit what all we can

426
00:18:08,330 --> 00:18:11,840
do with it

427
00:18:08,990 --> 00:18:15,050
and you can't actually defend against me

428
00:18:11,840 --> 00:18:18,409
me cats it's not overly complicated it

429
00:18:15,050 --> 00:18:20,570
uses a C debug privilege to do a lot of

430
00:18:18,410 --> 00:18:22,460
it a lot of the things that it does so

431
00:18:20,570 --> 00:18:25,669
if you disable that be a group policy

432
00:18:22,460 --> 00:18:27,710
and don't allow anybody to do that to

433
00:18:25,670 --> 00:18:29,990
access that then a lot of Mimi cats

434
00:18:27,710 --> 00:18:32,440
features will not work you can also

435
00:18:29,990 --> 00:18:34,550
disable w digest which you should do

436
00:18:32,440 --> 00:18:35,660
particularly on windows 7 systems

437
00:18:34,550 --> 00:18:38,419
hopefully you don't have any of those

438
00:18:35,660 --> 00:18:40,970
left that will also prevent getting some

439
00:18:38,420 --> 00:18:43,970
of those clear text credential guard is

440
00:18:40,970 --> 00:18:46,730
also a mac windows feature that provides

441
00:18:43,970 --> 00:18:48,890
more protections to us a process which

442
00:18:46,730 --> 00:18:50,590
is in memory and where we often steal

443
00:18:48,890 --> 00:18:53,420
the passwords from or authentication

444
00:18:50,590 --> 00:18:55,970
mechanisms and there can be some issues

445
00:18:53,420 --> 00:18:57,890
with single sign-on when using that but

446
00:18:55,970 --> 00:19:00,020
it's something that you could use I've

447
00:18:57,890 --> 00:19:02,770
seen people use that on like jump boxes

448
00:19:00,020 --> 00:19:05,330
and things like that high risk systems

449
00:19:02,770 --> 00:19:08,150
Headey our solutions are also pretty

450
00:19:05,330 --> 00:19:10,040
good at protecting the L SAS process so

451
00:19:08,150 --> 00:19:11,870
they'll they'll watch that an a if

452
00:19:10,040 --> 00:19:14,000
anything unusual tries to access it

453
00:19:11,870 --> 00:19:16,040
they'll prevent that well you can also

454
00:19:14,000 --> 00:19:19,310
detect me me cats if you have a sim or a

455
00:19:16,040 --> 00:19:22,190
tool monitoring and event logs if you

456
00:19:19,310 --> 00:19:23,629
look at event ID 46 88 and you look you

457
00:19:22,190 --> 00:19:29,150
want to look for things like mini hats

458
00:19:23,630 --> 00:19:31,520
exe SEC secure LSA even if somebody

459
00:19:29,150 --> 00:19:33,410
changes the executable a lot of times

460
00:19:31,520 --> 00:19:35,389
they won't change the commands within it

461
00:19:33,410 --> 00:19:38,540
so you can still pick it up by the

462
00:19:35,390 --> 00:19:41,600
commands being run in system on you can

463
00:19:38,540 --> 00:19:44,389
look for the same same indicators with

464
00:19:41,600 --> 00:19:48,490
event ID 1 and me me cats also has yarra

465
00:19:44,390 --> 00:19:51,290
rules included with the on github so

466
00:19:48,490 --> 00:19:53,480
once we have credentials we need to know

467
00:19:51,290 --> 00:19:56,930
what we can do with them how many people

468
00:19:53,480 --> 00:20:00,290
have used bloodhound here not too many

469
00:19:56,930 --> 00:20:03,410
so bloodhound is an active directory

470
00:20:00,290 --> 00:20:05,960
enumeration tool it has support for

471
00:20:03,410 --> 00:20:08,690
Windows and Linux you can run the data

472
00:20:05,960 --> 00:20:10,550
in gesture as any domain user so I can

473
00:20:08,690 --> 00:20:13,580
pull a lot of information at a packed

474
00:20:10,550 --> 00:20:16,340
Active Directory as any domain user and

475
00:20:13,580 --> 00:20:18,110
it helps an attacker and a defender look

476
00:20:16,340 --> 00:20:19,850
for possible privilege escalation

477
00:20:18,110 --> 00:20:23,120
and paths so I if I compromise an

478
00:20:19,850 --> 00:20:26,240
account and I have the blood bloodhound

479
00:20:23,120 --> 00:20:29,110
output I can pull up the nice interface

480
00:20:26,240 --> 00:20:32,000
here and say okay I have Jim's account

481
00:20:29,110 --> 00:20:33,919
is there a path for me to get to domain

482
00:20:32,000 --> 00:20:36,650
admin from here it'll tell you yes okay

483
00:20:33,920 --> 00:20:39,110
Jim can log into the system too which

484
00:20:36,650 --> 00:20:41,780
has a domain admin logged in he probably

485
00:20:39,110 --> 00:20:44,000
has tomato or he has local admin rights

486
00:20:41,780 --> 00:20:45,770
there can log into that system and steal

487
00:20:44,000 --> 00:20:49,340
that domain admins password then you're

488
00:20:45,770 --> 00:20:51,530
a domain admin so this can help you from

489
00:20:49,340 --> 00:20:53,059
a defensive side look at are there

490
00:20:51,530 --> 00:20:55,668
people that have overly permissive

491
00:20:53,059 --> 00:20:57,440
access in terms of local administrator

492
00:20:55,669 --> 00:21:00,850
rights is it very easy to get to your

493
00:20:57,440 --> 00:21:03,440
domain admins and privileged accounts

494
00:21:00,850 --> 00:21:07,010
you can you can't actually prevent

495
00:21:03,440 --> 00:21:08,600
bloodhound from running and defend

496
00:21:07,010 --> 00:21:10,040
against you know privilege abuse the

497
00:21:08,600 --> 00:21:12,678
best thing to do with that is to use

498
00:21:10,040 --> 00:21:14,450
these privilege if you can so giving

499
00:21:12,679 --> 00:21:16,549
users the least amount of privilege they

500
00:21:14,450 --> 00:21:18,980
need to do their their job that makes a

501
00:21:16,549 --> 00:21:20,240
lot harder if you get an account to

502
00:21:18,980 --> 00:21:23,150
utilize it to move throughout the

503
00:21:20,240 --> 00:21:25,820
network you can use bloodhound to find

504
00:21:23,150 --> 00:21:27,919
the weak links and then break them and

505
00:21:25,820 --> 00:21:30,559
you can actually detect bloodhound being

506
00:21:27,919 --> 00:21:32,540
run by creating tiny tokens and there's

507
00:21:30,559 --> 00:21:35,178
a link here I'll provide the slides on

508
00:21:32,540 --> 00:21:38,418
Twitter later if you want to go through

509
00:21:35,179 --> 00:21:40,280
and have the links you can also use 80

510
00:21:38,419 --> 00:21:42,830
Security orgs tips for breaking

511
00:21:40,280 --> 00:21:44,510
bloodhound that'll allow it to run for

512
00:21:42,830 --> 00:21:46,189
your defensive team but not for just

513
00:21:44,510 --> 00:21:47,840
anybody on the network which would which

514
00:21:46,190 --> 00:21:52,309
would prevent attackers from using a

515
00:21:47,840 --> 00:21:54,760
tool or a tool like that ping castles

516
00:21:52,309 --> 00:21:57,710
weren't worth mentioning it's an 80

517
00:21:54,760 --> 00:21:59,900
audit school that has some kind of

518
00:21:57,710 --> 00:22:01,460
similar features of bloodhound it's a

519
00:21:59,900 --> 00:22:04,400
paid tool but there's a free version it

520
00:22:01,460 --> 00:22:06,230
will look for do you have you know

521
00:22:04,400 --> 00:22:12,980
passwords stored new group policy things

522
00:22:06,230 --> 00:22:14,630
like that all right now that we we've

523
00:22:12,980 --> 00:22:17,360
looked it really just a small number of

524
00:22:14,630 --> 00:22:19,190
attack techniques and some of those

525
00:22:17,360 --> 00:22:22,969
really what I consider attack techniques

526
00:22:19,190 --> 00:22:25,040
just like a numeration but one of the

527
00:22:22,970 --> 00:22:27,050
things that that I find what I'm doing

528
00:22:25,040 --> 00:22:29,570
security assessments is that people have

529
00:22:27,050 --> 00:22:31,250
defensive tool sets in place they won't

530
00:22:29,570 --> 00:22:31,960
necessarily always test them to see how

531
00:22:31,250 --> 00:22:33,460
well they work

532
00:22:31,960 --> 00:22:35,920
and then when I come in or my team comes

533
00:22:33,460 --> 00:22:37,120
in we test them and it doesn't work how

534
00:22:35,920 --> 00:22:40,270
they think it works or it doesn't work

535
00:22:37,120 --> 00:22:41,649
at all and so I highly recommend if

536
00:22:40,270 --> 00:22:44,379
you're not using it using the mitre

537
00:22:41,650 --> 00:22:47,700
attack framework as as an attacker or as

538
00:22:44,380 --> 00:22:50,080
a defender to measure your defense and

539
00:22:47,700 --> 00:22:51,130
so what the mitre it's how many people

540
00:22:50,080 --> 00:22:53,320
are familiar with the my your attack

541
00:22:51,130 --> 00:22:55,120
framework ok great a lot of people

542
00:22:53,320 --> 00:22:58,450
you're not familiar with it it's this

543
00:22:55,120 --> 00:23:00,729
matrix of attack categories so you have

544
00:22:58,450 --> 00:23:03,180
initial access all different ways you

545
00:23:00,730 --> 00:23:06,220
could get that fishing supply chain

546
00:23:03,180 --> 00:23:10,690
execution all different methods of

547
00:23:06,220 --> 00:23:13,800
executing code on a system and so on and

548
00:23:10,690 --> 00:23:16,600
so how you want to use mitre attack to

549
00:23:13,800 --> 00:23:19,570
strengthen your defense or your offense

550
00:23:16,600 --> 00:23:22,270
is to from a defensive perspective

551
00:23:19,570 --> 00:23:23,800
looking at what are the common attacks

552
00:23:22,270 --> 00:23:26,800
in your industry or just a common

553
00:23:23,800 --> 00:23:28,450
attacks overall and seeing how you how

554
00:23:26,800 --> 00:23:30,730
you fare against those can you detect

555
00:23:28,450 --> 00:23:38,890
that can you prevent it if you can't why

556
00:23:30,730 --> 00:23:40,870
not and fix that this is one thing that

557
00:23:38,890 --> 00:23:42,880
why do you purple team assessments so we

558
00:23:40,870 --> 00:23:45,219
utilize heavily so I'll go in with one

559
00:23:42,880 --> 00:23:47,740
of my defensive team members and maybe

560
00:23:45,220 --> 00:23:49,240
I'll run the attacks we'll have a look

561
00:23:47,740 --> 00:23:51,550
at mitre attack work with the

562
00:23:49,240 --> 00:23:53,230
organization and say ok these are the

563
00:23:51,550 --> 00:23:55,960
areas you're concerned about let's start

564
00:23:53,230 --> 00:23:57,700
with these from you know we'll pick a

565
00:23:55,960 --> 00:24:00,820
handful of categories a handful of

566
00:23:57,700 --> 00:24:03,670
techniques and it will run the attack ok

567
00:24:00,820 --> 00:24:05,590
is the log in place to detect that ok it

568
00:24:03,670 --> 00:24:07,600
is great is that feeding of the sim are

569
00:24:05,590 --> 00:24:10,360
you alerting on it ok good you are

570
00:24:07,600 --> 00:24:11,800
is it being prevented and then we'll

571
00:24:10,360 --> 00:24:13,209
look at okay here's the prevention

572
00:24:11,800 --> 00:24:18,040
control for that to prevent that from

573
00:24:13,210 --> 00:24:19,600
being successful also all right I I

574
00:24:18,040 --> 00:24:21,550
managed to get through all those slides

575
00:24:19,600 --> 00:24:23,980
pretty quickly I was worried enough time

576
00:24:21,550 --> 00:24:26,200
thank you very much for listening I hope

577
00:24:23,980 --> 00:24:28,540
I didn't bore you too much if you have

578
00:24:26,200 --> 00:24:32,110
any questions for me I'd be happy to

579
00:24:28,540 --> 00:24:34,570
talk about anything after the talk I'll

580
00:24:32,110 --> 00:24:37,740
be around or reach out to me on Twitter

581
00:24:34,570 --> 00:24:37,740
or my emails there

582
00:24:46,150 --> 00:24:52,780
Lambeth okay take a couple questions

583
00:24:49,780 --> 00:24:52,780
yeah

584
00:24:53,350 --> 00:25:00,760
any other questions

585
00:24:56,799 --> 00:25:00,760
hey great thank you very much

