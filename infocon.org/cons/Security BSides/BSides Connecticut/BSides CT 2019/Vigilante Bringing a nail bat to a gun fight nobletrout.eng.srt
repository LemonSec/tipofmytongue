1
00:00:21,480 --> 00:00:25,690
hello oh can you guys hear me okay or

2
00:00:25,090 --> 00:00:31,029
should I

3
00:00:25,690 --> 00:00:35,980
okay cool hi yes so my name is also

4
00:00:31,029 --> 00:00:38,590
Chuck I have a regular name too and I'm

5
00:00:35,980 --> 00:00:41,080
here to give a talk that looks really

6
00:00:38,590 --> 00:00:44,199
really aggressive and mean I'm a big fan

7
00:00:41,080 --> 00:00:47,110
of like nail bats and zombies and things

8
00:00:44,199 --> 00:00:49,480
like that so that's actually the Twitter

9
00:00:47,110 --> 00:00:51,610
background picture of my Twitter thing

10
00:00:49,480 --> 00:00:57,699
so it was easy to grab and just use for

11
00:00:51,610 --> 00:00:59,829
my slide a little bit about me the

12
00:00:57,700 --> 00:01:01,960
intelligence is way too high on this

13
00:00:59,829 --> 00:01:05,199
special chart I'd probably put myself at

14
00:01:01,960 --> 00:01:07,509
a three but my Luck's definitely a 10

15
00:01:05,199 --> 00:01:11,020
I've given this is my fifth talk at

16
00:01:07,509 --> 00:01:13,090
b-sides Connecticut which is nuts

17
00:01:11,020 --> 00:01:15,640
for perspective there's only been six of

18
00:01:13,090 --> 00:01:18,250
them and my talks have gotten more and

19
00:01:15,640 --> 00:01:20,259
more increasingly weird and less related

20
00:01:18,250 --> 00:01:21,850
to what I do for work so I think the

21
00:01:20,259 --> 00:01:23,259
first time I came here I gave a talk and

22
00:01:21,850 --> 00:01:24,729
it was in a polo shirt and it looked

23
00:01:23,259 --> 00:01:26,250
nice and it was really cool it's

24
00:01:24,729 --> 00:01:30,549
recorded somewhere you can go watch it

25
00:01:26,250 --> 00:01:35,009
and then I gave a talk the next time was

26
00:01:30,549 --> 00:01:37,509
on hacking mobile networks the epc core

27
00:01:35,009 --> 00:01:39,310
basically how to take down the stuff

28
00:01:37,509 --> 00:01:41,530
that routes all your cell phone cellular

29
00:01:39,310 --> 00:01:45,040
data which was kind of fun and neat but

30
00:01:41,530 --> 00:01:46,930
also work-related ish and then the next

31
00:01:45,040 --> 00:01:51,640
year I gave an impromptu off-the-record

32
00:01:46,930 --> 00:01:52,630
I'm not going to talk about a talk I'm

33
00:01:51,640 --> 00:01:56,829
not telling you

34
00:01:52,630 --> 00:01:59,679
I just let's just say if you do

35
00:01:56,829 --> 00:02:04,240
something stupid they they like it and

36
00:01:59,680 --> 00:02:05,380
then the the last year I gave a two-fer

37
00:02:04,240 --> 00:02:07,539
talk because I didn't have enough

38
00:02:05,380 --> 00:02:10,299
material for one talk

39
00:02:07,540 --> 00:02:12,790
it was about hacking back at Monet our

40
00:02:10,299 --> 00:02:14,410
miners drive-by exploits and threat

41
00:02:12,790 --> 00:02:16,328
intelligence and then I talked about how

42
00:02:14,410 --> 00:02:20,950
I broke into my Audi which is kind of

43
00:02:16,329 --> 00:02:22,660
neat so I'm sort of all over the place

44
00:02:20,950 --> 00:02:24,160
and now this is like continuing the

45
00:02:22,660 --> 00:02:27,100
slide down this year I'm just in a

46
00:02:24,160 --> 00:02:29,579
t-shirt and sneakers that have spray

47
00:02:27,100 --> 00:02:39,090
foam on them from repair in my house

48
00:02:29,580 --> 00:02:41,400
and yeah so let's get weird so I'm not

49
00:02:39,090 --> 00:02:43,590
sure if any of you guys who has

50
00:02:41,400 --> 00:02:47,610
successfully deployed used tested or

51
00:02:43,590 --> 00:02:49,080
tried out TLS 1.3 or okay like let's do

52
00:02:47,610 --> 00:02:52,170
the old fashioned show of hands who

53
00:02:49,080 --> 00:02:53,940
knows what TLS 1.3 it's okay good and

54
00:02:52,170 --> 00:02:55,410
only like one person in the back over

55
00:02:53,940 --> 00:02:58,500
there put a hand up and someone over

56
00:02:55,410 --> 00:03:02,040
there it's been a total disaster in

57
00:02:58,500 --> 00:03:03,930
terms of rollout IETF RFC all this sort

58
00:03:02,040 --> 00:03:06,090
of stuff it was fascinating to sort of

59
00:03:03,930 --> 00:03:08,010
watch as someone who's involved in

60
00:03:06,090 --> 00:03:10,230
network test and measurement that this

61
00:03:08,010 --> 00:03:12,299
thing could be such a fiasco and what

62
00:03:10,230 --> 00:03:14,010
was going on there

63
00:03:12,300 --> 00:03:16,290
you would repeatedly see it sort of

64
00:03:14,010 --> 00:03:18,420
rolled out in the browser's and then

65
00:03:16,290 --> 00:03:22,410
quickly taken back or cloud fly return

66
00:03:18,420 --> 00:03:24,049
no no no no no no it's bad and you'd

67
00:03:22,410 --> 00:03:28,590
sort of start scratching your head and

68
00:03:24,050 --> 00:03:32,040
sort of looking at well why is this

69
00:03:28,590 --> 00:03:34,080
happening what's fun is is if you ever

70
00:03:32,040 --> 00:03:36,540
are interested you can subscribe to any

71
00:03:34,080 --> 00:03:38,700
IETF exchange and instantly you're now a

72
00:03:36,540 --> 00:03:39,929
member you're part of the advisory stuff

73
00:03:38,700 --> 00:03:41,760
right

74
00:03:39,930 --> 00:03:43,500
that's how open they are about this

75
00:03:41,760 --> 00:03:45,390
stuff you can sort of sit on the

76
00:03:43,500 --> 00:03:47,220
sidelines and watch watch the arguments

77
00:03:45,390 --> 00:03:49,170
and bent or go back and forth on their

78
00:03:47,220 --> 00:03:52,050
mailing lists and it can be quite

79
00:03:49,170 --> 00:03:55,049
entertaining the reality is is that

80
00:03:52,050 --> 00:03:56,760
every time they put it out the way the

81
00:03:55,050 --> 00:03:58,739
way that Google likes to test things is

82
00:03:56,760 --> 00:04:01,049
because their customers are free they

83
00:03:58,739 --> 00:04:03,239
just update their browser and they sort

84
00:04:01,050 --> 00:04:05,310
of do a a bee analysis they call it

85
00:04:03,239 --> 00:04:06,750
right like I'll turn it on and see how

86
00:04:05,310 --> 00:04:11,370
many failures I get and then I'll turn

87
00:04:06,750 --> 00:04:13,709
it back off again so then it was sort of

88
00:04:11,370 --> 00:04:15,750
finally announced in August last year

89
00:04:13,709 --> 00:04:17,910
that it was rolled out but as you saw

90
00:04:15,750 --> 00:04:20,850
from the show of hands it still hasn't

91
00:04:17,910 --> 00:04:23,580
rolled out why is it not rolled out it's

92
00:04:20,850 --> 00:04:27,540
because like I said it breaks everything

93
00:04:23,580 --> 00:04:31,020
and what was really interesting was why

94
00:04:27,540 --> 00:04:33,360
it broke everything the people pushing

95
00:04:31,020 --> 00:04:35,099
this standard wanted to stop people

96
00:04:33,360 --> 00:04:37,890
looking at the network traffic going

97
00:04:35,100 --> 00:04:41,160
through the network TLS is meant to keep

98
00:04:37,890 --> 00:04:42,539
you safe right some of us might call it

99
00:04:41,160 --> 00:04:45,210
SSL

100
00:04:42,540 --> 00:04:48,420
if you're really old but basically it

101
00:04:45,210 --> 00:04:50,609
it's designed to stop you from looking

102
00:04:48,420 --> 00:04:51,930
on the inside so if you go banking or

103
00:04:50,610 --> 00:04:54,240
something else all that data is

104
00:04:51,930 --> 00:04:56,430
encrypted does a public/private key

105
00:04:54,240 --> 00:04:59,310
encryption pair exchanger then share

106
00:04:56,430 --> 00:05:02,190
some sort of megalithic awesome key and

107
00:04:59,310 --> 00:05:07,050
now we have ephemeral ciphers which make

108
00:05:02,190 --> 00:05:08,670
it even tougher to break in so but

109
00:05:07,050 --> 00:05:11,040
what's the problem is is if you're a

110
00:05:08,670 --> 00:05:14,580
blue team or if you're a network defense

111
00:05:11,040 --> 00:05:15,930
person you have policy after enforce you

112
00:05:14,580 --> 00:05:16,580
have to stop people going to you porn

113
00:05:15,930 --> 00:05:18,720
all day

114
00:05:16,580 --> 00:05:21,810
you have to stop people going there

115
00:05:18,720 --> 00:05:23,160
known criminal websites or make sure

116
00:05:21,810 --> 00:05:26,610
that they're not downloading malware

117
00:05:23,160 --> 00:05:28,770
over TLS almost all malware is over some

118
00:05:26,610 --> 00:05:31,110
kind of SSL let's encrypt makes it nice

119
00:05:28,770 --> 00:05:33,299
and cheap for them to do it right so if

120
00:05:31,110 --> 00:05:36,270
you go look at a blue coat fortigate

121
00:05:33,300 --> 00:05:38,160
squid proxies whatever they all have an

122
00:05:36,270 --> 00:05:40,530
ability two men in the middle that that

123
00:05:38,160 --> 00:05:42,750
network connection and then your IT

124
00:05:40,530 --> 00:05:44,580
staff will ship a certificate that says

125
00:05:42,750 --> 00:05:47,040
that's okay and your browser doesn't

126
00:05:44,580 --> 00:05:48,840
throw up an alert right this is sort of

127
00:05:47,040 --> 00:05:50,370
how the submit the work and in America

128
00:05:48,840 --> 00:05:51,869
we understand our computers don't belong

129
00:05:50,370 --> 00:05:53,940
to us they belong to our company and

130
00:05:51,870 --> 00:05:55,710
everyone's okay with that and they then

131
00:05:53,940 --> 00:06:00,300
just buy another computer for porn at

132
00:05:55,710 --> 00:06:03,510
home there's there's a lot of good

133
00:06:00,300 --> 00:06:06,180
reasons for doing this right like you do

134
00:06:03,510 --> 00:06:07,980
want to limit access to stuff you want

135
00:06:06,180 --> 00:06:09,330
to make sure people are safe it's a

136
00:06:07,980 --> 00:06:13,260
headache wouldn't people download

137
00:06:09,330 --> 00:06:16,020
malware and also it's a handy thing to

138
00:06:13,260 --> 00:06:18,360
use if you happen to you know own the

139
00:06:16,020 --> 00:06:21,150
route signing certificate for calm and

140
00:06:18,360 --> 00:06:27,720
have a device that can intercept SSL to

141
00:06:21,150 --> 00:06:30,539
to spy on people so the trouble was was

142
00:06:27,720 --> 00:06:32,880
that these guys it's somehow magically

143
00:06:30,540 --> 00:06:34,770
appeared out of all this design and

144
00:06:32,880 --> 00:06:37,560
thought into this network protocol stack

145
00:06:34,770 --> 00:06:39,659
that they never even imagined that these

146
00:06:37,560 --> 00:06:41,760
devices existed out there or did this

147
00:06:39,660 --> 00:06:43,230
and it's mind-blowing but if you read

148
00:06:41,760 --> 00:06:44,670
these blogs and stuff they're like we

149
00:06:43,230 --> 00:06:47,880
found out about something we're calling

150
00:06:44,670 --> 00:06:49,990
middle boxes if you're me you call them

151
00:06:47,880 --> 00:06:53,229
a firewall or

152
00:06:49,990 --> 00:06:55,750
you know something like that but it's

153
00:06:53,229 --> 00:06:59,139
it's it's amazing how disconnected you

154
00:06:55,750 --> 00:07:01,060
can be as a developer a huge company

155
00:06:59,139 --> 00:07:02,830
like Google and not understand that this

156
00:07:01,060 --> 00:07:05,949
is also happening in the same world

157
00:07:02,830 --> 00:07:10,180
right but it really looks like that's

158
00:07:05,949 --> 00:07:12,009
sort of what happened so the the

159
00:07:10,180 --> 00:07:13,569
security vendors from what I could tell

160
00:07:12,009 --> 00:07:16,479
weren't brought into this discussion

161
00:07:13,569 --> 00:07:18,280
until way later the guys kept trying to

162
00:07:16,479 --> 00:07:20,740
get increasingly clever but the the

163
00:07:18,280 --> 00:07:22,030
weirds group they did was at the top of

164
00:07:20,740 --> 00:07:23,669
the protocol header it says what the

165
00:07:22,030 --> 00:07:26,489
version is and they just put 1.3

166
00:07:23,669 --> 00:07:30,750
assuming that that would just work and

167
00:07:26,490 --> 00:07:33,430
all the decryption devices out there

168
00:07:30,750 --> 00:07:36,639
sort of assumed that 1.3 would work kind

169
00:07:33,430 --> 00:07:43,000
of like 1.2 and it doesn't and so that

170
00:07:36,639 --> 00:07:44,650
sort of broke the whole thing and so if

171
00:07:43,000 --> 00:07:46,419
you start looking at it from up from my

172
00:07:44,650 --> 00:07:49,120
even bigger point of view these

173
00:07:46,419 --> 00:07:51,460
mailboxes don't just do TLS decryption

174
00:07:49,120 --> 00:07:54,550
they intercept your IMAP they intercept

175
00:07:51,460 --> 00:07:56,500
your pop3 your SMTP communications they

176
00:07:54,550 --> 00:08:00,580
have really neat sort of proxy mode slow

177
00:07:56,500 --> 00:08:02,229
mode whatever and they if they'll even

178
00:08:00,580 --> 00:08:04,840
hold back a data exchange as you're

179
00:08:02,229 --> 00:08:07,840
downloading an email for the last file

180
00:08:04,840 --> 00:08:09,698
send it a cloud hash it if it's bad it

181
00:08:07,840 --> 00:08:11,710
drops that last packet and hopefully

182
00:08:09,699 --> 00:08:13,060
your browser doesn't stitch that piece

183
00:08:11,710 --> 00:08:14,349
of malware together because there's no

184
00:08:13,060 --> 00:08:17,110
bytes padding on the end doesn't do

185
00:08:14,349 --> 00:08:21,250
anything the other stuff that middle

186
00:08:17,110 --> 00:08:23,289
middle boxes firewalls do is NAT they

187
00:08:21,250 --> 00:08:24,759
perform fix up some protocols so if

188
00:08:23,289 --> 00:08:27,039
you've ever had a headache where FTP

189
00:08:24,759 --> 00:08:28,659
isn't working or voice over IP isn't

190
00:08:27,039 --> 00:08:30,969
working you haven't turned your fix-ups

191
00:08:28,659 --> 00:08:33,819
on they rewrite the protocol headers for

192
00:08:30,969 --> 00:08:35,820
that squid caches your data so it

193
00:08:33,820 --> 00:08:43,539
inserts headers it looks at stuff and

194
00:08:35,820 --> 00:08:47,020
that block spam right so then for me and

195
00:08:43,539 --> 00:08:51,220
my point of view the question that I got

196
00:08:47,020 --> 00:08:56,199
provoked with was can I figure this out

197
00:08:51,220 --> 00:08:59,230
can I can I figure out what's between me

198
00:08:56,200 --> 00:09:01,420
and somewhere else for a box that's

199
00:08:59,230 --> 00:09:04,069
trying its best to be as transparent and

200
00:09:01,420 --> 00:09:07,819
go along get along as possible

201
00:09:04,069 --> 00:09:09,229
this isn't so much identify as oh it's a

202
00:09:07,819 --> 00:09:12,618
firewall but I want to know what

203
00:09:09,230 --> 00:09:15,379
specific device that is and how many

204
00:09:12,619 --> 00:09:19,639
there are between me and the rest of the

205
00:09:15,379 --> 00:09:21,829
world do I have the right to know that

206
00:09:19,639 --> 00:09:24,860
there's a follow-on question and I think

207
00:09:21,829 --> 00:09:27,170
the answer to that is yes and more

208
00:09:24,860 --> 00:09:30,279
importantly can I do it can I figure out

209
00:09:27,170 --> 00:09:35,240
what these things are and how they look

210
00:09:30,279 --> 00:09:38,319
so here's a chart for you but basically

211
00:09:35,240 --> 00:09:44,240
this is an FTP transaction across a

212
00:09:38,319 --> 00:09:45,439
firewall it says FortiGate and the pcap

213
00:09:44,240 --> 00:09:48,079
file out there so you can tell that

214
00:09:45,439 --> 00:09:50,089
that's a peek now FortiGate device and

215
00:09:48,079 --> 00:09:51,769
if you look on the left you'll notice

216
00:09:50,089 --> 00:09:53,540
that's a little shorter than the one on

217
00:09:51,769 --> 00:09:56,149
the right so now it becomes an

218
00:09:53,540 --> 00:09:57,920
eye-watering like visual diff of trying

219
00:09:56,149 --> 00:10:00,860
to figure out which command it is that

220
00:09:57,920 --> 00:10:02,240
was snuck in here that's not there yell

221
00:10:00,860 --> 00:10:06,410
it out if you see it otherwise I'll just

222
00:10:02,240 --> 00:10:08,870
say it right now mm-hmm sighs yeah it's

223
00:10:06,410 --> 00:10:11,480
size on the right size is an esoteric

224
00:10:08,870 --> 00:10:13,850
weird FTP command that you can issue

225
00:10:11,480 --> 00:10:16,069
before you do a retrieve for a file and

226
00:10:13,850 --> 00:10:17,689
it'll tell you how big that file is now

227
00:10:16,069 --> 00:10:19,699
if you're doing malware interception why

228
00:10:17,689 --> 00:10:21,019
is this important why do you want to

229
00:10:19,699 --> 00:10:23,059
know how big that file is gonna be

230
00:10:21,019 --> 00:10:24,980
because you'll have a separate socket

231
00:10:23,059 --> 00:10:27,230
it's just a binary blob of data that

232
00:10:24,980 --> 00:10:30,290
comes across at you right for that FTP

233
00:10:27,230 --> 00:10:32,300
transaction it has no context to it so

234
00:10:30,290 --> 00:10:33,829
you need you need the context of how big

235
00:10:32,300 --> 00:10:35,929
it is if you're gonna do malware

236
00:10:33,829 --> 00:10:38,540
analysis on it because what it will do

237
00:10:35,929 --> 00:10:39,980
is it will snarf up all of the packets

238
00:10:38,540 --> 00:10:41,540
pass them to the customer so the

239
00:10:39,980 --> 00:10:43,550
customer sees their download going just

240
00:10:41,540 --> 00:10:45,889
fine and then I'll leave those trailing

241
00:10:43,550 --> 00:10:48,170
bytes and it will just hash that whole

242
00:10:45,889 --> 00:10:50,720
file the last somewhere in the cloud is

243
00:10:48,170 --> 00:10:56,748
this malware with md5 there's a reason

244
00:10:50,720 --> 00:10:58,910
to use md5 or sha-1 sha-256 or something

245
00:10:56,749 --> 00:11:01,009
and then the cloud will come back and

246
00:10:58,910 --> 00:11:04,219
say yes this is malware you know

247
00:11:01,009 --> 00:11:06,379
terminate that connection then so we

248
00:11:04,220 --> 00:11:08,629
have our first test I can do an FTP

249
00:11:06,379 --> 00:11:11,149
transaction and if I see on the server

250
00:11:08,629 --> 00:11:13,759
side that size request and I didn't send

251
00:11:11,149 --> 00:11:16,520
it on the other side I now know I've got

252
00:11:13,759 --> 00:11:24,050
a 40 gate between me and somewhere else

253
00:11:16,520 --> 00:11:26,120
right here's an easier one so I can't

254
00:11:24,050 --> 00:11:28,430
remember which one this was but what's

255
00:11:26,120 --> 00:11:31,940
interesting is is there's no effort to

256
00:11:28,430 --> 00:11:34,310
mask any of the HEV headers or anything

257
00:11:31,940 --> 00:11:36,980
this little ie friendly error message is

258
00:11:34,310 --> 00:11:40,449
built right into the thing to try to

259
00:11:36,980 --> 00:11:43,670
navigate around an ie bug for like ie6

260
00:11:40,450 --> 00:11:45,770
where it basically just says if you get

261
00:11:43,670 --> 00:11:47,689
a 404 and that's too small it just

262
00:11:45,770 --> 00:11:51,710
displays the Internet Explorer it's a

263
00:11:47,690 --> 00:11:53,630
bad webpage rather than the page and on

264
00:11:51,710 --> 00:11:56,060
the right I was sending a car so I'm

265
00:11:53,630 --> 00:12:00,430
testing the AV filtering mechanism here

266
00:11:56,060 --> 00:12:05,780
and this is drifting slowly downwards

267
00:12:00,430 --> 00:12:07,579
there we go okay so this is easy to tell

268
00:12:05,780 --> 00:12:09,410
that the content I requested is not the

269
00:12:07,580 --> 00:12:10,910
content that I asked for but that's not

270
00:12:09,410 --> 00:12:13,040
the question I was asking the question

271
00:12:10,910 --> 00:12:15,560
was asking is who's actually doing the

272
00:12:13,040 --> 00:12:19,430
blocking and what it is so you can see

273
00:12:15,560 --> 00:12:23,750
different headers are inserted as long

274
00:12:19,430 --> 00:12:27,589
as well as Jesus looks like some other

275
00:12:23,750 --> 00:12:31,640
fun things right but what's also

276
00:12:27,590 --> 00:12:35,420
interesting is if you enable proxy mode

277
00:12:31,640 --> 00:12:36,920
on one of these firewalls but you turn

278
00:12:35,420 --> 00:12:39,020
off all detection you turn off all the

279
00:12:36,920 --> 00:12:43,310
engines it still flips one little bit

280
00:12:39,020 --> 00:12:44,390
changes HEV 101.1 so now I even know if

281
00:12:43,310 --> 00:12:47,060
you're trying to sneak something in

282
00:12:44,390 --> 00:12:51,340
there and not do anything at all I can

283
00:12:47,060 --> 00:12:51,339
still see you which is kind of neat too

284
00:12:51,700 --> 00:12:57,680
and then this is what I did last night I

285
00:12:55,520 --> 00:13:00,500
just googled how to set up a transparent

286
00:12:57,680 --> 00:13:02,569
squid proxy and you can see squid is

287
00:13:00,500 --> 00:13:05,000
super noisy puts a lot of stuff in the

288
00:13:02,570 --> 00:13:08,180
requests some of my stuff is also

289
00:13:05,000 --> 00:13:10,670
looking at a also looked up a lot of the

290
00:13:08,180 --> 00:13:17,170
TLS stuff but that'll make you go crazy

291
00:13:10,670 --> 00:13:19,899
trying to see those binary blobs so

292
00:13:17,170 --> 00:13:21,429
the question becomes who watches the

293
00:13:19,899 --> 00:13:24,399
Watchmen this is actually from a

294
00:13:21,429 --> 00:13:30,279
terrible Latin Romance poem but it's

295
00:13:24,399 --> 00:13:32,730
been a SERP I Alan Moore and I went and

296
00:13:30,279 --> 00:13:34,749
tried to figure out what's the Latin for

297
00:13:32,730 --> 00:13:36,759
watching the Watchmen and I got

298
00:13:34,749 --> 00:13:39,369
vigilante so I thought that sounds

299
00:13:36,759 --> 00:13:42,399
really cool and I'll use that for a name

300
00:13:39,369 --> 00:13:43,809
I wrote it in Python because I don't

301
00:13:42,399 --> 00:13:44,980
know how to write Python so I figured

302
00:13:43,809 --> 00:13:48,100
it'd be a good opportunity to learn how

303
00:13:44,980 --> 00:13:49,569
to write Python it recognizes

304
00:13:48,100 --> 00:13:51,669
middleboxes based on the traffic

305
00:13:49,569 --> 00:13:54,389
characteristics so you can think of it

306
00:13:51,669 --> 00:13:54,389
it's almost sort of like

307
00:14:02,840 --> 00:14:08,630
a procedural programmatic tool kind of

308
00:14:06,710 --> 00:14:11,390
like an IPS uses regular expressions to

309
00:14:08,630 --> 00:14:14,090
find malicious stuff that's on the

310
00:14:11,390 --> 00:14:17,960
network this is trying to find what is

311
00:14:14,090 --> 00:14:22,250
watching me right using a similar sort

312
00:14:17,960 --> 00:14:24,200
of framework or idea it's currently

313
00:14:22,250 --> 00:14:26,030
capable of detecting FortiGate in two

314
00:14:24,200 --> 00:14:27,170
different modes if you've ever deployed

315
00:14:26,030 --> 00:14:28,310
the FortiGate you know those two

316
00:14:27,170 --> 00:14:29,870
different modes make it up or like I

317
00:14:28,310 --> 00:14:32,469
like operate like a totally different

318
00:14:29,870 --> 00:14:35,300
firewall it also detects Palo Alto

319
00:14:32,470 --> 00:14:39,350
because our IT department uses Palo Alto

320
00:14:35,300 --> 00:14:42,530
so that's easy to test and as of last

321
00:14:39,350 --> 00:14:44,060
night I added a little bit detection in

322
00:14:42,530 --> 00:14:46,370
there too

323
00:14:44,060 --> 00:14:49,069
it currently can it has test cases for

324
00:14:46,370 --> 00:14:54,070
HTTP content filtering AV filtering

325
00:14:49,070 --> 00:14:59,480
proxy filter proxy detection TLS and FTP

326
00:14:54,070 --> 00:15:03,020
and yeah there you go content filtering

327
00:14:59,480 --> 00:15:06,350
AV filtering and all that so now I'm

328
00:15:03,020 --> 00:15:08,360
going to try to do a demo my laptop fan

329
00:15:06,350 --> 00:15:12,530
is going nuts because it's a little hot

330
00:15:08,360 --> 00:15:17,990
in here or maybe just here so we'll see

331
00:15:12,530 --> 00:15:22,310
how well this works out so if I go here

332
00:15:17,990 --> 00:15:26,630
I need to establish an SSH tunnel to a

333
00:15:22,310 --> 00:15:29,810
Jeff piezo server and this is basically

334
00:15:26,630 --> 00:15:31,520
port forwarding three different ports

335
00:15:29,810 --> 00:15:34,099
that I'm listening on so that my

336
00:15:31,520 --> 00:15:36,319
software just runs locally so now if I

337
00:15:34,100 --> 00:15:38,500
run you can see I've even been working

338
00:15:36,320 --> 00:15:45,350
on it now oh you guys can't see that oh

339
00:15:38,500 --> 00:15:47,300
my god what just yell that out right

340
00:15:45,350 --> 00:15:48,950
away guys don't let people dangle out

341
00:15:47,300 --> 00:15:55,400
there when they're presenting it feels

342
00:15:48,950 --> 00:15:58,370
terrible alright so this is guy go fast

343
00:15:55,400 --> 00:16:01,699
but I added color tech support so it

344
00:15:58,370 --> 00:16:05,780
looks cool and amazing and if you look

345
00:16:01,700 --> 00:16:08,450
here you can see that it can detect am I

346
00:16:05,780 --> 00:16:11,480
getting inspected by a Palo Alto or am i

347
00:16:08,450 --> 00:16:16,329
get inspected by squid or whatever I'll

348
00:16:11,480 --> 00:16:18,189
scroll back up here so if you look here

349
00:16:16,329 --> 00:16:20,618
I'm testing the presidents of proxies it

350
00:16:18,189 --> 00:16:23,649
didn't detect any proxies now doing

351
00:16:20,619 --> 00:16:24,869
clear-text heg inspection so here's a

352
00:16:23,649 --> 00:16:28,269
neat trick

353
00:16:24,869 --> 00:16:30,040
because dns is also a dumpster fire when

354
00:16:28,269 --> 00:16:32,199
these things are doing a content

355
00:16:30,040 --> 00:16:34,059
inspection and trying to stop you going

356
00:16:32,199 --> 00:16:35,738
to malicious websites most the time they

357
00:16:34,059 --> 00:16:38,949
don't see the DNS traffic your dns

358
00:16:35,739 --> 00:16:41,879
servers over here firewalls here users

359
00:16:38,949 --> 00:16:45,189
here better than up here right so

360
00:16:41,879 --> 00:16:47,709
instead of using DNS queries to to block

361
00:16:45,189 --> 00:16:50,230
stuff they look at the HTTP header they

362
00:16:47,709 --> 00:16:53,859
look at the certificate name yes and I

363
00:16:50,230 --> 00:16:56,670
filled the whatever like those those

364
00:16:53,860 --> 00:16:59,709
sort of Network artifacts instead right

365
00:16:56,670 --> 00:17:01,238
so all you have to do is pick a server

366
00:16:59,709 --> 00:17:02,559
on the Internet and then issue a get

367
00:17:01,239 --> 00:17:06,370
request in the host header that says

368
00:17:02,559 --> 00:17:08,109
playboy.com and it will nuke it so

369
00:17:06,369 --> 00:17:10,029
that's like the easiest way to test one

370
00:17:08,109 --> 00:17:11,829
of these things so what I did was I

371
00:17:10,029 --> 00:17:13,388
generated a list of places that I

372
00:17:11,829 --> 00:17:14,980
figured you might want to stop people go

373
00:17:13,388 --> 00:17:19,000
into playboy.com

374
00:17:14,980 --> 00:17:20,860
google comm example CNN BoardGameGeek

375
00:17:19,000 --> 00:17:24,099
they blocked my they blocked my board

376
00:17:20,859 --> 00:17:29,620
games at work this is number one reason

377
00:17:24,099 --> 00:17:31,629
why I set up a tour proxy oh I mean I

378
00:17:29,620 --> 00:17:34,299
just want to find out when Magic the

379
00:17:31,630 --> 00:17:37,510
Gathering is draft night is at 6:45 or

380
00:17:34,299 --> 00:17:38,200
6:30 to take my little one - and they

381
00:17:37,510 --> 00:17:41,919
block it

382
00:17:38,200 --> 00:17:43,590
Oh price-price Clearing House they can

383
00:17:41,919 --> 00:17:46,659
block that screw those guys

384
00:17:43,590 --> 00:17:48,158
and then it's kind of neat runs a shell

385
00:17:46,659 --> 00:17:50,710
script that generates new TLS

386
00:17:48,159 --> 00:17:52,690
certificates every time you run it these

387
00:17:50,710 --> 00:17:54,370
are fake TLS certificates but they put

388
00:17:52,690 --> 00:17:57,279
in the right certificate name sni

389
00:17:54,370 --> 00:18:00,070
headers and stuff um and it puts those

390
00:17:57,279 --> 00:18:04,630
in there I wrote basically like a fakie

391
00:18:00,070 --> 00:18:07,840
a fake TLS handshake II thing that

392
00:18:04,630 --> 00:18:09,880
pretends to do 1.2 which was lots of fun

393
00:18:07,840 --> 00:18:11,850
and a huge headache if you've ever done

394
00:18:09,880 --> 00:18:18,309
a SN dot one parsing

395
00:18:11,850 --> 00:18:21,928
no and then at the bottom here I've got

396
00:18:18,309 --> 00:18:26,260
an FTP filter the FTP filter test and

397
00:18:21,929 --> 00:18:28,340
the the only one I've got a test for

398
00:18:26,260 --> 00:18:30,260
that is the FortiGate right now and

399
00:18:28,340 --> 00:18:33,110
then this one doesn't have the sexy

400
00:18:30,260 --> 00:18:36,020
syntax highlighting but you can see that

401
00:18:33,110 --> 00:18:36,439
the AV filtering was pop down there

402
00:18:36,020 --> 00:18:39,080
right

403
00:18:36,440 --> 00:18:44,720
so that's on a pan and you can figure

404
00:18:39,080 --> 00:18:46,178
that out but then it gets cooler but

405
00:18:44,720 --> 00:18:49,429
wait there's more

406
00:18:46,179 --> 00:18:52,429
so this is the like Linux box I set up

407
00:18:49,429 --> 00:18:56,270
squid with am I still connect to the

408
00:18:52,429 --> 00:18:57,860
Machine I am good so hopefully you guys

409
00:18:56,270 --> 00:19:00,649
can see that it's a little smaller I

410
00:18:57,860 --> 00:19:03,049
know but this is basically a Linux box

411
00:19:00,649 --> 00:19:04,340
it's got a squid server set up and it's

412
00:19:03,049 --> 00:19:06,168
forcing all the traffic through that

413
00:19:04,340 --> 00:19:08,178
squid and then it's going to go through

414
00:19:06,169 --> 00:19:09,590
my VPN at work so now I can see if

415
00:19:08,179 --> 00:19:11,600
there's two devices layered on top of

416
00:19:09,590 --> 00:19:14,840
each other and who's doing what just

417
00:19:11,600 --> 00:19:19,370
kind of neat right um so if you look

418
00:19:14,840 --> 00:19:20,809
here at the top it figured out that when

419
00:19:19,370 --> 00:19:24,500
I say your browsing is being inspected

420
00:19:20,809 --> 00:19:29,510
by squid transparent proxy mostly used

421
00:19:24,500 --> 00:19:31,970
by Airlines and cheating it off and then

422
00:19:29,510 --> 00:19:34,220
further down here it says that your

423
00:19:31,970 --> 00:19:36,409
playboy.com is blocked by the pan so you

424
00:19:34,220 --> 00:19:40,419
can actually sort of see who's blocking

425
00:19:36,409 --> 00:19:46,159
me where which i think is really neat so

426
00:19:40,419 --> 00:19:52,850
that's the demo part I I think it's kind

427
00:19:46,159 --> 00:19:55,250
of cool I don't know and so now we have

428
00:19:52,850 --> 00:19:57,350
the necessary concluding slides and

429
00:19:55,250 --> 00:20:03,470
things so let me try to explain how it

430
00:19:57,350 --> 00:20:07,219
works I won't lie I made this about 20

431
00:20:03,470 --> 00:20:08,870
minutes ago because I realized that

432
00:20:07,220 --> 00:20:11,510
there's a lot of Voodoo going on in

433
00:20:08,870 --> 00:20:14,178
there you might not recognize but

434
00:20:11,510 --> 00:20:16,850
basically you're here you are over here

435
00:20:14,179 --> 00:20:19,340
with your computer and what I do is I

436
00:20:16,850 --> 00:20:21,350
set up an SSH turn out to an AWS

437
00:20:19,340 --> 00:20:25,070
instance the world's tiniest computer I

438
00:20:21,350 --> 00:20:27,770
can find and I say do remote port

439
00:20:25,070 --> 00:20:30,379
forwarding from there for 80 88 443 and

440
00:20:27,770 --> 00:20:32,720
2121 you can recognize those always like

441
00:20:30,380 --> 00:20:34,370
alternate ports I don't have to do user

442
00:20:32,720 --> 00:20:38,059
privileges or anything and then I set up

443
00:20:34,370 --> 00:20:38,830
IP tables to forward 84 43 and 21 down

444
00:20:38,059 --> 00:20:41,950
to there

445
00:20:38,830 --> 00:20:44,020
and then I run test cases one at a time

446
00:20:41,950 --> 00:20:46,840
I do comparisons of what I sent what I

447
00:20:44,020 --> 00:20:49,540
received on both sides so my test cases

448
00:20:46,840 --> 00:20:50,919
the the function absorbs it says here's

449
00:20:49,540 --> 00:20:53,200
the original sent here's the original

450
00:20:50,920 --> 00:20:54,910
received on the server and here's the

451
00:20:53,200 --> 00:20:59,410
original sent by server here's the

452
00:20:54,910 --> 00:21:02,590
original received by client it's working

453
00:20:59,410 --> 00:21:05,410
so far and I'll just keep adding in new

454
00:21:02,590 --> 00:21:10,629
fix ups for it as I find problems I

455
00:21:05,410 --> 00:21:13,780
guess the code is growth so I'm not

456
00:21:10,630 --> 00:21:17,350
sharing it I really want to test the

457
00:21:13,780 --> 00:21:19,780
blue coat TLS device did manage to find

458
00:21:17,350 --> 00:21:21,340
one for a hundred bucks on eBay but I

459
00:21:19,780 --> 00:21:25,170
haven't found the time to set it up and

460
00:21:21,340 --> 00:21:29,199
probably there's no license on it so boo

461
00:21:25,170 --> 00:21:30,880
SNAT detection if you look if you saw

462
00:21:29,200 --> 00:21:33,760
it's like I call these test cases layer

463
00:21:30,880 --> 00:21:36,040
seven but also one of a source net

464
00:21:33,760 --> 00:21:38,170
detection using scape II or some other

465
00:21:36,040 --> 00:21:39,850
packet crafting tools you can see the

466
00:21:38,170 --> 00:21:42,250
same sort of little network artifacts

467
00:21:39,850 --> 00:21:45,760
and identify if you're using pfSense or

468
00:21:42,250 --> 00:21:48,340
FortiGate or pan for doing your net they

469
00:21:45,760 --> 00:21:52,270
all rotate source IPS differently source

470
00:21:48,340 --> 00:21:54,879
ports and things instead of using SSH

471
00:21:52,270 --> 00:21:56,440
for port forwarding which is really cool

472
00:21:54,880 --> 00:21:58,360
I should probably learn our WebSockets

473
00:21:56,440 --> 00:22:00,400
work to make it a little easier to set

474
00:21:58,360 --> 00:22:04,750
up and run and then I don't have to rely

475
00:22:00,400 --> 00:22:06,280
on SSH working not being inspected which

476
00:22:04,750 --> 00:22:08,200
leads needle last one I want to know if

477
00:22:06,280 --> 00:22:10,810
SSH is being intercepted as well because

478
00:22:08,200 --> 00:22:12,400
how many times do you just type yes when

479
00:22:10,810 --> 00:22:15,100
you're logging into your server and it

480
00:22:12,400 --> 00:22:15,730
says new key you know like okay okay I

481
00:22:15,100 --> 00:22:20,830
get work done

482
00:22:15,730 --> 00:22:22,540
I guess it's right who knows um so why

483
00:22:20,830 --> 00:22:27,129
did I make this this is the the

484
00:22:22,540 --> 00:22:29,260
obligatory pontification slide I had an

485
00:22:27,130 --> 00:22:31,750
itch to scratch I guess I was like I

486
00:22:29,260 --> 00:22:33,520
have to deal with this in my work

487
00:22:31,750 --> 00:22:35,500
somewhat I have to make these

488
00:22:33,520 --> 00:22:38,530
application protocols work for testing

489
00:22:35,500 --> 00:22:40,960
across firewalls so I'm already learning

490
00:22:38,530 --> 00:22:46,030
how these things all work can I apply

491
00:22:40,960 --> 00:22:48,460
that in some other way also I was

492
00:22:46,030 --> 00:22:50,530
reminded of a college roommate who took

493
00:22:48,460 --> 00:22:52,750
a map of the Lakes region of northern

494
00:22:50,530 --> 00:22:55,090
Minnesota I don't know

495
00:22:52,750 --> 00:22:59,440
why he had that on his wall I went to

496
00:22:55,090 --> 00:23:01,899
school in Worcester and he scrawled on

497
00:22:59,440 --> 00:23:04,630
it giant Sharpie markers the map is not

498
00:23:01,900 --> 00:23:09,580
the terrain probably in a fit of madness

499
00:23:04,630 --> 00:23:12,220
it was college using imagination so the

500
00:23:09,580 --> 00:23:17,290
the point is is like even on my way down

501
00:23:12,220 --> 00:23:19,780
here today from New Hampshire knowing

502
00:23:17,290 --> 00:23:22,480
what you're going and knowing where you

503
00:23:19,780 --> 00:23:24,190
are doesn't tell you what's in front of

504
00:23:22,480 --> 00:23:25,360
you right it's not telling you how

505
00:23:24,190 --> 00:23:26,980
you're getting there it doesn't tell you

506
00:23:25,360 --> 00:23:29,919
where the toll booths are the police are

507
00:23:26,980 --> 00:23:32,770
hiding there's a pothole or you know

508
00:23:29,920 --> 00:23:34,600
think break down some of this stuff you

509
00:23:32,770 --> 00:23:36,460
can use Waze now right they sort of

510
00:23:34,600 --> 00:23:39,310
enhance and they're giving you terrain

511
00:23:36,460 --> 00:23:41,800
data now right but it's it's really that

512
00:23:39,310 --> 00:23:43,450
it's if I'm driving I can see what's in

513
00:23:41,800 --> 00:23:45,700
front of me as I'm going to my

514
00:23:43,450 --> 00:23:47,380
destination on the internet you know

515
00:23:45,700 --> 00:23:49,600
where you're going but you don't know

516
00:23:47,380 --> 00:23:52,570
how you're getting there it's a giant

517
00:23:49,600 --> 00:23:55,090
black box of I don't know I figure

518
00:23:52,570 --> 00:23:57,460
people have a right to sort of figure

519
00:23:55,090 --> 00:24:01,000
that out like what's going on between me

520
00:23:57,460 --> 00:24:03,250
and the rest of the world and how could

521
00:24:01,000 --> 00:24:08,440
it impact me and I'd like to know if

522
00:24:03,250 --> 00:24:11,380
they're doing that so I've got 7 minutes

523
00:24:08,440 --> 00:24:13,630
left if you got questions but basically

524
00:24:11,380 --> 00:24:16,180
you can follow me on twitter at noble

525
00:24:13,630 --> 00:24:17,980
Trout I'm part of like three random

526
00:24:16,180 --> 00:24:22,270
people in Massachusetts that are trying

527
00:24:17,980 --> 00:24:23,770
to start a ski slash security convention

528
00:24:22,270 --> 00:24:26,050
thing up in the White Mountains this

529
00:24:23,770 --> 00:24:30,340
winter it's going to be a total disaster

530
00:24:26,050 --> 00:24:33,190
and I'm gonna love every minute of it so

531
00:24:30,340 --> 00:24:38,320
if you're interested follow the ski con

532
00:24:33,190 --> 00:24:39,780
and e Twitter handle and yeah look

533
00:24:38,320 --> 00:24:41,950
forward to think some of you guys there

534
00:24:39,780 --> 00:24:44,410
I'm gonna measure there's gonna be a lot

535
00:24:41,950 --> 00:24:49,410
of beer and worn out people so it'll be

536
00:24:44,410 --> 00:24:49,410
good that's about it thank you

537
00:24:50,720 --> 00:24:54,039
[Applause]

538
00:24:55,200 --> 00:25:06,760
yeah yes I did I did and I didn't put it

539
00:25:05,409 --> 00:25:09,250
in here but yes I did

540
00:25:06,760 --> 00:25:11,169
um so actually I can show you that if

541
00:25:09,250 --> 00:25:13,029
you want to see it let me see here I

542
00:25:11,169 --> 00:25:17,500
happen to have my private github

543
00:25:13,029 --> 00:25:22,240
repository right here here we go

544
00:25:17,500 --> 00:25:25,929
so it's it's a bunch of binary blob

545
00:25:22,240 --> 00:25:30,429
comparisons but basically if we look

546
00:25:25,929 --> 00:25:31,779
down here there you go so this is sort

547
00:25:30,429 --> 00:25:35,409
of what you're dealing with basically

548
00:25:31,779 --> 00:25:39,070
right what's kind of neat let me see if

549
00:25:35,409 --> 00:25:42,669
I can find it here there we go

550
00:25:39,070 --> 00:25:46,149
so the pan takes the random number

551
00:25:42,669 --> 00:25:49,149
random thing in the TLS handshake and it

552
00:25:46,149 --> 00:25:51,668
just decrements the first byte wave 1 so

553
00:25:49,149 --> 00:25:55,959
my test string is Fifi Kathy Vika Fifi

554
00:25:51,669 --> 00:25:57,340
and becomes befefe Kathy Vika VP so that

555
00:25:55,960 --> 00:25:59,679
you know this is the sort of stuff that

556
00:25:57,340 --> 00:26:02,158
I'm trying to do to make it hard I set

557
00:25:59,679 --> 00:26:04,870
up because there's a lot of back scatter

558
00:26:02,159 --> 00:26:07,149
all my almost all my requests I try to

559
00:26:04,870 --> 00:26:09,120
smuggle UID in there and I pattern match

560
00:26:07,149 --> 00:26:12,750
on that to know that I'm talking to me

561
00:26:09,120 --> 00:26:12,750
otherwise it can get confusing

