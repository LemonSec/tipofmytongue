1
00:00:02,510 --> 00:00:08,820
this thank you hi I'm very happy to be

2
00:00:07,230 --> 00:00:12,509
here and thank you for having me

3
00:00:08,820 --> 00:00:16,948
as you said my name is Amit and today I

4
00:00:12,509 --> 00:00:19,170
will be discussing Chrome and web RTC

5
00:00:16,949 --> 00:00:21,840
and how we can combine these two to

6
00:00:19,170 --> 00:00:24,869
cause some problems and for those with a

7
00:00:21,840 --> 00:00:26,609
keen eye I've used the - EQ from

8
00:00:24,869 --> 00:00:29,009
PowerShell because of using PowerShell

9
00:00:26,609 --> 00:00:35,790
this is a concept though so you can use

10
00:00:29,010 --> 00:00:38,129
this concept - not targeting

11
00:00:35,790 --> 00:00:40,469
specifically Chrome and you'll see what

12
00:00:38,129 --> 00:00:43,320
I'm talking about in just a sec so as I

13
00:00:40,469 --> 00:00:46,800
said my name is Amit I'm a security

14
00:00:43,320 --> 00:00:50,039
researcher at Viterbo and what we do we

15
00:00:46,800 --> 00:00:51,599
do file sanitization and I'm doing the

16
00:00:50,039 --> 00:00:53,309
security research at motivo and prior to

17
00:00:51,600 --> 00:00:56,820
that I was walking for checkpoint

18
00:00:53,309 --> 00:00:59,129
focusing on exploited kids and I used to

19
00:00:56,820 --> 00:01:03,030
scare it I swim and I play the guitar

20
00:00:59,129 --> 00:01:05,908
and that's pretty much for that okay so

21
00:01:03,030 --> 00:01:09,960
exposition for this research is quite

22
00:01:05,909 --> 00:01:12,869
interesting for me because I was when I

23
00:01:09,960 --> 00:01:15,839
first read about WebRTC I thought okay

24
00:01:12,869 --> 00:01:19,170
this is a very cool protocol for me it

25
00:01:15,840 --> 00:01:21,810
allows for peer-to-peer file sharing and

26
00:01:19,170 --> 00:01:24,060
webcam and audio and whatever you want

27
00:01:21,810 --> 00:01:25,979
to do and it's easy and you don't have

28
00:01:24,060 --> 00:01:28,200
to install anything additional other

29
00:01:25,979 --> 00:01:30,840
than the browser so it's very cool but

30
00:01:28,200 --> 00:01:33,990
on the other hand the slightest misuse

31
00:01:30,840 --> 00:01:35,850
and you can do very nasty stuff with it

32
00:01:33,990 --> 00:01:38,820
and that's what we'll be discussing

33
00:01:35,850 --> 00:01:40,740
today and how i'll be showing two

34
00:01:38,820 --> 00:01:42,960
scenarios that i came up with

35
00:01:40,740 --> 00:01:45,240
but obviously i'm aware that there are

36
00:01:42,960 --> 00:01:48,419
most scenarios and so if this talk

37
00:01:45,240 --> 00:01:51,329
inspires you and you come up with fellow

38
00:01:48,420 --> 00:01:54,710
scenarios please contact me I'd be more

39
00:01:51,329 --> 00:01:59,460
than happy to to learn to see them and

40
00:01:54,710 --> 00:02:01,259
that's pretty much it so before we begin

41
00:01:59,460 --> 00:02:02,939
this is a post exploitation talk I'm

42
00:02:01,259 --> 00:02:05,189
discussing the case where we are already

43
00:02:02,939 --> 00:02:07,289
in and now we want to stay there and we

44
00:02:05,189 --> 00:02:10,079
want to get the data out without being

45
00:02:07,290 --> 00:02:11,670
detected and I'll be addressing at the

46
00:02:10,080 --> 00:02:13,430
end some critics about post exploitation

47
00:02:11,670 --> 00:02:14,899
because some people are claiming the

48
00:02:13,430 --> 00:02:18,409
most expectation is not as interesting

49
00:02:14,900 --> 00:02:22,700
as the expectation itself so let's save

50
00:02:18,409 --> 00:02:24,828
that to the end post exploitation so

51
00:02:22,700 --> 00:02:28,069
it's very interesting in the

52
00:02:24,829 --> 00:02:29,780
organization part to consider post

53
00:02:28,069 --> 00:02:31,488
exploitation because it can tell you a

54
00:02:29,780 --> 00:02:34,969
lot about what's going on in your

55
00:02:31,489 --> 00:02:37,430
organization if you can detect the

56
00:02:34,969 --> 00:02:39,170
machine as an infected one because it

57
00:02:37,430 --> 00:02:42,290
has some sort of a weird process or

58
00:02:39,170 --> 00:02:45,138
something or if you dig deeper it might

59
00:02:42,290 --> 00:02:46,730
even help you identify what infected

60
00:02:45,139 --> 00:02:49,760
your machine is it the banking portion

61
00:02:46,730 --> 00:02:52,189
is it a ransomware or so forth and if

62
00:02:49,760 --> 00:02:55,010
you look at the information that's being

63
00:02:52,189 --> 00:02:57,409
transferred in and out you might be able

64
00:02:55,010 --> 00:02:58,638
to know what's being targeted what are

65
00:02:57,409 --> 00:03:01,189
the secrets that are trying to get

66
00:02:58,639 --> 00:03:03,680
what's the the main goal of this

67
00:03:01,189 --> 00:03:05,480
infection so this is the general concept

68
00:03:03,680 --> 00:03:09,469
of what to look for in post exploitation

69
00:03:05,480 --> 00:03:11,750
and what's actually being done is for

70
00:03:09,469 --> 00:03:14,480
example I can look at a specific process

71
00:03:11,750 --> 00:03:17,000
in that machine and I can ask myself ok

72
00:03:14,480 --> 00:03:19,849
how did this process came to life what

73
00:03:17,000 --> 00:03:22,940
spawned it does this process 3 make

74
00:03:19,849 --> 00:03:24,978
sense this is in terms of a process I

75
00:03:22,940 --> 00:03:27,290
can look at the domain is if this

76
00:03:24,979 --> 00:03:29,629
process is contacting some kind of a

77
00:03:27,290 --> 00:03:31,310
domain or IP I can ask myself is this a

78
00:03:29,629 --> 00:03:33,709
legitimate domain it is this a

79
00:03:31,310 --> 00:03:36,979
legitimate IP maybe it can help me

80
00:03:33,709 --> 00:03:39,739
identify the specific malware type or

81
00:03:36,979 --> 00:03:42,139
Malvo family and I can also look at the

82
00:03:39,739 --> 00:03:43,430
traffic if I can actually go in and see

83
00:03:42,139 --> 00:03:45,859
what's being transferred like him I

84
00:03:43,430 --> 00:03:50,389
might be able to realize what's going on

85
00:03:45,859 --> 00:03:51,799
on my environment and so this is

86
00:03:50,389 --> 00:03:54,409
generally what it looks like for example

87
00:03:51,799 --> 00:03:57,669
suspicious a suspicious process tree

88
00:03:54,409 --> 00:04:01,189
we've got W script it's a Java Script

89
00:03:57,669 --> 00:04:03,079
launching a decoy war document and doing

90
00:04:01,189 --> 00:04:05,358
some stuff this is a Bitcoin address in

91
00:04:03,079 --> 00:04:06,949
the process name so this is probably not

92
00:04:05,359 --> 00:04:08,419
a good thing and if you see this then

93
00:04:06,949 --> 00:04:10,639
you might be aware that ok this machine

94
00:04:08,419 --> 00:04:12,620
is infected and I'm not I might want to

95
00:04:10,639 --> 00:04:14,060
look further into this machine but it

96
00:04:12,620 --> 00:04:18,048
doesn't tell me a whole lot about what's

97
00:04:14,060 --> 00:04:19,849
going on I have to look deeper for

98
00:04:18,048 --> 00:04:22,900
example if I'm looking at the domain and

99
00:04:19,849 --> 00:04:26,060
this this is from the ransomware tracker

100
00:04:22,900 --> 00:04:27,169
website these are all payment gateways

101
00:04:26,060 --> 00:04:29,090
from runs

102
00:04:27,170 --> 00:04:35,720
and I'm sorry that the consumers are not

103
00:04:29,090 --> 00:04:37,760
so are not so fashionably lately because

104
00:04:35,720 --> 00:04:39,440
we've more we've gone to crypto jacking

105
00:04:37,760 --> 00:04:40,849
in crypto mining but when I started this

106
00:04:39,440 --> 00:04:41,780
research on somewhere else where the

107
00:04:40,850 --> 00:04:44,900
latest craze

108
00:04:41,780 --> 00:04:47,210
so these domains are related to run some

109
00:04:44,900 --> 00:04:49,070
wells and if I'm seeing a machine trying

110
00:04:47,210 --> 00:04:50,780
to reach one of these domains I might be

111
00:04:49,070 --> 00:04:52,310
able to know okay this machine is not

112
00:04:50,780 --> 00:04:55,130
only infected it's been infected with

113
00:04:52,310 --> 00:04:59,060
Iran's owner maybe loci maybe server and

114
00:04:55,130 --> 00:05:01,580
so on and the last part is the data for

115
00:04:59,060 --> 00:05:05,060
example this is an exploit kit infection

116
00:05:01,580 --> 00:05:07,969
the last the the line before last is the

117
00:05:05,060 --> 00:05:09,500
actual exploit it's a flash exploit so I

118
00:05:07,970 --> 00:05:11,840
might be able to know okay

119
00:05:09,500 --> 00:05:14,750
this machine has been or is trying to

120
00:05:11,840 --> 00:05:18,140
get infected by Internet Explorer using

121
00:05:14,750 --> 00:05:20,110
flash so these are all steps that

122
00:05:18,140 --> 00:05:22,280
organizations can take in order to

123
00:05:20,110 --> 00:05:24,260
realize what's going on in their

124
00:05:22,280 --> 00:05:27,349
machines but the thing is it's never

125
00:05:24,260 --> 00:05:29,360
ending so you've got a malware it's

126
00:05:27,350 --> 00:05:31,610
doing something you catch it

127
00:05:29,360 --> 00:05:33,710
that's the end of this cycle and in the

128
00:05:31,610 --> 00:05:35,510
other cycle they do something else and

129
00:05:33,710 --> 00:05:38,090
you try to catch it again and the

130
00:05:35,510 --> 00:05:40,820
process continues so I looked at this

131
00:05:38,090 --> 00:05:44,090
and I said okay what if we can come up

132
00:05:40,820 --> 00:05:47,930
with I don't know a generalized formula

133
00:05:44,090 --> 00:05:51,590
which will help us achieve a better post

134
00:05:47,930 --> 00:05:54,470
exploitation stance and I thought okay

135
00:05:51,590 --> 00:05:57,710
if I want to exfiltrate data out of an

136
00:05:54,470 --> 00:06:00,860
organization and which is I guess a main

137
00:05:57,710 --> 00:06:03,440
goal of every infection I I need to

138
00:06:00,860 --> 00:06:05,540
think very carefully on three specific

139
00:06:03,440 --> 00:06:08,180
things I have to think about the process

140
00:06:05,540 --> 00:06:11,090
that's the main in fact or the process

141
00:06:08,180 --> 00:06:14,390
that's expert rating the data I have to

142
00:06:11,090 --> 00:06:16,400
think about where the data is going and

143
00:06:14,390 --> 00:06:19,219
how it's actually being transferred

144
00:06:16,400 --> 00:06:22,179
because I can get caught in on each of

145
00:06:19,220 --> 00:06:25,400
these steps separately and ending my

146
00:06:22,180 --> 00:06:27,920
infection so I suggest and obviously

147
00:06:25,400 --> 00:06:29,750
this is not my film a formula guys have

148
00:06:27,920 --> 00:06:32,360
been discussing this for a long time I

149
00:06:29,750 --> 00:06:34,280
suggest that if we use a legitimate

150
00:06:32,360 --> 00:06:37,060
process communicating with a legitimate

151
00:06:34,280 --> 00:06:40,460
server and using an unidentified

152
00:06:37,060 --> 00:06:42,590
hopefully even better encrypted traffic

153
00:06:40,460 --> 00:06:46,820
and our chances of getting caught would

154
00:06:42,590 --> 00:06:48,830
be decreasing so this is the formula and

155
00:06:46,820 --> 00:06:51,860
we're going to tick off one by one until

156
00:06:48,830 --> 00:06:53,510
we'll reach a generic attack which we

157
00:06:51,860 --> 00:06:55,750
can use and then I'll show you some

158
00:06:53,510 --> 00:06:58,940
scenarios that I can came I came up with

159
00:06:55,750 --> 00:07:01,400
and I actually want to start with the

160
00:06:58,940 --> 00:07:04,219
last one unidentified traffic and in

161
00:07:01,400 --> 00:07:06,710
order to do so let's talk about WebRTC

162
00:07:04,220 --> 00:07:10,040
how many people here know about you see

163
00:07:06,710 --> 00:07:13,430
heard of it oh cool

164
00:07:10,040 --> 00:07:15,350
so web RTC is been around for five six

165
00:07:13,430 --> 00:07:18,140
years something like that I think being

166
00:07:15,350 --> 00:07:20,720
developed and it's the abbreviation of

167
00:07:18,140 --> 00:07:24,080
web real-time communication and

168
00:07:20,720 --> 00:07:26,270
basically what it does allows you to

169
00:07:24,080 --> 00:07:30,740
have peer to peer communication user to

170
00:07:26,270 --> 00:07:32,450
user using the browser not it's they

171
00:07:30,740 --> 00:07:34,940
like to claim that it's only the browser

172
00:07:32,450 --> 00:07:36,620
but you have to connect to a server it's

173
00:07:34,940 --> 00:07:38,120
called the signaling server in order for

174
00:07:36,620 --> 00:07:40,310
you to be able to connect to the other

175
00:07:38,120 --> 00:07:41,920
user but once you've been connected you

176
00:07:40,310 --> 00:07:44,330
have a completely peer-to-peer

177
00:07:41,920 --> 00:07:46,220
connection you can do a lot of stuff

178
00:07:44,330 --> 00:07:50,870
with this and Google will go over it in

179
00:07:46,220 --> 00:07:52,910
a sec and this is a big deal because we

180
00:07:50,870 --> 00:07:55,190
don't have to install anything

181
00:07:52,910 --> 00:07:56,780
unlike torrents that were in the past

182
00:07:55,190 --> 00:07:58,070
and you had to install some drivers you

183
00:07:56,780 --> 00:08:00,469
have to install some programs you have

184
00:07:58,070 --> 00:08:02,630
to configure your firewall you don't

185
00:08:00,470 --> 00:08:06,410
have to do that we're about you see as a

186
00:08:02,630 --> 00:08:08,360
protocol takes care of all of this using

187
00:08:06,410 --> 00:08:12,370
the mediating server to connect you with

188
00:08:08,360 --> 00:08:15,890
the other user and then it's completely

189
00:08:12,370 --> 00:08:19,640
working and to build on top of that

190
00:08:15,890 --> 00:08:22,940
WebRTC uses UDP which basically doesn't

191
00:08:19,640 --> 00:08:26,210
have any security or encryption protocol

192
00:08:22,940 --> 00:08:30,260
but the WebRTC guys have implemented two

193
00:08:26,210 --> 00:08:33,230
security protocols DTLS and SRTP each of

194
00:08:30,260 --> 00:08:35,140
them works for a specific part of the

195
00:08:33,230 --> 00:08:38,030
WebRTC

196
00:08:35,140 --> 00:08:42,049
phases let's call it so for example I

197
00:08:38,030 --> 00:08:43,520
log into the web RTC site and then they

198
00:08:42,049 --> 00:08:44,990
worry about is it tries to connect me

199
00:08:43,520 --> 00:08:47,960
with another user in a peer-to-peer

200
00:08:44,990 --> 00:08:51,440
fashion and this is the DTLS this is

201
00:08:47,960 --> 00:08:53,840
what the DTLS comes to play it's the

202
00:08:51,440 --> 00:08:54,200
Datagram transport layer security very

203
00:08:53,840 --> 00:08:57,980
much

204
00:08:54,200 --> 00:09:00,710
the TLS protocol but for UDP packets and

205
00:08:57,980 --> 00:09:03,020
once we've been connected we have the

206
00:09:00,710 --> 00:09:05,500
SMTP protocol which secures the data

207
00:09:03,020 --> 00:09:07,939
connection the peer-to-peer connection

208
00:09:05,500 --> 00:09:10,820
encrypting the data that's being

209
00:09:07,940 --> 00:09:12,470
transferred so so far this is all I want

210
00:09:10,820 --> 00:09:14,150
to go into able to see I'm not going to

211
00:09:12,470 --> 00:09:16,130
discuss how it's being implemented and

212
00:09:14,150 --> 00:09:17,900
what's going on this is the general

213
00:09:16,130 --> 00:09:21,370
concept this is the communication

214
00:09:17,900 --> 00:09:23,540
protocol I'm going to point for you guys

215
00:09:21,370 --> 00:09:25,910
so now we can check this off the list

216
00:09:23,540 --> 00:09:26,319
we've got unidentified traffic so far so

217
00:09:25,910 --> 00:09:31,360
good

218
00:09:26,320 --> 00:09:33,920
moving on I want to have a process

219
00:09:31,360 --> 00:09:38,540
communicating online and I want it to be

220
00:09:33,920 --> 00:09:40,640
as I don't want it to be suspicious at

221
00:09:38,540 --> 00:09:42,500
all and if I'm looking for a non

222
00:09:40,640 --> 00:09:44,170
suspicious process talking online what's

223
00:09:42,500 --> 00:09:49,070
the first thing that comes to mind a

224
00:09:44,170 --> 00:09:50,959
browser right everybody has a browser it

225
00:09:49,070 --> 00:09:52,760
doesn't matter which kind you can either

226
00:09:50,960 --> 00:09:58,670
use the big ones or Internet Explorer

227
00:09:52,760 --> 00:10:01,040
it's up to you and everybody uses them

228
00:09:58,670 --> 00:10:05,300
it's not suspicious as it has been in

229
00:10:01,040 --> 00:10:08,449
the past and as it so happens web RTC

230
00:10:05,300 --> 00:10:10,670
is implemented by default in all of

231
00:10:08,450 --> 00:10:13,220
these browsers sense these versions and

232
00:10:10,670 --> 00:10:16,670
I think Rome is version 60 something 70

233
00:10:13,220 --> 00:10:18,800
now for example so since version 28 29

234
00:10:16,670 --> 00:10:20,150
it's being implemented by default you

235
00:10:18,800 --> 00:10:22,969
don't have to do anything and it's

236
00:10:20,150 --> 00:10:26,329
enabled by default it doesn't need or

237
00:10:22,970 --> 00:10:28,910
require any flags it simply works so I

238
00:10:26,330 --> 00:10:32,390
have to ask myself are we done is this

239
00:10:28,910 --> 00:10:36,079
enough for me to call it checked off

240
00:10:32,390 --> 00:10:38,300
let's call it well almost

241
00:10:36,080 --> 00:10:39,980
because when WebRTC was developed the

242
00:10:38,300 --> 00:10:42,229
developers we're aware of these

243
00:10:39,980 --> 00:10:45,260
capabilities and how you can abuse them

244
00:10:42,230 --> 00:10:49,130
and so they thought ok we will add some

245
00:10:45,260 --> 00:10:52,340
security mitigations restricting the

246
00:10:49,130 --> 00:10:54,140
usage of security of WebRTC capabilities

247
00:10:52,340 --> 00:10:57,800
only after the user have allowed them

248
00:10:54,140 --> 00:11:00,680
specifically by user interaction so if

249
00:10:57,800 --> 00:11:02,660
you want to use your webcam using robot

250
00:11:00,680 --> 00:11:06,109
you see you have to allow it with this

251
00:11:02,660 --> 00:11:08,069
prompt same goes for the user feedback

252
00:11:06,110 --> 00:11:10,290
that you get you get the audio feedback

253
00:11:08,070 --> 00:11:12,390
the screen capture and so all of these

254
00:11:10,290 --> 00:11:17,160
stuff are very bad for me if I want to

255
00:11:12,390 --> 00:11:20,220
hide my activities from the user and as

256
00:11:17,160 --> 00:11:22,829
it as it turns out you can actually

257
00:11:20,220 --> 00:11:27,240
supply I'm discussing Chrome but it

258
00:11:22,830 --> 00:11:29,910
works for other browsers as well you can

259
00:11:27,240 --> 00:11:32,310
actually supply the browser upon

260
00:11:29,910 --> 00:11:34,350
launching it some arguments which will

261
00:11:32,310 --> 00:11:37,500
disable or enable some capabilities and

262
00:11:34,350 --> 00:11:39,570
for example if I'm doing some automation

263
00:11:37,500 --> 00:11:42,150
testing and I'm using Chrome and I want

264
00:11:39,570 --> 00:11:44,850
to test WebRTC these annoying user

265
00:11:42,150 --> 00:11:48,600
interaction prompts will be very bad for

266
00:11:44,850 --> 00:11:51,240
me so I can simply disable them upon

267
00:11:48,600 --> 00:11:52,920
launching Chrome I'll add use fake UI

268
00:11:51,240 --> 00:11:54,600
for media stream and then Chrome

269
00:11:52,920 --> 00:11:57,240
wouldn't bother asking the user for his

270
00:11:54,600 --> 00:12:00,570
permission the webcam would walk the

271
00:11:57,240 --> 00:12:05,940
screen capture would work audio works no

272
00:12:00,570 --> 00:12:10,260
fast no nothing simply like that and now

273
00:12:05,940 --> 00:12:13,350
I think we can actually call it complete

274
00:12:10,260 --> 00:12:15,810
don't you think because for example if I

275
00:12:13,350 --> 00:12:18,090
covertly launch Chrome with these

276
00:12:15,810 --> 00:12:20,670
arguments and point it to a video chat

277
00:12:18,090 --> 00:12:24,000
site I can gain hidden surveillance on

278
00:12:20,670 --> 00:12:25,560
my victim okay just for example and

279
00:12:24,000 --> 00:12:28,920
let's put a pin in this will go back to

280
00:12:25,560 --> 00:12:30,449
this later on and so far we've got a

281
00:12:28,920 --> 00:12:33,870
legitimate browser and we've got our

282
00:12:30,450 --> 00:12:35,340
legitimate unidentified traffic and just

283
00:12:33,870 --> 00:12:37,610
to show you the connection between these

284
00:12:35,340 --> 00:12:39,810
two this is from the WebRTC security

285
00:12:37,610 --> 00:12:45,480
documentation it's talking about the

286
00:12:39,810 --> 00:12:47,790
browser trust model and it specifically

287
00:12:45,480 --> 00:12:49,470
says that if the browser cannot be

288
00:12:47,790 --> 00:12:52,079
trusted then all of the security

289
00:12:49,470 --> 00:12:55,920
assumptions made by the web RTC protocol

290
00:12:52,080 --> 00:12:58,320
could be dumped because it's based all

291
00:12:55,920 --> 00:12:59,729
all security assumptions on the browser

292
00:12:58,320 --> 00:13:02,520
if something happened to the browser

293
00:12:59,730 --> 00:13:06,420
then this protocols security is

294
00:13:02,520 --> 00:13:08,910
worthless and so browser

295
00:13:06,420 --> 00:13:13,500
unidentified traffic so far and let's

296
00:13:08,910 --> 00:13:15,329
move to legitimate server and I'm

297
00:13:13,500 --> 00:13:19,170
guessing most analysts here can identify

298
00:13:15,330 --> 00:13:21,240
a suspicious server or suspicious domain

299
00:13:19,170 --> 00:13:21,870
just by looking at it you can look at

300
00:13:21,240 --> 00:13:27,029
the till these

301
00:13:21,870 --> 00:13:29,520
right dot X Y Z dot top dot Apple

302
00:13:27,029 --> 00:13:32,760
whatever and you can look at the Whois

303
00:13:29,520 --> 00:13:35,100
information and see that the domain

304
00:13:32,760 --> 00:13:36,720
owner is unknown oh it's lacking all

305
00:13:35,100 --> 00:13:38,370
sorts of information and so forth you

306
00:13:36,720 --> 00:13:41,220
can look at the suspicious subdomains

307
00:13:38,370 --> 00:13:43,650
you know where's my money

308
00:13:41,220 --> 00:13:46,470
Apple pay back all of these kind of

309
00:13:43,650 --> 00:13:48,120
stuff and you can look at the ID ends

310
00:13:46,470 --> 00:13:49,950
and homographs and as well so what I'm

311
00:13:48,120 --> 00:13:53,370
trying to say is it's pretty easy to

312
00:13:49,950 --> 00:13:56,640
identify a malicious or suspicious

313
00:13:53,370 --> 00:13:58,410
domain and what exploit kids do usually

314
00:13:56,640 --> 00:14:01,890
they have two ways of operating they

315
00:13:58,410 --> 00:14:04,020
either spawn these domains and they live

316
00:14:01,890 --> 00:14:06,270
for a day or two and then they switch to

317
00:14:04,020 --> 00:14:08,189
another one all what they do they use a

318
00:14:06,270 --> 00:14:11,100
compromised site so they hack into a

319
00:14:08,190 --> 00:14:13,500
site make it host their code or they

320
00:14:11,100 --> 00:14:16,260
inject redirection iframe or something

321
00:14:13,500 --> 00:14:17,910
and then it's really hard to realize

322
00:14:16,260 --> 00:14:19,950
what's going on because the site itself

323
00:14:17,910 --> 00:14:21,600
is legitimate is just being hacked and

324
00:14:19,950 --> 00:14:24,779
it's being used to redirect traffic and

325
00:14:21,600 --> 00:14:26,790
all sorts so this is similar to what I'm

326
00:14:24,779 --> 00:14:28,310
trying to do here since web RTC has been

327
00:14:26,790 --> 00:14:31,349
developed some guys have developed

328
00:14:28,310 --> 00:14:34,229
WebRTC sites you've got group chat video

329
00:14:31,350 --> 00:14:36,029
chat file-sharing and so on and people

330
00:14:34,230 --> 00:14:38,370
have uploaded these sites online for

331
00:14:36,029 --> 00:14:41,279
free for the community to use and test

332
00:14:38,370 --> 00:14:44,339
WebRTC and these sites are completely

333
00:14:41,279 --> 00:14:46,140
completely legitimate I mean there's no

334
00:14:44,339 --> 00:14:48,240
suspicious behavior going on and this is

335
00:14:46,140 --> 00:14:55,250
exactly what I'm aiming for I want to

336
00:14:48,240 --> 00:14:58,050
use these sites to hide my traffic and

337
00:14:55,250 --> 00:15:00,779
so far I think we can call it a

338
00:14:58,050 --> 00:15:03,300
legitimate server complete and I think

339
00:15:00,779 --> 00:15:04,640
in terms of the formula we are done so

340
00:15:03,300 --> 00:15:07,349
we're going to use the browser

341
00:15:04,640 --> 00:15:10,620
communicate over WebRTC using these

342
00:15:07,350 --> 00:15:14,400
sites as the cover for our communication

343
00:15:10,620 --> 00:15:18,209
and we hopefully we will be able to

344
00:15:14,400 --> 00:15:22,050
achieve some covert actions and so I

345
00:15:18,209 --> 00:15:23,310
prepared as I said two scenarios and the

346
00:15:22,050 --> 00:15:25,020
first one you're going to have to excuse

347
00:15:23,310 --> 00:15:27,060
my animation skills you understand what

348
00:15:25,020 --> 00:15:28,350
I'm talking about in a sec so the first

349
00:15:27,060 --> 00:15:31,109
scenario is pretty easy and as I said

350
00:15:28,350 --> 00:15:35,250
I'm not discussing infection whatsoever

351
00:15:31,110 --> 00:15:36,040
so the infection stage is done ok the

352
00:15:35,250 --> 00:15:38,529
user has been in

353
00:15:36,040 --> 00:15:40,240
affected and what happens let's say it's

354
00:15:38,529 --> 00:15:42,250
a document right so the user has opened

355
00:15:40,240 --> 00:15:46,990
the document has enabled content and so

356
00:15:42,250 --> 00:15:49,810
forth and so in the background Chrome

357
00:15:46,990 --> 00:15:52,540
has been launched and has been

358
00:15:49,810 --> 00:15:55,479
redirected into a legitimate web RTC

359
00:15:52,540 --> 00:15:58,630
video chat site using the use fake UI

360
00:15:55,480 --> 00:16:01,620
argument to disregard all security

361
00:15:58,630 --> 00:16:04,240
mitigations and this is a predefined

362
00:16:01,620 --> 00:16:06,759
video chat room that the attacker has

363
00:16:04,240 --> 00:16:10,899
already set up in advance and once this

364
00:16:06,759 --> 00:16:13,029
all happens the attacker gets a constant

365
00:16:10,899 --> 00:16:15,069
stream of video surveillance on the

366
00:16:13,029 --> 00:16:18,610
victim which is pretty cool but the

367
00:16:15,069 --> 00:16:21,099
thing is when you when you open the web

368
00:16:18,610 --> 00:16:23,230
cam you get this tiny LED showing that

369
00:16:21,100 --> 00:16:26,470
the webcam is is on and usually on the

370
00:16:23,230 --> 00:16:29,889
latest laptops it's hard well into the

371
00:16:26,470 --> 00:16:31,089
webcam so when the webcam gets power so

372
00:16:29,889 --> 00:16:34,300
does the LED and there's not much you

373
00:16:31,089 --> 00:16:38,019
can do about it with the software but if

374
00:16:34,300 --> 00:16:41,050
we use only an audio feed that does not

375
00:16:38,019 --> 00:16:43,029
turn on the LED then you get a constant

376
00:16:41,050 --> 00:16:45,490
stream of audio surveillance in the

377
00:16:43,029 --> 00:16:47,170
background and you can you might say

378
00:16:45,490 --> 00:16:49,839
it's persistent for as long as the user

379
00:16:47,170 --> 00:16:51,250
does not reboot his machine the process

380
00:16:49,839 --> 00:16:55,480
will remain there and you'll get an

381
00:16:51,250 --> 00:16:58,930
audio feed on that user and I'll show a

382
00:16:55,480 --> 00:17:02,350
video now and I've used it for the video

383
00:16:58,930 --> 00:17:05,109
surveillance scenario because it looks

384
00:17:02,350 --> 00:17:09,630
cooler but I suggest audio feed because

385
00:17:05,109 --> 00:17:12,010
it's more cover but you do you and

386
00:17:09,630 --> 00:17:13,750
before we begin okay so this is the

387
00:17:12,010 --> 00:17:16,629
attackers now what we're looking at at

388
00:17:13,750 --> 00:17:19,390
the attacker is setting up is chatroom

389
00:17:16,630 --> 00:17:21,189
it's called the attacker and then it's

390
00:17:19,390 --> 00:17:22,480
gonna decrease in size and we're going

391
00:17:21,189 --> 00:17:24,970
to see the victim opening the document

392
00:17:22,480 --> 00:17:26,260
infecting itself and then in a small

393
00:17:24,970 --> 00:17:27,880
corner above we're going to see the

394
00:17:26,260 --> 00:17:35,559
attacker spying on the victim while the

395
00:17:27,880 --> 00:17:35,970
victim is playing solitaire so yeah as

396
00:17:35,559 --> 00:17:39,120
you can

397
00:17:35,970 --> 00:17:41,789
open to LTC that's the site completely

398
00:17:39,120 --> 00:17:45,689
legitimate and this is the infection

399
00:17:41,789 --> 00:17:54,169
part as I said not that interesting the

400
00:17:45,690 --> 00:17:54,169
user can be infected in either way yeah

401
00:17:54,230 --> 00:17:59,070
well it's good the user continues with

402
00:17:57,179 --> 00:18:01,950
his activities and check the attackers

403
00:17:59,070 --> 00:18:07,260
side above and you got some more video

404
00:18:01,950 --> 00:18:08,880
surveillance on the user and yet this

405
00:18:07,260 --> 00:18:12,900
just keeps on going I play solitaire and

406
00:18:08,880 --> 00:18:15,750
I I lose at the end by the way okay so

407
00:18:12,900 --> 00:18:17,640
this is bad enough right cool what do

408
00:18:15,750 --> 00:18:24,090
you think so far okay

409
00:18:17,640 --> 00:18:25,710
thank you and so when I was showing this

410
00:18:24,090 --> 00:18:27,270
to some friends of mine they said okay

411
00:18:25,710 --> 00:18:30,360
that's cool but you know let's talk

412
00:18:27,270 --> 00:18:31,980
about you know second stage payload then

413
00:18:30,360 --> 00:18:34,350
how you can how you can do something

414
00:18:31,980 --> 00:18:36,030
like wars with this and apparently we're

415
00:18:34,350 --> 00:18:38,639
about to see supports file-sharing as

416
00:18:36,030 --> 00:18:41,340
well and there are specific WebRTC

417
00:18:38,640 --> 00:18:43,710
file-sharing sites which you can use and

418
00:18:41,340 --> 00:18:45,389
I'm guessing you you you kind of realize

419
00:18:43,710 --> 00:18:47,640
what I'm going with this so this is the

420
00:18:45,390 --> 00:18:50,820
animation to show it so we have our

421
00:18:47,640 --> 00:18:52,850
peer-to-peer connection and which ones

422
00:18:50,820 --> 00:18:56,399
for the malware to the user for

423
00:18:52,850 --> 00:18:58,110
execution and the way I chose to

424
00:18:56,400 --> 00:19:00,000
implement this and I'm aware that this

425
00:18:58,110 --> 00:19:01,799
is might be this might be not the best

426
00:19:00,000 --> 00:19:03,510
way to do it and you can do it in memory

427
00:19:01,799 --> 00:19:06,059
and not save anything to disk but I

428
00:19:03,510 --> 00:19:09,658
choose to do it like that because it's

429
00:19:06,059 --> 00:19:12,120
easier so for example you were infected

430
00:19:09,659 --> 00:19:14,730
the user was infected PowerShell is

431
00:19:12,120 --> 00:19:17,428
running and it writes a local HTML file

432
00:19:14,730 --> 00:19:19,590
to the disk it has an iframe connecting

433
00:19:17,429 --> 00:19:22,169
to that web RTC file sharing site and

434
00:19:19,590 --> 00:19:24,000
the mainframe called controls the iframe

435
00:19:22,169 --> 00:19:26,130
with JavaScript eventually downloading

436
00:19:24,000 --> 00:19:29,820
the file I know it's it's a lot to

437
00:19:26,130 --> 00:19:32,309
comprehend it's kind of a mess but when

438
00:19:29,820 --> 00:19:35,220
you write a local HTML file to the

439
00:19:32,309 --> 00:19:36,928
machine trying to contact an HTTP file

440
00:19:35,220 --> 00:19:39,169
you encounter the same origin policy

441
00:19:36,929 --> 00:19:42,150
that's being enforced by the browser

442
00:19:39,169 --> 00:19:45,840
which is a problem that's that's exactly

443
00:19:42,150 --> 00:19:48,390
the same file trying to access HTTP but

444
00:19:45,840 --> 00:19:49,860
the browser so currently supports the

445
00:19:48,390 --> 00:19:51,870
disable web secure

446
00:19:49,860 --> 00:19:54,629
the argument you can add that alongside

447
00:19:51,870 --> 00:19:56,040
they use fake UI if you want to and then

448
00:19:54,630 --> 00:19:59,760
you shouldn't have any problems

449
00:19:56,040 --> 00:20:01,530
according to Chrome's documentation so

450
00:19:59,760 --> 00:20:03,840
this should take care of that but

451
00:20:01,530 --> 00:20:05,790
apparently this is not enough because

452
00:20:03,840 --> 00:20:09,030
now we get another problem we've got the

453
00:20:05,790 --> 00:20:13,678
local an iframe which it's origin is

454
00:20:09,030 --> 00:20:15,210
null trying to reach an HTTP website so

455
00:20:13,679 --> 00:20:19,530
that's because of the frames that we

456
00:20:15,210 --> 00:20:22,770
used but apparently if you add the user

457
00:20:19,530 --> 00:20:23,850
directory pointing to a random directory

458
00:20:22,770 --> 00:20:25,980
so the whole thing about the user

459
00:20:23,850 --> 00:20:28,199
directory in chrome is that you can have

460
00:20:25,980 --> 00:20:30,150
two users on the same machine having

461
00:20:28,200 --> 00:20:32,970
different configurations and you can

462
00:20:30,150 --> 00:20:35,160
tell chrome okay you start with this

463
00:20:32,970 --> 00:20:37,470
configuration from this directory or

464
00:20:35,160 --> 00:20:40,380
start chrome with this configuration

465
00:20:37,470 --> 00:20:42,809
from this directory according to the

466
00:20:40,380 --> 00:20:45,299
user but as it turns out if you point it

467
00:20:42,809 --> 00:20:48,200
to some random directory which has

468
00:20:45,299 --> 00:20:51,000
nothing chrome will spit out the default

469
00:20:48,200 --> 00:20:53,429
configuration file and this is what it

470
00:20:51,000 --> 00:20:57,990
takes to make disabled web security

471
00:20:53,429 --> 00:21:01,980
works I don't know why so I asked them

472
00:20:57,990 --> 00:21:03,900
and they said it's by design and it's a

473
00:21:01,980 --> 00:21:07,080
no fix you can check it out this is the

474
00:21:03,900 --> 00:21:09,030
the bug details and so I said okay if

475
00:21:07,080 --> 00:21:15,570
it's by design and it's a no fix by all

476
00:21:09,030 --> 00:21:16,678
means I'm gonna use it and so this is

477
00:21:15,570 --> 00:21:19,409
what it looks like we're gonna see the

478
00:21:16,679 --> 00:21:21,510
victim infecting itself and in the

479
00:21:19,410 --> 00:21:24,840
background logging into this file

480
00:21:21,510 --> 00:21:26,250
sharing website and after that you got

481
00:21:24,840 --> 00:21:28,830
we will be moved to the attacker and

482
00:21:26,250 --> 00:21:31,820
we'll see how he sets up the malware and

483
00:21:28,830 --> 00:21:33,809
actually transfers it to the victim

484
00:21:31,820 --> 00:21:38,309
interesting thing about chrome is it

485
00:21:33,809 --> 00:21:40,559
doesn't let you upload exe files so I

486
00:21:38,309 --> 00:21:42,480
kind of change it to dot malicious which

487
00:21:40,559 --> 00:21:44,760
is stands for nothing but the Malik and

488
00:21:42,480 --> 00:21:51,980
my powershell script can actually handle

489
00:21:44,760 --> 00:21:51,980
this okay so once again

490
00:21:58,700 --> 00:22:02,910
yeah okay so infection this was well

491
00:22:01,800 --> 00:22:04,350
obvious but this is the attackers

492
00:22:02,910 --> 00:22:06,000
machine I don't know if you could spot

493
00:22:04,350 --> 00:22:09,870
by the malicious Mickey Mouse but this

494
00:22:06,000 --> 00:22:11,820
is the so these are just actions that

495
00:22:09,870 --> 00:22:14,760
I'm doing because you know chrome does

496
00:22:11,820 --> 00:22:17,070
not support XE as I said but you can

497
00:22:14,760 --> 00:22:21,090
have it whatever you want so now I'm

498
00:22:17,070 --> 00:22:22,710
logging to the predefined file sharing

499
00:22:21,090 --> 00:22:25,409
and as you can see there are two users

500
00:22:22,710 --> 00:22:27,770
logged in me and the victim I share the

501
00:22:25,410 --> 00:22:30,450
file which has been shared successfully

502
00:22:27,770 --> 00:22:32,639
now we're gonna get back to the user and

503
00:22:30,450 --> 00:22:35,360
I want to point you there will be an L

504
00:22:32,640 --> 00:22:40,020
but check out this part of the screen

505
00:22:35,360 --> 00:22:42,330
see this is the chrome download symbol

506
00:22:40,020 --> 00:22:44,280
and the Marvel were actually done was

507
00:22:42,330 --> 00:22:46,439
actually downloaded to the Downloads

508
00:22:44,280 --> 00:22:49,950
folder because this is what chrome does

509
00:22:46,440 --> 00:22:51,870
and you can continue your doing and just

510
00:22:49,950 --> 00:22:56,520
in a few seconds I didn't edit it so

511
00:22:51,870 --> 00:22:59,669
okay there we go so we have been

512
00:22:56,520 --> 00:23:01,530
infected with the server encrypter it's

513
00:22:59,670 --> 00:23:04,950
an imitation of the selber ransomware

514
00:23:01,530 --> 00:23:12,750
and so forth I got this from somewhere

515
00:23:04,950 --> 00:23:15,270
so infection right but this as I said

516
00:23:12,750 --> 00:23:17,610
these are just some of the scenarios

517
00:23:15,270 --> 00:23:19,560
that we can discuss for example about

518
00:23:17,610 --> 00:23:21,510
this is supports file sharing you wanna

519
00:23:19,560 --> 00:23:24,300
have an active spying on your victim by

520
00:23:21,510 --> 00:23:26,640
all means do it if you want to exchange

521
00:23:24,300 --> 00:23:30,659
data you can send you you can use web

522
00:23:26,640 --> 00:23:32,940
RTC as a data channel to send comments

523
00:23:30,660 --> 00:23:35,700
to your implant or you can receive data

524
00:23:32,940 --> 00:23:37,470
from that implant using WebRTC it's

525
00:23:35,700 --> 00:23:39,960
completely encrypted so nobody will be

526
00:23:37,470 --> 00:23:42,900
able to know what's going on in this

527
00:23:39,960 --> 00:23:44,490
machine and I don't know you can use it

528
00:23:42,900 --> 00:23:47,340
for crypto checking it's kind of hot

529
00:23:44,490 --> 00:23:48,540
recently so I added this I guess you can

530
00:23:47,340 --> 00:23:53,959
do it without what about you see but

531
00:23:48,540 --> 00:23:57,149
it's cool so okay so a few quick notes

532
00:23:53,960 --> 00:24:02,400
and I'm ahead of time actually so I'll

533
00:23:57,150 --> 00:24:03,990
talk slower this guy which I don't know

534
00:24:02,400 --> 00:24:07,230
how to pronounce his name

535
00:24:03,990 --> 00:24:10,020
he's uh he did something very cool and

536
00:24:07,230 --> 00:24:13,110
quite similar and he used Internet

537
00:24:10,020 --> 00:24:14,820
Explorer so edge supposedly supports

538
00:24:13,110 --> 00:24:19,350
we're about to see but Internet Explorer

539
00:24:14,820 --> 00:24:21,600
does not and this guy what he did he

540
00:24:19,350 --> 00:24:24,600
said okay I'm infecting my machine not

541
00:24:21,600 --> 00:24:28,020
very interesting and now I am using calm

542
00:24:24,600 --> 00:24:30,260
to initiate and a let's call it Internet

543
00:24:28,020 --> 00:24:32,550
Explorer process in the background and

544
00:24:30,260 --> 00:24:34,590
because Internet Explorer supports

545
00:24:32,550 --> 00:24:38,879
WebSockets I'm gonna use WebSockets to

546
00:24:34,590 --> 00:24:40,830
communicate with my domain and have my

547
00:24:38,880 --> 00:24:42,000
commands go like this which is very cool

548
00:24:40,830 --> 00:24:43,740
actually it's it's quite different

549
00:24:42,000 --> 00:24:46,290
because for example WebSockets whelk

550
00:24:43,740 --> 00:24:49,200
anticipate and we're about to see on UDP

551
00:24:46,290 --> 00:24:52,110
this is not encrypted this is what what

552
00:24:49,200 --> 00:24:53,970
you see is encrypted but the the general

553
00:24:52,110 --> 00:24:56,969
concept was very similar so I thought ok

554
00:24:53,970 --> 00:24:58,170
it's worth showing but if you are if you

555
00:24:56,970 --> 00:25:00,290
don't want to use that you can simply

556
00:24:58,170 --> 00:25:03,120
install this plug-in I saw it online

557
00:25:00,290 --> 00:25:04,320
more than whatever downloads and it's

558
00:25:03,120 --> 00:25:06,179
supposed everything and once you've

559
00:25:04,320 --> 00:25:08,909
installed that you've got WebRTC working

560
00:25:06,180 --> 00:25:11,400
in Internet Explorer which you can

561
00:25:08,910 --> 00:25:15,300
launch with calm and I really like it

562
00:25:11,400 --> 00:25:18,270
it's really cool and that's pretty much

563
00:25:15,300 --> 00:25:22,680
it so yeah I know final notes it's kind

564
00:25:18,270 --> 00:25:25,110
of a head of time but yeah if we

565
00:25:22,680 --> 00:25:27,210
consider incident responders looking at

566
00:25:25,110 --> 00:25:29,909
these attacks and trying to figure out

567
00:25:27,210 --> 00:25:34,800
what's going on so in the signaling

568
00:25:29,910 --> 00:25:36,750
phase well the the machine first connect

569
00:25:34,800 --> 00:25:39,419
to the mediating site to the signaling

570
00:25:36,750 --> 00:25:41,820
server let's say it's HTTP so you can

571
00:25:39,420 --> 00:25:44,160
see a machine connecting to a web RTC

572
00:25:41,820 --> 00:25:45,960
site and exchanging the signaling data

573
00:25:44,160 --> 00:25:49,560
but if it's HTTP then you can't even

574
00:25:45,960 --> 00:25:52,650
tell what's going on in there and the

575
00:25:49,560 --> 00:25:56,669
site is legitimate as we say as we said

576
00:25:52,650 --> 00:25:59,130
and the communication is where UDP and

577
00:25:56,670 --> 00:26:03,720
encrypted so far so good

578
00:25:59,130 --> 00:26:05,850
appears legit taking a step further if

579
00:26:03,720 --> 00:26:07,920
we look at the second scenario where

580
00:26:05,850 --> 00:26:09,929
I've downloaded something to disk it was

581
00:26:07,920 --> 00:26:12,660
actually Chrome downloading something

582
00:26:09,930 --> 00:26:15,030
into the Downloads folder this appears

583
00:26:12,660 --> 00:26:17,640
to be regular behavior of Chrome nothing

584
00:26:15,030 --> 00:26:17,910
to suspect so far and in the audio

585
00:26:17,640 --> 00:26:20,280
server

586
00:26:17,910 --> 00:26:22,170
violence I've I've saved nothing to disk

587
00:26:20,280 --> 00:26:24,450
I've simply launched chrome with

588
00:26:22,170 --> 00:26:30,540
arguments and so there's nothing to

589
00:26:24,450 --> 00:26:33,420
suspect in this sense of the attack and

590
00:26:30,540 --> 00:26:36,060
as I said I wanted to address the post

591
00:26:33,420 --> 00:26:37,620
exploitation critics and a lot of people

592
00:26:36,060 --> 00:26:39,389
have been telling me ok so you're

593
00:26:37,620 --> 00:26:41,189
already in the machine you can do

594
00:26:39,390 --> 00:26:43,020
whatever you want you know you want to

595
00:26:41,190 --> 00:26:44,820
exfiltrate data so exfiltrate the data

596
00:26:43,020 --> 00:26:46,950
why do you need to go through all of

597
00:26:44,820 --> 00:26:50,250
this fast to do what you're trying to do

598
00:26:46,950 --> 00:26:52,890
and I I say ok

599
00:26:50,250 --> 00:26:54,330
getting in is only half the job if you

600
00:26:52,890 --> 00:26:56,910
haven't planned what you will be doing

601
00:26:54,330 --> 00:27:00,750
after you got in then this attack won't

602
00:26:56,910 --> 00:27:03,060
succeed so if you wanna steal something

603
00:27:00,750 --> 00:27:05,010
if you if we think about a thief going

604
00:27:03,060 --> 00:27:06,810
into your house and then walking outside

605
00:27:05,010 --> 00:27:08,670
with the TV I mean this is something

606
00:27:06,810 --> 00:27:12,120
that you might be aware of and you might

607
00:27:08,670 --> 00:27:14,490
be able to stop so getting in is only

608
00:27:12,120 --> 00:27:17,479
really half the job you have to get out

609
00:27:14,490 --> 00:27:20,070
or stay there or get the data out in a

610
00:27:17,480 --> 00:27:21,480
covert way in order for this attack to

611
00:27:20,070 --> 00:27:23,820
work in order for you to make money

612
00:27:21,480 --> 00:27:25,620
because you might be getting money from

613
00:27:23,820 --> 00:27:27,270
getting in but the actual money that the

614
00:27:25,620 --> 00:27:29,580
attackers make are from stealing

615
00:27:27,270 --> 00:27:32,580
something or getting information to

616
00:27:29,580 --> 00:27:36,870
someone so this is follow the post

617
00:27:32,580 --> 00:27:39,090
exploitation critics out there let's

618
00:27:36,870 --> 00:27:42,479
talk about some blue notes if you want

619
00:27:39,090 --> 00:27:44,370
to protect from this attack you can

620
00:27:42,480 --> 00:27:46,790
disable about to see hopefully it's not

621
00:27:44,370 --> 00:27:49,260
that easy as you think I mean you can

622
00:27:46,790 --> 00:27:52,620
specifically tell the browser using the

623
00:27:49,260 --> 00:27:57,420
chrome flags page disable what about the

624
00:27:52,620 --> 00:27:59,250
C communication the thing about what you

625
00:27:57,420 --> 00:28:03,450
see using the signaling protocol is that

626
00:27:59,250 --> 00:28:06,390
WebRTC tries to find open ports it can

627
00:28:03,450 --> 00:28:08,520
use so it it's kind of hard to block in

628
00:28:06,390 --> 00:28:11,910
terms of firewall but you can trying to

629
00:28:08,520 --> 00:28:15,260
inspect web UDP ports to try to see if

630
00:28:11,910 --> 00:28:17,820
it has we're about to see communication

631
00:28:15,260 --> 00:28:18,930
traffic or communication aspects and

632
00:28:17,820 --> 00:28:20,639
then you can go to that machine and

633
00:28:18,930 --> 00:28:24,090
check out what this user is doing with

634
00:28:20,640 --> 00:28:26,100
WebRTC in terms of the browser

635
00:28:24,090 --> 00:28:28,050
specifically chrome you can prevent

636
00:28:26,100 --> 00:28:30,449
other processes from launching Chrome

637
00:28:28,050 --> 00:28:31,649
you can say only the user only I don't

638
00:28:30,450 --> 00:28:35,460
know which one I'm launching

639
00:28:31,650 --> 00:28:37,260
from and moreover you can say this these

640
00:28:35,460 --> 00:28:39,390
arguments are the one I want to be

641
00:28:37,260 --> 00:28:42,330
supplied to Chrome nothing else no use

642
00:28:39,390 --> 00:28:44,790
fake UI no disable no nothing Chrome

643
00:28:42,330 --> 00:28:47,760
this is how it goes any other way I want

644
00:28:44,790 --> 00:28:49,860
it blocked and notified and so forth and

645
00:28:47,760 --> 00:28:53,010
so this I'll these are the blue notes

646
00:28:49,860 --> 00:28:55,679
and I thought about some red notes as

647
00:28:53,010 --> 00:28:57,660
well because when I started this

648
00:28:55,680 --> 00:28:59,670
presentation this research Chrome and

649
00:28:57,660 --> 00:29:02,670
Firefox did not have the headless mode

650
00:28:59,670 --> 00:29:04,830
which is relatively new so I launched

651
00:29:02,670 --> 00:29:06,510
Chrome and using PowerShell I

652
00:29:04,830 --> 00:29:08,370
immediately caught the window and send

653
00:29:06,510 --> 00:29:10,740
it to the background but you can use

654
00:29:08,370 --> 00:29:11,820
Chrome headless mode or if you don't

655
00:29:10,740 --> 00:29:14,190
want to use headless mode you can use

656
00:29:11,820 --> 00:29:15,990
popliteal or selenium which are

657
00:29:14,190 --> 00:29:19,680
environments you can use to control

658
00:29:15,990 --> 00:29:22,140
chrome and actually I've found out that

659
00:29:19,680 --> 00:29:26,900
puppeteer supports arguments for example

660
00:29:22,140 --> 00:29:30,960
use fake UI for media stream so it works

661
00:29:26,900 --> 00:29:33,180
and what about mobile devices so in

662
00:29:30,960 --> 00:29:35,430
terms of iOS I'm not so sure but in

663
00:29:33,180 --> 00:29:37,500
terms of Android what about UC is

664
00:29:35,430 --> 00:29:39,210
completely supported so you have to in

665
00:29:37,500 --> 00:29:42,630
think about your infection mechanism and

666
00:29:39,210 --> 00:29:46,320
everything but this works in WebRTC web

667
00:29:42,630 --> 00:29:50,880
RTC works in Android so feel free to try

668
00:29:46,320 --> 00:29:55,020
it out and some cool research that I've

669
00:29:50,880 --> 00:29:57,750
seen along the way so this is the

670
00:29:55,020 --> 00:29:59,670
WebSockets an Internet Explorer some

671
00:29:57,750 --> 00:30:00,840
connectionless backdoor ideas I highly

672
00:29:59,670 --> 00:30:04,620
recommend you to check it out if this

673
00:30:00,840 --> 00:30:06,870
interests you and this guy what he did

674
00:30:04,620 --> 00:30:10,229
he used a browser to transfer commands

675
00:30:06,870 --> 00:30:12,570
to his implant in the machine so it's

676
00:30:10,230 --> 00:30:14,460
quite similar I'll be sharing this slide

677
00:30:12,570 --> 00:30:18,000
anyway so you can have a look at them

678
00:30:14,460 --> 00:30:27,320
afterwards and quite ahead of time but

679
00:30:18,000 --> 00:30:27,320
I'm I'm finished so questions questions

680
00:30:28,360 --> 00:30:31,649
[Music]

681
00:30:35,960 --> 00:30:45,440
so yeah so we have a peer-to-peer

682
00:30:41,010 --> 00:30:48,330
connection and that means you would be

683
00:30:45,440 --> 00:30:50,010
more or less in the same case as on the

684
00:30:48,330 --> 00:30:54,360
machine trying to transfer again from

685
00:30:50,010 --> 00:30:56,879
the other side I'm having a hard time

686
00:30:54,360 --> 00:30:59,419
understanding this okay so you you

687
00:30:56,880 --> 00:31:02,250
compromised the machine yeah and then

688
00:30:59,420 --> 00:31:04,530
you transfer to another machine using

689
00:31:02,250 --> 00:31:06,500
peer-to-peer using WebRTC from from that

690
00:31:04,530 --> 00:31:09,300
machine then you have to do it again

691
00:31:06,500 --> 00:31:15,300
because you are more or less in the same

692
00:31:09,300 --> 00:31:17,430
situation I'm not sure I understand so

693
00:31:15,300 --> 00:31:19,379
you establish a peer-to-peer connection

694
00:31:17,430 --> 00:31:21,890
yeah you transfer already the files to

695
00:31:19,380 --> 00:31:24,870
the other machine so what do we do there

696
00:31:21,890 --> 00:31:28,110
from the attackers machine yeah whatever

697
00:31:24,870 --> 00:31:29,760
you want yeah but would you not consider

698
00:31:28,110 --> 00:31:31,979
this machine vulnerable because you have

699
00:31:29,760 --> 00:31:33,810
a peer-to-peer it's a multiple

700
00:31:31,980 --> 00:31:36,150
connection to a specific victim which I

701
00:31:33,810 --> 00:31:38,490
have an implant within that's in my

702
00:31:36,150 --> 00:31:40,170
control so if I got the files I can

703
00:31:38,490 --> 00:31:42,900
close the peer-to-peer connection on my

704
00:31:40,170 --> 00:31:50,900
side the attacking side and then it's

705
00:31:42,900 --> 00:31:50,900
done okay good thanks yeah

706
00:31:54,770 --> 00:32:01,500
you were talking about the suspicious

707
00:31:57,900 --> 00:32:04,320
process tree yeah and in your example of

708
00:32:01,500 --> 00:32:07,200
the file transfer actually it's Marshall

709
00:32:04,320 --> 00:32:09,080
executing web RTC and then monitoring

710
00:32:07,200 --> 00:32:12,330
the variance of something in the

711
00:32:09,080 --> 00:32:14,429
download folder is that right oh yeah as

712
00:32:12,330 --> 00:32:16,199
I said the infection part is less the

713
00:32:14,430 --> 00:32:19,110
thing that I focused on I mean you can

714
00:32:16,200 --> 00:32:24,090
have for example a user being infected

715
00:32:19,110 --> 00:32:25,709
by a world document did de downloads

716
00:32:24,090 --> 00:32:28,290
something that sits in the background

717
00:32:25,710 --> 00:32:29,670
and after two days writes an HTML file I

718
00:32:28,290 --> 00:32:31,260
mean you can play with it as much as you

719
00:32:29,670 --> 00:32:32,160
want this was just a plain example to

720
00:32:31,260 --> 00:32:35,220
show what it looks like

721
00:32:32,160 --> 00:32:38,280
my question was did you because you were

722
00:32:35,220 --> 00:32:40,830
writing a HTML file a local HTML file to

723
00:32:38,280 --> 00:32:42,899
bypass array of settings and then passed

724
00:32:40,830 --> 00:32:46,710
the arguments in chrome to disable

725
00:32:42,900 --> 00:32:50,880
security features did you dig into

726
00:32:46,710 --> 00:32:54,060
further how if you could make this HTML

727
00:32:50,880 --> 00:32:56,280
file these are an launched chrome to be

728
00:32:54,060 --> 00:32:58,710
completely self-sufficient without

729
00:32:56,280 --> 00:33:01,560
requiring a PowerShell to execute the

730
00:32:58,710 --> 00:33:05,400
downloaded file or being able to get

731
00:33:01,560 --> 00:33:08,220
commands over WebRTC to browse files

732
00:33:05,400 --> 00:33:10,140
just from the HTML file and then upload

733
00:33:08,220 --> 00:33:14,220
files from the victim to the attacker

734
00:33:10,140 --> 00:33:16,050
and so on so the reason I chose local

735
00:33:14,220 --> 00:33:18,840
HTML file with an iframe is just I

736
00:33:16,050 --> 00:33:20,820
wanted to address that this specific

737
00:33:18,840 --> 00:33:23,490
file sharing site which which had a

738
00:33:20,820 --> 00:33:25,500
download link so it was in terms of the

739
00:33:23,490 --> 00:33:27,150
site but if you build your attack and

740
00:33:25,500 --> 00:33:30,150
you know the file sharing site that you

741
00:33:27,150 --> 00:33:31,500
use or you set up your own legitimate

742
00:33:30,150 --> 00:33:37,520
file sharing site that you can work with

743
00:33:31,500 --> 00:33:37,520
it whatever you way you want thank you

744
00:33:51,050 --> 00:33:55,200
thank you

745
00:33:52,470 --> 00:33:59,970
is it possible to enumerate the initial

746
00:33:55,200 --> 00:34:01,470
UDP connection to the RTC stuff like if

747
00:33:59,970 --> 00:34:04,380
you want to write a rule let's say

748
00:34:01,470 --> 00:34:07,620
you're on Ubuntu and inside there Ubuntu

749
00:34:04,380 --> 00:34:09,990
you have Windows machine but you are

750
00:34:07,620 --> 00:34:11,668
trying to in fact whatever and on your

751
00:34:09,989 --> 00:34:14,790
body you want to write some a snort role

752
00:34:11,668 --> 00:34:16,918
would be possible to like take the

753
00:34:14,790 --> 00:34:20,460
initial phase of the UDP connection but

754
00:34:16,918 --> 00:34:22,620
there I haven't tried it sounds like you

755
00:34:20,460 --> 00:34:25,168
can like from your question I think

756
00:34:22,620 --> 00:34:28,130
might yeah but I don't know haven't

757
00:34:25,168 --> 00:34:28,129
tried it okay

758
00:34:30,110 --> 00:34:39,280
more questions ok so thank you thank you

759
00:34:38,520 --> 00:34:42,708
very much guys

760
00:34:39,280 --> 00:34:42,709
[Applause]

